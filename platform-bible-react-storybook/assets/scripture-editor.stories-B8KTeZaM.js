var tp=Object.defineProperty;var np=(t,e,n)=>e in t?tp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var sn=(t,e,n)=>np(t,typeof e!="symbol"?e+"":e,n);import{j as m}from"./jsx-runtime-D2yWc6If.js";import{c as ln,g as rp,r as _}from"./iframe-D8E0DHM7.js";import{H as hd,m as ot,V as sp,T as as,O as ls,w as ip,L as op,I as ap,D as Ua}from"./index-Dk3kgKOJ.js";import{C as yn,l as Et,d as fd,y as X,e as Ie,u as mi,g as lp,L as re,N as Dt,w as cp,h as Pl,W as es,S as we,k as ee,I as up,U as Xe,o as ce,p as Vr,q as Gr,s as pd,K as xe,J as gd,t as Ba,A as da,v as Ha,z as dp,B as md,F as hp,G as yd,H as fp,M as pp,O as bd,Q as gp,R as mp,T as yp,V as bp,Y as _p,Z as kr,a0 as Wa,a1 as _d,a2 as kp,a3 as kd,a4 as vp,a5 as wp,a6 as xp,a7 as vd,a8 as Bi,a9 as wd,aa as $l,ab as Cp,ac as Hi,ad as Wi,ae as Sp,af as Tp,ag as Dl,ah as Ep,ai as Bo,aj as Op,ak as Mp,al as ql,am as Ll,an as Ap,ao as jp,ap as Np,aq as Ip,ar as Rp,as as Pp,at as $p,au as Dp,av as qp,aw as Lp,ax as Fp,ay as Up,az as za,aA as Bp,aB as xd,aC as Hp,f as Cd,D as Ka,a as Wp,n as Sd,x as Td,aD as Te,aE as vr,aF as Ed,aG as Fl,aH as wr,aI as bn,X as jt,aJ as Si,i as _s,aK as ha,aL as _e,aM as yi,aN as zi,aO as zp,aP as Kp,aQ as Jp,aR as Od,aS as Md,aT as Ja,aU as Mt,aV as Vp,aW as ks,aX as Ul,aY as Gp,aZ as Yp,a_ as Xp,a$ as Zp,c as Qp,b as eg,r as tg}from"./LexicalTable.prod-ChNtyie0.js";import{r as At}from"./index-DTwt9jhc.js";import{c as ng,d as rg,e as sg,g as ig}from"./floating-ui.react-dom-A2jHDRVp.js";import{M as og}from"./markdown-renderer.component-Bj9B3K-2.js";import{C as ag,a as lg,b as cg,d as ug}from"./card-BJgZfBGV.js";import{B as dg}from"./book-chapter-control.component-CWRdWJcq.js";import{T as hg}from"./tab-toolbar.component-J2Ji5iXY.js";import{B as mt}from"./button-DjxNHubA.js";import{D as Va,a as Ga,b as Ya,c as fg,j as Ad,e as jd,l as ts}from"./dropdown-menu-BDZ6UsPy.js";import{C as pg}from"./chevron-down-DQgJcAJG.js";import{c as nt}from"./createLucideIcon-BD4WqGKu.js";import{F as Bt}from"./file-text-D0uIs85F.js";import{a as ns,T as rs,b as bi,c as ss,d as gg}from"./tooltip-hXafT-Ni.js";import{I as mg}from"./input-W0Fy_4MF.js";import{x as yg}from"./index-CQVHRrhN.js";import{X as bg}from"./x-BFTJQgAY.js";import{C as _g}from"./check-CVbQTEq1.js";import{C as kg}from"./copy-mMO1gyvz.js";import{P as vg,c as wg,b as xg}from"./popover-BwXYH-rN.js";import"./index-D2w9gCAG.js";import"./index-DZZBo1Qm.js";import"./shadcn-ui.util-DMJ19wEV.js";import"./book-item.utils-hkGqfnWj.js";import"./command-B5G2qoHn.js";import"./index-A9DQp8Yb.js";import"./index-DTAXz6r9.js";import"./index-D5MLWw_D.js";import"./index-CqQg7oEp.js";import"./index-9iVNp5n9.js";import"./index-DMCsQrjv.js";import"./index-DaH1HA5I.js";import"./index-DijGIr06.js";import"./index-CO6CksaK.js";import"./index-CxNUPp21.js";import"./index-C6x1QMsZ.js";import"./index-Wl23anVJ.js";import"./index-DPH1TvvE.js";import"./index-DqWlGILt.js";import"./dialog-B7YZWY17.js";import"./index-Czfav6j7.js";import"./search-Cs0XmWUF.js";import"./index.es-D4jfZzAn.js";import"./chevron-left-D2_ljZcm.js";import"./chevron-right-FnP4LhGB.js";import"./arrow-right-DgTJVG99.js";import"./tab-dropdown-menu.component-B-D94UX2.js";import"./menu.util-Dxh7JGT4.js";import"./menu-icon.component-rzqM60pv.js";import"./tab-toolbar-container.component-BljpS1mn.js";import"./index-BPbCuWFR.js";import"./index-BmArYUGE.js";import"./index-Jfv1fOY_.js";import"./index-DdqFJ7oY.js";import"./index-DzIh4y66.js";import"./index-BrvO9ylP.js";import"./index-C1qHP2HC.js";import"./index-BhfQYrHK.js";import"./circle-DRyQ0WYK.js";import"./index-erk05UJ6.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cg=[["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 18h18",key:"1h113x"}],["path",{d:"M3 6h18",key:"d0wm0j"}]],Ks=nt("AlignJustify",Cg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sg=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]],Tg=nt("Ban",Sg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Eg=[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"m17 12 3-2v8",key:"1hhhft"}]],rr=nt("Heading1",Eg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Og=[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M21 18h-4c0-4 4-3 4-6 0-1.5-2-2.5-4-1",key:"9jr5yi"}]],Bl=nt("Heading2",Og);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mg=[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M17.5 10.5c1.7-1 3.5 0 3.5 1.5a2 2 0 0 1-2 2",key:"68ncm8"}],["path",{d:"M17 17.5c2 1.5 4 .3 4-1.5a2 2 0 0 0-2-2",key:"1ejuhz"}]],Ho=nt("Heading3",Mg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ag=[["path",{d:"M16 12H3",key:"1a2rj7"}],["path",{d:"M16 6H3",key:"1wxfjs"}],["path",{d:"M10 18H3",key:"13769t"}],["path",{d:"M21 6v10a2 2 0 0 1-2 2h-5",key:"ilrcs8"}],["path",{d:"m16 16-2 2 2 2",key:"kkc6pm"}]],jg=nt("ListEnd",Ag);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ng=[["path",{d:"M21 7v6h-6",key:"3ptur4"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7",key:"1kgawr"}]],Ig=nt("Redo",Ng);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rg=[["path",{d:"m18 14 4 4-4 4",key:"10pe0f"}],["path",{d:"m18 2 4 4-4 4",key:"pucp1d"}],["path",{d:"M2 18h1.973a4 4 0 0 0 3.3-1.7l5.454-8.6a4 4 0 0 1 3.3-1.7H22",key:"1ailkh"}],["path",{d:"M2 6h1.972a4 4 0 0 1 3.6 2.2",key:"km57vx"}],["path",{d:"M22 18h-6.041a4 4 0 0 1-3.3-1.8l-.359-.45",key:"os18l9"}]],Pg=nt("Shuffle",Rg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $g=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"M9 17c2 0 2.8-1 2.8-2.8V10c0-2 1-3.3 3.2-3",key:"m1af9g"}],["path",{d:"M9 11.2h5.7",key:"3zgcl2"}]],Nd=nt("SquareFunction",$g);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dg=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M16 8.9V7H8l4 5-4 5h8v-1.9",key:"9nih0i"}]],Id=nt("SquareSigma",Dg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qg=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],Lg=nt("SquareX",qg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fg=[["path",{d:"m4 19 8-8",key:"hr47gm"}],["path",{d:"m12 19-8-8",key:"1dhhmo"}],["path",{d:"M20 12h-4c0-1.5.442-2 1.5-2.5S20 8.334 20 7.002c0-.472-.17-.93-.484-1.29a2.105 2.105 0 0 0-2.617-.436c-.42.239-.738.614-.899 1.06",key:"1dfcux"}]],Ug=nt("Superscript",Fg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bg=[["path",{d:"M17 6H3",key:"16j9eg"}],["path",{d:"M21 12H8",key:"scolzb"}],["path",{d:"M21 18H8",key:"1wfozv"}],["path",{d:"M3 12v6",key:"fv4c87"}]],Wo=nt("TextQuote",Bg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hg=[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]],Wg=nt("Undo",Hg);var Js={exports:{}},zo,Hl;function zg(){if(Hl)return zo;Hl=1;var t=-1,e=1,n=0;function r(k,I,C,$,O){if(k===I)return k?[[n,k]]:[];if(C!=null){var A=H(k,I,C);if(A)return A}var N=a(k,I),q=k.substring(0,N);k=k.substring(N),I=I.substring(N),N=u(k,I);var L=k.substring(k.length-N);k=k.substring(0,k.length-N),I=I.substring(0,I.length-N);var F=s(k,I);return q&&F.unshift([n,q]),L&&F.push([n,L]),v(F,O),$&&f(F),F}function s(k,I){var C;if(!k)return[[e,I]];if(!I)return[[t,k]];var $=k.length>I.length?k:I,O=k.length>I.length?I:k,A=$.indexOf(O);if(A!==-1)return C=[[e,$.substring(0,A)],[n,O],[e,$.substring(A+O.length)]],k.length>I.length&&(C[0][0]=C[2][0]=t),C;if(O.length===1)return[[t,k],[e,I]];var N=d(k,I);if(N){var q=N[0],L=N[1],F=N[2],J=N[3],K=N[4],Y=r(q,F),ne=r(L,J);return Y.concat([[n,K]],ne)}return i(k,I)}function i(k,I){for(var C=k.length,$=I.length,O=Math.ceil((C+$)/2),A=O,N=2*O,q=new Array(N),L=new Array(N),F=0;F<N;F++)q[F]=-1,L[F]=-1;q[A+1]=0,L[A+1]=0;for(var J=C-$,K=J%2!==0,Y=0,ne=0,V=0,ue=0,ye=0;ye<O;ye++){for(var te=-ye+Y;te<=ye-ne;te+=2){var se=A+te,ie;te===-ye||te!==ye&&q[se-1]<q[se+1]?ie=q[se+1]:ie=q[se-1]+1;for(var de=ie-te;ie<C&&de<$&&k.charAt(ie)===I.charAt(de);)ie++,de++;if(q[se]=ie,ie>C)ne+=2;else if(de>$)Y+=2;else if(K){var fe=A+J-te;if(fe>=0&&fe<N&&L[fe]!==-1){var ge=C-L[fe];if(ie>=ge)return o(k,I,ie,de)}}}for(var Oe=-ye+V;Oe<=ye-ue;Oe+=2){var fe=A+Oe,ge;Oe===-ye||Oe!==ye&&L[fe-1]<L[fe+1]?ge=L[fe+1]:ge=L[fe-1]+1;for(var Ue=ge-Oe;ge<C&&Ue<$&&k.charAt(C-ge-1)===I.charAt($-Ue-1);)ge++,Ue++;if(L[fe]=ge,ge>C)ue+=2;else if(Ue>$)V+=2;else if(!K){var se=A+J-Oe;if(se>=0&&se<N&&q[se]!==-1){var ie=q[se],de=A+ie-se;if(ge=C-ge,ie>=ge)return o(k,I,ie,de)}}}}return[[t,k],[e,I]]}function o(k,I,C,$){var O=k.substring(0,C),A=I.substring(0,$),N=k.substring(C),q=I.substring($),L=r(O,A),F=r(N,q);return L.concat(F)}function a(k,I){if(!k||!I||k.charAt(0)!==I.charAt(0))return 0;for(var C=0,$=Math.min(k.length,I.length),O=$,A=0;C<O;)k.substring(A,O)==I.substring(A,O)?(C=O,A=C):$=O,O=Math.floor(($-C)/2+C);return S(k.charCodeAt(O-1))&&O--,O}function l(k,I){var C=k.length,$=I.length;if(C==0||$==0)return 0;C>$?k=k.substring(C-$):C<$&&(I=I.substring(0,C));var O=Math.min(C,$);if(k==I)return O;for(var A=0,N=1;;){var q=k.substring(O-N),L=I.indexOf(q);if(L==-1)return A;N+=L,(L==0||k.substring(O-N)==I.substring(0,N))&&(A=N,N++)}}function u(k,I){if(!k||!I||k.slice(-1)!==I.slice(-1))return 0;for(var C=0,$=Math.min(k.length,I.length),O=$,A=0;C<O;)k.substring(k.length-O,k.length-A)==I.substring(I.length-O,I.length-A)?(C=O,A=C):$=O,O=Math.floor(($-C)/2+C);return j(k.charCodeAt(k.length-O))&&O--,O}function d(k,I){var C=k.length>I.length?k:I,$=k.length>I.length?I:k;if(C.length<4||$.length*2<C.length)return null;function O(ne,V,ue){for(var ye=ne.substring(ue,ue+Math.floor(ne.length/4)),te=-1,se="",ie,de,fe,ge;(te=V.indexOf(ye,te+1))!==-1;){var Oe=a(ne.substring(ue),V.substring(te)),Ue=u(ne.substring(0,ue),V.substring(0,te));se.length<Ue+Oe&&(se=V.substring(te-Ue,te)+V.substring(te,te+Oe),ie=ne.substring(0,ue-Ue),de=ne.substring(ue+Oe),fe=V.substring(0,te-Ue),ge=V.substring(te+Oe))}return se.length*2>=ne.length?[ie,de,fe,ge,se]:null}var A=O(C,$,Math.ceil(C.length/4)),N=O(C,$,Math.ceil(C.length/2)),q;if(!A&&!N)return null;N?A?q=A[4].length>N[4].length?A:N:q=N:q=A;var L,F,J,K;k.length>I.length?(L=q[0],F=q[1],J=q[2],K=q[3]):(J=q[0],K=q[1],L=q[2],F=q[3]);var Y=q[4];return[L,F,J,K,Y]}function f(k){for(var I=!1,C=[],$=0,O=null,A=0,N=0,q=0,L=0,F=0;A<k.length;)k[A][0]==n?(C[$++]=A,N=L,q=F,L=0,F=0,O=k[A][1]):(k[A][0]==e?L+=k[A][1].length:F+=k[A][1].length,O&&O.length<=Math.max(N,q)&&O.length<=Math.max(L,F)&&(k.splice(C[$-1],0,[t,O]),k[C[$-1]+1][0]=e,$--,$--,A=$>0?C[$-1]:-1,N=0,q=0,L=0,F=0,O=null,I=!0)),A++;for(I&&v(k),M(k),A=1;A<k.length;){if(k[A-1][0]==t&&k[A][0]==e){var J=k[A-1][1],K=k[A][1],Y=l(J,K),ne=l(K,J);Y>=ne?(Y>=J.length/2||Y>=K.length/2)&&(k.splice(A,0,[n,K.substring(0,Y)]),k[A-1][1]=J.substring(0,J.length-Y),k[A+1][1]=K.substring(Y),A++):(ne>=J.length/2||ne>=K.length/2)&&(k.splice(A,0,[n,J.substring(0,ne)]),k[A-1][0]=e,k[A-1][1]=K.substring(0,K.length-ne),k[A+1][0]=t,k[A+1][1]=J.substring(ne),A++),A++}A++}}var h=/[^a-zA-Z0-9]/,p=/\s/,y=/[\r\n]/,b=/\n\r?\n$/,w=/^\r?\n\r?\n/;function M(k){function I(ne,V){if(!ne||!V)return 6;var ue=ne.charAt(ne.length-1),ye=V.charAt(0),te=ue.match(h),se=ye.match(h),ie=te&&ue.match(p),de=se&&ye.match(p),fe=ie&&ue.match(y),ge=de&&ye.match(y),Oe=fe&&ne.match(b),Ue=ge&&V.match(w);return Oe||Ue?5:fe||ge?4:te&&!ie&&de?3:ie||de?2:te||se?1:0}for(var C=1;C<k.length-1;){if(k[C-1][0]==n&&k[C+1][0]==n){var $=k[C-1][1],O=k[C][1],A=k[C+1][1],N=u($,O);if(N){var q=O.substring(O.length-N);$=$.substring(0,$.length-N),O=q+O.substring(0,O.length-N),A=q+A}for(var L=$,F=O,J=A,K=I($,O)+I(O,A);O.charAt(0)===A.charAt(0);){$+=O.charAt(0),O=O.substring(1)+A.charAt(0),A=A.substring(1);var Y=I($,O)+I(O,A);Y>=K&&(K=Y,L=$,F=O,J=A)}k[C-1][1]!=L&&(L?k[C-1][1]=L:(k.splice(C-1,1),C--),k[C][1]=F,J?k[C+1][1]=J:(k.splice(C+1,1),C--))}C++}}function v(k,I){k.push([n,""]);for(var C=0,$=0,O=0,A="",N="",q;C<k.length;){if(C<k.length-1&&!k[C][1]){k.splice(C,1);continue}switch(k[C][0]){case e:O++,N+=k[C][1],C++;break;case t:$++,A+=k[C][1],C++;break;case n:var L=C-O-$-1;if(I){if(L>=0&&D(k[L][1])){var F=k[L][1].slice(-1);if(k[L][1]=k[L][1].slice(0,-1),A=F+A,N=F+N,!k[L][1]){k.splice(L,1),C--;var J=L-1;k[J]&&k[J][0]===e&&(O++,N=k[J][1]+N,J--),k[J]&&k[J][0]===t&&($++,A=k[J][1]+A,J--),L=J}}if(P(k[C][1])){var F=k[C][1].charAt(0);k[C][1]=k[C][1].slice(1),A+=F,N+=F}}if(C<k.length-1&&!k[C][1]){k.splice(C,1);break}if(A.length>0||N.length>0){A.length>0&&N.length>0&&(q=a(N,A),q!==0&&(L>=0?k[L][1]+=N.substring(0,q):(k.splice(0,0,[n,N.substring(0,q)]),C++),N=N.substring(q),A=A.substring(q)),q=u(N,A),q!==0&&(k[C][1]=N.substring(N.length-q)+k[C][1],N=N.substring(0,N.length-q),A=A.substring(0,A.length-q)));var K=O+$;A.length===0&&N.length===0?(k.splice(C-K,K),C=C-K):A.length===0?(k.splice(C-K,K,[e,N]),C=C-K+1):N.length===0?(k.splice(C-K,K,[t,A]),C=C-K+1):(k.splice(C-K,K,[t,A],[e,N]),C=C-K+2)}C!==0&&k[C-1][0]===n?(k[C-1][1]+=k[C][1],k.splice(C,1)):C++,O=0,$=0,A="",N="";break}}k[k.length-1][1]===""&&k.pop();var Y=!1;for(C=1;C<k.length-1;)k[C-1][0]===n&&k[C+1][0]===n&&(k[C][1].substring(k[C][1].length-k[C-1][1].length)===k[C-1][1]?(k[C][1]=k[C-1][1]+k[C][1].substring(0,k[C][1].length-k[C-1][1].length),k[C+1][1]=k[C-1][1]+k[C+1][1],k.splice(C-1,1),Y=!0):k[C][1].substring(0,k[C+1][1].length)==k[C+1][1]&&(k[C-1][1]+=k[C+1][1],k[C][1]=k[C][1].substring(k[C+1][1].length)+k[C+1][1],k.splice(C+1,1),Y=!0)),C++;Y&&v(k,I)}function S(k){return k>=55296&&k<=56319}function j(k){return k>=56320&&k<=57343}function P(k){return j(k.charCodeAt(0))}function D(k){return S(k.charCodeAt(k.length-1))}function B(k){for(var I=[],C=0;C<k.length;C++)k[C][1].length>0&&I.push(k[C]);return I}function U(k,I,C,$){return D(k)||P($)?null:B([[n,k],[t,I],[e,C],[n,$]])}function H(k,I,C){var $=typeof C=="number"?{index:C,length:0}:C.oldRange,O=typeof C=="number"?null:C.newRange,A=k.length,N=I.length;if($.length===0&&(O===null||O.length===0)){var q=$.index,L=k.slice(0,q),F=k.slice(q),J=O?O.index:null;e:{var K=q+N-A;if(J!==null&&J!==K||K<0||K>N)break e;var Y=I.slice(0,K),ne=I.slice(K);if(ne!==F)break e;var V=Math.min(q,K),ue=L.slice(0,V),ye=Y.slice(0,V);if(ue!==ye)break e;var te=L.slice(V),se=Y.slice(V);return U(ue,te,se,F)}e:{if(J!==null&&J!==q)break e;var ie=q,Y=I.slice(0,ie),ne=I.slice(ie);if(Y!==L)break e;var de=Math.min(A-ie,N-ie),fe=F.slice(F.length-de),ge=ne.slice(ne.length-de);if(fe!==ge)break e;var te=F.slice(0,F.length-de),se=ne.slice(0,ne.length-de);return U(L,te,se,fe)}}if($.length>0&&O&&O.length===0)e:{var ue=k.slice(0,$.index),fe=k.slice($.index+$.length),V=ue.length,de=fe.length;if(N<V+de)break e;var ye=I.slice(0,V),ge=I.slice(N-de);if(ue!==ye||fe!==ge)break e;var te=k.slice(V,A-de),se=I.slice(V,N-de);return U(ue,te,se,fe)}return null}function W(k,I,C,$){return r(k,I,C,$,!0)}return W.INSERT=e,W.DELETE=t,W.EQUAL=n,zo=W,zo}var Yr={exports:{}};Yr.exports;var Wl;function Rd(){return Wl||(Wl=1,function(t,e){var n=200,r="__lodash_hash_undefined__",s=9007199254740991,i="[object Arguments]",o="[object Array]",a="[object Boolean]",l="[object Date]",u="[object Error]",d="[object Function]",f="[object GeneratorFunction]",h="[object Map]",p="[object Number]",y="[object Object]",b="[object Promise]",w="[object RegExp]",M="[object Set]",v="[object String]",S="[object Symbol]",j="[object WeakMap]",P="[object ArrayBuffer]",D="[object DataView]",B="[object Float32Array]",U="[object Float64Array]",H="[object Int8Array]",W="[object Int16Array]",k="[object Int32Array]",I="[object Uint8Array]",C="[object Uint8ClampedArray]",$="[object Uint16Array]",O="[object Uint32Array]",A=/[\\^$.*+?()[\]{}|]/g,N=/\w*$/,q=/^\[object .+?Constructor\]$/,L=/^(?:0|[1-9]\d*)$/,F={};F[i]=F[o]=F[P]=F[D]=F[a]=F[l]=F[B]=F[U]=F[H]=F[W]=F[k]=F[h]=F[p]=F[y]=F[w]=F[M]=F[v]=F[S]=F[I]=F[C]=F[$]=F[O]=!0,F[u]=F[d]=F[j]=!1;var J=typeof ln=="object"&&ln&&ln.Object===Object&&ln,K=typeof self=="object"&&self&&self.Object===Object&&self,Y=J||K||Function("return this")(),ne=e&&!e.nodeType&&e,V=ne&&!0&&t&&!t.nodeType&&t,ue=V&&V.exports===ne;function ye(c,g){return c.set(g[0],g[1]),c}function te(c,g){return c.add(g),c}function se(c,g){for(var x=-1,R=c?c.length:0;++x<R&&g(c[x],x,c)!==!1;);return c}function ie(c,g){for(var x=-1,R=g.length,Q=c.length;++x<R;)c[Q+x]=g[x];return c}function de(c,g,x,R){for(var Q=-1,G=c?c.length:0;++Q<G;)x=g(x,c[Q],Q,c);return x}function fe(c,g){for(var x=-1,R=Array(c);++x<c;)R[x]=g(x);return R}function ge(c,g){return c==null?void 0:c[g]}function Oe(c){var g=!1;if(c!=null&&typeof c.toString!="function")try{g=!!(c+"")}catch{}return g}function Ue(c){var g=-1,x=Array(c.size);return c.forEach(function(R,Q){x[++g]=[Q,R]}),x}function Ar(c,g){return function(x){return c(g(x))}}function Es(c){var g=-1,x=Array(c.size);return c.forEach(function(R){x[++g]=R}),x}var eo=Array.prototype,to=Function.prototype,Kn=Object.prototype,jr=Y["__core-js_shared__"],Os=function(){var c=/[^.]+$/.exec(jr&&jr.keys&&jr.keys.IE_PROTO||"");return c?"Symbol(src)_1."+c:""}(),Ms=to.toString,wt=Kn.hasOwnProperty,Jn=Kn.toString,no=RegExp("^"+Ms.call(wt).replace(A,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Cn=ue?Y.Buffer:void 0,Vn=Y.Symbol,Nr=Y.Uint8Array,it=Ar(Object.getPrototypeOf,Object),As=Object.create,js=Kn.propertyIsEnumerable,ro=eo.splice,Ir=Object.getOwnPropertySymbols,Gn=Cn?Cn.isBuffer:void 0,Ns=Ar(Object.keys,Object),Yn=pt(Y,"DataView"),Sn=pt(Y,"Map"),ft=pt(Y,"Promise"),Xn=pt(Y,"Set"),Rr=pt(Y,"WeakMap"),Tn=pt(Object,"create"),Pr=Ve(Yn),En=Ve(Sn),$r=Ve(ft),Dr=Ve(Xn),qr=Ve(Rr),nn=Vn?Vn.prototype:void 0,Is=nn?nn.valueOf:void 0;function qt(c){var g=-1,x=c?c.length:0;for(this.clear();++g<x;){var R=c[g];this.set(R[0],R[1])}}function so(){this.__data__=Tn?Tn(null):{}}function io(c){return this.has(c)&&delete this.__data__[c]}function oo(c){var g=this.__data__;if(Tn){var x=g[c];return x===r?void 0:x}return wt.call(g,c)?g[c]:void 0}function Rs(c){var g=this.__data__;return Tn?g[c]!==void 0:wt.call(g,c)}function Lr(c,g){var x=this.__data__;return x[c]=Tn&&g===void 0?r:g,this}qt.prototype.clear=so,qt.prototype.delete=io,qt.prototype.get=oo,qt.prototype.has=Rs,qt.prototype.set=Lr;function De(c){var g=-1,x=c?c.length:0;for(this.clear();++g<x;){var R=c[g];this.set(R[0],R[1])}}function ao(){this.__data__=[]}function lo(c){var g=this.__data__,x=Qn(g,c);if(x<0)return!1;var R=g.length-1;return x==R?g.pop():ro.call(g,x,1),!0}function co(c){var g=this.__data__,x=Qn(g,c);return x<0?void 0:g[x][1]}function uo(c){return Qn(this.__data__,c)>-1}function ho(c,g){var x=this.__data__,R=Qn(x,c);return R<0?x.push([c,g]):x[R][1]=g,this}De.prototype.clear=ao,De.prototype.delete=lo,De.prototype.get=co,De.prototype.has=uo,De.prototype.set=ho;function Be(c){var g=-1,x=c?c.length:0;for(this.clear();++g<x;){var R=c[g];this.set(R[0],R[1])}}function fo(){this.__data__={hash:new qt,map:new(Sn||De),string:new qt}}function po(c){return Mn(this,c).delete(c)}function go(c){return Mn(this,c).get(c)}function mo(c){return Mn(this,c).has(c)}function yo(c,g){return Mn(this,c).set(c,g),this}Be.prototype.clear=fo,Be.prototype.delete=po,Be.prototype.get=go,Be.prototype.has=mo,Be.prototype.set=yo;function Ze(c){this.__data__=new De(c)}function bo(){this.__data__=new De}function _o(c){return this.__data__.delete(c)}function ko(c){return this.__data__.get(c)}function vo(c){return this.__data__.has(c)}function wo(c,g){var x=this.__data__;if(x instanceof De){var R=x.__data__;if(!Sn||R.length<n-1)return R.push([c,g]),this;x=this.__data__=new Be(R)}return x.set(c,g),this}Ze.prototype.clear=bo,Ze.prototype.delete=_o,Ze.prototype.get=ko,Ze.prototype.has=vo,Ze.prototype.set=wo;function Zn(c,g){var x=Hr(c)||tr(c)?fe(c.length,String):[],R=x.length,Q=!!R;for(var G in c)wt.call(c,G)&&!(Q&&(G=="length"||$o(G,R)))&&x.push(G);return x}function Ps(c,g,x){var R=c[g];(!(wt.call(c,g)&&Fs(R,x))||x===void 0&&!(g in c))&&(c[g]=x)}function Qn(c,g){for(var x=c.length;x--;)if(Fs(c[x][0],g))return x;return-1}function xt(c,g){return c&&Br(g,zr(g),c)}function Fr(c,g,x,R,Q,G,le){var ae;if(R&&(ae=G?R(c,Q,G,le):R(c)),ae!==void 0)return ae;if(!St(c))return c;var Me=Hr(c);if(Me){if(ae=Ro(c),!g)return jo(c,ae)}else{var he=Ft(c),He=he==d||he==f;if(Us(c))return er(c,g);if(he==y||he==i||He&&!G){if(Oe(c))return G?c:{};if(ae=Ct(He?{}:c),!g)return No(c,xt(ae,c))}else{if(!F[he])return G?c:{};ae=Po(c,he,Fr,g)}}le||(le=new Ze);var Qe=le.get(c);if(Qe)return Qe;if(le.set(c,ae),!Me)var Ae=x?Io(c):zr(c);return se(Ae||c,function(We,qe){Ae&&(qe=We,We=c[qe]),Ps(ae,qe,Fr(We,g,x,R,qe,c,le))}),ae}function xo(c){return St(c)?As(c):{}}function Co(c,g,x){var R=g(c);return Hr(c)?R:ie(R,x(c))}function So(c){return Jn.call(c)}function To(c){if(!St(c)||qo(c))return!1;var g=Wr(c)||Oe(c)?no:q;return g.test(Ve(c))}function Eo(c){if(!qs(c))return Ns(c);var g=[];for(var x in Object(c))wt.call(c,x)&&x!="constructor"&&g.push(x);return g}function er(c,g){if(g)return c.slice();var x=new c.constructor(c.length);return c.copy(x),x}function Ur(c){var g=new c.constructor(c.byteLength);return new Nr(g).set(new Nr(c)),g}function On(c,g){var x=g?Ur(c.buffer):c.buffer;return new c.constructor(x,c.byteOffset,c.byteLength)}function $s(c,g,x){var R=g?x(Ue(c),!0):Ue(c);return de(R,ye,new c.constructor)}function Ds(c){var g=new c.constructor(c.source,N.exec(c));return g.lastIndex=c.lastIndex,g}function Oo(c,g,x){var R=g?x(Es(c),!0):Es(c);return de(R,te,new c.constructor)}function Mo(c){return Is?Object(Is.call(c)):{}}function Ao(c,g){var x=g?Ur(c.buffer):c.buffer;return new c.constructor(x,c.byteOffset,c.length)}function jo(c,g){var x=-1,R=c.length;for(g||(g=Array(R));++x<R;)g[x]=c[x];return g}function Br(c,g,x,R){x||(x={});for(var Q=-1,G=g.length;++Q<G;){var le=g[Q],ae=void 0;Ps(x,le,ae===void 0?c[le]:ae)}return x}function No(c,g){return Br(c,Lt(c),g)}function Io(c){return Co(c,zr,Lt)}function Mn(c,g){var x=c.__data__;return Do(g)?x[typeof g=="string"?"string":"hash"]:x.map}function pt(c,g){var x=ge(c,g);return To(x)?x:void 0}var Lt=Ir?Ar(Ir,Object):Fo,Ft=So;(Yn&&Ft(new Yn(new ArrayBuffer(1)))!=D||Sn&&Ft(new Sn)!=h||ft&&Ft(ft.resolve())!=b||Xn&&Ft(new Xn)!=M||Rr&&Ft(new Rr)!=j)&&(Ft=function(c){var g=Jn.call(c),x=g==y?c.constructor:void 0,R=x?Ve(x):void 0;if(R)switch(R){case Pr:return D;case En:return h;case $r:return b;case Dr:return M;case qr:return j}return g});function Ro(c){var g=c.length,x=c.constructor(g);return g&&typeof c[0]=="string"&&wt.call(c,"index")&&(x.index=c.index,x.input=c.input),x}function Ct(c){return typeof c.constructor=="function"&&!qs(c)?xo(it(c)):{}}function Po(c,g,x,R){var Q=c.constructor;switch(g){case P:return Ur(c);case a:case l:return new Q(+c);case D:return On(c,R);case B:case U:case H:case W:case k:case I:case C:case $:case O:return Ao(c,R);case h:return $s(c,R,x);case p:case v:return new Q(c);case w:return Ds(c);case M:return Oo(c,R,x);case S:return Mo(c)}}function $o(c,g){return g=g??s,!!g&&(typeof c=="number"||L.test(c))&&c>-1&&c%1==0&&c<g}function Do(c){var g=typeof c;return g=="string"||g=="number"||g=="symbol"||g=="boolean"?c!=="__proto__":c===null}function qo(c){return!!Os&&Os in c}function qs(c){var g=c&&c.constructor,x=typeof g=="function"&&g.prototype||Kn;return c===x}function Ve(c){if(c!=null){try{return Ms.call(c)}catch{}try{return c+""}catch{}}return""}function Ls(c){return Fr(c,!0,!0)}function Fs(c,g){return c===g||c!==c&&g!==g}function tr(c){return Lo(c)&&wt.call(c,"callee")&&(!js.call(c,"callee")||Jn.call(c)==i)}var Hr=Array.isArray;function nr(c){return c!=null&&Bs(c.length)&&!Wr(c)}function Lo(c){return Hs(c)&&nr(c)}var Us=Gn||Uo;function Wr(c){var g=St(c)?Jn.call(c):"";return g==d||g==f}function Bs(c){return typeof c=="number"&&c>-1&&c%1==0&&c<=s}function St(c){var g=typeof c;return!!c&&(g=="object"||g=="function")}function Hs(c){return!!c&&typeof c=="object"}function zr(c){return nr(c)?Zn(c):Eo(c)}function Fo(){return[]}function Uo(){return!1}t.exports=Ls}(Yr,Yr.exports)),Yr.exports}var Xr={exports:{}};Xr.exports;var zl;function Pd(){return zl||(zl=1,function(t,e){var n=200,r="__lodash_hash_undefined__",s=1,i=2,o=9007199254740991,a="[object Arguments]",l="[object Array]",u="[object AsyncFunction]",d="[object Boolean]",f="[object Date]",h="[object Error]",p="[object Function]",y="[object GeneratorFunction]",b="[object Map]",w="[object Number]",M="[object Null]",v="[object Object]",S="[object Promise]",j="[object Proxy]",P="[object RegExp]",D="[object Set]",B="[object String]",U="[object Symbol]",H="[object Undefined]",W="[object WeakMap]",k="[object ArrayBuffer]",I="[object DataView]",C="[object Float32Array]",$="[object Float64Array]",O="[object Int8Array]",A="[object Int16Array]",N="[object Int32Array]",q="[object Uint8Array]",L="[object Uint8ClampedArray]",F="[object Uint16Array]",J="[object Uint32Array]",K=/[\\^$.*+?()[\]{}|]/g,Y=/^\[object .+?Constructor\]$/,ne=/^(?:0|[1-9]\d*)$/,V={};V[C]=V[$]=V[O]=V[A]=V[N]=V[q]=V[L]=V[F]=V[J]=!0,V[a]=V[l]=V[k]=V[d]=V[I]=V[f]=V[h]=V[p]=V[b]=V[w]=V[v]=V[P]=V[D]=V[B]=V[W]=!1;var ue=typeof ln=="object"&&ln&&ln.Object===Object&&ln,ye=typeof self=="object"&&self&&self.Object===Object&&self,te=ue||ye||Function("return this")(),se=e&&!e.nodeType&&e,ie=se&&!0&&t&&!t.nodeType&&t,de=ie&&ie.exports===se,fe=de&&ue.process,ge=function(){try{return fe&&fe.binding&&fe.binding("util")}catch{}}(),Oe=ge&&ge.isTypedArray;function Ue(c,g){for(var x=-1,R=c==null?0:c.length,Q=0,G=[];++x<R;){var le=c[x];g(le,x,c)&&(G[Q++]=le)}return G}function Ar(c,g){for(var x=-1,R=g.length,Q=c.length;++x<R;)c[Q+x]=g[x];return c}function Es(c,g){for(var x=-1,R=c==null?0:c.length;++x<R;)if(g(c[x],x,c))return!0;return!1}function eo(c,g){for(var x=-1,R=Array(c);++x<c;)R[x]=g(x);return R}function to(c){return function(g){return c(g)}}function Kn(c,g){return c.has(g)}function jr(c,g){return c==null?void 0:c[g]}function Os(c){var g=-1,x=Array(c.size);return c.forEach(function(R,Q){x[++g]=[Q,R]}),x}function Ms(c,g){return function(x){return c(g(x))}}function wt(c){var g=-1,x=Array(c.size);return c.forEach(function(R){x[++g]=R}),x}var Jn=Array.prototype,no=Function.prototype,Cn=Object.prototype,Vn=te["__core-js_shared__"],Nr=no.toString,it=Cn.hasOwnProperty,As=function(){var c=/[^.]+$/.exec(Vn&&Vn.keys&&Vn.keys.IE_PROTO||"");return c?"Symbol(src)_1."+c:""}(),js=Cn.toString,ro=RegExp("^"+Nr.call(it).replace(K,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ir=de?te.Buffer:void 0,Gn=te.Symbol,Ns=te.Uint8Array,Yn=Cn.propertyIsEnumerable,Sn=Jn.splice,ft=Gn?Gn.toStringTag:void 0,Xn=Object.getOwnPropertySymbols,Rr=Ir?Ir.isBuffer:void 0,Tn=Ms(Object.keys,Object),Pr=Lt(te,"DataView"),En=Lt(te,"Map"),$r=Lt(te,"Promise"),Dr=Lt(te,"Set"),qr=Lt(te,"WeakMap"),nn=Lt(Object,"create"),Is=Ve(Pr),qt=Ve(En),so=Ve($r),io=Ve(Dr),oo=Ve(qr),Rs=Gn?Gn.prototype:void 0,Lr=Rs?Rs.valueOf:void 0;function De(c){var g=-1,x=c==null?0:c.length;for(this.clear();++g<x;){var R=c[g];this.set(R[0],R[1])}}function ao(){this.__data__=nn?nn(null):{},this.size=0}function lo(c){var g=this.has(c)&&delete this.__data__[c];return this.size-=g?1:0,g}function co(c){var g=this.__data__;if(nn){var x=g[c];return x===r?void 0:x}return it.call(g,c)?g[c]:void 0}function uo(c){var g=this.__data__;return nn?g[c]!==void 0:it.call(g,c)}function ho(c,g){var x=this.__data__;return this.size+=this.has(c)?0:1,x[c]=nn&&g===void 0?r:g,this}De.prototype.clear=ao,De.prototype.delete=lo,De.prototype.get=co,De.prototype.has=uo,De.prototype.set=ho;function Be(c){var g=-1,x=c==null?0:c.length;for(this.clear();++g<x;){var R=c[g];this.set(R[0],R[1])}}function fo(){this.__data__=[],this.size=0}function po(c){var g=this.__data__,x=er(g,c);if(x<0)return!1;var R=g.length-1;return x==R?g.pop():Sn.call(g,x,1),--this.size,!0}function go(c){var g=this.__data__,x=er(g,c);return x<0?void 0:g[x][1]}function mo(c){return er(this.__data__,c)>-1}function yo(c,g){var x=this.__data__,R=er(x,c);return R<0?(++this.size,x.push([c,g])):x[R][1]=g,this}Be.prototype.clear=fo,Be.prototype.delete=po,Be.prototype.get=go,Be.prototype.has=mo,Be.prototype.set=yo;function Ze(c){var g=-1,x=c==null?0:c.length;for(this.clear();++g<x;){var R=c[g];this.set(R[0],R[1])}}function bo(){this.size=0,this.__data__={hash:new De,map:new(En||Be),string:new De}}function _o(c){var g=pt(this,c).delete(c);return this.size-=g?1:0,g}function ko(c){return pt(this,c).get(c)}function vo(c){return pt(this,c).has(c)}function wo(c,g){var x=pt(this,c),R=x.size;return x.set(c,g),this.size+=x.size==R?0:1,this}Ze.prototype.clear=bo,Ze.prototype.delete=_o,Ze.prototype.get=ko,Ze.prototype.has=vo,Ze.prototype.set=wo;function Zn(c){var g=-1,x=c==null?0:c.length;for(this.__data__=new Ze;++g<x;)this.add(c[g])}function Ps(c){return this.__data__.set(c,r),this}function Qn(c){return this.__data__.has(c)}Zn.prototype.add=Zn.prototype.push=Ps,Zn.prototype.has=Qn;function xt(c){var g=this.__data__=new Be(c);this.size=g.size}function Fr(){this.__data__=new Be,this.size=0}function xo(c){var g=this.__data__,x=g.delete(c);return this.size=g.size,x}function Co(c){return this.__data__.get(c)}function So(c){return this.__data__.has(c)}function To(c,g){var x=this.__data__;if(x instanceof Be){var R=x.__data__;if(!En||R.length<n-1)return R.push([c,g]),this.size=++x.size,this;x=this.__data__=new Ze(R)}return x.set(c,g),this.size=x.size,this}xt.prototype.clear=Fr,xt.prototype.delete=xo,xt.prototype.get=Co,xt.prototype.has=So,xt.prototype.set=To;function Eo(c,g){var x=tr(c),R=!x&&Fs(c),Q=!x&&!R&&nr(c),G=!x&&!R&&!Q&&Hs(c),le=x||R||Q||G,ae=le?eo(c.length,String):[],Me=ae.length;for(var he in c)it.call(c,he)&&!(le&&(he=="length"||Q&&(he=="offset"||he=="parent")||G&&(he=="buffer"||he=="byteLength"||he=="byteOffset")||Po(he,Me)))&&ae.push(he);return ae}function er(c,g){for(var x=c.length;x--;)if(Ls(c[x][0],g))return x;return-1}function Ur(c,g,x){var R=g(c);return tr(c)?R:Ar(R,x(c))}function On(c){return c==null?c===void 0?H:M:ft&&ft in Object(c)?Ft(c):qs(c)}function $s(c){return St(c)&&On(c)==a}function Ds(c,g,x,R,Q){return c===g?!0:c==null||g==null||!St(c)&&!St(g)?c!==c&&g!==g:Oo(c,g,x,R,Ds,Q)}function Oo(c,g,x,R,Q,G){var le=tr(c),ae=tr(g),Me=le?l:Ct(c),he=ae?l:Ct(g);Me=Me==a?v:Me,he=he==a?v:he;var He=Me==v,Qe=he==v,Ae=Me==he;if(Ae&&nr(c)){if(!nr(g))return!1;le=!0,He=!1}if(Ae&&!He)return G||(G=new xt),le||Hs(c)?Br(c,g,x,R,Q,G):No(c,g,Me,x,R,Q,G);if(!(x&s)){var We=He&&it.call(c,"__wrapped__"),qe=Qe&&it.call(g,"__wrapped__");if(We||qe){var rn=We?c.value():c,Ut=qe?g.value():g;return G||(G=new xt),Q(rn,Ut,x,R,G)}}return Ae?(G||(G=new xt),Io(c,g,x,R,Q,G)):!1}function Mo(c){if(!Bs(c)||Do(c))return!1;var g=Us(c)?ro:Y;return g.test(Ve(c))}function Ao(c){return St(c)&&Wr(c.length)&&!!V[On(c)]}function jo(c){if(!qo(c))return Tn(c);var g=[];for(var x in Object(c))it.call(c,x)&&x!="constructor"&&g.push(x);return g}function Br(c,g,x,R,Q,G){var le=x&s,ae=c.length,Me=g.length;if(ae!=Me&&!(le&&Me>ae))return!1;var he=G.get(c);if(he&&G.get(g))return he==g;var He=-1,Qe=!0,Ae=x&i?new Zn:void 0;for(G.set(c,g),G.set(g,c);++He<ae;){var We=c[He],qe=g[He];if(R)var rn=le?R(qe,We,He,g,c,G):R(We,qe,He,c,g,G);if(rn!==void 0){if(rn)continue;Qe=!1;break}if(Ae){if(!Es(g,function(Ut,An){if(!Kn(Ae,An)&&(We===Ut||Q(We,Ut,x,R,G)))return Ae.push(An)})){Qe=!1;break}}else if(!(We===qe||Q(We,qe,x,R,G))){Qe=!1;break}}return G.delete(c),G.delete(g),Qe}function No(c,g,x,R,Q,G,le){switch(x){case I:if(c.byteLength!=g.byteLength||c.byteOffset!=g.byteOffset)return!1;c=c.buffer,g=g.buffer;case k:return!(c.byteLength!=g.byteLength||!G(new Ns(c),new Ns(g)));case d:case f:case w:return Ls(+c,+g);case h:return c.name==g.name&&c.message==g.message;case P:case B:return c==g+"";case b:var ae=Os;case D:var Me=R&s;if(ae||(ae=wt),c.size!=g.size&&!Me)return!1;var he=le.get(c);if(he)return he==g;R|=i,le.set(c,g);var He=Br(ae(c),ae(g),R,Q,G,le);return le.delete(c),He;case U:if(Lr)return Lr.call(c)==Lr.call(g)}return!1}function Io(c,g,x,R,Q,G){var le=x&s,ae=Mn(c),Me=ae.length,he=Mn(g),He=he.length;if(Me!=He&&!le)return!1;for(var Qe=Me;Qe--;){var Ae=ae[Qe];if(!(le?Ae in g:it.call(g,Ae)))return!1}var We=G.get(c);if(We&&G.get(g))return We==g;var qe=!0;G.set(c,g),G.set(g,c);for(var rn=le;++Qe<Me;){Ae=ae[Qe];var Ut=c[Ae],An=g[Ae];if(R)var Rl=le?R(An,Ut,Ae,g,c,G):R(Ut,An,Ae,c,g,G);if(!(Rl===void 0?Ut===An||Q(Ut,An,x,R,G):Rl)){qe=!1;break}rn||(rn=Ae=="constructor")}if(qe&&!rn){var Ws=c.constructor,zs=g.constructor;Ws!=zs&&"constructor"in c&&"constructor"in g&&!(typeof Ws=="function"&&Ws instanceof Ws&&typeof zs=="function"&&zs instanceof zs)&&(qe=!1)}return G.delete(c),G.delete(g),qe}function Mn(c){return Ur(c,zr,Ro)}function pt(c,g){var x=c.__data__;return $o(g)?x[typeof g=="string"?"string":"hash"]:x.map}function Lt(c,g){var x=jr(c,g);return Mo(x)?x:void 0}function Ft(c){var g=it.call(c,ft),x=c[ft];try{c[ft]=void 0;var R=!0}catch{}var Q=js.call(c);return R&&(g?c[ft]=x:delete c[ft]),Q}var Ro=Xn?function(c){return c==null?[]:(c=Object(c),Ue(Xn(c),function(g){return Yn.call(c,g)}))}:Fo,Ct=On;(Pr&&Ct(new Pr(new ArrayBuffer(1)))!=I||En&&Ct(new En)!=b||$r&&Ct($r.resolve())!=S||Dr&&Ct(new Dr)!=D||qr&&Ct(new qr)!=W)&&(Ct=function(c){var g=On(c),x=g==v?c.constructor:void 0,R=x?Ve(x):"";if(R)switch(R){case Is:return I;case qt:return b;case so:return S;case io:return D;case oo:return W}return g});function Po(c,g){return g=g??o,!!g&&(typeof c=="number"||ne.test(c))&&c>-1&&c%1==0&&c<g}function $o(c){var g=typeof c;return g=="string"||g=="number"||g=="symbol"||g=="boolean"?c!=="__proto__":c===null}function Do(c){return!!As&&As in c}function qo(c){var g=c&&c.constructor,x=typeof g=="function"&&g.prototype||Cn;return c===x}function qs(c){return js.call(c)}function Ve(c){if(c!=null){try{return Nr.call(c)}catch{}try{return c+""}catch{}}return""}function Ls(c,g){return c===g||c!==c&&g!==g}var Fs=$s(function(){return arguments}())?$s:function(c){return St(c)&&it.call(c,"callee")&&!Yn.call(c,"callee")},tr=Array.isArray;function Hr(c){return c!=null&&Wr(c.length)&&!Us(c)}var nr=Rr||Uo;function Lo(c,g){return Ds(c,g)}function Us(c){if(!Bs(c))return!1;var g=On(c);return g==p||g==y||g==u||g==j}function Wr(c){return typeof c=="number"&&c>-1&&c%1==0&&c<=o}function Bs(c){var g=typeof c;return c!=null&&(g=="object"||g=="function")}function St(c){return c!=null&&typeof c=="object"}var Hs=Oe?to(Oe):Ao;function zr(c){return Hr(c)?Eo(c):jo(c)}function Fo(){return[]}function Uo(){return!1}t.exports=Lo}(Xr,Xr.exports)),Xr.exports}var Vs={},Kl;function Kg(){if(Kl)return Vs;Kl=1,Object.defineProperty(Vs,"__esModule",{value:!0});const t=Rd(),e=Pd();var n;return function(r){function s(l={},u={},d=!1){typeof l!="object"&&(l={}),typeof u!="object"&&(u={});let f=t(u);d||(f=Object.keys(f).reduce((h,p)=>(f[p]!=null&&(h[p]=f[p]),h),{}));for(const h in l)l[h]!==void 0&&u[h]===void 0&&(f[h]=l[h]);return Object.keys(f).length>0?f:void 0}r.compose=s;function i(l={},u={}){typeof l!="object"&&(l={}),typeof u!="object"&&(u={});const d=Object.keys(l).concat(Object.keys(u)).reduce((f,h)=>(e(l[h],u[h])||(f[h]=u[h]===void 0?null:u[h]),f),{});return Object.keys(d).length>0?d:void 0}r.diff=i;function o(l={},u={}){l=l||{};const d=Object.keys(u).reduce((f,h)=>(u[h]!==l[h]&&l[h]!==void 0&&(f[h]=u[h]),f),{});return Object.keys(l).reduce((f,h)=>(l[h]!==u[h]&&u[h]===void 0&&(f[h]=null),f),d)}r.invert=o;function a(l,u,d=!1){if(typeof l!="object")return u;if(typeof u!="object")return;if(!d)return u;const f=Object.keys(u).reduce((h,p)=>(l[p]===void 0&&(h[p]=u[p]),h),{});return Object.keys(f).length>0?f:void 0}r.transform=a}(n||(n={})),Vs.default=n,Vs}var Gs={},Jl;function $d(){if(Jl)return Gs;Jl=1,Object.defineProperty(Gs,"__esModule",{value:!0});var t;return function(e){function n(r){return typeof r.delete=="number"?r.delete:typeof r.retain=="number"?r.retain:typeof r.retain=="object"&&r.retain!==null?1:typeof r.insert=="string"?r.insert.length:1}e.length=n}(t||(t={})),Gs.default=t,Gs}var Ys={},Vl;function Jg(){if(Vl)return Ys;Vl=1,Object.defineProperty(Ys,"__esModule",{value:!0});const t=$d();class e{constructor(r){this.ops=r,this.index=0,this.offset=0}hasNext(){return this.peekLength()<1/0}next(r){r||(r=1/0);const s=this.ops[this.index];if(s){const i=this.offset,o=t.default.length(s);if(r>=o-i?(r=o-i,this.index+=1,this.offset=0):this.offset+=r,typeof s.delete=="number")return{delete:r};{const a={};return s.attributes&&(a.attributes=s.attributes),typeof s.retain=="number"?a.retain=r:typeof s.retain=="object"&&s.retain!==null?a.retain=s.retain:typeof s.insert=="string"?a.insert=s.insert.substr(i,r):a.insert=s.insert,a}}else return{retain:1/0}}peek(){return this.ops[this.index]}peekLength(){return this.ops[this.index]?t.default.length(this.ops[this.index])-this.offset:1/0}peekType(){const r=this.ops[this.index];return r?typeof r.delete=="number"?"delete":typeof r.retain=="number"||typeof r.retain=="object"&&r.retain!==null?"retain":"insert":"retain"}rest(){if(this.hasNext()){if(this.offset===0)return this.ops.slice(this.index);{const r=this.offset,s=this.index,i=this.next(),o=this.ops.slice(this.index);return this.offset=r,this.index=s,[i].concat(o)}}else return[]}}return Ys.default=e,Ys}var Gl;function Vg(){return Gl||(Gl=1,function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeMap=e.OpIterator=e.Op=void 0;const n=zg(),r=Rd(),s=Pd(),i=Kg();e.AttributeMap=i.default;const o=$d();e.Op=o.default;const a=Jg();e.OpIterator=a.default;const l="\0",u=(f,h)=>{if(typeof f!="object"||f===null)throw new Error(`cannot retain a ${typeof f}`);if(typeof h!="object"||h===null)throw new Error(`cannot retain a ${typeof h}`);const p=Object.keys(f)[0];if(!p||p!==Object.keys(h)[0])throw new Error(`embed types not matched: ${p} != ${Object.keys(h)[0]}`);return[p,f[p],h[p]]};class d{constructor(h){Array.isArray(h)?this.ops=h:h!=null&&Array.isArray(h.ops)?this.ops=h.ops:this.ops=[]}static registerEmbed(h,p){this.handlers[h]=p}static unregisterEmbed(h){delete this.handlers[h]}static getHandler(h){const p=this.handlers[h];if(!p)throw new Error(`no handlers for embed type "${h}"`);return p}insert(h,p){const y={};return typeof h=="string"&&h.length===0?this:(y.insert=h,p!=null&&typeof p=="object"&&Object.keys(p).length>0&&(y.attributes=p),this.push(y))}delete(h){return h<=0?this:this.push({delete:h})}retain(h,p){if(typeof h=="number"&&h<=0)return this;const y={retain:h};return p!=null&&typeof p=="object"&&Object.keys(p).length>0&&(y.attributes=p),this.push(y)}push(h){let p=this.ops.length,y=this.ops[p-1];if(h=r(h),typeof y=="object"){if(typeof h.delete=="number"&&typeof y.delete=="number")return this.ops[p-1]={delete:y.delete+h.delete},this;if(typeof y.delete=="number"&&h.insert!=null&&(p-=1,y=this.ops[p-1],typeof y!="object"))return this.ops.unshift(h),this;if(s(h.attributes,y.attributes)){if(typeof h.insert=="string"&&typeof y.insert=="string")return this.ops[p-1]={insert:y.insert+h.insert},typeof h.attributes=="object"&&(this.ops[p-1].attributes=h.attributes),this;if(typeof h.retain=="number"&&typeof y.retain=="number")return this.ops[p-1]={retain:y.retain+h.retain},typeof h.attributes=="object"&&(this.ops[p-1].attributes=h.attributes),this}}return p===this.ops.length?this.ops.push(h):this.ops.splice(p,0,h),this}chop(){const h=this.ops[this.ops.length-1];return h&&typeof h.retain=="number"&&!h.attributes&&this.ops.pop(),this}filter(h){return this.ops.filter(h)}forEach(h){this.ops.forEach(h)}map(h){return this.ops.map(h)}partition(h){const p=[],y=[];return this.forEach(b=>{(h(b)?p:y).push(b)}),[p,y]}reduce(h,p){return this.ops.reduce(h,p)}changeLength(){return this.reduce((h,p)=>p.insert?h+o.default.length(p):p.delete?h-p.delete:h,0)}length(){return this.reduce((h,p)=>h+o.default.length(p),0)}slice(h=0,p=1/0){const y=[],b=new a.default(this.ops);let w=0;for(;w<p&&b.hasNext();){let M;w<h?M=b.next(h-w):(M=b.next(p-w),y.push(M)),w+=o.default.length(M)}return new d(y)}compose(h){const p=new a.default(this.ops),y=new a.default(h.ops),b=[],w=y.peek();if(w!=null&&typeof w.retain=="number"&&w.attributes==null){let v=w.retain;for(;p.peekType()==="insert"&&p.peekLength()<=v;)v-=p.peekLength(),b.push(p.next());w.retain-v>0&&y.next(w.retain-v)}const M=new d(b);for(;p.hasNext()||y.hasNext();)if(y.peekType()==="insert")M.push(y.next());else if(p.peekType()==="delete")M.push(p.next());else{const v=Math.min(p.peekLength(),y.peekLength()),S=p.next(v),j=y.next(v);if(j.retain){const P={};if(typeof S.retain=="number")P.retain=typeof j.retain=="number"?v:j.retain;else if(typeof j.retain=="number")S.retain==null?P.insert=S.insert:P.retain=S.retain;else{const B=S.retain==null?"insert":"retain",[U,H,W]=u(S[B],j.retain),k=d.getHandler(U);P[B]={[U]:k.compose(H,W,B==="retain")}}const D=i.default.compose(S.attributes,j.attributes,typeof S.retain=="number");if(D&&(P.attributes=D),M.push(P),!y.hasNext()&&s(M.ops[M.ops.length-1],P)){const B=new d(p.rest());return M.concat(B).chop()}}else typeof j.delete=="number"&&(typeof S.retain=="number"||typeof S.retain=="object"&&S.retain!==null)&&M.push(j)}return M.chop()}concat(h){const p=new d(this.ops.slice());return h.ops.length>0&&(p.push(h.ops[0]),p.ops=p.ops.concat(h.ops.slice(1))),p}diff(h,p){if(this.ops===h.ops)return new d;const y=[this,h].map(S=>S.map(j=>{if(j.insert!=null)return typeof j.insert=="string"?j.insert:l;const P=S===h?"on":"with";throw new Error("diff() called "+P+" non-document")}).join("")),b=new d,w=n(y[0],y[1],p,!0),M=new a.default(this.ops),v=new a.default(h.ops);return w.forEach(S=>{let j=S[1].length;for(;j>0;){let P=0;switch(S[0]){case n.INSERT:P=Math.min(v.peekLength(),j),b.push(v.next(P));break;case n.DELETE:P=Math.min(j,M.peekLength()),M.next(P),b.delete(P);break;case n.EQUAL:P=Math.min(M.peekLength(),v.peekLength(),j);const D=M.next(P),B=v.next(P);s(D.insert,B.insert)?b.retain(P,i.default.diff(D.attributes,B.attributes)):b.push(B).delete(P);break}j-=P}}),b.chop()}eachLine(h,p=`
`){const y=new a.default(this.ops);let b=new d,w=0;for(;y.hasNext();){if(y.peekType()!=="insert")return;const M=y.peek(),v=o.default.length(M)-y.peekLength(),S=typeof M.insert=="string"?M.insert.indexOf(p,v)-v:-1;if(S<0)b.push(y.next());else if(S>0)b.push(y.next(S));else{if(h(b,y.next(1).attributes||{},w)===!1)return;w+=1,b=new d}}b.length()>0&&h(b,{},w)}invert(h){const p=new d;return this.reduce((y,b)=>{if(b.insert)p.delete(o.default.length(b));else{if(typeof b.retain=="number"&&b.attributes==null)return p.retain(b.retain),y+b.retain;if(b.delete||typeof b.retain=="number"){const w=b.delete||b.retain;return h.slice(y,y+w).forEach(v=>{b.delete?p.push(v):b.retain&&b.attributes&&p.retain(o.default.length(v),i.default.invert(b.attributes,v.attributes))}),y+w}else if(typeof b.retain=="object"&&b.retain!==null){const w=h.slice(y,y+1),M=new a.default(w.ops).next(),[v,S,j]=u(b.retain,M.insert),P=d.getHandler(v);return p.retain({[v]:P.invert(S,j)},i.default.invert(b.attributes,M.attributes)),y+1}}return y},0),p.chop()}transform(h,p=!1){if(p=!!p,typeof h=="number")return this.transformPosition(h,p);const y=h,b=new a.default(this.ops),w=new a.default(y.ops),M=new d;for(;b.hasNext()||w.hasNext();)if(b.peekType()==="insert"&&(p||w.peekType()!=="insert"))M.retain(o.default.length(b.next()));else if(w.peekType()==="insert")M.push(w.next());else{const v=Math.min(b.peekLength(),w.peekLength()),S=b.next(v),j=w.next(v);if(S.delete)continue;if(j.delete)M.push(j);else{const P=S.retain,D=j.retain;let B=typeof D=="object"&&D!==null?D:v;if(typeof P=="object"&&P!==null&&typeof D=="object"&&D!==null){const U=Object.keys(P)[0];if(U===Object.keys(D)[0]){const H=d.getHandler(U);H&&(B={[U]:H.transform(P[U],D[U],p)})}}M.retain(B,i.default.transform(S.attributes,j.attributes,p))}}return M.chop()}transformPosition(h,p=!1){p=!!p;const y=new a.default(this.ops);let b=0;for(;y.hasNext()&&b<=h;){const w=y.peekLength(),M=y.peekType();if(y.next(),M==="delete"){h-=Math.min(w,h-b);continue}else M==="insert"&&(b<h||!p)&&(h+=w);b+=w}return h}}d.Op=o.default,d.OpIterator=a.default,d.AttributeMap=i.default,d.handlers={},e.default=d,t.exports=d,t.exports.default=d}(Js,Js.exports)),Js.exports}var Gg=Vg();const Zr=rp(Gg);var Yg=Object.getOwnPropertyNames,Xg=Object.getOwnPropertySymbols,Zg=Object.prototype.hasOwnProperty;function Yl(t,e){return function(r,s,i){return t(r,s,i)&&e(r,s,i)}}function Xs(t){return function(n,r,s){if(!n||!r||typeof n!="object"||typeof r!="object")return t(n,r,s);var i=s.cache,o=i.get(n),a=i.get(r);if(o&&a)return o===r&&a===n;i.set(n,r),i.set(r,n);var l=t(n,r,s);return i.delete(n),i.delete(r),l}}function Xl(t){return Yg(t).concat(Xg(t))}var Qg=Object.hasOwn||function(t,e){return Zg.call(t,e)};function Un(t,e){return t===e||!t&&!e&&t!==t&&e!==e}var em="__v",tm="__o",nm="_owner",Zl=Object.getOwnPropertyDescriptor,Ql=Object.keys;function rm(t,e,n){var r=t.length;if(e.length!==r)return!1;for(;r-- >0;)if(!n.equals(t[r],e[r],r,r,t,e,n))return!1;return!0}function sm(t,e){return Un(t.getTime(),e.getTime())}function im(t,e){return t.name===e.name&&t.message===e.message&&t.cause===e.cause&&t.stack===e.stack}function om(t,e){return t===e}function ec(t,e,n){var r=t.size;if(r!==e.size)return!1;if(!r)return!0;for(var s=new Array(r),i=t.entries(),o,a,l=0;(o=i.next())&&!o.done;){for(var u=e.entries(),d=!1,f=0;(a=u.next())&&!a.done;){if(s[f]){f++;continue}var h=o.value,p=a.value;if(n.equals(h[0],p[0],l,f,t,e,n)&&n.equals(h[1],p[1],h[0],p[0],t,e,n)){d=s[f]=!0;break}f++}if(!d)return!1;l++}return!0}var am=Un;function lm(t,e,n){var r=Ql(t),s=r.length;if(Ql(e).length!==s)return!1;for(;s-- >0;)if(!Dd(t,e,n,r[s]))return!1;return!0}function Kr(t,e,n){var r=Xl(t),s=r.length;if(Xl(e).length!==s)return!1;for(var i,o,a;s-- >0;)if(i=r[s],!Dd(t,e,n,i)||(o=Zl(t,i),a=Zl(e,i),(o||a)&&(!o||!a||o.configurable!==a.configurable||o.enumerable!==a.enumerable||o.writable!==a.writable)))return!1;return!0}function cm(t,e){return Un(t.valueOf(),e.valueOf())}function um(t,e){return t.source===e.source&&t.flags===e.flags}function tc(t,e,n){var r=t.size;if(r!==e.size)return!1;if(!r)return!0;for(var s=new Array(r),i=t.values(),o,a;(o=i.next())&&!o.done;){for(var l=e.values(),u=!1,d=0;(a=l.next())&&!a.done;){if(!s[d]&&n.equals(o.value,a.value,o.value,a.value,t,e,n)){u=s[d]=!0;break}d++}if(!u)return!1}return!0}function dm(t,e){var n=t.length;if(e.length!==n)return!1;for(;n-- >0;)if(t[n]!==e[n])return!1;return!0}function hm(t,e){return t.hostname===e.hostname&&t.pathname===e.pathname&&t.protocol===e.protocol&&t.port===e.port&&t.hash===e.hash&&t.username===e.username&&t.password===e.password}function Dd(t,e,n,r){return(r===nm||r===tm||r===em)&&(t.$$typeof||e.$$typeof)?!0:Qg(e,r)&&n.equals(t[r],e[r],r,r,t,e,n)}var fm="[object Arguments]",pm="[object Boolean]",gm="[object Date]",mm="[object Error]",ym="[object Map]",bm="[object Number]",_m="[object Object]",km="[object RegExp]",vm="[object Set]",wm="[object String]",xm="[object URL]",Cm=Array.isArray,nc=typeof ArrayBuffer=="function"&&ArrayBuffer.isView?ArrayBuffer.isView:null,rc=Object.assign,Sm=Object.prototype.toString.call.bind(Object.prototype.toString);function Tm(t){var e=t.areArraysEqual,n=t.areDatesEqual,r=t.areErrorsEqual,s=t.areFunctionsEqual,i=t.areMapsEqual,o=t.areNumbersEqual,a=t.areObjectsEqual,l=t.arePrimitiveWrappersEqual,u=t.areRegExpsEqual,d=t.areSetsEqual,f=t.areTypedArraysEqual,h=t.areUrlsEqual;return function(y,b,w){if(y===b)return!0;if(y==null||b==null)return!1;var M=typeof y;if(M!==typeof b)return!1;if(M!=="object")return M==="number"?o(y,b,w):M==="function"?s(y,b,w):!1;var v=y.constructor;if(v!==b.constructor)return!1;if(v===Object)return a(y,b,w);if(Cm(y))return e(y,b,w);if(nc!=null&&nc(y))return f(y,b,w);if(v===Date)return n(y,b,w);if(v===RegExp)return u(y,b,w);if(v===Map)return i(y,b,w);if(v===Set)return d(y,b,w);var S=Sm(y);return S===gm?n(y,b,w):S===km?u(y,b,w):S===ym?i(y,b,w):S===vm?d(y,b,w):S===_m?typeof y.then!="function"&&typeof b.then!="function"&&a(y,b,w):S===xm?h(y,b,w):S===mm?r(y,b,w):S===fm?a(y,b,w):S===pm||S===bm||S===wm?l(y,b,w):!1}}function Em(t){var e=t.circular,n=t.createCustomConfig,r=t.strict,s={areArraysEqual:r?Kr:rm,areDatesEqual:sm,areErrorsEqual:im,areFunctionsEqual:om,areMapsEqual:r?Yl(ec,Kr):ec,areNumbersEqual:am,areObjectsEqual:r?Kr:lm,arePrimitiveWrappersEqual:cm,areRegExpsEqual:um,areSetsEqual:r?Yl(tc,Kr):tc,areTypedArraysEqual:r?Kr:dm,areUrlsEqual:hm};if(n&&(s=rc({},s,n(s))),e){var i=Xs(s.areArraysEqual),o=Xs(s.areMapsEqual),a=Xs(s.areObjectsEqual),l=Xs(s.areSetsEqual);s=rc({},s,{areArraysEqual:i,areMapsEqual:o,areObjectsEqual:a,areSetsEqual:l})}return s}function Om(t){return function(e,n,r,s,i,o,a){return t(e,n,a)}}function Mm(t){var e=t.circular,n=t.comparator,r=t.createState,s=t.equals,i=t.strict;if(r)return function(l,u){var d=r(),f=d.cache,h=f===void 0?e?new WeakMap:void 0:f,p=d.meta;return n(l,u,{cache:h,equals:s,meta:p,strict:i})};if(e)return function(l,u){return n(l,u,{cache:new WeakMap,equals:s,meta:void 0,strict:i})};var o={cache:void 0,equals:s,meta:void 0,strict:i};return function(l,u){return n(l,u,o)}}var zt=_n();_n({strict:!0});_n({circular:!0});_n({circular:!0,strict:!0});_n({createInternalComparator:function(){return Un}});_n({strict:!0,createInternalComparator:function(){return Un}});_n({circular:!0,createInternalComparator:function(){return Un}});_n({circular:!0,createInternalComparator:function(){return Un},strict:!0});function _n(t){t===void 0&&(t={});var e=t.circular,n=e===void 0?!1:e,r=t.createInternalComparator,s=t.createState,i=t.strict,o=i===void 0?!1:i,a=Em(t),l=Tm(a),u=r?r(l):Om(l);return Mm({circular:n,comparator:l,createState:s,equals:u,strict:o})}const Am=new Set(["http:","https:","mailto:","sms:","tel:"]);let qd=class Ld extends yn{constructor(n="",r={},s){super(s);sn(this,"__url");sn(this,"__target");sn(this,"__rel");sn(this,"__title");const{target:i=null,rel:o=null,title:a=null}=r;this.__url=n,this.__target=i,this.__rel=o,this.__title=a}static getType(){return"link"}static clone(n){return new Ld(n.__url,{rel:n.__rel,target:n.__target,title:n.__title},n.__key)}createDOM(n){const r=document.createElement("a");return this.updateLinkDOM(null,r,n),Et(r,n.theme.link),r}updateLinkDOM(n,r,s){if(fd(r)){n&&n.__url===this.__url||(r.href=this.sanitizeUrl(this.__url));for(const i of["target","rel","title"]){const o=`__${i}`,a=this[o];n&&n[o]===a||(a?r[i]=a:r.removeAttribute(i))}}}updateDOM(n,r,s){return this.updateLinkDOM(n,r,s),!1}static importDOM(){return{a:n=>({conversion:jm,priority:1})}}static importJSON(n){return fa().updateFromJSON(n)}updateFromJSON(n){return super.updateFromJSON(n).setURL(n.url).setRel(n.rel||null).setTarget(n.target||null).setTitle(n.title||null)}sanitizeUrl(n){n=sc(n);try{const r=new URL(sc(n));if(!Am.has(r.protocol))return"about:blank"}catch{return n}return n}exportJSON(){return{...super.exportJSON(),rel:this.getRel(),target:this.getTarget(),title:this.getTitle(),url:this.getURL()}}getURL(){return this.getLatest().__url}setURL(n){const r=this.getWritable();return r.__url=n,r}getTarget(){return this.getLatest().__target}setTarget(n){const r=this.getWritable();return r.__target=n,r}getRel(){return this.getLatest().__rel}setRel(n){const r=this.getWritable();return r.__rel=n,r}getTitle(){return this.getLatest().__title}setTitle(n){const r=this.getWritable();return r.__title=n,r}insertNewAfter(n,r=!0){const s=fa(this.__url,{rel:this.__rel,target:this.__target,title:this.__title});return this.insertAfter(s,r),s}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}canBeEmpty(){return!1}isInline(){return!0}extractWithChild(n,r,s){if(!X(r))return!1;const i=r.anchor.getNode(),o=r.focus.getNode();return this.isParentOf(i)&&this.isParentOf(o)&&r.getTextContent().length>0}isEmailURI(){return this.__url.startsWith("mailto:")}isWebSiteURI(){return this.__url.startsWith("https://")||this.__url.startsWith("http://")}};function jm(t){let e=null;if(fd(t)){const n=t.textContent;(n!==null&&n!==""||t.children.length>0)&&(e=fa(t.getAttribute("href")||"",{rel:t.getAttribute("rel"),target:t.getAttribute("target"),title:t.getAttribute("title")}))}return{node:e}}function fa(t="",e){return Ie(new qd(t,e))}function Nm(t){return t instanceof qd}const Im=/^\+?[0-9\s()-]{5,}$/;function sc(t){return t.match(/^[a-z][a-z0-9+.-]*:/i)||t.match(/^[/#.]/)?t:t.includes("@")?`mailto:${t}`:Im.test(t)?`tel:${t}`:`https://${t}`}const Fd=[];let Ud=class Bd extends yn{constructor(n=Fd,r){super(r);sn(this,"__ids");this.__ids=n}static getType(){return"mark"}static clone(n){return new Bd(n.__ids,n.__key)}static importDOM(){return null}static importJSON(n){return ic().updateFromJSON(n)}updateFromJSON(n){return super.updateFromJSON(n).setIDs(n.ids)}exportJSON(){return{...super.exportJSON(),ids:this.getIDs()}}createDOM(n){const r=document.createElement("mark");return Et(r,n.theme.mark),this.__ids.length>1&&Et(r,n.theme.markOverlap),r}updateDOM(n,r,s){const i=n.__ids,o=this.__ids,a=i.length,l=o.length,u=s.theme.markOverlap;return a!==l&&(a===1?l===2&&Et(r,u):l===1&&mi(r,u)),!1}hasID(n){return this.getIDs().includes(n)}getIDs(){return Array.from(this.getLatest().__ids)}setIDs(n){const r=this.getWritable();return r.__ids=n,r}addID(n){const r=this.getWritable();return r.__ids.includes(n)?r:r.setIDs([...r.__ids,n])}deleteID(n){const r=this.getWritable(),s=r.__ids.indexOf(n);if(s===-1)return r;const i=Array.from(r.__ids);return i.splice(s,1),r.setIDs(i)}insertNewAfter(n,r=!0){const s=ic(this.__ids);return this.insertAfter(s,r),s}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}canBeEmpty(){return!1}isInline(){return!0}extractWithChild(n,r,s){if(!X(r)||s==="html")return!1;const i=r.anchor,o=r.focus,a=i.getNode(),l=o.getNode(),u=r.isBackward()?i.offset-o.offset:o.offset-i.offset;return this.isParentOf(a)&&this.isParentOf(l)&&this.getTextContent().length===u}excludeFromCopy(n){return n!=="clone"}};function ic(t=Fd){return Ie(new Ud(t))}function Rm(t){return t instanceof Ud}const Hd=Object.freeze({"	":"\\t","\n":"\\n"}),oc=new RegExp(Object.keys(Hd).join("|"),"g"),Ot=Object.freeze({ancestorHasNextSibling:"|",ancestorIsLastChild:" ",hasNextSibling:"",isLastChild:"",selectedChar:"^",selectedLine:">"}),Pm=[t=>t.hasFormat("bold")&&"Bold",t=>t.hasFormat("code")&&"Code",t=>t.hasFormat("italic")&&"Italic",t=>t.hasFormat("strikethrough")&&"Strikethrough",t=>t.hasFormat("subscript")&&"Subscript",t=>t.hasFormat("superscript")&&"Superscript",t=>t.hasFormat("underline")&&"Underline",t=>t.hasFormat("highlight")&&"Highlight"],$m=[t=>t.hasTextFormat("bold")&&"Bold",t=>t.hasTextFormat("code")&&"Code",t=>t.hasTextFormat("italic")&&"Italic",t=>t.hasTextFormat("strikethrough")&&"Strikethrough",t=>t.hasTextFormat("subscript")&&"Subscript",t=>t.hasTextFormat("superscript")&&"Superscript",t=>t.hasTextFormat("underline")&&"Underline",t=>t.hasTextFormat("highlight")&&"Highlight"],Dm=[t=>t.isDirectionless()&&"Directionless",t=>t.isUnmergeable()&&"Unmergeable"],qm=[t=>t.isToken()&&"Token",t=>t.isSegmented()&&"Segmented"];function Lm(t,e,n,r,s=!1){const i=t.getEditorState(),o=t._config,a=t._compositionKey,l=t._editable;if(n){let h="";return i.read(()=>{h=function(p){const y=document.createElement("div");return y.innerHTML=p.trim(),zd(y,0).innerHTML}(lp(t))}),h}let u=` root
`;const d=i.read(()=>{const h=re();return Wd(Dt(),(p,y)=>{const b=`(${p.getKey()})`,w=p.getType()||"",M=p.isSelected();u+=`${M?Ot.selectedLine:" "} ${y.join(" ")} ${b} ${w} ${function(v,S,j=!1){const P=S?S(v,j):void 0;if(P!==void 0&&P.length>0)return P;if(ee(v)){const D=v.getTextContent(),B=D.length===0?"(empty)":`"${ac(D,j)}"`,U=function(H){return[lc(H),Fm(H),Um(H),cc(H)].filter(Boolean).join(", ")}(v);return[B,U.length!==0?`{ ${U} }`:null].filter(Boolean).join(" ").trim()}if(Nm(v)){const D=v.getURL(),B=D.length===0?"(empty)":`"${ac(D,j)}"`,U=function(H){return[Bm(H),Hm(H),Wm(H),cc(H)].filter(Boolean).join(", ")}(v);return[B,U.length!==0?`{ ${U} }`:null].filter(Boolean).join(" ").trim()}if(Rm(v))return`ids: [ ${v.getIDs().join(", ")} ]`;if(up(v)){const D=function(U){let H=$m.map(W=>W(U)).filter(Boolean).join(", ").toLocaleLowerCase();return H!==""&&(H="format: "+H),H}(v);let B=D!==""?`{ ${D} }`:"";return B+=v.__style?`(${v.__style})`:"",B}return""}(p,r,s)}
`,u+=function({indent:v,isSelected:S,node:j,nodeKeyDisplay:P,selection:D,typeDisplay:B}){if(!ee(j)||!X(D)||!S||we(j))return"";const U=D.anchor,H=D.focus;if(j.getTextContent()===""||U.getNode()===D.focus.getNode()&&U.offset===H.offset)return"";const[W,k]=function(q,L){const F=L.getStartEndPoints();if(Pl(L)||F===null)return[-1,-1];const[J,K]=F,Y=q.getTextContent(),ne=Y.length;let V=-1,ue=-1;if(J.type==="text"&&K.type==="text"){const se=J.getNode(),ie=K.getNode();se===ie&&q===se&&J.offset!==K.offset?[V,ue]=J.offset<K.offset?[J.offset,K.offset]:[K.offset,J.offset]:[V,ue]=q===se?se.isBefore(ie)?[J.offset,ne]:[0,J.offset]:q===ie?ie.isBefore(se)?[K.offset,ne]:[0,K.offset]:[0,ne]}const ye=(Y.slice(0,V).match(oc)||[]).length,te=(Y.slice(V,ue).match(oc)||[]).length;return[V+ye,ue+ye+te]}(j,D);if(W===k)return"";const I=v[v.length-1]===Ot.hasNextSibling?Ot.ancestorHasNextSibling:Ot.ancestorIsLastChild,C=[...v.slice(0,v.length-1),I],$=Array(W+1).fill(" "),O=Array(k-W).fill(Ot.selectedChar),A=B.length+2,N=Array(P.length+A).fill(" ");return[Ot.selectedLine,C.join(" "),[...N,...$,...O].join("")].join(" ")+`
`}({indent:y,isSelected:M,node:p,nodeKeyDisplay:b,selection:h,typeDisplay:w})}),h===null?": null":X(h)?function(p){let y="";const b=lc(p);y+=`: range ${b!==""?`{ ${b} }`:""} ${p.style!==""?`{ style: ${p.style} } `:""}`;const w=p.anchor,M=p.focus,v=w.offset,S=M.offset;return y+=`
   anchor { key: ${w.key}, offset: ${v===null?"null":v}, type: ${w.type} }`,y+=`
   focus { key: ${M.key}, offset: ${S===null?"null":S}, type: ${M.type} }`,y}(h):cp(h)?function(p){return`: table
   { table: ${p.tableKey}, anchorCell: ${p.anchor.key}, focusCell: ${p.focus.key} }`}(h):function(p){return Pl(p)?`: node
   [${Array.from(p._nodes).join(", ")}]`:""}(h)});if(u+=`
 selection`+d,u+=`

 commands:`,e.length)for(const{index:h,type:p,payload:y}of e)u+=`
   ${h}. { type: ${p}, payload: ${y instanceof Event?y.constructor.name:y} }`;else u+=`
   None dispatched.`;const{version:f}=t.constructor;return u+=`

 editor${f?` (v${f})`:""}:`,u+=`
   namespace ${o.namespace}`,a!==null&&(u+=`
   compositionKey ${a}`),u+=`
   editable ${String(l)}`,u}function Wd(t,e,n=[]){const r=t.getChildren(),s=r.length;r.forEach((i,o)=>{e(i,n.concat(o===s-1?Ot.isLastChild:Ot.hasNextSibling)),we(i)&&Wd(i,e,n.concat(o===s-1?Ot.ancestorIsLastChild:Ot.ancestorHasNextSibling))})}function ac(t,e=!1){const n=Object.entries(Hd).reduce((r,[s,i])=>r.replace(new RegExp(s,"g"),String(i)),t);return e?n.replace(/[^\s]/g,"*"):n}function Fm(t){let e=Dm.map(n=>n(t)).filter(Boolean).join(", ").toLocaleLowerCase();return e!==""&&(e="detail: "+e),e}function Um(t){let e=qm.map(n=>n(t)).filter(Boolean).join(", ").toLocaleLowerCase();return e!==""&&(e="mode: "+e),e}function lc(t){let e=Pm.map(n=>n(t)).filter(Boolean).join(", ").toLocaleLowerCase();return e!==""&&(e="format: "+e),e}function Bm(t){let e=t.getTarget();return e!=null&&(e="target: "+e),e}function Hm(t){let e=t.getRel();return e!=null&&(e="rel: "+e),e}function Wm(t){let e=t.getTitle();return e!=null&&(e="title: "+e),e}function cc(t){if(!t.__state)return!1;const e=[];for(const[r,s]of t.__state.knownState.entries()){if(r.isEqual(s,r.defaultValue))continue;const i=JSON.stringify(r.unparse(s));e.push(`[${r.key}: ${i}]`)}let n=e.join(",");return n!==""&&(n="state: "+n),n}function zd(t,e){const n=new Array(1+e++).join("  "),r=new Array(e-1).join("  ");let s;for(let i=0;i<t.children.length;i++)s=document.createTextNode(`
`+n),t.insertBefore(s,t.children[i]),zd(t.children[i],e),t.lastElementChild===t.children[i]&&(s=document.createTextNode(`
`+r),t.appendChild(s));return t}const zm=_.forwardRef(function({treeTypeButtonClassName:t,timeTravelButtonClassName:e,timeTravelPanelSliderClassName:n,timeTravelPanelButtonClassName:r,viewClassName:s,timeTravelPanelClassName:i,editorState:o,setEditorState:a,setEditorReadOnly:l,generateContent:u,commandsLog:d=[]},f){const[h,p]=_.useState([]),[y,b]=_.useState(""),[w,M]=_.useState(!1),[v,S]=_.useState(!1),j=_.useRef(0),P=_.useRef(null),[D,B]=_.useState(!1),[U,H]=_.useState(!1),[W,k]=_.useState(!1),I=_.useRef(null),C=_.useRef([]),$=_.useRef(0),O=_.useCallback(N=>{const q=++$.current;u(N).then(L=>{q===$.current&&b(L)}).catch(L=>{q===$.current&&b(`Error rendering tree: ${L.message}

Stack:
${L.stack}`)})},[u]);_.useEffect(()=>{if(!(!W&&o._nodeMap.size>1e3&&(H(!0),!W))&&(I.current!==o||C.current!==d)){const N=I.current!==o;I.current=o,C.current=d,O(v),!w&&N&&p(q=>[...q,[Date.now(),o]])}},[o,O,v,W,w,d]);const A=h.length;return _.useEffect(()=>{if(D){let N;const q=()=>{const L=j.current;if(L===A-1)return void B(!1);const F=h[L][0],J=h[L+1][0];N=setTimeout(()=>{j.current++;const K=j.current,Y=P.current;Y!==null&&(Y.value=String(K)),a(h[K][1]),q()},J-F)};return q(),()=>{clearTimeout(N)}}},[h,D,A,a]),m.jsxs("div",{className:s,children:[!W&&U?m.jsxs("div",{style:{padding:20},children:[m.jsx("span",{style:{marginRight:20},children:"Detected large EditorState, this can impact debugging performance."}),m.jsx("button",{onClick:()=>{k(!0)},style:{background:"transparent",border:"1px solid white",color:"white",cursor:"pointer",padding:5},children:"Show full tree"})]}):null,W?null:m.jsx("button",{onClick:()=>(O(!v),void S(!v)),className:t,type:"button",children:v?"Tree":"Export DOM"}),!w&&(W||!U)&&A>2&&m.jsx("button",{onClick:()=>{l(!0),j.current=A-1,M(!0)},className:e,type:"button",children:"Time Travel"}),(W||!U)&&m.jsx("pre",{ref:f,children:y}),w&&(W||!U)&&m.jsxs("div",{className:i,children:[m.jsx("button",{className:r,onClick:()=>{j.current===A-1&&(j.current=1),B(!D)},type:"button",children:D?"Pause":"Play"}),m.jsx("input",{className:n,ref:P,onChange:N=>{const q=Number(N.target.value),L=h[q];L&&(j.current=q,a(L[1]))},type:"range",min:"1",max:A-1}),m.jsx("button",{className:r,onClick:()=>{l(!1);const N=h.length-1,q=h[N];a(q[1]);const L=P.current;L!==null&&(L.value=String(N)),M(!1),B(!1)},type:"button",children:"Exit"})]})]})});function Km(t,e){const n=new Set;let r=0;for(const[s]of t._commands)n.add(t.registerCommand(s,i=>(e(o=>{r+=1;const a=[...o];return a.push({index:r,payload:i,type:s.type?s.type:"UNKNOWN"}),a.length>10&&a.shift(),a}),!1),es));return()=>n.forEach(s=>s())}function Jm(t){const[e,n]=_.useState([]);return _.useEffect(()=>Km(t,n),[t]),_.useMemo(()=>e,[e])}function Vm({treeTypeButtonClassName:t,timeTravelButtonClassName:e,timeTravelPanelSliderClassName:n,timeTravelPanelButtonClassName:r,timeTravelPanelClassName:s,viewClassName:i,editor:o,customPrintNode:a}){const l=_.createRef(),[u,d]=_.useState(o.getEditorState()),f=Jm(o);return _.useEffect(()=>Xe(o.registerUpdateListener(({editorState:h})=>{d(h)}),o.registerEditableListener(()=>{d(o.getEditorState())})),[o]),_.useEffect(()=>{const h=l.current;if(h!==null)return h.__lexicalEditor=o,()=>{h.__lexicalEditor=null}},[o,l]),m.jsx(zm,{treeTypeButtonClassName:t,timeTravelButtonClassName:e,timeTravelPanelSliderClassName:n,timeTravelPanelButtonClassName:r,viewClassName:i,timeTravelPanelClassName:s,setEditorReadOnly:h=>{const p=o.getRootElement();p!=null&&(p.contentEditable=h?"false":"true")},editorState:u,setEditorState:h=>o.setEditorState(h),generateContent:async function(h){return Lm(o,f,h,a)},ref:l,commandsLog:f})}function Kd({editorRef:t}){const[e]=ce();return _.useEffect(()=>{typeof t=="function"?t(e):typeof t=="object"&&(t.current=e)},[e]),null}function Gm(t,e,n,r,s){if(t===null||n.size===0&&r.size===0&&!s)return 0;const i=e._selection,o=t._selection;if(s)return 1;if(!(X(i)&&X(o)&&o.isCollapsed()&&i.isCollapsed()))return 0;const a=function(M,v,S){const j=M._nodeMap,P=[];for(const D of v){const B=j.get(D);B!==void 0&&P.push(B)}for(const[D,B]of S){if(!B)continue;const U=j.get(D);U===void 0||hp(U)||P.push(U)}return P}(e,n,r);if(a.length===0)return 0;if(a.length>1){const M=e._nodeMap,v=M.get(i.anchor.key),S=M.get(o.anchor.key);return v&&S&&!t._nodeMap.has(v.__key)&&ee(v)&&v.__text.length===1&&i.anchor.offset===1?2:0}const l=a[0],u=t._nodeMap.get(l.__key);if(!ee(u)||!ee(l)||u.__mode!==l.__mode)return 0;const d=u.__text,f=l.__text;if(d===f)return 0;const h=i.anchor,p=o.anchor;if(h.key!==p.key||h.type!=="text")return 0;const y=h.offset,b=p.offset,w=f.length-d.length;return w===1&&b===y-1?2:w===-1&&b===y+1?3:w===-1&&b===y?4:0}function Ym(t,e){let n=Date.now(),r=0;return(s,i,o,a,l,u)=>{const d=Date.now();if(u.has(da))return r=0,n=d,2;const f=Gm(s,i,a,l,t.isComposing()),h=(()=>{const p=o===null||o.editor===t,y=u.has(dp);if(!y&&p&&u.has(md))return 0;if(s===null)return 1;const b=i._selection;if(!(a.size>0||l.size>0))return b!==null?0:2;const w=typeof e=="number"?e:e.peek();return y===!1&&f!==0&&f===r&&d<n+w&&p||a.size===1&&function(M,v,S){const j=v._nodeMap.get(M),P=S._nodeMap.get(M),D=v._selection,B=S._selection;return!(X(D)&&X(B)&&D.anchor.type==="element"&&D.focus.type==="element"&&B.anchor.type==="text"&&B.focus.type==="text"||!ee(j)||!ee(P)||j.__parent!==P.__parent)&&JSON.stringify(v.read(()=>j.exportJSON()))===JSON.stringify(S.read(()=>P.exportJSON()))}(Array.from(a)[0],s,i)?0:1})();return n=d,r=f,h}}function uc(t){t.undoStack=[],t.redoStack=[],t.current=null}function Jd(t,e,n){const r=Ym(t,n);return Xe(t.registerCommand(Ha,()=>(function(i,o){const a=o.redoStack,l=o.undoStack;if(l.length!==0){const u=o.current,d=l.pop();u!==null&&(a.push(u),i.dispatchCommand(Vr,!0)),l.length===0&&i.dispatchCommand(Gr,!1),o.current=d||null,d&&d.editor.setEditorState(d.editorState,{tag:da})}}(t,e),!0),xe),t.registerCommand(Ba,()=>(function(i,o){const a=o.redoStack,l=o.undoStack;if(a.length!==0){const u=o.current;u!==null&&(l.push(u),i.dispatchCommand(Gr,!0));const d=a.pop();a.length===0&&i.dispatchCommand(Vr,!1),o.current=d||null,d&&d.editor.setEditorState(d.editorState,{tag:da})}}(t,e),!0),xe),t.registerCommand(gd,()=>(uc(e),!1),xe),t.registerCommand(pd,()=>(uc(e),t.dispatchCommand(Vr,!1),t.dispatchCommand(Gr,!1),!0),xe),t.registerUpdateListener(({editorState:i,prevEditorState:o,dirtyLeaves:a,dirtyElements:l,tags:u})=>{const d=e.current,f=e.redoStack,h=e.undoStack,p=d===null?null:d.editorState;if(d!==null&&i===p)return;const y=r(o,i,d,a,l,u);if(y===1)f.length!==0&&(e.redoStack=[],t.dispatchCommand(Vr,!1)),d!==null&&(h.push({...d}),t.dispatchCommand(Gr,!0));else if(y===2)return;e.current={editor:t,editorState:i}}))}function Vd(){return{current:null,redoStack:[],undoStack:[]}}const Ko=yd({build:(t,{delay:e,createInitialHistoryState:n,disabled:r})=>mp({delay:e,disabled:r,historyState:n(t)}),config:gp({createInitialHistoryState:Vd,delay:300,disabled:typeof window>"u"}),name:"@lexical/history/History",register:(t,e,n)=>{const r=n.getOutput();return bd(()=>r.disabled.value?void 0:Jd(t,r.historyState.value,r.delay))}});yd({dependencies:[fp(Ko,{createInitialHistoryState:()=>{throw new Error("SharedHistory did not inherit parent history")},disabled:!0})],name:"@lexical/history/SharedHistory",register(t,e,n){const{output:r}=n.getDependency(Ko),s=function(o){return o?pp(o,Ko.name):null}(t._parentEditor);if(!s)return()=>{};const i=s.output;return bd(()=>yp(()=>{r.delay.value=i.delay.value,r.historyState.value=i.historyState.value,r.disabled.value=i.disabled.value}))}});function Gd({delay:t,externalHistoryState:e}){const[n]=ce();return function(r,s,i=1e3){const o=_.useMemo(()=>s||Vd(),[s]);_.useEffect(()=>Jd(r,o,i),[i,r,o])}(n,e,t),null}const pa=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,Xm=pa?_.useLayoutEffect:_.useEffect;let Zm=class{constructor(e){sn(this,"key");sn(this,"ref");this.key=e,this.ref={current:null},this.setRefElement=this.setRefElement.bind(this)}setRefElement(e){this.ref={current:e}}};const dc=t=>{const e=document.getElementById("typeahead-menu");if(!e)return;const n=e.getBoundingClientRect();n.top+n.height>window.innerHeight&&e.scrollIntoView({block:"center"}),n.top<0&&e.scrollIntoView({block:"center"}),t.scrollIntoView({block:"nearest"})};function hc(t,e){const n=t.getBoundingClientRect(),r=e.getBoundingClientRect();return n.top>=r.top-6&&n.top<=r.bottom+6}function Qm(t,e,n,r){const[s]=ce();_.useEffect(()=>{if(e!=null&&t!=null){const i=s.getRootElement(),o=i!=null?function(f){let h=getComputedStyle(f);const p=h.position==="absolute",y=/(auto|scroll)/;if(h.position==="fixed")return document.body;for(let b=f;b=b.parentElement;)if(h=getComputedStyle(b),(!p||h.position!=="static")&&y.test(h.overflow+h.overflowY+h.overflowX))return b;return document.body}(i):document.body;let a=!1,l=hc(e,o);const u=function(){a||(window.requestAnimationFrame(function(){n(),a=!1}),a=!0);const f=hc(e,o);f!==l&&(l=f,r!=null&&r(f))},d=new ResizeObserver(n);return window.addEventListener("resize",n),document.addEventListener("scroll",u,{capture:!0,passive:!0}),d.observe(e),()=>{d.unobserve(e),window.removeEventListener("resize",n),document.removeEventListener("scroll",u,!0)}}},[e,s,r,n,t])}const fc=Wa("SCROLL_TYPEAHEAD_OPTION_INTO_VIEW_COMMAND");function ey({close:t,editor:e,anchorElementRef:n,resolution:r,options:s,menuRenderFn:i,onSelectOption:o,shouldSplitNodeWithQuery:a=!1,commandPriority:l=kr,preselectFirstItem:u=!0}){const[d,f]=_.useState(null),h=d!==null?Math.min(s.length-1,d):null,p=r.match&&r.match.matchingString;_.useEffect(()=>{u&&f(0)},[p,u]);const y=_.useCallback(w=>{e.update(()=>{const M=r.match!=null&&a?function(v){const S=re();if(!X(S)||!S.isCollapsed())return null;const j=S.anchor;if(j.type!=="text")return null;const P=j.getNode();if(!P.isSimpleText())return null;const D=j.offset,B=P.getTextContent().slice(0,D),U=v.replaceableString.length,H=D-function(k,I,C){let $=C;for(let O=$;O<=I.length;O++)k.slice(-O)===I.substring(0,O)&&($=O);return $}(B,v.matchingString,U);if(H<0)return null;let W;return H===0?[W]=P.splitText(D):[,W]=P.splitText(H,D),W}(r.match):null;o(w,M,t,r.match?r.match.matchingString:"")})},[e,a,r.match,o,t]),b=_.useCallback(w=>{const M=e.getRootElement();M!==null&&(M.setAttribute("aria-activedescendant","typeahead-item-"+w),f(w))},[e]);return _.useEffect(()=>()=>{const w=e.getRootElement();w!==null&&w.removeAttribute("aria-activedescendant")},[e]),Xm(()=>{s===null?f(null):h===null&&u&&b(0)},[s,h,b,u]),_.useEffect(()=>Xe(e.registerCommand(fc,({option:w})=>!(!w.ref||w.ref.current==null)&&(dc(w.ref.current),!0),l)),[e,b,l]),_.useEffect(()=>Xe(e.registerCommand(wp,w=>{const M=w;if(s!==null&&s.length){const v=h===null?0:h!==s.length-1?h+1:0;b(v);const S=s[v];if(!S)return b(-1),M.preventDefault(),M.stopImmediatePropagation(),!0;S.ref&&S.ref.current&&e.dispatchCommand(fc,{index:v,option:S}),M.preventDefault(),M.stopImmediatePropagation()}return!0},l),e.registerCommand(vp,w=>{const M=w;if(s!==null&&s.length){const v=h===null?s.length-1:h!==0?h-1:s.length-1;b(v);const S=s[v];if(!S)return b(-1),M.preventDefault(),M.stopImmediatePropagation(),!0;S.ref&&S.ref.current&&dc(S.ref.current),M.preventDefault(),M.stopImmediatePropagation()}return!0},l),e.registerCommand(kd,w=>{const M=w;return M.preventDefault(),M.stopImmediatePropagation(),t(),!0},l),e.registerCommand(kp,w=>{const M=w;return s!==null&&h!==null&&s[h]!=null&&(M.preventDefault(),M.stopImmediatePropagation(),y(s[h]),!0)},l),e.registerCommand(_d,w=>s!==null&&h!==null&&s[h]!=null&&(w!==null&&(w.preventDefault(),w.stopImmediatePropagation()),y(s[h]),!0),l)),[y,t,e,s,h,b,l]),i(n,_.useMemo(()=>({options:s,selectOptionAndCleanUp:y,selectedIndex:h,setHighlightedIndex:f}),[y,h,s]),r.match?r.match.matchingString:"")}function pc(t,e){e!=null&&(t.className=e),t.setAttribute("aria-label","Typeahead menu"),t.setAttribute("role","listbox"),t.style.display="block",t.style.position="absolute"}function ty({options:t,onWillOpen:e,onClose:n,onOpen:r,onSelectOption:s,menuRenderFn:i,anchorClassName:o,commandPriority:a=kr,parent:l}){const[u]=ce(),[d,f]=_.useState(null),h=_.useRef(null),p=function(v,S,j,P=pa?document.body:void 0,D=!0){const[B]=ce(),U=pa?document.createElement("div"):null,H=_.useRef(U),W=_.useCallback(()=>{if(H.current===null||P===void 0)return;H.current.style.top=H.current.style.bottom;const I=B.getRootElement(),C=H.current,$=C.firstChild;if(I!==null&&v!==null){const{left:O,top:A,width:N,height:q}=v.getRect(),L=H.current.offsetHeight;if(C.style.top=`${A+L+3+(D?window.pageYOffset:0)}px`,C.style.left=`${O+window.pageXOffset}px`,C.style.height=`${q}px`,C.style.width=`${N}px`,$!==null){$.style.top=`${A}`;const F=$.getBoundingClientRect(),J=F.height,K=F.width,Y=I.getBoundingClientRect();O+K>Y.right&&(C.style.left=`${Y.right-K+window.pageXOffset}px`),(A+J>window.innerHeight||A+J>Y.bottom)&&A-Y.top>J+q&&(C.style.top=`${A-J-q+(D?window.pageYOffset:0)}px`)}C.isConnected||(pc(C,j),P.append(C)),C.setAttribute("id","typeahead-menu"),I.setAttribute("aria-controls","typeahead-menu")}},[B,v,D,j,P]);_.useEffect(()=>{const I=B.getRootElement();return v!==null&&W(),()=>{I!==null&&I.removeAttribute("aria-controls");const C=H.current;C!==null&&C.isConnected&&(C.remove(),C.removeAttribute("id"))}},[B,W,v]);const k=_.useCallback(I=>{v!==null&&(I||S(null))},[v,S]);return Qm(v,H.current,W,k),U!=null&&U===H.current&&(pc(U,j),P!=null&&P.append(U)),H}(d,f,o,l),y=_.useCallback(()=>{f(null),n!=null&&d!==null&&n()},[n,d]),b=_.useCallback(v=>{f(v),r!=null&&d===null&&r(v)},[r,d]),w=_.useCallback(v=>{v.preventDefault(),e!=null&&e(v);const S=bp(v.target);b({getRect:()=>new DOMRect(v.clientX/S,v.clientY/S,1,1)})},[b,e]),M=_.useCallback(v=>{d!==null&&h.current!=null&&v.target!=null&&_p(v.target)&&!h.current.contains(v.target)&&y()},[y,d]);return _.useEffect(()=>{const v=u.getRootElement();if(v)return v.addEventListener("contextmenu",w),()=>v.removeEventListener("contextmenu",w)},[u,w]),_.useEffect(()=>(document.addEventListener("click",M),()=>document.removeEventListener("click",M)),[u,M]),p.current===null||d===null||u===null?null:m.jsx(ey,{close:y,resolution:d,editor:u,anchorElementRef:p,options:t,menuRenderFn:(v,S)=>i(v,S,{setMenuRef:j=>{h.current=j}}),onSelectOption:s,commandPriority:a})}const gc=[["Cat","rgb(125, 50, 0)"],["Dog","rgb(100, 0, 0)"],["Rabbit","rgb(150, 0, 0)"],["Frog","rgb(200, 0, 0)"],["Fox","rgb(200, 75, 0)"],["Hedgehog","rgb(0, 75, 0)"],["Pigeon","rgb(0, 125, 0)"],["Squirrel","rgb(75, 100, 0)"],["Bear","rgb(125, 100, 0)"],["Tiger","rgb(0, 0, 150)"],["Leopard","rgb(0, 0, 200)"],["Zebra","rgb(0, 0, 250)"],["Wolf","rgb(0, 100, 150)"],["Owl","rgb(0, 100, 100)"],["Gull","rgb(100, 0, 100)"],["Squid","rgb(150, 0, 150)"]],mc=gc[Math.floor(Math.random()*gc.length)],Yd=_.createContext(null);function Xd(){return{color:mc[1],isCollabActive:!1,name:mc[0],yjsDocMap:new Map}}const ny=Xd();function ry({children:t}){const e=_.useMemo(()=>Xd(),[]);return m.jsx(Yd.Provider,{value:e,children:t})}function Zd(t,e){let n=_.useContext(Yd);return n==null&&function(r,...s){const i=new URL("https://lexical.dev/docs/error"),o=new URLSearchParams;o.append("code",r);for(const a of s)o.append("v",a);i.search=o.toString(),console.warn(`Minified Lexical warning #${r}; visit ${i.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}(319),n=n??ny,n}const Bn=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,sy=Bn&&"documentMode"in document?document.documentMode:null,iy=Bn&&/Mac|iPod|iPhone|iPad/.test(navigator.platform),oy=!(!Bn||!("InputEvent"in window)||sy)&&"getTargetRanges"in new window.InputEvent("input"),ay=Bn&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent),yc=Bn&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,ly=Bn&&/^(?=.*Chrome).*/i.test(navigator.userAgent),cy=Bn&&/AppleWebKit\/[\d.]+/.test(navigator.userAgent)&&iy&&!ly;function bc(t,e){e.update(()=>{if(t!==null){const n=wd(t,KeyboardEvent)?null:t.clipboardData,r=re();if(r!==null&&!r.isCollapsed()&&n!=null){t.preventDefault();const s=$p(e);s!==null&&n.setData("text/html",s),n.setData("text/plain",r.getTextContent())}}})}function uy(t){return Xe(t.registerCommand(Bo,e=>{const n=re();return!!X(n)&&(n.deleteCharacter(e),!0)},xe),t.registerCommand(Pp,e=>{const n=re();return!!X(n)&&(n.deleteWord(e),!0)},xe),t.registerCommand(Rp,e=>{const n=re();return!!X(n)&&(n.deleteLine(e),!0)},xe),t.registerCommand(Ip,e=>{const n=re();if(!X(n))return!1;if(typeof e=="string")n.insertText(e);else{const r=e.dataTransfer;if(r!=null)$l(r,n);else{const s=e.data;s&&n.insertText(s)}}return!0},xe),t.registerCommand(Np,()=>{const e=re();return!!X(e)&&(e.removeText(),!0)},xe),t.registerCommand(Dl,e=>{const n=re();return!!X(n)&&(n.insertLineBreak(e),!0)},xe),t.registerCommand(jp,()=>{const e=re();return!!X(e)&&(e.insertLineBreak(),!0)},xe),t.registerCommand(Ap,e=>{const n=re();if(!X(n))return!1;const r=e,s=r.shiftKey;return!!ql(n,!0)&&(r.preventDefault(),Ll(n,s,!0),!0)},xe),t.registerCommand(Mp,e=>{const n=re();if(!X(n))return!1;const r=e,s=r.shiftKey;return!!ql(n,!1)&&(r.preventDefault(),Ll(n,s,!1),!0)},xe),t.registerCommand(Op,e=>{const n=re();return!!X(n)&&(!yc||navigator.language!=="ko-KR")&&(e.preventDefault(),t.dispatchCommand(Bo,!0))},xe),t.registerCommand(Ep,e=>{const n=re();return!!X(n)&&(e.preventDefault(),t.dispatchCommand(Bo,!1))},xe),t.registerCommand(_d,e=>{const n=re();if(!X(n))return!1;if(e!==null){if((yc||ay||cy)&&oy)return!1;e.preventDefault()}return t.dispatchCommand(Dl,!1)},xe),t.registerCommand(Sp,()=>(Tp(),!0),xe),t.registerCommand(Wi,e=>{const n=re();return!!X(n)&&(bc(e,t),!0)},xe),t.registerCommand(Hi,e=>{const n=re();return!!X(n)&&(function(r,s){bc(r,s),s.update(()=>{const i=re();X(i)&&i.removeText()})}(e,t),!0)},xe),t.registerCommand(Bi,e=>{const n=re();return!!X(n)&&(function(r,s){r.preventDefault(),s.update(()=>{const i=re(),o=wd(r,ClipboardEvent)?r.clipboardData:null;o!=null&&X(i)&&$l(o,i)},{tag:Cp})}(e,t),!0)},xe),t.registerCommand(vd,e=>{const n=re();return!!X(n)&&(e.preventDefault(),!0)},xe),t.registerCommand(xp,e=>{const n=re();return!!X(n)&&(e.preventDefault(),!0)},xe))}function dy(t,...e){const n=new URL("https://lexical.dev/docs/error"),r=new URLSearchParams;r.append("code",t);for(const s of e)r.append("v",s);throw n.search=r.toString(),Error(`Minified Lexical error #${t}; visit ${n.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}const Xa=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0?_.useLayoutEffect:_.useEffect;function hy({editor:t,ErrorBoundary:e}){return function(n,r){const[s,i]=_.useState(()=>n.getDecorators());return Xa(()=>n.registerDecoratorListener(o=>{At.flushSync(()=>{i(o)})}),[n]),_.useEffect(()=>{i(n.getDecorators())},[n]),_.useMemo(()=>{const o=[],a=Object.keys(s);for(let l=0;l<a.length;l++){const u=a[l],d=m.jsx(r,{onError:h=>n._onError(h),children:m.jsx(_.Suspense,{fallback:null,children:s[u]})}),f=n.getElementByKey(u);f!==null&&o.push(At.createPortal(d,f,u))}return o},[r,s,n])}(t,e)}function fy({editor:t,ErrorBoundary:e}){return function(n){const r=Lp.maybeFromEditor(n);if(r&&r.hasExtensionByName(Fp.name)){for(const s of["@lexical/plain-text","@lexical/rich-text"])r.hasExtensionByName(s)&&dy(320,s);return!0}return!1}(t)?null:m.jsx(hy,{editor:t,ErrorBoundary:e})}function _c(t){return t.getEditorState().read(Up(t.isComposing()))}function py({contentEditable:t,placeholder:e=null,ErrorBoundary:n}){const[r]=ce();return function(s){Xa(()=>Xe(uy(s),Dp(s)),[s])}(r),m.jsxs(m.Fragment,{children:[t,m.jsx(gy,{content:e}),m.jsx(fy,{editor:r,ErrorBoundary:n})]})}function gy({content:t}){const[e]=ce(),n=function(s){const[i,o]=_.useState(()=>_c(s));return Xa(()=>{function a(){const l=_c(s);o(l)}return a(),Xe(s.registerUpdateListener(()=>{a()}),s.registerEditableListener(()=>{a()}))},[s]),i}(e),r=qp();return n?typeof t=="function"?t(r):t:null}const Nt=()=>new Map,ga=t=>{const e=Nt();return t.forEach((n,r)=>{e.set(r,n)}),e},xr=(t,e,n)=>{let r=t.get(e);return r===void 0&&t.set(e,r=n()),r},my=(t,e)=>{const n=[];for(const[r,s]of t)n.push(e(s,r));return n},yy=(t,e)=>{for(const[n,r]of t)if(e(r,n))return!0;return!1},lr=()=>new Set,Jo=t=>t[t.length-1],cr=Array.from,by=Array.isArray;class _y{constructor(){this._observers=Nt()}on(e,n){return xr(this._observers,e,lr).add(n),n}once(e,n){const r=(...s)=>{this.off(e,r),n(...s)};this.on(e,r)}off(e,n){const r=this._observers.get(e);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(e))}emit(e,n){return cr((this._observers.get(e)||Nt()).values()).forEach(r=>r(...n))}destroy(){this._observers=Nt()}}const Pn=Math.floor,_i=Math.abs,Qd=(t,e)=>t<e?t:e,Cr=(t,e)=>t>e?t:e,ky=t=>t!==0?t<0:1/t<0,kc=1,vc=2,Vo=4,Go=8,vy=32,eh=64,Ti=128,wy=31,wc=63,is=127,xy=2147483647,Cy=Number.isInteger||(t=>typeof t=="number"&&isFinite(t)&&Pn(t)===t),Sy=t=>t.toLowerCase(),Ty=/^\s*/g,Ey=t=>t.replace(Ty,""),Oy=/([A-Z])/g,xc=(t,e)=>Ey(t.replace(Oy,n=>`${e}${Sy(n)}`)),My=t=>{const e=unescape(encodeURIComponent(t)),n=e.length,r=new Uint8Array(n);for(let s=0;s<n;s++)r[s]=e.codePointAt(s);return r},cs=typeof TextEncoder<"u"?new TextEncoder:null,Ay=t=>cs.encode(t),jy=cs?Ay:My;let Yo=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Yo&&Yo.decode(new Uint8Array).length===1&&(Yo=null);class vs{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const Za=()=>new vs,Ny=t=>{let e=t.cpos;for(let n=0;n<t.bufs.length;n++)e+=t.bufs[n].length;return e},Kt=t=>{const e=new Uint8Array(Ny(t));let n=0;for(let r=0;r<t.bufs.length;r++){const s=t.bufs[r];e.set(s,n),n+=s.length}return e.set(new Uint8Array(t.cbuf.buffer,0,t.cpos),n),e},Iy=(t,e)=>{const n=t.cbuf.length;n-t.cpos<e&&(t.bufs.push(new Uint8Array(t.cbuf.buffer,0,t.cpos)),t.cbuf=new Uint8Array(Cr(n,e)*2),t.cpos=0)},Re=(t,e)=>{const n=t.cbuf.length;t.cpos===n&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(n*2),t.cpos=0),t.cbuf[t.cpos++]=e},ma=Re,be=(t,e)=>{for(;e>is;)Re(t,Ti|is&e),e=Pn(e/128);Re(t,is&e)},Qa=(t,e)=>{const n=ky(e);for(n&&(e=-e),Re(t,(e>wc?Ti:0)|(n?eh:0)|wc&e),e=Pn(e/64);e>0;)Re(t,(e>is?Ti:0)|is&e),e=Pn(e/128)},ya=new Uint8Array(3e4),Ry=ya.length/3,Py=(t,e)=>{if(e.length<Ry){const n=cs.encodeInto(e,ya).written||0;be(t,n);for(let r=0;r<n;r++)Re(t,ya[r])}else rt(t,jy(e))},$y=(t,e)=>{const n=unescape(encodeURIComponent(e)),r=n.length;be(t,r);for(let s=0;s<r;s++)Re(t,n.codePointAt(s))},or=cs&&cs.encodeInto?Py:$y,el=(t,e)=>{const n=t.cbuf.length,r=t.cpos,s=Qd(n-r,e.length),i=e.length-s;t.cbuf.set(e.subarray(0,s),r),t.cpos+=s,i>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(Cr(n*2,i)),t.cbuf.set(e.subarray(s)),t.cpos=i)},rt=(t,e)=>{be(t,e.byteLength),el(t,e)},tl=(t,e)=>{Iy(t,e);const n=new DataView(t.cbuf.buffer,t.cpos,e);return t.cpos+=e,n},Dy=(t,e)=>tl(t,4).setFloat32(0,e,!1),qy=(t,e)=>tl(t,8).setFloat64(0,e,!1),Ly=(t,e)=>tl(t,8).setBigInt64(0,e,!1),Cc=new DataView(new ArrayBuffer(4)),Fy=t=>(Cc.setFloat32(0,t),Cc.getFloat32(0)===t),us=(t,e)=>{switch(typeof e){case"string":Re(t,119),or(t,e);break;case"number":Cy(e)&&_i(e)<=xy?(Re(t,125),Qa(t,e)):Fy(e)?(Re(t,124),Dy(t,e)):(Re(t,123),qy(t,e));break;case"bigint":Re(t,122),Ly(t,e);break;case"object":if(e===null)Re(t,126);else if(by(e)){Re(t,117),be(t,e.length);for(let n=0;n<e.length;n++)us(t,e[n])}else if(e instanceof Uint8Array)Re(t,116),rt(t,e);else{Re(t,118);const n=Object.keys(e);be(t,n.length);for(let r=0;r<n.length;r++){const s=n[r];or(t,s),us(t,e[s])}}break;case"boolean":Re(t,e?120:121);break;default:Re(t,127)}};class Sc extends vs{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&be(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const Tc=t=>{t.count>0&&(Qa(t.encoder,t.count===1?t.s:-t.s),t.count>1&&be(t.encoder,t.count-2))};class ki{constructor(){this.encoder=new vs,this.s=0,this.count=0}write(e){this.s===e?this.count++:(Tc(this),this.count=1,this.s=e)}toUint8Array(){return Tc(this),Kt(this.encoder)}}const Ec=t=>{if(t.count>0){const e=t.diff*2+(t.count===1?0:1);Qa(t.encoder,e),t.count>1&&be(t.encoder,t.count-2)}};class Xo{constructor(){this.encoder=new vs,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(Ec(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return Ec(this),Kt(this.encoder)}}class Uy{constructor(){this.sarr=[],this.s="",this.lensE=new ki}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new vs;return this.sarr.push(this.s),this.s="",or(e,this.sarr.join("")),el(e,this.lensE.toUint8Array()),Kt(e)}}const ur=t=>new Error(t),It=()=>{throw ur("Method unimplemented")},$n=()=>{throw ur("Unexpected case")},By=crypto.getRandomValues.bind(crypto),th=()=>By(new Uint32Array(1))[0],Hy="10000000-1000-4000-8000"+-1e11,Wy=()=>Hy.replace(/[018]/g,t=>(t^th()&15>>t/4).toString(16)),Oc=t=>new Promise(t);Promise.all.bind(Promise);const Mc=t=>t===void 0?null:t;class zy{constructor(){this.map=new Map}setItem(e,n){this.map.set(e,n)}getItem(e){return this.map.get(e)}}let nh=new zy,Ky=!0;try{typeof localStorage<"u"&&localStorage&&(nh=localStorage,Ky=!1)}catch{}const Jy=nh,Vy=Object.assign,Gy=Object.keys,Yy=(t,e)=>{for(const n in t)e(t[n],n)},Ac=t=>Gy(t).length,Xy=t=>{for(const e in t)return!1;return!0},Zy=(t,e)=>{for(const n in t)if(!e(t[n],n))return!1;return!0},Qy=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),eb=(t,e)=>t===e||Ac(t)===Ac(e)&&Zy(t,(n,r)=>(n!==void 0||Qy(e,r))&&e[r]===n),tb=Object.freeze,rh=t=>{for(const e in t){const n=t[e];(typeof n=="object"||typeof n=="function")&&rh(t[e])}return tb(t)},nl=(t,e,n=0)=>{try{for(;n<t.length;n++)t[n](...e)}finally{n<t.length&&nl(t,e,n+1)}},nb=(t,e)=>e.includes(t);var sh={};const ds=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";let Tt;const rb=()=>{if(Tt===void 0)if(ds){Tt=Nt();const t=process.argv;let e=null;for(let n=0;n<t.length;n++){const r=t[n];r[0]==="-"?(e!==null&&Tt.set(e,""),e=r):e!==null&&(Tt.set(e,r),e=null)}e!==null&&Tt.set(e,"")}else typeof location=="object"?(Tt=Nt(),(location.search||"?").slice(1).split("&").forEach(t=>{if(t.length!==0){const[e,n]=t.split("=");Tt.set(`--${xc(e,"-")}`,n),Tt.set(`-${xc(e,"-")}`,n)}})):Tt=Nt();return Tt},ba=t=>rb().has(t),Ei=t=>Mc(ds?sh[t.toUpperCase().replaceAll("-","_")]:Jy.getItem(t)),ih=t=>ba("--"+t)||Ei(t)!==null;ih("production");const sb=ds&&nb(sh.FORCE_COLOR,["true","1","2"]),ib=sb||!ba("--no-colors")&&!ih("no-color")&&(!ds||process.stdout.isTTY)&&(!ds||ba("--color")||Ei("COLORTERM")!==null||(Ei("TERM")||"").includes("color"));class ob{constructor(e,n){this.left=e,this.right=n}}const Ht=(t,e)=>new ob(t,e);typeof DOMParser<"u"&&new DOMParser;const ab=t=>my(t,(e,n)=>`${n}:${e};`).join(""),Xt=Symbol,oh=Xt(),ah=Xt(),lb=Xt(),cb=Xt(),ub=Xt(),lh=Xt(),db=Xt(),rl=Xt(),hb=Xt(),fb=t=>{var s;t.length===1&&((s=t[0])==null?void 0:s.constructor)===Function&&(t=t[0]());const e=[],n=[];let r=0;for(;r<t.length;r++){const i=t[r];if(i===void 0)break;if(i.constructor===String||i.constructor===Number)e.push(i);else if(i.constructor===Object)break}for(r>0&&n.push(e.join(""));r<t.length;r++){const i=t[r];i instanceof Symbol||n.push(i)}return n},pb={[oh]:Ht("font-weight","bold"),[ah]:Ht("font-weight","normal"),[lb]:Ht("color","blue"),[ub]:Ht("color","green"),[cb]:Ht("color","grey"),[lh]:Ht("color","red"),[db]:Ht("color","purple"),[rl]:Ht("color","orange"),[hb]:Ht("color","black")},gb=t=>{var o;t.length===1&&((o=t[0])==null?void 0:o.constructor)===Function&&(t=t[0]());const e=[],n=[],r=Nt();let s=[],i=0;for(;i<t.length;i++){const a=t[i],l=pb[a];if(l!==void 0)r.set(l.left,l.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const u=ab(r);i>0||u.length>0?(e.push("%c"+a),n.push(u)):e.push(a)}else break}}for(i>0&&(s=n,s.unshift(e.join("")));i<t.length;i++){const a=t[i];a instanceof Symbol||s.push(a)}return s},ch=ib?gb:fb,mb=(...t)=>{console.log(...ch(t)),uh.forEach(e=>e.print(t))},yb=(...t)=>{console.warn(...ch(t)),t.unshift(rl),uh.forEach(e=>e.print(t))},uh=lr(),dh=t=>({[Symbol.iterator](){return this},next:t}),bb=(t,e)=>dh(()=>{let n;do n=t.next();while(!n.done&&!e(n.value));return n}),Zo=(t,e)=>dh(()=>{const{done:n,value:r}=t.next();return{done:n,value:n?void 0:e(r)}});class _b{constructor(e,n){this.clock=e,this.len=n}}class kb{constructor(){this.clients=new Map}}const hh=(t,e,n)=>e.clients.forEach((r,s)=>{const i=t.doc.store.clients.get(s);if(i!=null){const o=i[i.length-1],a=o.id.clock+o.length;for(let l=0,u=r[l];l<r.length&&u.clock<a;u=r[++l])_h(t,i,u.clock,u.len,n)}}),vb=(t,e)=>{let n=0,r=t.length-1;for(;n<=r;){const s=Pn((n+r)/2),i=t[s],o=i.clock;if(o<=e){if(e<o+i.len)return s;n=s+1}else r=s-1}return null},fh=(t,e)=>{const n=t.clients.get(e.client);return n!==void 0&&vb(n,e.clock)!==null},ph=t=>{t.clients.forEach(e=>{e.sort((s,i)=>s.clock-i.clock);let n,r;for(n=1,r=1;n<e.length;n++){const s=e[r-1],i=e[n];s.clock+s.len>=i.clock?s.len=Cr(s.len,i.clock+i.len-s.clock):(r<n&&(e[r]=i),r++)}e.length=r})},gh=(t,e,n,r)=>{xr(t.clients,e,()=>[]).push(new _b(n,r))},wb=(t,e)=>{be(t.restEncoder,e.clients.size),cr(e.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{t.resetDsCurVal(),be(t.restEncoder,n);const s=r.length;be(t.restEncoder,s);for(let i=0;i<s;i++){const o=r[i];t.writeDsClock(o.clock),t.writeDsLen(o.len)}})},mh=th;class ws extends _y{constructor({guid:e=Wy(),collectionid:n=null,gc:r=!0,gcFilter:s=()=>!0,meta:i=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=s,this.clientID=mh(),this.guid=e,this.collectionid=n,this.share=new Map,this.store=new Nb,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=i,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=Oc(u=>{this.on("load",()=>{this.isLoaded=!0,u(this)})});const l=()=>Oc(u=>{const d=f=>{(f===void 0||f===!0)&&(this.off("sync",d),u())};this.on("sync",d)});this.on("sync",u=>{u===!1&&this.isSynced&&(this.whenSynced=l()),this.isSynced=u===void 0||u===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=l()}load(){const e=this._item;e!==null&&!this.shouldLoad&&ke(e.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(cr(this.subdocs).map(e=>e.guid))}transact(e,n=null){return ke(this,e,n)}get(e,n=Fe){const r=xr(this.share,e,()=>{const i=new n;return i._integrate(this,null),i}),s=r.constructor;if(n!==Fe&&s!==n)if(s===Fe){const i=new n;i._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=i}),i._start=r._start;for(let o=i._start;o!==null;o=o.right)o.parent=i;return i._length=r._length,this.share.set(e,i),i._integrate(this,null),i}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,Rn)}getText(e=""){return this.get(e,Ai)}getMap(e=""){return this.get(e,dr)}getXmlElement(e=""){return this.get(e,ps)}getXmlFragment(e=""){return this.get(e,hr)}toJSON(){const e={};return this.share.forEach((n,r)=>{e[r]=n.toJSON()}),e}destroy(){this.isDestroyed=!0,cr(this.subdocs).forEach(n=>n.destroy());const e=this._item;if(e!==null){this._item=null;const n=e.content;n.doc=new ws({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=e,ke(e.parent.doc,r=>{const s=n.doc;e.deleted||r.subdocsAdded.add(s),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class xb{constructor(){this.restEncoder=Za()}toUint8Array(){return Kt(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){be(this.restEncoder,e)}writeDsLen(e){be(this.restEncoder,e)}}class Cb extends xb{writeLeftID(e){be(this.restEncoder,e.client),be(this.restEncoder,e.clock)}writeRightID(e){be(this.restEncoder,e.client),be(this.restEncoder,e.clock)}writeClient(e){be(this.restEncoder,e)}writeInfo(e){ma(this.restEncoder,e)}writeString(e){or(this.restEncoder,e)}writeParentInfo(e){be(this.restEncoder,e?1:0)}writeTypeRef(e){be(this.restEncoder,e)}writeLen(e){be(this.restEncoder,e)}writeAny(e){us(this.restEncoder,e)}writeBuf(e){rt(this.restEncoder,e)}writeJSON(e){or(this.restEncoder,JSON.stringify(e))}writeKey(e){or(this.restEncoder,e)}}class Sb{constructor(){this.restEncoder=Za(),this.dsCurrVal=0}toUint8Array(){return Kt(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const n=e-this.dsCurrVal;this.dsCurrVal=e,be(this.restEncoder,n)}writeDsLen(e){e===0&&$n(),be(this.restEncoder,e-1),this.dsCurrVal+=e}}class Tb extends Sb{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Xo,this.clientEncoder=new ki,this.leftClockEncoder=new Xo,this.rightClockEncoder=new Xo,this.infoEncoder=new Sc(ma),this.stringEncoder=new Uy,this.parentInfoEncoder=new Sc(ma),this.typeRefEncoder=new ki,this.lenEncoder=new ki}toUint8Array(){const e=Za();return be(e,0),rt(e,this.keyClockEncoder.toUint8Array()),rt(e,this.clientEncoder.toUint8Array()),rt(e,this.leftClockEncoder.toUint8Array()),rt(e,this.rightClockEncoder.toUint8Array()),rt(e,Kt(this.infoEncoder)),rt(e,this.stringEncoder.toUint8Array()),rt(e,Kt(this.parentInfoEncoder)),rt(e,this.typeRefEncoder.toUint8Array()),rt(e,this.lenEncoder.toUint8Array()),el(e,Kt(this.restEncoder)),Kt(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){us(this.restEncoder,e)}writeBuf(e){rt(this.restEncoder,e)}writeJSON(e){us(this.restEncoder,e)}writeKey(e){const n=this.keyMap.get(e);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(n)}}const Eb=(t,e,n,r)=>{r=Cr(r,e[0].id.clock);const s=Jt(e,r);be(t.restEncoder,e.length-s),t.writeClient(n),be(t.restEncoder,r);const i=e[s];i.write(t,r-i.id.clock);for(let o=s+1;o<e.length;o++)e[o].write(t,0)},Ob=(t,e,n)=>{const r=new Map;n.forEach((s,i)=>{et(e,i)>s&&r.set(i,s)}),sl(e).forEach((s,i)=>{n.has(i)||r.set(i,0)}),be(t.restEncoder,r.size),cr(r.entries()).sort((s,i)=>i[0]-s[0]).forEach(([s,i])=>{Eb(t,e.clients.get(s),s,i)})},Mb=(t,e)=>Ob(t,e.doc.store,e.beforeState);class Ab{constructor(){this.l=[]}}const jc=()=>new Ab,Nc=(t,e)=>t.l.push(e),Ic=(t,e)=>{const n=t.l,r=n.length;t.l=n.filter(s=>e!==s),r===t.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},yh=(t,e,n)=>nl(t.l,[e,n]);class vi{constructor(e,n){this.client=e,this.clock=n}}const Zs=(t,e)=>t===e||t!==null&&e!==null&&t.client===e.client&&t.clock===e.clock,Se=(t,e)=>new vi(t,e),jb=t=>{for(const[e,n]of t.doc.share.entries())if(n===t)return e;throw $n()},sr=(t,e)=>e===void 0?!t.deleted:e.sv.has(t.id.client)&&(e.sv.get(t.id.client)||0)>t.id.clock&&!fh(e.ds,t.id),_a=(t,e)=>{const n=xr(t.meta,_a,lr),r=t.doc.store;n.has(e)||(e.sv.forEach((s,i)=>{s<et(r,i)&&dn(t,Se(i,s))}),hh(t,e.ds,s=>{}),n.add(e))};class Nb{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const sl=t=>{const e=new Map;return t.clients.forEach((n,r)=>{const s=n[n.length-1];e.set(r,s.id.clock+s.length)}),e},et=(t,e)=>{const n=t.clients.get(e);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},bh=(t,e)=>{let n=t.clients.get(e.id.client);if(n===void 0)n=[],t.clients.set(e.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==e.id.clock)throw $n()}n.push(e)},Jt=(t,e)=>{let n=0,r=t.length-1,s=t[r],i=s.id.clock;if(i===e)return r;let o=Pn(e/(i+s.length-1)*r);for(;n<=r;){if(s=t[o],i=s.id.clock,i<=e){if(e<i+s.length)return o;n=o+1}else r=o-1;o=Pn((n+r)/2)}throw $n()},Ib=(t,e)=>{const n=t.clients.get(e.client);return n[Jt(n,e.clock)]},Qo=Ib,ka=(t,e,n)=>{const r=Jt(e,n),s=e[r];return s.id.clock<n&&s instanceof ze?(e.splice(r+1,0,qh(t,s,n-s.id.clock)),r+1):r},dn=(t,e)=>{const n=t.doc.store.clients.get(e.client);return n[ka(t,n,e.clock)]},Rc=(t,e,n)=>{const r=e.clients.get(n.client),s=Jt(r,n.clock),i=r[s];return n.clock!==i.id.clock+i.length-1&&i.constructor!==an&&r.splice(s+1,0,qh(t,i,n.clock-i.id.clock+1)),i},Rb=(t,e,n)=>{const r=t.clients.get(e.id.client);r[Jt(r,e.id.clock)]=n},_h=(t,e,n,r,s)=>{if(r===0)return;const i=n+r;let o=ka(t,e,n),a;do a=e[o++],i<a.id.clock+a.length&&ka(t,e,i),s(a);while(o<e.length&&e[o].id.clock<i)};class Pb{constructor(e,n,r){this.doc=e,this.deleteSet=new kb,this.beforeState=sl(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const Pc=(t,e)=>e.deleteSet.clients.size===0&&!yy(e.afterState,(n,r)=>e.beforeState.get(r)!==n)?!1:(ph(e.deleteSet),Mb(t,e),wb(t,e.deleteSet),!0),$c=(t,e,n)=>{const r=e._item;(r===null||r.id.clock<(t.beforeState.get(r.id.client)||0)&&!r.deleted)&&xr(t.changed,e,lr).add(n)},wi=(t,e)=>{let n=t[e],r=t[e-1],s=e;for(;s>0;n=r,r=t[--s-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof ze&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const i=e-s;return i&&t.splice(e+1-i,i),i},$b=(t,e,n)=>{for(const[r,s]of t.clients.entries()){const i=e.clients.get(r);for(let o=s.length-1;o>=0;o--){const a=s[o],l=a.clock+a.len;for(let u=Jt(i,a.clock),d=i[u];u<i.length&&d.id.clock<l;d=i[++u]){const f=i[u];if(a.clock+a.len<=f.id.clock)break;f instanceof ze&&f.deleted&&!f.keep&&n(f)&&f.gc(e,!1)}}}},Db=(t,e)=>{t.clients.forEach((n,r)=>{const s=e.clients.get(r);for(let i=n.length-1;i>=0;i--){const o=n[i],a=Qd(s.length-1,1+Jt(s,o.clock+o.len-1));for(let l=a,u=s[l];l>0&&u.id.clock>=o.clock;u=s[l])l-=1+wi(s,l)}})},kh=(t,e)=>{if(e<t.length){const n=t[e],r=n.doc,s=r.store,i=n.deleteSet,o=n._mergeStructs;try{ph(i),n.afterState=sl(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((l,u)=>a.push(()=>{(u._item===null||!u._item.deleted)&&u._callObserver(n,l)})),a.push(()=>{n.changedParentTypes.forEach((l,u)=>{u._dEH.l.length>0&&(u._item===null||!u._item.deleted)&&(l=l.filter(d=>d.target._item===null||!d.target._item.deleted),l.forEach(d=>{d.currentTarget=u,d._path=null}),l.sort((d,f)=>d.path.length-f.path.length),yh(u._dEH,l,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),nl(a,[]),n._needFormattingCleanup&&Vb(n)}finally{r.gc&&$b(i,s,r.gcFilter),Db(i,s),n.afterState.forEach((d,f)=>{const h=n.beforeState.get(f)||0;if(h!==d){const p=s.clients.get(f),y=Cr(Jt(p,h),1);for(let b=p.length-1;b>=y;)b-=1+wi(p,b)}});for(let d=o.length-1;d>=0;d--){const{client:f,clock:h}=o[d].id,p=s.clients.get(f),y=Jt(p,h);y+1<p.length&&wi(p,y+1)>1||y>0&&wi(p,y)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(mb(rl,oh,"[yjs] ",ah,lh,"Changed the client-id because another client seems to be using it."),r.clientID=mh()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const d=new Cb;Pc(d,n)&&r.emit("update",[d.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const d=new Tb;Pc(d,n)&&r.emit("updateV2",[d.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:l,subdocsRemoved:u}=n;(a.size>0||u.size>0||l.size>0)&&(a.forEach(d=>{d.clientID=r.clientID,d.collectionid==null&&(d.collectionid=r.collectionid),r.subdocs.add(d)}),u.forEach(d=>r.subdocs.delete(d)),r.emit("subdocs",[{loaded:l,added:a,removed:u},r,n]),u.forEach(d=>d.destroy())),t.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,t])):kh(t,e+1)}}},ke=(t,e,n=null,r=!0)=>{const s=t._transactionCleanups;let i=!1,o=null;t._transaction===null&&(i=!0,t._transaction=new Pb(t,n,r),s.push(t._transaction),s.length===1&&t.emit("beforeAllTransactions",[t]),t.emit("beforeTransaction",[t._transaction,t]));try{o=e(t._transaction)}finally{if(i){const a=t._transaction===s[0];t._transaction=null,a&&kh(s,0)}}return o},Dc="You must not compute changes after the event-handler fired.";class Ki{constructor(e,n){this.target=e,this.currentTarget=e,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=qb(this.currentTarget,this.target))}deletes(e){return fh(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw ur(Dc);const e=new Map,n=this.target;this.transaction.changed.get(n).forEach(s=>{if(s!==null){const i=n._map.get(s);let o,a;if(this.adds(i)){let l=i.left;for(;l!==null&&this.adds(l);)l=l.left;if(this.deletes(i))if(l!==null&&this.deletes(l))o="delete",a=Jo(l.content.getContent());else return;else l!==null&&this.deletes(l)?(o="update",a=Jo(l.content.getContent())):(o="add",a=void 0)}else if(this.deletes(i))o="delete",a=Jo(i.content.getContent());else return;e.set(s,{action:o,oldValue:a})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw ur(Dc);const n=this.target,r=lr(),s=lr(),i=[];if(e={added:r,deleted:s,delta:i,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const l=()=>{a&&i.push(a)};for(let u=n._start;u!==null;u=u.right)u.deleted?this.deletes(u)&&!this.adds(u)&&((a===null||a.delete===void 0)&&(l(),a={delete:0}),a.delete+=u.length,s.add(u)):this.adds(u)?((a===null||a.insert===void 0)&&(l(),a={insert:[]}),a.insert=a.insert.concat(u.content.getContent()),r.add(u)):((a===null||a.retain===void 0)&&(l(),a={retain:0}),a.retain+=u.length);a!==null&&a.retain===void 0&&l()}this._changes=e}return e}}const qb=(t,e)=>{const n=[];for(;e._item!==null&&e!==t;){if(e._item.parentSub!==null)n.unshift(e._item.parentSub);else{let r=0,s=e._item.parent._start;for(;s!==e._item&&s!==null;)!s.deleted&&s.countable&&(r+=s.length),s=s.right;n.unshift(r)}e=e._item.parent}return n},Je=()=>{yb("Invalid access: Add Yjs type to a document before reading data.")},vh=80;let il=0;class Lb{constructor(e,n){e.marker=!0,this.p=e,this.index=n,this.timestamp=il++}}const Fb=t=>{t.timestamp=il++},wh=(t,e,n)=>{t.p.marker=!1,t.p=e,e.marker=!0,t.index=n,t.timestamp=il++},Ub=(t,e,n)=>{if(t.length>=vh){const r=t.reduce((s,i)=>s.timestamp<i.timestamp?s:i);return wh(r,e,n),r}else{const r=new Lb(e,n);return t.push(r),r}},Ji=(t,e)=>{if(t._start===null||e===0||t._searchMarker===null)return null;const n=t._searchMarker.length===0?null:t._searchMarker.reduce((i,o)=>_i(e-i.index)<_i(e-o.index)?i:o);let r=t._start,s=0;for(n!==null&&(r=n.p,s=n.index,Fb(n));r.right!==null&&s<e;){if(!r.deleted&&r.countable){if(e<s+r.length)break;s+=r.length}r=r.right}for(;r.left!==null&&s>e;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);return n!==null&&_i(n.index-s)<r.parent.length/vh?(wh(n,r,s),n):Ub(t._searchMarker,r,s)},hs=(t,e,n)=>{for(let r=t.length-1;r>=0;r--){const s=t[r];if(n>0){let i=s.p;for(i.marker=!1;i&&(i.deleted||!i.countable);)i=i.left,i&&!i.deleted&&i.countable&&(s.index-=i.length);if(i===null||i.marker===!0){t.splice(r,1);continue}s.p=i,i.marker=!0}(e<s.index||n>0&&e===s.index)&&(s.index=Cr(e,s.index+n))}},Vi=(t,e,n)=>{const r=t,s=e.changedParentTypes;for(;xr(s,t,()=>[]).push(n),t._item!==null;)t=t._item.parent;yh(r._eH,n,e)};class Fe{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=jc(),this._dEH=jc(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,n){this.doc=e,this._item=n}_copy(){throw It()}clone(){throw It()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,n){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){Nc(this._eH,e)}observeDeep(e){Nc(this._dEH,e)}unobserve(e){Ic(this._eH,e)}unobserveDeep(e){Ic(this._dEH,e)}toJSON(){}}const xh=(t,e,n)=>{t.doc??Je(),e<0&&(e=t._length+e),n<0&&(n=t._length+n);let r=n-e;const s=[];let i=t._start;for(;i!==null&&r>0;){if(i.countable&&!i.deleted){const o=i.content.getContent();if(o.length<=e)e-=o.length;else{for(let a=e;a<o.length&&r>0;a++)s.push(o[a]),r--;e=0}}i=i.right}return s},Ch=t=>{t.doc??Je();const e=[];let n=t._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let s=0;s<r.length;s++)e.push(r[s])}n=n.right}return e},fs=(t,e)=>{let n=0,r=t._start;for(t.doc??Je();r!==null;){if(r.countable&&!r.deleted){const s=r.content.getContent();for(let i=0;i<s.length;i++)e(s[i],n++,t)}r=r.right}},Sh=(t,e)=>{const n=[];return fs(t,(r,s)=>{n.push(e(r,s,t))}),n},Bb=t=>{let e=t._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};n=e.content.getContent(),r=0,e=e.right}const s=n[r++];return n.length<=r&&(n=null),{done:!1,value:s}}}},Th=(t,e)=>{t.doc??Je();const n=Ji(t,e);let r=t._start;for(n!==null&&(r=n.p,e-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},Oi=(t,e,n,r)=>{let s=n;const i=t.doc,o=i.clientID,a=i.store,l=n===null?e._start:n.right;let u=[];const d=()=>{u.length>0&&(s=new ze(Se(o,et(a,o)),s,s&&s.lastId,l,l&&l.id,e,null,new fr(u)),s.integrate(t,0),u=[])};r.forEach(f=>{if(f===null)u.push(f);else switch(f.constructor){case Number:case Object:case Boolean:case Array:case String:u.push(f);break;default:switch(d(),f.constructor){case Uint8Array:case ArrayBuffer:s=new ze(Se(o,et(a,o)),s,s&&s.lastId,l,l&&l.id,e,null,new Gi(new Uint8Array(f))),s.integrate(t,0);break;case ws:s=new ze(Se(o,et(a,o)),s,s&&s.lastId,l,l&&l.id,e,null,new Yi(f)),s.integrate(t,0);break;default:if(f instanceof Fe)s=new ze(Se(o,et(a,o)),s,s&&s.lastId,l,l&&l.id,e,null,new kn(f)),s.integrate(t,0);else throw new Error("Unexpected content type in insert operation")}}}),d()},Eh=()=>ur("Length exceeded!"),Oh=(t,e,n,r)=>{if(n>e._length)throw Eh();if(n===0)return e._searchMarker&&hs(e._searchMarker,n,r.length),Oi(t,e,null,r);const s=n,i=Ji(e,n);let o=e._start;for(i!==null&&(o=i.p,n-=i.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&dn(t,Se(o.id.client,o.id.clock+n));break}n-=o.length}return e._searchMarker&&hs(e._searchMarker,s,r.length),Oi(t,e,o,r)},Hb=(t,e,n)=>{let s=(e._searchMarker||[]).reduce((i,o)=>o.index>i.index?o:i,{index:0,p:e._start}).p;if(s)for(;s.right;)s=s.right;return Oi(t,e,s,n)},Mh=(t,e,n,r)=>{if(r===0)return;const s=n,i=r,o=Ji(e,n);let a=e._start;for(o!==null&&(a=o.p,n-=o.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&dn(t,Se(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&dn(t,Se(a.id.client,a.id.clock+r)),a.delete(t),r-=a.length),a=a.right;if(r>0)throw Eh();e._searchMarker&&hs(e._searchMarker,s,-i+r)},Mi=(t,e,n)=>{const r=e._map.get(n);r!==void 0&&r.delete(t)},ol=(t,e,n,r)=>{const s=e._map.get(n)||null,i=t.doc,o=i.clientID;let a;if(r==null)a=new fr([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:a=new fr([r]);break;case Uint8Array:a=new Gi(r);break;case ws:a=new Yi(r);break;default:if(r instanceof Fe)a=new kn(r);else throw new Error("Unexpected content type")}new ze(Se(o,et(i.store,o)),s,s&&s.lastId,null,null,e,n,a).integrate(t,0)},al=(t,e)=>{t.doc??Je();const n=t._map.get(e);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},Ah=t=>{const e={};return t.doc??Je(),t._map.forEach((n,r)=>{n.deleted||(e[r]=n.content.getContent()[n.length-1])}),e},jh=(t,e)=>{t.doc??Je();const n=t._map.get(e);return n!==void 0&&!n.deleted},Wb=(t,e)=>{const n={};return t._map.forEach((r,s)=>{let i=r;for(;i!==null&&(!e.sv.has(i.id.client)||i.id.clock>=(e.sv.get(i.id.client)||0));)i=i.left;i!==null&&sr(i,e)&&(n[s]=i.content.getContent()[i.length-1])}),n},Qs=t=>(t.doc??Je(),bb(t._map.entries(),e=>!e[1].deleted));class Nh extends Ki{}class Rn extends Fe{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const n=new Rn;return n.push(e),n}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Rn}clone(){const e=new Rn;return e.insert(0,this.toArray().map(n=>n instanceof Fe?n.clone():n)),e}get length(){return this.doc??Je(),this._length}_callObserver(e,n){super._callObserver(e,n),Vi(this,e,new Nh(this,e))}insert(e,n){this.doc!==null?ke(this.doc,r=>{Oh(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}push(e){this.doc!==null?ke(this.doc,n=>{Hb(n,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,n=1){this.doc!==null?ke(this.doc,r=>{Mh(r,this,e,n)}):this._prelimContent.splice(e,n)}get(e){return Th(this,e)}toArray(){return Ch(this)}slice(e=0,n=this.length){return xh(this,e,n)}toJSON(){return this.map(e=>e instanceof Fe?e.toJSON():e)}map(e){return Sh(this,e)}forEach(e){fs(this,e)}[Symbol.iterator](){return Bb(this)}_write(e){e.writeTypeRef(e_)}}class zb extends Ki{constructor(e,n,r){super(e,n),this.keysChanged=r}}class dr extends Fe{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,n){super._integrate(e,n),this._prelimContent.forEach((r,s)=>{this.set(s,r)}),this._prelimContent=null}_copy(){return new dr}clone(){const e=new dr;return this.forEach((n,r)=>{e.set(r,n instanceof Fe?n.clone():n)}),e}_callObserver(e,n){Vi(this,e,new zb(this,e,n))}toJSON(){this.doc??Je();const e={};return this._map.forEach((n,r)=>{if(!n.deleted){const s=n.content.getContent()[n.length-1];e[r]=s instanceof Fe?s.toJSON():s}}),e}get size(){return[...Qs(this)].length}keys(){return Zo(Qs(this),e=>e[0])}values(){return Zo(Qs(this),e=>e[1].content.getContent()[e[1].length-1])}entries(){return Zo(Qs(this),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this.doc??Je(),this._map.forEach((n,r)=>{n.deleted||e(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?ke(this.doc,n=>{Mi(n,this,e)}):this._prelimContent.delete(e)}set(e,n){return this.doc!==null?ke(this.doc,r=>{ol(r,this,e,n)}):this._prelimContent.set(e,n),n}get(e){return al(this,e)}has(e){return jh(this,e)}clear(){this.doc!==null?ke(this.doc,e=>{this.forEach(function(n,r,s){Mi(e,s,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(t_)}}const cn=(t,e)=>t===e||typeof t=="object"&&typeof e=="object"&&t&&e&&eb(t,e);class va{constructor(e,n,r,s){this.left=e,this.right=n,this.index=r,this.currentAttributes=s}forward(){switch(this.right===null&&$n(),this.right.content.constructor){case Pe:this.right.deleted||Sr(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const qc=(t,e,n)=>{for(;e.right!==null&&n>0;){switch(e.right.content.constructor){case Pe:e.right.deleted||Sr(e.currentAttributes,e.right.content);break;default:e.right.deleted||(n<e.right.length&&dn(t,Se(e.right.id.client,e.right.id.clock+n)),e.index+=e.right.length,n-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},ei=(t,e,n,r)=>{const s=new Map,i=r?Ji(e,n):null;if(i){const o=new va(i.p.left,i.p,i.index,s);return qc(t,o,n-i.index)}else{const o=new va(null,e._start,0,s);return qc(t,o,n)}},Ih=(t,e,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===Pe&&cn(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const s=t.doc,i=s.clientID;r.forEach((o,a)=>{const l=n.left,u=n.right,d=new ze(Se(i,et(s.store,i)),l,l&&l.lastId,u,u&&u.id,e,null,new Pe(a,o));d.integrate(t,0),n.right=d,n.forward()})},Sr=(t,e)=>{const{key:n,value:r}=e;r===null?t.delete(n):t.set(n,r)},Rh=(t,e)=>{for(;t.right!==null;){if(!(t.right.deleted||t.right.content.constructor===Pe&&cn(e[t.right.content.key]??null,t.right.content.value)))break;t.forward()}},Ph=(t,e,n,r)=>{const s=t.doc,i=s.clientID,o=new Map;for(const a in r){const l=r[a],u=n.currentAttributes.get(a)??null;if(!cn(u,l)){o.set(a,u);const{left:d,right:f}=n;n.right=new ze(Se(i,et(s.store,i)),d,d&&d.lastId,f,f&&f.id,e,null,new Pe(a,l)),n.right.integrate(t,0),n.forward()}}return o},ea=(t,e,n,r,s)=>{n.currentAttributes.forEach((h,p)=>{s[p]===void 0&&(s[p]=null)});const i=t.doc,o=i.clientID;Rh(n,s);const a=Ph(t,e,n,s),l=r.constructor===String?new Vt(r):r instanceof Fe?new kn(r):new Tr(r);let{left:u,right:d,index:f}=n;e._searchMarker&&hs(e._searchMarker,n.index,l.getLength()),d=new ze(Se(o,et(i.store,o)),u,u&&u.lastId,d,d&&d.id,e,null,l),d.integrate(t,0),n.right=d,n.index=f,n.forward(),Ih(t,e,n,a)},Lc=(t,e,n,r,s)=>{const i=t.doc,o=i.clientID;Rh(n,s);const a=Ph(t,e,n,s);e:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===Pe));){if(!n.right.deleted)switch(n.right.content.constructor){case Pe:{const{key:l,value:u}=n.right.content,d=s[l];if(d!==void 0){if(cn(d,u))a.delete(l);else{if(r===0)break e;a.set(l,u)}n.right.delete(t)}else n.currentAttributes.set(l,u);break}default:r<n.right.length&&dn(t,Se(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let l="";for(;r>0;r--)l+=`
`;n.right=new ze(Se(o,et(i.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,e,null,new Vt(l)),n.right.integrate(t,0),n.forward()}Ih(t,e,n,a)},$h=(t,e,n,r,s)=>{let i=e;const o=Nt();for(;i&&(!i.countable||i.deleted);){if(!i.deleted&&i.content.constructor===Pe){const u=i.content;o.set(u.key,u)}i=i.right}let a=0,l=!1;for(;e!==i;){if(n===e&&(l=!0),!e.deleted){const u=e.content;switch(u.constructor){case Pe:{const{key:d,value:f}=u,h=r.get(d)??null;(o.get(d)!==u||h===f)&&(e.delete(t),a++,!l&&(s.get(d)??null)===f&&h!==f&&(h===null?s.delete(d):s.set(d,h))),!l&&!e.deleted&&Sr(s,u);break}}}e=e.right}return a},Kb=(t,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const n=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===Pe){const r=e.content.key;n.has(r)?e.delete(t):n.add(r)}e=e.left}},Jb=t=>{let e=0;return ke(t.doc,n=>{let r=t._start,s=t._start,i=Nt();const o=ga(i);for(;s;){if(s.deleted===!1)switch(s.content.constructor){case Pe:Sr(o,s.content);break;default:e+=$h(n,r,s,i,o),i=ga(o),r=s;break}s=s.right}}),e},Vb=t=>{const e=new Set,n=t.doc;for(const[r,s]of t.afterState.entries()){const i=t.beforeState.get(r)||0;s!==i&&_h(t,n.store.clients.get(r),i,s,o=>{!o.deleted&&o.content.constructor===Pe&&o.constructor!==an&&e.add(o.parent)})}ke(n,r=>{hh(t,t.deleteSet,s=>{if(s instanceof an||!s.parent._hasFormatting||e.has(s.parent))return;const i=s.parent;s.content.constructor===Pe?e.add(i):Kb(r,s)});for(const s of e)Jb(s)})},Fc=(t,e,n)=>{const r=n,s=ga(e.currentAttributes),i=e.right;for(;n>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case kn:case Tr:case Vt:n<e.right.length&&dn(t,Se(e.right.id.client,e.right.id.clock+n)),n-=e.right.length,e.right.delete(t);break}e.forward()}i&&$h(t,i,e.right,s,e.currentAttributes);const o=(e.left||e.right).parent;return o._searchMarker&&hs(o._searchMarker,e.index,-r+n),e};class Gb extends Ki{constructor(e,n,r){super(e,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(s=>{s===null?this.childListChanged=!0:this.keysChanged.add(s)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,n=[];ke(e,r=>{const s=new Map,i=new Map;let o=this.target._start,a=null;const l={};let u="",d=0,f=0;const h=()=>{if(a!==null){let p=null;switch(a){case"delete":f>0&&(p={delete:f}),f=0;break;case"insert":(typeof u=="object"||u.length>0)&&(p={insert:u},s.size>0&&(p.attributes={},s.forEach((y,b)=>{y!==null&&(p.attributes[b]=y)}))),u="";break;case"retain":d>0&&(p={retain:d},Xy(l)||(p.attributes=Vy({},l))),d=0;break}p&&n.push(p),a=null}};for(;o!==null;){switch(o.content.constructor){case kn:case Tr:this.adds(o)?this.deletes(o)||(h(),a="insert",u=o.content.getContent()[0],h()):this.deletes(o)?(a!=="delete"&&(h(),a="delete"),f+=1):o.deleted||(a!=="retain"&&(h(),a="retain"),d+=1);break;case Vt:this.adds(o)?this.deletes(o)||(a!=="insert"&&(h(),a="insert"),u+=o.content.str):this.deletes(o)?(a!=="delete"&&(h(),a="delete"),f+=o.length):o.deleted||(a!=="retain"&&(h(),a="retain"),d+=o.length);break;case Pe:{const{key:p,value:y}=o.content;if(this.adds(o)){if(!this.deletes(o)){const b=s.get(p)??null;cn(b,y)?y!==null&&o.delete(r):(a==="retain"&&h(),cn(y,i.get(p)??null)?delete l[p]:l[p]=y)}}else if(this.deletes(o)){i.set(p,y);const b=s.get(p)??null;cn(b,y)||(a==="retain"&&h(),l[p]=b)}else if(!o.deleted){i.set(p,y);const b=l[p];b!==void 0&&(cn(b,y)?b!==null&&o.delete(r):(a==="retain"&&h(),y===null?delete l[p]:l[p]=y))}o.deleted||(a==="insert"&&h(),Sr(s,o.content));break}}o=o.right}for(h();n.length>0;){const p=n[n.length-1];if(p.retain!==void 0&&p.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class Ai extends Fe{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??Je(),this._length}_integrate(e,n){super._integrate(e,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new Ai}clone(){const e=new Ai;return e.applyDelta(this.toDelta()),e}_callObserver(e,n){super._callObserver(e,n);const r=new Gb(this,e,n);Vi(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){this.doc??Je();let e="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Vt&&(e+=n.content.str),n=n.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:n=!0}={}){this.doc!==null?ke(this.doc,r=>{const s=new va(null,this._start,0,new Map);for(let i=0;i<e.length;i++){const o=e[i];if(o.insert!==void 0){const a=!n&&typeof o.insert=="string"&&i===e.length-1&&s.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&ea(r,this,s,a,o.attributes||{})}else o.retain!==void 0?Lc(r,this,s,o.retain,o.attributes||{}):o.delete!==void 0&&Fc(r,s,o.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,n,r){this.doc??Je();const s=[],i=new Map,o=this.doc;let a="",l=this._start;function u(){if(a.length>0){const f={};let h=!1;i.forEach((y,b)=>{h=!0,f[b]=y});const p={insert:a};h&&(p.attributes=f),s.push(p),a=""}}const d=()=>{for(;l!==null;){if(sr(l,e)||n!==void 0&&sr(l,n))switch(l.content.constructor){case Vt:{const f=i.get("ychange");e!==void 0&&!sr(l,e)?(f===void 0||f.user!==l.id.client||f.type!=="removed")&&(u(),i.set("ychange",r?r("removed",l.id):{type:"removed"})):n!==void 0&&!sr(l,n)?(f===void 0||f.user!==l.id.client||f.type!=="added")&&(u(),i.set("ychange",r?r("added",l.id):{type:"added"})):f!==void 0&&(u(),i.delete("ychange")),a+=l.content.str;break}case kn:case Tr:{u();const f={insert:l.content.getContent()[0]};if(i.size>0){const h={};f.attributes=h,i.forEach((p,y)=>{h[y]=p})}s.push(f);break}case Pe:sr(l,e)&&(u(),Sr(i,l.content));break}l=l.right}u()};return e||n?ke(o,f=>{e&&_a(f,e),n&&_a(f,n),d()},"cleanup"):d(),s}insert(e,n,r){if(n.length<=0)return;const s=this.doc;s!==null?ke(s,i=>{const o=ei(i,this,e,!r);r||(r={},o.currentAttributes.forEach((a,l)=>{r[l]=a})),ea(i,this,o,n,r)}):this._pending.push(()=>this.insert(e,n,r))}insertEmbed(e,n,r){const s=this.doc;s!==null?ke(s,i=>{const o=ei(i,this,e,!r);ea(i,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(e,n,r||{}))}delete(e,n){if(n===0)return;const r=this.doc;r!==null?ke(r,s=>{Fc(s,ei(s,this,e,!0),n)}):this._pending.push(()=>this.delete(e,n))}format(e,n,r){if(n===0)return;const s=this.doc;s!==null?ke(s,i=>{const o=ei(i,this,e,!1);o.right!==null&&Lc(i,this,o,n,r)}):this._pending.push(()=>this.format(e,n,r))}removeAttribute(e){this.doc!==null?ke(this.doc,n=>{Mi(n,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,n){this.doc!==null?ke(this.doc,r=>{ol(r,this,e,n)}):this._pending.push(()=>this.setAttribute(e,n))}getAttribute(e){return al(this,e)}getAttributes(){return Ah(this)}_write(e){e.writeTypeRef(n_)}}class ta{constructor(e,n=()=>!0){this._filter=n,this._root=e,this._currentNode=e._start,this._firstCall=!0,e.doc??Je()}[Symbol.iterator](){return this}next(){let e=this._currentNode,n=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(n)))do if(n=e.content.type,!e.deleted&&(n.constructor===ps||n.constructor===hr)&&n._start!==null)e=n._start;else for(;e!==null;){const r=e.next;if(r!==null){e=r;break}else e.parent===this._root?e=null:e=e.parent._item}while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class hr extends Fe{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new hr}clone(){const e=new hr;return e.insert(0,this.toArray().map(n=>n instanceof Fe?n.clone():n)),e}get length(){return this.doc??Je(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new ta(this,e)}querySelector(e){e=e.toUpperCase();const r=new ta(this,s=>s.nodeName&&s.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),cr(new ta(this,n=>n.nodeName&&n.nodeName.toUpperCase()===e))}_callObserver(e,n){Vi(this,e,new Yb(this,n,e))}toString(){return Sh(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,n={},r){const s=e.createDocumentFragment();return r!==void 0&&r._createAssociation(s,this),fs(this,i=>{s.insertBefore(i.toDOM(e,n,r),null)}),s}insert(e,n){this.doc!==null?ke(this.doc,r=>{Oh(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}insertAfter(e,n){if(this.doc!==null)ke(this.doc,r=>{const s=e&&e instanceof Fe?e._item:e;Oi(r,this,s,n)});else{const r=this._prelimContent,s=e===null?0:r.findIndex(i=>i===e)+1;if(s===0&&e!==null)throw ur("Reference item not found");r.splice(s,0,...n)}}delete(e,n=1){this.doc!==null?ke(this.doc,r=>{Mh(r,this,e,n)}):this._prelimContent.splice(e,n)}toArray(){return Ch(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return Th(this,e)}slice(e=0,n=this.length){return xh(this,e,n)}forEach(e){fs(this,e)}_write(e){e.writeTypeRef(s_)}}class ps extends hr{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,n){super._integrate(e,n),this._prelimAttrs.forEach((r,s)=>{this.setAttribute(s,r)}),this._prelimAttrs=null}_copy(){return new ps(this.nodeName)}clone(){const e=new ps(this.nodeName),n=this.getAttributes();return Yy(n,(r,s)=>{typeof r=="string"&&e.setAttribute(s,r)}),e.insert(0,this.toArray().map(r=>r instanceof Fe?r.clone():r)),e}toString(){const e=this.getAttributes(),n=[],r=[];for(const a in e)r.push(a);r.sort();const s=r.length;for(let a=0;a<s;a++){const l=r[a];n.push(l+'="'+e[l]+'"')}const i=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${i}${o}>${super.toString()}</${i}>`}removeAttribute(e){this.doc!==null?ke(this.doc,n=>{Mi(n,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,n){this.doc!==null?ke(this.doc,r=>{ol(r,this,e,n)}):this._prelimAttrs.set(e,n)}getAttribute(e){return al(this,e)}hasAttribute(e){return jh(this,e)}getAttributes(e){return e?Wb(this,e):Ah(this)}toDOM(e=document,n={},r){const s=e.createElement(this.nodeName),i=this.getAttributes();for(const o in i){const a=i[o];typeof a=="string"&&s.setAttribute(o,a)}return fs(this,o=>{s.appendChild(o.toDOM(e,n,r))}),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(r_),e.writeKey(this.nodeName)}}class Yb extends Ki{constructor(e,n,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(s=>{s===null?this.childListChanged=!0:this.attributesChanged.add(s)})}}class Dh{constructor(e,n){this.id=e,this.length=n}get deleted(){throw It()}mergeWith(e){return!1}write(e,n,r){throw It()}integrate(e,n){throw It()}}const Xb=0;class an extends Dh{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){n>0&&(this.id.clock+=n,this.length-=n),bh(e.doc.store,this)}write(e,n){e.writeInfo(Xb),e.writeLen(this.length-n)}getMissing(e,n){return null}}class Gi{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Gi(this.content)}splice(e){throw It()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeBuf(this.content)}getRef(){return 3}}class ji{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new ji(this.len)}splice(e){const n=new ji(this.len-e);return this.len=e,n}mergeWith(e){return this.len+=e.len,!0}integrate(e,n){gh(e.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(e){}gc(e){}write(e,n){e.writeLen(this.len-n)}getRef(){return 1}}const Zb=(t,e)=>new ws({guid:t,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class Yi{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const n={};this.opts=n,e.gc||(n.gc=!1),e.autoLoad&&(n.autoLoad=!0),e.meta!==null&&(n.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Yi(Zb(this.doc.guid,this.opts))}splice(e){throw It()}mergeWith(e){return!1}integrate(e,n){this.doc._item=n,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,n){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}class Tr{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Tr(this.embed)}splice(e){throw It()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeJSON(this.embed)}getRef(){return 5}}class Pe{constructor(e,n){this.key=e,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Pe(this.key,this.value)}splice(e){throw It()}mergeWith(e){return!1}integrate(e,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,n){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const Qb=Ei("node_env")==="development";class fr{constructor(e){this.arr=e,Qb&&rh(e)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new fr(this.arr)}splice(e){const n=new fr(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let s=n;s<r;s++){const i=this.arr[s];e.writeAny(i)}}getRef(){return 8}}class Vt{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Vt(this.str)}splice(e){const n=new Vt(this.str.slice(e));this.str=this.str.slice(0,e);const r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"",n.str=""+n.str.slice(1)),n}mergeWith(e){return this.str+=e.str,!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const e_=0,t_=1,n_=2,r_=3,s_=4;class kn{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new kn(this.type._copy())}splice(e){throw It()}mergeWith(e){return!1}integrate(e,n){this.type._integrate(e.doc,n)}delete(e){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(e.beforeState.get(n.id.client)||0)&&e._mergeStructs.push(n):n.delete(e),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let n=this.type._start;for(;n!==null;)n.gc(e,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,n){this.type._write(e)}getRef(){return 7}}const qh=(t,e,n)=>{const{client:r,clock:s}=e.id,i=new ze(Se(r,s+n),e,Se(r,s+n-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(n));return e.deleted&&i.markDeleted(),e.keep&&(i.keep=!0),e.redone!==null&&(i.redone=Se(e.redone.client,e.redone.clock+n)),e.right=i,i.right!==null&&(i.right.left=i),t._mergeStructs.push(i),i.parentSub!==null&&i.right===null&&i.parent._map.set(i.parentSub,i),e.length=n,i};class ze extends Dh{constructor(e,n,r,s,i,o,a,l){super(e,l.getLength()),this.origin=r,this.left=n,this.right=s,this.rightOrigin=i,this.parent=o,this.parentSub=a,this.redone=null,this.content=l,this.info=this.content.isCountable()?vc:0}set marker(e){(this.info&Go)>0!==e&&(this.info^=Go)}get marker(){return(this.info&Go)>0}get keep(){return(this.info&kc)>0}set keep(e){this.keep!==e&&(this.info^=kc)}get countable(){return(this.info&vc)>0}get deleted(){return(this.info&Vo)>0}set deleted(e){this.deleted!==e&&(this.info^=Vo)}markDeleted(){this.info|=Vo}getMissing(e,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=et(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=et(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===vi&&this.id.client!==this.parent.client&&this.parent.clock>=et(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=Rc(e,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=dn(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===an||this.right&&this.right.constructor===an)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===ze?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===ze&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===vi){const r=Qo(n,this.parent);r.constructor===an?this.parent=null:this.parent=r.content.type}return null}integrate(e,n){if(n>0&&(this.id.clock+=n,this.left=Rc(e,e.doc.store,Se(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,s;if(r!==null)s=r.right;else if(this.parentSub!==null)for(s=this.parent._map.get(this.parentSub)||null;s!==null&&s.left!==null;)s=s.left;else s=this.parent._start;const i=new Set,o=new Set;for(;s!==null&&s!==this.right;){if(o.add(s),i.add(s),Zs(this.origin,s.origin)){if(s.id.client<this.id.client)r=s,i.clear();else if(Zs(this.rightOrigin,s.rightOrigin))break}else if(s.origin!==null&&o.has(Qo(e.doc.store,s.origin)))i.has(Qo(e.doc.store,s.origin))||(r=s,i.clear());else break;s=s.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),bh(e.doc.store,this),this.content.integrate(e,this),$c(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new an(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:Se(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&Zs(e.origin,this.lastId)&&this.right===e&&Zs(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),gh(e.deleteSet,this.id.client,this.id.clock,this.length),$c(e,n,this.parentSub),this.content.delete(e)}}gc(e,n){if(!this.deleted)throw $n();this.content.gc(e),n?Rb(e,this,new an(this.id,this.length)):this.content=new ji(this.length)}write(e,n){const r=n>0?Se(this.id.client,this.id.clock+n-1):this.origin,s=this.rightOrigin,i=this.parentSub,o=this.content.getRef()&wy|(r===null?0:Ti)|(s===null?0:eh)|(i===null?0:vy);if(e.writeInfo(o),r!==null&&e.writeLeftID(r),s!==null&&e.writeRightID(s),r===null&&s===null){const a=this.parent;if(a._item!==void 0){const l=a._item;if(l===null){const u=jb(a);e.writeParentInfo(!0),e.writeString(u)}else e.writeParentInfo(!1),e.writeLeftID(l.id)}else a.constructor===String?(e.writeParentInfo(!0),e.writeString(a)):a.constructor===vi?(e.writeParentInfo(!1),e.writeLeftID(a)):$n();i!==null&&e.writeString(i)}this.content.write(e,n)}}const Lh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},Fh="__ $YJS$ __";Lh[Fh]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");Lh[Fh]=!0;za("ychange",{isEqual:(t,e)=>t===e,parse:t=>t??null});const i_=Wa("TOGGLE_CONNECT_COMMAND");var o_=Object.defineProperty,a_=(t,e,n)=>e in t?o_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,z=(t,e,n)=>a_(t,typeof e!="symbol"?e+"":e,n);const na=t=>Ie(Jp(t)),Dn=za("cid",{parse:t=>typeof t=="string"?t:void 0}),hn=za("segment",{parse:t=>typeof t=="string"?t:void 0}),l_=["type","marker","content"],wa="unknown",Uh=1;class Hn extends yn{constructor(e="",n,r,s){super(s),z(this,"__tag"),z(this,"__marker"),z(this,"__unknownAttributes"),this.__tag=e,this.__marker=n,this.__unknownAttributes=r}static getType(){return"unknown"}static clone(e){const{__tag:n,__marker:r,__unknownAttributes:s,__key:i}=e;return new Hn(n,r,s,i)}static importDOM(){return{[wa]:e=>u_(e)?{conversion:c_,priority:1}:null}}static importJSON(e){return ll().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setTag(e.tag).setMarker(e.marker).setUnknownAttributes(e.unknownAttributes)}setTag(e){if(this.__tag===e)return this;const n=this.getWritable();return n.__tag=e,n}getTag(){return this.getLatest().__tag}setMarker(e){if(this.__marker===e)return this;const n=this.getWritable();return n.__marker=e,n}getMarker(){return this.getLatest().__marker}setUnknownAttributes(e){const n=this.getWritable();return n.__unknownAttributes=e,n}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement(wa);return e.style.display="none",e}updateDOM(){return!1}exportDOM(){return{element:null}}exportJSON(){return{...super.exportJSON(),type:this.getType(),tag:this.getTag(),marker:this.getMarker(),unknownAttributes:this.getUnknownAttributes(),version:Uh}}canBeEmpty(){return!0}isInline(){return!0}extractWithChild(){return!1}excludeFromCopy(e){return e!=="clone"}}function c_(t){const e=t.getAttribute("data-tag")??"",n=t.getAttribute("data-marker")??"";return{node:ll(e,n)}}function ll(t,e,n){return Ie(new Hn(t,e,n))}function u_(t){return(t==null?void 0:t.tagName)===wa}function Zt(t){return t instanceof Hn}const gs="id",Bh=1,d_=["type","marker","code","content"];class dt extends yn{constructor(e="",n,r){super(r),z(this,"__marker",gs),z(this,"__code"),z(this,"__unknownAttributes"),this.__code=e,this.__unknownAttributes=n}static getType(){return"book"}static clone(e){const{__code:n,__unknownAttributes:r,__key:s}=e;return new dt(n,r,s)}static importJSON(e){const{code:n}=e;return Hh(n).updateFromJSON(e)}static isValidBookCode(e){return sp(e)}updateFromJSON(e){return super.updateFromJSON(e).setCode(e.code).setUnknownAttributes(e.unknownAttributes)}getMarker(){return this.getLatest().__marker}setCode(e){if(this.__code===e)return this;const n=this.getWritable();return n.__code=e,n}getCode(){return this.getLatest().__code}setUnknownAttributes(e){const n=this.getWritable();return n.__unknownAttributes=e,n}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("p");return e.setAttribute("data-marker",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`),e.setAttribute("data-code",this.__code),e}updateDOM(){return!1}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),code:this.getCode(),unknownAttributes:this.getUnknownAttributes(),version:Bh}}}function Hh(t,e){return Ie(new dt(t,e))}function Rt(t){return t instanceof dt}function h_(t){return(t==null?void 0:t.type)===dt.getType()}const me="",xa="",Gt=me,cl=`${me}|`,Xi="p",Pt="+",pr="-",Ni="chapter",Ca="verse",Uc="invalid",f_="text-spacing",p_="formatted-font",g_="marker-",ul="external-usj-mutation",Wh="selection-change",Sa="cursor-change",Ta="annotation-change",Ea="delta-change",m_=[ul,Wh,Sa,Ta,Ea],Ii="c",zh=1,y_=["type","marker","number","sid","altnumber","pubnumber","content"];class vt extends yn{constructor(e="",n,r,s,i,o){super(o),z(this,"__marker"),z(this,"__number"),z(this,"__sid"),z(this,"__altnumber"),z(this,"__pubnumber"),z(this,"__unknownAttributes"),this.__marker=Ii,this.__number=e,this.__sid=n,this.__altnumber=r,this.__pubnumber=s,this.__unknownAttributes=i}static getType(){return"chapter"}static clone(e){const{__number:n,__sid:r,__altnumber:s,__pubnumber:i,__unknownAttributes:o,__key:a}=e;return new vt(n,r,s,i,o,a)}static importJSON(e){return Kh().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setNumber(e.number).setSid(e.sid).setAltnumber(e.altnumber).setPubnumber(e.pubnumber).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const n=this.getWritable();return n.__marker=e,n}getMarker(){return this.getLatest().__marker}setNumber(e){if(this.__number===e)return this;const n=this.getWritable();return n.__number=e,n}getNumber(){return this.getLatest().__number}setSid(e){if(this.__sid===e)return this;const n=this.getWritable();return n.__sid=e,n}getSid(){return this.getLatest().__sid}setAltnumber(e){if(this.__altnumber===e)return this;const n=this.getWritable();return n.__altnumber=e,n}getAltnumber(){return this.getLatest().__altnumber}setPubnumber(e){if(this.__pubnumber===e)return this;const n=this.getWritable();return n.__pubnumber=e,n}getPubnumber(){return this.getLatest().__pubnumber}setUnknownAttributes(e){const n=this.getWritable();return n.__unknownAttributes=e,n}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("p");return e.setAttribute("data-marker",this.__marker),e.classList.add(Ni,`usfm_${this.__marker}`),e.setAttribute("data-number",this.__number),e}updateDOM(){return!1}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),number:this.getNumber(),sid:this.getSid(),altnumber:this.getAltnumber(),pubnumber:this.getPubnumber(),unknownAttributes:this.getUnknownAttributes(),version:zh}}}function Kh(t,e,n,r,s){return Ie(new vt(t,e,n,r,s))}function dl(t){return t instanceof vt}function b_(t){return(t==null?void 0:t.type)===vt.getType()}const Jh=["fr","fq","fqa","fk","ft","fl","fw","fp","fv","fdc","fm"],Vh=["xo","xop","xk","xq","xt","xta","xot","xnt","xdc"],__=["ca","cp","va","vp","add","bk","dc","em","jmp","k","nd","ord","pn","png","qt","rb","rq","sig","sls","tl","w","wa","wg","wh","wj","bd","it","bdit","no","sc","sup","ior","iqt","qac","qs","litl","lik","liv","liv1","liv2","liv3","liv4","liv5",...Jh,...Vh],Gh=1,k_=["type","marker","content"];class Ce extends yn{constructor(e="",n,r){super(r),z(this,"__marker"),z(this,"__unknownAttributes"),this.__marker=e,this.__unknownAttributes=n}static getType(){return"char"}static clone(e){const{__marker:n,__unknownAttributes:r,__key:s}=e;return new Ce(n,r,s)}static isValidMarker(e){return e!==void 0&&__.includes(e)}static isValidFootnoteMarker(e){return e!==void 0&&Jh.includes(e)}static isValidCrossReferenceMarker(e){return e!==void 0&&Vh.includes(e)}static importDOM(){return{span:e=>w_(e)?{conversion:v_,priority:1}:null}}static importJSON(e){return gt().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const n=this.getWritable();return n.__marker=e,n}getMarker(){return this.getLatest().__marker}setUnknownAttributes(e){const n=this.getWritable();return n.__unknownAttributes=e,n}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("span");return e.setAttribute("data-marker",this.__marker),e.setAttribute("title",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`),e}updateDOM(){return!1}exportDOM(e){const{element:n}=super.exportDOM(e);return n&&bn(n)&&(n.setAttribute("data-marker",this.getMarker()),n.classList.add(this.getType(),`usfm_${this.getMarker()}`)),{element:n}}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),unknownAttributes:this.getUnknownAttributes(),version:Gh}}insertNewAfter(e,n){const r=gt(this.getMarker());return r.setTextFormat(e.format),r.setTextStyle(e.style),r.setDirection(this.getDirection()),r.setFormat(this.getFormatType()),r.setStyle(this.getTextStyle()),this.insertAfter(r,n),r}canBeEmpty(){return!1}isInline(){return!0}}function v_(t){const e=t.getAttribute("data-marker")??"f";return{node:gt(e)}}function gt(t,e){return Ie(new Ce(t,e))}function w_(t){if(!t)return!1;const e=t.getAttribute("data-marker")??"";return Ce.isValidMarker(e)&&t.classList.contains(Ce.getType())}function pe(t){return t instanceof Ce}function x_(t){return(t==null?void 0:t.type)===Ce.getType()}const Yh=1,C_="c",Xh="span";class Qt extends wr{constructor(e="",n=!1,r,s,i,o,a){super(a),z(this,"__marker"),z(this,"__number"),z(this,"__showMarker"),z(this,"__sid"),z(this,"__altnumber"),z(this,"__pubnumber"),z(this,"__unknownAttributes"),this.__marker=C_,this.__number=e,this.__showMarker=n,this.__sid=r,this.__altnumber=s,this.__pubnumber=i,this.__unknownAttributes=o}static getType(){return"immutable-chapter"}static clone(e){const{__number:n,__showMarker:r,__sid:s,__altnumber:i,__pubnumber:o,__unknownAttributes:a,__key:l}=e;return new Qt(n,r,s,i,o,a,l)}static importDOM(){return{span:e=>Zh(e)?{conversion:S_,priority:1}:null}}static importJSON(e){return hl().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setNumber(e.number).setShowMarker(e.showMarker).setSid(e.sid).setAltnumber(e.altnumber).setPubnumber(e.pubnumber).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const n=this.getWritable();return n.__marker=e,n}getMarker(){return this.getLatest().__marker}setNumber(e){if(this.__number===e)return this;const n=this.getWritable();return n.__number=e,n}getNumber(){return this.getLatest().__number}setShowMarker(e=!1){if(this.__showMarker===e)return this;const n=this.getWritable();return n.__showMarker=e,n}getShowMarker(){return this.getLatest().__showMarker}setSid(e){if(this.__sid===e)return this;const n=this.getWritable();return n.__sid=e,n}getSid(){return this.getLatest().__sid}setAltnumber(e){if(this.__altnumber===e)return this;const n=this.getWritable();return n.__altnumber=e,n}getAltnumber(){return this.getLatest().__altnumber}setPubnumber(e){if(this.__pubnumber===e)return this;const n=this.getWritable();return n.__pubnumber=e,n}getPubnumber(){return this.getLatest().__pubnumber}setUnknownAttributes(e){const n=this.getWritable();return n.__unknownAttributes=e,n}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement(Xh);return e.setAttribute("data-marker",this.__marker),e.classList.add(Ni,`usfm_${this.__marker}`),this.__showMarker&&e.classList.add("marker"),e.setAttribute("data-number",this.__number),e}updateDOM(){return!1}exportDOM(e){const{element:n}=super.exportDOM(e);return n&&bn(n)&&(n.setAttribute("data-marker",this.getMarker()),n.classList.add(Ni,`usfm_${this.getMarker()}`),n.setAttribute("data-number",this.getNumber())),{element:n}}decorate(){return this.getShowMarker()?Cs(this.getMarker(),this.getNumber()):this.getNumber()}exportJSON(){return{type:this.getType(),marker:this.getMarker(),number:this.getNumber(),showMarker:this.getShowMarker(),sid:this.getSid(),altnumber:this.getAltnumber(),pubnumber:this.getPubnumber(),unknownAttributes:this.getUnknownAttributes(),version:Yh}}isInline(){return!1}isKeyboardSelectable(){return!1}}function S_(t){const e=t.getAttribute("data-number")??"0";return{node:hl(e)}}function hl(t,e,n,r,s,i){return Ie(new Qt(t,e,n,r,s,i))}function Zh(t){return t?t.classList.contains(Ni)&&t.tagName.toLowerCase()===Xh:!1}function xs(t){return t instanceof Qt}function T_(t){return(t==null?void 0:t.type)===Qt.getType()}const Qh=1;class fn extends Ka{static getType(){return"implied-para"}static clone(e){return new fn(e.__key)}static importJSON(e){return bt().updateFromJSON(e)}getMarker(){return Xi}exportJSON(){return{...super.exportJSON(),type:this.getType(),version:Qh}}insertNewAfter(e,n){const r=bt();return r.setTextFormat(e.format),r.setTextStyle(e.style),r.setDirection(this.getDirection()),r.setFormat(this.getFormatType()),r.setStyle(this.getTextStyle()),this.insertAfter(r,n),r}}function bt(){return Ie(new fn)}function Yt(t){return t instanceof fn}function fl(t){return(t==null?void 0:t.type)===fn.getType()}const qn="zmsc-s",ar="zmsc-e",E_=[qn,ar],O_=["ts-s","ts-e","t-s","t-e","ts","qt1-s","qt1-e","qt2-s","qt2-e","qt3-s","qt3-e","qt4-s","qt4-e","qt5-s","qt5-e","qt-s","qt-e",qn,ar],ef=1,M_=["type","marker","sid","eid","content"];class $t extends wr{constructor(e="",n,r,s,i){super(i),z(this,"__marker"),z(this,"__sid"),z(this,"__eid"),z(this,"__unknownAttributes"),this.__marker=e,this.__sid=n,this.__eid=r,this.__unknownAttributes=s}static getType(){return"ms"}static clone(e){const{__marker:n,__sid:r,__eid:s,__unknownAttributes:i,__key:o}=e;return new $t(n,r,s,i,o)}static importJSON(e){return tf().updateFromJSON(e)}static isValidMarker(e){return e!==void 0&&(O_.includes(e)||e.startsWith("z"))}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setSid(e.sid).setEid(e.eid).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const n=this.getWritable();return n.__marker=e,n}getMarker(){return this.getLatest().__marker}setSid(e){if(this.__sid===e)return this;const n=this.getWritable();return n.__sid=e,n}getSid(){return this.getLatest().__sid}setEid(e){if(this.__eid===e)return this;const n=this.getWritable();return n.__eid=e,n}getEid(){return this.getLatest().__eid}setUnknownAttributes(e){const n=this.getWritable();return n.__unknownAttributes=e,n}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("span");return e.setAttribute("data-marker",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`),e}updateDOM(){return!1}decorate(){return""}exportJSON(){return{type:this.getType(),marker:this.getMarker(),sid:this.getSid(),eid:this.getEid(),unknownAttributes:this.getUnknownAttributes(),version:ef}}isKeyboardSelectable(){return!1}}function A_(t){return E_.includes(t)}function tf(t,e,n,r){return Ie(new $t(t,e,n,r))}function Zi(t){return t instanceof $t}const pl="f",j_=[pl,"fe","ef","efe","x","ex"],N_=["type","marker","caller","category","content"],nf=1;class $e extends yn{constructor(e=pl,n,r=!0,s,i,o){super(o),z(this,"__marker"),z(this,"__caller"),z(this,"__isCollapsed"),z(this,"__category"),z(this,"__unknownAttributes"),this.__marker=e,this.__caller=n??(e==="x"||e==="ex"?pr:Pt),this.__isCollapsed=r,this.__category=s,this.__unknownAttributes=i}static getType(){return"note"}static clone(e){const{__marker:n,__caller:r,__isCollapsed:s,__category:i,__unknownAttributes:o,__key:a}=e;return new $e(n,r,s,i,o,a)}static importDOM(){return{span:e=>R_(e)?{conversion:I_,priority:1}:null}}static importJSON(e){return gl().updateFromJSON(e)}static isValidMarker(e){return e!==void 0&&j_.includes(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setCaller(e.caller).setIsCollapsed(e.isCollapsed).setCategory(e.category).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const n=this.getWritable();return n.__marker=e,n}getMarker(){return this.getLatest().__marker}setCaller(e){if(this.__caller===e)return this;const n=this.getWritable();return n.__caller=e,n}getCaller(){return this.getLatest().__caller}setIsCollapsed(e){if(this.__isCollapsed===e)return this;const n=this.getWritable();return n.__isCollapsed=e,n}toggleIsCollapsed(){const e=this.getWritable();return e.__isCollapsed=!e.__isCollapsed,e}getIsCollapsed(){return this.getLatest().__isCollapsed}setCategory(e){if(this.__category===e)return this;const n=this.getWritable();return n.__category=e,n}getCategory(){return this.getLatest().__category}setUnknownAttributes(e){const n=this.getWritable();return n.__unknownAttributes=e,n}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("span");return e.setAttribute("data-marker",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`,this.__isCollapsed?"collapsed":"expanded"),e.setAttribute("data-caller",this.__caller),e}updateDOM(e){return e.__isCollapsed!==this.__isCollapsed}exportDOM(e){const{element:n}=super.exportDOM(e);return n&&bn(n)&&(n.setAttribute("data-marker",this.getMarker()),n.classList.add(this.getType(),`usfm_${this.getMarker()}`,this.getIsCollapsed()?"collapsed":"expanded"),n.setAttribute("data-caller",this.getCaller())),{element:n}}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),caller:this.getCaller(),isCollapsed:this.getIsCollapsed(),category:this.getCategory(),unknownAttributes:this.getUnknownAttributes(),version:nf}}canBeEmpty(){return!1}isInline(){return!0}}function I_(t){const e=t.getAttribute("data-marker")??"f",n=t.getAttribute("data-caller")??"",r=t.classList.contains("collapsed");return{node:gl(e,n,r)}}function gl(t,e,n,r,s){return Ie(new $e(t,e,n,r,s))}function R_(t){if(!t)return!1;const e=t.getAttribute("data-marker")??"";return $e.isValidMarker(e)&&t.classList.contains($e.getType())}function oe(t){return t instanceof $e}const P_=["ide","sts","rem","h","toc1","toc2","toc3","toca1","toca2","toca3","imt","imt1","imt2","imt3","imt4","is","is1","is2","ip","ipi","im","imi","ipq","imq","ipr","iq","iq1","iq2","iq3","ili","ili1","ili2","ib","iot","io","io1","io2","io3","io4","iex","imte","imte1","imte2","ie","mt","mt1","mt2","mt3","mt4","mte","mte1","mte2","cl","cd","ms","ms1","ms2","ms3","mr","s","s1","s2","s3","s4","sr","r","d","sp","sd","sd1","sd2","sd3","sd4",Xi,"m","po","cls","pr","pc","pm","pmo","pmc","pmr","pi","pi1","pi2","pi3","mi","lit","nb","q","q1","q2","q3","q4","qr","qc","qa","qm","qm1","qm2","qm3","qd","b","lh","li","li1","li2","li3","li4","lf","lim","lim1","lim2","lim3","lim4","pb"],rf=1,$_=["type","marker","content"];class tt extends Ka{constructor(e=Xi,n,r){super(r),z(this,"__marker"),z(this,"__unknownAttributes"),this.__marker=e,this.__unknownAttributes=n}static getType(){return"para"}static clone(e){const{__marker:n,__unknownAttributes:r,__key:s}=e;return new tt(n,r,s)}static isValidMarker(e){return e!==void 0&&P_.includes(e)}static importDOM(){return{p:()=>({conversion:D_,priority:1})}}static importJSON(e){return ms().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const n=this.getWritable();return n.__marker=e,n}getMarker(){return this.getLatest().__marker}setUnknownAttributes(e){const n=this.getWritable();return n.__unknownAttributes=e,n}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("p");return e.setAttribute("data-marker",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`),e}exportDOM(e){const{element:n}=super.exportDOM(e);return n&&bn(n)&&(n.setAttribute("data-marker",this.getMarker()),n.classList.add(this.getType(),`usfm_${this.getMarker()}`)),{element:n}}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),unknownAttributes:this.getUnknownAttributes(),version:rf}}insertNewAfter(e,n){const r=ms(this.getMarker());return r.setTextFormat(e.format),r.setTextStyle(e.style),r.setDirection(this.getDirection()),r.setFormat(this.getFormatType()),r.setStyle(this.getTextStyle()),this.insertAfter(r,n),r}}function D_(t){const e=t.getAttribute("data-marker")??void 0,n=ms(e);if(t.style){n.setFormat(t.style.textAlign);const r=parseInt(t.style.textIndent,10)/20;r>0&&n.setIndent(r)}return{node:n}}function ms(t,e){return Ie(new tt(t,e))}function Ke(t){return t instanceof tt}function q_(t){return(t==null?void 0:t.type)===tt.getType()}const Ri="v",sf=1,L_=["type","marker","number","sid","altnumber","pubnumber","content"];class Ge extends jt{constructor(e="",n,r,s,i,o,a){super(n??e,a),z(this,"__marker"),z(this,"__number"),z(this,"__sid"),z(this,"__altnumber"),z(this,"__pubnumber"),z(this,"__unknownAttributes"),this.__marker=Ri,this.__number=e,this.__sid=r,this.__altnumber=s,this.__pubnumber=i,this.__unknownAttributes=o}static getType(){return"verse"}static clone(e){const{__number:n,__text:r,__sid:s,__altnumber:i,__pubnumber:o,__unknownAttributes:a,__key:l}=e;return new Ge(n,r,s,i,o,a,l)}static importJSON(e){return of().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setNumber(e.number).setSid(e.sid).setAltnumber(e.altnumber).setPubnumber(e.pubnumber).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const n=this.getWritable();return n.__marker=e,n}getMarker(){return this.getLatest().__marker}setNumber(e){if(this.__number===e)return this;const n=this.getWritable();return n.__number=e,n}getNumber(){return this.getLatest().__number}setSid(e){if(this.__sid===e)return this;const n=this.getWritable();return n.__sid=e,n}getSid(){return this.getLatest().__sid}setAltnumber(e){if(this.__altnumber===e)return this;const n=this.getWritable();return n.__altnumber=e,n}getAltnumber(){return this.getLatest().__altnumber}setPubnumber(e){if(this.__pubnumber===e)return this;const n=this.getWritable();return n.__pubnumber=e,n}getPubnumber(){return this.getLatest().__pubnumber}setUnknownAttributes(e){const n=this.getWritable();return n.__unknownAttributes=e,n}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(e){const n=super.createDOM(e);return n.setAttribute("data-marker",this.__marker),n.classList.add(Ca,`usfm_${this.__marker}`),n.setAttribute("data-number",this.__number),n}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),number:this.getNumber(),sid:this.getSid(),altnumber:this.getAltnumber(),pubnumber:this.getPubnumber(),unknownAttributes:this.getUnknownAttributes(),version:sf}}}function of(t,e,n,r,s,i){return Ie(new Ge(t,e,n,r,s,i))}function ml(t){return t instanceof Ge}function F_(t){return(t==null?void 0:t.type)===Ge.getType()}function U_(t){return b_(t)||T_(t)}function ct(t){return dl(t)||xs(t)}function B_(t,e){return t.find(n=>ct(n)&&n.getNumber()===e.toString())}function H_(t,e=!1){return t.find((n,r)=>(!e||r>0)&&ct(n))}function yl(t){var e;if(!t)return;if(ct(t))return t;let n=(e=t.getTopLevelElement())==null?void 0:e.getPreviousSibling();for(;n&&!ct(n);)n=n.getPreviousSibling();if(n&&ct(n))return n}function af(t){let e=t;for(;e!==null;){if(oe(e))return e;e=e.getParent()}}function W_(t){return Rt(t)||dl(t)||pe(t)||xs(t)||Yt(t)||Zi(t)||Ke(t)||oe(t)||ml(t)||Zt(t)}function z_(t){var e;if(t.anchor.type==="element"){const r=t.anchor.getNode(),s=t.anchor.offset;if(s<r.getChildrenSize())return r.getChildAtIndex(s)}const n=t.anchor.getNode();return n.getNextSibling()??((e=n.getParent())==null?void 0:e.getNextSibling())??null}function K_(t){var e;const n=t.anchor.offset;if(t.anchor.type==="element"&&n>0)return t.anchor.getNode().getChildAtIndex(n-1);const r=t.anchor.getNode();return r.getPreviousSibling()??((e=r.getParent())==null?void 0:e.getPreviousSibling())??null}function yt(t){return Ke(t)||Yt(t)}function J_(t,e){let n=t.getParent();for(;n;){if(n.getKey()===e)return!0;n=n.getParent()}return!1}function Ln(t,e){const n=ks(e,Dn),r=!!(t.cid&&n),s=!t.cid&&!n;return t.style===e.getMarker()&&(s||r&&t.cid===n)}function V_(t,e){const n=we(t)?t:t.getParent(),r=we(e)?e:e.getParent(),s=n&&r?Kp(n,r):void 0;return s?s.commonAncestor:void 0}function G_(t){const e=t.getStartEndPoints();if(!e)return;const[n,r]=e,s=t.isBackward()?n:r;t.focus.set(s.key,s.offset,s.type),t.anchor.set(s.key,s.offset,s.type)}function bl(t){return(t==null?void 0:t.type)===jt.getType()}function Y_(t,e){if(!e)return;const n=t.findIndex(r=>r===e);n&&(t.length=n)}function X_(t,e){if(!e)return t;const n=e.getIndexWithinParent();return t.splice(n+1,t.length-n-1)}function en(t){return`\\${t}`}function gr(t){return`\\${t}*`}function lf(t,e,n){const r=en(t);if(e!=null&&e.startsWith(r)){const s=parseInt(e.slice(r.length),10);isNaN(s)||(n=s.toString())}return n}function Cs(t,e){let n=en(t);return e&&(n+=`${me}${e}`),n+=" ",n}function cf(t){return bl(t)&&t.text!==me?t.text:x_(t)?t.children.map(e=>cf(e)).join(""):""}function Z_(t){return t.map(e=>cf(e)).filter(e=>e.length>0).join(" ").trim()}function _l(t){return me+t+" "}function kl(t){const e=[];for(const n of t){if(!pe(n))continue;const r=n.getTextContent();r!==Gt&&r.length>0&&e.push(r)}return e.join(" ").trim()}function je(t,e=ap){const n={...t};return e.forEach(r=>{Reflect.deleteProperty(n,r)}),Object.keys(n).length===0?void 0:n}function Ne(t){return Object.fromEntries(Object.entries(t).filter(([,e])=>e!==void 0))}function uf(t){if(!t)return;const e=t.getNodes();if(e.length>0)return t.isBackward()?e[e.length-1]:e[0]}function Oa(t,e){if(!e)return(t+1).toString();const n=e.split("-");if(n.length===2)return parseInt(n[1])?`${parseInt(n[1])+1}`:`${parseInt(n[0])+1}`;const r=RegExp(/^(\d+)([a-yA-Y]{1,3})$/).exec(e);if(!r)return(parseInt(e)+1).toString();const s=String.fromCharCode(r[2].charCodeAt(0)+1);return`${r[1]}${s}`}function vl(t,e){if(!e)return!1;const n=e.split("-").map(r=>parseInt(r));if(n.length<1||n.length>2||n[0]>n[1])throw new Error("isVerseInRange: invalid range");return n.length===1?t===n[0]:n.length===2&&isNaN(n[1])?t>=n[0]:(n.length===2&&isNaN(n[0])||t>=n[0])&&t<=n[1]}function Q_(t){return!!t&&t.includes("-")}const ek=1;class Wn extends jt{constructor(e="",n="opening",r){super(ra(e,n),r),z(this,"__marker"),z(this,"__markerSyntax"),this.__marker=e,this.__markerSyntax=n}static getType(){return"marker"}static clone(e){return new Wn(e.__marker,e.__markerSyntax,e.__key)}static importJSON(e){return mr().updateFromJSON(e)}updateFromJSON(e){const{marker:n,markerSyntax:r="opening"}=e;return super.updateFromJSON(e).setMarker(n).setMarkerSyntax(r)}setMarker(e){if(this.__marker===e)return this;const n=this.getWritable();return n.__marker=e,n.__text=ra(e,n.__markerSyntax),n}getMarker(){return this.getLatest().__marker}setMarkerSyntax(e){if(this.__markerSyntax===e)return this;const n=this.getWritable();return n.__markerSyntax=e,n.__text=ra(n.__marker,e),n}getMarkerSyntax(){return this.getLatest().__markerSyntax}createDOM(e){const n=super.createDOM(e);return n.setAttribute("data-marker",this.__marker),n.classList.add(this.__markerSyntax),n}exportJSON(){return{...super.exportJSON(),type:this.getType(),text:this.getTextContent(),marker:this.getMarker(),markerSyntax:this.getMarkerSyntax(),version:ek}}}function mr(t,e){return Ie(new Wn(t,e))}function Ss(t){return t instanceof Wn}function ra(t,e){return e==="closing"?gr(t):e==="selfClosing"?gr(""):en(t)}const un="internal-comment",tk=[un],df=Object.freeze({}),Ma=Object.freeze({}),Aa=Object.freeze({}),nk=1,Wt=new Map,jn=new Map;class Le extends yn{constructor(e=df,n,r,s){super(s),z(this,"__typedIDs"),z(this,"__typedOnClicks"),z(this,"__typedOnRemoves"),z(this,"__domOnClickListener"),z(this,"__suppressOnRemoveCallbacks"),this.__typedIDs=ti(e),this.__typedOnClicks=sa(n),this.__typedOnRemoves=ia(r),this.pruneTypedOnClicks(),this.pruneTypedOnRemoves(),this.syncTypedOnClicksToRegistry(),this.syncTypedOnRemovesToRegistry()}static getType(){return"typed-mark"}static clone(e){const n=ti(e.__typedIDs),r=sa(e.__typedOnClicks),s=ia(e.__typedOnRemoves);return new Le(n,r,s,e.__key)}static isReservedType(e){return tk.includes(e)}static importDOM(){return null}static importJSON(e){return ys().updateFromJSON(e)}exportJSON(){return{...super.exportJSON(),type:this.getType(),typedIDs:this.getTypedIDs(),version:nk}}createDOM(e,n){const r=document.createElement("mark");for(const[i,o]of Object.entries(this.__typedIDs)){Et(r,Nn(e.theme.typedMark,i)),o.length>1&&Et(r,Nn(e.theme.typedMarkOverlap,i));for(const a of o)Et(r,Nn("annotationId",a))}const s=this.getOrCreateDOMClickListener(n);return r.addEventListener("click",s),r}updateDOM(e,n,r){const s=new Set([...Object.keys(e.__typedIDs??{}),...Object.keys(this.__typedIDs??{})]);for(const i of s){const o=e.__typedIDs[i]??[],a=this.__typedIDs[i]??[],l=o.length,u=a.length,d=Nn(r.theme.typedMark,i),f=Nn(r.theme.typedMarkOverlap,i);l!==u&&(l===0?u===1&&Et(n,d):u===0&&mi(n,d),l===1?u===2&&Et(n,f):u===1&&mi(n,f));const h=new Set(o),p=new Set(a);for(const y of o)p.has(y)||mi(n,Nn("annotationId",y));for(const y of a)h.has(y)||Et(n,Nn("annotationId",y))}return!1}updateFromJSON(e){return super.updateFromJSON(e).setTypedIDs(e.typedIDs)}hasID(e,n){const r=this.getTypedIDs()[e];if(!r)return!1;for(const s of r)if(n===s)return!0;return!1}getTypedIDs(){const e=this.getLatest();return Ee(e)?e.__typedIDs:{}}setTypedIDs(e){const n=this.getWritable(),r=ti(n.__typedIDs);n.__typedIDs=ti(e),n.dispatchRemovedIDs(r,n.__typedIDs,"removed"),n.pruneTypedOnClicks(),n.pruneTypedOnRemoves(),n.syncTypedOnClicksToRegistry(),n.syncTypedOnRemovesToRegistry();const s=n.mergeWithAdjacentTypedMarks();return s.hasNoIDsForEveryType()&&s.getParent()!==null&&Pi(s),s}setTypedOnClicks(e){const n=this.getWritable();return n.__typedOnClicks=sa(e),n.pruneTypedOnClicks(),n.syncTypedOnClicksToRegistry(),n}getTypedOnClicks(){const e=this.getLatest();return Ee(e)?Wt.get(e.getKey())??{}:{}}setTypedOnRemoves(e){const n=this.getWritable();return n.__typedOnRemoves=ia(e),n.pruneTypedOnRemoves(),n.syncTypedOnRemovesToRegistry(),n}getTypedOnRemoves(){const e=this.getLatest();return Ee(e)?jn.get(e.getKey())??{}:{}}addID(e,n,r,s){const i=this.getWritable();if(!Ee(i))return;ot(e),ot(n);let o=i.__typedIDs[e];o||(o=[],i.__typedIDs[e]=o);for(const a of o)if(n===a){r&&i.setOnClickFor(e,n,r),s&&i.setOnRemoveFor(e,n,s);return}o.push(n),r&&i.setOnClickFor(e,n,r),s&&i.setOnRemoveFor(e,n,s)}deleteID(e,n){const r=this.getWritable();if(!Ee(r))return;const s=r.__typedIDs[e];if(!s||s.length===0)return;for(let o=0;o<s.length;o++)if(n===s[o]){s.splice(o,1),r.invokeOnRemove(e,n,"removed");break}r.removeOnClickFor(e,n),r.removeOnRemoveFor(e,n),r.pruneTypedOnClicks(),r.pruneTypedOnRemoves();const i=r.mergeWithAdjacentTypedMarks();i.hasNoIDsForEveryType()&&i.getParent()!==null&&Pi(i)}hasNoIDsForEveryType(){return Object.values(this.getTypedIDs()).every(e=>e===void 0||e.length===0)}insertNewAfter(e,n=!0){const r=ys(this.__typedIDs,this.getTypedOnClicks());return this.insertAfter(r,n),r}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}canBeEmpty(){return!1}isInline(){return!0}extractWithChild(e,n,r){if(!X(n)||r==="html")return!1;const s=n.anchor,i=n.focus,o=s.getNode(),a=i.getNode(),l=n.isBackward()?s.offset-i.offset:i.offset-s.offset;return this.isParentOf(o)&&this.isParentOf(a)&&this.getTextContent().length===l}excludeFromCopy(e){return e!=="clone"}remove(e){const n=this.getWritable(),r=this.getTypedIDs();n.__suppressOnRemoveCallbacks?n.__suppressOnRemoveCallbacks=void 0:n.dispatchOnRemoveForTypedIDs(r,"destroyed"),Wt.delete(n.getKey()),jn.delete(n.getKey()),n.__typedOnClicks=void 0,n.__typedOnRemoves=void 0,super.remove.call(n,e)}getOrCreateDOMClickListener(e){return this.__domOnClickListener||(this.__domOnClickListener=n=>{this.handleDOMClick(n,e)}),this.__domOnClickListener}handleDOMClick(e,n){const r=Wt.get(this.getKey());if(!r)return;const s=[];for(const[o,a]of Object.entries(r))for(const[l,u]of Object.entries(a))u&&s.push([u,o,l]);if(s.length===0)return;const i=n.read(()=>this.getTextContent());for(const[o,a,l]of s)o(e,a,l,i)}ensureOnClickMapMutable(){if(this.__typedOnClicks===void 0||this.__typedOnClicks===Ma){const e=Wt.get(this.getKey());this.__typedOnClicks=e??{}}return this.__typedOnClicks}syncTypedOnClicksToRegistry(){if(!this.__typedOnClicks||Object.keys(this.__typedOnClicks).length===0){Wt.delete(this.getKey()),this.__typedOnClicks&&Object.keys(this.__typedOnClicks).length===0&&(this.__typedOnClicks=void 0);return}Wt.set(this.getKey(),this.__typedOnClicks)}setOnClickFor(e,n,r){ot(e),ot(n);const s=this.ensureOnClickMapMutable(),i=s[e]??(s[e]={});i[n]=r,this.syncTypedOnClicksToRegistry()}removeOnClickFor(e,n){if(!this.__typedOnClicks)return;const r=this.__typedOnClicks[e];if(!r)return;const s=ni(r,n);if(Object.keys(s).length>0)this.__typedOnClicks={...this.__typedOnClicks,[e]:s};else{const i=ni(this.__typedOnClicks,e);this.__typedOnClicks=Object.keys(i).length>0?i:void 0}this.syncTypedOnClicksToRegistry()}pruneTypedOnClicks(){if(!this.__typedOnClicks||this.__typedOnClicks===Ma){this.__typedOnClicks=void 0,this.syncTypedOnClicksToRegistry();return}const e={};for(const[n,r]of Object.entries(this.__typedOnClicks)){const s=this.__typedIDs[n];if(!s||s.length===0)continue;const i=new Set(s),o={};for(const[a,l]of Object.entries(r))i.has(a)&&(o[a]=l);Object.keys(o).length>0&&(e[n]=o)}this.__typedOnClicks=Object.keys(e).length>0?e:void 0,this.syncTypedOnClicksToRegistry()}ensureOnRemoveMapMutable(){if(this.__typedOnRemoves===void 0||this.__typedOnRemoves===Aa){const e=jn.get(this.getKey());this.__typedOnRemoves=e??{}}return this.__typedOnRemoves}syncTypedOnRemovesToRegistry(){if(!this.__typedOnRemoves||Object.keys(this.__typedOnRemoves).length===0){jn.delete(this.getKey()),this.__typedOnRemoves&&Object.keys(this.__typedOnRemoves).length===0&&(this.__typedOnRemoves=void 0);return}jn.set(this.getKey(),this.__typedOnRemoves)}setOnRemoveFor(e,n,r){ot(e),ot(n);const s=this.ensureOnRemoveMapMutable(),i=s[e]??(s[e]={});i[n]=r,this.syncTypedOnRemovesToRegistry()}removeOnRemoveFor(e,n){if(!this.__typedOnRemoves)return;const r=this.__typedOnRemoves[e];if(!r)return;const s=ni(r,n);if(Object.keys(s).length>0)this.__typedOnRemoves={...this.__typedOnRemoves,[e]:s};else{const i=ni(this.__typedOnRemoves,e);this.__typedOnRemoves=Object.keys(i).length>0?i:void 0}this.syncTypedOnRemovesToRegistry()}pruneTypedOnRemoves(){if(!this.__typedOnRemoves||this.__typedOnRemoves===Aa){this.__typedOnRemoves=void 0,this.syncTypedOnRemovesToRegistry();return}const e={};for(const[n,r]of Object.entries(this.__typedOnRemoves)){const s=this.__typedIDs[n];if(!s||s.length===0)continue;const i=new Set(s),o={};for(const[a,l]of Object.entries(r))i.has(a)&&(o[a]=l);Object.keys(o).length>0&&(e[n]=o)}this.__typedOnRemoves=Object.keys(e).length>0?e:void 0,this.syncTypedOnRemovesToRegistry()}invokeOnRemove(e,n,r){var s;const i=(s=this.getTypedOnRemoves()[e])==null?void 0:s[n];i&&(i(e,n,r,this.getTextContent()),this.removeOnRemoveFor(e,n))}dispatchRemovedIDs(e,n,r){const s=rk(e,n);if(s.length!==0)for(const[i,o]of s)this.invokeOnRemove(i,o,r)}dispatchOnRemoveForTypedIDs(e,n){for(const[r,s]of Object.entries(e))if(s)for(const i of s)this.invokeOnRemove(r,i,n)}mergeWithAdjacentTypedMarks(){if(this.hasNoIDsForEveryType())return this;let e=this.getPreviousSibling();for(;Ee(e)&&Hc(e.getTypedIDs(),this.getTypedIDs());)this.mergeWithPreviousTypedMark(e),e=this.getPreviousSibling();let n=this.getNextSibling();for(;Ee(n)&&Hc(this.getTypedIDs(),n.getTypedIDs());)this.mergeWithNextTypedMark(n),n=this.getNextSibling();return this}mergeWithPreviousTypedMark(e){this.mergeOnClicksFrom(e.getTypedOnClicks()),this.mergeOnRemovesFrom(e.getTypedOnRemoves());const n=e.getChildren();n.length>0&&this.splice(0,0,n),Wt.delete(e.getKey()),jn.delete(e.getKey()),e.getWritable().__suppressOnRemoveCallbacks=!0,e.remove()}mergeWithNextTypedMark(e){this.mergeOnClicksFrom(e.getTypedOnClicks()),this.mergeOnRemovesFrom(e.getTypedOnRemoves());const n=e.getChildren();n.length>0&&this.append(...n),Wt.delete(e.getKey()),jn.delete(e.getKey()),e.getWritable().__suppressOnRemoveCallbacks=!0,e.remove()}mergeOnClicksFrom(e){if(!e||Object.keys(e).length===0)return;const n=sk(this.getTypedOnClicks(),e);Object.keys(n).length!==0&&this.setTypedOnClicks(n)}mergeOnRemovesFrom(e){if(!e||Object.keys(e).length===0)return;const n=ik(this.getTypedOnRemoves(),e);Object.keys(n).length!==0&&this.setTypedOnRemoves(n)}}function ti(t=df){const e={};for(const[n,r]of Object.entries(t)){if(ot(n),!Array.isArray(r)){e[n]=[];continue}const s=[];for(const i of r)ot(i),s.push(i);e[n]=s}return e}function sa(t){if(!t||t===Ma)return;const e={};for(const[n,r]of Object.entries(t)){ot(n);const s={};for(const[i,o]of Object.entries(r))ot(i),s[i]=o;Object.keys(s).length>0&&(e[n]=s)}return Object.keys(e).length>0?e:void 0}function ia(t){if(!t||t===Aa)return;const e={};for(const[n,r]of Object.entries(t)){ot(n);const s={};for(const[i,o]of Object.entries(r))ot(i),s[i]=o;Object.keys(s).length>0&&(e[n]=s)}return Object.keys(e).length>0?e:void 0}function ni(t,e){const n={};for(const[r,s]of Object.entries(t))r!==e&&(n[r]=s);return n}function Bc(t){const e={};for(const[n,r]of Object.entries(t))!r||r.length===0||(e[n]=[...r].sort());return e}function rk(t,e){const n=[];for(const[r,s]of Object.entries(t)){const i=new Set(e[r]??[]);for(const o of s??[])i.has(o)||n.push([r,o])}return n}function Hc(t,e){const n=Bc(t),r=Bc(e),s=Object.keys(n).sort(),i=Object.keys(r).sort();if(s.length!==i.length)return!1;for(let o=0;o<s.length;o++){const a=s[o];if(a!==i[o])return!1;const l=n[a],u=r[a];if(!l||!u||l.length!==u.length)return!1;for(let d=0;d<l.length;d++)if(l[d]!==u[d])return!1}return!0}function sk(t,e){const n={},r=new Set([...Object.keys(t),...Object.keys(e)]);for(const s of r){const i=t[s]??{},o=e[s]??{},a=new Set([...Object.keys(i),...Object.keys(o)]),l={};for(const u of a){const d=i[u]??o[u];d&&(l[u]=d)}Object.keys(l).length>0&&(n[s]=l)}return n}function ik(t,e){const n={},r=new Set([...Object.keys(t),...Object.keys(e)]);for(const s of r){const i=t[s]??{},o=e[s]??{},a=new Set([...Object.keys(i),...Object.keys(o)]),l={};for(const u of a){const d=i[u]??o[u];d&&(l[u]=d)}Object.keys(l).length>0&&(n[s]=l)}return n}function Nn(t,e){return`${t}-${e}`}function Wc(t){return`external-${t}`}function ys(t,e,n){return Ie(new Le(t,e,n))}function Ee(t){return t instanceof Le}function ok(t){return(t==null?void 0:t.type)===Le.getType()}function Pi(t){const e=t.getChildren();let n=null;for(const r of e)n===null?t.insertBefore(r):n.insertAfter(r),n=r;t.remove(),Wt.delete(t.getKey())}function hf(t,e,n,r,s){const i=t.getNodes(),o=t.anchor.offset,a=t.focus.offset,l=i.length,u=t.isBackward(),d=u?a:o,f=u?o:a;let h,p;for(let y=0;y<l;y++){const b=i[y];if(we(p)&&p.isParentOf(b))continue;const w=y===0,M=y===l-1;let v=null;if(ee(b)){const S=b.getTextContentSize(),j=w?d:0,P=M?f:S;if(j===0&&P===0)continue;const D=b.splitText(j,P);v=D.length>1&&(D.length===3||w&&!M||P===S)?D[1]:D[0]}else{if(Ee(b))continue;we(b)&&b.isInline()&&(v=b)}if(v!==null){if(v&&v.is(h))continue;const S=v.getParent();(S==null||!S.is(h))&&(p=void 0),h=S,p===void 0&&(p=ys(),p.addID(e,n,r,s),v.insertBefore(p)),p.append(v)}else h=void 0,p=void 0}e===un&&we(p)&&(u?p.selectStart():p.selectEnd())}function ak(t,e,n){let r=t;for(;r!==null;){if(Ee(r))return r.getTypedIDs()[e];if(ee(r)&&n===r.getTextContentSize()){const s=r.getNextSibling();if(Ee(s))return s.getTypedIDs()[e]}r=r.getParent()}}const ff=1;class vn extends wr{constructor(e="",n="",r){super(r),z(this,"__textType"),z(this,"__text"),this.__textType=e,this.__text=n}static getType(){return"immutable-typed-text"}static clone(e){const{__textType:n,__text:r,__key:s}=e;return new vn(n,r,s)}static importDOM(){return{span:e=>ck(e)?{conversion:lk,priority:1}:null}}static importJSON(e){return yr().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setTextType(e.textType).setTextContent(e.text)}setTextType(e){if(this.__textType===e)return this;const n=this.getWritable();return n.__textType=e,n}getTextType(){return this.getLatest().__textType}setTextContent(e){if(this.__text===e)return this;const n=this.getWritable();return n.__text=e,n}getTextContent(){return this.getLatest().__text}createDOM(){const e=document.createElement("span");return e.setAttribute("data-text-type",this.__textType),e.classList.add(this.__textType),e}updateDOM(){return!1}exportDOM(e){const{element:n}=super.exportDOM(e);return n&&bn(n)&&n.setAttribute("data-text-type",this.getTextType()),{element:n}}decorate(){return this.getTextContent()}exportJSON(){return{type:this.getType(),textType:this.getTextType(),text:this.getTextContent(),version:ff}}isKeyboardSelectable(){return!1}}function lk(t){const e=t.getAttribute("data-text-type")??"",n=t.textContent??"";return{node:yr(e,n)}}function yr(t,e){return Ie(new vn(t,e))}function ck(t){return(t==null?void 0:t.tagName)==="span"}function $i(t){return t instanceof vn}function uk(t){return(t==null?void 0:t.type)===vn.getType()}const Di="unmatched",pf=1;class wn extends wr{constructor(e="",n){super(n),z(this,"__marker"),this.__marker=e}static getType(){return"unmatched"}static clone(e){const{__marker:n,__key:r}=e;return new wn(n,r)}static importDOM(){return{[Di]:e=>hk(e)?{conversion:dk,priority:1}:null}}static importJSON(e){return wl().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker)}setMarker(e){if(this.__marker===e)return this;const n=this.getWritable();return n.__marker=e,n}getMarker(){return this.getLatest().__marker}createDOM(){const e=document.createElement(Di);e.setAttribute("data-marker",this.__marker),e.classList.add(Uc);const n=this.__marker.endsWith("*");return e.title=n?"This closing marker has no matching opening marker!":"This opening marker has no matching closing marker!",e}updateDOM(){return!1}exportDOM(e){const{element:n}=super.exportDOM(e);return n&&bn(n)&&(n.setAttribute("data-marker",this.getMarker()),n.classList.add(Uc)),{element:n}}decorate(){return`\\${this.getMarker()}${xa}`}exportJSON(){return{type:this.getType(),marker:this.getMarker(),version:pf}}isKeyboardSelectable(){return!1}}function dk(t){const e=t.getAttribute("data-marker")??"";return{node:wl(e)}}function wl(t){return Ie(new wn(t))}function hk(t){return(t==null?void 0:t.tagName)===Di}function gf(t){return t instanceof wn}const fk=[dt,Qt,vt,Ge,Ce,$e,$t,Wn,Hn,vn,wn,tt,fn,{replace:Ka,with:()=>bt(),withKlass:fn}];var E;(function(t){t.FileIdentification="FileIdentification",t.Headers="Headers",t.Remarks="Remarks",t.Introduction="Introduction",t.DivisionMarks="DivisionMarks",t.Paragraphs="Paragraphs",t.Poetry="Poetry",t.TitlesHeadings="TitlesHeadings",t.Tables="Tables",t.CenterTables="CenterTables",t.RightTables="RightTables",t.Lists="Lists",t.Footnotes="Footnotes",t.CrossReferences="CrossReferences",t.SpecialText="SpecialText",t.CharacterStyling="CharacterStyling",t.Breaks="Breaks",t.SpecialFeatures="SpecialFeatures",t.PeripheralReferences="PeripheralReferences",t.PeripheralMaterials="PeripheralMaterials",t.Uncategorized="Uncategorized"})(E||(E={}));var T;(function(t){t.Paragraph="Paragraph",t.Character="Character",t.Note="Note",t.Unknown="Unknown"})(T||(T={}));const pk={id:{category:E.FileIdentification,type:T.Paragraph,description:"File identification information (BOOKID, FILENAME, EDITOR, MODIFICATION DATE)",hasEndMarker:!1,children:{FileIdentification:["usfm","ide"],Headers:["h","h1","h2","h3","toc1","toc2","toc3"],Remarks:["rem","sts","restore"],Introduction:["imt","imt1","imt2","imt3","imt4","imte","imte1","imte2","is","is1","is2","iot","io","io1","io2","io3","io4","ior","ip","im","ipi","imi","ili","ili1","ili2","ipq","imq","ipr","ib","iq","iq1","iq2","iq3","iex","ie"],DivisionMarks:["c","cl"],TitlesHeadings:["mt","mt1","mt2","mt3","mt4"]}},usfm:{category:E.FileIdentification,type:T.Paragraph,description:"File markup version information",hasEndMarker:!1,children:void 0},ide:{category:E.FileIdentification,type:T.Paragraph,description:"File encoding information",hasEndMarker:!1,children:{Remarks:["rem","sts"]}},h:{category:E.Headers,type:T.Paragraph,description:"Running header text for a book (basic)",hasEndMarker:!1,children:{Headers:["toc1","toc2","toc3","toca1","toca2","toca3"]}},h1:{category:E.Headers,type:T.Paragraph,description:"Running header text",hasEndMarker:!1,children:{Headers:["toc1","toc2","toc3","toca1","toca2","toca3"]}},h2:{category:E.Headers,type:T.Paragraph,description:"Running header text, left side of page",hasEndMarker:!1,children:{Headers:["toc1","toc2","toc3","toca1","toca2","toca3"]}},h3:{category:E.Headers,type:T.Paragraph,description:"Running header text, right side of page",hasEndMarker:!1,children:{Headers:["toc1","toc2","toc3","toca1","toca2","toca3"]}},toc1:{category:E.Headers,type:T.Paragraph,description:"Long table of contents text",hasEndMarker:!1,children:void 0},toc2:{category:E.Headers,type:T.Paragraph,description:"Short table of contents text",hasEndMarker:!1,children:void 0},toc3:{category:E.Headers,type:T.Paragraph,description:"Book Abbreviation",hasEndMarker:!1,children:void 0},toca1:{category:E.Headers,type:T.Paragraph,description:"Alternative language long table of contents text",hasEndMarker:!1,children:void 0},toca2:{category:E.Headers,type:T.Paragraph,description:"Alternative language short table of contents text",hasEndMarker:!1,children:void 0},toca3:{category:E.Headers,type:T.Paragraph,description:"Alternative language book Abbreviation",hasEndMarker:!1,children:void 0},rem:{category:E.Remarks,type:T.Paragraph,description:"Comments and remarks",hasEndMarker:!1,children:void 0},sts:{category:E.Remarks,type:T.Paragraph,description:"Status of this file",hasEndMarker:!1,children:void 0},restore:{category:E.Remarks,type:T.Paragraph,description:"Project restore information",hasEndMarker:!1,children:void 0},imt:{category:E.Introduction,type:T.Paragraph,description:"Introduction major title, level 1 (if single level) (basic)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imt1:{category:E.Introduction,type:T.Paragraph,description:"Introduction major title, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imt2:{category:E.Introduction,type:T.Paragraph,description:"Introduction major title, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imt3:{category:E.Introduction,type:T.Paragraph,description:"Introduction major title, level 3",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imt4:{category:E.Introduction,type:T.Paragraph,description:"Introduction major title, level 4 (usually within parenthesis)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imte:{category:E.Introduction,type:T.Paragraph,description:"Introduction major title at introduction end, level 1 (if single level)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imte1:{category:E.Introduction,type:T.Paragraph,description:"Introduction major title at introduction end, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imte2:{category:E.Introduction,type:T.Paragraph,description:"Introduction major title at introduction end, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},is:{category:E.Introduction,type:T.Paragraph,description:"Introduction section heading, level 1 (if single level) (basic)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"],CharacterStyling:["no"]}},is1:{category:E.Introduction,type:T.Paragraph,description:"Introduction section heading, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},is2:{category:E.Introduction,type:T.Paragraph,description:"Introduction section heading, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},iot:{category:E.Introduction,type:T.Paragraph,description:"Introduction outline title (basic)",hasEndMarker:!1,children:{Introduction:["iqt"],CharacterStyling:["no"]}},io:{category:E.Introduction,type:T.Paragraph,description:"Introduction outline text, level 1 (if single level)",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},io1:{category:E.Introduction,type:T.Paragraph,description:"Introduction outline text, level 1 (if multiple levels) (basic)",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},io2:{category:E.Introduction,type:T.Paragraph,description:"Introduction outline text, level 2",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},io3:{category:E.Introduction,type:T.Paragraph,description:"Introduction outline text, level 3",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},io4:{category:E.Introduction,type:T.Paragraph,description:"Introduction outline text, level 4",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ior:{category:E.Introduction,type:T.Character,description:"Introduction references range for outline entry; for marking references separately",hasEndMarker:!0,children:void 0},ip:{category:E.Introduction,type:T.Paragraph,description:"Introduction prose paragraph (basic)",hasEndMarker:!1,children:{Introduction:["iqt"],Footnotes:["f","fe","fm"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},im:{category:E.Introduction,type:T.Paragraph,description:"Introduction prose paragraph, with no first line indent (may occur after poetry)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ipi:{category:E.Introduction,type:T.Paragraph,description:"Introduction prose paragraph, indented, with first line indent",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},imi:{category:E.Introduction,type:T.Paragraph,description:"Introduction prose paragraph text, indented, with no first line indent",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ili:{category:E.Introduction,type:T.Paragraph,description:"A list entry, level 1 (if single level)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ili1:{category:E.Introduction,type:T.Paragraph,description:"A list entry, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ili2:{category:E.Introduction,type:T.Paragraph,description:"A list entry, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ipq:{category:E.Introduction,type:T.Paragraph,description:"Introduction prose paragraph, quote from the body text",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},imq:{category:E.Introduction,type:T.Paragraph,description:"Introduction prose paragraph, quote from the body text, with no first line indent",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ipr:{category:E.Introduction,type:T.Paragraph,description:"Introduction prose paragraph, right aligned",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},ib:{category:E.Introduction,type:T.Paragraph,description:"Introduction blank line",hasEndMarker:!1,children:{Introduction:["iqt"]}},iq:{category:E.Introduction,type:T.Paragraph,description:"Introduction poetry text, level 1 (if single level)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},iq1:{category:E.Introduction,type:T.Paragraph,description:"Introduction poetry text, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},iq2:{category:E.Introduction,type:T.Paragraph,description:"Introduction poetry text, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},iq3:{category:E.Introduction,type:T.Paragraph,description:"Introduction poetry text, level 3",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},iex:{category:E.Introduction,type:T.Paragraph,description:"Introduction explanatory or bridge text (e.g. explanation of missing book in Short Old Testament)",hasEndMarker:!1,children:{Introduction:["iqt"],CharacterStyling:["no"]}},iqt:{category:E.Introduction,type:T.Character,description:"For quoted scripture text appearing in the introduction",hasEndMarker:!0,children:void 0},ie:{category:E.Introduction,type:T.Paragraph,description:"Introduction ending marker",hasEndMarker:!1,children:void 0},c:{category:E.DivisionMarks,type:T.Paragraph,description:"Chapter number",hasEndMarker:!1,children:{DivisionMarks:["ca","cp","cl","cd"],Paragraphs:["p","m","po","pr","cls","pi","pi1","pi2","pi3","pc","mi","nb"],Poetry:["q","q1","q2","q3","q4","qc","qr","qa","qd","b"],TitlesHeadings:["mte","ms","ms1","ms2","ms3","s","s1","s2","s3","s4","r","sp","d","sd","sd1","sd2","sd3","sd4"],Lists:["lh","li","li1","li2","li3","li4","lf","lim","lim1","lim2","lim3","lim4"],Footnotes:["f","fe"],SpecialText:["lit"],Breaks:["pb"]}},ca:{category:E.DivisionMarks,type:T.Character,description:"Second (alternate) chapter number (for coding dual versification; useful for places where different traditions of chapter breaks need to be supported in the same translation)",hasEndMarker:!0,children:void 0},cp:{category:E.DivisionMarks,type:T.Paragraph,description:"Published chapter number (chapter string that should appear in the published text)",hasEndMarker:!1,children:{Footnotes:["f"]}},cl:{category:E.DivisionMarks,type:T.Paragraph,description:"Chapter label used for translations that add a word such as 'Chapter' before chapter numbers (e.g. Psalms). The subsequent text is the chapter label.",hasEndMarker:!1,children:void 0},cd:{category:E.DivisionMarks,type:T.Paragraph,description:"Chapter Description (Publishing option D, e.g. in Russian Bibles)",hasEndMarker:!1,children:{DivisionMarks:["vp"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},v:{category:E.DivisionMarks,type:T.Character,description:"A verse number",hasEndMarker:!1,children:void 0},va:{category:E.DivisionMarks,type:T.Character,description:"Second (alternate) verse number (for coding dual numeration in Psalms; see also NRSV Exo 22.1-4)",hasEndMarker:!0,children:void 0},vp:{category:E.DivisionMarks,type:T.Character,description:"Published verse marker (verse string that should appear in the published text)",hasEndMarker:!0,children:void 0},p:{category:E.Paragraphs,type:T.Paragraph,description:"Paragraph text, with first line indent (basic)",hasEndMarker:!1,children:{Paragraphs:["pmo","pm","pmc","pmr"],Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},m:{category:E.Paragraphs,type:T.Paragraph,description:"Paragraph text, with no first line indent (may occur after poetry) (basic)",hasEndMarker:!1,children:{Paragraphs:["pmo","pm","pmc","pmr"],Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},po:{category:E.Paragraphs,type:T.Paragraph,description:"Letter opening",hasEndMarker:!1,children:{Paragraphs:["pmo","pm","pmc","pmr"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pr:{category:E.Paragraphs,type:T.Paragraph,description:"Text refrain (paragraph text, right aligned)",hasEndMarker:!1,children:{Paragraphs:["pmo","pm","pmc","pmr"],Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},cls:{category:E.Paragraphs,type:T.Paragraph,description:"Letter Closing",hasEndMarker:!1,children:{SpecialText:["tl","sig","pn","png","addpn","add"]}},pmo:{category:E.Paragraphs,type:T.Paragraph,description:"Embedded text opening",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pm:{category:E.Paragraphs,type:T.Paragraph,description:"Embedded text paragraph",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pmc:{category:E.Paragraphs,type:T.Paragraph,description:"Embedded text closing",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pmr:{category:E.Paragraphs,type:T.Paragraph,description:"Embedded text refrain (e.g. Then all the people shall say, 'Amen!')",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pi:{category:E.Paragraphs,type:T.Paragraph,description:"Paragraph text, level 1 indent (if single level), with first line indent; often used for discourse (basic)",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pi1:{category:E.Paragraphs,type:T.Paragraph,description:"Paragraph text, level 1 indent (if multiple levels), with first line indent; often used for discourse",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pi2:{category:E.Paragraphs,type:T.Paragraph,description:"Paragraph text, level 2 indent, with first line indent; often used for discourse",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pi3:{category:E.Paragraphs,type:T.Paragraph,description:"Paragraph text, level 3 indent, with first line indent; often used for discourse",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pc:{category:E.Paragraphs,type:T.Paragraph,description:"Paragraph text, centered (for Inscription)",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},mi:{category:E.Paragraphs,type:T.Paragraph,description:"Paragraph text, indented, with no first line indent; often used for discourse",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},nb:{category:E.Paragraphs,type:T.Paragraph,description:"Paragraph text, with no break from previous paragraph text (at chapter boundary) (basic)",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q:{category:E.Poetry,type:T.Paragraph,description:"Poetry text, level 1 indent (if single level)",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q1:{category:E.Poetry,type:T.Paragraph,description:"Poetry text, level 1 indent (if multiple levels) (basic)",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q2:{category:E.Poetry,type:T.Paragraph,description:"Poetry text, level 2 indent (basic)",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q3:{category:E.Poetry,type:T.Paragraph,description:"Poetry text, level 3 indent",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q4:{category:E.Poetry,type:T.Paragraph,description:"Poetry text, level 4 indent",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qc:{category:E.Poetry,type:T.Paragraph,description:"Poetry text, centered",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qr:{category:E.Poetry,type:T.Paragraph,description:"Poetry text, Right Aligned",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qs:{category:E.Poetry,type:T.Character,description:"Poetry text, Selah",hasEndMarker:!0,children:{Footnotes:["f"],CrossReferences:["x"]}},qa:{category:E.Poetry,type:T.Paragraph,description:"Poetry text, Acrostic marker/heading",hasEndMarker:!1,children:void 0},qac:{category:E.Poetry,type:T.Character,description:"Poetry text, Acrostic markup of the first character of a line of acrostic poetry",hasEndMarker:!0,children:void 0},qm:{category:E.Poetry,type:T.Paragraph,description:"Poetry text, embedded, level 1 indent (if single level)",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qm1:{category:E.Poetry,type:T.Paragraph,description:"Poetry text, embedded, level 1 indent (if multiple levels)",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qm2:{category:E.Poetry,type:T.Paragraph,description:"Poetry text, embedded, level 2 indent",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qm3:{category:E.Poetry,type:T.Paragraph,description:"Poetry text, embedded, level 3 indent",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qd:{category:E.Poetry,type:T.Paragraph,description:"A Hebrew musical performance annotation, similar in content to Hebrew descriptive title.",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},b:{category:E.Poetry,type:T.Paragraph,description:"Poetry text stanza break (e.g. stanza break) (basic)",hasEndMarker:!1,children:void 0},mt:{category:E.TitlesHeadings,type:T.Paragraph,description:"The main title of the book (if single level)",hasEndMarker:!1,children:{Footnotes:["f"],CrossReferences:["x"]}},mt1:{category:E.TitlesHeadings,type:T.Paragraph,description:"The main title of the book (if multiple levels) (basic)",hasEndMarker:!1,children:{Footnotes:["f"],CrossReferences:["x"]}},mt2:{category:E.TitlesHeadings,type:T.Paragraph,description:"A secondary title usually occurring before the main title (basic)",hasEndMarker:!1,children:{Footnotes:["f"],CrossReferences:["x"]}},mt3:{category:E.TitlesHeadings,type:T.Paragraph,description:"A secondary title occurring after the main title",hasEndMarker:!1,children:{Footnotes:["f"],CrossReferences:["x"]}},mt4:{category:E.TitlesHeadings,type:T.Paragraph,description:"A small secondary title sometimes occurring within parentheses",hasEndMarker:!1,children:void 0},mte:{category:E.TitlesHeadings,type:T.Paragraph,description:"The main title of the book repeated at the end of the book, level 1 (if single level)",hasEndMarker:!1,children:void 0},mte1:{category:E.TitlesHeadings,type:T.Paragraph,description:"The main title of the book repeated at the end of the book, level 1 (if multiple levels)",hasEndMarker:!1,children:{TitlesHeadings:["mte2"]}},mte2:{category:E.TitlesHeadings,type:T.Paragraph,description:"A secondary title occurring before or after the 'ending' main title",hasEndMarker:!1,children:void 0},ms:{category:E.TitlesHeadings,type:T.Paragraph,description:"A major section division heading, level 1 (if single level) (basic)",hasEndMarker:!1,children:{TitlesHeadings:["mr"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},ms1:{category:E.TitlesHeadings,type:T.Paragraph,description:"A major section division heading, level 1 (if multiple levels)",hasEndMarker:!1,children:{TitlesHeadings:["mr"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},ms2:{category:E.TitlesHeadings,type:T.Paragraph,description:"A major section division heading, level 2",hasEndMarker:!1,children:{TitlesHeadings:["mr"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},ms3:{category:E.TitlesHeadings,type:T.Paragraph,description:"A major section division heading, level 3",hasEndMarker:!1,children:{TitlesHeadings:["mr"],Footnotes:["f","fe"]}},mr:{category:E.TitlesHeadings,type:T.Paragraph,description:"A major section division references range heading (basic)",hasEndMarker:!1,children:void 0},s:{category:E.TitlesHeadings,type:T.Paragraph,description:"A section heading, level 1 (if single level) (basic)",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},s1:{category:E.TitlesHeadings,type:T.Paragraph,description:"A section heading, level 1 (if multiple levels)",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},s2:{category:E.TitlesHeadings,type:T.Paragraph,description:"A section heading, level 2 (e.g. Proverbs 22-24)",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},s3:{category:E.TitlesHeadings,type:T.Paragraph,description:"A section heading, level 3 (e.g. Genesis 'The First Day')",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},s4:{category:E.TitlesHeadings,type:T.Paragraph,description:"A section heading, level 4",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},sr:{category:E.TitlesHeadings,type:T.Paragraph,description:"A section division references range heading",hasEndMarker:!1,children:void 0},r:{category:E.TitlesHeadings,type:T.Paragraph,description:"Parallel reference(s) (basic)",hasEndMarker:!1,children:void 0},sp:{category:E.TitlesHeadings,type:T.Paragraph,description:"A heading, to identify the speaker (e.g. Job)",hasEndMarker:!1,children:{Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},d:{category:E.TitlesHeadings,type:T.Paragraph,description:"A Hebrew text heading, to provide description (e.g. Psalms)",hasEndMarker:!1,children:{Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},sd:{category:E.TitlesHeadings,type:T.Paragraph,description:"Vertical space used to divide the text into sections, level 1 (if single level)",hasEndMarker:!1,children:void 0},sd1:{category:E.TitlesHeadings,type:T.Paragraph,description:"Vertical space used to divide the text into sections, level 1 (if multiple levels)",hasEndMarker:!1,children:void 0},sd2:{category:E.TitlesHeadings,type:T.Paragraph,description:"Vertical space used to divide the text into sections, level 2",hasEndMarker:!1,children:void 0},sd3:{category:E.TitlesHeadings,type:T.Paragraph,description:"Vertical space used to divide the text into sections, level 3",hasEndMarker:!1,children:void 0},sd4:{category:E.TitlesHeadings,type:T.Paragraph,description:"Vertical space used to divide the text into sections, level 4",hasEndMarker:!1,children:void 0},lh:{category:E.Lists,type:T.Paragraph,description:"List header (introductory remark)",hasEndMarker:!1,children:{Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li:{category:E.Lists,type:T.Paragraph,description:"A list entry, level 1 (if single level)",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li1:{category:E.Lists,type:T.Paragraph,description:"A list entry, level 1 (if multiple levels)",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li2:{category:E.Lists,type:T.Paragraph,description:"A list entry, level 2",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li3:{category:E.Lists,type:T.Paragraph,description:"A list entry, level 3",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li4:{category:E.Lists,type:T.Paragraph,description:"A list entry, level 4",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lf:{category:E.Lists,type:T.Paragraph,description:"List footer (concluding remark)",hasEndMarker:!1,children:{Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim:{category:E.Lists,type:T.Paragraph,description:"An embedded list entry, level 1 (if single level)",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim1:{category:E.Lists,type:T.Paragraph,description:"An embedded list entry, level 1 (if multiple levels)",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim2:{category:E.Lists,type:T.Paragraph,description:"An embedded list entry, level 2",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim3:{category:E.Lists,type:T.Paragraph,description:"An embedded list item, level 3",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim4:{category:E.Lists,type:T.Paragraph,description:"An embedded list entry, level 4",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},litl:{category:E.Lists,type:T.Character,description:"List entry total text",hasEndMarker:!0,children:void 0},lik:{category:E.Lists,type:T.Character,description:"Structured list entry key text",hasEndMarker:!0,children:void 0},liv:{category:E.Lists,type:T.Character,description:"Structured list entry value 1 content (if single value)",hasEndMarker:!0,children:void 0},liv1:{category:E.Lists,type:T.Character,description:"Structured list entry value 1 content (if multiple values)",hasEndMarker:!0,children:void 0},liv2:{category:E.Lists,type:T.Character,description:"Structured list entry value 2 content",hasEndMarker:!0,children:void 0},liv3:{category:E.Lists,type:T.Character,description:"Structured list entry value 3 content",hasEndMarker:!0,children:void 0},liv4:{category:E.Lists,type:T.Character,description:"Structured list entry value 4 content",hasEndMarker:!0,children:void 0},liv5:{category:E.Lists,type:T.Character,description:"Structured list entry value 5 content",hasEndMarker:!0,children:void 0},f:{category:E.Footnotes,type:T.Note,description:"A Footnote text item (basic)",hasEndMarker:!0,children:{Footnotes:["fr","ft","fk","fq","fqa","fl","fw","fp","fv","fdc"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},fe:{category:E.Footnotes,type:T.Note,description:"An Endnote text item",hasEndMarker:!0,children:{Footnotes:["fr","ft","fk","fq","fqa","fl","fw","fp","fv","fdc"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},fr:{category:E.Footnotes,type:T.Character,description:"The origin reference for the footnote (basic)",hasEndMarker:!0,children:void 0},ft:{category:E.Footnotes,type:T.Character,description:"Footnote text, Protocanon (basic)",hasEndMarker:!0,children:void 0},fk:{category:E.Footnotes,type:T.Character,description:"A footnote keyword (basic)",hasEndMarker:!0,children:void 0},fq:{category:E.Footnotes,type:T.Character,description:"A footnote scripture quote or alternate rendering (basic)",hasEndMarker:!0,children:void 0},fqa:{category:E.Footnotes,type:T.Character,description:"A footnote alternate rendering for a portion of scripture text",hasEndMarker:!0,children:void 0},fl:{category:E.Footnotes,type:T.Character,description:"A footnote label text item, for marking or 'labelling' the type or alternate translation being provided in the note.",hasEndMarker:!0,children:void 0},fw:{category:E.Footnotes,type:T.Character,description:"A footnote witness list, for distinguishing a list of sigla representing witnesses in critical editions.",hasEndMarker:!0,children:void 0},fp:{category:E.Footnotes,type:T.Character,description:"A Footnote additional paragraph marker",hasEndMarker:!0,children:void 0},fv:{category:E.Footnotes,type:T.Character,description:"A verse number within the footnote text",hasEndMarker:!0,children:void 0},fdc:{category:E.Footnotes,type:T.Character,description:"Footnote text, applies to Deuterocanon only",hasEndMarker:!0,children:void 0},fm:{category:E.Footnotes,type:T.Character,description:"An additional footnote marker location for a previous footnote",hasEndMarker:!0,children:void 0},x:{category:E.CrossReferences,type:T.Note,description:"A list of cross references (basic)",hasEndMarker:!0,children:{CrossReferences:["xo","xop","xt","xta","xk","xq","xot","xnt","xdc"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},xo:{category:E.CrossReferences,type:T.Character,description:"The cross reference origin reference (basic)",hasEndMarker:!0,children:void 0},xop:{category:E.CrossReferences,type:T.Character,description:"Published cross reference origin reference (origin reference that should appear in the published text)",hasEndMarker:!0,children:void 0},xt:{category:E.CrossReferences,type:T.Character,description:"The cross reference target reference(s), protocanon only (basic)",hasEndMarker:!0,children:void 0},xta:{category:E.CrossReferences,type:T.Character,description:"Cross reference target references added text",hasEndMarker:!0,children:void 0},xk:{category:E.CrossReferences,type:T.Character,description:"A cross reference keyword",hasEndMarker:!0,children:void 0},xq:{category:E.CrossReferences,type:T.Character,description:"A cross-reference quotation from the scripture text",hasEndMarker:!0,children:void 0},xot:{category:E.CrossReferences,type:T.Character,description:"Cross-reference target reference(s), Old Testament only",hasEndMarker:!0,children:void 0},xnt:{category:E.CrossReferences,type:T.Character,description:"Cross-reference target reference(s), New Testament only",hasEndMarker:!0,children:void 0},xdc:{category:E.CrossReferences,type:T.Character,description:"Cross-reference target reference(s), Deuterocanon only",hasEndMarker:!0,children:void 0},rq:{category:E.CrossReferences,type:T.Character,description:"A cross-reference indicating the source text for the preceding quotation.",hasEndMarker:!0,children:void 0},qt:{category:E.SpecialText,type:T.Character,description:"For Old Testament quoted text appearing in the New Testament (basic)",hasEndMarker:!0,children:void 0},nd:{category:E.SpecialText,type:T.Character,description:"For name of deity (basic)",hasEndMarker:!0,children:void 0},tl:{category:E.SpecialText,type:T.Character,description:"For transliterated words",hasEndMarker:!0,children:void 0},dc:{category:E.SpecialText,type:T.Character,description:"Deuterocanonical/LXX additions or insertions in the Protocanonical text",hasEndMarker:!0,children:void 0},bk:{category:E.SpecialText,type:T.Character,description:"For the quoted name of a book",hasEndMarker:!0,children:void 0},sig:{category:E.SpecialText,type:T.Character,description:"For the signature of the author of an Epistle",hasEndMarker:!0,children:void 0},pn:{category:E.SpecialText,type:T.Character,description:"For a proper name",hasEndMarker:!0,children:void 0},png:{category:E.SpecialText,type:T.Character,description:"For a geographic proper name",hasEndMarker:!0,children:void 0},addpn:{category:E.SpecialText,type:T.Character,description:"For chinese words to be dot underline & underline",hasEndMarker:!0,children:void 0},wj:{category:E.SpecialText,type:T.Character,description:"For marking the words of Jesus",hasEndMarker:!0,children:void 0},k:{category:E.SpecialText,type:T.Character,description:"For a keyword",hasEndMarker:!0,children:void 0},sls:{category:E.SpecialText,type:T.Character,description:"To represent where the original text is in a secondary language or from an alternate text source",hasEndMarker:!0,children:void 0},ord:{category:E.SpecialText,type:T.Character,description:"For the text portion of an ordinal number",hasEndMarker:!0,children:void 0},add:{category:E.SpecialText,type:T.Character,description:"For a translational addition to the text",hasEndMarker:!0,children:void 0},lit:{category:E.SpecialText,type:T.Paragraph,description:"For a comment or note inserted for liturgical use",hasEndMarker:!1,children:void 0},no:{category:E.CharacterStyling,type:T.Character,description:"A character style, use normal text",hasEndMarker:!0,children:void 0},it:{category:E.CharacterStyling,type:T.Character,description:"A character style, use italic text",hasEndMarker:!0,children:void 0},bd:{category:E.CharacterStyling,type:T.Character,description:"A character style, use bold text",hasEndMarker:!0,children:void 0},bdit:{category:E.CharacterStyling,type:T.Character,description:"A character style, use bold + italic text",hasEndMarker:!0,children:void 0},em:{category:E.CharacterStyling,type:T.Character,description:"A character style, use emphasized text style",hasEndMarker:!0,children:void 0},sc:{category:E.CharacterStyling,type:T.Character,description:"A character style, for small capitalization text",hasEndMarker:!0,children:void 0},sup:{category:E.CharacterStyling,type:T.Character,description:"A character style, for superscript text. Typically for use in critical edition footnotes.",hasEndMarker:!0,children:void 0},pb:{category:E.Breaks,type:T.Paragraph,description:"Page Break used for new reader portions and children's bibles where content is controlled by the page",hasEndMarker:!1,children:void 0}},In={DivisionMarks:{add:["v","c"],remove:[]},Paragraphs:{add:["p"],remove:[]},Poetry:{add:["q","q1","q2","q3","q4","b"],remove:[]},TitlesHeadings:{add:["mte","ms","ms1","ms2","ms3","s","s1","s2","s3","s4","r","sp","d","sd","sd1","sd2","sd3","sd4"],remove:[]}},gk={p:{children:In},q:{children:In},q1:{children:In},q2:{children:In},q3:{children:In},q4:{children:In},b:{children:In},qm:{children:{Paragraphs:{add:["p"],remove:[]}}},c:{type:T.Paragraph,children:null},v:{children:null}};function zc(t){const e=pk[t],n=gk[t];if(!e)return;if(!n)return e;let r=e.children?{...e.children}:void 0;if(n.children===null&&(r=void 0),n.children){r=r||{};for(const[s,i]of Object.entries(n.children)){const o=s;if(i===null)Reflect.deleteProperty(r,o);else{let a=r[o]||[];i.remove&&(a=a.filter(l=>!i.remove.includes(l))),i.add&&(a=[...new Set([...a,...i.add])]),a.length>0?r[o]=a:Reflect.deleteProperty(r,o)}}Object.keys(r).length===0&&(r=void 0)}return{...e,...n,children:r}}function Kc(t,e,n){const r={type:as,version:ls,content:t},s=e.serializeEditorState(r,n);return fl(s.root.children[0])?s.root.children[0].children[0]:s.root.children[0]}function ja(t,e){if(!t||!ee(t))return[void 0,void 0];const n=t.getTextContent();if(e>=0&&e<n.length)return[t,e];let r=t.getNextSibling();if(!r){const i=t.getParent();Ee(i)&&(r=i.getNextSibling())}if(!r||!Ee(r)&&!ee(r))return[void 0,void 0];const s=e-n.length;return r&&ee(r)?ja(r,s):ja(r.getFirstChild()??void 0,s)}function Jc(t){const e=ip(t.jsonPath);let n=Dt();for(const r of e){if(!n||!we(n))return[void 0,void 0];n=n.getChildAtIndex(r)??void 0}return ja(n,t.offset)}function Vc(t){return we(t)?"element":"text"}function xl(t){const{start:e}=t;let{end:n}=t;n===void 0&&(n=e);const[r,s]=Jc(e),[i,o]=Jc(n);if(!r||!i||s===void 0||o===void 0)return;const a=Ed();return a.anchor=Fl(r.getKey(),s,Vc(r)),a.focus=Fl(i.getKey(),o,Vc(i)),a}function Gc(t,e){const n=[];let r=t;for(;r!=null&&r.getParent();){const s=r.getParent();if(s){const i=s==null?void 0:s.getChildren().indexOf(r);i>=0&&n.unshift(i)}r=s}return{jsonPath:op(n),offset:e}}function mf(){const t=re();if(!t||!X(t))return;const e=t.isBackward()?t.focus.getNode():t.anchor.getNode(),n=t.isBackward()?t.focus.offset:t.anchor.offset,r=Gc(e,n);if(t.isCollapsed())return{start:r};const s=t.isBackward()?t.anchor.getNode():t.focus.getNode(),i=t.isBackward()?t.anchor.offset:t.focus.offset,o=Gc(s,i);return{start:r,end:o}}const yf="v",bf=1;class Ye extends wr{constructor(e="",n=!1,r,s,i,o,a){super(a),z(this,"__marker"),z(this,"__number"),z(this,"__showMarker"),z(this,"__sid"),z(this,"__altnumber"),z(this,"__pubnumber"),z(this,"__unknownAttributes"),this.__marker=yf,this.__number=e,this.__showMarker=n,this.__sid=r,this.__altnumber=s,this.__pubnumber=i,this.__unknownAttributes=o}static getType(){return"immutable-verse"}static clone(e){const{__number:n,__showMarker:r,__sid:s,__altnumber:i,__pubnumber:o,__unknownAttributes:a,__key:l}=e;return new Ye(n,r,s,i,o,a,l)}static importDOM(){return{span:e=>yk(e)?{conversion:mk,priority:1}:null}}static importJSON(e){return Cl().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setNumber(e.number).setShowMarker(e.showMarker).setSid(e.sid).setAltnumber(e.altnumber).setPubnumber(e.pubnumber).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const n=this.getWritable();return n.__marker=e,n}getMarker(){return this.getLatest().__marker}setNumber(e){if(this.__number===e)return this;const n=this.getWritable();return n.__number=e,n}getNumber(){return this.getLatest().__number}setShowMarker(e=!1){if(this.__showMarker===e)return this;const n=this.getWritable();return n.__showMarker=e,n}getShowMarker(){return this.getLatest().__showMarker}setSid(e){if(this.__sid===e)return this;const n=this.getWritable();return n.__sid=e,n}getSid(){return this.getLatest().__sid}setAltnumber(e){if(this.__altnumber===e)return this;const n=this.getWritable();return n.__altnumber=e,n}getAltnumber(){return this.getLatest().__altnumber}setPubnumber(e){if(this.__pubnumber===e)return this;const n=this.getWritable();return n.__pubnumber=e,n}getPubnumber(){return this.getLatest().__pubnumber}setUnknownAttributes(e){const n=this.getWritable();return n.__unknownAttributes=e,n}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("span");return e.setAttribute("data-marker",this.__marker),e.classList.add(Ca,`usfm_${this.__marker}`),this.__showMarker&&e.classList.add("marker"),e.setAttribute("data-number",this.__number),e}updateDOM(){return!1}exportDOM(e){const{element:n}=super.exportDOM(e);return n&&bn(n)&&(n.setAttribute("data-marker",this.getMarker()),n.classList.add(Ca,`usfm_${this.getMarker()}`),n.setAttribute("data-number",this.getNumber())),{element:n}}decorate(){return m.jsx("span",{children:this.getShowMarker()?Cs(this.getMarker(),this.getNumber()):xa+this.getNumber()+xa})}exportJSON(){return{type:this.getType(),marker:this.getMarker(),number:this.getNumber(),showMarker:this.getShowMarker(),sid:this.getSid(),altnumber:this.getAltnumber(),pubnumber:this.getPubnumber(),unknownAttributes:this.getUnknownAttributes(),version:bf}}isKeyboardSelectable(){return!1}}function mk(t){const e=t.getAttribute("data-number")??"0";return{node:Cl(e)}}function Cl(t,e,n,r,s,i){return Ie(new Ye(t,e,n,r,s,i))}function yk(t){return((t==null?void 0:t.getAttribute("data-marker"))??void 0)===yf}function Er(t){return t instanceof Ye}function bk(t){return(t==null?void 0:t.type)===Ye.getType()}function ut(t){return ml(t)||Er(t)}function _k(t){return F_(t)||bk(t)}function kk(t,e,n,r,s,i,o){if(!$e.isValidMarker(t))throw new Error(`$insertNote: Invalid note marker '${t}'`);const a=n?xl(n):re();if(!X(a))return;const l=vk(a,t,r,o);if(l===void 0)return;const u=kf(t,e,l,s,i);return _f(u,a,s),u}function _f(t,e,n){const r=(n==null?void 0:n.noteMode)==="collapsed";if(t.setIsCollapsed(r),e.isCollapsed()||G_(e),e.insertNodes([t]),!r){const s=t.getChildren().reverse().find(pe);s==null||s.selectEnd()}}function vk(t,e,n,r){const s=[],{chapterNum:i,verseNum:o}=n??{};switch(e){case"f":case"fe":case"ef":case"efe":if(i!==void 0&&o!==void 0&&s.push(gt("fr").append(_e(`${i}:${o}`))),!t.isCollapsed()){const a=t.getTextContent().trim();if(a.length>0){const l=gt("fq").append(_e(a));s.push(l)}}s.push(gt("ft").append(_e(Gt)));break;case"x":case"ex":if(i!==void 0&&o!==void 0&&s.push(gt("xo").append(_e(`${i}:${o}`))),!t.isCollapsed()){const a=t.getTextContent().trim();if(a.length>0){const l=gt("xq").append(_e(a));s.push(l)}}s.push(gt("xt").append(_e(Gt)));break;default:r==null||r.warn(`$createNoteChildren: Unsupported note marker '${e}'`);return}return s}function kf(t,e,n,r,s,i){const o=(r==null?void 0:r.noteMode)!=="expanded",a=gl(t,e,o);i&&Mt(a,hn,()=>i);let l,u;(r==null?void 0:r.markerMode)==="editable"?(l=mr(t),u=mr(t,"closing")):(r==null?void 0:r.markerMode)==="visible"&&(l=yr("marker",en(t)+me),u=yr("marker",gr(t)+me));let d;if(l&&a.append(l),(r==null?void 0:r.markerMode)==="editable")e===""?a.append(...n):(d=_e(_l(a.__caller)),a.append(d,...n));else{const f=()=>_e(me),h=n.flatMap(xk(f));if(e==="")a.append(...h);else{const p=kl(n);let y=()=>{};s!=null&&s.noteCallerOnClick&&(y=s.noteCallerOnClick),d=Ol(a.__caller,p,y),a.append(d,f(),...h)}}return u&&a.append(u),a}function Yc(t){var e;if(typeof t=="string"){const s=Te(t);return oe(s)?s:void 0}const n=vr();if(n.length<=0)return;const r=(e=n.filter(s=>oe(s.node))[t])==null?void 0:e.node;if(oe(r))return r}function wk(t,e){const n=(e==null?void 0:e.noteMode)==="collapsed";if(t.setIsCollapsed(n),n){const r=t.getPreviousSibling();if(Er(r)||!r){const s=t.getParent();if(s){const i=t.getIndexWithinParent();s.select(i,i)}}else r.selectEnd()}else{const r=t.getChildren().reverse().find(pe);r==null||r.selectEnd()}}function xk(t){return e=>$i(e)?[e]:[e,t()]}function Ck(t){return t.find(e=>Ke(e))}function Sk(t,e){return we(t)?t.getChildren().find(n=>ut(n)&&vl(e,n.getNumber())):void 0}function Tk(t,e){return e===0?Ck(t):t.map(n=>Sk(n,e)).filter(n=>n)[0]}function Xc(t){return!t||!we(t)?void 0:t.getChildren().findLast(e=>ut(e))}function vf(t){var e,n;if(!t||ct(t))return;if(ut(t))return t;let r=Ee(t.getParent())?(e=t.getParent())==null?void 0:e.getPreviousSibling():t.getPreviousSibling();for(;r&&!ut(r)&&!ct(r);)r=r.getPreviousSibling();if(r&&ut(r))return r;let s=(n=t.getTopLevelElement())==null?void 0:n.getPreviousSibling(),i=Xc(s),o=i;for(;s&&!i&&!ct(s);)i=o,s=s.getPreviousSibling(),o=Xc(s);if(!(!i&&ct(s)))return i}function Ek(t){return W_(t)||Er(t)}function Sl(t){if(ee(t)){const e=t.getTextContent();!e.endsWith(" ")&&!e.endsWith(me)&&t.setTextContent(`${e} `)}}function wf(t){if(ee(t)){const e=t.getTextContent();e.startsWith(" ")&&t.setTextContent(e.trimStart())}}function Tl(t,e){return t.getEditorState().read(()=>!Te(e))}const Ok=["style"],Mk=["style","code"],qi=["style","cid"],Ak=["style","number","sid","altnumber","pubnumber"],jk=["style","number","sid","altnumber","pubnumber"],Nk=["style","sid","eid"],Ik=["style","caller","category","contents"],Rk=["tag","marker","contents"],Pk=["chapter","immutable-chapter","verse","immutable-verse","ms","note","unknown","unmatched"],bs=`
`;function $k(t,e){const n=Te(t);if(!kt(n))return;const r=xf(n);return r===void 0?void 0:[{retain:r},...e,{delete:1}]}function xf(t){if(!t)return;const e=vr();let n=0;const r=[],s=[],i=t.getKey();let o;for(const a of e){const l=a.node;for(let d=r.length-1;d>=0;d--)if(br(r[d],a)){const f=r[d];if(r.splice(d,1),n+=1,o&&f.getKey()===o.getKey())return n-1}for(let d=s.length-1;d>=0;d--)br(s[d].node,a)&&s.splice(d,1);const u=s[s.length-1];if(u){if(l.getKey()===i)return u.position;continue}if(l.getKey()===i){if(ee(l)||kt(l))return n;ht(l)&&(o=l)}if(ht(l)&&(r.includes(l)||r.push(l)),oe(l)||Zt(l)){if(l.getKey()===i)return n;s.push({node:l,position:n}),n+=1;continue}n+=Cf(l)}if(o)return n}function Zc(t,e){if(t.length<2||!Lk(t[0])||!qk(t[1]))return;const n=t[0].retain;return e.read(()=>{const r=Dk(n);return r==null?void 0:r.getKey()})}function Dk(t){const e=vr();let n=0;const r=[],s=[];for(const i of e){const o=i.node;for(let u=r.length-1;u>=0;u--)if(br(r[u],i)){const d=r[u];if(r.splice(u,1),n===t)return d;n+=1}for(let u=s.length-1;u>=0;u--)br(s[u].node,i)&&s.splice(u,1);const a=s[s.length-1];if(a){if(a.position===t)return a.node;continue}if(ht(o)&&(r.includes(o)||r.push(o)),oe(o)||Zt(o)){if(n===t)return o;s.push({node:o,position:n}),n+=1;continue}const l=Cf(o);if(ee(o)&&l>0&&t>=n&&t<n+l||kt(o)&&n===t)return o;n+=l}for(const i of r){if(n===t)return i;n+=1}}function br(t,e){return t?e?!J_(e.node,t.getKey()):!0:!1}function kt(t){return ct(t)||ut(t)||Zi(t)||oe(t)||Zt(t)||gf(t)}function ht(t){return yt(t)||Rt(t)}function at(t,e){return(e==null?void 0:e.insert)!=null&&typeof e.insert=="object"&&t in e.insert}function qk(t){if(t.insert==null||typeof t.insert!="object")return!1;const e=Object.keys(t.insert)[0];return t.insert!=null&&typeof t.insert=="object"&&e in t.insert&&Pk.includes(e)}function Lk(t){return t.retain!=null&&typeof t.retain=="number"}function Cf(t){return ee(t)?t.getTextContentSize():kt(t)?1:0}function Na(t,e){const n={insert:t.__text},r=ks(t,hn);if(r&&(n.attributes={segment:r}),e&&e.length>0){const s=Sf(e);s&&(n.attributes={...n.attributes,char:s})}return n}function Qc(t){const e=new Zr;return t.isEmpty()||t.read(()=>{const n=Dt();if(!n||n.isEmpty())return;const r=n.getChildren();if(r.length===1&&Yt(r[0])&&(!r[0].getChildren()||r[0].getChildrenSize()===0))return;const s=Fk();for(const i of s)e.push(i)}),e}function El(t,e){const n=[],r=vr(t),s=[],i=[],o=[],a=new Set;for(let l=0;l<r.length;l++){const u=r[l].node;n.push(...eu(u,l,r,s,i,o,a))}for(const l of s)n.push(...eu(l,r.length,r,s,i,o,a));return n}function Fk(){return El()}function eu(t,e,n,r,s,i,o){if(!t)return[];const a=[],l=n[e+1];return Uk(t,a,r),Bk(t,a,s,i,o),Hk(t,e,n,s,o,i,a),ct(t)&&a.push(Jk(t)),ut(t)&&a.push(Gk(t)),Zi(t)&&a.push(Yk(t)),gf(t)&&a.push(Xk(t)),zk(t,a,i),Wk(t,a,i),tv(l,i),a}function Uk(t,e,n){if(!t.isInline()){const r=n.pop();Rt(r)?e.push(Kk(r)):Ke(r)?e.push(Vk(r)):Yt(r)&&e.push({insert:bs})}ht(t)&&(n.includes(t)||n.push(t))}function Bk(t,e,n,r,s){var i;if(!ee(t))return;const o=t.getParent();if(oe(o)&&o.getFirstChild()===t)return;const a=t.getTextContent(),l=a.startsWith(cl),u=pe(o)?o:void 0,d=!!u&&a===Gt&&u.getChildrenSize()===1,f=Na(t,n),h=Qi(t,r);if(h){if(!a||a===me||l)return;(i=h.contentsOps)==null||i.push(f)}else d||l&&u||e.push(f);const p=a!==""&&!d&&!(l&&u);if(n.length>0&&p)for(const y of n)s.add(y)}function Hk(t,e,n,r,s,i,o){var a;pe(t)&&!r.includes(t)&&r.push(t);const l=n[e+1];for(const u of r.toReversed())if(br(u,l)){if(r.pop(),!s.has(u)){const d=Qk(u),f=Qi(u,i);f?(a=f.contentsOps)==null||a.push(d):o.push(d)}s.delete(u)}}function Wk(t,e,n){var r,s;if(!oe(t))return;const i=Zk(t),o=Qi(t,n),a={node:t,children:vr(t).map(l=>l.node),contentsOps:(s=(r=i.insert.note)==null?void 0:r.contents)==null?void 0:s.ops};n.push(a),o!=null&&o.contentsOps?o.contentsOps.push(i):e.push(i)}function zk(t,e,n){var r,s;if(!Zt(t))return;const i=ev(t),o=Qi(t,n),a={node:t,children:vr(t).map(l=>l.node),contentsOps:(s=(r=i.insert.unknown)==null?void 0:r.contents)==null?void 0:s.ops};n.push(a),o!=null&&o.contentsOps?o.contentsOps.push(i):e.push(i)}function Kk(t){const e={style:gs,code:t.__code};return{insert:bs,attributes:{book:e}}}function Jk(t){const e={style:Ii,number:t.__number};return t.__sid&&(e.sid=t.__sid),t.__altnumber&&(e.altnumber=t.__altnumber),t.__pubnumber&&(e.pubnumber=t.__pubnumber),{insert:{chapter:e}}}function Vk(t){const e={style:t.__marker};return{insert:bs,attributes:{para:e}}}function Gk(t){const e={style:Ri,number:t.__number};return t.__sid&&(e.sid=t.__sid),t.__altnumber&&(e.altnumber=t.__altnumber),t.__pubnumber&&(e.pubnumber=t.__pubnumber),{insert:{verse:e}}}function Yk(t){const e={style:t.__marker};return t.__sid&&(e.sid=t.__sid),t.__eid&&(e.eid=t.__eid),{insert:{milestone:e}}}function Xk(t){return{insert:{unmatched:{marker:t.__marker}}}}function Zk(t){const e={style:t.__marker,caller:t.__caller};t.__category&&(e.category=t.__category),t.getChildrenSize()>1&&(e.contents={ops:[]});const n={insert:{note:e}},r=ks(t,hn);return r&&(n.attributes={segment:r}),n}function Qk(t){const e={insert:""},n=Sf([t]);return n&&(e.attributes={char:n}),e}function ev(t){const e={tag:t.getTag()},n=t.getMarker();n&&(e.marker=n);const r=t.getUnknownAttributes();return r&&Object.assign(e,r),t.getChildrenSize()>0&&(e.contents={ops:[]}),{insert:{unknown:e}}}function Qi(t,e){for(let n=e.length-1;n>=0;n--){const r=e[n];if(r.children.includes(t))return r}}function tv(t,e){for(let n=e.length-1;n>=0;n--)br(e[n].node,t)&&e.splice(n,1)}function Sf(t){if(t.length===0)return;const e=t.map(nv);return e.length===1?e[0]:e}function nv(t){const e={style:t.__marker},n=ks(t,Dn);n&&(e.cid=n);const r=t.getUnknownAttributes();return r&&Object.keys(r).length>0&&Object.assign(e,r),e}const Tf=1;class _t extends wr{constructor(e=Pt,n="",r,s){super(s),z(this,"__caller"),z(this,"__previewText"),z(this,"__onClick"),this.__caller=e,this.__previewText=n,this.__onClick=r??(()=>{})}static getType(){return"immutable-note-caller"}static clone(e){const{__caller:n,__previewText:r,__onClick:s,__key:i}=e;return new _t(n,r,s,i)}static importDOM(){return{span:e=>sv(e)?{conversion:rv,priority:1}:null}}static importJSON(e){return Ol().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setCaller(e.caller).setPreviewText(e.previewText).setOnClick(e.onClick)}setCaller(e){if(this.__caller===e)return this;const n=this.getWritable();return n.__caller=e,n}getCaller(){return this.getLatest().__caller}setPreviewText(e){if(this.__previewText===e)return this;const n=this.getWritable();return n.__previewText=e,n}getPreviewText(){return this.getLatest().__previewText}setOnClick(e){if(this.__onClick===e)return this;const n=this.getWritable();return n.__onClick=e,n}getOnClick(){return this.getLatest().__onClick}createDOM(){const e=document.createElement("span");return e.classList.add(this.__type),e.setAttribute("data-caller",this.__caller),e.setAttribute("data-preview-text",this.__previewText),e}updateDOM(e){return e.__caller!==this.__caller}exportDOM(e){const{element:n}=super.exportDOM(e);return n&&bn(n)&&(n.classList.add(this.getType()),n.setAttribute("data-caller",this.getCaller()),n.setAttribute("data-preview-text",this.getPreviewText())),{element:n}}decorate(e){const n=this.getParent();if(!n)return null;const r=n.getKey(),s=n.getIsCollapsed(),i=this.__key,o=l=>{var u;return(u=this.__onClick)==null?void 0:u.call(this,l,r,s,()=>iv(e,r),d=>ov(e,r,i,d),()=>av(e,r))},a=`${this.__caller}_${this.__previewText}}`.replace(/\s+/g,"").substring(0,25);return m.jsx("button",{onClick:o,title:this.__previewText,"data-caller-id":a,children:this.__caller===Pt&&s?"":this.__caller})}exportJSON(){return{type:this.getType(),caller:this.getCaller(),previewText:this.getPreviewText(),onClick:this.getOnClick(),version:Tf}}isKeyboardSelectable(){return!1}}function rv(t){const e=t.getAttribute("data-caller")??"",n=t.getAttribute("data-preview-text")??"";return{node:Ol(e,n)}}function Ol(t,e,n){return Ie(new _t(t,e,n))}function sv(t){return t?t.classList.contains(_t.getType()):!1}function xn(t){return t instanceof _t}function iv(t,e){return t.read(()=>{const n=Te(e);if(!oe(n))throw new Error(`getNoteCaller: Note node not found: ${e}`);return n.getCaller()})}function ov(t,e,n,r){t.update(()=>{const s=Te(e);if(!oe(s))throw new Error(`setNoteCaller: Note node not found: ${e}`);s.setCaller(r);const i=Te(n);if(!xn(i))throw new Error(`setNoteCaller: Caller node not found: ${n}`);i.setCaller(r)})}function av(t,e){return t.read(()=>{const n=Te(e);if(!oe(n))throw new Error(`getNoteOps: Note node not found: ${e}`);return El(n)})}const lv=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],cv=[_t,Ye,...fk],uv=_.forwardRef((t,e)=>{const{coords:n,children:r,style:s,...i}=t,o=n!==void 0;return m.jsx("div",{ref:e,className:"floating-box","aria-hidden":!o,style:{...s,position:"absolute",zIndex:1e3,top:n==null?void 0:n.y,left:n==null?void 0:n.x,visibility:o?"visible":"hidden",opacity:o?1:0},...i,children:r})});function dv(){const[t,e]=_.useState(void 0),[n,r]=_.useState(),s=_.useRef(null),i=_.useCallback((a,l)=>{s.current&&s.current();const u=a.commonAncestorContainer.nodeType===a.commonAncestorContainer.TEXT_NODE?a:a.commonAncestorContainer;s.current=ng(u,l,()=>{rg(u,l,{placement:"bottom-start",middleware:[sg(),ig()]}).then(d=>{r(d.placement),e(f=>(f==null?void 0:f.x)===d.x&&(f==null?void 0:f.y)===d.y?f:{x:d.x,y:d.y})}).catch(()=>{e(void 0)})})},[]),o=_.useCallback(()=>{s.current&&(e(void 0),s.current(),s.current=null)},[]);return _.useEffect(()=>o,[o]),{coords:t,placement:n,updatePosition:i,cleanup:o}}function hv({isOpen:t,floatingBoxRef:e}){const{coords:n,updatePosition:r,cleanup:s,placement:i}=dv();return _.useEffect(()=>{var o;if(!t||!e.current){s();return}const a=(o=window.getSelection())==null?void 0:o.getRangeAt(0);if(!a){s();return}return r(a,e.current),s},[s,t,e,r]),{coords:n,placement:i}}const fv=document.body,pv=_.memo(uv);function gv({isOpen:t=!1,children:e}){const n=_.useRef(null),{coords:r,placement:s}=hv({isOpen:t,floatingBoxRef:n}),i=_.useMemo(()=>r?typeof e=="function"?e:()=>e:()=>null,[e,r]);return At.createPortal(m.jsx(pv,{ref:n,coords:r,style:r?void 0:{display:"none"},children:i({isOpen:t,placement:s})}),fv)}const Ef=_.createContext(void 0);function Ml(){const t=_.useContext(Ef);if(!t)throw new Error("useMenuContext must be used within a MenuProvider");return t}function mv(t,e){const[n,r]=_.useState(0),[s,i]=_.useState(-1),o=_.useMemo(()=>t??[],[t]),a={menuItems:o,activeIndex:n,selectedIndex:s,onSelectOption:e??(()=>{})},l=_.useCallback(()=>{r(f=>{const h=o.length;return h?(f-1+h)%h:0})},[o.length]),u=_.useCallback(()=>{r(f=>{const h=o.length;return h?(f+1)%h:0})},[o.length]),d=_.useCallback(()=>{const f=o.length;if(n>=0&&n<f){const h=o[n];e==null||e(h),i(n)}},[n,o,e]);return{state:a,moveUp:l,moveDown:u,select:d,setActiveIndex:r,setSelectedIndex:i}}function yv({children:t,menuItems:e,onSelectOption:n,...r}){const s=mv(e,n);return m.jsx(Ef.Provider,{value:s,children:m.jsx("div",{...r,children:t})})}const Of=_.forwardRef(({index:t,children:e,onMouseEnter:n,onClick:r,...s},i)=>{const{state:{activeIndex:o},setActiveIndex:a,setSelectedIndex:l,select:u}=Ml(),d=_.useCallback(h=>{u(),l(-1),r==null||r(h)},[r,u,l]),f=_.useCallback(h=>{a(t),n==null||n(h)},[t,a,n]);return m.jsx("button",{ref:i,role:"menuitem",...s,onClick:d,onMouseEnter:f,"aria-selected":t!==void 0&&o===t?"true":void 0,tabIndex:-1,children:e})});function bv({children:t,autoIndex:e=!0,...n}){const r=_.useRef(null),{state:{activeIndex:s,menuItems:i}}=Ml(),o=_.useMemo(()=>i?typeof t=="function"?t:()=>t:()=>null,[t,i]),a=_.useMemo(()=>{const l=o(i);return e?_.Children.map(l,(u,d)=>_.isValidElement(u)&&u.type===Of&&u.props.index===void 0?_.cloneElement(u,{index:d}):u):l},[o,e,i]);return _.useEffect(()=>{if(r.current){const l=r.current,u=l.children[s];if(u){const d=l.getBoundingClientRect(),f=u.getBoundingClientRect();f.bottom>d.bottom?l.scrollTop+=f.bottom-d.bottom:f.top<d.top&&(l.scrollTop-=d.top-f.top)}}},[s]),m.jsx("div",{ref:r,role:"menu",...n,children:a})}const oa={Root:yv,Options:bv,Option:Of},_v=(t,e,n)=>xi(t,n).toLowerCase().includes(e.toLowerCase()),tu=t=>Object.keys(t).find(e=>typeof t[e]=="string")||"",xi=(t,e)=>{const n=t[e];return typeof n=="string"?n:String(n)};function kv(t){const{query:e,items:n,filterBy:r,filter:s,sortBy:i,sortingOptions:o}=t,{caseSensitive:a=!1,priorityOrder:l=["exact","startsWith","contains"]}=o||{},u=a?e:e.toLowerCase();let d,f;s?(f=s,d=n.length>0?tu(n[0]):""):(d=r||(n.length>0?tu(n[0]):""),f=(y,b)=>_v(y,b,d));const h=i||d,p=new Map;return n.filter(y=>{try{return f(y,e)}catch(b){return console.warn("Error filtering item:",y,b),!1}}).sort((y,b)=>{const w=S=>(p.has(S)||p.set(S,xi(S,h).toLowerCase()),p.get(S)??""),M=a?xi(y,h):w(y),v=a?xi(b,h):w(b);for(const S of l)switch(S){case"exact":if(M===u&&v!==u)return-1;if(v===u&&M!==u)return 1;break;case"startsWith":if(M.startsWith(u)&&!v.startsWith(u))return-1;if(v.startsWith(u)&&!M.startsWith(u))return 1;break;case"contains":{const j=M.indexOf(u),P=v.indexOf(u);if(j!==-1&&P===-1)return-1;if(P!==-1&&j===-1)return 1;if(j!==-1&&P!==-1)return j-P;break}}return M.localeCompare(v)})}function vv(t){const{query:e,items:n,filterBy:r,filter:s,sortBy:i,sortingOptions:o}=t;return _.useMemo(()=>kv({query:e,items:n,filterBy:r,filter:s,sortBy:i,sortingOptions:o}),[e,n,r,s,i,o])}function wv(){const{moveUp:t,moveDown:e,select:n}=Ml();return _.useMemo(()=>({moveUp:t,moveDown:e,select:n}),[t,e,n])}const xv=()=>{const t=wv(),[e]=ce();_.useEffect(()=>{const n=r=>{const s={ArrowDown:()=>t==null?void 0:t.moveDown(),ArrowUp:()=>t==null?void 0:t.moveUp(),Enter:()=>t==null?void 0:t.select(),Tab:()=>t==null?void 0:t.select()}[r.key];return s?(s(),r.preventDefault(),r.stopPropagation(),!0):!1};return e.registerCommand(zi,n,Ja)},[e,t])};function Cv(){return xv(),null}function Sv(t){const{options:e,onSelectOption:n,onClose:r,inverse:s,query:i,menuOpenKey:o}=t,[a]=ce(),l=i!==void 0,[u,d]=_.useState(""),f=l?i??"":u,h=vv({query:f,items:e,filterBy:"name"}),p=y=>{r==null||r(),n?n(y):y.action(a)};return _.useEffect(()=>a.registerCommand(zi,y=>{if(l)return!1;const b={Escape:()=>r==null?void 0:r(),Backspace:()=>{f.length===0?r==null||r():d(w=>w.slice(0,-1))}}[y.key];return b?(y.stopPropagation(),y.preventDefault(),b(),!0):y.key.length===1?(y.stopPropagation(),y.preventDefault(),y.key!==o&&d(w=>w+y.key),!0):!1},Ja),[a,l,f,o,r]),m.jsxs(oa.Root,{className:`autocomplete-menu-container ${s?"inverse":""}`,menuItems:h,onSelectOption:y=>p(y),children:[!l&&m.jsx("input",{value:f,type:"text",disabled:!0}),m.jsx(Cv,{}),m.jsx(oa.Options,{className:"autocomplete-menu-options",autoIndex:!1,children:y=>y.map((b,w)=>m.jsxs(oa.Option,{index:w,children:[m.jsx("span",{className:"label",children:b.label??b.name}),m.jsx("span",{className:"description",children:b.description})]},b.name))})]})}function Tv({trigger:t,items:e}){const[n]=ce(),[r,s]=_.useState(!1),i=_.useCallback(o=>{o.key==="Escape"&&r?(s(!1),n.focus()):o.key===t&&!r&&(o.preventDefault(),s(!0))},[n,t,r]);return _.useEffect(()=>n.registerRootListener(o=>{if(o)return o.addEventListener("keydown",i),()=>{o.removeEventListener("keydown",i)}}),[n,i]),_.useEffect(()=>n.registerUpdateListener(({prevEditorState:o,editorState:a})=>{const l=o.read(()=>{const u=re();if(X(u))return u});a.read(()=>{const u=re();!X(u)||l!=null&&l.is(u)||s(!1)})}),[n]),e&&m.jsx(gv,{isOpen:r,children:({placement:o})=>m.jsx(Sv,{options:e,onClose:()=>s(!1),inverse:o==="top-start",menuOpenKey:t})})}function Ev({scriptureReference:t,contextMarker:e,getMarkerAction:n}){return{markersMenuItems:_.useMemo(()=>{if(!e||!t)return;const r=zc(e);if(r!=null&&r.children)return Object.values(r.children).flatMap(s=>s.map(i=>{const o=zc(i),{action:a}=n(i,o);return{name:i,label:i,description:(o==null?void 0:o.description)??"",action:l=>{a({editor:l,reference:t})}}}))},[e,n,t])}}function os(t,e){return`${t}:${e}`}function Ov(t,e){_.useEffect(()=>{if(!t.hasNodes([Le]))throw new Error("AnnotationPlugin: TypedMarkNode not registered on editor!");const n=new Map;return Xe(Md(t,Le,r=>ys(r.getTypedIDs(),r.getTypedOnClicks(),r.getTypedOnRemoves()),(r,s)=>{const i=r.getTypedOnClicks(),o=r.getTypedOnRemoves();for(const[a,l]of Object.entries(r.getTypedIDs()))l.forEach(u=>{var d,f;const h=(d=i[a])==null?void 0:d[u],p=(f=o[a])==null?void 0:f[u];s.addID(a,u,h,p)});r.getWritable().__suppressOnRemoveCallbacks=!0}),t.registerMutationListener(Le,r=>{t.getEditorState().read(()=>{for(const[s,i]of r){const o=Te(s);let a={};i==="destroyed"?a=n.get(s)??{}:Ee(o)&&(a=o.getTypedIDs());for(const[l,u]of Object.entries(a))if(!Le.isReservedType(l))for(const d of u){let f=e.get(os(l,d));a[l]=u,n.set(s,a),i==="destroyed"?f!==void 0&&(f.delete(s),f.size===0&&e.delete(os(l,d))):(f===void 0&&(f=new Set,e.set(os(l,d),f)),f.has(s)||f.add(s))}}})},{skipInitialization:!0}))},[t,e])}const Mv=_.forwardRef(function({logger:t},e){const[n]=ce(),r=_.useMemo(()=>new Map,[]);Ov(n,r);const s=(i,o,a)=>{const l=Array.from(a??r.get(os(i,o))??[]);if(l.length!==0)for(const u of l){const d=Te(u);Ee(d)&&(d.deleteID(i,o),d.hasNoIDsForEveryType()&&Pi(d))}};return _.useImperativeHandle(e,()=>({setAnnotation(i,o,a,l,u){if(Le.isReservedType(o))throw new Error(`setAnnotation: Can't directly set this reserved annotation type '${o}'. Use the appropriate plugin instead.`);n.update(()=>{const d=xl(i);if(d===void 0){t==null||t.error("Failed to find start or end node of the annotation.");return}s(o,a),hf(d,o,a,l,u)},{tag:Ta})},removeAnnotation(i,o){if(Le.isReservedType(i))throw new Error(`removeAnnotation: Can't directly remove this reserved annotation type '${i}'. Use the appropriate plugin instead.`);const a=r.get(os(i,o));a===void 0||a.size===0||n.update(()=>{s(i,o,a)},{tag:Ta})}})),null});function Av({ignoreHistoryMergeTagChange:t=!0,ignoreSelectionChange:e=!1,onChange:n}){const[r]=ce();return _.useLayoutEffect(()=>{if(n)return r.registerUpdateListener(s=>{const{editorState:i,dirtyElements:o,dirtyLeaves:a,prevEditorState:l,tags:u}=s;if(e&&o.size===0&&a.size===0||t&&u.has(md)||l.isEmpty())return;const d=jv(r,s);d.length!==0&&n(i,r,u,d)})},[r,t,e,n]),null}function jv(t,{dirtyLeaves:e,prevEditorState:n}){let r=new Zr;return t.getEditorState().read(()=>{const s=e.values().next().value??"";if(e.size===1&&ee(Te(s))){const i=Te(s),o=xf(i);if(ee(i)&&o!==void 0){const a=n.read(()=>{const d=Te(s);return new Zr([ee(d)?Na(d):{insert:""}])}),l=new Zr([Na(i)]),u=new Zr(o>0?[{retain:o}]:[]);r=r.concat(u).concat(a.diff(l))}}else{const i=Qc(n),o=Qc(t.getEditorState());r=i.diff(o)}}),r.ops}function Nv(t,e,n,r){let s=0;t.forEach(i=>{if("retain"in i)s+=Iv(i,s,e,r);else if("delete"in i){if(typeof i.delete!="number"||i.delete<=0){r==null||r.error(`Invalid delete operation: ${JSON.stringify(i)}`);return}r==null||r.debug(`Delete: ${i.delete}`),Pv(s,i.delete,r)}else"insert"in i?typeof i.insert=="string"?(r==null||r.debug(`Insert: '${i.insert}'`),s+=$v(s,i.insert,i.attributes,e,r)):typeof i.insert=="object"&&i.insert!==null?(r==null||r.debug(`Insert embed: ${JSON.stringify(i.insert)}`),qv(s,i,e,n,r)?s+=1:r==null||r.error(`Failed to process insert embed operation: ${JSON.stringify(i.insert)} at index ${s}. Document may be inconsistent.`)):r==null||r.error(`Insert of unknown type: ${JSON.stringify(i.insert)}`):r==null||r.error(`Unknown operation: ${JSON.stringify(i)}`)})}function Iv(t,e,n,r){return typeof t.retain!="number"||t.retain<0?(r==null||r.error(`Invalid retain operation: ${JSON.stringify(t)}`),0):(r==null||r.debug(`Retain: ${t.retain}`),t.attributes&&(r==null||r.debug(`Retain attributes: ${JSON.stringify(t.attributes)}`),Rv(e,t.retain,t.attributes,n,r)),t.retain)}function Rv(t,e,n,r,s){s==null||s.debug(`Applying attributes for range [${t}, ${t+e-1}] with attributes: ${JSON.stringify(n)}`);let i=e,o=0,a=-1;const l=Dt();function u(d){if(i<=0)return!0;if(ee(d)){const f=d.getTextContentSize();if(t<o+f&&o<t+e){const h=Math.max(0,t-o),p=f-h,y=Math.min(i,p);if(y>0){let b=d;const w=h>0,M=y<f-h;if(w&&M){const[,v]=d.splitText(h);[b]=v.splitText(y)}else w?[,b]=d.splitText(h):M&&([b]=d.splitText(y));if(pn(n)){const v=b.getParent();if(pe(v)){const S=n.char;let j;Array.isArray(S)?a>=0&&a<=S.length-1&&(j=S[a]):a===0&&(j=S);const P=j?Ln(j,v):!1;if(P&&Array.isArray(S)&&S.length>1){const D=_e("");b.replace(D);const B=typeof n.segment=="string"?n.segment:void 0,U=Or(S.slice(1),r,b,B);let H=D;for(const W of U)H.insertAfter(W),H=W;D.remove(),lt(n,b)}else if(P)lt(n,b);else{b.remove();const D=nu(b,n,r,s);if(D&&D.length>0){let B=v;for(const U of D)B.insertAfter(U),B=U}}}else{const S=_e("");b.replace(S);const j=nu(b,n,r,s);if(j&&j.length>0){let P=S;for(const D of j)P.insertAfter(D),P=D;S.remove()}else S.replace(b)}}else lt(n,b);i-=y}}o+=f}else if(kt(d))t<=o&&o<t+e&&i>0&&(ru(d,n),i-=1),o+=1;else if(pe(d)){a+=1;let f=!1;if(t<=o&&o<t+e&&i>0)if(pn(n)){const h=n.char;let p;if(Array.isArray(h)?a>=0&&a<=h.length-1&&(p=h[a]):a===0&&(p=h),p){d.setMarker(p.style),typeof p.cid=="string"&&Mt(d,Dn,()=>p.cid);const y=je(p,qi);y&&Object.keys(y).length>0?d.setUnknownAttributes({...d.getUnknownAttributes()??{},...y}):d.setUnknownAttributes(void 0)}}else(n.char===!1||n.char===null||Kv(n.char))&&(f=!0);if(i>0){const h=d.getChildren();for(const p of h){if(i<=0)break;if(u(p)&&i<=0)return f&&Ul(d),!0}}f&&Ul(d),a-=1}else if(ht(d)){const f=d.getChildren();for(const p of f){if(i<=0)break;if(u(p)&&i<=0)return!0}const h=1;if(t<=o&&o<t+i&&i>0){if(!Yt(d))ru(d,n);else if(Al(n)){const p=Af(n.para);p&&d.replace(p,!0)}i-=h}o+=h}else if(we(d)){const f=d.getChildren();for(const h of f){if(i<=0)break;if(u(h)&&i<=0)return!0}}return i<=0}u(l),i>0&&(s==null||s.warn(`$applyAttributes: Not all characters in the retain operation (length ${e}) could be processed. Remaining: ${i}. targetIndex: ${t}, final currentIndex: ${o}`))}function nu(t,e,n,r){var s;const i=typeof e.segment=="string"?e.segment:void 0,o=Or(e.char,n,t,i),a=o.find(pe);if(!a){r==null||r.error(`Failed to create CharNode for text transformation. Style: ${Array.isArray(e.char)?e.char[0].style:(s=e.char)==null?void 0:s.style}. Falling back to standard text attributes.`),lt(e,t);return}const l={};If.forEach(f=>{t.hasFormat(f)&&(l[f]="true")});const u={};Object.entries(e).forEach(([f,h])=>{f==="segment"||f==="char"||(typeof h=="string"?u[f]=h:h===!0?u[f]="true":h===!1&&(u[f]="false"))});const d={...a.getUnknownAttributes()??{},...l,...u};return Object.keys(d).length>0&&a.setUnknownAttributes(d),lt(e,t),o}function ru(t,e){for(const n of Object.keys(e)){const r=e[n];if(n==="char"&&pe(t)&&pn(e)){const s=r;if(t.setMarker(s.style),typeof s.cid=="string"){const o=s.cid;Mt(t,Dn,()=>o)}const i=je(s,qi);i&&Object.keys(i).length>0&&t.setUnknownAttributes({...t.getUnknownAttributes()??{},...i});continue}typeof r=="string"&&(ct(t)||ut(t)||Zi(t)||oe(t)||Zt(t)?t.setUnknownAttributes({...t.getUnknownAttributes()??{},[n]:r}):(Rt(t)||Ke(t)||pe(t))&&(n==="style"&&!Rt(t)?t.setMarker(r):n==="code"&&Rt(t)?t.setCode(r):t.setUnknownAttributes({...t.getUnknownAttributes()??{},[n]:r})),n==="segment"&&Mt(t,hn,()=>r))}}function Pv(t,e,n){if(e<=0)return;const r=Dt();let s=0,i=e;function o(a){if(i<=0)return!0;if(ee(a)){let l=a.getTextContentSize();if(t<s+l&&s<t+i){const u=Math.max(0,t-s),d=l-u,f=Math.min(i,d);f>0&&(a.spliceText(u,f,""),a.getTextContentSize()===0&&a.remove(),n==null||n.debug(`Deleted ${f} length from TextNode (key: ${a.getKey()}) at nodeOffset ${u}. Original targetIndex: ${t}, current currentIndex: ${s}.`),i-=f,l-=f)}s+=l}else if(kt(a))t<=s&&s<t+i?(a.remove(),n==null||n.debug(`Deleted embed node (key: ${a.getKey()}) at currentIndex: ${s}. Original targetIndex: ${t}, remainingToDelete: ${i}.`),i-=1):s+=1;else if(ht(a)){const l=a.getChildren().slice(),u=a.getChildren();for(const d of u){if(i<=0)break;if(o(d)&&i<=0)return!0}if(t<=s&&s<t+i&&ht(a)){i-=1;const d=a.getChildren().length;if(l.length>0&&d===0){const f=a.getParent();((f==null?void 0:f.getChildren())??[]).length>1?(a.remove(),n==null||n.debug(`Removed entire ParaNode that had all its content deleted at currentIndex: ${s}. Original targetIndex: ${t}, remainingToDelete: ${i}.`)):(a.replace(bt(),!0),n==null||n.debug(`Replaced last ParaNode with ImpliedParaNode at currentIndex: ${s}. Original targetIndex: ${t}, remainingToDelete: ${i}.`))}else if(i>0){const f=a.getNextSibling();if(f&&yt(f)){let h=s+1;const p=f.getChildren();for(const b of p){if(i<=0)break;const w=s;if(s=h,o(b)){s=w;break}ee(b)?h+=b.getTextContentSize():kt(b)&&(h+=1),s=w}const y=f.getChildren();for(const b of y)b.remove(),a.append(b);f.remove(),n==null||n.debug(`Merged next paragraph into current one after deleting symbolic close at currentIndex: ${s}. Original targetIndex: ${t}, remainingToDelete: ${i}.`)}else a.replace(bt(),!0)}else Ke(a)?a.replace(bt(),!0):a.remove()}s+=1}else if(we(a)){const l=a.getChildren();for(const u of l){if(i<=0)break;if(o(u)&&i<=0)return!0}}return i<=0}o(r),i>0&&(n==null||n.warn(`Delete operation could not remove all requested characters. Remaining to delete: ${i}. Original targetIndex: ${t}, OT length: ${e}. Final currentIndex: ${s}`))}function $v(t,e,n,r,s){if(e===bs)return su(t,n,s);if(e.endsWith(bs)&&!Al(n)){const i=e.slice(0,-1);let o=0;if(i.length>0){if(pn(n))throw new Error("Text + LF should not have char attributes");o+=Li(t,i,n,s)}return o+=su(t+o,n,s),o}else return pn(n)?Dv(t,e,n,r,s):Li(t,e,n,s)}function Dv(t,e,n,r,s){s==null||s.debug(`Attempting to insert CharNode with text "${e}" and attributes ${JSON.stringify(n.char)} at index ${t}`);const i=_e(e===""?Gt:e);lt(n,i);let o;{let p=function(w){if(ee(w)){const M=w.getTextContentSize();if(t>=b&&t<b+M){const v=w.getParent();return pe(v)&&(o=v),!0}b+=M}else if(kt(w))b+=1;else if(pe(w)){const M=w.getChildren();for(const v of M)if(p(v))return!0}else if(we(w)){const M=w.getChildren();for(const v of M)if(p(v))return!0;ht(w)&&(b+=1)}return!1};const y=Dt();let b=0;p(y)}let a=n.char;if(Array.isArray(a)){if(o){const p=a[0];p&&Ln(p,o)?(a=a.slice(1),a.length===1&&(a=a[0])):o=void 0}}else o&&(Ln(a,o)||(o=void 0));const l=typeof n.segment=="string"?n.segment:void 0,u=Or(a,r,i,l,o?[o]:void 0);if(u.length===0)return e.length;const d=u.find(pe);if(!d)return s==null||s.error(`CharNode style is missing for text "${e}". Attributes: ${JSON.stringify(n.char)}. Falling back to rich text insertion.`),Li(t,e,void 0,s);const f={};for(const[p,y]of Object.entries(n))p!=="char"&&p!=="segment"&&typeof y=="string"&&(f[p]=y);Object.keys(f).length>0&&d.setUnknownAttributes(f);let h=!0;for(const p of u)if(!Mf(t,p,s)){h=!1;break}return h?e.length:(s==null||s.error(`Failed to insert CharNode with text "${e}" at index ${t}. Falling back to rich text.`),Li(t,e,void 0,s))}function Li(t,e,n,r){if(e.length<=0)return r==null||r.debug("Attempted to insert empty string. No action taken."),0;const s=Dt();let i=0,o=!1;function a(l){if(o)return!0;if(ee(l)){const u=l.getTextContentSize();if(t>=i&&t<=i+u){const d=t-i,f=_e(e);if(lt(n,f),d===0)l.insertBefore(f);else if(d===u){const h=l.getParent();pe(h)&&!pn(n)?h.insertAfter(f):l.insertAfter(f)}else{const[,h]=l.splitText(d);h.insertBefore(f)}return r==null||r.debug(`Inserted text "${e}" in/around TextNode (key: ${l.getKey()}) at nodeOffset ${d}. Original targetIndex: ${t}, currentIndex at node start: ${i}.`),o=!0,!0}i+=u}else if(kt(l))i+=1;else if(pe(l)){if(!o&&t===i){const d=_e(e);lt(n,d);const f=l.getFirstChild();return f?f.insertBefore(d):l.append(d),r==null||r.debug(`Inserted text "${e}" at beginning of CharNode ${l.getType()} (key: ${l.getKey()}).`),o=!0,!0}const u=l.getChildren();for(const d of u){if(a(d))return!0;if(o)break}if(!o&&t===i){const d=_e(e);return lt(n,d),l.append(d),r==null||r.debug(`Appended text "${e}" to end of CharNode ${l.getType()} (key: ${l.getKey()}).`),o=!0,!0}}else if(ht(l)){if(!o&&t===i){const d=_e(e);lt(n,d);const f=l.getFirstChild();return f?f.insertBefore(d):l.append(d),r==null||r.debug(`Inserted text "${e}" at beginning of container ${l.getType()} (key: ${l.getKey()}).`),o=!0,!0}const u=l.getChildren();for(const d of u){if(a(d))return!0;if(o)break}if(!o&&t===i){const d=_e(e);return lt(n,d),l.append(d),r==null||r.debug(`Appended text "${e}" to end of container ${l.getType()} (key: ${l.getKey()}).`),o=!0,!0}i+=1}else if(we(l)){const u=l.getChildren();for(const d of u){if(a(d))return!0;if(o)break}}return o}if(a(s),!o&&t===i){r==null||r.debug(`Insertion point matches end of document (targetIndex: ${t}, final currentIndex: ${i}). Appending text to new ParaNode.`);const l=_e(e);lt(n,l);const u=bt().append(l);s.append(u),o=!0}return o?e.length:(r==null||r.warn(`$insertRichText: Could not find insertion point for text "${e}" at targetIndex ${t}. Final currentIndex: ${i}. Text not inserted.`),0)}function Mf(t,e,n){const r=Dt();let s=0,i=!1;function o(a){if(i)return!0;if(a===r&&t===0&&!r.getFirstChild())return e.isInline()?(n==null||n.debug(`$insertNodeAtCharacterOffset: Inserting inline node ${e.getType()} into empty root, wrapped in ImpliedParaNode. targetIndex: ${t}`),r.append(bt().append(e))):(n==null||n.debug(`$insertNodeAtCharacterOffset: Inserting block node ${e.getType()} directly into empty root. targetIndex: ${t}`),r.append(e)),i=!0,!0;if(!we(a))return!1;const l=a.getChildren();for(const u of l){if(t===s&&!i){if(a===r&&e.isInline())if(yt(u)){n==null||n.debug(`$insertNodeAtCharacterOffset: Inserting inline node ${e.getType()} into existing ${u.getType()} at beginning. targetIndex: ${t}`);const d=u.getFirstChild();d?d.insertBefore(e):u.append(e)}else n==null||n.debug(`$insertNodeAtCharacterOffset: Inserting inline node ${e.getType()} into root before ${u.getType()}, wrapping in ImpliedParaNode. targetIndex: ${t}`),u.insertBefore(bt().append(e));else u.insertBefore(e),n==null||n.debug(`$insertNodeAtCharacterOffset: Inserted node ${e.getType()} (key: ${e.getKey()}) before child ${u.getType()} (key: ${u.getKey()}) in ${a.getType()} (key: ${a.getKey()}). targetIndex: ${t}, currentIndex: ${s}`);return i=!0,!0}if(ee(u)){const d=u.getTextContentSize();if(!i&&t>s&&t<s+d){const f=t-s,[h]=u.splitText(f);return h.insertAfter(e),n==null||n.debug(`$insertNodeAtCharacterOffset: Inserted node ${e.getType()} (key: ${e.getKey()}) by splitting TextNode (key: ${u.getKey()}) at offset ${f}. targetIndex: ${t}, currentIndex at node start: ${s}`),i=!0,!0}s+=d}else if(kt(u))s+=1;else if(pe(u)){if(o(u))return!0}else if(ht(u)){const d=u;if(o(d))return!0;const f=s;if(Yt(d)&&ht(e)&&t===f&&!i)return n==null||n.debug(`$insertNodeAtCharacterOffset: Replacing ImpliedParaNode (key: ${d.getKey()}) with block node '${e.getType()}' (key: ${e.getKey()}) at OT index ${t}.`),u.replace(e,!0),s=f+1,i=!0,!0;s+=1}else if(we(u)&&o(u))return!0;if(i)return!0}return we(a)&&!i&&(t===s||a===r&&t>s)?a===r?(e.isInline()?(n==null||n.debug(`$insertNodeAtCharacterOffset: Appending inline node ${e.getType()} to root. Wrapping in new ImpliedParaNode. targetIndex: ${t}, current document OT length: ${s}.`),r.append(bt().append(e))):(n==null||n.debug(`$insertNodeAtCharacterOffset: Appending block node ${e.getType()} to root. targetIndex: ${t}, current document OT length: ${s}.`),r.append(e)),i=!0,!0):yt(a)?Yt(a)&&Ke(e)&&t===s?(n==null||n.debug(`$insertNodeAtCharacterOffset: Replacing ImpliedParaNode container (key: ${a.getKey()}) with ParaNode ${e.getType()} (key: ${e.getKey()}) via append logic. targetIndex: ${t}`),a.replace(e,!0),i=!0,!0):e.isInline()||!yt(e)?(n==null||n.debug(`$insertNodeAtCharacterOffset: Appending node ${e.getType()} to existing container ${a.getType()} (key: ${a.getKey()}). targetIndex: ${t}, container end OT index: ${s}.`),a.append(e),i=!0,!0):(n==null||n.debug(`$insertNodeAtCharacterOffset: Inserting block node ${e.getType()} after container ${a.getType()} (key: ${a.getKey()}). targetIndex: ${t}, container end OT index: ${s}.`),a.insertAfter(e),i=!0,!0):(pe(a)?(n==null||n.debug(`$insertNodeAtCharacterOffset: Inserting node ${e.getType()} after CharNode (key: ${a.getKey()}). targetIndex: ${t}, element end OT index: ${s}.`),a.insertAfter(e)):e.isInline()||!yt(e)?(n==null||n.debug(`$insertNodeAtCharacterOffset: Appending node ${e.getType()} to generic element ${a.getType()} (key: ${a.getKey()}). targetIndex: ${t}, element end OT index: ${s}.`),a.append(e)):(n==null||n.debug(`$insertNodeAtCharacterOffset: Inserting block node ${e.getType()} after generic element ${a.getType()} (key: ${a.getKey()}). targetIndex: ${t}, element end OT index: ${s}.`),a.insertAfter(e)),i=!0,!0):i}return o(r),i||n==null||n.warn(`$insertNodeAtCharacterOffset: Could not find insertion point for node ${e.getType()} (key: ${e.getKey()}) at targetIndex ${t}. Final currentIndex: ${s}. Node not inserted.`),i}function qv(t,e,n,r,s){let i;return at("chapter",e)?i=Fv(e.insert.chapter,n):at("verse",e)?i=Uv(e.insert.verse,n):at("ms",e)?i=Bv(e.insert.ms):at("note",e)?i=jf(e,n,r,s):at("unknown",e)?i=Nf(e,n,r,s):at("unmatched",e)&&(i=Wv(e.insert.unmatched)),i?Mf(t,i,s):(s==null||s.error(`$insertEmbedAtCurrentIndex: Cannot create LexicalNode for embed object: ${JSON.stringify(e.insert)}`),!1)}function su(t,e,n){let r;Al(e)?r=Af(e.para):zv(e)&&(r=Lv(e.book)),r??(r=bt());const s=r,i=Ke(s),o=Yt(s);let a=0,l=!1;function u(d){if(l)return!0;if(ee(d)){const f=d.getTextContentSize();if(t>=a&&t<=a+f){const h=d.getParent();if(Ke(h)&&(i||o)){n==null||n.debug(`Splitting ParaNode (marker: ${h.getMarker()}) with LF attributes at targetIndex ${t}`);const p=t-a,[y]=p>0?d.splitText(p):[void 0];let b=y==null?void 0:y.getPreviousSibling();for(;b;){const w=b;b=b.getPreviousSibling();const M=s.getFirstChild();M?M.insertBefore(w):s.append(w)}return y&&s.append(y),h.insertBefore(s),l=!0,!0}}a+=f}else if(kt(d))a+=1;else if(ht(d)){const f=d.getChildren();for(const h of f){if(u(h))return!0;if(l)break}if(t===a){if(Yt(d)&&s)return n==null||n.debug(`Replacing ImpliedParaNode (key: ${d.getKey()}) with ParaNode at targetIndex ${t}`),d.replace(s,!0),l=!0,!0;if(Ke(d)&&s){const h=d;return n==null||n.debug(`Creating new block node with LF attributes after existing ParaNode (marker: ${h.getMarker()}) at targetIndex ${t}`),h.insertAfter(s),l=!0,!0}}if(a+=1,t===a&&Ke(d)&&s)return n==null||n.debug(`Creating new block node after existing ParaNode (marker: ${d.getMarker()}) at targetIndex ${t}`),d.insertAfter(s),l=!0,!0}else if(we(d)){const f=d.getChildren();for(const h of f){if(u(h))return!0;if(l)break}}return l}return u(Dt()),l||n==null||n.warn(`Could not find location to handle newline with para attributes at targetIndex ${t}. Final currentIndex: ${a}.`),1}function Lv(t){const{style:e,code:n}=t;if(!e||e!==gs||!n||!dt.isValidBookCode(n))return;const r=je(t,Mk);return Hh(n,r)}function Af(t){const{style:e}=t;if(!e)return;const n=je(t,Ok);return ms(e,n)}function Fv(t,e){if(!t)return;const{number:n,sid:r,altnumber:s,pubnumber:i}=t;if(!n)return;const o=je(t,Ak);let a;if(e.markerMode==="editable")a=Kh(n,r,s,i,o);else{const l=e.markerMode==="visible";a=hl(n,l,r,s,i,o)}return a}function Uv(t,e){if(!t)return;const{style:n,number:r,sid:s,altnumber:i,pubnumber:o}=t;if(!r)return;const a=je(t,jk);let l;if(e.markerMode==="editable"){if(!n)return;const u=Cs(n,r);l=of(r,u,s,i,o,a)}else{const u=e.markerMode==="visible";l=Cl(r,u,s,i,o,a)}return l}function Bv(t){if(!t)return;const{style:e,sid:n,eid:r}=t;if(!e)return;const s=je(t,Nk);return tf(e,n,r,s)}function jf(t,e,n,r){var s;const i=t.insert;if(!i.note)return;const{style:o,caller:a,category:l,contents:u}=i.note;if(!o||a==null)return;a===""&&(r==null||r.warn("Note has empty caller. Only use for note editing."));const d=je(i.note,Ik),f=(s=t.attributes)==null?void 0:s.segment;let h;f&&typeof f=="string"&&(h=f);const p=[];for(const y of(u==null?void 0:u.ops)??[])if(typeof y.insert=="string")if(pn(y.attributes)){const b=Or(y.attributes.char,e,_e(y.insert),void 0,p);p.push(...b)}else p.push(_e(y.insert));return kf(o,a,p,e,n,h).setCategory(l).setUnknownAttributes(d)}function Nf(t,e,n,r){var s;const i=t.insert.unknown;if(!i)return;const{tag:o,marker:a,contents:l}=i;if(!o)return;const u=je(i,Rk),d=ll(o,a,u),f=(l==null?void 0:l.ops)??[];f.length>0&&Hv(f,e,n,r).forEach(p=>d.append(p));const h=(s=t.attributes)==null?void 0:s.segment;return typeof h=="string"&&Mt(d,hn,()=>h),d}function Hv(t,e,n,r){const s=[];for(const i of t){if(typeof i.insert=="string"){if(pn(i.attributes)){const o=_e(i.insert),a=Or(i.attributes.char,e,o,void 0,s);s.push(...a)}else s.push(_e(i.insert));continue}if(!(!i.insert||typeof i.insert!="object")){if(at("unknown",i)){const o=Nf(i,e,n,r);o&&s.push(o);continue}if(at("note",i)){const o=jf(i,e,n,r);o&&s.push(o);continue}r==null||r.warn(`$createInlineNodesFromOps: Unsupported embed inside unknown contents: ${JSON.stringify(i.insert)}`)}}return s}function Wv(t){if(!t)return;const{marker:e}=t;if(e)return wl(e)}function Or(t,e,n,r,s){if(ee(n)&&n.getTextContentSize()===0&&n.setTextContent(Gt),Array.isArray(t)){if(t.length===0)throw new Error("Empty charAttr array");const i=t[0],o=s==null?void 0:s[s.length-1];if(pe(o)&&Ln(i,o))return t.length>1?Or(t.slice(1),e,n).forEach(d=>o.append(d)):n&&o.append(n),[];const a=t.reduceRight((d,f,h)=>{const p=gt(f.style,je(f,qi));if(typeof f.cid=="string"&&Mt(p,Dn,()=>f.cid),r&&h===t.length-1&&Mt(p,hn,()=>r),d)if(pe(d)){const y=d.getMarker(),b=[];aa(y,b,e),b.forEach(M=>p.append(M)),p.append(d);const w=[];la(y,w,e),w.forEach(M=>p.append(M))}else p.append(d);return p},n),l=[],u=t[0];return aa(u.style,l,e),l.push(a),la(u.style,l,e),l}else{const i=s==null?void 0:s[s.length-1];if(pe(i)&&Ln(t,i))return n&&i.append(n),[];const o=[];aa(t.style,o,e);const a=gt(t.style,je(t,qi));return typeof t.cid=="string"&&Mt(a,Dn,()=>t.cid),r&&Mt(a,hn,()=>r),n&&a.append(n),o.push(a),la(t.style,o,e),o}}function aa(t,e,n){(n==null?void 0:n.markerMode)==="editable"?e.push(mr(t)):(n==null?void 0:n.markerMode)==="visible"&&e.push(yr("marker",en(t)))}function la(t,e,n,r=!1){Ce.isValidFootnoteMarker(t)||Ce.isValidCrossReferenceMarker(t)||((n==null?void 0:n.markerMode)==="editable"?r?e.push(mr("","selfClosing")):e.push(mr(t,"closing")):(n==null?void 0:n.markerMode)==="visible"&&e.push(yr("marker",gr(r?"":t))))}function zv(t){return!!t&&!!t.book&&typeof t.book=="object"&&t.book!==null&&"style"in t.book&&typeof t.book.style=="string"&&"code"in t.book&&typeof t.book.code=="string"}function Al(t){return!!t&&!!t.para&&typeof t.para=="object"&&t.para!==null&&"style"in t.para&&typeof t.para.style=="string"}function pn(t){return!!t&&!!t.char&&typeof t.char=="object"&&t.char!==null&&(!Array.isArray(t.char)&&"style"in t.char&&typeof t.char.style=="string"||Array.isArray(t.char)&&t.char.length>0&&"style"in t.char[0]&&typeof t.char[0].style=="string")}function Kv(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)&&Object.keys(t).length===0}function lt(t,e){if(t)for(const n of Object.keys(t)){if(n==="segment"&&typeof t[n]=="string"){const r=t[n];Mt(e,hn,()=>r);continue}if(Jv(n)){const r=!!t[n],s=n,i=e.hasFormat(s);(r&&!i||!r&&i)&&e.toggleFormat(s)}}}const If=["bold","underline","strikethrough","italic","highlight","code","subscript","superscript","lowercase","uppercase","capitalize"];function Jv(t){return If.includes(t)}function Vv({viewOptions:t}){const[e]=ce();return Gv(e,t),null}function Gv(t,e){_.useEffect(()=>{if(!t.hasNodes([Qt,Ye,$e]))throw new Error("ArrowNavigationPlugin: ImmutableChapterNode, ImmutableVerseNode or NoteNode not registered on editor!");const n=r=>{if(r.key!=="ArrowLeft"&&r.key!=="ArrowRight")return!1;const s=re();if(!X(s)||!s.isCollapsed())return!1;const i=t.getRootElement();if(!i)return!1;const o=i.dir||"ltr";let a=!1;return Yv(o,r.key)?a=Zv(s):Xv(o,r.key)&&(a=Qv(s,e)),a&&r.preventDefault(),a};return t.registerCommand(zi,n,Ja)},[t,e])}function Yv(t,e){return t==="ltr"&&e==="ArrowRight"||t==="rtl"&&e==="ArrowLeft"}function Xv(t,e){return t==="ltr"&&e==="ArrowLeft"||t==="rtl"&&e==="ArrowRight"}function Zv(t){var e,n,r;const s=t.anchor.getNode(),i=z_(t);if(oe(i)&&!Ss(i.getFirstChild())){if(yt(s)){if(t.anchor.offset===s.getChildrenSize())return!1}else if(t.anchor.offset!==s.getTextContentSize())return!1;if(i.getIsCollapsed()){if(i.is((e=i.getParent())==null?void 0:e.getLastChild()))return(r=(n=i.getParent())==null?void 0:n.getNextSibling())==null||r.selectStart(),!0}else return $i(i.getFirstChild())?i.select(2,2):i.select(1,1),!0}if(yt(s)&&oe(i)&&i.getIsCollapsed()){const a=i.getNextSibling();return a?a.selectStart():i.selectEnd(),!0}const o=i==null?void 0:i.getParent();if($i(i)&&oe(o)&&i.is(o==null?void 0:o.getLastChild())){const a=o.getNextSibling();return a?a.selectStart():o.selectEnd(),!0}return!1}function Qv(t,e){const n=K_(t);if(xs(n)&&!n.getPreviousSibling())return!0;if(t.anchor.offset!==0)return!1;const r=t.anchor.getNode();if(Rt(r.getParent()))return!0;if(oe(n)&&n.getIsCollapsed()){const i=n.getPreviousSibling();if(!Er(i))return!1;const o=n.getParent();if(!o)return!1;const a=n.getIndexWithinParent();return o.select(a,a),!0}if(yt(n)&&(e==null?void 0:e.noteMode)==="collapsed"){const i=n.getLastChild();if(!i)return!1;const o=Si(i,a=>oe(a));if(oe(o)&&o.getIsCollapsed()){const a=o.getParent();if(!a)return!1;const l=o.getIndexWithinParent();return a.select(l,l),!0}}const s=af(r);if(!s||s.getIsCollapsed())return!1;if(xn(n)){const i=s.getParent();if(!i)return!1;const o=s.getIndexWithinParent();return i.select(o,o),!0}return!1}function ew(){const[t]=ce();return tw(t),null}function tw(t){_.useEffect(()=>{if(!t.hasNodes([Ce]))throw new Error("CharNodePlugin: CharNode not registered on editor!");return Xe(t.registerNodeTransform(Ce,nw),t.registerNodeTransform(jt,rw))},[t])}function nw(t){if(!pe(t))return;if(t.isEmpty()){t.remove();return}const e=t.getMarker(),n=ks(t,Dn),r=t.getUnknownAttributes(),s=t.getNextSibling();pe(s)&&Ln({style:e,cid:n},s)&&zt(r,s.getUnknownAttributes())&&(t.append(...s.getChildren()),s.remove());const i=t.getPreviousSibling();pe(i)&&Ln({style:e,cid:n},i)&&zt(r,i.getUnknownAttributes())&&(i.append(...t.getChildren()),t.remove())}function rw(t){const e=t.getParent();if(!pe(e)||e.getChildrenSize()!==1)return;const n=t.getTextContent();n.length>1&&n.startsWith(Gt)&&(t.setTextContent(n.slice(1)),t.selectEnd())}function Rf(t){return t.replaceAll("	"," ")}const jl=t=>{navigator.clipboard.read().then(async e=>{if((await navigator.permissions.query({name:"clipboard-read"})).state==="denied"){alert("Not allowed to paste from clipboard.");return}const n=new DataTransfer,r=e[0];for(const i of r.types){const o=await(await r.getType(i)).text();n.setData(i,Rf(o))}const s=new ClipboardEvent("paste",{clipboardData:n});t.dispatchCommand(Bi,s)})},Nl=t=>{navigator.clipboard.read().then(async()=>{if((await navigator.permissions.query({name:"clipboard-read"})).state==="denied"){alert("Not allowed to paste from clipboard.");return}const e=new DataTransfer,n=await navigator.clipboard.readText();e.setData("text/plain",Rf(n));const r=new ClipboardEvent("paste",{clipboardData:e});t.dispatchCommand(Bi,r)})};function sw(){const[t]=ce();return _.useEffect(()=>{const e=n=>{const{key:r,shiftKey:s,metaKey:i,ctrlKey:o,altKey:a}=n;!(ha?i:o)||a||(!s&&r.toLowerCase()==="c"?(n.preventDefault(),t.dispatchCommand(Wi,null)):!s&&r.toLowerCase()==="x"?(n.preventDefault(),t.dispatchCommand(Hi,null)):r.toLowerCase()==="v"&&(n.preventDefault(),s?Nl(t):jl(t)))};return t.registerRootListener((n,r)=>{r!==null&&r.removeEventListener("keydown",e),n!==null&&n.addEventListener("keydown",e)})},[t]),null}function iw({logger:t}){const[e]=ce();return _.useEffect(()=>Xe(e.registerCommand(zi,n=>n.key!=="\\"&&n.key!=="/"?!1:(n.preventDefault(),!0),yi),e.registerCommand(Bi,n=>{var r;const s=(r=n.clipboardData)==null?void 0:r.getData("text/plain");return!s||!s.includes("\\")&&!s.includes("/")?!1:(t==null||t.info("CommandMenuPlugin: paste containing backslash or forward slash ignored."),n.preventDefault(),!0)},yi),e.registerCommand(vd,n=>{var r;const s=(r=n.dataTransfer)==null?void 0:r.getData("text/plain");return!s||!s.includes("\\")&&!s.includes("/")?!1:(t==null||t.info("CommandMenuPlugin: drag containing backslash or forward slash ignored."),n.preventDefault(),!0)},yi)),[e,t]),null}function ow({index:t,isSelected:e,onClick:n,onMouseEnter:r,option:s}){let i="item";return e&&(i+=" selected"),s.isDisabled&&(i+=" disabled"),m.jsx("li",{tabIndex:-1,className:i,ref:s.setRefElement,role:"option","aria-selected":e,"aria-disabled":s.isDisabled,id:"typeahead-item-"+t,onMouseEnter:r,onClick:s.isDisabled?void 0:n,children:m.jsx("span",{className:"text",children:s.title})},s.key)}function aw({options:t,selectedItemIndex:e,onOptionClick:n,onOptionMouseEnter:r}){return m.jsx("div",{className:"typeahead-popover",children:m.jsx("ul",{children:t.map((s,i)=>m.jsx(ow,{index:i,isSelected:e===i,onClick:()=>n(s,i),onMouseEnter:()=>r(i),option:s},s.key))})})}class ri extends Zm{constructor(e,n){super(e),z(this,"title"),z(this,"onSelect"),z(this,"isDisabled"),this.title=e,this.onSelect=n.onSelect.bind(this),this.isDisabled=n.isDisabled||!1}}function lw(t,e="editor-input"){return t?t.classList.contains(e):!1}function cw(){const[t]=ce(),[e,n]=_.useState(()=>!t.isEditable()),r=_.useRef(void 0),s=_.useRef(void 0),i=_.useRef(void 0),o=_.useMemo(()=>[new ri("Cut",{onSelect:()=>{t.dispatchCommand(Hi,null)},isDisabled:e}),new ri("Copy",{onSelect:()=>{t.dispatchCommand(Wi,null)}}),new ri("Paste",{onSelect:()=>{jl(t)},isDisabled:e}),new ri("Paste as Plain Text",{onSelect:()=>{Nl(t)},isDisabled:e})],[t,e]),a=_.useCallback((l,u,d)=>{t.update(()=>{l==null||l.onSelect(u),d()})},[t]);return _.useEffect(()=>{var l;s.current=((l=t.getRootElement())==null?void 0:l.className)??""},[t]),_.useEffect(()=>{const l=()=>{var u;(u=i.current)==null||u.call(i)};return window.addEventListener("scroll",l,!0),()=>{window.removeEventListener("scroll",l,!0)}},[]),_.useEffect(()=>t.registerEditableListener(l=>{n(!l)}),[t]),m.jsx(ty,{options:o,onSelectOption:a,onWillOpen:l=>{r.current=l.target},menuRenderFn:(l,{selectedIndex:u,options:d,selectOptionAndCleanUp:f,setHighlightedIndex:h},{setMenuRef:p})=>(i.current=()=>f(void 0),l.current&&!lw(r.current,s.current)&&!Zh(r.current)?At.createPortal(m.jsx("div",{className:"typeahead-popover auto-embed-menu",style:{marginLeft:l.current.style.width,userSelect:"none",width:200},ref:p,children:m.jsx(aw,{options:o,selectedItemIndex:u,onOptionClick:(y,b)=>{y.isDisabled||(h(b),f(y))},onOptionMouseEnter:y=>{h(y)}})}),l.current):null)})}function uw({isEditable:t}){const[e]=ce();return _.useLayoutEffect(()=>{e.setEditable(t)},[e,t]),null}function dw({scripture:t,nodeOptions:e,editorAdaptor:n,viewOptions:r,logger:s}){const[i]=ce();return _.useEffect(()=>{var o;(o=n.initialize)==null||o.call(n,e,s)},[n,s,e]),_.useEffect(()=>{var o;(o=n.reset)==null||o.call(n);const a=n.serializeEditorState(t,r);if(a==null){s==null||s.warn("LoadStatePlugin: serializedEditorState was null or undefined. Skipping editor update.");return}try{const l=i.parseEditorState(a);queueMicrotask(()=>{i.update(()=>{i.setEditorState(l),i.dispatchCommand(pd,void 0)},{tag:ul})})}catch{s==null||s.error("LoadStatePlugin: error parsing or setting editor state.")}},[i,n,s,t,r]),null}function hw({expandedNoteKeyRef:t,nodeOptions:e,viewOptions:n,logger:r}){const[s]=ce();return fw(e,r),pw(s,t,n,r),null}function fw(t,e){const n=_.useRef(void 0),r=t.noteCallers;_.useEffect(()=>{let s=r;(!s||s.length<=0)&&(s=lv),n.current!==s&&(n.current=s,ww("note-callers",s,e))},[e,r])}function pw(t,e,n,r){_.useEffect(()=>{if(!t.hasNodes([Ce,$e,_t]))throw new Error("NoteNodePlugin: CharNode, NoteNode or ImmutableNoteCallerNode not registered on editor!");const s=i=>t.update(()=>vw(i));return Xe(t.registerNodeTransform($e,i=>gw(i,n)),t.registerNodeTransform(Ce,mw),t.registerNodeTransform(jt,yw),t.registerNodeTransform(_t,bw),t.registerMutationListener(_t,(i,{prevEditorState:o})=>_w(i,o)),t.registerCommand(_s,()=>kw(t,e,n,r),kr),t.registerRootListener((i,o)=>{o!==null&&o.removeEventListener("dblclick",s),i!==null&&i.addEventListener("dblclick",s)}))},[t,e,r,n])}function gw(t,e){const n=t.getChildren();if(!n.some(r=>xn(r))&&(e==null?void 0:e.markerMode)!=="editable"&&t.getCaller()!==""&&t.remove(),n.length>0){const r=n[0];ee(r)&&!Ss(r)&&t.insertBefore(r)}}function mw(t){const e=t.getParentOrThrow(),n=e.getChildren(),r=n.find(o=>xn(o));if(!pe(t)||!oe(e)||!r)return;const s=kl(n);r.getPreviewText()!==s&&r.setPreviewText(s);const i=t.getNextSibling();ee(i)?i.getTextContent()!==me&&i.setTextContent(me):t.insertAfter(_e(me))}function yw(t){const e=af(t),n=e==null?void 0:e.getChildren(),r=n==null?void 0:n.find(o=>xn(o));if(!ee(t)||!oe(e)||!r||!n)return;const s=t.getParent();if(!Ss(t)&&oe(s)&&t.getTextContent()!==me&&(t.setTextContent(me),t.selectEnd()),pe(s)&&s.getChildrenSize()===1){const o=t.getTextContent();o.length>1&&o.startsWith(Gt)&&(t.setTextContent(o.slice(1)),t.selectEnd())}const i=kl(n);r.getPreviewText()!==i&&r.setPreviewText(i)}function bw(t){if(!xn(t))return;const e=t.getNextSibling();!ee(e)||Ss(e)?t.insertAfter(_e(me)):e.getTextContent()!==me&&e.setTextContent(me)}function _w(t,e){for(const[n,r]of t){if(r!=="destroyed")continue;const s=e.read(()=>{const o=Te(n),a=o==null?void 0:o.getParent();return xn(o)&&oe(a)&&a.getCaller()===Pt}),i=document.querySelector(".editor-input");!s||!i||(i.classList.add("reset-counters"),i.offsetHeight,i.classList.remove("reset-counters"))}}function kw(t,e,n,r){var s;if((n==null?void 0:n.noteMode)!=="expandInline")return!1;const i=re();if(!X(i)||!i.isCollapsed())return!1;const o=i.anchor,a=o.getNode();if(e.current){const l=Si(a,u=>oe(u));if(l)e.current!==l.getKey()&&(e.current=l.getKey());else{const u=Te(e.current);u&&!u.getIsCollapsed()&&(r==null||r.debug("Cursor moved away from NoteNode, collapsing it"),Jr(t,e.current,r)),e.current=void 0}}if(o.offset===0){const l=a.getPreviousSibling();if(oe(l)){r==null||r.debug("Cursor is just after a NoteNode");const u=l.getKey();l.getIsCollapsed()?e.current=u:e.current=void 0,Jr(t,u,r)}}if(o.offset===a.getTextContentSize()){const l=a.getNextSibling();if(oe(l)){r==null||r.debug("Cursor is just before a NoteNode");const u=l.getKey();l.getIsCollapsed()?e.current=u:e.current=void 0,Jr(t,u,r)}else if(!l){const u=Si(a,d=>oe(d));if(u&&u.getIsCollapsed()&&yt(u.getParent())&&u.is((s=u.getParent())==null?void 0:s.getLastChild())){r==null||r.debug("Cursor is at end of note at end of para");const d=u.getKey();e.current=d,Jr(t,d,r)}}}if(yt(a)){const l=a.getChildAtIndex(o.offset),u=l==null?void 0:l.getPreviousSibling();if(Er(u)&&oe(l)){r==null||r.debug("Cursor is between verse and NoteNode");const d=l.getKey();l.getIsCollapsed()?e.current=d:e.current=void 0,Jr(t,d,r)}}return!1}function Jr(t,e,n){const r=Te(e);try{r==null||r.toggleIsCollapsed()}catch(s){if(s instanceof Error&&s.message.includes("read only"))n==null||n.warn("Fallback triggered after stabilization - edge case"),setTimeout(()=>{t.update(()=>{r==null||r.toggleIsCollapsed()})},0);else throw s}}function vw(t){const e=re();if(!X(e))return;const n=e.anchor,r=e.focus,s=n.getNode(),i=r.getNode();if(oe(s)&&ee(i)){t.preventDefault();const o=Ed();o.anchor.set(i.getKey(),0,"text"),o.focus.set(i.getKey(),r.offset,"text"),xd(o)}}function ww(t,e,n){for(const r of document.styleSheets)try{const s=r.cssRules||r.rules;for(const i of s)if(xw(i,t)){const o=e.map(a=>`"${a}"`).join(" ");i.symbols=o;return}}catch{continue}n==null||n.warn(`Editor: counter style "${t}" not found.`)}function xw(t,e){return typeof t=="object"&&t!==null&&"name"in t&&t.name===e&&"symbols"in t&&typeof t.symbols=="string"}function Cw({onChange:t}){const[e]=ce();return _.useEffect(()=>e.registerCommand(_s,()=>{const n=e.read(()=>mf());return t==null||t(n),!1},kr),[e,t]),null}function Sw(){const[t]=ce();return Tw(t),null}function Tw(t){_.useEffect(()=>{if(!t.hasNodes([tt]))throw new Error("ParaNodePlugin: ParaNode not registered on editor!");return t.registerNodeTransform(tt,e=>Ew(e,t))},[t])}function Ew(t,e){Tl(e,t.getKey())&&wf(t.getFirstChild()),!(!Ke(t)||t.getMarker()!=="b"||t.isEmpty()||!e.getEditorState().read(()=>{const n=Te(t.getKey());return Ke(n)&&((n==null?void 0:n.isEmpty())??!1)}))&&t.clear()}function Pf({onStateChange:t}){const[e]=ce(),[n,r]=_.useState(e),s=_.useRef(!1),i=_.useRef(!1),o=_.useRef(),a=_.useRef(),l=_.useCallback(()=>{const u=re();let d;if(X(u)){const f=u.anchor.getNode(),h=u.focus.getNode();let p=f.getKey()==="root"?f:Si(f,M=>{const v=M.getParent();return v!==null&&zp(v)});p===null&&(p=f.getTopLevelElementOrThrow());const y=p.getKey(),b=n.getElementByKey(y),w=V_(f,h);if(w&&Ek(w)&&(d=w.getMarker()),b!==null&&(Ke(p)||Rt(p)||xs(p))){o.current=p.getMarker(),a.current=d,t==null||t({canUndo:s.current,canRedo:i.current,blockMarker:o.current,contextMarker:d});return}}a.current=d},[n,t]);return _.useEffect(()=>e.registerCommand(_s,(u,d)=>(l(),r(d),!1),es),[e,l]),_.useEffect(()=>Xe(n.registerUpdateListener(({editorState:u})=>{u.read(()=>{l()})}),n.registerCommand(Gr,u=>(s.current=u,t==null||t({canUndo:s.current,canRedo:i.current,blockMarker:o.current,contextMarker:a.current}),!1),es),n.registerCommand(Vr,u=>(i.current=u,t==null||t({canUndo:s.current,canRedo:i.current,blockMarker:o.current,contextMarker:a.current}),!1),es)),[l,n,t]),null}function Ow({textDirection:t}){const[e]=ce();return Mw(e,t),null}function Mw(t,e){_.useEffect(()=>(iu(t,e),t.registerUpdateListener(({dirtyElements:n})=>{n.size>0&&iu(t,e)})),[t,e])}function iu(t,e){if(e==="auto")return;const n=t.getRootElement();n&&(n.dir=e);const r=t._config.theme.placeholder,s=document.getElementsByClassName(r)[0];s&&(s.dir=e)}function Aw(){const[t]=ce();return jw(t),null}function jw(t){_.useEffect(()=>{if(!t.hasNodes([Ce,Ye,$e,jt,Ge]))throw new Error("TextSpacingPlugin: CharNode, ImmutableVerseNode, NoteNode, TextNode or VerseNode not registered on editor!");return Xe(t.registerNodeTransform(jt,Nw),t.registerNodeTransform(jt,e=>Iw(e,t)),t.registerNodeTransform(Ge,ou),t.registerNodeTransform(Ye,ou))},[t])}function Nw(t){if(!t.isAttached())return;const e=t.getTextContent(),n=t.getNextSibling(),r=t.getParent();t.getMode()!=="normal"||e.endsWith(" ")&&e.length>1||oe(n)||pe(r)||Ee(r)||Zt(r)||(e===" "&&!ut(n)?t.setTextContent(""):Sl(t))}function Iw(t,e){const n=t.getParent();!Zt(n)||!t.isAttached()||Tl(e,t.getKey())&&n.insertAfter(t)}function ou(t){if(!t.isAttached())return;const e=t.getPreviousSibling();e&&!ut(e)&&!ee(e)&&!Zt(e)&&t.insertBefore(_e(" "))}function Rw({trigger:t,scriptureReference:e,contextMarker:n,getMarkerAction:r}){const{markersMenuItems:s}=Ev({scriptureReference:e,contextMarker:n,getMarkerAction:r});return m.jsx(Tv,{trigger:t,items:s})}function Pw({trigger:t,scrRef:e,contextMarker:n,getMarkerAction:r}){const{book:s,chapterNum:i,verseNum:o,verse:a,versificationStr:l}=e,u=_.useMemo(()=>({book:s,chapterNum:i,verseNum:o,verse:a,versificationStr:l}),[s,i,o,a,l]),[d]=ce();return $w(d),m.jsx(Rw,{trigger:t,scriptureReference:u,contextMarker:n,getMarkerAction:r})}function $w(t){_.useEffect(()=>{if(!t.hasNodes([Ge,Ye]))throw new Error("UsjNodesMenuPlugin: VerseNode or ImmutableVerseNode not registered on editor!");const e={},n={};return Xe(t.registerNodeTransform(Ye,r=>au(r,t,e)),t.registerNodeTransform(Ge,r=>au(r,t,e)),t.registerMutationListener(Ye,r=>du(r,t,e,n)),t.registerMutationListener(Ge,r=>du(r,t,e,n)))},[t])}function au(t,e,n){Vp(ul)||Tl(e,t.getKey())&&Lw(t,n)}const lu=2,Dw=3,cu=4,qw=5;function Lw(t,e){var n;const r=yl(t),s=r==null?void 0:r.getNumber();if(!s)return;const i=e[s];if(!i)return;let o=parseInt(t.getNumber()),a=((n=uu(t.getNumber()))==null?void 0:n[lu])??"";i.forEach(l=>{const u=Te(l);if(!u)return;const d=u.getNumber(),f=parseInt(d),h=uu(d),p=!!(h!=null&&h[Dw]),y=p?parseInt(h[cu]):f;if(y<o||f>o||y===o&&a)return;const b=(h==null?void 0:h[lu])??"",w=(h==null?void 0:h[qw])??"",M=p?Oa(parseInt(h[cu]),void 0):"";let v=`${b}`;v+=p?`-${M}${w}`:"";const S=Oa(f,void 0);u.setNumber(`${S}${v}`),o=parseInt(p?M:S),a=p?w:b})}function uu(t){return RegExp(/(\d+)([a-zA-Z]+)?(-(\d+)([a-zA-Z]+)?)?/).exec(t)}function du(t,e,n,r){e.getEditorState().read(()=>{for(const[s,i]of t){const o=Te(s);if(ut(o)){if(i==="created"){const a=yl(o);if(!a)continue;const l=a.getNumber();n[l]||(n[l]=[]),n[l].push(s),r[s]=l}else if(i==="destroyed"){const a=r[s],l=n[a];if(!l)continue;const u=l.findIndex(d=>d===s);if(u===-1)continue;l.splice(u,1),Reflect.deleteProperty(r,s)}}}})}const $f="formatted",Fw="unformatted";let Il;function Uw(t){const e=Bw(t);if(!e)throw new Error(`Invalid view mode: ${t}`);Il=e}Uw($f);const Mr=()=>Il;function Bw(t){let e;switch(t){case $f:e={markerMode:"hidden",noteMode:"collapsed",hasSpacing:!0,isFormattedFont:!0};break;case Fw:e={markerMode:"editable",noteMode:"expanded",hasSpacing:!1,isFormattedFont:!1};break}return e}function Hw(t){if(t)return t.markerMode==="editable"?Ge:Ye}function Ww(t){const e=[],n=t??Il;return n&&(e.push(`${g_}${n.markerMode}`),n.hasSpacing&&e.push(f_),n.isFormattedFont&&e.push(p_)),e}let Ia;function zw(t){t&&(Ia=t)}function Kw(t){return t.isEmpty()?hd:Jw(t.toJSON())}function Jw(t){if(!t.root||!t.root.children)return;const e=t.root.children;if(e.length===1&&fl(e[0])&&(!e[0].children||e[0].children.length===0))return hd;const n=Df(e),r=on(n);return r?{type:as,version:ls,content:r}:void 0}function Vw(t,e){const{type:n,marker:r,unknownAttributes:s}=t;let i;return t.code!==""&&(i=t.code),Ne({type:n,marker:r,code:i,...s,content:e})}function Gw(t){const{marker:e,number:n,sid:r,altnumber:s,pubnumber:i,unknownAttributes:o}=t;return Ne({type:vt.getType(),marker:e,number:n,sid:r,altnumber:s,pubnumber:i,...o})}function Yw(t,e){const{marker:n,sid:r,altnumber:s,pubnumber:i,unknownAttributes:o}=t,a=e&&typeof e[0]=="string"?e[0]:void 0;let{number:l}=t;return l=lf(n,a,l),Ne({type:vt.getType(),marker:n,number:l,sid:r,altnumber:s,pubnumber:i,...o})}function Xw(t){const{marker:e,sid:n,altnumber:r,pubnumber:s,unknownAttributes:i}=t,{text:o}=t;let{number:a}=t;return a=lf(e,o,a),Ne({type:Ge.getType(),marker:e,number:a,sid:n,altnumber:r,pubnumber:s,...i})}function Zw(t,e){const{type:n,marker:r,unknownAttributes:s}=t,i=r===""?void 0:r;return e==null||e.forEach((o,a)=>{typeof o=="string"&&o.startsWith(me)&&(e[a]=o.slice(1))}),Ne({type:n,marker:i,...s,content:e})}function Qw(t,e){const{type:n,marker:r,unknownAttributes:s}=t;return Ne({type:n,marker:r,...s,content:e})}function ex(t,e){const{type:n,marker:r,caller:s,category:i,unknownAttributes:o}=t;return Ne({type:n,marker:r,caller:s,category:i,...o,content:e})}function ir(t){const{type:e,marker:n,sid:r,eid:s,unknownAttributes:i}=t;return Ne({type:e,marker:n===""?void 0:n,sid:r,eid:s,...i})}function tx(t){return t.text}function nx(t,e){const{tag:n,marker:r,unknownAttributes:s}=t;return Ne({type:n,marker:r,...s,content:e})}function rx(t){const{marker:e}=t;return{type:Di,marker:e===""?void 0:e}}function hu(t,e){const n=t[t.length-1];n&&typeof n=="string"?t[t.length-1]=n+e:t.push(e)}function sx(t,e,n,r,s){const i=$t.getType(),o=e.filter(a=>!n.includes(a));if(n.filter(a=>!e.includes(a)).forEach(a=>{const l=ir({type:i,marker:ar,eid:a});s.push(l)}),o.forEach(a=>{const l=ir({type:i,marker:qn,sid:a});s.push(l)}),e.length===0){const a=ir({type:i,marker:qn});s.push(a)}if(s.push(...t),e.length===0){const a=ir({type:i,marker:ar});s.push(a)}(!r||!ok(r))&&e.forEach(a=>{const l=ir({type:i,marker:ar,eid:a});s.push(l)})}function on(t,e){const n=[];let r,s=[];return t.forEach((i,o)=>{const a=i,l=i,u=i,d=i,f=i,h=i,p=i,y=i;switch(i.type){case dt.getType():n.push(Vw(a,on(a.children)));break;case Qt.getType():n.push(Gw(i));break;case vt.getType():n.push(Yw(l,on(l.children)));break;case Ye.getType():case Ge.getType():n.push(Xw(i));break;case Ce.getType():n.push(Zw(u,on(u.children)));break;case tt.getType():n.push(Qw(d,on(d.children)));break;case $e.getType():n.push(ex(f,on(f.children,f.caller)));break;case vn.getType():case _t.getType():case Od.getType():case Wn.getType():break;case Le.getType():if(r=on(p.children),r){const b=p.typedIDs[un];if(b)sx(r,b,s,t[o+1],n),s=b;else{const w=r.shift();w&&(typeof w=="string"?hu(n,w):n.push(w)),r.length>0&&n.push(...r)}}break;case $t.getType():n.push(ir(i));break;case jt.getType():h.text&&h.text!==me&&!h.text.startsWith(cl)&&(!e||h.text!==_l(e))&&hu(n,tx(h));break;case Hn.getType():n.push(nx(y,on(y.children)));break;case wn.getType():n.push(rx(i));break;default:Ia==null||Ia.error(`Unexpected node type '${i.type}'!`)}}),n&&n.length>0?n:void 0}function Df(t){const e=t.findIndex(n=>fl(n));if(e>=0){const n=t.slice(0,e),r=t[e].children,s=Df(t.slice(e+1));t=[...n,...r,...s]}return t}const ca={initialize:zw,deserializeEditorState:Kw},fu=qf([]),ix={type:Od.getType(),version:1};let Fi=[],Z,Ci,Ra,ve;function ox(t,e){Fi=[],cx(t),ux(e)}function ax(t=0){}function lx(t,e){Z=e??Mr();let n;return t?(t.type!==as&&(ve==null||ve.warn(`This USJ type '${t.type}' didn't match the expected type '${as}'.`)),t.version!==ls&&(ve==null||ve.warn(`This USJ version '${t.version}' didn't match the expected version '${ls}'.`)),t.content.length>0?n=$a(Qr(t.content)):n=[fu]):n=[fu],Ra==null||Ra(Fi),{root:{children:n,direction:null,format:"",indent:0,type:"root",version:1}}}function cx(t){t&&(Ci=t),t!=null&&t.addMissingComments&&(Ra=t.addMissingComments)}function ux(t){t&&(ve=t)}function dx(t){return!t||t.length!==1||typeof t[0]!="string"?"":t[0]}function hx(t){let{marker:e}=t;e!==gs&&(ve==null||ve.warn(`Unexpected book marker '${e}'!`)),e=e??gs;const{code:n}=t;(!n||!dt.isValidBookCode(n))&&(ve==null||ve.warn(`Unexpected book code '${n}'!`));const r=[];((Z==null?void 0:Z.markerMode)==="editable"||(Z==null?void 0:Z.markerMode)==="visible")&&r.push(Fn("marker",en(e)+" "+n+me));const s=dx(t.content);s&&r.push(gn(s));const i=je(t,d_);return Ne({type:dt.getType(),marker:e,code:n??"",unknownAttributes:i,children:r,direction:null,format:"",indent:0,version:Bh})}function fx(t){let{marker:e}=t;e!==Ii&&(ve==null||ve.warn(`Unexpected chapter marker '${e}'!`)),e=e??Ii;const{number:n,sid:r,altnumber:s,pubnumber:i}=t,o=je(t,y_);let a;return(Z==null?void 0:Z.markerMode)==="visible"&&(a=!0),(Z==null?void 0:Z.markerMode)==="editable"?Ne({type:vt.getType(),marker:e,number:n??"",sid:r,altnumber:s,pubnumber:i,unknownAttributes:o,children:[gn(Cs(e,n)??"")],direction:null,format:"",indent:0,version:zh}):Ne({type:Qt.getType(),marker:e,number:n??"",showMarker:a,sid:r,altnumber:s,pubnumber:i,unknownAttributes:o,version:Yh})}function px(t){let{marker:e}=t;e!==Ri&&(ve==null||ve.warn(`Unexpected verse marker '${e}'!`)),e=e??Ri;const{number:n,sid:r,altnumber:s,pubnumber:i}=t,o=(Hw(Z)??Ye).getType(),a=(Z==null?void 0:Z.markerMode)==="editable"?sf:bf;let l,u;(Z==null?void 0:Z.markerMode)==="editable"?l=Cs(e,n):(Z==null?void 0:Z.markerMode)==="visible"&&(u=!0);const d=je(t,L_);return Ne({type:o,text:l,marker:e,number:n??"",sid:r,altnumber:s,pubnumber:i,showMarker:u,unknownAttributes:d,version:a})}function gx(t,e=[]){let{marker:n}=t;Ce.isValidMarker(n)||ve==null||ve.warn(`Unexpected char marker '${n}'!`),n=n??"",(Z==null?void 0:Z.markerMode)==="editable"&&e.forEach(s=>{bl(s)&&(s.text=me+s.text)}),e.length===0&&e.push(gn(Gt));const r=je(t,k_);return Ne({type:Ce.getType(),marker:n,unknownAttributes:r,children:[...e],direction:null,format:"",indent:0,textFormat:0,textStyle:"",version:Gh})}function qf(t){return{type:fn.getType(),children:t,direction:null,format:"",indent:0,textFormat:0,textStyle:"",version:Qh}}function mx(t,e=[]){let{marker:n}=t;tt.isValidMarker(n)||ve==null||ve.warn(`Unexpected para marker '${n}'!`),n=n??Xi;const r=[];(Z==null?void 0:Z.markerMode)==="editable"?r.push(_r(n),gn(me)):(Z==null?void 0:Z.markerMode)==="visible"&&r.push(Fn("marker",en(n)+me)),r.push(...e);const s=je(t,$_);return Ne({type:tt.getType(),marker:n,unknownAttributes:s,children:r,direction:null,format:"",indent:0,textFormat:0,textStyle:"",version:rf})}function yx(t,e){const n=Z_(e);let r=()=>{};return Ci!=null&&Ci.noteCallerOnClick&&(r=Ci.noteCallerOnClick),Ne({type:_t.getType(),caller:t,previewText:n,onClick:r,version:Tf})}function bx(t,e){let{marker:n}=t;$e.isValidMarker(n)||ve==null||ve.warn(`Unexpected note marker '${n}'!`),n=n??pl;const{category:r}=t,s=t.caller??"*",i=(Z==null?void 0:Z.noteMode)!=="expanded",o=je(t,N_);let a,l;(Z==null?void 0:Z.markerMode)==="editable"?(a=_r(n),l=_r(n,"closing")):(Z==null?void 0:Z.markerMode)==="visible"&&(a=Fn("marker",en(n)+me),l=Fn("marker",gr(n)+me));const u=[];let d;if(a&&u.push(a),(Z==null?void 0:Z.markerMode)==="editable")d=gn(_l(s)),u.push(d,...e);else{const f=gn(me);d=yx(s,e),u.push(d,f,...e.flatMap(_x(f)))}return l&&u.push(l),Ne({type:$e.getType(),marker:n,caller:s,isCollapsed:i,category:r,unknownAttributes:o,children:u,direction:null,format:"",indent:0,version:nf})}function _x(t){return e=>uk(e)?[e]:[e,t]}function kx(t){let{marker:e}=t;(!e||!$t.isValidMarker(e))&&(ve==null||ve.warn(`Unexpected milestone marker '${e}'!`)),e=e??"";const{sid:n,eid:r}=t,s=je(t,M_);return Ne({type:$t.getType(),marker:e,sid:n,eid:r,unknownAttributes:s,version:ef})}function pu(t,e=[]){return{type:Le.getType(),typedIDs:{[un]:e},children:t,direction:null,format:"",indent:0,version:1}}function vx(t,e){const{marker:n}=t,r=t.type,s=je(t,l_),i=[...e];return i.forEach(o=>{bl(o)&&(o.mode="token")}),Ne({type:Hn.getType(),tag:r,marker:n,unknownAttributes:s,children:i,direction:null,format:"",indent:0,version:Uh})}function wx(t){return{type:wn.getType(),marker:t,version:pf}}function _r(t,e="opening"){return{type:Wn.getType(),marker:t,markerSyntax:e,text:"",detail:0,format:0,mode:"normal",style:"",version:1}}function gn(t,e="normal"){return{type:jt.getType(),text:t,detail:0,format:0,mode:e,style:"",version:1}}function Fn(t,e){return{type:vn.getType(),text:e,textType:t,version:ff}}function gu(t,e){(Z==null?void 0:Z.markerMode)==="editable"?e.push(_r(t)):(Z==null?void 0:Z.markerMode)==="visible"&&e.push(Fn("marker",en(t)))}function mu(t,e,n=!1){Ce.isValidFootnoteMarker(t)||Ce.isValidCrossReferenceMarker(t)||((Z==null?void 0:Z.markerMode)==="editable"?n?e.push(_r("","selfClosing")):e.push(_r(t,"closing")):(Z==null?void 0:Z.markerMode)==="visible"&&e.push(Fn("marker",gr(n?"":t))))}function xx(t,e){if(t.type!=="ms")return;const n=[];if(t.sid&&n.push(`sid="${t.sid}"`),t.eid&&n.push(`eid="${t.eid}"`),n.length<=0)return;const r=cl+n.join(" ");(Z==null?void 0:Z.markerMode)==="editable"?e.push(gn(r)):(Z==null?void 0:Z.markerMode)==="visible"&&e.push(Fn("attribute",r))}function yu(t,e){return t.length<=0||e===0?t:t.map(n=>n-e)}function Cx(t,e){const n=t.indexOf(e,0);n>-1&&t.splice(n,1)}function bu(t,e){e.marker===qn&&e.sid!==void 0&&t.push(e.sid),e.marker===ar&&e.eid!==void 0&&Cx(t,e.eid)}function Pa(t,e,n=!1,r=[]){if(e.length<=0||e[0]>=t.length)return t;const s=e.shift(),i=e.length>0?e.shift():t.length-1;if(s===void 0||i===void 0||i>=t.length||t.length<=0)return t;const o=t.slice(0,s),a=n?[pu(o,[...r])]:o,l=t[s];bu(r,l);const u=Pa(t.slice(s+1,i),yu(e,s+1),l.marker===qn,r),d=pu(u,[...r]),f=t[i];bu(r,f);const h=Pa(t.slice(i+1),yu(e,i+1),f.marker===qn,r);return[...a,d,...h]}function Qr(t){const e=[],n=[];return t==null||t.forEach(r=>{if(typeof r=="string")r&&n.push(gn(r));else if(!r.type)ve==null||ve.error("Marker type is missing!");else switch(r.type){case dt.getType():n.push(hx(r));break;case vt.getType():n.push(fx(r));break;case Ge.getType():Z!=null&&Z.hasSpacing||n.push(ix),n.push(px(r));break;case Ce.getType():gu(r.marker??"",n),n.push(gx(r,Qr(r.content))),mu(r.marker??"",n);break;case tt.getType():n.push(mx(r,Qr(r.content)));break;case $e.getType():n.push(bx(r,Qr(r.content)));break;case $t.getType():A_(r.marker??"")&&(e.push(n.length),r.sid!==void 0&&(Fi==null||Fi.push(r.sid))),n.push(kx(r)),gu(r.marker??"",n),xx(r,n),mu(r.marker??"",n,!0);break;case wn.getType():n.push(wx(r.marker??""));break;default:ve==null||ve.warn(`Unknown type-marker '${r.type}-${r.marker}'!`),n.push(vx(r,Qr(r.content)))}}),Pa(n,e)}function $a(t){const e=t.findIndex(n=>h_(n)||U_(n)||q_(n));if(e>=0){const n=$a(t.slice(0,e)),r=t[e],s=$a(t.slice(e+1));return[...n,r,...s]}else if(t.some(n=>"text"in n&&"mode"in n||_k(n)))return[qf(t)];return t}const Da={initialize:ox,reset:ax,serializeEditorState:lx},si=t=>{if(!$e.isValidMarker(t)||!t.includes("f"))throw new Error(`Invalid footnote marker '${t}'`);return{action:e=>{const{chapterNum:n,verseNum:r}=e.reference,s=[];return n!==void 0&&r!==void 0&&s.push({type:"char",marker:"fr",content:[`${n}:${r}`]}),e.noteText&&s.push({type:"char",marker:"fq",content:[e.noteText]}),s.push({type:"char",marker:"ft"}),[{type:"note",marker:t,caller:Pt,content:s}]}}},_u=t=>{if(!$e.isValidMarker(t)||!t.includes("x"))throw new Error(`Invalid cross-reference marker '${t}'`);return{action:e=>{const{chapterNum:n,verseNum:r}=e.reference,s=[];return n!==void 0&&r!==void 0&&s.push({type:"char",marker:"xo",content:[`${n}:${r}`]}),e.noteText&&s.push({type:"char",marker:"xq",content:[e.noteText]}),s.push({type:"char",marker:"xt"}),[{type:"note",marker:t,caller:pr,content:s}]}}},Sx={c:{action:t=>{const{chapterNum:e}=t.reference;return[{type:"chapter",marker:"c",number:`${e+1}`}]}},v:{action:t=>{const{verseNum:e,verse:n}=t.reference;return[{type:"verse",marker:"v",number:`${Oa(e,n)}`}]}},f:si("f"),fe:si("fe"),ef:si("ef"),efe:si("efe"),x:_u("x"),ex:_u("ex")};function Tx(t,e,n,r,s){const i=Ex(t);return{action:o=>{o.editor.update(()=>{var a;const l=re();X(l)&&(o.noteText=l.getTextContent());const u=(a=i==null?void 0:i.action)==null?void 0:a.call(i,o);if(!u)return;const d=Kc(u,Da,r),f=na(d);if(X(l)){const h=l.anchor.getNode();if(oe(f))_f(f,l,r),f.getIsCollapsed()||(e.current=f.getKey());else if(l.getTextContent().length>0)Ox(l,()=>na(d));else if(we(f)&&!f.isInline()){const p=l.insertParagraph();if(p){const y=p.getChildren();f.append(...y),p.replace(f),f.selectStart()}}else if(ee(h)&&!Ss(h)&&oe(h.getParent())&&l.isCollapsed()){let p=h.insertAfter(f);if($i(f)){const y={...r||Mr(),markerMode:"hidden"},b=Kc(u,Da,y),w=na(b);p=p.insertAfter(w)}p.insertAfter(_e(me))}else{l.insertNodes([f]),Ix(f);const p=f.getNextSibling();p?p.selectStart():f.selectStart()}}else l==null||l.insertNodes([f])},s)},label:i==null?void 0:i.label}}function Ex(t){let e=Sx[t];return e||(tt.isValidMarker(t)?e={action:()=>[{type:tt.getType(),marker:t,content:[]}]}:Ce.isValidMarker(t)&&(e={action:()=>[{type:Ce.getType(),marker:t}]})),e}function Ox(t,e){const n=t.getNodes(),[r,s]=Mx(t);let i;n.forEach((o,a)=>{if(we(i)&&i.isParentOf(o))return;const l=Ax(o,a===0,a===n.length-1,r,s);if(!l){i=void 0;return}i||(i=e(),l.insertBefore(i)),Nx(l,i)}),(ee(i)||we(i))&&i.selectEnd()}function Mx(t){const e=t.anchor.offset,n=t.focus.offset;return t.isBackward()?[n,e]:[e,n]}function Ax(t,e,n,r,s){if(!(Ee(t)||oe(t)||oe(t.getParent()))){if(ee(t))return jx(t,e,n,r,s);if(we(t)&&t.isInline())return t}}function jx(t,e,n,r,s){const i=t.getTextContentSize(),o=e?r:0,a=n?s:i;if(o===0&&a===0)return;const l=t.splitText(o,a);return l.length===1?l[0]:l.length===3||a===i?l[1]:l[0]}function Nx(t,e){var n;if(ee(e)){const r=ku(t,e);e.setTextContent(r),t.remove()}else if(we(e)){const r=e.getChildrenSize();e.append(t);for(let s=0;s<r;s++)(n=e.getFirstChild())==null||n.remove();ku(t,e)}}function ku(t,e){let n=t.getTextContent();if(ee(t)&&e.isInline()&&n.startsWith(" ")){n=n.trimStart(),t.setTextContent(n);const r=e.getPreviousSibling();Sl(r),ee(r)||e.insertBefore(_e(" "))}return n}function Ix(t){ut(t)&&(Sl(t.getPreviousSibling()),wf(t.getNextSibling()))}const Lf={chapter:"chapter",verse:"verse",char:"char",para:"para",typedMark:"editor-typed-mark",typedMarkOverlap:"editor-typed-markOverlap",mark:"editor-mark",markOverlap:"editor-markOverlap",placeholder:"editor-placeholder",paragraph:"editor-paragraph",quote:"editor-quote",heading:{h1:"editor-heading-h1",h2:"editor-heading-h2",h3:"editor-heading-h3",h4:"editor-heading-h4",h5:"editor-heading-h5"},list:{nested:{listitem:"editor-nested-listitem"},ol:"editor-list-ol",ul:"editor-list-ul",listitem:"editor-listitem"},image:"editor-image",link:"editor-link",text:{bold:"editor-text-bold",italic:"editor-text-italic",overflowed:"editor-text-overflowed",hashtag:"editor-text-hashtag",underline:"editor-text-underline",strikethrough:"editor-text-strikethrough",underlineStrikethrough:"editor-text-underlineStrikethrough"}};function Rx({options:t,editedUsjRef:e,usj:n,setUsj:r}){const{view:s,nodes:i}=t||{},{hasSpacing:o,isFormattedFont:a,markerMode:l}=s||{};return _.useEffect(()=>{e.current&&!zt(e.current,n)&&r(e.current)},[e,o,a,l,i,r,n]),null}function Px({scrRef:t,onScrRefChange:e}){const[n]=ce(),r=_.useRef(!1),s=_.useRef(!1),{book:i,chapterNum:o,verseNum:a}=t;return _.useEffect(()=>n.registerMutationListener(dt,l=>{n.update(()=>{for(const[u,d]of l){const f=Te(u);f&&Rt(f)&&d==="created"&&vu(o,a,s)}},{tag:Sa})},{skipInitialization:!0}),[n,o,a]),_.useEffect(()=>{r.current?r.current=!1:n.update(()=>vu(o,a,s),{tag:Sa})},[n,o,a]),_.useEffect(()=>n.registerCommand(_s,()=>(s.current?s.current=!1:$x(i,o,a,e,r),!1),kr),[n,i,o,a,e]),null}function vu(t,e,n){var r;const s=uf(re()),i=(r=vf(s))==null?void 0:r.getNumber();if(Q_(i)&&vl(e,i))return;const o=Dt().getChildren(),a=B_(o,t),l=X_(o,a),u=H_(l,!!a);if(u&&!a||!a)return;Y_(l,u);const d=Tk(l,e);if(d){if(Ke(d)){const f=d.getFirstChild();ee(f)?f.select(0,0):d.select(0,0)}else d.selectNext(0,0);n.current=!0}}function $x(t,e,n,r,s){const i=uf(re());if(!i)return;const o=yl(i),a=parseInt((o==null?void 0:o.getNumber())??"1",10),l=vf(i),u=l==null?void 0:l.getNumber(),d=parseInt(u??"0",10),f=u?vl(n,u):n===d;if(s.current=!!(o&&a!==e||!f),s.current){const h={book:t,chapterNum:a,verseNum:d};u!=null&&d.toString()!==u&&(h.verse=u),r(h)}}function Dx(t){return Rt(t)?`${t.__code}`:dl(t)?`${t.__marker} "${t.__number}"`:pe(t)?`${t.__marker}`:xs(t)?`${t.__marker} "${t.__number}"`:xn(t)?`${t.__caller}`:Er(t)?`${t.__marker} "${t.__number}"`:oe(t)?`${t.__marker} "${t.__caller}"`+(t.__isCollapsed?" (collapsed)":" (expanded)"):Ke(t)?`${t.__marker}`:Ee(t)?`ids: [ ${JSON.stringify(t.getTypedIDs())} ]`:ml(t)?`${t.__marker} "${t.__number}"`:""}function qx(){const[t]=ce();return m.jsx(Vm,{viewClassName:"tree-view-output",treeTypeButtonClassName:"debug-treetype-button",timeTravelPanelClassName:"debug-timetravel-panel",timeTravelButtonClassName:"debug-timetravel-button",timeTravelPanelSliderClassName:"debug-timetravel-panel-slider",timeTravelPanelButtonClassName:"debug-timetravel-panel-button",customPrintNode:Dx,editor:t})}const Ff=_.createContext(null),wu=4;function Lx({children:t,className:e,onClick:n,title:r}){const s=_.useRef(null),i=_.useContext(Ff);if(i===null)throw new Error("DropDownItem must be used within a DropDown");const{registerItem:o}=i;return _.useEffect(()=>{s&&s.current&&o(s)},[s,o]),m.jsx("button",{className:e,onClick:n,ref:s,title:r,type:"button",children:t})}function Fx({children:t,dropDownRef:e,onClose:n}){const[r,s]=_.useState(),[i,o]=_.useState(),a=_.useCallback(d=>{s(f=>f?[...f,d]:[d])},[s]),l=d=>{if(!r)return;const f=d.key;["Escape","ArrowUp","ArrowDown","Tab"].includes(f)&&d.preventDefault(),f==="Escape"||f==="Tab"?n():f==="ArrowUp"?o(h=>{if(!h)return r[0];const p=r.indexOf(h)-1;return r[p===-1?r.length-1:p]}):f==="ArrowDown"&&o(h=>h?r[r.indexOf(h)+1]:r[0])},u=_.useMemo(()=>({registerItem:a}),[a]);return _.useEffect(()=>{r&&!i&&o(r[0]),i&&i.current&&i.current.focus()},[r,i]),m.jsx(Ff.Provider,{value:u,children:m.jsx("div",{className:"dropdown",ref:e,onKeyDown:l,children:t})})}function Ux({disabled:t=!1,buttonLabel:e,buttonAriaLabel:n,buttonClassName:r,buttonIconClassName:s,children:i,stopCloseOnClickSelf:o}){const a=_.useRef(null),l=_.useRef(null),[u,d]=_.useState(!1),f=()=>{d(!1),l&&l.current&&l.current.focus()};return _.useEffect(()=>{const h=l.current,p=a.current;if(u&&h!==null&&p!==null){const{top:y,left:b}=h.getBoundingClientRect();p.style.top=`${y+h.offsetHeight+wu}px`,p.style.left=`${Math.min(b,window.innerWidth-p.offsetWidth-20)}px`}},[a,l,u]),_.useEffect(()=>{const h=l.current;if(h!==null&&u){const p=y=>{const b=y.target;o&&a.current&&a.current.contains(b)||h.contains(b)||d(!1)};return document.addEventListener("click",p),()=>{document.removeEventListener("click",p)}}return()=>{}},[a,l,u,o]),_.useEffect(()=>{const h=()=>{if(u){const p=l.current,y=a.current;if(p!==null&&y!==null){const{top:b}=p.getBoundingClientRect(),w=b+p.offsetHeight+wu;w!==y.getBoundingClientRect().top&&(y.style.top=`${w}px`)}}};return document.addEventListener("scroll",h),()=>{document.removeEventListener("scroll",h)}},[l,a,u]),m.jsxs(m.Fragment,{children:[m.jsxs("button",{type:"button",disabled:t,"aria-label":n||e,className:r,onClick:()=>d(!u),ref:l,children:[s&&m.jsx("span",{className:s}),e&&m.jsx("span",{className:"text dropdown-button-text",children:e}),m.jsx("i",{className:"chevron-down"})]}),u&&At.createPortal(m.jsx(Fx,{dropDownRef:a,onClose:f,children:i}),document.body)]})}const qa={m:"m - Paragraph - Margin - No First Line Indent",ms:"ms - Heading - Major Section Level 1",nb:"nb - Paragraph - No Break with Previous Paragraph",p:"p - Paragraph - Normal - First Line Indent",pi:"pi - Paragraph - Indented - Level 1 - First Line Indent",q1:"q1 - Poetry - Indent Level 1",q2:"q2 - Poetry - Indent Level 2",r:"r - Heading - Parallel References",s:"s - Heading - Section Level 1"},La={...qa,ide:"ide - File - Encoding",h:"h - File - Header",h1:"h1 - File - Header",h2:"h2 - File - Left Header",h3:"h3 - File - Right Header",toc1:"toc1 - File - Long Table of Contents Text",toc2:"toc2 - File - Short Table of Contents Text",toc3:"toc3 - File - Book Abbreviation",cl:"cl - Chapter - Publishing Label",mt:"mt - Title - Major Title Level 1",mt1:"mt1 - Title - Major Title Level 1",mt2:"mt2 - Title - Major Title Level 2",mt3:"mt3 - Title - Major Title Level 3",mt4:"mt4 - Title - Major Title Level 4",ms1:"ms1 - Heading - Major Section Level 1",ms2:"ms2 - Heading - Major Section Level 2",ms3:"ms3 - Heading - Major Section Level 3",b:"b - Poetry - Stanza Break (Blank Line)"};function Bx({editorRef:t,blockMarker:e,disabled:n=!1}){return m.jsx(Ux,{disabled:n,buttonClassName:"toolbar-item block-controls",buttonIconClassName:"icon block-marker "+Hx(e),buttonLabel:Wx(e),buttonAriaLabel:"Formatting options for block type",children:Object.keys(qa).map(r=>m.jsxs(Lx,{className:"item block-marker "+zx(e===r),onClick:()=>{var s;return(s=t.current)==null?void 0:s.formatPara(r)},children:[m.jsx("i",{className:"icon block-marker "+r}),m.jsx("span",{className:"text usfm_"+r,children:qa[r]})]},r))})}function Hx(t){return t&&t in La?t:"ban"}function Wx(t){return t&&t in La?La[t]:"No Style"}function zx(t){return t?"active dropdown-item-active":""}function xu(){return m.jsx("div",{className:"divider"})}const Kx=_.forwardRef(function({editorRef:t,isReadonly:e=!1,onStateChange:n},r){const[s]=ce(),[i,o]=_.useState(s),[a,l]=_.useState(),[u,d]=_.useState(!1),[f,h]=_.useState(!1),p=_.useCallback(({canUndo:y,canRedo:b,blockMarker:w,contextMarker:M})=>{d(y),h(b),l(w),n==null||n({canUndo:y,canRedo:b,blockMarker:w,contextMarker:M})},[n]);return _.useEffect(()=>s.registerCommand(_s,(y,b)=>(o(b),!1),es),[s]),m.jsxs(m.Fragment,{children:[m.jsx(Pf,{onStateChange:p}),m.jsxs("div",{className:"toolbar",children:[m.jsx("button",{disabled:!u||e,onClick:()=>{i.dispatchCommand(Ha,void 0)},title:ha?"Undo (Z)":"Undo (Ctrl+Z)",type:"button",className:"toolbar-item spaced","aria-label":"Undo",children:m.jsx("i",{className:"format undo"})}),m.jsx("button",{disabled:!f||e,onClick:()=>{i.dispatchCommand(Ba,void 0)},title:ha?"Redo (Y)":"Redo (Ctrl+Y)",type:"button",className:"toolbar-item","aria-label":"Redo",children:m.jsx("i",{className:"format redo"})}),m.jsx(xu,{}),i===s&&m.jsxs(m.Fragment,{children:[m.jsx(Bx,{editorRef:t,blockMarker:a,disabled:e}),m.jsx(xu,{})]}),m.jsx("div",{ref:r,className:"end-container"})]})]})}),Cu={namespace:"platformEditor",theme:Lf,editable:!0,editorState:void 0,onError(t){throw t},nodes:[Le,...cv]},Jx=Mr(),Vx={},Gx={};function Yx(){return m.jsx("div",{className:"editor-placeholder",children:"Enter some Scripture..."})}const Uf=_.forwardRef(function({defaultUsj:t,scrRef:e,onScrRefChange:n,onSelectionChange:r,onUsjChange:s,onStateChange:i,options:o,logger:a,children:l},u){const d=_.useRef(null),f=_.useRef(null),h=_.useRef(null),p=_.useRef(t),y=_.useRef(),[b,w]=_.useState(t),[M,v]=_.useState(0),[S,j]=_.useState(),{isReadonly:P=!1,hasExternalUI:D=!1,hasSpellCheck:B=!1,textDirection:U="ltr",markerMenuTrigger:H="\\",view:W=Jx,nodes:k=Vx,debug:I=!1}=o??Gx;Cu.editable=!P,ca.initialize(a),_.useImperativeHandle(u,()=>({focus(){var O;(O=d.current)==null||O.focus()},undo(){var O;(O=d.current)==null||O.dispatchCommand(Ha,void 0)},redo(){var O;(O=d.current)==null||O.dispatchCommand(Ba,void 0)},cut(){var O;(O=d.current)==null||O.dispatchCommand(Hi,null)},copy(){var O;(O=d.current)==null||O.dispatchCommand(Wi,null)},paste(){d.current&&jl(d.current)},pastePlainText(){d.current&&Nl(d.current)},getUsj(){return p.current},setUsj(O){if(!zt(p.current,O)){p.current=O;const A=zt(b,O);w(O),A&&v(N=>N+1)}},applyUpdate(O,A="remote"){var N,q;(N=d.current)==null||N.update(()=>{A==="remote"&&Hp(Ea),Nv(O,W,k,a)},{discrete:!0});const L=(q=d.current)==null?void 0:q.getEditorState();if(!L)return;const F=ca.deserializeEditorState(L);if(F){const J=!zt(p.current,F);if(J&&(p.current=F),J||!zt(b,F)){const K=Zc(O,L);s==null||s(F,O,A,K)}}},replaceEmbedUpdate(O,A){var N;const q=(N=d.current)==null?void 0:N.read(()=>$k(O,A));q&&this.applyUpdate(q)},getSelection(){var O;return(O=d.current)==null?void 0:O.read(mf)},setSelection(O){var A;(A=d.current)==null||A.update(()=>{const N=xl(O);N!==void 0&&xd(N)},{tag:Wh})},setAnnotation(O,A,N,q,L){var F;(F=f.current)==null||F.setAnnotation(O,Wc(A),N,q,L)},removeAnnotation(O,A){var N;(N=f.current)==null||N.removeAnnotation(Wc(O),A)},formatPara(O){var A;(A=d.current)==null||A.update(()=>{const N=re();X(N)&&Bp(N,()=>ms(O))})},getElementByKey(O){var A;return(A=d.current)==null?void 0:A.read(()=>{var N;return((N=d.current)==null?void 0:N.getElementByKey(O))??void 0})},insertNote(O,A,N){var q;(q=d.current)==null||q.update(()=>{const L=kk(O,A,N,e,W,k,a);L&&!L.getIsCollapsed()&&(y.current=L.getKey())})},selectNote(O){var A;(A=d.current)==null||A.update(()=>{const N=Yc(O);N&&(wk(N,W),N.getIsCollapsed()||(y.current=N.getKey()))})},getNoteOps(O){var A;return(A=d.current)==null?void 0:A.read(()=>{const N=Yc(O);if(N)return El(N)})},get toolbarEndRef(){return h}}));const C=_.useCallback((O,A,N,q)=>{if(m_.some(F=>N.has(F)))return;const L=ca.deserializeEditorState(O);if(L){const F=!zt(p.current,L);if(F&&(p.current=L),F||!zt(b,L)){const J=N.has(Ea)?"remote":"local",K=Zc(q,O);s==null||s(L,q,J,K)}}},[b,s]),$=_.useCallback(O=>{j(O.contextMarker),i==null||i(O)},[i]);return m.jsxs(Cd,{initialConfig:Cu,children:[m.jsx(uw,{isEditable:!P}),m.jsxs("div",{className:"editor-container",children:[D?m.jsx(Pf,{onStateChange:$}):m.jsx("div",{className:"editor-toolbar-container"+(P?"-readonly":"-editable"),children:m.jsx(Kx,{ref:h,editorRef:u,isReadonly:P,onStateChange:$})}),m.jsxs("div",{className:"editor-inner",children:[m.jsx(Kd,{editorRef:d}),m.jsx(Wp,{contentEditable:m.jsx(Td,{className:`editor-input usfm ${Ww(W).join(" ")}`,spellCheck:B}),placeholder:m.jsx(Yx,{}),ErrorBoundary:Sd}),m.jsx(Gd,{}),e&&n&&m.jsx(Px,{scrRef:e,onScrRefChange:n}),e&&m.jsx(Pw,{trigger:H,scrRef:e,contextMarker:S,getMarkerAction:(O,A)=>Tx(O,y,A,W)}),m.jsx(Rx,{options:{view:W,nodes:k},editedUsjRef:p,usj:b,setUsj:w}),m.jsx(dw,{scripture:b,nodeOptions:k,editorAdaptor:Da,viewOptions:W,logger:a},M),m.jsx(Cw,{onChange:r}),m.jsx(Av,{onChange:C,ignoreSelectionChange:!0,ignoreHistoryMergeTagChange:!0}),m.jsx(Mv,{ref:f,logger:a}),m.jsx(Vv,{viewOptions:W}),m.jsx(ew,{}),m.jsx(sw,{}),m.jsx(iw,{logger:a}),m.jsx(cw,{}),m.jsx(hw,{expandedNoteKeyRef:y,nodeOptions:k,viewOptions:W,logger:a}),m.jsx(Sw,{}),m.jsx(Ow,{textDirection:U}),m.jsx(Aw,{}),l]}),I&&m.jsx(qx,{})]})]})}),Ts=_.forwardRef(function(t,e){const{children:n,...r}=t;return m.jsx(Uf,{ref:e,...r})});function Bf(){return Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5)}function Ui(t,e,n,r,s){return{author:e,content:t,deleted:s===void 0?!1:s,id:n===void 0?Bf():n,timeStamp:r===void 0?performance.timeOrigin+performance.now():r,type:"comment"}}function Hf(t,e,n){return{comments:e,id:n===void 0?Bf():n,quote:t,type:"thread"}}function Su(t){return{comments:Array.from(t.comments),id:t.id,quote:t.quote,type:"thread"}}function Xx(t){return{author:t.author,content:"[Deleted Comment]",deleted:!0,id:t.id,timeStamp:t.timeStamp,type:"comment"}}function ua(t){const e=t._changeListeners;for(const n of e)n()}class Zx{constructor(e,n){z(this,"_editor"),z(this,"_comments"),z(this,"_changeListeners"),z(this,"_collabProvider"),z(this,"logger"),this._comments=[],this._editor=e,this.logger=n,this._collabProvider=null,this._changeListeners=new Set}isCollaborative(){return this._collabProvider!==null}getComments(){return this._comments}setComments(e){this._comments=e,ua(this)}addComment(e,n,r){const s=Array.from(this._comments),i=this._getCollabComments();if(n!==void 0&&e.type==="comment")for(let o=0;o<s.length;o++){const a=s[o];if(a.type==="thread"&&a.id===n.id){const l=Su(a);s.splice(o,1,l);const u=r!==void 0?r:l.comments.length;if(this.isCollaborative()&&i!==null){const d=i.get(o).get("comments");this._withRemoteTransaction(()=>{const f=this._createCollabSharedMap(e);d.insert(u,[f])})}l.comments.splice(u,0,e);break}}else{const o=r!==void 0?r:s.length;this.isCollaborative()&&i!==null&&this._withRemoteTransaction(()=>{const a=this._createCollabSharedMap(e);i.insert(o,[a])}),s.splice(o,0,e)}this._comments=s,ua(this)}deleteCommentOrThread(e,n){const r=Array.from(this._comments),s=this._getCollabComments();let i=null;if(n!==void 0)for(let o=0;o<r.length;o++){const a=r[o];if(a.type==="thread"&&a.id===n.id){const l=Su(a);r.splice(o,1,l);const u=l.comments;if(i=u.indexOf(e),this.isCollaborative()&&s!==null){const d=s.get(o).get("comments"),f=i;this._withRemoteTransaction(()=>{d.delete(f)})}u.splice(i,1);break}}else i=r.indexOf(e),this.isCollaborative()&&s!==null&&this._withRemoteTransaction(()=>{s.delete(i)}),r.splice(i,1);return this._comments=r,ua(this),e.type==="comment"?{index:i,markedComment:Xx(e)}:null}registerOnChange(e){const n=this._changeListeners;return n.add(e),()=>{n.delete(e)}}_withRemoteTransaction(e){const n=this._collabProvider;n!==null&&n.doc.transact(e,this)}_withLocalTransaction(e){const n=this._collabProvider;try{this._collabProvider=null,e()}finally{this._collabProvider=n}}_getCollabComments(){const e=this._collabProvider;return e!==null?e.doc.get("comments",Rn):null}_createCollabSharedMap(e){const n=new dr,r=e.type,s=e.id;if(n.set("type",r),n.set("id",s),r==="comment")n.set("author",e.author),n.set("content",e.content),n.set("deleted",e.deleted),n.set("timeStamp",e.timeStamp);else{n.set("quote",e.quote);const i=new Rn;e.comments.forEach((o,a)=>{const l=this._createCollabSharedMap(o);i.insert(a,[l])}),n.set("comments",i)}return n}registerCollaboration(e){this._collabProvider=e;const n=this._getCollabComments(),r=()=>{e.connect()},s=()=>{try{e.disconnect()}catch{}},i=this._editor.registerCommand(i_,a=>{var l,u;return r!==void 0&&s!==void 0&&(a?((l=this.logger)==null||l.info("Comments connected!"),r()):((u=this.logger)==null||u.info("Comments disconnected!"),s())),!1},kr),o=(a,l)=>{if(l.origin!==this){for(const u of a)if(u instanceof Nh){const d=u.target,f=u.delta;let h=0;for(const p of f){const y=p.insert,b=p.retain,w=p.delete,M=d.parent,v=d===n?void 0:M instanceof dr&&this._comments.find(S=>S.id===M.get("id"));if(Array.isArray(y)){const S=h;y.slice().reverse().forEach(j=>{const P=j.get("id"),D=j.get("type")==="thread"?Hf(j.get("quote"),j.get("comments").toArray().map(B=>Ui(B.get("content"),B.get("author"),B.get("id"),B.get("timeStamp"),B.get("deleted"))),P):Ui(j.get("content"),j.get("author"),P,j.get("timeStamp"),j.get("deleted"));this._withLocalTransaction(()=>{this.addComment(D,v,S)})})}else if(typeof b=="number")h+=b;else if(typeof w=="number")for(let S=0;S<w;S++){const j=v===void 0||v===!1?this._comments[h]:v.comments[h];this._withLocalTransaction(()=>{this.deleteCommentOrThread(j,v)}),h++}}}}};return n===null?()=>null:(n.observeDeep(o),r(),()=>{n.unobserveDeep(o),i(),this._collabProvider=null})}}function Qx(t){const[e,n]=_.useState(t.getComments());return _.useEffect(()=>t.registerOnChange(()=>{n(t.getComments())}),[t]),e}function eC({onClose:t,children:e,title:n,closeOnClickOutside:r}){const s=_.useRef(null);return _.useEffect(()=>{s.current!==null&&s.current.focus()},[]),_.useEffect(()=>{let i=null;const o=u=>{u.key==="Escape"&&t()},a=u=>{const d=u.target;s.current!==null&&!s.current.contains(d)&&r&&t()},l=s.current;return l!==null&&(i=l.parentElement,i!==null&&i.addEventListener("click",a)),window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o),i!==null&&(i==null||i.removeEventListener("click",a))}},[r,t]),m.jsx("div",{className:"Modal__overlay",role:"dialog",children:m.jsxs("div",{className:"Modal__modal",tabIndex:-1,ref:s,children:[m.jsx("h2",{className:"Modal__title",children:n}),m.jsx("button",{className:"Modal__closeButton","aria-label":"Close modal",type:"button",onClick:t,children:"X"}),m.jsx("div",{className:"Modal__content",children:e})]})})}function tC({onClose:t,children:e,title:n,closeOnClickOutside:r=!1}){return At.createPortal(m.jsx(eC,{onClose:t,title:n,closeOnClickOutside:r,children:e}),document.body)}function Wf(){const[t,e]=_.useState(null),n=_.useCallback(()=>{e(null)},[]),r=_.useMemo(()=>{if(t===null)return null;const{title:i,content:o,closeOnClickOutside:a}=t;return m.jsx(tC,{onClose:n,title:i,closeOnClickOutside:a,children:o})},[t,n]),s=_.useCallback((i,o,a=!1)=>{e({closeOnClickOutside:a,content:o(n),title:i})},[n]);return[r,s]}const nC={...Lf,paragraph:"CommentEditorTheme__paragraph"};function rC(...t){return t.filter(Boolean).join(" ")}function mn({"data-test-id":t,children:e,className:n,onClick:r,disabled:s,small:i,title:o}){return m.jsx("button",{disabled:s,className:rC("Button__root",s&&"Button__disabled",i&&"Button__small",n),onClick:r,title:o,"aria-label":o,...t&&{"data-test-id":t},children:e})}function sC({className:t}){return m.jsx(Td,{className:t||"ContentEditable__root"})}function iC({children:t,className:e}){return m.jsx("div",{className:e||"Placeholder__root",children:t})}const Tu=Wa("INSERT_INLINE_COMMAND");function oC({anchorKey:t,editor:e,showComments:n,onAddComment:r}){const s=_.useRef(null),i=_.useCallback(()=>{const o=s.current,a=e.getRootElement(),l=e.getElementByKey(t);if(o!==null&&a!==null&&l!==null){const{right:u}=a.getBoundingClientRect(),{top:d}=l.getBoundingClientRect();o.style.left=`${u-20}px`,o.style.top=`${d-30}px`}},[t,e]);return _.useEffect(()=>(window.addEventListener("resize",i),()=>{window.removeEventListener("resize",i)}),[e,i]),_.useLayoutEffect(()=>{i()},[t,e,n,i]),m.jsx("div",{className:"CommentPlugin_AddCommentBox",ref:s,children:m.jsx("button",{className:"CommentPlugin_AddCommentBox_button",onClick:r,children:m.jsx("i",{className:"icon add-comment"})})})}function aC({onEscape:t}){const[e]=ce();return _.useEffect(()=>e.registerCommand(kd,n=>t(n),yi),[e,t]),null}function zf({className:t,autoFocus:e,onEscape:n,onChange:r,editorRef:s,placeholder:i="Type a comment..."}){return m.jsx(Cd,{initialConfig:{namespace:"Commenting",nodes:[],onError:o=>{throw o},theme:nC},children:m.jsxs("div",{className:"CommentPlugin_CommentInputBox_EditorContainer",children:[m.jsx(py,{contentEditable:m.jsx(sC,{className:t}),placeholder:m.jsx(iC,{children:i}),ErrorBoundary:Sd}),m.jsx(Qp,{onChange:r}),m.jsx(Gd,{}),e!==!1&&m.jsx(eg,{}),m.jsx(aC,{onEscape:n}),m.jsx(tg,{}),s!==void 0&&m.jsx(Kd,{editorRef:s})]})})}function Kf(t,e){return _.useCallback((n,r)=>{n.read(()=>{t(Xp()),e(!Zp(r.isComposing(),!0))})},[e,t])}function lC({editor:t,cancelAddComment:e,submitAddComment:n}){const[r,s]=_.useState(""),[i,o]=_.useState(!1),a=_.useRef(null),l=_.useMemo(()=>({container:document.createElement("div"),elements:[]}),[]),u=_.useRef(null),d=Vf(),f=_.useCallback(()=>{t.getEditorState().read(()=>{const b=re();if(X(b)){u.current=b.clone();const w=b.anchor,M=b.focus,v=Gp(t,w.getNode(),w.offset,M.getNode(),M.offset),S=a.current;if(v!==null&&S!==null){const{left:j,bottom:P,width:D}=v.getBoundingClientRect(),B=Yp(t,v);let U=B.length===1?j+D/2-125:j-125;U<10&&(U=10),S.style.left=`${U}px`,S.style.top=`${P+20+(window.pageYOffset||document.documentElement.scrollTop)}px`;const H=B.length,{container:W}=l,k=l.elements,I=k.length;for(let C=0;C<H;C++){const $=B[C];let O=k[C];O===void 0&&(O=document.createElement("span"),k[C]=O,W.appendChild(O));const A=`position:absolute;top:${$.top+(window.pageYOffset||document.documentElement.scrollTop)}px;left:${$.left}px;height:${$.height}px;width:${$.width}px;background-color:rgba(255, 212, 0, 0.3);pointer-events:none;z-index:5;`;O.style.cssText=A}for(let C=I-1;C>=H;C--){const $=k[C];W.removeChild($),k.pop()}}}})},[t,l]);_.useLayoutEffect(()=>{f();const b=l.container,w=document.body;return w!==null?(w.appendChild(b),()=>{w.removeChild(b)}):()=>{}},[l.container,f]),_.useEffect(()=>(window.addEventListener("resize",f),()=>{window.removeEventListener("resize",f)}),[f]);const h=b=>(b.preventDefault(),e(),!0),p=()=>{if(i){let b=t.getEditorState().read(()=>{const w=u.current;return w?w.getTextContent():""});b.length>100&&(b=b.slice(0,99)+""),n(Hf(b,[Ui(r,d)]),!0,void 0,u.current),u.current=null}},y=Kf(s,o);return m.jsxs("div",{className:"CommentPlugin_CommentInputBox",ref:a,children:[m.jsx(zf,{className:"CommentPlugin_CommentInputBox_Editor",onEscape:h,onChange:y}),m.jsxs("div",{className:"CommentPlugin_CommentInputBox_Buttons",children:[m.jsx(mn,{onClick:e,className:"CommentPlugin_CommentInputBox_Button",children:"Cancel"}),m.jsx(mn,{onClick:p,disabled:!i,className:"CommentPlugin_CommentInputBox_Button primary",children:"Comment"})]})]})}function cC({submitAddComment:t,thread:e,placeholder:n}){const[r,s]=_.useState(""),[i,o]=_.useState(!1),a=_.useRef(null),l=Vf(),u=Kf(s,o);return m.jsxs(m.Fragment,{children:[m.jsx(zf,{className:"CommentPlugin_CommentsPanel_Editor",autoFocus:!1,onEscape:()=>!0,onChange:u,editorRef:a,placeholder:n}),m.jsx(mn,{className:"CommentPlugin_CommentsPanel_SendButton",onClick:()=>{if(i){t(Ui(r,l),!1,e);const d=a.current;d!==null&&d.dispatchCommand(gd,void 0)}},disabled:!i,children:m.jsx("i",{className:"send"})})]})}function Jf({commentOrThread:t,deleteCommentOrThread:e,onClose:n,thread:r=void 0}){return m.jsxs(m.Fragment,{children:["Are you sure you want to delete this ",t.type,"?",m.jsxs("div",{className:"Modal__content",children:[m.jsx(mn,{onClick:()=>{e(t,r),n()},children:"Delete"})," ",m.jsx(mn,{onClick:()=>{n()},children:"Cancel"})]})]})}function Eu({comment:t,deleteComment:e,thread:n,rtf:r}){const s=Math.round((t.timeStamp-(performance.timeOrigin+performance.now()))/1e3),i=Math.round(s/60),[o,a]=Wf();return m.jsxs("li",{className:"CommentPlugin_CommentsPanel_List_Comment",children:[m.jsxs("div",{className:"CommentPlugin_CommentsPanel_List_Details",children:[m.jsx("span",{className:"CommentPlugin_CommentsPanel_List_Comment_Author",children:t.author}),m.jsxs("span",{className:"CommentPlugin_CommentsPanel_List_Comment_Time",children:[" ",s>-10?"Just now":r.format(i,"minute")]})]}),m.jsx("p",{className:t.deleted?"CommentPlugin_CommentsPanel_DeletedComment":"",children:t.content}),!t.deleted&&m.jsxs(m.Fragment,{children:[m.jsx(mn,{onClick:()=>{a("Delete Comment",l=>m.jsx(Jf,{commentOrThread:t,deleteCommentOrThread:e,thread:n,onClose:l}))},className:"CommentPlugin_CommentsPanel_List_DeleteButton",children:m.jsx("i",{className:"delete"})}),o]})]})}function uC({activeIDs:t,comments:e,deleteCommentOrThread:n,listRef:r,submitAddComment:s,markNodeMap:i}){const[o]=ce(),[a,l]=_.useState(0),[u,d]=Wf(),f=_.useMemo(()=>new Intl.RelativeTimeFormat("en",{localeMatcher:"best fit",numeric:"auto",style:"short"}),[]);return _.useEffect(()=>{const h=setTimeout(()=>{l(a+1)},1e4);return()=>{clearTimeout(h)}},[a]),m.jsx("ul",{className:"CommentPlugin_CommentsPanel_List",ref:r,children:e.map(h=>{const p=h.id;return h.type==="thread"?m.jsxs("li",{onClick:()=>{const y=i.get(p);if(y!==void 0&&(t===null||t.indexOf(p)===-1)){const b=document.activeElement;o.update(()=>{const w=Array.from(y)[0],M=Te(w);Ee(M)&&M.selectStart()},{onUpdate(){b!==null&&b.focus()}})}},className:`CommentPlugin_CommentsPanel_List_Thread ${i.has(p)?"interactive":""} ${t.indexOf(p)===-1?"":"active"}`,children:[m.jsxs("div",{className:"CommentPlugin_CommentsPanel_List_Thread_QuoteBox",children:[m.jsxs("blockquote",{className:"CommentPlugin_CommentsPanel_List_Thread_Quote",children:["> ",m.jsx("span",{children:h.quote})]}),m.jsx(mn,{onClick:()=>{d("Delete Thread",y=>m.jsx(Jf,{commentOrThread:h,deleteCommentOrThread:n,onClose:y}))},className:"CommentPlugin_CommentsPanel_List_DeleteButton",children:m.jsx("i",{className:"delete"})}),u]}),m.jsx("ul",{className:"CommentPlugin_CommentsPanel_List_Thread_Comments",children:h.comments.map(y=>m.jsx(Eu,{comment:y,deleteComment:n,thread:h,rtf:f},y.id))}),m.jsx("div",{className:"CommentPlugin_CommentsPanel_List_Thread_Editor",children:m.jsx(cC,{submitAddComment:s,thread:h,placeholder:"Reply to comment..."})})]},p):m.jsx(Eu,{comment:h,deleteComment:n,rtf:f},p)})})}function dC({activeIDs:t,deleteCommentOrThread:e,comments:n,submitAddComment:r,markNodeMap:s}){const i=_.useRef(null),o=n.length===0;return m.jsxs("div",{className:"CommentPlugin_CommentsPanel",children:[m.jsx("h2",{className:"CommentPlugin_CommentsPanel_Heading",children:"Comments"}),o?m.jsx("div",{className:"CommentPlugin_CommentsPanel_Empty",children:"No Comments"}):m.jsx(uC,{activeIDs:t,comments:n,deleteCommentOrThread:e,listRef:i,submitAddComment:r,markNodeMap:s})]})}function Vf(){const t=Zd(),{yjsDocMap:e,name:n}=t;return e.has("comments")?n:"Scripture User"}function hC({providerFactory:t,setCommentStore:e,onChange:n,showCommentsContainerRef:r,commentContainerRef:s,logger:i}){const o=Zd(),[a]=ce(),l=_.useMemo(()=>{const U=new Zx(a,i);return n&&U.registerOnChange(n),e==null||e(U),U},[a,i,n,e]),u=Qx(l),d=_.useMemo(()=>new Map,[]),[f,h]=_.useState(),[p,y]=_.useState([]),[b,w]=_.useState(!1),[M,v]=_.useState(!1),{yjsDocMap:S}=o;_.useEffect(()=>{if(t){const U=t("comments",S);return l.registerCollaboration(U)}return()=>{}},[l,t,S]);const j=_.useCallback(()=>{a.update(()=>{const U=re();U!==null&&(U.dirty=!0)}),w(!1)},[a]),P=_.useCallback((U,H)=>{if(U.type==="comment"){const W=l.deleteCommentOrThread(U,H);if(!W)return;const{markedComment:k,index:I}=W;l.addComment(k,H,I)}else{l.deleteCommentOrThread(U);const W=H!==void 0?H.id:U.id,k=d.get(W);k!==void 0&&setTimeout(()=>{a.update(()=>{for(const I of k){const C=Te(I);Ee(C)&&(C.deleteID(un,W),C.hasNoIDsForEveryType()&&Pi(C))}})})}},[l,a,d]),D=_.useCallback((U,H,W,k)=>{l.addComment(U,W),H&&(a.update(()=>{X(k)&&hf(k,un,U.id)}),w(!1))},[l,a]);_.useEffect(()=>{const U=[];for(const H of p){const W=d.get(H);if(W!==void 0)for(const k of W){const I=a.getElementByKey(k);I!==null&&(I.classList.add("selected"),U.push(I),v(!0))}}return()=>{for(const H of U)H.classList.remove("selected")}},[p,a,d]),_.useEffect(()=>{if(!a.hasNodes([Le]))throw new Error("CommentPlugin: TypedMarkNode not registered on editor!");const U=new Map;return Xe(Md(a,Le,H=>ys(H.getTypedIDs()),(H,W)=>{for(const[k,I]of Object.entries(H.getTypedIDs()))I.forEach(C=>{W.addID(k,C)})}),a.registerMutationListener(Le,H=>{a.getEditorState().read(()=>{for(const[W,k]of H){const I=Te(W);let C=[];k==="destroyed"?C=U.get(W)??[]:Ee(I)&&(C=I.getTypedIDs()[un]??[]);for(const $ of C){let O=d.get($);U.set(W,C),k==="destroyed"?O!==void 0&&(O.delete(W),O.size===0&&d.delete($)):(O===void 0&&(O=new Set,d.set($,O)),O.has(W)||O.add(W))}}})},{skipInitialization:!1}),a.registerUpdateListener(({editorState:H,tags:W})=>{H.read(()=>{const k=re();let I=!1,C=!1;if(X(k)){const $=k.anchor.getNode();if(ee($)){const O=ak($,un,k.anchor.offset)??[];O!==null&&(y(O),I=!0),k.isCollapsed()||(h($.getKey()),C=!0)}}I||y($=>$.length===0?$:[]),C||h(null),!W.has("collaboration")&&X(k)&&w(!1)})}),a.registerCommand(Tu,()=>{const H=window.getSelection();return H!==null&&H.removeAllRanges(),w(!0),!0},xe))},[a,d]);const B=()=>{a.dispatchCommand(Tu,void 0)};return m.jsxs(m.Fragment,{children:[b&&At.createPortal(m.jsx(lC,{editor:a,cancelAddComment:j,submitAddComment:D}),document.body),f!=null&&!b&&At.createPortal(m.jsx(oC,{anchorKey:f,editor:a,showComments:M,onAddComment:B}),document.body),r!==null&&At.createPortal(m.jsx(mn,{className:`CommentPlugin_ShowCommentsButton ${M?"active":""}`,onClick:()=>v(!M),title:M?"Hide Comments":"Show Comments",children:m.jsx("i",{className:"comments"})}),(r==null?void 0:r.current)??document.body),M&&At.createPortal(m.jsx(dC,{comments:u,submitAddComment:D,deleteCommentOrThread:P,activeIDs:p,markNodeMap:d}),(s==null?void 0:s.current)??document.body)]})}function fC(){const t=_.useRef(void 0),e=_.useCallback(n=>{t.current=n},[]);return[t,e]}function pC(t,e){var n,r;const s=((n=e.current)==null?void 0:n.getComments())??[],i=s==null?void 0:s.map(a=>a.id),o=t.map(a=>{const l=i.findIndex(u=>u===a);return l!==void 0&&l>=0?s[l]:{comments:[{author:"unknown",content:"Comment not found",deleted:!1,id:"",timeStamp:0,type:"comment"}],id:a,quote:"",type:"thread"}});s.forEach(a=>{t.includes(a.id)||o.push(a)}),o&&((r=e.current)==null||r.setComments(o))}function gC(t,e){_.useEffect(()=>{var n;t.options??(t.options={}),(n=t.options).nodes??(n.nodes={}),t.options.nodes.addMissingComments=r=>{pC(r,e)}},[e,t])}_.forwardRef(function(t,e){const n=_.useRef(null),r=_.useRef(!0),s=_.useRef(null),[i,o]=_.useState(null),{children:a,onCommentChange:l,onUsjChange:u,showCommentsContainerRef:d,...f}=t,{logger:h,options:{isReadonly:p}={}}=t,[y,b]=fC();gC(f,y),_.useEffect(()=>{},[h]),_.useImperativeHandle(e,()=>({focus(){var v;(v=n.current)==null||v.focus()},undo(){var v;(v=n.current)==null||v.undo()},redo(){var v;(v=n.current)==null||v.redo()},cut(){var v;(v=n.current)==null||v.cut()},copy(){var v;(v=n.current)==null||v.copy()},paste(){var v;(v=n.current)==null||v.paste()},pastePlainText(){var v;(v=n.current)==null||v.pastePlainText()},getUsj(){var v;return(v=n.current)==null?void 0:v.getUsj()},setUsj(v){var S;(S=n.current)==null||S.setUsj(v)},applyUpdate(v,S){var j;(j=n.current)==null||j.applyUpdate(v,S)},replaceEmbedUpdate(v,S){var j;return(j=n.current)==null?void 0:j.replaceEmbedUpdate(v,S)},getSelection(){var v;return(v=n.current)==null?void 0:v.getSelection()},setSelection(v){var S;(S=n.current)==null||S.setSelection(v)},setAnnotation(v,S,j,P,D){var B;(B=n.current)==null||B.setAnnotation(v,S,j,P,D)},removeAnnotation(v,S){var j;(j=n.current)==null||j.removeAnnotation(v,S)},formatPara(v){var S;(S=n.current)==null||S.formatPara(v)},getElementByKey(v){var S;return(S=n.current)==null?void 0:S.getElementByKey(v)},insertNote(v,S,j){var P;(P=n.current)==null||P.insertNote(v,S,j)},selectNote(v){var S;(S=n.current)==null||S.selectNote(v)},getNoteOps(v){var S;return(S=n.current)==null?void 0:S.getNoteOps(v)},setComments(v){var S;(S=y.current)==null||S.setComments(v),r.current=!0},get toolbarEndRef(){return i}}));const w=_.useCallback((v,S,j,P)=>{var D;if(!u)return;const B=(D=y.current)==null?void 0:D.getComments();u(v,B,S,j,P)},[y,u]),M=_.useCallback(()=>{var v;if(!l||r.current){r.current=!1;return}const S=(v=y.current)==null?void 0:v.getComments();l(S)},[y,r,l]);return _.useEffect(()=>{var v;return o(((v=n.current)==null?void 0:v.toolbarEndRef)??null),()=>o(null)},[]),m.jsx(ry,{children:m.jsxs(Uf,{ref:n,onUsjChange:w,...f,children:[m.jsx(hC,{setCommentStore:b,onChange:M,showCommentsContainerRef:p?null:d??i,commentContainerRef:s,logger:f.logger}),m.jsx("div",{ref:s,className:"comment-container"})]})})});const Gf=_.memo(function({viewMode:e,description:n,children:r}){const s=e==="story",i=_.useMemo(()=>!s||typeof n!="string"||!n.trim()?null:m.jsxs(ag,{className:"tw-w-full",children:[m.jsx(lg,{className:"tw-pb-2",children:m.jsx(cg,{className:"tw-text-sm tw-font-medium tw-text-muted-foreground",children:"Story Description"})}),m.jsx(ug,{className:"tw-pt-2",children:m.jsx(og,{className:"tw-prose-sm tw-max-w-none tw-text-muted-foreground",markdown:n})})]}),[n,s]);return m.jsxs("div",{style:{display:"grid",gap:8},children:[r,i]})});Gf.__docgenInfo={description:"",methods:[],displayName:"CanvasWithDescription",props:{viewMode:{required:!1,tsType:{name:"string"},description:""},description:{required:!1,tsType:{name:"string"},description:""},children:{required:!0,tsType:{name:"ReactNode"},description:""}}};const Fa={m:"m - Paragraph - Margin - No First Line Indent",ms:"ms - Heading - Major Section Level 1",nb:"nb - Paragraph - No Break with Previous Paragraph",p:"p - Paragraph - Normal - First Line Indent",pi:"pi - Paragraph - Indented - Level 1 - First Line Indent",q1:"q1 - Poetry - Indent Level 1",q2:"q2 - Poetry - Indent Level 2",r:"r - Heading - Parallel References",s:"s - Heading - Section Level 1"},Ou={...Fa,ide:"ide - File - Encoding",h:"h - File - Header",h1:"h1 - File - Header",h2:"h2 - File - Left Header",h3:"h3 - File - Right Header",toc1:"toc1 - File - Long Table of Contents Text",toc2:"toc2 - File - Short Table of Contents Text",toc3:"toc3 - File - Book Abbreviation",cl:"cl - Chapter - Publishing Label",mt:"mt - Title - Major Title Level 1",mt1:"mt1 - Title - Major Title Level 1",mt2:"mt2 - Title - Major Title Level 2",mt3:"mt3 - Title - Major Title Level 3",mt4:"mt4 - Title - Major Title Level 4",ms1:"ms1 - Heading - Major Section Level 1",ms2:"ms2 - Heading - Major Section Level 2",ms3:"ms3 - Heading - Major Section Level 3",b:"b - Poetry - Stanza Break (Blank Line)"},Mu={m:Ks,ms:rr,nb:Ks,p:Ks,pi:Ks,q1:Wo,q2:Wo,r:rr,s:rr,ide:Bt,h:Bt,h1:Bt,h2:Bt,h3:Bt,toc1:Bt,toc2:Bt,toc3:Bt,cl:Bt,mt:rr,mt1:rr,mt2:Bl,mt3:Ho,mt4:Ho,ms1:rr,ms2:Bl,ms3:Ho,b:Wo};function Au({blockMarker:t,className:e}){const n=t&&t in Mu?Mu[t]:Tg;return m.jsx(n,{className:e,size:16})}function Yf({editorRef:t,blockMarker:e}){return m.jsxs(Va,{children:[m.jsx(Ga,{asChild:!0,children:m.jsxs(mt,{variant:"outline",className:"","aria-label":"Formatting options for block type",children:[m.jsx(Au,{blockMarker:e,className:"tw-me-2"}),mC(e),m.jsx(pg,{className:"tw-ms-2"})]})}),m.jsx(Ya,{children:Object.keys(Fa).map(n=>m.jsxs(fg,{className:`item block-marker ${yC(e===n)}`,onClick:()=>{var r;return(r=t.current)==null?void 0:r.formatPara(n)},children:[m.jsx(Au,{blockMarker:n,className:"tw-me-2"}),m.jsx("span",{className:`text usfm_${n}`,children:Fa[n]})]},n))})]})}function mC(t){return t&&t in Ou?Ou[t]:"No Style"}function yC(t){return t?"active dropdown-item-active":""}Yf.__docgenInfo={description:"",methods:[],displayName:"BlockFormatDropDown",props:{editorRef:{required:!0,tsType:{name:"MutableRefObject",elements:[{name:"union",raw:"EditorRef | null",elements:[{name:"EditorRef"},{name:"null"}]}],raw:"MutableRefObject<EditorRef | null>"},description:""},blockMarker:{required:!0,tsType:{name:"union",raw:"string | undefined",elements:[{name:"string"},{name:"undefined"}]},description:""}}};const bC={columns:{"platformScriptureEditor.edit":{label:"Edit",order:1},"platformScriptureEditor.insert":{label:"Insert",order:2}},groups:{"platformScriptureEditor.clipboard":{column:"platformScriptureEditor.edit",order:1},"platformScriptureEditor.insertNote":{column:"platformScriptureEditor.insert",order:1}},items:[{label:"Insert footnote",group:"platformScriptureEditor.insertNote",order:1,command:"platformScriptureEditor.insertFootnoteAtSelection",localizeNotes:""},{label:"Insert cross-reference",group:"platformScriptureEditor.insertNote",order:2,command:"platformScriptureEditor.insertCrossReferenceAtSelection",localizeNotes:""},{label:"Insert endnote",group:"platformScriptureEditor.insertNote",order:3,command:"platformScriptureEditor.insertEndnoteAtSelection",localizeNotes:""},{label:"Cut",group:"platformScriptureEditor.clipboard",order:1,command:"platformScriptureEditor.cut",localizeNotes:""},{label:"Copy",group:"platformScriptureEditor.clipboard",order:2,command:"platformScriptureEditor.copy",localizeNotes:""},{label:"Paste",group:"platformScriptureEditor.clipboard",order:3,command:"platformScriptureEditor.paste",localizeNotes:""},{label:"Paste as plain text",group:"platformScriptureEditor.clipboard",order:4,command:"platformScriptureEditor.pastePlainText",localizeNotes:""}]};function Xf({editorRef:t,scrRef:e,onScrRefChange:n,isReadonly:r=!1,canUndo:s=!1,canRedo:i=!1,blockMarker:o}){const a=()=>{var h;(h=t.current)==null||h.insertNote("f")},l=()=>{var h;(h=t.current)==null||h.insertNote("x")},u=()=>{var h;(h=t.current)==null||h.insertNote("fe")},d=h=>{var p,y,b,w;switch(h.command){case"platformScriptureEditor.insertFootnoteAtSelection":a();break;case"platformScriptureEditor.insertCrossReferenceAtSelection":l();break;case"platformScriptureEditor.insertEndnoteAtSelection":u();break;case"platformScriptureEditor.cut":(p=t.current)==null||p.cut();break;case"platformScriptureEditor.copy":(y=t.current)==null||y.copy();break;case"platformScriptureEditor.paste":(b=t.current)==null||b.paste();break;case"platformScriptureEditor.pastePlainText":(w=t.current)==null||w.pastePlainText();break;default:throw new Error(`Unknown onSelectProjectMenuItem command: ${h.command}`)}},f=()=>{};return m.jsx(hg,{onSelectProjectMenuItem:d,onSelectViewInfoMenuItem:f,projectMenuData:bC,className:"toolbar",startAreaChildren:m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"tw-flex tw-h-full tw-items-center",children:m.jsx(dg,{scrRef:e,handleSubmit:n})}),!r&&m.jsxs(m.Fragment,{children:[m.jsx(mt,{"aria-label":"Undo",title:"Undo",variant:"ghost",size:"icon",onClick:()=>{var h;return(h=t.current)==null?void 0:h.undo()},disabled:!s,children:m.jsx(Wg,{})}),m.jsx(mt,{"aria-label":"Redo",title:"Redo",variant:"ghost",size:"icon",onClick:()=>{var h;return(h=t.current)==null?void 0:h.redo()},disabled:!i,children:m.jsx(Ig,{})}),m.jsx(Yf,{editorRef:t,blockMarker:o}),m.jsx(mt,{"aria-label":"Insert footnote",title:"Insert footnote",variant:"ghost",size:"icon",onClick:a,children:m.jsx(Ug,{})}),m.jsx(mt,{"aria-label":"Insert cross-reference",title:"Insert cross-reference",variant:"ghost",size:"icon",onClick:l,children:m.jsx(Pg,{})}),m.jsx(mt,{"aria-label":"Insert endnote",title:"Insert endnote",variant:"ghost",size:"icon",onClick:u,children:m.jsx(jg,{})})]})]})})}Xf.__docgenInfo={description:"",methods:[],displayName:"PlatformToolbar",props:{editorRef:{required:!0,tsType:{name:"RefObject",elements:[{name:"union",raw:"EditorRef | null",elements:[{name:"EditorRef"},{name:"null"}]}],raw:"RefObject<EditorRef | null>"},description:""},scrRef:{required:!0,tsType:{name:"SerializedVerseRef"},description:""},onScrRefChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(scrRef: SerializedVerseRef) => void",signature:{arguments:[{type:{name:"SerializedVerseRef"},name:"scrRef"}],return:{name:"void"}}},description:""},isReadonly:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},canUndo:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},canRedo:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},blockMarker:{required:!1,tsType:{name:"string"},description:""}}};function zn(t,e,n){var h,p,y,b;const r=_.useRef(null),[s,i]=_.useState(n),[o,a]=_.useState(!1),[l,u]=_.useState(!1),[d,f]=_.useState();return m.jsxs(Gf,{viewMode:e.viewMode,description:((y=(p=(h=e.parameters)==null?void 0:h.docs)==null?void 0:p.description)==null?void 0:y.story)??((b=e.parameters)==null?void 0:b.description),children:[m.jsx(Xf,{editorRef:r,scrRef:s,onScrRefChange:i,isReadonly:!1,canUndo:o,canRedo:l,blockMarker:d}),m.jsx(Ts,{...t,ref:r,scrRef:s,onScrRefChange:i,onStateChange:({canUndo:w,canRedo:M,blockMarker:v})=>{a(w),u(M),f(v)}})]})}zn.__docgenInfo={description:`Render function that combines the Editorial component with a PlatformToolbar. This provides a
complete editing experience with undo/redo, navigation, and other toolbar features.

Use this as a render function in a Storybook story, not as a component.`,methods:[],displayName:"renderEditorialWithToolbar"};const _C='<usx version="3.1" />',kC=Ua(_C),vC=`<?xml version="1.0" encoding="utf-8"?>
<usx version="3.1">
  <book code="PSA" style="id">World English Bible (WEB)</book>
  <para style="mt1">The Psalms</para>
  <chapter number="1" style="c" sid="PSA 1" />
  <para style="q1">
    <verse number="1" style="v" sid="PSA 1:1" />Blessed is the man who doesnt walk in the counsel of the wicked<note caller="+" style="f"><char style="fr">1:1 </char><char style="ft">Or "sinful"</char></note>,</para>
  <para style="q2" vid="PSA 1:1">nor stand on the path<note caller="+" style="f"><char style="fr">1:1 </char><char style="ft">Hebrew: "way"</char></note> of sinners,</para>
  <para style="q2" vid="PSA 1:1">nor sit in the seat of scoffers;<verse eid="PSA 1:1" /></para>
  <para style="q1">
    <verse number="2" style="v" sid="PSA 1:2" /><note caller="+" style="f"><char style="fr" closed="false">1:2 </char><char style="ft" closed="false">After verse</char></note> but his delight is in Yahwehs<note caller="+" style="f"><char style="fr" closed="false">1:2 </char><char style="ft" closed="false">Yahweh is Gods proper Name, sometimes rendered LORD (all caps) in other translations.</char></note> law.<note caller="+" style="f"><char style="fr" closed="false">1:2 </char><char style="ft" closed="false">End of Para</char></note></para>
  <para style="q2" vid="PSA 1:2">On his law he meditates day and night.<note caller="+" style="f"><char style="fr" closed="false">1:2 </char><char style="ft" closed="false">End of Doc</char></note><verse eid="PSA 1:2" /></para>
</usx>
`,tn=Ua(vC),wC={start:{jsonPath:"$.content[3].content[1]",offset:15},end:{jsonPath:"$.content[3].content[1]",offset:18}},xC={start:{jsonPath:"$.content[3].content[1]",offset:15},end:{jsonPath:"$.content[3].content[1]",offset:22}},CC=`<?xml version="1.0" encoding="utf-8"?>
<usx version="3.1">
  <book code="PSA" style="id"></book>
  <para style="mt1"></para>
  <chapter number="1" style="c" sid="PSA 1" />
  <para style="q1">
    <verse number="1" style="v" sid="PSA 1:1" />      ,</para>
  <para style="q2" vid="PSA 1:1">   ,</para>
  <para style="q2" vid="PSA 1:1">   .<verse eid="PSA 1:1" /></para>
  <para style="q1">
    <verse number="2" style="v" sid="PSA 1:2" />    ,</para>
  <para style="q2" vid="PSA 1:2">   .<verse eid="PSA 1:2" /></para>
</usx>
`,SC=Ua(CC),TC=(t,e,n)=>t==="generated"?m.jsxs(m.Fragment,{children:[m.jsx("p",{children:"+"})," ",e["%footnoteEditor_callerDropdown_item_generated%"]]}):t==="hidden"?m.jsxs(m.Fragment,{children:[m.jsx("p",{children:"-"})," ",e["%footnoteEditor_callerDropdown_item_hidden%"]]}):m.jsxs(m.Fragment,{children:[m.jsx("p",{children:n})," ",e["%footnoteEditor_callerDropdown_item_custom%"]]});function Zf({callerType:t,updateCallerType:e,customCaller:n,updateCustomCaller:r,localizedStrings:s}){const i=_.useRef(null),o=_.useRef(null),a=_.useRef(!1),[l,u]=_.useState(t),[d,f]=_.useState(n),[h,p]=_.useState(!1);_.useEffect(()=>{u(t)},[t]),_.useEffect(()=>{d!==n&&f(n)},[n]);const y=w=>{a.current=!1,p(w),w||(l!=="custom"||d?(e(l),r(d)):(u(t),f(n)))},b=w=>{var M,v,S,j;w.stopPropagation(),document.activeElement===o.current&&w.key==="ArrowDown"||w.key==="ArrowRight"?((M=i.current)==null||M.focus(),a.current=!0):document.activeElement===i.current&&w.key==="ArrowUp"?((v=o.current)==null||v.focus(),a.current=!1):document.activeElement===i.current&&w.key==="ArrowLeft"&&((S=i.current)==null?void 0:S.selectionStart)===0&&((j=o.current)==null||j.focus(),a.current=!1),l==="custom"&&w.key==="Enter"&&(document.activeElement===o.current||document.activeElement===i.current)&&y(!1)};return m.jsxs(Va,{open:h,onOpenChange:y,children:[m.jsx(ns,{children:m.jsxs(rs,{children:[m.jsx(bi,{asChild:!0,children:m.jsx(Ga,{asChild:!0,children:m.jsx(mt,{variant:"outline",className:"tw-h-6",children:TC(t,s,n)})})}),m.jsx(ss,{children:s["%footnoteEditor_callerDropdown_tooltip%"]})]})}),m.jsxs(Ya,{className:"tw-z-[300]",onClick:()=>{a.current&&(a.current=!1)},onKeyDown:b,onMouseMove:()=>{var w;a.current&&((w=i.current)==null||w.focus())},children:[m.jsx(Ad,{children:s["%footnoteEditor_callerDropdown_label%"]}),m.jsx(jd,{}),m.jsx(ts,{checked:l==="generated",onCheckedChange:()=>u("generated"),children:m.jsxs("div",{className:"tw-flex tw-w-full tw-justify-between",children:[m.jsx("span",{children:s["%footnoteEditor_callerDropdown_item_generated%"]}),m.jsx("span",{className:"tw-w-10 tw-text-center",children:Pt})]})}),m.jsx(ts,{checked:l==="hidden",onCheckedChange:()=>u("hidden"),children:m.jsxs("div",{className:"tw-flex tw-w-full tw-justify-between",children:[m.jsx("span",{children:s["%footnoteEditor_callerDropdown_item_hidden%"]}),m.jsx("span",{className:"tw-w-10 tw-text-center",children:pr})]})}),m.jsx(ts,{ref:o,checked:l==="custom",onCheckedChange:()=>u("custom"),onClick:w=>{var M;w.stopPropagation(),a.current=!0,(M=i.current)==null||M.focus()},onSelect:w=>w.preventDefault(),children:m.jsxs("div",{className:"tw-flex tw-w-full tw-justify-between",children:[m.jsx("span",{children:s["%footnoteEditor_callerDropdown_item_custom%"]}),m.jsx(mg,{tabIndex:0,onMouseDown:w=>{w.stopPropagation(),u("custom"),a.current=!0},ref:i,className:"tw-h-auto tw-w-10 tw-p-0 tw-text-center",value:d,onKeyDown:w=>{w.key==="Enter"||w.key==="ArrowUp"||w.key==="ArrowDown"||w.key==="ArrowLeft"||w.key==="ArrowRight"||w.stopPropagation()},maxLength:1,onChange:w=>f(w.target.value)})]})})]})]})}Zf.__docgenInfo={description:"",methods:[],displayName:"FootnoteCallerDropdown",props:{callerType:{required:!0,tsType:{name:"union",raw:"'generated' | 'hidden' | 'custom'",elements:[{name:"literal",value:"'generated'"},{name:"literal",value:"'hidden'"},{name:"literal",value:"'custom'"}]},description:"The caller type value to pass to the dropdown"},updateCallerType:{required:!0,tsType:{name:"signature",type:"function",raw:"(newCallerType: FootnoteCallerType) => void",signature:{arguments:[{type:{name:"union",raw:"'generated' | 'hidden' | 'custom'",elements:[{name:"literal",value:"'generated'"},{name:"literal",value:"'hidden'"},{name:"literal",value:"'custom'"}]},name:"newCallerType"}],return:{name:"void"}}},description:"Function to update the caller type"},customCaller:{required:!0,tsType:{name:"string"},description:"The custom caller to pass to the custom caller input field"},updateCustomCaller:{required:!0,tsType:{name:"signature",type:"function",raw:"(newCustomCaller: string) => void",signature:{arguments:[{type:{name:"string"},name:"newCustomCaller"}],return:{name:"void"}}},description:"FUnction to update the custom caller"},localizedStrings:{required:!0,tsType:{name:"signature",type:"object",raw:`{
  [localizedKey in (typeof FOOTNOTE_EDITOR_STRING_KEYS)[number]]?: string;
}`,signature:{properties:[{key:{name:"unknown[number]",raw:"(typeof FOOTNOTE_EDITOR_STRING_KEYS)[number]",required:!1},value:{name:"string"}}]}},description:"Localized strings from the parent component"}}};const EC=(t,e)=>t==="f"?m.jsxs(m.Fragment,{children:[m.jsx(Nd,{})," ",e["%footnoteEditor_noteType_footnote_label%"]]}):t==="fe"?m.jsxs(m.Fragment,{children:[m.jsx(Id,{})," ",e["%footnoteEditor_noteType_endNote_label%"]]}):m.jsxs(m.Fragment,{children:[m.jsx(Lg,{})," ",e["%footnoteEditor_noteType_crossReference_label%"]]}),OC=(t,e)=>{if(t==="x")return e["%footnoteEditor_noteType_crossReference_label%"];let n=e["%footnoteEditor_noteType_endNote_label%"];return t==="f"&&(n=e["%footnoteEditor_noteType_footnote_label%"]),yg(e["%footnoteEditor_noteType_tooltip%"]??"",{noteType:n})};function Qf({noteType:t,handleNoteTypeChange:e,localizedStrings:n}){return m.jsxs(Va,{children:[m.jsx(ns,{children:m.jsxs(rs,{children:[m.jsx(gg,{asChild:!0,children:m.jsx(Ga,{asChild:!0,children:m.jsx(mt,{variant:"outline",className:"tw-h-6 disabled:tw-pointer-events-auto",disabled:t==="x",children:EC(t,n)})})}),m.jsx(ss,{children:m.jsx("p",{children:OC(t,n)})})]})}),t!=="x"&&m.jsxs(Ya,{className:"tw-z-[300]",children:[m.jsx(Ad,{children:n["%footnoteEditor_noteTypeDropdown_label%"]}),m.jsx(jd,{}),m.jsxs(ts,{checked:t==="f",onCheckedChange:()=>e("f"),className:"tw-gap-2",children:[m.jsx(Nd,{}),m.jsx("span",{children:n["%footnoteEditor_noteType_footnote_label%"]})]}),m.jsxs(ts,{checked:t==="fe",onCheckedChange:()=>e("fe"),className:"tw-gap-2",children:[m.jsx(Id,{}),m.jsx("span",{children:n["%footnoteEditor_noteType_endNote_label%"]})]})]})]})}Qf.__docgenInfo={description:"",methods:[],displayName:"FootnoteTypeDropdown",props:{noteType:{required:!0,tsType:{name:"string"},description:""},handleNoteTypeChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(newNoteType: string) => void",signature:{arguments:[{type:{name:"string"},name:"newNoteType"}],return:{name:"void"}}},description:""},localizedStrings:{required:!0,tsType:{name:"signature",type:"object",raw:`{
  [localizedKey in (typeof FOOTNOTE_EDITOR_STRING_KEYS)[number]]?: string;
}`,signature:{properties:[{key:{name:"unknown[number]",raw:"(typeof FOOTNOTE_EDITOR_STRING_KEYS)[number]",required:!1},value:{name:"string"}}]}},description:""}}};function ep({noteOps:t,onSave:e,onClose:n,scrRef:r,noteKey:s,editorOptions:i,localizedStrings:o}){const a=_.useRef(null),l=_.createRef(),[u,d]=_.useState("generated"),[f,h]=_.useState("*"),[p,y]=_.useState("f"),b=_.useMemo(()=>({...i,markerMenuTrigger:i.markerMenuTrigger??"\\",hasExternalUI:!0,view:{...i.view??Mr(),noteMode:"expanded"}}),[i]);_.useEffect(()=>{var S;(S=a.current)==null||S.focus()}),_.useEffect(()=>{var P,D;let S;const j=t==null?void 0:t.at(0);if(j&&at("note",j)){const B=(P=j.insert.note)==null?void 0:P.caller;let U="custom";B===Pt?U="generated":B===pr?U="hidden":B&&h(B),d(U),y(((D=j.insert.note)==null?void 0:D.style)??"f"),j.insert.note&&(j.insert.note.caller=""),S=setTimeout(()=>{var H;(H=a.current)==null||H.applyUpdate([{delete:1},j])},0)}return()=>{S&&clearTimeout(S)}},[t,s]);const w=_.useCallback(()=>{var j,P;const S=(P=(j=a.current)==null?void 0:j.getNoteOps(0))==null?void 0:P.at(0);S&&at("note",S)&&(S.insert.note&&(u==="custom"?S.insert.note.caller=f:S.insert.note.caller=u==="generated"?Pt:pr),e([S]))},[u,f,e]),M=()=>{var j;const S=(j=l.current)==null?void 0:j.getElementsByClassName("editor-input")[0];S!=null&&S.textContent&&navigator.clipboard.writeText(S.textContent)},v=S=>{var P,D,B;y(S);const j=(D=(P=a.current)==null?void 0:P.getNoteOps(0))==null?void 0:D.at(0);j&&at("note",j)&&(j.insert.note&&(j.insert.note.style=S),(B=a.current)==null||B.applyUpdate([{delete:1},j]))};return m.jsxs("div",{className:"footnote-editor tw-grid tw-gap-[12px]",children:[m.jsxs("div",{className:"tw-flex",children:[m.jsxs("div",{className:"tw-flex tw-gap-4",children:[m.jsx(Qf,{noteType:p,handleNoteTypeChange:v,localizedStrings:o}),m.jsx(Zf,{callerType:u,updateCallerType:d,customCaller:f,updateCustomCaller:h,localizedStrings:o})]}),m.jsxs("div",{className:"tw-flex tw-w-full tw-justify-end tw-gap-4",children:[m.jsx(ns,{children:m.jsxs(rs,{children:[m.jsx(bi,{asChild:!0,children:m.jsx(mt,{onClick:n,className:"tw-h-6 tw-w-6",size:"icon",variant:"secondary",children:m.jsx(bg,{})})}),m.jsx(ss,{children:m.jsx("p",{children:o["%footnoteEditor_cancelButton_tooltip%"]})})]})}),m.jsx(ns,{children:m.jsxs(rs,{children:[m.jsx(bi,{asChild:!0,children:m.jsx(mt,{onClick:w,className:"tw-h-6 tw-w-6",size:"icon",variant:"default",children:m.jsx(_g,{})})}),m.jsx(ss,{children:o["%footnoteEditor_saveButton_tooltip%"]})]})})]})]}),m.jsxs("div",{ref:l,className:"tw-relative tw-rounded-[6px] tw-border-2 tw-border-ring",children:[m.jsx(Ts,{options:b,onScrRefChange:()=>{},scrRef:r,ref:a}),m.jsx("div",{className:"tw-absolute tw-bottom-0 tw-right-0",children:m.jsx(ns,{children:m.jsxs(rs,{children:[m.jsx(bi,{asChild:!0,children:m.jsx(mt,{onClick:M,className:"tw-h-6 tw-w-6",variant:"ghost",size:"icon",children:m.jsx(kg,{})})}),m.jsx(ss,{children:m.jsx("p",{children:o["%footnoteEditor_copyButton_tooltip%"]})})]})})})]})]})}ep.__docgenInfo={description:`Component to edit footnotes from within the editor component

@param FootnoteEditorProps - The properties for the footnote editor component`,methods:[],displayName:"FootnoteEditor",props:{noteOps:{required:!0,tsType:{name:"union",raw:"DeltaOpInsertNoteEmbed[] | undefined",elements:[{name:"Array",elements:[{name:"DeltaOpInsertNoteEmbed"}],raw:"DeltaOpInsertNoteEmbed[]"},{name:"undefined"}]},description:"Delta ops for the current note being edited that are applied to the note editorial"},onSave:{required:!0,tsType:{name:"signature",type:"function",raw:"(noteOps: DeltaOpInsertNoteEmbed[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"DeltaOpInsertNoteEmbed"}],raw:"DeltaOpInsertNoteEmbed[]"},name:"noteOps"}],return:{name:"void"}}},description:"External function to handle saving changes to the footnote"},onClose:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:`External function to handle closing the footnote editor. Gets called when the editor is closed
without saving changes`},scrRef:{required:!0,tsType:{name:"SerializedVerseRef"},description:"The scripture reference for the parent editor"},noteKey:{required:!0,tsType:{name:"union",raw:"string | undefined",elements:[{name:"string"},{name:"undefined"}]},description:"The unique note key to identify the note being edited used to apply changes to the note"},editorOptions:{required:!0,tsType:{name:"EditorOptions"},description:"View options of the parent editor"},localizedStrings:{required:!0,tsType:{name:"signature",type:"object",raw:`{
  [localizedKey in (typeof FOOTNOTE_EDITOR_STRING_KEYS)[number]]?: string;
}`,signature:{properties:[{key:{name:"unknown[number]",raw:"(typeof FOOTNOTE_EDITOR_STRING_KEYS)[number]",required:!1},value:{name:"string"}}]}},description:"Localized strings to be passed to the footnote editor component"}}};const st={book:"PSA",chapterNum:1,verseNum:1},H0={title:"Demo/Editorial",component:Ts,tags:["autodocs"],parameters:{docs:{description:{component:`
**Demo Only:** This component is provided for demonstration purposes only. For production applications, developers should import the Scripture Editor component directly from:
- npm [@eten-tech-foundation/platform-editor](https://www.npmjs.com/package/@eten-tech-foundation/platform-editor)
- github [eten-tech-foundation/platform-editor](https://github.com/eten-tech-foundation/scripture-editors/tree/main/packages/platform)

This demo version is included in Storybook to showcase the component's functionality and usage patterns.

**Known Limitation:** In the Docs view, all story examples may show the same note caller style due to global state management in the editor component. To see the correct note caller behavior for each story (default lowercase letters vs custom symbols), please view the individual stories in the Canvas view instead of the Docs view.
        `}}},argTypes:{ref:{control:"object",description:"Reference to the editor instance",defaultValue:null},defaultUsj:{control:"object",description:"Default USJ object to initialize the editor with",defaultValue:{type:as,version:ls,content:[""]}},scrRef:{control:"object",description:"Scripture reference",defaultValue:st},options:{control:"object",description:"Options to configure the editor (EditorOptions)",defaultValue:{},table:{type:{summary:"EditorOptions",detail:'{ isReadonly?: boolean; hasSpellCheck?: boolean; textDirection?: "ltr" | "rtl" | "auto"; markerMenuTrigger?: string; nodes?: UsjNodeOptions; }'}}}}},ii={args:{defaultUsj:tn,scrRef:st}},oi={args:{defaultUsj:kC,scrRef:st}},ai={args:{defaultUsj:tn,scrRef:st,options:{isReadonly:!0}}},li={render:(t,e)=>zn(t,e,st),parameters:{docs:{description:{story:'Right-to-left example using a Hebrew snippet (Psalm 1:1). The editor is set to RTL via _options.textDirection = "rtl"_. If you want the UI (tab toolbar) to be RTL click **Switch direction** in the Storybook toolbar.'}}},args:{defaultUsj:SC,options:{hasExternalUI:!0,textDirection:"rtl"}}};function ju(t,e,n,r){console.log("handleAnnotationOnClick",{event:t,type:e,id:n,textContent:r})}function Nu(t,e,n,r){console.log("handleAnnotationOnRemove",{type:t,id:e,cause:n,textContent:r})}const ci={render:t=>{const e=_.useRef(null);return _.useEffect(()=>{const n=setTimeout(()=>{e.current&&(e.current.setAnnotation(wC,"spelling","annotationId",ju,Nu),e.current.setAnnotation(xC,"grammar","abc123",ju,Nu))},0);return()=>clearTimeout(n)},[]),m.jsx(Ts,{...t,ref:e})},args:{defaultUsj:tn,scrRef:st}},MC={hasExternalUI:!0,view:{...Mr(),noteMode:"expandInline"},nodes:{noteCallerOnClick:(t,e,n,r,s)=>{n||(r()===Pt?s(pr):s(Pt))}}},ui={render:(t,e)=>zn(t,e,st),parameters:{docs:{description:{story:"This story demonstrates editing notes inline. Move your cursor to a note caller and the note will expand and can be edited. Move the cursor out of the note and it will collapse. Click the expanded note caller to toggle between the auto-generated caller and the hidden caller."}}},args:{defaultUsj:tn,options:MC}},AC={hasExternalUI:!0,view:{...Mr(),noteMode:"expandInline"}},di={render:(t,e)=>zn(t,e,st),parameters:{docs:{description:{story:'This story demonstrates inserting notes. Use the Project menu (hamburger) or the toolbar buttons above the editor to insert footnotes, cross-references, and endnotes at the current cursor position. Selecting text before inserting a footnote will use that text as the footnote quote. You can also insert by typing "\\f", "\\x", or "\\fe".'}}},args:{defaultUsj:tn,options:AC}},jC={hasExternalUI:!0,nodes:{noteCallers:["","","","","","","","","",""],noteCallerOnClick:(t,e,n,r,s,i)=>{console.log("Note caller clicked:",t,e,n,r,s,i),alert("Note caller clicked! Check console for details.")}}},hi={render:(t,e)=>zn(t,e,st),parameters:{docs:{description:{story:"This story demonstrates custom note callers and click handling. **Try clicking on the circled number footnote markers ( ) in the text to see the click handler in action!** The click event will show an alert and log details to the browser console."}}},args:{defaultUsj:tn,options:jC}},fi={render:(t,e)=>zn(t,e,st),parameters:{docs:{description:{story:'This story demonstrates using a custom marker menu trigger key. **Try typing "?" (question mark) anywhere in the editor text to open the marker menu!** The default trigger is "\\\\" (backslash), but this story changes it to "?" for demonstration. The marker menu allows you to insert USFM markers into the text.'}}},args:{defaultUsj:tn,options:{hasExternalUI:!0,markerMenuTrigger:"?"}}},NC={"%footnoteEditor_callerDropdown_label%":"Footnote caller","%footnoteEditor_callerDropdown_item_generated%":"Auto-generated","%footnoteEditor_callerDropdown_item_hidden%":"Hidden","%footnoteEditor_callerDropdown_item_custom%":"Custom","%footnoteEditor_callerDropdown_tooltip%":"Footnote caller","%footnoteEditor_cancelButton_tooltip%":"Cancel","%footnoteEditor_copyButton_tooltip%":"Copy footnote","%footnoteEditor_noteType_crossReference_label%":"Cross reference","%footnoteEditor_noteType_endNote_label%":"Endnote","%footnoteEditor_noteType_footnote_label%":"Footnote","%footnoteEditor_noteType_tooltip%":"Change type: Footnote","%footnoteEditor_noteTypeDropdown_label%":"Type","%footnoteEditor_saveButton_tooltip%":"Save"},pi={render:t=>{const e=_.useRef(null),n=_.useRef(),r=_.useRef(),[s,i]=_.useState(),[o,a]=_.useState(),[l,u]=_.useState(),[d,f]=_.useState(),h=_.useMemo(()=>({markerMode:"hidden",noteMode:"collapsed",hasSpacing:!0,isFormattedFont:!0}),[]),p=_.useMemo(()=>({...t.options??{},nodes:{noteCallerOnClick:(M,v,S,j,P,D)=>{var U;const B=M.currentTarget.getBoundingClientRect();if(i(B.left),a(B.top),u(B.height),S){if(n.current)return;const H=(U=D())==null?void 0:U.at(0);if(!H||!at("note",H))return;n.current=v,r.current=[H],f(!0)}}},view:h}),[t.options,h,n]),y=()=>{n.current=void 0,r.current=void 0,f(!1)},b=w=>{var M;n.current&&((M=e.current)==null||M.replaceEmbedUpdate(n.current,w)),y()};return m.jsxs("div",{children:[m.jsx(Ts,{...t,options:p,ref:e,onScrRefChange:()=>{}}),m.jsxs(vg,{open:d,children:[m.jsx(wg,{className:"tw-absolute",style:{top:o??0,left:s??0,height:l,width:0}}),m.jsx(xg,{className:"tw-w-[500px] tw-p-[10px]",children:m.jsx(ep,{noteKey:n.current,noteOps:r.current,onSave:b,onClose:y,scrRef:t.scrRef??st,editorOptions:p,localizedStrings:NC})})]})]})},parameters:{docs:{description:{story:"This story demonstrates the use of the new footnote editor on the side of the  editorial component"}}},args:{defaultUsj:tn,scrRef:st,options:{hasExternalUI:!1,markerMenuTrigger:"\\"}}},gi={name:"View Options",render:(t,e)=>{const{markerMode:n,noteMode:r,hasSpacing:s,isFormattedFont:i}=t;return zn({defaultUsj:tn,options:{hasExternalUI:!0,view:{markerMode:n,noteMode:r,hasSpacing:s,isFormattedFont:i}}},e,st)},argTypes:{markerMode:{control:{type:"select"},options:["hidden","visible","editable"],description:"Controls how USFM markers are displayed in the editor",table:{category:"View Options"}},noteMode:{control:{type:"select"},options:["collapsed","expandInline","expanded"],description:"Controls how notes are displayed in the editor",table:{category:"View Options"}},hasSpacing:{control:{type:"boolean"},description:"Whether to add spacing between paragraphs",table:{category:"View Options"}},isFormattedFont:{control:{type:"boolean"},description:"Whether to use formatted font styling",table:{category:"View Options"}}},parameters:{docs:{description:{story:"Demonstrates the editor view options (marker visibility, spacing, and formatted font) using USX input. Below in the **Controls** tab, try changing the **View Options** to see how they affect the editor display."}}},args:{markerMode:"hidden",noteMode:"collapsed",hasSpacing:!0,isFormattedFont:!0}};var Iu,Ru,Pu;ii.parameters={...ii.parameters,docs:{...(Iu=ii.parameters)==null?void 0:Iu.docs,source:{originalSource:`{
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef
  }
}`,...(Pu=(Ru=ii.parameters)==null?void 0:Ru.docs)==null?void 0:Pu.source}}};var $u,Du,qu;oi.parameters={...oi.parameters,docs:{...($u=oi.parameters)==null?void 0:$u.docs,source:{originalSource:`{
  args: {
    defaultUsj: usjEmpty,
    scrRef: defaultScrRef
  }
}`,...(qu=(Du=oi.parameters)==null?void 0:Du.docs)==null?void 0:qu.source}}};var Lu,Fu,Uu;ai.parameters={...ai.parameters,docs:{...(Lu=ai.parameters)==null?void 0:Lu.docs,source:{originalSource:`{
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef,
    options: {
      isReadonly: true
    }
  }
}`,...(Uu=(Fu=ai.parameters)==null?void 0:Fu.docs)==null?void 0:Uu.source}}};var Bu,Hu,Wu;li.parameters={...li.parameters,docs:{...(Bu=li.parameters)==null?void 0:Bu.docs,source:{originalSource:`{
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'Right-to-left example using a Hebrew snippet (Psalm 1:1). ' + 'The editor is set to RTL via _options.textDirection = "rtl"_. If you want the UI ' + '(tab toolbar) to be RTL click **Switch direction** in the Storybook toolbar.'
      }
    }
  },
  args: {
    defaultUsj: usjHebrew,
    options: {
      hasExternalUI: true,
      textDirection: 'rtl'
    }
  }
}`,...(Wu=(Hu=li.parameters)==null?void 0:Hu.docs)==null?void 0:Wu.source}}};var zu,Ku,Ju;ci.parameters={...ci.parameters,docs:{...(zu=ci.parameters)==null?void 0:zu.docs,source:{originalSource:`{
  render: args => {
    // eslint-disable-next-line no-null/no-null
    const editorRef = useRef<EditorRef | null>(null);
    useEffect(() => {
      const timeoutId = setTimeout(() => {
        if (editorRef.current) {
          editorRef.current.setAnnotation(annotationRangeWeb1, 'spelling', 'annotationId', handleAnnotationOnClick, handleAnnotationOnRemove);
          editorRef.current.setAnnotation(annotationRangeWeb2, 'grammar', 'abc123', handleAnnotationOnClick, handleAnnotationOnRemove);
        }
      }, 0);
      return () => clearTimeout(timeoutId);
    }, []);
    return <Editorial {...args} ref={editorRef} />;
  },
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef
  }
}`,...(Ju=(Ku=ci.parameters)==null?void 0:Ku.docs)==null?void 0:Ju.source}}};var Vu,Gu,Yu;ui.parameters={...ui.parameters,docs:{...(Vu=ui.parameters)==null?void 0:Vu.docs,source:{originalSource:`{
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates editing notes inline. Move your cursor to a note caller and ' + 'the note will expand and can be edited. Move the cursor out of the note and it will ' + 'collapse. Click the expanded note caller to toggle between the auto-generated caller ' + 'and the hidden caller.'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    options: inlineNoteOptions
  }
}`,...(Yu=(Gu=ui.parameters)==null?void 0:Gu.docs)==null?void 0:Yu.source}}};var Xu,Zu,Qu;di.parameters={...di.parameters,docs:{...(Xu=di.parameters)==null?void 0:Xu.docs,source:{originalSource:`{
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates inserting notes. Use the Project menu (hamburger) or the ' + 'toolbar buttons above the editor to insert footnotes, cross-references, and endnotes ' + 'at the current cursor position. Selecting text before inserting a footnote will use ' + 'that text as the footnote quote. You can also insert by typing "\\\\f", "\\\\x", or "\\\\fe".'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    options: insertNoteOptions
  }
}`,...(Qu=(Zu=di.parameters)==null?void 0:Zu.docs)==null?void 0:Qu.source}}};var ed,td,nd;hi.parameters={...hi.parameters,docs:{...(ed=hi.parameters)==null?void 0:ed.docs,source:{originalSource:`{
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates custom note callers and click handling. **Try clicking on the ' + 'circled number footnote markers ( ) in the text to see the click handler in ' + 'action!** The click event will show an alert and log details to the browser console.'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    options: customNodeOptions
  }
}`,...(nd=(td=hi.parameters)==null?void 0:td.docs)==null?void 0:nd.source}}};var rd,sd,id;fi.parameters={...fi.parameters,docs:{...(rd=fi.parameters)==null?void 0:rd.docs,source:{originalSource:`{
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates using a custom marker menu trigger key. **Try typing "?" ' + '(question mark) anywhere in the editor text to open the marker menu!** The default ' + 'trigger is "\\\\\\\\" (backslash), but this story changes it to "?" for demonstration. ' + 'The marker menu allows you to insert USFM markers into the text.'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    options: {
      hasExternalUI: true,
      markerMenuTrigger: '?'
    }
  }
}`,...(id=(sd=fi.parameters)==null?void 0:sd.docs)==null?void 0:id.source}}};var od,ad,ld;pi.parameters={...pi.parameters,docs:{...(od=pi.parameters)==null?void 0:od.docs,source:{originalSource:`{
  render: args => {
    // eslint-disable-next-line no-null/no-null
    const editorRef = useRef<EditorRef | null>(null);
    const noteKey = useRef<string>();
    const noteOps = useRef<DeltaOpInsertNoteEmbed[]>();
    const [popoverX, setPopoverX] = useState<number>();
    const [popoverY, setPopoverY] = useState<number>();
    const [popoverHeight, setPopoverHeight] = useState<number>();
    const [showFootnoteEditor, setShowFootnoteEditor] = useState<boolean>();
    const viewOptions = useMemo<ViewOptions>(() => ({
      markerMode: 'hidden',
      noteMode: 'collapsed',
      hasSpacing: true,
      isFormattedFont: true
    }), []);
    const mergedOptions = useMemo<EditorOptions>(() => {
      const base = args.options ?? {};
      return {
        ...base,
        nodes: {
          noteCallerOnClick: (event, noteNodeKey, isCollapsed, _getCaller, _setCaller, getNoteOps) => {
            const targetRect = event.currentTarget.getBoundingClientRect();
            setPopoverX(targetRect.left);
            setPopoverY(targetRect.top);
            setPopoverHeight(targetRect.height);
            if (isCollapsed) {
              // (event as SyntheticEvent<)
              if (noteKey.current) return;

              // Makes sure the note op is the correct type and is defined
              const noteOp = getNoteOps()?.at(0);
              if (!noteOp || !isInsertEmbedOpOfType('note', noteOp)) return;
              noteKey.current = noteNodeKey;
              noteOps.current = [noteOp];
              setShowFootnoteEditor(true);
            }
          }
        },
        view: viewOptions
      };
    }, [args.options, viewOptions, noteKey]);
    const onEditorClose = () => {
      noteKey.current = undefined;
      noteOps.current = undefined;
      setShowFootnoteEditor(false);
    };
    const onEditorSave = (newNoteOps: DeltaOp[]) => {
      if (noteKey.current) {
        editorRef.current?.replaceEmbedUpdate(noteKey.current, newNoteOps);
      }
      onEditorClose();
    };
    return <div>
        <Editorial {...args} options={mergedOptions} ref={editorRef} onScrRefChange={() => undefined} />
        <Popover open={showFootnoteEditor}>
          <PopoverAnchor className="tw-absolute" style={{
          top: popoverY ?? 0,
          left: popoverX ?? 0,
          height: popoverHeight,
          width: 0
        }} />
          <PopoverContent className="tw-w-[500px] tw-p-[10px]">
            <FootnoteEditor noteKey={noteKey.current} noteOps={noteOps.current} onSave={onEditorSave} onClose={onEditorClose} scrRef={args.scrRef ?? defaultScrRef} editorOptions={mergedOptions} localizedStrings={sampleFootnoteEditorLocalizedStrings} />
          </PopoverContent>
        </Popover>
      </div>;
  },
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates the use of the new footnote editor on the side of the ' + ' editorial component'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef,
    options: {
      hasExternalUI: false,
      markerMenuTrigger: '\\\\'
    }
  }
}`,...(ld=(ad=pi.parameters)==null?void 0:ad.docs)==null?void 0:ld.source}}};var cd,ud,dd;gi.parameters={...gi.parameters,docs:{...(cd=gi.parameters)==null?void 0:cd.docs,source:{originalSource:`{
  name: 'View Options',
  render: (args, context) => {
    // Destructure flattened view options from args
    const {
      markerMode,
      noteMode,
      hasSpacing,
      isFormattedFont
    } = args;

    // Reconstruct the args with the options.view settings
    const mergedArgs = {
      defaultUsj: usjWeb,
      options: {
        hasExternalUI: true,
        view: {
          markerMode,
          noteMode,
          hasSpacing,
          isFormattedFont
        }
      }
    };
    return renderEditorialWithToolbar(mergedArgs, context, defaultScrRef);
  },
  argTypes: {
    markerMode: {
      control: {
        type: 'select'
      },
      options: ['hidden', 'visible', 'editable'],
      description: 'Controls how USFM markers are displayed in the editor',
      table: {
        category: 'View Options'
      }
    },
    noteMode: {
      control: {
        type: 'select'
      },
      options: ['collapsed', 'expandInline', 'expanded'],
      description: 'Controls how notes are displayed in the editor',
      table: {
        category: 'View Options'
      }
    },
    hasSpacing: {
      control: {
        type: 'boolean'
      },
      description: 'Whether to add spacing between paragraphs',
      table: {
        category: 'View Options'
      }
    },
    isFormattedFont: {
      control: {
        type: 'boolean'
      },
      description: 'Whether to use formatted font styling',
      table: {
        category: 'View Options'
      }
    }
  },
  parameters: {
    docs: {
      description: {
        story: 'Demonstrates the editor view options (marker visibility, spacing, and formatted font) ' + 'using USX input. Below in the **Controls** tab, try changing the **View Options** ' + 'to see how they affect the editor display.'
      }
    }
  },
  args: {
    markerMode: 'hidden',
    noteMode: 'collapsed',
    hasSpacing: true,
    isFormattedFont: true
  }
}`,...(dd=(ud=gi.parameters)==null?void 0:ud.docs)==null?void 0:dd.source}}};const W0=["Default","Empty","ReadOnly","RTL","Annotated","InlineNoteEditing","InsertNote","CustomNoteOptions","CustomMarkerTrigger","FootnoteEditorView","EditorViewOptions"];export{ci as Annotated,fi as CustomMarkerTrigger,hi as CustomNoteOptions,ii as Default,gi as EditorViewOptions,oi as Empty,pi as FootnoteEditorView,ui as InlineNoteEditing,di as InsertNote,li as RTL,ai as ReadOnly,W0 as __namedExportsOrder,H0 as default};
