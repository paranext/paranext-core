import{j as m}from"./jsx-runtime-DYdH0Bpv.js";import{c as rr,g as qf,r as _}from"./iframe-GRO_q3r5.js";import{_ as td,H as Lf,p as Zn,O as es,D as Df,U as Ff,B as Uf,V as Pa}from"./index-ZThHfTg3.js";import{e as ur,r as nr,v as rd,_ as X,i as Oe,j as ra,g as Bf,P as ne,w as Pt,C as Hf,y as Sl,V as Kn,k as ve,s as ee,l as Wf,p as Xe,o as ue,Z as Un,t as Bn,Q as nd,J as xe,X as sd,u as Ra,M as na,A as $a,O as zf,B as id,E as Jf,F as Kf,G as Vf,$ as Pr,I as qa,K as od,R as Gf,L as ad,S as Yf,U as Xf,Y as Qf,a0 as ld,a1 as qi,a2 as cd,a3 as El,a4 as Zf,a5 as Li,a6 as Di,a7 as ep,a8 as tp,a9 as Tl,aa as rp,ab as $o,ac as np,ad as sp,ae as Ml,af as Al,ag as ip,ah as op,ai as ap,aj as lp,ak as cp,al as up,am as dp,an as hp,ao as fp,ap as pp,aq as gp,ar as ud,as as mp,f as dd,z as La,a as yp,b as hd,x as fd,at as we,au as fs,av as pd,aw as Nl,ax as fn,ay as dr,q as Mt,az as ts,h as pn,aA as sa,aB as Ce,aC as fi,aD as ps,aE as bp,aF as _p,aG as gd,aH as md,aI as Fi,aJ as kp,aK as vp,aL as gs,aM as Ol,aN as Wt,aO as yd,aP as wp,aQ as xp,aR as Cp,aS as Sp,n as Ep,c as Tp,d as Mp}from"./LexicalTable.prod-CxJiRive.js";import{r as gt}from"./index-RCKYsxPh.js";import{c as Ap,d as Np,e as Op,g as jp}from"./floating-ui.react-dom-DHpdw1JM.js";import{M as Ip}from"./markdown-renderer.component-DQzPq2D1.js";import{C as Pp,a as Rp,b as $p,d as qp}from"./card-CSxOJA30.js";import{B as Lp}from"./book-chapter-control.component-CT5Ky4j3.js";import{T as Dp}from"./tab-toolbar.component-CfCfgAL5.js";import{B as pt}from"./button-ah8GIK0o.js";import{D as Da,a as Fa,b as Ua,c as Fp,j as bd,e as _d,l as Vn}from"./dropdown-menu-CrsGlpz0.js";import{C as Up}from"./chevron-down-CighenK6.js";import{c as nt}from"./createLucideIcon-CCJkxewo.js";import{F as Ft}from"./file-text-BipWJEgn.js";import{a as Gn,T as Yn,b as pi,c as Xn,d as Bp}from"./tooltip-BQ3wH6P7.js";import{I as Hp}from"./input-BUGb9Qev.js";import{M as Wp}from"./index-DNL2LXP3.js";import{X as zp}from"./x-BdNGdUz7.js";import{C as Jp}from"./check-BVRgXKgy.js";import{C as Kp}from"./copy-BFaBEWDn.js";import{P as Vp,c as Gp,b as Yp}from"./popover-BVK-6Q4g.js";import"./index-CwaHUmDz.js";import"./shadcn-ui.util-DMJ19wEV.js";import"./book-item.utils-BA2mJG8O.js";import"./command-BfF7xU2M.js";import"./index-BtFCHZMr.js";import"./index-DTAXz6r9.js";import"./index-CdBbWID_.js";import"./index-C8ptiv9h.js";import"./index-C52JeAEo.js";import"./index-CoTjvdMv.js";import"./index-B-A_1dao.js";import"./index-B3uZ0Ztc.js";import"./index-D04FOCGj.js";import"./index-jXCnr4ld.js";import"./index-C2SPF2zY.js";import"./index-B8b-c3oM.js";import"./index-vP08ADpb.js";import"./index-D2BV1uXs.js";import"./dialog-Bbw7Lv1o.js";import"./index-Czfav6j7.js";import"./search-BcxdvSEG.js";import"./index.es-D4jfZzAn.js";import"./chevron-left-BJ76bO8m.js";import"./chevron-right-BYlA2wJr.js";import"./arrow-right-CV6hSf33.js";import"./tab-dropdown-menu.component-Bv730JHi.js";import"./menu.util-Dxh7JGT4.js";import"./menu-icon.component-BrhGrX7t.js";import"./tab-toolbar-container.component-bRXZujk4.js";import"./index-BPbCuWFR.js";import"./index-C1CHiVay.js";import"./index-B9BJJrka.js";import"./index-VndLGJ-I.js";import"./index-BlJ4Yg6k.js";import"./index-aV8Q-Doo.js";import"./index-75am10L8.js";import"./index-B-l4t9R9.js";import"./circle-iUNlYNJS.js";import"./index-CRE3FOco.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xp=[["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 18h18",key:"1h113x"}],["path",{d:"M3 6h18",key:"d0wm0j"}]],Bs=nt("AlignJustify",Xp);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qp=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]],Zp=nt("Ban",Qp);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eg=[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"m17 12 3-2v8",key:"1hhhft"}]],Yr=nt("Heading1",eg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tg=[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M21 18h-4c0-4 4-3 4-6 0-1.5-2-2.5-4-1",key:"9jr5yi"}]],jl=nt("Heading2",tg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rg=[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M17.5 10.5c1.7-1 3.5 0 3.5 1.5a2 2 0 0 1-2 2",key:"68ncm8"}],["path",{d:"M17 17.5c2 1.5 4 .3 4-1.5a2 2 0 0 0-2-2",key:"1ejuhz"}]],qo=nt("Heading3",rg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ng=[["path",{d:"M16 12H3",key:"1a2rj7"}],["path",{d:"M16 6H3",key:"1wxfjs"}],["path",{d:"M10 18H3",key:"13769t"}],["path",{d:"M21 6v10a2 2 0 0 1-2 2h-5",key:"ilrcs8"}],["path",{d:"m16 16-2 2 2 2",key:"kkc6pm"}]],sg=nt("ListEnd",ng);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ig=[["path",{d:"M21 7v6h-6",key:"3ptur4"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7",key:"1kgawr"}]],og=nt("Redo",ig);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ag=[["path",{d:"m18 14 4 4-4 4",key:"10pe0f"}],["path",{d:"m18 2 4 4-4 4",key:"pucp1d"}],["path",{d:"M2 18h1.973a4 4 0 0 0 3.3-1.7l5.454-8.6a4 4 0 0 1 3.3-1.7H22",key:"1ailkh"}],["path",{d:"M2 6h1.972a4 4 0 0 1 3.6 2.2",key:"km57vx"}],["path",{d:"M22 18h-6.041a4 4 0 0 1-3.3-1.8l-.359-.45",key:"os18l9"}]],lg=nt("Shuffle",ag);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cg=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"M9 17c2 0 2.8-1 2.8-2.8V10c0-2 1-3.3 3.2-3",key:"m1af9g"}],["path",{d:"M9 11.2h5.7",key:"3zgcl2"}]],kd=nt("SquareFunction",cg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ug=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M16 8.9V7H8l4 5-4 5h8v-1.9",key:"9nih0i"}]],vd=nt("SquareSigma",ug);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dg=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],hg=nt("SquareX",dg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fg=[["path",{d:"m4 19 8-8",key:"hr47gm"}],["path",{d:"m12 19-8-8",key:"1dhhmo"}],["path",{d:"M20 12h-4c0-1.5.442-2 1.5-2.5S20 8.334 20 7.002c0-.472-.17-.93-.484-1.29a2.105 2.105 0 0 0-2.617-.436c-.42.239-.738.614-.899 1.06",key:"1dfcux"}]],pg=nt("Superscript",fg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gg=[["path",{d:"M17 6H3",key:"16j9eg"}],["path",{d:"M21 12H8",key:"scolzb"}],["path",{d:"M21 18H8",key:"1wfozv"}],["path",{d:"M3 12v6",key:"fv4c87"}]],Lo=nt("TextQuote",gg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mg=[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]],yg=nt("Undo",mg);var Hs={exports:{}},Do,Il;function bg(){if(Il)return Do;Il=1;var t=-1,e=1,r=0;function n(k,M,v,N,P){if(k===M)return k?[[r,k]]:[];if(v!=null){var j=F(k,M,v);if(j)return j}var R=a(k,M),D=k.substring(0,R);k=k.substring(R),M=M.substring(R),R=u(k,M);var U=k.substring(k.length-R);k=k.substring(0,k.length-R),M=M.substring(0,M.length-R);var B=s(k,M);return D&&B.unshift([r,D]),U&&B.push([r,U]),x(B,P),N&&f(B),B}function s(k,M){var v;if(!k)return[[e,M]];if(!M)return[[t,k]];var N=k.length>M.length?k:M,P=k.length>M.length?M:k,j=N.indexOf(P);if(j!==-1)return v=[[e,N.substring(0,j)],[r,P],[e,N.substring(j+P.length)]],k.length>M.length&&(v[0][0]=v[2][0]=t),v;if(P.length===1)return[[t,k],[e,M]];var R=d(k,M);if(R){var D=R[0],U=R[1],B=R[2],V=R[3],J=R[4],Y=n(D,B),re=n(U,V);return Y.concat([[r,J]],re)}return i(k,M)}function i(k,M){for(var v=k.length,N=M.length,P=Math.ceil((v+N)/2),j=P,R=2*P,D=new Array(R),U=new Array(R),B=0;B<R;B++)D[B]=-1,U[B]=-1;D[j+1]=0,U[j+1]=0;for(var V=v-N,J=V%2!==0,Y=0,re=0,K=0,de=0,ye=0;ye<P;ye++){for(var te=-ye+Y;te<=ye-re;te+=2){var se=j+te,ie;te===-ye||te!==ye&&D[se-1]<D[se+1]?ie=D[se+1]:ie=D[se-1]+1;for(var he=ie-te;ie<v&&he<N&&k.charAt(ie)===M.charAt(he);)ie++,he++;if(D[se]=ie,ie>v)re+=2;else if(he>N)Y+=2;else if(J){var pe=j+V-te;if(pe>=0&&pe<R&&U[pe]!==-1){var me=v-U[pe];if(ie>=me)return o(k,M,ie,he)}}}for(var Te=-ye+K;Te<=ye-de;Te+=2){var pe=j+Te,me;Te===-ye||Te!==ye&&U[pe-1]<U[pe+1]?me=U[pe+1]:me=U[pe-1]+1;for(var Ue=me-Te;me<v&&Ue<N&&k.charAt(v-me-1)===M.charAt(N-Ue-1);)me++,Ue++;if(U[pe]=me,me>v)de+=2;else if(Ue>N)K+=2;else if(!J){var se=j+V-Te;if(se>=0&&se<R&&D[se]!==-1){var ie=D[se],he=j+ie-se;if(me=v-me,ie>=me)return o(k,M,ie,he)}}}}return[[t,k],[e,M]]}function o(k,M,v,N){var P=k.substring(0,v),j=M.substring(0,N),R=k.substring(v),D=M.substring(N),U=n(P,j),B=n(R,D);return U.concat(B)}function a(k,M){if(!k||!M||k.charAt(0)!==M.charAt(0))return 0;for(var v=0,N=Math.min(k.length,M.length),P=N,j=0;v<P;)k.substring(j,P)==M.substring(j,P)?(v=P,j=v):N=P,P=Math.floor((N-v)/2+v);return A(k.charCodeAt(P-1))&&P--,P}function l(k,M){var v=k.length,N=M.length;if(v==0||N==0)return 0;v>N?k=k.substring(v-N):v<N&&(M=M.substring(0,v));var P=Math.min(v,N);if(k==M)return P;for(var j=0,R=1;;){var D=k.substring(P-R),U=M.indexOf(D);if(U==-1)return j;R+=U,(U==0||k.substring(P-R)==M.substring(0,R))&&(j=R,R++)}}function u(k,M){if(!k||!M||k.slice(-1)!==M.slice(-1))return 0;for(var v=0,N=Math.min(k.length,M.length),P=N,j=0;v<P;)k.substring(k.length-P,k.length-j)==M.substring(M.length-P,M.length-j)?(v=P,j=v):N=P,P=Math.floor((N-v)/2+v);return O(k.charCodeAt(k.length-P))&&P--,P}function d(k,M){var v=k.length>M.length?k:M,N=k.length>M.length?M:k;if(v.length<4||N.length*2<v.length)return null;function P(re,K,de){for(var ye=re.substring(de,de+Math.floor(re.length/4)),te=-1,se="",ie,he,pe,me;(te=K.indexOf(ye,te+1))!==-1;){var Te=a(re.substring(de),K.substring(te)),Ue=u(re.substring(0,de),K.substring(0,te));se.length<Ue+Te&&(se=K.substring(te-Ue,te)+K.substring(te,te+Te),ie=re.substring(0,de-Ue),he=re.substring(de+Te),pe=K.substring(0,te-Ue),me=K.substring(te+Te))}return se.length*2>=re.length?[ie,he,pe,me,se]:null}var j=P(v,N,Math.ceil(v.length/4)),R=P(v,N,Math.ceil(v.length/2)),D;if(!j&&!R)return null;R?j?D=j[4].length>R[4].length?j:R:D=R:D=j;var U,B,V,J;k.length>M.length?(U=D[0],B=D[1],V=D[2],J=D[3]):(V=D[0],J=D[1],U=D[2],B=D[3]);var Y=D[4];return[U,B,V,J,Y]}function f(k){for(var M=!1,v=[],N=0,P=null,j=0,R=0,D=0,U=0,B=0;j<k.length;)k[j][0]==r?(v[N++]=j,R=U,D=B,U=0,B=0,P=k[j][1]):(k[j][0]==e?U+=k[j][1].length:B+=k[j][1].length,P&&P.length<=Math.max(R,D)&&P.length<=Math.max(U,B)&&(k.splice(v[N-1],0,[t,P]),k[v[N-1]+1][0]=e,N--,N--,j=N>0?v[N-1]:-1,R=0,D=0,U=0,B=0,P=null,M=!0)),j++;for(M&&x(k),C(k),j=1;j<k.length;){if(k[j-1][0]==t&&k[j][0]==e){var V=k[j-1][1],J=k[j][1],Y=l(V,J),re=l(J,V);Y>=re?(Y>=V.length/2||Y>=J.length/2)&&(k.splice(j,0,[r,J.substring(0,Y)]),k[j-1][1]=V.substring(0,V.length-Y),k[j+1][1]=J.substring(Y),j++):(re>=V.length/2||re>=J.length/2)&&(k.splice(j,0,[r,V.substring(0,re)]),k[j-1][0]=e,k[j-1][1]=J.substring(0,J.length-re),k[j+1][0]=t,k[j+1][1]=V.substring(re),j++),j++}j++}}var h=/[^a-zA-Z0-9]/,p=/\s/,y=/[\r\n]/,b=/\n\r?\n$/,S=/^\r?\n\r?\n/;function C(k){function M(re,K){if(!re||!K)return 6;var de=re.charAt(re.length-1),ye=K.charAt(0),te=de.match(h),se=ye.match(h),ie=te&&de.match(p),he=se&&ye.match(p),pe=ie&&de.match(y),me=he&&ye.match(y),Te=pe&&re.match(b),Ue=me&&K.match(S);return Te||Ue?5:pe||me?4:te&&!ie&&he?3:ie||he?2:te||se?1:0}for(var v=1;v<k.length-1;){if(k[v-1][0]==r&&k[v+1][0]==r){var N=k[v-1][1],P=k[v][1],j=k[v+1][1],R=u(N,P);if(R){var D=P.substring(P.length-R);N=N.substring(0,N.length-R),P=D+P.substring(0,P.length-R),j=D+j}for(var U=N,B=P,V=j,J=M(N,P)+M(P,j);P.charAt(0)===j.charAt(0);){N+=P.charAt(0),P=P.substring(1)+j.charAt(0),j=j.substring(1);var Y=M(N,P)+M(P,j);Y>=J&&(J=Y,U=N,B=P,V=j)}k[v-1][1]!=U&&(U?k[v-1][1]=U:(k.splice(v-1,1),v--),k[v][1]=B,V?k[v+1][1]=V:(k.splice(v+1,1),v--))}v++}}function x(k,M){k.push([r,""]);for(var v=0,N=0,P=0,j="",R="",D;v<k.length;){if(v<k.length-1&&!k[v][1]){k.splice(v,1);continue}switch(k[v][0]){case e:P++,R+=k[v][1],v++;break;case t:N++,j+=k[v][1],v++;break;case r:var U=v-P-N-1;if(M){if(U>=0&&L(k[U][1])){var B=k[U][1].slice(-1);if(k[U][1]=k[U][1].slice(0,-1),j=B+j,R=B+R,!k[U][1]){k.splice(U,1),v--;var V=U-1;k[V]&&k[V][0]===e&&(P++,R=k[V][1]+R,V--),k[V]&&k[V][0]===t&&(N++,j=k[V][1]+j,V--),U=V}}if($(k[v][1])){var B=k[v][1].charAt(0);k[v][1]=k[v][1].slice(1),j+=B,R+=B}}if(v<k.length-1&&!k[v][1]){k.splice(v,1);break}if(j.length>0||R.length>0){j.length>0&&R.length>0&&(D=a(R,j),D!==0&&(U>=0?k[U][1]+=R.substring(0,D):(k.splice(0,0,[r,R.substring(0,D)]),v++),R=R.substring(D),j=j.substring(D)),D=u(R,j),D!==0&&(k[v][1]=R.substring(R.length-D)+k[v][1],R=R.substring(0,R.length-D),j=j.substring(0,j.length-D)));var J=P+N;j.length===0&&R.length===0?(k.splice(v-J,J),v=v-J):j.length===0?(k.splice(v-J,J,[e,R]),v=v-J+1):R.length===0?(k.splice(v-J,J,[t,j]),v=v-J+1):(k.splice(v-J,J,[t,j],[e,R]),v=v-J+2)}v!==0&&k[v-1][0]===r?(k[v-1][1]+=k[v][1],k.splice(v,1)):v++,P=0,N=0,j="",R="";break}}k[k.length-1][1]===""&&k.pop();var Y=!1;for(v=1;v<k.length-1;)k[v-1][0]===r&&k[v+1][0]===r&&(k[v][1].substring(k[v][1].length-k[v-1][1].length)===k[v-1][1]?(k[v][1]=k[v-1][1]+k[v][1].substring(0,k[v][1].length-k[v-1][1].length),k[v+1][1]=k[v-1][1]+k[v+1][1],k.splice(v-1,1),Y=!0):k[v][1].substring(0,k[v+1][1].length)==k[v+1][1]&&(k[v-1][1]+=k[v+1][1],k[v][1]=k[v][1].substring(k[v+1][1].length)+k[v+1][1],k.splice(v+1,1),Y=!0)),v++;Y&&x(k,M)}function A(k){return k>=55296&&k<=56319}function O(k){return k>=56320&&k<=57343}function $(k){return O(k.charCodeAt(0))}function L(k){return A(k.charCodeAt(k.length-1))}function H(k){for(var M=[],v=0;v<k.length;v++)k[v][1].length>0&&M.push(k[v]);return M}function q(k,M,v,N){return L(k)||$(N)?null:H([[r,k],[t,M],[e,v],[r,N]])}function F(k,M,v){var N=typeof v=="number"?{index:v,length:0}:v.oldRange,P=typeof v=="number"?null:v.newRange,j=k.length,R=M.length;if(N.length===0&&(P===null||P.length===0)){var D=N.index,U=k.slice(0,D),B=k.slice(D),V=P?P.index:null;e:{var J=D+R-j;if(V!==null&&V!==J||J<0||J>R)break e;var Y=M.slice(0,J),re=M.slice(J);if(re!==B)break e;var K=Math.min(D,J),de=U.slice(0,K),ye=Y.slice(0,K);if(de!==ye)break e;var te=U.slice(K),se=Y.slice(K);return q(de,te,se,B)}e:{if(V!==null&&V!==D)break e;var ie=D,Y=M.slice(0,ie),re=M.slice(ie);if(Y!==U)break e;var he=Math.min(j-ie,R-ie),pe=B.slice(B.length-he),me=re.slice(re.length-he);if(pe!==me)break e;var te=B.slice(0,B.length-he),se=re.slice(0,re.length-he);return q(U,te,se,pe)}}if(N.length>0&&P&&P.length===0)e:{var de=k.slice(0,N.index),pe=k.slice(N.index+N.length),K=de.length,he=pe.length;if(R<K+he)break e;var ye=M.slice(0,K),me=M.slice(R-he);if(de!==ye||pe!==me)break e;var te=k.slice(K,j-he),se=M.slice(K,R-he);return q(de,te,se,pe)}return null}function W(k,M,v,N){return n(k,M,v,N,!0)}return W.INSERT=e,W.DELETE=t,W.EQUAL=r,Do=W,Do}var Hn={exports:{}};Hn.exports;var Pl;function wd(){return Pl||(Pl=1,function(t,e){var r=200,n="__lodash_hash_undefined__",s=9007199254740991,i="[object Arguments]",o="[object Array]",a="[object Boolean]",l="[object Date]",u="[object Error]",d="[object Function]",f="[object GeneratorFunction]",h="[object Map]",p="[object Number]",y="[object Object]",b="[object Promise]",S="[object RegExp]",C="[object Set]",x="[object String]",A="[object Symbol]",O="[object WeakMap]",$="[object ArrayBuffer]",L="[object DataView]",H="[object Float32Array]",q="[object Float64Array]",F="[object Int8Array]",W="[object Int16Array]",k="[object Int32Array]",M="[object Uint8Array]",v="[object Uint8ClampedArray]",N="[object Uint16Array]",P="[object Uint32Array]",j=/[\\^$.*+?()[\]{}|]/g,R=/\w*$/,D=/^\[object .+?Constructor\]$/,U=/^(?:0|[1-9]\d*)$/,B={};B[i]=B[o]=B[$]=B[L]=B[a]=B[l]=B[H]=B[q]=B[F]=B[W]=B[k]=B[h]=B[p]=B[y]=B[S]=B[C]=B[x]=B[A]=B[M]=B[v]=B[N]=B[P]=!0,B[u]=B[d]=B[O]=!1;var V=typeof rr=="object"&&rr&&rr.Object===Object&&rr,J=typeof self=="object"&&self&&self.Object===Object&&self,Y=V||J||Function("return this")(),re=e&&!e.nodeType&&e,K=re&&!0&&t&&!t.nodeType&&t,de=K&&K.exports===re;function ye(c,g){return c.set(g[0],g[1]),c}function te(c,g){return c.add(g),c}function se(c,g){for(var w=-1,I=c?c.length:0;++w<I&&g(c[w],w,c)!==!1;);return c}function ie(c,g){for(var w=-1,I=g.length,Z=c.length;++w<I;)c[Z+w]=g[w];return c}function he(c,g,w,I){for(var Z=-1,G=c?c.length:0;++Z<G;)w=g(w,c[Z],Z,c);return w}function pe(c,g){for(var w=-1,I=Array(c);++w<c;)I[w]=g(w);return I}function me(c,g){return c==null?void 0:c[g]}function Te(c){var g=!1;if(c!=null&&typeof c.toString!="function")try{g=!!(c+"")}catch{}return g}function Ue(c){var g=-1,w=Array(c.size);return c.forEach(function(I,Z){w[++g]=[Z,I]}),w}function xn(c,g){return function(w){return c(g(w))}}function xs(c){var g=-1,w=Array(c.size);return c.forEach(function(I){w[++g]=I}),w}var Vi=Array.prototype,Gi=Function.prototype,Dr=Object.prototype,Cn=Y["__core-js_shared__"],Cs=function(){var c=/[^.]+$/.exec(Cn&&Cn.keys&&Cn.keys.IE_PROTO||"");return c?"Symbol(src)_1."+c:""}(),Ss=Gi.toString,vt=Dr.hasOwnProperty,Fr=Dr.toString,Yi=RegExp("^"+Ss.call(vt).replace(j,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),yr=de?Y.Buffer:void 0,Ur=Y.Symbol,Sn=Y.Uint8Array,it=xn(Object.getPrototypeOf,Object),Es=Object.create,Ts=Dr.propertyIsEnumerable,Xi=Vi.splice,En=Object.getOwnPropertySymbols,Br=yr?yr.isBuffer:void 0,Ms=xn(Object.keys,Object),Hr=ht(Y,"DataView"),br=ht(Y,"Map"),dt=ht(Y,"Promise"),Wr=ht(Y,"Set"),Tn=ht(Y,"WeakMap"),_r=ht(Object,"create"),Mn=Ve(Hr),kr=Ve(br),An=Ve(dt),Nn=Ve(Wr),On=Ve(Tn),Qt=Ur?Ur.prototype:void 0,As=Qt?Qt.valueOf:void 0;function $t(c){var g=-1,w=c?c.length:0;for(this.clear();++g<w;){var I=c[g];this.set(I[0],I[1])}}function Qi(){this.__data__=_r?_r(null):{}}function Zi(c){return this.has(c)&&delete this.__data__[c]}function eo(c){var g=this.__data__;if(_r){var w=g[c];return w===n?void 0:w}return vt.call(g,c)?g[c]:void 0}function Ns(c){var g=this.__data__;return _r?g[c]!==void 0:vt.call(g,c)}function jn(c,g){var w=this.__data__;return w[c]=_r&&g===void 0?n:g,this}$t.prototype.clear=Qi,$t.prototype.delete=Zi,$t.prototype.get=eo,$t.prototype.has=Ns,$t.prototype.set=jn;function $e(c){var g=-1,w=c?c.length:0;for(this.clear();++g<w;){var I=c[g];this.set(I[0],I[1])}}function to(){this.__data__=[]}function ro(c){var g=this.__data__,w=Jr(g,c);if(w<0)return!1;var I=g.length-1;return w==I?g.pop():Xi.call(g,w,1),!0}function no(c){var g=this.__data__,w=Jr(g,c);return w<0?void 0:g[w][1]}function so(c){return Jr(this.__data__,c)>-1}function io(c,g){var w=this.__data__,I=Jr(w,c);return I<0?w.push([c,g]):w[I][1]=g,this}$e.prototype.clear=to,$e.prototype.delete=ro,$e.prototype.get=no,$e.prototype.has=so,$e.prototype.set=io;function Be(c){var g=-1,w=c?c.length:0;for(this.clear();++g<w;){var I=c[g];this.set(I[0],I[1])}}function oo(){this.__data__={hash:new $t,map:new(br||$e),string:new $t}}function ao(c){return wr(this,c).delete(c)}function lo(c){return wr(this,c).get(c)}function co(c){return wr(this,c).has(c)}function uo(c,g){return wr(this,c).set(c,g),this}Be.prototype.clear=oo,Be.prototype.delete=ao,Be.prototype.get=lo,Be.prototype.has=co,Be.prototype.set=uo;function Qe(c){this.__data__=new $e(c)}function ho(){this.__data__=new $e}function fo(c){return this.__data__.delete(c)}function po(c){return this.__data__.get(c)}function go(c){return this.__data__.has(c)}function mo(c,g){var w=this.__data__;if(w instanceof $e){var I=w.__data__;if(!br||I.length<r-1)return I.push([c,g]),this;w=this.__data__=new Be(I)}return w.set(c,g),this}Qe.prototype.clear=ho,Qe.prototype.delete=fo,Qe.prototype.get=po,Qe.prototype.has=go,Qe.prototype.set=mo;function zr(c,g){var w=$n(c)||Vr(c)?pe(c.length,String):[],I=w.length,Z=!!I;for(var G in c)vt.call(c,G)&&!(Z&&(G=="length"||No(G,I)))&&w.push(G);return w}function Os(c,g,w){var I=c[g];(!(vt.call(c,g)&&$s(I,w))||w===void 0&&!(g in c))&&(c[g]=w)}function Jr(c,g){for(var w=c.length;w--;)if($s(c[w][0],g))return w;return-1}function wt(c,g){return c&&Rn(g,Ln(g),c)}function In(c,g,w,I,Z,G,ce){var le;if(I&&(le=G?I(c,Z,G,ce):I(c)),le!==void 0)return le;if(!Ct(c))return c;var Me=$n(c);if(Me){if(le=Mo(c),!g)return So(c,le)}else{var fe=Lt(c),He=fe==d||fe==f;if(qs(c))return Kr(c,g);if(fe==y||fe==i||He&&!G){if(Te(c))return G?c:{};if(le=xt(He?{}:c),!g)return Eo(c,wt(le,c))}else{if(!B[fe])return G?c:{};le=Ao(c,fe,In,g)}}ce||(ce=new Qe);var Ze=ce.get(c);if(Ze)return Ze;if(ce.set(c,le),!Me)var Ae=w?To(c):Ln(c);return se(Ae||c,function(We,qe){Ae&&(qe=We,We=c[qe]),Os(le,qe,In(We,g,w,I,qe,c,ce))}),le}function yo(c){return Ct(c)?Es(c):{}}function bo(c,g,w){var I=g(c);return $n(c)?I:ie(I,w(c))}function _o(c){return Fr.call(c)}function ko(c){if(!Ct(c)||jo(c))return!1;var g=qn(c)||Te(c)?Yi:D;return g.test(Ve(c))}function vo(c){if(!Ps(c))return Ms(c);var g=[];for(var w in Object(c))vt.call(c,w)&&w!="constructor"&&g.push(w);return g}function Kr(c,g){if(g)return c.slice();var w=new c.constructor(c.length);return c.copy(w),w}function Pn(c){var g=new c.constructor(c.byteLength);return new Sn(g).set(new Sn(c)),g}function vr(c,g){var w=g?Pn(c.buffer):c.buffer;return new c.constructor(w,c.byteOffset,c.byteLength)}function js(c,g,w){var I=g?w(Ue(c),!0):Ue(c);return he(I,ye,new c.constructor)}function Is(c){var g=new c.constructor(c.source,R.exec(c));return g.lastIndex=c.lastIndex,g}function wo(c,g,w){var I=g?w(xs(c),!0):xs(c);return he(I,te,new c.constructor)}function xo(c){return As?Object(As.call(c)):{}}function Co(c,g){var w=g?Pn(c.buffer):c.buffer;return new c.constructor(w,c.byteOffset,c.length)}function So(c,g){var w=-1,I=c.length;for(g||(g=Array(I));++w<I;)g[w]=c[w];return g}function Rn(c,g,w,I){w||(w={});for(var Z=-1,G=g.length;++Z<G;){var ce=g[Z],le=void 0;Os(w,ce,le===void 0?c[ce]:le)}return w}function Eo(c,g){return Rn(c,qt(c),g)}function To(c){return bo(c,Ln,qt)}function wr(c,g){var w=c.__data__;return Oo(g)?w[typeof g=="string"?"string":"hash"]:w.map}function ht(c,g){var w=me(c,g);return ko(w)?w:void 0}var qt=En?xn(En,Object):Po,Lt=_o;(Hr&&Lt(new Hr(new ArrayBuffer(1)))!=L||br&&Lt(new br)!=h||dt&&Lt(dt.resolve())!=b||Wr&&Lt(new Wr)!=C||Tn&&Lt(new Tn)!=O)&&(Lt=function(c){var g=Fr.call(c),w=g==y?c.constructor:void 0,I=w?Ve(w):void 0;if(I)switch(I){case Mn:return L;case kr:return h;case An:return b;case Nn:return C;case On:return O}return g});function Mo(c){var g=c.length,w=c.constructor(g);return g&&typeof c[0]=="string"&&vt.call(c,"index")&&(w.index=c.index,w.input=c.input),w}function xt(c){return typeof c.constructor=="function"&&!Ps(c)?yo(it(c)):{}}function Ao(c,g,w,I){var Z=c.constructor;switch(g){case $:return Pn(c);case a:case l:return new Z(+c);case L:return vr(c,I);case H:case q:case F:case W:case k:case M:case v:case N:case P:return Co(c,I);case h:return js(c,I,w);case p:case x:return new Z(c);case S:return Is(c);case C:return wo(c,I,w);case A:return xo(c)}}function No(c,g){return g=g??s,!!g&&(typeof c=="number"||U.test(c))&&c>-1&&c%1==0&&c<g}function Oo(c){var g=typeof c;return g=="string"||g=="number"||g=="symbol"||g=="boolean"?c!=="__proto__":c===null}function jo(c){return!!Cs&&Cs in c}function Ps(c){var g=c&&c.constructor,w=typeof g=="function"&&g.prototype||Dr;return c===w}function Ve(c){if(c!=null){try{return Ss.call(c)}catch{}try{return c+""}catch{}}return""}function Rs(c){return In(c,!0,!0)}function $s(c,g){return c===g||c!==c&&g!==g}function Vr(c){return Io(c)&&vt.call(c,"callee")&&(!Ts.call(c,"callee")||Fr.call(c)==i)}var $n=Array.isArray;function Gr(c){return c!=null&&Ls(c.length)&&!qn(c)}function Io(c){return Ds(c)&&Gr(c)}var qs=Br||Ro;function qn(c){var g=Ct(c)?Fr.call(c):"";return g==d||g==f}function Ls(c){return typeof c=="number"&&c>-1&&c%1==0&&c<=s}function Ct(c){var g=typeof c;return!!c&&(g=="object"||g=="function")}function Ds(c){return!!c&&typeof c=="object"}function Ln(c){return Gr(c)?zr(c):vo(c)}function Po(){return[]}function Ro(){return!1}t.exports=Rs}(Hn,Hn.exports)),Hn.exports}var Wn={exports:{}};Wn.exports;var Rl;function xd(){return Rl||(Rl=1,function(t,e){var r=200,n="__lodash_hash_undefined__",s=1,i=2,o=9007199254740991,a="[object Arguments]",l="[object Array]",u="[object AsyncFunction]",d="[object Boolean]",f="[object Date]",h="[object Error]",p="[object Function]",y="[object GeneratorFunction]",b="[object Map]",S="[object Number]",C="[object Null]",x="[object Object]",A="[object Promise]",O="[object Proxy]",$="[object RegExp]",L="[object Set]",H="[object String]",q="[object Symbol]",F="[object Undefined]",W="[object WeakMap]",k="[object ArrayBuffer]",M="[object DataView]",v="[object Float32Array]",N="[object Float64Array]",P="[object Int8Array]",j="[object Int16Array]",R="[object Int32Array]",D="[object Uint8Array]",U="[object Uint8ClampedArray]",B="[object Uint16Array]",V="[object Uint32Array]",J=/[\\^$.*+?()[\]{}|]/g,Y=/^\[object .+?Constructor\]$/,re=/^(?:0|[1-9]\d*)$/,K={};K[v]=K[N]=K[P]=K[j]=K[R]=K[D]=K[U]=K[B]=K[V]=!0,K[a]=K[l]=K[k]=K[d]=K[M]=K[f]=K[h]=K[p]=K[b]=K[S]=K[x]=K[$]=K[L]=K[H]=K[W]=!1;var de=typeof rr=="object"&&rr&&rr.Object===Object&&rr,ye=typeof self=="object"&&self&&self.Object===Object&&self,te=de||ye||Function("return this")(),se=e&&!e.nodeType&&e,ie=se&&!0&&t&&!t.nodeType&&t,he=ie&&ie.exports===se,pe=he&&de.process,me=function(){try{return pe&&pe.binding&&pe.binding("util")}catch{}}(),Te=me&&me.isTypedArray;function Ue(c,g){for(var w=-1,I=c==null?0:c.length,Z=0,G=[];++w<I;){var ce=c[w];g(ce,w,c)&&(G[Z++]=ce)}return G}function xn(c,g){for(var w=-1,I=g.length,Z=c.length;++w<I;)c[Z+w]=g[w];return c}function xs(c,g){for(var w=-1,I=c==null?0:c.length;++w<I;)if(g(c[w],w,c))return!0;return!1}function Vi(c,g){for(var w=-1,I=Array(c);++w<c;)I[w]=g(w);return I}function Gi(c){return function(g){return c(g)}}function Dr(c,g){return c.has(g)}function Cn(c,g){return c==null?void 0:c[g]}function Cs(c){var g=-1,w=Array(c.size);return c.forEach(function(I,Z){w[++g]=[Z,I]}),w}function Ss(c,g){return function(w){return c(g(w))}}function vt(c){var g=-1,w=Array(c.size);return c.forEach(function(I){w[++g]=I}),w}var Fr=Array.prototype,Yi=Function.prototype,yr=Object.prototype,Ur=te["__core-js_shared__"],Sn=Yi.toString,it=yr.hasOwnProperty,Es=function(){var c=/[^.]+$/.exec(Ur&&Ur.keys&&Ur.keys.IE_PROTO||"");return c?"Symbol(src)_1."+c:""}(),Ts=yr.toString,Xi=RegExp("^"+Sn.call(it).replace(J,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),En=he?te.Buffer:void 0,Br=te.Symbol,Ms=te.Uint8Array,Hr=yr.propertyIsEnumerable,br=Fr.splice,dt=Br?Br.toStringTag:void 0,Wr=Object.getOwnPropertySymbols,Tn=En?En.isBuffer:void 0,_r=Ss(Object.keys,Object),Mn=qt(te,"DataView"),kr=qt(te,"Map"),An=qt(te,"Promise"),Nn=qt(te,"Set"),On=qt(te,"WeakMap"),Qt=qt(Object,"create"),As=Ve(Mn),$t=Ve(kr),Qi=Ve(An),Zi=Ve(Nn),eo=Ve(On),Ns=Br?Br.prototype:void 0,jn=Ns?Ns.valueOf:void 0;function $e(c){var g=-1,w=c==null?0:c.length;for(this.clear();++g<w;){var I=c[g];this.set(I[0],I[1])}}function to(){this.__data__=Qt?Qt(null):{},this.size=0}function ro(c){var g=this.has(c)&&delete this.__data__[c];return this.size-=g?1:0,g}function no(c){var g=this.__data__;if(Qt){var w=g[c];return w===n?void 0:w}return it.call(g,c)?g[c]:void 0}function so(c){var g=this.__data__;return Qt?g[c]!==void 0:it.call(g,c)}function io(c,g){var w=this.__data__;return this.size+=this.has(c)?0:1,w[c]=Qt&&g===void 0?n:g,this}$e.prototype.clear=to,$e.prototype.delete=ro,$e.prototype.get=no,$e.prototype.has=so,$e.prototype.set=io;function Be(c){var g=-1,w=c==null?0:c.length;for(this.clear();++g<w;){var I=c[g];this.set(I[0],I[1])}}function oo(){this.__data__=[],this.size=0}function ao(c){var g=this.__data__,w=Kr(g,c);if(w<0)return!1;var I=g.length-1;return w==I?g.pop():br.call(g,w,1),--this.size,!0}function lo(c){var g=this.__data__,w=Kr(g,c);return w<0?void 0:g[w][1]}function co(c){return Kr(this.__data__,c)>-1}function uo(c,g){var w=this.__data__,I=Kr(w,c);return I<0?(++this.size,w.push([c,g])):w[I][1]=g,this}Be.prototype.clear=oo,Be.prototype.delete=ao,Be.prototype.get=lo,Be.prototype.has=co,Be.prototype.set=uo;function Qe(c){var g=-1,w=c==null?0:c.length;for(this.clear();++g<w;){var I=c[g];this.set(I[0],I[1])}}function ho(){this.size=0,this.__data__={hash:new $e,map:new(kr||Be),string:new $e}}function fo(c){var g=ht(this,c).delete(c);return this.size-=g?1:0,g}function po(c){return ht(this,c).get(c)}function go(c){return ht(this,c).has(c)}function mo(c,g){var w=ht(this,c),I=w.size;return w.set(c,g),this.size+=w.size==I?0:1,this}Qe.prototype.clear=ho,Qe.prototype.delete=fo,Qe.prototype.get=po,Qe.prototype.has=go,Qe.prototype.set=mo;function zr(c){var g=-1,w=c==null?0:c.length;for(this.__data__=new Qe;++g<w;)this.add(c[g])}function Os(c){return this.__data__.set(c,n),this}function Jr(c){return this.__data__.has(c)}zr.prototype.add=zr.prototype.push=Os,zr.prototype.has=Jr;function wt(c){var g=this.__data__=new Be(c);this.size=g.size}function In(){this.__data__=new Be,this.size=0}function yo(c){var g=this.__data__,w=g.delete(c);return this.size=g.size,w}function bo(c){return this.__data__.get(c)}function _o(c){return this.__data__.has(c)}function ko(c,g){var w=this.__data__;if(w instanceof Be){var I=w.__data__;if(!kr||I.length<r-1)return I.push([c,g]),this.size=++w.size,this;w=this.__data__=new Qe(I)}return w.set(c,g),this.size=w.size,this}wt.prototype.clear=In,wt.prototype.delete=yo,wt.prototype.get=bo,wt.prototype.has=_o,wt.prototype.set=ko;function vo(c,g){var w=Vr(c),I=!w&&$s(c),Z=!w&&!I&&Gr(c),G=!w&&!I&&!Z&&Ds(c),ce=w||I||Z||G,le=ce?Vi(c.length,String):[],Me=le.length;for(var fe in c)it.call(c,fe)&&!(ce&&(fe=="length"||Z&&(fe=="offset"||fe=="parent")||G&&(fe=="buffer"||fe=="byteLength"||fe=="byteOffset")||Ao(fe,Me)))&&le.push(fe);return le}function Kr(c,g){for(var w=c.length;w--;)if(Rs(c[w][0],g))return w;return-1}function Pn(c,g,w){var I=g(c);return Vr(c)?I:xn(I,w(c))}function vr(c){return c==null?c===void 0?F:C:dt&&dt in Object(c)?Lt(c):Ps(c)}function js(c){return Ct(c)&&vr(c)==a}function Is(c,g,w,I,Z){return c===g?!0:c==null||g==null||!Ct(c)&&!Ct(g)?c!==c&&g!==g:wo(c,g,w,I,Is,Z)}function wo(c,g,w,I,Z,G){var ce=Vr(c),le=Vr(g),Me=ce?l:xt(c),fe=le?l:xt(g);Me=Me==a?x:Me,fe=fe==a?x:fe;var He=Me==x,Ze=fe==x,Ae=Me==fe;if(Ae&&Gr(c)){if(!Gr(g))return!1;ce=!0,He=!1}if(Ae&&!He)return G||(G=new wt),ce||Ds(c)?Rn(c,g,w,I,Z,G):Eo(c,g,Me,w,I,Z,G);if(!(w&s)){var We=He&&it.call(c,"__wrapped__"),qe=Ze&&it.call(g,"__wrapped__");if(We||qe){var Zt=We?c.value():c,Dt=qe?g.value():g;return G||(G=new wt),Z(Zt,Dt,w,I,G)}}return Ae?(G||(G=new wt),To(c,g,w,I,Z,G)):!1}function xo(c){if(!Ls(c)||Oo(c))return!1;var g=qs(c)?Xi:Y;return g.test(Ve(c))}function Co(c){return Ct(c)&&qn(c.length)&&!!K[vr(c)]}function So(c){if(!jo(c))return _r(c);var g=[];for(var w in Object(c))it.call(c,w)&&w!="constructor"&&g.push(w);return g}function Rn(c,g,w,I,Z,G){var ce=w&s,le=c.length,Me=g.length;if(le!=Me&&!(ce&&Me>le))return!1;var fe=G.get(c);if(fe&&G.get(g))return fe==g;var He=-1,Ze=!0,Ae=w&i?new zr:void 0;for(G.set(c,g),G.set(g,c);++He<le;){var We=c[He],qe=g[He];if(I)var Zt=ce?I(qe,We,He,g,c,G):I(We,qe,He,c,g,G);if(Zt!==void 0){if(Zt)continue;Ze=!1;break}if(Ae){if(!xs(g,function(Dt,xr){if(!Dr(Ae,xr)&&(We===Dt||Z(We,Dt,w,I,G)))return Ae.push(xr)})){Ze=!1;break}}else if(!(We===qe||Z(We,qe,w,I,G))){Ze=!1;break}}return G.delete(c),G.delete(g),Ze}function Eo(c,g,w,I,Z,G,ce){switch(w){case M:if(c.byteLength!=g.byteLength||c.byteOffset!=g.byteOffset)return!1;c=c.buffer,g=g.buffer;case k:return!(c.byteLength!=g.byteLength||!G(new Ms(c),new Ms(g)));case d:case f:case S:return Rs(+c,+g);case h:return c.name==g.name&&c.message==g.message;case $:case H:return c==g+"";case b:var le=Cs;case L:var Me=I&s;if(le||(le=vt),c.size!=g.size&&!Me)return!1;var fe=ce.get(c);if(fe)return fe==g;I|=i,ce.set(c,g);var He=Rn(le(c),le(g),I,Z,G,ce);return ce.delete(c),He;case q:if(jn)return jn.call(c)==jn.call(g)}return!1}function To(c,g,w,I,Z,G){var ce=w&s,le=wr(c),Me=le.length,fe=wr(g),He=fe.length;if(Me!=He&&!ce)return!1;for(var Ze=Me;Ze--;){var Ae=le[Ze];if(!(ce?Ae in g:it.call(g,Ae)))return!1}var We=G.get(c);if(We&&G.get(g))return We==g;var qe=!0;G.set(c,g),G.set(g,c);for(var Zt=ce;++Ze<Me;){Ae=le[Ze];var Dt=c[Ae],xr=g[Ae];if(I)var Cl=ce?I(xr,Dt,Ae,g,c,G):I(Dt,xr,Ae,c,g,G);if(!(Cl===void 0?Dt===xr||Z(Dt,xr,w,I,G):Cl)){qe=!1;break}Zt||(Zt=Ae=="constructor")}if(qe&&!Zt){var Fs=c.constructor,Us=g.constructor;Fs!=Us&&"constructor"in c&&"constructor"in g&&!(typeof Fs=="function"&&Fs instanceof Fs&&typeof Us=="function"&&Us instanceof Us)&&(qe=!1)}return G.delete(c),G.delete(g),qe}function wr(c){return Pn(c,Ln,Mo)}function ht(c,g){var w=c.__data__;return No(g)?w[typeof g=="string"?"string":"hash"]:w.map}function qt(c,g){var w=Cn(c,g);return xo(w)?w:void 0}function Lt(c){var g=it.call(c,dt),w=c[dt];try{c[dt]=void 0;var I=!0}catch{}var Z=Ts.call(c);return I&&(g?c[dt]=w:delete c[dt]),Z}var Mo=Wr?function(c){return c==null?[]:(c=Object(c),Ue(Wr(c),function(g){return Hr.call(c,g)}))}:Po,xt=vr;(Mn&&xt(new Mn(new ArrayBuffer(1)))!=M||kr&&xt(new kr)!=b||An&&xt(An.resolve())!=A||Nn&&xt(new Nn)!=L||On&&xt(new On)!=W)&&(xt=function(c){var g=vr(c),w=g==x?c.constructor:void 0,I=w?Ve(w):"";if(I)switch(I){case As:return M;case $t:return b;case Qi:return A;case Zi:return L;case eo:return W}return g});function Ao(c,g){return g=g??o,!!g&&(typeof c=="number"||re.test(c))&&c>-1&&c%1==0&&c<g}function No(c){var g=typeof c;return g=="string"||g=="number"||g=="symbol"||g=="boolean"?c!=="__proto__":c===null}function Oo(c){return!!Es&&Es in c}function jo(c){var g=c&&c.constructor,w=typeof g=="function"&&g.prototype||yr;return c===w}function Ps(c){return Ts.call(c)}function Ve(c){if(c!=null){try{return Sn.call(c)}catch{}try{return c+""}catch{}}return""}function Rs(c,g){return c===g||c!==c&&g!==g}var $s=js(function(){return arguments}())?js:function(c){return Ct(c)&&it.call(c,"callee")&&!Hr.call(c,"callee")},Vr=Array.isArray;function $n(c){return c!=null&&qn(c.length)&&!qs(c)}var Gr=Tn||Ro;function Io(c,g){return Is(c,g)}function qs(c){if(!Ls(c))return!1;var g=vr(c);return g==p||g==y||g==u||g==O}function qn(c){return typeof c=="number"&&c>-1&&c%1==0&&c<=o}function Ls(c){var g=typeof c;return c!=null&&(g=="object"||g=="function")}function Ct(c){return c!=null&&typeof c=="object"}var Ds=Te?Gi(Te):Co;function Ln(c){return $n(c)?vo(c):So(c)}function Po(){return[]}function Ro(){return!1}t.exports=Io}(Wn,Wn.exports)),Wn.exports}var Ws={},$l;function _g(){if($l)return Ws;$l=1,Object.defineProperty(Ws,"__esModule",{value:!0});const t=wd(),e=xd();var r;return function(n){function s(l={},u={},d=!1){typeof l!="object"&&(l={}),typeof u!="object"&&(u={});let f=t(u);d||(f=Object.keys(f).reduce((h,p)=>(f[p]!=null&&(h[p]=f[p]),h),{}));for(const h in l)l[h]!==void 0&&u[h]===void 0&&(f[h]=l[h]);return Object.keys(f).length>0?f:void 0}n.compose=s;function i(l={},u={}){typeof l!="object"&&(l={}),typeof u!="object"&&(u={});const d=Object.keys(l).concat(Object.keys(u)).reduce((f,h)=>(e(l[h],u[h])||(f[h]=u[h]===void 0?null:u[h]),f),{});return Object.keys(d).length>0?d:void 0}n.diff=i;function o(l={},u={}){l=l||{};const d=Object.keys(u).reduce((f,h)=>(u[h]!==l[h]&&l[h]!==void 0&&(f[h]=u[h]),f),{});return Object.keys(l).reduce((f,h)=>(l[h]!==u[h]&&u[h]===void 0&&(f[h]=null),f),d)}n.invert=o;function a(l,u,d=!1){if(typeof l!="object")return u;if(typeof u!="object")return;if(!d)return u;const f=Object.keys(u).reduce((h,p)=>(l[p]===void 0&&(h[p]=u[p]),h),{});return Object.keys(f).length>0?f:void 0}n.transform=a}(r||(r={})),Ws.default=r,Ws}var zs={},ql;function Cd(){if(ql)return zs;ql=1,Object.defineProperty(zs,"__esModule",{value:!0});var t;return function(e){function r(n){return typeof n.delete=="number"?n.delete:typeof n.retain=="number"?n.retain:typeof n.retain=="object"&&n.retain!==null?1:typeof n.insert=="string"?n.insert.length:1}e.length=r}(t||(t={})),zs.default=t,zs}var Js={},Ll;function kg(){if(Ll)return Js;Ll=1,Object.defineProperty(Js,"__esModule",{value:!0});const t=Cd();class e{constructor(n){this.ops=n,this.index=0,this.offset=0}hasNext(){return this.peekLength()<1/0}next(n){n||(n=1/0);const s=this.ops[this.index];if(s){const i=this.offset,o=t.default.length(s);if(n>=o-i?(n=o-i,this.index+=1,this.offset=0):this.offset+=n,typeof s.delete=="number")return{delete:n};{const a={};return s.attributes&&(a.attributes=s.attributes),typeof s.retain=="number"?a.retain=n:typeof s.retain=="object"&&s.retain!==null?a.retain=s.retain:typeof s.insert=="string"?a.insert=s.insert.substr(i,n):a.insert=s.insert,a}}else return{retain:1/0}}peek(){return this.ops[this.index]}peekLength(){return this.ops[this.index]?t.default.length(this.ops[this.index])-this.offset:1/0}peekType(){const n=this.ops[this.index];return n?typeof n.delete=="number"?"delete":typeof n.retain=="number"||typeof n.retain=="object"&&n.retain!==null?"retain":"insert":"retain"}rest(){if(this.hasNext()){if(this.offset===0)return this.ops.slice(this.index);{const n=this.offset,s=this.index,i=this.next(),o=this.ops.slice(this.index);return this.offset=n,this.index=s,[i].concat(o)}}else return[]}}return Js.default=e,Js}var Dl;function vg(){return Dl||(Dl=1,function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeMap=e.OpIterator=e.Op=void 0;const r=bg(),n=wd(),s=xd(),i=_g();e.AttributeMap=i.default;const o=Cd();e.Op=o.default;const a=kg();e.OpIterator=a.default;const l="\0",u=(f,h)=>{if(typeof f!="object"||f===null)throw new Error(`cannot retain a ${typeof f}`);if(typeof h!="object"||h===null)throw new Error(`cannot retain a ${typeof h}`);const p=Object.keys(f)[0];if(!p||p!==Object.keys(h)[0])throw new Error(`embed types not matched: ${p} != ${Object.keys(h)[0]}`);return[p,f[p],h[p]]};class d{constructor(h){Array.isArray(h)?this.ops=h:h!=null&&Array.isArray(h.ops)?this.ops=h.ops:this.ops=[]}static registerEmbed(h,p){this.handlers[h]=p}static unregisterEmbed(h){delete this.handlers[h]}static getHandler(h){const p=this.handlers[h];if(!p)throw new Error(`no handlers for embed type "${h}"`);return p}insert(h,p){const y={};return typeof h=="string"&&h.length===0?this:(y.insert=h,p!=null&&typeof p=="object"&&Object.keys(p).length>0&&(y.attributes=p),this.push(y))}delete(h){return h<=0?this:this.push({delete:h})}retain(h,p){if(typeof h=="number"&&h<=0)return this;const y={retain:h};return p!=null&&typeof p=="object"&&Object.keys(p).length>0&&(y.attributes=p),this.push(y)}push(h){let p=this.ops.length,y=this.ops[p-1];if(h=n(h),typeof y=="object"){if(typeof h.delete=="number"&&typeof y.delete=="number")return this.ops[p-1]={delete:y.delete+h.delete},this;if(typeof y.delete=="number"&&h.insert!=null&&(p-=1,y=this.ops[p-1],typeof y!="object"))return this.ops.unshift(h),this;if(s(h.attributes,y.attributes)){if(typeof h.insert=="string"&&typeof y.insert=="string")return this.ops[p-1]={insert:y.insert+h.insert},typeof h.attributes=="object"&&(this.ops[p-1].attributes=h.attributes),this;if(typeof h.retain=="number"&&typeof y.retain=="number")return this.ops[p-1]={retain:y.retain+h.retain},typeof h.attributes=="object"&&(this.ops[p-1].attributes=h.attributes),this}}return p===this.ops.length?this.ops.push(h):this.ops.splice(p,0,h),this}chop(){const h=this.ops[this.ops.length-1];return h&&typeof h.retain=="number"&&!h.attributes&&this.ops.pop(),this}filter(h){return this.ops.filter(h)}forEach(h){this.ops.forEach(h)}map(h){return this.ops.map(h)}partition(h){const p=[],y=[];return this.forEach(b=>{(h(b)?p:y).push(b)}),[p,y]}reduce(h,p){return this.ops.reduce(h,p)}changeLength(){return this.reduce((h,p)=>p.insert?h+o.default.length(p):p.delete?h-p.delete:h,0)}length(){return this.reduce((h,p)=>h+o.default.length(p),0)}slice(h=0,p=1/0){const y=[],b=new a.default(this.ops);let S=0;for(;S<p&&b.hasNext();){let C;S<h?C=b.next(h-S):(C=b.next(p-S),y.push(C)),S+=o.default.length(C)}return new d(y)}compose(h){const p=new a.default(this.ops),y=new a.default(h.ops),b=[],S=y.peek();if(S!=null&&typeof S.retain=="number"&&S.attributes==null){let x=S.retain;for(;p.peekType()==="insert"&&p.peekLength()<=x;)x-=p.peekLength(),b.push(p.next());S.retain-x>0&&y.next(S.retain-x)}const C=new d(b);for(;p.hasNext()||y.hasNext();)if(y.peekType()==="insert")C.push(y.next());else if(p.peekType()==="delete")C.push(p.next());else{const x=Math.min(p.peekLength(),y.peekLength()),A=p.next(x),O=y.next(x);if(O.retain){const $={};if(typeof A.retain=="number")$.retain=typeof O.retain=="number"?x:O.retain;else if(typeof O.retain=="number")A.retain==null?$.insert=A.insert:$.retain=A.retain;else{const H=A.retain==null?"insert":"retain",[q,F,W]=u(A[H],O.retain),k=d.getHandler(q);$[H]={[q]:k.compose(F,W,H==="retain")}}const L=i.default.compose(A.attributes,O.attributes,typeof A.retain=="number");if(L&&($.attributes=L),C.push($),!y.hasNext()&&s(C.ops[C.ops.length-1],$)){const H=new d(p.rest());return C.concat(H).chop()}}else typeof O.delete=="number"&&(typeof A.retain=="number"||typeof A.retain=="object"&&A.retain!==null)&&C.push(O)}return C.chop()}concat(h){const p=new d(this.ops.slice());return h.ops.length>0&&(p.push(h.ops[0]),p.ops=p.ops.concat(h.ops.slice(1))),p}diff(h,p){if(this.ops===h.ops)return new d;const y=[this,h].map(A=>A.map(O=>{if(O.insert!=null)return typeof O.insert=="string"?O.insert:l;const $=A===h?"on":"with";throw new Error("diff() called "+$+" non-document")}).join("")),b=new d,S=r(y[0],y[1],p,!0),C=new a.default(this.ops),x=new a.default(h.ops);return S.forEach(A=>{let O=A[1].length;for(;O>0;){let $=0;switch(A[0]){case r.INSERT:$=Math.min(x.peekLength(),O),b.push(x.next($));break;case r.DELETE:$=Math.min(O,C.peekLength()),C.next($),b.delete($);break;case r.EQUAL:$=Math.min(C.peekLength(),x.peekLength(),O);const L=C.next($),H=x.next($);s(L.insert,H.insert)?b.retain($,i.default.diff(L.attributes,H.attributes)):b.push(H).delete($);break}O-=$}}),b.chop()}eachLine(h,p=`
`){const y=new a.default(this.ops);let b=new d,S=0;for(;y.hasNext();){if(y.peekType()!=="insert")return;const C=y.peek(),x=o.default.length(C)-y.peekLength(),A=typeof C.insert=="string"?C.insert.indexOf(p,x)-x:-1;if(A<0)b.push(y.next());else if(A>0)b.push(y.next(A));else{if(h(b,y.next(1).attributes||{},S)===!1)return;S+=1,b=new d}}b.length()>0&&h(b,{},S)}invert(h){const p=new d;return this.reduce((y,b)=>{if(b.insert)p.delete(o.default.length(b));else{if(typeof b.retain=="number"&&b.attributes==null)return p.retain(b.retain),y+b.retain;if(b.delete||typeof b.retain=="number"){const S=b.delete||b.retain;return h.slice(y,y+S).forEach(x=>{b.delete?p.push(x):b.retain&&b.attributes&&p.retain(o.default.length(x),i.default.invert(b.attributes,x.attributes))}),y+S}else if(typeof b.retain=="object"&&b.retain!==null){const S=h.slice(y,y+1),C=new a.default(S.ops).next(),[x,A,O]=u(b.retain,C.insert),$=d.getHandler(x);return p.retain({[x]:$.invert(A,O)},i.default.invert(b.attributes,C.attributes)),y+1}}return y},0),p.chop()}transform(h,p=!1){if(p=!!p,typeof h=="number")return this.transformPosition(h,p);const y=h,b=new a.default(this.ops),S=new a.default(y.ops),C=new d;for(;b.hasNext()||S.hasNext();)if(b.peekType()==="insert"&&(p||S.peekType()!=="insert"))C.retain(o.default.length(b.next()));else if(S.peekType()==="insert")C.push(S.next());else{const x=Math.min(b.peekLength(),S.peekLength()),A=b.next(x),O=S.next(x);if(A.delete)continue;if(O.delete)C.push(O);else{const $=A.retain,L=O.retain;let H=typeof L=="object"&&L!==null?L:x;if(typeof $=="object"&&$!==null&&typeof L=="object"&&L!==null){const q=Object.keys($)[0];if(q===Object.keys(L)[0]){const F=d.getHandler(q);F&&(H={[q]:F.transform($[q],L[q],p)})}}C.retain(H,i.default.transform(A.attributes,O.attributes,p))}}return C.chop()}transformPosition(h,p=!1){p=!!p;const y=new a.default(this.ops);let b=0;for(;y.hasNext()&&b<=h;){const S=y.peekLength(),C=y.peekType();if(y.next(),C==="delete"){h-=Math.min(S,h-b);continue}else C==="insert"&&(b<h||!p)&&(h+=S);b+=S}return h}}d.Op=o.default,d.OpIterator=a.default,d.AttributeMap=i.default,d.handlers={},e.default=d,t.exports=d,t.exports.default=d}(Hs,Hs.exports)),Hs.exports}var wg=vg();const zn=qf(wg);var xg=Object.getOwnPropertyNames,Cg=Object.getOwnPropertySymbols,Sg=Object.prototype.hasOwnProperty;function Fl(t,e){return function(n,s,i){return t(n,s,i)&&e(n,s,i)}}function Ks(t){return function(r,n,s){if(!r||!n||typeof r!="object"||typeof n!="object")return t(r,n,s);var i=s.cache,o=i.get(r),a=i.get(n);if(o&&a)return o===n&&a===r;i.set(r,n),i.set(n,r);var l=t(r,n,s);return i.delete(r),i.delete(n),l}}function Ul(t){return xg(t).concat(Cg(t))}var Eg=Object.hasOwn||function(t,e){return Sg.call(t,e)};function Rr(t,e){return t===e||!t&&!e&&t!==t&&e!==e}var Tg="__v",Mg="__o",Ag="_owner",Bl=Object.getOwnPropertyDescriptor,Hl=Object.keys;function Ng(t,e,r){var n=t.length;if(e.length!==n)return!1;for(;n-- >0;)if(!r.equals(t[n],e[n],n,n,t,e,r))return!1;return!0}function Og(t,e){return Rr(t.getTime(),e.getTime())}function jg(t,e){return t.name===e.name&&t.message===e.message&&t.cause===e.cause&&t.stack===e.stack}function Ig(t,e){return t===e}function Wl(t,e,r){var n=t.size;if(n!==e.size)return!1;if(!n)return!0;for(var s=new Array(n),i=t.entries(),o,a,l=0;(o=i.next())&&!o.done;){for(var u=e.entries(),d=!1,f=0;(a=u.next())&&!a.done;){if(s[f]){f++;continue}var h=o.value,p=a.value;if(r.equals(h[0],p[0],l,f,t,e,r)&&r.equals(h[1],p[1],h[0],p[0],t,e,r)){d=s[f]=!0;break}f++}if(!d)return!1;l++}return!0}var Pg=Rr;function Rg(t,e,r){var n=Hl(t),s=n.length;if(Hl(e).length!==s)return!1;for(;s-- >0;)if(!Sd(t,e,r,n[s]))return!1;return!0}function Dn(t,e,r){var n=Ul(t),s=n.length;if(Ul(e).length!==s)return!1;for(var i,o,a;s-- >0;)if(i=n[s],!Sd(t,e,r,i)||(o=Bl(t,i),a=Bl(e,i),(o||a)&&(!o||!a||o.configurable!==a.configurable||o.enumerable!==a.enumerable||o.writable!==a.writable)))return!1;return!0}function $g(t,e){return Rr(t.valueOf(),e.valueOf())}function qg(t,e){return t.source===e.source&&t.flags===e.flags}function zl(t,e,r){var n=t.size;if(n!==e.size)return!1;if(!n)return!0;for(var s=new Array(n),i=t.values(),o,a;(o=i.next())&&!o.done;){for(var l=e.values(),u=!1,d=0;(a=l.next())&&!a.done;){if(!s[d]&&r.equals(o.value,a.value,o.value,a.value,t,e,r)){u=s[d]=!0;break}d++}if(!u)return!1}return!0}function Lg(t,e){var r=t.length;if(e.length!==r)return!1;for(;r-- >0;)if(t[r]!==e[r])return!1;return!0}function Dg(t,e){return t.hostname===e.hostname&&t.pathname===e.pathname&&t.protocol===e.protocol&&t.port===e.port&&t.hash===e.hash&&t.username===e.username&&t.password===e.password}function Sd(t,e,r,n){return(n===Ag||n===Mg||n===Tg)&&(t.$$typeof||e.$$typeof)?!0:Eg(e,n)&&r.equals(t[n],e[n],n,n,t,e,r)}var Fg="[object Arguments]",Ug="[object Boolean]",Bg="[object Date]",Hg="[object Error]",Wg="[object Map]",zg="[object Number]",Jg="[object Object]",Kg="[object RegExp]",Vg="[object Set]",Gg="[object String]",Yg="[object URL]",Xg=Array.isArray,Jl=typeof ArrayBuffer=="function"&&ArrayBuffer.isView?ArrayBuffer.isView:null,Kl=Object.assign,Qg=Object.prototype.toString.call.bind(Object.prototype.toString);function Zg(t){var e=t.areArraysEqual,r=t.areDatesEqual,n=t.areErrorsEqual,s=t.areFunctionsEqual,i=t.areMapsEqual,o=t.areNumbersEqual,a=t.areObjectsEqual,l=t.arePrimitiveWrappersEqual,u=t.areRegExpsEqual,d=t.areSetsEqual,f=t.areTypedArraysEqual,h=t.areUrlsEqual;return function(y,b,S){if(y===b)return!0;if(y==null||b==null)return!1;var C=typeof y;if(C!==typeof b)return!1;if(C!=="object")return C==="number"?o(y,b,S):C==="function"?s(y,b,S):!1;var x=y.constructor;if(x!==b.constructor)return!1;if(x===Object)return a(y,b,S);if(Xg(y))return e(y,b,S);if(Jl!=null&&Jl(y))return f(y,b,S);if(x===Date)return r(y,b,S);if(x===RegExp)return u(y,b,S);if(x===Map)return i(y,b,S);if(x===Set)return d(y,b,S);var A=Qg(y);return A===Bg?r(y,b,S):A===Kg?u(y,b,S):A===Wg?i(y,b,S):A===Vg?d(y,b,S):A===Jg?typeof y.then!="function"&&typeof b.then!="function"&&a(y,b,S):A===Yg?h(y,b,S):A===Hg?n(y,b,S):A===Fg?a(y,b,S):A===Ug||A===zg||A===Gg?l(y,b,S):!1}}function em(t){var e=t.circular,r=t.createCustomConfig,n=t.strict,s={areArraysEqual:n?Dn:Ng,areDatesEqual:Og,areErrorsEqual:jg,areFunctionsEqual:Ig,areMapsEqual:n?Fl(Wl,Dn):Wl,areNumbersEqual:Pg,areObjectsEqual:n?Dn:Rg,arePrimitiveWrappersEqual:$g,areRegExpsEqual:qg,areSetsEqual:n?Fl(zl,Dn):zl,areTypedArraysEqual:n?Dn:Lg,areUrlsEqual:Dg};if(r&&(s=Kl({},s,r(s))),e){var i=Ks(s.areArraysEqual),o=Ks(s.areMapsEqual),a=Ks(s.areObjectsEqual),l=Ks(s.areSetsEqual);s=Kl({},s,{areArraysEqual:i,areMapsEqual:o,areObjectsEqual:a,areSetsEqual:l})}return s}function tm(t){return function(e,r,n,s,i,o,a){return t(e,r,a)}}function rm(t){var e=t.circular,r=t.comparator,n=t.createState,s=t.equals,i=t.strict;if(n)return function(l,u){var d=n(),f=d.cache,h=f===void 0?e?new WeakMap:void 0:f,p=d.meta;return r(l,u,{cache:h,equals:s,meta:p,strict:i})};if(e)return function(l,u){return r(l,u,{cache:new WeakMap,equals:s,meta:void 0,strict:i})};var o={cache:void 0,equals:s,meta:void 0,strict:i};return function(l,u){return r(l,u,o)}}var Bt=hr();hr({strict:!0});hr({circular:!0});hr({circular:!0,strict:!0});hr({createInternalComparator:function(){return Rr}});hr({strict:!0,createInternalComparator:function(){return Rr}});hr({circular:!0,createInternalComparator:function(){return Rr}});hr({circular:!0,createInternalComparator:function(){return Rr},strict:!0});function hr(t){t===void 0&&(t={});var e=t.circular,r=e===void 0?!1:e,n=t.createInternalComparator,s=t.createState,i=t.strict,o=i===void 0?!1:i,a=em(t),l=Zg(a),u=n?n(l):tm(l);return rm({circular:r,comparator:l,createState:s,equals:u,strict:o})}const nm=new Set(["http:","https:","mailto:","sms:","tel:"]);let Ed=class Td extends ur{static getType(){return"link"}static clone(e){return new Td(e.__url,{rel:e.__rel,target:e.__target,title:e.__title},e.__key)}constructor(e="",r={},n){super(n);const{target:s=null,rel:i=null,title:o=null}=r;this.__url=e,this.__target=s,this.__rel=i,this.__title=o}createDOM(e){const r=document.createElement("a");return this.updateLinkDOM(null,r,e),nr(r,e.theme.link),r}updateLinkDOM(e,r,n){if(rd(r)){e&&e.__url===this.__url||(r.href=this.sanitizeUrl(this.__url));for(const s of["target","rel","title"]){const i=`__${s}`,o=this[i];e&&e[i]===o||(o?r[s]=o:r.removeAttribute(s))}}}updateDOM(e,r,n){return this.updateLinkDOM(e,r,n),!1}static importDOM(){return{a:e=>({conversion:sm,priority:1})}}static importJSON(e){return ia().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setURL(e.url).setRel(e.rel||null).setTarget(e.target||null).setTitle(e.title||null)}sanitizeUrl(e){e=Vl(e);try{const r=new URL(Vl(e));if(!nm.has(r.protocol))return"about:blank"}catch{return e}return e}exportJSON(){return{...super.exportJSON(),rel:this.getRel(),target:this.getTarget(),title:this.getTitle(),url:this.getURL()}}getURL(){return this.getLatest().__url}setURL(e){const r=this.getWritable();return r.__url=e,r}getTarget(){return this.getLatest().__target}setTarget(e){const r=this.getWritable();return r.__target=e,r}getRel(){return this.getLatest().__rel}setRel(e){const r=this.getWritable();return r.__rel=e,r}getTitle(){return this.getLatest().__title}setTitle(e){const r=this.getWritable();return r.__title=e,r}insertNewAfter(e,r=!0){const n=ia(this.__url,{rel:this.__rel,target:this.__target,title:this.__title});return this.insertAfter(n,r),n}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}canBeEmpty(){return!1}isInline(){return!0}extractWithChild(e,r,n){if(!X(r))return!1;const s=r.anchor.getNode(),i=r.focus.getNode();return this.isParentOf(s)&&this.isParentOf(i)&&r.getTextContent().length>0}isEmailURI(){return this.__url.startsWith("mailto:")}isWebSiteURI(){return this.__url.startsWith("https://")||this.__url.startsWith("http://")}};function sm(t){let e=null;if(rd(t)){const r=t.textContent;(r!==null&&r!==""||t.children.length>0)&&(e=ia(t.getAttribute("href")||"",{rel:t.getAttribute("rel"),target:t.getAttribute("target"),title:t.getAttribute("title")}))}return{node:e}}function ia(t="",e){return Oe(new Ed(t,e))}function im(t){return t instanceof Ed}const om=/^\+?[0-9\s()-]{5,}$/;function Vl(t){return t.match(/^[a-z][a-z0-9+.-]*:/i)||t.match(/^[/#.]/)?t:t.includes("@")?`mailto:${t}`:om.test(t)?`tel:${t}`:`https://${t}`}const Md=[];let Ad=class Nd extends ur{static getType(){return"mark"}static clone(e){return new Nd(e.__ids,e.__key)}static importDOM(){return null}static importJSON(e){return Gl().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setIDs(e.ids)}exportJSON(){return{...super.exportJSON(),ids:this.getIDs()}}constructor(e=Md,r){super(r),this.__ids=e}createDOM(e){const r=document.createElement("mark");return nr(r,e.theme.mark),this.__ids.length>1&&nr(r,e.theme.markOverlap),r}updateDOM(e,r,n){const s=e.__ids,i=this.__ids,o=s.length,a=i.length,l=n.theme.markOverlap;return o!==a&&(o===1?a===2&&nr(r,l):a===1&&ra(r,l)),!1}hasID(e){return this.getIDs().includes(e)}getIDs(){return Array.from(this.getLatest().__ids)}setIDs(e){const r=this.getWritable();return r.__ids=e,r}addID(e){const r=this.getWritable();return r.__ids.includes(e)?r:r.setIDs([...r.__ids,e])}deleteID(e){const r=this.getWritable(),n=r.__ids.indexOf(e);if(n===-1)return r;const s=Array.from(r.__ids);return s.splice(n,1),r.setIDs(s)}insertNewAfter(e,r=!0){const n=Gl(this.__ids);return this.insertAfter(n,r),n}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}canBeEmpty(){return!1}isInline(){return!0}extractWithChild(e,r,n){if(!X(r)||n==="html")return!1;const s=r.anchor,i=r.focus,o=s.getNode(),a=i.getNode(),l=r.isBackward()?s.offset-i.offset:i.offset-s.offset;return this.isParentOf(o)&&this.isParentOf(a)&&this.getTextContent().length===l}excludeFromCopy(e){return e!=="clone"}};function Gl(t=Md){return Oe(new Ad(t))}function am(t){return t instanceof Ad}const Od=Object.freeze({"	":"\\t","\n":"\\n"}),Yl=new RegExp(Object.keys(Od).join("|"),"g"),Et=Object.freeze({ancestorHasNextSibling:"|",ancestorIsLastChild:" ",hasNextSibling:"",isLastChild:"",selectedChar:"^",selectedLine:">"}),lm=[t=>t.hasFormat("bold")&&"Bold",t=>t.hasFormat("code")&&"Code",t=>t.hasFormat("italic")&&"Italic",t=>t.hasFormat("strikethrough")&&"Strikethrough",t=>t.hasFormat("subscript")&&"Subscript",t=>t.hasFormat("superscript")&&"Superscript",t=>t.hasFormat("underline")&&"Underline",t=>t.hasFormat("highlight")&&"Highlight"],cm=[t=>t.hasTextFormat("bold")&&"Bold",t=>t.hasTextFormat("code")&&"Code",t=>t.hasTextFormat("italic")&&"Italic",t=>t.hasTextFormat("strikethrough")&&"Strikethrough",t=>t.hasTextFormat("subscript")&&"Subscript",t=>t.hasTextFormat("superscript")&&"Superscript",t=>t.hasTextFormat("underline")&&"Underline",t=>t.hasTextFormat("highlight")&&"Highlight"],um=[t=>t.isDirectionless()&&"Directionless",t=>t.isUnmergeable()&&"Unmergeable"],dm=[t=>t.isToken()&&"Token",t=>t.isSegmented()&&"Segmented"];function hm(t,e,r,n,s=!1){const i=t.getEditorState(),o=t._config,a=t._compositionKey,l=t._editable;if(r){let h="";return i.read(()=>{h=function(p){const y=document.createElement("div");return y.innerHTML=p.trim(),Id(y,0).innerHTML}(Bf(t))}),h}let u=` root
`;const d=i.read(()=>{const h=ne();return jd(Pt(),(p,y)=>{const b=`(${p.getKey()})`,S=p.getType()||"",C=p.isSelected();u+=`${C?Et.selectedLine:" "} ${y.join(" ")} ${b} ${S} ${function(x,A,O=!1){const $=A?A(x,O):void 0;if($!==void 0&&$.length>0)return $;if(ee(x)){const L=x.getTextContent(),H=L.length===0?"(empty)":`"${Xl(L,O)}"`,q=function(F){return[Ql(F),fm(F),pm(F),Zl(F)].filter(Boolean).join(", ")}(x);return[H,q.length!==0?`{ ${q} }`:null].filter(Boolean).join(" ").trim()}if(im(x)){const L=x.getURL(),H=L.length===0?"(empty)":`"${Xl(L,O)}"`,q=function(F){return[gm(F),mm(F),ym(F),Zl(F)].filter(Boolean).join(", ")}(x);return[H,q.length!==0?`{ ${q} }`:null].filter(Boolean).join(" ").trim()}if(am(x))return`ids: [ ${x.getIDs().join(", ")} ]`;if(Wf(x)){const L=function(q){let F=cm.map(W=>W(q)).filter(Boolean).join(", ").toLocaleLowerCase();return F!==""&&(F="format: "+F),F}(x);let H=L!==""?`{ ${L} }`:"";return H+=x.__style?`(${x.__style})`:"",H}return""}(p,n,s)}
`,u+=function({indent:x,isSelected:A,node:O,nodeKeyDisplay:$,selection:L,typeDisplay:H}){if(!ee(O)||!X(L)||!A||ve(O))return"";const q=L.anchor,F=L.focus;if(O.getTextContent()===""||q.getNode()===L.focus.getNode()&&q.offset===F.offset)return"";const[W,k]=function(D,U){const B=U.getStartEndPoints();if(Sl(U)||B===null)return[-1,-1];const[V,J]=B,Y=D.getTextContent(),re=Y.length;let K=-1,de=-1;if(V.type==="text"&&J.type==="text"){const se=V.getNode(),ie=J.getNode();se===ie&&D===se&&V.offset!==J.offset?[K,de]=V.offset<J.offset?[V.offset,J.offset]:[J.offset,V.offset]:[K,de]=D===se?se.isBefore(ie)?[V.offset,re]:[0,V.offset]:D===ie?ie.isBefore(se)?[J.offset,re]:[0,J.offset]:[0,re]}const ye=(Y.slice(0,K).match(Yl)||[]).length,te=(Y.slice(K,de).match(Yl)||[]).length;return[K+ye,de+ye+te]}(O,L);if(W===k)return"";const M=x[x.length-1]===Et.hasNextSibling?Et.ancestorHasNextSibling:Et.ancestorIsLastChild,v=[...x.slice(0,x.length-1),M],N=Array(W+1).fill(" "),P=Array(k-W).fill(Et.selectedChar),j=H.length+2,R=Array($.length+j).fill(" ");return[Et.selectedLine,v.join(" "),[...R,...N,...P].join("")].join(" ")+`
`}({indent:y,isSelected:C,node:p,nodeKeyDisplay:b,selection:h,typeDisplay:S})}),h===null?": null":X(h)?function(p){let y="";const b=Ql(p);y+=`: range ${b!==""?`{ ${b} }`:""} ${p.style!==""?`{ style: ${p.style} } `:""}`;const S=p.anchor,C=p.focus,x=S.offset,A=C.offset;return y+=`
   anchor { key: ${S.key}, offset: ${x===null?"null":x}, type: ${S.type} }`,y+=`
   focus { key: ${C.key}, offset: ${A===null?"null":A}, type: ${C.type} }`,y}(h):Hf(h)?function(p){return`: table
   { table: ${p.tableKey}, anchorCell: ${p.anchor.key}, focusCell: ${p.focus.key} }`}(h):function(p){return Sl(p)?`: node
   [${Array.from(p._nodes).join(", ")}]`:""}(h)});if(u+=`
 selection`+d,u+=`

 commands:`,e.length)for(const{index:h,type:p,payload:y}of e)u+=`
   ${h}. { type: ${p}, payload: ${y instanceof Event?y.constructor.name:y} }`;else u+=`
   None dispatched.`;const{version:f}=t.constructor;return u+=`

 editor${f?` (v${f})`:""}:`,u+=`
   namespace ${o.namespace}`,a!==null&&(u+=`
   compositionKey ${a}`),u+=`
   editable ${String(l)}`,u}function jd(t,e,r=[]){const n=t.getChildren(),s=n.length;n.forEach((i,o)=>{e(i,r.concat(o===s-1?Et.isLastChild:Et.hasNextSibling)),ve(i)&&jd(i,e,r.concat(o===s-1?Et.ancestorIsLastChild:Et.ancestorHasNextSibling))})}function Xl(t,e=!1){const r=Object.entries(Od).reduce((n,[s,i])=>n.replace(new RegExp(s,"g"),String(i)),t);return e?r.replace(/[^\s]/g,"*"):r}function fm(t){let e=um.map(r=>r(t)).filter(Boolean).join(", ").toLocaleLowerCase();return e!==""&&(e="detail: "+e),e}function pm(t){let e=dm.map(r=>r(t)).filter(Boolean).join(", ").toLocaleLowerCase();return e!==""&&(e="mode: "+e),e}function Ql(t){let e=lm.map(r=>r(t)).filter(Boolean).join(", ").toLocaleLowerCase();return e!==""&&(e="format: "+e),e}function gm(t){let e=t.getTarget();return e!=null&&(e="target: "+e),e}function mm(t){let e=t.getRel();return e!=null&&(e="rel: "+e),e}function ym(t){let e=t.getTitle();return e!=null&&(e="title: "+e),e}function Zl(t){if(!t.__state)return!1;const e=[];for(const[n,s]of t.__state.knownState.entries()){if(n.isEqual(s,n.defaultValue))continue;const i=JSON.stringify(n.unparse(s));e.push(`[${n.key}: ${i}]`)}let r=e.join(",");return r!==""&&(r="state: "+r),r}function Id(t,e){const r=new Array(1+e++).join("  "),n=new Array(e-1).join("  ");let s;for(let i=0;i<t.children.length;i++)s=document.createTextNode(`
`+r),t.insertBefore(s,t.children[i]),Id(t.children[i],e),t.lastElementChild===t.children[i]&&(s=document.createTextNode(`
`+n),t.appendChild(s));return t}const bm=_.forwardRef(function({treeTypeButtonClassName:t,timeTravelButtonClassName:e,timeTravelPanelSliderClassName:r,timeTravelPanelButtonClassName:n,viewClassName:s,timeTravelPanelClassName:i,editorState:o,setEditorState:a,setEditorReadOnly:l,generateContent:u,commandsLog:d=[]},f){const[h,p]=_.useState([]),[y,b]=_.useState(""),[S,C]=_.useState(!1),[x,A]=_.useState(!1),O=_.useRef(0),$=_.useRef(null),[L,H]=_.useState(!1),[q,F]=_.useState(!1),[W,k]=_.useState(!1),M=_.useRef(),v=_.useRef([]),N=_.useRef(0),P=_.useCallback(R=>{const D=++N.current;u(R).then(U=>{D===N.current&&b(U)}).catch(U=>{D===N.current&&b(`Error rendering tree: ${U.message}

Stack:
${U.stack}`)})},[u]);_.useEffect(()=>{if(!(!W&&o._nodeMap.size>1e3&&(F(!0),!W))&&(M.current!==o||v.current!==d)){const R=M.current!==o;M.current=o,v.current=d,P(x),!S&&R&&p(D=>[...D,[Date.now(),o]])}},[o,P,x,W,S,d]);const j=h.length;return _.useEffect(()=>{if(L){let R;const D=()=>{const U=O.current;if(U===j-1)return void H(!1);const B=h[U][0],V=h[U+1][0];R=setTimeout(()=>{O.current++;const J=O.current,Y=$.current;Y!==null&&(Y.value=String(J)),a(h[J][1]),D()},V-B)};return D(),()=>{clearTimeout(R)}}},[h,L,j,a]),m.jsxs("div",{className:s,children:[!W&&q?m.jsxs("div",{style:{padding:20},children:[m.jsx("span",{style:{marginRight:20},children:"Detected large EditorState, this can impact debugging performance."}),m.jsx("button",{onClick:()=>{k(!0)},style:{background:"transparent",border:"1px solid white",color:"white",cursor:"pointer",padding:5},children:"Show full tree"})]}):null,W?null:m.jsx("button",{onClick:()=>(P(!x),void A(!x)),className:t,type:"button",children:x?"Tree":"Export DOM"}),!S&&(W||!q)&&j>2&&m.jsx("button",{onClick:()=>{l(!0),O.current=j-1,C(!0)},className:e,type:"button",children:"Time Travel"}),(W||!q)&&m.jsx("pre",{ref:f,children:y}),S&&(W||!q)&&m.jsxs("div",{className:i,children:[m.jsx("button",{className:n,onClick:()=>{O.current===j-1&&(O.current=1),H(!L)},type:"button",children:L?"Pause":"Play"}),m.jsx("input",{className:r,ref:$,onChange:R=>{const D=Number(R.target.value),U=h[D];U&&(O.current=D,a(U[1]))},type:"range",min:"1",max:j-1}),m.jsx("button",{className:n,onClick:()=>{l(!1);const R=h.length-1,D=h[R];a(D[1]);const U=$.current;U!==null&&(U.value=String(R)),C(!1),H(!1)},type:"button",children:"Exit"})]})]})});function _m(t,e){const r=new Set;let n=0;for(const[s]of t._commands)r.add(t.registerCommand(s,i=>(e(o=>{n+=1;const a=[...o];return a.push({index:n,payload:i,type:s.type?s.type:"UNKNOWN"}),a.length>10&&a.shift(),a}),!1),Kn));return()=>r.forEach(s=>s())}function km(t){const[e,r]=_.useState([]);return _.useEffect(()=>_m(t,r),[t]),_.useMemo(()=>e,[e])}function vm({treeTypeButtonClassName:t,timeTravelButtonClassName:e,timeTravelPanelSliderClassName:r,timeTravelPanelButtonClassName:n,timeTravelPanelClassName:s,viewClassName:i,editor:o,customPrintNode:a}){const l=_.createRef(),[u,d]=_.useState(o.getEditorState()),f=km(o);return _.useEffect(()=>Xe(o.registerUpdateListener(({editorState:h})=>{d(h)}),o.registerEditableListener(()=>{d(o.getEditorState())})),[o]),_.useEffect(()=>{const h=l.current;if(h!==null)return h.__lexicalEditor=o,()=>{h.__lexicalEditor=null}},[o,l]),m.jsx(bm,{treeTypeButtonClassName:t,timeTravelButtonClassName:e,timeTravelPanelSliderClassName:r,timeTravelPanelButtonClassName:n,viewClassName:i,timeTravelPanelClassName:s,setEditorReadOnly:h=>{const p=o.getRootElement();p!=null&&(p.contentEditable=h?"false":"true")},editorState:u,setEditorState:h=>o.setEditorState(h),generateContent:async function(h){return hm(o,f,h,a)},ref:l,commandsLog:f})}function Pd({editorRef:t}){const[e]=ue();return _.useEffect(()=>{typeof t=="function"?t(e):typeof t=="object"&&(t.current=e)},[e]),null}const Vs=0,oa=1,aa=2,ft=0,wm=1,ec=2,xm=3,Cm=4;function Sm(t,e,r,n,s){if(t===null||r.size===0&&n.size===0&&!s)return ft;const i=e._selection,o=t._selection;if(s)return wm;if(!(X(i)&&X(o)&&o.isCollapsed()&&i.isCollapsed()))return ft;const a=function(C,x,A){const O=C._nodeMap,$=[];for(const L of x){const H=O.get(L);H!==void 0&&$.push(H)}for(const[L,H]of A){if(!H)continue;const q=O.get(L);q===void 0||Jf(q)||$.push(q)}return $}(e,r,n);if(a.length===0)return ft;if(a.length>1){const C=e._nodeMap,x=C.get(i.anchor.key),A=C.get(o.anchor.key);return x&&A&&!t._nodeMap.has(x.__key)&&ee(x)&&x.__text.length===1&&i.anchor.offset===1?ec:ft}const l=a[0],u=t._nodeMap.get(l.__key);if(!ee(u)||!ee(l)||u.__mode!==l.__mode)return ft;const d=u.__text,f=l.__text;if(d===f)return ft;const h=i.anchor,p=o.anchor;if(h.key!==p.key||h.type!=="text")return ft;const y=h.offset,b=p.offset,S=f.length-d.length;return S===1&&b===y-1?ec:S===-1&&b===y+1?xm:S===-1&&b===y?Cm:ft}function Em(t,e){let r=Date.now(),n=ft;return(s,i,o,a,l,u)=>{const d=Date.now();if(u.has(na))return n=ft,r=d,aa;const f=Sm(s,i,a,l,t.isComposing()),h=(()=>{const p=o===null||o.editor===t,y=u.has(zf);if(!y&&p&&u.has(id))return Vs;if(s===null)return oa;const b=i._selection;return a.size>0||l.size>0?y===!1&&f!==ft&&f===n&&d<r+e&&p||a.size===1&&function(S,C,x){const A=C._nodeMap.get(S),O=x._nodeMap.get(S),$=C._selection,L=x._selection;return!(X($)&&X(L)&&$.anchor.type==="element"&&$.focus.type==="element"&&L.anchor.type==="text"&&L.focus.type==="text"||!ee(A)||!ee(O)||A.__parent!==O.__parent)&&JSON.stringify(C.read(()=>A.exportJSON()))===JSON.stringify(x.read(()=>O.exportJSON()))}(Array.from(a)[0],s,i)?Vs:oa:b!==null?Vs:aa})();return r=d,n=f,h}}function tc(t){t.undoStack=[],t.redoStack=[],t.current=null}function Tm(t,e,r){const n=Em(t,r);return Xe(t.registerCommand($a,()=>(function(i,o){const a=o.redoStack,l=o.undoStack;if(l.length!==0){const u=o.current,d=l.pop();u!==null&&(a.push(u),i.dispatchCommand(Un,!0)),l.length===0&&i.dispatchCommand(Bn,!1),o.current=d||null,d&&d.editor.setEditorState(d.editorState,{tag:na})}}(t,e),!0),xe),t.registerCommand(Ra,()=>(function(i,o){const a=o.redoStack,l=o.undoStack;if(a.length!==0){const u=o.current;u!==null&&(l.push(u),i.dispatchCommand(Bn,!0));const d=a.pop();a.length===0&&i.dispatchCommand(Un,!1),o.current=d||null,d&&d.editor.setEditorState(d.editorState,{tag:na})}}(t,e),!0),xe),t.registerCommand(sd,()=>(tc(e),!1),xe),t.registerCommand(nd,()=>(tc(e),t.dispatchCommand(Un,!1),t.dispatchCommand(Bn,!1),!0),xe),t.registerUpdateListener(({editorState:i,prevEditorState:o,dirtyLeaves:a,dirtyElements:l,tags:u})=>{const d=e.current,f=e.redoStack,h=e.undoStack,p=d===null?null:d.editorState;if(d!==null&&i===p)return;const y=n(o,i,d,a,l,u);if(y===oa)f.length!==0&&(e.redoStack=[],t.dispatchCommand(Un,!1)),d!==null&&(h.push({...d}),t.dispatchCommand(Bn,!0));else if(y===aa)return;e.current={editor:t,editorState:i}}))}function Mm(){return{current:null,redoStack:[],undoStack:[]}}function Rd({delay:t,externalHistoryState:e}){const[r]=ue();return function(n,s,i=1e3){const o=_.useMemo(()=>s||Mm(),[s]);_.useEffect(()=>Tm(n,o,i),[i,n,o])}(r,e,t),null}const la=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,Am=la?_.useLayoutEffect:_.useEffect;let Nm=class{constructor(e){this.key=e,this.ref={current:null},this.setRefElement=this.setRefElement.bind(this)}setRefElement(e){this.ref={current:e}}};const rc=t=>{const e=document.getElementById("typeahead-menu");if(!e)return;const r=e.getBoundingClientRect();r.top+r.height>window.innerHeight&&e.scrollIntoView({block:"center"}),r.top<0&&e.scrollIntoView({block:"center"}),t.scrollIntoView({block:"nearest"})};function nc(t,e){const r=t.getBoundingClientRect(),n=e.getBoundingClientRect();return r.top>n.top&&r.top<n.bottom}function Om(t,e,r,n){const[s]=ue();_.useEffect(()=>{if(e!=null&&t!=null){const i=s.getRootElement(),o=i!=null?function(f,h){let p=getComputedStyle(f);const y=p.position==="absolute",b=/(auto|scroll)/;if(p.position==="fixed")return document.body;for(let S=f;S=S.parentElement;)if(p=getComputedStyle(S),(!y||p.position!=="static")&&b.test(p.overflow+p.overflowY+p.overflowX))return S;return document.body}(i):document.body;let a=!1,l=nc(e,o);const u=function(){a||(window.requestAnimationFrame(function(){r(),a=!1}),a=!0);const f=nc(e,o);f!==l&&(l=f,n!=null&&n(f))},d=new ResizeObserver(r);return window.addEventListener("resize",r),document.addEventListener("scroll",u,{capture:!0,passive:!0}),d.observe(e),()=>{d.unobserve(e),window.removeEventListener("resize",r),document.removeEventListener("scroll",u,!0)}}},[e,s,n,r,t])}const sc=qa("SCROLL_TYPEAHEAD_OPTION_INTO_VIEW_COMMAND");function jm({close:t,editor:e,anchorElementRef:r,resolution:n,options:s,menuRenderFn:i,onSelectOption:o,shouldSplitNodeWithQuery:a=!1,commandPriority:l=Pr,preselectFirstItem:u=!0}){const[d,f]=_.useState(null),h=n.match&&n.match.matchingString;_.useEffect(()=>{u&&f(0)},[h,u]);const p=_.useCallback(b=>{e.update(()=>{const S=n.match!=null&&a?function(C){const x=ne();if(!X(x)||!x.isCollapsed())return null;const A=x.anchor;if(A.type!=="text")return null;const O=A.getNode();if(!O.isSimpleText())return null;const $=A.offset,L=O.getTextContent().slice(0,$),H=C.replaceableString.length,q=$-function(W,k,M){let v=M;for(let N=v;N<=k.length;N++)W.slice(-N)===k.substring(0,N)&&(v=N);return v}(L,C.matchingString,H);if(q<0)return null;let F;return q===0?[F]=O.splitText($):[,F]=O.splitText(q,$),F}(n.match):null;o(b,S,t,n.match?n.match.matchingString:"")})},[e,a,n.match,o,t]),y=_.useCallback(b=>{const S=e.getRootElement();S!==null&&(S.setAttribute("aria-activedescendant","typeahead-item-"+b),f(b))},[e]);return _.useEffect(()=>()=>{const b=e.getRootElement();b!==null&&b.removeAttribute("aria-activedescendant")},[e]),Am(()=>{s===null?f(null):d===null&&u&&y(0)},[s,d,y,u]),_.useEffect(()=>Xe(e.registerCommand(sc,({option:b})=>!(!b.ref||b.ref.current==null)&&(rc(b.ref.current),!0),l)),[e,y,l]),_.useEffect(()=>Xe(e.registerCommand(Xf,b=>{const S=b;if(s!==null&&s.length){const C=d===null?0:d!==s.length-1?d+1:0;y(C);const x=s[C];x.ref!=null&&x.ref.current&&e.dispatchCommand(sc,{index:C,option:x}),S.preventDefault(),S.stopImmediatePropagation()}return!0},l),e.registerCommand(Yf,b=>{const S=b;if(s!==null&&s.length){const C=d===null?s.length-1:d!==0?d-1:s.length-1;y(C);const x=s[C];x.ref!=null&&x.ref.current&&rc(x.ref.current),S.preventDefault(),S.stopImmediatePropagation()}return!0},l),e.registerCommand(ad,b=>{const S=b;return S.preventDefault(),S.stopImmediatePropagation(),t(),!0},l),e.registerCommand(Gf,b=>{const S=b;return s!==null&&d!==null&&s[d]!=null&&(S.preventDefault(),S.stopImmediatePropagation(),p(s[d]),!0)},l),e.registerCommand(od,b=>s!==null&&d!==null&&s[d]!=null&&(b!==null&&(b.preventDefault(),b.stopImmediatePropagation()),p(s[d]),!0),l)),[p,t,e,s,d,y,l]),i(r,_.useMemo(()=>({options:s,selectOptionAndCleanUp:p,selectedIndex:d,setHighlightedIndex:f}),[p,d,s]),n.match?n.match.matchingString:"")}function ic(t,e){e!=null&&(t.className=e),t.setAttribute("aria-label","Typeahead menu"),t.setAttribute("role","listbox"),t.style.display="block",t.style.position="absolute"}function Im({options:t,onWillOpen:e,onClose:r,onOpen:n,onSelectOption:s,menuRenderFn:i,anchorClassName:o,commandPriority:a=Pr,parent:l}){const[u]=ue(),[d,f]=_.useState(null),h=_.useRef(null),p=function(x,A,O,$=la?document.body:void 0,L=!0){const[H]=ue(),q=la?document.createElement("div"):null,F=_.useRef(q),W=_.useCallback(()=>{if(F.current===null||$===void 0)return;F.current.style.top=F.current.style.bottom;const M=H.getRootElement(),v=F.current,N=v.firstChild;if(M!==null&&x!==null){const{left:P,top:j,width:R,height:D}=x.getRect(),U=F.current.offsetHeight;if(v.style.top=`${j+U+3+(L?window.pageYOffset:0)}px`,v.style.left=`${P+window.pageXOffset}px`,v.style.height=`${D}px`,v.style.width=`${R}px`,N!==null){N.style.top=`${j}`;const B=N.getBoundingClientRect(),V=B.height,J=B.width,Y=M.getBoundingClientRect();P+J>Y.right&&(v.style.left=`${Y.right-J+window.pageXOffset}px`),(j+V>window.innerHeight||j+V>Y.bottom)&&j-Y.top>V+D&&(v.style.top=`${j-V-D+(L?window.pageYOffset:0)}px`)}v.isConnected||(ic(v,O),$.append(v)),v.setAttribute("id","typeahead-menu"),M.setAttribute("aria-controls","typeahead-menu")}},[H,x,L,O,$]);_.useEffect(()=>{const M=H.getRootElement();return x!==null&&W(),()=>{M!==null&&M.removeAttribute("aria-controls");const v=F.current;v!==null&&v.isConnected&&(v.remove(),v.removeAttribute("id"))}},[H,W,x]);const k=_.useCallback(M=>{x!==null&&(M||A(null))},[x,A]);return Om(x,F.current,W,k),q!=null&&q===F.current&&(ic(q,O),$!=null&&$.append(q)),F}(d,f,o,l),y=_.useCallback(()=>{f(null),r!=null&&d!==null&&r()},[r,d]),b=_.useCallback(x=>{f(x),n!=null&&d===null&&n(x)},[n,d]),S=_.useCallback(x=>{x.preventDefault(),e!=null&&e(x);const A=Kf(x.target);b({getRect:()=>new DOMRect(x.clientX/A,x.clientY/A,1,1)})},[b,e]),C=_.useCallback(x=>{d!==null&&h.current!=null&&x.target!=null&&Vf(x.target)&&!h.current.contains(x.target)&&y()},[y,d]);return _.useEffect(()=>{const x=u.getRootElement();if(x)return x.addEventListener("contextmenu",S),()=>x.removeEventListener("contextmenu",S)},[u,S]),_.useEffect(()=>(document.addEventListener("click",C),()=>document.removeEventListener("click",C)),[u,C]),p.current===null||d===null||u===null?null:m.jsx(jm,{close:y,resolution:d,editor:u,anchorElementRef:p,options:t,menuRenderFn:(x,A)=>i(x,A,{setMenuRef:O=>{h.current=O}}),onSelectOption:s,commandPriority:a})}const oc=[["Cat","rgb(125, 50, 0)"],["Dog","rgb(100, 0, 0)"],["Rabbit","rgb(150, 0, 0)"],["Frog","rgb(200, 0, 0)"],["Fox","rgb(200, 75, 0)"],["Hedgehog","rgb(0, 75, 0)"],["Pigeon","rgb(0, 125, 0)"],["Squirrel","rgb(75, 100, 0)"],["Bear","rgb(125, 100, 0)"],["Tiger","rgb(0, 0, 150)"],["Leopard","rgb(0, 0, 200)"],["Zebra","rgb(0, 0, 250)"],["Wolf","rgb(0, 100, 150)"],["Owl","rgb(0, 100, 100)"],["Gull","rgb(100, 0, 100)"],["Squid","rgb(150, 0, 150)"]],ac=oc[Math.floor(Math.random()*oc.length)],Pm=_.createContext({clientID:0,color:ac[1],isCollabActive:!1,name:ac[0],yjsDocMap:new Map});function $d(t,e){return _.useContext(Pm)}const gn=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,Rm=gn&&"documentMode"in document?document.documentMode:null,$m=!(!gn||!("InputEvent"in window)||Rm)&&"getTargetRanges"in new window.InputEvent("input"),qm=gn&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent),lc=gn&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,Lm=gn&&/^(?=.*Chrome).*/i.test(navigator.userAgent),Dm=gn&&/AppleWebKit\/[\d.]+/.test(navigator.userAgent)&&!Lm;function cc(t,e){e.update(()=>{if(t!==null){const r=cd(t,KeyboardEvent)?null:t.clipboardData,n=ne();if(n!==null&&r!=null){t.preventDefault();const s=dp(e);s!==null&&r.setData("text/html",s),r.setData("text/plain",n.getTextContent())}}})}function Fm(t){return Xe(t.registerCommand($o,e=>{const r=ne();return!!X(r)&&(r.deleteCharacter(e),!0)},xe),t.registerCommand(up,e=>{const r=ne();return!!X(r)&&(r.deleteWord(e),!0)},xe),t.registerCommand(cp,e=>{const r=ne();return!!X(r)&&(r.deleteLine(e),!0)},xe),t.registerCommand(lp,e=>{const r=ne();if(!X(r))return!1;if(typeof e=="string")r.insertText(e);else{const n=e.dataTransfer;if(n!=null)El(n,r);else{const s=e.data;s&&r.insertText(s)}}return!0},xe),t.registerCommand(ap,()=>{const e=ne();return!!X(e)&&(e.removeText(),!0)},xe),t.registerCommand(Tl,e=>{const r=ne();return!!X(r)&&(r.insertLineBreak(e),!0)},xe),t.registerCommand(op,()=>{const e=ne();return!!X(e)&&(e.insertLineBreak(),!0)},xe),t.registerCommand(ip,e=>{const r=ne();if(!X(r))return!1;const n=e,s=n.shiftKey;return!!Ml(r,!0)&&(n.preventDefault(),Al(r,s,!0),!0)},xe),t.registerCommand(sp,e=>{const r=ne();if(!X(r))return!1;const n=e,s=n.shiftKey;return!!Ml(r,!1)&&(n.preventDefault(),Al(r,s,!1),!0)},xe),t.registerCommand(np,e=>{const r=ne();return!!X(r)&&(!lc||navigator.language!=="ko-KR")&&(e.preventDefault(),t.dispatchCommand($o,!0))},xe),t.registerCommand(rp,e=>{const r=ne();return!!X(r)&&(e.preventDefault(),t.dispatchCommand($o,!1))},xe),t.registerCommand(od,e=>{const r=ne();if(!X(r))return!1;if(e!==null){if((lc||qm||Dm)&&$m)return!1;e.preventDefault()}return t.dispatchCommand(Tl,!1)},xe),t.registerCommand(ep,()=>(tp(),!0),xe),t.registerCommand(Di,e=>{const r=ne();return!!X(r)&&(cc(e,t),!0)},xe),t.registerCommand(Li,e=>{const r=ne();return!!X(r)&&(function(n,s){cc(n,s),s.update(()=>{const i=ne();X(i)&&i.removeText()})}(e,t),!0)},xe),t.registerCommand(qi,e=>{const r=ne();return!!X(r)&&(function(n,s){n.preventDefault(),s.update(()=>{const i=ne(),o=cd(n,ClipboardEvent)?n.clipboardData:null;o!=null&&X(i)&&El(o,i)},{tag:Zf})}(e,t),!0)},xe),t.registerCommand(ld,e=>{const r=ne();return!!X(r)&&(e.preventDefault(),!0)},xe),t.registerCommand(Qf,e=>{const r=ne();return!!X(r)&&(e.preventDefault(),!0)},xe))}const ca=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0?_.useLayoutEffect:_.useEffect;function uc(t){return t.getEditorState().read(pp(t.isComposing()))}function Um({contentEditable:t,placeholder:e=null,ErrorBoundary:r}){const[n]=ue(),s=function(i,o){const[a,l]=_.useState(()=>i.getDecorators());return ca(()=>i.registerDecoratorListener(u=>{gt.flushSync(()=>{l(u)})}),[i]),_.useEffect(()=>{l(i.getDecorators())},[i]),_.useMemo(()=>{const u=[],d=Object.keys(a);for(let f=0;f<d.length;f++){const h=d[f],p=m.jsx(o,{onError:b=>i._onError(b),children:m.jsx(_.Suspense,{fallback:null,children:a[h]})}),y=i.getElementByKey(h);y!==null&&u.push(gt.createPortal(p,y,h))}return u},[o,a,i])}(n,r);return function(i){ca(()=>Xe(Fm(i),hp(i)),[i])}(n),m.jsxs(m.Fragment,{children:[t,m.jsx(Bm,{content:e}),s]})}function Bm({content:t}){const[e]=ue(),r=function(s){const[i,o]=_.useState(()=>uc(s));return ca(()=>{function a(){const l=uc(s);o(l)}return a(),Xe(s.registerUpdateListener(()=>{a()}),s.registerEditableListener(()=>{a()}))},[s]),i}(e),n=fp();return r?typeof t=="function"?t(n):t:null}const At=()=>new Map,ua=t=>{const e=At();return t.forEach((r,n)=>{e.set(n,r)}),e},mn=(t,e,r)=>{let n=t.get(e);return n===void 0&&t.set(e,n=r()),n},Hm=(t,e)=>{const r=[];for(const[n,s]of t)r.push(e(s,n));return r},Wm=(t,e)=>{for(const[r,n]of t)if(e(n,r))return!0;return!1},tn=()=>new Set,Fo=t=>t[t.length-1],rn=Array.from,zm=Array.isArray;class Jm{constructor(){this._observers=At()}on(e,r){return mn(this._observers,e,tn).add(r),r}once(e,r){const n=(...s)=>{this.off(e,n),r(...s)};this.on(e,n)}off(e,r){const n=this._observers.get(e);n!==void 0&&(n.delete(r),n.size===0&&this._observers.delete(e))}emit(e,r){return rn((this._observers.get(e)||At()).values()).forEach(n=>n(...r))}destroy(){this._observers=At()}}const Er=Math.floor,gi=Math.abs,qd=(t,e)=>t<e?t:e,yn=(t,e)=>t>e?t:e,Km=t=>t!==0?t<0:1/t<0,dc=1,hc=2,Uo=4,Bo=8,Vm=32,Ld=64,wi=128,Gm=31,fc=63,Qn=127,Ym=2147483647,Xm=Number.isInteger||(t=>typeof t=="number"&&isFinite(t)&&Er(t)===t),Qm=t=>t.toLowerCase(),Zm=/^\s*/g,ey=t=>t.replace(Zm,""),ty=/([A-Z])/g,pc=(t,e)=>ey(t.replace(ty,r=>`${e}${Qm(r)}`)),ry=t=>{const e=unescape(encodeURIComponent(t)),r=e.length,n=new Uint8Array(r);for(let s=0;s<r;s++)n[s]=e.codePointAt(s);return n},rs=typeof TextEncoder<"u"?new TextEncoder:null,ny=t=>rs.encode(t),sy=rs?ny:ry;let Ho=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Ho&&Ho.decode(new Uint8Array).length===1&&(Ho=null);class ms{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const Ba=()=>new ms,iy=t=>{let e=t.cpos;for(let r=0;r<t.bufs.length;r++)e+=t.bufs[r].length;return e},zt=t=>{const e=new Uint8Array(iy(t));let r=0;for(let n=0;n<t.bufs.length;n++){const s=t.bufs[n];e.set(s,r),r+=s.length}return e.set(new Uint8Array(t.cbuf.buffer,0,t.cpos),r),e},oy=(t,e)=>{const r=t.cbuf.length;r-t.cpos<e&&(t.bufs.push(new Uint8Array(t.cbuf.buffer,0,t.cpos)),t.cbuf=new Uint8Array(yn(r,e)*2),t.cpos=0)},je=(t,e)=>{const r=t.cbuf.length;t.cpos===r&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(r*2),t.cpos=0),t.cbuf[t.cpos++]=e},da=je,be=(t,e)=>{for(;e>Qn;)je(t,wi|Qn&e),e=Er(e/128);je(t,Qn&e)},Ha=(t,e)=>{const r=Km(e);for(r&&(e=-e),je(t,(e>fc?wi:0)|(r?Ld:0)|fc&e),e=Er(e/64);e>0;)je(t,(e>Qn?wi:0)|Qn&e),e=Er(e/128)},ha=new Uint8Array(3e4),ay=ha.length/3,ly=(t,e)=>{if(e.length<ay){const r=rs.encodeInto(e,ha).written||0;be(t,r);for(let n=0;n<r;n++)je(t,ha[n])}else st(t,sy(e))},cy=(t,e)=>{const r=unescape(encodeURIComponent(e)),n=r.length;be(t,n);for(let s=0;s<n;s++)je(t,r.codePointAt(s))},Zr=rs&&rs.encodeInto?ly:cy,Wa=(t,e)=>{const r=t.cbuf.length,n=t.cpos,s=qd(r-n,e.length),i=e.length-s;t.cbuf.set(e.subarray(0,s),n),t.cpos+=s,i>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(yn(r*2,i)),t.cbuf.set(e.subarray(s)),t.cpos=i)},st=(t,e)=>{be(t,e.byteLength),Wa(t,e)},za=(t,e)=>{oy(t,e);const r=new DataView(t.cbuf.buffer,t.cpos,e);return t.cpos+=e,r},uy=(t,e)=>za(t,4).setFloat32(0,e,!1),dy=(t,e)=>za(t,8).setFloat64(0,e,!1),hy=(t,e)=>za(t,8).setBigInt64(0,e,!1),gc=new DataView(new ArrayBuffer(4)),fy=t=>(gc.setFloat32(0,t),gc.getFloat32(0)===t),ns=(t,e)=>{switch(typeof e){case"string":je(t,119),Zr(t,e);break;case"number":Xm(e)&&gi(e)<=Ym?(je(t,125),Ha(t,e)):fy(e)?(je(t,124),uy(t,e)):(je(t,123),dy(t,e));break;case"bigint":je(t,122),hy(t,e);break;case"object":if(e===null)je(t,126);else if(zm(e)){je(t,117),be(t,e.length);for(let r=0;r<e.length;r++)ns(t,e[r])}else if(e instanceof Uint8Array)je(t,116),st(t,e);else{je(t,118);const r=Object.keys(e);be(t,r.length);for(let n=0;n<r.length;n++){const s=r[n];Zr(t,s),ns(t,e[s])}}break;case"boolean":je(t,e?120:121);break;default:je(t,127)}};class mc extends ms{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&be(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const yc=t=>{t.count>0&&(Ha(t.encoder,t.count===1?t.s:-t.s),t.count>1&&be(t.encoder,t.count-2))};class mi{constructor(){this.encoder=new ms,this.s=0,this.count=0}write(e){this.s===e?this.count++:(yc(this),this.count=1,this.s=e)}toUint8Array(){return yc(this),zt(this.encoder)}}const bc=t=>{if(t.count>0){const e=t.diff*2+(t.count===1?0:1);Ha(t.encoder,e),t.count>1&&be(t.encoder,t.count-2)}};class Wo{constructor(){this.encoder=new ms,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(bc(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return bc(this),zt(this.encoder)}}class py{constructor(){this.sarr=[],this.s="",this.lensE=new mi}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new ms;return this.sarr.push(this.s),this.s="",Zr(e,this.sarr.join("")),Wa(e,this.lensE.toUint8Array()),zt(e)}}const nn=t=>new Error(t),Nt=()=>{throw nn("Method unimplemented")},Tr=()=>{throw nn("Unexpected case")},gy=crypto.getRandomValues.bind(crypto),Dd=()=>gy(new Uint32Array(1))[0],my="10000000-1000-4000-8000"+-1e11,yy=()=>my.replace(/[018]/g,t=>(t^Dd()&15>>t/4).toString(16)),_c=t=>new Promise(t);Promise.all.bind(Promise);const kc=t=>t===void 0?null:t;class by{constructor(){this.map=new Map}setItem(e,r){this.map.set(e,r)}getItem(e){return this.map.get(e)}}let Fd=new by,_y=!0;try{typeof localStorage<"u"&&localStorage&&(Fd=localStorage,_y=!1)}catch{}const ky=Fd,vy=Object.assign,wy=Object.keys,xy=(t,e)=>{for(const r in t)e(t[r],r)},vc=t=>wy(t).length,Cy=t=>{for(const e in t)return!1;return!0},Sy=(t,e)=>{for(const r in t)if(!e(t[r],r))return!1;return!0},Ey=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),Ty=(t,e)=>t===e||vc(t)===vc(e)&&Sy(t,(r,n)=>(r!==void 0||Ey(e,n))&&e[n]===r),My=Object.freeze,Ud=t=>{for(const e in t){const r=t[e];(typeof r=="object"||typeof r=="function")&&Ud(t[e])}return My(t)},Ja=(t,e,r=0)=>{try{for(;r<t.length;r++)t[r](...e)}finally{r<t.length&&Ja(t,e,r+1)}},Ay=(t,e)=>e.includes(t);var Bd={};const ss=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";let St;const Ny=()=>{if(St===void 0)if(ss){St=At();const t=process.argv;let e=null;for(let r=0;r<t.length;r++){const n=t[r];n[0]==="-"?(e!==null&&St.set(e,""),e=n):e!==null&&(St.set(e,n),e=null)}e!==null&&St.set(e,"")}else typeof location=="object"?(St=At(),(location.search||"?").slice(1).split("&").forEach(t=>{if(t.length!==0){const[e,r]=t.split("=");St.set(`--${pc(e,"-")}`,r),St.set(`-${pc(e,"-")}`,r)}})):St=At();return St},fa=t=>Ny().has(t),xi=t=>kc(ss?Bd[t.toUpperCase().replaceAll("-","_")]:ky.getItem(t)),Hd=t=>fa("--"+t)||xi(t)!==null;Hd("production");const Oy=ss&&Ay(Bd.FORCE_COLOR,["true","1","2"]),jy=Oy||!fa("--no-colors")&&!Hd("no-color")&&(!ss||process.stdout.isTTY)&&(!ss||fa("--color")||xi("COLORTERM")!==null||(xi("TERM")||"").includes("color"));class Iy{constructor(e,r){this.left=e,this.right=r}}const Ut=(t,e)=>new Iy(t,e);typeof DOMParser<"u"&&new DOMParser;const Py=t=>Hm(t,(e,r)=>`${r}:${e};`).join(""),Gt=Symbol,Wd=Gt(),zd=Gt(),Ry=Gt(),$y=Gt(),qy=Gt(),Jd=Gt(),Ly=Gt(),Ka=Gt(),Dy=Gt(),Fy=t=>{var s;t.length===1&&((s=t[0])==null?void 0:s.constructor)===Function&&(t=t[0]());const e=[],r=[];let n=0;for(;n<t.length;n++){const i=t[n];if(i===void 0)break;if(i.constructor===String||i.constructor===Number)e.push(i);else if(i.constructor===Object)break}for(n>0&&r.push(e.join(""));n<t.length;n++){const i=t[n];i instanceof Symbol||r.push(i)}return r},Uy={[Wd]:Ut("font-weight","bold"),[zd]:Ut("font-weight","normal"),[Ry]:Ut("color","blue"),[qy]:Ut("color","green"),[$y]:Ut("color","grey"),[Jd]:Ut("color","red"),[Ly]:Ut("color","purple"),[Ka]:Ut("color","orange"),[Dy]:Ut("color","black")},By=t=>{var o;t.length===1&&((o=t[0])==null?void 0:o.constructor)===Function&&(t=t[0]());const e=[],r=[],n=At();let s=[],i=0;for(;i<t.length;i++){const a=t[i],l=Uy[a];if(l!==void 0)n.set(l.left,l.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const u=Py(n);i>0||u.length>0?(e.push("%c"+a),r.push(u)):e.push(a)}else break}}for(i>0&&(s=r,s.unshift(e.join("")));i<t.length;i++){const a=t[i];a instanceof Symbol||s.push(a)}return s},Kd=jy?By:Fy,Hy=(...t)=>{console.log(...Kd(t)),Vd.forEach(e=>e.print(t))},Wy=(...t)=>{console.warn(...Kd(t)),t.unshift(Ka),Vd.forEach(e=>e.print(t))},Vd=tn(),Gd=t=>({[Symbol.iterator](){return this},next:t}),zy=(t,e)=>Gd(()=>{let r;do r=t.next();while(!r.done&&!e(r.value));return r}),zo=(t,e)=>Gd(()=>{const{done:r,value:n}=t.next();return{done:r,value:r?void 0:e(n)}});class Jy{constructor(e,r){this.clock=e,this.len=r}}class Ky{constructor(){this.clients=new Map}}const Yd=(t,e,r)=>e.clients.forEach((n,s)=>{const i=t.doc.store.clients.get(s);if(i!=null){const o=i[i.length-1],a=o.id.clock+o.length;for(let l=0,u=n[l];l<n.length&&u.clock<a;u=n[++l])nh(t,i,u.clock,u.len,r)}}),Vy=(t,e)=>{let r=0,n=t.length-1;for(;r<=n;){const s=Er((r+n)/2),i=t[s],o=i.clock;if(o<=e){if(e<o+i.len)return s;r=s+1}else n=s-1}return null},Xd=(t,e)=>{const r=t.clients.get(e.client);return r!==void 0&&Vy(r,e.clock)!==null},Qd=t=>{t.clients.forEach(e=>{e.sort((s,i)=>s.clock-i.clock);let r,n;for(r=1,n=1;r<e.length;r++){const s=e[n-1],i=e[r];s.clock+s.len>=i.clock?s.len=yn(s.len,i.clock+i.len-s.clock):(n<r&&(e[n]=i),n++)}e.length=n})},Zd=(t,e,r,n)=>{mn(t.clients,e,()=>[]).push(new Jy(r,n))},Gy=(t,e)=>{be(t.restEncoder,e.clients.size),rn(e.clients.entries()).sort((r,n)=>n[0]-r[0]).forEach(([r,n])=>{t.resetDsCurVal(),be(t.restEncoder,r);const s=n.length;be(t.restEncoder,s);for(let i=0;i<s;i++){const o=n[i];t.writeDsClock(o.clock),t.writeDsLen(o.len)}})},eh=Dd;class ys extends Jm{constructor({guid:e=yy(),collectionid:r=null,gc:n=!0,gcFilter:s=()=>!0,meta:i=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=n,this.gcFilter=s,this.clientID=eh(),this.guid=e,this.collectionid=r,this.share=new Map,this.store=new ib,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=i,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=_c(u=>{this.on("load",()=>{this.isLoaded=!0,u(this)})});const l=()=>_c(u=>{const d=f=>{(f===void 0||f===!0)&&(this.off("sync",d),u())};this.on("sync",d)});this.on("sync",u=>{u===!1&&this.isSynced&&(this.whenSynced=l()),this.isSynced=u===void 0||u===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=l()}load(){const e=this._item;e!==null&&!this.shouldLoad&&_e(e.parent.doc,r=>{r.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(rn(this.subdocs).map(e=>e.guid))}transact(e,r=null){return _e(this,e,r)}get(e,r=De){const n=mn(this.share,e,()=>{const i=new r;return i._integrate(this,null),i}),s=n.constructor;if(r!==De&&s!==r)if(s===De){const i=new r;i._map=n._map,n._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=i}),i._start=n._start;for(let o=i._start;o!==null;o=o.right)o.parent=i;return i._length=n._length,this.share.set(e,i),i._integrate(this,null),i}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return n}getArray(e=""){return this.get(e,Sr)}getText(e=""){return this.get(e,Ei)}getMap(e=""){return this.get(e,sn)}getXmlElement(e=""){return this.get(e,as)}getXmlFragment(e=""){return this.get(e,on)}toJSON(){const e={};return this.share.forEach((r,n)=>{e[n]=r.toJSON()}),e}destroy(){this.isDestroyed=!0,rn(this.subdocs).forEach(r=>r.destroy());const e=this._item;if(e!==null){this._item=null;const r=e.content;r.doc=new ys({guid:this.guid,...r.opts,shouldLoad:!1}),r.doc._item=e,_e(e.parent.doc,n=>{const s=r.doc;e.deleted||n.subdocsAdded.add(s),n.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class Yy{constructor(){this.restEncoder=Ba()}toUint8Array(){return zt(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){be(this.restEncoder,e)}writeDsLen(e){be(this.restEncoder,e)}}class Xy extends Yy{writeLeftID(e){be(this.restEncoder,e.client),be(this.restEncoder,e.clock)}writeRightID(e){be(this.restEncoder,e.client),be(this.restEncoder,e.clock)}writeClient(e){be(this.restEncoder,e)}writeInfo(e){da(this.restEncoder,e)}writeString(e){Zr(this.restEncoder,e)}writeParentInfo(e){be(this.restEncoder,e?1:0)}writeTypeRef(e){be(this.restEncoder,e)}writeLen(e){be(this.restEncoder,e)}writeAny(e){ns(this.restEncoder,e)}writeBuf(e){st(this.restEncoder,e)}writeJSON(e){Zr(this.restEncoder,JSON.stringify(e))}writeKey(e){Zr(this.restEncoder,e)}}class Qy{constructor(){this.restEncoder=Ba(),this.dsCurrVal=0}toUint8Array(){return zt(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const r=e-this.dsCurrVal;this.dsCurrVal=e,be(this.restEncoder,r)}writeDsLen(e){e===0&&Tr(),be(this.restEncoder,e-1),this.dsCurrVal+=e}}class Zy extends Qy{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Wo,this.clientEncoder=new mi,this.leftClockEncoder=new Wo,this.rightClockEncoder=new Wo,this.infoEncoder=new mc(da),this.stringEncoder=new py,this.parentInfoEncoder=new mc(da),this.typeRefEncoder=new mi,this.lenEncoder=new mi}toUint8Array(){const e=Ba();return be(e,0),st(e,this.keyClockEncoder.toUint8Array()),st(e,this.clientEncoder.toUint8Array()),st(e,this.leftClockEncoder.toUint8Array()),st(e,this.rightClockEncoder.toUint8Array()),st(e,zt(this.infoEncoder)),st(e,this.stringEncoder.toUint8Array()),st(e,zt(this.parentInfoEncoder)),st(e,this.typeRefEncoder.toUint8Array()),st(e,this.lenEncoder.toUint8Array()),Wa(e,zt(this.restEncoder)),zt(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){ns(this.restEncoder,e)}writeBuf(e){st(this.restEncoder,e)}writeJSON(e){ns(this.restEncoder,e)}writeKey(e){const r=this.keyMap.get(e);r===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(r)}}const eb=(t,e,r,n)=>{n=yn(n,e[0].id.clock);const s=Jt(e,n);be(t.restEncoder,e.length-s),t.writeClient(r),be(t.restEncoder,n);const i=e[s];i.write(t,n-i.id.clock);for(let o=s+1;o<e.length;o++)e[o].write(t,0)},tb=(t,e,r)=>{const n=new Map;r.forEach((s,i)=>{et(e,i)>s&&n.set(i,s)}),Va(e).forEach((s,i)=>{r.has(i)||n.set(i,0)}),be(t.restEncoder,n.size),rn(n.entries()).sort((s,i)=>i[0]-s[0]).forEach(([s,i])=>{eb(t,e.clients.get(s),s,i)})},rb=(t,e)=>tb(t,e.doc.store,e.beforeState);class nb{constructor(){this.l=[]}}const wc=()=>new nb,xc=(t,e)=>t.l.push(e),Cc=(t,e)=>{const r=t.l,n=r.length;t.l=r.filter(s=>e!==s),n===t.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},th=(t,e,r)=>Ja(t.l,[e,r]);class yi{constructor(e,r){this.client=e,this.clock=r}}const Gs=(t,e)=>t===e||t!==null&&e!==null&&t.client===e.client&&t.clock===e.clock,Ee=(t,e)=>new yi(t,e),sb=t=>{for(const[e,r]of t.doc.share.entries())if(r===t)return e;throw Tr()},Xr=(t,e)=>e===void 0?!t.deleted:e.sv.has(t.id.client)&&(e.sv.get(t.id.client)||0)>t.id.clock&&!Xd(e.ds,t.id),pa=(t,e)=>{const r=mn(t.meta,pa,tn),n=t.doc.store;r.has(e)||(e.sv.forEach((s,i)=>{s<et(n,i)&&or(t,Ee(i,s))}),Yd(t,e.ds,s=>{}),r.add(e))};class ib{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Va=t=>{const e=new Map;return t.clients.forEach((r,n)=>{const s=r[r.length-1];e.set(n,s.id.clock+s.length)}),e},et=(t,e)=>{const r=t.clients.get(e);if(r===void 0)return 0;const n=r[r.length-1];return n.id.clock+n.length},rh=(t,e)=>{let r=t.clients.get(e.id.client);if(r===void 0)r=[],t.clients.set(e.id.client,r);else{const n=r[r.length-1];if(n.id.clock+n.length!==e.id.clock)throw Tr()}r.push(e)},Jt=(t,e)=>{let r=0,n=t.length-1,s=t[n],i=s.id.clock;if(i===e)return n;let o=Er(e/(i+s.length-1)*n);for(;r<=n;){if(s=t[o],i=s.id.clock,i<=e){if(e<i+s.length)return o;r=o+1}else n=o-1;o=Er((r+n)/2)}throw Tr()},ob=(t,e)=>{const r=t.clients.get(e.client);return r[Jt(r,e.clock)]},Jo=ob,ga=(t,e,r)=>{const n=Jt(e,r),s=e[n];return s.id.clock<r&&s instanceof ze?(e.splice(n+1,0,wh(t,s,r-s.id.clock)),n+1):n},or=(t,e)=>{const r=t.doc.store.clients.get(e.client);return r[ga(t,r,e.clock)]},Sc=(t,e,r)=>{const n=e.clients.get(r.client),s=Jt(n,r.clock),i=n[s];return r.clock!==i.id.clock+i.length-1&&i.constructor!==tr&&n.splice(s+1,0,wh(t,i,r.clock-i.id.clock+1)),i},ab=(t,e,r)=>{const n=t.clients.get(e.id.client);n[Jt(n,e.id.clock)]=r},nh=(t,e,r,n,s)=>{if(n===0)return;const i=r+n;let o=ga(t,e,r),a;do a=e[o++],i<a.id.clock+a.length&&ga(t,e,i),s(a);while(o<e.length&&e[o].id.clock<i)};class lb{constructor(e,r,n){this.doc=e,this.deleteSet=new Ky,this.beforeState=Va(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=r,this.meta=new Map,this.local=n,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const Ec=(t,e)=>e.deleteSet.clients.size===0&&!Wm(e.afterState,(r,n)=>e.beforeState.get(n)!==r)?!1:(Qd(e.deleteSet),rb(t,e),Gy(t,e.deleteSet),!0),Tc=(t,e,r)=>{const n=e._item;(n===null||n.id.clock<(t.beforeState.get(n.id.client)||0)&&!n.deleted)&&mn(t.changed,e,tn).add(r)},bi=(t,e)=>{let r=t[e],n=t[e-1],s=e;for(;s>0;r=n,n=t[--s-1]){if(n.deleted===r.deleted&&n.constructor===r.constructor&&n.mergeWith(r)){r instanceof ze&&r.parentSub!==null&&r.parent._map.get(r.parentSub)===r&&r.parent._map.set(r.parentSub,n);continue}break}const i=e-s;return i&&t.splice(e+1-i,i),i},cb=(t,e,r)=>{for(const[n,s]of t.clients.entries()){const i=e.clients.get(n);for(let o=s.length-1;o>=0;o--){const a=s[o],l=a.clock+a.len;for(let u=Jt(i,a.clock),d=i[u];u<i.length&&d.id.clock<l;d=i[++u]){const f=i[u];if(a.clock+a.len<=f.id.clock)break;f instanceof ze&&f.deleted&&!f.keep&&r(f)&&f.gc(e,!1)}}}},ub=(t,e)=>{t.clients.forEach((r,n)=>{const s=e.clients.get(n);for(let i=r.length-1;i>=0;i--){const o=r[i],a=qd(s.length-1,1+Jt(s,o.clock+o.len-1));for(let l=a,u=s[l];l>0&&u.id.clock>=o.clock;u=s[l])l-=1+bi(s,l)}})},sh=(t,e)=>{if(e<t.length){const r=t[e],n=r.doc,s=n.store,i=r.deleteSet,o=r._mergeStructs;try{Qd(i),r.afterState=Va(r.doc.store),n.emit("beforeObserverCalls",[r,n]);const a=[];r.changed.forEach((l,u)=>a.push(()=>{(u._item===null||!u._item.deleted)&&u._callObserver(r,l)})),a.push(()=>{r.changedParentTypes.forEach((l,u)=>{u._dEH.l.length>0&&(u._item===null||!u._item.deleted)&&(l=l.filter(d=>d.target._item===null||!d.target._item.deleted),l.forEach(d=>{d.currentTarget=u,d._path=null}),l.sort((d,f)=>d.path.length-f.path.length),th(u._dEH,l,r))})}),a.push(()=>n.emit("afterTransaction",[r,n])),Ja(a,[]),r._needFormattingCleanup&&vb(r)}finally{n.gc&&cb(i,s,n.gcFilter),ub(i,s),r.afterState.forEach((d,f)=>{const h=r.beforeState.get(f)||0;if(h!==d){const p=s.clients.get(f),y=yn(Jt(p,h),1);for(let b=p.length-1;b>=y;)b-=1+bi(p,b)}});for(let d=o.length-1;d>=0;d--){const{client:f,clock:h}=o[d].id,p=s.clients.get(f),y=Jt(p,h);y+1<p.length&&bi(p,y+1)>1||y>0&&bi(p,y)}if(!r.local&&r.afterState.get(n.clientID)!==r.beforeState.get(n.clientID)&&(Hy(Ka,Wd,"[yjs] ",zd,Jd,"Changed the client-id because another client seems to be using it."),n.clientID=eh()),n.emit("afterTransactionCleanup",[r,n]),n._observers.has("update")){const d=new Xy;Ec(d,r)&&n.emit("update",[d.toUint8Array(),r.origin,n,r])}if(n._observers.has("updateV2")){const d=new Zy;Ec(d,r)&&n.emit("updateV2",[d.toUint8Array(),r.origin,n,r])}const{subdocsAdded:a,subdocsLoaded:l,subdocsRemoved:u}=r;(a.size>0||u.size>0||l.size>0)&&(a.forEach(d=>{d.clientID=n.clientID,d.collectionid==null&&(d.collectionid=n.collectionid),n.subdocs.add(d)}),u.forEach(d=>n.subdocs.delete(d)),n.emit("subdocs",[{loaded:l,added:a,removed:u},n,r]),u.forEach(d=>d.destroy())),t.length<=e+1?(n._transactionCleanups=[],n.emit("afterAllTransactions",[n,t])):sh(t,e+1)}}},_e=(t,e,r=null,n=!0)=>{const s=t._transactionCleanups;let i=!1,o=null;t._transaction===null&&(i=!0,t._transaction=new lb(t,r,n),s.push(t._transaction),s.length===1&&t.emit("beforeAllTransactions",[t]),t.emit("beforeTransaction",[t._transaction,t]));try{o=e(t._transaction)}finally{if(i){const a=t._transaction===s[0];t._transaction=null,a&&sh(s,0)}}return o},Mc="You must not compute changes after the event-handler fired.";class Ui{constructor(e,r){this.target=e,this.currentTarget=e,this.transaction=r,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=db(this.currentTarget,this.target))}deletes(e){return Xd(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw nn(Mc);const e=new Map,r=this.target;this.transaction.changed.get(r).forEach(s=>{if(s!==null){const i=r._map.get(s);let o,a;if(this.adds(i)){let l=i.left;for(;l!==null&&this.adds(l);)l=l.left;if(this.deletes(i))if(l!==null&&this.deletes(l))o="delete",a=Fo(l.content.getContent());else return;else l!==null&&this.deletes(l)?(o="update",a=Fo(l.content.getContent())):(o="add",a=void 0)}else if(this.deletes(i))o="delete",a=Fo(i.content.getContent());else return;e.set(s,{action:o,oldValue:a})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw nn(Mc);const r=this.target,n=tn(),s=tn(),i=[];if(e={added:n,deleted:s,delta:i,keys:this.keys},this.transaction.changed.get(r).has(null)){let a=null;const l=()=>{a&&i.push(a)};for(let u=r._start;u!==null;u=u.right)u.deleted?this.deletes(u)&&!this.adds(u)&&((a===null||a.delete===void 0)&&(l(),a={delete:0}),a.delete+=u.length,s.add(u)):this.adds(u)?((a===null||a.insert===void 0)&&(l(),a={insert:[]}),a.insert=a.insert.concat(u.content.getContent()),n.add(u)):((a===null||a.retain===void 0)&&(l(),a={retain:0}),a.retain+=u.length);a!==null&&a.retain===void 0&&l()}this._changes=e}return e}}const db=(t,e)=>{const r=[];for(;e._item!==null&&e!==t;){if(e._item.parentSub!==null)r.unshift(e._item.parentSub);else{let n=0,s=e._item.parent._start;for(;s!==e._item&&s!==null;)!s.deleted&&s.countable&&(n+=s.length),s=s.right;r.unshift(n)}e=e._item.parent}return r},Ke=()=>{Wy("Invalid access: Add Yjs type to a document before reading data.")},ih=80;let Ga=0;class hb{constructor(e,r){e.marker=!0,this.p=e,this.index=r,this.timestamp=Ga++}}const fb=t=>{t.timestamp=Ga++},oh=(t,e,r)=>{t.p.marker=!1,t.p=e,e.marker=!0,t.index=r,t.timestamp=Ga++},pb=(t,e,r)=>{if(t.length>=ih){const n=t.reduce((s,i)=>s.timestamp<i.timestamp?s:i);return oh(n,e,r),n}else{const n=new hb(e,r);return t.push(n),n}},Bi=(t,e)=>{if(t._start===null||e===0||t._searchMarker===null)return null;const r=t._searchMarker.length===0?null:t._searchMarker.reduce((i,o)=>gi(e-i.index)<gi(e-o.index)?i:o);let n=t._start,s=0;for(r!==null&&(n=r.p,s=r.index,fb(r));n.right!==null&&s<e;){if(!n.deleted&&n.countable){if(e<s+n.length)break;s+=n.length}n=n.right}for(;n.left!==null&&s>e;)n=n.left,!n.deleted&&n.countable&&(s-=n.length);for(;n.left!==null&&n.left.id.client===n.id.client&&n.left.id.clock+n.left.length===n.id.clock;)n=n.left,!n.deleted&&n.countable&&(s-=n.length);return r!==null&&gi(r.index-s)<n.parent.length/ih?(oh(r,n,s),r):pb(t._searchMarker,n,s)},is=(t,e,r)=>{for(let n=t.length-1;n>=0;n--){const s=t[n];if(r>0){let i=s.p;for(i.marker=!1;i&&(i.deleted||!i.countable);)i=i.left,i&&!i.deleted&&i.countable&&(s.index-=i.length);if(i===null||i.marker===!0){t.splice(n,1);continue}s.p=i,i.marker=!0}(e<s.index||r>0&&e===s.index)&&(s.index=yn(e,s.index+r))}},Hi=(t,e,r)=>{const n=t,s=e.changedParentTypes;for(;mn(s,t,()=>[]).push(r),t._item!==null;)t=t._item.parent;th(n._eH,r,e)};class De{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=wc(),this._dEH=wc(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,r){this.doc=e,this._item=r}_copy(){throw Nt()}clone(){throw Nt()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,r){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){xc(this._eH,e)}observeDeep(e){xc(this._dEH,e)}unobserve(e){Cc(this._eH,e)}unobserveDeep(e){Cc(this._dEH,e)}toJSON(){}}const ah=(t,e,r)=>{t.doc??Ke(),e<0&&(e=t._length+e),r<0&&(r=t._length+r);let n=r-e;const s=[];let i=t._start;for(;i!==null&&n>0;){if(i.countable&&!i.deleted){const o=i.content.getContent();if(o.length<=e)e-=o.length;else{for(let a=e;a<o.length&&n>0;a++)s.push(o[a]),n--;e=0}}i=i.right}return s},lh=t=>{t.doc??Ke();const e=[];let r=t._start;for(;r!==null;){if(r.countable&&!r.deleted){const n=r.content.getContent();for(let s=0;s<n.length;s++)e.push(n[s])}r=r.right}return e},os=(t,e)=>{let r=0,n=t._start;for(t.doc??Ke();n!==null;){if(n.countable&&!n.deleted){const s=n.content.getContent();for(let i=0;i<s.length;i++)e(s[i],r++,t)}n=n.right}},ch=(t,e)=>{const r=[];return os(t,(n,s)=>{r.push(e(n,s,t))}),r},gb=t=>{let e=t._start,r=null,n=0;return{[Symbol.iterator](){return this},next:()=>{if(r===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};r=e.content.getContent(),n=0,e=e.right}const s=r[n++];return r.length<=n&&(r=null),{done:!1,value:s}}}},uh=(t,e)=>{t.doc??Ke();const r=Bi(t,e);let n=t._start;for(r!==null&&(n=r.p,e-=r.index);n!==null;n=n.right)if(!n.deleted&&n.countable){if(e<n.length)return n.content.getContent()[e];e-=n.length}},Ci=(t,e,r,n)=>{let s=r;const i=t.doc,o=i.clientID,a=i.store,l=r===null?e._start:r.right;let u=[];const d=()=>{u.length>0&&(s=new ze(Ee(o,et(a,o)),s,s&&s.lastId,l,l&&l.id,e,null,new an(u)),s.integrate(t,0),u=[])};n.forEach(f=>{if(f===null)u.push(f);else switch(f.constructor){case Number:case Object:case Boolean:case Array:case String:u.push(f);break;default:switch(d(),f.constructor){case Uint8Array:case ArrayBuffer:s=new ze(Ee(o,et(a,o)),s,s&&s.lastId,l,l&&l.id,e,null,new Wi(new Uint8Array(f))),s.integrate(t,0);break;case ys:s=new ze(Ee(o,et(a,o)),s,s&&s.lastId,l,l&&l.id,e,null,new zi(f)),s.integrate(t,0);break;default:if(f instanceof De)s=new ze(Ee(o,et(a,o)),s,s&&s.lastId,l,l&&l.id,e,null,new fr(f)),s.integrate(t,0);else throw new Error("Unexpected content type in insert operation")}}}),d()},dh=()=>nn("Length exceeded!"),hh=(t,e,r,n)=>{if(r>e._length)throw dh();if(r===0)return e._searchMarker&&is(e._searchMarker,r,n.length),Ci(t,e,null,n);const s=r,i=Bi(e,r);let o=e._start;for(i!==null&&(o=i.p,r-=i.index,r===0&&(o=o.prev,r+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(r<=o.length){r<o.length&&or(t,Ee(o.id.client,o.id.clock+r));break}r-=o.length}return e._searchMarker&&is(e._searchMarker,s,n.length),Ci(t,e,o,n)},mb=(t,e,r)=>{let s=(e._searchMarker||[]).reduce((i,o)=>o.index>i.index?o:i,{index:0,p:e._start}).p;if(s)for(;s.right;)s=s.right;return Ci(t,e,s,r)},fh=(t,e,r,n)=>{if(n===0)return;const s=r,i=n,o=Bi(e,r);let a=e._start;for(o!==null&&(a=o.p,r-=o.index);a!==null&&r>0;a=a.right)!a.deleted&&a.countable&&(r<a.length&&or(t,Ee(a.id.client,a.id.clock+r)),r-=a.length);for(;n>0&&a!==null;)a.deleted||(n<a.length&&or(t,Ee(a.id.client,a.id.clock+n)),a.delete(t),n-=a.length),a=a.right;if(n>0)throw dh();e._searchMarker&&is(e._searchMarker,s,-i+n)},Si=(t,e,r)=>{const n=e._map.get(r);n!==void 0&&n.delete(t)},Ya=(t,e,r,n)=>{const s=e._map.get(r)||null,i=t.doc,o=i.clientID;let a;if(n==null)a=new an([n]);else switch(n.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:a=new an([n]);break;case Uint8Array:a=new Wi(n);break;case ys:a=new zi(n);break;default:if(n instanceof De)a=new fr(n);else throw new Error("Unexpected content type")}new ze(Ee(o,et(i.store,o)),s,s&&s.lastId,null,null,e,r,a).integrate(t,0)},Xa=(t,e)=>{t.doc??Ke();const r=t._map.get(e);return r!==void 0&&!r.deleted?r.content.getContent()[r.length-1]:void 0},ph=t=>{const e={};return t.doc??Ke(),t._map.forEach((r,n)=>{r.deleted||(e[n]=r.content.getContent()[r.length-1])}),e},gh=(t,e)=>{t.doc??Ke();const r=t._map.get(e);return r!==void 0&&!r.deleted},yb=(t,e)=>{const r={};return t._map.forEach((n,s)=>{let i=n;for(;i!==null&&(!e.sv.has(i.id.client)||i.id.clock>=(e.sv.get(i.id.client)||0));)i=i.left;i!==null&&Xr(i,e)&&(r[s]=i.content.getContent()[i.length-1])}),r},Ys=t=>(t.doc??Ke(),zy(t._map.entries(),e=>!e[1].deleted));class mh extends Ui{}class Sr extends De{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const r=new Sr;return r.push(e),r}_integrate(e,r){super._integrate(e,r),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Sr}clone(){const e=new Sr;return e.insert(0,this.toArray().map(r=>r instanceof De?r.clone():r)),e}get length(){return this.doc??Ke(),this._length}_callObserver(e,r){super._callObserver(e,r),Hi(this,e,new mh(this,e))}insert(e,r){this.doc!==null?_e(this.doc,n=>{hh(n,this,e,r)}):this._prelimContent.splice(e,0,...r)}push(e){this.doc!==null?_e(this.doc,r=>{mb(r,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,r=1){this.doc!==null?_e(this.doc,n=>{fh(n,this,e,r)}):this._prelimContent.splice(e,r)}get(e){return uh(this,e)}toArray(){return lh(this)}slice(e=0,r=this.length){return ah(this,e,r)}toJSON(){return this.map(e=>e instanceof De?e.toJSON():e)}map(e){return ch(this,e)}forEach(e){os(this,e)}[Symbol.iterator](){return gb(this)}_write(e){e.writeTypeRef(Tb)}}class bb extends Ui{constructor(e,r,n){super(e,r),this.keysChanged=n}}class sn extends De{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,r){super._integrate(e,r),this._prelimContent.forEach((n,s)=>{this.set(s,n)}),this._prelimContent=null}_copy(){return new sn}clone(){const e=new sn;return this.forEach((r,n)=>{e.set(n,r instanceof De?r.clone():r)}),e}_callObserver(e,r){Hi(this,e,new bb(this,e,r))}toJSON(){this.doc??Ke();const e={};return this._map.forEach((r,n)=>{if(!r.deleted){const s=r.content.getContent()[r.length-1];e[n]=s instanceof De?s.toJSON():s}}),e}get size(){return[...Ys(this)].length}keys(){return zo(Ys(this),e=>e[0])}values(){return zo(Ys(this),e=>e[1].content.getContent()[e[1].length-1])}entries(){return zo(Ys(this),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this.doc??Ke(),this._map.forEach((r,n)=>{r.deleted||e(r.content.getContent()[r.length-1],n,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?_e(this.doc,r=>{Si(r,this,e)}):this._prelimContent.delete(e)}set(e,r){return this.doc!==null?_e(this.doc,n=>{Ya(n,this,e,r)}):this._prelimContent.set(e,r),r}get(e){return Xa(this,e)}has(e){return gh(this,e)}clear(){this.doc!==null?_e(this.doc,e=>{this.forEach(function(r,n,s){Si(e,s,n)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(Mb)}}const sr=(t,e)=>t===e||typeof t=="object"&&typeof e=="object"&&t&&e&&Ty(t,e);class ma{constructor(e,r,n,s){this.left=e,this.right=r,this.index=n,this.currentAttributes=s}forward(){switch(this.right===null&&Tr(),this.right.content.constructor){case Ie:this.right.deleted||bn(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Ac=(t,e,r)=>{for(;e.right!==null&&r>0;){switch(e.right.content.constructor){case Ie:e.right.deleted||bn(e.currentAttributes,e.right.content);break;default:e.right.deleted||(r<e.right.length&&or(t,Ee(e.right.id.client,e.right.id.clock+r)),e.index+=e.right.length,r-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},Xs=(t,e,r,n)=>{const s=new Map,i=n?Bi(e,r):null;if(i){const o=new ma(i.p.left,i.p,i.index,s);return Ac(t,o,r-i.index)}else{const o=new ma(null,e._start,0,s);return Ac(t,o,r)}},yh=(t,e,r,n)=>{for(;r.right!==null&&(r.right.deleted===!0||r.right.content.constructor===Ie&&sr(n.get(r.right.content.key),r.right.content.value));)r.right.deleted||n.delete(r.right.content.key),r.forward();const s=t.doc,i=s.clientID;n.forEach((o,a)=>{const l=r.left,u=r.right,d=new ze(Ee(i,et(s.store,i)),l,l&&l.lastId,u,u&&u.id,e,null,new Ie(a,o));d.integrate(t,0),r.right=d,r.forward()})},bn=(t,e)=>{const{key:r,value:n}=e;n===null?t.delete(r):t.set(r,n)},bh=(t,e)=>{for(;t.right!==null;){if(!(t.right.deleted||t.right.content.constructor===Ie&&sr(e[t.right.content.key]??null,t.right.content.value)))break;t.forward()}},_h=(t,e,r,n)=>{const s=t.doc,i=s.clientID,o=new Map;for(const a in n){const l=n[a],u=r.currentAttributes.get(a)??null;if(!sr(u,l)){o.set(a,u);const{left:d,right:f}=r;r.right=new ze(Ee(i,et(s.store,i)),d,d&&d.lastId,f,f&&f.id,e,null,new Ie(a,l)),r.right.integrate(t,0),r.forward()}}return o},Ko=(t,e,r,n,s)=>{r.currentAttributes.forEach((h,p)=>{s[p]===void 0&&(s[p]=null)});const i=t.doc,o=i.clientID;bh(r,s);const a=_h(t,e,r,s),l=n.constructor===String?new Kt(n):n instanceof De?new fr(n):new _n(n);let{left:u,right:d,index:f}=r;e._searchMarker&&is(e._searchMarker,r.index,l.getLength()),d=new ze(Ee(o,et(i.store,o)),u,u&&u.lastId,d,d&&d.id,e,null,l),d.integrate(t,0),r.right=d,r.index=f,r.forward(),yh(t,e,r,a)},Nc=(t,e,r,n,s)=>{const i=t.doc,o=i.clientID;bh(r,s);const a=_h(t,e,r,s);e:for(;r.right!==null&&(n>0||a.size>0&&(r.right.deleted||r.right.content.constructor===Ie));){if(!r.right.deleted)switch(r.right.content.constructor){case Ie:{const{key:l,value:u}=r.right.content,d=s[l];if(d!==void 0){if(sr(d,u))a.delete(l);else{if(n===0)break e;a.set(l,u)}r.right.delete(t)}else r.currentAttributes.set(l,u);break}default:n<r.right.length&&or(t,Ee(r.right.id.client,r.right.id.clock+n)),n-=r.right.length;break}r.forward()}if(n>0){let l="";for(;n>0;n--)l+=`
`;r.right=new ze(Ee(o,et(i.store,o)),r.left,r.left&&r.left.lastId,r.right,r.right&&r.right.id,e,null,new Kt(l)),r.right.integrate(t,0),r.forward()}yh(t,e,r,a)},kh=(t,e,r,n,s)=>{let i=e;const o=At();for(;i&&(!i.countable||i.deleted);){if(!i.deleted&&i.content.constructor===Ie){const u=i.content;o.set(u.key,u)}i=i.right}let a=0,l=!1;for(;e!==i;){if(r===e&&(l=!0),!e.deleted){const u=e.content;switch(u.constructor){case Ie:{const{key:d,value:f}=u,h=n.get(d)??null;(o.get(d)!==u||h===f)&&(e.delete(t),a++,!l&&(s.get(d)??null)===f&&h!==f&&(h===null?s.delete(d):s.set(d,h))),!l&&!e.deleted&&bn(s,u);break}}}e=e.right}return a},_b=(t,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const r=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===Ie){const n=e.content.key;r.has(n)?e.delete(t):r.add(n)}e=e.left}},kb=t=>{let e=0;return _e(t.doc,r=>{let n=t._start,s=t._start,i=At();const o=ua(i);for(;s;){if(s.deleted===!1)switch(s.content.constructor){case Ie:bn(o,s.content);break;default:e+=kh(r,n,s,i,o),i=ua(o),n=s;break}s=s.right}}),e},vb=t=>{const e=new Set,r=t.doc;for(const[n,s]of t.afterState.entries()){const i=t.beforeState.get(n)||0;s!==i&&nh(t,r.store.clients.get(n),i,s,o=>{!o.deleted&&o.content.constructor===Ie&&o.constructor!==tr&&e.add(o.parent)})}_e(r,n=>{Yd(t,t.deleteSet,s=>{if(s instanceof tr||!s.parent._hasFormatting||e.has(s.parent))return;const i=s.parent;s.content.constructor===Ie?e.add(i):_b(n,s)});for(const s of e)kb(s)})},Oc=(t,e,r)=>{const n=r,s=ua(e.currentAttributes),i=e.right;for(;r>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case fr:case _n:case Kt:r<e.right.length&&or(t,Ee(e.right.id.client,e.right.id.clock+r)),r-=e.right.length,e.right.delete(t);break}e.forward()}i&&kh(t,i,e.right,s,e.currentAttributes);const o=(e.left||e.right).parent;return o._searchMarker&&is(o._searchMarker,e.index,-n+r),e};class wb extends Ui{constructor(e,r,n){super(e,r),this.childListChanged=!1,this.keysChanged=new Set,n.forEach(s=>{s===null?this.childListChanged=!0:this.keysChanged.add(s)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,r=[];_e(e,n=>{const s=new Map,i=new Map;let o=this.target._start,a=null;const l={};let u="",d=0,f=0;const h=()=>{if(a!==null){let p=null;switch(a){case"delete":f>0&&(p={delete:f}),f=0;break;case"insert":(typeof u=="object"||u.length>0)&&(p={insert:u},s.size>0&&(p.attributes={},s.forEach((y,b)=>{y!==null&&(p.attributes[b]=y)}))),u="";break;case"retain":d>0&&(p={retain:d},Cy(l)||(p.attributes=vy({},l))),d=0;break}p&&r.push(p),a=null}};for(;o!==null;){switch(o.content.constructor){case fr:case _n:this.adds(o)?this.deletes(o)||(h(),a="insert",u=o.content.getContent()[0],h()):this.deletes(o)?(a!=="delete"&&(h(),a="delete"),f+=1):o.deleted||(a!=="retain"&&(h(),a="retain"),d+=1);break;case Kt:this.adds(o)?this.deletes(o)||(a!=="insert"&&(h(),a="insert"),u+=o.content.str):this.deletes(o)?(a!=="delete"&&(h(),a="delete"),f+=o.length):o.deleted||(a!=="retain"&&(h(),a="retain"),d+=o.length);break;case Ie:{const{key:p,value:y}=o.content;if(this.adds(o)){if(!this.deletes(o)){const b=s.get(p)??null;sr(b,y)?y!==null&&o.delete(n):(a==="retain"&&h(),sr(y,i.get(p)??null)?delete l[p]:l[p]=y)}}else if(this.deletes(o)){i.set(p,y);const b=s.get(p)??null;sr(b,y)||(a==="retain"&&h(),l[p]=b)}else if(!o.deleted){i.set(p,y);const b=l[p];b!==void 0&&(sr(b,y)?b!==null&&o.delete(n):(a==="retain"&&h(),y===null?delete l[p]:l[p]=y))}o.deleted||(a==="insert"&&h(),bn(s,o.content));break}}o=o.right}for(h();r.length>0;){const p=r[r.length-1];if(p.retain!==void 0&&p.attributes===void 0)r.pop();else break}}),this._delta=r}return this._delta}}class Ei extends De{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??Ke(),this._length}_integrate(e,r){super._integrate(e,r);try{this._pending.forEach(n=>n())}catch(n){console.error(n)}this._pending=null}_copy(){return new Ei}clone(){const e=new Ei;return e.applyDelta(this.toDelta()),e}_callObserver(e,r){super._callObserver(e,r);const n=new wb(this,e,r);Hi(this,e,n),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){this.doc??Ke();let e="",r=this._start;for(;r!==null;)!r.deleted&&r.countable&&r.content.constructor===Kt&&(e+=r.content.str),r=r.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:r=!0}={}){this.doc!==null?_e(this.doc,n=>{const s=new ma(null,this._start,0,new Map);for(let i=0;i<e.length;i++){const o=e[i];if(o.insert!==void 0){const a=!r&&typeof o.insert=="string"&&i===e.length-1&&s.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&Ko(n,this,s,a,o.attributes||{})}else o.retain!==void 0?Nc(n,this,s,o.retain,o.attributes||{}):o.delete!==void 0&&Oc(n,s,o.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,r,n){this.doc??Ke();const s=[],i=new Map,o=this.doc;let a="",l=this._start;function u(){if(a.length>0){const f={};let h=!1;i.forEach((y,b)=>{h=!0,f[b]=y});const p={insert:a};h&&(p.attributes=f),s.push(p),a=""}}const d=()=>{for(;l!==null;){if(Xr(l,e)||r!==void 0&&Xr(l,r))switch(l.content.constructor){case Kt:{const f=i.get("ychange");e!==void 0&&!Xr(l,e)?(f===void 0||f.user!==l.id.client||f.type!=="removed")&&(u(),i.set("ychange",n?n("removed",l.id):{type:"removed"})):r!==void 0&&!Xr(l,r)?(f===void 0||f.user!==l.id.client||f.type!=="added")&&(u(),i.set("ychange",n?n("added",l.id):{type:"added"})):f!==void 0&&(u(),i.delete("ychange")),a+=l.content.str;break}case fr:case _n:{u();const f={insert:l.content.getContent()[0]};if(i.size>0){const h={};f.attributes=h,i.forEach((p,y)=>{h[y]=p})}s.push(f);break}case Ie:Xr(l,e)&&(u(),bn(i,l.content));break}l=l.right}u()};return e||r?_e(o,f=>{e&&pa(f,e),r&&pa(f,r),d()},"cleanup"):d(),s}insert(e,r,n){if(r.length<=0)return;const s=this.doc;s!==null?_e(s,i=>{const o=Xs(i,this,e,!n);n||(n={},o.currentAttributes.forEach((a,l)=>{n[l]=a})),Ko(i,this,o,r,n)}):this._pending.push(()=>this.insert(e,r,n))}insertEmbed(e,r,n){const s=this.doc;s!==null?_e(s,i=>{const o=Xs(i,this,e,!n);Ko(i,this,o,r,n||{})}):this._pending.push(()=>this.insertEmbed(e,r,n||{}))}delete(e,r){if(r===0)return;const n=this.doc;n!==null?_e(n,s=>{Oc(s,Xs(s,this,e,!0),r)}):this._pending.push(()=>this.delete(e,r))}format(e,r,n){if(r===0)return;const s=this.doc;s!==null?_e(s,i=>{const o=Xs(i,this,e,!1);o.right!==null&&Nc(i,this,o,r,n)}):this._pending.push(()=>this.format(e,r,n))}removeAttribute(e){this.doc!==null?_e(this.doc,r=>{Si(r,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,r){this.doc!==null?_e(this.doc,n=>{Ya(n,this,e,r)}):this._pending.push(()=>this.setAttribute(e,r))}getAttribute(e){return Xa(this,e)}getAttributes(){return ph(this)}_write(e){e.writeTypeRef(Ab)}}class Vo{constructor(e,r=()=>!0){this._filter=r,this._root=e,this._currentNode=e._start,this._firstCall=!0,e.doc??Ke()}[Symbol.iterator](){return this}next(){let e=this._currentNode,r=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(r)))do if(r=e.content.type,!e.deleted&&(r.constructor===as||r.constructor===on)&&r._start!==null)e=r._start;else for(;e!==null;){const n=e.next;if(n!==null){e=n;break}else e.parent===this._root?e=null:e=e.parent._item}while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class on extends De{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,r){super._integrate(e,r),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new on}clone(){const e=new on;return e.insert(0,this.toArray().map(r=>r instanceof De?r.clone():r)),e}get length(){return this.doc??Ke(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new Vo(this,e)}querySelector(e){e=e.toUpperCase();const n=new Vo(this,s=>s.nodeName&&s.nodeName.toUpperCase()===e).next();return n.done?null:n.value}querySelectorAll(e){return e=e.toUpperCase(),rn(new Vo(this,r=>r.nodeName&&r.nodeName.toUpperCase()===e))}_callObserver(e,r){Hi(this,e,new xb(this,r,e))}toString(){return ch(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,r={},n){const s=e.createDocumentFragment();return n!==void 0&&n._createAssociation(s,this),os(this,i=>{s.insertBefore(i.toDOM(e,r,n),null)}),s}insert(e,r){this.doc!==null?_e(this.doc,n=>{hh(n,this,e,r)}):this._prelimContent.splice(e,0,...r)}insertAfter(e,r){if(this.doc!==null)_e(this.doc,n=>{const s=e&&e instanceof De?e._item:e;Ci(n,this,s,r)});else{const n=this._prelimContent,s=e===null?0:n.findIndex(i=>i===e)+1;if(s===0&&e!==null)throw nn("Reference item not found");n.splice(s,0,...r)}}delete(e,r=1){this.doc!==null?_e(this.doc,n=>{fh(n,this,e,r)}):this._prelimContent.splice(e,r)}toArray(){return lh(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return uh(this,e)}slice(e=0,r=this.length){return ah(this,e,r)}forEach(e){os(this,e)}_write(e){e.writeTypeRef(Ob)}}class as extends on{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,r){super._integrate(e,r),this._prelimAttrs.forEach((n,s)=>{this.setAttribute(s,n)}),this._prelimAttrs=null}_copy(){return new as(this.nodeName)}clone(){const e=new as(this.nodeName),r=this.getAttributes();return xy(r,(n,s)=>{typeof n=="string"&&e.setAttribute(s,n)}),e.insert(0,this.toArray().map(n=>n instanceof De?n.clone():n)),e}toString(){const e=this.getAttributes(),r=[],n=[];for(const a in e)n.push(a);n.sort();const s=n.length;for(let a=0;a<s;a++){const l=n[a];r.push(l+'="'+e[l]+'"')}const i=this.nodeName.toLocaleLowerCase(),o=r.length>0?" "+r.join(" "):"";return`<${i}${o}>${super.toString()}</${i}>`}removeAttribute(e){this.doc!==null?_e(this.doc,r=>{Si(r,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,r){this.doc!==null?_e(this.doc,n=>{Ya(n,this,e,r)}):this._prelimAttrs.set(e,r)}getAttribute(e){return Xa(this,e)}hasAttribute(e){return gh(this,e)}getAttributes(e){return e?yb(this,e):ph(this)}toDOM(e=document,r={},n){const s=e.createElement(this.nodeName),i=this.getAttributes();for(const o in i){const a=i[o];typeof a=="string"&&s.setAttribute(o,a)}return os(this,o=>{s.appendChild(o.toDOM(e,r,n))}),n!==void 0&&n._createAssociation(s,this),s}_write(e){e.writeTypeRef(Nb),e.writeKey(this.nodeName)}}class xb extends Ui{constructor(e,r,n){super(e,n),this.childListChanged=!1,this.attributesChanged=new Set,r.forEach(s=>{s===null?this.childListChanged=!0:this.attributesChanged.add(s)})}}class vh{constructor(e,r){this.id=e,this.length=r}get deleted(){throw Nt()}mergeWith(e){return!1}write(e,r,n){throw Nt()}integrate(e,r){throw Nt()}}const Cb=0;class tr extends vh{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,r){r>0&&(this.id.clock+=r,this.length-=r),rh(e.doc.store,this)}write(e,r){e.writeInfo(Cb),e.writeLen(this.length-r)}getMissing(e,r){return null}}class Wi{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Wi(this.content)}splice(e){throw Nt()}mergeWith(e){return!1}integrate(e,r){}delete(e){}gc(e){}write(e,r){e.writeBuf(this.content)}getRef(){return 3}}class Ti{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Ti(this.len)}splice(e){const r=new Ti(this.len-e);return this.len=e,r}mergeWith(e){return this.len+=e.len,!0}integrate(e,r){Zd(e.deleteSet,r.id.client,r.id.clock,this.len),r.markDeleted()}delete(e){}gc(e){}write(e,r){e.writeLen(this.len-r)}getRef(){return 1}}const Sb=(t,e)=>new ys({guid:t,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class zi{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const r={};this.opts=r,e.gc||(r.gc=!1),e.autoLoad&&(r.autoLoad=!0),e.meta!==null&&(r.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new zi(Sb(this.doc.guid,this.opts))}splice(e){throw Nt()}mergeWith(e){return!1}integrate(e,r){this.doc._item=r,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,r){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}class _n{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new _n(this.embed)}splice(e){throw Nt()}mergeWith(e){return!1}integrate(e,r){}delete(e){}gc(e){}write(e,r){e.writeJSON(this.embed)}getRef(){return 5}}class Ie{constructor(e,r){this.key=e,this.value=r}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Ie(this.key,this.value)}splice(e){throw Nt()}mergeWith(e){return!1}integrate(e,r){const n=r.parent;n._searchMarker=null,n._hasFormatting=!0}delete(e){}gc(e){}write(e,r){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const Eb=xi("node_env")==="development";class an{constructor(e){this.arr=e,Eb&&Ud(e)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new an(this.arr)}splice(e){const r=new an(this.arr.slice(e));return this.arr=this.arr.slice(0,e),r}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,r){}delete(e){}gc(e){}write(e,r){const n=this.arr.length;e.writeLen(n-r);for(let s=r;s<n;s++){const i=this.arr[s];e.writeAny(i)}}getRef(){return 8}}class Kt{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Kt(this.str)}splice(e){const r=new Kt(this.str.slice(e));this.str=this.str.slice(0,e);const n=this.str.charCodeAt(e-1);return n>=55296&&n<=56319&&(this.str=this.str.slice(0,e-1)+"",r.str=""+r.str.slice(1)),r}mergeWith(e){return this.str+=e.str,!0}integrate(e,r){}delete(e){}gc(e){}write(e,r){e.writeString(r===0?this.str:this.str.slice(r))}getRef(){return 4}}const Tb=0,Mb=1,Ab=2,Nb=3,Ob=4;class fr{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new fr(this.type._copy())}splice(e){throw Nt()}mergeWith(e){return!1}integrate(e,r){this.type._integrate(e.doc,r)}delete(e){let r=this.type._start;for(;r!==null;)r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e),r=r.right;this.type._map.forEach(n=>{n.deleted?n.id.clock<(e.beforeState.get(n.id.client)||0)&&e._mergeStructs.push(n):n.delete(e)}),e.changed.delete(this.type)}gc(e){let r=this.type._start;for(;r!==null;)r.gc(e,!0),r=r.right;this.type._start=null,this.type._map.forEach(n=>{for(;n!==null;)n.gc(e,!0),n=n.left}),this.type._map=new Map}write(e,r){this.type._write(e)}getRef(){return 7}}const wh=(t,e,r)=>{const{client:n,clock:s}=e.id,i=new ze(Ee(n,s+r),e,Ee(n,s+r-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(r));return e.deleted&&i.markDeleted(),e.keep&&(i.keep=!0),e.redone!==null&&(i.redone=Ee(e.redone.client,e.redone.clock+r)),e.right=i,i.right!==null&&(i.right.left=i),t._mergeStructs.push(i),i.parentSub!==null&&i.right===null&&i.parent._map.set(i.parentSub,i),e.length=r,i};class ze extends vh{constructor(e,r,n,s,i,o,a,l){super(e,l.getLength()),this.origin=n,this.left=r,this.right=s,this.rightOrigin=i,this.parent=o,this.parentSub=a,this.redone=null,this.content=l,this.info=this.content.isCountable()?hc:0}set marker(e){(this.info&Bo)>0!==e&&(this.info^=Bo)}get marker(){return(this.info&Bo)>0}get keep(){return(this.info&dc)>0}set keep(e){this.keep!==e&&(this.info^=dc)}get countable(){return(this.info&hc)>0}get deleted(){return(this.info&Uo)>0}set deleted(e){this.deleted!==e&&(this.info^=Uo)}markDeleted(){this.info|=Uo}getMissing(e,r){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=et(r,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=et(r,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===yi&&this.id.client!==this.parent.client&&this.parent.clock>=et(r,this.parent.client))return this.parent.client;if(this.origin&&(this.left=Sc(e,r,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=or(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===tr||this.right&&this.right.constructor===tr)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===ze?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===ze&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===yi){const n=Jo(r,this.parent);n.constructor===tr?this.parent=null:this.parent=n.content.type}return null}integrate(e,r){if(r>0&&(this.id.clock+=r,this.left=Sc(e,e.doc.store,Ee(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(r),this.length-=r),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let n=this.left,s;if(n!==null)s=n.right;else if(this.parentSub!==null)for(s=this.parent._map.get(this.parentSub)||null;s!==null&&s.left!==null;)s=s.left;else s=this.parent._start;const i=new Set,o=new Set;for(;s!==null&&s!==this.right;){if(o.add(s),i.add(s),Gs(this.origin,s.origin)){if(s.id.client<this.id.client)n=s,i.clear();else if(Gs(this.rightOrigin,s.rightOrigin))break}else if(s.origin!==null&&o.has(Jo(e.doc.store,s.origin)))i.has(Jo(e.doc.store,s.origin))||(n=s,i.clear());else break;s=s.right}this.left=n}if(this.left!==null){const n=this.left.right;this.right=n,this.left.right=this}else{let n;if(this.parentSub!==null)for(n=this.parent._map.get(this.parentSub)||null;n!==null&&n.left!==null;)n=n.left;else n=this.parent._start,this.parent._start=this;this.right=n}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),rh(e.doc.store,this),this.content.integrate(e,this),Tc(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new tr(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:Ee(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&Gs(e.origin,this.lastId)&&this.right===e&&Gs(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const r=this.parent._searchMarker;return r&&r.forEach(n=>{n.p===e&&(n.p=this,!this.deleted&&this.countable&&(n.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const r=this.parent;this.countable&&this.parentSub===null&&(r._length-=this.length),this.markDeleted(),Zd(e.deleteSet,this.id.client,this.id.clock,this.length),Tc(e,r,this.parentSub),this.content.delete(e)}}gc(e,r){if(!this.deleted)throw Tr();this.content.gc(e),r?ab(e,this,new tr(this.id,this.length)):this.content=new Ti(this.length)}write(e,r){const n=r>0?Ee(this.id.client,this.id.clock+r-1):this.origin,s=this.rightOrigin,i=this.parentSub,o=this.content.getRef()&Gm|(n===null?0:wi)|(s===null?0:Ld)|(i===null?0:Vm);if(e.writeInfo(o),n!==null&&e.writeLeftID(n),s!==null&&e.writeRightID(s),n===null&&s===null){const a=this.parent;if(a._item!==void 0){const l=a._item;if(l===null){const u=sb(a);e.writeParentInfo(!0),e.writeString(u)}else e.writeParentInfo(!1),e.writeLeftID(l.id)}else a.constructor===String?(e.writeParentInfo(!0),e.writeString(a)):a.constructor===yi?(e.writeParentInfo(!1),e.writeLeftID(a)):Tr();i!==null&&e.writeString(i)}this.content.write(e,r)}}const xh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},Ch="__ $YJS$ __";xh[Ch]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");xh[Ch]=!0;const jb=qa("TOGGLE_CONNECT_COMMAND");var Ib=Object.defineProperty,Pb=(t,e,r)=>e in t?Ib(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,z=(t,e,r)=>Pb(t,typeof e!="symbol"?e+"":e,r);const Go=t=>Oe(_p(t)),Mr=yd("cid",{parse:t=>typeof t=="string"?t:void 0}),Ar=yd("segment",{parse:t=>typeof t=="string"?t:void 0}),ya="unknown",Sh=1;class $r extends ur{constructor(e="",r,n,s){super(s),z(this,"__tag"),z(this,"__marker"),z(this,"__unknownAttributes"),this.__tag=e,this.__marker=r,this.__unknownAttributes=n}static getType(){return"unknown"}static clone(e){const{__tag:r,__marker:n,__unknownAttributes:s,__key:i}=e;return new $r(r,n,s,i)}static importDOM(){return{[ya]:e=>$b(e)?{conversion:Rb,priority:1}:null}}static importJSON(e){return Eh().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setTag(e.tag).setMarker(e.marker).setUnknownAttributes(e.unknownAttributes)}setTag(e){if(this.__tag===e)return this;const r=this.getWritable();return r.__tag=e,r}getTag(){return this.getLatest().__tag}setMarker(e){if(this.__marker===e)return this;const r=this.getWritable();return r.__marker=e,r}getMarker(){return this.getLatest().__marker}setUnknownAttributes(e){const r=this.getWritable();return r.__unknownAttributes=e,r}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement(ya);return e.style.display="none",e}updateDOM(){return!1}exportDOM(){return{element:null}}exportJSON(){return{...super.exportJSON(),type:this.getType(),tag:this.getTag(),marker:this.getMarker(),unknownAttributes:this.getUnknownAttributes(),version:Sh}}canBeEmpty(){return!0}isInline(){return!0}extractWithChild(){return!1}excludeFromCopy(e){return e!=="clone"}}function Rb(t){const e=t.getAttribute("data-tag")??"",r=t.getAttribute("data-marker")??"";return{node:Eh(e,r)}}function Eh(t,e,r){return Oe(new $r(t,e,r))}function $b(t){return(t==null?void 0:t.tagName)===ya}function bs(t){return t instanceof $r}const ls="id",Th=1;class ct extends ur{constructor(e="",r,n){super(n),z(this,"__marker",ls),z(this,"__code"),z(this,"__unknownAttributes"),this.__code=e,this.__unknownAttributes=r}static getType(){return"book"}static clone(e){const{__code:r,__unknownAttributes:n,__key:s}=e;return new ct(r,n,s)}static importJSON(e){const{code:r}=e;return Mh(r).updateFromJSON(e)}static isValidBookCode(e){return Lf(e)}updateFromJSON(e){return super.updateFromJSON(e).setCode(e.code).setUnknownAttributes(e.unknownAttributes)}getMarker(){return this.getLatest().__marker}setCode(e){if(this.__code===e)return this;const r=this.getWritable();return r.__code=e,r}getCode(){return this.getLatest().__code}setUnknownAttributes(e){const r=this.getWritable();return r.__unknownAttributes=e,r}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("p");return e.setAttribute("data-marker",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`),e.setAttribute("data-code",this.__code),e}updateDOM(){return!1}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),code:this.getCode(),unknownAttributes:this.getUnknownAttributes(),version:Th}}}function Mh(t,e){return Oe(new ct(t,e))}function Ot(t){return t instanceof ct}function qb(t){return(t==null?void 0:t.type)===ct.getType()}const ae="",ba="",Qa=`${ae}|`,Ji="p",jt="+",ln="-",Mi="chapter",_a="verse",jc="invalid",Lb="text-spacing",Db="formatted-font",Fb="marker-",Za="external-usj-mutation",Ah="selection-change",ka="cursor-change",va="annotation-change",wa="delta-change",Ub=[Za,Ah,ka,va,wa],Ai="c",Nh=1;class kt extends ur{constructor(e="",r,n,s,i,o){super(o),z(this,"__marker"),z(this,"__number"),z(this,"__sid"),z(this,"__altnumber"),z(this,"__pubnumber"),z(this,"__unknownAttributes"),this.__marker=Ai,this.__number=e,this.__sid=r,this.__altnumber=n,this.__pubnumber=s,this.__unknownAttributes=i}static getType(){return"chapter"}static clone(e){const{__number:r,__sid:n,__altnumber:s,__pubnumber:i,__unknownAttributes:o,__key:a}=e;return new kt(r,n,s,i,o,a)}static importJSON(e){return Oh().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setNumber(e.number).setSid(e.sid).setAltnumber(e.altnumber).setPubnumber(e.pubnumber).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const r=this.getWritable();return r.__marker=e,r}getMarker(){return this.getLatest().__marker}setNumber(e){if(this.__number===e)return this;const r=this.getWritable();return r.__number=e,r}getNumber(){return this.getLatest().__number}setSid(e){if(this.__sid===e)return this;const r=this.getWritable();return r.__sid=e,r}getSid(){return this.getLatest().__sid}setAltnumber(e){if(this.__altnumber===e)return this;const r=this.getWritable();return r.__altnumber=e,r}getAltnumber(){return this.getLatest().__altnumber}setPubnumber(e){if(this.__pubnumber===e)return this;const r=this.getWritable();return r.__pubnumber=e,r}getPubnumber(){return this.getLatest().__pubnumber}setUnknownAttributes(e){const r=this.getWritable();return r.__unknownAttributes=e,r}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("p");return e.setAttribute("data-marker",this.__marker),e.classList.add(Mi,`usfm_${this.__marker}`),e.setAttribute("data-number",this.__number),e}updateDOM(){return!1}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),number:this.getNumber(),sid:this.getSid(),altnumber:this.getAltnumber(),pubnumber:this.getPubnumber(),unknownAttributes:this.getUnknownAttributes(),version:Nh}}}function Oh(t,e,r,n,s){return Oe(new kt(t,e,r,n,s))}function el(t){return t instanceof kt}function Bb(t){return(t==null?void 0:t.type)===kt.getType()}const jh=["fr","fq","fqa","fk","ft","fl","fw","fp","fv","fdc","fm"],Ih=["xo","xop","xk","xq","xt","xta","xot","xnt","xdc"],Hb=["ca","cp","va","vp","add","bk","dc","em","jmp","k","nd","ord","pn","png","qt","rb","rq","sig","sls","tl","w","wa","wg","wh","wj","bd","it","bdit","no","sc","sup","ior","iqt","qac","qs","litl","lik","liv","liv1","liv2","liv3","liv4","liv5",...jh,...Ih],Ph=1;class Se extends ur{constructor(e="",r,n){super(n),z(this,"__marker"),z(this,"__unknownAttributes"),this.__marker=e,this.__unknownAttributes=r}static getType(){return"char"}static clone(e){const{__marker:r,__unknownAttributes:n,__key:s}=e;return new Se(r,n,s)}static isValidMarker(e){return e!==void 0&&Hb.includes(e)}static isValidFootnoteMarker(e){return e!==void 0&&jh.includes(e)}static isValidCrossReferenceMarker(e){return e!==void 0&&Ih.includes(e)}static importDOM(){return{span:e=>zb(e)?{conversion:Wb,priority:1}:null}}static importJSON(e){return Tt().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const r=this.getWritable();return r.__marker=e,r}getMarker(){return this.getLatest().__marker}setUnknownAttributes(e){const r=this.getWritable();return r.__unknownAttributes=e,r}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("span");return e.setAttribute("data-marker",this.__marker),e.setAttribute("title",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`),e}updateDOM(){return!1}exportDOM(e){const{element:r}=super.exportDOM(e);return r&&dr(r)&&(r.setAttribute("data-marker",this.getMarker()),r.classList.add(this.getType(),`usfm_${this.getMarker()}`)),{element:r}}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),unknownAttributes:this.getUnknownAttributes(),version:Ph}}insertNewAfter(e,r){const n=Tt(this.getMarker());return n.setTextFormat(e.format),n.setTextStyle(e.style),n.setDirection(this.getDirection()),n.setFormat(this.getFormatType()),n.setStyle(this.getTextStyle()),this.insertAfter(n,r),n}canBeEmpty(){return!1}isInline(){return!0}}function Wb(t){const e=t.getAttribute("data-marker")??"f";return{node:Tt(e)}}function Tt(t,e){return Oe(new Se(t,e))}function zb(t){if(!t)return!1;const e=t.getAttribute("data-marker")??"";return Se.isValidMarker(e)&&t.classList.contains(Se.getType())}function ge(t){return t instanceof Se}function Jb(t){return(t==null?void 0:t.type)===Se.getType()}const Rh=1,Kb="c",$h="span";class Yt extends fn{constructor(e="",r=!1,n,s,i,o,a){super(a),z(this,"__marker"),z(this,"__number"),z(this,"__showMarker"),z(this,"__sid"),z(this,"__altnumber"),z(this,"__pubnumber"),z(this,"__unknownAttributes"),this.__marker=Kb,this.__number=e,this.__showMarker=r,this.__sid=n,this.__altnumber=s,this.__pubnumber=i,this.__unknownAttributes=o}static getType(){return"immutable-chapter"}static clone(e){const{__number:r,__showMarker:n,__sid:s,__altnumber:i,__pubnumber:o,__unknownAttributes:a,__key:l}=e;return new Yt(r,n,s,i,o,a,l)}static importDOM(){return{span:e=>qh(e)?{conversion:Vb,priority:1}:null}}static importJSON(e){return tl().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setNumber(e.number).setShowMarker(e.showMarker).setSid(e.sid).setAltnumber(e.altnumber).setPubnumber(e.pubnumber).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const r=this.getWritable();return r.__marker=e,r}getMarker(){return this.getLatest().__marker}setNumber(e){if(this.__number===e)return this;const r=this.getWritable();return r.__number=e,r}getNumber(){return this.getLatest().__number}setShowMarker(e=!1){if(this.__showMarker===e)return this;const r=this.getWritable();return r.__showMarker=e,r}getShowMarker(){return this.getLatest().__showMarker}setSid(e){if(this.__sid===e)return this;const r=this.getWritable();return r.__sid=e,r}getSid(){return this.getLatest().__sid}setAltnumber(e){if(this.__altnumber===e)return this;const r=this.getWritable();return r.__altnumber=e,r}getAltnumber(){return this.getLatest().__altnumber}setPubnumber(e){if(this.__pubnumber===e)return this;const r=this.getWritable();return r.__pubnumber=e,r}getPubnumber(){return this.getLatest().__pubnumber}setUnknownAttributes(e){const r=this.getWritable();return r.__unknownAttributes=e,r}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement($h);return e.setAttribute("data-marker",this.__marker),e.classList.add(Mi,`usfm_${this.__marker}`),this.__showMarker&&e.classList.add("marker"),e.setAttribute("data-number",this.__number),e}updateDOM(){return!1}exportDOM(e){const{element:r}=super.exportDOM(e);return r&&dr(r)&&(r.setAttribute("data-marker",this.getMarker()),r.classList.add(Mi,`usfm_${this.getMarker()}`),r.setAttribute("data-number",this.getNumber())),{element:r}}decorate(){return this.getShowMarker()?ks(this.getMarker(),this.getNumber()):this.getNumber()}exportJSON(){return{type:this.getType(),marker:this.getMarker(),number:this.getNumber(),showMarker:this.getShowMarker(),sid:this.getSid(),altnumber:this.getAltnumber(),pubnumber:this.getPubnumber(),unknownAttributes:this.getUnknownAttributes(),version:Rh}}isInline(){return!1}isKeyboardSelectable(){return!1}}function Vb(t){const e=t.getAttribute("data-number")??"0";return{node:tl(e)}}function tl(t,e,r,n,s,i){return Oe(new Yt(t,e,r,n,s,i))}function qh(t){return t?t.classList.contains(Mi)&&t.tagName.toLowerCase()===$h:!1}function _s(t){return t instanceof Yt}function Gb(t){return(t==null?void 0:t.type)===Yt.getType()}const Lh=1;class ar extends La{static getType(){return"implied-para"}static clone(e){return new ar(e.__key)}static importJSON(e){return yt().updateFromJSON(e)}getMarker(){return Ji}exportJSON(){return{...super.exportJSON(),type:this.getType(),version:Lh}}insertNewAfter(e,r){const n=yt();return n.setTextFormat(e.format),n.setTextStyle(e.style),n.setDirection(this.getDirection()),n.setFormat(this.getFormatType()),n.setStyle(this.getTextStyle()),this.insertAfter(n,r),n}}function yt(){return Oe(new ar)}function Vt(t){return t instanceof ar}function rl(t){return(t==null?void 0:t.type)===ar.getType()}const Nr="zmsc-s",en="zmsc-e",Yb=[Nr,en],Xb=["ts-s","ts-e","t-s","t-e","ts","qt1-s","qt1-e","qt2-s","qt2-e","qt3-s","qt3-e","qt4-s","qt4-e","qt5-s","qt5-e","qt-s","qt-e",Nr,en],Dh=1;class It extends fn{constructor(e="",r,n,s,i){super(i),z(this,"__marker"),z(this,"__sid"),z(this,"__eid"),z(this,"__unknownAttributes"),this.__marker=e,this.__sid=r,this.__eid=n,this.__unknownAttributes=s}static getType(){return"ms"}static clone(e){const{__marker:r,__sid:n,__eid:s,__unknownAttributes:i,__key:o}=e;return new It(r,n,s,i,o)}static importJSON(e){return Fh().updateFromJSON(e)}static isValidMarker(e){return e!==void 0&&(Xb.includes(e)||e.startsWith("z"))}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setSid(e.sid).setEid(e.eid).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const r=this.getWritable();return r.__marker=e,r}getMarker(){return this.getLatest().__marker}setSid(e){if(this.__sid===e)return this;const r=this.getWritable();return r.__sid=e,r}getSid(){return this.getLatest().__sid}setEid(e){if(this.__eid===e)return this;const r=this.getWritable();return r.__eid=e,r}getEid(){return this.getLatest().__eid}setUnknownAttributes(e){const r=this.getWritable();return r.__unknownAttributes=e,r}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("span");return e.setAttribute("data-marker",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`),e}updateDOM(){return!1}decorate(){return""}exportJSON(){return{type:this.getType(),marker:this.getMarker(),sid:this.getSid(),eid:this.getEid(),unknownAttributes:this.getUnknownAttributes(),version:Dh}}isKeyboardSelectable(){return!1}}function Qb(t){return Yb.includes(t)}function Fh(t,e,r,n){return Oe(new It(t,e,r,n))}function Ki(t){return t instanceof It}const nl="f",Zb=[nl,"fe","ef","efe","x","ex"],Uh=1;class Pe extends ur{constructor(e=nl,r,n=!0,s,i,o){super(o),z(this,"__marker"),z(this,"__caller"),z(this,"__isCollapsed"),z(this,"__category"),z(this,"__unknownAttributes"),this.__marker=e,this.__caller=r??(e==="x"||e==="ex"?ln:jt),this.__isCollapsed=n,this.__category=s,this.__unknownAttributes=i}static getType(){return"note"}static clone(e){const{__marker:r,__caller:n,__isCollapsed:s,__category:i,__unknownAttributes:o,__key:a}=e;return new Pe(r,n,s,i,o,a)}static importDOM(){return{span:e=>t_(e)?{conversion:e_,priority:1}:null}}static importJSON(e){return sl().updateFromJSON(e)}static isValidMarker(e){return e!==void 0&&Zb.includes(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setCaller(e.caller).setIsCollapsed(e.isCollapsed).setCategory(e.category).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const r=this.getWritable();return r.__marker=e,r}getMarker(){return this.getLatest().__marker}setCaller(e){if(this.__caller===e)return this;const r=this.getWritable();return r.__caller=e,r}getCaller(){return this.getLatest().__caller}setIsCollapsed(e){if(this.__isCollapsed===e)return this;const r=this.getWritable();return r.__isCollapsed=e,r}toggleIsCollapsed(){const e=this.getWritable();return e.__isCollapsed=!e.__isCollapsed,e}getIsCollapsed(){return this.getLatest().__isCollapsed}setCategory(e){if(this.__category===e)return this;const r=this.getWritable();return r.__category=e,r}getCategory(){return this.getLatest().__category}setUnknownAttributes(e){const r=this.getWritable();return r.__unknownAttributes=e,r}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("span");return e.setAttribute("data-marker",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`,this.__isCollapsed?"collapsed":"expanded"),e.setAttribute("data-caller",this.__caller),e}updateDOM(e){return e.__isCollapsed!==this.__isCollapsed}exportDOM(e){const{element:r}=super.exportDOM(e);return r&&dr(r)&&(r.setAttribute("data-marker",this.getMarker()),r.classList.add(this.getType(),`usfm_${this.getMarker()}`,this.getIsCollapsed()?"collapsed":"expanded"),r.setAttribute("data-caller",this.getCaller())),{element:r}}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),caller:this.getCaller(),isCollapsed:this.getIsCollapsed(),category:this.getCategory(),unknownAttributes:this.getUnknownAttributes(),version:Uh}}canBeEmpty(){return!1}isInline(){return!0}}function e_(t){const e=t.getAttribute("data-marker")??"f",r=t.getAttribute("data-caller")??"",n=t.classList.contains("collapsed");return{node:sl(e,r,n)}}function sl(t,e,r,n,s){return Oe(new Pe(t,e,r,n,s))}function t_(t){if(!t)return!1;const e=t.getAttribute("data-marker")??"";return Pe.isValidMarker(e)&&t.classList.contains(Pe.getType())}function oe(t){return t instanceof Pe}const r_=["ide","sts","rem","h","toc1","toc2","toc3","toca1","toca2","toca3","imt","imt1","imt2","imt3","imt4","is","is1","is2","ip","ipi","im","imi","ipq","imq","ipr","iq","iq1","iq2","iq3","ili","ili1","ili2","ib","iot","io","io1","io2","io3","io4","iex","imte","imte1","imte2","ie","mt","mt1","mt2","mt3","mt4","mte","mte1","mte2","cl","cd","ms","ms1","ms2","ms3","mr","s","s1","s2","s3","s4","sr","r","d","sp","sd","sd1","sd2","sd3","sd4",Ji,"m","po","cls","pr","pc","pm","pmo","pmc","pmr","pi","pi1","pi2","pi3","mi","lit","nb","q","q1","q2","q3","q4","qr","qc","qa","qm","qm1","qm2","qm3","qd","b","lh","li","li1","li2","li3","li4","lf","lim","lim1","lim2","lim3","lim4","pb"],Bh=1;class tt extends La{constructor(e=Ji,r,n){super(n),z(this,"__marker"),z(this,"__unknownAttributes"),this.__marker=e,this.__unknownAttributes=r}static getType(){return"para"}static clone(e){const{__marker:r,__unknownAttributes:n,__key:s}=e;return new tt(r,n,s)}static isValidMarker(e){return e!==void 0&&r_.includes(e)}static importDOM(){return{p:()=>({conversion:n_,priority:1})}}static importJSON(e){return cs().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const r=this.getWritable();return r.__marker=e,r}getMarker(){return this.getLatest().__marker}setUnknownAttributes(e){const r=this.getWritable();return r.__unknownAttributes=e,r}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("p");return e.setAttribute("data-marker",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`),e}exportDOM(e){const{element:r}=super.exportDOM(e);return r&&dr(r)&&(r.setAttribute("data-marker",this.getMarker()),r.classList.add(this.getType(),`usfm_${this.getMarker()}`)),{element:r}}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),unknownAttributes:this.getUnknownAttributes(),version:Bh}}insertNewAfter(e,r){const n=cs(this.getMarker());return n.setTextFormat(e.format),n.setTextStyle(e.style),n.setDirection(this.getDirection()),n.setFormat(this.getFormatType()),n.setStyle(this.getTextStyle()),this.insertAfter(n,r),n}}function n_(t){const e=t.getAttribute("data-marker")??void 0,r=cs(e);if(t.style){r.setFormat(t.style.textAlign);const n=parseInt(t.style.textIndent,10)/20;n>0&&r.setIndent(n)}return{node:r}}function cs(t,e){return Oe(new tt(t,e))}function Je(t){return t instanceof tt}function s_(t){return(t==null?void 0:t.type)===tt.getType()}const Ni="v",Hh=1;class Ge extends Mt{constructor(e="",r,n,s,i,o,a){super(r??e,a),z(this,"__marker"),z(this,"__number"),z(this,"__sid"),z(this,"__altnumber"),z(this,"__pubnumber"),z(this,"__unknownAttributes"),this.__marker=Ni,this.__number=e,this.__sid=n,this.__altnumber=s,this.__pubnumber=i,this.__unknownAttributes=o}static getType(){return"verse"}static clone(e){const{__number:r,__text:n,__sid:s,__altnumber:i,__pubnumber:o,__unknownAttributes:a,__key:l}=e;return new Ge(r,n,s,i,o,a,l)}static importJSON(e){return Wh().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setNumber(e.number).setSid(e.sid).setAltnumber(e.altnumber).setPubnumber(e.pubnumber).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const r=this.getWritable();return r.__marker=e,r}getMarker(){return this.getLatest().__marker}setNumber(e){if(this.__number===e)return this;const r=this.getWritable();return r.__number=e,r}getNumber(){return this.getLatest().__number}setSid(e){if(this.__sid===e)return this;const r=this.getWritable();return r.__sid=e,r}getSid(){return this.getLatest().__sid}setAltnumber(e){if(this.__altnumber===e)return this;const r=this.getWritable();return r.__altnumber=e,r}getAltnumber(){return this.getLatest().__altnumber}setPubnumber(e){if(this.__pubnumber===e)return this;const r=this.getWritable();return r.__pubnumber=e,r}getPubnumber(){return this.getLatest().__pubnumber}setUnknownAttributes(e){const r=this.getWritable();return r.__unknownAttributes=e,r}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(e){const r=super.createDOM(e);return r.setAttribute("data-marker",this.__marker),r.classList.add(_a,`usfm_${this.__marker}`),r.setAttribute("data-number",this.__number),r}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),number:this.getNumber(),sid:this.getSid(),altnumber:this.getAltnumber(),pubnumber:this.getPubnumber(),unknownAttributes:this.getUnknownAttributes(),version:Hh}}}function Wh(t,e,r,n,s,i){return Oe(new Ge(t,e,r,n,s,i))}function il(t){return t instanceof Ge}function i_(t){return(t==null?void 0:t.type)===Ge.getType()}function o_(t){return Bb(t)||Gb(t)}function at(t){return el(t)||_s(t)}function a_(t,e){return t.find(r=>at(r)&&r.getNumber()===e.toString())}function l_(t,e=!1){return t.find((r,n)=>(!e||n>0)&&at(r))}function ol(t){var e;if(!t)return;if(at(t))return t;let r=(e=t.getTopLevelElement())==null?void 0:e.getPreviousSibling();for(;r&&!at(r);)r=r.getPreviousSibling();if(r&&at(r))return r}function zh(t){let e=t;for(;e!==null;){if(oe(e))return e;e=e.getParent()}}function c_(t){return Ot(t)||el(t)||ge(t)||_s(t)||Vt(t)||Ki(t)||Je(t)||oe(t)||il(t)||bs(t)}function u_(t){var e;if(t.anchor.type==="element"){const n=t.anchor.getNode(),s=t.anchor.offset;if(s<n.getChildrenSize())return n.getChildAtIndex(s)}const r=t.anchor.getNode();return r.getNextSibling()??((e=r.getParent())==null?void 0:e.getNextSibling())??null}function d_(t){var e;const r=t.anchor.offset;if(t.anchor.type==="element"&&r>0)return t.anchor.getNode().getChildAtIndex(r-1);const n=t.anchor.getNode();return n.getPreviousSibling()??((e=n.getParent())==null?void 0:e.getPreviousSibling())??null}function mt(t){return Je(t)||Vt(t)}function h_(t,e){let r=t.getParent();for(;r;){if(r.getKey()===e)return!0;r=r.getParent()}return!1}function Or(t,e){const r=gs(e,Mr),n=!!(t.cid&&r),s=!t.cid&&!r;return t.style===e.getMarker()&&(s||n&&t.cid===r)}function f_(t,e){const r=ve(t)?t:t.getParent(),n=ve(e)?e:e.getParent(),s=r&&n?kp(r,n):void 0;return s?s.commonAncestor:void 0}function p_(t){const e=t.getStartEndPoints();if(!e)return;const[r,n]=e,s=t.isBackward()?r:n;t.focus.set(s.key,s.offset,s.type),t.anchor.set(s.key,s.offset,s.type)}function al(t){return(t==null?void 0:t.type)===Mt.getType()}function g_(t,e){if(!e)return;const r=t.findIndex(n=>n===e);r&&(t.length=r)}function m_(t,e){if(!e)return t;const r=e.getIndexWithinParent();return t.splice(r+1,t.length-r-1)}function Xt(t){return`\\${t}`}function cn(t){return`\\${t}*`}function Jh(t,e,r){const n=Xt(t);if(e!=null&&e.startsWith(n)){const s=parseInt(e.slice(n.length),10);isNaN(s)||(r=s.toString())}return r}function ks(t,e){let r=Xt(t);return e&&(r+=`${ae}${e}`),r+=" ",r}function Kh(t){return al(t)&&t.text!==ae?t.text:Jb(t)?t.children.map(e=>Kh(e)).join(""):""}function y_(t){return t.map(e=>Kh(e)).filter(e=>e.length>0).join(" ").trim()}function ll(t){return ae+t+" "}function cl(t){const e=[];for(const r of t){if(!ge(r))continue;const n=r.getTextContent();n!==ae&&n.length>0&&e.push(n)}return e.join(" ").trim()}function Re(t,e=Uf){const r={...t};return e.forEach(n=>{Reflect.deleteProperty(r,n)}),Object.keys(r).length===0?void 0:r}function b_(t,e){const r=e.getElementByKey(t.getKey());return r?r.tagName.toLowerCase():void 0}function Ne(t){return Object.fromEntries(Object.entries(t).filter(([,e])=>e!==void 0))}function Vh(t){if(!t)return;const e=t.getNodes();if(e.length>0)return t.isBackward()?e[e.length-1]:e[0]}function xa(t,e){if(!e)return(t+1).toString();const r=e.split("-");if(r.length===2)return parseInt(r[1])?`${parseInt(r[1])+1}`:`${parseInt(r[0])+1}`;const n=RegExp(/^(\d+)([a-yA-Y]{1,3})$/).exec(e);if(!n)return(parseInt(e)+1).toString();const s=String.fromCharCode(n[2].charCodeAt(0)+1);return`${n[1]}${s}`}function ul(t,e){if(!e)return!1;const r=e.split("-").map(n=>parseInt(n));if(r.length<1||r.length>2||r[0]>r[1])throw new Error("isVerseInRange: invalid range");return r.length===1?t===r[0]:r.length===2&&isNaN(r[1])?t>=r[0]:(r.length===2&&isNaN(r[0])||t>=r[0])&&t<=r[1]}function __(t){return!!t&&t.includes("-")}const k_=1;class qr extends Mt{constructor(e="",r="opening",n){super(Yo(e,r),n),z(this,"__marker"),z(this,"__markerSyntax"),this.__marker=e,this.__markerSyntax=r}static getType(){return"marker"}static clone(e){return new qr(e.__marker,e.__markerSyntax,e.__key)}static importJSON(e){return un().updateFromJSON(e)}updateFromJSON(e){const{marker:r,markerSyntax:n="opening"}=e;return super.updateFromJSON(e).setMarker(r).setMarkerSyntax(n)}setMarker(e){if(this.__marker===e)return this;const r=this.getWritable();return r.__marker=e,r.__text=Yo(e,r.__markerSyntax),r}getMarker(){return this.getLatest().__marker}setMarkerSyntax(e){if(this.__markerSyntax===e)return this;const r=this.getWritable();return r.__markerSyntax=e,r.__text=Yo(r.__marker,e),r}getMarkerSyntax(){return this.getLatest().__markerSyntax}createDOM(e){const r=super.createDOM(e);return r.setAttribute("data-marker",this.__marker),r.classList.add(this.__markerSyntax),r}exportJSON(){return{...super.exportJSON(),type:this.getType(),text:this.getTextContent(),marker:this.getMarker(),markerSyntax:this.getMarkerSyntax(),version:k_}}}function un(t,e){return Oe(new qr(t,e))}function vs(t){return t instanceof qr}function Yo(t,e){return e==="closing"?cn(t):e==="selfClosing"?cn(""):Xt(t)}const ir="internal-comment",v_=[ir],w_={},x_=1;class Le extends ur{constructor(e=w_,r){super(r),z(this,"__typedIDs"),this.__typedIDs=e}static getType(){return"typed-mark"}static clone(e){const r=JSON.parse(JSON.stringify(e.__typedIDs));return new Le(r,e.__key)}static isReservedType(e){return v_.includes(e)}static importDOM(){return null}static importJSON(e){return us().updateFromJSON(e)}exportJSON(){return{...super.exportJSON(),type:this.getType(),typedIDs:this.getTypedIDs(),version:x_}}createDOM(e){const r=document.createElement("mark");for(const[n,s]of Object.entries(this.__typedIDs))nr(r,Qs(e.theme.typedMark,n)),s.length>1&&nr(r,Qs(e.theme.typedMarkOverlap,n));return r}updateDOM(e,r,n){for(const[s,i]of Object.entries(this.__typedIDs)){const o=e.__typedIDs[s].length,a=i.length,l=Qs(n.theme.typedMark,s),u=Qs(n.theme.typedMarkOverlap,s);o!==a&&(o===0?a===1&&nr(r,l):a===0&&ra(r,l),o===1?a===2&&nr(r,u):a===1&&ra(r,u))}return!1}updateFromJSON(e){return super.updateFromJSON(e).setTypedIDs(e.typedIDs)}hasID(e,r){const n=this.getTypedIDs()[e];if(!n)return!1;for(const s of n)if(r===s)return!0;return!1}getTypedIDs(){const e=this.getLatest();return Fe(e)?e.__typedIDs:{}}setTypedIDs(e){const r=this.getWritable();return r.__typedIDs=e,r}addID(e,r){const n=this.getWritable();if(!Fe(n))return;const s=n.__typedIDs[e]??[];n.__typedIDs[e]=s;for(const i of s)if(r===i)return;s.push(r)}deleteID(e,r){const n=this.getWritable();if(!Fe(n))return;const s=n.__typedIDs[e];for(let i=0;i<s.length;i++)if(r===s[i]){s.splice(i,1);return}}hasNoIDsForEveryType(){return Object.values(this.getTypedIDs()).every(e=>e===void 0||e.length===0)}insertNewAfter(e,r=!0){const n=us(this.__typedIDs);return this.insertAfter(n,r),n}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}canBeEmpty(){return!1}isInline(){return!0}extractWithChild(e,r,n){if(!X(r)||n==="html")return!1;const s=r.anchor,i=r.focus,o=s.getNode(),a=i.getNode(),l=r.isBackward()?s.offset-i.offset:i.offset-s.offset;return this.isParentOf(o)&&this.isParentOf(a)&&this.getTextContent().length===l}excludeFromCopy(e){return e!=="clone"}}function Qs(t,e){return`${t}-${e}`}function us(t){return Oe(new Le(t))}function Fe(t){return t instanceof Le}function C_(t){return(t==null?void 0:t.type)===Le.getType()}function Gh(t){const e=t.getChildren();let r=null;for(const n of e)r===null?t.insertBefore(n):r.insertAfter(n),r=n;t.remove()}function Yh(t,e,r,n){const s=t.getNodes(),i=t.anchor.offset,o=t.focus.offset,a=s.length,l=t.isBackward(),u=l?o:i,d=l?i:o;let f,h;for(let p=0;p<a;p++){const y=s[p];if(ve(h)&&h.isParentOf(y))continue;const b=p===0,S=p===a-1;let C=null;if(ee(y)){const x=y.getTextContentSize(),A=b?u:0,O=S?d:x;if(A===0&&O===0)continue;const $=y.splitText(A,O);C=$.length>1&&($.length===3||b&&!S||O===x)?$[1]:$[0]}else{if(Fe(y))continue;ve(y)&&y.isInline()&&(C=y)}if(C!==null){if(C&&C.is(f))continue;const x=C.getParent();(x==null||!x.is(f))&&(h=void 0),f=x,h===void 0&&(h=us({[e]:[r]}),C.insertBefore(h)),h.append(C)}else f=void 0,h=void 0}e===ir&&ve(h)&&(l?h.selectStart():h.selectEnd())}function S_(t,e,r){let n=t;for(;n!==null;){if(Fe(n))return n.getTypedIDs()[e];if(ee(n)&&r===n.getTextContentSize()){const s=n.getNextSibling();if(Fe(s))return s.getTypedIDs()[e]}n=n.getParent()}}function Ic(t){return`external-${t}`}const Xh=1;class pr extends fn{constructor(e="",r="",n){super(n),z(this,"__textType"),z(this,"__text"),this.__textType=e,this.__text=r}static getType(){return"immutable-typed-text"}static clone(e){const{__textType:r,__text:n,__key:s}=e;return new pr(r,n,s)}static importDOM(){return{span:e=>T_(e)?{conversion:E_,priority:1}:null}}static importJSON(e){return dn().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setTextType(e.textType).setTextContent(e.text)}setTextType(e){if(this.__textType===e)return this;const r=this.getWritable();return r.__textType=e,r}getTextType(){return this.getLatest().__textType}setTextContent(e){if(this.__text===e)return this;const r=this.getWritable();return r.__text=e,r}getTextContent(){return this.getLatest().__text}createDOM(){const e=document.createElement("span");return e.setAttribute("data-text-type",this.__textType),e.classList.add(this.__textType),e}updateDOM(){return!1}exportDOM(e){const{element:r}=super.exportDOM(e);return r&&dr(r)&&r.setAttribute("data-text-type",this.getTextType()),{element:r}}decorate(){return this.getTextContent()}exportJSON(){return{type:this.getType(),textType:this.getTextType(),text:this.getTextContent(),version:Xh}}isKeyboardSelectable(){return!1}}function E_(t){const e=t.getAttribute("data-text-type")??"",r=t.textContent??"";return{node:dn(e,r)}}function dn(t,e){return Oe(new pr(t,e))}function T_(t){return(t==null?void 0:t.tagName)==="span"}function Oi(t){return t instanceof pr}function M_(t){return(t==null?void 0:t.type)===pr.getType()}const ji="unmatched",Qh=1;class gr extends fn{constructor(e="",r){super(r),z(this,"__marker"),this.__marker=e}static getType(){return"unmatched"}static clone(e){const{__marker:r,__key:n}=e;return new gr(r,n)}static importDOM(){return{[ji]:e=>N_(e)?{conversion:A_,priority:1}:null}}static importJSON(e){return dl().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker)}setMarker(e){if(this.__marker===e)return this;const r=this.getWritable();return r.__marker=e,r}getMarker(){return this.getLatest().__marker}createDOM(){const e=document.createElement(ji);e.setAttribute("data-marker",this.__marker),e.classList.add(jc);const r=this.__marker.endsWith("*");return e.title=r?"This closing marker has no matching opening marker!":"This opening marker has no matching closing marker!",e}updateDOM(){return!1}exportDOM(e){const{element:r}=super.exportDOM(e);return r&&dr(r)&&(r.setAttribute("data-marker",this.getMarker()),r.classList.add(jc)),{element:r}}decorate(){return`\\${this.getMarker()}${ba}`}exportJSON(){return{type:this.getType(),marker:this.getMarker(),version:Qh}}isKeyboardSelectable(){return!1}}function A_(t){const e=t.getAttribute("data-marker")??"";return{node:dl(e)}}function dl(t){return Oe(new gr(t))}function N_(t){return(t==null?void 0:t.tagName)===ji}function Zh(t){return t instanceof gr}const O_=[ct,Yt,kt,Ge,Se,Pe,It,qr,$r,pr,gr,tt,ar,{replace:La,with:()=>yt(),withKlass:ar}];var T;(function(t){t.FileIdentification="FileIdentification",t.Headers="Headers",t.Remarks="Remarks",t.Introduction="Introduction",t.DivisionMarks="DivisionMarks",t.Paragraphs="Paragraphs",t.Poetry="Poetry",t.TitlesHeadings="TitlesHeadings",t.Tables="Tables",t.CenterTables="CenterTables",t.RightTables="RightTables",t.Lists="Lists",t.Footnotes="Footnotes",t.CrossReferences="CrossReferences",t.SpecialText="SpecialText",t.CharacterStyling="CharacterStyling",t.Breaks="Breaks",t.SpecialFeatures="SpecialFeatures",t.PeripheralReferences="PeripheralReferences",t.PeripheralMaterials="PeripheralMaterials",t.Uncategorized="Uncategorized"})(T||(T={}));var E;(function(t){t.Paragraph="Paragraph",t.Character="Character",t.Note="Note",t.Unknown="Unknown"})(E||(E={}));const j_={id:{category:T.FileIdentification,type:E.Paragraph,description:"File identification information (BOOKID, FILENAME, EDITOR, MODIFICATION DATE)",hasEndMarker:!1,children:{FileIdentification:["usfm","ide"],Headers:["h","h1","h2","h3","toc1","toc2","toc3"],Remarks:["rem","sts","restore"],Introduction:["imt","imt1","imt2","imt3","imt4","imte","imte1","imte2","is","is1","is2","iot","io","io1","io2","io3","io4","ior","ip","im","ipi","imi","ili","ili1","ili2","ipq","imq","ipr","ib","iq","iq1","iq2","iq3","iex","ie"],DivisionMarks:["c","cl"],TitlesHeadings:["mt","mt1","mt2","mt3","mt4"]}},usfm:{category:T.FileIdentification,type:E.Paragraph,description:"File markup version information",hasEndMarker:!1,children:void 0},ide:{category:T.FileIdentification,type:E.Paragraph,description:"File encoding information",hasEndMarker:!1,children:{Remarks:["rem","sts"]}},h:{category:T.Headers,type:E.Paragraph,description:"Running header text for a book (basic)",hasEndMarker:!1,children:{Headers:["toc1","toc2","toc3","toca1","toca2","toca3"]}},h1:{category:T.Headers,type:E.Paragraph,description:"Running header text",hasEndMarker:!1,children:{Headers:["toc1","toc2","toc3","toca1","toca2","toca3"]}},h2:{category:T.Headers,type:E.Paragraph,description:"Running header text, left side of page",hasEndMarker:!1,children:{Headers:["toc1","toc2","toc3","toca1","toca2","toca3"]}},h3:{category:T.Headers,type:E.Paragraph,description:"Running header text, right side of page",hasEndMarker:!1,children:{Headers:["toc1","toc2","toc3","toca1","toca2","toca3"]}},toc1:{category:T.Headers,type:E.Paragraph,description:"Long table of contents text",hasEndMarker:!1,children:void 0},toc2:{category:T.Headers,type:E.Paragraph,description:"Short table of contents text",hasEndMarker:!1,children:void 0},toc3:{category:T.Headers,type:E.Paragraph,description:"Book Abbreviation",hasEndMarker:!1,children:void 0},toca1:{category:T.Headers,type:E.Paragraph,description:"Alternative language long table of contents text",hasEndMarker:!1,children:void 0},toca2:{category:T.Headers,type:E.Paragraph,description:"Alternative language short table of contents text",hasEndMarker:!1,children:void 0},toca3:{category:T.Headers,type:E.Paragraph,description:"Alternative language book Abbreviation",hasEndMarker:!1,children:void 0},rem:{category:T.Remarks,type:E.Paragraph,description:"Comments and remarks",hasEndMarker:!1,children:void 0},sts:{category:T.Remarks,type:E.Paragraph,description:"Status of this file",hasEndMarker:!1,children:void 0},restore:{category:T.Remarks,type:E.Paragraph,description:"Project restore information",hasEndMarker:!1,children:void 0},imt:{category:T.Introduction,type:E.Paragraph,description:"Introduction major title, level 1 (if single level) (basic)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imt1:{category:T.Introduction,type:E.Paragraph,description:"Introduction major title, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imt2:{category:T.Introduction,type:E.Paragraph,description:"Introduction major title, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imt3:{category:T.Introduction,type:E.Paragraph,description:"Introduction major title, level 3",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imt4:{category:T.Introduction,type:E.Paragraph,description:"Introduction major title, level 4 (usually within parenthesis)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imte:{category:T.Introduction,type:E.Paragraph,description:"Introduction major title at introduction end, level 1 (if single level)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imte1:{category:T.Introduction,type:E.Paragraph,description:"Introduction major title at introduction end, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imte2:{category:T.Introduction,type:E.Paragraph,description:"Introduction major title at introduction end, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},is:{category:T.Introduction,type:E.Paragraph,description:"Introduction section heading, level 1 (if single level) (basic)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"],CharacterStyling:["no"]}},is1:{category:T.Introduction,type:E.Paragraph,description:"Introduction section heading, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},is2:{category:T.Introduction,type:E.Paragraph,description:"Introduction section heading, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},iot:{category:T.Introduction,type:E.Paragraph,description:"Introduction outline title (basic)",hasEndMarker:!1,children:{Introduction:["iqt"],CharacterStyling:["no"]}},io:{category:T.Introduction,type:E.Paragraph,description:"Introduction outline text, level 1 (if single level)",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},io1:{category:T.Introduction,type:E.Paragraph,description:"Introduction outline text, level 1 (if multiple levels) (basic)",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},io2:{category:T.Introduction,type:E.Paragraph,description:"Introduction outline text, level 2",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},io3:{category:T.Introduction,type:E.Paragraph,description:"Introduction outline text, level 3",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},io4:{category:T.Introduction,type:E.Paragraph,description:"Introduction outline text, level 4",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ior:{category:T.Introduction,type:E.Character,description:"Introduction references range for outline entry; for marking references separately",hasEndMarker:!0,children:void 0},ip:{category:T.Introduction,type:E.Paragraph,description:"Introduction prose paragraph (basic)",hasEndMarker:!1,children:{Introduction:["iqt"],Footnotes:["f","fe","fm"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},im:{category:T.Introduction,type:E.Paragraph,description:"Introduction prose paragraph, with no first line indent (may occur after poetry)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ipi:{category:T.Introduction,type:E.Paragraph,description:"Introduction prose paragraph, indented, with first line indent",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},imi:{category:T.Introduction,type:E.Paragraph,description:"Introduction prose paragraph text, indented, with no first line indent",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ili:{category:T.Introduction,type:E.Paragraph,description:"A list entry, level 1 (if single level)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ili1:{category:T.Introduction,type:E.Paragraph,description:"A list entry, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ili2:{category:T.Introduction,type:E.Paragraph,description:"A list entry, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ipq:{category:T.Introduction,type:E.Paragraph,description:"Introduction prose paragraph, quote from the body text",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},imq:{category:T.Introduction,type:E.Paragraph,description:"Introduction prose paragraph, quote from the body text, with no first line indent",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ipr:{category:T.Introduction,type:E.Paragraph,description:"Introduction prose paragraph, right aligned",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},ib:{category:T.Introduction,type:E.Paragraph,description:"Introduction blank line",hasEndMarker:!1,children:{Introduction:["iqt"]}},iq:{category:T.Introduction,type:E.Paragraph,description:"Introduction poetry text, level 1 (if single level)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},iq1:{category:T.Introduction,type:E.Paragraph,description:"Introduction poetry text, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},iq2:{category:T.Introduction,type:E.Paragraph,description:"Introduction poetry text, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},iq3:{category:T.Introduction,type:E.Paragraph,description:"Introduction poetry text, level 3",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},iex:{category:T.Introduction,type:E.Paragraph,description:"Introduction explanatory or bridge text (e.g. explanation of missing book in Short Old Testament)",hasEndMarker:!1,children:{Introduction:["iqt"],CharacterStyling:["no"]}},iqt:{category:T.Introduction,type:E.Character,description:"For quoted scripture text appearing in the introduction",hasEndMarker:!0,children:void 0},ie:{category:T.Introduction,type:E.Paragraph,description:"Introduction ending marker",hasEndMarker:!1,children:void 0},c:{category:T.DivisionMarks,type:E.Paragraph,description:"Chapter number",hasEndMarker:!1,children:{DivisionMarks:["ca","cp","cl","cd"],Paragraphs:["p","m","po","pr","cls","pi","pi1","pi2","pi3","pc","mi","nb"],Poetry:["q","q1","q2","q3","q4","qc","qr","qa","qd","b"],TitlesHeadings:["mte","ms","ms1","ms2","ms3","s","s1","s2","s3","s4","r","sp","d","sd","sd1","sd2","sd3","sd4"],Lists:["lh","li","li1","li2","li3","li4","lf","lim","lim1","lim2","lim3","lim4"],Footnotes:["f","fe"],SpecialText:["lit"],Breaks:["pb"]}},ca:{category:T.DivisionMarks,type:E.Character,description:"Second (alternate) chapter number (for coding dual versification; useful for places where different traditions of chapter breaks need to be supported in the same translation)",hasEndMarker:!0,children:void 0},cp:{category:T.DivisionMarks,type:E.Paragraph,description:"Published chapter number (chapter string that should appear in the published text)",hasEndMarker:!1,children:{Footnotes:["f"]}},cl:{category:T.DivisionMarks,type:E.Paragraph,description:"Chapter label used for translations that add a word such as 'Chapter' before chapter numbers (e.g. Psalms). The subsequent text is the chapter label.",hasEndMarker:!1,children:void 0},cd:{category:T.DivisionMarks,type:E.Paragraph,description:"Chapter Description (Publishing option D, e.g. in Russian Bibles)",hasEndMarker:!1,children:{DivisionMarks:["vp"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},v:{category:T.DivisionMarks,type:E.Character,description:"A verse number",hasEndMarker:!1,children:void 0},va:{category:T.DivisionMarks,type:E.Character,description:"Second (alternate) verse number (for coding dual numeration in Psalms; see also NRSV Exo 22.1-4)",hasEndMarker:!0,children:void 0},vp:{category:T.DivisionMarks,type:E.Character,description:"Published verse marker (verse string that should appear in the published text)",hasEndMarker:!0,children:void 0},p:{category:T.Paragraphs,type:E.Paragraph,description:"Paragraph text, with first line indent (basic)",hasEndMarker:!1,children:{Paragraphs:["pmo","pm","pmc","pmr"],Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},m:{category:T.Paragraphs,type:E.Paragraph,description:"Paragraph text, with no first line indent (may occur after poetry) (basic)",hasEndMarker:!1,children:{Paragraphs:["pmo","pm","pmc","pmr"],Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},po:{category:T.Paragraphs,type:E.Paragraph,description:"Letter opening",hasEndMarker:!1,children:{Paragraphs:["pmo","pm","pmc","pmr"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pr:{category:T.Paragraphs,type:E.Paragraph,description:"Text refrain (paragraph text, right aligned)",hasEndMarker:!1,children:{Paragraphs:["pmo","pm","pmc","pmr"],Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},cls:{category:T.Paragraphs,type:E.Paragraph,description:"Letter Closing",hasEndMarker:!1,children:{SpecialText:["tl","sig","pn","png","addpn","add"]}},pmo:{category:T.Paragraphs,type:E.Paragraph,description:"Embedded text opening",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pm:{category:T.Paragraphs,type:E.Paragraph,description:"Embedded text paragraph",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pmc:{category:T.Paragraphs,type:E.Paragraph,description:"Embedded text closing",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pmr:{category:T.Paragraphs,type:E.Paragraph,description:"Embedded text refrain (e.g. Then all the people shall say, 'Amen!')",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pi:{category:T.Paragraphs,type:E.Paragraph,description:"Paragraph text, level 1 indent (if single level), with first line indent; often used for discourse (basic)",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pi1:{category:T.Paragraphs,type:E.Paragraph,description:"Paragraph text, level 1 indent (if multiple levels), with first line indent; often used for discourse",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pi2:{category:T.Paragraphs,type:E.Paragraph,description:"Paragraph text, level 2 indent, with first line indent; often used for discourse",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pi3:{category:T.Paragraphs,type:E.Paragraph,description:"Paragraph text, level 3 indent, with first line indent; often used for discourse",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pc:{category:T.Paragraphs,type:E.Paragraph,description:"Paragraph text, centered (for Inscription)",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},mi:{category:T.Paragraphs,type:E.Paragraph,description:"Paragraph text, indented, with no first line indent; often used for discourse",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},nb:{category:T.Paragraphs,type:E.Paragraph,description:"Paragraph text, with no break from previous paragraph text (at chapter boundary) (basic)",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q:{category:T.Poetry,type:E.Paragraph,description:"Poetry text, level 1 indent (if single level)",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q1:{category:T.Poetry,type:E.Paragraph,description:"Poetry text, level 1 indent (if multiple levels) (basic)",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q2:{category:T.Poetry,type:E.Paragraph,description:"Poetry text, level 2 indent (basic)",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q3:{category:T.Poetry,type:E.Paragraph,description:"Poetry text, level 3 indent",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q4:{category:T.Poetry,type:E.Paragraph,description:"Poetry text, level 4 indent",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qc:{category:T.Poetry,type:E.Paragraph,description:"Poetry text, centered",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qr:{category:T.Poetry,type:E.Paragraph,description:"Poetry text, Right Aligned",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qs:{category:T.Poetry,type:E.Character,description:"Poetry text, Selah",hasEndMarker:!0,children:{Footnotes:["f"],CrossReferences:["x"]}},qa:{category:T.Poetry,type:E.Paragraph,description:"Poetry text, Acrostic marker/heading",hasEndMarker:!1,children:void 0},qac:{category:T.Poetry,type:E.Character,description:"Poetry text, Acrostic markup of the first character of a line of acrostic poetry",hasEndMarker:!0,children:void 0},qm:{category:T.Poetry,type:E.Paragraph,description:"Poetry text, embedded, level 1 indent (if single level)",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qm1:{category:T.Poetry,type:E.Paragraph,description:"Poetry text, embedded, level 1 indent (if multiple levels)",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qm2:{category:T.Poetry,type:E.Paragraph,description:"Poetry text, embedded, level 2 indent",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qm3:{category:T.Poetry,type:E.Paragraph,description:"Poetry text, embedded, level 3 indent",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qd:{category:T.Poetry,type:E.Paragraph,description:"A Hebrew musical performance annotation, similar in content to Hebrew descriptive title.",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},b:{category:T.Poetry,type:E.Paragraph,description:"Poetry text stanza break (e.g. stanza break) (basic)",hasEndMarker:!1,children:void 0},mt:{category:T.TitlesHeadings,type:E.Paragraph,description:"The main title of the book (if single level)",hasEndMarker:!1,children:{Footnotes:["f"],CrossReferences:["x"]}},mt1:{category:T.TitlesHeadings,type:E.Paragraph,description:"The main title of the book (if multiple levels) (basic)",hasEndMarker:!1,children:{Footnotes:["f"],CrossReferences:["x"]}},mt2:{category:T.TitlesHeadings,type:E.Paragraph,description:"A secondary title usually occurring before the main title (basic)",hasEndMarker:!1,children:{Footnotes:["f"],CrossReferences:["x"]}},mt3:{category:T.TitlesHeadings,type:E.Paragraph,description:"A secondary title occurring after the main title",hasEndMarker:!1,children:{Footnotes:["f"],CrossReferences:["x"]}},mt4:{category:T.TitlesHeadings,type:E.Paragraph,description:"A small secondary title sometimes occurring within parentheses",hasEndMarker:!1,children:void 0},mte:{category:T.TitlesHeadings,type:E.Paragraph,description:"The main title of the book repeated at the end of the book, level 1 (if single level)",hasEndMarker:!1,children:void 0},mte1:{category:T.TitlesHeadings,type:E.Paragraph,description:"The main title of the book repeated at the end of the book, level 1 (if multiple levels)",hasEndMarker:!1,children:{TitlesHeadings:["mte2"]}},mte2:{category:T.TitlesHeadings,type:E.Paragraph,description:"A secondary title occurring before or after the 'ending' main title",hasEndMarker:!1,children:void 0},ms:{category:T.TitlesHeadings,type:E.Paragraph,description:"A major section division heading, level 1 (if single level) (basic)",hasEndMarker:!1,children:{TitlesHeadings:["mr"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},ms1:{category:T.TitlesHeadings,type:E.Paragraph,description:"A major section division heading, level 1 (if multiple levels)",hasEndMarker:!1,children:{TitlesHeadings:["mr"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},ms2:{category:T.TitlesHeadings,type:E.Paragraph,description:"A major section division heading, level 2",hasEndMarker:!1,children:{TitlesHeadings:["mr"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},ms3:{category:T.TitlesHeadings,type:E.Paragraph,description:"A major section division heading, level 3",hasEndMarker:!1,children:{TitlesHeadings:["mr"],Footnotes:["f","fe"]}},mr:{category:T.TitlesHeadings,type:E.Paragraph,description:"A major section division references range heading (basic)",hasEndMarker:!1,children:void 0},s:{category:T.TitlesHeadings,type:E.Paragraph,description:"A section heading, level 1 (if single level) (basic)",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},s1:{category:T.TitlesHeadings,type:E.Paragraph,description:"A section heading, level 1 (if multiple levels)",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},s2:{category:T.TitlesHeadings,type:E.Paragraph,description:"A section heading, level 2 (e.g. Proverbs 22-24)",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},s3:{category:T.TitlesHeadings,type:E.Paragraph,description:"A section heading, level 3 (e.g. Genesis 'The First Day')",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},s4:{category:T.TitlesHeadings,type:E.Paragraph,description:"A section heading, level 4",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},sr:{category:T.TitlesHeadings,type:E.Paragraph,description:"A section division references range heading",hasEndMarker:!1,children:void 0},r:{category:T.TitlesHeadings,type:E.Paragraph,description:"Parallel reference(s) (basic)",hasEndMarker:!1,children:void 0},sp:{category:T.TitlesHeadings,type:E.Paragraph,description:"A heading, to identify the speaker (e.g. Job)",hasEndMarker:!1,children:{Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},d:{category:T.TitlesHeadings,type:E.Paragraph,description:"A Hebrew text heading, to provide description (e.g. Psalms)",hasEndMarker:!1,children:{Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},sd:{category:T.TitlesHeadings,type:E.Paragraph,description:"Vertical space used to divide the text into sections, level 1 (if single level)",hasEndMarker:!1,children:void 0},sd1:{category:T.TitlesHeadings,type:E.Paragraph,description:"Vertical space used to divide the text into sections, level 1 (if multiple levels)",hasEndMarker:!1,children:void 0},sd2:{category:T.TitlesHeadings,type:E.Paragraph,description:"Vertical space used to divide the text into sections, level 2",hasEndMarker:!1,children:void 0},sd3:{category:T.TitlesHeadings,type:E.Paragraph,description:"Vertical space used to divide the text into sections, level 3",hasEndMarker:!1,children:void 0},sd4:{category:T.TitlesHeadings,type:E.Paragraph,description:"Vertical space used to divide the text into sections, level 4",hasEndMarker:!1,children:void 0},lh:{category:T.Lists,type:E.Paragraph,description:"List header (introductory remark)",hasEndMarker:!1,children:{Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li:{category:T.Lists,type:E.Paragraph,description:"A list entry, level 1 (if single level)",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li1:{category:T.Lists,type:E.Paragraph,description:"A list entry, level 1 (if multiple levels)",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li2:{category:T.Lists,type:E.Paragraph,description:"A list entry, level 2",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li3:{category:T.Lists,type:E.Paragraph,description:"A list entry, level 3",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li4:{category:T.Lists,type:E.Paragraph,description:"A list entry, level 4",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lf:{category:T.Lists,type:E.Paragraph,description:"List footer (concluding remark)",hasEndMarker:!1,children:{Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim:{category:T.Lists,type:E.Paragraph,description:"An embedded list entry, level 1 (if single level)",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim1:{category:T.Lists,type:E.Paragraph,description:"An embedded list entry, level 1 (if multiple levels)",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim2:{category:T.Lists,type:E.Paragraph,description:"An embedded list entry, level 2",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim3:{category:T.Lists,type:E.Paragraph,description:"An embedded list item, level 3",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim4:{category:T.Lists,type:E.Paragraph,description:"An embedded list entry, level 4",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},litl:{category:T.Lists,type:E.Character,description:"List entry total text",hasEndMarker:!0,children:void 0},lik:{category:T.Lists,type:E.Character,description:"Structured list entry key text",hasEndMarker:!0,children:void 0},liv:{category:T.Lists,type:E.Character,description:"Structured list entry value 1 content (if single value)",hasEndMarker:!0,children:void 0},liv1:{category:T.Lists,type:E.Character,description:"Structured list entry value 1 content (if multiple values)",hasEndMarker:!0,children:void 0},liv2:{category:T.Lists,type:E.Character,description:"Structured list entry value 2 content",hasEndMarker:!0,children:void 0},liv3:{category:T.Lists,type:E.Character,description:"Structured list entry value 3 content",hasEndMarker:!0,children:void 0},liv4:{category:T.Lists,type:E.Character,description:"Structured list entry value 4 content",hasEndMarker:!0,children:void 0},liv5:{category:T.Lists,type:E.Character,description:"Structured list entry value 5 content",hasEndMarker:!0,children:void 0},f:{category:T.Footnotes,type:E.Note,description:"A Footnote text item (basic)",hasEndMarker:!0,children:{Footnotes:["fr","ft","fk","fq","fqa","fl","fw","fp","fv","fdc"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},fe:{category:T.Footnotes,type:E.Note,description:"An Endnote text item",hasEndMarker:!0,children:{Footnotes:["fr","ft","fk","fq","fqa","fl","fw","fp","fv","fdc"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},fr:{category:T.Footnotes,type:E.Character,description:"The origin reference for the footnote (basic)",hasEndMarker:!0,children:void 0},ft:{category:T.Footnotes,type:E.Character,description:"Footnote text, Protocanon (basic)",hasEndMarker:!0,children:void 0},fk:{category:T.Footnotes,type:E.Character,description:"A footnote keyword (basic)",hasEndMarker:!0,children:void 0},fq:{category:T.Footnotes,type:E.Character,description:"A footnote scripture quote or alternate rendering (basic)",hasEndMarker:!0,children:void 0},fqa:{category:T.Footnotes,type:E.Character,description:"A footnote alternate rendering for a portion of scripture text",hasEndMarker:!0,children:void 0},fl:{category:T.Footnotes,type:E.Character,description:"A footnote label text item, for marking or 'labelling' the type or alternate translation being provided in the note.",hasEndMarker:!0,children:void 0},fw:{category:T.Footnotes,type:E.Character,description:"A footnote witness list, for distinguishing a list of sigla representing witnesses in critical editions.",hasEndMarker:!0,children:void 0},fp:{category:T.Footnotes,type:E.Character,description:"A Footnote additional paragraph marker",hasEndMarker:!0,children:void 0},fv:{category:T.Footnotes,type:E.Character,description:"A verse number within the footnote text",hasEndMarker:!0,children:void 0},fdc:{category:T.Footnotes,type:E.Character,description:"Footnote text, applies to Deuterocanon only",hasEndMarker:!0,children:void 0},fm:{category:T.Footnotes,type:E.Character,description:"An additional footnote marker location for a previous footnote",hasEndMarker:!0,children:void 0},x:{category:T.CrossReferences,type:E.Note,description:"A list of cross references (basic)",hasEndMarker:!0,children:{CrossReferences:["xo","xop","xt","xta","xk","xq","xot","xnt","xdc"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},xo:{category:T.CrossReferences,type:E.Character,description:"The cross reference origin reference (basic)",hasEndMarker:!0,children:void 0},xop:{category:T.CrossReferences,type:E.Character,description:"Published cross reference origin reference (origin reference that should appear in the published text)",hasEndMarker:!0,children:void 0},xt:{category:T.CrossReferences,type:E.Character,description:"The cross reference target reference(s), protocanon only (basic)",hasEndMarker:!0,children:void 0},xta:{category:T.CrossReferences,type:E.Character,description:"Cross reference target references added text",hasEndMarker:!0,children:void 0},xk:{category:T.CrossReferences,type:E.Character,description:"A cross reference keyword",hasEndMarker:!0,children:void 0},xq:{category:T.CrossReferences,type:E.Character,description:"A cross-reference quotation from the scripture text",hasEndMarker:!0,children:void 0},xot:{category:T.CrossReferences,type:E.Character,description:"Cross-reference target reference(s), Old Testament only",hasEndMarker:!0,children:void 0},xnt:{category:T.CrossReferences,type:E.Character,description:"Cross-reference target reference(s), New Testament only",hasEndMarker:!0,children:void 0},xdc:{category:T.CrossReferences,type:E.Character,description:"Cross-reference target reference(s), Deuterocanon only",hasEndMarker:!0,children:void 0},rq:{category:T.CrossReferences,type:E.Character,description:"A cross-reference indicating the source text for the preceding quotation.",hasEndMarker:!0,children:void 0},qt:{category:T.SpecialText,type:E.Character,description:"For Old Testament quoted text appearing in the New Testament (basic)",hasEndMarker:!0,children:void 0},nd:{category:T.SpecialText,type:E.Character,description:"For name of deity (basic)",hasEndMarker:!0,children:void 0},tl:{category:T.SpecialText,type:E.Character,description:"For transliterated words",hasEndMarker:!0,children:void 0},dc:{category:T.SpecialText,type:E.Character,description:"Deuterocanonical/LXX additions or insertions in the Protocanonical text",hasEndMarker:!0,children:void 0},bk:{category:T.SpecialText,type:E.Character,description:"For the quoted name of a book",hasEndMarker:!0,children:void 0},sig:{category:T.SpecialText,type:E.Character,description:"For the signature of the author of an Epistle",hasEndMarker:!0,children:void 0},pn:{category:T.SpecialText,type:E.Character,description:"For a proper name",hasEndMarker:!0,children:void 0},png:{category:T.SpecialText,type:E.Character,description:"For a geographic proper name",hasEndMarker:!0,children:void 0},addpn:{category:T.SpecialText,type:E.Character,description:"For chinese words to be dot underline & underline",hasEndMarker:!0,children:void 0},wj:{category:T.SpecialText,type:E.Character,description:"For marking the words of Jesus",hasEndMarker:!0,children:void 0},k:{category:T.SpecialText,type:E.Character,description:"For a keyword",hasEndMarker:!0,children:void 0},sls:{category:T.SpecialText,type:E.Character,description:"To represent where the original text is in a secondary language or from an alternate text source",hasEndMarker:!0,children:void 0},ord:{category:T.SpecialText,type:E.Character,description:"For the text portion of an ordinal number",hasEndMarker:!0,children:void 0},add:{category:T.SpecialText,type:E.Character,description:"For a translational addition to the text",hasEndMarker:!0,children:void 0},lit:{category:T.SpecialText,type:E.Paragraph,description:"For a comment or note inserted for liturgical use",hasEndMarker:!1,children:void 0},no:{category:T.CharacterStyling,type:E.Character,description:"A character style, use normal text",hasEndMarker:!0,children:void 0},it:{category:T.CharacterStyling,type:E.Character,description:"A character style, use italic text",hasEndMarker:!0,children:void 0},bd:{category:T.CharacterStyling,type:E.Character,description:"A character style, use bold text",hasEndMarker:!0,children:void 0},bdit:{category:T.CharacterStyling,type:E.Character,description:"A character style, use bold + italic text",hasEndMarker:!0,children:void 0},em:{category:T.CharacterStyling,type:E.Character,description:"A character style, use emphasized text style",hasEndMarker:!0,children:void 0},sc:{category:T.CharacterStyling,type:E.Character,description:"A character style, for small capitalization text",hasEndMarker:!0,children:void 0},sup:{category:T.CharacterStyling,type:E.Character,description:"A character style, for superscript text. Typically for use in critical edition footnotes.",hasEndMarker:!0,children:void 0},pb:{category:T.Breaks,type:E.Paragraph,description:"Page Break used for new reader portions and children's bibles where content is controlled by the page",hasEndMarker:!1,children:void 0}},Cr={DivisionMarks:{add:["v","c"],remove:[]},Paragraphs:{add:["p"],remove:[]},Poetry:{add:["q","q1","q2","q3","q4","b"],remove:[]},TitlesHeadings:{add:["mte","ms","ms1","ms2","ms3","s","s1","s2","s3","s4","r","sp","d","sd","sd1","sd2","sd3","sd4"],remove:[]}},I_={p:{children:Cr},q:{children:Cr},q1:{children:Cr},q2:{children:Cr},q3:{children:Cr},q4:{children:Cr},b:{children:Cr},qm:{children:{Paragraphs:{add:["p"],remove:[]}}},c:{type:E.Paragraph,children:null},v:{children:null}};function Pc(t){const e=j_[t],r=I_[t];if(!e)return;if(!r)return e;let n=e.children?{...e.children}:void 0;if(r.children===null&&(n=void 0),r.children){n=n||{};for(const[s,i]of Object.entries(r.children)){const o=s;if(i===null)Reflect.deleteProperty(n,o);else{let a=n[o]||[];i.remove&&(a=a.filter(l=>!i.remove.includes(l))),i.add&&(a=[...new Set([...a,...i.add])]),a.length>0?n[o]=a:Reflect.deleteProperty(n,o)}}Object.keys(n).length===0&&(n=void 0)}return{...e,...r,children:n}}function Rc(t,e,r){const n={type:Zn,version:es,content:t},s=e.serializeEditorState(n,r);return rl(s.root.children[0])?s.root.children[0].children[0]:s.root.children[0]}function Ca(t,e){if(!t||!ee(t))return[void 0,void 0];const r=t.getTextContent();if(e>=0&&e<r.length)return[t,e];let n=t.getNextSibling();if(!n){const i=t.getParent();Fe(i)&&(n=i.getNextSibling())}if(!n||!Fe(n)&&!ee(n))return[void 0,void 0];const s=e-r.length;return n&&ee(n)?Ca(n,s):Ca(n.getFirstChild()??void 0,s)}function $c(t){const e=Df(t.jsonPath);let r=Pt();for(const n of e){if(!r||!ve(r))return[void 0,void 0];r=r.getChildAtIndex(n)??void 0}return Ca(r,t.offset)}function qc(t){return ve(t)?"element":"text"}function hl(t){const{start:e}=t;let{end:r}=t;r===void 0&&(r=e);const[n,s]=$c(e),[i,o]=$c(r);if(!n||!i||s===void 0||o===void 0)return;const a=pd();return a.anchor=Nl(n.getKey(),s,qc(n)),a.focus=Nl(i.getKey(),o,qc(i)),a}function Lc(t,e){const r=[];let n=t;for(;n!=null&&n.getParent();){const s=n.getParent();if(s){const i=s==null?void 0:s.getChildren().indexOf(n);i>=0&&r.unshift(i)}n=s}return{jsonPath:Ff(r),offset:e}}function ef(){const t=ne();if(!t||!X(t))return;const e=t.isBackward()?t.focus.getNode():t.anchor.getNode(),r=t.isBackward()?t.focus.offset:t.anchor.offset,n=Lc(e,r);if(t.isCollapsed())return{start:n};const s=t.isBackward()?t.anchor.getNode():t.focus.getNode(),i=t.isBackward()?t.anchor.offset:t.focus.offset,o=Lc(s,i);return{start:n,end:o}}const tf="v",rf=1;class Ye extends fn{constructor(e="",r=!1,n,s,i,o,a){super(a),z(this,"__marker"),z(this,"__number"),z(this,"__showMarker"),z(this,"__sid"),z(this,"__altnumber"),z(this,"__pubnumber"),z(this,"__unknownAttributes"),this.__marker=tf,this.__number=e,this.__showMarker=r,this.__sid=n,this.__altnumber=s,this.__pubnumber=i,this.__unknownAttributes=o}static getType(){return"immutable-verse"}static clone(e){const{__number:r,__showMarker:n,__sid:s,__altnumber:i,__pubnumber:o,__unknownAttributes:a,__key:l}=e;return new Ye(r,n,s,i,o,a,l)}static importDOM(){return{span:e=>R_(e)?{conversion:P_,priority:1}:null}}static importJSON(e){return fl().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setNumber(e.number).setShowMarker(e.showMarker).setSid(e.sid).setAltnumber(e.altnumber).setPubnumber(e.pubnumber).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const r=this.getWritable();return r.__marker=e,r}getMarker(){return this.getLatest().__marker}setNumber(e){if(this.__number===e)return this;const r=this.getWritable();return r.__number=e,r}getNumber(){return this.getLatest().__number}setShowMarker(e=!1){if(this.__showMarker===e)return this;const r=this.getWritable();return r.__showMarker=e,r}getShowMarker(){return this.getLatest().__showMarker}setSid(e){if(this.__sid===e)return this;const r=this.getWritable();return r.__sid=e,r}getSid(){return this.getLatest().__sid}setAltnumber(e){if(this.__altnumber===e)return this;const r=this.getWritable();return r.__altnumber=e,r}getAltnumber(){return this.getLatest().__altnumber}setPubnumber(e){if(this.__pubnumber===e)return this;const r=this.getWritable();return r.__pubnumber=e,r}getPubnumber(){return this.getLatest().__pubnumber}setUnknownAttributes(e){const r=this.getWritable();return r.__unknownAttributes=e,r}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("span");return e.setAttribute("data-marker",this.__marker),e.classList.add(_a,`usfm_${this.__marker}`),this.__showMarker&&e.classList.add("marker"),e.setAttribute("data-number",this.__number),e}updateDOM(){return!1}exportDOM(e){const{element:r}=super.exportDOM(e);return r&&dr(r)&&(r.setAttribute("data-marker",this.getMarker()),r.classList.add(_a,`usfm_${this.getMarker()}`),r.setAttribute("data-number",this.getNumber())),{element:r}}decorate(){return m.jsx("span",{children:this.getShowMarker()?ks(this.getMarker(),this.getNumber()):ba+this.getNumber()+ba})}exportJSON(){return{type:this.getType(),marker:this.getMarker(),number:this.getNumber(),showMarker:this.getShowMarker(),sid:this.getSid(),altnumber:this.getAltnumber(),pubnumber:this.getPubnumber(),unknownAttributes:this.getUnknownAttributes(),version:rf}}isKeyboardSelectable(){return!1}}function P_(t){const e=t.getAttribute("data-number")??"0";return{node:fl(e)}}function fl(t,e,r,n,s,i){return Oe(new Ye(t,e,r,n,s,i))}function R_(t){return((t==null?void 0:t.getAttribute("data-marker"))??void 0)===tf}function kn(t){return t instanceof Ye}function $_(t){return(t==null?void 0:t.type)===Ye.getType()}function lt(t){return il(t)||kn(t)}function q_(t){return i_(t)||$_(t)}function L_(t,e,r,n,s,i,o){if(!Pe.isValidMarker(t))throw new Error(`$insertNote: Invalid note marker '${t}'`);const a=r?hl(r):ne();if(!X(a))return;const l=D_(a,t,n,o);if(l===void 0)return;const u=sf(t,e,l,s,i);return nf(u,a,s),u}function nf(t,e,r){const n=(r==null?void 0:r.noteMode)==="collapsed";if(t.setIsCollapsed(n),e.isCollapsed()||p_(e),e.insertNodes([t]),!n){const s=t.getChildren().reverse().find(ge);s==null||s.selectEnd()}}function D_(t,e,r,n){const s=[],{chapterNum:i,verseNum:o}=r??{};switch(e){case"f":case"fe":case"ef":case"efe":if(i!==void 0&&o!==void 0&&s.push(Tt("fr").append(Ce(`${i}:${o}`))),!t.isCollapsed()){const a=t.getTextContent().trim();if(a.length>0){const l=Tt("fq");l.append(Ce(a)),s.push(l)}}s.push(Tt("ft").append(Ce(ae)));break;case"x":case"ex":i!==void 0&&o!==void 0&&s.push(Tt("xo").append(Ce(`${i}:${o}`))),s.push(Tt("xt").append(Ce(ae)));break;default:n==null||n.warn(`$createNoteChildren: Unsupported note marker '${e}'`);return}return s}function sf(t,e,r,n,s,i){const o=(n==null?void 0:n.noteMode)!=="expanded",a=sl(t,e,o);i&&Wt(a,Ar,()=>i);let l,u;(n==null?void 0:n.markerMode)==="editable"?(l=un(t),u=un(t,"closing")):(n==null?void 0:n.markerMode)==="visible"&&(l=dn("marker",Xt(t)+ae),u=dn("marker",cn(t)+ae));let d;if(l&&a.append(l),(n==null?void 0:n.markerMode)==="editable")e===""?a.append(...r):(d=Ce(ll(a.__caller)),a.append(d,...r));else{const f=()=>Ce(ae),h=r.flatMap(U_(f));if(e==="")a.append(...h);else{const p=cl(r);let y=()=>{};s!=null&&s.noteCallerOnClick&&(y=s.noteCallerOnClick),d=yl(a.__caller,p,y),a.append(d,f(),...h)}}return u&&a.append(u),a}function Dc(t){var e;if(typeof t=="string"){const s=we(t);return oe(s)?s:void 0}const r=fs();if(r.length<=0)return;const n=(e=r.filter(s=>oe(s.node))[t])==null?void 0:e.node;if(oe(n))return n}function F_(t,e){const r=(e==null?void 0:e.noteMode)==="collapsed";if(t.setIsCollapsed(r),r){const n=t.getPreviousSibling();if(kn(n)||!n){const s=t.getParent();if(s){const i=t.getIndexWithinParent();s.select(i,i)}}else n.selectEnd()}else{const n=t.getChildren().reverse().find(ge);n==null||n.selectEnd()}}function U_(t){return e=>Oi(e)?[e]:[e,t()]}function B_(t){return t.find(e=>Je(e))}function H_(t,e){return ve(t)?t.getChildren().find(r=>lt(r)&&ul(e,r.getNumber())):void 0}function W_(t,e){return e===0?B_(t):t.map(r=>H_(r,e)).filter(r=>r)[0]}function Fc(t){return!t||!ve(t)?void 0:t.getChildren().findLast(e=>lt(e))}function of(t){var e,r;if(!t||at(t))return;if(lt(t))return t;let n=Fe(t.getParent())?(e=t.getParent())==null?void 0:e.getPreviousSibling():t.getPreviousSibling();for(;n&&!lt(n)&&!at(n);)n=n.getPreviousSibling();if(n&&lt(n))return n;let s=(r=t.getTopLevelElement())==null?void 0:r.getPreviousSibling(),i=Fc(s),o=i;for(;s&&!i&&!at(s);)i=o,s=s.getPreviousSibling(),o=Fc(s);if(!(!i&&at(s)))return i}function z_(t){return c_(t)||kn(t)}function pl(t){if(ee(t)){const e=t.getTextContent();!e.endsWith(" ")&&!e.endsWith(ae)&&t.setTextContent(`${e} `)}}function af(t){if(ee(t)){const e=t.getTextContent();e.startsWith(" ")&&t.setTextContent(e.trimStart())}}function gl(t,e){return t.getEditorState().read(()=>!we(e))}const J_=["style"],K_=["style","code"],Ii=["style","cid"],V_=["style","number","sid","altnumber","pubnumber"],G_=["style","number","sid","altnumber","pubnumber"],Y_=["style","sid","eid"],X_=["style","caller","category","contents"],Q_=["chapter","immutable-chapter","verse","immutable-verse","ms","note","unmatched"],ds=`
`;function Z_(t,e){const r=we(t);if(!_t(r))return;const n=lf(r);return n===void 0?void 0:[{retain:n},...e,{delete:1}]}function lf(t){if(!t)return;const e=fs();let r=0;const n=[];let s,i;const o=t.getKey();let a;for(const l of e){const u=l.node;for(let d=n.length-1;d>=0;d--)if(hs(n[d],l)){const f=n[d];if(n.splice(d,1),r+=1,a&&f.getKey()===a.getKey())return r-1}if(s&&hs(s,l)&&(s=void 0,i=void 0),s){if(u.getKey()===o)return i;continue}if(u.getKey()===o){if(ee(u)||_t(u))return r;ut(u)&&(a=u)}if(ut(u)&&(n.includes(u)||n.push(u)),oe(u)){s=u,i=r,r+=1;continue}r+=cf(u)}if(a)return r}function Uc(t,e){if(t.length<2||!rk(t[0])||!tk(t[1]))return;const r=t[0].retain;return e.read(()=>{const n=ek(r);return n==null?void 0:n.getKey()})}function ek(t){const e=fs();let r=0;const n=[];let s,i;for(const o of e){const a=o.node;for(let u=n.length-1;u>=0;u--)if(hs(n[u],o)){const d=n[u];if(n.splice(u,1),r===t)return d;r+=1}if(s&&hs(s,o)&&(s=void 0,i=void 0),s){if(i===t)return s;continue}if(ut(a)&&(n.includes(a)||n.push(a)),oe(a)){if(s=a,i=r,r===t)return a;r+=1;continue}const l=cf(a);if(ee(a)&&l>0&&t>=r&&t<r+l||_t(a)&&r===t)return a;r+=l}for(const o of n){if(r===t)return o;r+=1}}function hs(t,e){return t?e?!h_(e.node,t.getKey()):!0:!1}function _t(t){return at(t)||lt(t)||Ki(t)||oe(t)||Zh(t)}function ut(t){return mt(t)||Ot(t)}function Ht(t,e){return e.insert!=null&&typeof e.insert=="object"&&t in e.insert}function tk(t){if(t.insert==null||typeof t.insert!="object")return!1;const e=Object.keys(t.insert)[0];return t.insert!=null&&typeof t.insert=="object"&&e in t.insert&&Q_.includes(e)}function rk(t){return t.retain!=null&&typeof t.retain=="number"}function cf(t){return ee(t)?t.getTextContentSize():_t(t)?1:0}function Sa(t,e){const r={insert:t.__text},n=gs(t,Ar);if(n&&(r.attributes={segment:n}),e&&e.length>0){const s=uf(e);s&&(r.attributes={...r.attributes,char:s})}return r}function Bc(t){const e=new zn;return t.isEmpty()||t.read(()=>{const r=Pt();if(!r||r.isEmpty())return;const n=r.getChildren();if(n.length===1&&Vt(n[0])&&(!n[0].getChildren()||n[0].getChildrenSize()===0))return;const s=nk();for(const i of s)e.push(i)}),e}function ml(t,e){const r=[],n=fs(t),s=[],i=[],o={children:[],contentsOps:[]},a=new Set;for(let l=0;l<n.length;l++){const u=n[l].node;r.push(...Hc(u,l,n,s,i,o,a))}for(const l of s)r.push(...Hc(l,n.length,n,s,i,o,a));return r}function nk(){return ml()}function Hc(t,e,r,n,s,i,o){if(!t)return[];const a=[];return sk(t,a,n),ik(t,a,s,i,o),ok(t,e,r,s,o,i,a),at(t)&&a.push(ck(t)),lt(t)&&a.push(dk(t)),Ki(t)&&a.push(hk(t)),Zh(t)&&a.push(fk(t)),ak(t,a,i),a}function sk(t,e,r){if(!t.isInline()){const n=r.pop();Ot(n)?e.push(lk(n)):Je(n)?e.push(uk(n)):Vt(n)&&e.push({insert:ds})}ut(t)&&(r.includes(t)||r.push(t))}function ik(t,e,r,n,s){var i;if(!ee(t))return;const o=t.getParent();if(oe(o)&&o.getFirstChild()===t)return;const a=t.getTextContent(),l=a.startsWith(Qa),u=ge(o)?o:void 0,d=!!u&&a===ae&&u.getChildrenSize()===1,f=Sa(t,r);if(n.children.includes(t)){if(!a||a===ae||l)return;(i=n.contentsOps)==null||i.push(f)}else d||l&&u||e.push(f);const h=a!==""&&!d&&!(l&&u);if(r.length>0&&h)for(const p of r)s.add(p)}function ok(t,e,r,n,s,i,o){var a;ge(t)&&!n.includes(t)&&n.push(t);const l=r[e+1];for(const u of n.toReversed())if(hs(u,l)){if(n.pop(),!s.has(u)){const d=gk(u);i.children.includes(u)?(a=i.contentsOps)==null||a.push(d):o.push(d)}s.delete(u)}}function ak(t,e,r){var n,s;if(!oe(t))return;fs(t).forEach(o=>r.children.push(o.node));const i=pk(t);r.contentsOps=(s=(n=i.insert.note)==null?void 0:n.contents)==null?void 0:s.ops,e.push(i)}function lk(t){const e={style:ls,code:t.__code};return{insert:ds,attributes:{book:e}}}function ck(t){const e={style:Ai,number:t.__number};return t.__sid&&(e.sid=t.__sid),t.__altnumber&&(e.altnumber=t.__altnumber),t.__pubnumber&&(e.pubnumber=t.__pubnumber),{insert:{chapter:e}}}function uk(t){const e={style:t.__marker};return{insert:ds,attributes:{para:e}}}function dk(t){const e={style:Ni,number:t.__number};return t.__sid&&(e.sid=t.__sid),t.__altnumber&&(e.altnumber=t.__altnumber),t.__pubnumber&&(e.pubnumber=t.__pubnumber),{insert:{verse:e}}}function hk(t){const e={style:t.__marker};return t.__sid&&(e.sid=t.__sid),t.__eid&&(e.eid=t.__eid),{insert:{milestone:e}}}function fk(t){return{insert:{unmatched:{marker:t.__marker}}}}function pk(t){const e={style:t.__marker,caller:t.__caller};t.__category&&(e.category=t.__category),t.getChildrenSize()>1&&(e.contents={ops:[]});const r={insert:{note:e}},n=gs(t,Ar);return n&&(r.attributes={segment:n}),r}function gk(t){const e={insert:""},r=uf([t]);return r&&(e.attributes={char:r}),e}function uf(t){if(t.length===0)return;const e=t.map(mk);return e.length===1?e[0]:e}function mk(t){const e={style:t.__marker},r=gs(t,Mr);r&&(e.cid=r);const n=t.getUnknownAttributes();return n&&Object.keys(n).length>0&&Object.assign(e,n),e}const df=1;class bt extends fn{constructor(e=jt,r="",n,s){super(s),z(this,"__caller"),z(this,"__previewText"),z(this,"__onClick"),this.__caller=e,this.__previewText=r,this.__onClick=n??(()=>{})}static getType(){return"immutable-note-caller"}static clone(e){const{__caller:r,__previewText:n,__onClick:s,__key:i}=e;return new bt(r,n,s,i)}static importDOM(){return{span:e=>bk(e)?{conversion:yk,priority:1}:null}}static importJSON(e){return yl().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setCaller(e.caller).setPreviewText(e.previewText).setOnClick(e.onClick)}setCaller(e){if(this.__caller===e)return this;const r=this.getWritable();return r.__caller=e,r}getCaller(){return this.getLatest().__caller}setPreviewText(e){if(this.__previewText===e)return this;const r=this.getWritable();return r.__previewText=e,r}getPreviewText(){return this.getLatest().__previewText}setOnClick(e){if(this.__onClick===e)return this;const r=this.getWritable();return r.__onClick=e,r}getOnClick(){return this.getLatest().__onClick}createDOM(){const e=document.createElement("span");return e.classList.add(this.__type),e.setAttribute("data-caller",this.__caller),e.setAttribute("data-preview-text",this.__previewText),e}updateDOM(e){return e.__caller!==this.__caller}exportDOM(e){const{element:r}=super.exportDOM(e);return r&&dr(r)&&(r.classList.add(this.getType()),r.setAttribute("data-caller",this.getCaller()),r.setAttribute("data-preview-text",this.getPreviewText())),{element:r}}decorate(e){const r=this.getParent();if(!r)return null;const n=r.getKey(),s=r.getIsCollapsed(),i=this.__key,o=l=>{var u;return(u=this.__onClick)==null?void 0:u.call(this,l,n,s,()=>_k(e,n),d=>kk(e,n,i,d),()=>vk(e,n))},a=`${this.__caller}_${this.__previewText}}`.replace(/\s+/g,"").substring(0,25);return m.jsx("button",{onClick:o,title:this.__previewText,"data-caller-id":a,children:this.__caller===jt&&s?"":this.__caller})}exportJSON(){return{type:this.getType(),caller:this.getCaller(),previewText:this.getPreviewText(),onClick:this.getOnClick(),version:df}}isKeyboardSelectable(){return!1}}function yk(t){const e=t.getAttribute("data-caller")??"",r=t.getAttribute("data-preview-text")??"";return{node:yl(e,r)}}function yl(t,e,r){return Oe(new bt(t,e,r))}function bk(t){return t?t.classList.contains(bt.getType()):!1}function mr(t){return t instanceof bt}function _k(t,e){return t.read(()=>{const r=we(e);if(!oe(r))throw new Error(`getNoteCaller: Note node not found: ${e}`);return r.getCaller()})}function kk(t,e,r,n){t.update(()=>{const s=we(e);if(!oe(s))throw new Error(`setNoteCaller: Note node not found: ${e}`);s.setCaller(n);const i=we(r);if(!mr(i))throw new Error(`setNoteCaller: Caller node not found: ${r}`);i.setCaller(n)})}function vk(t,e){return t.read(()=>{const r=we(e);if(!oe(r))throw new Error(`getNoteOps: Note node not found: ${e}`);return ml(r)})}const wk=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],xk=[bt,Ye,...O_],Ck=_.forwardRef((t,e)=>{const{coords:r,children:n,style:s,...i}=t,o=r!==void 0;return m.jsx("div",{ref:e,className:"floating-box","aria-hidden":!o,style:{...s,position:"absolute",zIndex:1e3,top:r==null?void 0:r.y,left:r==null?void 0:r.x,visibility:o?"visible":"hidden",opacity:o?1:0},...i,children:n})});function Sk(){const[t,e]=_.useState(void 0),[r,n]=_.useState(),s=_.useRef(null),i=_.useCallback((a,l)=>{s.current&&s.current();const u=a.commonAncestorContainer.nodeType===a.commonAncestorContainer.TEXT_NODE?a:a.commonAncestorContainer;s.current=Ap(u,l,()=>{Np(u,l,{placement:"bottom-start",middleware:[Op(),jp()]}).then(d=>{n(d.placement),e(f=>(f==null?void 0:f.x)===d.x&&(f==null?void 0:f.y)===d.y?f:{x:d.x,y:d.y})}).catch(()=>{e(void 0)})})},[]),o=_.useCallback(()=>{s.current&&(e(void 0),s.current(),s.current=null)},[]);return _.useEffect(()=>o,[o]),{coords:t,placement:r,updatePosition:i,cleanup:o}}function Ek({isOpen:t,floatingBoxRef:e}){const{coords:r,updatePosition:n,cleanup:s,placement:i}=Sk();return _.useEffect(()=>{var o;if(!t||!e.current){s();return}const a=(o=window.getSelection())==null?void 0:o.getRangeAt(0);if(!a){s();return}return n(a,e.current),s},[s,t,e,n]),{coords:r,placement:i}}const Tk=document.body,Mk=_.memo(Ck);function Ak({isOpen:t=!1,children:e}){const r=_.useRef(null),{coords:n,placement:s}=Ek({isOpen:t,floatingBoxRef:r}),i=_.useMemo(()=>n?typeof e=="function"?e:()=>e:()=>null,[e,n]);return gt.createPortal(m.jsx(Mk,{ref:r,coords:n,style:n?void 0:{display:"none"},children:i({isOpen:t,placement:s})}),Tk)}const hf=_.createContext(void 0);function bl(){const t=_.useContext(hf);if(!t)throw new Error("useMenuContext must be used within a MenuProvider");return t}function Nk(t,e){const[r,n]=_.useState(0),[s,i]=_.useState(-1),o=_.useMemo(()=>t??[],[t]),a={menuItems:o,activeIndex:r,selectedIndex:s,onSelectOption:e??(()=>{})},l=_.useCallback(()=>{n(f=>{const h=o.length;return h?(f-1+h)%h:0})},[o.length]),u=_.useCallback(()=>{n(f=>{const h=o.length;return h?(f+1)%h:0})},[o.length]),d=_.useCallback(()=>{const f=o.length;if(r>=0&&r<f){const h=o[r];e==null||e(h),i(r)}},[r,o,e]);return{state:a,moveUp:l,moveDown:u,select:d,setActiveIndex:n,setSelectedIndex:i}}function Ok({children:t,menuItems:e,onSelectOption:r,...n}){const s=Nk(e,r);return m.jsx(hf.Provider,{value:s,children:m.jsx("div",{...n,children:t})})}const ff=_.forwardRef(({index:t,children:e,onMouseEnter:r,onClick:n,...s},i)=>{const{state:{activeIndex:o},setActiveIndex:a,setSelectedIndex:l,select:u}=bl(),d=_.useCallback(h=>{u(),l(-1),n==null||n(h)},[n,u,l]),f=_.useCallback(h=>{a(t),r==null||r(h)},[t,a,r]);return m.jsx("button",{ref:i,role:"menuitem",...s,onClick:d,onMouseEnter:f,"aria-selected":t!==void 0&&o===t?"true":void 0,tabIndex:-1,children:e})});function jk({children:t,autoIndex:e=!0,...r}){const n=_.useRef(null),{state:{activeIndex:s,menuItems:i}}=bl(),o=_.useMemo(()=>i?typeof t=="function"?t:()=>t:()=>null,[t,i]),a=_.useMemo(()=>{const l=o(i);return e?_.Children.map(l,(u,d)=>_.isValidElement(u)&&u.type===ff&&u.props.index===void 0?_.cloneElement(u,{index:d}):u):l},[o,e,i]);return _.useEffect(()=>{if(n.current){const l=n.current,u=l.children[s];if(u){const d=l.getBoundingClientRect(),f=u.getBoundingClientRect();f.bottom>d.bottom?l.scrollTop+=f.bottom-d.bottom:f.top<d.top&&(l.scrollTop-=d.top-f.top)}}},[s]),m.jsx("div",{ref:n,role:"menu",...r,children:a})}const Xo={Root:Ok,Options:jk,Option:ff},Ik=(t,e,r)=>_i(t,r).toLowerCase().includes(e.toLowerCase()),Wc=t=>Object.keys(t).find(e=>typeof t[e]=="string")||"",_i=(t,e)=>{const r=t[e];return typeof r=="string"?r:String(r)};function Pk(t){const{query:e,items:r,filterBy:n,filter:s,sortBy:i,sortingOptions:o}=t,{caseSensitive:a=!1,priorityOrder:l=["exact","startsWith","contains"]}=o||{},u=a?e:e.toLowerCase();let d,f;s?(f=s,d=r.length>0?Wc(r[0]):""):(d=n||(r.length>0?Wc(r[0]):""),f=(y,b)=>Ik(y,b,d));const h=i||d,p=new Map;return r.filter(y=>{try{return f(y,e)}catch(b){return console.warn("Error filtering item:",y,b),!1}}).sort((y,b)=>{const S=A=>(p.has(A)||p.set(A,_i(A,h).toLowerCase()),p.get(A)??""),C=a?_i(y,h):S(y),x=a?_i(b,h):S(b);for(const A of l)switch(A){case"exact":if(C===u&&x!==u)return-1;if(x===u&&C!==u)return 1;break;case"startsWith":if(C.startsWith(u)&&!x.startsWith(u))return-1;if(x.startsWith(u)&&!C.startsWith(u))return 1;break;case"contains":{const O=C.indexOf(u),$=x.indexOf(u);if(O!==-1&&$===-1)return-1;if($!==-1&&O===-1)return 1;if(O!==-1&&$!==-1)return O-$;break}}return C.localeCompare(x)})}function Rk(t){const{query:e,items:r,filterBy:n,filter:s,sortBy:i,sortingOptions:o}=t;return _.useMemo(()=>Pk({query:e,items:r,filterBy:n,filter:s,sortBy:i,sortingOptions:o}),[e,r,n,s,i,o])}function $k(){const{moveUp:t,moveDown:e,select:r}=bl();return _.useMemo(()=>({moveUp:t,moveDown:e,select:r}),[t,e,r])}const qk=()=>{const t=$k(),[e]=ue();_.useEffect(()=>{const r=n=>{const s={ArrowDown:()=>t==null?void 0:t.moveDown(),ArrowUp:()=>t==null?void 0:t.moveUp(),Enter:()=>t==null?void 0:t.select(),Tab:()=>t==null?void 0:t.select()}[n.key];return s?(s(),n.preventDefault(),n.stopPropagation(),!0):!1};return e.registerCommand(ps,r,Fi)},[e,t])};function Lk(){return qk(),null}function Dk(t){const{options:e,onSelectOption:r,onClose:n,inverse:s,query:i,menuOpenKey:o}=t,[a]=ue(),l=i!==void 0,[u,d]=_.useState(""),f=l?i??"":u,h=Rk({query:f,items:e,filterBy:"name"}),p=y=>{n==null||n(),r?r(y):y.action(a)};return _.useEffect(()=>a.registerCommand(ps,y=>{if(l)return!1;const b={Escape:()=>n==null?void 0:n(),Backspace:()=>{f.length===0?n==null||n():d(S=>S.slice(0,-1))}}[y.key];return b?(y.stopPropagation(),y.preventDefault(),b(),!0):y.key.length===1?(y.stopPropagation(),y.preventDefault(),y.key!==o&&d(S=>S+y.key),!0):!1},Fi),[a,l,f,o,n]),m.jsxs(Xo.Root,{className:`autocomplete-menu-container ${s?"inverse":""}`,menuItems:h,onSelectOption:y=>p(y),children:[!l&&m.jsx("input",{value:f,type:"text",disabled:!0}),m.jsx(Lk,{}),m.jsx(Xo.Options,{className:"autocomplete-menu-options",autoIndex:!1,children:y=>y.map((b,S)=>m.jsxs(Xo.Option,{index:S,children:[m.jsx("span",{className:"label",children:b.label??b.name}),m.jsx("span",{className:"description",children:b.description})]},b.name))})]})}function Fk({trigger:t,items:e}){const[r]=ue(),[n,s]=_.useState(!1),i=_.useCallback(o=>{o.key==="Escape"&&n?(s(!1),r.focus()):o.key===t&&!n&&(o.preventDefault(),s(!0))},[r,t,n]);return _.useEffect(()=>r.registerRootListener(o=>{if(o)return o.addEventListener("keydown",i),()=>{o.removeEventListener("keydown",i)}}),[r,i]),_.useEffect(()=>r.registerUpdateListener(({prevEditorState:o,editorState:a})=>{const l=o.read(()=>{const u=ne();if(X(u))return u});a.read(()=>{const u=ne();!X(u)||l!=null&&l.is(u)||s(!1)})}),[r]),e&&m.jsx(Ak,{isOpen:n,children:({placement:o})=>m.jsx(Dk,{options:e,onClose:()=>s(!1),inverse:o==="top-start",menuOpenKey:t})})}function Uk({scriptureReference:t,contextMarker:e,getMarkerAction:r}){return{markersMenuItems:_.useMemo(()=>{if(!e||!t)return;const n=Pc(e);if(n!=null&&n.children)return Object.values(n.children).flatMap(s=>s.map(i=>{const o=Pc(i),{action:a}=r(i,o);return{name:i,label:i,description:(o==null?void 0:o.description)??"",action:l=>{a({editor:l,reference:t})}}}))},[e,r,t])}}function ki(t,e){return`${t}:${e}`}function Bk(t,e){_.useEffect(()=>{if(!t.hasNodes([Le]))throw new Error("AnnotationPlugin: TypedMarkNode not registered on editor!");const r=new Map;return Xe(md(t,Le,n=>us(n.getTypedIDs()),(n,s)=>{for(const[i,o]of Object.entries(n.getTypedIDs()))o.forEach(a=>{s.addID(i,a)})}),t.registerMutationListener(Le,n=>{t.getEditorState().read(()=>{for(const[s,i]of n){const o=we(s);let a={};i==="destroyed"?a=r.get(s)??{}:Fe(o)&&(a=o.getTypedIDs());for(const[l,u]of Object.entries(a))if(!Le.isReservedType(l))for(const d of u){let f=e.get(ki(l,d));a[l]=u,r.set(s,a),i==="destroyed"?f!==void 0&&(f.delete(s),f.size===0&&e.delete(ki(l,d))):(f===void 0&&(f=new Set,e.set(ki(l,d),f)),f.has(s)||f.add(s))}}})},{skipInitialization:!0}))},[t,e])}const Hk=_.forwardRef(function({logger:t},e){const[r]=ue(),n=_.useMemo(()=>new Map,[]);return Bk(r,n),_.useImperativeHandle(e,()=>({addAnnotation(s,i,o){if(Le.isReservedType(i))throw new Error(`addAnnotation: Can't directly add this reserved annotation type '${i}'. Use the appropriate plugin instead.`);r.update(()=>{const a=hl(s);if(a===void 0){t==null||t.error("Failed to find start or end node of the annotation.");return}Yh(a,i,o)},{tag:va})},removeAnnotation(s,i){if(Le.isReservedType(s))throw new Error(`removeAnnotation: Can't directly remove this reserved annotation type '${s}'. Use the appropriate plugin instead.`);const o=n.get(ki(s,i));o!==void 0&&setTimeout(()=>{r.update(()=>{for(const a of o){const l=we(a);Fe(l)&&(l.deleteID(s,i),l.hasNoIDsForEveryType()&&Gh(l))}},{tag:va})})}})),null});function Wk({ignoreHistoryMergeTagChange:t=!0,ignoreSelectionChange:e=!1,onChange:r}){const[n]=ue();return _.useLayoutEffect(()=>{if(r)return n.registerUpdateListener(s=>{const{editorState:i,dirtyElements:o,dirtyLeaves:a,prevEditorState:l,tags:u}=s;if(e&&o.size===0&&a.size===0||t&&u.has(id)||l.isEmpty())return;const d=zk(n,s);d.length!==0&&r(i,n,u,d)})},[n,t,e,r]),null}function zk(t,{dirtyLeaves:e,prevEditorState:r}){let n=new zn;return t.getEditorState().read(()=>{const s=e.values().next().value??"";if(e.size===1&&ee(we(s))){const i=we(s),o=lf(i);if(ee(i)&&o!==void 0){const a=r.read(()=>{const d=we(s);return new zn([ee(d)?Sa(d):{insert:""}])}),l=new zn([Sa(i)]),u=new zn(o>0?[{retain:o}]:[]);n=n.concat(u).concat(a.diff(l))}}else{const i=Bc(r),o=Bc(t.getEditorState());n=i.diff(o)}}),n.ops}function Jk(t,e,r,n){let s=0;t.forEach(i=>{if("retain"in i)s+=Kk(i,s,e,n);else if("delete"in i){if(typeof i.delete!="number"||i.delete<=0){n==null||n.error(`Invalid delete operation: ${JSON.stringify(i)}`);return}n==null||n.debug(`Delete: ${i.delete}`),Gk(s,i.delete,n)}else"insert"in i?typeof i.insert=="string"?(n==null||n.debug(`Insert: '${i.insert}'`),s+=Yk(s,i.insert,i.attributes,e,n)):typeof i.insert=="object"&&i.insert!==null?(n==null||n.debug(`Insert embed: ${JSON.stringify(i.insert)}`),Qk(s,i,e,r,n)?s+=1:n==null||n.error(`Failed to process insert embed operation: ${JSON.stringify(i.insert)} at index ${s}. Document may be inconsistent.`)):n==null||n.error(`Insert of unknown type: ${JSON.stringify(i.insert)}`):n==null||n.error(`Unknown operation: ${JSON.stringify(i)}`)})}function Kk(t,e,r,n){return typeof t.retain!="number"||t.retain<0?(n==null||n.error(`Invalid retain operation: ${JSON.stringify(t)}`),0):(n==null||n.debug(`Retain: ${t.retain}`),t.attributes&&(n==null||n.debug(`Retain attributes: ${JSON.stringify(t.attributes)}`),Vk(e,t.retain,t.attributes,r,n)),t.retain)}function Vk(t,e,r,n,s){s==null||s.debug(`Applying attributes for range [${t}, ${t+e-1}] with attributes: ${JSON.stringify(r)}`);let i=e,o=0,a=-1;const l=Pt();function u(d){if(i<=0)return!0;if(ee(d)){const f=d.getTextContentSize();if(t<o+f&&o<t+e){const h=Math.max(0,t-o),p=f-h,y=Math.min(i,p);if(y>0){let b=d;const S=h>0,C=y<f-h;if(S&&C){const[,x]=d.splitText(h);[b]=x.splitText(y)}else S?[,b]=d.splitText(h):C&&([b]=d.splitText(y));if(jr(r)){const x=b.getParent();if(ge(x)){const A=r.char;let O;Array.isArray(A)?a>=0&&a<=A.length-1&&(O=A[a]):a===0&&(O=A);const $=O?Or(O,x):!1;if($&&Array.isArray(A)&&A.length>1){const L=Ce("");b.replace(L);const H=typeof r.segment=="string"?r.segment:void 0,q=ws(A.slice(1),n,b,H);let F=L;for(const W of q)F.insertAfter(W),F=W;L.remove(),ot(r,b)}else if($)ot(r,b);else{b.remove();const L=zc(b,r,n,s);if(L&&L.length>0){let H=x;for(const q of L)H.insertAfter(q),H=q}}}else{const A=Ce("");b.replace(A);const O=zc(b,r,n,s);if(O&&O.length>0){let $=A;for(const L of O)$.insertAfter(L),$=L;A.remove()}else A.replace(b)}}else ot(r,b);i-=y}}o+=f}else if(_t(d))t<=o&&o<t+e&&i>0&&(Jc(d,r),i-=1),o+=1;else if(ge(d)){a+=1;let f=!1;if(t<=o&&o<t+e&&i>0)if(jr(r)){const h=r.char;let p;if(Array.isArray(h)?a>=0&&a<=h.length-1&&(p=h[a]):a===0&&(p=h),p){d.setMarker(p.style),typeof p.cid=="string"&&Wt(d,Mr,()=>p.cid);const y=Re(p,Ii);y&&Object.keys(y).length>0?d.setUnknownAttributes({...d.getUnknownAttributes()??{},...y}):d.setUnknownAttributes(void 0)}}else(r.char===!1||r.char===null||ov(r.char))&&(f=!0);if(i>0){const h=d.getChildren();for(const p of h){if(i<=0)break;if(u(p)&&i<=0)return f&&Ol(d),!0}}f&&Ol(d),a-=1}else if(ut(d)){const f=d.getChildren();for(const p of f){if(i<=0)break;if(u(p)&&i<=0)return!0}const h=1;if(t<=o&&o<t+i&&i>0){if(!Vt(d))Jc(d,r);else if(_l(r)){const p=gf(r.para);p&&d.replace(p,!0)}i-=h}o+=h}else if(ve(d)){const f=d.getChildren();for(const h of f){if(i<=0)break;if(u(h)&&i<=0)return!0}}return i<=0}u(l),i>0&&(s==null||s.warn(`$applyAttributes: Not all characters in the retain operation (length ${e}) could be processed. Remaining: ${i}. targetIndex: ${t}, final currentIndex: ${o}`))}function zc(t,e,r,n){var s;const i=typeof e.segment=="string"?e.segment:void 0,o=ws(e.char,r,t,i),a=o.find(ge);if(!a){n==null||n.error(`Failed to create CharNode for text transformation. Style: ${Array.isArray(e.char)?e.char[0].style:(s=e.char)==null?void 0:s.style}. Falling back to standard text attributes.`),ot(e,t);return}const l={};mf.forEach(f=>{t.hasFormat(f)&&(l[f]="true")});const u={};Object.entries(e).forEach(([f,h])=>{f==="segment"||f==="char"||(typeof h=="string"?u[f]=h:h===!0?u[f]="true":h===!1&&(u[f]="false"))});const d={...a.getUnknownAttributes()??{},...l,...u};return Object.keys(d).length>0&&a.setUnknownAttributes(d),ot(e,t),o}function Jc(t,e){for(const r of Object.keys(e)){const n=e[r];if(r==="char"&&ge(t)&&jr(e)){const s=n;if(t.setMarker(s.style),typeof s.cid=="string"){const o=s.cid;Wt(t,Mr,()=>o)}const i=Re(s,Ii);i&&Object.keys(i).length>0&&t.setUnknownAttributes({...t.getUnknownAttributes()??{},...i});continue}typeof n=="string"&&(at(t)||lt(t)||Ki(t)||oe(t)||bs(t)?t.setUnknownAttributes({...t.getUnknownAttributes()??{},[r]:n}):(Ot(t)||Je(t)||ge(t))&&(r==="style"&&!Ot(t)?t.setMarker(n):r==="code"&&Ot(t)?t.setCode(n):t.setUnknownAttributes({...t.getUnknownAttributes()??{},[r]:n})),r==="segment"&&Wt(t,Ar,()=>n))}}function Gk(t,e,r){if(e<=0)return;const n=Pt();let s=0,i=e;function o(a){if(i<=0)return!0;if(ee(a)){let l=a.getTextContentSize();if(t<s+l&&s<t+i){const u=Math.max(0,t-s),d=l-u,f=Math.min(i,d);f>0&&(a.spliceText(u,f,""),a.getTextContentSize()===0&&a.remove(),r==null||r.debug(`Deleted ${f} length from TextNode (key: ${a.getKey()}) at nodeOffset ${u}. Original targetIndex: ${t}, current currentIndex: ${s}.`),i-=f,l-=f)}s+=l}else if(_t(a))t<=s&&s<t+i?(a.remove(),r==null||r.debug(`Deleted embed node (key: ${a.getKey()}) at currentIndex: ${s}. Original targetIndex: ${t}, remainingToDelete: ${i}.`),i-=1):s+=1;else if(ut(a)){const l=a.getChildren().slice(),u=a.getChildren();for(const d of u){if(i<=0)break;if(o(d)&&i<=0)return!0}if(t<=s&&s<t+i&&ut(a)){i-=1;const d=a.getChildren().length;if(l.length>0&&d===0){const f=a.getParent();((f==null?void 0:f.getChildren())??[]).length>1?(a.remove(),r==null||r.debug(`Removed entire ParaNode that had all its content deleted at currentIndex: ${s}. Original targetIndex: ${t}, remainingToDelete: ${i}.`)):(a.replace(yt(),!0),r==null||r.debug(`Replaced last ParaNode with ImpliedParaNode at currentIndex: ${s}. Original targetIndex: ${t}, remainingToDelete: ${i}.`))}else if(i>0){const f=a.getNextSibling();if(f&&mt(f)){let h=s+1;const p=f.getChildren();for(const b of p){if(i<=0)break;const S=s;if(s=h,o(b)){s=S;break}ee(b)?h+=b.getTextContentSize():_t(b)&&(h+=1),s=S}const y=f.getChildren();for(const b of y)b.remove(),a.append(b);f.remove(),r==null||r.debug(`Merged next paragraph into current one after deleting symbolic close at currentIndex: ${s}. Original targetIndex: ${t}, remainingToDelete: ${i}.`)}else a.replace(yt(),!0)}else Je(a)?a.replace(yt(),!0):a.remove()}s+=1}else if(ve(a)){const l=a.getChildren();for(const u of l){if(i<=0)break;if(o(u)&&i<=0)return!0}}return i<=0}o(n),i>0&&(r==null||r.warn(`Delete operation could not remove all requested characters. Remaining to delete: ${i}. Original targetIndex: ${t}, OT length: ${e}. Final currentIndex: ${s}`))}function Yk(t,e,r,n,s){if(e===ds)return Kc(t,r,s);if(e.endsWith(ds)&&!_l(r)){const i=e.slice(0,-1);let o=0;if(i.length>0){if(jr(r))throw new Error("Text + LF should not have char attributes");o+=Pi(t,i,r,s)}return o+=Kc(t+o,r,s),o}else return jr(r)?Xk(t,e,r,n,s):Pi(t,e,r,s)}function Xk(t,e,r,n,s){s==null||s.debug(`Attempting to insert CharNode with text "${e}" and attributes ${JSON.stringify(r.char)} at index ${t}`);const i=Ce(e===""?ae:e);ot(r,i);let o;{let p=function(S){if(ee(S)){const C=S.getTextContentSize();if(t>=b&&t<b+C){const x=S.getParent();return ge(x)&&(o=x),!0}b+=C}else if(_t(S))b+=1;else if(ge(S)){const C=S.getChildren();for(const x of C)if(p(x))return!0}else if(ve(S)){const C=S.getChildren();for(const x of C)if(p(x))return!0;ut(S)&&(b+=1)}return!1};const y=Pt();let b=0;p(y)}let a=r.char;if(Array.isArray(a)){if(o){const p=a[0];p&&Or(p,o)?(a=a.slice(1),a.length===1&&(a=a[0])):o=void 0}}else o&&(Or(a,o)||(o=void 0));const l=typeof r.segment=="string"?r.segment:void 0,u=ws(a,n,i,l,o?[o]:void 0);if(u.length===0)return e.length;const d=u.find(ge);if(!d)return s==null||s.error(`CharNode style is missing for text "${e}". Attributes: ${JSON.stringify(r.char)}. Falling back to rich text insertion.`),Pi(t,e,void 0,s);const f={};for(const[p,y]of Object.entries(r))p!=="char"&&p!=="segment"&&typeof y=="string"&&(f[p]=y);Object.keys(f).length>0&&d.setUnknownAttributes(f);let h=!0;for(const p of u)if(!pf(t,p,s)){h=!1;break}return h?e.length:(s==null||s.error(`Failed to insert CharNode with text "${e}" at index ${t}. Falling back to rich text.`),Pi(t,e,void 0,s))}function Pi(t,e,r,n){if(e.length<=0)return n==null||n.debug("Attempted to insert empty string. No action taken."),0;const s=Pt();let i=0,o=!1;function a(l){if(o)return!0;if(ee(l)){const u=l.getTextContentSize();if(t>=i&&t<=i+u){const d=t-i,f=Ce(e);if(ot(r,f),d===0)l.insertBefore(f);else if(d===u){const h=l.getParent();ge(h)&&!jr(r)?h.insertAfter(f):l.insertAfter(f)}else{const[,h]=l.splitText(d);h.insertBefore(f)}return n==null||n.debug(`Inserted text "${e}" in/around TextNode (key: ${l.getKey()}) at nodeOffset ${d}. Original targetIndex: ${t}, currentIndex at node start: ${i}.`),o=!0,!0}i+=u}else if(_t(l))i+=1;else if(ge(l)){if(!o&&t===i){const d=Ce(e);ot(r,d);const f=l.getFirstChild();return f?f.insertBefore(d):l.append(d),n==null||n.debug(`Inserted text "${e}" at beginning of CharNode ${l.getType()} (key: ${l.getKey()}).`),o=!0,!0}const u=l.getChildren();for(const d of u){if(a(d))return!0;if(o)break}if(!o&&t===i){const d=Ce(e);return ot(r,d),l.append(d),n==null||n.debug(`Appended text "${e}" to end of CharNode ${l.getType()} (key: ${l.getKey()}).`),o=!0,!0}}else if(ut(l)){if(!o&&t===i){const d=Ce(e);ot(r,d);const f=l.getFirstChild();return f?f.insertBefore(d):l.append(d),n==null||n.debug(`Inserted text "${e}" at beginning of container ${l.getType()} (key: ${l.getKey()}).`),o=!0,!0}const u=l.getChildren();for(const d of u){if(a(d))return!0;if(o)break}if(!o&&t===i){const d=Ce(e);return ot(r,d),l.append(d),n==null||n.debug(`Appended text "${e}" to end of container ${l.getType()} (key: ${l.getKey()}).`),o=!0,!0}i+=1}else if(ve(l)){const u=l.getChildren();for(const d of u){if(a(d))return!0;if(o)break}}return o}if(a(s),!o&&t===i){n==null||n.debug(`Insertion point matches end of document (targetIndex: ${t}, final currentIndex: ${i}). Appending text to new ParaNode.`);const l=Ce(e);ot(r,l);const u=yt().append(l);s.append(u),o=!0}return o?e.length:(n==null||n.warn(`$insertRichText: Could not find insertion point for text "${e}" at targetIndex ${t}. Final currentIndex: ${i}. Text not inserted.`),0)}function pf(t,e,r){const n=Pt();let s=0,i=!1;function o(a){if(i)return!0;if(a===n&&t===0&&!n.getFirstChild())return e.isInline()?(r==null||r.debug(`$insertNodeAtCharacterOffset: Inserting inline node ${e.getType()} into empty root, wrapped in ImpliedParaNode. targetIndex: ${t}`),n.append(yt().append(e))):(r==null||r.debug(`$insertNodeAtCharacterOffset: Inserting block node ${e.getType()} directly into empty root. targetIndex: ${t}`),n.append(e)),i=!0,!0;if(!ve(a))return!1;const l=a.getChildren();for(const u of l){if(t===s&&!i){if(a===n&&e.isInline())if(mt(u)){r==null||r.debug(`$insertNodeAtCharacterOffset: Inserting inline node ${e.getType()} into existing ${u.getType()} at beginning. targetIndex: ${t}`);const d=u.getFirstChild();d?d.insertBefore(e):u.append(e)}else r==null||r.debug(`$insertNodeAtCharacterOffset: Inserting inline node ${e.getType()} into root before ${u.getType()}, wrapping in ImpliedParaNode. targetIndex: ${t}`),u.insertBefore(yt().append(e));else u.insertBefore(e),r==null||r.debug(`$insertNodeAtCharacterOffset: Inserted node ${e.getType()} (key: ${e.getKey()}) before child ${u.getType()} (key: ${u.getKey()}) in ${a.getType()} (key: ${a.getKey()}). targetIndex: ${t}, currentIndex: ${s}`);return i=!0,!0}if(ee(u)){const d=u.getTextContentSize();if(!i&&t>s&&t<s+d){const f=t-s,[h]=u.splitText(f);return h.insertAfter(e),r==null||r.debug(`$insertNodeAtCharacterOffset: Inserted node ${e.getType()} (key: ${e.getKey()}) by splitting TextNode (key: ${u.getKey()}) at offset ${f}. targetIndex: ${t}, currentIndex at node start: ${s}`),i=!0,!0}s+=d}else if(_t(u))s+=1;else if(ge(u)){if(o(u))return!0}else if(ut(u)){const d=u;if(o(d))return!0;const f=s;if(Vt(d)&&ut(e)&&t===f&&!i)return r==null||r.debug(`$insertNodeAtCharacterOffset: Replacing ImpliedParaNode (key: ${d.getKey()}) with block node '${e.getType()}' (key: ${e.getKey()}) at OT index ${t}.`),u.replace(e,!0),s=f+1,i=!0,!0;s+=1}else if(ve(u)&&o(u))return!0;if(i)return!0}return ve(a)&&!i&&(t===s||a===n&&t>s)?a===n?(e.isInline()?(r==null||r.debug(`$insertNodeAtCharacterOffset: Appending inline node ${e.getType()} to root. Wrapping in new ImpliedParaNode. targetIndex: ${t}, current document OT length: ${s}.`),n.append(yt().append(e))):(r==null||r.debug(`$insertNodeAtCharacterOffset: Appending block node ${e.getType()} to root. targetIndex: ${t}, current document OT length: ${s}.`),n.append(e)),i=!0,!0):mt(a)?Vt(a)&&Je(e)&&t===s?(r==null||r.debug(`$insertNodeAtCharacterOffset: Replacing ImpliedParaNode container (key: ${a.getKey()}) with ParaNode ${e.getType()} (key: ${e.getKey()}) via append logic. targetIndex: ${t}`),a.replace(e,!0),i=!0,!0):e.isInline()||!mt(e)?(r==null||r.debug(`$insertNodeAtCharacterOffset: Appending node ${e.getType()} to existing container ${a.getType()} (key: ${a.getKey()}). targetIndex: ${t}, container end OT index: ${s}.`),a.append(e),i=!0,!0):(r==null||r.debug(`$insertNodeAtCharacterOffset: Inserting block node ${e.getType()} after container ${a.getType()} (key: ${a.getKey()}). targetIndex: ${t}, container end OT index: ${s}.`),a.insertAfter(e),i=!0,!0):(ge(a)?(r==null||r.debug(`$insertNodeAtCharacterOffset: Inserting node ${e.getType()} after CharNode (key: ${a.getKey()}). targetIndex: ${t}, element end OT index: ${s}.`),a.insertAfter(e)):e.isInline()||!mt(e)?(r==null||r.debug(`$insertNodeAtCharacterOffset: Appending node ${e.getType()} to generic element ${a.getType()} (key: ${a.getKey()}). targetIndex: ${t}, element end OT index: ${s}.`),a.append(e)):(r==null||r.debug(`$insertNodeAtCharacterOffset: Inserting block node ${e.getType()} after generic element ${a.getType()} (key: ${a.getKey()}). targetIndex: ${t}, element end OT index: ${s}.`),a.insertAfter(e)),i=!0,!0):i}return o(n),i||r==null||r.warn(`$insertNodeAtCharacterOffset: Could not find insertion point for node ${e.getType()} (key: ${e.getKey()}) at targetIndex ${t}. Final currentIndex: ${s}. Node not inserted.`),i}function Qk(t,e,r,n,s){let i;return Ht("chapter",e)?i=Zk(e.insert.chapter,r):Ht("verse",e)?i=ev(e.insert.verse,r):Ht("ms",e)?i=tv(e.insert.ms):Ht("unmatched",e)?i=rv(e.insert.unmatched):Ht("note",e)&&(i=nv(e,r,n,s)),i?pf(t,i,s):(s==null||s.error(`$insertEmbedAtCurrentIndex: Cannot create LexicalNode for embed object: ${JSON.stringify(e.insert)}`),!1)}function Kc(t,e,r){let n;_l(e)?n=gf(e.para):iv(e)&&(n=sv(e.book)),n??(n=yt());const s=n,i=Je(s),o=Vt(s);let a=0,l=!1;function u(d){if(l)return!0;if(ee(d)){const f=d.getTextContentSize();if(t>=a&&t<=a+f){const h=d.getParent();if(Je(h)&&(i||o)){r==null||r.debug(`Splitting ParaNode (marker: ${h.getMarker()}) with LF attributes at targetIndex ${t}`);const p=t-a,[y]=p>0?d.splitText(p):[void 0];let b=y==null?void 0:y.getPreviousSibling();for(;b;){const S=b;b=b.getPreviousSibling();const C=s.getFirstChild();C?C.insertBefore(S):s.append(S)}return y&&s.append(y),h.insertBefore(s),l=!0,!0}}a+=f}else if(_t(d))a+=1;else if(ut(d)){const f=d.getChildren();for(const h of f){if(u(h))return!0;if(l)break}if(t===a){if(Vt(d)&&s)return r==null||r.debug(`Replacing ImpliedParaNode (key: ${d.getKey()}) with ParaNode at targetIndex ${t}`),d.replace(s,!0),l=!0,!0;if(Je(d)&&s){const h=d;return r==null||r.debug(`Creating new block node with LF attributes after existing ParaNode (marker: ${h.getMarker()}) at targetIndex ${t}`),h.insertAfter(s),l=!0,!0}}if(a+=1,t===a&&Je(d)&&s)return r==null||r.debug(`Creating new block node after existing ParaNode (marker: ${d.getMarker()}) at targetIndex ${t}`),d.insertAfter(s),l=!0,!0}else if(ve(d)){const f=d.getChildren();for(const h of f){if(u(h))return!0;if(l)break}}return l}return u(Pt()),l||r==null||r.warn(`Could not find location to handle newline with para attributes at targetIndex ${t}. Final currentIndex: ${a}.`),1}function Zk(t,e){if(!t)return;const{number:r,sid:n,altnumber:s,pubnumber:i}=t;if(!r)return;const o=Re(t,V_);let a;if(e.markerMode==="editable")a=Oh(r,n,s,i,o);else{const l=e.markerMode==="visible";a=tl(r,l,n,s,i,o)}return a}function ev(t,e){if(!t)return;const{style:r,number:n,sid:s,altnumber:i,pubnumber:o}=t;if(!n)return;const a=Re(t,G_);let l;if(e.markerMode==="editable"){if(!r)return;const u=ks(r,n);l=Wh(n,u,s,i,o,a)}else{const u=e.markerMode==="visible";l=fl(n,u,s,i,o,a)}return l}function tv(t){if(!t)return;const{style:e,sid:r,eid:n}=t;if(!e)return;const s=Re(t,Y_);return Fh(e,r,n,s)}function rv(t){if(!t)return;const{marker:e}=t;if(e)return dl(e)}function nv(t,e,r,n){var s;const i=t.insert;if(!i.note)return;const{style:o,caller:a,category:l,contents:u}=i.note;if(!o||a==null)return;a===""&&(n==null||n.warn("Note has empty caller. Only use for note editing."));const d=Re(i.note,X_),f=(s=t.attributes)==null?void 0:s.segment;let h;f&&typeof f=="string"&&(h=f);const p=[];for(const y of(u==null?void 0:u.ops)??[])if(typeof y.insert=="string")if(jr(y.attributes)){const b=ws(y.attributes.char,e,Ce(y.insert),void 0,p);p.push(...b)}else p.push(Ce(y.insert));return sf(o,a,p,e,r,h).setCategory(l).setUnknownAttributes(d)}function sv(t){const{style:e,code:r}=t;if(!e||e!==ls||!r||!ct.isValidBookCode(r))return;const n=Re(t,K_);return Mh(r,n)}function gf(t){const{style:e}=t;if(!e)return;const r=Re(t,J_);return cs(e,r)}function ws(t,e,r,n,s){if(ee(r)&&r.getTextContentSize()===0&&r.setTextContent(ae),Array.isArray(t)){if(t.length===0)throw new Error("Empty charAttr array");const i=t[0],o=s==null?void 0:s[s.length-1];if(ge(o)&&Or(i,o))return t.length>1?ws(t.slice(1),e,r).forEach(d=>o.append(d)):r&&o.append(r),[];const a=t.reduceRight((d,f,h)=>{const p=Tt(f.style,Re(f,Ii));if(typeof f.cid=="string"&&Wt(p,Mr,()=>f.cid),n&&h===t.length-1&&Wt(p,Ar,()=>n),d)if(ge(d)){const y=d.getMarker(),b=[];Qo(y,b,e),b.forEach(C=>p.append(C)),p.append(d);const S=[];Zo(y,S,e),S.forEach(C=>p.append(C))}else p.append(d);return p},r),l=[],u=t[0];return Qo(u.style,l,e),l.push(a),Zo(u.style,l,e),l}else{const i=s==null?void 0:s[s.length-1];if(ge(i)&&Or(t,i))return r&&i.append(r),[];const o=[];Qo(t.style,o,e);const a=Tt(t.style,Re(t,Ii));return typeof t.cid=="string"&&Wt(a,Mr,()=>t.cid),n&&Wt(a,Ar,()=>n),r&&a.append(r),o.push(a),Zo(t.style,o,e),o}}function Qo(t,e,r){(r==null?void 0:r.markerMode)==="editable"?e.push(un(t)):(r==null?void 0:r.markerMode)==="visible"&&e.push(dn("marker",Xt(t)))}function Zo(t,e,r,n=!1){Se.isValidFootnoteMarker(t)||Se.isValidCrossReferenceMarker(t)||((r==null?void 0:r.markerMode)==="editable"?n?e.push(un("","selfClosing")):e.push(un(t,"closing")):(r==null?void 0:r.markerMode)==="visible"&&e.push(dn("marker",cn(n?"":t))))}function iv(t){return!!t&&!!t.book&&typeof t.book=="object"&&t.book!==null&&"style"in t.book&&typeof t.book.style=="string"&&"code"in t.book&&typeof t.book.code=="string"}function _l(t){return!!t&&!!t.para&&typeof t.para=="object"&&t.para!==null&&"style"in t.para&&typeof t.para.style=="string"}function jr(t){return!!t&&!!t.char&&typeof t.char=="object"&&t.char!==null&&(!Array.isArray(t.char)&&"style"in t.char&&typeof t.char.style=="string"||Array.isArray(t.char)&&t.char.length>0&&"style"in t.char[0]&&typeof t.char[0].style=="string")}function ov(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)&&Object.keys(t).length===0}function ot(t,e){if(t)for(const r of Object.keys(t)){if(r==="segment"&&typeof t[r]=="string"){const n=t[r];Wt(e,Ar,()=>n);continue}if(av(r)){const n=!!t[r],s=r,i=e.hasFormat(s);(n&&!i||!n&&i)&&e.toggleFormat(s)}}}const mf=["bold","underline","strikethrough","italic","highlight","code","subscript","superscript","lowercase","uppercase","capitalize"];function av(t){return mf.includes(t)}function lv({viewOptions:t}){const[e]=ue();return cv(e,t),null}function cv(t,e){_.useEffect(()=>{if(!t.hasNodes([Yt,Ye,Pe]))throw new Error("ArrowNavigationPlugin: ImmutableChapterNode, ImmutableVerseNode or NoteNode not registered on editor!");const r=n=>{if(n.key!=="ArrowLeft"&&n.key!=="ArrowRight")return!1;const s=ne();if(!X(s)||!s.isCollapsed())return!1;const i=t.getRootElement();if(!i)return!1;const o=i.dir||"ltr";let a=!1;return uv(o,n.key)?a=hv(s):dv(o,n.key)&&(a=fv(s,e)),a&&n.preventDefault(),a};return t.registerCommand(ps,r,Fi)},[t,e])}function uv(t,e){return t==="ltr"&&e==="ArrowRight"||t==="rtl"&&e==="ArrowLeft"}function dv(t,e){return t==="ltr"&&e==="ArrowLeft"||t==="rtl"&&e==="ArrowRight"}function hv(t){var e,r,n;const s=t.anchor.getNode(),i=u_(t);if(oe(i)&&!vs(i.getFirstChild())){if(mt(s)){if(t.anchor.offset===s.getChildrenSize())return!1}else if(t.anchor.offset!==s.getTextContentSize())return!1;if(i.getIsCollapsed()){if(i.is((e=i.getParent())==null?void 0:e.getLastChild()))return(n=(r=i.getParent())==null?void 0:r.getNextSibling())==null||n.selectStart(),!0}else return Oi(i.getFirstChild())?i.select(2,2):i.select(1,1),!0}if(mt(s)&&oe(i)&&i.getIsCollapsed()){const a=i.getNextSibling();return a?a.selectStart():i.selectEnd(),!0}const o=i==null?void 0:i.getParent();if(Oi(i)&&oe(o)&&i.is(o==null?void 0:o.getLastChild())){const a=o.getNextSibling();return a?a.selectStart():o.selectEnd(),!0}return!1}function fv(t,e){const r=d_(t);if(_s(r)&&!r.getPreviousSibling())return!0;if(t.anchor.offset!==0)return!1;const n=t.anchor.getNode();if(Ot(n.getParent()))return!0;if(oe(r)&&r.getIsCollapsed()){const i=r.getPreviousSibling();if(!kn(i))return!1;const o=r.getParent();if(!o)return!1;const a=r.getIndexWithinParent();return o.select(a,a),!0}if(mt(r)&&(e==null?void 0:e.noteMode)==="collapsed"){const i=r.getLastChild();if(!i)return!1;const o=ts(i,a=>oe(a));if(oe(o)&&o.getIsCollapsed()){const a=o.getParent();if(!a)return!1;const l=o.getIndexWithinParent();return a.select(l,l),!0}}const s=zh(n);if(!s||s.getIsCollapsed())return!1;if(mr(r)){const i=s.getParent();if(!i)return!1;const o=s.getIndexWithinParent();return i.select(o,o),!0}return!1}function pv(){const[t]=ue();return gv(t),null}function gv(t){_.useEffect(()=>{if(!t.hasNodes([Se]))throw new Error("CharNodePlugin: CharNode not registered on editor!");return Xe(t.registerNodeTransform(Se,mv),t.registerNodeTransform(Mt,yv))},[t])}function mv(t){if(!ge(t))return;if(t.isEmpty()){t.remove();return}const e=t.getMarker(),r=gs(t,Mr),n=t.getUnknownAttributes(),s=t.getNextSibling();ge(s)&&Or({style:e,cid:r},s)&&Bt(n,s.getUnknownAttributes())&&(t.append(...s.getChildren()),s.remove());const i=t.getPreviousSibling();ge(i)&&Or({style:e,cid:r},i)&&Bt(n,i.getUnknownAttributes())&&(i.append(...t.getChildren()),t.remove())}function yv(t){const e=t.getParent();if(!ge(e)||e.getChildrenSize()!==1)return;const r=t.getTextContent();r.length>1&&r.startsWith(ae)&&(t.setTextContent(r.slice(1)),t.selectEnd())}function yf(t){return t.replaceAll("	"," ")}const kl=t=>{navigator.clipboard.read().then(async e=>{if((await navigator.permissions.query({name:"clipboard-read"})).state==="denied"){alert("Not allowed to paste from clipboard.");return}const r=new DataTransfer,n=e[0];for(const i of n.types){const o=await(await n.getType(i)).text();r.setData(i,yf(o))}const s=new ClipboardEvent("paste",{clipboardData:r});t.dispatchCommand(qi,s)})},vl=t=>{navigator.clipboard.read().then(async()=>{if((await navigator.permissions.query({name:"clipboard-read"})).state==="denied"){alert("Not allowed to paste from clipboard.");return}const e=new DataTransfer,r=await navigator.clipboard.readText();e.setData("text/plain",yf(r));const n=new ClipboardEvent("paste",{clipboardData:e});t.dispatchCommand(qi,n)})};function bv(){const[t]=ue();return _.useEffect(()=>{const e=r=>{const{key:n,shiftKey:s,metaKey:i,ctrlKey:o,altKey:a}=r;!(sa?i:o)||a||(!s&&n.toLowerCase()==="c"?(r.preventDefault(),t.dispatchCommand(Di,null)):!s&&n.toLowerCase()==="x"?(r.preventDefault(),t.dispatchCommand(Li,null)):n.toLowerCase()==="v"&&(r.preventDefault(),s?vl(t):kl(t)))};return t.registerRootListener((r,n)=>{n!==null&&n.removeEventListener("keydown",e),r!==null&&r.addEventListener("keydown",e)})},[t]),null}function _v({logger:t}){const[e]=ue();return _.useEffect(()=>Xe(e.registerCommand(ps,r=>r.key!=="\\"&&r.key!=="/"?!1:(r.preventDefault(),!0),fi),e.registerCommand(qi,r=>{var n;const s=(n=r.clipboardData)==null?void 0:n.getData("text/plain");return!s||!s.includes("\\")&&!s.includes("/")?!1:(t==null||t.info("CommandMenuPlugin: paste containing backslash or forward slash ignored."),r.preventDefault(),!0)},fi),e.registerCommand(ld,r=>{var n;const s=(n=r.dataTransfer)==null?void 0:n.getData("text/plain");return!s||!s.includes("\\")&&!s.includes("/")?!1:(t==null||t.info("CommandMenuPlugin: drag containing backslash or forward slash ignored."),r.preventDefault(),!0)},fi)),[e,t]),null}function kv({index:t,isSelected:e,onClick:r,onMouseEnter:n,option:s}){let i="item";return e&&(i+=" selected"),s.isDisabled&&(i+=" disabled"),m.jsx("li",{tabIndex:-1,className:i,ref:s.setRefElement,role:"option","aria-selected":e,"aria-disabled":s.isDisabled,id:"typeahead-item-"+t,onMouseEnter:n,onClick:s.isDisabled?void 0:r,children:m.jsx("span",{className:"text",children:s.title})},s.key)}function vv({options:t,selectedItemIndex:e,onOptionClick:r,onOptionMouseEnter:n}){return m.jsx("div",{className:"typeahead-popover",children:m.jsx("ul",{children:t.map((s,i)=>m.jsx(kv,{index:i,isSelected:e===i,onClick:()=>r(s,i),onMouseEnter:()=>n(i),option:s},s.key))})})}class Zs extends Nm{constructor(e,r){super(e),z(this,"title"),z(this,"onSelect"),z(this,"isDisabled"),this.title=e,this.onSelect=r.onSelect.bind(this),this.isDisabled=r.isDisabled||!1}}function wv(t,e="editor-input"){return t?t.classList.contains(e):!1}function xv(){const[t]=ue(),[e,r]=_.useState(()=>!t.isEditable()),n=_.useRef(void 0),s=_.useRef(void 0),i=_.useRef(void 0),o=_.useMemo(()=>[new Zs("Cut",{onSelect:()=>{t.dispatchCommand(Li,null)},isDisabled:e}),new Zs("Copy",{onSelect:()=>{t.dispatchCommand(Di,null)}}),new Zs("Paste",{onSelect:()=>{kl(t)},isDisabled:e}),new Zs("Paste as Plain Text",{onSelect:()=>{vl(t)},isDisabled:e})],[t,e]),a=_.useCallback((l,u,d)=>{t.update(()=>{l==null||l.onSelect(u),d()})},[t]);return _.useEffect(()=>{var l;s.current=((l=t.getRootElement())==null?void 0:l.className)??""},[t]),_.useEffect(()=>{const l=()=>{var u;(u=i.current)==null||u.call(i)};return window.addEventListener("scroll",l,!0),()=>{window.removeEventListener("scroll",l,!0)}},[]),_.useEffect(()=>t.registerEditableListener(l=>{r(!l)}),[t]),m.jsx(Im,{options:o,onSelectOption:a,onWillOpen:l=>{n.current=l.target},menuRenderFn:(l,{selectedIndex:u,options:d,selectOptionAndCleanUp:f,setHighlightedIndex:h},{setMenuRef:p})=>(i.current=()=>f(void 0),l.current&&!wv(n.current,s.current)&&!qh(n.current)?gt.createPortal(m.jsx("div",{className:"typeahead-popover auto-embed-menu",style:{marginLeft:l.current.style.width,userSelect:"none",width:200},ref:p,children:m.jsx(vv,{options:o,selectedItemIndex:u,onOptionClick:(y,b)=>{y.isDisabled||(h(b),f(y))},onOptionMouseEnter:y=>{h(y)}})}),l.current):null)})}function Cv({isEditable:t}){const[e]=ue();return _.useLayoutEffect(()=>{e.setEditable(t)},[e,t]),null}function Sv({scripture:t,nodeOptions:e,editorAdaptor:r,viewOptions:n,logger:s}){const[i]=ue();return _.useEffect(()=>{var o;(o=r.initialize)==null||o.call(r,e,s)},[r,s,e]),_.useEffect(()=>{var o;(o=r.reset)==null||o.call(r);const a=r.serializeEditorState(t,n);if(a==null){s==null||s.warn("LoadStatePlugin: serializedEditorState was null or undefined. Skipping editor update.");return}try{const l=i.parseEditorState(a);queueMicrotask(()=>{i.update(()=>{i.setEditorState(l),i.dispatchCommand(nd,void 0)},{tag:Za})})}catch{s==null||s.error("LoadStatePlugin: error parsing or setting editor state.")}},[i,r,s,t,n]),null}function Ev({expandedNoteKeyRef:t,nodeOptions:e,viewOptions:r,logger:n}){const[s]=ue();return Tv(e,n),Mv(s,t,r,n),null}function Tv(t,e){const r=_.useRef(void 0),n=t.noteCallers;_.useEffect(()=>{let s=n;(!s||s.length<=0)&&(s=wk),r.current!==s&&(r.current=s,$v("note-callers",s,e))},[e,n])}function Mv(t,e,r,n){_.useEffect(()=>{if(!t.hasNodes([Se,Pe,bt]))throw new Error("NoteNodePlugin: CharNode, NoteNode or ImmutableNoteCallerNode not registered on editor!");const s=i=>t.update(()=>Rv(i));return Xe(t.registerNodeTransform(Pe,i=>Av(i,r)),t.registerNodeTransform(Se,Nv),t.registerNodeTransform(Mt,Ov),t.registerNodeTransform(bt,jv),t.registerMutationListener(bt,(i,{prevEditorState:o})=>Iv(i,o)),t.registerCommand(pn,()=>Pv(t,e,r,n),Pr),t.registerRootListener((i,o)=>{o!==null&&o.removeEventListener("dblclick",s),i!==null&&i.addEventListener("dblclick",s)}))},[t,e,n,r])}function Av(t,e){const r=t.getChildren();if(!r.some(n=>mr(n))&&(e==null?void 0:e.markerMode)!=="editable"&&t.getCaller()!==""&&t.remove(),r.length>0){const n=r[0];ee(n)&&!vs(n)&&t.insertBefore(n)}}function Nv(t){const e=t.getParentOrThrow(),r=e.getChildren(),n=r.find(o=>mr(o));if(!ge(t)||!oe(e)||!n)return;const s=cl(r);n.getPreviewText()!==s&&n.setPreviewText(s);const i=t.getNextSibling();ee(i)?i.getTextContent()!==ae&&i.setTextContent(ae):t.insertAfter(Ce(ae))}function Ov(t){const e=zh(t),r=e==null?void 0:e.getChildren(),n=r==null?void 0:r.find(o=>mr(o));if(!ee(t)||!oe(e)||!n||!r)return;const s=t.getParent();if(!vs(t)&&oe(s)&&t.getTextContent()!==ae&&(t.setTextContent(ae),t.selectEnd()),ge(s)&&s.getChildrenSize()===1){const o=t.getTextContent();o.length>1&&o.startsWith(ae)&&(t.setTextContent(o.slice(1)),t.selectEnd())}const i=cl(r);n.getPreviewText()!==i&&n.setPreviewText(i)}function jv(t){if(!mr(t))return;const e=t.getNextSibling();!ee(e)||vs(e)?t.insertAfter(Ce(ae)):e.getTextContent()!==ae&&e.setTextContent(ae)}function Iv(t,e){for(const[r,n]of t){if(n!=="destroyed")continue;const s=e.read(()=>{const o=we(r),a=o==null?void 0:o.getParent();return mr(o)&&oe(a)&&a.getCaller()===jt}),i=document.querySelector(".editor-input");!s||!i||(i.classList.add("reset-counters"),i.offsetHeight,i.classList.remove("reset-counters"))}}function Pv(t,e,r,n){var s;if((r==null?void 0:r.noteMode)!=="expandInline")return!1;const i=ne();if(!X(i)||!i.isCollapsed())return!1;const o=i.anchor,a=o.getNode();if(e.current){const l=ts(a,u=>oe(u));if(l)e.current!==l.getKey()&&(e.current=l.getKey());else{const u=we(e.current);u&&!u.getIsCollapsed()&&(n==null||n.debug("Cursor moved away from NoteNode, collapsing it"),Fn(t,e.current,n)),e.current=void 0}}if(o.offset===0){const l=a.getPreviousSibling();if(oe(l)){n==null||n.debug("Cursor is just after a NoteNode");const u=l.getKey();l.getIsCollapsed()?e.current=u:e.current=void 0,Fn(t,u,n)}}if(o.offset===a.getTextContentSize()){const l=a.getNextSibling();if(oe(l)){n==null||n.debug("Cursor is just before a NoteNode");const u=l.getKey();l.getIsCollapsed()?e.current=u:e.current=void 0,Fn(t,u,n)}else if(!l){const u=ts(a,d=>oe(d));if(u&&u.getIsCollapsed()&&mt(u.getParent())&&u.is((s=u.getParent())==null?void 0:s.getLastChild())){n==null||n.debug("Cursor is at end of note at end of para");const d=u.getKey();e.current=d,Fn(t,d,n)}}}if(mt(a)){const l=a.getChildAtIndex(o.offset),u=l==null?void 0:l.getPreviousSibling();if(kn(u)&&oe(l)){n==null||n.debug("Cursor is between verse and NoteNode");const d=l.getKey();l.getIsCollapsed()?e.current=d:e.current=void 0,Fn(t,d,n)}}return!1}function Fn(t,e,r){const n=we(e);try{n==null||n.toggleIsCollapsed()}catch(s){if(s instanceof Error&&s.message.includes("read only"))r==null||r.warn("Fallback triggered after stabilization - edge case"),setTimeout(()=>{t.update(()=>{n==null||n.toggleIsCollapsed()})},0);else throw s}}function Rv(t){const e=ne();if(!X(e))return;const r=e.anchor,n=e.focus,s=r.getNode(),i=n.getNode();if(oe(s)&&ee(i)){t.preventDefault();const o=pd();o.anchor.set(i.getKey(),0,"text"),o.focus.set(i.getKey(),n.offset,"text"),ud(o)}}function $v(t,e,r){for(const n of document.styleSheets)try{const s=n.cssRules||n.rules;for(const i of s)if(qv(i,t)){const o=e.map(a=>`"${a}"`).join(" ");i.symbols=o;return}}catch{continue}r==null||r.warn(`Editor: counter style "${t}" not found.`)}function qv(t,e){return typeof t=="object"&&t!==null&&"name"in t&&t.name===e&&"symbols"in t&&typeof t.symbols=="string"}function Lv({onChange:t}){const[e]=ue();return _.useEffect(()=>e.registerCommand(pn,()=>{const r=e.read(()=>ef());return t==null||t(r),!1},Pr),[e,t]),null}function Dv(){const[t]=ue();return Fv(t),null}function Fv(t){_.useEffect(()=>{if(!t.hasNodes([tt]))throw new Error("ParaNodePlugin: ParaNode not registered on editor!");return t.registerNodeTransform(tt,e=>Uv(e,t))},[t])}function Uv(t,e){gl(e,t.getKey())&&af(t.getFirstChild()),!(!Je(t)||t.getMarker()!=="b"||t.isEmpty()||!e.getEditorState().read(()=>{const r=we(t.getKey());return Je(r)&&((r==null?void 0:r.isEmpty())??!1)}))&&t.clear()}function bf({onStateChange:t}){const[e]=ue(),[r,n]=_.useState(e),s=_.useRef(!1),i=_.useRef(!1),o=_.useRef(),a=_.useCallback(()=>{const l=ne();if(X(l)){const u=l.anchor.getNode();let d=u.getKey()==="root"?u:ts(u,h=>{const p=h.getParent();return p!==null&&bp(p)});d===null&&(d=u.getTopLevelElementOrThrow());const f=d.getKey();r.getElementByKey(f)!==null&&(Je(d)||Ot(d)||_s(d))&&(o.current=d.getMarker(),t==null||t(s.current,i.current,o.current))}},[r,t]);return _.useEffect(()=>e.registerCommand(pn,(l,u)=>(a(),n(u),!1),Kn),[e,a]),_.useEffect(()=>Xe(r.registerUpdateListener(({editorState:l})=>{l.read(()=>{a()})}),r.registerCommand(Bn,l=>(s.current=l,t==null||t(s.current,i.current,o.current),!1),Kn),r.registerCommand(Un,l=>(i.current=l,t==null||t(s.current,i.current,o.current),!1),Kn)),[a,r,t]),null}function Bv({textDirection:t}){const[e]=ue();return Hv(e,t),Wv(e),null}function Hv(t,e){_.useEffect(()=>{function r(){const n=t.getRootElement();if(!n||e==="auto")return;n.dir=e;const s=t._config.theme.placeholder,i=document.getElementsByClassName(s)[0];i&&(i.dir=e)}return r(),t.registerUpdateListener(({dirtyElements:n})=>{n.size>0&&r()})},[t,e])}function Wv(t){_.useEffect(()=>{const e=r=>{if(r.key!=="ArrowLeft"&&r.key!=="ArrowRight")return!1;const n=ne();if(!X(n))return!1;const s=n.anchor.getNode(),i=ts(s,f=>b_(f,t)==="p");if(!i)return!1;const o=t.getElementByKey(i.getKey());if(!o)return!1;const a=o.parentElement,l=o.dir||"ltr",u=((a==null?void 0:a.dir)??"")||"ltr";if(!a||l===u)return!1;const d=a.dir==="rtl"&&r.key==="ArrowLeft"||a.dir==="ltr"&&r.key==="ArrowRight";return n.modify("move",d,"character"),r.preventDefault(),!0};return t.registerCommand(ps,e,Fi)},[t])}function zv(){const[t]=ue();return Jv(t),null}function Jv(t){_.useEffect(()=>{if(!t.hasNodes([Se,Ye,Pe,Mt,Ge]))throw new Error("TextSpacingPlugin: CharNode, ImmutableVerseNode, NoteNode, TextNode or VerseNode not registered on editor!");return Xe(t.registerNodeTransform(Mt,Kv),t.registerNodeTransform(Mt,e=>Vv(e,t)),t.registerNodeTransform(Ge,Vc),t.registerNodeTransform(Ye,Vc))},[t])}function Kv(t){if(!t.isAttached())return;const e=t.getTextContent(),r=t.getNextSibling(),n=t.getParent();t.getMode()!=="normal"||e.endsWith(" ")&&e.length>1||oe(r)||ge(n)||Fe(n)||bs(n)||(e===" "&&!lt(r)?t.setTextContent(""):pl(t))}function Vv(t,e){const r=t.getParent();!bs(r)||!t.isAttached()||gl(e,t.getKey())&&r.insertAfter(t)}function Vc(t){if(!t.isAttached())return;const e=t.getPreviousSibling();e&&!lt(e)&&!ee(e)&&!bs(e)&&t.insertBefore(Ce(" "))}function Gv({trigger:t,scriptureReference:e,contextMarker:r,getMarkerAction:n}){const{markersMenuItems:s}=Uk({scriptureReference:e,contextMarker:r,getMarkerAction:n});return m.jsx(Fk,{trigger:t,items:s})}function Yv({trigger:t,scrRef:e,getMarkerAction:r}){const{book:n,chapterNum:s,verseNum:i,verse:o}=e,a=_.useMemo(()=>e,[n,s,i,o]),[l]=ue(),[u]=Xv(l);return Qv(l),m.jsx(Gv,{trigger:t,scriptureReference:a,contextMarker:u,getMarkerAction:r})}function Xv(t){const[e,r]=_.useState();return _.useEffect(()=>t.registerCommand(pn,()=>(t.read(()=>{const n=ne();if(!X(n)){e&&r(void 0);return}const s=we(n.anchor.key),i=we(n.focus.key);if(!s||!i){e&&r(void 0);return}const o=f_(s,i);if(!o||!z_(o)){e&&r(void 0);return}const a=o.getMarker();e!==a&&r(a)}),!1),Pr),[e,t]),[e]}function Qv(t){_.useEffect(()=>{if(!t.hasNodes([Ge,Ye]))throw new Error("UsjNodesMenuPlugin: VerseNode or ImmutableVerseNode not registered on editor!");const e={},r={};return Xe(t.registerNodeTransform(Ye,n=>Gc(n,t,e)),t.registerNodeTransform(Ge,n=>Gc(n,t,e)),t.registerMutationListener(Ye,n=>Zc(n,t,e,r)),t.registerMutationListener(Ge,n=>Zc(n,t,e,r)))},[t])}function Gc(t,e,r){vp(Za)||gl(e,t.getKey())&&tw(t,r)}function Yc(t){return RegExp(/(\d+)([a-zA-Z]+)?(-(\d+)([a-zA-Z]+)?)?/).exec(t)}const Xc=2,Zv=3,Qc=4,ew=5;function tw(t,e){var r;const n=ol(t),s=n==null?void 0:n.getNumber();if(!s)return;const i=e[s];if(!i)return;let o=parseInt(t.getNumber()),a=((r=Yc(t.getNumber()))==null?void 0:r[Xc])??"";i.forEach(l=>{const u=we(l);if(!u)return;const d=u.getNumber(),f=parseInt(d),h=Yc(d),p=!!(h!=null&&h[Zv]),y=p?parseInt(h[Qc]):f;if(y<o||f>o||y===o&&a)return;const b=(h==null?void 0:h[Xc])??"",S=(h==null?void 0:h[ew])??"",C=p?xa(parseInt(h[Qc]),void 0):"";let x=`${b}`;x+=p?`-${C}${S}`:"";const A=xa(f,void 0);u.setNumber(`${A}${x}`),o=parseInt(p?C:A),a=p?S:b})}function Zc(t,e,r,n){e.getEditorState().read(()=>{for(const[s,i]of t){const o=we(s);if(lt(o)){if(i==="created"){const a=ol(o);if(!a)continue;const l=a.getNumber();r[l]||(r[l]=[]),r[l].push(s),n[s]=l}else if(i==="destroyed"){const a=n[s],l=r[a];if(!l)continue;const u=l.findIndex(d=>d===s);if(u===-1)continue;l.splice(u,1),Reflect.deleteProperty(n,s)}}}})}const _f="formatted",rw="unformatted";let wl;function nw(t){const e=sw(t);if(!e)throw new Error(`Invalid view mode: ${t}`);wl=e}nw(_f);const vn=()=>wl;function sw(t){let e;switch(t){case _f:e={markerMode:"hidden",noteMode:"collapsed",hasSpacing:!0,isFormattedFont:!0};break;case rw:e={markerMode:"editable",noteMode:"expanded",hasSpacing:!1,isFormattedFont:!1};break}return e}function iw(t){if(t)return t.markerMode==="editable"?Ge:Ye}function ow(t){const e=[],r=t??wl;return r&&(e.push(`${Fb}${r.markerMode}`),r.hasSpacing&&e.push(Lb),r.isFormattedFont&&e.push(Db)),e}let Ea;function aw(t){t&&(Ea=t)}function lw(t){return t.isEmpty()?td:cw(t.toJSON())}function cw(t){if(!t.root||!t.root.children)return;const e=t.root.children;if(e.length===1&&rl(e[0])&&(!e[0].children||e[0].children.length===0))return td;const r=kf(e),n=er(r);return n?{type:Zn,version:es,content:n}:void 0}function uw(t,e){const{type:r,marker:n,unknownAttributes:s}=t;let i;return t.code!==""&&(i=t.code),Ne({type:r,marker:n,code:i,...s,content:e})}function dw(t){const{marker:e,number:r,sid:n,altnumber:s,pubnumber:i,unknownAttributes:o}=t;return Ne({type:kt.getType(),marker:e,number:r,sid:n,altnumber:s,pubnumber:i,...o})}function hw(t,e){const{marker:r,sid:n,altnumber:s,pubnumber:i,unknownAttributes:o}=t,a=e&&typeof e[0]=="string"?e[0]:void 0;let{number:l}=t;return l=Jh(r,a,l),Ne({type:kt.getType(),marker:r,number:l,sid:n,altnumber:s,pubnumber:i,...o})}function fw(t){const{marker:e,sid:r,altnumber:n,pubnumber:s,unknownAttributes:i}=t,{text:o}=t;let{number:a}=t;return a=Jh(e,o,a),Ne({type:Ge.getType(),marker:e,number:a,sid:r,altnumber:n,pubnumber:s,...i})}function pw(t,e){const{type:r,marker:n,unknownAttributes:s}=t,i=n===""?void 0:n;return e==null||e.forEach((o,a)=>{typeof o=="string"&&o.startsWith(ae)&&(e[a]=o.slice(1))}),Ne({type:r,marker:i,...s,content:e})}function gw(t,e){const{type:r,marker:n,unknownAttributes:s}=t;return Ne({type:r,marker:n,...s,content:e})}function mw(t,e){const{type:r,marker:n,caller:s,category:i,unknownAttributes:o}=t;return Ne({type:r,marker:n,caller:s,category:i,...o,content:e})}function Qr(t){const{type:e,marker:r,sid:n,eid:s,unknownAttributes:i}=t;return Ne({type:e,marker:r===""?void 0:r,sid:n,eid:s,...i})}function yw(t){return t.text}function bw(t,e){const{tag:r,marker:n,unknownAttributes:s}=t;return Ne({type:r,marker:n,...s,content:e})}function _w(t){const{marker:e}=t;return{type:ji,marker:e===""?void 0:e}}function eu(t,e){const r=t[t.length-1];r&&typeof r=="string"?t[t.length-1]=r+e:t.push(e)}function kw(t,e,r,n,s){const i=It.getType(),o=e.filter(a=>!r.includes(a));if(r.filter(a=>!e.includes(a)).forEach(a=>{const l=Qr({type:i,marker:en,eid:a});s.push(l)}),o.forEach(a=>{const l=Qr({type:i,marker:Nr,sid:a});s.push(l)}),e.length===0){const a=Qr({type:i,marker:Nr});s.push(a)}if(s.push(...t),e.length===0){const a=Qr({type:i,marker:en});s.push(a)}(!n||!C_(n))&&e.forEach(a=>{const l=Qr({type:i,marker:en,eid:a});s.push(l)})}function er(t,e){const r=[];let n,s=[];return t.forEach((i,o)=>{const a=i,l=i,u=i,d=i,f=i,h=i,p=i,y=i;switch(i.type){case ct.getType():r.push(uw(a,er(a.children)));break;case Yt.getType():r.push(dw(i));break;case kt.getType():r.push(hw(l,er(l.children)));break;case Ye.getType():case Ge.getType():r.push(fw(i));break;case Se.getType():r.push(pw(u,er(u.children)));break;case tt.getType():r.push(gw(d,er(d.children)));break;case Pe.getType():r.push(mw(f,er(f.children,f.caller)));break;case pr.getType():case bt.getType():case gd.getType():case qr.getType():break;case Le.getType():if(n=er(p.children),n){const b=p.typedIDs[ir];if(b)kw(n,b,s,t[o+1],r),s=b;else{const S=n.shift();S&&(typeof S=="string"?eu(r,S):r.push(S)),n.length>0&&r.push(...n)}}break;case It.getType():r.push(Qr(i));break;case Mt.getType():h.text&&h.text!==ae&&!h.text.startsWith(Qa)&&(!e||h.text!==ll(e))&&eu(r,yw(h));break;case $r.getType():r.push(bw(y,er(y.children)));break;case gr.getType():r.push(_w(i));break;default:Ea==null||Ea.error(`Unexpected node type '${i.type}'!`)}}),r&&r.length>0?r:void 0}function kf(t){const e=t.findIndex(r=>rl(r));if(e>=0){const r=t.slice(0,e),n=t[e].children,s=kf(t.slice(e+1));t=[...r,...n,...s]}return t}const ea={initialize:aw,deserializeEditorState:lw},tu=vf([]),vw={type:gd.getType(),version:1};let Ri=[],Q,vi,Ta,ke;function ww(t,e){Ri=[],Sw(t),Ew(e)}function xw(t=0){}function Cw(t,e){Q=e??vn();let r;return t?(t.type!==Zn&&(ke==null||ke.warn(`This USJ type '${t.type}' didn't match the expected type '${Zn}'.`)),t.version!==es&&(ke==null||ke.warn(`This USJ version '${t.version}' didn't match the expected version '${es}'.`)),t.content.length>0?r=Aa(Jn(t.content)):r=[tu]):r=[tu],Ta==null||Ta(Ri),{root:{children:r,direction:null,format:"",indent:0,type:"root",version:1}}}function Sw(t){t&&(vi=t),t!=null&&t.addMissingComments&&(Ta=t.addMissingComments)}function Ew(t){t&&(ke=t)}function Tw(t){return!t||t.length!==1||typeof t[0]!="string"?"":t[0]}function Mw(t){let{marker:e}=t;e!==ls&&(ke==null||ke.warn(`Unexpected book marker '${e}'!`)),e=e??ls;const{code:r}=t;(!r||!ct.isValidBookCode(r))&&(ke==null||ke.warn(`Unexpected book code '${r}'!`));const n=[];((Q==null?void 0:Q.markerMode)==="editable"||(Q==null?void 0:Q.markerMode)==="visible")&&n.push(Ir("marker",Xt(e)+" "+r+ae));const s=Tw(t.content);s&&n.push(lr(s));const i=Re(t);return Ne({type:ct.getType(),marker:e,code:r??"",unknownAttributes:i,children:n,direction:null,format:"",indent:0,version:Th})}function Aw(t){let{marker:e}=t;e!==Ai&&(ke==null||ke.warn(`Unexpected chapter marker '${e}'!`)),e=e??Ai;const{number:r,sid:n,altnumber:s,pubnumber:i}=t,o=Re(t);let a;return(Q==null?void 0:Q.markerMode)==="visible"&&(a=!0),(Q==null?void 0:Q.markerMode)==="editable"?Ne({type:kt.getType(),marker:e,number:r??"",sid:n,altnumber:s,pubnumber:i,unknownAttributes:o,children:[lr(ks(e,r)??"")],direction:null,format:"",indent:0,version:Nh}):Ne({type:Yt.getType(),marker:e,number:r??"",showMarker:a,sid:n,altnumber:s,pubnumber:i,unknownAttributes:o,version:Rh})}function Nw(t){let{marker:e}=t;e!==Ni&&(ke==null||ke.warn(`Unexpected verse marker '${e}'!`)),e=e??Ni;const{number:r,sid:n,altnumber:s,pubnumber:i}=t,o=(iw(Q)??Ye).getType(),a=(Q==null?void 0:Q.markerMode)==="editable"?Hh:rf;let l,u;(Q==null?void 0:Q.markerMode)==="editable"?l=ks(e,r):(Q==null?void 0:Q.markerMode)==="visible"&&(u=!0);const d=Re(t);return Ne({type:o,text:l,marker:e,number:r??"",sid:n,altnumber:s,pubnumber:i,showMarker:u,unknownAttributes:d,version:a})}function Ow(t,e=[]){let{marker:r}=t;Se.isValidMarker(r)||ke==null||ke.warn(`Unexpected char marker '${r}'!`),r=r??"",(Q==null?void 0:Q.markerMode)==="editable"&&e.forEach(s=>{al(s)&&(s.text=ae+s.text)}),e.length===0&&e.push(lr(ae));const n=Re(t);return Ne({type:Se.getType(),marker:r,unknownAttributes:n,children:[...e],direction:null,format:"",indent:0,textFormat:0,textStyle:"",version:Ph})}function vf(t){return{type:ar.getType(),children:t,direction:null,format:"",indent:0,textFormat:0,textStyle:"",version:Lh}}function jw(t,e=[]){let{marker:r}=t;tt.isValidMarker(r)||ke==null||ke.warn(`Unexpected para marker '${r}'!`),r=r??Ji;const n=[];(Q==null?void 0:Q.markerMode)==="editable"?n.push(hn(r),lr(ae)):(Q==null?void 0:Q.markerMode)==="visible"&&n.push(Ir("marker",Xt(r)+ae)),n.push(...e);const s=Re(t);return Ne({type:tt.getType(),marker:r,unknownAttributes:s,children:n,direction:null,format:"",indent:0,textFormat:0,textStyle:"",version:Bh})}function Iw(t,e){const r=y_(e);let n=()=>{};return vi!=null&&vi.noteCallerOnClick&&(n=vi.noteCallerOnClick),Ne({type:bt.getType(),caller:t,previewText:r,onClick:n,version:df})}function Pw(t,e){let{marker:r}=t;Pe.isValidMarker(r)||ke==null||ke.warn(`Unexpected note marker '${r}'!`),r=r??nl;const{category:n}=t,s=t.caller??"*",i=(Q==null?void 0:Q.noteMode)!=="expanded",o=Re(t);let a,l;(Q==null?void 0:Q.markerMode)==="editable"?(a=hn(r),l=hn(r,"closing")):(Q==null?void 0:Q.markerMode)==="visible"&&(a=Ir("marker",Xt(r)+ae),l=Ir("marker",cn(r)+ae));const u=[];let d;if(a&&u.push(a),(Q==null?void 0:Q.markerMode)==="editable")d=lr(ll(s)),u.push(d,...e);else{const f=lr(ae);d=Iw(s,e),u.push(d,f,...e.flatMap(Rw(f)))}return l&&u.push(l),Ne({type:Pe.getType(),marker:r,caller:s,isCollapsed:i,category:n,unknownAttributes:o,children:u,direction:null,format:"",indent:0,version:Uh})}function Rw(t){return e=>M_(e)?[e]:[e,t]}function $w(t){let{marker:e}=t;(!e||!It.isValidMarker(e))&&(ke==null||ke.warn(`Unexpected milestone marker '${e}'!`)),e=e??"";const{sid:r,eid:n}=t,s=Re(t);return Ne({type:It.getType(),marker:e,sid:r,eid:n,unknownAttributes:s,version:Dh})}function ru(t,e=[]){return{type:Le.getType(),typedIDs:{[ir]:e},children:t,direction:null,format:"",indent:0,version:1}}function qw(t,e){const{marker:r}=t,n=t.type,s=Re(t),i=[...e];return i.forEach(o=>{al(o)&&(o.mode="token")}),Ne({type:$r.getType(),tag:n,marker:r,unknownAttributes:s,children:i,direction:null,format:"",indent:0,version:Sh})}function Lw(t){return{type:gr.getType(),marker:t,version:Qh}}function hn(t,e="opening"){return{type:qr.getType(),marker:t,markerSyntax:e,text:"",detail:0,format:0,mode:"normal",style:"",version:1}}function lr(t,e="normal"){return{type:Mt.getType(),text:t,detail:0,format:0,mode:e,style:"",version:1}}function Ir(t,e){return{type:pr.getType(),text:e,textType:t,version:Xh}}function nu(t,e){(Q==null?void 0:Q.markerMode)==="editable"?e.push(hn(t)):(Q==null?void 0:Q.markerMode)==="visible"&&e.push(Ir("marker",Xt(t)))}function su(t,e,r=!1){Se.isValidFootnoteMarker(t)||Se.isValidCrossReferenceMarker(t)||((Q==null?void 0:Q.markerMode)==="editable"?r?e.push(hn("","selfClosing")):e.push(hn(t,"closing")):(Q==null?void 0:Q.markerMode)==="visible"&&e.push(Ir("marker",cn(r?"":t))))}function Dw(t,e){if(t.type!=="ms")return;const r=[];if(t.sid&&r.push(`sid="${t.sid}"`),t.eid&&r.push(`eid="${t.eid}"`),r.length<=0)return;const n=Qa+r.join(" ");(Q==null?void 0:Q.markerMode)==="editable"?e.push(lr(n)):(Q==null?void 0:Q.markerMode)==="visible"&&e.push(Ir("attribute",n))}function iu(t,e){return t.length<=0||e===0?t:t.map(r=>r-e)}function Fw(t,e){const r=t.indexOf(e,0);r>-1&&t.splice(r,1)}function ou(t,e){e.marker===Nr&&e.sid!==void 0&&t.push(e.sid),e.marker===en&&e.eid!==void 0&&Fw(t,e.eid)}function Ma(t,e,r=!1,n=[]){if(e.length<=0||e[0]>=t.length)return t;const s=e.shift(),i=e.length>0?e.shift():t.length-1;if(s===void 0||i===void 0||i>=t.length||t.length<=0)return t;const o=t.slice(0,s),a=r?[ru(o,[...n])]:o,l=t[s];ou(n,l);const u=Ma(t.slice(s+1,i),iu(e,s+1),l.marker===Nr,n),d=ru(u,[...n]),f=t[i];ou(n,f);const h=Ma(t.slice(i+1),iu(e,i+1),f.marker===Nr,n);return[...a,d,...h]}function Jn(t){const e=[],r=[];return t==null||t.forEach(n=>{if(typeof n=="string")n&&r.push(lr(n));else if(!n.type)ke==null||ke.error("Marker type is missing!");else switch(n.type){case ct.getType():r.push(Mw(n));break;case kt.getType():r.push(Aw(n));break;case Ge.getType():Q!=null&&Q.hasSpacing||r.push(vw),r.push(Nw(n));break;case Se.getType():nu(n.marker??"",r),r.push(Ow(n,Jn(n.content))),su(n.marker??"",r);break;case tt.getType():r.push(jw(n,Jn(n.content)));break;case Pe.getType():r.push(Pw(n,Jn(n.content)));break;case It.getType():Qb(n.marker??"")&&(e.push(r.length),n.sid!==void 0&&(Ri==null||Ri.push(n.sid))),r.push($w(n)),nu(n.marker??"",r),Dw(n,r),su(n.marker??"",r,!0);break;case gr.getType():r.push(Lw(n.marker??""));break;default:ke==null||ke.warn(`Unknown type-marker '${n.type}-${n.marker}'!`),r.push(qw(n,Jn(n.content)))}}),Ma(r,e)}function Aa(t){const e=t.findIndex(r=>qb(r)||o_(r)||s_(r));if(e>=0){const r=Aa(t.slice(0,e)),n=t[e],s=Aa(t.slice(e+1));return[...r,n,...s]}else if(t.some(r=>"text"in r&&"mode"in r||q_(r)))return[vf(t)];return t}const Na={initialize:ww,reset:xw,serializeEditorState:Cw},ei=t=>{if(!Pe.isValidMarker(t)||!t.includes("f"))throw new Error(`Invalid footnote marker '${t}'`);return{action:e=>{const{chapterNum:r,verseNum:n}=e.reference,s=[];return r!==void 0&&n!==void 0&&s.push({type:"char",marker:"fr",content:[`${r}:${n}`]}),e.noteText&&s.push({type:"char",marker:"fq",content:[e.noteText]}),s.push({type:"char",marker:"ft"}),[{type:"note",marker:t,caller:jt,content:s}]}}},au=t=>{if(!Pe.isValidMarker(t)||!t.includes("x"))throw new Error(`Invalid cross-reference marker '${t}'`);return{action:e=>{const{chapterNum:r,verseNum:n}=e.reference,s=[];return r!==void 0&&n!==void 0&&s.push({type:"char",marker:"xo",content:[`${r}:${n}`]}),s.push({type:"char",marker:"xt"}),[{type:"note",marker:t,caller:ln,content:s}]}}},Uw={c:{action:t=>{const{chapterNum:e}=t.reference;return[{type:"chapter",marker:"c",number:`${e+1}`}]}},v:{action:t=>{const{verseNum:e,verse:r}=t.reference;return[{type:"verse",marker:"v",number:`${xa(e,r)}`}]}},f:ei("f"),fe:ei("fe"),ef:ei("ef"),efe:ei("efe"),x:au("x"),ex:au("ex")};function Bw(t,e,r,n,s){const i=Hw(t);return{action:o=>{o.editor.update(()=>{var a;const l=ne();X(l)&&(o.noteText=l.getTextContent());const u=(a=i==null?void 0:i.action)==null?void 0:a.call(i,o);if(!u)return;const d=Rc(u,Na,n),f=Go(d);if(X(l)){const h=l.anchor.getNode();if(oe(f))nf(f,l,n),f.getIsCollapsed()||(e.current=f.getKey());else if(l.getTextContent().length>0)Ww(l,()=>Go(d));else if(ve(f)&&!f.isInline()){const p=l.insertParagraph();if(p){const y=p.getChildren();f.append(...y),p.replace(f),f.selectStart()}}else if(ee(h)&&!vs(h)&&oe(h.getParent())&&l.isCollapsed()){let p=h.insertAfter(f);if(Oi(f)){const y={...n||vn(),markerMode:"hidden"},b=Rc(u,Na,y),S=Go(b);p=p.insertAfter(S)}p.insertAfter(Ce(ae))}else{l.insertNodes([f]),Gw(f);const p=f.getNextSibling();p?p.selectStart():f.selectStart()}}else l==null||l.insertNodes([f])},s)},label:i==null?void 0:i.label}}function Hw(t){let e=Uw[t];return e||(tt.isValidMarker(t)?e={action:()=>[{type:tt.getType(),marker:t,content:[]}]}:Se.isValidMarker(t)&&(e={action:()=>[{type:Se.getType(),marker:t}]})),e}function Ww(t,e){const r=t.getNodes(),[n,s]=zw(t);let i;r.forEach((o,a)=>{if(ve(i)&&i.isParentOf(o))return;const l=Jw(o,a===0,a===r.length-1,n,s);if(!l){i=void 0;return}i||(i=e(),l.insertBefore(i)),Vw(l,i)}),(ee(i)||ve(i))&&i.selectEnd()}function zw(t){const e=t.anchor.offset,r=t.focus.offset;return t.isBackward()?[r,e]:[e,r]}function Jw(t,e,r,n,s){if(!(Fe(t)||oe(t)||oe(t.getParent()))){if(ee(t))return Kw(t,e,r,n,s);if(ve(t)&&t.isInline())return t}}function Kw(t,e,r,n,s){const i=t.getTextContentSize(),o=e?n:0,a=r?s:i;if(o===0&&a===0)return;const l=t.splitText(o,a);return l.length===1?l[0]:l.length===3||a===i?l[1]:l[0]}function Vw(t,e){var r;if(ee(e)){const n=lu(t,e);e.setTextContent(n),t.remove()}else if(ve(e)){const n=e.getChildrenSize();e.append(t);for(let s=0;s<n;s++)(r=e.getFirstChild())==null||r.remove();lu(t,e)}}function lu(t,e){let r=t.getTextContent();if(ee(t)&&e.isInline()&&r.startsWith(" ")){r=r.trimStart(),t.setTextContent(r);const n=e.getPreviousSibling();pl(n),ee(n)||e.insertBefore(Ce(" "))}return r}function Gw(t){lt(t)&&(pl(t.getPreviousSibling()),af(t.getNextSibling()))}const wf={chapter:"chapter",verse:"verse",char:"char",para:"para",typedMark:"editor-typed-mark",typedMarkOverlap:"editor-typed-markOverlap",mark:"editor-mark",markOverlap:"editor-markOverlap",placeholder:"editor-placeholder",paragraph:"editor-paragraph",quote:"editor-quote",heading:{h1:"editor-heading-h1",h2:"editor-heading-h2",h3:"editor-heading-h3",h4:"editor-heading-h4",h5:"editor-heading-h5"},list:{nested:{listitem:"editor-nested-listitem"},ol:"editor-list-ol",ul:"editor-list-ul",listitem:"editor-listitem"},image:"editor-image",link:"editor-link",text:{bold:"editor-text-bold",italic:"editor-text-italic",overflowed:"editor-text-overflowed",hashtag:"editor-text-hashtag",underline:"editor-text-underline",strikethrough:"editor-text-strikethrough",underlineStrikethrough:"editor-text-underlineStrikethrough"}};function Yw({options:t,editedUsjRef:e,usj:r,setUsj:n}){const{view:s,nodes:i}=t||{},{hasSpacing:o,isFormattedFont:a,markerMode:l}=s||{};return _.useEffect(()=>{e.current&&!Bt(e.current,r)&&n(e.current)},[e,o,a,l,i,n,r]),null}function Xw({scrRef:t,onScrRefChange:e}){const[r]=ue(),n=_.useRef(!1),s=_.useRef(!1),{book:i,chapterNum:o,verseNum:a}=t;return _.useEffect(()=>r.registerMutationListener(ct,l=>{r.update(()=>{for(const[u,d]of l){const f=we(u);f&&Ot(f)&&d==="created"&&cu(o,a,s)}},{tag:ka})},{skipInitialization:!0}),[r,o,a]),_.useEffect(()=>{n.current?n.current=!1:r.update(()=>cu(o,a,s),{tag:ka})},[r,o,a]),_.useEffect(()=>r.registerCommand(pn,()=>(s.current?s.current=!1:Qw(i,o,a,e,n),!1),Pr),[r,i,o,a,e]),null}function cu(t,e,r){var n;const s=Vh(ne()),i=(n=of(s))==null?void 0:n.getNumber();if(__(i)&&ul(e,i))return;const o=Pt().getChildren(),a=a_(o,t),l=m_(o,a),u=l_(l,!!a);if(u&&!a||!a)return;g_(l,u);const d=W_(l,e);if(d){if(Je(d)){const f=d.getFirstChild();ee(f)?f.select(0,0):d.select(0,0)}else d.selectNext(0,0);r.current=!0}}function Qw(t,e,r,n,s){const i=Vh(ne());if(!i)return;const o=ol(i),a=parseInt((o==null?void 0:o.getNumber())??"1",10),l=of(i),u=l==null?void 0:l.getNumber(),d=parseInt(u??"0",10),f=u?ul(r,u):r===d;if(s.current=!!(o&&a!==e||!f),s.current){const h={book:t,chapterNum:a,verseNum:d};u!=null&&d.toString()!==u&&(h.verse=u),n(h)}}function Zw(t){return Ot(t)?`${t.__code}`:el(t)?`${t.__marker} "${t.__number}"`:ge(t)?`${t.__marker}`:_s(t)?`${t.__marker} "${t.__number}"`:mr(t)?`${t.__caller}`:kn(t)?`${t.__marker} "${t.__number}"`:oe(t)?`${t.__marker} "${t.__caller}"`+(t.__isCollapsed?" (collapsed)":" (expanded)"):Je(t)?`${t.__marker}`:Fe(t)?`ids: [ ${JSON.stringify(t.getTypedIDs())} ]`:il(t)?`${t.__marker} "${t.__number}"`:""}function ex(){const[t]=ue();return m.jsx(vm,{viewClassName:"tree-view-output",treeTypeButtonClassName:"debug-treetype-button",timeTravelPanelClassName:"debug-timetravel-panel",timeTravelButtonClassName:"debug-timetravel-button",timeTravelPanelSliderClassName:"debug-timetravel-panel-slider",timeTravelPanelButtonClassName:"debug-timetravel-panel-button",customPrintNode:Zw,editor:t})}const xf=_.createContext(null),uu=4;function tx({children:t,className:e,onClick:r,title:n}){const s=_.useRef(null),i=_.useContext(xf);if(i===null)throw new Error("DropDownItem must be used within a DropDown");const{registerItem:o}=i;return _.useEffect(()=>{s&&s.current&&o(s)},[s,o]),m.jsx("button",{className:e,onClick:r,ref:s,title:n,type:"button",children:t})}function rx({children:t,dropDownRef:e,onClose:r}){const[n,s]=_.useState(),[i,o]=_.useState(),a=_.useCallback(d=>{s(f=>f?[...f,d]:[d])},[s]),l=d=>{if(!n)return;const f=d.key;["Escape","ArrowUp","ArrowDown","Tab"].includes(f)&&d.preventDefault(),f==="Escape"||f==="Tab"?r():f==="ArrowUp"?o(h=>{if(!h)return n[0];const p=n.indexOf(h)-1;return n[p===-1?n.length-1:p]}):f==="ArrowDown"&&o(h=>h?n[n.indexOf(h)+1]:n[0])},u=_.useMemo(()=>({registerItem:a}),[a]);return _.useEffect(()=>{n&&!i&&o(n[0]),i&&i.current&&i.current.focus()},[n,i]),m.jsx(xf.Provider,{value:u,children:m.jsx("div",{className:"dropdown",ref:e,onKeyDown:l,children:t})})}function nx({disabled:t=!1,buttonLabel:e,buttonAriaLabel:r,buttonClassName:n,buttonIconClassName:s,children:i,stopCloseOnClickSelf:o}){const a=_.useRef(null),l=_.useRef(null),[u,d]=_.useState(!1),f=()=>{d(!1),l&&l.current&&l.current.focus()};return _.useEffect(()=>{const h=l.current,p=a.current;if(u&&h!==null&&p!==null){const{top:y,left:b}=h.getBoundingClientRect();p.style.top=`${y+h.offsetHeight+uu}px`,p.style.left=`${Math.min(b,window.innerWidth-p.offsetWidth-20)}px`}},[a,l,u]),_.useEffect(()=>{const h=l.current;if(h!==null&&u){const p=y=>{const b=y.target;o&&a.current&&a.current.contains(b)||h.contains(b)||d(!1)};return document.addEventListener("click",p),()=>{document.removeEventListener("click",p)}}return()=>{}},[a,l,u,o]),_.useEffect(()=>{const h=()=>{if(u){const p=l.current,y=a.current;if(p!==null&&y!==null){const{top:b}=p.getBoundingClientRect(),S=b+p.offsetHeight+uu;S!==y.getBoundingClientRect().top&&(y.style.top=`${S}px`)}}};return document.addEventListener("scroll",h),()=>{document.removeEventListener("scroll",h)}},[l,a,u]),m.jsxs(m.Fragment,{children:[m.jsxs("button",{type:"button",disabled:t,"aria-label":r||e,className:n,onClick:()=>d(!u),ref:l,children:[s&&m.jsx("span",{className:s}),e&&m.jsx("span",{className:"text dropdown-button-text",children:e}),m.jsx("i",{className:"chevron-down"})]}),u&&gt.createPortal(m.jsx(rx,{dropDownRef:a,onClose:f,children:i}),document.body)]})}const Oa={m:"m - Paragraph - Margin - No First Line Indent",ms:"ms - Heading - Major Section Level 1",nb:"nb - Paragraph - No Break with Previous Paragraph",p:"p - Paragraph - Normal - First Line Indent",pi:"pi - Paragraph - Indented - Level 1 - First Line Indent",q1:"q1 - Poetry - Indent Level 1",q2:"q2 - Poetry - Indent Level 2",r:"r - Heading - Parallel References",s:"s - Heading - Section Level 1"},ja={...Oa,ide:"ide - File - Encoding",h:"h - File - Header",h1:"h1 - File - Header",h2:"h2 - File - Left Header",h3:"h3 - File - Right Header",toc1:"toc1 - File - Long Table of Contents Text",toc2:"toc2 - File - Short Table of Contents Text",toc3:"toc3 - File - Book Abbreviation",cl:"cl - Chapter - Publishing Label",mt:"mt - Title - Major Title Level 1",mt1:"mt1 - Title - Major Title Level 1",mt2:"mt2 - Title - Major Title Level 2",mt3:"mt3 - Title - Major Title Level 3",mt4:"mt4 - Title - Major Title Level 4",ms1:"ms1 - Heading - Major Section Level 1",ms2:"ms2 - Heading - Major Section Level 2",ms3:"ms3 - Heading - Major Section Level 3",b:"b - Poetry - Stanza Break (Blank Line)"};function sx({editorRef:t,blockMarker:e,disabled:r=!1}){return m.jsx(nx,{disabled:r,buttonClassName:"toolbar-item block-controls",buttonIconClassName:"icon block-marker "+ix(e),buttonLabel:ox(e),buttonAriaLabel:"Formatting options for block type",children:Object.keys(Oa).map(n=>m.jsxs(tx,{className:"item block-marker "+ax(e===n),onClick:()=>{var s;return(s=t.current)==null?void 0:s.formatPara(n)},children:[m.jsx("i",{className:"icon block-marker "+n}),m.jsx("span",{className:"text usfm_"+n,children:Oa[n]})]},n))})}function ix(t){return t&&t in ja?t:"ban"}function ox(t){return t&&t in ja?ja[t]:"No Style"}function ax(t){return t?"active dropdown-item-active":""}function du(){return m.jsx("div",{className:"divider"})}const lx=_.forwardRef(function({editorRef:t,isReadonly:e=!1,onStateChange:r},n){const[s]=ue(),[i,o]=_.useState(s),[a,l]=_.useState(),[u,d]=_.useState(!1),[f,h]=_.useState(!1),p=_.useCallback((y,b,S)=>{d(y),h(b),l(S),r==null||r(y,b,S)},[r]);return _.useEffect(()=>s.registerCommand(pn,(y,b)=>(o(b),!1),Kn),[s]),m.jsxs(m.Fragment,{children:[m.jsx(bf,{onStateChange:p}),m.jsxs("div",{className:"toolbar",children:[m.jsx("button",{disabled:!u||e,onClick:()=>{i.dispatchCommand($a,void 0)},title:sa?"Undo (Z)":"Undo (Ctrl+Z)",type:"button",className:"toolbar-item spaced","aria-label":"Undo",children:m.jsx("i",{className:"format undo"})}),m.jsx("button",{disabled:!f||e,onClick:()=>{i.dispatchCommand(Ra,void 0)},title:sa?"Redo (Y)":"Redo (Ctrl+Y)",type:"button",className:"toolbar-item","aria-label":"Redo",children:m.jsx("i",{className:"format redo"})}),m.jsx(du,{}),i===s&&m.jsxs(m.Fragment,{children:[m.jsx(sx,{editorRef:t,blockMarker:a,disabled:e}),m.jsx(du,{})]}),m.jsx("div",{ref:n,className:"end-container"})]})]})}),hu={namespace:"platformEditor",theme:wf,editable:!0,editorState:void 0,onError(t){throw t},nodes:[Le,...xk]},cx=vn(),ux={},dx={};function hx(){return m.jsx("div",{className:"editor-placeholder",children:"Enter some Scripture..."})}const Cf=_.forwardRef(function({defaultUsj:t,scrRef:e,onScrRefChange:r,onSelectionChange:n,onUsjChange:s,onStateChange:i,options:o,logger:a,children:l},u){const d=_.useRef(null),f=_.useRef(null),h=_.useRef(null),p=_.useRef(t),y=_.useRef(),[b,S]=_.useState(t),[C,x]=_.useState(0),{isReadonly:A=!1,hasExternalUI:O=!1,hasSpellCheck:$=!1,textDirection:L="ltr",markerMenuTrigger:H="\\",view:q=cx,nodes:F=ux,debug:W=!1}=o??dx;hu.editable=!A,ea.initialize(a),_.useImperativeHandle(u,()=>({focus(){var M;(M=d.current)==null||M.focus()},undo(){var M;(M=d.current)==null||M.dispatchCommand($a,void 0)},redo(){var M;(M=d.current)==null||M.dispatchCommand(Ra,void 0)},cut(){var M;(M=d.current)==null||M.dispatchCommand(Li,null)},copy(){var M;(M=d.current)==null||M.dispatchCommand(Di,null)},paste(){d.current&&kl(d.current)},pastePlainText(){d.current&&vl(d.current)},getUsj(){return p.current},setUsj(M){if(!Bt(p.current,M)){p.current=M;const v=Bt(b,M);S(M),v&&x(N=>N+1)}},applyUpdate(M,v="remote"){var N,P;(N=d.current)==null||N.update(()=>{v==="remote"&&mp(wa),Jk(M,q,F,a)},{discrete:!0});const j=(P=d.current)==null?void 0:P.getEditorState();if(!j)return;const R=ea.deserializeEditorState(j);if(R){const D=!Bt(p.current,R);if(D&&(p.current=R),D||!Bt(b,R)){const U=Uc(M,j);s==null||s(R,M,v,U)}}},replaceEmbedUpdate(M,v){var N;const P=(N=d.current)==null?void 0:N.read(()=>Z_(M,v));P&&this.applyUpdate(P)},getSelection(){var M;return(M=d.current)==null?void 0:M.read(ef)},setSelection(M){var v;(v=d.current)==null||v.update(()=>{const N=hl(M);N!==void 0&&ud(N)},{tag:Ah})},addAnnotation(M,v,N){var P;(P=f.current)==null||P.addAnnotation(M,Ic(v),N)},removeAnnotation(M,v){var N;(N=f.current)==null||N.removeAnnotation(Ic(M),v)},formatPara(M){var v;(v=d.current)==null||v.update(()=>{const N=ne();X(N)&&gp(N,()=>cs(M))})},getElementByKey(M){var v;return(v=d.current)==null?void 0:v.read(()=>{var N;return((N=d.current)==null?void 0:N.getElementByKey(M))??void 0})},insertNote(M,v,N){var P;(P=d.current)==null||P.update(()=>{const j=L_(M,v,N,e,q,F,a);j&&!j.getIsCollapsed()&&(y.current=j.getKey())})},selectNote(M){var v;(v=d.current)==null||v.update(()=>{const N=Dc(M);N&&(F_(N,q),N.getIsCollapsed()||(y.current=N.getKey()))})},getNoteOps(M){var v;return(v=d.current)==null?void 0:v.read(()=>{const N=Dc(M);if(N)return ml(N)})},get toolbarEndRef(){return h}}));const k=_.useCallback((M,v,N,P)=>{if(Ub.some(R=>N.has(R)))return;const j=ea.deserializeEditorState(M);if(j){const R=!Bt(p.current,j);if(R&&(p.current=j),R||!Bt(b,j)){const D=N.has(wa)?"remote":"local",U=Uc(P,M);s==null||s(j,P,D,U)}}},[b,s]);return m.jsxs(dd,{initialConfig:hu,children:[m.jsx(Cv,{isEditable:!A}),m.jsxs("div",{className:"editor-container",children:[O?m.jsx(bf,{onStateChange:i}):m.jsx("div",{className:"editor-toolbar-container"+(A?"-readonly":"-editable"),children:m.jsx(lx,{ref:h,editorRef:u,isReadonly:A,onStateChange:i})}),m.jsxs("div",{className:"editor-inner",children:[m.jsx(Pd,{editorRef:d}),m.jsx(yp,{contentEditable:m.jsx(fd,{className:`editor-input usfm ${ow(q).join(" ")}`,spellCheck:$}),placeholder:m.jsx(hx,{}),ErrorBoundary:hd}),m.jsx(Rd,{}),e&&r&&m.jsx(Xw,{scrRef:e,onScrRefChange:r}),e&&m.jsx(Yv,{trigger:H,scrRef:e,getMarkerAction:(M,v)=>Bw(M,y,v,q)}),m.jsx(Yw,{options:{view:q,nodes:F},editedUsjRef:p,usj:b,setUsj:S}),m.jsx(Sv,{scripture:b,nodeOptions:F,editorAdaptor:Na,viewOptions:q,logger:a},C),m.jsx(Lv,{onChange:n}),m.jsx(Wk,{onChange:k,ignoreSelectionChange:!0,ignoreHistoryMergeTagChange:!0}),m.jsx(Hk,{ref:f,logger:a}),m.jsx(lv,{viewOptions:q}),m.jsx(pv,{}),m.jsx(bv,{}),m.jsx(_v,{logger:a}),m.jsx(xv,{}),m.jsx(Ev,{expandedNoteKeyRef:y,nodeOptions:F,viewOptions:q,logger:a}),m.jsx(Dv,{}),m.jsx(Bv,{textDirection:L}),m.jsx(zv,{}),l]}),W&&m.jsx(ex,{})]})]})}),wn=_.forwardRef(function(t,e){const{children:r,...n}=t;return m.jsx(Cf,{ref:e,...n})});function Sf(){return Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5)}function $i(t,e,r,n,s){return{author:e,content:t,deleted:s===void 0?!1:s,id:r===void 0?Sf():r,timeStamp:n===void 0?performance.timeOrigin+performance.now():n,type:"comment"}}function Ef(t,e,r){return{comments:e,id:r===void 0?Sf():r,quote:t,type:"thread"}}function fu(t){return{comments:Array.from(t.comments),id:t.id,quote:t.quote,type:"thread"}}function fx(t){return{author:t.author,content:"[Deleted Comment]",deleted:!0,id:t.id,timeStamp:t.timeStamp,type:"comment"}}function ta(t){const e=t._changeListeners;for(const r of e)r()}class px{constructor(e,r){z(this,"_editor"),z(this,"_comments"),z(this,"_changeListeners"),z(this,"_collabProvider"),z(this,"logger"),this._comments=[],this._editor=e,this.logger=r,this._collabProvider=null,this._changeListeners=new Set}isCollaborative(){return this._collabProvider!==null}getComments(){return this._comments}setComments(e){this._comments=e,ta(this)}addComment(e,r,n){const s=Array.from(this._comments),i=this._getCollabComments();if(r!==void 0&&e.type==="comment")for(let o=0;o<s.length;o++){const a=s[o];if(a.type==="thread"&&a.id===r.id){const l=fu(a);s.splice(o,1,l);const u=n!==void 0?n:l.comments.length;if(this.isCollaborative()&&i!==null){const d=i.get(o).get("comments");this._withRemoteTransaction(()=>{const f=this._createCollabSharedMap(e);d.insert(u,[f])})}l.comments.splice(u,0,e);break}}else{const o=n!==void 0?n:s.length;this.isCollaborative()&&i!==null&&this._withRemoteTransaction(()=>{const a=this._createCollabSharedMap(e);i.insert(o,[a])}),s.splice(o,0,e)}this._comments=s,ta(this)}deleteCommentOrThread(e,r){const n=Array.from(this._comments),s=this._getCollabComments();let i=null;if(r!==void 0)for(let o=0;o<n.length;o++){const a=n[o];if(a.type==="thread"&&a.id===r.id){const l=fu(a);n.splice(o,1,l);const u=l.comments;if(i=u.indexOf(e),this.isCollaborative()&&s!==null){const d=s.get(o).get("comments"),f=i;this._withRemoteTransaction(()=>{d.delete(f)})}u.splice(i,1);break}}else i=n.indexOf(e),this.isCollaborative()&&s!==null&&this._withRemoteTransaction(()=>{s.delete(i)}),n.splice(i,1);return this._comments=n,ta(this),e.type==="comment"?{index:i,markedComment:fx(e)}:null}registerOnChange(e){const r=this._changeListeners;return r.add(e),()=>{r.delete(e)}}_withRemoteTransaction(e){const r=this._collabProvider;r!==null&&r.doc.transact(e,this)}_withLocalTransaction(e){const r=this._collabProvider;try{this._collabProvider=null,e()}finally{this._collabProvider=r}}_getCollabComments(){const e=this._collabProvider;return e!==null?e.doc.get("comments",Sr):null}_createCollabSharedMap(e){const r=new sn,n=e.type,s=e.id;if(r.set("type",n),r.set("id",s),n==="comment")r.set("author",e.author),r.set("content",e.content),r.set("deleted",e.deleted),r.set("timeStamp",e.timeStamp);else{r.set("quote",e.quote);const i=new Sr;e.comments.forEach((o,a)=>{const l=this._createCollabSharedMap(o);i.insert(a,[l])}),r.set("comments",i)}return r}registerCollaboration(e){this._collabProvider=e;const r=this._getCollabComments(),n=()=>{e.connect()},s=()=>{try{e.disconnect()}catch{}},i=this._editor.registerCommand(jb,a=>{var l,u;return n!==void 0&&s!==void 0&&(a?((l=this.logger)==null||l.info("Comments connected!"),n()):((u=this.logger)==null||u.info("Comments disconnected!"),s())),!1},Pr),o=(a,l)=>{if(l.origin!==this){for(const u of a)if(u instanceof mh){const d=u.target,f=u.delta;let h=0;for(const p of f){const y=p.insert,b=p.retain,S=p.delete,C=d.parent,x=d===r?void 0:C instanceof sn&&this._comments.find(A=>A.id===C.get("id"));if(Array.isArray(y)){const A=h;y.slice().reverse().forEach(O=>{const $=O.get("id"),L=O.get("type")==="thread"?Ef(O.get("quote"),O.get("comments").toArray().map(H=>$i(H.get("content"),H.get("author"),H.get("id"),H.get("timeStamp"),H.get("deleted"))),$):$i(O.get("content"),O.get("author"),$,O.get("timeStamp"),O.get("deleted"));this._withLocalTransaction(()=>{this.addComment(L,x,A)})})}else if(typeof b=="number")h+=b;else if(typeof S=="number")for(let A=0;A<S;A++){const O=x===void 0||x===!1?this._comments[h]:x.comments[h];this._withLocalTransaction(()=>{this.deleteCommentOrThread(O,x)}),h++}}}}};return r===null?()=>null:(r.observeDeep(o),n(),()=>{r.unobserveDeep(o),i(),this._collabProvider=null})}}function gx(t){const[e,r]=_.useState(t.getComments());return _.useEffect(()=>t.registerOnChange(()=>{r(t.getComments())}),[t]),e}function mx({onClose:t,children:e,title:r,closeOnClickOutside:n}){const s=_.useRef(null);return _.useEffect(()=>{s.current!==null&&s.current.focus()},[]),_.useEffect(()=>{let i=null;const o=u=>{u.key==="Escape"&&t()},a=u=>{const d=u.target;s.current!==null&&!s.current.contains(d)&&n&&t()},l=s.current;return l!==null&&(i=l.parentElement,i!==null&&i.addEventListener("click",a)),window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o),i!==null&&(i==null||i.removeEventListener("click",a))}},[n,t]),m.jsx("div",{className:"Modal__overlay",role:"dialog",children:m.jsxs("div",{className:"Modal__modal",tabIndex:-1,ref:s,children:[m.jsx("h2",{className:"Modal__title",children:r}),m.jsx("button",{className:"Modal__closeButton","aria-label":"Close modal",type:"button",onClick:t,children:"X"}),m.jsx("div",{className:"Modal__content",children:e})]})})}function yx({onClose:t,children:e,title:r,closeOnClickOutside:n=!1}){return gt.createPortal(m.jsx(mx,{onClose:t,title:r,closeOnClickOutside:n,children:e}),document.body)}function Tf(){const[t,e]=_.useState(null),r=_.useCallback(()=>{e(null)},[]),n=_.useMemo(()=>{if(t===null)return null;const{title:i,content:o,closeOnClickOutside:a}=t;return m.jsx(yx,{onClose:r,title:i,closeOnClickOutside:a,children:o})},[t,r]),s=_.useCallback((i,o,a=!1)=>{e({closeOnClickOutside:a,content:o(r),title:i})},[r]);return[n,s]}const bx={...wf,paragraph:"CommentEditorTheme__paragraph"};function _x(...t){return t.filter(Boolean).join(" ")}function cr({"data-test-id":t,children:e,className:r,onClick:n,disabled:s,small:i,title:o}){return m.jsx("button",{disabled:s,className:_x("Button__root",s&&"Button__disabled",i&&"Button__small",r),onClick:n,title:o,"aria-label":o,...t&&{"data-test-id":t},children:e})}function kx({className:t}){return m.jsx(fd,{className:t||"ContentEditable__root"})}function vx({children:t,className:e}){return m.jsx("div",{className:e||"Placeholder__root",children:t})}const pu=qa("INSERT_INLINE_COMMAND");function wx({anchorKey:t,editor:e,showComments:r,onAddComment:n}){const s=_.useRef(null),i=_.useCallback(()=>{const o=s.current,a=e.getRootElement(),l=e.getElementByKey(t);if(o!==null&&a!==null&&l!==null){const{right:u}=a.getBoundingClientRect(),{top:d}=l.getBoundingClientRect();o.style.left=`${u-20}px`,o.style.top=`${d-30}px`}},[t,e]);return _.useEffect(()=>(window.addEventListener("resize",i),()=>{window.removeEventListener("resize",i)}),[e,i]),_.useLayoutEffect(()=>{i()},[t,e,r,i]),m.jsx("div",{className:"CommentPlugin_AddCommentBox",ref:s,children:m.jsx("button",{className:"CommentPlugin_AddCommentBox_button",onClick:n,children:m.jsx("i",{className:"icon add-comment"})})})}function xx({onEscape:t}){const[e]=ue();return _.useEffect(()=>e.registerCommand(ad,r=>t(r),fi),[e,t]),null}function Mf({className:t,autoFocus:e,onEscape:r,onChange:n,editorRef:s,placeholder:i="Type a comment..."}){return m.jsx(dd,{initialConfig:{namespace:"Commenting",nodes:[],onError:o=>{throw o},theme:bx},children:m.jsxs("div",{className:"CommentPlugin_CommentInputBox_EditorContainer",children:[m.jsx(Um,{contentEditable:m.jsx(kx,{className:t}),placeholder:m.jsx(vx,{children:i}),ErrorBoundary:hd}),m.jsx(Ep,{onChange:n}),m.jsx(Rd,{}),e!==!1&&m.jsx(Tp,{}),m.jsx(xx,{onEscape:r}),m.jsx(Mp,{}),s!==void 0&&m.jsx(Pd,{editorRef:s})]})})}function Af(t,e){return _.useCallback((r,n)=>{r.read(()=>{t(Cp()),e(!Sp(n.isComposing(),!0))})},[e,t])}function Cx({editor:t,cancelAddComment:e,submitAddComment:r}){const[n,s]=_.useState(""),[i,o]=_.useState(!1),a=_.useRef(null),l=_.useMemo(()=>({container:document.createElement("div"),elements:[]}),[]),u=_.useRef(null),d=Of(),f=_.useCallback(()=>{t.getEditorState().read(()=>{const b=ne();if(X(b)){u.current=b.clone();const S=b.anchor,C=b.focus,x=wp(t,S.getNode(),S.offset,C.getNode(),C.offset),A=a.current;if(x!==null&&A!==null){const{left:O,bottom:$,width:L}=x.getBoundingClientRect(),H=xp(t,x);let q=H.length===1?O+L/2-125:O-125;q<10&&(q=10),A.style.left=`${q}px`,A.style.top=`${$+20+(window.pageYOffset||document.documentElement.scrollTop)}px`;const F=H.length,{container:W}=l,k=l.elements,M=k.length;for(let v=0;v<F;v++){const N=H[v];let P=k[v];P===void 0&&(P=document.createElement("span"),k[v]=P,W.appendChild(P));const j=`position:absolute;top:${N.top+(window.pageYOffset||document.documentElement.scrollTop)}px;left:${N.left}px;height:${N.height}px;width:${N.width}px;background-color:rgba(255, 212, 0, 0.3);pointer-events:none;z-index:5;`;P.style.cssText=j}for(let v=M-1;v>=F;v--){const N=k[v];W.removeChild(N),k.pop()}}}})},[t,l]);_.useLayoutEffect(()=>{f();const b=l.container,S=document.body;return S!==null?(S.appendChild(b),()=>{S.removeChild(b)}):()=>{}},[l.container,f]),_.useEffect(()=>(window.addEventListener("resize",f),()=>{window.removeEventListener("resize",f)}),[f]);const h=b=>(b.preventDefault(),e(),!0),p=()=>{if(i){let b=t.getEditorState().read(()=>{const S=u.current;return S?S.getTextContent():""});b.length>100&&(b=b.slice(0,99)+""),r(Ef(b,[$i(n,d)]),!0,void 0,u.current),u.current=null}},y=Af(s,o);return m.jsxs("div",{className:"CommentPlugin_CommentInputBox",ref:a,children:[m.jsx(Mf,{className:"CommentPlugin_CommentInputBox_Editor",onEscape:h,onChange:y}),m.jsxs("div",{className:"CommentPlugin_CommentInputBox_Buttons",children:[m.jsx(cr,{onClick:e,className:"CommentPlugin_CommentInputBox_Button",children:"Cancel"}),m.jsx(cr,{onClick:p,disabled:!i,className:"CommentPlugin_CommentInputBox_Button primary",children:"Comment"})]})]})}function Sx({submitAddComment:t,thread:e,placeholder:r}){const[n,s]=_.useState(""),[i,o]=_.useState(!1),a=_.useRef(null),l=Of(),u=Af(s,o);return m.jsxs(m.Fragment,{children:[m.jsx(Mf,{className:"CommentPlugin_CommentsPanel_Editor",autoFocus:!1,onEscape:()=>!0,onChange:u,editorRef:a,placeholder:r}),m.jsx(cr,{className:"CommentPlugin_CommentsPanel_SendButton",onClick:()=>{if(i){t($i(n,l),!1,e);const d=a.current;d!==null&&d.dispatchCommand(sd,void 0)}},disabled:!i,children:m.jsx("i",{className:"send"})})]})}function Nf({commentOrThread:t,deleteCommentOrThread:e,onClose:r,thread:n=void 0}){return m.jsxs(m.Fragment,{children:["Are you sure you want to delete this ",t.type,"?",m.jsxs("div",{className:"Modal__content",children:[m.jsx(cr,{onClick:()=>{e(t,n),r()},children:"Delete"})," ",m.jsx(cr,{onClick:()=>{r()},children:"Cancel"})]})]})}function gu({comment:t,deleteComment:e,thread:r,rtf:n}){const s=Math.round((t.timeStamp-(performance.timeOrigin+performance.now()))/1e3),i=Math.round(s/60),[o,a]=Tf();return m.jsxs("li",{className:"CommentPlugin_CommentsPanel_List_Comment",children:[m.jsxs("div",{className:"CommentPlugin_CommentsPanel_List_Details",children:[m.jsx("span",{className:"CommentPlugin_CommentsPanel_List_Comment_Author",children:t.author}),m.jsxs("span",{className:"CommentPlugin_CommentsPanel_List_Comment_Time",children:[" ",s>-10?"Just now":n.format(i,"minute")]})]}),m.jsx("p",{className:t.deleted?"CommentPlugin_CommentsPanel_DeletedComment":"",children:t.content}),!t.deleted&&m.jsxs(m.Fragment,{children:[m.jsx(cr,{onClick:()=>{a("Delete Comment",l=>m.jsx(Nf,{commentOrThread:t,deleteCommentOrThread:e,thread:r,onClose:l}))},className:"CommentPlugin_CommentsPanel_List_DeleteButton",children:m.jsx("i",{className:"delete"})}),o]})]})}function Ex({activeIDs:t,comments:e,deleteCommentOrThread:r,listRef:n,submitAddComment:s,markNodeMap:i}){const[o]=ue(),[a,l]=_.useState(0),[u,d]=Tf(),f=_.useMemo(()=>new Intl.RelativeTimeFormat("en",{localeMatcher:"best fit",numeric:"auto",style:"short"}),[]);return _.useEffect(()=>{const h=setTimeout(()=>{l(a+1)},1e4);return()=>{clearTimeout(h)}},[a]),m.jsx("ul",{className:"CommentPlugin_CommentsPanel_List",ref:n,children:e.map(h=>{const p=h.id;return h.type==="thread"?m.jsxs("li",{onClick:()=>{const y=i.get(p);if(y!==void 0&&(t===null||t.indexOf(p)===-1)){const b=document.activeElement;o.update(()=>{const S=Array.from(y)[0],C=we(S);Fe(C)&&C.selectStart()},{onUpdate(){b!==null&&b.focus()}})}},className:`CommentPlugin_CommentsPanel_List_Thread ${i.has(p)?"interactive":""} ${t.indexOf(p)===-1?"":"active"}`,children:[m.jsxs("div",{className:"CommentPlugin_CommentsPanel_List_Thread_QuoteBox",children:[m.jsxs("blockquote",{className:"CommentPlugin_CommentsPanel_List_Thread_Quote",children:["> ",m.jsx("span",{children:h.quote})]}),m.jsx(cr,{onClick:()=>{d("Delete Thread",y=>m.jsx(Nf,{commentOrThread:h,deleteCommentOrThread:r,onClose:y}))},className:"CommentPlugin_CommentsPanel_List_DeleteButton",children:m.jsx("i",{className:"delete"})}),u]}),m.jsx("ul",{className:"CommentPlugin_CommentsPanel_List_Thread_Comments",children:h.comments.map(y=>m.jsx(gu,{comment:y,deleteComment:r,thread:h,rtf:f},y.id))}),m.jsx("div",{className:"CommentPlugin_CommentsPanel_List_Thread_Editor",children:m.jsx(Sx,{submitAddComment:s,thread:h,placeholder:"Reply to comment..."})})]},p):m.jsx(gu,{comment:h,deleteComment:r,rtf:f},p)})})}function Tx({activeIDs:t,deleteCommentOrThread:e,comments:r,submitAddComment:n,markNodeMap:s}){const i=_.useRef(null),o=r.length===0;return m.jsxs("div",{className:"CommentPlugin_CommentsPanel",children:[m.jsx("h2",{className:"CommentPlugin_CommentsPanel_Heading",children:"Comments"}),o?m.jsx("div",{className:"CommentPlugin_CommentsPanel_Empty",children:"No Comments"}):m.jsx(Ex,{activeIDs:t,comments:r,deleteCommentOrThread:e,listRef:i,submitAddComment:n,markNodeMap:s})]})}function Of(){const t=$d(),{yjsDocMap:e,name:r}=t;return e.has("comments")?r:"Scripture User"}function Mx({providerFactory:t,setCommentStore:e,onChange:r,showCommentsContainerRef:n,commentContainerRef:s,logger:i}){const o=$d(),[a]=ue(),l=_.useMemo(()=>{const q=new px(a,i);return r&&q.registerOnChange(r),e==null||e(q),q},[a,i,r,e]),u=gx(l),d=_.useMemo(()=>new Map,[]),[f,h]=_.useState(),[p,y]=_.useState([]),[b,S]=_.useState(!1),[C,x]=_.useState(!1),{yjsDocMap:A}=o;_.useEffect(()=>{if(t){const q=t("comments",A);return l.registerCollaboration(q)}return()=>{}},[l,t,A]);const O=_.useCallback(()=>{a.update(()=>{const q=ne();q!==null&&(q.dirty=!0)}),S(!1)},[a]),$=_.useCallback((q,F)=>{if(q.type==="comment"){const W=l.deleteCommentOrThread(q,F);if(!W)return;const{markedComment:k,index:M}=W;l.addComment(k,F,M)}else{l.deleteCommentOrThread(q);const W=F!==void 0?F.id:q.id,k=d.get(W);k!==void 0&&setTimeout(()=>{a.update(()=>{for(const M of k){const v=we(M);Fe(v)&&(v.deleteID(ir,W),v.hasNoIDsForEveryType()&&Gh(v))}})})}},[l,a,d]),L=_.useCallback((q,F,W,k)=>{l.addComment(q,W),F&&(a.update(()=>{X(k)&&Yh(k,ir,q.id)}),S(!1))},[l,a]);_.useEffect(()=>{const q=[];for(const F of p){const W=d.get(F);if(W!==void 0)for(const k of W){const M=a.getElementByKey(k);M!==null&&(M.classList.add("selected"),q.push(M),x(!0))}}return()=>{for(const F of q)F.classList.remove("selected")}},[p,a,d]),_.useEffect(()=>{if(!a.hasNodes([Le]))throw new Error("CommentPlugin: TypedMarkNode not registered on editor!");const q=new Map;return Xe(md(a,Le,F=>us(F.getTypedIDs()),(F,W)=>{for(const[k,M]of Object.entries(F.getTypedIDs()))M.forEach(v=>{W.addID(k,v)})}),a.registerMutationListener(Le,F=>{a.getEditorState().read(()=>{for(const[W,k]of F){const M=we(W);let v=[];k==="destroyed"?v=q.get(W)??[]:Fe(M)&&(v=M.getTypedIDs()[ir]??[]);for(const N of v){let P=d.get(N);q.set(W,v),k==="destroyed"?P!==void 0&&(P.delete(W),P.size===0&&d.delete(N)):(P===void 0&&(P=new Set,d.set(N,P)),P.has(W)||P.add(W))}}})},{skipInitialization:!1}),a.registerUpdateListener(({editorState:F,tags:W})=>{F.read(()=>{const k=ne();let M=!1,v=!1;if(X(k)){const N=k.anchor.getNode();if(ee(N)){const P=S_(N,ir,k.anchor.offset)??[];P!==null&&(y(P),M=!0),k.isCollapsed()||(h(N.getKey()),v=!0)}}M||y(N=>N.length===0?N:[]),v||h(null),!W.has("collaboration")&&X(k)&&S(!1)})}),a.registerCommand(pu,()=>{const F=window.getSelection();return F!==null&&F.removeAllRanges(),S(!0),!0},xe))},[a,d]);const H=()=>{a.dispatchCommand(pu,void 0)};return m.jsxs(m.Fragment,{children:[b&&gt.createPortal(m.jsx(Cx,{editor:a,cancelAddComment:O,submitAddComment:L}),document.body),f!=null&&!b&&gt.createPortal(m.jsx(wx,{anchorKey:f,editor:a,showComments:C,onAddComment:H}),document.body),n!==null&&gt.createPortal(m.jsx(cr,{className:`CommentPlugin_ShowCommentsButton ${C?"active":""}`,onClick:()=>x(!C),title:C?"Hide Comments":"Show Comments",children:m.jsx("i",{className:"comments"})}),(n==null?void 0:n.current)??document.body),C&&gt.createPortal(m.jsx(Tx,{comments:u,submitAddComment:L,deleteCommentOrThread:$,activeIDs:p,markNodeMap:d}),(s==null?void 0:s.current)??document.body)]})}function Ax(){const t=_.useRef(void 0),e=_.useCallback(r=>{t.current=r},[]);return[t,e]}function Nx(t,e){var r,n;const s=((r=e.current)==null?void 0:r.getComments())??[],i=s==null?void 0:s.map(a=>a.id),o=t.map(a=>{const l=i.findIndex(u=>u===a);return l!==void 0&&l>=0?s[l]:{comments:[{author:"unknown",content:"Comment not found",deleted:!1,id:"",timeStamp:0,type:"comment"}],id:a,quote:"",type:"thread"}});s.forEach(a=>{t.includes(a.id)||o.push(a)}),o&&((n=e.current)==null||n.setComments(o))}function Ox(t,e){_.useEffect(()=>{var r;t.options??(t.options={}),(r=t.options).nodes??(r.nodes={}),t.options.nodes.addMissingComments=n=>{Nx(n,e)}},[e,t])}_.forwardRef(function(t,e){const r=_.useRef(null),n=_.useRef(!0),s=_.useRef(null),[i,o]=_.useState(null),{children:a,onCommentChange:l,onUsjChange:u,showCommentsContainerRef:d,...f}=t,{options:{isReadonly:h}={}}=t,[p,y]=Ax();Ox(f,p),_.useImperativeHandle(e,()=>({focus(){var C;(C=r.current)==null||C.focus()},undo(){var C;(C=r.current)==null||C.undo()},redo(){var C;(C=r.current)==null||C.redo()},cut(){var C;(C=r.current)==null||C.cut()},copy(){var C;(C=r.current)==null||C.copy()},paste(){var C;(C=r.current)==null||C.paste()},pastePlainText(){var C;(C=r.current)==null||C.pastePlainText()},getUsj(){var C;return(C=r.current)==null?void 0:C.getUsj()},setUsj(C){var x;(x=r.current)==null||x.setUsj(C)},applyUpdate(C,x){var A;(A=r.current)==null||A.applyUpdate(C,x)},replaceEmbedUpdate(C,x){var A;return(A=r.current)==null?void 0:A.replaceEmbedUpdate(C,x)},getSelection(){var C;return(C=r.current)==null?void 0:C.getSelection()},setSelection(C){var x;(x=r.current)==null||x.setSelection(C)},addAnnotation(C,x,A){var O;(O=r.current)==null||O.addAnnotation(C,x,A)},removeAnnotation(C,x){var A;(A=r.current)==null||A.removeAnnotation(C,x)},formatPara(C){var x;(x=r.current)==null||x.formatPara(C)},getElementByKey(C){var x;return(x=r.current)==null?void 0:x.getElementByKey(C)},insertNote(C,x,A){var O;(O=r.current)==null||O.insertNote(C,x,A)},selectNote(C){var x;(x=r.current)==null||x.selectNote(C)},getNoteOps(C){var x;return(x=r.current)==null?void 0:x.getNoteOps(C)},setComments(C){var x;(x=p.current)==null||x.setComments(C),n.current=!0},get toolbarEndRef(){return i}}));const b=_.useCallback((C,x,A,O)=>{var $;if(!u)return;const L=($=p.current)==null?void 0:$.getComments();u(C,L,x,A,O)},[p,u]),S=_.useCallback(()=>{var C;if(!l||n.current){n.current=!1;return}const x=(C=p.current)==null?void 0:C.getComments();l(x)},[p,n,l]);return _.useEffect(()=>{var C;return o(((C=r.current)==null?void 0:C.toolbarEndRef)??null),()=>o(null)},[]),m.jsxs(Cf,{ref:r,onUsjChange:b,...f,children:[m.jsx(Mx,{setCommentStore:y,onChange:S,showCommentsContainerRef:h?null:d??i,commentContainerRef:s,logger:f.logger}),m.jsx("div",{ref:s,className:"comment-container"})]})});const xl=_.memo(function({viewMode:e,description:r,children:n}){const s=e==="story",i=_.useMemo(()=>!s||typeof r!="string"||!r.trim()?null:m.jsxs(Pp,{className:"tw-w-full",children:[m.jsx(Rp,{className:"tw-pb-2",children:m.jsx($p,{className:"tw-text-sm tw-font-medium tw-text-muted-foreground",children:"Story Description"})}),m.jsx(qp,{className:"tw-pt-2",children:m.jsx(Ip,{className:"tw-prose-sm tw-max-w-none tw-text-muted-foreground",markdown:r})})]}),[r,s]);return m.jsxs("div",{style:{display:"grid",gap:8},children:[n,i]})});xl.__docgenInfo={description:"",methods:[],displayName:"CanvasWithDescription",props:{viewMode:{required:!1,tsType:{name:"string"},description:""},description:{required:!1,tsType:{name:"string"},description:""},children:{required:!0,tsType:{name:"ReactNode"},description:""}}};const Ia={m:"m - Paragraph - Margin - No First Line Indent",ms:"ms - Heading - Major Section Level 1",nb:"nb - Paragraph - No Break with Previous Paragraph",p:"p - Paragraph - Normal - First Line Indent",pi:"pi - Paragraph - Indented - Level 1 - First Line Indent",q1:"q1 - Poetry - Indent Level 1",q2:"q2 - Poetry - Indent Level 2",r:"r - Heading - Parallel References",s:"s - Heading - Section Level 1"},mu={...Ia,ide:"ide - File - Encoding",h:"h - File - Header",h1:"h1 - File - Header",h2:"h2 - File - Left Header",h3:"h3 - File - Right Header",toc1:"toc1 - File - Long Table of Contents Text",toc2:"toc2 - File - Short Table of Contents Text",toc3:"toc3 - File - Book Abbreviation",cl:"cl - Chapter - Publishing Label",mt:"mt - Title - Major Title Level 1",mt1:"mt1 - Title - Major Title Level 1",mt2:"mt2 - Title - Major Title Level 2",mt3:"mt3 - Title - Major Title Level 3",mt4:"mt4 - Title - Major Title Level 4",ms1:"ms1 - Heading - Major Section Level 1",ms2:"ms2 - Heading - Major Section Level 2",ms3:"ms3 - Heading - Major Section Level 3",b:"b - Poetry - Stanza Break (Blank Line)"},yu={m:Bs,ms:Yr,nb:Bs,p:Bs,pi:Bs,q1:Lo,q2:Lo,r:Yr,s:Yr,ide:Ft,h:Ft,h1:Ft,h2:Ft,h3:Ft,toc1:Ft,toc2:Ft,toc3:Ft,cl:Ft,mt:Yr,mt1:Yr,mt2:jl,mt3:qo,mt4:qo,ms1:Yr,ms2:jl,ms3:qo,b:Lo};function bu({blockMarker:t,className:e}){const r=t&&t in yu?yu[t]:Zp;return m.jsx(r,{className:e,size:16})}function jf({editorRef:t,blockMarker:e}){return m.jsxs(Da,{children:[m.jsx(Fa,{asChild:!0,children:m.jsxs(pt,{variant:"outline",className:"","aria-label":"Formatting options for block type",children:[m.jsx(bu,{blockMarker:e,className:"tw-me-2"}),jx(e),m.jsx(Up,{className:"tw-ms-2"})]})}),m.jsx(Ua,{children:Object.keys(Ia).map(r=>m.jsxs(Fp,{className:`item block-marker ${Ix(e===r)}`,onClick:()=>{var n;return(n=t.current)==null?void 0:n.formatPara(r)},children:[m.jsx(bu,{blockMarker:r,className:"tw-me-2"}),m.jsx("span",{className:`text usfm_${r}`,children:Ia[r]})]},r))})]})}function jx(t){return t&&t in mu?mu[t]:"No Style"}function Ix(t){return t?"active dropdown-item-active":""}jf.__docgenInfo={description:"",methods:[],displayName:"BlockFormatDropDown",props:{editorRef:{required:!0,tsType:{name:"MutableRefObject",elements:[{name:"union",raw:"EditorRef | null",elements:[{name:"EditorRef"},{name:"null"}]}],raw:"MutableRefObject<EditorRef | null>"},description:""},blockMarker:{required:!0,tsType:{name:"union",raw:"string | undefined",elements:[{name:"string"},{name:"undefined"}]},description:""}}};const Px={columns:{"platformScriptureEditor.edit":{label:"Edit",order:1},"platformScriptureEditor.insert":{label:"Insert",order:2}},groups:{"platformScriptureEditor.clipboard":{column:"platformScriptureEditor.edit",order:1},"platformScriptureEditor.insertNote":{column:"platformScriptureEditor.insert",order:1}},items:[{label:"Insert footnote",group:"platformScriptureEditor.insertNote",order:1,command:"platformScriptureEditor.insertFootnoteAtSelection",localizeNotes:""},{label:"Insert cross-reference",group:"platformScriptureEditor.insertNote",order:2,command:"platformScriptureEditor.insertCrossReferenceAtSelection",localizeNotes:""},{label:"Insert endnote",group:"platformScriptureEditor.insertNote",order:3,command:"platformScriptureEditor.insertEndnoteAtSelection",localizeNotes:""},{label:"Cut",group:"platformScriptureEditor.clipboard",order:1,command:"platformScriptureEditor.cut",localizeNotes:""},{label:"Copy",group:"platformScriptureEditor.clipboard",order:2,command:"platformScriptureEditor.copy",localizeNotes:""},{label:"Paste",group:"platformScriptureEditor.clipboard",order:3,command:"platformScriptureEditor.paste",localizeNotes:""},{label:"Paste as plain text",group:"platformScriptureEditor.clipboard",order:4,command:"platformScriptureEditor.pastePlainText",localizeNotes:""}]};function If({editorRef:t,scrRef:e,onScrRefChange:r,isReadonly:n=!1,canUndo:s=!1,canRedo:i=!1,blockMarker:o}){const a=()=>{var h;(h=t.current)==null||h.insertNote("f")},l=()=>{var h;(h=t.current)==null||h.insertNote("x")},u=()=>{var h;(h=t.current)==null||h.insertNote("fe")},d=h=>{var p,y,b,S;switch(h.command){case"platformScriptureEditor.insertFootnoteAtSelection":a();break;case"platformScriptureEditor.insertCrossReferenceAtSelection":l();break;case"platformScriptureEditor.insertEndnoteAtSelection":u();break;case"platformScriptureEditor.cut":(p=t.current)==null||p.cut();break;case"platformScriptureEditor.copy":(y=t.current)==null||y.copy();break;case"platformScriptureEditor.paste":(b=t.current)==null||b.paste();break;case"platformScriptureEditor.pastePlainText":(S=t.current)==null||S.pastePlainText();break;default:throw new Error(`Unknown onSelectProjectMenuItem command: ${h.command}`)}},f=()=>{};return m.jsx(Dp,{onSelectProjectMenuItem:d,onSelectViewInfoMenuItem:f,projectMenuData:Px,className:"toolbar",startAreaChildren:m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"tw-flex tw-h-full tw-items-center",children:m.jsx(Lp,{scrRef:e,handleSubmit:r})}),!n&&m.jsxs(m.Fragment,{children:[m.jsx(pt,{"aria-label":"Undo",title:"Undo",variant:"ghost",size:"icon",onClick:()=>{var h;return(h=t.current)==null?void 0:h.undo()},disabled:!s,children:m.jsx(yg,{})}),m.jsx(pt,{"aria-label":"Redo",title:"Redo",variant:"ghost",size:"icon",onClick:()=>{var h;return(h=t.current)==null?void 0:h.redo()},disabled:!i,children:m.jsx(og,{})}),m.jsx(jf,{editorRef:t,blockMarker:o}),m.jsx(pt,{"aria-label":"Insert footnote",title:"Insert footnote",variant:"ghost",size:"icon",onClick:a,children:m.jsx(pg,{})}),m.jsx(pt,{"aria-label":"Insert cross-reference",title:"Insert cross-reference",variant:"ghost",size:"icon",onClick:l,children:m.jsx(lg,{})}),m.jsx(pt,{"aria-label":"Insert endnote",title:"Insert endnote",variant:"ghost",size:"icon",onClick:u,children:m.jsx(sg,{})})]})]})})}If.__docgenInfo={description:"",methods:[],displayName:"PlatformToolbar",props:{editorRef:{required:!0,tsType:{name:"RefObject",elements:[{name:"union",raw:"MarginalRef | EditorRef | null",elements:[{name:"MarginalRef"},{name:"EditorRef"},{name:"null"}]}],raw:"RefObject<MarginalRef | EditorRef | null>"},description:""},scrRef:{required:!0,tsType:{name:"SerializedVerseRef"},description:""},onScrRefChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(scrRef: SerializedVerseRef) => void",signature:{arguments:[{type:{name:"SerializedVerseRef"},name:"scrRef"}],return:{name:"void"}}},description:""},isReadonly:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},canUndo:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},canRedo:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},blockMarker:{required:!1,tsType:{name:"string"},description:""}}};function Lr(t,e,r){var h,p,y,b;const n=_.useRef(null),[s,i]=_.useState(r),[o,a]=_.useState(!1),[l,u]=_.useState(!1),[d,f]=_.useState();return m.jsxs(xl,{viewMode:e.viewMode,description:((y=(p=(h=e.parameters)==null?void 0:h.docs)==null?void 0:p.description)==null?void 0:y.story)??((b=e.parameters)==null?void 0:b.description),children:[m.jsx(If,{editorRef:n,scrRef:s,onScrRefChange:i,isReadonly:!1,canUndo:o,canRedo:l,blockMarker:d}),m.jsx(wn,{...t,ref:n,scrRef:s,onScrRefChange:i,onStateChange:(S,C,x)=>{a(S),u(C),f(x)}})]})}Lr.__docgenInfo={description:`Render function that combines the Editorial component with a PlatformToolbar. This provides a
complete editing experience with undo/redo, navigation, and other toolbar features.

Use this as a render function in a Storybook story, not as a component.`,methods:[],displayName:"renderEditorialWithToolbar"};const Rx='<usx version="3.1" />',$x=Pa(Rx),qx=`<?xml version="1.0" encoding="utf-8"?>
<usx version="3.1">
  <book code="PSA" style="id">World English Bible (WEB)</book>
  <para style="mt1">The Psalms</para>
  <chapter number="1" style="c" sid="PSA 1" />
  <para style="q1">
    <verse number="1" style="v" sid="PSA 1:1" />Blessed is the man who doesnt walk in the counsel of the wicked<note caller="+" style="f"><char style="fr">1:1 </char><char style="ft">Or "sinful"</char></note>,</para>
  <para style="q2" vid="PSA 1:1">nor stand on the path<note caller="+" style="f"><char style="fr">1:1 </char><char style="ft">Hebrew: "way"</char></note> of sinners,</para>
  <para style="q2" vid="PSA 1:1">nor sit in the seat of scoffers;<verse eid="PSA 1:1" /></para>
  <para style="q1">
    <verse number="2" style="v" sid="PSA 1:2" /><note caller="+" style="f"><char style="fr" closed="false">1:2 </char><char style="ft" closed="false">After verse</char></note> but his delight is in Yahwehs<note caller="+" style="f"><char style="fr" closed="false">1:2 </char><char style="ft" closed="false">Yahweh is Gods proper Name, sometimes rendered LORD (all caps) in other translations.</char></note> law.<note caller="+" style="f"><char style="fr" closed="false">1:2 </char><char style="ft" closed="false">End of Para</char></note></para>
  <para style="q2" vid="PSA 1:2">On his law he meditates day and night.<note caller="+" style="f"><char style="fr" closed="false">1:2 </char><char style="ft" closed="false">End of Doc</char></note><verse eid="PSA 1:2" /></para>
</usx>
`,Rt=Pa(qx),Lx={start:{jsonPath:"$.content[3].content[1]",offset:15},end:{jsonPath:"$.content[3].content[1]",offset:18}},Dx={start:{jsonPath:"$.content[3].content[1]",offset:15},end:{jsonPath:"$.content[3].content[1]",offset:22}},Fx=`<?xml version="1.0" encoding="utf-8"?>
<usx version="3.1">
  <book code="PSA" style="id"></book>
  <para style="mt1"></para>
  <chapter number="1" style="c" sid="PSA 1" />
  <para style="q1">
    <verse number="1" style="v" sid="PSA 1:1" />      ,</para>
  <para style="q2" vid="PSA 1:1">   ,</para>
  <para style="q2" vid="PSA 1:1">   .<verse eid="PSA 1:1" /></para>
  <para style="q1">
    <verse number="2" style="v" sid="PSA 1:2" />    ,</para>
  <para style="q2" vid="PSA 1:2">   .<verse eid="PSA 1:2" /></para>
</usx>
`,Ux=Pa(Fx),Bx=(t,e,r)=>t==="generated"?m.jsxs(m.Fragment,{children:[m.jsx("p",{children:"+"})," ",e["%footnoteEditor_callerDropdown_item_generated%"]]}):t==="hidden"?m.jsxs(m.Fragment,{children:[m.jsx("p",{children:"-"})," ",e["%footnoteEditor_callerDropdown_item_hidden%"]]}):m.jsxs(m.Fragment,{children:[m.jsx("p",{children:r})," ",e["%footnoteEditor_callerDropdown_item_custom%"]]});function Pf({callerType:t,updateCallerType:e,customCaller:r,updateCustomCaller:n,localizedStrings:s}){const[i,o]=_.useState(t),[a,l]=_.useState(r);_.useEffect(()=>{o(t)},[t]),_.useEffect(()=>{a!==r&&l(r)},[r]);const u=d=>{d||(i!=="custom"||a?(e(i),n(a)):(o(t),l(r)))};return m.jsxs(Da,{onOpenChange:u,children:[m.jsx(Gn,{children:m.jsxs(Yn,{children:[m.jsx(pi,{asChild:!0,children:m.jsx(Fa,{asChild:!0,children:m.jsx(pt,{variant:"outline",className:"tw-h-6",children:Bx(t,s,r)})})}),m.jsx(Xn,{children:s["%footnoteEditor_callerDropdown_tooltip%"]})]})}),m.jsxs(Ua,{className:"tw-z-[300]",children:[m.jsx(bd,{children:s["%footnoteEditor_callerDropdown_label%"]}),m.jsx(_d,{}),m.jsx(Vn,{checked:i==="generated",onCheckedChange:()=>o("generated"),children:m.jsxs("div",{className:"tw-flex tw-w-full tw-justify-between",children:[m.jsx("span",{children:s["%footnoteEditor_callerDropdown_item_generated%"]}),m.jsx("span",{className:"tw-w-10 tw-text-center",children:jt})]})}),m.jsx(Vn,{checked:i==="hidden",onCheckedChange:()=>o("hidden"),children:m.jsxs("div",{className:"tw-flex tw-w-full tw-justify-between",children:[m.jsx("span",{children:s["%footnoteEditor_callerDropdown_item_hidden%"]}),m.jsx("span",{className:"tw-w-10 tw-text-center",children:ln})]})}),m.jsx(Vn,{checked:i==="custom",onCheckedChange:()=>o("custom"),onSelect:d=>d.preventDefault(),children:m.jsxs("div",{className:"tw-flex tw-w-full tw-justify-between",children:[m.jsx("span",{children:s["%footnoteEditor_callerDropdown_item_custom%"]}),m.jsx(Hp,{className:"tw-h-auto tw-w-10 tw-p-0 tw-text-center",value:a,maxLength:1,onChange:d=>l(d.target.value)})]})})]})]})}Pf.__docgenInfo={description:"",methods:[],displayName:"FootnoteCallerDropdown",props:{callerType:{required:!0,tsType:{name:"union",raw:"'generated' | 'hidden' | 'custom'",elements:[{name:"literal",value:"'generated'"},{name:"literal",value:"'hidden'"},{name:"literal",value:"'custom'"}]},description:"The caller type value to pass to the dropdown"},updateCallerType:{required:!0,tsType:{name:"signature",type:"function",raw:"(newCallerType: FootnoteCallerType) => void",signature:{arguments:[{type:{name:"union",raw:"'generated' | 'hidden' | 'custom'",elements:[{name:"literal",value:"'generated'"},{name:"literal",value:"'hidden'"},{name:"literal",value:"'custom'"}]},name:"newCallerType"}],return:{name:"void"}}},description:"Function to update the caller type"},customCaller:{required:!0,tsType:{name:"string"},description:"The custom caller to pass to the custom caller input field"},updateCustomCaller:{required:!0,tsType:{name:"signature",type:"function",raw:"(newCustomCaller: string) => void",signature:{arguments:[{type:{name:"string"},name:"newCustomCaller"}],return:{name:"void"}}},description:"FUnction to update the custom caller"},localizedStrings:{required:!0,tsType:{name:"signature",type:"object",raw:`{
  [localizedKey in (typeof FOOTNOTE_EDITOR_STRING_KEYS)[number]]?: string;
}`,signature:{properties:[{key:{name:"unknown[number]",raw:"(typeof FOOTNOTE_EDITOR_STRING_KEYS)[number]",required:!1},value:{name:"string"}}]}},description:"Localized strings from the parent component"}}};const Hx=(t,e)=>t==="f"?m.jsxs(m.Fragment,{children:[m.jsx(kd,{})," ",e["%footnoteEditor_noteType_footnote_label%"]]}):t==="fe"?m.jsxs(m.Fragment,{children:[m.jsx(vd,{})," ",e["%footnoteEditor_noteType_endNote_label%"]]}):m.jsxs(m.Fragment,{children:[m.jsx(hg,{})," ",e["%footnoteEditor_noteType_crossReference_label%"]]}),Wx=(t,e)=>{if(t==="x")return e["%footnoteEditor_noteType_crossReference_label%"];let r=e["%footnoteEditor_noteType_endNote_label%"];return t==="f"&&(r=e["%footnoteEditor_noteType_footnote_label%"]),Wp(e["%footnoteEditor_noteType_tooltip%"]??"",{noteType:r})};function Rf({noteType:t,handleNoteTypeChange:e,localizedStrings:r}){return m.jsxs(Da,{children:[m.jsx(Gn,{children:m.jsxs(Yn,{children:[m.jsx(Bp,{asChild:!0,children:m.jsx(Fa,{asChild:!0,children:m.jsx(pt,{variant:"outline",className:"tw-h-6 disabled:tw-pointer-events-auto",disabled:t==="x",children:Hx(t,r)})})}),m.jsx(Xn,{children:m.jsx("p",{children:Wx(t,r)})})]})}),t!=="x"&&m.jsxs(Ua,{className:"tw-z-[300]",children:[m.jsx(bd,{children:r["%footnoteEditor_noteTypeDropdown_label%"]}),m.jsx(_d,{}),m.jsxs(Vn,{checked:t==="f",onCheckedChange:()=>e("f"),className:"tw-gap-2",children:[m.jsx(kd,{}),m.jsx("span",{children:r["%footnoteEditor_noteType_footnote_label%"]})]}),m.jsxs(Vn,{checked:t==="fe",onCheckedChange:()=>e("fe"),className:"tw-gap-2",children:[m.jsx(vd,{}),m.jsx("span",{children:r["%footnoteEditor_noteType_endNote_label%"]})]})]})]})}Rf.__docgenInfo={description:"",methods:[],displayName:"FootnoteTypeDropdown",props:{noteType:{required:!0,tsType:{name:"string"},description:""},handleNoteTypeChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(newNoteType: string) => void",signature:{arguments:[{type:{name:"string"},name:"newNoteType"}],return:{name:"void"}}},description:""},localizedStrings:{required:!0,tsType:{name:"signature",type:"object",raw:`{
  [localizedKey in (typeof FOOTNOTE_EDITOR_STRING_KEYS)[number]]?: string;
}`,signature:{properties:[{key:{name:"unknown[number]",raw:"(typeof FOOTNOTE_EDITOR_STRING_KEYS)[number]",required:!1},value:{name:"string"}}]}},description:""}}};function $f({noteOps:t,onSave:e,onClose:r,scrRef:n,noteKey:s,editorOptions:i,localizedStrings:o}){const a=_.useRef(null),l=_.createRef(),[u,d]=_.useState("generated"),[f,h]=_.useState("*"),[p,y]=_.useState("f"),b=_.useMemo(()=>({...i,markerMenuTrigger:i.markerMenuTrigger??"\\",hasExternalUI:!0,view:{...i.view??vn(),noteMode:"expanded"}}),[i]);_.useEffect(()=>{var A;(A=a.current)==null||A.focus()}),_.useEffect(()=>{var $,L;let A;const O=t==null?void 0:t.at(0);if(O&&Ht("note",O)){const H=($=O.insert.note)==null?void 0:$.caller;let q="custom";H===jt?q="generated":H===ln?q="hidden":H&&h(H),d(q),y(((L=O.insert.note)==null?void 0:L.style)??"f"),O.insert.note&&(O.insert.note.caller=""),A=setTimeout(()=>{var F;(F=a.current)==null||F.applyUpdate([{delete:1},O])},0)}return()=>{A&&clearTimeout(A)}},[t,s]);const S=_.useCallback(()=>{var O,$;const A=($=(O=a.current)==null?void 0:O.getNoteOps(0))==null?void 0:$.at(0);A&&Ht("note",A)&&(A.insert.note&&(u==="custom"?A.insert.note.caller=f:A.insert.note.caller=u==="generated"?jt:ln),e([A]))},[u,f,e]),C=()=>{var O;const A=(O=l.current)==null?void 0:O.getElementsByClassName("editor-input")[0];A!=null&&A.textContent&&navigator.clipboard.writeText(A.textContent)},x=A=>{var $,L,H;y(A);const O=(L=($=a.current)==null?void 0:$.getNoteOps(0))==null?void 0:L.at(0);O&&Ht("note",O)&&(O.insert.note&&(O.insert.note.style=A),(H=a.current)==null||H.applyUpdate([{delete:1},O]))};return m.jsxs("div",{className:"footnote-editor tw-grid tw-gap-[12px]",children:[m.jsxs("div",{className:"tw-flex",children:[m.jsxs("div",{className:"tw-flex tw-gap-4",children:[m.jsx(Rf,{noteType:p,handleNoteTypeChange:x,localizedStrings:o}),m.jsx(Pf,{callerType:u,updateCallerType:d,customCaller:f,updateCustomCaller:h,localizedStrings:o})]}),m.jsxs("div",{className:"tw-flex tw-w-full tw-justify-end tw-gap-4",children:[m.jsx(Gn,{children:m.jsxs(Yn,{children:[m.jsx(pi,{asChild:!0,children:m.jsx(pt,{onClick:r,className:"tw-h-6 tw-w-6",size:"icon",variant:"secondary",children:m.jsx(zp,{})})}),m.jsx(Xn,{children:m.jsx("p",{children:o["%footnoteEditor_cancelButton_tooltip%"]})})]})}),m.jsx(Gn,{children:m.jsxs(Yn,{children:[m.jsx(pi,{asChild:!0,children:m.jsx(pt,{onClick:S,className:"tw-h-6 tw-w-6",size:"icon",variant:"default",children:m.jsx(Jp,{})})}),m.jsx(Xn,{children:o["%footnoteEditor_saveButton_tooltip%"]})]})})]})]}),m.jsxs("div",{ref:l,className:"tw-relative tw-rounded-[6px] tw-border-2 tw-border-ring",children:[m.jsx(wn,{options:b,onScrRefChange:()=>{},scrRef:n,ref:a}),m.jsx("div",{className:"tw-absolute tw-bottom-0 tw-right-0",children:m.jsx(Gn,{children:m.jsxs(Yn,{children:[m.jsx(pi,{asChild:!0,children:m.jsx(pt,{onClick:C,className:"tw-h-6 tw-w-6",variant:"ghost",size:"icon",children:m.jsx(Kp,{})})}),m.jsx(Xn,{children:m.jsx("p",{children:o["%footnoteEditor_copyButton_tooltip%"]})})]})})})]})]})}$f.__docgenInfo={description:`Component to edit footnotes from within the editor component

@param usj The raw usj of the footnote to edit
@param parentRef The ref of the parent editor component
@returns`,methods:[],displayName:"FootnoteEditor",props:{noteOps:{required:!0,tsType:{name:"union",raw:"DeltaOpInsertNoteEmbed[] | undefined",elements:[{name:"Array",elements:[{name:"DeltaOpInsertNoteEmbed"}],raw:"DeltaOpInsertNoteEmbed[]"},{name:"undefined"}]},description:"Delta ops for the current note being edited that are applied to the note editorial"},onSave:{required:!0,tsType:{name:"signature",type:"function",raw:"(noteOps: DeltaOpInsertNoteEmbed[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"DeltaOpInsertNoteEmbed"}],raw:"DeltaOpInsertNoteEmbed[]"},name:"noteOps"}],return:{name:"void"}}},description:"External function to handle saving changes to the footnote"},onClose:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:`External function to handle closing the footnote editor. Gets called when the editor is closed
without saving changes`},scrRef:{required:!0,tsType:{name:"SerializedVerseRef"},description:"The scripture reference for the parent editor"},noteKey:{required:!0,tsType:{name:"union",raw:"string | undefined",elements:[{name:"string"},{name:"undefined"}]},description:"The unique note key to identify the note being edited used to apply changes to the note"},editorOptions:{required:!0,tsType:{name:"EditorOptions"},description:"View options of the parent editor"},localizedStrings:{required:!0,tsType:{name:"signature",type:"object",raw:`{
  [localizedKey in (typeof FOOTNOTE_EDITOR_STRING_KEYS)[number]]?: string;
}`,signature:{properties:[{key:{name:"unknown[number]",raw:"(typeof FOOTNOTE_EDITOR_STRING_KEYS)[number]",required:!1},value:{name:"string"}}]}},description:"Localized strings to be passed to the footnote editor component"}}};const rt={book:"PSA",chapterNum:1,verseNum:1},n0={title:"Demo/Editorial",component:wn,tags:["autodocs"],parameters:{docs:{description:{component:`
**Demo Only:** This component is provided for demonstration purposes only. For production applications, developers should import the Scripture Editor component directly from:
- npm [@eten-tech-foundation/platform-editor](https://www.npmjs.com/package/@eten-tech-foundation/platform-editor)
- github [eten-tech-foundation/platform-editor](https://github.com/eten-tech-foundation/scripture-editors/tree/main/packages/platform)

This demo version is included in Storybook to showcase the component's functionality and usage patterns.

**Known Limitation:** In the Docs view, all story examples may show the same note caller style due to global state management in the editor component. To see the correct note caller behavior for each story (default lowercase letters vs custom symbols), please view the individual stories in the Canvas view instead of the Docs view.
        `}}},argTypes:{ref:{control:"object",description:"Reference to the editor instance",defaultValue:null},defaultUsj:{control:"object",description:"Default USJ object to initialize the editor with",defaultValue:{type:Zn,version:es,content:[""]}},scrRef:{control:"object",description:"Scripture reference",defaultValue:rt},options:{control:"object",description:"Options to configure the editor (EditorOptions)",defaultValue:{},table:{type:{summary:"EditorOptions",detail:'{ isReadonly?: boolean; hasSpellCheck?: boolean; textDirection?: "ltr" | "rtl" | "auto"; markerMenuTrigger?: string; nodes?: UsjNodeOptions; }'}}}}},ti={args:{defaultUsj:Rt,scrRef:rt}},ri={args:{defaultUsj:$x,scrRef:rt}},ni={args:{defaultUsj:Rt,scrRef:rt,options:{isReadonly:!0}}},si={render:(t,e)=>Lr(t,e,rt),parameters:{docs:{description:{story:'Right-to-left example using a Hebrew snippet (Psalm 1:1). The editor is set to RTL via _options.textDirection = "rtl"_. If you want the UI (tab toolbar) to be RTL click **Switch direction** in the Storybook toolbar.'}}},args:{defaultUsj:Ux,options:{hasExternalUI:!0,textDirection:"rtl"}}},ii={render:t=>{const e=_.useRef(null);return _.useEffect(()=>{const r=setTimeout(()=>{e.current&&(e.current.addAnnotation(Lx,"spelling","annotationId"),e.current.addAnnotation(Dx,"grammar","abc123"))},0);return()=>clearTimeout(r)},[]),m.jsx(wn,{...t,ref:e})},args:{defaultUsj:Rt,scrRef:rt}},zx={hasExternalUI:!0,view:{...vn(),noteMode:"expandInline"},nodes:{noteCallerOnClick:(t,e,r,n,s)=>{r||(n()===jt?s(ln):s(jt))}}},oi={render:(t,e)=>Lr(t,e,rt),parameters:{docs:{description:{story:"This story demonstrates editing notes inline. Move your cursor to a note caller and the note will expand and can be edited. Move the cursor out of the note and it will collapse. Click the expanded note caller to toggle between the auto-generated caller and the hidden caller."}}},args:{defaultUsj:Rt,options:zx}},Jx={hasExternalUI:!0,view:{...vn(),noteMode:"expandInline"}},ai={render:(t,e)=>Lr(t,e,rt),parameters:{docs:{description:{story:'This story demonstrates inserting notes. Use the Project menu (hamburger) or the toolbar buttons above the editor to insert footnotes, cross-references, and endnotes at the current cursor position. Selecting text before inserting a footnote will use that text as the footnote quote. You can also insert by typing "\\f", "\\x", or "\\fe".'}}},args:{defaultUsj:Rt,options:Jx}},Kx={hasExternalUI:!0,nodes:{noteCallers:["","","","","","","","","",""],noteCallerOnClick:(t,e,r,n,s,i)=>{console.log("Note caller clicked:",t,e,r,n,s,i),alert("Note caller clicked! Check console for details.")}}},li={render:(t,e)=>Lr(t,e,rt),parameters:{docs:{description:{story:"This story demonstrates custom note callers and click handling. **Try clicking on the circled number footnote markers ( ) in the text to see the click handler in action!** The click event will show an alert and log details to the browser console."}}},args:{defaultUsj:Rt,options:Kx}},ci={render:(t,e)=>Lr(t,e,rt),parameters:{docs:{description:{story:'This story demonstrates using a custom marker menu trigger key. **Try typing "?" (question mark) anywhere in the editor text to open the marker menu!** The default trigger is "\\\\" (backslash), but this story changes it to "?" for demonstration. The marker menu allows you to insert USFM markers into the text.'}}},args:{defaultUsj:Rt,options:{hasExternalUI:!0,markerMenuTrigger:"?"}}},Vx={"%footnoteEditor_callerDropdown_label%":"Footnote caller","%footnoteEditor_callerDropdown_item_generated%":"Auto-generated","%footnoteEditor_callerDropdown_item_hidden%":"Hidden","%footnoteEditor_callerDropdown_item_custom%":"Custom","%footnoteEditor_callerDropdown_tooltip%":"Footnote caller","%footnoteEditor_cancelButton_tooltip%":"Cancel","%footnoteEditor_copyButton_tooltip%":"Copy footnote","%footnoteEditor_noteType_crossReference_label%":"Cross reference","%footnoteEditor_noteType_endNote_label%":"Endnote","%footnoteEditor_noteType_footnote_label%":"Footnote","%footnoteEditor_noteType_tooltip%":"Change type: Footnote","%footnoteEditor_noteTypeDropdown_label%":"Type","%footnoteEditor_saveButton_tooltip%":"Save"},ui={render:t=>{const e=_.useRef(null),r=_.useRef(),n=_.useRef(),[s,i]=_.useState(),[o,a]=_.useState(),[l,u]=_.useState(),[d,f]=_.useState(),h=_.useMemo(()=>({markerMode:"hidden",noteMode:"collapsed",hasSpacing:!0,isFormattedFont:!0}),[]),p=_.useMemo(()=>({...t.options??{},nodes:{noteCallerOnClick:(C,x,A,O,$,L)=>{var q;const H=C.currentTarget.getBoundingClientRect();if(i(H.left),a(H.top),u(H.height),A){if(r.current)return;const F=(q=L())==null?void 0:q.at(0);if(!F||!Ht("note",F))return;r.current=x,n.current=[F],f(!0)}}},view:h}),[t.options,h,r]),y=()=>{r.current=void 0,n.current=void 0,f(!1)},b=S=>{var C;r.current&&((C=e.current)==null||C.replaceEmbedUpdate(r.current,S)),y()};return m.jsxs("div",{children:[m.jsx(wn,{...t,options:p,ref:e,onScrRefChange:()=>{}}),m.jsxs(Vp,{open:d,children:[m.jsx(Gp,{className:"tw-absolute",style:{top:o??0,left:s??0,height:l,width:0}}),m.jsx(Yp,{className:"tw-w-[500px] tw-p-[10px]",children:m.jsx($f,{noteKey:r.current,noteOps:n.current,onSave:b,onClose:y,scrRef:t.scrRef??rt,editorOptions:p,localizedStrings:Vx})})]})]})},parameters:{docs:{description:{story:"This story demonstrates the use of the new footnote editor on the side of the  editorial component"}}},args:{defaultUsj:Rt,scrRef:rt,options:{hasExternalUI:!1,markerMenuTrigger:"\\"}}},di={render:(t,e)=>{var u,d,f,h;const r=_.useRef(null),[n,s]=_.useState(null),[i,o]=_.useState(!1),a=_.useMemo(()=>({...t.options??{},view:{markerMode:i?"visible":"hidden",hasSpacing:!0,isFormattedFont:!0}}),[t.options,i]);_.useEffect(()=>{var y,b;const p=(b=(y=r.current)==null?void 0:y.toolbarEndRef)==null?void 0:b.current;if(p)s(p);else{const S=window.setTimeout(()=>{var x,A;const C=(A=(x=r.current)==null?void 0:x.toolbarEndRef)==null?void 0:A.current;C&&s(C)},0);return()=>window.clearTimeout(S)}},[a]);const l=_.useCallback(()=>o(p=>!p),[]);return m.jsxs(xl,{viewMode:e.viewMode,description:((f=(d=(u=e.parameters)==null?void 0:u.docs)==null?void 0:d.description)==null?void 0:f.story)??((h=e.parameters)==null?void 0:h.description),children:[m.jsx(wn,{...t,options:a,ref:r}),n&&gt.createPortal(m.jsx("button",{type:"button",title:"Show/hide markers","aria-label":"Show/hide markers","aria-pressed":i,className:`toolbar-item ${i?"active":""}`,onClick:l,children:m.jsx("span",{className:"icon pilcrow-icon","aria-hidden":"true",children:""})}),n)]})},parameters:{docs:{description:{story:"This story demonstrates the Markers view, which shows USFM markers inline with the text. Click the **Show/hide markers** () button in the editor toolbar to toggle the Markers view on and off. "}}},args:{defaultUsj:Rt,scrRef:rt}},hi={name:"View Options",render:(t,e)=>Lr(t,e,rt),parameters:{docs:{description:{story:'Demonstrates the editor view options (marker visibility, spacing, and formatted font) using USX input. Below in the **Controls** tab, try changing the **options.view** values to see how they affect the editor display. Valid values for **markerMode** are _"hidden"_, _"visible"_, and _"editable"_. Valid values for **noteMode** are _"collapsed"_, _"expandInline"_, and _"expanded"_.'}}},args:{defaultUsj:Rt,options:{hasExternalUI:!0,view:{markerMode:"hidden",noteMode:"collapsed",hasSpacing:!0,isFormattedFont:!0}}}};var _u,ku,vu;ti.parameters={...ti.parameters,docs:{...(_u=ti.parameters)==null?void 0:_u.docs,source:{originalSource:`{
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef
  }
}`,...(vu=(ku=ti.parameters)==null?void 0:ku.docs)==null?void 0:vu.source}}};var wu,xu,Cu;ri.parameters={...ri.parameters,docs:{...(wu=ri.parameters)==null?void 0:wu.docs,source:{originalSource:`{
  args: {
    defaultUsj: usjEmpty,
    scrRef: defaultScrRef
  }
}`,...(Cu=(xu=ri.parameters)==null?void 0:xu.docs)==null?void 0:Cu.source}}};var Su,Eu,Tu;ni.parameters={...ni.parameters,docs:{...(Su=ni.parameters)==null?void 0:Su.docs,source:{originalSource:`{
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef,
    options: {
      isReadonly: true
    }
  }
}`,...(Tu=(Eu=ni.parameters)==null?void 0:Eu.docs)==null?void 0:Tu.source}}};var Mu,Au,Nu;si.parameters={...si.parameters,docs:{...(Mu=si.parameters)==null?void 0:Mu.docs,source:{originalSource:`{
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'Right-to-left example using a Hebrew snippet (Psalm 1:1). ' + 'The editor is set to RTL via _options.textDirection = "rtl"_. If you want the UI ' + '(tab toolbar) to be RTL click **Switch direction** in the Storybook toolbar.'
      }
    }
  },
  args: {
    defaultUsj: usjHebrew,
    options: {
      hasExternalUI: true,
      textDirection: 'rtl'
    }
  }
}`,...(Nu=(Au=si.parameters)==null?void 0:Au.docs)==null?void 0:Nu.source}}};var Ou,ju,Iu;ii.parameters={...ii.parameters,docs:{...(Ou=ii.parameters)==null?void 0:Ou.docs,source:{originalSource:`{
  render: args => {
    // eslint-disable-next-line no-null/no-null
    const editorRef = useRef<EditorRef | null>(null);
    useEffect(() => {
      const timeoutId = setTimeout(() => {
        if (editorRef.current) {
          editorRef.current.addAnnotation(annotationRangeWeb1, 'spelling', 'annotationId');
          editorRef.current.addAnnotation(annotationRangeWeb2, 'grammar', 'abc123');
        }
      }, 0);
      return () => clearTimeout(timeoutId);
    }, []);
    return <Editorial {...args} ref={editorRef} />;
  },
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef
  }
}`,...(Iu=(ju=ii.parameters)==null?void 0:ju.docs)==null?void 0:Iu.source}}};var Pu,Ru,$u;oi.parameters={...oi.parameters,docs:{...(Pu=oi.parameters)==null?void 0:Pu.docs,source:{originalSource:`{
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates editing notes inline. Move your cursor to a note caller and ' + 'the note will expand and can be edited. Move the cursor out of the note and it will ' + 'collapse. Click the expanded note caller to toggle between the auto-generated caller ' + 'and the hidden caller.'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    options: inlineNoteOptions
  }
}`,...($u=(Ru=oi.parameters)==null?void 0:Ru.docs)==null?void 0:$u.source}}};var qu,Lu,Du;ai.parameters={...ai.parameters,docs:{...(qu=ai.parameters)==null?void 0:qu.docs,source:{originalSource:`{
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates inserting notes. Use the Project menu (hamburger) or the ' + 'toolbar buttons above the editor to insert footnotes, cross-references, and endnotes ' + 'at the current cursor position. Selecting text before inserting a footnote will use ' + 'that text as the footnote quote. You can also insert by typing "\\\\f", "\\\\x", or "\\\\fe".'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    options: insertNoteOptions
  }
}`,...(Du=(Lu=ai.parameters)==null?void 0:Lu.docs)==null?void 0:Du.source}}};var Fu,Uu,Bu;li.parameters={...li.parameters,docs:{...(Fu=li.parameters)==null?void 0:Fu.docs,source:{originalSource:`{
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates custom note callers and click handling. **Try clicking on the ' + 'circled number footnote markers ( ) in the text to see the click handler in ' + 'action!** The click event will show an alert and log details to the browser console.'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    options: customNodeOptions
  }
}`,...(Bu=(Uu=li.parameters)==null?void 0:Uu.docs)==null?void 0:Bu.source}}};var Hu,Wu,zu;ci.parameters={...ci.parameters,docs:{...(Hu=ci.parameters)==null?void 0:Hu.docs,source:{originalSource:`{
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates using a custom marker menu trigger key. **Try typing "?" ' + '(question mark) anywhere in the editor text to open the marker menu!** The default ' + 'trigger is "\\\\\\\\" (backslash), but this story changes it to "?" for demonstration. ' + 'The marker menu allows you to insert USFM markers into the text.'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    options: {
      hasExternalUI: true,
      markerMenuTrigger: '?'
    }
  }
}`,...(zu=(Wu=ci.parameters)==null?void 0:Wu.docs)==null?void 0:zu.source}}};var Ju,Ku,Vu;ui.parameters={...ui.parameters,docs:{...(Ju=ui.parameters)==null?void 0:Ju.docs,source:{originalSource:`{
  render: args => {
    // eslint-disable-next-line no-null/no-null
    const editorRef = useRef<EditorRef | null>(null);
    const noteKey = useRef<string>();
    const noteOps = useRef<DeltaOpInsertNoteEmbed[]>();
    const [popoverX, setPopoverX] = useState<number>();
    const [popoverY, setPopoverY] = useState<number>();
    const [popoverHeight, setPopoverHeight] = useState<number>();
    const [showFootnoteEditor, setShowFootnoteEditor] = useState<boolean>();
    const viewOptions = useMemo<ViewOptions>(() => ({
      markerMode: 'hidden',
      noteMode: 'collapsed',
      hasSpacing: true,
      isFormattedFont: true
    }), []);
    const mergedOptions = useMemo<EditorOptions>(() => {
      const base = args.options ?? {};
      return {
        ...base,
        nodes: {
          noteCallerOnClick: (event, noteNodeKey, isCollapsed, _getCaller, _setCaller, getNoteOps) => {
            const targetRect = event.currentTarget.getBoundingClientRect();
            setPopoverX(targetRect.left);
            setPopoverY(targetRect.top);
            setPopoverHeight(targetRect.height);
            if (isCollapsed) {
              // (event as SyntheticEvent<)
              if (noteKey.current) return;

              // Makes sure the note op is the correct type and is defined
              const noteOp = getNoteOps()?.at(0);
              if (!noteOp || !isInsertEmbedOpOfType('note', noteOp)) return;
              noteKey.current = noteNodeKey;
              noteOps.current = [noteOp];
              setShowFootnoteEditor(true);
            }
          }
        },
        view: viewOptions
      };
    }, [args.options, viewOptions, noteKey]);
    const onEditorClose = () => {
      noteKey.current = undefined;
      noteOps.current = undefined;
      setShowFootnoteEditor(false);
    };
    const onEditorSave = (newNoteOps: DeltaOp[]) => {
      if (noteKey.current) {
        editorRef.current?.replaceEmbedUpdate(noteKey.current, newNoteOps);
      }
      onEditorClose();
    };
    return <div>
        <Editorial {...args} options={mergedOptions} ref={editorRef} onScrRefChange={() => undefined} />
        <Popover open={showFootnoteEditor}>
          <PopoverAnchor className="tw-absolute" style={{
          top: popoverY ?? 0,
          left: popoverX ?? 0,
          height: popoverHeight,
          width: 0
        }} />
          <PopoverContent className="tw-w-[500px] tw-p-[10px]">
            <FootnoteEditor noteKey={noteKey.current} noteOps={noteOps.current} onSave={onEditorSave} onClose={onEditorClose} scrRef={args.scrRef ?? defaultScrRef} editorOptions={mergedOptions} localizedStrings={sampleFootnoteEditorLocalizedStrings} />
          </PopoverContent>
        </Popover>
      </div>;
  },
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates the use of the new footnote editor on the side of the ' + ' editorial component'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef,
    options: {
      hasExternalUI: false,
      markerMenuTrigger: '\\\\'
    }
  }
}`,...(Vu=(Ku=ui.parameters)==null?void 0:Ku.docs)==null?void 0:Vu.source}}};var Gu,Yu,Xu;di.parameters={...di.parameters,docs:{...(Gu=di.parameters)==null?void 0:Gu.docs,source:{originalSource:`{
  render: (args, context) => {
    // eslint-disable-next-line no-null/no-null
    const editorRef = useRef<EditorRef | null>(null);
    // eslint-disable-next-line no-null/no-null
    const [toolbarEndEl, setToolbarEndEl] = useState<HTMLElement | null>(null);
    const [showMarkers, setShowMarkers] = useState(false);
    const mergedOptions = useMemo(() => {
      const base = args.options ?? {};
      const view: ViewOptions = {
        markerMode: showMarkers ? 'visible' : 'hidden',
        hasSpacing: true,
        isFormattedFont: true
      };
      return {
        ...base,
        view
      };
    }, [args.options, showMarkers]);
    useEffect(() => {
      const el = editorRef.current?.toolbarEndRef?.current;
      if (el) setToolbarEndEl(el);else {
        // Retry once on next tick in case the toolbar mounts after the ref effect
        const id = window.setTimeout(() => {
          const el2 = editorRef.current?.toolbarEndRef?.current;
          if (el2) setToolbarEndEl(el2);
        }, 0);
        return () => window.clearTimeout(id);
      }
      return undefined;
    }, [mergedOptions]);
    const handleShowMarkerToggle = useCallback(() => setShowMarkers(v => !v), []);
    return <CanvasWithDescription viewMode={context.viewMode} description={context.parameters?.docs?.description?.story ?? context.parameters?.description}>
        <Editorial {...args} options={mergedOptions} ref={editorRef} />
        {toolbarEndEl && createPortal(<button type="button" title="Show/hide markers" aria-label="Show/hide markers" aria-pressed={showMarkers} className={\`toolbar-item \${showMarkers ? 'active' : ''}\`} onClick={handleShowMarkerToggle}>
              <span className="icon pilcrow-icon" aria-hidden="true">
                
              </span>
            </button>, toolbarEndEl)}
      </CanvasWithDescription>;
  },
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates the Markers view, which shows USFM markers inline with the ' + 'text. Click the **Show/hide markers** () button in the editor toolbar to toggle the ' + 'Markers view on and off. '
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef
  }
}`,...(Xu=(Yu=di.parameters)==null?void 0:Yu.docs)==null?void 0:Xu.source}}};var Qu,Zu,ed;hi.parameters={...hi.parameters,docs:{...(Qu=hi.parameters)==null?void 0:Qu.docs,source:{originalSource:`{
  name: 'View Options',
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'Demonstrates the editor view options (marker visibility, spacing, and formatted font) ' + 'using USX input. Below in the **Controls** tab, try changing the **options.view** ' + 'values to see how they affect the editor display. Valid values for **markerMode** are ' + '_"hidden"_, _"visible"_, and _"editable"_. Valid values for **noteMode** are ' + '_"collapsed"_, _"expandInline"_, and _"expanded"_.'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    options: {
      hasExternalUI: true,
      view: {
        markerMode: 'hidden',
        noteMode: 'collapsed',
        hasSpacing: true,
        isFormattedFont: true
      }
    }
  }
}`,...(ed=(Zu=hi.parameters)==null?void 0:Zu.docs)==null?void 0:ed.source}}};const s0=["Default","Empty","ReadOnly","RTL","Annotated","InlineNoteEditing","InsertNote","CustomNoteOptions","CustomMarkerTrigger","FootnoteEditorView","MarkersView","ViewOptionsStory"];export{ii as Annotated,ci as CustomMarkerTrigger,li as CustomNoteOptions,ti as Default,ri as Empty,ui as FootnoteEditorView,oi as InlineNoteEditing,ai as InsertNote,di as MarkersView,si as RTL,ni as ReadOnly,hi as ViewOptionsStory,s0 as __namedExportsOrder,n0 as default};
