import{j as s}from"./jsx-runtime-CoJcBlqr.js";import{d as ce,A as _,e as Ne,a as ve,c as F,b as te,B as Te,f as Le}from"./book-item.utils-B3g7WYdO.js";import{B as U}from"./button-BOi5X0CC.js";import{e as S,d as ue,C as Ie,a as je,c as Oe}from"./command-CVOFFHX5.js";import{P as _e,a as Ee,b as De}from"./popover-Ctsr1WcE.js";import{r as n,a as Ae}from"./iframe-ChjBVkNN.js";import{c as Q}from"./shadcn-ui.util-DMJ19wEV.js";import{m as O}from"./index.es-D4jfZzAn.js";import{j as Me,V as x,O as re,I as Ve}from"./index-BYC3xje7.js";import{c as me}from"./createLucideIcon-CVIRtPIF.js";import{C as ne}from"./chevron-left-CSrm-Qxr.js";import{C as oe}from"./chevron-right-DW0kcE5l.js";import{A as qe,a as Pe}from"./arrow-right-C51dLHJc.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=[["path",{d:"m11 17-5-5 5-5",key:"13zhaf"}],["path",{d:"m18 17-5-5 5-5",key:"h8a8et"}]],se=me("ChevronsLeft",He);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=[["path",{d:"m6 17 5-5-5-5",key:"xnjwq"}],["path",{d:"m13 17 5-5-5-5",key:"17xmmf"}]],ae=me("ChevronsRight",$e),G={BOOK_ONLY:/^([^:\s]+(?:\s+[^:\s]+)*)$/i,BOOK_CHAPTER:/^([^:\s]+(?:\s+[^:\s]+)*)\s+(\d+)$/i,BOOK_CHAPTER_VERSE:/^([^:\s]+(?:\s+[^:\s]+)*)\s+(\d+):(\d*)$/i},Be=[G.BOOK_ONLY,G.BOOK_CHAPTER,G.BOOK_CHAPTER_VERSE];function ie(e){const r=/^[a-zA-Z]$/.test(e),h=/^[0-9]$/.test(e);return{isLetter:r,isDigit:h}}function T(e){return Me(O.bookIdToNumber(e))}function Ke(e,r,h){if(!e.trim()||r.length===0)return;const l=Be.reduce((i,d)=>{if(i)return i;const f=d.exec(e.trim());if(f){const[w,b=void 0,y=void 0]=f.slice(1);let m;const v=r.filter(u=>ce(u,w,h));if(v.length===1&&([m]=v),!m&&b){if(O.isBookIdValid(w)){const u=w.toUpperCase();r.includes(u)&&(m=u)}if(!m&&h){const u=Array.from(h.entries()).find(([,c])=>c.localizedId.toLowerCase()===w.toLowerCase());u&&r.includes(u[0])&&([m]=u)}}if(!m&&b){const c=(N=>Object.keys(_).find(g=>_[g].toLowerCase()===N.toLowerCase()))(w);if(c&&r.includes(c)&&(m=c),!m&&h){const N=Array.from(h.entries()).find(([,g])=>g.localizedName.toLowerCase()===w.toLowerCase());N&&r.includes(N[0])&&([m]=N)}}if(m){let u=b?parseInt(b,10):void 0;u&&u>T(m)&&(u=Math.max(T(m),1));const c=y?parseInt(y,10):void 0;return{book:m,chapterNum:u,verseNum:c}}}},void 0);if(l)return l}function Fe(e,r,h,l){const i=n.useCallback(()=>{if(e.chapterNum>1)l({book:e.book,chapterNum:e.chapterNum-1,verseNum:1});else{const b=r.indexOf(e.book);if(b>0){const y=r[b-1],m=Math.max(T(y),1);l({book:y,chapterNum:m,verseNum:1})}}},[e,r,l]),d=n.useCallback(()=>{const b=T(e.book);if(e.chapterNum<b)l({book:e.book,chapterNum:e.chapterNum+1,verseNum:1});else{const y=r.indexOf(e.book);if(y<r.length-1){const m=r[y+1];l({book:m,chapterNum:1,verseNum:1})}}},[e,r,l]),f=n.useCallback(()=>{l({book:e.book,chapterNum:e.chapterNum,verseNum:e.verseNum>1?e.verseNum-1:0})},[e,l]),w=n.useCallback(()=>{l({book:e.book,chapterNum:e.chapterNum,verseNum:e.verseNum+1})},[e,l]);return n.useMemo(()=>[{onClick:i,disabled:r.length===0||e.chapterNum===1&&r.indexOf(e.book)===0,title:"Previous chapter",icon:h==="ltr"?se:ae},{onClick:f,disabled:r.length===0||e.verseNum===0,title:"Previous verse",icon:h==="ltr"?ne:oe},{onClick:w,disabled:r.length===0,title:"Next verse",icon:h==="ltr"?oe:ne},{onClick:d,disabled:r.length===0||(e.chapterNum===T(e.book)||T(e.book)===-1)&&r.indexOf(e.book)===r.length-1,title:"Next chapter",icon:h==="ltr"?ae:se}],[e,r,h,i,f,w,d])}function Y({bookId:e,scrRef:r,onChapterSelect:h,setChapterRef:l,isChapterDimmed:i,className:d}){if(e)return s.jsx(S,{children:s.jsx("div",{className:Q("tw-grid tw-grid-cols-6 tw-gap-1",d),children:Array.from({length:T(e)},(f,w)=>w+1).map(f=>s.jsx(ue,{value:`${e} ${_[e]||""} ${f}`,onSelect:()=>h(f),ref:l(f),className:Q("tw-h-8 tw-w-8 tw-cursor-pointer tw-justify-center tw-rounded-md tw-text-center tw-text-sm",{"tw-bg-primary tw-text-primary-foreground":e===r.book&&f===r.chapterNum},{"tw-bg-muted/50 tw-text-muted-foreground/50":(i==null?void 0:i(f))??!1}),children:f},f))})})}Y.__docgenInfo={description:`Renders a grid of chapter numbers for a given book, with highlighting for the current chapter and
optional dimmed chapters based on state logic.`,methods:[],displayName:"ChapterGrid",props:{bookId:{required:!0,tsType:{name:"string"},description:"The book ID to render chapters for"},scrRef:{required:!0,tsType:{name:"signature",type:"object",raw:"{ book: string; chapterNum: number }",signature:{properties:[{key:"book",value:{name:"string",required:!0}},{key:"chapterNum",value:{name:"number",required:!0}}]}},description:"Current scripture reference for highlighting"},onChapterSelect:{required:!0,tsType:{name:"signature",type:"function",raw:"(chapter: number) => void",signature:{arguments:[{type:{name:"number"},name:"chapter"}],return:{name:"void"}}},description:"Callback when a chapter is selected"},setChapterRef:{required:!0,tsType:{name:"signature",type:"function",raw:"(chapter: number) => (element: HTMLDivElement | null) => void",signature:{arguments:[{type:{name:"number"},name:"chapter"}],return:{name:"signature",type:"function",raw:"(element: HTMLDivElement | null) => void",signature:{arguments:[{type:{name:"union",raw:"HTMLDivElement | null",elements:[{name:"HTMLDivElement"},{name:"null"}]},name:"element"}],return:{name:"void"}}}}},description:"Function to set chapter refs for keyboard navigation"},isChapterDimmed:{required:!1,tsType:{name:"signature",type:"function",raw:"(chapter: number) => boolean",signature:{arguments:[{type:{name:"number"},name:"chapter"}],return:{name:"boolean"}}},description:"Optional function to determine if a chapter should be dimmed"},className:{required:!1,tsType:{name:"string"},description:"Optional additional class name for styling"}}};function Ue({scrRef:e,handleSubmit:r,className:h,getActiveBookIds:l,localizedBookNames:i,localizedStrings:d}){const f=Ae(),[w,b]=n.useState(!1),[y,m]=n.useState(""),[v,u]=n.useState(""),[c,N]=n.useState("books"),[g,E]=n.useState(void 0),[pe,P]=n.useState(!1),H=n.useRef(void 0),j=n.useRef(void 0),D=n.useRef(void 0),$=n.useRef(void 0),B=n.useRef({}),A=n.useMemo(()=>l?l():Ne,[l]),M=n.useMemo(()=>({[x.OT]:A.filter(a=>O.isBookOT(a)),[x.NT]:A.filter(a=>O.isBookNT(a)),[x.DC]:A.filter(a=>O.isBookDC(a)),[x.Extra]:A.filter(a=>O.extraBooks().includes(a))}),[A]),K=n.useMemo(()=>Object.values(M).flat(),[M]),le=n.useMemo(()=>{if(!v.trim())return M;const t={[x.OT]:[],[x.NT]:[],[x.DC]:[],[x.Extra]:[]};return[x.OT,x.NT,x.DC,x.Extra].forEach(p=>{t[p]=M[p].filter(k=>ce(k,v,i))}),t},[M,v,i]),o=n.useMemo(()=>Ke(v,K,i),[v,K,i]),de=n.useCallback(()=>{o&&(r({book:o.book,chapterNum:o.chapterNum??1,verseNum:o.verseNum??1}),b(!1),u(""),m(""))},[r,o]),he=n.useCallback(t=>{if(T(t)<=1){r({book:t,chapterNum:1,verseNum:1}),b(!1),u("");return}E(t),N("chapters")},[r]),R=n.useCallback(t=>{const a=c==="chapters"?g:o==null?void 0:o.book;a&&(r({book:a,chapterNum:t,verseNum:1}),b(!1),N("books"),E(void 0),u(""))},[r,c,g,o]),fe=Fe(e,K,f,r),V=n.useCallback(()=>{N("books"),E(void 0),setTimeout(()=>{j.current&&j.current.focus()},0)},[]),ge=n.useCallback(t=>{if(!t&&c==="chapters"){V();return}b(t),t&&(N("books"),E(void 0),u(""))},[c,V]),{otLong:X,ntLong:Z,dcLong:J,extraLong:W}={otLong:d==null?void 0:d["%scripture_section_ot_long%"],ntLong:d==null?void 0:d["%scripture_section_nt_long%"],dcLong:d==null?void 0:d["%scripture_section_dc_long%"],extraLong:d==null?void 0:d["%scripture_section_extra_long%"]},we=n.useCallback(t=>ve(t,X,Z,J,W),[X,Z,J,W]),ke=n.useCallback(t=>o?!!o.chapterNum&&!t.toString().includes(o.chapterNum.toString()):!1,[o]),be=n.useMemo(()=>re(e,i?F(e.book,i):"English"),[e,i]),z=n.useCallback(t=>a=>{B.current[t]=a},[]),Ce=n.useCallback(t=>{(t.key==="Home"||t.key==="End")&&t.stopPropagation()},[]),ye=n.useCallback(t=>{if(t.ctrlKey)return;const{isLetter:a,isDigit:p}=ie(t.key);if(c==="chapters"){if(t.key==="Backspace"){t.preventDefault(),t.stopPropagation(),V();return}if(a||p){if(t.preventDefault(),t.stopPropagation(),N("books"),E(void 0),p&&g){const k=_[g];u(`${k} ${t.key}`)}else u(t.key);setTimeout(()=>{j.current&&j.current.focus()},0);return}}if((c==="chapters"||c==="books"&&o)&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(t.key)){const k=c==="chapters"?g:o==null?void 0:o.book;if(!k)return;const C=(()=>{if(!y)return 1;const q=y.match(/(\d+)$/);return q?parseInt(q[1],10):0})(),I=T(k);if(!I)return;let L=C;const ee=6;switch(t.key){case"ArrowLeft":C!==0&&(L=C>1?C-1:I);break;case"ArrowRight":C!==0&&(L=C<I?C+1:1);break;case"ArrowUp":L=C===0?I:Math.max(1,C-ee);break;case"ArrowDown":L=C===0?1:Math.min(I,C+ee);break;default:return}L!==C&&(t.preventDefault(),t.stopPropagation(),m(te(k,i,L)),setTimeout(()=>{const q=B.current[L];q&&q.scrollIntoView({block:"nearest",behavior:"smooth"})},0))}},[c,o,V,g,y,i]),xe=n.useCallback(t=>{if(t.shiftKey||t.key==="Tab"||t.key===" ")return;const{isLetter:a,isDigit:p}=ie(t.key);(a||p)&&(t.preventDefault(),u(k=>k+t.key),j.current.focus(),P(!1))},[]);return n.useLayoutEffect(()=>{const t=setTimeout(()=>{if(w&&c==="books"&&D.current&&$.current){const a=D.current,p=$.current,k=p.offsetTop,C=a.clientHeight,I=p.clientHeight,L=k-C/2+I/2;a.scrollTo({top:Math.max(0,L),behavior:"smooth"}),m(te(e.book))}},0);return()=>{clearTimeout(t)}},[w,c,v,o,e.book]),n.useLayoutEffect(()=>{if(c==="chapters"&&g){const t=g===e.book;setTimeout(()=>{if(D.current)if(t){const a=B.current[e.chapterNum];a&&a.scrollIntoView({block:"center",behavior:"smooth"})}else D.current.scrollTo({top:0});H.current&&H.current.focus()},0)}},[c,g,o,e.book,e.chapterNum]),s.jsxs(_e,{open:w,onOpenChange:ge,children:[s.jsx(Ee,{asChild:!0,children:s.jsx(U,{"aria-label":"book-chapter-trigger",variant:"outline",role:"combobox","aria-expanded":w,className:Q("tw-h-8 tw-w-full tw-min-w-16 tw-max-w-48 tw-overflow-hidden tw-px-1",h),children:s.jsx("span",{className:"tw-truncate",children:be})})}),s.jsx(De,{forceMount:!0,className:"tw-w-[280px] tw-p-0",align:"center",children:s.jsxs(Ie,{ref:H,onKeyDown:ye,loop:!0,value:y,onValueChange:m,shouldFilter:!1,children:[c==="books"?s.jsxs("div",{className:"tw-flex tw-items-end",children:[s.jsx(je,{ref:j,value:v,onValueChange:u,onKeyDown:Ce,onFocus:()=>P(!1)}),s.jsx("div",{className:"tw-flex tw-items-center tw-gap-1 tw-border-b tw-pe-2",children:fe.map(({onClick:t,disabled:a,title:p,icon:k})=>s.jsx(U,{variant:"ghost",size:"sm",onClick:()=>{P(!0),t()},disabled:a,className:"tw-h-10 tw-w-4 tw-p-0",title:p,onKeyDown:xe,children:s.jsx(k,{})},p))})]}):s.jsxs("div",{className:"tw-flex tw-items-center tw-border-b tw-px-3 tw-py-2",children:[s.jsx(U,{variant:"ghost",size:"sm",onClick:V,className:"tw-mr-2 tw-h-6 tw-w-6 tw-p-0",tabIndex:-1,children:f==="ltr"?s.jsx(qe,{className:"tw-h-4 tw-w-4"}):s.jsx(Pe,{className:"tw-h-4 tw-w-4"})}),g&&s.jsx("span",{tabIndex:-1,className:"tw-text-sm tw-font-medium",children:F(g,i)})]}),!pe&&s.jsxs(Oe,{ref:D,children:[c==="books"&&s.jsxs(s.Fragment,{children:[!o&&Object.entries(le).map(([t,a])=>{if(a.length!==0)return s.jsx(S,{heading:we(t),children:a.map(p=>s.jsx(Te,{bookId:p,onSelect:k=>he(k),section:Ve(p),commandValue:`${p} ${_[p]}`,ref:p===e.book?$:void 0,localizedBookNames:i},p))},t)}),o&&s.jsx(S,{children:s.jsx(ue,{value:`${o.book} ${_[o.book]} ${o.chapterNum||""}:${o.verseNum||""})}`,onSelect:de,className:"tw-font-semibold tw-text-primary",children:re({book:o.book,chapterNum:o.chapterNum??1,verseNum:o.verseNum??1},i?Le(o.book,i):void 0)},"top-match")}),o&&T(o.book)>1&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"tw-mb-2 tw-px-3 tw-text-sm tw-font-medium tw-text-muted-foreground",children:F(o.book,i)}),s.jsx(Y,{bookId:o.book,scrRef:e,onChapterSelect:R,setChapterRef:z,isChapterDimmed:ke,className:"tw-px-4 tw-pb-4"})]})]}),c==="chapters"&&g&&s.jsx(Y,{bookId:g,scrRef:e,onChapterSelect:R,setChapterRef:z,className:"tw-p-4"})]})]})})]})}Ue.__docgenInfo={description:`\`BookChapterControl\` is a component that provides an interactive UI for selecting book chapters.
It allows users to input a search query to find specific books and chapters, navigate through
options with keyboard interactions, and submit selections. The component handles various
interactions such as opening and closing the dropdown menu, filtering book lists based on search
input, and managing highlighted selections. It also integrates with external handlers for
submitting selected references and retrieving active book IDs.`,methods:[],displayName:"BookChapterControl",props:{scrRef:{required:!0,tsType:{name:"SerializedVerseRef"},description:"The current scripture reference"},handleSubmit:{required:!0,tsType:{name:"signature",type:"function",raw:"(scrRef: SerializedVerseRef) => void",signature:{arguments:[{type:{name:"SerializedVerseRef"},name:"scrRef"}],return:{name:"void"}}},description:"Callback to handle the submission of a selected reference"},className:{required:!1,tsType:{name:"string"},description:"Optional additional class name for styling"},getActiveBookIds:{required:!1,tsType:{name:"signature",type:"function",raw:"() => string[]",signature:{arguments:[],return:{name:"Array",elements:[{name:"string"}],raw:"string[]"}}},description:"Callback to retrieve book IDs that are available in the current context"},localizedBookNames:{required:!1,tsType:{name:"Map",elements:[{name:"string"},{name:"signature",type:"object",raw:"{ localizedId: string; localizedName: string }",signature:{properties:[{key:"localizedId",value:{name:"string",required:!0}},{key:"localizedName",value:{name:"string",required:!0}}]}}],raw:"Map<string, { localizedId: string; localizedName: string }>"},description:`Optional map of localized book IDs/short names and full names. The key is the standard book ID
(e.g., "2CH"), the value contains a localized version of the ID and related book name (e.g. {
localizedId: '2CR', localizedName: '2 Crónicas' })`},localizedStrings:{required:!1,tsType:{name:"LanguageStrings"},description:"Optional localized strings for the component"}}};export{Ue as B};
