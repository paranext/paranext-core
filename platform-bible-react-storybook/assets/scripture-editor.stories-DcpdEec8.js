var Hf=Object.defineProperty;var Wf=(t,e,n)=>e in t?Hf(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var sn=(t,e,n)=>Wf(t,typeof e!="symbol"?e+"":e,n);import{j as m}from"./jsx-runtime-B0mj53Uj.js";import{c as ln,g as Kf,r as b}from"./iframe-9Zhl2CkU.js";import{H as ed,m as at,V as zf,T as ss,O as is,w as Jf,L as Vf,I as Gf,D as Da}from"./index-DHHh0bqX.js";import{C as yn,l as Et,d as td,y as X,e as Ie,u as hi,g as Yf,L as re,N as Dt,w as Xf,h as jl,W as Zr,S as we,k as ee,I as Zf,U as Xe,o as ce,p as zr,q as Jr,s as nd,K as xe,J as rd,t as La,A as aa,v as Fa,z as Qf,B as sd,F as ep,G as id,H as tp,M as np,O as od,Q as rp,R as sp,T as ip,V as op,Y as ap,Z as _r,a0 as qa,a1 as ad,a2 as lp,a3 as ld,a4 as cp,a5 as up,a6 as dp,a7 as cd,a8 as Li,a9 as ud,aa as Nl,ab as hp,ac as Fi,ad as qi,ae as fp,af as pp,ag as Il,ah as gp,ai as Lo,aj as mp,ak as yp,al as Rl,am as Pl,an as bp,ao as _p,ap as kp,aq as vp,ar as wp,as as xp,at as Cp,au as Sp,av as Tp,aw as Ep,ax as Op,ay as Mp,az as Ua,aA as Ap,aB as dd,aC as jp,f as hd,D as Ba,a as Np,n as fd,x as pd,aD as Te,aE as kr,aF as gd,aG as $l,aH as vr,aI as bn,X as jt,aJ as vi,i as ms,aK as la,aL as _e,aM as fi,aN as Ui,aO as Ip,aP as Rp,aQ as Pp,aR as md,aS as yd,aT as Ha,aU as Mt,aV as $p,aW as ys,aX as Dl,aY as Dp,aZ as Lp,a_ as Fp,a$ as qp,c as Up,b as Bp,r as Hp}from"./LexicalTable.prod-CkmWXpv9.js";import{d as Kt,Q as Wp}from"./index-CcmwSDMt.js";import{r as At}from"./index-zIv3hLbJ.js";import{c as Kp,d as zp,e as Jp,g as Vp}from"./floating-ui.react-dom-CwX0otsg.js";import{M as Gp}from"./markdown-renderer.component-BKPRO6An.js";import{C as Yp,a as Xp,b as Zp,d as Qp}from"./card-BzEHiwLG.js";import{B as eg}from"./book-chapter-control.component-B1DEs-b5.js";import{T as tg}from"./tab-toolbar.component-BbEN8CjI.js";import{B as mt}from"./button-SlL39imj.js";import{D as Wa,a as Ka,b as za,c as ng,j as bd,e as _d,l as sr}from"./dropdown-menu-CvZWwXV0.js";import{C as rg}from"./chevron-down-XeoIgwTY.js";import{c as rt}from"./createLucideIcon-D4vYydla.js";import{F as Bt}from"./file-text-DM0GzBz2.js";import{a as Qr,T as es,b as pi,c as ts,d as sg}from"./tooltip-6RIbarFp.js";import{I as ig}from"./input-Dcoe_3fh.js";import{X as og}from"./x-BlhA8cFy.js";import{C as ag}from"./check-D2EzCwfD.js";import{C as lg}from"./copy-CkcWm0_V.js";import{P as cg,c as ug,b as dg}from"./popover-egnr3aGi.js";import"./preload-helper-CTOgD26E.js";import"./index-Bl2C2VvJ.js";import"./index-eZTIp-nj.js";import"./shadcn-ui.util-DMJ19wEV.js";import"./book-item.utils-FEeHXR9m.js";import"./command-BTaRZS91.js";import"./index-DxfOTCbt.js";import"./index-Cn-FdYao.js";import"./index-Dj-VCL0K.js";import"./index-Ch6-ikge.js";import"./index-BcL1YFU6.js";import"./index-CGUQXvUO.js";import"./index-BUTdLPnK.js";import"./index-BtLdhcm0.js";import"./index-CO0yGGT5.js";import"./index-BxWNdA6r.js";import"./index-CMl0rFGz.js";import"./dialog-BYDdLLMh.js";import"./search-BAf8WBf6.js";import"./chevron-left-fau3fR-F.js";import"./chevron-right-C-RcsKXv.js";import"./arrow-right-C-QRwl_B.js";import"./tab-dropdown-menu.component-BRyhfMsz.js";import"./menu.util-Dxh7JGT4.js";import"./menu-icon.component-CMr2dUHq.js";import"./tab-toolbar-container.component-B_qDyxHp.js";import"./index-BPbCuWFR.js";import"./index-Cit3Y4jb.js";import"./index-DTAXz6r9.js";import"./index-BSPEc8l8.js";import"./index-BWKubMEI.js";import"./index-D-ktTNAQ.js";import"./index-w3Oj2mU8.js";import"./index-CaWqlVwm.js";import"./index-D5gf-719.js";import"./index-BLg3_FZ3.js";import"./index-DyBgsuyh.js";import"./circle-DN9IQ6fZ.js";import"./index-BmiXKKsm.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hg=[["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 18h18",key:"1h113x"}],["path",{d:"M3 6h18",key:"d0wm0j"}]],Hs=rt("AlignJustify",hg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fg=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]],pg=rt("Ban",fg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gg=[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"m17 12 3-2v8",key:"1hhhft"}]],tr=rt("Heading1",gg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mg=[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M21 18h-4c0-4 4-3 4-6 0-1.5-2-2.5-4-1",key:"9jr5yi"}]],Ll=rt("Heading2",mg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yg=[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M17.5 10.5c1.7-1 3.5 0 3.5 1.5a2 2 0 0 1-2 2",key:"68ncm8"}],["path",{d:"M17 17.5c2 1.5 4 .3 4-1.5a2 2 0 0 0-2-2",key:"1ejuhz"}]],Fo=rt("Heading3",yg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bg=[["path",{d:"M16 12H3",key:"1a2rj7"}],["path",{d:"M16 6H3",key:"1wxfjs"}],["path",{d:"M10 18H3",key:"13769t"}],["path",{d:"M21 6v10a2 2 0 0 1-2 2h-5",key:"ilrcs8"}],["path",{d:"m16 16-2 2 2 2",key:"kkc6pm"}]],_g=rt("ListEnd",bg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kg=[["path",{d:"M21 7v6h-6",key:"3ptur4"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7",key:"1kgawr"}]],vg=rt("Redo",kg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wg=[["path",{d:"m18 14 4 4-4 4",key:"10pe0f"}],["path",{d:"m18 2 4 4-4 4",key:"pucp1d"}],["path",{d:"M2 18h1.973a4 4 0 0 0 3.3-1.7l5.454-8.6a4 4 0 0 1 3.3-1.7H22",key:"1ailkh"}],["path",{d:"M2 6h1.972a4 4 0 0 1 3.6 2.2",key:"km57vx"}],["path",{d:"M22 18h-6.041a4 4 0 0 1-3.3-1.8l-.359-.45",key:"os18l9"}]],xg=rt("Shuffle",wg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cg=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"M9 17c2 0 2.8-1 2.8-2.8V10c0-2 1-3.3 3.2-3",key:"m1af9g"}],["path",{d:"M9 11.2h5.7",key:"3zgcl2"}]],kd=rt("SquareFunction",Cg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sg=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M16 8.9V7H8l4 5-4 5h8v-1.9",key:"9nih0i"}]],vd=rt("SquareSigma",Sg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tg=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],wd=rt("SquareX",Tg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Eg=[["path",{d:"m4 19 8-8",key:"hr47gm"}],["path",{d:"m12 19-8-8",key:"1dhhmo"}],["path",{d:"M20 12h-4c0-1.5.442-2 1.5-2.5S20 8.334 20 7.002c0-.472-.17-.93-.484-1.29a2.105 2.105 0 0 0-2.617-.436c-.42.239-.738.614-.899 1.06",key:"1dfcux"}]],Og=rt("Superscript",Eg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mg=[["path",{d:"M17 6H3",key:"16j9eg"}],["path",{d:"M21 12H8",key:"scolzb"}],["path",{d:"M21 18H8",key:"1wfozv"}],["path",{d:"M3 12v6",key:"fv4c87"}]],qo=rt("TextQuote",Mg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ag=[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]],jg=rt("Undo",Ag);var Ws={exports:{}},Uo,Fl;function Ng(){if(Fl)return Uo;Fl=1;var t=-1,e=1,n=0;function r(_,j,x,P,E){if(_===j)return _?[[n,_]]:[];if(x!=null){var A=H(_,j,x);if(A)return A}var N=a(_,j),L=_.substring(0,N);_=_.substring(N),j=j.substring(N),N=u(_,j);var U=_.substring(_.length-N);_=_.substring(0,_.length-N),j=j.substring(0,j.length-N);var B=s(_,j);return L&&B.unshift([n,L]),U&&B.push([n,U]),v(B,E),P&&f(B),B}function s(_,j){var x;if(!_)return[[e,j]];if(!j)return[[t,_]];var P=_.length>j.length?_:j,E=_.length>j.length?j:_,A=P.indexOf(E);if(A!==-1)return x=[[e,P.substring(0,A)],[n,E],[e,P.substring(A+E.length)]],_.length>j.length&&(x[0][0]=x[2][0]=t),x;if(E.length===1)return[[t,_],[e,j]];var N=d(_,j);if(N){var L=N[0],U=N[1],B=N[2],J=N[3],z=N[4],Y=r(L,B),ne=r(U,J);return Y.concat([[n,z]],ne)}return i(_,j)}function i(_,j){for(var x=_.length,P=j.length,E=Math.ceil((x+P)/2),A=E,N=2*E,L=new Array(N),U=new Array(N),B=0;B<N;B++)L[B]=-1,U[B]=-1;L[A+1]=0,U[A+1]=0;for(var J=x-P,z=J%2!==0,Y=0,ne=0,V=0,ue=0,ye=0;ye<E;ye++){for(var te=-ye+Y;te<=ye-ne;te+=2){var se=A+te,ie;te===-ye||te!==ye&&L[se-1]<L[se+1]?ie=L[se+1]:ie=L[se-1]+1;for(var de=ie-te;ie<x&&de<P&&_.charAt(ie)===j.charAt(de);)ie++,de++;if(L[se]=ie,ie>x)ne+=2;else if(de>P)Y+=2;else if(z){var fe=A+J-te;if(fe>=0&&fe<N&&U[fe]!==-1){var ge=x-U[fe];if(ie>=ge)return o(_,j,ie,de)}}}for(var Oe=-ye+V;Oe<=ye-ue;Oe+=2){var fe=A+Oe,ge;Oe===-ye||Oe!==ye&&U[fe-1]<U[fe+1]?ge=U[fe+1]:ge=U[fe-1]+1;for(var Ue=ge-Oe;ge<x&&Ue<P&&_.charAt(x-ge-1)===j.charAt(P-Ue-1);)ge++,Ue++;if(U[fe]=ge,ge>x)ue+=2;else if(Ue>P)V+=2;else if(!z){var se=A+J-Oe;if(se>=0&&se<N&&L[se]!==-1){var ie=L[se],de=A+ie-se;if(ge=x-ge,ie>=ge)return o(_,j,ie,de)}}}}return[[t,_],[e,j]]}function o(_,j,x,P){var E=_.substring(0,x),A=j.substring(0,P),N=_.substring(x),L=j.substring(P),U=r(E,A),B=r(N,L);return U.concat(B)}function a(_,j){if(!_||!j||_.charAt(0)!==j.charAt(0))return 0;for(var x=0,P=Math.min(_.length,j.length),E=P,A=0;x<E;)_.substring(A,E)==j.substring(A,E)?(x=E,A=x):P=E,E=Math.floor((P-x)/2+x);return O(_.charCodeAt(E-1))&&E--,E}function l(_,j){var x=_.length,P=j.length;if(x==0||P==0)return 0;x>P?_=_.substring(x-P):x<P&&(j=j.substring(0,x));var E=Math.min(x,P);if(_==j)return E;for(var A=0,N=1;;){var L=_.substring(E-N),U=j.indexOf(L);if(U==-1)return A;N+=U,(U==0||_.substring(E-N)==j.substring(0,N))&&(A=N,N++)}}function u(_,j){if(!_||!j||_.slice(-1)!==j.slice(-1))return 0;for(var x=0,P=Math.min(_.length,j.length),E=P,A=0;x<E;)_.substring(_.length-E,_.length-A)==j.substring(j.length-E,j.length-A)?(x=E,A=x):P=E,E=Math.floor((P-x)/2+x);return I(_.charCodeAt(_.length-E))&&E--,E}function d(_,j){var x=_.length>j.length?_:j,P=_.length>j.length?j:_;if(x.length<4||P.length*2<x.length)return null;function E(ne,V,ue){for(var ye=ne.substring(ue,ue+Math.floor(ne.length/4)),te=-1,se="",ie,de,fe,ge;(te=V.indexOf(ye,te+1))!==-1;){var Oe=a(ne.substring(ue),V.substring(te)),Ue=u(ne.substring(0,ue),V.substring(0,te));se.length<Ue+Oe&&(se=V.substring(te-Ue,te)+V.substring(te,te+Oe),ie=ne.substring(0,ue-Ue),de=ne.substring(ue+Oe),fe=V.substring(0,te-Ue),ge=V.substring(te+Oe))}return se.length*2>=ne.length?[ie,de,fe,ge,se]:null}var A=E(x,P,Math.ceil(x.length/4)),N=E(x,P,Math.ceil(x.length/2)),L;if(!A&&!N)return null;N?A?L=A[4].length>N[4].length?A:N:L=N:L=A;var U,B,J,z;_.length>j.length?(U=L[0],B=L[1],J=L[2],z=L[3]):(J=L[0],z=L[1],U=L[2],B=L[3]);var Y=L[4];return[U,B,J,z,Y]}function f(_){for(var j=!1,x=[],P=0,E=null,A=0,N=0,L=0,U=0,B=0;A<_.length;)_[A][0]==n?(x[P++]=A,N=U,L=B,U=0,B=0,E=_[A][1]):(_[A][0]==e?U+=_[A][1].length:B+=_[A][1].length,E&&E.length<=Math.max(N,L)&&E.length<=Math.max(U,B)&&(_.splice(x[P-1],0,[t,E]),_[x[P-1]+1][0]=e,P--,P--,A=P>0?x[P-1]:-1,N=0,L=0,U=0,B=0,E=null,j=!0)),A++;for(j&&v(_),M(_),A=1;A<_.length;){if(_[A-1][0]==t&&_[A][0]==e){var J=_[A-1][1],z=_[A][1],Y=l(J,z),ne=l(z,J);Y>=ne?(Y>=J.length/2||Y>=z.length/2)&&(_.splice(A,0,[n,z.substring(0,Y)]),_[A-1][1]=J.substring(0,J.length-Y),_[A+1][1]=z.substring(Y),A++):(ne>=J.length/2||ne>=z.length/2)&&(_.splice(A,0,[n,J.substring(0,ne)]),_[A-1][0]=e,_[A-1][1]=z.substring(0,z.length-ne),_[A+1][0]=t,_[A+1][1]=J.substring(ne),A++),A++}A++}}var h=/[^a-zA-Z0-9]/,p=/\s/,y=/[\r\n]/,k=/\n\r?\n$/,C=/^\r?\n\r?\n/;function M(_){function j(ne,V){if(!ne||!V)return 6;var ue=ne.charAt(ne.length-1),ye=V.charAt(0),te=ue.match(h),se=ye.match(h),ie=te&&ue.match(p),de=se&&ye.match(p),fe=ie&&ue.match(y),ge=de&&ye.match(y),Oe=fe&&ne.match(k),Ue=ge&&V.match(C);return Oe||Ue?5:fe||ge?4:te&&!ie&&de?3:ie||de?2:te||se?1:0}for(var x=1;x<_.length-1;){if(_[x-1][0]==n&&_[x+1][0]==n){var P=_[x-1][1],E=_[x][1],A=_[x+1][1],N=u(P,E);if(N){var L=E.substring(E.length-N);P=P.substring(0,P.length-N),E=L+E.substring(0,E.length-N),A=L+A}for(var U=P,B=E,J=A,z=j(P,E)+j(E,A);E.charAt(0)===A.charAt(0);){P+=E.charAt(0),E=E.substring(1)+A.charAt(0),A=A.substring(1);var Y=j(P,E)+j(E,A);Y>=z&&(z=Y,U=P,B=E,J=A)}_[x-1][1]!=U&&(U?_[x-1][1]=U:(_.splice(x-1,1),x--),_[x][1]=B,J?_[x+1][1]=J:(_.splice(x+1,1),x--))}x++}}function v(_,j){_.push([n,""]);for(var x=0,P=0,E=0,A="",N="",L;x<_.length;){if(x<_.length-1&&!_[x][1]){_.splice(x,1);continue}switch(_[x][0]){case e:E++,N+=_[x][1],x++;break;case t:P++,A+=_[x][1],x++;break;case n:var U=x-E-P-1;if(j){if(U>=0&&q(_[U][1])){var B=_[U][1].slice(-1);if(_[U][1]=_[U][1].slice(0,-1),A=B+A,N=B+N,!_[U][1]){_.splice(U,1),x--;var J=U-1;_[J]&&_[J][0]===e&&(E++,N=_[J][1]+N,J--),_[J]&&_[J][0]===t&&(P++,A=_[J][1]+A,J--),U=J}}if(D(_[x][1])){var B=_[x][1].charAt(0);_[x][1]=_[x][1].slice(1),A+=B,N+=B}}if(x<_.length-1&&!_[x][1]){_.splice(x,1);break}if(A.length>0||N.length>0){A.length>0&&N.length>0&&(L=a(N,A),L!==0&&(U>=0?_[U][1]+=N.substring(0,L):(_.splice(0,0,[n,N.substring(0,L)]),x++),N=N.substring(L),A=A.substring(L)),L=u(N,A),L!==0&&(_[x][1]=N.substring(N.length-L)+_[x][1],N=N.substring(0,N.length-L),A=A.substring(0,A.length-L)));var z=E+P;A.length===0&&N.length===0?(_.splice(x-z,z),x=x-z):A.length===0?(_.splice(x-z,z,[e,N]),x=x-z+1):N.length===0?(_.splice(x-z,z,[t,A]),x=x-z+1):(_.splice(x-z,z,[t,A],[e,N]),x=x-z+2)}x!==0&&_[x-1][0]===n?(_[x-1][1]+=_[x][1],_.splice(x,1)):x++,E=0,P=0,A="",N="";break}}_[_.length-1][1]===""&&_.pop();var Y=!1;for(x=1;x<_.length-1;)_[x-1][0]===n&&_[x+1][0]===n&&(_[x][1].substring(_[x][1].length-_[x-1][1].length)===_[x-1][1]?(_[x][1]=_[x-1][1]+_[x][1].substring(0,_[x][1].length-_[x-1][1].length),_[x+1][1]=_[x-1][1]+_[x+1][1],_.splice(x-1,1),Y=!0):_[x][1].substring(0,_[x+1][1].length)==_[x+1][1]&&(_[x-1][1]+=_[x+1][1],_[x][1]=_[x][1].substring(_[x+1][1].length)+_[x+1][1],_.splice(x+1,1),Y=!0)),x++;Y&&v(_,j)}function O(_){return _>=55296&&_<=56319}function I(_){return _>=56320&&_<=57343}function D(_){return I(_.charCodeAt(0))}function q(_){return O(_.charCodeAt(_.length-1))}function F(_){for(var j=[],x=0;x<_.length;x++)_[x][1].length>0&&j.push(_[x]);return j}function $(_,j,x,P){return q(_)||D(P)?null:F([[n,_],[t,j],[e,x],[n,P]])}function H(_,j,x){var P=typeof x=="number"?{index:x,length:0}:x.oldRange,E=typeof x=="number"?null:x.newRange,A=_.length,N=j.length;if(P.length===0&&(E===null||E.length===0)){var L=P.index,U=_.slice(0,L),B=_.slice(L),J=E?E.index:null;e:{var z=L+N-A;if(J!==null&&J!==z||z<0||z>N)break e;var Y=j.slice(0,z),ne=j.slice(z);if(ne!==B)break e;var V=Math.min(L,z),ue=U.slice(0,V),ye=Y.slice(0,V);if(ue!==ye)break e;var te=U.slice(V),se=Y.slice(V);return $(ue,te,se,B)}e:{if(J!==null&&J!==L)break e;var ie=L,Y=j.slice(0,ie),ne=j.slice(ie);if(Y!==U)break e;var de=Math.min(A-ie,N-ie),fe=B.slice(B.length-de),ge=ne.slice(ne.length-de);if(fe!==ge)break e;var te=B.slice(0,B.length-de),se=ne.slice(0,ne.length-de);return $(U,te,se,fe)}}if(P.length>0&&E&&E.length===0)e:{var ue=_.slice(0,P.index),fe=_.slice(P.index+P.length),V=ue.length,de=fe.length;if(N<V+de)break e;var ye=j.slice(0,V),ge=j.slice(N-de);if(ue!==ye||fe!==ge)break e;var te=_.slice(V,A-de),se=j.slice(V,N-de);return $(ue,te,se,fe)}return null}function W(_,j,x,P){return r(_,j,x,P,!0)}return W.INSERT=e,W.DELETE=t,W.EQUAL=n,Uo=W,Uo}var Vr={exports:{}};Vr.exports;var ql;function xd(){return ql||(ql=1,function(t,e){var n=200,r="__lodash_hash_undefined__",s=9007199254740991,i="[object Arguments]",o="[object Array]",a="[object Boolean]",l="[object Date]",u="[object Error]",d="[object Function]",f="[object GeneratorFunction]",h="[object Map]",p="[object Number]",y="[object Object]",k="[object Promise]",C="[object RegExp]",M="[object Set]",v="[object String]",O="[object Symbol]",I="[object WeakMap]",D="[object ArrayBuffer]",q="[object DataView]",F="[object Float32Array]",$="[object Float64Array]",H="[object Int8Array]",W="[object Int16Array]",_="[object Int32Array]",j="[object Uint8Array]",x="[object Uint8ClampedArray]",P="[object Uint16Array]",E="[object Uint32Array]",A=/[\\^$.*+?()[\]{}|]/g,N=/\w*$/,L=/^\[object .+?Constructor\]$/,U=/^(?:0|[1-9]\d*)$/,B={};B[i]=B[o]=B[D]=B[q]=B[a]=B[l]=B[F]=B[$]=B[H]=B[W]=B[_]=B[h]=B[p]=B[y]=B[C]=B[M]=B[v]=B[O]=B[j]=B[x]=B[P]=B[E]=!0,B[u]=B[d]=B[I]=!1;var J=typeof ln=="object"&&ln&&ln.Object===Object&&ln,z=typeof self=="object"&&self&&self.Object===Object&&self,Y=J||z||Function("return this")(),ne=e&&!e.nodeType&&e,V=ne&&!0&&t&&!t.nodeType&&t,ue=V&&V.exports===ne;function ye(c,g){return c.set(g[0],g[1]),c}function te(c,g){return c.add(g),c}function se(c,g){for(var w=-1,R=c?c.length:0;++w<R&&g(c[w],w,c)!==!1;);return c}function ie(c,g){for(var w=-1,R=g.length,Q=c.length;++w<R;)c[Q+w]=g[w];return c}function de(c,g,w,R){for(var Q=-1,G=c?c.length:0;++Q<G;)w=g(w,c[Q],Q,c);return w}function fe(c,g){for(var w=-1,R=Array(c);++w<c;)R[w]=g(w);return R}function ge(c,g){return c==null?void 0:c[g]}function Oe(c){var g=!1;if(c!=null&&typeof c.toString!="function")try{g=!!(c+"")}catch{}return g}function Ue(c){var g=-1,w=Array(c.size);return c.forEach(function(R,Q){w[++g]=[Q,R]}),w}function Mr(c,g){return function(w){return c(g(w))}}function Cs(c){var g=-1,w=Array(c.size);return c.forEach(function(R){w[++g]=R}),w}var Yi=Array.prototype,Xi=Function.prototype,Wn=Object.prototype,Ar=Y["__core-js_shared__"],Ss=function(){var c=/[^.]+$/.exec(Ar&&Ar.keys&&Ar.keys.IE_PROTO||"");return c?"Symbol(src)_1."+c:""}(),Ts=Xi.toString,wt=Wn.hasOwnProperty,Kn=Wn.toString,Zi=RegExp("^"+Ts.call(wt).replace(A,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),xn=ue?Y.Buffer:void 0,zn=Y.Symbol,jr=Y.Uint8Array,ot=Mr(Object.getPrototypeOf,Object),Es=Object.create,Os=Wn.propertyIsEnumerable,Qi=Yi.splice,Nr=Object.getOwnPropertySymbols,Jn=xn?xn.isBuffer:void 0,Ms=Mr(Object.keys,Object),Vn=pt(Y,"DataView"),Cn=pt(Y,"Map"),ft=pt(Y,"Promise"),Gn=pt(Y,"Set"),Ir=pt(Y,"WeakMap"),Sn=pt(Object,"create"),Rr=Ve(Vn),Tn=Ve(Cn),Pr=Ve(ft),$r=Ve(Gn),Dr=Ve(Ir),nn=zn?zn.prototype:void 0,As=nn?nn.valueOf:void 0;function Lt(c){var g=-1,w=c?c.length:0;for(this.clear();++g<w;){var R=c[g];this.set(R[0],R[1])}}function eo(){this.__data__=Sn?Sn(null):{}}function to(c){return this.has(c)&&delete this.__data__[c]}function no(c){var g=this.__data__;if(Sn){var w=g[c];return w===r?void 0:w}return wt.call(g,c)?g[c]:void 0}function js(c){var g=this.__data__;return Sn?g[c]!==void 0:wt.call(g,c)}function Lr(c,g){var w=this.__data__;return w[c]=Sn&&g===void 0?r:g,this}Lt.prototype.clear=eo,Lt.prototype.delete=to,Lt.prototype.get=no,Lt.prototype.has=js,Lt.prototype.set=Lr;function De(c){var g=-1,w=c?c.length:0;for(this.clear();++g<w;){var R=c[g];this.set(R[0],R[1])}}function ro(){this.__data__=[]}function so(c){var g=this.__data__,w=Xn(g,c);if(w<0)return!1;var R=g.length-1;return w==R?g.pop():Qi.call(g,w,1),!0}function io(c){var g=this.__data__,w=Xn(g,c);return w<0?void 0:g[w][1]}function oo(c){return Xn(this.__data__,c)>-1}function ao(c,g){var w=this.__data__,R=Xn(w,c);return R<0?w.push([c,g]):w[R][1]=g,this}De.prototype.clear=ro,De.prototype.delete=so,De.prototype.get=io,De.prototype.has=oo,De.prototype.set=ao;function Be(c){var g=-1,w=c?c.length:0;for(this.clear();++g<w;){var R=c[g];this.set(R[0],R[1])}}function lo(){this.__data__={hash:new Lt,map:new(Cn||De),string:new Lt}}function co(c){return On(this,c).delete(c)}function uo(c){return On(this,c).get(c)}function ho(c){return On(this,c).has(c)}function fo(c,g){return On(this,c).set(c,g),this}Be.prototype.clear=lo,Be.prototype.delete=co,Be.prototype.get=uo,Be.prototype.has=ho,Be.prototype.set=fo;function Ze(c){this.__data__=new De(c)}function po(){this.__data__=new De}function go(c){return this.__data__.delete(c)}function mo(c){return this.__data__.get(c)}function yo(c){return this.__data__.has(c)}function bo(c,g){var w=this.__data__;if(w instanceof De){var R=w.__data__;if(!Cn||R.length<n-1)return R.push([c,g]),this;w=this.__data__=new Be(R)}return w.set(c,g),this}Ze.prototype.clear=po,Ze.prototype.delete=go,Ze.prototype.get=mo,Ze.prototype.has=yo,Ze.prototype.set=bo;function Yn(c,g){var w=Br(c)||Qn(c)?fe(c.length,String):[],R=w.length,Q=!!R;for(var G in c)wt.call(c,G)&&!(Q&&(G=="length"||No(G,R)))&&w.push(G);return w}function Ns(c,g,w){var R=c[g];(!(wt.call(c,g)&&Ds(R,w))||w===void 0&&!(g in c))&&(c[g]=w)}function Xn(c,g){for(var w=c.length;w--;)if(Ds(c[w][0],g))return w;return-1}function xt(c,g){return c&&Ur(g,Wr(g),c)}function Fr(c,g,w,R,Q,G,le){var ae;if(R&&(ae=G?R(c,Q,G,le):R(c)),ae!==void 0)return ae;if(!St(c))return c;var Me=Br(c);if(Me){if(ae=Ao(c),!g)return Eo(c,ae)}else{var he=qt(c),He=he==d||he==f;if(Ls(c))return Zn(c,g);if(he==y||he==i||He&&!G){if(Oe(c))return G?c:{};if(ae=Ct(He?{}:c),!g)return Oo(c,xt(ae,c))}else{if(!B[he])return G?c:{};ae=jo(c,he,Fr,g)}}le||(le=new Ze);var Qe=le.get(c);if(Qe)return Qe;if(le.set(c,ae),!Me)var Ae=w?Mo(c):Wr(c);return se(Ae||c,function(We,Le){Ae&&(Le=We,We=c[Le]),Ns(ae,Le,Fr(We,g,w,R,Le,c,le))}),ae}function _o(c){return St(c)?Es(c):{}}function ko(c,g,w){var R=g(c);return Br(c)?R:ie(R,w(c))}function vo(c){return Kn.call(c)}function wo(c){if(!St(c)||Ro(c))return!1;var g=Hr(c)||Oe(c)?Zi:L;return g.test(Ve(c))}function xo(c){if(!Ps(c))return Ms(c);var g=[];for(var w in Object(c))wt.call(c,w)&&w!="constructor"&&g.push(w);return g}function Zn(c,g){if(g)return c.slice();var w=new c.constructor(c.length);return c.copy(w),w}function qr(c){var g=new c.constructor(c.byteLength);return new jr(g).set(new jr(c)),g}function En(c,g){var w=g?qr(c.buffer):c.buffer;return new c.constructor(w,c.byteOffset,c.byteLength)}function Is(c,g,w){var R=g?w(Ue(c),!0):Ue(c);return de(R,ye,new c.constructor)}function Rs(c){var g=new c.constructor(c.source,N.exec(c));return g.lastIndex=c.lastIndex,g}function Co(c,g,w){var R=g?w(Cs(c),!0):Cs(c);return de(R,te,new c.constructor)}function So(c){return As?Object(As.call(c)):{}}function To(c,g){var w=g?qr(c.buffer):c.buffer;return new c.constructor(w,c.byteOffset,c.length)}function Eo(c,g){var w=-1,R=c.length;for(g||(g=Array(R));++w<R;)g[w]=c[w];return g}function Ur(c,g,w,R){w||(w={});for(var Q=-1,G=g.length;++Q<G;){var le=g[Q],ae=void 0;Ns(w,le,ae===void 0?c[le]:ae)}return w}function Oo(c,g){return Ur(c,Ft(c),g)}function Mo(c){return ko(c,Wr,Ft)}function On(c,g){var w=c.__data__;return Io(g)?w[typeof g=="string"?"string":"hash"]:w.map}function pt(c,g){var w=ge(c,g);return wo(w)?w:void 0}var Ft=Nr?Mr(Nr,Object):$o,qt=vo;(Vn&&qt(new Vn(new ArrayBuffer(1)))!=q||Cn&&qt(new Cn)!=h||ft&&qt(ft.resolve())!=k||Gn&&qt(new Gn)!=M||Ir&&qt(new Ir)!=I)&&(qt=function(c){var g=Kn.call(c),w=g==y?c.constructor:void 0,R=w?Ve(w):void 0;if(R)switch(R){case Rr:return q;case Tn:return h;case Pr:return k;case $r:return M;case Dr:return I}return g});function Ao(c){var g=c.length,w=c.constructor(g);return g&&typeof c[0]=="string"&&wt.call(c,"index")&&(w.index=c.index,w.input=c.input),w}function Ct(c){return typeof c.constructor=="function"&&!Ps(c)?_o(ot(c)):{}}function jo(c,g,w,R){var Q=c.constructor;switch(g){case D:return qr(c);case a:case l:return new Q(+c);case q:return En(c,R);case F:case $:case H:case W:case _:case j:case x:case P:case E:return To(c,R);case h:return Is(c,R,w);case p:case v:return new Q(c);case C:return Rs(c);case M:return Co(c,R,w);case O:return So(c)}}function No(c,g){return g=g??s,!!g&&(typeof c=="number"||U.test(c))&&c>-1&&c%1==0&&c<g}function Io(c){var g=typeof c;return g=="string"||g=="number"||g=="symbol"||g=="boolean"?c!=="__proto__":c===null}function Ro(c){return!!Ss&&Ss in c}function Ps(c){var g=c&&c.constructor,w=typeof g=="function"&&g.prototype||Wn;return c===w}function Ve(c){if(c!=null){try{return Ts.call(c)}catch{}try{return c+""}catch{}}return""}function $s(c){return Fr(c,!0,!0)}function Ds(c,g){return c===g||c!==c&&g!==g}function Qn(c){return Po(c)&&wt.call(c,"callee")&&(!Os.call(c,"callee")||Kn.call(c)==i)}var Br=Array.isArray;function er(c){return c!=null&&Fs(c.length)&&!Hr(c)}function Po(c){return qs(c)&&er(c)}var Ls=Jn||Do;function Hr(c){var g=St(c)?Kn.call(c):"";return g==d||g==f}function Fs(c){return typeof c=="number"&&c>-1&&c%1==0&&c<=s}function St(c){var g=typeof c;return!!c&&(g=="object"||g=="function")}function qs(c){return!!c&&typeof c=="object"}function Wr(c){return er(c)?Yn(c):xo(c)}function $o(){return[]}function Do(){return!1}t.exports=$s}(Vr,Vr.exports)),Vr.exports}var Gr={exports:{}};Gr.exports;var Ul;function Cd(){return Ul||(Ul=1,function(t,e){var n=200,r="__lodash_hash_undefined__",s=1,i=2,o=9007199254740991,a="[object Arguments]",l="[object Array]",u="[object AsyncFunction]",d="[object Boolean]",f="[object Date]",h="[object Error]",p="[object Function]",y="[object GeneratorFunction]",k="[object Map]",C="[object Number]",M="[object Null]",v="[object Object]",O="[object Promise]",I="[object Proxy]",D="[object RegExp]",q="[object Set]",F="[object String]",$="[object Symbol]",H="[object Undefined]",W="[object WeakMap]",_="[object ArrayBuffer]",j="[object DataView]",x="[object Float32Array]",P="[object Float64Array]",E="[object Int8Array]",A="[object Int16Array]",N="[object Int32Array]",L="[object Uint8Array]",U="[object Uint8ClampedArray]",B="[object Uint16Array]",J="[object Uint32Array]",z=/[\\^$.*+?()[\]{}|]/g,Y=/^\[object .+?Constructor\]$/,ne=/^(?:0|[1-9]\d*)$/,V={};V[x]=V[P]=V[E]=V[A]=V[N]=V[L]=V[U]=V[B]=V[J]=!0,V[a]=V[l]=V[_]=V[d]=V[j]=V[f]=V[h]=V[p]=V[k]=V[C]=V[v]=V[D]=V[q]=V[F]=V[W]=!1;var ue=typeof ln=="object"&&ln&&ln.Object===Object&&ln,ye=typeof self=="object"&&self&&self.Object===Object&&self,te=ue||ye||Function("return this")(),se=e&&!e.nodeType&&e,ie=se&&!0&&t&&!t.nodeType&&t,de=ie&&ie.exports===se,fe=de&&ue.process,ge=function(){try{return fe&&fe.binding&&fe.binding("util")}catch{}}(),Oe=ge&&ge.isTypedArray;function Ue(c,g){for(var w=-1,R=c==null?0:c.length,Q=0,G=[];++w<R;){var le=c[w];g(le,w,c)&&(G[Q++]=le)}return G}function Mr(c,g){for(var w=-1,R=g.length,Q=c.length;++w<R;)c[Q+w]=g[w];return c}function Cs(c,g){for(var w=-1,R=c==null?0:c.length;++w<R;)if(g(c[w],w,c))return!0;return!1}function Yi(c,g){for(var w=-1,R=Array(c);++w<c;)R[w]=g(w);return R}function Xi(c){return function(g){return c(g)}}function Wn(c,g){return c.has(g)}function Ar(c,g){return c==null?void 0:c[g]}function Ss(c){var g=-1,w=Array(c.size);return c.forEach(function(R,Q){w[++g]=[Q,R]}),w}function Ts(c,g){return function(w){return c(g(w))}}function wt(c){var g=-1,w=Array(c.size);return c.forEach(function(R){w[++g]=R}),w}var Kn=Array.prototype,Zi=Function.prototype,xn=Object.prototype,zn=te["__core-js_shared__"],jr=Zi.toString,ot=xn.hasOwnProperty,Es=function(){var c=/[^.]+$/.exec(zn&&zn.keys&&zn.keys.IE_PROTO||"");return c?"Symbol(src)_1."+c:""}(),Os=xn.toString,Qi=RegExp("^"+jr.call(ot).replace(z,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Nr=de?te.Buffer:void 0,Jn=te.Symbol,Ms=te.Uint8Array,Vn=xn.propertyIsEnumerable,Cn=Kn.splice,ft=Jn?Jn.toStringTag:void 0,Gn=Object.getOwnPropertySymbols,Ir=Nr?Nr.isBuffer:void 0,Sn=Ts(Object.keys,Object),Rr=Ft(te,"DataView"),Tn=Ft(te,"Map"),Pr=Ft(te,"Promise"),$r=Ft(te,"Set"),Dr=Ft(te,"WeakMap"),nn=Ft(Object,"create"),As=Ve(Rr),Lt=Ve(Tn),eo=Ve(Pr),to=Ve($r),no=Ve(Dr),js=Jn?Jn.prototype:void 0,Lr=js?js.valueOf:void 0;function De(c){var g=-1,w=c==null?0:c.length;for(this.clear();++g<w;){var R=c[g];this.set(R[0],R[1])}}function ro(){this.__data__=nn?nn(null):{},this.size=0}function so(c){var g=this.has(c)&&delete this.__data__[c];return this.size-=g?1:0,g}function io(c){var g=this.__data__;if(nn){var w=g[c];return w===r?void 0:w}return ot.call(g,c)?g[c]:void 0}function oo(c){var g=this.__data__;return nn?g[c]!==void 0:ot.call(g,c)}function ao(c,g){var w=this.__data__;return this.size+=this.has(c)?0:1,w[c]=nn&&g===void 0?r:g,this}De.prototype.clear=ro,De.prototype.delete=so,De.prototype.get=io,De.prototype.has=oo,De.prototype.set=ao;function Be(c){var g=-1,w=c==null?0:c.length;for(this.clear();++g<w;){var R=c[g];this.set(R[0],R[1])}}function lo(){this.__data__=[],this.size=0}function co(c){var g=this.__data__,w=Zn(g,c);if(w<0)return!1;var R=g.length-1;return w==R?g.pop():Cn.call(g,w,1),--this.size,!0}function uo(c){var g=this.__data__,w=Zn(g,c);return w<0?void 0:g[w][1]}function ho(c){return Zn(this.__data__,c)>-1}function fo(c,g){var w=this.__data__,R=Zn(w,c);return R<0?(++this.size,w.push([c,g])):w[R][1]=g,this}Be.prototype.clear=lo,Be.prototype.delete=co,Be.prototype.get=uo,Be.prototype.has=ho,Be.prototype.set=fo;function Ze(c){var g=-1,w=c==null?0:c.length;for(this.clear();++g<w;){var R=c[g];this.set(R[0],R[1])}}function po(){this.size=0,this.__data__={hash:new De,map:new(Tn||Be),string:new De}}function go(c){var g=pt(this,c).delete(c);return this.size-=g?1:0,g}function mo(c){return pt(this,c).get(c)}function yo(c){return pt(this,c).has(c)}function bo(c,g){var w=pt(this,c),R=w.size;return w.set(c,g),this.size+=w.size==R?0:1,this}Ze.prototype.clear=po,Ze.prototype.delete=go,Ze.prototype.get=mo,Ze.prototype.has=yo,Ze.prototype.set=bo;function Yn(c){var g=-1,w=c==null?0:c.length;for(this.__data__=new Ze;++g<w;)this.add(c[g])}function Ns(c){return this.__data__.set(c,r),this}function Xn(c){return this.__data__.has(c)}Yn.prototype.add=Yn.prototype.push=Ns,Yn.prototype.has=Xn;function xt(c){var g=this.__data__=new Be(c);this.size=g.size}function Fr(){this.__data__=new Be,this.size=0}function _o(c){var g=this.__data__,w=g.delete(c);return this.size=g.size,w}function ko(c){return this.__data__.get(c)}function vo(c){return this.__data__.has(c)}function wo(c,g){var w=this.__data__;if(w instanceof Be){var R=w.__data__;if(!Tn||R.length<n-1)return R.push([c,g]),this.size=++w.size,this;w=this.__data__=new Ze(R)}return w.set(c,g),this.size=w.size,this}xt.prototype.clear=Fr,xt.prototype.delete=_o,xt.prototype.get=ko,xt.prototype.has=vo,xt.prototype.set=wo;function xo(c,g){var w=Qn(c),R=!w&&Ds(c),Q=!w&&!R&&er(c),G=!w&&!R&&!Q&&qs(c),le=w||R||Q||G,ae=le?Yi(c.length,String):[],Me=ae.length;for(var he in c)ot.call(c,he)&&!(le&&(he=="length"||Q&&(he=="offset"||he=="parent")||G&&(he=="buffer"||he=="byteLength"||he=="byteOffset")||jo(he,Me)))&&ae.push(he);return ae}function Zn(c,g){for(var w=c.length;w--;)if($s(c[w][0],g))return w;return-1}function qr(c,g,w){var R=g(c);return Qn(c)?R:Mr(R,w(c))}function En(c){return c==null?c===void 0?H:M:ft&&ft in Object(c)?qt(c):Ps(c)}function Is(c){return St(c)&&En(c)==a}function Rs(c,g,w,R,Q){return c===g?!0:c==null||g==null||!St(c)&&!St(g)?c!==c&&g!==g:Co(c,g,w,R,Rs,Q)}function Co(c,g,w,R,Q,G){var le=Qn(c),ae=Qn(g),Me=le?l:Ct(c),he=ae?l:Ct(g);Me=Me==a?v:Me,he=he==a?v:he;var He=Me==v,Qe=he==v,Ae=Me==he;if(Ae&&er(c)){if(!er(g))return!1;le=!0,He=!1}if(Ae&&!He)return G||(G=new xt),le||qs(c)?Ur(c,g,w,R,Q,G):Oo(c,g,Me,w,R,Q,G);if(!(w&s)){var We=He&&ot.call(c,"__wrapped__"),Le=Qe&&ot.call(g,"__wrapped__");if(We||Le){var rn=We?c.value():c,Ut=Le?g.value():g;return G||(G=new xt),Q(rn,Ut,w,R,G)}}return Ae?(G||(G=new xt),Mo(c,g,w,R,Q,G)):!1}function So(c){if(!Fs(c)||Io(c))return!1;var g=Ls(c)?Qi:Y;return g.test(Ve(c))}function To(c){return St(c)&&Hr(c.length)&&!!V[En(c)]}function Eo(c){if(!Ro(c))return Sn(c);var g=[];for(var w in Object(c))ot.call(c,w)&&w!="constructor"&&g.push(w);return g}function Ur(c,g,w,R,Q,G){var le=w&s,ae=c.length,Me=g.length;if(ae!=Me&&!(le&&Me>ae))return!1;var he=G.get(c);if(he&&G.get(g))return he==g;var He=-1,Qe=!0,Ae=w&i?new Yn:void 0;for(G.set(c,g),G.set(g,c);++He<ae;){var We=c[He],Le=g[He];if(R)var rn=le?R(Le,We,He,g,c,G):R(We,Le,He,c,g,G);if(rn!==void 0){if(rn)continue;Qe=!1;break}if(Ae){if(!Cs(g,function(Ut,Mn){if(!Wn(Ae,Mn)&&(We===Ut||Q(We,Ut,w,R,G)))return Ae.push(Mn)})){Qe=!1;break}}else if(!(We===Le||Q(We,Le,w,R,G))){Qe=!1;break}}return G.delete(c),G.delete(g),Qe}function Oo(c,g,w,R,Q,G,le){switch(w){case j:if(c.byteLength!=g.byteLength||c.byteOffset!=g.byteOffset)return!1;c=c.buffer,g=g.buffer;case _:return!(c.byteLength!=g.byteLength||!G(new Ms(c),new Ms(g)));case d:case f:case C:return $s(+c,+g);case h:return c.name==g.name&&c.message==g.message;case D:case F:return c==g+"";case k:var ae=Ss;case q:var Me=R&s;if(ae||(ae=wt),c.size!=g.size&&!Me)return!1;var he=le.get(c);if(he)return he==g;R|=i,le.set(c,g);var He=Ur(ae(c),ae(g),R,Q,G,le);return le.delete(c),He;case $:if(Lr)return Lr.call(c)==Lr.call(g)}return!1}function Mo(c,g,w,R,Q,G){var le=w&s,ae=On(c),Me=ae.length,he=On(g),He=he.length;if(Me!=He&&!le)return!1;for(var Qe=Me;Qe--;){var Ae=ae[Qe];if(!(le?Ae in g:ot.call(g,Ae)))return!1}var We=G.get(c);if(We&&G.get(g))return We==g;var Le=!0;G.set(c,g),G.set(g,c);for(var rn=le;++Qe<Me;){Ae=ae[Qe];var Ut=c[Ae],Mn=g[Ae];if(R)var Al=le?R(Mn,Ut,Ae,g,c,G):R(Ut,Mn,Ae,c,g,G);if(!(Al===void 0?Ut===Mn||Q(Ut,Mn,w,R,G):Al)){Le=!1;break}rn||(rn=Ae=="constructor")}if(Le&&!rn){var Us=c.constructor,Bs=g.constructor;Us!=Bs&&"constructor"in c&&"constructor"in g&&!(typeof Us=="function"&&Us instanceof Us&&typeof Bs=="function"&&Bs instanceof Bs)&&(Le=!1)}return G.delete(c),G.delete(g),Le}function On(c){return qr(c,Wr,Ao)}function pt(c,g){var w=c.__data__;return No(g)?w[typeof g=="string"?"string":"hash"]:w.map}function Ft(c,g){var w=Ar(c,g);return So(w)?w:void 0}function qt(c){var g=ot.call(c,ft),w=c[ft];try{c[ft]=void 0;var R=!0}catch{}var Q=Os.call(c);return R&&(g?c[ft]=w:delete c[ft]),Q}var Ao=Gn?function(c){return c==null?[]:(c=Object(c),Ue(Gn(c),function(g){return Vn.call(c,g)}))}:$o,Ct=En;(Rr&&Ct(new Rr(new ArrayBuffer(1)))!=j||Tn&&Ct(new Tn)!=k||Pr&&Ct(Pr.resolve())!=O||$r&&Ct(new $r)!=q||Dr&&Ct(new Dr)!=W)&&(Ct=function(c){var g=En(c),w=g==v?c.constructor:void 0,R=w?Ve(w):"";if(R)switch(R){case As:return j;case Lt:return k;case eo:return O;case to:return q;case no:return W}return g});function jo(c,g){return g=g??o,!!g&&(typeof c=="number"||ne.test(c))&&c>-1&&c%1==0&&c<g}function No(c){var g=typeof c;return g=="string"||g=="number"||g=="symbol"||g=="boolean"?c!=="__proto__":c===null}function Io(c){return!!Es&&Es in c}function Ro(c){var g=c&&c.constructor,w=typeof g=="function"&&g.prototype||xn;return c===w}function Ps(c){return Os.call(c)}function Ve(c){if(c!=null){try{return jr.call(c)}catch{}try{return c+""}catch{}}return""}function $s(c,g){return c===g||c!==c&&g!==g}var Ds=Is(function(){return arguments}())?Is:function(c){return St(c)&&ot.call(c,"callee")&&!Vn.call(c,"callee")},Qn=Array.isArray;function Br(c){return c!=null&&Hr(c.length)&&!Ls(c)}var er=Ir||Do;function Po(c,g){return Rs(c,g)}function Ls(c){if(!Fs(c))return!1;var g=En(c);return g==p||g==y||g==u||g==I}function Hr(c){return typeof c=="number"&&c>-1&&c%1==0&&c<=o}function Fs(c){var g=typeof c;return c!=null&&(g=="object"||g=="function")}function St(c){return c!=null&&typeof c=="object"}var qs=Oe?Xi(Oe):To;function Wr(c){return Br(c)?xo(c):Eo(c)}function $o(){return[]}function Do(){return!1}t.exports=Po}(Gr,Gr.exports)),Gr.exports}var Ks={},Bl;function Ig(){if(Bl)return Ks;Bl=1,Object.defineProperty(Ks,"__esModule",{value:!0});const t=xd(),e=Cd();var n;return function(r){function s(l={},u={},d=!1){typeof l!="object"&&(l={}),typeof u!="object"&&(u={});let f=t(u);d||(f=Object.keys(f).reduce((h,p)=>(f[p]!=null&&(h[p]=f[p]),h),{}));for(const h in l)l[h]!==void 0&&u[h]===void 0&&(f[h]=l[h]);return Object.keys(f).length>0?f:void 0}r.compose=s;function i(l={},u={}){typeof l!="object"&&(l={}),typeof u!="object"&&(u={});const d=Object.keys(l).concat(Object.keys(u)).reduce((f,h)=>(e(l[h],u[h])||(f[h]=u[h]===void 0?null:u[h]),f),{});return Object.keys(d).length>0?d:void 0}r.diff=i;function o(l={},u={}){l=l||{};const d=Object.keys(u).reduce((f,h)=>(u[h]!==l[h]&&l[h]!==void 0&&(f[h]=u[h]),f),{});return Object.keys(l).reduce((f,h)=>(l[h]!==u[h]&&u[h]===void 0&&(f[h]=null),f),d)}r.invert=o;function a(l,u,d=!1){if(typeof l!="object")return u;if(typeof u!="object")return;if(!d)return u;const f=Object.keys(u).reduce((h,p)=>(l[p]===void 0&&(h[p]=u[p]),h),{});return Object.keys(f).length>0?f:void 0}r.transform=a}(n||(n={})),Ks.default=n,Ks}var zs={},Hl;function Sd(){if(Hl)return zs;Hl=1,Object.defineProperty(zs,"__esModule",{value:!0});var t;return function(e){function n(r){return typeof r.delete=="number"?r.delete:typeof r.retain=="number"?r.retain:typeof r.retain=="object"&&r.retain!==null?1:typeof r.insert=="string"?r.insert.length:1}e.length=n}(t||(t={})),zs.default=t,zs}var Js={},Wl;function Rg(){if(Wl)return Js;Wl=1,Object.defineProperty(Js,"__esModule",{value:!0});const t=Sd();class e{constructor(r){this.ops=r,this.index=0,this.offset=0}hasNext(){return this.peekLength()<1/0}next(r){r||(r=1/0);const s=this.ops[this.index];if(s){const i=this.offset,o=t.default.length(s);if(r>=o-i?(r=o-i,this.index+=1,this.offset=0):this.offset+=r,typeof s.delete=="number")return{delete:r};{const a={};return s.attributes&&(a.attributes=s.attributes),typeof s.retain=="number"?a.retain=r:typeof s.retain=="object"&&s.retain!==null?a.retain=s.retain:typeof s.insert=="string"?a.insert=s.insert.substr(i,r):a.insert=s.insert,a}}else return{retain:1/0}}peek(){return this.ops[this.index]}peekLength(){return this.ops[this.index]?t.default.length(this.ops[this.index])-this.offset:1/0}peekType(){const r=this.ops[this.index];return r?typeof r.delete=="number"?"delete":typeof r.retain=="number"||typeof r.retain=="object"&&r.retain!==null?"retain":"insert":"retain"}rest(){if(this.hasNext()){if(this.offset===0)return this.ops.slice(this.index);{const r=this.offset,s=this.index,i=this.next(),o=this.ops.slice(this.index);return this.offset=r,this.index=s,[i].concat(o)}}else return[]}}return Js.default=e,Js}var Kl;function Pg(){return Kl||(Kl=1,function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeMap=e.OpIterator=e.Op=void 0;const n=Ng(),r=xd(),s=Cd(),i=Ig();e.AttributeMap=i.default;const o=Sd();e.Op=o.default;const a=Rg();e.OpIterator=a.default;const l="\0",u=(f,h)=>{if(typeof f!="object"||f===null)throw new Error(`cannot retain a ${typeof f}`);if(typeof h!="object"||h===null)throw new Error(`cannot retain a ${typeof h}`);const p=Object.keys(f)[0];if(!p||p!==Object.keys(h)[0])throw new Error(`embed types not matched: ${p} != ${Object.keys(h)[0]}`);return[p,f[p],h[p]]};class d{constructor(h){Array.isArray(h)?this.ops=h:h!=null&&Array.isArray(h.ops)?this.ops=h.ops:this.ops=[]}static registerEmbed(h,p){this.handlers[h]=p}static unregisterEmbed(h){delete this.handlers[h]}static getHandler(h){const p=this.handlers[h];if(!p)throw new Error(`no handlers for embed type "${h}"`);return p}insert(h,p){const y={};return typeof h=="string"&&h.length===0?this:(y.insert=h,p!=null&&typeof p=="object"&&Object.keys(p).length>0&&(y.attributes=p),this.push(y))}delete(h){return h<=0?this:this.push({delete:h})}retain(h,p){if(typeof h=="number"&&h<=0)return this;const y={retain:h};return p!=null&&typeof p=="object"&&Object.keys(p).length>0&&(y.attributes=p),this.push(y)}push(h){let p=this.ops.length,y=this.ops[p-1];if(h=r(h),typeof y=="object"){if(typeof h.delete=="number"&&typeof y.delete=="number")return this.ops[p-1]={delete:y.delete+h.delete},this;if(typeof y.delete=="number"&&h.insert!=null&&(p-=1,y=this.ops[p-1],typeof y!="object"))return this.ops.unshift(h),this;if(s(h.attributes,y.attributes)){if(typeof h.insert=="string"&&typeof y.insert=="string")return this.ops[p-1]={insert:y.insert+h.insert},typeof h.attributes=="object"&&(this.ops[p-1].attributes=h.attributes),this;if(typeof h.retain=="number"&&typeof y.retain=="number")return this.ops[p-1]={retain:y.retain+h.retain},typeof h.attributes=="object"&&(this.ops[p-1].attributes=h.attributes),this}}return p===this.ops.length?this.ops.push(h):this.ops.splice(p,0,h),this}chop(){const h=this.ops[this.ops.length-1];return h&&typeof h.retain=="number"&&!h.attributes&&this.ops.pop(),this}filter(h){return this.ops.filter(h)}forEach(h){this.ops.forEach(h)}map(h){return this.ops.map(h)}partition(h){const p=[],y=[];return this.forEach(k=>{(h(k)?p:y).push(k)}),[p,y]}reduce(h,p){return this.ops.reduce(h,p)}changeLength(){return this.reduce((h,p)=>p.insert?h+o.default.length(p):p.delete?h-p.delete:h,0)}length(){return this.reduce((h,p)=>h+o.default.length(p),0)}slice(h=0,p=1/0){const y=[],k=new a.default(this.ops);let C=0;for(;C<p&&k.hasNext();){let M;C<h?M=k.next(h-C):(M=k.next(p-C),y.push(M)),C+=o.default.length(M)}return new d(y)}compose(h){const p=new a.default(this.ops),y=new a.default(h.ops),k=[],C=y.peek();if(C!=null&&typeof C.retain=="number"&&C.attributes==null){let v=C.retain;for(;p.peekType()==="insert"&&p.peekLength()<=v;)v-=p.peekLength(),k.push(p.next());C.retain-v>0&&y.next(C.retain-v)}const M=new d(k);for(;p.hasNext()||y.hasNext();)if(y.peekType()==="insert")M.push(y.next());else if(p.peekType()==="delete")M.push(p.next());else{const v=Math.min(p.peekLength(),y.peekLength()),O=p.next(v),I=y.next(v);if(I.retain){const D={};if(typeof O.retain=="number")D.retain=typeof I.retain=="number"?v:I.retain;else if(typeof I.retain=="number")O.retain==null?D.insert=O.insert:D.retain=O.retain;else{const F=O.retain==null?"insert":"retain",[$,H,W]=u(O[F],I.retain),_=d.getHandler($);D[F]={[$]:_.compose(H,W,F==="retain")}}const q=i.default.compose(O.attributes,I.attributes,typeof O.retain=="number");if(q&&(D.attributes=q),M.push(D),!y.hasNext()&&s(M.ops[M.ops.length-1],D)){const F=new d(p.rest());return M.concat(F).chop()}}else typeof I.delete=="number"&&(typeof O.retain=="number"||typeof O.retain=="object"&&O.retain!==null)&&M.push(I)}return M.chop()}concat(h){const p=new d(this.ops.slice());return h.ops.length>0&&(p.push(h.ops[0]),p.ops=p.ops.concat(h.ops.slice(1))),p}diff(h,p){if(this.ops===h.ops)return new d;const y=[this,h].map(O=>O.map(I=>{if(I.insert!=null)return typeof I.insert=="string"?I.insert:l;const D=O===h?"on":"with";throw new Error("diff() called "+D+" non-document")}).join("")),k=new d,C=n(y[0],y[1],p,!0),M=new a.default(this.ops),v=new a.default(h.ops);return C.forEach(O=>{let I=O[1].length;for(;I>0;){let D=0;switch(O[0]){case n.INSERT:D=Math.min(v.peekLength(),I),k.push(v.next(D));break;case n.DELETE:D=Math.min(I,M.peekLength()),M.next(D),k.delete(D);break;case n.EQUAL:D=Math.min(M.peekLength(),v.peekLength(),I);const q=M.next(D),F=v.next(D);s(q.insert,F.insert)?k.retain(D,i.default.diff(q.attributes,F.attributes)):k.push(F).delete(D);break}I-=D}}),k.chop()}eachLine(h,p=`
`){const y=new a.default(this.ops);let k=new d,C=0;for(;y.hasNext();){if(y.peekType()!=="insert")return;const M=y.peek(),v=o.default.length(M)-y.peekLength(),O=typeof M.insert=="string"?M.insert.indexOf(p,v)-v:-1;if(O<0)k.push(y.next());else if(O>0)k.push(y.next(O));else{if(h(k,y.next(1).attributes||{},C)===!1)return;C+=1,k=new d}}k.length()>0&&h(k,{},C)}invert(h){const p=new d;return this.reduce((y,k)=>{if(k.insert)p.delete(o.default.length(k));else{if(typeof k.retain=="number"&&k.attributes==null)return p.retain(k.retain),y+k.retain;if(k.delete||typeof k.retain=="number"){const C=k.delete||k.retain;return h.slice(y,y+C).forEach(v=>{k.delete?p.push(v):k.retain&&k.attributes&&p.retain(o.default.length(v),i.default.invert(k.attributes,v.attributes))}),y+C}else if(typeof k.retain=="object"&&k.retain!==null){const C=h.slice(y,y+1),M=new a.default(C.ops).next(),[v,O,I]=u(k.retain,M.insert),D=d.getHandler(v);return p.retain({[v]:D.invert(O,I)},i.default.invert(k.attributes,M.attributes)),y+1}}return y},0),p.chop()}transform(h,p=!1){if(p=!!p,typeof h=="number")return this.transformPosition(h,p);const y=h,k=new a.default(this.ops),C=new a.default(y.ops),M=new d;for(;k.hasNext()||C.hasNext();)if(k.peekType()==="insert"&&(p||C.peekType()!=="insert"))M.retain(o.default.length(k.next()));else if(C.peekType()==="insert")M.push(C.next());else{const v=Math.min(k.peekLength(),C.peekLength()),O=k.next(v),I=C.next(v);if(O.delete)continue;if(I.delete)M.push(I);else{const D=O.retain,q=I.retain;let F=typeof q=="object"&&q!==null?q:v;if(typeof D=="object"&&D!==null&&typeof q=="object"&&q!==null){const $=Object.keys(D)[0];if($===Object.keys(q)[0]){const H=d.getHandler($);H&&(F={[$]:H.transform(D[$],q[$],p)})}}M.retain(F,i.default.transform(O.attributes,I.attributes,p))}}return M.chop()}transformPosition(h,p=!1){p=!!p;const y=new a.default(this.ops);let k=0;for(;y.hasNext()&&k<=h;){const C=y.peekLength(),M=y.peekType();if(y.next(),M==="delete"){h-=Math.min(C,h-k);continue}else M==="insert"&&(k<h||!p)&&(h+=C);k+=C}return h}}d.Op=o.default,d.OpIterator=a.default,d.AttributeMap=i.default,d.handlers={},e.default=d,t.exports=d,t.exports.default=d}(Ws,Ws.exports)),Ws.exports}var $g=Pg();const Yr=Kf($g),Dg=new Set(["http:","https:","mailto:","sms:","tel:"]);let Td=class Ed extends yn{constructor(n="",r={},s){super(s);sn(this,"__url");sn(this,"__target");sn(this,"__rel");sn(this,"__title");const{target:i=null,rel:o=null,title:a=null}=r;this.__url=n,this.__target=i,this.__rel=o,this.__title=a}static getType(){return"link"}static clone(n){return new Ed(n.__url,{rel:n.__rel,target:n.__target,title:n.__title},n.__key)}createDOM(n){const r=document.createElement("a");return this.updateLinkDOM(null,r,n),Et(r,n.theme.link),r}updateLinkDOM(n,r,s){if(td(r)){n&&n.__url===this.__url||(r.href=this.sanitizeUrl(this.__url));for(const i of["target","rel","title"]){const o=`__${i}`,a=this[o];n&&n[o]===a||(a?r[i]=a:r.removeAttribute(i))}}}updateDOM(n,r,s){return this.updateLinkDOM(n,r,s),!1}static importDOM(){return{a:n=>({conversion:Lg,priority:1})}}static importJSON(n){return ca().updateFromJSON(n)}updateFromJSON(n){return super.updateFromJSON(n).setURL(n.url).setRel(n.rel||null).setTarget(n.target||null).setTitle(n.title||null)}sanitizeUrl(n){n=zl(n);try{const r=new URL(zl(n));if(!Dg.has(r.protocol))return"about:blank"}catch{return n}return n}exportJSON(){return{...super.exportJSON(),rel:this.getRel(),target:this.getTarget(),title:this.getTitle(),url:this.getURL()}}getURL(){return this.getLatest().__url}setURL(n){const r=this.getWritable();return r.__url=n,r}getTarget(){return this.getLatest().__target}setTarget(n){const r=this.getWritable();return r.__target=n,r}getRel(){return this.getLatest().__rel}setRel(n){const r=this.getWritable();return r.__rel=n,r}getTitle(){return this.getLatest().__title}setTitle(n){const r=this.getWritable();return r.__title=n,r}insertNewAfter(n,r=!0){const s=ca(this.__url,{rel:this.__rel,target:this.__target,title:this.__title});return this.insertAfter(s,r),s}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}canBeEmpty(){return!1}isInline(){return!0}extractWithChild(n,r,s){if(!X(r))return!1;const i=r.anchor.getNode(),o=r.focus.getNode();return this.isParentOf(i)&&this.isParentOf(o)&&r.getTextContent().length>0}isEmailURI(){return this.__url.startsWith("mailto:")}isWebSiteURI(){return this.__url.startsWith("https://")||this.__url.startsWith("http://")}};function Lg(t){let e=null;if(td(t)){const n=t.textContent;(n!==null&&n!==""||t.children.length>0)&&(e=ca(t.getAttribute("href")||"",{rel:t.getAttribute("rel"),target:t.getAttribute("target"),title:t.getAttribute("title")}))}return{node:e}}function ca(t="",e){return Ie(new Td(t,e))}function Fg(t){return t instanceof Td}const qg=/^\+?[0-9\s()-]{5,}$/;function zl(t){return t.match(/^[a-z][a-z0-9+.-]*:/i)||t.match(/^[/#.]/)?t:t.includes("@")?`mailto:${t}`:qg.test(t)?`tel:${t}`:`https://${t}`}const Od=[];let Md=class Ad extends yn{constructor(n=Od,r){super(r);sn(this,"__ids");this.__ids=n}static getType(){return"mark"}static clone(n){return new Ad(n.__ids,n.__key)}static importDOM(){return null}static importJSON(n){return Jl().updateFromJSON(n)}updateFromJSON(n){return super.updateFromJSON(n).setIDs(n.ids)}exportJSON(){return{...super.exportJSON(),ids:this.getIDs()}}createDOM(n){const r=document.createElement("mark");return Et(r,n.theme.mark),this.__ids.length>1&&Et(r,n.theme.markOverlap),r}updateDOM(n,r,s){const i=n.__ids,o=this.__ids,a=i.length,l=o.length,u=s.theme.markOverlap;return a!==l&&(a===1?l===2&&Et(r,u):l===1&&hi(r,u)),!1}hasID(n){return this.getIDs().includes(n)}getIDs(){return Array.from(this.getLatest().__ids)}setIDs(n){const r=this.getWritable();return r.__ids=n,r}addID(n){const r=this.getWritable();return r.__ids.includes(n)?r:r.setIDs([...r.__ids,n])}deleteID(n){const r=this.getWritable(),s=r.__ids.indexOf(n);if(s===-1)return r;const i=Array.from(r.__ids);return i.splice(s,1),r.setIDs(i)}insertNewAfter(n,r=!0){const s=Jl(this.__ids);return this.insertAfter(s,r),s}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}canBeEmpty(){return!1}isInline(){return!0}extractWithChild(n,r,s){if(!X(r)||s==="html")return!1;const i=r.anchor,o=r.focus,a=i.getNode(),l=o.getNode(),u=r.isBackward()?i.offset-o.offset:o.offset-i.offset;return this.isParentOf(a)&&this.isParentOf(l)&&this.getTextContent().length===u}excludeFromCopy(n){return n!=="clone"}};function Jl(t=Od){return Ie(new Md(t))}function Ug(t){return t instanceof Md}const jd=Object.freeze({"	":"\\t","\n":"\\n"}),Vl=new RegExp(Object.keys(jd).join("|"),"g"),Ot=Object.freeze({ancestorHasNextSibling:"|",ancestorIsLastChild:" ",hasNextSibling:"",isLastChild:"",selectedChar:"^",selectedLine:">"}),Bg=[t=>t.hasFormat("bold")&&"Bold",t=>t.hasFormat("code")&&"Code",t=>t.hasFormat("italic")&&"Italic",t=>t.hasFormat("strikethrough")&&"Strikethrough",t=>t.hasFormat("subscript")&&"Subscript",t=>t.hasFormat("superscript")&&"Superscript",t=>t.hasFormat("underline")&&"Underline",t=>t.hasFormat("highlight")&&"Highlight"],Hg=[t=>t.hasTextFormat("bold")&&"Bold",t=>t.hasTextFormat("code")&&"Code",t=>t.hasTextFormat("italic")&&"Italic",t=>t.hasTextFormat("strikethrough")&&"Strikethrough",t=>t.hasTextFormat("subscript")&&"Subscript",t=>t.hasTextFormat("superscript")&&"Superscript",t=>t.hasTextFormat("underline")&&"Underline",t=>t.hasTextFormat("highlight")&&"Highlight"],Wg=[t=>t.isDirectionless()&&"Directionless",t=>t.isUnmergeable()&&"Unmergeable"],Kg=[t=>t.isToken()&&"Token",t=>t.isSegmented()&&"Segmented"];function zg(t,e,n,r,s=!1){const i=t.getEditorState(),o=t._config,a=t._compositionKey,l=t._editable;if(n){let h="";return i.read(()=>{h=function(p){const y=document.createElement("div");return y.innerHTML=p.trim(),Id(y,0).innerHTML}(Yf(t))}),h}let u=` root
`;const d=i.read(()=>{const h=re();return Nd(Dt(),(p,y)=>{const k=`(${p.getKey()})`,C=p.getType()||"",M=p.isSelected();u+=`${M?Ot.selectedLine:" "} ${y.join(" ")} ${k} ${C} ${function(v,O,I=!1){const D=O?O(v,I):void 0;if(D!==void 0&&D.length>0)return D;if(ee(v)){const q=v.getTextContent(),F=q.length===0?"(empty)":`"${Gl(q,I)}"`,$=function(H){return[Yl(H),Jg(H),Vg(H),Xl(H)].filter(Boolean).join(", ")}(v);return[F,$.length!==0?`{ ${$} }`:null].filter(Boolean).join(" ").trim()}if(Fg(v)){const q=v.getURL(),F=q.length===0?"(empty)":`"${Gl(q,I)}"`,$=function(H){return[Gg(H),Yg(H),Xg(H),Xl(H)].filter(Boolean).join(", ")}(v);return[F,$.length!==0?`{ ${$} }`:null].filter(Boolean).join(" ").trim()}if(Ug(v))return`ids: [ ${v.getIDs().join(", ")} ]`;if(Zf(v)){const q=function($){let H=Hg.map(W=>W($)).filter(Boolean).join(", ").toLocaleLowerCase();return H!==""&&(H="format: "+H),H}(v);let F=q!==""?`{ ${q} }`:"";return F+=v.__style?`(${v.__style})`:"",F}return""}(p,r,s)}
`,u+=function({indent:v,isSelected:O,node:I,nodeKeyDisplay:D,selection:q,typeDisplay:F}){if(!ee(I)||!X(q)||!O||we(I))return"";const $=q.anchor,H=q.focus;if(I.getTextContent()===""||$.getNode()===q.focus.getNode()&&$.offset===H.offset)return"";const[W,_]=function(L,U){const B=U.getStartEndPoints();if(jl(U)||B===null)return[-1,-1];const[J,z]=B,Y=L.getTextContent(),ne=Y.length;let V=-1,ue=-1;if(J.type==="text"&&z.type==="text"){const se=J.getNode(),ie=z.getNode();se===ie&&L===se&&J.offset!==z.offset?[V,ue]=J.offset<z.offset?[J.offset,z.offset]:[z.offset,J.offset]:[V,ue]=L===se?se.isBefore(ie)?[J.offset,ne]:[0,J.offset]:L===ie?ie.isBefore(se)?[z.offset,ne]:[0,z.offset]:[0,ne]}const ye=(Y.slice(0,V).match(Vl)||[]).length,te=(Y.slice(V,ue).match(Vl)||[]).length;return[V+ye,ue+ye+te]}(I,q);if(W===_)return"";const j=v[v.length-1]===Ot.hasNextSibling?Ot.ancestorHasNextSibling:Ot.ancestorIsLastChild,x=[...v.slice(0,v.length-1),j],P=Array(W+1).fill(" "),E=Array(_-W).fill(Ot.selectedChar),A=F.length+2,N=Array(D.length+A).fill(" ");return[Ot.selectedLine,x.join(" "),[...N,...P,...E].join("")].join(" ")+`
`}({indent:y,isSelected:M,node:p,nodeKeyDisplay:k,selection:h,typeDisplay:C})}),h===null?": null":X(h)?function(p){let y="";const k=Yl(p);y+=`: range ${k!==""?`{ ${k} }`:""} ${p.style!==""?`{ style: ${p.style} } `:""}`;const C=p.anchor,M=p.focus,v=C.offset,O=M.offset;return y+=`
   anchor { key: ${C.key}, offset: ${v===null?"null":v}, type: ${C.type} }`,y+=`
   focus { key: ${M.key}, offset: ${O===null?"null":O}, type: ${M.type} }`,y}(h):Xf(h)?function(p){return`: table
   { table: ${p.tableKey}, anchorCell: ${p.anchor.key}, focusCell: ${p.focus.key} }`}(h):function(p){return jl(p)?`: node
   [${Array.from(p._nodes).join(", ")}]`:""}(h)});if(u+=`
 selection`+d,u+=`

 commands:`,e.length)for(const{index:h,type:p,payload:y}of e)u+=`
   ${h}. { type: ${p}, payload: ${y instanceof Event?y.constructor.name:y} }`;else u+=`
   None dispatched.`;const{version:f}=t.constructor;return u+=`

 editor${f?` (v${f})`:""}:`,u+=`
   namespace ${o.namespace}`,a!==null&&(u+=`
   compositionKey ${a}`),u+=`
   editable ${String(l)}`,u}function Nd(t,e,n=[]){const r=t.getChildren(),s=r.length;r.forEach((i,o)=>{e(i,n.concat(o===s-1?Ot.isLastChild:Ot.hasNextSibling)),we(i)&&Nd(i,e,n.concat(o===s-1?Ot.ancestorIsLastChild:Ot.ancestorHasNextSibling))})}function Gl(t,e=!1){const n=Object.entries(jd).reduce((r,[s,i])=>r.replace(new RegExp(s,"g"),String(i)),t);return e?n.replace(/[^\s]/g,"*"):n}function Jg(t){let e=Wg.map(n=>n(t)).filter(Boolean).join(", ").toLocaleLowerCase();return e!==""&&(e="detail: "+e),e}function Vg(t){let e=Kg.map(n=>n(t)).filter(Boolean).join(", ").toLocaleLowerCase();return e!==""&&(e="mode: "+e),e}function Yl(t){let e=Bg.map(n=>n(t)).filter(Boolean).join(", ").toLocaleLowerCase();return e!==""&&(e="format: "+e),e}function Gg(t){let e=t.getTarget();return e!=null&&(e="target: "+e),e}function Yg(t){let e=t.getRel();return e!=null&&(e="rel: "+e),e}function Xg(t){let e=t.getTitle();return e!=null&&(e="title: "+e),e}function Xl(t){if(!t.__state)return!1;const e=[];for(const[r,s]of t.__state.knownState.entries()){if(r.isEqual(s,r.defaultValue))continue;const i=JSON.stringify(r.unparse(s));e.push(`[${r.key}: ${i}]`)}let n=e.join(",");return n!==""&&(n="state: "+n),n}function Id(t,e){const n=new Array(1+e++).join("  "),r=new Array(e-1).join("  ");let s;for(let i=0;i<t.children.length;i++)s=document.createTextNode(`
`+n),t.insertBefore(s,t.children[i]),Id(t.children[i],e),t.lastElementChild===t.children[i]&&(s=document.createTextNode(`
`+r),t.appendChild(s));return t}const Zg=b.forwardRef(function({treeTypeButtonClassName:t,timeTravelButtonClassName:e,timeTravelPanelSliderClassName:n,timeTravelPanelButtonClassName:r,viewClassName:s,timeTravelPanelClassName:i,editorState:o,setEditorState:a,setEditorReadOnly:l,generateContent:u,commandsLog:d=[]},f){const[h,p]=b.useState([]),[y,k]=b.useState(""),[C,M]=b.useState(!1),[v,O]=b.useState(!1),I=b.useRef(0),D=b.useRef(null),[q,F]=b.useState(!1),[$,H]=b.useState(!1),[W,_]=b.useState(!1),j=b.useRef(null),x=b.useRef([]),P=b.useRef(0),E=b.useCallback(N=>{const L=++P.current;u(N).then(U=>{L===P.current&&k(U)}).catch(U=>{L===P.current&&k(`Error rendering tree: ${U.message}

Stack:
${U.stack}`)})},[u]);b.useEffect(()=>{if(!(!W&&o._nodeMap.size>1e3&&(H(!0),!W))&&(j.current!==o||x.current!==d)){const N=j.current!==o;j.current=o,x.current=d,E(v),!C&&N&&p(L=>[...L,[Date.now(),o]])}},[o,E,v,W,C,d]);const A=h.length;return b.useEffect(()=>{if(q){let N;const L=()=>{const U=I.current;if(U===A-1)return void F(!1);const B=h[U][0],J=h[U+1][0];N=setTimeout(()=>{I.current++;const z=I.current,Y=D.current;Y!==null&&(Y.value=String(z)),a(h[z][1]),L()},J-B)};return L(),()=>{clearTimeout(N)}}},[h,q,A,a]),m.jsxs("div",{className:s,children:[!W&&$?m.jsxs("div",{style:{padding:20},children:[m.jsx("span",{style:{marginRight:20},children:"Detected large EditorState, this can impact debugging performance."}),m.jsx("button",{onClick:()=>{_(!0)},style:{background:"transparent",border:"1px solid white",color:"white",cursor:"pointer",padding:5},children:"Show full tree"})]}):null,W?null:m.jsx("button",{onClick:()=>(E(!v),void O(!v)),className:t,type:"button",children:v?"Tree":"Export DOM"}),!C&&(W||!$)&&A>2&&m.jsx("button",{onClick:()=>{l(!0),I.current=A-1,M(!0)},className:e,type:"button",children:"Time Travel"}),(W||!$)&&m.jsx("pre",{ref:f,children:y}),C&&(W||!$)&&m.jsxs("div",{className:i,children:[m.jsx("button",{className:r,onClick:()=>{I.current===A-1&&(I.current=1),F(!q)},type:"button",children:q?"Pause":"Play"}),m.jsx("input",{className:n,ref:D,onChange:N=>{const L=Number(N.target.value),U=h[L];U&&(I.current=L,a(U[1]))},type:"range",min:"1",max:A-1}),m.jsx("button",{className:r,onClick:()=>{l(!1);const N=h.length-1,L=h[N];a(L[1]);const U=D.current;U!==null&&(U.value=String(N)),M(!1),F(!1)},type:"button",children:"Exit"})]})]})});function Qg(t,e){const n=new Set;let r=0;for(const[s]of t._commands)n.add(t.registerCommand(s,i=>(e(o=>{r+=1;const a=[...o];return a.push({index:r,payload:i,type:s.type?s.type:"UNKNOWN"}),a.length>10&&a.shift(),a}),!1),Zr));return()=>n.forEach(s=>s())}function em(t){const[e,n]=b.useState([]);return b.useEffect(()=>Qg(t,n),[t]),b.useMemo(()=>e,[e])}function tm({treeTypeButtonClassName:t,timeTravelButtonClassName:e,timeTravelPanelSliderClassName:n,timeTravelPanelButtonClassName:r,timeTravelPanelClassName:s,viewClassName:i,editor:o,customPrintNode:a}){const l=b.createRef(),[u,d]=b.useState(o.getEditorState()),f=em(o);return b.useEffect(()=>Xe(o.registerUpdateListener(({editorState:h})=>{d(h)}),o.registerEditableListener(()=>{d(o.getEditorState())})),[o]),b.useEffect(()=>{const h=l.current;if(h!==null)return h.__lexicalEditor=o,()=>{h.__lexicalEditor=null}},[o,l]),m.jsx(Zg,{treeTypeButtonClassName:t,timeTravelButtonClassName:e,timeTravelPanelSliderClassName:n,timeTravelPanelButtonClassName:r,viewClassName:i,timeTravelPanelClassName:s,setEditorReadOnly:h=>{const p=o.getRootElement();p!=null&&(p.contentEditable=h?"false":"true")},editorState:u,setEditorState:h=>o.setEditorState(h),generateContent:async function(h){return zg(o,f,h,a)},ref:l,commandsLog:f})}function Rd({editorRef:t}){const[e]=ce();return b.useEffect(()=>{typeof t=="function"?t(e):typeof t=="object"&&(t.current=e)},[e]),null}function nm(t,e,n,r,s){if(t===null||n.size===0&&r.size===0&&!s)return 0;const i=e._selection,o=t._selection;if(s)return 1;if(!(X(i)&&X(o)&&o.isCollapsed()&&i.isCollapsed()))return 0;const a=function(M,v,O){const I=M._nodeMap,D=[];for(const q of v){const F=I.get(q);F!==void 0&&D.push(F)}for(const[q,F]of O){if(!F)continue;const $=I.get(q);$===void 0||ep($)||D.push($)}return D}(e,n,r);if(a.length===0)return 0;if(a.length>1){const M=e._nodeMap,v=M.get(i.anchor.key),O=M.get(o.anchor.key);return v&&O&&!t._nodeMap.has(v.__key)&&ee(v)&&v.__text.length===1&&i.anchor.offset===1?2:0}const l=a[0],u=t._nodeMap.get(l.__key);if(!ee(u)||!ee(l)||u.__mode!==l.__mode)return 0;const d=u.__text,f=l.__text;if(d===f)return 0;const h=i.anchor,p=o.anchor;if(h.key!==p.key||h.type!=="text")return 0;const y=h.offset,k=p.offset,C=f.length-d.length;return C===1&&k===y-1?2:C===-1&&k===y+1?3:C===-1&&k===y?4:0}function rm(t,e){let n=Date.now(),r=0;return(s,i,o,a,l,u)=>{const d=Date.now();if(u.has(aa))return r=0,n=d,2;const f=nm(s,i,a,l,t.isComposing()),h=(()=>{const p=o===null||o.editor===t,y=u.has(Qf);if(!y&&p&&u.has(sd))return 0;if(s===null)return 1;const k=i._selection;if(!(a.size>0||l.size>0))return k!==null?0:2;const C=typeof e=="number"?e:e.peek();return y===!1&&f!==0&&f===r&&d<n+C&&p||a.size===1&&function(M,v,O){const I=v._nodeMap.get(M),D=O._nodeMap.get(M),q=v._selection,F=O._selection;return!(X(q)&&X(F)&&q.anchor.type==="element"&&q.focus.type==="element"&&F.anchor.type==="text"&&F.focus.type==="text"||!ee(I)||!ee(D)||I.__parent!==D.__parent)&&JSON.stringify(v.read(()=>I.exportJSON()))===JSON.stringify(O.read(()=>D.exportJSON()))}(Array.from(a)[0],s,i)?0:1})();return n=d,r=f,h}}function Zl(t){t.undoStack=[],t.redoStack=[],t.current=null}function Pd(t,e,n){const r=rm(t,n);return Xe(t.registerCommand(Fa,()=>(function(i,o){const a=o.redoStack,l=o.undoStack;if(l.length!==0){const u=o.current,d=l.pop();u!==null&&(a.push(u),i.dispatchCommand(zr,!0)),l.length===0&&i.dispatchCommand(Jr,!1),o.current=d||null,d&&d.editor.setEditorState(d.editorState,{tag:aa})}}(t,e),!0),xe),t.registerCommand(La,()=>(function(i,o){const a=o.redoStack,l=o.undoStack;if(a.length!==0){const u=o.current;u!==null&&(l.push(u),i.dispatchCommand(Jr,!0));const d=a.pop();a.length===0&&i.dispatchCommand(zr,!1),o.current=d||null,d&&d.editor.setEditorState(d.editorState,{tag:aa})}}(t,e),!0),xe),t.registerCommand(rd,()=>(Zl(e),!1),xe),t.registerCommand(nd,()=>(Zl(e),t.dispatchCommand(zr,!1),t.dispatchCommand(Jr,!1),!0),xe),t.registerUpdateListener(({editorState:i,prevEditorState:o,dirtyLeaves:a,dirtyElements:l,tags:u})=>{const d=e.current,f=e.redoStack,h=e.undoStack,p=d===null?null:d.editorState;if(d!==null&&i===p)return;const y=r(o,i,d,a,l,u);if(y===1)f.length!==0&&(e.redoStack=[],t.dispatchCommand(zr,!1)),d!==null&&(h.push({...d}),t.dispatchCommand(Jr,!0));else if(y===2)return;e.current={editor:t,editorState:i}}))}function $d(){return{current:null,redoStack:[],undoStack:[]}}const Bo=id({build:(t,{delay:e,createInitialHistoryState:n,disabled:r})=>sp({delay:e,disabled:r,historyState:n(t)}),config:rp({createInitialHistoryState:$d,delay:300,disabled:typeof window>"u"}),name:"@lexical/history/History",register:(t,e,n)=>{const r=n.getOutput();return od(()=>r.disabled.value?void 0:Pd(t,r.historyState.value,r.delay))}});id({dependencies:[tp(Bo,{createInitialHistoryState:()=>{throw new Error("SharedHistory did not inherit parent history")},disabled:!0})],name:"@lexical/history/SharedHistory",register(t,e,n){const{output:r}=n.getDependency(Bo),s=function(o){return o?np(o,Bo.name):null}(t._parentEditor);if(!s)return()=>{};const i=s.output;return od(()=>ip(()=>{r.delay.value=i.delay.value,r.historyState.value=i.historyState.value,r.disabled.value=i.disabled.value}))}});function Dd({delay:t,externalHistoryState:e}){const[n]=ce();return function(r,s,i=1e3){const o=b.useMemo(()=>s||$d(),[s]);b.useEffect(()=>Pd(r,o,i),[i,r,o])}(n,e,t),null}const ua=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,sm=ua?b.useLayoutEffect:b.useEffect;let im=class{constructor(e){sn(this,"key");sn(this,"ref");this.key=e,this.ref={current:null},this.setRefElement=this.setRefElement.bind(this)}setRefElement(e){this.ref={current:e}}};const Ql=t=>{const e=document.getElementById("typeahead-menu");if(!e)return;const n=e.getBoundingClientRect();n.top+n.height>window.innerHeight&&e.scrollIntoView({block:"center"}),n.top<0&&e.scrollIntoView({block:"center"}),t.scrollIntoView({block:"nearest"})};function ec(t,e){const n=t.getBoundingClientRect(),r=e.getBoundingClientRect();return n.top>=r.top-6&&n.top<=r.bottom+6}function om(t,e,n,r){const[s]=ce();b.useEffect(()=>{if(e!=null&&t!=null){const i=s.getRootElement(),o=i!=null?function(f){let h=getComputedStyle(f);const p=h.position==="absolute",y=/(auto|scroll)/;if(h.position==="fixed")return document.body;for(let k=f;k=k.parentElement;)if(h=getComputedStyle(k),(!p||h.position!=="static")&&y.test(h.overflow+h.overflowY+h.overflowX))return k;return document.body}(i):document.body;let a=!1,l=ec(e,o);const u=function(){a||(window.requestAnimationFrame(function(){n(),a=!1}),a=!0);const f=ec(e,o);f!==l&&(l=f,r!=null&&r(f))},d=new ResizeObserver(n);return window.addEventListener("resize",n),document.addEventListener("scroll",u,{capture:!0,passive:!0}),d.observe(e),()=>{d.unobserve(e),window.removeEventListener("resize",n),document.removeEventListener("scroll",u,!0)}}},[e,s,r,n,t])}const tc=qa("SCROLL_TYPEAHEAD_OPTION_INTO_VIEW_COMMAND");function am({close:t,editor:e,anchorElementRef:n,resolution:r,options:s,menuRenderFn:i,onSelectOption:o,shouldSplitNodeWithQuery:a=!1,commandPriority:l=_r,preselectFirstItem:u=!0}){const[d,f]=b.useState(null),h=d!==null?Math.min(s.length-1,d):null,p=r.match&&r.match.matchingString;b.useEffect(()=>{u&&f(0)},[p,u]);const y=b.useCallback(C=>{e.update(()=>{const M=r.match!=null&&a?function(v){const O=re();if(!X(O)||!O.isCollapsed())return null;const I=O.anchor;if(I.type!=="text")return null;const D=I.getNode();if(!D.isSimpleText())return null;const q=I.offset,F=D.getTextContent().slice(0,q),$=v.replaceableString.length,H=q-function(_,j,x){let P=x;for(let E=P;E<=j.length;E++)_.slice(-E)===j.substring(0,E)&&(P=E);return P}(F,v.matchingString,$);if(H<0)return null;let W;return H===0?[W]=D.splitText(q):[,W]=D.splitText(H,q),W}(r.match):null;o(C,M,t,r.match?r.match.matchingString:"")})},[e,a,r.match,o,t]),k=b.useCallback(C=>{const M=e.getRootElement();M!==null&&(M.setAttribute("aria-activedescendant","typeahead-item-"+C),f(C))},[e]);return b.useEffect(()=>()=>{const C=e.getRootElement();C!==null&&C.removeAttribute("aria-activedescendant")},[e]),sm(()=>{s===null?f(null):h===null&&u&&k(0)},[s,h,k,u]),b.useEffect(()=>Xe(e.registerCommand(tc,({option:C})=>!(!C.ref||C.ref.current==null)&&(Ql(C.ref.current),!0),l)),[e,k,l]),b.useEffect(()=>Xe(e.registerCommand(up,C=>{const M=C;if(s!==null&&s.length){const v=h===null?0:h!==s.length-1?h+1:0;k(v);const O=s[v];if(!O)return k(-1),M.preventDefault(),M.stopImmediatePropagation(),!0;O.ref&&O.ref.current&&e.dispatchCommand(tc,{index:v,option:O}),M.preventDefault(),M.stopImmediatePropagation()}return!0},l),e.registerCommand(cp,C=>{const M=C;if(s!==null&&s.length){const v=h===null?s.length-1:h!==0?h-1:s.length-1;k(v);const O=s[v];if(!O)return k(-1),M.preventDefault(),M.stopImmediatePropagation(),!0;O.ref&&O.ref.current&&Ql(O.ref.current),M.preventDefault(),M.stopImmediatePropagation()}return!0},l),e.registerCommand(ld,C=>{const M=C;return M.preventDefault(),M.stopImmediatePropagation(),t(),!0},l),e.registerCommand(lp,C=>{const M=C;return s!==null&&h!==null&&s[h]!=null&&(M.preventDefault(),M.stopImmediatePropagation(),y(s[h]),!0)},l),e.registerCommand(ad,C=>s!==null&&h!==null&&s[h]!=null&&(C!==null&&(C.preventDefault(),C.stopImmediatePropagation()),y(s[h]),!0),l)),[y,t,e,s,h,k,l]),i(n,b.useMemo(()=>({options:s,selectOptionAndCleanUp:y,selectedIndex:h,setHighlightedIndex:f}),[y,h,s]),r.match?r.match.matchingString:"")}function nc(t,e){e!=null&&(t.className=e),t.setAttribute("aria-label","Typeahead menu"),t.setAttribute("role","listbox"),t.style.display="block",t.style.position="absolute"}function lm({options:t,onWillOpen:e,onClose:n,onOpen:r,onSelectOption:s,menuRenderFn:i,anchorClassName:o,commandPriority:a=_r,parent:l}){const[u]=ce(),[d,f]=b.useState(null),h=b.useRef(null),p=function(v,O,I,D=ua?document.body:void 0,q=!0){const[F]=ce(),$=ua?document.createElement("div"):null,H=b.useRef($),W=b.useCallback(()=>{if(H.current===null||D===void 0)return;H.current.style.top=H.current.style.bottom;const j=F.getRootElement(),x=H.current,P=x.firstChild;if(j!==null&&v!==null){const{left:E,top:A,width:N,height:L}=v.getRect(),U=H.current.offsetHeight;if(x.style.top=`${A+U+3+(q?window.pageYOffset:0)}px`,x.style.left=`${E+window.pageXOffset}px`,x.style.height=`${L}px`,x.style.width=`${N}px`,P!==null){P.style.top=`${A}`;const B=P.getBoundingClientRect(),J=B.height,z=B.width,Y=j.getBoundingClientRect();E+z>Y.right&&(x.style.left=`${Y.right-z+window.pageXOffset}px`),(A+J>window.innerHeight||A+J>Y.bottom)&&A-Y.top>J+L&&(x.style.top=`${A-J-L+(q?window.pageYOffset:0)}px`)}x.isConnected||(nc(x,I),D.append(x)),x.setAttribute("id","typeahead-menu"),j.setAttribute("aria-controls","typeahead-menu")}},[F,v,q,I,D]);b.useEffect(()=>{const j=F.getRootElement();return v!==null&&W(),()=>{j!==null&&j.removeAttribute("aria-controls");const x=H.current;x!==null&&x.isConnected&&(x.remove(),x.removeAttribute("id"))}},[F,W,v]);const _=b.useCallback(j=>{v!==null&&(j||O(null))},[v,O]);return om(v,H.current,W,_),$!=null&&$===H.current&&(nc($,I),D!=null&&D.append($)),H}(d,f,o,l),y=b.useCallback(()=>{f(null),n!=null&&d!==null&&n()},[n,d]),k=b.useCallback(v=>{f(v),r!=null&&d===null&&r(v)},[r,d]),C=b.useCallback(v=>{v.preventDefault(),e!=null&&e(v);const O=op(v.target);k({getRect:()=>new DOMRect(v.clientX/O,v.clientY/O,1,1)})},[k,e]),M=b.useCallback(v=>{d!==null&&h.current!=null&&v.target!=null&&ap(v.target)&&!h.current.contains(v.target)&&y()},[y,d]);return b.useEffect(()=>{const v=u.getRootElement();if(v)return v.addEventListener("contextmenu",C),()=>v.removeEventListener("contextmenu",C)},[u,C]),b.useEffect(()=>(document.addEventListener("click",M),()=>document.removeEventListener("click",M)),[u,M]),p.current===null||d===null||u===null?null:m.jsx(am,{close:y,resolution:d,editor:u,anchorElementRef:p,options:t,menuRenderFn:(v,O)=>i(v,O,{setMenuRef:I=>{h.current=I}}),onSelectOption:s,commandPriority:a})}const rc=[["Cat","rgb(125, 50, 0)"],["Dog","rgb(100, 0, 0)"],["Rabbit","rgb(150, 0, 0)"],["Frog","rgb(200, 0, 0)"],["Fox","rgb(200, 75, 0)"],["Hedgehog","rgb(0, 75, 0)"],["Pigeon","rgb(0, 125, 0)"],["Squirrel","rgb(75, 100, 0)"],["Bear","rgb(125, 100, 0)"],["Tiger","rgb(0, 0, 150)"],["Leopard","rgb(0, 0, 200)"],["Zebra","rgb(0, 0, 250)"],["Wolf","rgb(0, 100, 150)"],["Owl","rgb(0, 100, 100)"],["Gull","rgb(100, 0, 100)"],["Squid","rgb(150, 0, 150)"]],sc=rc[Math.floor(Math.random()*rc.length)],Ld=b.createContext(null);function Fd(){return{color:sc[1],isCollabActive:!1,name:sc[0],yjsDocMap:new Map}}const cm=Fd();function um({children:t}){const e=b.useMemo(()=>Fd(),[]);return m.jsx(Ld.Provider,{value:e,children:t})}function qd(t,e){let n=b.useContext(Ld);return n==null&&function(r,...s){const i=new URL("https://lexical.dev/docs/error"),o=new URLSearchParams;o.append("code",r);for(const a of s)o.append("v",a);i.search=o.toString(),console.warn(`Minified Lexical warning #${r}; visit ${i.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}(319),n=n??cm,n}const qn=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,dm=qn&&"documentMode"in document?document.documentMode:null,hm=qn&&/Mac|iPod|iPhone|iPad/.test(navigator.platform),fm=!(!qn||!("InputEvent"in window)||dm)&&"getTargetRanges"in new window.InputEvent("input"),pm=qn&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent),ic=qn&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,gm=qn&&/^(?=.*Chrome).*/i.test(navigator.userAgent),mm=qn&&/AppleWebKit\/[\d.]+/.test(navigator.userAgent)&&hm&&!gm;function oc(t,e){e.update(()=>{if(t!==null){const n=ud(t,KeyboardEvent)?null:t.clipboardData,r=re();if(r!==null&&!r.isCollapsed()&&n!=null){t.preventDefault();const s=Cp(e);s!==null&&n.setData("text/html",s),n.setData("text/plain",r.getTextContent())}}})}function ym(t){return Xe(t.registerCommand(Lo,e=>{const n=re();return!!X(n)&&(n.deleteCharacter(e),!0)},xe),t.registerCommand(xp,e=>{const n=re();return!!X(n)&&(n.deleteWord(e),!0)},xe),t.registerCommand(wp,e=>{const n=re();return!!X(n)&&(n.deleteLine(e),!0)},xe),t.registerCommand(vp,e=>{const n=re();if(!X(n))return!1;if(typeof e=="string")n.insertText(e);else{const r=e.dataTransfer;if(r!=null)Nl(r,n);else{const s=e.data;s&&n.insertText(s)}}return!0},xe),t.registerCommand(kp,()=>{const e=re();return!!X(e)&&(e.removeText(),!0)},xe),t.registerCommand(Il,e=>{const n=re();return!!X(n)&&(n.insertLineBreak(e),!0)},xe),t.registerCommand(_p,()=>{const e=re();return!!X(e)&&(e.insertLineBreak(),!0)},xe),t.registerCommand(bp,e=>{const n=re();if(!X(n))return!1;const r=e,s=r.shiftKey;return!!Rl(n,!0)&&(r.preventDefault(),Pl(n,s,!0),!0)},xe),t.registerCommand(yp,e=>{const n=re();if(!X(n))return!1;const r=e,s=r.shiftKey;return!!Rl(n,!1)&&(r.preventDefault(),Pl(n,s,!1),!0)},xe),t.registerCommand(mp,e=>{const n=re();return!!X(n)&&(!ic||navigator.language!=="ko-KR")&&(e.preventDefault(),t.dispatchCommand(Lo,!0))},xe),t.registerCommand(gp,e=>{const n=re();return!!X(n)&&(e.preventDefault(),t.dispatchCommand(Lo,!1))},xe),t.registerCommand(ad,e=>{const n=re();if(!X(n))return!1;if(e!==null){if((ic||pm||mm)&&fm)return!1;e.preventDefault()}return t.dispatchCommand(Il,!1)},xe),t.registerCommand(fp,()=>(pp(),!0),xe),t.registerCommand(qi,e=>{const n=re();return!!X(n)&&(oc(e,t),!0)},xe),t.registerCommand(Fi,e=>{const n=re();return!!X(n)&&(function(r,s){oc(r,s),s.update(()=>{const i=re();X(i)&&i.removeText()})}(e,t),!0)},xe),t.registerCommand(Li,e=>{const n=re();return!!X(n)&&(function(r,s){r.preventDefault(),s.update(()=>{const i=re(),o=ud(r,ClipboardEvent)?r.clipboardData:null;o!=null&&X(i)&&Nl(o,i)},{tag:hp})}(e,t),!0)},xe),t.registerCommand(cd,e=>{const n=re();return!!X(n)&&(e.preventDefault(),!0)},xe),t.registerCommand(dp,e=>{const n=re();return!!X(n)&&(e.preventDefault(),!0)},xe))}function bm(t,...e){const n=new URL("https://lexical.dev/docs/error"),r=new URLSearchParams;r.append("code",t);for(const s of e)r.append("v",s);throw n.search=r.toString(),Error(`Minified Lexical error #${t}; visit ${n.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}const Ja=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0?b.useLayoutEffect:b.useEffect;function _m({editor:t,ErrorBoundary:e}){return function(n,r){const[s,i]=b.useState(()=>n.getDecorators());return Ja(()=>n.registerDecoratorListener(o=>{At.flushSync(()=>{i(o)})}),[n]),b.useEffect(()=>{i(n.getDecorators())},[n]),b.useMemo(()=>{const o=[],a=Object.keys(s);for(let l=0;l<a.length;l++){const u=a[l],d=m.jsx(r,{onError:h=>n._onError(h),children:m.jsx(b.Suspense,{fallback:null,children:s[u]})}),f=n.getElementByKey(u);f!==null&&o.push(At.createPortal(d,f,u))}return o},[r,s,n])}(t,e)}function km({editor:t,ErrorBoundary:e}){return function(n){const r=Ep.maybeFromEditor(n);if(r&&r.hasExtensionByName(Op.name)){for(const s of["@lexical/plain-text","@lexical/rich-text"])r.hasExtensionByName(s)&&bm(320,s);return!0}return!1}(t)?null:m.jsx(_m,{editor:t,ErrorBoundary:e})}function ac(t){return t.getEditorState().read(Mp(t.isComposing()))}function vm({contentEditable:t,placeholder:e=null,ErrorBoundary:n}){const[r]=ce();return function(s){Ja(()=>Xe(ym(s),Sp(s)),[s])}(r),m.jsxs(m.Fragment,{children:[t,m.jsx(wm,{content:e}),m.jsx(km,{editor:r,ErrorBoundary:n})]})}function wm({content:t}){const[e]=ce(),n=function(s){const[i,o]=b.useState(()=>ac(s));return Ja(()=>{function a(){const l=ac(s);o(l)}return a(),Xe(s.registerUpdateListener(()=>{a()}),s.registerEditableListener(()=>{a()}))},[s]),i}(e),r=Tp();return n?typeof t=="function"?t(r):t:null}const Nt=()=>new Map,da=t=>{const e=Nt();return t.forEach((n,r)=>{e.set(r,n)}),e},wr=(t,e,n)=>{let r=t.get(e);return r===void 0&&t.set(e,r=n()),r},xm=(t,e)=>{const n=[];for(const[r,s]of t)n.push(e(s,r));return n},Cm=(t,e)=>{for(const[n,r]of t)if(e(r,n))return!0;return!1},ar=()=>new Set,Ho=t=>t[t.length-1],lr=Array.from,Sm=Array.isArray;class Tm{constructor(){this._observers=Nt()}on(e,n){return wr(this._observers,e,ar).add(n),n}once(e,n){const r=(...s)=>{this.off(e,r),n(...s)};this.on(e,r)}off(e,n){const r=this._observers.get(e);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(e))}emit(e,n){return lr((this._observers.get(e)||Nt()).values()).forEach(r=>r(...n))}destroy(){this._observers=Nt()}}const Rn=Math.floor,gi=Math.abs,Ud=(t,e)=>t<e?t:e,xr=(t,e)=>t>e?t:e,Em=t=>t!==0?t<0:1/t<0,lc=1,cc=2,Wo=4,Ko=8,Om=32,Bd=64,wi=128,Mm=31,uc=63,ns=127,Am=2147483647,jm=Number.isInteger||(t=>typeof t=="number"&&isFinite(t)&&Rn(t)===t),Nm=t=>t.toLowerCase(),Im=/^\s*/g,Rm=t=>t.replace(Im,""),Pm=/([A-Z])/g,dc=(t,e)=>Rm(t.replace(Pm,n=>`${e}${Nm(n)}`)),$m=t=>{const e=unescape(encodeURIComponent(t)),n=e.length,r=new Uint8Array(n);for(let s=0;s<n;s++)r[s]=e.codePointAt(s);return r},os=typeof TextEncoder<"u"?new TextEncoder:null,Dm=t=>os.encode(t),Lm=os?Dm:$m;let zo=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});zo&&zo.decode(new Uint8Array).length===1&&(zo=null);class bs{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const Va=()=>new bs,Fm=t=>{let e=t.cpos;for(let n=0;n<t.bufs.length;n++)e+=t.bufs[n].length;return e},zt=t=>{const e=new Uint8Array(Fm(t));let n=0;for(let r=0;r<t.bufs.length;r++){const s=t.bufs[r];e.set(s,n),n+=s.length}return e.set(new Uint8Array(t.cbuf.buffer,0,t.cpos),n),e},qm=(t,e)=>{const n=t.cbuf.length;n-t.cpos<e&&(t.bufs.push(new Uint8Array(t.cbuf.buffer,0,t.cpos)),t.cbuf=new Uint8Array(xr(n,e)*2),t.cpos=0)},Re=(t,e)=>{const n=t.cbuf.length;t.cpos===n&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(n*2),t.cpos=0),t.cbuf[t.cpos++]=e},ha=Re,be=(t,e)=>{for(;e>ns;)Re(t,wi|ns&e),e=Rn(e/128);Re(t,ns&e)},Ga=(t,e)=>{const n=Em(e);for(n&&(e=-e),Re(t,(e>uc?wi:0)|(n?Bd:0)|uc&e),e=Rn(e/64);e>0;)Re(t,(e>ns?wi:0)|ns&e),e=Rn(e/128)},fa=new Uint8Array(3e4),Um=fa.length/3,Bm=(t,e)=>{if(e.length<Um){const n=os.encodeInto(e,fa).written||0;be(t,n);for(let r=0;r<n;r++)Re(t,fa[r])}else st(t,Lm(e))},Hm=(t,e)=>{const n=unescape(encodeURIComponent(e)),r=n.length;be(t,r);for(let s=0;s<r;s++)Re(t,n.codePointAt(s))},ir=os&&os.encodeInto?Bm:Hm,Ya=(t,e)=>{const n=t.cbuf.length,r=t.cpos,s=Ud(n-r,e.length),i=e.length-s;t.cbuf.set(e.subarray(0,s),r),t.cpos+=s,i>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(xr(n*2,i)),t.cbuf.set(e.subarray(s)),t.cpos=i)},st=(t,e)=>{be(t,e.byteLength),Ya(t,e)},Xa=(t,e)=>{qm(t,e);const n=new DataView(t.cbuf.buffer,t.cpos,e);return t.cpos+=e,n},Wm=(t,e)=>Xa(t,4).setFloat32(0,e,!1),Km=(t,e)=>Xa(t,8).setFloat64(0,e,!1),zm=(t,e)=>Xa(t,8).setBigInt64(0,e,!1),hc=new DataView(new ArrayBuffer(4)),Jm=t=>(hc.setFloat32(0,t),hc.getFloat32(0)===t),as=(t,e)=>{switch(typeof e){case"string":Re(t,119),ir(t,e);break;case"number":jm(e)&&gi(e)<=Am?(Re(t,125),Ga(t,e)):Jm(e)?(Re(t,124),Wm(t,e)):(Re(t,123),Km(t,e));break;case"bigint":Re(t,122),zm(t,e);break;case"object":if(e===null)Re(t,126);else if(Sm(e)){Re(t,117),be(t,e.length);for(let n=0;n<e.length;n++)as(t,e[n])}else if(e instanceof Uint8Array)Re(t,116),st(t,e);else{Re(t,118);const n=Object.keys(e);be(t,n.length);for(let r=0;r<n.length;r++){const s=n[r];ir(t,s),as(t,e[s])}}break;case"boolean":Re(t,e?120:121);break;default:Re(t,127)}};class fc extends bs{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&be(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const pc=t=>{t.count>0&&(Ga(t.encoder,t.count===1?t.s:-t.s),t.count>1&&be(t.encoder,t.count-2))};class mi{constructor(){this.encoder=new bs,this.s=0,this.count=0}write(e){this.s===e?this.count++:(pc(this),this.count=1,this.s=e)}toUint8Array(){return pc(this),zt(this.encoder)}}const gc=t=>{if(t.count>0){const e=t.diff*2+(t.count===1?0:1);Ga(t.encoder,e),t.count>1&&be(t.encoder,t.count-2)}};class Jo{constructor(){this.encoder=new bs,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(gc(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return gc(this),zt(this.encoder)}}class Vm{constructor(){this.sarr=[],this.s="",this.lensE=new mi}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new bs;return this.sarr.push(this.s),this.s="",ir(e,this.sarr.join("")),Ya(e,this.lensE.toUint8Array()),zt(e)}}const cr=t=>new Error(t),It=()=>{throw cr("Method unimplemented")},Pn=()=>{throw cr("Unexpected case")},Gm=crypto.getRandomValues.bind(crypto),Hd=()=>Gm(new Uint32Array(1))[0],Ym="10000000-1000-4000-8000"+-1e11,Xm=()=>Ym.replace(/[018]/g,t=>(t^Hd()&15>>t/4).toString(16)),mc=t=>new Promise(t);Promise.all.bind(Promise);const yc=t=>t===void 0?null:t;class Zm{constructor(){this.map=new Map}setItem(e,n){this.map.set(e,n)}getItem(e){return this.map.get(e)}}let Wd=new Zm,Qm=!0;try{typeof localStorage<"u"&&localStorage&&(Wd=localStorage,Qm=!1)}catch{}const ey=Wd,ty=Object.assign,ny=Object.keys,ry=(t,e)=>{for(const n in t)e(t[n],n)},bc=t=>ny(t).length,sy=t=>{for(const e in t)return!1;return!0},iy=(t,e)=>{for(const n in t)if(!e(t[n],n))return!1;return!0},oy=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),ay=(t,e)=>t===e||bc(t)===bc(e)&&iy(t,(n,r)=>(n!==void 0||oy(e,r))&&e[r]===n),ly=Object.freeze,Kd=t=>{for(const e in t){const n=t[e];(typeof n=="object"||typeof n=="function")&&Kd(t[e])}return ly(t)},Za=(t,e,n=0)=>{try{for(;n<t.length;n++)t[n](...e)}finally{n<t.length&&Za(t,e,n+1)}},cy=(t,e)=>e.includes(t);var zd={};const ls=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";let Tt;const uy=()=>{if(Tt===void 0)if(ls){Tt=Nt();const t=process.argv;let e=null;for(let n=0;n<t.length;n++){const r=t[n];r[0]==="-"?(e!==null&&Tt.set(e,""),e=r):e!==null&&(Tt.set(e,r),e=null)}e!==null&&Tt.set(e,"")}else typeof location=="object"?(Tt=Nt(),(location.search||"?").slice(1).split("&").forEach(t=>{if(t.length!==0){const[e,n]=t.split("=");Tt.set(`--${dc(e,"-")}`,n),Tt.set(`-${dc(e,"-")}`,n)}})):Tt=Nt();return Tt},pa=t=>uy().has(t),xi=t=>yc(ls?zd[t.toUpperCase().replaceAll("-","_")]:ey.getItem(t)),Jd=t=>pa("--"+t)||xi(t)!==null;Jd("production");const dy=ls&&cy(zd.FORCE_COLOR,["true","1","2"]),hy=dy||!pa("--no-colors")&&!Jd("no-color")&&(!ls||process.stdout.isTTY)&&(!ls||pa("--color")||xi("COLORTERM")!==null||(xi("TERM")||"").includes("color"));class fy{constructor(e,n){this.left=e,this.right=n}}const Ht=(t,e)=>new fy(t,e);typeof DOMParser<"u"&&new DOMParser;const py=t=>xm(t,(e,n)=>`${n}:${e};`).join(""),Xt=Symbol,Vd=Xt(),Gd=Xt(),gy=Xt(),my=Xt(),yy=Xt(),Yd=Xt(),by=Xt(),Qa=Xt(),_y=Xt(),ky=t=>{var s;t.length===1&&((s=t[0])==null?void 0:s.constructor)===Function&&(t=t[0]());const e=[],n=[];let r=0;for(;r<t.length;r++){const i=t[r];if(i===void 0)break;if(i.constructor===String||i.constructor===Number)e.push(i);else if(i.constructor===Object)break}for(r>0&&n.push(e.join(""));r<t.length;r++){const i=t[r];i instanceof Symbol||n.push(i)}return n},vy={[Vd]:Ht("font-weight","bold"),[Gd]:Ht("font-weight","normal"),[gy]:Ht("color","blue"),[yy]:Ht("color","green"),[my]:Ht("color","grey"),[Yd]:Ht("color","red"),[by]:Ht("color","purple"),[Qa]:Ht("color","orange"),[_y]:Ht("color","black")},wy=t=>{var o;t.length===1&&((o=t[0])==null?void 0:o.constructor)===Function&&(t=t[0]());const e=[],n=[],r=Nt();let s=[],i=0;for(;i<t.length;i++){const a=t[i],l=vy[a];if(l!==void 0)r.set(l.left,l.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const u=py(r);i>0||u.length>0?(e.push("%c"+a),n.push(u)):e.push(a)}else break}}for(i>0&&(s=n,s.unshift(e.join("")));i<t.length;i++){const a=t[i];a instanceof Symbol||s.push(a)}return s},Xd=hy?wy:ky,xy=(...t)=>{console.log(...Xd(t)),Zd.forEach(e=>e.print(t))},Cy=(...t)=>{console.warn(...Xd(t)),t.unshift(Qa),Zd.forEach(e=>e.print(t))},Zd=ar(),Qd=t=>({[Symbol.iterator](){return this},next:t}),Sy=(t,e)=>Qd(()=>{let n;do n=t.next();while(!n.done&&!e(n.value));return n}),Vo=(t,e)=>Qd(()=>{const{done:n,value:r}=t.next();return{done:n,value:n?void 0:e(r)}});class Ty{constructor(e,n){this.clock=e,this.len=n}}class Ey{constructor(){this.clients=new Map}}const eh=(t,e,n)=>e.clients.forEach((r,s)=>{const i=t.doc.store.clients.get(s);if(i!=null){const o=i[i.length-1],a=o.id.clock+o.length;for(let l=0,u=r[l];l<r.length&&u.clock<a;u=r[++l])ah(t,i,u.clock,u.len,n)}}),Oy=(t,e)=>{let n=0,r=t.length-1;for(;n<=r;){const s=Rn((n+r)/2),i=t[s],o=i.clock;if(o<=e){if(e<o+i.len)return s;n=s+1}else r=s-1}return null},th=(t,e)=>{const n=t.clients.get(e.client);return n!==void 0&&Oy(n,e.clock)!==null},nh=t=>{t.clients.forEach(e=>{e.sort((s,i)=>s.clock-i.clock);let n,r;for(n=1,r=1;n<e.length;n++){const s=e[r-1],i=e[n];s.clock+s.len>=i.clock?s.len=xr(s.len,i.clock+i.len-s.clock):(r<n&&(e[r]=i),r++)}e.length=r})},rh=(t,e,n,r)=>{wr(t.clients,e,()=>[]).push(new Ty(n,r))},My=(t,e)=>{be(t.restEncoder,e.clients.size),lr(e.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{t.resetDsCurVal(),be(t.restEncoder,n);const s=r.length;be(t.restEncoder,s);for(let i=0;i<s;i++){const o=r[i];t.writeDsClock(o.clock),t.writeDsLen(o.len)}})},sh=Hd;class _s extends Tm{constructor({guid:e=Xm(),collectionid:n=null,gc:r=!0,gcFilter:s=()=>!0,meta:i=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=s,this.clientID=sh(),this.guid=e,this.collectionid=n,this.share=new Map,this.store=new Fy,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=i,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=mc(u=>{this.on("load",()=>{this.isLoaded=!0,u(this)})});const l=()=>mc(u=>{const d=f=>{(f===void 0||f===!0)&&(this.off("sync",d),u())};this.on("sync",d)});this.on("sync",u=>{u===!1&&this.isSynced&&(this.whenSynced=l()),this.isSynced=u===void 0||u===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=l()}load(){const e=this._item;e!==null&&!this.shouldLoad&&ke(e.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(lr(this.subdocs).map(e=>e.guid))}transact(e,n=null){return ke(this,e,n)}get(e,n=qe){const r=wr(this.share,e,()=>{const i=new n;return i._integrate(this,null),i}),s=r.constructor;if(n!==qe&&s!==n)if(s===qe){const i=new n;i._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=i}),i._start=r._start;for(let o=i._start;o!==null;o=o.right)o.parent=i;return i._length=r._length,this.share.set(e,i),i._integrate(this,null),i}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,In)}getText(e=""){return this.get(e,Ti)}getMap(e=""){return this.get(e,ur)}getXmlElement(e=""){return this.get(e,ds)}getXmlFragment(e=""){return this.get(e,dr)}toJSON(){const e={};return this.share.forEach((n,r)=>{e[r]=n.toJSON()}),e}destroy(){this.isDestroyed=!0,lr(this.subdocs).forEach(n=>n.destroy());const e=this._item;if(e!==null){this._item=null;const n=e.content;n.doc=new _s({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=e,ke(e.parent.doc,r=>{const s=n.doc;e.deleted||r.subdocsAdded.add(s),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class Ay{constructor(){this.restEncoder=Va()}toUint8Array(){return zt(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){be(this.restEncoder,e)}writeDsLen(e){be(this.restEncoder,e)}}class jy extends Ay{writeLeftID(e){be(this.restEncoder,e.client),be(this.restEncoder,e.clock)}writeRightID(e){be(this.restEncoder,e.client),be(this.restEncoder,e.clock)}writeClient(e){be(this.restEncoder,e)}writeInfo(e){ha(this.restEncoder,e)}writeString(e){ir(this.restEncoder,e)}writeParentInfo(e){be(this.restEncoder,e?1:0)}writeTypeRef(e){be(this.restEncoder,e)}writeLen(e){be(this.restEncoder,e)}writeAny(e){as(this.restEncoder,e)}writeBuf(e){st(this.restEncoder,e)}writeJSON(e){ir(this.restEncoder,JSON.stringify(e))}writeKey(e){ir(this.restEncoder,e)}}class Ny{constructor(){this.restEncoder=Va(),this.dsCurrVal=0}toUint8Array(){return zt(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const n=e-this.dsCurrVal;this.dsCurrVal=e,be(this.restEncoder,n)}writeDsLen(e){e===0&&Pn(),be(this.restEncoder,e-1),this.dsCurrVal+=e}}class Iy extends Ny{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Jo,this.clientEncoder=new mi,this.leftClockEncoder=new Jo,this.rightClockEncoder=new Jo,this.infoEncoder=new fc(ha),this.stringEncoder=new Vm,this.parentInfoEncoder=new fc(ha),this.typeRefEncoder=new mi,this.lenEncoder=new mi}toUint8Array(){const e=Va();return be(e,0),st(e,this.keyClockEncoder.toUint8Array()),st(e,this.clientEncoder.toUint8Array()),st(e,this.leftClockEncoder.toUint8Array()),st(e,this.rightClockEncoder.toUint8Array()),st(e,zt(this.infoEncoder)),st(e,this.stringEncoder.toUint8Array()),st(e,zt(this.parentInfoEncoder)),st(e,this.typeRefEncoder.toUint8Array()),st(e,this.lenEncoder.toUint8Array()),Ya(e,zt(this.restEncoder)),zt(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){as(this.restEncoder,e)}writeBuf(e){st(this.restEncoder,e)}writeJSON(e){as(this.restEncoder,e)}writeKey(e){const n=this.keyMap.get(e);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(n)}}const Ry=(t,e,n,r)=>{r=xr(r,e[0].id.clock);const s=Jt(e,r);be(t.restEncoder,e.length-s),t.writeClient(n),be(t.restEncoder,r);const i=e[s];i.write(t,r-i.id.clock);for(let o=s+1;o<e.length;o++)e[o].write(t,0)},Py=(t,e,n)=>{const r=new Map;n.forEach((s,i)=>{tt(e,i)>s&&r.set(i,s)}),el(e).forEach((s,i)=>{n.has(i)||r.set(i,0)}),be(t.restEncoder,r.size),lr(r.entries()).sort((s,i)=>i[0]-s[0]).forEach(([s,i])=>{Ry(t,e.clients.get(s),s,i)})},$y=(t,e)=>Py(t,e.doc.store,e.beforeState);class Dy{constructor(){this.l=[]}}const _c=()=>new Dy,kc=(t,e)=>t.l.push(e),vc=(t,e)=>{const n=t.l,r=n.length;t.l=n.filter(s=>e!==s),r===t.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},ih=(t,e,n)=>Za(t.l,[e,n]);class yi{constructor(e,n){this.client=e,this.clock=n}}const Vs=(t,e)=>t===e||t!==null&&e!==null&&t.client===e.client&&t.clock===e.clock,Se=(t,e)=>new yi(t,e),Ly=t=>{for(const[e,n]of t.doc.share.entries())if(n===t)return e;throw Pn()},nr=(t,e)=>e===void 0?!t.deleted:e.sv.has(t.id.client)&&(e.sv.get(t.id.client)||0)>t.id.clock&&!th(e.ds,t.id),ga=(t,e)=>{const n=wr(t.meta,ga,ar),r=t.doc.store;n.has(e)||(e.sv.forEach((s,i)=>{s<tt(r,i)&&dn(t,Se(i,s))}),eh(t,e.ds,s=>{}),n.add(e))};class Fy{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const el=t=>{const e=new Map;return t.clients.forEach((n,r)=>{const s=n[n.length-1];e.set(r,s.id.clock+s.length)}),e},tt=(t,e)=>{const n=t.clients.get(e);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},oh=(t,e)=>{let n=t.clients.get(e.id.client);if(n===void 0)n=[],t.clients.set(e.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==e.id.clock)throw Pn()}n.push(e)},Jt=(t,e)=>{let n=0,r=t.length-1,s=t[r],i=s.id.clock;if(i===e)return r;let o=Rn(e/(i+s.length-1)*r);for(;n<=r;){if(s=t[o],i=s.id.clock,i<=e){if(e<i+s.length)return o;n=o+1}else r=o-1;o=Rn((n+r)/2)}throw Pn()},qy=(t,e)=>{const n=t.clients.get(e.client);return n[Jt(n,e.clock)]},Go=qy,ma=(t,e,n)=>{const r=Jt(e,n),s=e[r];return s.id.clock<n&&s instanceof Ke?(e.splice(r+1,0,Th(t,s,n-s.id.clock)),r+1):r},dn=(t,e)=>{const n=t.doc.store.clients.get(e.client);return n[ma(t,n,e.clock)]},wc=(t,e,n)=>{const r=e.clients.get(n.client),s=Jt(r,n.clock),i=r[s];return n.clock!==i.id.clock+i.length-1&&i.constructor!==an&&r.splice(s+1,0,Th(t,i,n.clock-i.id.clock+1)),i},Uy=(t,e,n)=>{const r=t.clients.get(e.id.client);r[Jt(r,e.id.clock)]=n},ah=(t,e,n,r,s)=>{if(r===0)return;const i=n+r;let o=ma(t,e,n),a;do a=e[o++],i<a.id.clock+a.length&&ma(t,e,i),s(a);while(o<e.length&&e[o].id.clock<i)};class By{constructor(e,n,r){this.doc=e,this.deleteSet=new Ey,this.beforeState=el(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const xc=(t,e)=>e.deleteSet.clients.size===0&&!Cm(e.afterState,(n,r)=>e.beforeState.get(r)!==n)?!1:(nh(e.deleteSet),$y(t,e),My(t,e.deleteSet),!0),Cc=(t,e,n)=>{const r=e._item;(r===null||r.id.clock<(t.beforeState.get(r.id.client)||0)&&!r.deleted)&&wr(t.changed,e,ar).add(n)},bi=(t,e)=>{let n=t[e],r=t[e-1],s=e;for(;s>0;n=r,r=t[--s-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof Ke&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const i=e-s;return i&&t.splice(e+1-i,i),i},Hy=(t,e,n)=>{for(const[r,s]of t.clients.entries()){const i=e.clients.get(r);for(let o=s.length-1;o>=0;o--){const a=s[o],l=a.clock+a.len;for(let u=Jt(i,a.clock),d=i[u];u<i.length&&d.id.clock<l;d=i[++u]){const f=i[u];if(a.clock+a.len<=f.id.clock)break;f instanceof Ke&&f.deleted&&!f.keep&&n(f)&&f.gc(e,!1)}}}},Wy=(t,e)=>{t.clients.forEach((n,r)=>{const s=e.clients.get(r);for(let i=n.length-1;i>=0;i--){const o=n[i],a=Ud(s.length-1,1+Jt(s,o.clock+o.len-1));for(let l=a,u=s[l];l>0&&u.id.clock>=o.clock;u=s[l])l-=1+bi(s,l)}})},lh=(t,e)=>{if(e<t.length){const n=t[e],r=n.doc,s=r.store,i=n.deleteSet,o=n._mergeStructs;try{nh(i),n.afterState=el(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((l,u)=>a.push(()=>{(u._item===null||!u._item.deleted)&&u._callObserver(n,l)})),a.push(()=>{n.changedParentTypes.forEach((l,u)=>{u._dEH.l.length>0&&(u._item===null||!u._item.deleted)&&(l=l.filter(d=>d.target._item===null||!d.target._item.deleted),l.forEach(d=>{d.currentTarget=u,d._path=null}),l.sort((d,f)=>d.path.length-f.path.length),ih(u._dEH,l,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),Za(a,[]),n._needFormattingCleanup&&tb(n)}finally{r.gc&&Hy(i,s,r.gcFilter),Wy(i,s),n.afterState.forEach((d,f)=>{const h=n.beforeState.get(f)||0;if(h!==d){const p=s.clients.get(f),y=xr(Jt(p,h),1);for(let k=p.length-1;k>=y;)k-=1+bi(p,k)}});for(let d=o.length-1;d>=0;d--){const{client:f,clock:h}=o[d].id,p=s.clients.get(f),y=Jt(p,h);y+1<p.length&&bi(p,y+1)>1||y>0&&bi(p,y)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(xy(Qa,Vd,"[yjs] ",Gd,Yd,"Changed the client-id because another client seems to be using it."),r.clientID=sh()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const d=new jy;xc(d,n)&&r.emit("update",[d.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const d=new Iy;xc(d,n)&&r.emit("updateV2",[d.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:l,subdocsRemoved:u}=n;(a.size>0||u.size>0||l.size>0)&&(a.forEach(d=>{d.clientID=r.clientID,d.collectionid==null&&(d.collectionid=r.collectionid),r.subdocs.add(d)}),u.forEach(d=>r.subdocs.delete(d)),r.emit("subdocs",[{loaded:l,added:a,removed:u},r,n]),u.forEach(d=>d.destroy())),t.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,t])):lh(t,e+1)}}},ke=(t,e,n=null,r=!0)=>{const s=t._transactionCleanups;let i=!1,o=null;t._transaction===null&&(i=!0,t._transaction=new By(t,n,r),s.push(t._transaction),s.length===1&&t.emit("beforeAllTransactions",[t]),t.emit("beforeTransaction",[t._transaction,t]));try{o=e(t._transaction)}finally{if(i){const a=t._transaction===s[0];t._transaction=null,a&&lh(s,0)}}return o},Sc="You must not compute changes after the event-handler fired.";class Bi{constructor(e,n){this.target=e,this.currentTarget=e,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=Ky(this.currentTarget,this.target))}deletes(e){return th(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw cr(Sc);const e=new Map,n=this.target;this.transaction.changed.get(n).forEach(s=>{if(s!==null){const i=n._map.get(s);let o,a;if(this.adds(i)){let l=i.left;for(;l!==null&&this.adds(l);)l=l.left;if(this.deletes(i))if(l!==null&&this.deletes(l))o="delete",a=Ho(l.content.getContent());else return;else l!==null&&this.deletes(l)?(o="update",a=Ho(l.content.getContent())):(o="add",a=void 0)}else if(this.deletes(i))o="delete",a=Ho(i.content.getContent());else return;e.set(s,{action:o,oldValue:a})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw cr(Sc);const n=this.target,r=ar(),s=ar(),i=[];if(e={added:r,deleted:s,delta:i,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const l=()=>{a&&i.push(a)};for(let u=n._start;u!==null;u=u.right)u.deleted?this.deletes(u)&&!this.adds(u)&&((a===null||a.delete===void 0)&&(l(),a={delete:0}),a.delete+=u.length,s.add(u)):this.adds(u)?((a===null||a.insert===void 0)&&(l(),a={insert:[]}),a.insert=a.insert.concat(u.content.getContent()),r.add(u)):((a===null||a.retain===void 0)&&(l(),a={retain:0}),a.retain+=u.length);a!==null&&a.retain===void 0&&l()}this._changes=e}return e}}const Ky=(t,e)=>{const n=[];for(;e._item!==null&&e!==t;){if(e._item.parentSub!==null)n.unshift(e._item.parentSub);else{let r=0,s=e._item.parent._start;for(;s!==e._item&&s!==null;)!s.deleted&&s.countable&&(r+=s.length),s=s.right;n.unshift(r)}e=e._item.parent}return n},Je=()=>{Cy("Invalid access: Add Yjs type to a document before reading data.")},ch=80;let tl=0;class zy{constructor(e,n){e.marker=!0,this.p=e,this.index=n,this.timestamp=tl++}}const Jy=t=>{t.timestamp=tl++},uh=(t,e,n)=>{t.p.marker=!1,t.p=e,e.marker=!0,t.index=n,t.timestamp=tl++},Vy=(t,e,n)=>{if(t.length>=ch){const r=t.reduce((s,i)=>s.timestamp<i.timestamp?s:i);return uh(r,e,n),r}else{const r=new zy(e,n);return t.push(r),r}},Hi=(t,e)=>{if(t._start===null||e===0||t._searchMarker===null)return null;const n=t._searchMarker.length===0?null:t._searchMarker.reduce((i,o)=>gi(e-i.index)<gi(e-o.index)?i:o);let r=t._start,s=0;for(n!==null&&(r=n.p,s=n.index,Jy(n));r.right!==null&&s<e;){if(!r.deleted&&r.countable){if(e<s+r.length)break;s+=r.length}r=r.right}for(;r.left!==null&&s>e;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);return n!==null&&gi(n.index-s)<r.parent.length/ch?(uh(n,r,s),n):Vy(t._searchMarker,r,s)},cs=(t,e,n)=>{for(let r=t.length-1;r>=0;r--){const s=t[r];if(n>0){let i=s.p;for(i.marker=!1;i&&(i.deleted||!i.countable);)i=i.left,i&&!i.deleted&&i.countable&&(s.index-=i.length);if(i===null||i.marker===!0){t.splice(r,1);continue}s.p=i,i.marker=!0}(e<s.index||n>0&&e===s.index)&&(s.index=xr(e,s.index+n))}},Wi=(t,e,n)=>{const r=t,s=e.changedParentTypes;for(;wr(s,t,()=>[]).push(n),t._item!==null;)t=t._item.parent;ih(r._eH,n,e)};class qe{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=_c(),this._dEH=_c(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,n){this.doc=e,this._item=n}_copy(){throw It()}clone(){throw It()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,n){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){kc(this._eH,e)}observeDeep(e){kc(this._dEH,e)}unobserve(e){vc(this._eH,e)}unobserveDeep(e){vc(this._dEH,e)}toJSON(){}}const dh=(t,e,n)=>{t.doc??Je(),e<0&&(e=t._length+e),n<0&&(n=t._length+n);let r=n-e;const s=[];let i=t._start;for(;i!==null&&r>0;){if(i.countable&&!i.deleted){const o=i.content.getContent();if(o.length<=e)e-=o.length;else{for(let a=e;a<o.length&&r>0;a++)s.push(o[a]),r--;e=0}}i=i.right}return s},hh=t=>{t.doc??Je();const e=[];let n=t._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let s=0;s<r.length;s++)e.push(r[s])}n=n.right}return e},us=(t,e)=>{let n=0,r=t._start;for(t.doc??Je();r!==null;){if(r.countable&&!r.deleted){const s=r.content.getContent();for(let i=0;i<s.length;i++)e(s[i],n++,t)}r=r.right}},fh=(t,e)=>{const n=[];return us(t,(r,s)=>{n.push(e(r,s,t))}),n},Gy=t=>{let e=t._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};n=e.content.getContent(),r=0,e=e.right}const s=n[r++];return n.length<=r&&(n=null),{done:!1,value:s}}}},ph=(t,e)=>{t.doc??Je();const n=Hi(t,e);let r=t._start;for(n!==null&&(r=n.p,e-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},Ci=(t,e,n,r)=>{let s=n;const i=t.doc,o=i.clientID,a=i.store,l=n===null?e._start:n.right;let u=[];const d=()=>{u.length>0&&(s=new Ke(Se(o,tt(a,o)),s,s&&s.lastId,l,l&&l.id,e,null,new hr(u)),s.integrate(t,0),u=[])};r.forEach(f=>{if(f===null)u.push(f);else switch(f.constructor){case Number:case Object:case Boolean:case Array:case String:u.push(f);break;default:switch(d(),f.constructor){case Uint8Array:case ArrayBuffer:s=new Ke(Se(o,tt(a,o)),s,s&&s.lastId,l,l&&l.id,e,null,new Ki(new Uint8Array(f))),s.integrate(t,0);break;case _s:s=new Ke(Se(o,tt(a,o)),s,s&&s.lastId,l,l&&l.id,e,null,new zi(f)),s.integrate(t,0);break;default:if(f instanceof qe)s=new Ke(Se(o,tt(a,o)),s,s&&s.lastId,l,l&&l.id,e,null,new _n(f)),s.integrate(t,0);else throw new Error("Unexpected content type in insert operation")}}}),d()},gh=()=>cr("Length exceeded!"),mh=(t,e,n,r)=>{if(n>e._length)throw gh();if(n===0)return e._searchMarker&&cs(e._searchMarker,n,r.length),Ci(t,e,null,r);const s=n,i=Hi(e,n);let o=e._start;for(i!==null&&(o=i.p,n-=i.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&dn(t,Se(o.id.client,o.id.clock+n));break}n-=o.length}return e._searchMarker&&cs(e._searchMarker,s,r.length),Ci(t,e,o,r)},Yy=(t,e,n)=>{let s=(e._searchMarker||[]).reduce((i,o)=>o.index>i.index?o:i,{index:0,p:e._start}).p;if(s)for(;s.right;)s=s.right;return Ci(t,e,s,n)},yh=(t,e,n,r)=>{if(r===0)return;const s=n,i=r,o=Hi(e,n);let a=e._start;for(o!==null&&(a=o.p,n-=o.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&dn(t,Se(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&dn(t,Se(a.id.client,a.id.clock+r)),a.delete(t),r-=a.length),a=a.right;if(r>0)throw gh();e._searchMarker&&cs(e._searchMarker,s,-i+r)},Si=(t,e,n)=>{const r=e._map.get(n);r!==void 0&&r.delete(t)},nl=(t,e,n,r)=>{const s=e._map.get(n)||null,i=t.doc,o=i.clientID;let a;if(r==null)a=new hr([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:a=new hr([r]);break;case Uint8Array:a=new Ki(r);break;case _s:a=new zi(r);break;default:if(r instanceof qe)a=new _n(r);else throw new Error("Unexpected content type")}new Ke(Se(o,tt(i.store,o)),s,s&&s.lastId,null,null,e,n,a).integrate(t,0)},rl=(t,e)=>{t.doc??Je();const n=t._map.get(e);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},bh=t=>{const e={};return t.doc??Je(),t._map.forEach((n,r)=>{n.deleted||(e[r]=n.content.getContent()[n.length-1])}),e},_h=(t,e)=>{t.doc??Je();const n=t._map.get(e);return n!==void 0&&!n.deleted},Xy=(t,e)=>{const n={};return t._map.forEach((r,s)=>{let i=r;for(;i!==null&&(!e.sv.has(i.id.client)||i.id.clock>=(e.sv.get(i.id.client)||0));)i=i.left;i!==null&&nr(i,e)&&(n[s]=i.content.getContent()[i.length-1])}),n},Gs=t=>(t.doc??Je(),Sy(t._map.entries(),e=>!e[1].deleted));class kh extends Bi{}class In extends qe{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const n=new In;return n.push(e),n}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new In}clone(){const e=new In;return e.insert(0,this.toArray().map(n=>n instanceof qe?n.clone():n)),e}get length(){return this.doc??Je(),this._length}_callObserver(e,n){super._callObserver(e,n),Wi(this,e,new kh(this,e))}insert(e,n){this.doc!==null?ke(this.doc,r=>{mh(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}push(e){this.doc!==null?ke(this.doc,n=>{Yy(n,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,n=1){this.doc!==null?ke(this.doc,r=>{yh(r,this,e,n)}):this._prelimContent.splice(e,n)}get(e){return ph(this,e)}toArray(){return hh(this)}slice(e=0,n=this.length){return dh(this,e,n)}toJSON(){return this.map(e=>e instanceof qe?e.toJSON():e)}map(e){return fh(this,e)}forEach(e){us(this,e)}[Symbol.iterator](){return Gy(this)}_write(e){e.writeTypeRef(ab)}}class Zy extends Bi{constructor(e,n,r){super(e,n),this.keysChanged=r}}class ur extends qe{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,n){super._integrate(e,n),this._prelimContent.forEach((r,s)=>{this.set(s,r)}),this._prelimContent=null}_copy(){return new ur}clone(){const e=new ur;return this.forEach((n,r)=>{e.set(r,n instanceof qe?n.clone():n)}),e}_callObserver(e,n){Wi(this,e,new Zy(this,e,n))}toJSON(){this.doc??Je();const e={};return this._map.forEach((n,r)=>{if(!n.deleted){const s=n.content.getContent()[n.length-1];e[r]=s instanceof qe?s.toJSON():s}}),e}get size(){return[...Gs(this)].length}keys(){return Vo(Gs(this),e=>e[0])}values(){return Vo(Gs(this),e=>e[1].content.getContent()[e[1].length-1])}entries(){return Vo(Gs(this),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this.doc??Je(),this._map.forEach((n,r)=>{n.deleted||e(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?ke(this.doc,n=>{Si(n,this,e)}):this._prelimContent.delete(e)}set(e,n){return this.doc!==null?ke(this.doc,r=>{nl(r,this,e,n)}):this._prelimContent.set(e,n),n}get(e){return rl(this,e)}has(e){return _h(this,e)}clear(){this.doc!==null?ke(this.doc,e=>{this.forEach(function(n,r,s){Si(e,s,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(lb)}}const cn=(t,e)=>t===e||typeof t=="object"&&typeof e=="object"&&t&&e&&ay(t,e);class ya{constructor(e,n,r,s){this.left=e,this.right=n,this.index=r,this.currentAttributes=s}forward(){switch(this.right===null&&Pn(),this.right.content.constructor){case Pe:this.right.deleted||Cr(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Tc=(t,e,n)=>{for(;e.right!==null&&n>0;){switch(e.right.content.constructor){case Pe:e.right.deleted||Cr(e.currentAttributes,e.right.content);break;default:e.right.deleted||(n<e.right.length&&dn(t,Se(e.right.id.client,e.right.id.clock+n)),e.index+=e.right.length,n-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},Ys=(t,e,n,r)=>{const s=new Map,i=r?Hi(e,n):null;if(i){const o=new ya(i.p.left,i.p,i.index,s);return Tc(t,o,n-i.index)}else{const o=new ya(null,e._start,0,s);return Tc(t,o,n)}},vh=(t,e,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===Pe&&cn(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const s=t.doc,i=s.clientID;r.forEach((o,a)=>{const l=n.left,u=n.right,d=new Ke(Se(i,tt(s.store,i)),l,l&&l.lastId,u,u&&u.id,e,null,new Pe(a,o));d.integrate(t,0),n.right=d,n.forward()})},Cr=(t,e)=>{const{key:n,value:r}=e;r===null?t.delete(n):t.set(n,r)},wh=(t,e)=>{for(;t.right!==null;){if(!(t.right.deleted||t.right.content.constructor===Pe&&cn(e[t.right.content.key]??null,t.right.content.value)))break;t.forward()}},xh=(t,e,n,r)=>{const s=t.doc,i=s.clientID,o=new Map;for(const a in r){const l=r[a],u=n.currentAttributes.get(a)??null;if(!cn(u,l)){o.set(a,u);const{left:d,right:f}=n;n.right=new Ke(Se(i,tt(s.store,i)),d,d&&d.lastId,f,f&&f.id,e,null,new Pe(a,l)),n.right.integrate(t,0),n.forward()}}return o},Yo=(t,e,n,r,s)=>{n.currentAttributes.forEach((h,p)=>{s[p]===void 0&&(s[p]=null)});const i=t.doc,o=i.clientID;wh(n,s);const a=xh(t,e,n,s),l=r.constructor===String?new Vt(r):r instanceof qe?new _n(r):new Sr(r);let{left:u,right:d,index:f}=n;e._searchMarker&&cs(e._searchMarker,n.index,l.getLength()),d=new Ke(Se(o,tt(i.store,o)),u,u&&u.lastId,d,d&&d.id,e,null,l),d.integrate(t,0),n.right=d,n.index=f,n.forward(),vh(t,e,n,a)},Ec=(t,e,n,r,s)=>{const i=t.doc,o=i.clientID;wh(n,s);const a=xh(t,e,n,s);e:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===Pe));){if(!n.right.deleted)switch(n.right.content.constructor){case Pe:{const{key:l,value:u}=n.right.content,d=s[l];if(d!==void 0){if(cn(d,u))a.delete(l);else{if(r===0)break e;a.set(l,u)}n.right.delete(t)}else n.currentAttributes.set(l,u);break}default:r<n.right.length&&dn(t,Se(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let l="";for(;r>0;r--)l+=`
`;n.right=new Ke(Se(o,tt(i.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,e,null,new Vt(l)),n.right.integrate(t,0),n.forward()}vh(t,e,n,a)},Ch=(t,e,n,r,s)=>{let i=e;const o=Nt();for(;i&&(!i.countable||i.deleted);){if(!i.deleted&&i.content.constructor===Pe){const u=i.content;o.set(u.key,u)}i=i.right}let a=0,l=!1;for(;e!==i;){if(n===e&&(l=!0),!e.deleted){const u=e.content;switch(u.constructor){case Pe:{const{key:d,value:f}=u,h=r.get(d)??null;(o.get(d)!==u||h===f)&&(e.delete(t),a++,!l&&(s.get(d)??null)===f&&h!==f&&(h===null?s.delete(d):s.set(d,h))),!l&&!e.deleted&&Cr(s,u);break}}}e=e.right}return a},Qy=(t,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const n=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===Pe){const r=e.content.key;n.has(r)?e.delete(t):n.add(r)}e=e.left}},eb=t=>{let e=0;return ke(t.doc,n=>{let r=t._start,s=t._start,i=Nt();const o=da(i);for(;s;){if(s.deleted===!1)switch(s.content.constructor){case Pe:Cr(o,s.content);break;default:e+=Ch(n,r,s,i,o),i=da(o),r=s;break}s=s.right}}),e},tb=t=>{const e=new Set,n=t.doc;for(const[r,s]of t.afterState.entries()){const i=t.beforeState.get(r)||0;s!==i&&ah(t,n.store.clients.get(r),i,s,o=>{!o.deleted&&o.content.constructor===Pe&&o.constructor!==an&&e.add(o.parent)})}ke(n,r=>{eh(t,t.deleteSet,s=>{if(s instanceof an||!s.parent._hasFormatting||e.has(s.parent))return;const i=s.parent;s.content.constructor===Pe?e.add(i):Qy(r,s)});for(const s of e)eb(s)})},Oc=(t,e,n)=>{const r=n,s=da(e.currentAttributes),i=e.right;for(;n>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case _n:case Sr:case Vt:n<e.right.length&&dn(t,Se(e.right.id.client,e.right.id.clock+n)),n-=e.right.length,e.right.delete(t);break}e.forward()}i&&Ch(t,i,e.right,s,e.currentAttributes);const o=(e.left||e.right).parent;return o._searchMarker&&cs(o._searchMarker,e.index,-r+n),e};class nb extends Bi{constructor(e,n,r){super(e,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(s=>{s===null?this.childListChanged=!0:this.keysChanged.add(s)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,n=[];ke(e,r=>{const s=new Map,i=new Map;let o=this.target._start,a=null;const l={};let u="",d=0,f=0;const h=()=>{if(a!==null){let p=null;switch(a){case"delete":f>0&&(p={delete:f}),f=0;break;case"insert":(typeof u=="object"||u.length>0)&&(p={insert:u},s.size>0&&(p.attributes={},s.forEach((y,k)=>{y!==null&&(p.attributes[k]=y)}))),u="";break;case"retain":d>0&&(p={retain:d},sy(l)||(p.attributes=ty({},l))),d=0;break}p&&n.push(p),a=null}};for(;o!==null;){switch(o.content.constructor){case _n:case Sr:this.adds(o)?this.deletes(o)||(h(),a="insert",u=o.content.getContent()[0],h()):this.deletes(o)?(a!=="delete"&&(h(),a="delete"),f+=1):o.deleted||(a!=="retain"&&(h(),a="retain"),d+=1);break;case Vt:this.adds(o)?this.deletes(o)||(a!=="insert"&&(h(),a="insert"),u+=o.content.str):this.deletes(o)?(a!=="delete"&&(h(),a="delete"),f+=o.length):o.deleted||(a!=="retain"&&(h(),a="retain"),d+=o.length);break;case Pe:{const{key:p,value:y}=o.content;if(this.adds(o)){if(!this.deletes(o)){const k=s.get(p)??null;cn(k,y)?y!==null&&o.delete(r):(a==="retain"&&h(),cn(y,i.get(p)??null)?delete l[p]:l[p]=y)}}else if(this.deletes(o)){i.set(p,y);const k=s.get(p)??null;cn(k,y)||(a==="retain"&&h(),l[p]=k)}else if(!o.deleted){i.set(p,y);const k=l[p];k!==void 0&&(cn(k,y)?k!==null&&o.delete(r):(a==="retain"&&h(),y===null?delete l[p]:l[p]=y))}o.deleted||(a==="insert"&&h(),Cr(s,o.content));break}}o=o.right}for(h();n.length>0;){const p=n[n.length-1];if(p.retain!==void 0&&p.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class Ti extends qe{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??Je(),this._length}_integrate(e,n){super._integrate(e,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new Ti}clone(){const e=new Ti;return e.applyDelta(this.toDelta()),e}_callObserver(e,n){super._callObserver(e,n);const r=new nb(this,e,n);Wi(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){this.doc??Je();let e="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Vt&&(e+=n.content.str),n=n.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:n=!0}={}){this.doc!==null?ke(this.doc,r=>{const s=new ya(null,this._start,0,new Map);for(let i=0;i<e.length;i++){const o=e[i];if(o.insert!==void 0){const a=!n&&typeof o.insert=="string"&&i===e.length-1&&s.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&Yo(r,this,s,a,o.attributes||{})}else o.retain!==void 0?Ec(r,this,s,o.retain,o.attributes||{}):o.delete!==void 0&&Oc(r,s,o.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,n,r){this.doc??Je();const s=[],i=new Map,o=this.doc;let a="",l=this._start;function u(){if(a.length>0){const f={};let h=!1;i.forEach((y,k)=>{h=!0,f[k]=y});const p={insert:a};h&&(p.attributes=f),s.push(p),a=""}}const d=()=>{for(;l!==null;){if(nr(l,e)||n!==void 0&&nr(l,n))switch(l.content.constructor){case Vt:{const f=i.get("ychange");e!==void 0&&!nr(l,e)?(f===void 0||f.user!==l.id.client||f.type!=="removed")&&(u(),i.set("ychange",r?r("removed",l.id):{type:"removed"})):n!==void 0&&!nr(l,n)?(f===void 0||f.user!==l.id.client||f.type!=="added")&&(u(),i.set("ychange",r?r("added",l.id):{type:"added"})):f!==void 0&&(u(),i.delete("ychange")),a+=l.content.str;break}case _n:case Sr:{u();const f={insert:l.content.getContent()[0]};if(i.size>0){const h={};f.attributes=h,i.forEach((p,y)=>{h[y]=p})}s.push(f);break}case Pe:nr(l,e)&&(u(),Cr(i,l.content));break}l=l.right}u()};return e||n?ke(o,f=>{e&&ga(f,e),n&&ga(f,n),d()},"cleanup"):d(),s}insert(e,n,r){if(n.length<=0)return;const s=this.doc;s!==null?ke(s,i=>{const o=Ys(i,this,e,!r);r||(r={},o.currentAttributes.forEach((a,l)=>{r[l]=a})),Yo(i,this,o,n,r)}):this._pending.push(()=>this.insert(e,n,r))}insertEmbed(e,n,r){const s=this.doc;s!==null?ke(s,i=>{const o=Ys(i,this,e,!r);Yo(i,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(e,n,r||{}))}delete(e,n){if(n===0)return;const r=this.doc;r!==null?ke(r,s=>{Oc(s,Ys(s,this,e,!0),n)}):this._pending.push(()=>this.delete(e,n))}format(e,n,r){if(n===0)return;const s=this.doc;s!==null?ke(s,i=>{const o=Ys(i,this,e,!1);o.right!==null&&Ec(i,this,o,n,r)}):this._pending.push(()=>this.format(e,n,r))}removeAttribute(e){this.doc!==null?ke(this.doc,n=>{Si(n,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,n){this.doc!==null?ke(this.doc,r=>{nl(r,this,e,n)}):this._pending.push(()=>this.setAttribute(e,n))}getAttribute(e){return rl(this,e)}getAttributes(){return bh(this)}_write(e){e.writeTypeRef(cb)}}class Xo{constructor(e,n=()=>!0){this._filter=n,this._root=e,this._currentNode=e._start,this._firstCall=!0,e.doc??Je()}[Symbol.iterator](){return this}next(){let e=this._currentNode,n=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(n)))do if(n=e.content.type,!e.deleted&&(n.constructor===ds||n.constructor===dr)&&n._start!==null)e=n._start;else for(;e!==null;){const r=e.next;if(r!==null){e=r;break}else e.parent===this._root?e=null:e=e.parent._item}while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class dr extends qe{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new dr}clone(){const e=new dr;return e.insert(0,this.toArray().map(n=>n instanceof qe?n.clone():n)),e}get length(){return this.doc??Je(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new Xo(this,e)}querySelector(e){e=e.toUpperCase();const r=new Xo(this,s=>s.nodeName&&s.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),lr(new Xo(this,n=>n.nodeName&&n.nodeName.toUpperCase()===e))}_callObserver(e,n){Wi(this,e,new rb(this,n,e))}toString(){return fh(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,n={},r){const s=e.createDocumentFragment();return r!==void 0&&r._createAssociation(s,this),us(this,i=>{s.insertBefore(i.toDOM(e,n,r),null)}),s}insert(e,n){this.doc!==null?ke(this.doc,r=>{mh(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}insertAfter(e,n){if(this.doc!==null)ke(this.doc,r=>{const s=e&&e instanceof qe?e._item:e;Ci(r,this,s,n)});else{const r=this._prelimContent,s=e===null?0:r.findIndex(i=>i===e)+1;if(s===0&&e!==null)throw cr("Reference item not found");r.splice(s,0,...n)}}delete(e,n=1){this.doc!==null?ke(this.doc,r=>{yh(r,this,e,n)}):this._prelimContent.splice(e,n)}toArray(){return hh(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return ph(this,e)}slice(e=0,n=this.length){return dh(this,e,n)}forEach(e){us(this,e)}_write(e){e.writeTypeRef(db)}}class ds extends dr{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,n){super._integrate(e,n),this._prelimAttrs.forEach((r,s)=>{this.setAttribute(s,r)}),this._prelimAttrs=null}_copy(){return new ds(this.nodeName)}clone(){const e=new ds(this.nodeName),n=this.getAttributes();return ry(n,(r,s)=>{typeof r=="string"&&e.setAttribute(s,r)}),e.insert(0,this.toArray().map(r=>r instanceof qe?r.clone():r)),e}toString(){const e=this.getAttributes(),n=[],r=[];for(const a in e)r.push(a);r.sort();const s=r.length;for(let a=0;a<s;a++){const l=r[a];n.push(l+'="'+e[l]+'"')}const i=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${i}${o}>${super.toString()}</${i}>`}removeAttribute(e){this.doc!==null?ke(this.doc,n=>{Si(n,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,n){this.doc!==null?ke(this.doc,r=>{nl(r,this,e,n)}):this._prelimAttrs.set(e,n)}getAttribute(e){return rl(this,e)}hasAttribute(e){return _h(this,e)}getAttributes(e){return e?Xy(this,e):bh(this)}toDOM(e=document,n={},r){const s=e.createElement(this.nodeName),i=this.getAttributes();for(const o in i){const a=i[o];typeof a=="string"&&s.setAttribute(o,a)}return us(this,o=>{s.appendChild(o.toDOM(e,n,r))}),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(ub),e.writeKey(this.nodeName)}}class rb extends Bi{constructor(e,n,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(s=>{s===null?this.childListChanged=!0:this.attributesChanged.add(s)})}}class Sh{constructor(e,n){this.id=e,this.length=n}get deleted(){throw It()}mergeWith(e){return!1}write(e,n,r){throw It()}integrate(e,n){throw It()}}const sb=0;class an extends Sh{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){n>0&&(this.id.clock+=n,this.length-=n),oh(e.doc.store,this)}write(e,n){e.writeInfo(sb),e.writeLen(this.length-n)}getMissing(e,n){return null}}class Ki{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Ki(this.content)}splice(e){throw It()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeBuf(this.content)}getRef(){return 3}}class Ei{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Ei(this.len)}splice(e){const n=new Ei(this.len-e);return this.len=e,n}mergeWith(e){return this.len+=e.len,!0}integrate(e,n){rh(e.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(e){}gc(e){}write(e,n){e.writeLen(this.len-n)}getRef(){return 1}}const ib=(t,e)=>new _s({guid:t,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class zi{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const n={};this.opts=n,e.gc||(n.gc=!1),e.autoLoad&&(n.autoLoad=!0),e.meta!==null&&(n.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new zi(ib(this.doc.guid,this.opts))}splice(e){throw It()}mergeWith(e){return!1}integrate(e,n){this.doc._item=n,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,n){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}class Sr{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Sr(this.embed)}splice(e){throw It()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeJSON(this.embed)}getRef(){return 5}}class Pe{constructor(e,n){this.key=e,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Pe(this.key,this.value)}splice(e){throw It()}mergeWith(e){return!1}integrate(e,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,n){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const ob=xi("node_env")==="development";class hr{constructor(e){this.arr=e,ob&&Kd(e)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new hr(this.arr)}splice(e){const n=new hr(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let s=n;s<r;s++){const i=this.arr[s];e.writeAny(i)}}getRef(){return 8}}class Vt{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Vt(this.str)}splice(e){const n=new Vt(this.str.slice(e));this.str=this.str.slice(0,e);const r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"",n.str=""+n.str.slice(1)),n}mergeWith(e){return this.str+=e.str,!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const ab=0,lb=1,cb=2,ub=3,db=4;class _n{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new _n(this.type._copy())}splice(e){throw It()}mergeWith(e){return!1}integrate(e,n){this.type._integrate(e.doc,n)}delete(e){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(e.beforeState.get(n.id.client)||0)&&e._mergeStructs.push(n):n.delete(e),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let n=this.type._start;for(;n!==null;)n.gc(e,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,n){this.type._write(e)}getRef(){return 7}}const Th=(t,e,n)=>{const{client:r,clock:s}=e.id,i=new Ke(Se(r,s+n),e,Se(r,s+n-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(n));return e.deleted&&i.markDeleted(),e.keep&&(i.keep=!0),e.redone!==null&&(i.redone=Se(e.redone.client,e.redone.clock+n)),e.right=i,i.right!==null&&(i.right.left=i),t._mergeStructs.push(i),i.parentSub!==null&&i.right===null&&i.parent._map.set(i.parentSub,i),e.length=n,i};class Ke extends Sh{constructor(e,n,r,s,i,o,a,l){super(e,l.getLength()),this.origin=r,this.left=n,this.right=s,this.rightOrigin=i,this.parent=o,this.parentSub=a,this.redone=null,this.content=l,this.info=this.content.isCountable()?cc:0}set marker(e){(this.info&Ko)>0!==e&&(this.info^=Ko)}get marker(){return(this.info&Ko)>0}get keep(){return(this.info&lc)>0}set keep(e){this.keep!==e&&(this.info^=lc)}get countable(){return(this.info&cc)>0}get deleted(){return(this.info&Wo)>0}set deleted(e){this.deleted!==e&&(this.info^=Wo)}markDeleted(){this.info|=Wo}getMissing(e,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=tt(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=tt(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===yi&&this.id.client!==this.parent.client&&this.parent.clock>=tt(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=wc(e,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=dn(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===an||this.right&&this.right.constructor===an)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===Ke?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===Ke&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===yi){const r=Go(n,this.parent);r.constructor===an?this.parent=null:this.parent=r.content.type}return null}integrate(e,n){if(n>0&&(this.id.clock+=n,this.left=wc(e,e.doc.store,Se(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,s;if(r!==null)s=r.right;else if(this.parentSub!==null)for(s=this.parent._map.get(this.parentSub)||null;s!==null&&s.left!==null;)s=s.left;else s=this.parent._start;const i=new Set,o=new Set;for(;s!==null&&s!==this.right;){if(o.add(s),i.add(s),Vs(this.origin,s.origin)){if(s.id.client<this.id.client)r=s,i.clear();else if(Vs(this.rightOrigin,s.rightOrigin))break}else if(s.origin!==null&&o.has(Go(e.doc.store,s.origin)))i.has(Go(e.doc.store,s.origin))||(r=s,i.clear());else break;s=s.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),oh(e.doc.store,this),this.content.integrate(e,this),Cc(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new an(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:Se(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&Vs(e.origin,this.lastId)&&this.right===e&&Vs(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),rh(e.deleteSet,this.id.client,this.id.clock,this.length),Cc(e,n,this.parentSub),this.content.delete(e)}}gc(e,n){if(!this.deleted)throw Pn();this.content.gc(e),n?Uy(e,this,new an(this.id,this.length)):this.content=new Ei(this.length)}write(e,n){const r=n>0?Se(this.id.client,this.id.clock+n-1):this.origin,s=this.rightOrigin,i=this.parentSub,o=this.content.getRef()&Mm|(r===null?0:wi)|(s===null?0:Bd)|(i===null?0:Om);if(e.writeInfo(o),r!==null&&e.writeLeftID(r),s!==null&&e.writeRightID(s),r===null&&s===null){const a=this.parent;if(a._item!==void 0){const l=a._item;if(l===null){const u=Ly(a);e.writeParentInfo(!0),e.writeString(u)}else e.writeParentInfo(!1),e.writeLeftID(l.id)}else a.constructor===String?(e.writeParentInfo(!0),e.writeString(a)):a.constructor===yi?(e.writeParentInfo(!1),e.writeLeftID(a)):Pn();i!==null&&e.writeString(i)}this.content.write(e,n)}}const Eh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},Oh="__ $YJS$ __";Eh[Oh]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");Eh[Oh]=!0;Ua("ychange",{isEqual:(t,e)=>t===e,parse:t=>t??null});const hb=qa("TOGGLE_CONNECT_COMMAND");var fb=Object.defineProperty,pb=(t,e,n)=>e in t?fb(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,K=(t,e,n)=>pb(t,typeof e!="symbol"?e+"":e,n);const Zo=t=>Ie(Pp(t)),$n=Ua("cid",{parse:t=>typeof t=="string"?t:void 0}),hn=Ua("segment",{parse:t=>typeof t=="string"?t:void 0}),gb=["type","marker","content"],ba="unknown",Mh=1;class Un extends yn{constructor(e="",n,r,s){super(s),K(this,"__tag"),K(this,"__marker"),K(this,"__unknownAttributes"),this.__tag=e,this.__marker=n,this.__unknownAttributes=r}static getType(){return"unknown"}static clone(e){const{__tag:n,__marker:r,__unknownAttributes:s,__key:i}=e;return new Un(n,r,s,i)}static importDOM(){return{[ba]:e=>yb(e)?{conversion:mb,priority:1}:null}}static importJSON(e){return sl().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setTag(e.tag).setMarker(e.marker).setUnknownAttributes(e.unknownAttributes)}setTag(e){if(this.__tag===e)return this;const n=this.getWritable();return n.__tag=e,n}getTag(){return this.getLatest().__tag}setMarker(e){if(this.__marker===e)return this;const n=this.getWritable();return n.__marker=e,n}getMarker(){return this.getLatest().__marker}setUnknownAttributes(e){const n=this.getWritable();return n.__unknownAttributes=e,n}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement(ba);return e.style.display="none",e}updateDOM(){return!1}exportDOM(){return{element:null}}exportJSON(){return{...super.exportJSON(),type:this.getType(),tag:this.getTag(),marker:this.getMarker(),unknownAttributes:this.getUnknownAttributes(),version:Mh}}canBeEmpty(){return!0}isInline(){return!0}extractWithChild(){return!1}excludeFromCopy(e){return e!=="clone"}}function mb(t){const e=t.getAttribute("data-tag")??"",n=t.getAttribute("data-marker")??"";return{node:sl(e,n)}}function sl(t,e,n){return Ie(new Un(t,e,n))}function yb(t){return(t==null?void 0:t.tagName)===ba}function Zt(t){return t instanceof Un}const hs="id",Ah=1,bb=["type","marker","code","content"];class dt extends yn{constructor(e="",n,r){super(r),K(this,"__marker",hs),K(this,"__code"),K(this,"__unknownAttributes"),this.__code=e,this.__unknownAttributes=n}static getType(){return"book"}static clone(e){const{__code:n,__unknownAttributes:r,__key:s}=e;return new dt(n,r,s)}static importJSON(e){const{code:n}=e;return jh(n).updateFromJSON(e)}static isValidBookCode(e){return zf(e)}updateFromJSON(e){return super.updateFromJSON(e).setCode(e.code).setUnknownAttributes(e.unknownAttributes)}getMarker(){return this.getLatest().__marker}setCode(e){if(this.__code===e)return this;const n=this.getWritable();return n.__code=e,n}getCode(){return this.getLatest().__code}setUnknownAttributes(e){const n=this.getWritable();return n.__unknownAttributes=e,n}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("p");return e.setAttribute("data-marker",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`),e.setAttribute("data-code",this.__code),e}updateDOM(){return!1}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),code:this.getCode(),unknownAttributes:this.getUnknownAttributes(),version:Ah}}}function jh(t,e){return Ie(new dt(t,e))}function Rt(t){return t instanceof dt}function _b(t){return(t==null?void 0:t.type)===dt.getType()}const me="",_a="",Gt=me,il=`${me}|`,Ji="p",Pt="+",fr="-",Oi="chapter",ka="verse",Mc="invalid",kb="text-spacing",vb="formatted-font",wb="marker-",ol="external-usj-mutation",Nh="selection-change",va="cursor-change",wa="annotation-change",xa="delta-change",xb=[ol,Nh,va,wa,xa],Mi="c",Ih=1,Cb=["type","marker","number","sid","altnumber","pubnumber","content"];class vt extends yn{constructor(e="",n,r,s,i,o){super(o),K(this,"__marker"),K(this,"__number"),K(this,"__sid"),K(this,"__altnumber"),K(this,"__pubnumber"),K(this,"__unknownAttributes"),this.__marker=Mi,this.__number=e,this.__sid=n,this.__altnumber=r,this.__pubnumber=s,this.__unknownAttributes=i}static getType(){return"chapter"}static clone(e){const{__number:n,__sid:r,__altnumber:s,__pubnumber:i,__unknownAttributes:o,__key:a}=e;return new vt(n,r,s,i,o,a)}static importJSON(e){return Rh().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setNumber(e.number).setSid(e.sid).setAltnumber(e.altnumber).setPubnumber(e.pubnumber).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const n=this.getWritable();return n.__marker=e,n}getMarker(){return this.getLatest().__marker}setNumber(e){if(this.__number===e)return this;const n=this.getWritable();return n.__number=e,n}getNumber(){return this.getLatest().__number}setSid(e){if(this.__sid===e)return this;const n=this.getWritable();return n.__sid=e,n}getSid(){return this.getLatest().__sid}setAltnumber(e){if(this.__altnumber===e)return this;const n=this.getWritable();return n.__altnumber=e,n}getAltnumber(){return this.getLatest().__altnumber}setPubnumber(e){if(this.__pubnumber===e)return this;const n=this.getWritable();return n.__pubnumber=e,n}getPubnumber(){return this.getLatest().__pubnumber}setUnknownAttributes(e){const n=this.getWritable();return n.__unknownAttributes=e,n}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("p");return e.setAttribute("data-marker",this.__marker),e.classList.add(Oi,`usfm_${this.__marker}`),e.setAttribute("data-number",this.__number),e}updateDOM(){return!1}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),number:this.getNumber(),sid:this.getSid(),altnumber:this.getAltnumber(),pubnumber:this.getPubnumber(),unknownAttributes:this.getUnknownAttributes(),version:Ih}}}function Rh(t,e,n,r,s){return Ie(new vt(t,e,n,r,s))}function al(t){return t instanceof vt}function Sb(t){return(t==null?void 0:t.type)===vt.getType()}const Ph=["fr","fq","fqa","fk","ft","fl","fw","fp","fv","fdc","fm"],$h=["xo","xop","xk","xq","xt","xta","xot","xnt","xdc"],Tb=["ca","cp","va","vp","add","bk","dc","em","jmp","k","nd","ord","pn","png","qt","rb","rq","sig","sls","tl","w","wa","wg","wh","wj","bd","it","bdit","no","sc","sup","ior","iqt","qac","qs","litl","lik","liv","liv1","liv2","liv3","liv4","liv5",...Ph,...$h],Dh=1,Eb=["type","marker","content"];class Ce extends yn{constructor(e="",n,r){super(r),K(this,"__marker"),K(this,"__unknownAttributes"),this.__marker=e,this.__unknownAttributes=n}static getType(){return"char"}static clone(e){const{__marker:n,__unknownAttributes:r,__key:s}=e;return new Ce(n,r,s)}static isValidMarker(e){return e!==void 0&&Tb.includes(e)}static isValidFootnoteMarker(e){return e!==void 0&&Ph.includes(e)}static isValidCrossReferenceMarker(e){return e!==void 0&&$h.includes(e)}static importDOM(){return{span:e=>Mb(e)?{conversion:Ob,priority:1}:null}}static importJSON(e){return gt().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const n=this.getWritable();return n.__marker=e,n}getMarker(){return this.getLatest().__marker}setUnknownAttributes(e){const n=this.getWritable();return n.__unknownAttributes=e,n}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("span");return e.setAttribute("data-marker",this.__marker),e.setAttribute("title",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`),e}updateDOM(){return!1}exportDOM(e){const{element:n}=super.exportDOM(e);return n&&bn(n)&&(n.setAttribute("data-marker",this.getMarker()),n.classList.add(this.getType(),`usfm_${this.getMarker()}`)),{element:n}}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),unknownAttributes:this.getUnknownAttributes(),version:Dh}}insertNewAfter(e,n){const r=gt(this.getMarker());return r.setTextFormat(e.format),r.setTextStyle(e.style),r.setDirection(this.getDirection()),r.setFormat(this.getFormatType()),r.setStyle(this.getTextStyle()),this.insertAfter(r,n),r}canBeEmpty(){return!1}isInline(){return!0}}function Ob(t){const e=t.getAttribute("data-marker")??"f";return{node:gt(e)}}function gt(t,e){return Ie(new Ce(t,e))}function Mb(t){if(!t)return!1;const e=t.getAttribute("data-marker")??"";return Ce.isValidMarker(e)&&t.classList.contains(Ce.getType())}function pe(t){return t instanceof Ce}function Ab(t){return(t==null?void 0:t.type)===Ce.getType()}const Lh=1,jb="c",Fh="span";class Qt extends vr{constructor(e="",n=!1,r,s,i,o,a){super(a),K(this,"__marker"),K(this,"__number"),K(this,"__showMarker"),K(this,"__sid"),K(this,"__altnumber"),K(this,"__pubnumber"),K(this,"__unknownAttributes"),this.__marker=jb,this.__number=e,this.__showMarker=n,this.__sid=r,this.__altnumber=s,this.__pubnumber=i,this.__unknownAttributes=o}static getType(){return"immutable-chapter"}static clone(e){const{__number:n,__showMarker:r,__sid:s,__altnumber:i,__pubnumber:o,__unknownAttributes:a,__key:l}=e;return new Qt(n,r,s,i,o,a,l)}static importDOM(){return{span:e=>qh(e)?{conversion:Nb,priority:1}:null}}static importJSON(e){return ll().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setNumber(e.number).setShowMarker(e.showMarker).setSid(e.sid).setAltnumber(e.altnumber).setPubnumber(e.pubnumber).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const n=this.getWritable();return n.__marker=e,n}getMarker(){return this.getLatest().__marker}setNumber(e){if(this.__number===e)return this;const n=this.getWritable();return n.__number=e,n}getNumber(){return this.getLatest().__number}setShowMarker(e=!1){if(this.__showMarker===e)return this;const n=this.getWritable();return n.__showMarker=e,n}getShowMarker(){return this.getLatest().__showMarker}setSid(e){if(this.__sid===e)return this;const n=this.getWritable();return n.__sid=e,n}getSid(){return this.getLatest().__sid}setAltnumber(e){if(this.__altnumber===e)return this;const n=this.getWritable();return n.__altnumber=e,n}getAltnumber(){return this.getLatest().__altnumber}setPubnumber(e){if(this.__pubnumber===e)return this;const n=this.getWritable();return n.__pubnumber=e,n}getPubnumber(){return this.getLatest().__pubnumber}setUnknownAttributes(e){const n=this.getWritable();return n.__unknownAttributes=e,n}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement(Fh);return e.setAttribute("data-marker",this.__marker),e.classList.add(Oi,`usfm_${this.__marker}`),this.__showMarker&&e.classList.add("marker"),e.setAttribute("data-number",this.__number),e}updateDOM(){return!1}exportDOM(e){const{element:n}=super.exportDOM(e);return n&&bn(n)&&(n.setAttribute("data-marker",this.getMarker()),n.classList.add(Oi,`usfm_${this.getMarker()}`),n.setAttribute("data-number",this.getNumber())),{element:n}}decorate(){return this.getShowMarker()?vs(this.getMarker(),this.getNumber()):this.getNumber()}exportJSON(){return{type:this.getType(),marker:this.getMarker(),number:this.getNumber(),showMarker:this.getShowMarker(),sid:this.getSid(),altnumber:this.getAltnumber(),pubnumber:this.getPubnumber(),unknownAttributes:this.getUnknownAttributes(),version:Lh}}isInline(){return!1}isKeyboardSelectable(){return!1}}function Nb(t){const e=t.getAttribute("data-number")??"0";return{node:ll(e)}}function ll(t,e,n,r,s,i){return Ie(new Qt(t,e,n,r,s,i))}function qh(t){return t?t.classList.contains(Oi)&&t.tagName.toLowerCase()===Fh:!1}function ks(t){return t instanceof Qt}function Ib(t){return(t==null?void 0:t.type)===Qt.getType()}const Uh=1;class fn extends Ba{static getType(){return"implied-para"}static clone(e){return new fn(e.__key)}static importJSON(e){return bt().updateFromJSON(e)}getMarker(){return Ji}exportJSON(){return{...super.exportJSON(),type:this.getType(),version:Uh}}insertNewAfter(e,n){const r=bt();return r.setTextFormat(e.format),r.setTextStyle(e.style),r.setDirection(this.getDirection()),r.setFormat(this.getFormatType()),r.setStyle(this.getTextStyle()),this.insertAfter(r,n),r}}function bt(){return Ie(new fn)}function Yt(t){return t instanceof fn}function cl(t){return(t==null?void 0:t.type)===fn.getType()}const Dn="zmsc-s",or="zmsc-e",Rb=[Dn,or],Pb=["ts-s","ts-e","t-s","t-e","ts","qt1-s","qt1-e","qt2-s","qt2-e","qt3-s","qt3-e","qt4-s","qt4-e","qt5-s","qt5-e","qt-s","qt-e",Dn,or],Bh=1,$b=["type","marker","sid","eid","content"];class $t extends vr{constructor(e="",n,r,s,i){super(i),K(this,"__marker"),K(this,"__sid"),K(this,"__eid"),K(this,"__unknownAttributes"),this.__marker=e,this.__sid=n,this.__eid=r,this.__unknownAttributes=s}static getType(){return"ms"}static clone(e){const{__marker:n,__sid:r,__eid:s,__unknownAttributes:i,__key:o}=e;return new $t(n,r,s,i,o)}static importJSON(e){return Hh().updateFromJSON(e)}static isValidMarker(e){return e!==void 0&&(Pb.includes(e)||e.startsWith("z"))}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setSid(e.sid).setEid(e.eid).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const n=this.getWritable();return n.__marker=e,n}getMarker(){return this.getLatest().__marker}setSid(e){if(this.__sid===e)return this;const n=this.getWritable();return n.__sid=e,n}getSid(){return this.getLatest().__sid}setEid(e){if(this.__eid===e)return this;const n=this.getWritable();return n.__eid=e,n}getEid(){return this.getLatest().__eid}setUnknownAttributes(e){const n=this.getWritable();return n.__unknownAttributes=e,n}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("span");return e.setAttribute("data-marker",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`),e}updateDOM(){return!1}decorate(){return""}exportJSON(){return{type:this.getType(),marker:this.getMarker(),sid:this.getSid(),eid:this.getEid(),unknownAttributes:this.getUnknownAttributes(),version:Bh}}isKeyboardSelectable(){return!1}}function Db(t){return Rb.includes(t)}function Hh(t,e,n,r){return Ie(new $t(t,e,n,r))}function Vi(t){return t instanceof $t}const ul="f",Lb=[ul,"fe","ef","efe","x","ex"],Fb=["type","marker","caller","category","content"],Wh=1;class $e extends yn{constructor(e=ul,n,r=!0,s,i,o){super(o),K(this,"__marker"),K(this,"__caller"),K(this,"__isCollapsed"),K(this,"__category"),K(this,"__unknownAttributes"),this.__marker=e,this.__caller=n??(e==="x"||e==="ex"?fr:Pt),this.__isCollapsed=r,this.__category=s,this.__unknownAttributes=i}static getType(){return"note"}static clone(e){const{__marker:n,__caller:r,__isCollapsed:s,__category:i,__unknownAttributes:o,__key:a}=e;return new $e(n,r,s,i,o,a)}static importDOM(){return{span:e=>Ub(e)?{conversion:qb,priority:1}:null}}static importJSON(e){return dl().updateFromJSON(e)}static isValidMarker(e){return e!==void 0&&Lb.includes(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setCaller(e.caller).setIsCollapsed(e.isCollapsed).setCategory(e.category).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const n=this.getWritable();return n.__marker=e,n}getMarker(){return this.getLatest().__marker}setCaller(e){if(this.__caller===e)return this;const n=this.getWritable();return n.__caller=e,n}getCaller(){return this.getLatest().__caller}setIsCollapsed(e){if(this.__isCollapsed===e)return this;const n=this.getWritable();return n.__isCollapsed=e,n}toggleIsCollapsed(){const e=this.getWritable();return e.__isCollapsed=!e.__isCollapsed,e}getIsCollapsed(){return this.getLatest().__isCollapsed}setCategory(e){if(this.__category===e)return this;const n=this.getWritable();return n.__category=e,n}getCategory(){return this.getLatest().__category}setUnknownAttributes(e){const n=this.getWritable();return n.__unknownAttributes=e,n}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("span");return e.setAttribute("data-marker",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`,this.__isCollapsed?"collapsed":"expanded"),e.setAttribute("data-caller",this.__caller),e}updateDOM(e){return e.__isCollapsed!==this.__isCollapsed}exportDOM(e){const{element:n}=super.exportDOM(e);return n&&bn(n)&&(n.setAttribute("data-marker",this.getMarker()),n.classList.add(this.getType(),`usfm_${this.getMarker()}`,this.getIsCollapsed()?"collapsed":"expanded"),n.setAttribute("data-caller",this.getCaller())),{element:n}}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),caller:this.getCaller(),isCollapsed:this.getIsCollapsed(),category:this.getCategory(),unknownAttributes:this.getUnknownAttributes(),version:Wh}}canBeEmpty(){return!1}isInline(){return!0}}function qb(t){const e=t.getAttribute("data-marker")??"f",n=t.getAttribute("data-caller")??"",r=t.classList.contains("collapsed");return{node:dl(e,n,r)}}function dl(t,e,n,r,s){return Ie(new $e(t,e,n,r,s))}function Ub(t){if(!t)return!1;const e=t.getAttribute("data-marker")??"";return $e.isValidMarker(e)&&t.classList.contains($e.getType())}function oe(t){return t instanceof $e}const Bb=["ide","sts","rem","h","toc1","toc2","toc3","toca1","toca2","toca3","imt","imt1","imt2","imt3","imt4","is","is1","is2","ip","ipi","im","imi","ipq","imq","ipr","iq","iq1","iq2","iq3","ili","ili1","ili2","ib","iot","io","io1","io2","io3","io4","iex","imte","imte1","imte2","ie","mt","mt1","mt2","mt3","mt4","mte","mte1","mte2","cl","cd","ms","ms1","ms2","ms3","mr","s","s1","s2","s3","s4","sr","r","d","sp","sd","sd1","sd2","sd3","sd4",Ji,"m","po","cls","pr","pc","pm","pmo","pmc","pmr","pi","pi1","pi2","pi3","mi","lit","nb","q","q1","q2","q3","q4","qr","qc","qa","qm","qm1","qm2","qm3","qd","b","lh","li","li1","li2","li3","li4","lf","lim","lim1","lim2","lim3","lim4","pb"],Kh=1,Hb=["type","marker","content"];class nt extends Ba{constructor(e=Ji,n,r){super(r),K(this,"__marker"),K(this,"__unknownAttributes"),this.__marker=e,this.__unknownAttributes=n}static getType(){return"para"}static clone(e){const{__marker:n,__unknownAttributes:r,__key:s}=e;return new nt(n,r,s)}static isValidMarker(e){return e!==void 0&&Bb.includes(e)}static importDOM(){return{p:()=>({conversion:Wb,priority:1})}}static importJSON(e){return fs().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const n=this.getWritable();return n.__marker=e,n}getMarker(){return this.getLatest().__marker}setUnknownAttributes(e){const n=this.getWritable();return n.__unknownAttributes=e,n}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("p");return e.setAttribute("data-marker",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`),e}exportDOM(e){const{element:n}=super.exportDOM(e);return n&&bn(n)&&(n.setAttribute("data-marker",this.getMarker()),n.classList.add(this.getType(),`usfm_${this.getMarker()}`)),{element:n}}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),unknownAttributes:this.getUnknownAttributes(),version:Kh}}insertNewAfter(e,n){const r=fs(this.getMarker());return r.setTextFormat(e.format),r.setTextStyle(e.style),r.setDirection(this.getDirection()),r.setFormat(this.getFormatType()),r.setStyle(this.getTextStyle()),this.insertAfter(r,n),r}}function Wb(t){const e=t.getAttribute("data-marker")??void 0,n=fs(e);if(t.style){n.setFormat(t.style.textAlign);const r=parseInt(t.style.textIndent,10)/20;r>0&&n.setIndent(r)}return{node:n}}function fs(t,e){return Ie(new nt(t,e))}function ze(t){return t instanceof nt}function Kb(t){return(t==null?void 0:t.type)===nt.getType()}const Ai="v",zh=1,zb=["type","marker","number","sid","altnumber","pubnumber","content"];class Ge extends jt{constructor(e="",n,r,s,i,o,a){super(n??e,a),K(this,"__marker"),K(this,"__number"),K(this,"__sid"),K(this,"__altnumber"),K(this,"__pubnumber"),K(this,"__unknownAttributes"),this.__marker=Ai,this.__number=e,this.__sid=r,this.__altnumber=s,this.__pubnumber=i,this.__unknownAttributes=o}static getType(){return"verse"}static clone(e){const{__number:n,__text:r,__sid:s,__altnumber:i,__pubnumber:o,__unknownAttributes:a,__key:l}=e;return new Ge(n,r,s,i,o,a,l)}static importJSON(e){return Jh().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setNumber(e.number).setSid(e.sid).setAltnumber(e.altnumber).setPubnumber(e.pubnumber).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const n=this.getWritable();return n.__marker=e,n}getMarker(){return this.getLatest().__marker}setNumber(e){if(this.__number===e)return this;const n=this.getWritable();return n.__number=e,n}getNumber(){return this.getLatest().__number}setSid(e){if(this.__sid===e)return this;const n=this.getWritable();return n.__sid=e,n}getSid(){return this.getLatest().__sid}setAltnumber(e){if(this.__altnumber===e)return this;const n=this.getWritable();return n.__altnumber=e,n}getAltnumber(){return this.getLatest().__altnumber}setPubnumber(e){if(this.__pubnumber===e)return this;const n=this.getWritable();return n.__pubnumber=e,n}getPubnumber(){return this.getLatest().__pubnumber}setUnknownAttributes(e){const n=this.getWritable();return n.__unknownAttributes=e,n}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(e){const n=super.createDOM(e);return n.setAttribute("data-marker",this.__marker),n.classList.add(ka,`usfm_${this.__marker}`),n.setAttribute("data-number",this.__number),n}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),number:this.getNumber(),sid:this.getSid(),altnumber:this.getAltnumber(),pubnumber:this.getPubnumber(),unknownAttributes:this.getUnknownAttributes(),version:zh}}}function Jh(t,e,n,r,s,i){return Ie(new Ge(t,e,n,r,s,i))}function hl(t){return t instanceof Ge}function Jb(t){return(t==null?void 0:t.type)===Ge.getType()}function Vb(t){return Sb(t)||Ib(t)}function ct(t){return al(t)||ks(t)}function Gb(t,e){return t.find(n=>ct(n)&&n.getNumber()===e.toString())}function Yb(t,e=!1){return t.find((n,r)=>(!e||r>0)&&ct(n))}function fl(t){var e;if(!t)return;if(ct(t))return t;let n=(e=t.getTopLevelElement())==null?void 0:e.getPreviousSibling();for(;n&&!ct(n);)n=n.getPreviousSibling();if(n&&ct(n))return n}function Vh(t){let e=t;for(;e!==null;){if(oe(e))return e;e=e.getParent()}}function Xb(t){return Rt(t)||al(t)||pe(t)||ks(t)||Yt(t)||Vi(t)||ze(t)||oe(t)||hl(t)||Zt(t)}function Zb(t){var e;if(t.anchor.type==="element"){const r=t.anchor.getNode(),s=t.anchor.offset;if(s<r.getChildrenSize())return r.getChildAtIndex(s)}const n=t.anchor.getNode();return n.getNextSibling()??((e=n.getParent())==null?void 0:e.getNextSibling())??null}function Qb(t){var e;const n=t.anchor.offset;if(t.anchor.type==="element"&&n>0)return t.anchor.getNode().getChildAtIndex(n-1);const r=t.anchor.getNode();return r.getPreviousSibling()??((e=r.getParent())==null?void 0:e.getPreviousSibling())??null}function yt(t){return ze(t)||Yt(t)}function e_(t,e){let n=t.getParent();for(;n;){if(n.getKey()===e)return!0;n=n.getParent()}return!1}function Ln(t,e){const n=ys(e,$n),r=!!(t.cid&&n),s=!t.cid&&!n;return t.style===e.getMarker()&&(s||r&&t.cid===n)}function t_(t,e){const n=we(t)?t:t.getParent(),r=we(e)?e:e.getParent(),s=n&&r?Rp(n,r):void 0;return s?s.commonAncestor:void 0}function n_(t){const e=t.getStartEndPoints();if(!e)return;const[n,r]=e,s=t.isBackward()?n:r;t.focus.set(s.key,s.offset,s.type),t.anchor.set(s.key,s.offset,s.type)}function pl(t){return(t==null?void 0:t.type)===jt.getType()}function r_(t,e){if(!e)return;const n=t.findIndex(r=>r===e);n&&(t.length=n)}function s_(t,e){if(!e)return t;const n=e.getIndexWithinParent();return t.splice(n+1,t.length-n-1)}function en(t){return`\\${t}`}function pr(t){return`\\${t}*`}function Gh(t,e,n){const r=en(t);if(e!=null&&e.startsWith(r)){const s=parseInt(e.slice(r.length),10);isNaN(s)||(n=s.toString())}return n}function vs(t,e){let n=en(t);return e&&(n+=`${me}${e}`),n+=" ",n}function Yh(t){return pl(t)&&t.text!==me?t.text:Ab(t)?t.children.map(e=>Yh(e)).join(""):""}function i_(t){return t.map(e=>Yh(e)).filter(e=>e.length>0).join(" ").trim()}function gl(t){return me+t+" "}function ml(t){const e=[];for(const n of t){if(!pe(n))continue;const r=n.getTextContent();r!==Gt&&r.length>0&&e.push(r)}return e.join(" ").trim()}function je(t,e=Gf){const n={...t};return e.forEach(r=>{Reflect.deleteProperty(n,r)}),Object.keys(n).length===0?void 0:n}function Ne(t){return Object.fromEntries(Object.entries(t).filter(([,e])=>e!==void 0))}function Xh(t){if(!t)return;const e=t.getNodes();if(e.length>0)return t.isBackward()?e[e.length-1]:e[0]}function Ca(t,e){if(!e)return(t+1).toString();const n=e.split("-");if(n.length===2)return parseInt(n[1])?`${parseInt(n[1])+1}`:`${parseInt(n[0])+1}`;const r=RegExp(/^(\d+)([a-yA-Y]{1,3})$/).exec(e);if(!r)return(parseInt(e)+1).toString();const s=String.fromCharCode(r[2].charCodeAt(0)+1);return`${r[1]}${s}`}function yl(t,e){if(!e)return!1;const n=e.split("-").map(r=>parseInt(r));if(n.length<1||n.length>2||n[0]>n[1])throw new Error("isVerseInRange: invalid range");return n.length===1?t===n[0]:n.length===2&&isNaN(n[1])?t>=n[0]:(n.length===2&&isNaN(n[0])||t>=n[0])&&t<=n[1]}function o_(t){return!!t&&t.includes("-")}const a_=1;class Bn extends jt{constructor(e="",n="opening",r){super(Qo(e,n),r),K(this,"__marker"),K(this,"__markerSyntax"),this.__marker=e,this.__markerSyntax=n}static getType(){return"marker"}static clone(e){return new Bn(e.__marker,e.__markerSyntax,e.__key)}static importJSON(e){return gr().updateFromJSON(e)}updateFromJSON(e){const{marker:n,markerSyntax:r="opening"}=e;return super.updateFromJSON(e).setMarker(n).setMarkerSyntax(r)}setMarker(e){if(this.__marker===e)return this;const n=this.getWritable();return n.__marker=e,n.__text=Qo(e,n.__markerSyntax),n}getMarker(){return this.getLatest().__marker}setMarkerSyntax(e){if(this.__markerSyntax===e)return this;const n=this.getWritable();return n.__markerSyntax=e,n.__text=Qo(n.__marker,e),n}getMarkerSyntax(){return this.getLatest().__markerSyntax}createDOM(e){const n=super.createDOM(e);return n.setAttribute("data-marker",this.__marker),n.classList.add(this.__markerSyntax),n}exportJSON(){return{...super.exportJSON(),type:this.getType(),text:this.getTextContent(),marker:this.getMarker(),markerSyntax:this.getMarkerSyntax(),version:a_}}}function gr(t,e){return Ie(new Bn(t,e))}function ws(t){return t instanceof Bn}function Qo(t,e){return e==="closing"?pr(t):e==="selfClosing"?pr(""):en(t)}const un="internal-comment",l_=[un],Zh=Object.freeze({}),Sa=Object.freeze({}),Ta=Object.freeze({}),c_=1,Wt=new Map,An=new Map;class Fe extends yn{constructor(e=Zh,n,r,s){super(s),K(this,"__typedIDs"),K(this,"__typedOnClicks"),K(this,"__typedOnRemoves"),K(this,"__domOnClickListener"),K(this,"__suppressOnRemoveCallbacks"),this.__typedIDs=Xs(e),this.__typedOnClicks=ea(n),this.__typedOnRemoves=ta(r),this.pruneTypedOnClicks(),this.pruneTypedOnRemoves(),this.syncTypedOnClicksToRegistry(),this.syncTypedOnRemovesToRegistry()}static getType(){return"typed-mark"}static clone(e){const n=Xs(e.__typedIDs),r=ea(e.__typedOnClicks),s=ta(e.__typedOnRemoves);return new Fe(n,r,s,e.__key)}static isReservedType(e){return l_.includes(e)}static importDOM(){return null}static importJSON(e){return ps().updateFromJSON(e)}exportJSON(){return{...super.exportJSON(),type:this.getType(),typedIDs:this.getTypedIDs(),version:c_}}createDOM(e,n){const r=document.createElement("mark");for(const[i,o]of Object.entries(this.__typedIDs)){Et(r,jn(e.theme.typedMark,i)),o.length>1&&Et(r,jn(e.theme.typedMarkOverlap,i));for(const a of o)Et(r,jn("annotationId",a))}const s=this.getOrCreateDOMClickListener(n);return r.addEventListener("click",s),r}updateDOM(e,n,r){const s=new Set([...Object.keys(e.__typedIDs??{}),...Object.keys(this.__typedIDs??{})]);for(const i of s){const o=e.__typedIDs[i]??[],a=this.__typedIDs[i]??[],l=o.length,u=a.length,d=jn(r.theme.typedMark,i),f=jn(r.theme.typedMarkOverlap,i);l!==u&&(l===0?u===1&&Et(n,d):u===0&&hi(n,d),l===1?u===2&&Et(n,f):u===1&&hi(n,f));const h=new Set(o),p=new Set(a);for(const y of o)p.has(y)||hi(n,jn("annotationId",y));for(const y of a)h.has(y)||Et(n,jn("annotationId",y))}return!1}updateFromJSON(e){return super.updateFromJSON(e).setTypedIDs(e.typedIDs)}hasID(e,n){const r=this.getTypedIDs()[e];if(!r)return!1;for(const s of r)if(n===s)return!0;return!1}getTypedIDs(){const e=this.getLatest();return Ee(e)?e.__typedIDs:{}}setTypedIDs(e){const n=this.getWritable(),r=Xs(n.__typedIDs);n.__typedIDs=Xs(e),n.dispatchRemovedIDs(r,n.__typedIDs,"removed"),n.pruneTypedOnClicks(),n.pruneTypedOnRemoves(),n.syncTypedOnClicksToRegistry(),n.syncTypedOnRemovesToRegistry();const s=n.mergeWithAdjacentTypedMarks();return s.hasNoIDsForEveryType()&&s.getParent()!==null&&ji(s),s}setTypedOnClicks(e){const n=this.getWritable();return n.__typedOnClicks=ea(e),n.pruneTypedOnClicks(),n.syncTypedOnClicksToRegistry(),n}getTypedOnClicks(){const e=this.getLatest();return Ee(e)?Wt.get(e.getKey())??{}:{}}setTypedOnRemoves(e){const n=this.getWritable();return n.__typedOnRemoves=ta(e),n.pruneTypedOnRemoves(),n.syncTypedOnRemovesToRegistry(),n}getTypedOnRemoves(){const e=this.getLatest();return Ee(e)?An.get(e.getKey())??{}:{}}addID(e,n,r,s){const i=this.getWritable();if(!Ee(i))return;at(e),at(n);let o=i.__typedIDs[e];o||(o=[],i.__typedIDs[e]=o);for(const a of o)if(n===a){r&&i.setOnClickFor(e,n,r),s&&i.setOnRemoveFor(e,n,s);return}o.push(n),r&&i.setOnClickFor(e,n,r),s&&i.setOnRemoveFor(e,n,s)}deleteID(e,n){const r=this.getWritable();if(!Ee(r))return;const s=r.__typedIDs[e];if(!s||s.length===0)return;for(let o=0;o<s.length;o++)if(n===s[o]){s.splice(o,1),r.invokeOnRemove(e,n,"removed");break}r.removeOnClickFor(e,n),r.removeOnRemoveFor(e,n),r.pruneTypedOnClicks(),r.pruneTypedOnRemoves();const i=r.mergeWithAdjacentTypedMarks();i.hasNoIDsForEveryType()&&i.getParent()!==null&&ji(i)}hasNoIDsForEveryType(){return Object.values(this.getTypedIDs()).every(e=>e===void 0||e.length===0)}insertNewAfter(e,n=!0){const r=ps(this.__typedIDs,this.getTypedOnClicks());return this.insertAfter(r,n),r}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}canBeEmpty(){return!1}isInline(){return!0}extractWithChild(e,n,r){if(!X(n)||r==="html")return!1;const s=n.anchor,i=n.focus,o=s.getNode(),a=i.getNode(),l=n.isBackward()?s.offset-i.offset:i.offset-s.offset;return this.isParentOf(o)&&this.isParentOf(a)&&this.getTextContent().length===l}excludeFromCopy(e){return e!=="clone"}remove(e){const n=this.getWritable(),r=this.getTypedIDs();n.__suppressOnRemoveCallbacks?n.__suppressOnRemoveCallbacks=void 0:n.dispatchOnRemoveForTypedIDs(r,"destroyed"),Wt.delete(n.getKey()),An.delete(n.getKey()),n.__typedOnClicks=void 0,n.__typedOnRemoves=void 0,super.remove.call(n,e)}getOrCreateDOMClickListener(e){return this.__domOnClickListener||(this.__domOnClickListener=n=>{this.handleDOMClick(n,e)}),this.__domOnClickListener}handleDOMClick(e,n){const r=Wt.get(this.getKey());if(!r)return;const s=[];for(const[o,a]of Object.entries(r))for(const[l,u]of Object.entries(a))u&&s.push([u,o,l]);if(s.length===0)return;const i=n.read(()=>this.getTextContent());for(const[o,a,l]of s)o(e,a,l,i)}ensureOnClickMapMutable(){if(this.__typedOnClicks===void 0||this.__typedOnClicks===Sa){const e=Wt.get(this.getKey());this.__typedOnClicks=e??{}}return this.__typedOnClicks}syncTypedOnClicksToRegistry(){if(!this.__typedOnClicks||Object.keys(this.__typedOnClicks).length===0){Wt.delete(this.getKey()),this.__typedOnClicks&&Object.keys(this.__typedOnClicks).length===0&&(this.__typedOnClicks=void 0);return}Wt.set(this.getKey(),this.__typedOnClicks)}setOnClickFor(e,n,r){at(e),at(n);const s=this.ensureOnClickMapMutable(),i=s[e]??(s[e]={});i[n]=r,this.syncTypedOnClicksToRegistry()}removeOnClickFor(e,n){if(!this.__typedOnClicks)return;const r=this.__typedOnClicks[e];if(!r)return;const s=Zs(r,n);if(Object.keys(s).length>0)this.__typedOnClicks={...this.__typedOnClicks,[e]:s};else{const i=Zs(this.__typedOnClicks,e);this.__typedOnClicks=Object.keys(i).length>0?i:void 0}this.syncTypedOnClicksToRegistry()}pruneTypedOnClicks(){if(!this.__typedOnClicks||this.__typedOnClicks===Sa){this.__typedOnClicks=void 0,this.syncTypedOnClicksToRegistry();return}const e={};for(const[n,r]of Object.entries(this.__typedOnClicks)){const s=this.__typedIDs[n];if(!s||s.length===0)continue;const i=new Set(s),o={};for(const[a,l]of Object.entries(r))i.has(a)&&(o[a]=l);Object.keys(o).length>0&&(e[n]=o)}this.__typedOnClicks=Object.keys(e).length>0?e:void 0,this.syncTypedOnClicksToRegistry()}ensureOnRemoveMapMutable(){if(this.__typedOnRemoves===void 0||this.__typedOnRemoves===Ta){const e=An.get(this.getKey());this.__typedOnRemoves=e??{}}return this.__typedOnRemoves}syncTypedOnRemovesToRegistry(){if(!this.__typedOnRemoves||Object.keys(this.__typedOnRemoves).length===0){An.delete(this.getKey()),this.__typedOnRemoves&&Object.keys(this.__typedOnRemoves).length===0&&(this.__typedOnRemoves=void 0);return}An.set(this.getKey(),this.__typedOnRemoves)}setOnRemoveFor(e,n,r){at(e),at(n);const s=this.ensureOnRemoveMapMutable(),i=s[e]??(s[e]={});i[n]=r,this.syncTypedOnRemovesToRegistry()}removeOnRemoveFor(e,n){if(!this.__typedOnRemoves)return;const r=this.__typedOnRemoves[e];if(!r)return;const s=Zs(r,n);if(Object.keys(s).length>0)this.__typedOnRemoves={...this.__typedOnRemoves,[e]:s};else{const i=Zs(this.__typedOnRemoves,e);this.__typedOnRemoves=Object.keys(i).length>0?i:void 0}this.syncTypedOnRemovesToRegistry()}pruneTypedOnRemoves(){if(!this.__typedOnRemoves||this.__typedOnRemoves===Ta){this.__typedOnRemoves=void 0,this.syncTypedOnRemovesToRegistry();return}const e={};for(const[n,r]of Object.entries(this.__typedOnRemoves)){const s=this.__typedIDs[n];if(!s||s.length===0)continue;const i=new Set(s),o={};for(const[a,l]of Object.entries(r))i.has(a)&&(o[a]=l);Object.keys(o).length>0&&(e[n]=o)}this.__typedOnRemoves=Object.keys(e).length>0?e:void 0,this.syncTypedOnRemovesToRegistry()}invokeOnRemove(e,n,r){var s;const i=(s=this.getTypedOnRemoves()[e])==null?void 0:s[n];i&&(i(e,n,r,this.getTextContent()),this.removeOnRemoveFor(e,n))}dispatchRemovedIDs(e,n,r){const s=u_(e,n);if(s.length!==0)for(const[i,o]of s)this.invokeOnRemove(i,o,r)}dispatchOnRemoveForTypedIDs(e,n){for(const[r,s]of Object.entries(e))if(s)for(const i of s)this.invokeOnRemove(r,i,n)}mergeWithAdjacentTypedMarks(){if(this.hasNoIDsForEveryType())return this;let e=this.getPreviousSibling();for(;Ee(e)&&jc(e.getTypedIDs(),this.getTypedIDs());)this.mergeWithPreviousTypedMark(e),e=this.getPreviousSibling();let n=this.getNextSibling();for(;Ee(n)&&jc(this.getTypedIDs(),n.getTypedIDs());)this.mergeWithNextTypedMark(n),n=this.getNextSibling();return this}mergeWithPreviousTypedMark(e){this.mergeOnClicksFrom(e.getTypedOnClicks()),this.mergeOnRemovesFrom(e.getTypedOnRemoves());const n=e.getChildren();n.length>0&&this.splice(0,0,n),Wt.delete(e.getKey()),An.delete(e.getKey()),e.getWritable().__suppressOnRemoveCallbacks=!0,e.remove()}mergeWithNextTypedMark(e){this.mergeOnClicksFrom(e.getTypedOnClicks()),this.mergeOnRemovesFrom(e.getTypedOnRemoves());const n=e.getChildren();n.length>0&&this.append(...n),Wt.delete(e.getKey()),An.delete(e.getKey()),e.getWritable().__suppressOnRemoveCallbacks=!0,e.remove()}mergeOnClicksFrom(e){if(!e||Object.keys(e).length===0)return;const n=d_(this.getTypedOnClicks(),e);Object.keys(n).length!==0&&this.setTypedOnClicks(n)}mergeOnRemovesFrom(e){if(!e||Object.keys(e).length===0)return;const n=h_(this.getTypedOnRemoves(),e);Object.keys(n).length!==0&&this.setTypedOnRemoves(n)}}function Xs(t=Zh){const e={};for(const[n,r]of Object.entries(t)){if(at(n),!Array.isArray(r)){e[n]=[];continue}const s=[];for(const i of r)at(i),s.push(i);e[n]=s}return e}function ea(t){if(!t||t===Sa)return;const e={};for(const[n,r]of Object.entries(t)){at(n);const s={};for(const[i,o]of Object.entries(r))at(i),s[i]=o;Object.keys(s).length>0&&(e[n]=s)}return Object.keys(e).length>0?e:void 0}function ta(t){if(!t||t===Ta)return;const e={};for(const[n,r]of Object.entries(t)){at(n);const s={};for(const[i,o]of Object.entries(r))at(i),s[i]=o;Object.keys(s).length>0&&(e[n]=s)}return Object.keys(e).length>0?e:void 0}function Zs(t,e){const n={};for(const[r,s]of Object.entries(t))r!==e&&(n[r]=s);return n}function Ac(t){const e={};for(const[n,r]of Object.entries(t))!r||r.length===0||(e[n]=[...r].sort());return e}function u_(t,e){const n=[];for(const[r,s]of Object.entries(t)){const i=new Set(e[r]??[]);for(const o of s??[])i.has(o)||n.push([r,o])}return n}function jc(t,e){const n=Ac(t),r=Ac(e),s=Object.keys(n).sort(),i=Object.keys(r).sort();if(s.length!==i.length)return!1;for(let o=0;o<s.length;o++){const a=s[o];if(a!==i[o])return!1;const l=n[a],u=r[a];if(!l||!u||l.length!==u.length)return!1;for(let d=0;d<l.length;d++)if(l[d]!==u[d])return!1}return!0}function d_(t,e){const n={},r=new Set([...Object.keys(t),...Object.keys(e)]);for(const s of r){const i=t[s]??{},o=e[s]??{},a=new Set([...Object.keys(i),...Object.keys(o)]),l={};for(const u of a){const d=i[u]??o[u];d&&(l[u]=d)}Object.keys(l).length>0&&(n[s]=l)}return n}function h_(t,e){const n={},r=new Set([...Object.keys(t),...Object.keys(e)]);for(const s of r){const i=t[s]??{},o=e[s]??{},a=new Set([...Object.keys(i),...Object.keys(o)]),l={};for(const u of a){const d=i[u]??o[u];d&&(l[u]=d)}Object.keys(l).length>0&&(n[s]=l)}return n}function jn(t,e){return`${t}-${e}`}function Nc(t){return`external-${t}`}function ps(t,e,n){return Ie(new Fe(t,e,n))}function Ee(t){return t instanceof Fe}function f_(t){return(t==null?void 0:t.type)===Fe.getType()}function ji(t){const e=t.getChildren();let n=null;for(const r of e)n===null?t.insertBefore(r):n.insertAfter(r),n=r;t.remove(),Wt.delete(t.getKey())}function Qh(t,e,n,r,s){const i=t.getNodes(),o=t.anchor.offset,a=t.focus.offset,l=i.length,u=t.isBackward(),d=u?a:o,f=u?o:a;let h,p;for(let y=0;y<l;y++){const k=i[y];if(we(p)&&p.isParentOf(k))continue;const C=y===0,M=y===l-1;let v=null;if(ee(k)){const O=k.getTextContentSize(),I=C?d:0,D=M?f:O;if(I===0&&D===0)continue;const q=k.splitText(I,D);v=q.length>1&&(q.length===3||C&&!M||D===O)?q[1]:q[0]}else{if(Ee(k))continue;we(k)&&k.isInline()&&(v=k)}if(v!==null){if(v&&v.is(h))continue;const O=v.getParent();(O==null||!O.is(h))&&(p=void 0),h=O,p===void 0&&(p=ps(),p.addID(e,n,r,s),v.insertBefore(p)),p.append(v)}else h=void 0,p=void 0}e===un&&we(p)&&(u?p.selectStart():p.selectEnd())}function p_(t,e,n){let r=t;for(;r!==null;){if(Ee(r))return r.getTypedIDs()[e];if(ee(r)&&n===r.getTextContentSize()){const s=r.getNextSibling();if(Ee(s))return s.getTypedIDs()[e]}r=r.getParent()}}const ef=1;class kn extends vr{constructor(e="",n="",r){super(r),K(this,"__textType"),K(this,"__text"),this.__textType=e,this.__text=n}static getType(){return"immutable-typed-text"}static clone(e){const{__textType:n,__text:r,__key:s}=e;return new kn(n,r,s)}static importDOM(){return{span:e=>m_(e)?{conversion:g_,priority:1}:null}}static importJSON(e){return mr().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setTextType(e.textType).setTextContent(e.text)}setTextType(e){if(this.__textType===e)return this;const n=this.getWritable();return n.__textType=e,n}getTextType(){return this.getLatest().__textType}setTextContent(e){if(this.__text===e)return this;const n=this.getWritable();return n.__text=e,n}getTextContent(){return this.getLatest().__text}createDOM(){const e=document.createElement("span");return e.setAttribute("data-text-type",this.__textType),e.classList.add(this.__textType),e}updateDOM(){return!1}exportDOM(e){const{element:n}=super.exportDOM(e);return n&&bn(n)&&n.setAttribute("data-text-type",this.getTextType()),{element:n}}decorate(){return this.getTextContent()}exportJSON(){return{type:this.getType(),textType:this.getTextType(),text:this.getTextContent(),version:ef}}isKeyboardSelectable(){return!1}}function g_(t){const e=t.getAttribute("data-text-type")??"",n=t.textContent??"";return{node:mr(e,n)}}function mr(t,e){return Ie(new kn(t,e))}function m_(t){return(t==null?void 0:t.tagName)==="span"}function Ni(t){return t instanceof kn}function y_(t){return(t==null?void 0:t.type)===kn.getType()}const Ii="unmatched",tf=1;class vn extends vr{constructor(e="",n){super(n),K(this,"__marker"),this.__marker=e}static getType(){return"unmatched"}static clone(e){const{__marker:n,__key:r}=e;return new vn(n,r)}static importDOM(){return{[Ii]:e=>__(e)?{conversion:b_,priority:1}:null}}static importJSON(e){return bl().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker)}setMarker(e){if(this.__marker===e)return this;const n=this.getWritable();return n.__marker=e,n}getMarker(){return this.getLatest().__marker}createDOM(){const e=document.createElement(Ii);e.setAttribute("data-marker",this.__marker),e.classList.add(Mc);const n=this.__marker.endsWith("*");return e.title=n?"This closing marker has no matching opening marker!":"This opening marker has no matching closing marker!",e}updateDOM(){return!1}exportDOM(e){const{element:n}=super.exportDOM(e);return n&&bn(n)&&(n.setAttribute("data-marker",this.getMarker()),n.classList.add(Mc)),{element:n}}decorate(){return`\\${this.getMarker()}${_a}`}exportJSON(){return{type:this.getType(),marker:this.getMarker(),version:tf}}isKeyboardSelectable(){return!1}}function b_(t){const e=t.getAttribute("data-marker")??"";return{node:bl(e)}}function bl(t){return Ie(new vn(t))}function __(t){return(t==null?void 0:t.tagName)===Ii}function nf(t){return t instanceof vn}const k_=[dt,Qt,vt,Ge,Ce,$e,$t,Bn,Un,kn,vn,nt,fn,{replace:Ba,with:()=>bt(),withKlass:fn}];var T;(function(t){t.FileIdentification="FileIdentification",t.Headers="Headers",t.Remarks="Remarks",t.Introduction="Introduction",t.DivisionMarks="DivisionMarks",t.Paragraphs="Paragraphs",t.Poetry="Poetry",t.TitlesHeadings="TitlesHeadings",t.Tables="Tables",t.CenterTables="CenterTables",t.RightTables="RightTables",t.Lists="Lists",t.Footnotes="Footnotes",t.CrossReferences="CrossReferences",t.SpecialText="SpecialText",t.CharacterStyling="CharacterStyling",t.Breaks="Breaks",t.SpecialFeatures="SpecialFeatures",t.PeripheralReferences="PeripheralReferences",t.PeripheralMaterials="PeripheralMaterials",t.Uncategorized="Uncategorized"})(T||(T={}));var S;(function(t){t.Paragraph="Paragraph",t.Character="Character",t.Note="Note",t.Unknown="Unknown"})(S||(S={}));const v_={id:{category:T.FileIdentification,type:S.Paragraph,description:"File identification information (BOOKID, FILENAME, EDITOR, MODIFICATION DATE)",hasEndMarker:!1,children:{FileIdentification:["usfm","ide"],Headers:["h","h1","h2","h3","toc1","toc2","toc3"],Remarks:["rem","sts","restore"],Introduction:["imt","imt1","imt2","imt3","imt4","imte","imte1","imte2","is","is1","is2","iot","io","io1","io2","io3","io4","ior","ip","im","ipi","imi","ili","ili1","ili2","ipq","imq","ipr","ib","iq","iq1","iq2","iq3","iex","ie"],DivisionMarks:["c","cl"],TitlesHeadings:["mt","mt1","mt2","mt3","mt4"]}},usfm:{category:T.FileIdentification,type:S.Paragraph,description:"File markup version information",hasEndMarker:!1,children:void 0},ide:{category:T.FileIdentification,type:S.Paragraph,description:"File encoding information",hasEndMarker:!1,children:{Remarks:["rem","sts"]}},h:{category:T.Headers,type:S.Paragraph,description:"Running header text for a book (basic)",hasEndMarker:!1,children:{Headers:["toc1","toc2","toc3","toca1","toca2","toca3"]}},h1:{category:T.Headers,type:S.Paragraph,description:"Running header text",hasEndMarker:!1,children:{Headers:["toc1","toc2","toc3","toca1","toca2","toca3"]}},h2:{category:T.Headers,type:S.Paragraph,description:"Running header text, left side of page",hasEndMarker:!1,children:{Headers:["toc1","toc2","toc3","toca1","toca2","toca3"]}},h3:{category:T.Headers,type:S.Paragraph,description:"Running header text, right side of page",hasEndMarker:!1,children:{Headers:["toc1","toc2","toc3","toca1","toca2","toca3"]}},toc1:{category:T.Headers,type:S.Paragraph,description:"Long table of contents text",hasEndMarker:!1,children:void 0},toc2:{category:T.Headers,type:S.Paragraph,description:"Short table of contents text",hasEndMarker:!1,children:void 0},toc3:{category:T.Headers,type:S.Paragraph,description:"Book Abbreviation",hasEndMarker:!1,children:void 0},toca1:{category:T.Headers,type:S.Paragraph,description:"Alternative language long table of contents text",hasEndMarker:!1,children:void 0},toca2:{category:T.Headers,type:S.Paragraph,description:"Alternative language short table of contents text",hasEndMarker:!1,children:void 0},toca3:{category:T.Headers,type:S.Paragraph,description:"Alternative language book Abbreviation",hasEndMarker:!1,children:void 0},rem:{category:T.Remarks,type:S.Paragraph,description:"Comments and remarks",hasEndMarker:!1,children:void 0},sts:{category:T.Remarks,type:S.Paragraph,description:"Status of this file",hasEndMarker:!1,children:void 0},restore:{category:T.Remarks,type:S.Paragraph,description:"Project restore information",hasEndMarker:!1,children:void 0},imt:{category:T.Introduction,type:S.Paragraph,description:"Introduction major title, level 1 (if single level) (basic)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imt1:{category:T.Introduction,type:S.Paragraph,description:"Introduction major title, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imt2:{category:T.Introduction,type:S.Paragraph,description:"Introduction major title, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imt3:{category:T.Introduction,type:S.Paragraph,description:"Introduction major title, level 3",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imt4:{category:T.Introduction,type:S.Paragraph,description:"Introduction major title, level 4 (usually within parenthesis)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imte:{category:T.Introduction,type:S.Paragraph,description:"Introduction major title at introduction end, level 1 (if single level)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imte1:{category:T.Introduction,type:S.Paragraph,description:"Introduction major title at introduction end, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imte2:{category:T.Introduction,type:S.Paragraph,description:"Introduction major title at introduction end, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},is:{category:T.Introduction,type:S.Paragraph,description:"Introduction section heading, level 1 (if single level) (basic)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"],CharacterStyling:["no"]}},is1:{category:T.Introduction,type:S.Paragraph,description:"Introduction section heading, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},is2:{category:T.Introduction,type:S.Paragraph,description:"Introduction section heading, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},iot:{category:T.Introduction,type:S.Paragraph,description:"Introduction outline title (basic)",hasEndMarker:!1,children:{Introduction:["iqt"],CharacterStyling:["no"]}},io:{category:T.Introduction,type:S.Paragraph,description:"Introduction outline text, level 1 (if single level)",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},io1:{category:T.Introduction,type:S.Paragraph,description:"Introduction outline text, level 1 (if multiple levels) (basic)",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},io2:{category:T.Introduction,type:S.Paragraph,description:"Introduction outline text, level 2",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},io3:{category:T.Introduction,type:S.Paragraph,description:"Introduction outline text, level 3",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},io4:{category:T.Introduction,type:S.Paragraph,description:"Introduction outline text, level 4",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ior:{category:T.Introduction,type:S.Character,description:"Introduction references range for outline entry; for marking references separately",hasEndMarker:!0,children:void 0},ip:{category:T.Introduction,type:S.Paragraph,description:"Introduction prose paragraph (basic)",hasEndMarker:!1,children:{Introduction:["iqt"],Footnotes:["f","fe","fm"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},im:{category:T.Introduction,type:S.Paragraph,description:"Introduction prose paragraph, with no first line indent (may occur after poetry)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ipi:{category:T.Introduction,type:S.Paragraph,description:"Introduction prose paragraph, indented, with first line indent",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},imi:{category:T.Introduction,type:S.Paragraph,description:"Introduction prose paragraph text, indented, with no first line indent",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ili:{category:T.Introduction,type:S.Paragraph,description:"A list entry, level 1 (if single level)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ili1:{category:T.Introduction,type:S.Paragraph,description:"A list entry, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ili2:{category:T.Introduction,type:S.Paragraph,description:"A list entry, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ipq:{category:T.Introduction,type:S.Paragraph,description:"Introduction prose paragraph, quote from the body text",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},imq:{category:T.Introduction,type:S.Paragraph,description:"Introduction prose paragraph, quote from the body text, with no first line indent",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ipr:{category:T.Introduction,type:S.Paragraph,description:"Introduction prose paragraph, right aligned",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},ib:{category:T.Introduction,type:S.Paragraph,description:"Introduction blank line",hasEndMarker:!1,children:{Introduction:["iqt"]}},iq:{category:T.Introduction,type:S.Paragraph,description:"Introduction poetry text, level 1 (if single level)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},iq1:{category:T.Introduction,type:S.Paragraph,description:"Introduction poetry text, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},iq2:{category:T.Introduction,type:S.Paragraph,description:"Introduction poetry text, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},iq3:{category:T.Introduction,type:S.Paragraph,description:"Introduction poetry text, level 3",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},iex:{category:T.Introduction,type:S.Paragraph,description:"Introduction explanatory or bridge text (e.g. explanation of missing book in Short Old Testament)",hasEndMarker:!1,children:{Introduction:["iqt"],CharacterStyling:["no"]}},iqt:{category:T.Introduction,type:S.Character,description:"For quoted scripture text appearing in the introduction",hasEndMarker:!0,children:void 0},ie:{category:T.Introduction,type:S.Paragraph,description:"Introduction ending marker",hasEndMarker:!1,children:void 0},c:{category:T.DivisionMarks,type:S.Paragraph,description:"Chapter number",hasEndMarker:!1,children:{DivisionMarks:["ca","cp","cl","cd"],Paragraphs:["p","m","po","pr","cls","pi","pi1","pi2","pi3","pc","mi","nb"],Poetry:["q","q1","q2","q3","q4","qc","qr","qa","qd","b"],TitlesHeadings:["mte","ms","ms1","ms2","ms3","s","s1","s2","s3","s4","r","sp","d","sd","sd1","sd2","sd3","sd4"],Lists:["lh","li","li1","li2","li3","li4","lf","lim","lim1","lim2","lim3","lim4"],Footnotes:["f","fe"],SpecialText:["lit"],Breaks:["pb"]}},ca:{category:T.DivisionMarks,type:S.Character,description:"Second (alternate) chapter number (for coding dual versification; useful for places where different traditions of chapter breaks need to be supported in the same translation)",hasEndMarker:!0,children:void 0},cp:{category:T.DivisionMarks,type:S.Paragraph,description:"Published chapter number (chapter string that should appear in the published text)",hasEndMarker:!1,children:{Footnotes:["f"]}},cl:{category:T.DivisionMarks,type:S.Paragraph,description:"Chapter label used for translations that add a word such as 'Chapter' before chapter numbers (e.g. Psalms). The subsequent text is the chapter label.",hasEndMarker:!1,children:void 0},cd:{category:T.DivisionMarks,type:S.Paragraph,description:"Chapter Description (Publishing option D, e.g. in Russian Bibles)",hasEndMarker:!1,children:{DivisionMarks:["vp"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},v:{category:T.DivisionMarks,type:S.Character,description:"A verse number",hasEndMarker:!1,children:void 0},va:{category:T.DivisionMarks,type:S.Character,description:"Second (alternate) verse number (for coding dual numeration in Psalms; see also NRSV Exo 22.1-4)",hasEndMarker:!0,children:void 0},vp:{category:T.DivisionMarks,type:S.Character,description:"Published verse marker (verse string that should appear in the published text)",hasEndMarker:!0,children:void 0},p:{category:T.Paragraphs,type:S.Paragraph,description:"Paragraph text, with first line indent (basic)",hasEndMarker:!1,children:{Paragraphs:["pmo","pm","pmc","pmr"],Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},m:{category:T.Paragraphs,type:S.Paragraph,description:"Paragraph text, with no first line indent (may occur after poetry) (basic)",hasEndMarker:!1,children:{Paragraphs:["pmo","pm","pmc","pmr"],Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},po:{category:T.Paragraphs,type:S.Paragraph,description:"Letter opening",hasEndMarker:!1,children:{Paragraphs:["pmo","pm","pmc","pmr"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pr:{category:T.Paragraphs,type:S.Paragraph,description:"Text refrain (paragraph text, right aligned)",hasEndMarker:!1,children:{Paragraphs:["pmo","pm","pmc","pmr"],Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},cls:{category:T.Paragraphs,type:S.Paragraph,description:"Letter Closing",hasEndMarker:!1,children:{SpecialText:["tl","sig","pn","png","addpn","add"]}},pmo:{category:T.Paragraphs,type:S.Paragraph,description:"Embedded text opening",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pm:{category:T.Paragraphs,type:S.Paragraph,description:"Embedded text paragraph",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pmc:{category:T.Paragraphs,type:S.Paragraph,description:"Embedded text closing",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pmr:{category:T.Paragraphs,type:S.Paragraph,description:"Embedded text refrain (e.g. Then all the people shall say, 'Amen!')",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pi:{category:T.Paragraphs,type:S.Paragraph,description:"Paragraph text, level 1 indent (if single level), with first line indent; often used for discourse (basic)",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pi1:{category:T.Paragraphs,type:S.Paragraph,description:"Paragraph text, level 1 indent (if multiple levels), with first line indent; often used for discourse",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pi2:{category:T.Paragraphs,type:S.Paragraph,description:"Paragraph text, level 2 indent, with first line indent; often used for discourse",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pi3:{category:T.Paragraphs,type:S.Paragraph,description:"Paragraph text, level 3 indent, with first line indent; often used for discourse",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pc:{category:T.Paragraphs,type:S.Paragraph,description:"Paragraph text, centered (for Inscription)",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},mi:{category:T.Paragraphs,type:S.Paragraph,description:"Paragraph text, indented, with no first line indent; often used for discourse",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},nb:{category:T.Paragraphs,type:S.Paragraph,description:"Paragraph text, with no break from previous paragraph text (at chapter boundary) (basic)",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q:{category:T.Poetry,type:S.Paragraph,description:"Poetry text, level 1 indent (if single level)",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q1:{category:T.Poetry,type:S.Paragraph,description:"Poetry text, level 1 indent (if multiple levels) (basic)",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q2:{category:T.Poetry,type:S.Paragraph,description:"Poetry text, level 2 indent (basic)",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q3:{category:T.Poetry,type:S.Paragraph,description:"Poetry text, level 3 indent",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q4:{category:T.Poetry,type:S.Paragraph,description:"Poetry text, level 4 indent",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qc:{category:T.Poetry,type:S.Paragraph,description:"Poetry text, centered",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qr:{category:T.Poetry,type:S.Paragraph,description:"Poetry text, Right Aligned",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qs:{category:T.Poetry,type:S.Character,description:"Poetry text, Selah",hasEndMarker:!0,children:{Footnotes:["f"],CrossReferences:["x"]}},qa:{category:T.Poetry,type:S.Paragraph,description:"Poetry text, Acrostic marker/heading",hasEndMarker:!1,children:void 0},qac:{category:T.Poetry,type:S.Character,description:"Poetry text, Acrostic markup of the first character of a line of acrostic poetry",hasEndMarker:!0,children:void 0},qm:{category:T.Poetry,type:S.Paragraph,description:"Poetry text, embedded, level 1 indent (if single level)",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qm1:{category:T.Poetry,type:S.Paragraph,description:"Poetry text, embedded, level 1 indent (if multiple levels)",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qm2:{category:T.Poetry,type:S.Paragraph,description:"Poetry text, embedded, level 2 indent",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qm3:{category:T.Poetry,type:S.Paragraph,description:"Poetry text, embedded, level 3 indent",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qd:{category:T.Poetry,type:S.Paragraph,description:"A Hebrew musical performance annotation, similar in content to Hebrew descriptive title.",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},b:{category:T.Poetry,type:S.Paragraph,description:"Poetry text stanza break (e.g. stanza break) (basic)",hasEndMarker:!1,children:void 0},mt:{category:T.TitlesHeadings,type:S.Paragraph,description:"The main title of the book (if single level)",hasEndMarker:!1,children:{Footnotes:["f"],CrossReferences:["x"]}},mt1:{category:T.TitlesHeadings,type:S.Paragraph,description:"The main title of the book (if multiple levels) (basic)",hasEndMarker:!1,children:{Footnotes:["f"],CrossReferences:["x"]}},mt2:{category:T.TitlesHeadings,type:S.Paragraph,description:"A secondary title usually occurring before the main title (basic)",hasEndMarker:!1,children:{Footnotes:["f"],CrossReferences:["x"]}},mt3:{category:T.TitlesHeadings,type:S.Paragraph,description:"A secondary title occurring after the main title",hasEndMarker:!1,children:{Footnotes:["f"],CrossReferences:["x"]}},mt4:{category:T.TitlesHeadings,type:S.Paragraph,description:"A small secondary title sometimes occurring within parentheses",hasEndMarker:!1,children:void 0},mte:{category:T.TitlesHeadings,type:S.Paragraph,description:"The main title of the book repeated at the end of the book, level 1 (if single level)",hasEndMarker:!1,children:void 0},mte1:{category:T.TitlesHeadings,type:S.Paragraph,description:"The main title of the book repeated at the end of the book, level 1 (if multiple levels)",hasEndMarker:!1,children:{TitlesHeadings:["mte2"]}},mte2:{category:T.TitlesHeadings,type:S.Paragraph,description:"A secondary title occurring before or after the 'ending' main title",hasEndMarker:!1,children:void 0},ms:{category:T.TitlesHeadings,type:S.Paragraph,description:"A major section division heading, level 1 (if single level) (basic)",hasEndMarker:!1,children:{TitlesHeadings:["mr"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},ms1:{category:T.TitlesHeadings,type:S.Paragraph,description:"A major section division heading, level 1 (if multiple levels)",hasEndMarker:!1,children:{TitlesHeadings:["mr"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},ms2:{category:T.TitlesHeadings,type:S.Paragraph,description:"A major section division heading, level 2",hasEndMarker:!1,children:{TitlesHeadings:["mr"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},ms3:{category:T.TitlesHeadings,type:S.Paragraph,description:"A major section division heading, level 3",hasEndMarker:!1,children:{TitlesHeadings:["mr"],Footnotes:["f","fe"]}},mr:{category:T.TitlesHeadings,type:S.Paragraph,description:"A major section division references range heading (basic)",hasEndMarker:!1,children:void 0},s:{category:T.TitlesHeadings,type:S.Paragraph,description:"A section heading, level 1 (if single level) (basic)",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},s1:{category:T.TitlesHeadings,type:S.Paragraph,description:"A section heading, level 1 (if multiple levels)",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},s2:{category:T.TitlesHeadings,type:S.Paragraph,description:"A section heading, level 2 (e.g. Proverbs 22-24)",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},s3:{category:T.TitlesHeadings,type:S.Paragraph,description:"A section heading, level 3 (e.g. Genesis 'The First Day')",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},s4:{category:T.TitlesHeadings,type:S.Paragraph,description:"A section heading, level 4",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},sr:{category:T.TitlesHeadings,type:S.Paragraph,description:"A section division references range heading",hasEndMarker:!1,children:void 0},r:{category:T.TitlesHeadings,type:S.Paragraph,description:"Parallel reference(s) (basic)",hasEndMarker:!1,children:void 0},sp:{category:T.TitlesHeadings,type:S.Paragraph,description:"A heading, to identify the speaker (e.g. Job)",hasEndMarker:!1,children:{Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},d:{category:T.TitlesHeadings,type:S.Paragraph,description:"A Hebrew text heading, to provide description (e.g. Psalms)",hasEndMarker:!1,children:{Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},sd:{category:T.TitlesHeadings,type:S.Paragraph,description:"Vertical space used to divide the text into sections, level 1 (if single level)",hasEndMarker:!1,children:void 0},sd1:{category:T.TitlesHeadings,type:S.Paragraph,description:"Vertical space used to divide the text into sections, level 1 (if multiple levels)",hasEndMarker:!1,children:void 0},sd2:{category:T.TitlesHeadings,type:S.Paragraph,description:"Vertical space used to divide the text into sections, level 2",hasEndMarker:!1,children:void 0},sd3:{category:T.TitlesHeadings,type:S.Paragraph,description:"Vertical space used to divide the text into sections, level 3",hasEndMarker:!1,children:void 0},sd4:{category:T.TitlesHeadings,type:S.Paragraph,description:"Vertical space used to divide the text into sections, level 4",hasEndMarker:!1,children:void 0},lh:{category:T.Lists,type:S.Paragraph,description:"List header (introductory remark)",hasEndMarker:!1,children:{Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li:{category:T.Lists,type:S.Paragraph,description:"A list entry, level 1 (if single level)",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li1:{category:T.Lists,type:S.Paragraph,description:"A list entry, level 1 (if multiple levels)",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li2:{category:T.Lists,type:S.Paragraph,description:"A list entry, level 2",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li3:{category:T.Lists,type:S.Paragraph,description:"A list entry, level 3",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li4:{category:T.Lists,type:S.Paragraph,description:"A list entry, level 4",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lf:{category:T.Lists,type:S.Paragraph,description:"List footer (concluding remark)",hasEndMarker:!1,children:{Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim:{category:T.Lists,type:S.Paragraph,description:"An embedded list entry, level 1 (if single level)",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim1:{category:T.Lists,type:S.Paragraph,description:"An embedded list entry, level 1 (if multiple levels)",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim2:{category:T.Lists,type:S.Paragraph,description:"An embedded list entry, level 2",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim3:{category:T.Lists,type:S.Paragraph,description:"An embedded list item, level 3",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim4:{category:T.Lists,type:S.Paragraph,description:"An embedded list entry, level 4",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},litl:{category:T.Lists,type:S.Character,description:"List entry total text",hasEndMarker:!0,children:void 0},lik:{category:T.Lists,type:S.Character,description:"Structured list entry key text",hasEndMarker:!0,children:void 0},liv:{category:T.Lists,type:S.Character,description:"Structured list entry value 1 content (if single value)",hasEndMarker:!0,children:void 0},liv1:{category:T.Lists,type:S.Character,description:"Structured list entry value 1 content (if multiple values)",hasEndMarker:!0,children:void 0},liv2:{category:T.Lists,type:S.Character,description:"Structured list entry value 2 content",hasEndMarker:!0,children:void 0},liv3:{category:T.Lists,type:S.Character,description:"Structured list entry value 3 content",hasEndMarker:!0,children:void 0},liv4:{category:T.Lists,type:S.Character,description:"Structured list entry value 4 content",hasEndMarker:!0,children:void 0},liv5:{category:T.Lists,type:S.Character,description:"Structured list entry value 5 content",hasEndMarker:!0,children:void 0},f:{category:T.Footnotes,type:S.Note,description:"A Footnote text item (basic)",hasEndMarker:!0,children:{Footnotes:["fr","ft","fk","fq","fqa","fl","fw","fp","fv","fdc"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},fe:{category:T.Footnotes,type:S.Note,description:"An Endnote text item",hasEndMarker:!0,children:{Footnotes:["fr","ft","fk","fq","fqa","fl","fw","fp","fv","fdc"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},fr:{category:T.Footnotes,type:S.Character,description:"The origin reference for the footnote (basic)",hasEndMarker:!0,children:void 0},ft:{category:T.Footnotes,type:S.Character,description:"Footnote text, Protocanon (basic)",hasEndMarker:!0,children:void 0},fk:{category:T.Footnotes,type:S.Character,description:"A footnote keyword (basic)",hasEndMarker:!0,children:void 0},fq:{category:T.Footnotes,type:S.Character,description:"A footnote scripture quote or alternate rendering (basic)",hasEndMarker:!0,children:void 0},fqa:{category:T.Footnotes,type:S.Character,description:"A footnote alternate rendering for a portion of scripture text",hasEndMarker:!0,children:void 0},fl:{category:T.Footnotes,type:S.Character,description:"A footnote label text item, for marking or 'labelling' the type or alternate translation being provided in the note.",hasEndMarker:!0,children:void 0},fw:{category:T.Footnotes,type:S.Character,description:"A footnote witness list, for distinguishing a list of sigla representing witnesses in critical editions.",hasEndMarker:!0,children:void 0},fp:{category:T.Footnotes,type:S.Character,description:"A Footnote additional paragraph marker",hasEndMarker:!0,children:void 0},fv:{category:T.Footnotes,type:S.Character,description:"A verse number within the footnote text",hasEndMarker:!0,children:void 0},fdc:{category:T.Footnotes,type:S.Character,description:"Footnote text, applies to Deuterocanon only",hasEndMarker:!0,children:void 0},fm:{category:T.Footnotes,type:S.Character,description:"An additional footnote marker location for a previous footnote",hasEndMarker:!0,children:void 0},x:{category:T.CrossReferences,type:S.Note,description:"A list of cross references (basic)",hasEndMarker:!0,children:{CrossReferences:["xo","xop","xt","xta","xk","xq","xot","xnt","xdc"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},xo:{category:T.CrossReferences,type:S.Character,description:"The cross reference origin reference (basic)",hasEndMarker:!0,children:void 0},xop:{category:T.CrossReferences,type:S.Character,description:"Published cross reference origin reference (origin reference that should appear in the published text)",hasEndMarker:!0,children:void 0},xt:{category:T.CrossReferences,type:S.Character,description:"The cross reference target reference(s), protocanon only (basic)",hasEndMarker:!0,children:void 0},xta:{category:T.CrossReferences,type:S.Character,description:"Cross reference target references added text",hasEndMarker:!0,children:void 0},xk:{category:T.CrossReferences,type:S.Character,description:"A cross reference keyword",hasEndMarker:!0,children:void 0},xq:{category:T.CrossReferences,type:S.Character,description:"A cross-reference quotation from the scripture text",hasEndMarker:!0,children:void 0},xot:{category:T.CrossReferences,type:S.Character,description:"Cross-reference target reference(s), Old Testament only",hasEndMarker:!0,children:void 0},xnt:{category:T.CrossReferences,type:S.Character,description:"Cross-reference target reference(s), New Testament only",hasEndMarker:!0,children:void 0},xdc:{category:T.CrossReferences,type:S.Character,description:"Cross-reference target reference(s), Deuterocanon only",hasEndMarker:!0,children:void 0},rq:{category:T.CrossReferences,type:S.Character,description:"A cross-reference indicating the source text for the preceding quotation.",hasEndMarker:!0,children:void 0},qt:{category:T.SpecialText,type:S.Character,description:"For Old Testament quoted text appearing in the New Testament (basic)",hasEndMarker:!0,children:void 0},nd:{category:T.SpecialText,type:S.Character,description:"For name of deity (basic)",hasEndMarker:!0,children:void 0},tl:{category:T.SpecialText,type:S.Character,description:"For transliterated words",hasEndMarker:!0,children:void 0},dc:{category:T.SpecialText,type:S.Character,description:"Deuterocanonical/LXX additions or insertions in the Protocanonical text",hasEndMarker:!0,children:void 0},bk:{category:T.SpecialText,type:S.Character,description:"For the quoted name of a book",hasEndMarker:!0,children:void 0},sig:{category:T.SpecialText,type:S.Character,description:"For the signature of the author of an Epistle",hasEndMarker:!0,children:void 0},pn:{category:T.SpecialText,type:S.Character,description:"For a proper name",hasEndMarker:!0,children:void 0},png:{category:T.SpecialText,type:S.Character,description:"For a geographic proper name",hasEndMarker:!0,children:void 0},addpn:{category:T.SpecialText,type:S.Character,description:"For chinese words to be dot underline & underline",hasEndMarker:!0,children:void 0},wj:{category:T.SpecialText,type:S.Character,description:"For marking the words of Jesus",hasEndMarker:!0,children:void 0},k:{category:T.SpecialText,type:S.Character,description:"For a keyword",hasEndMarker:!0,children:void 0},sls:{category:T.SpecialText,type:S.Character,description:"To represent where the original text is in a secondary language or from an alternate text source",hasEndMarker:!0,children:void 0},ord:{category:T.SpecialText,type:S.Character,description:"For the text portion of an ordinal number",hasEndMarker:!0,children:void 0},add:{category:T.SpecialText,type:S.Character,description:"For a translational addition to the text",hasEndMarker:!0,children:void 0},lit:{category:T.SpecialText,type:S.Paragraph,description:"For a comment or note inserted for liturgical use",hasEndMarker:!1,children:void 0},no:{category:T.CharacterStyling,type:S.Character,description:"A character style, use normal text",hasEndMarker:!0,children:void 0},it:{category:T.CharacterStyling,type:S.Character,description:"A character style, use italic text",hasEndMarker:!0,children:void 0},bd:{category:T.CharacterStyling,type:S.Character,description:"A character style, use bold text",hasEndMarker:!0,children:void 0},bdit:{category:T.CharacterStyling,type:S.Character,description:"A character style, use bold + italic text",hasEndMarker:!0,children:void 0},em:{category:T.CharacterStyling,type:S.Character,description:"A character style, use emphasized text style",hasEndMarker:!0,children:void 0},sc:{category:T.CharacterStyling,type:S.Character,description:"A character style, for small capitalization text",hasEndMarker:!0,children:void 0},sup:{category:T.CharacterStyling,type:S.Character,description:"A character style, for superscript text. Typically for use in critical edition footnotes.",hasEndMarker:!0,children:void 0},pb:{category:T.Breaks,type:S.Paragraph,description:"Page Break used for new reader portions and children's bibles where content is controlled by the page",hasEndMarker:!1,children:void 0}},Nn={DivisionMarks:{add:["v","c"],remove:[]},Paragraphs:{add:["p"],remove:[]},Poetry:{add:["q","q1","q2","q3","q4","b"],remove:[]},TitlesHeadings:{add:["mte","ms","ms1","ms2","ms3","s","s1","s2","s3","s4","r","sp","d","sd","sd1","sd2","sd3","sd4"],remove:[]}},w_={p:{children:Nn},q:{children:Nn},q1:{children:Nn},q2:{children:Nn},q3:{children:Nn},q4:{children:Nn},b:{children:Nn},qm:{children:{Paragraphs:{add:["p"],remove:[]}}},c:{type:S.Paragraph,children:null},v:{children:null}};function Ic(t){const e=v_[t],n=w_[t];if(!e)return;if(!n)return e;let r=e.children?{...e.children}:void 0;if(n.children===null&&(r=void 0),n.children){r=r||{};for(const[s,i]of Object.entries(n.children)){const o=s;if(i===null)Reflect.deleteProperty(r,o);else{let a=r[o]||[];i.remove&&(a=a.filter(l=>!i.remove.includes(l))),i.add&&(a=[...new Set([...a,...i.add])]),a.length>0?r[o]=a:Reflect.deleteProperty(r,o)}}Object.keys(r).length===0&&(r=void 0)}return{...e,...n,children:r}}function Rc(t,e,n){const r={type:ss,version:is,content:t},s=e.serializeEditorState(r,n);return cl(s.root.children[0])?s.root.children[0].children[0]:s.root.children[0]}function Ea(t,e){if(!t||!ee(t))return[void 0,void 0];const n=t.getTextContent();if(e>=0&&e<n.length)return[t,e];let r=t.getNextSibling();if(!r){const i=t.getParent();Ee(i)&&(r=i.getNextSibling())}if(!r||!Ee(r)&&!ee(r))return[void 0,void 0];const s=e-n.length;return r&&ee(r)?Ea(r,s):Ea(r.getFirstChild()??void 0,s)}function Pc(t){const e=Jf(t.jsonPath);let n=Dt();for(const r of e){if(!n||!we(n))return[void 0,void 0];n=n.getChildAtIndex(r)??void 0}return Ea(n,t.offset)}function $c(t){return we(t)?"element":"text"}function _l(t){const{start:e}=t;let{end:n}=t;n===void 0&&(n=e);const[r,s]=Pc(e),[i,o]=Pc(n);if(!r||!i||s===void 0||o===void 0)return;const a=gd();return a.anchor=$l(r.getKey(),s,$c(r)),a.focus=$l(i.getKey(),o,$c(i)),a}function Dc(t,e){const n=[];let r=t;for(;r!=null&&r.getParent();){const s=r.getParent();if(s){const i=s==null?void 0:s.getChildren().indexOf(r);i>=0&&n.unshift(i)}r=s}return{jsonPath:Vf(n),offset:e}}function rf(){const t=re();if(!t||!X(t))return;const e=t.isBackward()?t.focus.getNode():t.anchor.getNode(),n=t.isBackward()?t.focus.offset:t.anchor.offset,r=Dc(e,n);if(t.isCollapsed())return{start:r};const s=t.isBackward()?t.anchor.getNode():t.focus.getNode(),i=t.isBackward()?t.anchor.offset:t.focus.offset,o=Dc(s,i);return{start:r,end:o}}const sf="v",of=1;class Ye extends vr{constructor(e="",n=!1,r,s,i,o,a){super(a),K(this,"__marker"),K(this,"__number"),K(this,"__showMarker"),K(this,"__sid"),K(this,"__altnumber"),K(this,"__pubnumber"),K(this,"__unknownAttributes"),this.__marker=sf,this.__number=e,this.__showMarker=n,this.__sid=r,this.__altnumber=s,this.__pubnumber=i,this.__unknownAttributes=o}static getType(){return"immutable-verse"}static clone(e){const{__number:n,__showMarker:r,__sid:s,__altnumber:i,__pubnumber:o,__unknownAttributes:a,__key:l}=e;return new Ye(n,r,s,i,o,a,l)}static importDOM(){return{span:e=>C_(e)?{conversion:x_,priority:1}:null}}static importJSON(e){return kl().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setNumber(e.number).setShowMarker(e.showMarker).setSid(e.sid).setAltnumber(e.altnumber).setPubnumber(e.pubnumber).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const n=this.getWritable();return n.__marker=e,n}getMarker(){return this.getLatest().__marker}setNumber(e){if(this.__number===e)return this;const n=this.getWritable();return n.__number=e,n}getNumber(){return this.getLatest().__number}setShowMarker(e=!1){if(this.__showMarker===e)return this;const n=this.getWritable();return n.__showMarker=e,n}getShowMarker(){return this.getLatest().__showMarker}setSid(e){if(this.__sid===e)return this;const n=this.getWritable();return n.__sid=e,n}getSid(){return this.getLatest().__sid}setAltnumber(e){if(this.__altnumber===e)return this;const n=this.getWritable();return n.__altnumber=e,n}getAltnumber(){return this.getLatest().__altnumber}setPubnumber(e){if(this.__pubnumber===e)return this;const n=this.getWritable();return n.__pubnumber=e,n}getPubnumber(){return this.getLatest().__pubnumber}setUnknownAttributes(e){const n=this.getWritable();return n.__unknownAttributes=e,n}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("span");return e.setAttribute("data-marker",this.__marker),e.classList.add(ka,`usfm_${this.__marker}`),this.__showMarker&&e.classList.add("marker"),e.setAttribute("data-number",this.__number),e}updateDOM(){return!1}exportDOM(e){const{element:n}=super.exportDOM(e);return n&&bn(n)&&(n.setAttribute("data-marker",this.getMarker()),n.classList.add(ka,`usfm_${this.getMarker()}`),n.setAttribute("data-number",this.getNumber())),{element:n}}decorate(){return m.jsx("span",{children:this.getShowMarker()?vs(this.getMarker(),this.getNumber()):_a+this.getNumber()+_a})}exportJSON(){return{type:this.getType(),marker:this.getMarker(),number:this.getNumber(),showMarker:this.getShowMarker(),sid:this.getSid(),altnumber:this.getAltnumber(),pubnumber:this.getPubnumber(),unknownAttributes:this.getUnknownAttributes(),version:of}}isKeyboardSelectable(){return!1}}function x_(t){const e=t.getAttribute("data-number")??"0";return{node:kl(e)}}function kl(t,e,n,r,s,i){return Ie(new Ye(t,e,n,r,s,i))}function C_(t){return((t==null?void 0:t.getAttribute("data-marker"))??void 0)===sf}function Tr(t){return t instanceof Ye}function S_(t){return(t==null?void 0:t.type)===Ye.getType()}function ut(t){return hl(t)||Tr(t)}function T_(t){return Jb(t)||S_(t)}function E_(t,e,n,r,s,i,o){if(!$e.isValidMarker(t))throw new Error(`$insertNote: Invalid note marker '${t}'`);const a=n?_l(n):re();if(!X(a))return;const l=O_(a,t,r,o);if(l===void 0)return;const u=lf(t,e,l,s,i);return af(u,a,s),u}function af(t,e,n){const r=(n==null?void 0:n.noteMode)==="collapsed";if(t.setIsCollapsed(r),e.isCollapsed()||n_(e),e.insertNodes([t]),!r){const s=t.getChildren().reverse().find(pe);s==null||s.selectEnd()}}function O_(t,e,n,r){const s=[],{chapterNum:i,verseNum:o}=n??{};switch(e){case"f":case"fe":case"ef":case"efe":if(i!==void 0&&o!==void 0&&s.push(gt("fr").append(_e(`${i}:${o}`))),!t.isCollapsed()){const a=t.getTextContent().trim();if(a.length>0){const l=gt("fq").append(_e(a));s.push(l)}}s.push(gt("ft").append(_e(Gt)));break;case"x":case"ex":if(i!==void 0&&o!==void 0&&s.push(gt("xo").append(_e(`${i}:${o}`))),!t.isCollapsed()){const a=t.getTextContent().trim();if(a.length>0){const l=gt("xq").append(_e(a));s.push(l)}}s.push(gt("xt").append(_e(Gt)));break;default:r==null||r.warn(`$createNoteChildren: Unsupported note marker '${e}'`);return}return s}function lf(t,e,n,r,s,i){const o=(r==null?void 0:r.noteMode)!=="expanded",a=dl(t,e,o);i&&Mt(a,hn,()=>i);let l,u;(r==null?void 0:r.markerMode)==="editable"?(l=gr(t),u=gr(t,"closing")):(r==null?void 0:r.markerMode)==="visible"&&(l=mr("marker",en(t)+me),u=mr("marker",pr(t)+me));let d;if(l&&a.append(l),(r==null?void 0:r.markerMode)==="editable")e===""?a.append(...n):(d=_e(gl(a.__caller)),a.append(d,...n));else{const f=()=>_e(me),h=n.flatMap(A_(f));if(e==="")a.append(...h);else{const p=ml(n);let y=()=>{};s!=null&&s.noteCallerOnClick&&(y=s.noteCallerOnClick),d=Cl(a.__caller,p,y),a.append(d,f(),...h)}}return u&&a.append(u),a}function Lc(t){var e;if(typeof t=="string"){const s=Te(t);return oe(s)?s:void 0}const n=kr();if(n.length<=0)return;const r=(e=n.filter(s=>oe(s.node))[t])==null?void 0:e.node;if(oe(r))return r}function M_(t,e){const n=(e==null?void 0:e.noteMode)==="collapsed";if(t.setIsCollapsed(n),n){const r=t.getPreviousSibling();if(Tr(r)||!r){const s=t.getParent();if(s){const i=t.getIndexWithinParent();s.select(i,i)}}else r.selectEnd()}else{const r=t.getChildren().reverse().find(pe);r==null||r.selectEnd()}}function A_(t){return e=>Ni(e)?[e]:[e,t()]}function j_(t){return t.find(e=>ze(e))}function N_(t,e){return we(t)?t.getChildren().find(n=>ut(n)&&yl(e,n.getNumber())):void 0}function I_(t,e){return e===0?j_(t):t.map(n=>N_(n,e)).filter(n=>n)[0]}function Fc(t){return!t||!we(t)?void 0:t.getChildren().findLast(e=>ut(e))}function cf(t){var e,n;if(!t||ct(t))return;if(ut(t))return t;let r=Ee(t.getParent())?(e=t.getParent())==null?void 0:e.getPreviousSibling():t.getPreviousSibling();for(;r&&!ut(r)&&!ct(r);)r=r.getPreviousSibling();if(r&&ut(r))return r;let s=(n=t.getTopLevelElement())==null?void 0:n.getPreviousSibling(),i=Fc(s),o=i;for(;s&&!i&&!ct(s);)i=o,s=s.getPreviousSibling(),o=Fc(s);if(!(!i&&ct(s)))return i}function R_(t){return Xb(t)||Tr(t)}function vl(t){if(ee(t)){const e=t.getTextContent();!e.endsWith(" ")&&!e.endsWith(me)&&t.setTextContent(`${e} `)}}function uf(t){if(ee(t)){const e=t.getTextContent();e.startsWith(" ")&&t.setTextContent(e.trimStart())}}function wl(t,e){return t.getEditorState().read(()=>!Te(e))}const P_=["style"],$_=["style","code"],Ri=["style","cid"],D_=["style","number","sid","altnumber","pubnumber"],L_=["style","number","sid","altnumber","pubnumber"],F_=["style","sid","eid"],q_=["style","caller","category","contents"],U_=["tag","marker","contents"],B_=["chapter","immutable-chapter","verse","immutable-verse","ms","note","unknown","unmatched"],gs=`
`;function H_(t,e){const n=Te(t);if(!kt(n))return;const r=df(n);return r===void 0?void 0:[{retain:r},...e,{delete:1}]}function df(t){if(!t)return;const e=kr();let n=0;const r=[],s=[],i=t.getKey();let o;for(const a of e){const l=a.node;for(let d=r.length-1;d>=0;d--)if(yr(r[d],a)){const f=r[d];if(r.splice(d,1),n+=1,o&&f.getKey()===o.getKey())return n-1}for(let d=s.length-1;d>=0;d--)yr(s[d].node,a)&&s.splice(d,1);const u=s[s.length-1];if(u){if(l.getKey()===i)return u.position;continue}if(l.getKey()===i){if(ee(l)||kt(l))return n;ht(l)&&(o=l)}if(ht(l)&&(r.includes(l)||r.push(l)),oe(l)||Zt(l)){if(l.getKey()===i)return n;s.push({node:l,position:n}),n+=1;continue}n+=hf(l)}if(o)return n}function qc(t,e){if(t.length<2||!z_(t[0])||!K_(t[1]))return;const n=t[0].retain;return e.read(()=>{const r=W_(n);return r==null?void 0:r.getKey()})}function W_(t){const e=kr();let n=0;const r=[],s=[];for(const i of e){const o=i.node;for(let u=r.length-1;u>=0;u--)if(yr(r[u],i)){const d=r[u];if(r.splice(u,1),n===t)return d;n+=1}for(let u=s.length-1;u>=0;u--)yr(s[u].node,i)&&s.splice(u,1);const a=s[s.length-1];if(a){if(a.position===t)return a.node;continue}if(ht(o)&&(r.includes(o)||r.push(o)),oe(o)||Zt(o)){if(n===t)return o;s.push({node:o,position:n}),n+=1;continue}const l=hf(o);if(ee(o)&&l>0&&t>=n&&t<n+l||kt(o)&&n===t)return o;n+=l}for(const i of r){if(n===t)return i;n+=1}}function yr(t,e){return t?e?!e_(e.node,t.getKey()):!0:!1}function kt(t){return ct(t)||ut(t)||Vi(t)||oe(t)||Zt(t)||nf(t)}function ht(t){return yt(t)||Rt(t)}function et(t,e){return(e==null?void 0:e.insert)!=null&&typeof e.insert=="object"&&t in e.insert}function K_(t){if(t.insert==null||typeof t.insert!="object")return!1;const e=Object.keys(t.insert)[0];return t.insert!=null&&typeof t.insert=="object"&&e in t.insert&&B_.includes(e)}function z_(t){return t.retain!=null&&typeof t.retain=="number"}function hf(t){return ee(t)?t.getTextContentSize():kt(t)?1:0}function Oa(t,e){const n={insert:t.__text},r=ys(t,hn);if(r&&(n.attributes={segment:r}),e&&e.length>0){const s=ff(e);s&&(n.attributes={...n.attributes,char:s})}return n}function Uc(t){const e=new Yr;return t.isEmpty()||t.read(()=>{const n=Dt();if(!n||n.isEmpty())return;const r=n.getChildren();if(r.length===1&&Yt(r[0])&&(!r[0].getChildren()||r[0].getChildrenSize()===0))return;const s=J_();for(const i of s)e.push(i)}),e}function xl(t,e){const n=[],r=kr(t),s=[],i=[],o=[],a=new Set;for(let l=0;l<r.length;l++){const u=r[l].node;n.push(...Bc(u,l,r,s,i,o,a))}for(const l of s)n.push(...Bc(l,r.length,r,s,i,o,a));return n}function J_(){return xl()}function Bc(t,e,n,r,s,i,o){if(!t)return[];const a=[],l=n[e+1];return V_(t,a,r),G_(t,a,s,i,o),Y_(t,e,n,s,o,i,a),ct(t)&&a.push(ek(t)),ut(t)&&a.push(nk(t)),Vi(t)&&a.push(rk(t)),nf(t)&&a.push(sk(t)),Z_(t,a,i),X_(t,a,i),lk(l,i),a}function V_(t,e,n){if(!t.isInline()){const r=n.pop();Rt(r)?e.push(Q_(r)):ze(r)?e.push(tk(r)):Yt(r)&&e.push({insert:gs})}ht(t)&&(n.includes(t)||n.push(t))}function G_(t,e,n,r,s){var i;if(!ee(t))return;const o=t.getParent();if(oe(o)&&o.getFirstChild()===t)return;const a=t.getTextContent(),l=a.startsWith(il),u=pe(o)?o:void 0,d=!!u&&a===Gt&&u.getChildrenSize()===1,f=Oa(t,n),h=Gi(t,r);if(h){if(!a||a===me||l)return;(i=h.contentsOps)==null||i.push(f)}else d||l&&u||e.push(f);const p=a!==""&&!d&&!(l&&u);if(n.length>0&&p)for(const y of n)s.add(y)}function Y_(t,e,n,r,s,i,o){var a;pe(t)&&!r.includes(t)&&r.push(t);const l=n[e+1];for(const u of r.toReversed())if(yr(u,l)){if(r.pop(),!s.has(u)){const d=ok(u),f=Gi(u,i);f?(a=f.contentsOps)==null||a.push(d):o.push(d)}s.delete(u)}}function X_(t,e,n){var r,s;if(!oe(t))return;const i=ik(t),o=Gi(t,n),a={node:t,children:kr(t).map(l=>l.node),contentsOps:(s=(r=i.insert.note)==null?void 0:r.contents)==null?void 0:s.ops};n.push(a),o!=null&&o.contentsOps?o.contentsOps.push(i):e.push(i)}function Z_(t,e,n){var r,s;if(!Zt(t))return;const i=ak(t),o=Gi(t,n),a={node:t,children:kr(t).map(l=>l.node),contentsOps:(s=(r=i.insert.unknown)==null?void 0:r.contents)==null?void 0:s.ops};n.push(a),o!=null&&o.contentsOps?o.contentsOps.push(i):e.push(i)}function Q_(t){const e={style:hs,code:t.__code};return{insert:gs,attributes:{book:e}}}function ek(t){const e={style:Mi,number:t.__number};return t.__sid&&(e.sid=t.__sid),t.__altnumber&&(e.altnumber=t.__altnumber),t.__pubnumber&&(e.pubnumber=t.__pubnumber),{insert:{chapter:e}}}function tk(t){const e={style:t.__marker};return{insert:gs,attributes:{para:e}}}function nk(t){const e={style:Ai,number:t.__number};return t.__sid&&(e.sid=t.__sid),t.__altnumber&&(e.altnumber=t.__altnumber),t.__pubnumber&&(e.pubnumber=t.__pubnumber),{insert:{verse:e}}}function rk(t){const e={style:t.__marker};return t.__sid&&(e.sid=t.__sid),t.__eid&&(e.eid=t.__eid),{insert:{milestone:e}}}function sk(t){return{insert:{unmatched:{marker:t.__marker}}}}function ik(t){const e={style:t.__marker,caller:t.__caller};t.__category&&(e.category=t.__category),t.getChildrenSize()>1&&(e.contents={ops:[]});const n={insert:{note:e}},r=ys(t,hn);return r&&(n.attributes={segment:r}),n}function ok(t){const e={insert:""},n=ff([t]);return n&&(e.attributes={char:n}),e}function ak(t){const e={tag:t.getTag()},n=t.getMarker();n&&(e.marker=n);const r=t.getUnknownAttributes();return r&&Object.assign(e,r),t.getChildrenSize()>0&&(e.contents={ops:[]}),{insert:{unknown:e}}}function Gi(t,e){for(let n=e.length-1;n>=0;n--){const r=e[n];if(r.children.includes(t))return r}}function lk(t,e){for(let n=e.length-1;n>=0;n--)yr(e[n].node,t)&&e.splice(n,1)}function ff(t){if(t.length===0)return;const e=t.map(ck);return e.length===1?e[0]:e}function ck(t){const e={style:t.__marker},n=ys(t,$n);n&&(e.cid=n);const r=t.getUnknownAttributes();return r&&Object.keys(r).length>0&&Object.assign(e,r),e}const pf=1;class _t extends vr{constructor(e=Pt,n="",r,s){super(s),K(this,"__caller"),K(this,"__previewText"),K(this,"__onClick"),this.__caller=e,this.__previewText=n,this.__onClick=r??(()=>{})}static getType(){return"immutable-note-caller"}static clone(e){const{__caller:n,__previewText:r,__onClick:s,__key:i}=e;return new _t(n,r,s,i)}static importDOM(){return{span:e=>dk(e)?{conversion:uk,priority:1}:null}}static importJSON(e){return Cl().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setCaller(e.caller).setPreviewText(e.previewText).setOnClick(e.onClick)}setCaller(e){if(this.__caller===e)return this;const n=this.getWritable();return n.__caller=e,n}getCaller(){return this.getLatest().__caller}setPreviewText(e){if(this.__previewText===e)return this;const n=this.getWritable();return n.__previewText=e,n}getPreviewText(){return this.getLatest().__previewText}setOnClick(e){if(this.__onClick===e)return this;const n=this.getWritable();return n.__onClick=e,n}getOnClick(){return this.getLatest().__onClick}createDOM(){const e=document.createElement("span");return e.classList.add(this.__type),e.setAttribute("data-caller",this.__caller),e.setAttribute("data-preview-text",this.__previewText),e}updateDOM(e){return e.__caller!==this.__caller}exportDOM(e){const{element:n}=super.exportDOM(e);return n&&bn(n)&&(n.classList.add(this.getType()),n.setAttribute("data-caller",this.getCaller()),n.setAttribute("data-preview-text",this.getPreviewText())),{element:n}}decorate(e){const n=this.getParent();if(!n)return null;const r=n.getKey(),s=n.getIsCollapsed(),i=this.__key,o=l=>{var u;return(u=this.__onClick)==null?void 0:u.call(this,l,r,s,()=>hk(e,r),d=>fk(e,r,i,d),()=>pk(e,r))},a=`${this.__caller}_${this.__previewText}}`.replace(/\s+/g,"").substring(0,25);return m.jsx("button",{onClick:o,title:this.__previewText,"data-caller-id":a,children:this.__caller===Pt&&s?"":this.__caller})}exportJSON(){return{type:this.getType(),caller:this.getCaller(),previewText:this.getPreviewText(),onClick:this.getOnClick(),version:pf}}isKeyboardSelectable(){return!1}}function uk(t){const e=t.getAttribute("data-caller")??"",n=t.getAttribute("data-preview-text")??"";return{node:Cl(e,n)}}function Cl(t,e,n){return Ie(new _t(t,e,n))}function dk(t){return t?t.classList.contains(_t.getType()):!1}function wn(t){return t instanceof _t}function hk(t,e){return t.read(()=>{const n=Te(e);if(!oe(n))throw new Error(`getNoteCaller: Note node not found: ${e}`);return n.getCaller()})}function fk(t,e,n,r){t.update(()=>{const s=Te(e);if(!oe(s))throw new Error(`setNoteCaller: Note node not found: ${e}`);s.setCaller(r);const i=Te(n);if(!wn(i))throw new Error(`setNoteCaller: Caller node not found: ${n}`);i.setCaller(r)})}function pk(t,e){return t.read(()=>{const n=Te(e);if(!oe(n))throw new Error(`getNoteOps: Note node not found: ${e}`);return xl(n)})}const gk=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],mk=[_t,Ye,...k_],yk=b.forwardRef((t,e)=>{const{coords:n,children:r,style:s,...i}=t,o=n!==void 0;return m.jsx("div",{ref:e,className:"floating-box","aria-hidden":!o,style:{...s,position:"absolute",zIndex:1e3,top:n==null?void 0:n.y,left:n==null?void 0:n.x,visibility:o?"visible":"hidden",opacity:o?1:0},...i,children:r})});function bk(){const[t,e]=b.useState(void 0),[n,r]=b.useState(),s=b.useRef(null),i=b.useCallback((a,l)=>{s.current&&s.current();const u=a.commonAncestorContainer.nodeType===a.commonAncestorContainer.TEXT_NODE?a:a.commonAncestorContainer;s.current=Kp(u,l,()=>{zp(u,l,{placement:"bottom-start",middleware:[Jp(),Vp()]}).then(d=>{r(d.placement),e(f=>(f==null?void 0:f.x)===d.x&&(f==null?void 0:f.y)===d.y?f:{x:d.x,y:d.y})}).catch(()=>{e(void 0)})})},[]),o=b.useCallback(()=>{s.current&&(e(void 0),s.current(),s.current=null)},[]);return b.useEffect(()=>o,[o]),{coords:t,placement:n,updatePosition:i,cleanup:o}}function _k({isOpen:t,floatingBoxRef:e}){const{coords:n,updatePosition:r,cleanup:s,placement:i}=bk();return b.useEffect(()=>{var o;if(!t||!e.current){s();return}const a=(o=window.getSelection())==null?void 0:o.getRangeAt(0);if(!a){s();return}return r(a,e.current),s},[s,t,e,r]),{coords:n,placement:i}}const kk=document.body,vk=b.memo(yk);function wk({isOpen:t=!1,children:e}){const n=b.useRef(null),{coords:r,placement:s}=_k({isOpen:t,floatingBoxRef:n}),i=b.useMemo(()=>r?typeof e=="function"?e:()=>e:()=>null,[e,r]);return At.createPortal(m.jsx(vk,{ref:n,coords:r,style:r?void 0:{display:"none"},children:i({isOpen:t,placement:s})}),kk)}const gf=b.createContext(void 0);function Sl(){const t=b.useContext(gf);if(!t)throw new Error("useMenuContext must be used within a MenuProvider");return t}function xk(t,e){const[n,r]=b.useState(0),[s,i]=b.useState(-1),o=b.useMemo(()=>t??[],[t]),a={menuItems:o,activeIndex:n,selectedIndex:s,onSelectOption:e??(()=>{})},l=b.useCallback(()=>{r(f=>{const h=o.length;return h?(f-1+h)%h:0})},[o.length]),u=b.useCallback(()=>{r(f=>{const h=o.length;return h?(f+1)%h:0})},[o.length]),d=b.useCallback(()=>{const f=o.length;if(n>=0&&n<f){const h=o[n];e==null||e(h),i(n)}},[n,o,e]);return{state:a,moveUp:l,moveDown:u,select:d,setActiveIndex:r,setSelectedIndex:i}}function Ck({children:t,menuItems:e,onSelectOption:n,...r}){const s=xk(e,n);return m.jsx(gf.Provider,{value:s,children:m.jsx("div",{...r,children:t})})}const mf=b.forwardRef(({index:t,children:e,onMouseEnter:n,onClick:r,...s},i)=>{const{state:{activeIndex:o},setActiveIndex:a,setSelectedIndex:l,select:u}=Sl(),d=b.useCallback(h=>{u(),l(-1),r==null||r(h)},[r,u,l]),f=b.useCallback(h=>{a(t),n==null||n(h)},[t,a,n]);return m.jsx("button",{ref:i,role:"menuitem",...s,onClick:d,onMouseEnter:f,"aria-selected":t!==void 0&&o===t?"true":void 0,tabIndex:-1,children:e})});function Sk({children:t,autoIndex:e=!0,...n}){const r=b.useRef(null),{state:{activeIndex:s,menuItems:i}}=Sl(),o=b.useMemo(()=>i?typeof t=="function"?t:()=>t:()=>null,[t,i]),a=b.useMemo(()=>{const l=o(i);return e?b.Children.map(l,(u,d)=>b.isValidElement(u)&&u.type===mf&&u.props.index===void 0?b.cloneElement(u,{index:d}):u):l},[o,e,i]);return b.useEffect(()=>{if(r.current){const l=r.current,u=l.children[s];if(u){const d=l.getBoundingClientRect(),f=u.getBoundingClientRect();f.bottom>d.bottom?l.scrollTop+=f.bottom-d.bottom:f.top<d.top&&(l.scrollTop-=d.top-f.top)}}},[s]),m.jsx("div",{ref:r,role:"menu",...n,children:a})}const na={Root:Ck,Options:Sk,Option:mf},Tk=(t,e,n)=>_i(t,n).toLowerCase().includes(e.toLowerCase()),Hc=t=>Object.keys(t).find(e=>typeof t[e]=="string")||"",_i=(t,e)=>{const n=t[e];return typeof n=="string"?n:String(n)};function Ek(t){const{query:e,items:n,filterBy:r,filter:s,sortBy:i,sortingOptions:o}=t,{caseSensitive:a=!1,priorityOrder:l=["exact","startsWith","contains"]}=o||{},u=a?e:e.toLowerCase();let d,f;s?(f=s,d=n.length>0?Hc(n[0]):""):(d=r||(n.length>0?Hc(n[0]):""),f=(y,k)=>Tk(y,k,d));const h=i||d,p=new Map;return n.filter(y=>{try{return f(y,e)}catch(k){return console.warn("Error filtering item:",y,k),!1}}).sort((y,k)=>{const C=O=>(p.has(O)||p.set(O,_i(O,h).toLowerCase()),p.get(O)??""),M=a?_i(y,h):C(y),v=a?_i(k,h):C(k);for(const O of l)switch(O){case"exact":if(M===u&&v!==u)return-1;if(v===u&&M!==u)return 1;break;case"startsWith":if(M.startsWith(u)&&!v.startsWith(u))return-1;if(v.startsWith(u)&&!M.startsWith(u))return 1;break;case"contains":{const I=M.indexOf(u),D=v.indexOf(u);if(I!==-1&&D===-1)return-1;if(D!==-1&&I===-1)return 1;if(I!==-1&&D!==-1)return I-D;break}}return M.localeCompare(v)})}function Ok(t){const{query:e,items:n,filterBy:r,filter:s,sortBy:i,sortingOptions:o}=t;return b.useMemo(()=>Ek({query:e,items:n,filterBy:r,filter:s,sortBy:i,sortingOptions:o}),[e,n,r,s,i,o])}function Mk(){const{moveUp:t,moveDown:e,select:n}=Sl();return b.useMemo(()=>({moveUp:t,moveDown:e,select:n}),[t,e,n])}const Ak=()=>{const t=Mk(),[e]=ce();b.useEffect(()=>{const n=r=>{const s={ArrowDown:()=>t==null?void 0:t.moveDown(),ArrowUp:()=>t==null?void 0:t.moveUp(),Enter:()=>t==null?void 0:t.select(),Tab:()=>t==null?void 0:t.select()}[r.key];return s?(s(),r.preventDefault(),r.stopPropagation(),!0):!1};return e.registerCommand(Ui,n,Ha)},[e,t])};function jk(){return Ak(),null}function Nk(t){const{options:e,onSelectOption:n,onClose:r,inverse:s,query:i,menuOpenKey:o}=t,[a]=ce(),l=i!==void 0,[u,d]=b.useState(""),f=l?i??"":u,h=Ok({query:f,items:e,filterBy:"name"}),p=y=>{r==null||r(),n?n(y):y.action(a)};return b.useEffect(()=>a.registerCommand(Ui,y=>{if(l)return!1;const k={Escape:()=>r==null?void 0:r(),Backspace:()=>{f.length===0?r==null||r():d(C=>C.slice(0,-1))}}[y.key];return k?(y.stopPropagation(),y.preventDefault(),k(),!0):y.key.length===1?(y.stopPropagation(),y.preventDefault(),y.key!==o&&d(C=>C+y.key),!0):!1},Ha),[a,l,f,o,r]),m.jsxs(na.Root,{className:`autocomplete-menu-container ${s?"inverse":""}`,menuItems:h,onSelectOption:y=>p(y),children:[!l&&m.jsx("input",{value:f,type:"text",disabled:!0}),m.jsx(jk,{}),m.jsx(na.Options,{className:"autocomplete-menu-options",autoIndex:!1,children:y=>y.map((k,C)=>m.jsxs(na.Option,{index:C,children:[m.jsx("span",{className:"label",children:k.label??k.name}),m.jsx("span",{className:"description",children:k.description})]},k.name))})]})}function Ik({trigger:t,items:e}){const[n]=ce(),[r,s]=b.useState(!1),i=b.useCallback(o=>{o.key==="Escape"&&r?(s(!1),n.focus()):o.key===t&&!r&&(o.preventDefault(),s(!0))},[n,t,r]);return b.useEffect(()=>n.registerRootListener(o=>{if(o)return o.addEventListener("keydown",i),()=>{o.removeEventListener("keydown",i)}}),[n,i]),b.useEffect(()=>n.registerUpdateListener(({prevEditorState:o,editorState:a})=>{const l=o.read(()=>{const u=re();if(X(u))return u});a.read(()=>{const u=re();!X(u)||l!=null&&l.is(u)||s(!1)})}),[n]),e&&m.jsx(wk,{isOpen:r,children:({placement:o})=>m.jsx(Nk,{options:e,onClose:()=>s(!1),inverse:o==="top-start",menuOpenKey:t})})}function Rk({scriptureReference:t,contextMarker:e,getMarkerAction:n}){return{markersMenuItems:b.useMemo(()=>{if(!e||!t)return;const r=Ic(e);if(r!=null&&r.children)return Object.values(r.children).flatMap(s=>s.map(i=>{const o=Ic(i),{action:a}=n(i,o);return{name:i,label:i,description:(o==null?void 0:o.description)??"",action:l=>{a({editor:l,reference:t})}}}))},[e,n,t])}}function rs(t,e){return`${t}:${e}`}function Pk(t,e){b.useEffect(()=>{if(!t.hasNodes([Fe]))throw new Error("AnnotationPlugin: TypedMarkNode not registered on editor!");const n=new Map;return Xe(yd(t,Fe,r=>ps(r.getTypedIDs(),r.getTypedOnClicks(),r.getTypedOnRemoves()),(r,s)=>{const i=r.getTypedOnClicks(),o=r.getTypedOnRemoves();for(const[a,l]of Object.entries(r.getTypedIDs()))l.forEach(u=>{var d,f;const h=(d=i[a])==null?void 0:d[u],p=(f=o[a])==null?void 0:f[u];s.addID(a,u,h,p)});r.getWritable().__suppressOnRemoveCallbacks=!0}),t.registerMutationListener(Fe,r=>{t.getEditorState().read(()=>{for(const[s,i]of r){const o=Te(s);let a={};i==="destroyed"?a=n.get(s)??{}:Ee(o)&&(a=o.getTypedIDs());for(const[l,u]of Object.entries(a))if(!Fe.isReservedType(l))for(const d of u){let f=e.get(rs(l,d));a[l]=u,n.set(s,a),i==="destroyed"?f!==void 0&&(f.delete(s),f.size===0&&e.delete(rs(l,d))):(f===void 0&&(f=new Set,e.set(rs(l,d),f)),f.has(s)||f.add(s))}}})},{skipInitialization:!0}))},[t,e])}const $k=b.forwardRef(function({logger:t},e){const[n]=ce(),r=b.useMemo(()=>new Map,[]);Pk(n,r);const s=(i,o,a)=>{const l=Array.from(a??r.get(rs(i,o))??[]);if(l.length!==0)for(const u of l){const d=Te(u);Ee(d)&&(d.deleteID(i,o),d.hasNoIDsForEveryType()&&ji(d))}};return b.useImperativeHandle(e,()=>({setAnnotation(i,o,a,l,u){if(Fe.isReservedType(o))throw new Error(`setAnnotation: Can't directly set this reserved annotation type '${o}'. Use the appropriate plugin instead.`);n.update(()=>{const d=_l(i);if(d===void 0){t==null||t.error("Failed to find start or end node of the annotation.");return}s(o,a),Qh(d,o,a,l,u)},{tag:wa})},removeAnnotation(i,o){if(Fe.isReservedType(i))throw new Error(`removeAnnotation: Can't directly remove this reserved annotation type '${i}'. Use the appropriate plugin instead.`);const a=r.get(rs(i,o));a===void 0||a.size===0||n.update(()=>{s(i,o,a)},{tag:wa})}})),null});function Dk({ignoreHistoryMergeTagChange:t=!0,ignoreSelectionChange:e=!1,onChange:n}){const[r]=ce();return b.useLayoutEffect(()=>{if(n)return r.registerUpdateListener(s=>{const{editorState:i,dirtyElements:o,dirtyLeaves:a,prevEditorState:l,tags:u}=s;if(e&&o.size===0&&a.size===0||t&&u.has(sd)||l.isEmpty())return;const d=Lk(r,s);d.length!==0&&n(i,r,u,d)})},[r,t,e,n]),null}function Lk(t,{dirtyLeaves:e,prevEditorState:n}){let r=new Yr;return t.getEditorState().read(()=>{const s=e.values().next().value??"";if(e.size===1&&ee(Te(s))){const i=Te(s),o=df(i);if(ee(i)&&o!==void 0){const a=n.read(()=>{const d=Te(s);return new Yr([ee(d)?Oa(d):{insert:""}])}),l=new Yr([Oa(i)]),u=new Yr(o>0?[{retain:o}]:[]);r=r.concat(u).concat(a.diff(l))}}else{const i=Uc(n),o=Uc(t.getEditorState());r=i.diff(o)}}),r.ops}function Fk(t,e,n,r){let s=0;t.forEach(i=>{if("retain"in i)s+=qk(i,s,e,r);else if("delete"in i){if(typeof i.delete!="number"||i.delete<=0){r==null||r.error(`Invalid delete operation: ${JSON.stringify(i)}`);return}r==null||r.debug(`Delete: ${i.delete}`),Bk(s,i.delete,r)}else"insert"in i?typeof i.insert=="string"?(r==null||r.debug(`Insert: '${i.insert}'`),s+=Hk(s,i.insert,i.attributes,e,r)):typeof i.insert=="object"&&i.insert!==null?(r==null||r.debug(`Insert embed: ${JSON.stringify(i.insert)}`),Kk(s,i,e,n,r)?s+=1:r==null||r.error(`Failed to process insert embed operation: ${JSON.stringify(i.insert)} at index ${s}. Document may be inconsistent.`)):r==null||r.error(`Insert of unknown type: ${JSON.stringify(i.insert)}`):r==null||r.error(`Unknown operation: ${JSON.stringify(i)}`)})}function qk(t,e,n,r){return typeof t.retain!="number"||t.retain<0?(r==null||r.error(`Invalid retain operation: ${JSON.stringify(t)}`),0):(r==null||r.debug(`Retain: ${t.retain}`),t.attributes&&(r==null||r.debug(`Retain attributes: ${JSON.stringify(t.attributes)}`),Uk(e,t.retain,t.attributes,n,r)),t.retain)}function Uk(t,e,n,r,s){s==null||s.debug(`Applying attributes for range [${t}, ${t+e-1}] with attributes: ${JSON.stringify(n)}`);let i=e,o=0,a=-1;const l=Dt();function u(d){if(i<=0)return!0;if(ee(d)){const f=d.getTextContentSize();if(t<o+f&&o<t+e){const h=Math.max(0,t-o),p=f-h,y=Math.min(i,p);if(y>0){let k=d;const C=h>0,M=y<f-h;if(C&&M){const[,v]=d.splitText(h);[k]=v.splitText(y)}else C?[,k]=d.splitText(h):M&&([k]=d.splitText(y));if(pn(n)){const v=k.getParent();if(pe(v)){const O=n.char;let I;Array.isArray(O)?a>=0&&a<=O.length-1&&(I=O[a]):a===0&&(I=O);const D=I?Ln(I,v):!1;if(D&&Array.isArray(O)&&O.length>1){const q=_e("");k.replace(q);const F=typeof n.segment=="string"?n.segment:void 0,$=Er(O.slice(1),r,k,F);let H=q;for(const W of $)H.insertAfter(W),H=W;q.remove(),lt(n,k)}else if(D)lt(n,k);else{k.remove();const q=Wc(k,n,r,s);if(q&&q.length>0){let F=v;for(const $ of q)F.insertAfter($),F=$}}}else{const O=_e("");k.replace(O);const I=Wc(k,n,r,s);if(I&&I.length>0){let D=O;for(const q of I)D.insertAfter(q),D=q;O.remove()}else O.replace(k)}}else lt(n,k);i-=y}}o+=f}else if(kt(d))t<=o&&o<t+e&&i>0&&(Kc(d,n),i-=1),o+=1;else if(pe(d)){a+=1;let f=!1;if(t<=o&&o<t+e&&i>0)if(pn(n)){const h=n.char;let p;if(Array.isArray(h)?a>=0&&a<=h.length-1&&(p=h[a]):a===0&&(p=h),p){d.setMarker(p.style),typeof p.cid=="string"&&Mt(d,$n,()=>p.cid);const y=je(p,Ri);y&&Object.keys(y).length>0?d.setUnknownAttributes({...d.getUnknownAttributes()??{},...y}):d.setUnknownAttributes(void 0)}}else(n.char===!1||n.char===null||Qk(n.char))&&(f=!0);if(i>0){const h=d.getChildren();for(const p of h){if(i<=0)break;if(u(p)&&i<=0)return f&&Dl(d),!0}}f&&Dl(d),a-=1}else if(ht(d)){const f=d.getChildren();for(const p of f){if(i<=0)break;if(u(p)&&i<=0)return!0}const h=1;if(t<=o&&o<t+i&&i>0){if(!Yt(d))Kc(d,n);else if(Tl(n)){const p=bf(n.para);p&&d.replace(p,!0)}i-=h}o+=h}else if(we(d)){const f=d.getChildren();for(const h of f){if(i<=0)break;if(u(h)&&i<=0)return!0}}return i<=0}u(l),i>0&&(s==null||s.warn(`$applyAttributes: Not all characters in the retain operation (length ${e}) could be processed. Remaining: ${i}. targetIndex: ${t}, final currentIndex: ${o}`))}function Wc(t,e,n,r){var s;const i=typeof e.segment=="string"?e.segment:void 0,o=Er(e.char,n,t,i),a=o.find(pe);if(!a){r==null||r.error(`Failed to create CharNode for text transformation. Style: ${Array.isArray(e.char)?e.char[0].style:(s=e.char)==null?void 0:s.style}. Falling back to standard text attributes.`),lt(e,t);return}const l={};vf.forEach(f=>{t.hasFormat(f)&&(l[f]="true")});const u={};Object.entries(e).forEach(([f,h])=>{f==="segment"||f==="char"||(typeof h=="string"?u[f]=h:h===!0?u[f]="true":h===!1&&(u[f]="false"))});const d={...a.getUnknownAttributes()??{},...l,...u};return Object.keys(d).length>0&&a.setUnknownAttributes(d),lt(e,t),o}function Kc(t,e){for(const n of Object.keys(e)){const r=e[n];if(n==="char"&&pe(t)&&pn(e)){const s=r;if(t.setMarker(s.style),typeof s.cid=="string"){const o=s.cid;Mt(t,$n,()=>o)}const i=je(s,Ri);i&&Object.keys(i).length>0&&t.setUnknownAttributes({...t.getUnknownAttributes()??{},...i});continue}typeof r=="string"&&(ct(t)||ut(t)||Vi(t)||oe(t)||Zt(t)?t.setUnknownAttributes({...t.getUnknownAttributes()??{},[n]:r}):(Rt(t)||ze(t)||pe(t))&&(n==="style"&&!Rt(t)?t.setMarker(r):n==="code"&&Rt(t)?t.setCode(r):t.setUnknownAttributes({...t.getUnknownAttributes()??{},[n]:r})),n==="segment"&&Mt(t,hn,()=>r))}}function Bk(t,e,n){if(e<=0)return;const r=Dt();let s=0,i=e;function o(a){if(i<=0)return!0;if(ee(a)){let l=a.getTextContentSize();if(t<s+l&&s<t+i){const u=Math.max(0,t-s),d=l-u,f=Math.min(i,d);f>0&&(a.spliceText(u,f,""),a.getTextContentSize()===0&&a.remove(),n==null||n.debug(`Deleted ${f} length from TextNode (key: ${a.getKey()}) at nodeOffset ${u}. Original targetIndex: ${t}, current currentIndex: ${s}.`),i-=f,l-=f)}s+=l}else if(kt(a))t<=s&&s<t+i?(a.remove(),n==null||n.debug(`Deleted embed node (key: ${a.getKey()}) at currentIndex: ${s}. Original targetIndex: ${t}, remainingToDelete: ${i}.`),i-=1):s+=1;else if(ht(a)){const l=a.getChildren().slice(),u=a.getChildren();for(const d of u){if(i<=0)break;if(o(d)&&i<=0)return!0}if(t<=s&&s<t+i&&ht(a)){i-=1;const d=a.getChildren().length;if(l.length>0&&d===0){const f=a.getParent();((f==null?void 0:f.getChildren())??[]).length>1?(a.remove(),n==null||n.debug(`Removed entire ParaNode that had all its content deleted at currentIndex: ${s}. Original targetIndex: ${t}, remainingToDelete: ${i}.`)):(a.replace(bt(),!0),n==null||n.debug(`Replaced last ParaNode with ImpliedParaNode at currentIndex: ${s}. Original targetIndex: ${t}, remainingToDelete: ${i}.`))}else if(i>0){const f=a.getNextSibling();if(f&&yt(f)){let h=s+1;const p=f.getChildren();for(const k of p){if(i<=0)break;const C=s;if(s=h,o(k)){s=C;break}ee(k)?h+=k.getTextContentSize():kt(k)&&(h+=1),s=C}const y=f.getChildren();for(const k of y)k.remove(),a.append(k);f.remove(),n==null||n.debug(`Merged next paragraph into current one after deleting symbolic close at currentIndex: ${s}. Original targetIndex: ${t}, remainingToDelete: ${i}.`)}else a.replace(bt(),!0)}else ze(a)?a.replace(bt(),!0):a.remove()}s+=1}else if(we(a)){const l=a.getChildren();for(const u of l){if(i<=0)break;if(o(u)&&i<=0)return!0}}return i<=0}o(r),i>0&&(n==null||n.warn(`Delete operation could not remove all requested characters. Remaining to delete: ${i}. Original targetIndex: ${t}, OT length: ${e}. Final currentIndex: ${s}`))}function Hk(t,e,n,r,s){if(e===gs)return zc(t,n,s);if(e.endsWith(gs)&&!Tl(n)){const i=e.slice(0,-1);let o=0;if(i.length>0){if(pn(n))throw new Error("Text + LF should not have char attributes");o+=Pi(t,i,n,s)}return o+=zc(t+o,n,s),o}else return pn(n)?Wk(t,e,n,r,s):Pi(t,e,n,s)}function Wk(t,e,n,r,s){s==null||s.debug(`Attempting to insert CharNode with text "${e}" and attributes ${JSON.stringify(n.char)} at index ${t}`);const i=_e(e===""?Gt:e);lt(n,i);let o;{let p=function(C){if(ee(C)){const M=C.getTextContentSize();if(t>=k&&t<k+M){const v=C.getParent();return pe(v)&&(o=v),!0}k+=M}else if(kt(C))k+=1;else if(pe(C)){const M=C.getChildren();for(const v of M)if(p(v))return!0}else if(we(C)){const M=C.getChildren();for(const v of M)if(p(v))return!0;ht(C)&&(k+=1)}return!1};const y=Dt();let k=0;p(y)}let a=n.char;if(Array.isArray(a)){if(o){const p=a[0];p&&Ln(p,o)?(a=a.slice(1),a.length===1&&(a=a[0])):o=void 0}}else o&&(Ln(a,o)||(o=void 0));const l=typeof n.segment=="string"?n.segment:void 0,u=Er(a,r,i,l,o?[o]:void 0);if(u.length===0)return e.length;const d=u.find(pe);if(!d)return s==null||s.error(`CharNode style is missing for text "${e}". Attributes: ${JSON.stringify(n.char)}. Falling back to rich text insertion.`),Pi(t,e,void 0,s);const f={};for(const[p,y]of Object.entries(n))p!=="char"&&p!=="segment"&&typeof y=="string"&&(f[p]=y);Object.keys(f).length>0&&d.setUnknownAttributes(f);let h=!0;for(const p of u)if(!yf(t,p,s)){h=!1;break}return h?e.length:(s==null||s.error(`Failed to insert CharNode with text "${e}" at index ${t}. Falling back to rich text.`),Pi(t,e,void 0,s))}function Pi(t,e,n,r){if(e.length<=0)return r==null||r.debug("Attempted to insert empty string. No action taken."),0;const s=Dt();let i=0,o=!1;function a(l){if(o)return!0;if(ee(l)){const u=l.getTextContentSize();if(t>=i&&t<=i+u){const d=t-i,f=_e(e);if(lt(n,f),d===0)l.insertBefore(f);else if(d===u){const h=l.getParent();pe(h)&&!pn(n)?h.insertAfter(f):l.insertAfter(f)}else{const[,h]=l.splitText(d);h.insertBefore(f)}return r==null||r.debug(`Inserted text "${e}" in/around TextNode (key: ${l.getKey()}) at nodeOffset ${d}. Original targetIndex: ${t}, currentIndex at node start: ${i}.`),o=!0,!0}i+=u}else if(kt(l))i+=1;else if(pe(l)){if(!o&&t===i){const d=_e(e);lt(n,d);const f=l.getFirstChild();return f?f.insertBefore(d):l.append(d),r==null||r.debug(`Inserted text "${e}" at beginning of CharNode ${l.getType()} (key: ${l.getKey()}).`),o=!0,!0}const u=l.getChildren();for(const d of u){if(a(d))return!0;if(o)break}if(!o&&t===i){const d=_e(e);return lt(n,d),l.append(d),r==null||r.debug(`Appended text "${e}" to end of CharNode ${l.getType()} (key: ${l.getKey()}).`),o=!0,!0}}else if(ht(l)){if(!o&&t===i){const d=_e(e);lt(n,d);const f=l.getFirstChild();return f?f.insertBefore(d):l.append(d),r==null||r.debug(`Inserted text "${e}" at beginning of container ${l.getType()} (key: ${l.getKey()}).`),o=!0,!0}const u=l.getChildren();for(const d of u){if(a(d))return!0;if(o)break}if(!o&&t===i){const d=_e(e);return lt(n,d),l.append(d),r==null||r.debug(`Appended text "${e}" to end of container ${l.getType()} (key: ${l.getKey()}).`),o=!0,!0}i+=1}else if(we(l)){const u=l.getChildren();for(const d of u){if(a(d))return!0;if(o)break}}return o}if(a(s),!o&&t===i){r==null||r.debug(`Insertion point matches end of document (targetIndex: ${t}, final currentIndex: ${i}). Appending text to new ParaNode.`);const l=_e(e);lt(n,l);const u=bt().append(l);s.append(u),o=!0}return o?e.length:(r==null||r.warn(`$insertRichText: Could not find insertion point for text "${e}" at targetIndex ${t}. Final currentIndex: ${i}. Text not inserted.`),0)}function yf(t,e,n){const r=Dt();let s=0,i=!1;function o(a){if(i)return!0;if(a===r&&t===0&&!r.getFirstChild())return e.isInline()?(n==null||n.debug(`$insertNodeAtCharacterOffset: Inserting inline node ${e.getType()} into empty root, wrapped in ImpliedParaNode. targetIndex: ${t}`),r.append(bt().append(e))):(n==null||n.debug(`$insertNodeAtCharacterOffset: Inserting block node ${e.getType()} directly into empty root. targetIndex: ${t}`),r.append(e)),i=!0,!0;if(!we(a))return!1;const l=a.getChildren();for(const u of l){if(t===s&&!i){if(a===r&&e.isInline())if(yt(u)){n==null||n.debug(`$insertNodeAtCharacterOffset: Inserting inline node ${e.getType()} into existing ${u.getType()} at beginning. targetIndex: ${t}`);const d=u.getFirstChild();d?d.insertBefore(e):u.append(e)}else n==null||n.debug(`$insertNodeAtCharacterOffset: Inserting inline node ${e.getType()} into root before ${u.getType()}, wrapping in ImpliedParaNode. targetIndex: ${t}`),u.insertBefore(bt().append(e));else u.insertBefore(e),n==null||n.debug(`$insertNodeAtCharacterOffset: Inserted node ${e.getType()} (key: ${e.getKey()}) before child ${u.getType()} (key: ${u.getKey()}) in ${a.getType()} (key: ${a.getKey()}). targetIndex: ${t}, currentIndex: ${s}`);return i=!0,!0}if(ee(u)){const d=u.getTextContentSize();if(!i&&t>s&&t<s+d){const f=t-s,[h]=u.splitText(f);return h.insertAfter(e),n==null||n.debug(`$insertNodeAtCharacterOffset: Inserted node ${e.getType()} (key: ${e.getKey()}) by splitting TextNode (key: ${u.getKey()}) at offset ${f}. targetIndex: ${t}, currentIndex at node start: ${s}`),i=!0,!0}s+=d}else if(kt(u))s+=1;else if(pe(u)){if(o(u))return!0}else if(ht(u)){const d=u;if(o(d))return!0;const f=s;if(Yt(d)&&ht(e)&&t===f&&!i)return n==null||n.debug(`$insertNodeAtCharacterOffset: Replacing ImpliedParaNode (key: ${d.getKey()}) with block node '${e.getType()}' (key: ${e.getKey()}) at OT index ${t}.`),u.replace(e,!0),s=f+1,i=!0,!0;s+=1}else if(we(u)&&o(u))return!0;if(i)return!0}return we(a)&&!i&&(t===s||a===r&&t>s)?a===r?(e.isInline()?(n==null||n.debug(`$insertNodeAtCharacterOffset: Appending inline node ${e.getType()} to root. Wrapping in new ImpliedParaNode. targetIndex: ${t}, current document OT length: ${s}.`),r.append(bt().append(e))):(n==null||n.debug(`$insertNodeAtCharacterOffset: Appending block node ${e.getType()} to root. targetIndex: ${t}, current document OT length: ${s}.`),r.append(e)),i=!0,!0):yt(a)?Yt(a)&&ze(e)&&t===s?(n==null||n.debug(`$insertNodeAtCharacterOffset: Replacing ImpliedParaNode container (key: ${a.getKey()}) with ParaNode ${e.getType()} (key: ${e.getKey()}) via append logic. targetIndex: ${t}`),a.replace(e,!0),i=!0,!0):e.isInline()||!yt(e)?(n==null||n.debug(`$insertNodeAtCharacterOffset: Appending node ${e.getType()} to existing container ${a.getType()} (key: ${a.getKey()}). targetIndex: ${t}, container end OT index: ${s}.`),a.append(e),i=!0,!0):(n==null||n.debug(`$insertNodeAtCharacterOffset: Inserting block node ${e.getType()} after container ${a.getType()} (key: ${a.getKey()}). targetIndex: ${t}, container end OT index: ${s}.`),a.insertAfter(e),i=!0,!0):(pe(a)?(n==null||n.debug(`$insertNodeAtCharacterOffset: Inserting node ${e.getType()} after CharNode (key: ${a.getKey()}). targetIndex: ${t}, element end OT index: ${s}.`),a.insertAfter(e)):e.isInline()||!yt(e)?(n==null||n.debug(`$insertNodeAtCharacterOffset: Appending node ${e.getType()} to generic element ${a.getType()} (key: ${a.getKey()}). targetIndex: ${t}, element end OT index: ${s}.`),a.append(e)):(n==null||n.debug(`$insertNodeAtCharacterOffset: Inserting block node ${e.getType()} after generic element ${a.getType()} (key: ${a.getKey()}). targetIndex: ${t}, element end OT index: ${s}.`),a.insertAfter(e)),i=!0,!0):i}return o(r),i||n==null||n.warn(`$insertNodeAtCharacterOffset: Could not find insertion point for node ${e.getType()} (key: ${e.getKey()}) at targetIndex ${t}. Final currentIndex: ${s}. Node not inserted.`),i}function Kk(t,e,n,r,s){let i;return et("chapter",e)?i=Jk(e.insert.chapter,n):et("verse",e)?i=Vk(e.insert.verse,n):et("ms",e)?i=Gk(e.insert.ms):et("note",e)?i=_f(e,n,r,s):et("unknown",e)?i=kf(e,n,r,s):et("unmatched",e)&&(i=Xk(e.insert.unmatched)),i?yf(t,i,s):(s==null||s.error(`$insertEmbedAtCurrentIndex: Cannot create LexicalNode for embed object: ${JSON.stringify(e.insert)}`),!1)}function zc(t,e,n){let r;Tl(e)?r=bf(e.para):Zk(e)&&(r=zk(e.book)),r??(r=bt());const s=r,i=ze(s),o=Yt(s);let a=0,l=!1;function u(d){if(l)return!0;if(ee(d)){const f=d.getTextContentSize();if(t>=a&&t<=a+f){const h=d.getParent();if(ze(h)&&(i||o)){n==null||n.debug(`Splitting ParaNode (marker: ${h.getMarker()}) with LF attributes at targetIndex ${t}`);const p=t-a,[y]=p>0?d.splitText(p):[void 0];let k=y==null?void 0:y.getPreviousSibling();for(;k;){const C=k;k=k.getPreviousSibling();const M=s.getFirstChild();M?M.insertBefore(C):s.append(C)}return y&&s.append(y),h.insertBefore(s),l=!0,!0}}a+=f}else if(kt(d))a+=1;else if(ht(d)){const f=d.getChildren();for(const h of f){if(u(h))return!0;if(l)break}if(t===a){if(Yt(d)&&s)return n==null||n.debug(`Replacing ImpliedParaNode (key: ${d.getKey()}) with ParaNode at targetIndex ${t}`),d.replace(s,!0),l=!0,!0;if(ze(d)&&s){const h=d;return n==null||n.debug(`Creating new block node with LF attributes after existing ParaNode (marker: ${h.getMarker()}) at targetIndex ${t}`),h.insertAfter(s),l=!0,!0}}if(a+=1,t===a&&ze(d)&&s)return n==null||n.debug(`Creating new block node after existing ParaNode (marker: ${d.getMarker()}) at targetIndex ${t}`),d.insertAfter(s),l=!0,!0}else if(we(d)){const f=d.getChildren();for(const h of f){if(u(h))return!0;if(l)break}}return l}return u(Dt()),l||n==null||n.warn(`Could not find location to handle newline with para attributes at targetIndex ${t}. Final currentIndex: ${a}.`),1}function zk(t){const{style:e,code:n}=t;if(!e||e!==hs||!n||!dt.isValidBookCode(n))return;const r=je(t,$_);return jh(n,r)}function bf(t){const{style:e}=t;if(!e)return;const n=je(t,P_);return fs(e,n)}function Jk(t,e){if(!t)return;const{number:n,sid:r,altnumber:s,pubnumber:i}=t;if(!n)return;const o=je(t,D_);let a;if(e.markerMode==="editable")a=Rh(n,r,s,i,o);else{const l=e.markerMode==="visible";a=ll(n,l,r,s,i,o)}return a}function Vk(t,e){if(!t)return;const{style:n,number:r,sid:s,altnumber:i,pubnumber:o}=t;if(!r)return;const a=je(t,L_);let l;if(e.markerMode==="editable"){if(!n)return;const u=vs(n,r);l=Jh(r,u,s,i,o,a)}else{const u=e.markerMode==="visible";l=kl(r,u,s,i,o,a)}return l}function Gk(t){if(!t)return;const{style:e,sid:n,eid:r}=t;if(!e)return;const s=je(t,F_);return Hh(e,n,r,s)}function _f(t,e,n,r){var s;const i=t.insert;if(!i.note)return;const{style:o,caller:a,category:l,contents:u}=i.note;if(!o||a==null)return;a===""&&(r==null||r.warn("Note has empty caller. Only use for note editing."));const d=je(i.note,q_),f=(s=t.attributes)==null?void 0:s.segment;let h;f&&typeof f=="string"&&(h=f);const p=[];for(const y of(u==null?void 0:u.ops)??[])if(typeof y.insert=="string")if(pn(y.attributes)){const k=Er(y.attributes.char,e,_e(y.insert),void 0,p);p.push(...k)}else p.push(_e(y.insert));return lf(o,a,p,e,n,h).setCategory(l).setUnknownAttributes(d)}function kf(t,e,n,r){var s;const i=t.insert.unknown;if(!i)return;const{tag:o,marker:a,contents:l}=i;if(!o)return;const u=je(i,U_),d=sl(o,a,u),f=(l==null?void 0:l.ops)??[];f.length>0&&Yk(f,e,n,r).forEach(p=>d.append(p));const h=(s=t.attributes)==null?void 0:s.segment;return typeof h=="string"&&Mt(d,hn,()=>h),d}function Yk(t,e,n,r){const s=[];for(const i of t){if(typeof i.insert=="string"){if(pn(i.attributes)){const o=_e(i.insert),a=Er(i.attributes.char,e,o,void 0,s);s.push(...a)}else s.push(_e(i.insert));continue}if(!(!i.insert||typeof i.insert!="object")){if(et("unknown",i)){const o=kf(i,e,n,r);o&&s.push(o);continue}if(et("note",i)){const o=_f(i,e,n,r);o&&s.push(o);continue}r==null||r.warn(`$createInlineNodesFromOps: Unsupported embed inside unknown contents: ${JSON.stringify(i.insert)}`)}}return s}function Xk(t){if(!t)return;const{marker:e}=t;if(e)return bl(e)}function Er(t,e,n,r,s){if(ee(n)&&n.getTextContentSize()===0&&n.setTextContent(Gt),Array.isArray(t)){if(t.length===0)throw new Error("Empty charAttr array");const i=t[0],o=s==null?void 0:s[s.length-1];if(pe(o)&&Ln(i,o))return t.length>1?Er(t.slice(1),e,n).forEach(d=>o.append(d)):n&&o.append(n),[];const a=t.reduceRight((d,f,h)=>{const p=gt(f.style,je(f,Ri));if(typeof f.cid=="string"&&Mt(p,$n,()=>f.cid),r&&h===t.length-1&&Mt(p,hn,()=>r),d)if(pe(d)){const y=d.getMarker(),k=[];ra(y,k,e),k.forEach(M=>p.append(M)),p.append(d);const C=[];sa(y,C,e),C.forEach(M=>p.append(M))}else p.append(d);return p},n),l=[],u=t[0];return ra(u.style,l,e),l.push(a),sa(u.style,l,e),l}else{const i=s==null?void 0:s[s.length-1];if(pe(i)&&Ln(t,i))return n&&i.append(n),[];const o=[];ra(t.style,o,e);const a=gt(t.style,je(t,Ri));return typeof t.cid=="string"&&Mt(a,$n,()=>t.cid),r&&Mt(a,hn,()=>r),n&&a.append(n),o.push(a),sa(t.style,o,e),o}}function ra(t,e,n){(n==null?void 0:n.markerMode)==="editable"?e.push(gr(t)):(n==null?void 0:n.markerMode)==="visible"&&e.push(mr("marker",en(t)))}function sa(t,e,n,r=!1){Ce.isValidFootnoteMarker(t)||Ce.isValidCrossReferenceMarker(t)||((n==null?void 0:n.markerMode)==="editable"?r?e.push(gr("","selfClosing")):e.push(gr(t,"closing")):(n==null?void 0:n.markerMode)==="visible"&&e.push(mr("marker",pr(r?"":t))))}function Zk(t){return!!t&&!!t.book&&typeof t.book=="object"&&t.book!==null&&"style"in t.book&&typeof t.book.style=="string"&&"code"in t.book&&typeof t.book.code=="string"}function Tl(t){return!!t&&!!t.para&&typeof t.para=="object"&&t.para!==null&&"style"in t.para&&typeof t.para.style=="string"}function pn(t){return!!t&&!!t.char&&typeof t.char=="object"&&t.char!==null&&(!Array.isArray(t.char)&&"style"in t.char&&typeof t.char.style=="string"||Array.isArray(t.char)&&t.char.length>0&&"style"in t.char[0]&&typeof t.char[0].style=="string")}function Qk(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)&&Object.keys(t).length===0}function lt(t,e){if(t)for(const n of Object.keys(t)){if(n==="segment"&&typeof t[n]=="string"){const r=t[n];Mt(e,hn,()=>r);continue}if(ev(n)){const r=!!t[n],s=n,i=e.hasFormat(s);(r&&!i||!r&&i)&&e.toggleFormat(s)}}}const vf=["bold","underline","strikethrough","italic","highlight","code","subscript","superscript","lowercase","uppercase","capitalize"];function ev(t){return vf.includes(t)}function tv({viewOptions:t}){const[e]=ce();return nv(e,t),null}function nv(t,e){b.useEffect(()=>{if(!t.hasNodes([Qt,Ye,$e]))throw new Error("ArrowNavigationPlugin: ImmutableChapterNode, ImmutableVerseNode or NoteNode not registered on editor!");const n=r=>{if(r.key!=="ArrowLeft"&&r.key!=="ArrowRight")return!1;const s=re();if(!X(s)||!s.isCollapsed())return!1;const i=t.getRootElement();if(!i)return!1;const o=i.dir||"ltr";let a=!1;return rv(o,r.key)?a=iv(s):sv(o,r.key)&&(a=ov(s,e)),a&&r.preventDefault(),a};return t.registerCommand(Ui,n,Ha)},[t,e])}function rv(t,e){return t==="ltr"&&e==="ArrowRight"||t==="rtl"&&e==="ArrowLeft"}function sv(t,e){return t==="ltr"&&e==="ArrowLeft"||t==="rtl"&&e==="ArrowRight"}function iv(t){var e,n,r;const s=t.anchor.getNode(),i=Zb(t);if(oe(i)&&!ws(i.getFirstChild())){if(yt(s)){if(t.anchor.offset===s.getChildrenSize())return!1}else if(t.anchor.offset!==s.getTextContentSize())return!1;if(i.getIsCollapsed()){if(i.is((e=i.getParent())==null?void 0:e.getLastChild()))return(r=(n=i.getParent())==null?void 0:n.getNextSibling())==null||r.selectStart(),!0}else return Ni(i.getFirstChild())?i.select(2,2):i.select(1,1),!0}if(yt(s)&&oe(i)&&i.getIsCollapsed()){const a=i.getNextSibling();return a?a.selectStart():i.selectEnd(),!0}const o=i==null?void 0:i.getParent();if(Ni(i)&&oe(o)&&i.is(o==null?void 0:o.getLastChild())){const a=o.getNextSibling();return a?a.selectStart():o.selectEnd(),!0}return!1}function ov(t,e){const n=Qb(t);if(ks(n)&&!n.getPreviousSibling())return!0;if(t.anchor.offset!==0)return!1;const r=t.anchor.getNode();if(Rt(r.getParent()))return!0;if(oe(n)&&n.getIsCollapsed()){const i=n.getPreviousSibling();if(!Tr(i))return!1;const o=n.getParent();if(!o)return!1;const a=n.getIndexWithinParent();return o.select(a,a),!0}if(yt(n)&&(e==null?void 0:e.noteMode)==="collapsed"){const i=n.getLastChild();if(!i)return!1;const o=vi(i,a=>oe(a));if(oe(o)&&o.getIsCollapsed()){const a=o.getParent();if(!a)return!1;const l=o.getIndexWithinParent();return a.select(l,l),!0}}const s=Vh(r);if(!s||s.getIsCollapsed())return!1;if(wn(n)){const i=s.getParent();if(!i)return!1;const o=s.getIndexWithinParent();return i.select(o,o),!0}return!1}function av(){const[t]=ce();return lv(t),null}function lv(t){b.useEffect(()=>{if(!t.hasNodes([Ce]))throw new Error("CharNodePlugin: CharNode not registered on editor!");return Xe(t.registerNodeTransform(Ce,cv),t.registerNodeTransform(jt,uv))},[t])}function cv(t){if(!pe(t))return;if(t.isEmpty()){t.remove();return}const e=t.getMarker(),n=ys(t,$n),r=t.getUnknownAttributes(),s=t.getNextSibling();pe(s)&&Ln({style:e,cid:n},s)&&Kt(r,s.getUnknownAttributes())&&(t.append(...s.getChildren()),s.remove());const i=t.getPreviousSibling();pe(i)&&Ln({style:e,cid:n},i)&&Kt(r,i.getUnknownAttributes())&&(i.append(...t.getChildren()),t.remove())}function uv(t){const e=t.getParent();if(!pe(e)||e.getChildrenSize()!==1)return;const n=t.getTextContent();n.length>1&&n.startsWith(Gt)&&(t.setTextContent(n.slice(1)),t.selectEnd())}function wf(t){return t.replaceAll("	"," ")}const El=t=>{navigator.clipboard.read().then(async e=>{if((await navigator.permissions.query({name:"clipboard-read"})).state==="denied"){alert("Not allowed to paste from clipboard.");return}const n=new DataTransfer,r=e[0];for(const i of r.types){const o=await(await r.getType(i)).text();n.setData(i,wf(o))}const s=new ClipboardEvent("paste",{clipboardData:n});t.dispatchCommand(Li,s)})},Ol=t=>{navigator.clipboard.read().then(async()=>{if((await navigator.permissions.query({name:"clipboard-read"})).state==="denied"){alert("Not allowed to paste from clipboard.");return}const e=new DataTransfer,n=await navigator.clipboard.readText();e.setData("text/plain",wf(n));const r=new ClipboardEvent("paste",{clipboardData:e});t.dispatchCommand(Li,r)})};function dv(){const[t]=ce();return b.useEffect(()=>{const e=n=>{const{key:r,shiftKey:s,metaKey:i,ctrlKey:o,altKey:a}=n;!(la?i:o)||a||(!s&&r.toLowerCase()==="c"?(n.preventDefault(),t.dispatchCommand(qi,null)):!s&&r.toLowerCase()==="x"?(n.preventDefault(),t.dispatchCommand(Fi,null)):r.toLowerCase()==="v"&&(n.preventDefault(),s?Ol(t):El(t)))};return t.registerRootListener((n,r)=>{r!==null&&r.removeEventListener("keydown",e),n!==null&&n.addEventListener("keydown",e)})},[t]),null}function hv({logger:t}){const[e]=ce();return b.useEffect(()=>Xe(e.registerCommand(Ui,n=>n.key!=="\\"&&n.key!=="/"?!1:(n.preventDefault(),!0),fi),e.registerCommand(Li,n=>{var r;const s=(r=n.clipboardData)==null?void 0:r.getData("text/plain");return!s||!s.includes("\\")&&!s.includes("/")?!1:(t==null||t.info("CommandMenuPlugin: paste containing backslash or forward slash ignored."),n.preventDefault(),!0)},fi),e.registerCommand(cd,n=>{var r;const s=(r=n.dataTransfer)==null?void 0:r.getData("text/plain");return!s||!s.includes("\\")&&!s.includes("/")?!1:(t==null||t.info("CommandMenuPlugin: drag containing backslash or forward slash ignored."),n.preventDefault(),!0)},fi)),[e,t]),null}function fv({index:t,isSelected:e,onClick:n,onMouseEnter:r,option:s}){let i="item";return e&&(i+=" selected"),s.isDisabled&&(i+=" disabled"),m.jsx("li",{tabIndex:-1,className:i,ref:s.setRefElement,role:"option","aria-selected":e,"aria-disabled":s.isDisabled,id:"typeahead-item-"+t,onMouseEnter:r,onClick:s.isDisabled?void 0:n,children:m.jsx("span",{className:"text",children:s.title})},s.key)}function pv({options:t,selectedItemIndex:e,onOptionClick:n,onOptionMouseEnter:r}){return m.jsx("div",{className:"typeahead-popover",children:m.jsx("ul",{children:t.map((s,i)=>m.jsx(fv,{index:i,isSelected:e===i,onClick:()=>n(s,i),onMouseEnter:()=>r(i),option:s},s.key))})})}class Qs extends im{constructor(e,n){super(e),K(this,"title"),K(this,"onSelect"),K(this,"isDisabled"),this.title=e,this.onSelect=n.onSelect.bind(this),this.isDisabled=n.isDisabled||!1}}function gv(t,e="editor-input"){return t?t.classList.contains(e):!1}function mv(){const[t]=ce(),[e,n]=b.useState(()=>!t.isEditable()),r=b.useRef(void 0),s=b.useRef(void 0),i=b.useRef(void 0),o=b.useMemo(()=>[new Qs("Cut",{onSelect:()=>{t.dispatchCommand(Fi,null)},isDisabled:e}),new Qs("Copy",{onSelect:()=>{t.dispatchCommand(qi,null)}}),new Qs("Paste",{onSelect:()=>{El(t)},isDisabled:e}),new Qs("Paste as Plain Text",{onSelect:()=>{Ol(t)},isDisabled:e})],[t,e]),a=b.useCallback((l,u,d)=>{t.update(()=>{l==null||l.onSelect(u),d()})},[t]);return b.useEffect(()=>{var l;s.current=((l=t.getRootElement())==null?void 0:l.className)??""},[t]),b.useEffect(()=>{const l=()=>{var u;(u=i.current)==null||u.call(i)};return window.addEventListener("scroll",l,!0),()=>{window.removeEventListener("scroll",l,!0)}},[]),b.useEffect(()=>t.registerEditableListener(l=>{n(!l)}),[t]),m.jsx(lm,{options:o,onSelectOption:a,onWillOpen:l=>{r.current=l.target},menuRenderFn:(l,{selectedIndex:u,options:d,selectOptionAndCleanUp:f,setHighlightedIndex:h},{setMenuRef:p})=>(i.current=()=>f(void 0),l.current&&!gv(r.current,s.current)&&!qh(r.current)?At.createPortal(m.jsx("div",{className:"typeahead-popover auto-embed-menu",style:{marginLeft:l.current.style.width,userSelect:"none",width:200},ref:p,children:m.jsx(pv,{options:o,selectedItemIndex:u,onOptionClick:(y,k)=>{y.isDisabled||(h(k),f(y))},onOptionMouseEnter:y=>{h(y)}})}),l.current):null)})}function yv({isEditable:t}){const[e]=ce();return b.useLayoutEffect(()=>{e.setEditable(t)},[e,t]),null}function bv({scripture:t,nodeOptions:e,editorAdaptor:n,viewOptions:r,logger:s}){const[i]=ce();return b.useEffect(()=>{var o;(o=n.initialize)==null||o.call(n,e,s)},[n,s,e]),b.useEffect(()=>{var o;(o=n.reset)==null||o.call(n);const a=n.serializeEditorState(t,r);if(a==null){s==null||s.warn("LoadStatePlugin: serializedEditorState was null or undefined. Skipping editor update.");return}try{const l=i.parseEditorState(a);queueMicrotask(()=>{i.update(()=>{i.setEditorState(l),i.dispatchCommand(nd,void 0)},{tag:ol})})}catch{s==null||s.error("LoadStatePlugin: error parsing or setting editor state.")}},[i,n,s,t,r]),null}function _v({expandedNoteKeyRef:t,nodeOptions:e,viewOptions:n,logger:r}){const[s]=ce();return kv(e,r),vv(s,t,n,r),null}function kv(t,e){const n=b.useRef(void 0),r=t.noteCallers;b.useEffect(()=>{let s=r;(!s||s.length<=0)&&(s=gk),n.current!==s&&(n.current=s,Mv("note-callers",s,e))},[e,r])}function vv(t,e,n,r){b.useEffect(()=>{if(!t.hasNodes([Ce,$e,_t]))throw new Error("NoteNodePlugin: CharNode, NoteNode or ImmutableNoteCallerNode not registered on editor!");const s=i=>t.update(()=>Ov(i));return Xe(t.registerNodeTransform($e,i=>wv(i,n)),t.registerNodeTransform(Ce,xv),t.registerNodeTransform(jt,Cv),t.registerNodeTransform(_t,Sv),t.registerMutationListener(_t,(i,{prevEditorState:o})=>Tv(i,o)),t.registerCommand(ms,()=>Ev(t,e,n,r),_r),t.registerRootListener((i,o)=>{o!==null&&o.removeEventListener("dblclick",s),i!==null&&i.addEventListener("dblclick",s)}))},[t,e,r,n])}function wv(t,e){const n=t.getChildren();if(!n.some(r=>wn(r))&&(e==null?void 0:e.markerMode)!=="editable"&&t.getCaller()!==""&&t.remove(),n.length>0){const r=n[0];ee(r)&&!ws(r)&&t.insertBefore(r)}}function xv(t){const e=t.getParentOrThrow(),n=e.getChildren(),r=n.find(o=>wn(o));if(!pe(t)||!oe(e)||!r)return;const s=ml(n);r.getPreviewText()!==s&&r.setPreviewText(s);const i=t.getNextSibling();ee(i)?i.getTextContent()!==me&&i.setTextContent(me):t.insertAfter(_e(me))}function Cv(t){const e=Vh(t),n=e==null?void 0:e.getChildren(),r=n==null?void 0:n.find(o=>wn(o));if(!ee(t)||!oe(e)||!r||!n)return;const s=t.getParent();if(!ws(t)&&oe(s)&&t.getTextContent()!==me&&(t.setTextContent(me),t.selectEnd()),pe(s)&&s.getChildrenSize()===1){const o=t.getTextContent();o.length>1&&o.startsWith(Gt)&&(t.setTextContent(o.slice(1)),t.selectEnd())}const i=ml(n);r.getPreviewText()!==i&&r.setPreviewText(i)}function Sv(t){if(!wn(t))return;const e=t.getNextSibling();!ee(e)||ws(e)?t.insertAfter(_e(me)):e.getTextContent()!==me&&e.setTextContent(me)}function Tv(t,e){for(const[n,r]of t){if(r!=="destroyed")continue;const s=e.read(()=>{const o=Te(n),a=o==null?void 0:o.getParent();return wn(o)&&oe(a)&&a.getCaller()===Pt}),i=document.querySelector(".editor-input");!s||!i||(i.classList.add("reset-counters"),i.offsetHeight,i.classList.remove("reset-counters"))}}function Ev(t,e,n,r){var s;if((n==null?void 0:n.noteMode)!=="expandInline")return!1;const i=re();if(!X(i)||!i.isCollapsed())return!1;const o=i.anchor,a=o.getNode();if(e.current){const l=vi(a,u=>oe(u));if(l)e.current!==l.getKey()&&(e.current=l.getKey());else{const u=Te(e.current);u&&!u.getIsCollapsed()&&(r==null||r.debug("Cursor moved away from NoteNode, collapsing it"),Kr(t,e.current,r)),e.current=void 0}}if(o.offset===0){const l=a.getPreviousSibling();if(oe(l)){r==null||r.debug("Cursor is just after a NoteNode");const u=l.getKey();l.getIsCollapsed()?e.current=u:e.current=void 0,Kr(t,u,r)}}if(o.offset===a.getTextContentSize()){const l=a.getNextSibling();if(oe(l)){r==null||r.debug("Cursor is just before a NoteNode");const u=l.getKey();l.getIsCollapsed()?e.current=u:e.current=void 0,Kr(t,u,r)}else if(!l){const u=vi(a,d=>oe(d));if(u&&u.getIsCollapsed()&&yt(u.getParent())&&u.is((s=u.getParent())==null?void 0:s.getLastChild())){r==null||r.debug("Cursor is at end of note at end of para");const d=u.getKey();e.current=d,Kr(t,d,r)}}}if(yt(a)){const l=a.getChildAtIndex(o.offset),u=l==null?void 0:l.getPreviousSibling();if(Tr(u)&&oe(l)){r==null||r.debug("Cursor is between verse and NoteNode");const d=l.getKey();l.getIsCollapsed()?e.current=d:e.current=void 0,Kr(t,d,r)}}return!1}function Kr(t,e,n){const r=Te(e);try{r==null||r.toggleIsCollapsed()}catch(s){if(s instanceof Error&&s.message.includes("read only"))n==null||n.warn("Fallback triggered after stabilization - edge case"),setTimeout(()=>{t.update(()=>{r==null||r.toggleIsCollapsed()})},0);else throw s}}function Ov(t){const e=re();if(!X(e))return;const n=e.anchor,r=e.focus,s=n.getNode(),i=r.getNode();if(oe(s)&&ee(i)){t.preventDefault();const o=gd();o.anchor.set(i.getKey(),0,"text"),o.focus.set(i.getKey(),r.offset,"text"),dd(o)}}function Mv(t,e,n){for(const r of document.styleSheets)try{const s=r.cssRules||r.rules;for(const i of s)if(Av(i,t)){const o=e.map(a=>`"${a}"`).join(" ");i.symbols=o;return}}catch{continue}n==null||n.warn(`Editor: counter style "${t}" not found.`)}function Av(t,e){return typeof t=="object"&&t!==null&&"name"in t&&t.name===e&&"symbols"in t&&typeof t.symbols=="string"}function jv({onChange:t}){const[e]=ce();return b.useEffect(()=>e.registerCommand(ms,()=>{const n=e.read(()=>rf());return t==null||t(n),!1},_r),[e,t]),null}function Nv(){const[t]=ce();return Iv(t),null}function Iv(t){b.useEffect(()=>{if(!t.hasNodes([nt]))throw new Error("ParaNodePlugin: ParaNode not registered on editor!");return t.registerNodeTransform(nt,e=>Rv(e,t))},[t])}function Rv(t,e){wl(e,t.getKey())&&uf(t.getFirstChild()),!(!ze(t)||t.getMarker()!=="b"||t.isEmpty()||!e.getEditorState().read(()=>{const n=Te(t.getKey());return ze(n)&&((n==null?void 0:n.isEmpty())??!1)}))&&t.clear()}function xf({onStateChange:t}){const[e]=ce(),[n,r]=b.useState(e),s=b.useRef(!1),i=b.useRef(!1),o=b.useRef(),a=b.useRef(),l=b.useCallback(()=>{const u=re();let d;if(X(u)){const f=u.anchor.getNode(),h=u.focus.getNode();let p=f.getKey()==="root"?f:vi(f,M=>{const v=M.getParent();return v!==null&&Ip(v)});p===null&&(p=f.getTopLevelElementOrThrow());const y=p.getKey(),k=n.getElementByKey(y),C=t_(f,h);if(C&&R_(C)&&(d=C.getMarker()),k!==null&&(ze(p)||Rt(p)||ks(p))){o.current=p.getMarker(),a.current=d,t==null||t({canUndo:s.current,canRedo:i.current,blockMarker:o.current,contextMarker:d});return}}a.current=d},[n,t]);return b.useEffect(()=>e.registerCommand(ms,(u,d)=>(l(),r(d),!1),Zr),[e,l]),b.useEffect(()=>Xe(n.registerUpdateListener(({editorState:u})=>{u.read(()=>{l()})}),n.registerCommand(Jr,u=>(s.current=u,t==null||t({canUndo:s.current,canRedo:i.current,blockMarker:o.current,contextMarker:a.current}),!1),Zr),n.registerCommand(zr,u=>(i.current=u,t==null||t({canUndo:s.current,canRedo:i.current,blockMarker:o.current,contextMarker:a.current}),!1),Zr)),[l,n,t]),null}function Pv({textDirection:t}){const[e]=ce();return $v(e,t),null}function $v(t,e){b.useEffect(()=>(Jc(t,e),t.registerUpdateListener(({dirtyElements:n})=>{n.size>0&&Jc(t,e)})),[t,e])}function Jc(t,e){if(e==="auto")return;const n=t.getRootElement();n&&(n.dir=e);const r=t._config.theme.placeholder,s=document.getElementsByClassName(r)[0];s&&(s.dir=e)}function Dv(){const[t]=ce();return Lv(t),null}function Lv(t){b.useEffect(()=>{if(!t.hasNodes([Ce,Ye,$e,jt,Ge]))throw new Error("TextSpacingPlugin: CharNode, ImmutableVerseNode, NoteNode, TextNode or VerseNode not registered on editor!");return Xe(t.registerNodeTransform(jt,Fv),t.registerNodeTransform(jt,e=>qv(e,t)),t.registerNodeTransform(Ge,Vc),t.registerNodeTransform(Ye,Vc))},[t])}function Fv(t){if(!t.isAttached())return;const e=t.getTextContent(),n=t.getNextSibling(),r=t.getParent();t.getMode()!=="normal"||e.endsWith(" ")&&e.length>1||oe(n)||pe(r)||Ee(r)||Zt(r)||(e===" "&&!ut(n)?t.setTextContent(""):vl(t))}function qv(t,e){const n=t.getParent();!Zt(n)||!t.isAttached()||wl(e,t.getKey())&&n.insertAfter(t)}function Vc(t){if(!t.isAttached())return;const e=t.getPreviousSibling();e&&!ut(e)&&!ee(e)&&!Zt(e)&&t.insertBefore(_e(" "))}function Uv({trigger:t,scriptureReference:e,contextMarker:n,getMarkerAction:r}){const{markersMenuItems:s}=Rk({scriptureReference:e,contextMarker:n,getMarkerAction:r});return m.jsx(Ik,{trigger:t,items:s})}function Bv({trigger:t,scrRef:e,contextMarker:n,getMarkerAction:r}){const{book:s,chapterNum:i,verseNum:o,verse:a,versificationStr:l}=e,u=b.useMemo(()=>({book:s,chapterNum:i,verseNum:o,verse:a,versificationStr:l}),[s,i,o,a,l]),[d]=ce();return Hv(d),m.jsx(Uv,{trigger:t,scriptureReference:u,contextMarker:n,getMarkerAction:r})}function Hv(t){b.useEffect(()=>{if(!t.hasNodes([Ge,Ye]))throw new Error("UsjNodesMenuPlugin: VerseNode or ImmutableVerseNode not registered on editor!");const e={},n={};return Xe(t.registerNodeTransform(Ye,r=>Gc(r,t,e)),t.registerNodeTransform(Ge,r=>Gc(r,t,e)),t.registerMutationListener(Ye,r=>Qc(r,t,e,n)),t.registerMutationListener(Ge,r=>Qc(r,t,e,n)))},[t])}function Gc(t,e,n){$p(ol)||wl(e,t.getKey())&&zv(t,n)}const Yc=2,Wv=3,Xc=4,Kv=5;function zv(t,e){var n;const r=fl(t),s=r==null?void 0:r.getNumber();if(!s)return;const i=e[s];if(!i)return;let o=parseInt(t.getNumber()),a=((n=Zc(t.getNumber()))==null?void 0:n[Yc])??"";i.forEach(l=>{const u=Te(l);if(!u)return;const d=u.getNumber(),f=parseInt(d),h=Zc(d),p=!!(h!=null&&h[Wv]),y=p?parseInt(h[Xc]):f;if(y<o||f>o||y===o&&a)return;const k=(h==null?void 0:h[Yc])??"",C=(h==null?void 0:h[Kv])??"",M=p?Ca(parseInt(h[Xc]),void 0):"";let v=`${k}`;v+=p?`-${M}${C}`:"";const O=Ca(f,void 0);u.setNumber(`${O}${v}`),o=parseInt(p?M:O),a=p?C:k})}function Zc(t){return RegExp(/(\d+)([a-zA-Z]+)?(-(\d+)([a-zA-Z]+)?)?/).exec(t)}function Qc(t,e,n,r){e.getEditorState().read(()=>{for(const[s,i]of t){const o=Te(s);if(ut(o)){if(i==="created"){const a=fl(o);if(!a)continue;const l=a.getNumber();n[l]||(n[l]=[]),n[l].push(s),r[s]=l}else if(i==="destroyed"){const a=r[s],l=n[a];if(!l)continue;const u=l.findIndex(d=>d===s);if(u===-1)continue;l.splice(u,1),Reflect.deleteProperty(r,s)}}}})}const Cf="formatted",Jv="unformatted";let Ml;function Vv(t){const e=Gv(t);if(!e)throw new Error(`Invalid view mode: ${t}`);Ml=e}Vv(Cf);const Or=()=>Ml;function Gv(t){let e;switch(t){case Cf:e={markerMode:"hidden",noteMode:"collapsed",hasSpacing:!0,isFormattedFont:!0};break;case Jv:e={markerMode:"editable",noteMode:"expanded",hasSpacing:!1,isFormattedFont:!1};break}return e}function Yv(t){if(t)return t.markerMode==="editable"?Ge:Ye}function Xv(t){const e=[],n=t??Ml;return n&&(e.push(`${wb}${n.markerMode}`),n.hasSpacing&&e.push(kb),n.isFormattedFont&&e.push(vb)),e}let Ma;function Zv(t){t&&(Ma=t)}function Qv(t){return t.isEmpty()?ed:ew(t.toJSON())}function ew(t){if(!t.root||!t.root.children)return;const e=t.root.children;if(e.length===1&&cl(e[0])&&(!e[0].children||e[0].children.length===0))return ed;const n=Sf(e),r=on(n);return r?{type:ss,version:is,content:r}:void 0}function tw(t,e){const{type:n,marker:r,unknownAttributes:s}=t;let i;return t.code!==""&&(i=t.code),Ne({type:n,marker:r,code:i,...s,content:e})}function nw(t){const{marker:e,number:n,sid:r,altnumber:s,pubnumber:i,unknownAttributes:o}=t;return Ne({type:vt.getType(),marker:e,number:n,sid:r,altnumber:s,pubnumber:i,...o})}function rw(t,e){const{marker:n,sid:r,altnumber:s,pubnumber:i,unknownAttributes:o}=t,a=e&&typeof e[0]=="string"?e[0]:void 0;let{number:l}=t;return l=Gh(n,a,l),Ne({type:vt.getType(),marker:n,number:l,sid:r,altnumber:s,pubnumber:i,...o})}function sw(t){const{marker:e,sid:n,altnumber:r,pubnumber:s,unknownAttributes:i}=t,{text:o}=t;let{number:a}=t;return a=Gh(e,o,a),Ne({type:Ge.getType(),marker:e,number:a,sid:n,altnumber:r,pubnumber:s,...i})}function iw(t,e){const{type:n,marker:r,unknownAttributes:s}=t,i=r===""?void 0:r;return e==null||e.forEach((o,a)=>{typeof o=="string"&&o.startsWith(me)&&(e[a]=o.slice(1))}),Ne({type:n,marker:i,...s,content:e})}function ow(t,e){const{type:n,marker:r,unknownAttributes:s}=t;return Ne({type:n,marker:r,...s,content:e})}function aw(t,e){const{type:n,marker:r,caller:s,category:i,unknownAttributes:o}=t;return Ne({type:n,marker:r,caller:s,category:i,...o,content:e})}function rr(t){const{type:e,marker:n,sid:r,eid:s,unknownAttributes:i}=t;return Ne({type:e,marker:n===""?void 0:n,sid:r,eid:s,...i})}function lw(t){return t.text}function cw(t,e){const{tag:n,marker:r,unknownAttributes:s}=t;return Ne({type:n,marker:r,...s,content:e})}function uw(t){const{marker:e}=t;return{type:Ii,marker:e===""?void 0:e}}function eu(t,e){const n=t[t.length-1];n&&typeof n=="string"?t[t.length-1]=n+e:t.push(e)}function dw(t,e,n,r,s){const i=$t.getType(),o=e.filter(a=>!n.includes(a));if(n.filter(a=>!e.includes(a)).forEach(a=>{const l=rr({type:i,marker:or,eid:a});s.push(l)}),o.forEach(a=>{const l=rr({type:i,marker:Dn,sid:a});s.push(l)}),e.length===0){const a=rr({type:i,marker:Dn});s.push(a)}if(s.push(...t),e.length===0){const a=rr({type:i,marker:or});s.push(a)}(!r||!f_(r))&&e.forEach(a=>{const l=rr({type:i,marker:or,eid:a});s.push(l)})}function on(t,e){const n=[];let r,s=[];return t.forEach((i,o)=>{const a=i,l=i,u=i,d=i,f=i,h=i,p=i,y=i;switch(i.type){case dt.getType():n.push(tw(a,on(a.children)));break;case Qt.getType():n.push(nw(i));break;case vt.getType():n.push(rw(l,on(l.children)));break;case Ye.getType():case Ge.getType():n.push(sw(i));break;case Ce.getType():n.push(iw(u,on(u.children)));break;case nt.getType():n.push(ow(d,on(d.children)));break;case $e.getType():n.push(aw(f,on(f.children,f.caller)));break;case kn.getType():case _t.getType():case md.getType():case Bn.getType():break;case Fe.getType():if(r=on(p.children),r){const k=p.typedIDs[un];if(k)dw(r,k,s,t[o+1],n),s=k;else{const C=r.shift();C&&(typeof C=="string"?eu(n,C):n.push(C)),r.length>0&&n.push(...r)}}break;case $t.getType():n.push(rr(i));break;case jt.getType():h.text&&h.text!==me&&!h.text.startsWith(il)&&(!e||h.text!==gl(e))&&eu(n,lw(h));break;case Un.getType():n.push(cw(y,on(y.children)));break;case vn.getType():n.push(uw(i));break;default:Ma==null||Ma.error(`Unexpected node type '${i.type}'!`)}}),n&&n.length>0?n:void 0}function Sf(t){const e=t.findIndex(n=>cl(n));if(e>=0){const n=t.slice(0,e),r=t[e].children,s=Sf(t.slice(e+1));t=[...n,...r,...s]}return t}const ia={initialize:Zv,deserializeEditorState:Qv},tu=Tf([]),hw={type:md.getType(),version:1};let $i=[],Z,ki,Aa,ve;function fw(t,e){$i=[],mw(t),yw(e)}function pw(t=0){}function gw(t,e){Z=e??Or();let n;return t?(t.type!==ss&&(ve==null||ve.warn(`This USJ type '${t.type}' didn't match the expected type '${ss}'.`)),t.version!==is&&(ve==null||ve.warn(`This USJ version '${t.version}' didn't match the expected version '${is}'.`)),t.content.length>0?n=Na(Xr(t.content)):n=[tu]):n=[tu],Aa==null||Aa($i),{root:{children:n,direction:null,format:"",indent:0,type:"root",version:1}}}function mw(t){t&&(ki=t),t!=null&&t.addMissingComments&&(Aa=t.addMissingComments)}function yw(t){t&&(ve=t)}function bw(t){return!t||t.length!==1||typeof t[0]!="string"?"":t[0]}function _w(t){let{marker:e}=t;e!==hs&&(ve==null||ve.warn(`Unexpected book marker '${e}'!`)),e=e??hs;const{code:n}=t;(!n||!dt.isValidBookCode(n))&&(ve==null||ve.warn(`Unexpected book code '${n}'!`));const r=[];((Z==null?void 0:Z.markerMode)==="editable"||(Z==null?void 0:Z.markerMode)==="visible")&&r.push(Fn("marker",en(e)+" "+n+me));const s=bw(t.content);s&&r.push(gn(s));const i=je(t,bb);return Ne({type:dt.getType(),marker:e,code:n??"",unknownAttributes:i,children:r,direction:null,format:"",indent:0,version:Ah})}function kw(t){let{marker:e}=t;e!==Mi&&(ve==null||ve.warn(`Unexpected chapter marker '${e}'!`)),e=e??Mi;const{number:n,sid:r,altnumber:s,pubnumber:i}=t,o=je(t,Cb);let a;return(Z==null?void 0:Z.markerMode)==="visible"&&(a=!0),(Z==null?void 0:Z.markerMode)==="editable"?Ne({type:vt.getType(),marker:e,number:n??"",sid:r,altnumber:s,pubnumber:i,unknownAttributes:o,children:[gn(vs(e,n)??"")],direction:null,format:"",indent:0,version:Ih}):Ne({type:Qt.getType(),marker:e,number:n??"",showMarker:a,sid:r,altnumber:s,pubnumber:i,unknownAttributes:o,version:Lh})}function vw(t){let{marker:e}=t;e!==Ai&&(ve==null||ve.warn(`Unexpected verse marker '${e}'!`)),e=e??Ai;const{number:n,sid:r,altnumber:s,pubnumber:i}=t,o=(Yv(Z)??Ye).getType(),a=(Z==null?void 0:Z.markerMode)==="editable"?zh:of;let l,u;(Z==null?void 0:Z.markerMode)==="editable"?l=vs(e,n):(Z==null?void 0:Z.markerMode)==="visible"&&(u=!0);const d=je(t,zb);return Ne({type:o,text:l,marker:e,number:n??"",sid:r,altnumber:s,pubnumber:i,showMarker:u,unknownAttributes:d,version:a})}function ww(t,e=[]){let{marker:n}=t;Ce.isValidMarker(n)||ve==null||ve.warn(`Unexpected char marker '${n}'!`),n=n??"",(Z==null?void 0:Z.markerMode)==="editable"&&e.forEach(s=>{pl(s)&&(s.text=me+s.text)}),e.length===0&&e.push(gn(Gt));const r=je(t,Eb);return Ne({type:Ce.getType(),marker:n,unknownAttributes:r,children:[...e],direction:null,format:"",indent:0,textFormat:0,textStyle:"",version:Dh})}function Tf(t){return{type:fn.getType(),children:t,direction:null,format:"",indent:0,textFormat:0,textStyle:"",version:Uh}}function xw(t,e=[]){let{marker:n}=t;nt.isValidMarker(n)||ve==null||ve.warn(`Unexpected para marker '${n}'!`),n=n??Ji;const r=[];(Z==null?void 0:Z.markerMode)==="editable"?r.push(br(n),gn(me)):(Z==null?void 0:Z.markerMode)==="visible"&&r.push(Fn("marker",en(n)+me)),r.push(...e);const s=je(t,Hb);return Ne({type:nt.getType(),marker:n,unknownAttributes:s,children:r,direction:null,format:"",indent:0,textFormat:0,textStyle:"",version:Kh})}function Cw(t,e){const n=i_(e);let r=()=>{};return ki!=null&&ki.noteCallerOnClick&&(r=ki.noteCallerOnClick),Ne({type:_t.getType(),caller:t,previewText:n,onClick:r,version:pf})}function Sw(t,e){let{marker:n}=t;$e.isValidMarker(n)||ve==null||ve.warn(`Unexpected note marker '${n}'!`),n=n??ul;const{category:r}=t,s=t.caller??"*",i=(Z==null?void 0:Z.noteMode)!=="expanded",o=je(t,Fb);let a,l;(Z==null?void 0:Z.markerMode)==="editable"?(a=br(n),l=br(n,"closing")):(Z==null?void 0:Z.markerMode)==="visible"&&(a=Fn("marker",en(n)+me),l=Fn("marker",pr(n)+me));const u=[];let d;if(a&&u.push(a),(Z==null?void 0:Z.markerMode)==="editable")d=gn(gl(s)),u.push(d,...e);else{const f=gn(me);d=Cw(s,e),u.push(d,f,...e.flatMap(Tw(f)))}return l&&u.push(l),Ne({type:$e.getType(),marker:n,caller:s,isCollapsed:i,category:r,unknownAttributes:o,children:u,direction:null,format:"",indent:0,version:Wh})}function Tw(t){return e=>y_(e)?[e]:[e,t]}function Ew(t){let{marker:e}=t;(!e||!$t.isValidMarker(e))&&(ve==null||ve.warn(`Unexpected milestone marker '${e}'!`)),e=e??"";const{sid:n,eid:r}=t,s=je(t,$b);return Ne({type:$t.getType(),marker:e,sid:n,eid:r,unknownAttributes:s,version:Bh})}function nu(t,e=[]){return{type:Fe.getType(),typedIDs:{[un]:e},children:t,direction:null,format:"",indent:0,version:1}}function Ow(t,e){const{marker:n}=t,r=t.type,s=je(t,gb),i=[...e];return i.forEach(o=>{pl(o)&&(o.mode="token")}),Ne({type:Un.getType(),tag:r,marker:n,unknownAttributes:s,children:i,direction:null,format:"",indent:0,version:Mh})}function Mw(t){return{type:vn.getType(),marker:t,version:tf}}function br(t,e="opening"){return{type:Bn.getType(),marker:t,markerSyntax:e,text:"",detail:0,format:0,mode:"normal",style:"",version:1}}function gn(t,e="normal"){return{type:jt.getType(),text:t,detail:0,format:0,mode:e,style:"",version:1}}function Fn(t,e){return{type:kn.getType(),text:e,textType:t,version:ef}}function ru(t,e){(Z==null?void 0:Z.markerMode)==="editable"?e.push(br(t)):(Z==null?void 0:Z.markerMode)==="visible"&&e.push(Fn("marker",en(t)))}function su(t,e,n=!1){Ce.isValidFootnoteMarker(t)||Ce.isValidCrossReferenceMarker(t)||((Z==null?void 0:Z.markerMode)==="editable"?n?e.push(br("","selfClosing")):e.push(br(t,"closing")):(Z==null?void 0:Z.markerMode)==="visible"&&e.push(Fn("marker",pr(n?"":t))))}function Aw(t,e){if(t.type!=="ms")return;const n=[];if(t.sid&&n.push(`sid="${t.sid}"`),t.eid&&n.push(`eid="${t.eid}"`),n.length<=0)return;const r=il+n.join(" ");(Z==null?void 0:Z.markerMode)==="editable"?e.push(gn(r)):(Z==null?void 0:Z.markerMode)==="visible"&&e.push(Fn("attribute",r))}function iu(t,e){return t.length<=0||e===0?t:t.map(n=>n-e)}function jw(t,e){const n=t.indexOf(e,0);n>-1&&t.splice(n,1)}function ou(t,e){e.marker===Dn&&e.sid!==void 0&&t.push(e.sid),e.marker===or&&e.eid!==void 0&&jw(t,e.eid)}function ja(t,e,n=!1,r=[]){if(e.length<=0||e[0]>=t.length)return t;const s=e.shift(),i=e.length>0?e.shift():t.length-1;if(s===void 0||i===void 0||i>=t.length||t.length<=0)return t;const o=t.slice(0,s),a=n?[nu(o,[...r])]:o,l=t[s];ou(r,l);const u=ja(t.slice(s+1,i),iu(e,s+1),l.marker===Dn,r),d=nu(u,[...r]),f=t[i];ou(r,f);const h=ja(t.slice(i+1),iu(e,i+1),f.marker===Dn,r);return[...a,d,...h]}function Xr(t){const e=[],n=[];return t==null||t.forEach(r=>{if(typeof r=="string")r&&n.push(gn(r));else if(!r.type)ve==null||ve.error("Marker type is missing!");else switch(r.type){case dt.getType():n.push(_w(r));break;case vt.getType():n.push(kw(r));break;case Ge.getType():Z!=null&&Z.hasSpacing||n.push(hw),n.push(vw(r));break;case Ce.getType():ru(r.marker??"",n),n.push(ww(r,Xr(r.content))),su(r.marker??"",n);break;case nt.getType():n.push(xw(r,Xr(r.content)));break;case $e.getType():n.push(Sw(r,Xr(r.content)));break;case $t.getType():Db(r.marker??"")&&(e.push(n.length),r.sid!==void 0&&($i==null||$i.push(r.sid))),n.push(Ew(r)),ru(r.marker??"",n),Aw(r,n),su(r.marker??"",n,!0);break;case vn.getType():n.push(Mw(r.marker??""));break;default:ve==null||ve.warn(`Unknown type-marker '${r.type}-${r.marker}'!`),n.push(Ow(r,Xr(r.content)))}}),ja(n,e)}function Na(t){const e=t.findIndex(n=>_b(n)||Vb(n)||Kb(n));if(e>=0){const n=Na(t.slice(0,e)),r=t[e],s=Na(t.slice(e+1));return[...n,r,...s]}else if(t.some(n=>"text"in n&&"mode"in n||T_(n)))return[Tf(t)];return t}const Ia={initialize:fw,reset:pw,serializeEditorState:gw},ei=t=>{if(!$e.isValidMarker(t)||!t.includes("f"))throw new Error(`Invalid footnote marker '${t}'`);return{action:e=>{const{chapterNum:n,verseNum:r}=e.reference,s=[];return n!==void 0&&r!==void 0&&s.push({type:"char",marker:"fr",content:[`${n}:${r}`]}),e.noteText&&s.push({type:"char",marker:"fq",content:[e.noteText]}),s.push({type:"char",marker:"ft"}),[{type:"note",marker:t,caller:Pt,content:s}]}}},au=t=>{if(!$e.isValidMarker(t)||!t.includes("x"))throw new Error(`Invalid cross-reference marker '${t}'`);return{action:e=>{const{chapterNum:n,verseNum:r}=e.reference,s=[];return n!==void 0&&r!==void 0&&s.push({type:"char",marker:"xo",content:[`${n}:${r}`]}),e.noteText&&s.push({type:"char",marker:"xq",content:[e.noteText]}),s.push({type:"char",marker:"xt"}),[{type:"note",marker:t,caller:fr,content:s}]}}},Nw={c:{action:t=>{const{chapterNum:e}=t.reference;return[{type:"chapter",marker:"c",number:`${e+1}`}]}},v:{action:t=>{const{verseNum:e,verse:n}=t.reference;return[{type:"verse",marker:"v",number:`${Ca(e,n)}`}]}},f:ei("f"),fe:ei("fe"),ef:ei("ef"),efe:ei("efe"),x:au("x"),ex:au("ex")};function Iw(t,e,n,r,s){const i=Rw(t);return{action:o=>{o.editor.update(()=>{var a;const l=re();X(l)&&(o.noteText=l.getTextContent());const u=(a=i==null?void 0:i.action)==null?void 0:a.call(i,o);if(!u)return;const d=Rc(u,Ia,r),f=Zo(d);if(X(l)){const h=l.anchor.getNode();if(oe(f))af(f,l,r),f.getIsCollapsed()||(e.current=f.getKey());else if(l.getTextContent().length>0)Pw(l,()=>Zo(d));else if(we(f)&&!f.isInline()){const p=l.insertParagraph();if(p){const y=p.getChildren();f.append(...y),p.replace(f),f.selectStart()}}else if(ee(h)&&!ws(h)&&oe(h.getParent())&&l.isCollapsed()){let p=h.insertAfter(f);if(Ni(f)){const y={...r||Or(),markerMode:"hidden"},k=Rc(u,Ia,y),C=Zo(k);p=p.insertAfter(C)}p.insertAfter(_e(me))}else{l.insertNodes([f]),qw(f);const p=f.getNextSibling();p?p.selectStart():f.selectStart()}}else l==null||l.insertNodes([f])},s)},label:i==null?void 0:i.label}}function Rw(t){let e=Nw[t];return e||(nt.isValidMarker(t)?e={action:()=>[{type:nt.getType(),marker:t,content:[]}]}:Ce.isValidMarker(t)&&(e={action:()=>[{type:Ce.getType(),marker:t}]})),e}function Pw(t,e){const n=t.getNodes(),[r,s]=$w(t);let i;n.forEach((o,a)=>{if(we(i)&&i.isParentOf(o))return;const l=Dw(o,a===0,a===n.length-1,r,s);if(!l){i=void 0;return}i||(i=e(),l.insertBefore(i)),Fw(l,i)}),(ee(i)||we(i))&&i.selectEnd()}function $w(t){const e=t.anchor.offset,n=t.focus.offset;return t.isBackward()?[n,e]:[e,n]}function Dw(t,e,n,r,s){if(!(Ee(t)||oe(t)||oe(t.getParent()))){if(ee(t))return Lw(t,e,n,r,s);if(we(t)&&t.isInline())return t}}function Lw(t,e,n,r,s){const i=t.getTextContentSize(),o=e?r:0,a=n?s:i;if(o===0&&a===0)return;const l=t.splitText(o,a);return l.length===1?l[0]:l.length===3||a===i?l[1]:l[0]}function Fw(t,e){var n;if(ee(e)){const r=lu(t,e);e.setTextContent(r),t.remove()}else if(we(e)){const r=e.getChildrenSize();e.append(t);for(let s=0;s<r;s++)(n=e.getFirstChild())==null||n.remove();lu(t,e)}}function lu(t,e){let n=t.getTextContent();if(ee(t)&&e.isInline()&&n.startsWith(" ")){n=n.trimStart(),t.setTextContent(n);const r=e.getPreviousSibling();vl(r),ee(r)||e.insertBefore(_e(" "))}return n}function qw(t){ut(t)&&(vl(t.getPreviousSibling()),uf(t.getNextSibling()))}const Ef={chapter:"chapter",verse:"verse",char:"char",para:"para",typedMark:"editor-typed-mark",typedMarkOverlap:"editor-typed-markOverlap",mark:"editor-mark",markOverlap:"editor-markOverlap",placeholder:"editor-placeholder",paragraph:"editor-paragraph",quote:"editor-quote",heading:{h1:"editor-heading-h1",h2:"editor-heading-h2",h3:"editor-heading-h3",h4:"editor-heading-h4",h5:"editor-heading-h5"},list:{nested:{listitem:"editor-nested-listitem"},ol:"editor-list-ol",ul:"editor-list-ul",listitem:"editor-listitem"},image:"editor-image",link:"editor-link",text:{bold:"editor-text-bold",italic:"editor-text-italic",overflowed:"editor-text-overflowed",hashtag:"editor-text-hashtag",underline:"editor-text-underline",strikethrough:"editor-text-strikethrough",underlineStrikethrough:"editor-text-underlineStrikethrough"}};function Uw({options:t,editedUsjRef:e,usj:n,setUsj:r}){const{view:s,nodes:i}=t||{},{hasSpacing:o,isFormattedFont:a,markerMode:l}=s||{};return b.useEffect(()=>{e.current&&!Kt(e.current,n)&&r(e.current)},[e,o,a,l,i,r,n]),null}function Bw({scrRef:t,onScrRefChange:e}){const[n]=ce(),r=b.useRef(!1),s=b.useRef(!1),{book:i,chapterNum:o,verseNum:a}=t;return b.useEffect(()=>n.registerMutationListener(dt,l=>{n.update(()=>{for(const[u,d]of l){const f=Te(u);f&&Rt(f)&&d==="created"&&cu(o,a,s)}},{tag:va})},{skipInitialization:!0}),[n,o,a]),b.useEffect(()=>{r.current?r.current=!1:n.update(()=>cu(o,a,s),{tag:va})},[n,o,a]),b.useEffect(()=>n.registerCommand(ms,()=>(s.current?s.current=!1:Hw(i,o,a,e,r),!1),_r),[n,i,o,a,e]),null}function cu(t,e,n){var r;const s=Xh(re()),i=(r=cf(s))==null?void 0:r.getNumber();if(o_(i)&&yl(e,i))return;const o=Dt().getChildren(),a=Gb(o,t),l=s_(o,a),u=Yb(l,!!a);if(u&&!a||!a)return;r_(l,u);const d=I_(l,e);if(d){if(ze(d)){const f=d.getFirstChild();ee(f)?f.select(0,0):d.select(0,0)}else d.selectNext(0,0);n.current=!0}}function Hw(t,e,n,r,s){const i=Xh(re());if(!i)return;const o=fl(i),a=parseInt((o==null?void 0:o.getNumber())??"1",10),l=cf(i),u=l==null?void 0:l.getNumber(),d=parseInt(u??"0",10),f=u?yl(n,u):n===d;if(s.current=!!(o&&a!==e||!f),s.current){const h={book:t,chapterNum:a,verseNum:d};u!=null&&d.toString()!==u&&(h.verse=u),r(h)}}function Ww(t){return Rt(t)?`${t.__code}`:al(t)?`${t.__marker} "${t.__number}"`:pe(t)?`${t.__marker}`:ks(t)?`${t.__marker} "${t.__number}"`:wn(t)?`${t.__caller}`:Tr(t)?`${t.__marker} "${t.__number}"`:oe(t)?`${t.__marker} "${t.__caller}"`+(t.__isCollapsed?" (collapsed)":" (expanded)"):ze(t)?`${t.__marker}`:Ee(t)?`ids: [ ${JSON.stringify(t.getTypedIDs())} ]`:hl(t)?`${t.__marker} "${t.__number}"`:""}function Kw(){const[t]=ce();return m.jsx(tm,{viewClassName:"tree-view-output",treeTypeButtonClassName:"debug-treetype-button",timeTravelPanelClassName:"debug-timetravel-panel",timeTravelButtonClassName:"debug-timetravel-button",timeTravelPanelSliderClassName:"debug-timetravel-panel-slider",timeTravelPanelButtonClassName:"debug-timetravel-panel-button",customPrintNode:Ww,editor:t})}const Of=b.createContext(null),uu=4;function zw({children:t,className:e,onClick:n,title:r}){const s=b.useRef(null),i=b.useContext(Of);if(i===null)throw new Error("DropDownItem must be used within a DropDown");const{registerItem:o}=i;return b.useEffect(()=>{s&&s.current&&o(s)},[s,o]),m.jsx("button",{className:e,onClick:n,ref:s,title:r,type:"button",children:t})}function Jw({children:t,dropDownRef:e,onClose:n}){const[r,s]=b.useState(),[i,o]=b.useState(),a=b.useCallback(d=>{s(f=>f?[...f,d]:[d])},[s]),l=d=>{if(!r)return;const f=d.key;["Escape","ArrowUp","ArrowDown","Tab"].includes(f)&&d.preventDefault(),f==="Escape"||f==="Tab"?n():f==="ArrowUp"?o(h=>{if(!h)return r[0];const p=r.indexOf(h)-1;return r[p===-1?r.length-1:p]}):f==="ArrowDown"&&o(h=>h?r[r.indexOf(h)+1]:r[0])},u=b.useMemo(()=>({registerItem:a}),[a]);return b.useEffect(()=>{r&&!i&&o(r[0]),i&&i.current&&i.current.focus()},[r,i]),m.jsx(Of.Provider,{value:u,children:m.jsx("div",{className:"dropdown",ref:e,onKeyDown:l,children:t})})}function Vw({disabled:t=!1,buttonLabel:e,buttonAriaLabel:n,buttonClassName:r,buttonIconClassName:s,children:i,stopCloseOnClickSelf:o}){const a=b.useRef(null),l=b.useRef(null),[u,d]=b.useState(!1),f=()=>{d(!1),l&&l.current&&l.current.focus()};return b.useEffect(()=>{const h=l.current,p=a.current;if(u&&h!==null&&p!==null){const{top:y,left:k}=h.getBoundingClientRect();p.style.top=`${y+h.offsetHeight+uu}px`,p.style.left=`${Math.min(k,window.innerWidth-p.offsetWidth-20)}px`}},[a,l,u]),b.useEffect(()=>{const h=l.current;if(h!==null&&u){const p=y=>{const k=y.target;o&&a.current&&a.current.contains(k)||h.contains(k)||d(!1)};return document.addEventListener("click",p),()=>{document.removeEventListener("click",p)}}return()=>{}},[a,l,u,o]),b.useEffect(()=>{const h=()=>{if(u){const p=l.current,y=a.current;if(p!==null&&y!==null){const{top:k}=p.getBoundingClientRect(),C=k+p.offsetHeight+uu;C!==y.getBoundingClientRect().top&&(y.style.top=`${C}px`)}}};return document.addEventListener("scroll",h),()=>{document.removeEventListener("scroll",h)}},[l,a,u]),m.jsxs(m.Fragment,{children:[m.jsxs("button",{type:"button",disabled:t,"aria-label":n||e,className:r,onClick:()=>d(!u),ref:l,children:[s&&m.jsx("span",{className:s}),e&&m.jsx("span",{className:"text dropdown-button-text",children:e}),m.jsx("i",{className:"chevron-down"})]}),u&&At.createPortal(m.jsx(Jw,{dropDownRef:a,onClose:f,children:i}),document.body)]})}const Ra={m:"m - Paragraph - Margin - No First Line Indent",ms:"ms - Heading - Major Section Level 1",nb:"nb - Paragraph - No Break with Previous Paragraph",p:"p - Paragraph - Normal - First Line Indent",pi:"pi - Paragraph - Indented - Level 1 - First Line Indent",q1:"q1 - Poetry - Indent Level 1",q2:"q2 - Poetry - Indent Level 2",r:"r - Heading - Parallel References",s:"s - Heading - Section Level 1"},Pa={...Ra,ide:"ide - File - Encoding",h:"h - File - Header",h1:"h1 - File - Header",h2:"h2 - File - Left Header",h3:"h3 - File - Right Header",toc1:"toc1 - File - Long Table of Contents Text",toc2:"toc2 - File - Short Table of Contents Text",toc3:"toc3 - File - Book Abbreviation",cl:"cl - Chapter - Publishing Label",mt:"mt - Title - Major Title Level 1",mt1:"mt1 - Title - Major Title Level 1",mt2:"mt2 - Title - Major Title Level 2",mt3:"mt3 - Title - Major Title Level 3",mt4:"mt4 - Title - Major Title Level 4",ms1:"ms1 - Heading - Major Section Level 1",ms2:"ms2 - Heading - Major Section Level 2",ms3:"ms3 - Heading - Major Section Level 3",b:"b - Poetry - Stanza Break (Blank Line)"};function Gw({editorRef:t,blockMarker:e,disabled:n=!1}){return m.jsx(Vw,{disabled:n,buttonClassName:"toolbar-item block-controls",buttonIconClassName:"icon block-marker "+Yw(e),buttonLabel:Xw(e),buttonAriaLabel:"Formatting options for block type",children:Object.keys(Ra).map(r=>m.jsxs(zw,{className:"item block-marker "+Zw(e===r),onClick:()=>{var s;return(s=t.current)==null?void 0:s.formatPara(r)},children:[m.jsx("i",{className:"icon block-marker "+r}),m.jsx("span",{className:"text usfm_"+r,children:Ra[r]})]},r))})}function Yw(t){return t&&t in Pa?t:"ban"}function Xw(t){return t&&t in Pa?Pa[t]:"No Style"}function Zw(t){return t?"active dropdown-item-active":""}function du(){return m.jsx("div",{className:"divider"})}const Qw=b.forwardRef(function({editorRef:t,isReadonly:e=!1,onStateChange:n},r){const[s]=ce(),[i,o]=b.useState(s),[a,l]=b.useState(),[u,d]=b.useState(!1),[f,h]=b.useState(!1),p=b.useCallback(({canUndo:y,canRedo:k,blockMarker:C,contextMarker:M})=>{d(y),h(k),l(C),n==null||n({canUndo:y,canRedo:k,blockMarker:C,contextMarker:M})},[n]);return b.useEffect(()=>s.registerCommand(ms,(y,k)=>(o(k),!1),Zr),[s]),m.jsxs(m.Fragment,{children:[m.jsx(xf,{onStateChange:p}),m.jsxs("div",{className:"toolbar",children:[m.jsx("button",{disabled:!u||e,onClick:()=>{i.dispatchCommand(Fa,void 0)},title:la?"Undo (Z)":"Undo (Ctrl+Z)",type:"button",className:"toolbar-item spaced","aria-label":"Undo",children:m.jsx("i",{className:"format undo"})}),m.jsx("button",{disabled:!f||e,onClick:()=>{i.dispatchCommand(La,void 0)},title:la?"Redo (Y)":"Redo (Ctrl+Y)",type:"button",className:"toolbar-item","aria-label":"Redo",children:m.jsx("i",{className:"format redo"})}),m.jsx(du,{}),i===s&&m.jsxs(m.Fragment,{children:[m.jsx(Gw,{editorRef:t,blockMarker:a,disabled:e}),m.jsx(du,{})]}),m.jsx("div",{ref:r,className:"end-container"})]})]})}),hu={namespace:"platformEditor",theme:Ef,editable:!0,editorState:void 0,onError(t){throw t},nodes:[Fe,...mk]},ex=Or(),tx={},nx={};function rx(){return m.jsx("div",{className:"editor-placeholder",children:"Enter some Scripture..."})}const Mf=b.forwardRef(function({defaultUsj:t,scrRef:e,onScrRefChange:n,onSelectionChange:r,onUsjChange:s,onStateChange:i,options:o,logger:a,children:l},u){const d=b.useRef(null),f=b.useRef(null),h=b.useRef(null),p=b.useRef(t),y=b.useRef(),[k,C]=b.useState(t),[M,v]=b.useState(0),[O,I]=b.useState(),{isReadonly:D=!1,hasExternalUI:q=!1,hasSpellCheck:F=!1,textDirection:$="ltr",markerMenuTrigger:H="\\",view:W=ex,nodes:_=tx,debug:j=!1}=o??nx;hu.editable=!D,ia.initialize(a),b.useImperativeHandle(u,()=>({focus(){var E;(E=d.current)==null||E.focus()},undo(){var E;(E=d.current)==null||E.dispatchCommand(Fa,void 0)},redo(){var E;(E=d.current)==null||E.dispatchCommand(La,void 0)},cut(){var E;(E=d.current)==null||E.dispatchCommand(Fi,null)},copy(){var E;(E=d.current)==null||E.dispatchCommand(qi,null)},paste(){d.current&&El(d.current)},pastePlainText(){d.current&&Ol(d.current)},getUsj(){return p.current},setUsj(E){if(!Kt(p.current,E)){p.current=E;const A=Kt(k,E);C(E),A&&v(N=>N+1)}},applyUpdate(E,A="remote"){var N,L;(N=d.current)==null||N.update(()=>{A==="remote"&&jp(xa),Fk(E,W,_,a)},{discrete:!0});const U=(L=d.current)==null?void 0:L.getEditorState();if(!U)return;const B=ia.deserializeEditorState(U);if(B){const J=!Kt(p.current,B);if(J&&(p.current=B),J||!Kt(k,B)){const z=qc(E,U);s==null||s(B,E,A,z)}}},replaceEmbedUpdate(E,A){var N;const L=(N=d.current)==null?void 0:N.read(()=>H_(E,A));L&&this.applyUpdate(L)},getSelection(){var E;return(E=d.current)==null?void 0:E.read(rf)},setSelection(E){var A;(A=d.current)==null||A.update(()=>{const N=_l(E);N!==void 0&&dd(N)},{tag:Nh})},setAnnotation(E,A,N,L,U){var B;(B=f.current)==null||B.setAnnotation(E,Nc(A),N,L,U)},removeAnnotation(E,A){var N;(N=f.current)==null||N.removeAnnotation(Nc(E),A)},formatPara(E){var A;(A=d.current)==null||A.update(()=>{const N=re();X(N)&&Ap(N,()=>fs(E))})},getElementByKey(E){var A;return(A=d.current)==null?void 0:A.read(()=>{var N;return((N=d.current)==null?void 0:N.getElementByKey(E))??void 0})},insertNote(E,A,N){var L;(L=d.current)==null||L.update(()=>{const U=E_(E,A,N,e,W,_,a);U&&!U.getIsCollapsed()&&(y.current=U.getKey())})},selectNote(E){var A;(A=d.current)==null||A.update(()=>{const N=Lc(E);N&&(M_(N,W),N.getIsCollapsed()||(y.current=N.getKey()))})},getNoteOps(E){var A;return(A=d.current)==null?void 0:A.read(()=>{const N=Lc(E);if(N)return xl(N)})},get toolbarEndRef(){return h}}));const x=b.useCallback((E,A,N,L)=>{if(xb.some(B=>N.has(B)))return;const U=ia.deserializeEditorState(E);if(U){const B=!Kt(p.current,U);if(B&&(p.current=U),B||!Kt(k,U)){const J=N.has(xa)?"remote":"local",z=qc(L,E);s==null||s(U,L,J,z)}}},[k,s]),P=b.useCallback(E=>{I(E.contextMarker),i==null||i(E)},[i]);return m.jsxs(hd,{initialConfig:hu,children:[m.jsx(yv,{isEditable:!D}),m.jsxs("div",{className:"editor-container",children:[q?m.jsx(xf,{onStateChange:P}):m.jsx("div",{className:"editor-toolbar-container"+(D?"-readonly":"-editable"),children:m.jsx(Qw,{ref:h,editorRef:u,isReadonly:D,onStateChange:P})}),m.jsxs("div",{className:"editor-inner",children:[m.jsx(Rd,{editorRef:d}),m.jsx(Np,{contentEditable:m.jsx(pd,{className:`editor-input usfm ${Xv(W).join(" ")}`,spellCheck:F}),placeholder:m.jsx(rx,{}),ErrorBoundary:fd}),m.jsx(Dd,{}),e&&n&&m.jsx(Bw,{scrRef:e,onScrRefChange:n}),e&&m.jsx(Bv,{trigger:H,scrRef:e,contextMarker:O,getMarkerAction:(E,A)=>Iw(E,y,A,W)}),m.jsx(Uw,{options:{view:W,nodes:_},editedUsjRef:p,usj:k,setUsj:C}),m.jsx(bv,{scripture:k,nodeOptions:_,editorAdaptor:Ia,viewOptions:W,logger:a},M),m.jsx(jv,{onChange:r}),m.jsx(Dk,{onChange:x,ignoreSelectionChange:!0,ignoreHistoryMergeTagChange:!0}),m.jsx($k,{ref:f,logger:a}),m.jsx(tv,{viewOptions:W}),m.jsx(av,{}),m.jsx(dv,{}),m.jsx(hv,{logger:a}),m.jsx(mv,{}),m.jsx(_v,{expandedNoteKeyRef:y,nodeOptions:_,viewOptions:W,logger:a}),m.jsx(Nv,{}),m.jsx(Pv,{textDirection:$}),m.jsx(Dv,{}),l]}),j&&m.jsx(Kw,{})]})]})}),xs=b.forwardRef(function(t,e){const{children:n,...r}=t;return m.jsx(Mf,{ref:e,...r})});function Af(){return Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5)}function Di(t,e,n,r,s){return{author:e,content:t,deleted:s===void 0?!1:s,id:n===void 0?Af():n,timeStamp:r===void 0?performance.timeOrigin+performance.now():r,type:"comment"}}function jf(t,e,n){return{comments:e,id:n===void 0?Af():n,quote:t,type:"thread"}}function fu(t){return{comments:Array.from(t.comments),id:t.id,quote:t.quote,type:"thread"}}function sx(t){return{author:t.author,content:"[Deleted Comment]",deleted:!0,id:t.id,timeStamp:t.timeStamp,type:"comment"}}function oa(t){const e=t._changeListeners;for(const n of e)n()}class ix{constructor(e,n){K(this,"_editor"),K(this,"_comments"),K(this,"_changeListeners"),K(this,"_collabProvider"),K(this,"logger"),this._comments=[],this._editor=e,this.logger=n,this._collabProvider=null,this._changeListeners=new Set}isCollaborative(){return this._collabProvider!==null}getComments(){return this._comments}setComments(e){this._comments=e,oa(this)}addComment(e,n,r){const s=Array.from(this._comments),i=this._getCollabComments();if(n!==void 0&&e.type==="comment")for(let o=0;o<s.length;o++){const a=s[o];if(a.type==="thread"&&a.id===n.id){const l=fu(a);s.splice(o,1,l);const u=r!==void 0?r:l.comments.length;if(this.isCollaborative()&&i!==null){const d=i.get(o).get("comments");this._withRemoteTransaction(()=>{const f=this._createCollabSharedMap(e);d.insert(u,[f])})}l.comments.splice(u,0,e);break}}else{const o=r!==void 0?r:s.length;this.isCollaborative()&&i!==null&&this._withRemoteTransaction(()=>{const a=this._createCollabSharedMap(e);i.insert(o,[a])}),s.splice(o,0,e)}this._comments=s,oa(this)}deleteCommentOrThread(e,n){const r=Array.from(this._comments),s=this._getCollabComments();let i=null;if(n!==void 0)for(let o=0;o<r.length;o++){const a=r[o];if(a.type==="thread"&&a.id===n.id){const l=fu(a);r.splice(o,1,l);const u=l.comments;if(i=u.indexOf(e),this.isCollaborative()&&s!==null){const d=s.get(o).get("comments"),f=i;this._withRemoteTransaction(()=>{d.delete(f)})}u.splice(i,1);break}}else i=r.indexOf(e),this.isCollaborative()&&s!==null&&this._withRemoteTransaction(()=>{s.delete(i)}),r.splice(i,1);return this._comments=r,oa(this),e.type==="comment"?{index:i,markedComment:sx(e)}:null}registerOnChange(e){const n=this._changeListeners;return n.add(e),()=>{n.delete(e)}}_withRemoteTransaction(e){const n=this._collabProvider;n!==null&&n.doc.transact(e,this)}_withLocalTransaction(e){const n=this._collabProvider;try{this._collabProvider=null,e()}finally{this._collabProvider=n}}_getCollabComments(){const e=this._collabProvider;return e!==null?e.doc.get("comments",In):null}_createCollabSharedMap(e){const n=new ur,r=e.type,s=e.id;if(n.set("type",r),n.set("id",s),r==="comment")n.set("author",e.author),n.set("content",e.content),n.set("deleted",e.deleted),n.set("timeStamp",e.timeStamp);else{n.set("quote",e.quote);const i=new In;e.comments.forEach((o,a)=>{const l=this._createCollabSharedMap(o);i.insert(a,[l])}),n.set("comments",i)}return n}registerCollaboration(e){this._collabProvider=e;const n=this._getCollabComments(),r=()=>{e.connect()},s=()=>{try{e.disconnect()}catch{}},i=this._editor.registerCommand(hb,a=>{var l,u;return r!==void 0&&s!==void 0&&(a?((l=this.logger)==null||l.info("Comments connected!"),r()):((u=this.logger)==null||u.info("Comments disconnected!"),s())),!1},_r),o=(a,l)=>{if(l.origin!==this){for(const u of a)if(u instanceof kh){const d=u.target,f=u.delta;let h=0;for(const p of f){const y=p.insert,k=p.retain,C=p.delete,M=d.parent,v=d===n?void 0:M instanceof ur&&this._comments.find(O=>O.id===M.get("id"));if(Array.isArray(y)){const O=h;y.slice().reverse().forEach(I=>{const D=I.get("id"),q=I.get("type")==="thread"?jf(I.get("quote"),I.get("comments").toArray().map(F=>Di(F.get("content"),F.get("author"),F.get("id"),F.get("timeStamp"),F.get("deleted"))),D):Di(I.get("content"),I.get("author"),D,I.get("timeStamp"),I.get("deleted"));this._withLocalTransaction(()=>{this.addComment(q,v,O)})})}else if(typeof k=="number")h+=k;else if(typeof C=="number")for(let O=0;O<C;O++){const I=v===void 0||v===!1?this._comments[h]:v.comments[h];this._withLocalTransaction(()=>{this.deleteCommentOrThread(I,v)}),h++}}}}};return n===null?()=>null:(n.observeDeep(o),r(),()=>{n.unobserveDeep(o),i(),this._collabProvider=null})}}function ox(t){const[e,n]=b.useState(t.getComments());return b.useEffect(()=>t.registerOnChange(()=>{n(t.getComments())}),[t]),e}function ax({onClose:t,children:e,title:n,closeOnClickOutside:r}){const s=b.useRef(null);return b.useEffect(()=>{s.current!==null&&s.current.focus()},[]),b.useEffect(()=>{let i=null;const o=u=>{u.key==="Escape"&&t()},a=u=>{const d=u.target;s.current!==null&&!s.current.contains(d)&&r&&t()},l=s.current;return l!==null&&(i=l.parentElement,i!==null&&i.addEventListener("click",a)),window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o),i!==null&&(i==null||i.removeEventListener("click",a))}},[r,t]),m.jsx("div",{className:"Modal__overlay",role:"dialog",children:m.jsxs("div",{className:"Modal__modal",tabIndex:-1,ref:s,children:[m.jsx("h2",{className:"Modal__title",children:n}),m.jsx("button",{className:"Modal__closeButton","aria-label":"Close modal",type:"button",onClick:t,children:"X"}),m.jsx("div",{className:"Modal__content",children:e})]})})}function lx({onClose:t,children:e,title:n,closeOnClickOutside:r=!1}){return At.createPortal(m.jsx(ax,{onClose:t,title:n,closeOnClickOutside:r,children:e}),document.body)}function Nf(){const[t,e]=b.useState(null),n=b.useCallback(()=>{e(null)},[]),r=b.useMemo(()=>{if(t===null)return null;const{title:i,content:o,closeOnClickOutside:a}=t;return m.jsx(lx,{onClose:n,title:i,closeOnClickOutside:a,children:o})},[t,n]),s=b.useCallback((i,o,a=!1)=>{e({closeOnClickOutside:a,content:o(n),title:i})},[n]);return[r,s]}const cx={...Ef,paragraph:"CommentEditorTheme__paragraph"};function ux(...t){return t.filter(Boolean).join(" ")}function mn({"data-test-id":t,children:e,className:n,onClick:r,disabled:s,small:i,title:o}){return m.jsx("button",{disabled:s,className:ux("Button__root",s&&"Button__disabled",i&&"Button__small",n),onClick:r,title:o,"aria-label":o,...t&&{"data-test-id":t},children:e})}function dx({className:t}){return m.jsx(pd,{className:t||"ContentEditable__root"})}function hx({children:t,className:e}){return m.jsx("div",{className:e||"Placeholder__root",children:t})}const pu=qa("INSERT_INLINE_COMMAND");function fx({anchorKey:t,editor:e,showComments:n,onAddComment:r}){const s=b.useRef(null),i=b.useCallback(()=>{const o=s.current,a=e.getRootElement(),l=e.getElementByKey(t);if(o!==null&&a!==null&&l!==null){const{right:u}=a.getBoundingClientRect(),{top:d}=l.getBoundingClientRect();o.style.left=`${u-20}px`,o.style.top=`${d-30}px`}},[t,e]);return b.useEffect(()=>(window.addEventListener("resize",i),()=>{window.removeEventListener("resize",i)}),[e,i]),b.useLayoutEffect(()=>{i()},[t,e,n,i]),m.jsx("div",{className:"CommentPlugin_AddCommentBox",ref:s,children:m.jsx("button",{className:"CommentPlugin_AddCommentBox_button",onClick:r,children:m.jsx("i",{className:"icon add-comment"})})})}function px({onEscape:t}){const[e]=ce();return b.useEffect(()=>e.registerCommand(ld,n=>t(n),fi),[e,t]),null}function If({className:t,autoFocus:e,onEscape:n,onChange:r,editorRef:s,placeholder:i="Type a comment..."}){return m.jsx(hd,{initialConfig:{namespace:"Commenting",nodes:[],onError:o=>{throw o},theme:cx},children:m.jsxs("div",{className:"CommentPlugin_CommentInputBox_EditorContainer",children:[m.jsx(vm,{contentEditable:m.jsx(dx,{className:t}),placeholder:m.jsx(hx,{children:i}),ErrorBoundary:fd}),m.jsx(Up,{onChange:r}),m.jsx(Dd,{}),e!==!1&&m.jsx(Bp,{}),m.jsx(px,{onEscape:n}),m.jsx(Hp,{}),s!==void 0&&m.jsx(Rd,{editorRef:s})]})})}function Rf(t,e){return b.useCallback((n,r)=>{n.read(()=>{t(Fp()),e(!qp(r.isComposing(),!0))})},[e,t])}function gx({editor:t,cancelAddComment:e,submitAddComment:n}){const[r,s]=b.useState(""),[i,o]=b.useState(!1),a=b.useRef(null),l=b.useMemo(()=>({container:document.createElement("div"),elements:[]}),[]),u=b.useRef(null),d=$f(),f=b.useCallback(()=>{t.getEditorState().read(()=>{const k=re();if(X(k)){u.current=k.clone();const C=k.anchor,M=k.focus,v=Dp(t,C.getNode(),C.offset,M.getNode(),M.offset),O=a.current;if(v!==null&&O!==null){const{left:I,bottom:D,width:q}=v.getBoundingClientRect(),F=Lp(t,v);let $=F.length===1?I+q/2-125:I-125;$<10&&($=10),O.style.left=`${$}px`,O.style.top=`${D+20+(window.pageYOffset||document.documentElement.scrollTop)}px`;const H=F.length,{container:W}=l,_=l.elements,j=_.length;for(let x=0;x<H;x++){const P=F[x];let E=_[x];E===void 0&&(E=document.createElement("span"),_[x]=E,W.appendChild(E));const A=`position:absolute;top:${P.top+(window.pageYOffset||document.documentElement.scrollTop)}px;left:${P.left}px;height:${P.height}px;width:${P.width}px;background-color:rgba(255, 212, 0, 0.3);pointer-events:none;z-index:5;`;E.style.cssText=A}for(let x=j-1;x>=H;x--){const P=_[x];W.removeChild(P),_.pop()}}}})},[t,l]);b.useLayoutEffect(()=>{f();const k=l.container,C=document.body;return C!==null?(C.appendChild(k),()=>{C.removeChild(k)}):()=>{}},[l.container,f]),b.useEffect(()=>(window.addEventListener("resize",f),()=>{window.removeEventListener("resize",f)}),[f]);const h=k=>(k.preventDefault(),e(),!0),p=()=>{if(i){let k=t.getEditorState().read(()=>{const C=u.current;return C?C.getTextContent():""});k.length>100&&(k=k.slice(0,99)+""),n(jf(k,[Di(r,d)]),!0,void 0,u.current),u.current=null}},y=Rf(s,o);return m.jsxs("div",{className:"CommentPlugin_CommentInputBox",ref:a,children:[m.jsx(If,{className:"CommentPlugin_CommentInputBox_Editor",onEscape:h,onChange:y}),m.jsxs("div",{className:"CommentPlugin_CommentInputBox_Buttons",children:[m.jsx(mn,{onClick:e,className:"CommentPlugin_CommentInputBox_Button",children:"Cancel"}),m.jsx(mn,{onClick:p,disabled:!i,className:"CommentPlugin_CommentInputBox_Button primary",children:"Comment"})]})]})}function mx({submitAddComment:t,thread:e,placeholder:n}){const[r,s]=b.useState(""),[i,o]=b.useState(!1),a=b.useRef(null),l=$f(),u=Rf(s,o);return m.jsxs(m.Fragment,{children:[m.jsx(If,{className:"CommentPlugin_CommentsPanel_Editor",autoFocus:!1,onEscape:()=>!0,onChange:u,editorRef:a,placeholder:n}),m.jsx(mn,{className:"CommentPlugin_CommentsPanel_SendButton",onClick:()=>{if(i){t(Di(r,l),!1,e);const d=a.current;d!==null&&d.dispatchCommand(rd,void 0)}},disabled:!i,children:m.jsx("i",{className:"send"})})]})}function Pf({commentOrThread:t,deleteCommentOrThread:e,onClose:n,thread:r=void 0}){return m.jsxs(m.Fragment,{children:["Are you sure you want to delete this ",t.type,"?",m.jsxs("div",{className:"Modal__content",children:[m.jsx(mn,{onClick:()=>{e(t,r),n()},children:"Delete"})," ",m.jsx(mn,{onClick:()=>{n()},children:"Cancel"})]})]})}function gu({comment:t,deleteComment:e,thread:n,rtf:r}){const s=Math.round((t.timeStamp-(performance.timeOrigin+performance.now()))/1e3),i=Math.round(s/60),[o,a]=Nf();return m.jsxs("li",{className:"CommentPlugin_CommentsPanel_List_Comment",children:[m.jsxs("div",{className:"CommentPlugin_CommentsPanel_List_Details",children:[m.jsx("span",{className:"CommentPlugin_CommentsPanel_List_Comment_Author",children:t.author}),m.jsxs("span",{className:"CommentPlugin_CommentsPanel_List_Comment_Time",children:[" ",s>-10?"Just now":r.format(i,"minute")]})]}),m.jsx("p",{className:t.deleted?"CommentPlugin_CommentsPanel_DeletedComment":"",children:t.content}),!t.deleted&&m.jsxs(m.Fragment,{children:[m.jsx(mn,{onClick:()=>{a("Delete Comment",l=>m.jsx(Pf,{commentOrThread:t,deleteCommentOrThread:e,thread:n,onClose:l}))},className:"CommentPlugin_CommentsPanel_List_DeleteButton",children:m.jsx("i",{className:"delete"})}),o]})]})}function yx({activeIDs:t,comments:e,deleteCommentOrThread:n,listRef:r,submitAddComment:s,markNodeMap:i}){const[o]=ce(),[a,l]=b.useState(0),[u,d]=Nf(),f=b.useMemo(()=>new Intl.RelativeTimeFormat("en",{localeMatcher:"best fit",numeric:"auto",style:"short"}),[]);return b.useEffect(()=>{const h=setTimeout(()=>{l(a+1)},1e4);return()=>{clearTimeout(h)}},[a]),m.jsx("ul",{className:"CommentPlugin_CommentsPanel_List",ref:r,children:e.map(h=>{const p=h.id;return h.type==="thread"?m.jsxs("li",{onClick:()=>{const y=i.get(p);if(y!==void 0&&(t===null||t.indexOf(p)===-1)){const k=document.activeElement;o.update(()=>{const C=Array.from(y)[0],M=Te(C);Ee(M)&&M.selectStart()},{onUpdate(){k!==null&&k.focus()}})}},className:`CommentPlugin_CommentsPanel_List_Thread ${i.has(p)?"interactive":""} ${t.indexOf(p)===-1?"":"active"}`,children:[m.jsxs("div",{className:"CommentPlugin_CommentsPanel_List_Thread_QuoteBox",children:[m.jsxs("blockquote",{className:"CommentPlugin_CommentsPanel_List_Thread_Quote",children:["> ",m.jsx("span",{children:h.quote})]}),m.jsx(mn,{onClick:()=>{d("Delete Thread",y=>m.jsx(Pf,{commentOrThread:h,deleteCommentOrThread:n,onClose:y}))},className:"CommentPlugin_CommentsPanel_List_DeleteButton",children:m.jsx("i",{className:"delete"})}),u]}),m.jsx("ul",{className:"CommentPlugin_CommentsPanel_List_Thread_Comments",children:h.comments.map(y=>m.jsx(gu,{comment:y,deleteComment:n,thread:h,rtf:f},y.id))}),m.jsx("div",{className:"CommentPlugin_CommentsPanel_List_Thread_Editor",children:m.jsx(mx,{submitAddComment:s,thread:h,placeholder:"Reply to comment..."})})]},p):m.jsx(gu,{comment:h,deleteComment:n,rtf:f},p)})})}function bx({activeIDs:t,deleteCommentOrThread:e,comments:n,submitAddComment:r,markNodeMap:s}){const i=b.useRef(null),o=n.length===0;return m.jsxs("div",{className:"CommentPlugin_CommentsPanel",children:[m.jsx("h2",{className:"CommentPlugin_CommentsPanel_Heading",children:"Comments"}),o?m.jsx("div",{className:"CommentPlugin_CommentsPanel_Empty",children:"No Comments"}):m.jsx(yx,{activeIDs:t,comments:n,deleteCommentOrThread:e,listRef:i,submitAddComment:r,markNodeMap:s})]})}function $f(){const t=qd(),{yjsDocMap:e,name:n}=t;return e.has("comments")?n:"Scripture User"}function _x({providerFactory:t,setCommentStore:e,onChange:n,showCommentsContainerRef:r,commentContainerRef:s,logger:i}){const o=qd(),[a]=ce(),l=b.useMemo(()=>{const $=new ix(a,i);return n&&$.registerOnChange(n),e==null||e($),$},[a,i,n,e]),u=ox(l),d=b.useMemo(()=>new Map,[]),[f,h]=b.useState(),[p,y]=b.useState([]),[k,C]=b.useState(!1),[M,v]=b.useState(!1),{yjsDocMap:O}=o;b.useEffect(()=>{if(t){const $=t("comments",O);return l.registerCollaboration($)}return()=>{}},[l,t,O]);const I=b.useCallback(()=>{a.update(()=>{const $=re();$!==null&&($.dirty=!0)}),C(!1)},[a]),D=b.useCallback(($,H)=>{if($.type==="comment"){const W=l.deleteCommentOrThread($,H);if(!W)return;const{markedComment:_,index:j}=W;l.addComment(_,H,j)}else{l.deleteCommentOrThread($);const W=H!==void 0?H.id:$.id,_=d.get(W);_!==void 0&&setTimeout(()=>{a.update(()=>{for(const j of _){const x=Te(j);Ee(x)&&(x.deleteID(un,W),x.hasNoIDsForEveryType()&&ji(x))}})})}},[l,a,d]),q=b.useCallback(($,H,W,_)=>{l.addComment($,W),H&&(a.update(()=>{X(_)&&Qh(_,un,$.id)}),C(!1))},[l,a]);b.useEffect(()=>{const $=[];for(const H of p){const W=d.get(H);if(W!==void 0)for(const _ of W){const j=a.getElementByKey(_);j!==null&&(j.classList.add("selected"),$.push(j),v(!0))}}return()=>{for(const H of $)H.classList.remove("selected")}},[p,a,d]),b.useEffect(()=>{if(!a.hasNodes([Fe]))throw new Error("CommentPlugin: TypedMarkNode not registered on editor!");const $=new Map;return Xe(yd(a,Fe,H=>ps(H.getTypedIDs()),(H,W)=>{for(const[_,j]of Object.entries(H.getTypedIDs()))j.forEach(x=>{W.addID(_,x)})}),a.registerMutationListener(Fe,H=>{a.getEditorState().read(()=>{for(const[W,_]of H){const j=Te(W);let x=[];_==="destroyed"?x=$.get(W)??[]:Ee(j)&&(x=j.getTypedIDs()[un]??[]);for(const P of x){let E=d.get(P);$.set(W,x),_==="destroyed"?E!==void 0&&(E.delete(W),E.size===0&&d.delete(P)):(E===void 0&&(E=new Set,d.set(P,E)),E.has(W)||E.add(W))}}})},{skipInitialization:!1}),a.registerUpdateListener(({editorState:H,tags:W})=>{H.read(()=>{const _=re();let j=!1,x=!1;if(X(_)){const P=_.anchor.getNode();if(ee(P)){const E=p_(P,un,_.anchor.offset)??[];E!==null&&(y(E),j=!0),_.isCollapsed()||(h(P.getKey()),x=!0)}}j||y(P=>P.length===0?P:[]),x||h(null),!W.has("collaboration")&&X(_)&&C(!1)})}),a.registerCommand(pu,()=>{const H=window.getSelection();return H!==null&&H.removeAllRanges(),C(!0),!0},xe))},[a,d]);const F=()=>{a.dispatchCommand(pu,void 0)};return m.jsxs(m.Fragment,{children:[k&&At.createPortal(m.jsx(gx,{editor:a,cancelAddComment:I,submitAddComment:q}),document.body),f!=null&&!k&&At.createPortal(m.jsx(fx,{anchorKey:f,editor:a,showComments:M,onAddComment:F}),document.body),r!==null&&At.createPortal(m.jsx(mn,{className:`CommentPlugin_ShowCommentsButton ${M?"active":""}`,onClick:()=>v(!M),title:M?"Hide Comments":"Show Comments",children:m.jsx("i",{className:"comments"})}),(r==null?void 0:r.current)??document.body),M&&At.createPortal(m.jsx(bx,{comments:u,submitAddComment:q,deleteCommentOrThread:D,activeIDs:p,markNodeMap:d}),(s==null?void 0:s.current)??document.body)]})}function kx(){const t=b.useRef(void 0),e=b.useCallback(n=>{t.current=n},[]);return[t,e]}function vx(t,e){var n,r;const s=((n=e.current)==null?void 0:n.getComments())??[],i=s==null?void 0:s.map(a=>a.id),o=t.map(a=>{const l=i.findIndex(u=>u===a);return l!==void 0&&l>=0?s[l]:{comments:[{author:"unknown",content:"Comment not found",deleted:!1,id:"",timeStamp:0,type:"comment"}],id:a,quote:"",type:"thread"}});s.forEach(a=>{t.includes(a.id)||o.push(a)}),o&&((r=e.current)==null||r.setComments(o))}function wx(t,e){b.useEffect(()=>{var n;t.options??(t.options={}),(n=t.options).nodes??(n.nodes={}),t.options.nodes.addMissingComments=r=>{vx(r,e)}},[e,t])}b.forwardRef(function(t,e){const n=b.useRef(null),r=b.useRef(!0),s=b.useRef(null),[i,o]=b.useState(null),{children:a,onCommentChange:l,onUsjChange:u,showCommentsContainerRef:d,...f}=t,{logger:h,options:{isReadonly:p}={}}=t,[y,k]=kx();wx(f,y),b.useEffect(()=>{},[h]),b.useImperativeHandle(e,()=>({focus(){var v;(v=n.current)==null||v.focus()},undo(){var v;(v=n.current)==null||v.undo()},redo(){var v;(v=n.current)==null||v.redo()},cut(){var v;(v=n.current)==null||v.cut()},copy(){var v;(v=n.current)==null||v.copy()},paste(){var v;(v=n.current)==null||v.paste()},pastePlainText(){var v;(v=n.current)==null||v.pastePlainText()},getUsj(){var v;return(v=n.current)==null?void 0:v.getUsj()},setUsj(v){var O;(O=n.current)==null||O.setUsj(v)},applyUpdate(v,O){var I;(I=n.current)==null||I.applyUpdate(v,O)},replaceEmbedUpdate(v,O){var I;return(I=n.current)==null?void 0:I.replaceEmbedUpdate(v,O)},getSelection(){var v;return(v=n.current)==null?void 0:v.getSelection()},setSelection(v){var O;(O=n.current)==null||O.setSelection(v)},setAnnotation(v,O,I,D,q){var F;(F=n.current)==null||F.setAnnotation(v,O,I,D,q)},removeAnnotation(v,O){var I;(I=n.current)==null||I.removeAnnotation(v,O)},formatPara(v){var O;(O=n.current)==null||O.formatPara(v)},getElementByKey(v){var O;return(O=n.current)==null?void 0:O.getElementByKey(v)},insertNote(v,O,I){var D;(D=n.current)==null||D.insertNote(v,O,I)},selectNote(v){var O;(O=n.current)==null||O.selectNote(v)},getNoteOps(v){var O;return(O=n.current)==null?void 0:O.getNoteOps(v)},setComments(v){var O;(O=y.current)==null||O.setComments(v),r.current=!0},get toolbarEndRef(){return i}}));const C=b.useCallback((v,O,I,D)=>{var q;if(!u)return;const F=(q=y.current)==null?void 0:q.getComments();u(v,F,O,I,D)},[y,u]),M=b.useCallback(()=>{var v;if(!l||r.current){r.current=!1;return}const O=(v=y.current)==null?void 0:v.getComments();l(O)},[y,r,l]);return b.useEffect(()=>{var v;return o(((v=n.current)==null?void 0:v.toolbarEndRef)??null),()=>o(null)},[]),m.jsx(um,{children:m.jsxs(Mf,{ref:n,onUsjChange:C,...f,children:[m.jsx(_x,{setCommentStore:k,onChange:M,showCommentsContainerRef:p?null:d??i,commentContainerRef:s,logger:f.logger}),m.jsx("div",{ref:s,className:"comment-container"})]})})});const Df=b.memo(function({viewMode:e,description:n,children:r}){const s=e==="story",i=b.useMemo(()=>!s||typeof n!="string"||!n.trim()?null:m.jsxs(Yp,{className:"tw-w-full",children:[m.jsx(Xp,{className:"tw-pb-2",children:m.jsx(Zp,{className:"tw-text-sm tw-font-medium tw-text-muted-foreground",children:"Story Description"})}),m.jsx(Qp,{className:"tw-pt-2",children:m.jsx(Gp,{className:"tw-prose-sm tw-max-w-none tw-text-muted-foreground",markdown:n})})]}),[n,s]);return m.jsxs("div",{style:{display:"grid",gap:8},children:[r,i]})});Df.__docgenInfo={description:"",methods:[],displayName:"CanvasWithDescription",props:{viewMode:{required:!1,tsType:{name:"string"},description:""},description:{required:!1,tsType:{name:"string"},description:""},children:{required:!0,tsType:{name:"ReactNode"},description:""}}};const $a={m:"m - Paragraph - Margin - No First Line Indent",ms:"ms - Heading - Major Section Level 1",nb:"nb - Paragraph - No Break with Previous Paragraph",p:"p - Paragraph - Normal - First Line Indent",pi:"pi - Paragraph - Indented - Level 1 - First Line Indent",q1:"q1 - Poetry - Indent Level 1",q2:"q2 - Poetry - Indent Level 2",r:"r - Heading - Parallel References",s:"s - Heading - Section Level 1"},mu={...$a,ide:"ide - File - Encoding",h:"h - File - Header",h1:"h1 - File - Header",h2:"h2 - File - Left Header",h3:"h3 - File - Right Header",toc1:"toc1 - File - Long Table of Contents Text",toc2:"toc2 - File - Short Table of Contents Text",toc3:"toc3 - File - Book Abbreviation",cl:"cl - Chapter - Publishing Label",mt:"mt - Title - Major Title Level 1",mt1:"mt1 - Title - Major Title Level 1",mt2:"mt2 - Title - Major Title Level 2",mt3:"mt3 - Title - Major Title Level 3",mt4:"mt4 - Title - Major Title Level 4",ms1:"ms1 - Heading - Major Section Level 1",ms2:"ms2 - Heading - Major Section Level 2",ms3:"ms3 - Heading - Major Section Level 3",b:"b - Poetry - Stanza Break (Blank Line)"},yu={m:Hs,ms:tr,nb:Hs,p:Hs,pi:Hs,q1:qo,q2:qo,r:tr,s:tr,ide:Bt,h:Bt,h1:Bt,h2:Bt,h3:Bt,toc1:Bt,toc2:Bt,toc3:Bt,cl:Bt,mt:tr,mt1:tr,mt2:Ll,mt3:Fo,mt4:Fo,ms1:tr,ms2:Ll,ms3:Fo,b:qo};function bu({blockMarker:t,className:e}){const n=t&&t in yu?yu[t]:pg;return m.jsx(n,{className:e,size:16})}function Lf({editorRef:t,blockMarker:e}){return m.jsxs(Wa,{children:[m.jsx(Ka,{asChild:!0,children:m.jsxs(mt,{variant:"outline",className:"","aria-label":"Formatting options for block type",children:[m.jsx(bu,{blockMarker:e,className:"tw-me-2"}),xx(e),m.jsx(rg,{className:"tw-ms-2"})]})}),m.jsx(za,{children:Object.keys($a).map(n=>m.jsxs(ng,{className:`item block-marker ${Cx(e===n)}`,onClick:()=>{var r;return(r=t.current)==null?void 0:r.formatPara(n)},children:[m.jsx(bu,{blockMarker:n,className:"tw-me-2"}),m.jsx("span",{className:`text usfm_${n}`,children:$a[n]})]},n))})]})}function xx(t){return t&&t in mu?mu[t]:"No Style"}function Cx(t){return t?"active dropdown-item-active":""}Lf.__docgenInfo={description:"",methods:[],displayName:"BlockFormatDropDown",props:{editorRef:{required:!0,tsType:{name:"MutableRefObject",elements:[{name:"union",raw:"EditorRef | null",elements:[{name:"EditorRef"},{name:"null"}]}],raw:"MutableRefObject<EditorRef | null>"},description:""},blockMarker:{required:!0,tsType:{name:"union",raw:"string | undefined",elements:[{name:"string"},{name:"undefined"}]},description:""}}};const Sx={columns:{"platformScriptureEditor.edit":{label:"Edit",order:1},"platformScriptureEditor.insert":{label:"Insert",order:2}},groups:{"platformScriptureEditor.clipboard":{column:"platformScriptureEditor.edit",order:1},"platformScriptureEditor.insertNote":{column:"platformScriptureEditor.insert",order:1}},items:[{label:"Insert footnote",group:"platformScriptureEditor.insertNote",order:1,command:"platformScriptureEditor.insertFootnoteAtSelection",localizeNotes:""},{label:"Insert cross-reference",group:"platformScriptureEditor.insertNote",order:2,command:"platformScriptureEditor.insertCrossReferenceAtSelection",localizeNotes:""},{label:"Insert endnote",group:"platformScriptureEditor.insertNote",order:3,command:"platformScriptureEditor.insertEndnoteAtSelection",localizeNotes:""},{label:"Cut",group:"platformScriptureEditor.clipboard",order:1,command:"platformScriptureEditor.cut",localizeNotes:""},{label:"Copy",group:"platformScriptureEditor.clipboard",order:2,command:"platformScriptureEditor.copy",localizeNotes:""},{label:"Paste",group:"platformScriptureEditor.clipboard",order:3,command:"platformScriptureEditor.paste",localizeNotes:""},{label:"Paste as plain text",group:"platformScriptureEditor.clipboard",order:4,command:"platformScriptureEditor.pastePlainText",localizeNotes:""}]};function Ff({editorRef:t,scrRef:e,onScrRefChange:n,isReadonly:r=!1,canUndo:s=!1,canRedo:i=!1,blockMarker:o}){const a=()=>{var h;(h=t.current)==null||h.insertNote("f")},l=()=>{var h;(h=t.current)==null||h.insertNote("x")},u=()=>{var h;(h=t.current)==null||h.insertNote("fe")},d=h=>{var p,y,k,C;switch(h.command){case"platformScriptureEditor.insertFootnoteAtSelection":a();break;case"platformScriptureEditor.insertCrossReferenceAtSelection":l();break;case"platformScriptureEditor.insertEndnoteAtSelection":u();break;case"platformScriptureEditor.cut":(p=t.current)==null||p.cut();break;case"platformScriptureEditor.copy":(y=t.current)==null||y.copy();break;case"platformScriptureEditor.paste":(k=t.current)==null||k.paste();break;case"platformScriptureEditor.pastePlainText":(C=t.current)==null||C.pastePlainText();break;default:throw new Error(`Unknown onSelectProjectMenuItem command: ${h.command}`)}},f=()=>{};return m.jsx(tg,{onSelectProjectMenuItem:d,onSelectViewInfoMenuItem:f,projectMenuData:Sx,className:"toolbar",startAreaChildren:m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"tw-flex tw-h-full tw-items-center",children:m.jsx(eg,{scrRef:e,handleSubmit:n})}),!r&&m.jsxs(m.Fragment,{children:[m.jsx(mt,{"aria-label":"Undo",title:"Undo",variant:"ghost",size:"icon",onClick:()=>{var h;return(h=t.current)==null?void 0:h.undo()},disabled:!s,children:m.jsx(jg,{})}),m.jsx(mt,{"aria-label":"Redo",title:"Redo",variant:"ghost",size:"icon",onClick:()=>{var h;return(h=t.current)==null?void 0:h.redo()},disabled:!i,children:m.jsx(vg,{})}),m.jsx(Lf,{editorRef:t,blockMarker:o}),m.jsx(mt,{"aria-label":"Insert footnote",title:"Insert footnote",variant:"ghost",size:"icon",onClick:a,children:m.jsx(Og,{})}),m.jsx(mt,{"aria-label":"Insert cross-reference",title:"Insert cross-reference",variant:"ghost",size:"icon",onClick:l,children:m.jsx(xg,{})}),m.jsx(mt,{"aria-label":"Insert endnote",title:"Insert endnote",variant:"ghost",size:"icon",onClick:u,children:m.jsx(_g,{})})]})]})})}Ff.__docgenInfo={description:"",methods:[],displayName:"PlatformToolbar",props:{editorRef:{required:!0,tsType:{name:"RefObject",elements:[{name:"union",raw:"EditorRef | null",elements:[{name:"EditorRef"},{name:"null"}]}],raw:"RefObject<EditorRef | null>"},description:""},scrRef:{required:!0,tsType:{name:"SerializedVerseRef"},description:""},onScrRefChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(scrRef: SerializedVerseRef) => void",signature:{arguments:[{type:{name:"SerializedVerseRef"},name:"scrRef"}],return:{name:"void"}}},description:""},isReadonly:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},canUndo:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},canRedo:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},blockMarker:{required:!1,tsType:{name:"string"},description:""}}};function Hn(t,e,n){var h,p,y,k;const r=b.useRef(null),[s,i]=b.useState(n),[o,a]=b.useState(!1),[l,u]=b.useState(!1),[d,f]=b.useState();return m.jsxs(Df,{viewMode:e.viewMode,description:((y=(p=(h=e.parameters)==null?void 0:h.docs)==null?void 0:p.description)==null?void 0:y.story)??((k=e.parameters)==null?void 0:k.description),children:[m.jsx(Ff,{editorRef:r,scrRef:s,onScrRefChange:i,isReadonly:!1,canUndo:o,canRedo:l,blockMarker:d}),m.jsx(xs,{...t,ref:r,scrRef:s,onScrRefChange:i,onStateChange:({canUndo:C,canRedo:M,blockMarker:v})=>{a(C),u(M),f(v)}})]})}Hn.__docgenInfo={description:`Render function that combines the Editorial component with a PlatformToolbar. This provides a
complete editing experience with undo/redo, navigation, and other toolbar features.

Use this as a render function in a Storybook story, not as a component.`,methods:[],displayName:"renderEditorialWithToolbar"};const Tx='<usx version="3.1" />',Ex=Da(Tx),Ox=`<?xml version="1.0" encoding="utf-8"?>
<usx version="3.1">
  <book code="PSA" style="id">World English Bible (WEB)</book>
  <para style="mt1">The Psalms</para>
  <chapter number="1" style="c" sid="PSA 1" />
  <para style="q1">
    <verse number="1" style="v" sid="PSA 1:1" />Blessed is the man who doesnt walk in the counsel of the wicked<note caller="+" style="f"><char style="fr">1:1 </char><char style="ft">Or "sinful"</char></note>,</para>
  <para style="q2" vid="PSA 1:1">nor stand on the path<note caller="+" style="f"><char style="fr">1:1 </char><char style="ft">Hebrew: "way"</char></note> of sinners,</para>
  <para style="q2" vid="PSA 1:1">nor sit in the seat of scoffers;<verse eid="PSA 1:1" /></para>
  <para style="q1">
    <verse number="2" style="v" sid="PSA 1:2" /><note caller="+" style="f"><char style="fr" closed="false">1:2 </char><char style="ft" closed="false">After verse</char></note> but his delight is in Yahwehs<note caller="+" style="f"><char style="fr" closed="false">1:2 </char><char style="ft" closed="false">Yahweh is Gods proper Name, sometimes rendered LORD (all caps) in other translations.</char></note> law.<note caller="+" style="f"><char style="fr" closed="false">1:2 </char><char style="ft" closed="false">End of Para</char></note></para>
  <para style="q2" vid="PSA 1:2">On his law he meditates day and night.<note caller="+" style="f"><char style="fr" closed="false">1:2 </char><char style="ft" closed="false">End of Doc</char></note><verse eid="PSA 1:2" /></para>
</usx>
`,tn=Da(Ox),Mx={start:{jsonPath:"$.content[3].content[1]",offset:15},end:{jsonPath:"$.content[3].content[1]",offset:18}},Ax={start:{jsonPath:"$.content[3].content[1]",offset:15},end:{jsonPath:"$.content[3].content[1]",offset:22}},jx=`<?xml version="1.0" encoding="utf-8"?>
<usx version="3.1">
  <book code="PSA" style="id"></book>
  <para style="mt1"></para>
  <chapter number="1" style="c" sid="PSA 1" />
  <para style="q1">
    <verse number="1" style="v" sid="PSA 1:1" />      ,</para>
  <para style="q2" vid="PSA 1:1">   ,</para>
  <para style="q2" vid="PSA 1:1">   .<verse eid="PSA 1:1" /></para>
  <para style="q1">
    <verse number="2" style="v" sid="PSA 1:2" />    ,</para>
  <para style="q2" vid="PSA 1:2">   .<verse eid="PSA 1:2" /></para>
</usx>
`,Nx=Da(jx),Ix=(t,e,n)=>t==="generated"?m.jsxs(m.Fragment,{children:[m.jsx("p",{children:"+"})," ",e["%footnoteEditor_callerDropdown_item_generated%"]]}):t==="hidden"?m.jsxs(m.Fragment,{children:[m.jsx("p",{children:"-"})," ",e["%footnoteEditor_callerDropdown_item_hidden%"]]}):m.jsxs(m.Fragment,{children:[m.jsx("p",{children:n})," ",e["%footnoteEditor_callerDropdown_item_custom%"]]});function qf({callerType:t,updateCallerType:e,customCaller:n,updateCustomCaller:r,localizedStrings:s}){const i=b.useRef(null),o=b.useRef(null),a=b.useRef(!1),[l,u]=b.useState(t),[d,f]=b.useState(n),[h,p]=b.useState(!1);b.useEffect(()=>{u(t)},[t]),b.useEffect(()=>{d!==n&&f(n)},[n]);const y=C=>{a.current=!1,p(C),C||(l!=="custom"||d?(e(l),r(d)):(u(t),f(n)))},k=C=>{var M,v,O,I;C.stopPropagation(),document.activeElement===o.current&&C.key==="ArrowDown"||C.key==="ArrowRight"?((M=i.current)==null||M.focus(),a.current=!0):document.activeElement===i.current&&C.key==="ArrowUp"?((v=o.current)==null||v.focus(),a.current=!1):document.activeElement===i.current&&C.key==="ArrowLeft"&&((O=i.current)==null?void 0:O.selectionStart)===0&&((I=o.current)==null||I.focus(),a.current=!1),l==="custom"&&C.key==="Enter"&&(document.activeElement===o.current||document.activeElement===i.current)&&y(!1)};return m.jsxs(Wa,{open:h,onOpenChange:y,children:[m.jsx(Qr,{children:m.jsxs(es,{children:[m.jsx(pi,{asChild:!0,children:m.jsx(Ka,{asChild:!0,children:m.jsx(mt,{variant:"outline",className:"tw-h-6",children:Ix(t,s,n)})})}),m.jsx(ts,{children:s["%footnoteEditor_callerDropdown_tooltip%"]})]})}),m.jsxs(za,{className:"tw-z-[300]",onClick:()=>{a.current&&(a.current=!1)},onKeyDown:k,onMouseMove:()=>{var C;a.current&&((C=i.current)==null||C.focus())},children:[m.jsx(bd,{children:s["%footnoteEditor_callerDropdown_label%"]}),m.jsx(_d,{}),m.jsx(sr,{checked:l==="generated",onCheckedChange:()=>u("generated"),children:m.jsxs("div",{className:"tw-flex tw-w-full tw-justify-between",children:[m.jsx("span",{children:s["%footnoteEditor_callerDropdown_item_generated%"]}),m.jsx("span",{className:"tw-w-10 tw-text-center",children:Pt})]})}),m.jsx(sr,{checked:l==="hidden",onCheckedChange:()=>u("hidden"),children:m.jsxs("div",{className:"tw-flex tw-w-full tw-justify-between",children:[m.jsx("span",{children:s["%footnoteEditor_callerDropdown_item_hidden%"]}),m.jsx("span",{className:"tw-w-10 tw-text-center",children:fr})]})}),m.jsx(sr,{ref:o,checked:l==="custom",onCheckedChange:()=>u("custom"),onClick:C=>{var M;C.stopPropagation(),a.current=!0,(M=i.current)==null||M.focus()},onSelect:C=>C.preventDefault(),children:m.jsxs("div",{className:"tw-flex tw-w-full tw-justify-between",children:[m.jsx("span",{children:s["%footnoteEditor_callerDropdown_item_custom%"]}),m.jsx(ig,{tabIndex:0,onMouseDown:C=>{C.stopPropagation(),u("custom"),a.current=!0},ref:i,className:"tw-h-auto tw-w-10 tw-p-0 tw-text-center",value:d,onKeyDown:C=>{C.key==="Enter"||C.key==="ArrowUp"||C.key==="ArrowDown"||C.key==="ArrowLeft"||C.key==="ArrowRight"||C.stopPropagation()},maxLength:1,onChange:C=>f(C.target.value)})]})})]})]})}qf.__docgenInfo={description:"",methods:[],displayName:"FootnoteCallerDropdown",props:{callerType:{required:!0,tsType:{name:"union",raw:"'generated' | 'hidden' | 'custom'",elements:[{name:"literal",value:"'generated'"},{name:"literal",value:"'hidden'"},{name:"literal",value:"'custom'"}]},description:"The caller type value to pass to the dropdown"},updateCallerType:{required:!0,tsType:{name:"signature",type:"function",raw:"(newCallerType: FootnoteCallerType) => void",signature:{arguments:[{type:{name:"union",raw:"'generated' | 'hidden' | 'custom'",elements:[{name:"literal",value:"'generated'"},{name:"literal",value:"'hidden'"},{name:"literal",value:"'custom'"}]},name:"newCallerType"}],return:{name:"void"}}},description:"Function to update the caller type"},customCaller:{required:!0,tsType:{name:"string"},description:"The custom caller to pass to the custom caller input field"},updateCustomCaller:{required:!0,tsType:{name:"signature",type:"function",raw:"(newCustomCaller: string) => void",signature:{arguments:[{type:{name:"string"},name:"newCustomCaller"}],return:{name:"void"}}},description:"FUnction to update the custom caller"},localizedStrings:{required:!0,tsType:{name:"signature",type:"object",raw:`{
  [localizedKey in (typeof FOOTNOTE_EDITOR_STRING_KEYS)[number]]?: string;
}`,signature:{properties:[{key:{name:"unknown[number]",raw:"(typeof FOOTNOTE_EDITOR_STRING_KEYS)[number]",required:!1},value:{name:"string"}}]}},description:"Localized strings from the parent component"}}};const Rx=(t,e)=>t==="f"?m.jsxs(m.Fragment,{children:[m.jsx(kd,{})," ",e["%footnoteEditor_noteType_footnote_label%"]]}):t==="fe"?m.jsxs(m.Fragment,{children:[m.jsx(vd,{})," ",e["%footnoteEditor_noteType_endNote_label%"]]}):m.jsxs(m.Fragment,{children:[m.jsx(wd,{})," ",e["%footnoteEditor_noteType_crossReference_label%"]]}),Px=(t,e)=>{if(t==="x")return e["%footnoteEditor_noteType_crossReference_label%"];let n=e["%footnoteEditor_noteType_endNote_label%"];return t==="f"&&(n=e["%footnoteEditor_noteType_footnote_label%"]),Wp(e["%footnoteEditor_noteType_tooltip%"]??"",{noteType:n})};function Uf({noteType:t,handleNoteTypeChange:e,localizedStrings:n,isTypeSwitchable:r}){return m.jsxs(Wa,{children:[m.jsx(Qr,{children:m.jsxs(es,{children:[m.jsx(sg,{asChild:!0,children:m.jsx(Ka,{asChild:!0,children:m.jsx(mt,{variant:"outline",className:"tw-h-6",children:Rx(t,n)})})}),m.jsx(ts,{children:m.jsx("p",{children:Px(t,n)})})]})}),m.jsxs(za,{className:"tw-z-[300]",children:[m.jsx(bd,{children:n["%footnoteEditor_noteTypeDropdown_label%"]}),m.jsx(_d,{}),m.jsxs(sr,{disabled:t!=="x"&&!r,checked:t==="x",onCheckedChange:()=>e("x"),className:"tw-gap-2",children:[m.jsx(wd,{}),m.jsx("span",{children:n["%footnoteEditor_noteType_crossReference_label%"]})]}),m.jsxs(sr,{disabled:t==="x"&&!r,checked:t==="f",onCheckedChange:()=>e("f"),className:"tw-gap-2",children:[m.jsx(kd,{}),m.jsx("span",{children:n["%footnoteEditor_noteType_footnote_label%"]})]}),m.jsxs(sr,{disabled:t==="x"&&!r,checked:t==="fe",onCheckedChange:()=>e("fe"),className:"tw-gap-2",children:[m.jsx(vd,{}),m.jsx("span",{children:n["%footnoteEditor_noteType_endNote_label%"]})]})]})]})}Uf.__docgenInfo={description:"",methods:[],displayName:"FootnoteTypeDropdown",props:{noteType:{required:!0,tsType:{name:"string"},description:""},handleNoteTypeChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(newNoteType: string) => void",signature:{arguments:[{type:{name:"string"},name:"newNoteType"}],return:{name:"void"}}},description:""},localizedStrings:{required:!0,tsType:{name:"signature",type:"object",raw:`{
  [localizedKey in (typeof FOOTNOTE_EDITOR_STRING_KEYS)[number]]?: string;
}`,signature:{properties:[{key:{name:"unknown[number]",raw:"(typeof FOOTNOTE_EDITOR_STRING_KEYS)[number]",required:!1},value:{name:"string"}}]}},description:""},isTypeSwitchable:{required:!0,tsType:{name:"boolean"},description:""}}};function $x(t){var n;const e=(n=t.attributes)==null?void 0:n.char;e.style&&(e.style==="ft"&&(e.style="xt"),e.style==="fr"&&(e.style="xo"),e.style==="fq"&&(e.style="xq"))}function Dx(t){var n;const e=(n=t.attributes)==null?void 0:n.char;e.style&&(e.style==="xt"&&(e.style="ft"),e.style==="xo"&&(e.style="fr"),e.style==="xq"&&(e.style="fq"))}const Lx={type:"USJ",version:"3.1",content:[{type:"para"}]};function Bf({classNameForEditor:t,noteOps:e,onSave:n,onClose:r,scrRef:s,noteKey:i,editorOptions:o,localizedStrings:a}){const l=b.useRef(null),u=b.createRef(),[d,f]=b.useState("generated"),[h,p]=b.useState("*"),[y,k]=b.useState("f"),[C,M]=b.useState(!1),v=b.useMemo(()=>({...o,markerMenuTrigger:o.markerMenuTrigger??"\\",hasExternalUI:!0,view:{...o.view??Or(),noteMode:"expanded"}}),[o]);b.useEffect(()=>{var F;(F=l.current)==null||F.focus()}),b.useEffect(()=>{var H,W;let F;const $=e==null?void 0:e.at(0);if($&&et("note",$)){const _=(H=$.insert.note)==null?void 0:H.caller;let j="custom";_===Pt?j="generated":_===fr?j="hidden":_&&p(_),f(j),k(((W=$.insert.note)==null?void 0:W.style)??"f"),F=setTimeout(()=>{var x;(x=l.current)==null||x.applyUpdate([$])},0)}return()=>{F&&clearTimeout(F)}},[e,i]);const O=b.useCallback(()=>{var $,H;const F=(H=($=l.current)==null?void 0:$.getNoteOps(0))==null?void 0:H.at(0);F&&et("note",F)&&(F.insert.note&&(d==="custom"?F.insert.note.caller=h:F.insert.note.caller=d==="generated"?Pt:fr),n([F]))},[d,h,n]),I=()=>{var $;const F=($=u.current)==null?void 0:$.getElementsByClassName("editor-input")[0];F!=null&&F.textContent&&navigator.clipboard.writeText(F.textContent)},D=F=>{var H,W,_,j,x;k(F);const $=(W=(H=l.current)==null?void 0:H.getNoteOps(0))==null?void 0:W.at(0);if($&&et("note",$)){$.insert.note&&($.insert.note.style=F);const P=(j=(_=$.insert.note)==null?void 0:_.contents)==null?void 0:j.ops;y!=="x"&&F==="x"?P==null||P.forEach(E=>$x(E)):y==="x"&&F!=="x"&&(P==null||P.forEach(E=>Dx(E))),(x=l.current)==null||x.applyUpdate([$,{delete:1}])}},q=F=>{var H,W,_,j,x;const $=(W=(H=l.current)==null?void 0:H.getNoteOps(0))==null?void 0:W.at(0);if($&&et("note",$)){F.content.length>1&&setTimeout(()=>{var A;(A=l.current)==null||A.applyUpdate([{retain:2},{delete:1}])},0);const P=(_=$.insert.note)==null?void 0:_.style,E=(x=(j=$.insert.note)==null?void 0:j.contents)==null?void 0:x.ops;P||M(!1),M(P==="x"?!!(E!=null&&E.every(A=>{var L,U;if(!((L=A.attributes)!=null&&L.char))return!0;const N=((U=A.attributes)==null?void 0:U.char).style;return N==="xt"||N==="xo"||N==="xq"})):!!(E!=null&&E.every(A=>{var L,U;if(!((L=A.attributes)!=null&&L.char))return!0;const N=((U=A.attributes)==null?void 0:U.char).style;return N==="ft"||N==="fr"||N==="fq"})))}else M(!1)};return m.jsxs("div",{className:"footnote-editor tw-grid tw-gap-[12px]",children:[m.jsxs("div",{className:"tw-flex",children:[m.jsxs("div",{className:"tw-flex tw-gap-4",children:[m.jsx(Uf,{isTypeSwitchable:C,noteType:y,handleNoteTypeChange:D,localizedStrings:a}),m.jsx(qf,{callerType:d,updateCallerType:f,customCaller:h,updateCustomCaller:p,localizedStrings:a})]}),m.jsxs("div",{className:"tw-flex tw-w-full tw-justify-end tw-gap-4",children:[m.jsx(Qr,{children:m.jsxs(es,{children:[m.jsx(pi,{asChild:!0,children:m.jsx(mt,{onClick:r,className:"tw-h-6 tw-w-6",size:"icon",variant:"secondary",children:m.jsx(og,{})})}),m.jsx(ts,{children:m.jsx("p",{children:a["%footnoteEditor_cancelButton_tooltip%"]})})]})}),m.jsx(Qr,{children:m.jsxs(es,{children:[m.jsx(pi,{asChild:!0,children:m.jsx(mt,{onClick:O,className:"tw-h-6 tw-w-6",size:"icon",variant:"default",children:m.jsx(ag,{})})}),m.jsx(ts,{children:a["%footnoteEditor_saveButton_tooltip%"]})]})})]})]}),m.jsxs("div",{ref:u,className:"tw-relative tw-rounded-[6px] tw-border-2 tw-border-ring",children:[m.jsx("div",{className:t,children:m.jsx(xs,{options:v,onUsjChange:q,defaultUsj:Lx,onScrRefChange:()=>{},scrRef:s,ref:l})}),m.jsx("div",{className:"tw-absolute tw-bottom-0 tw-right-0",children:m.jsx(Qr,{children:m.jsxs(es,{children:[m.jsx(pi,{asChild:!0,children:m.jsx(mt,{onClick:I,className:"tw-h-6 tw-w-6",variant:"ghost",size:"icon",children:m.jsx(lg,{})})}),m.jsx(ts,{children:m.jsx("p",{children:a["%footnoteEditor_copyButton_tooltip%"]})})]})})})]})]})}Bf.__docgenInfo={description:`Component to edit footnotes from within the editor component

@param FootnoteEditorProps - The properties for the footnote editor component`,methods:[],displayName:"FootnoteEditor",props:{classNameForEditor:{required:!1,tsType:{name:"string"},description:"Class name for styling the embedded `Editor` component in this editor popover"},noteOps:{required:!0,tsType:{name:"union",raw:"DeltaOpInsertNoteEmbed[] | undefined",elements:[{name:"Array",elements:[{name:"DeltaOpInsertNoteEmbed"}],raw:"DeltaOpInsertNoteEmbed[]"},{name:"undefined"}]},description:"Delta ops for the current note being edited that are applied to the note editorial"},onSave:{required:!0,tsType:{name:"signature",type:"function",raw:"(noteOps: DeltaOpInsertNoteEmbed[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"DeltaOpInsertNoteEmbed"}],raw:"DeltaOpInsertNoteEmbed[]"},name:"noteOps"}],return:{name:"void"}}},description:"External function to handle saving changes to the footnote"},onClose:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:`External function to handle closing the footnote editor. Gets called when the editor is closed
without saving changes`},scrRef:{required:!0,tsType:{name:"SerializedVerseRef"},description:"The scripture reference for the parent editor"},noteKey:{required:!0,tsType:{name:"union",raw:"string | undefined",elements:[{name:"string"},{name:"undefined"}]},description:"The unique note key to identify the note being edited used to apply changes to the note"},editorOptions:{required:!0,tsType:{name:"EditorOptions"},description:"View options of the parent editor"},localizedStrings:{required:!0,tsType:{name:"signature",type:"object",raw:`{
  [localizedKey in (typeof FOOTNOTE_EDITOR_STRING_KEYS)[number]]?: string;
}`,signature:{properties:[{key:{name:"unknown[number]",raw:"(typeof FOOTNOTE_EDITOR_STRING_KEYS)[number]",required:!1},value:{name:"string"}}]}},description:"Localized strings to be passed to the footnote editor component"}}};const it={book:"PSA",chapterNum:1,verseNum:1},ZC={title:"Demo/Editorial",component:xs,tags:["autodocs"],parameters:{docs:{description:{component:`
**Demo Only:** This component is provided for demonstration purposes only. For production applications, developers should import the Scripture Editor component directly from:
- npm [@eten-tech-foundation/platform-editor](https://www.npmjs.com/package/@eten-tech-foundation/platform-editor)
- github [eten-tech-foundation/platform-editor](https://github.com/eten-tech-foundation/scripture-editors/tree/main/packages/platform)

This demo version is included in Storybook to showcase the component's functionality and usage patterns.

**Known Limitation:** In the Docs view, all story examples may show the same note caller style due to global state management in the editor component. To see the correct note caller behavior for each story (default lowercase letters vs custom symbols), please view the individual stories in the Canvas view instead of the Docs view.
        `}}},argTypes:{ref:{control:"object",description:"Reference to the editor instance",defaultValue:null},defaultUsj:{control:"object",description:"Default USJ object to initialize the editor with",defaultValue:{type:ss,version:is,content:[""]}},scrRef:{control:"object",description:"Scripture reference",defaultValue:it},options:{control:"object",description:"Options to configure the editor (EditorOptions)",defaultValue:{},table:{type:{summary:"EditorOptions",detail:'{ isReadonly?: boolean; hasSpellCheck?: boolean; textDirection?: "ltr" | "rtl" | "auto"; markerMenuTrigger?: string; nodes?: UsjNodeOptions; }'}}}}},ti={args:{defaultUsj:tn,scrRef:it}},ni={args:{defaultUsj:Ex,scrRef:it}},ri={args:{defaultUsj:tn,scrRef:it,options:{isReadonly:!0}}},si={render:(t,e)=>Hn(t,e,it),parameters:{docs:{description:{story:'Right-to-left example using a Hebrew snippet (Psalm 1:1). The editor is set to RTL via _options.textDirection = "rtl"_. If you want the UI (tab toolbar) to be RTL click **Switch direction** in the Storybook toolbar.'}}},args:{defaultUsj:Nx,options:{hasExternalUI:!0,textDirection:"rtl"}}};function _u(t,e,n,r){console.log("handleAnnotationOnClick",{event:t,type:e,id:n,textContent:r})}function ku(t,e,n,r){console.log("handleAnnotationOnRemove",{type:t,id:e,cause:n,textContent:r})}const ii={render:t=>{const e=b.useRef(null);return b.useEffect(()=>{const n=setTimeout(()=>{e.current&&(e.current.setAnnotation(Mx,"spelling","annotationId",_u,ku),e.current.setAnnotation(Ax,"grammar","abc123",_u,ku))},0);return()=>clearTimeout(n)},[]),m.jsx(xs,{...t,ref:e})},args:{defaultUsj:tn,scrRef:it}},Fx={hasExternalUI:!0,view:{...Or(),noteMode:"expandInline"},nodes:{noteCallerOnClick:(t,e,n,r,s)=>{n||(r()===Pt?s(fr):s(Pt))}}},oi={render:(t,e)=>Hn(t,e,it),parameters:{docs:{description:{story:"This story demonstrates editing notes inline. Move your cursor to a note caller and the note will expand and can be edited. Move the cursor out of the note and it will collapse. Click the expanded note caller to toggle between the auto-generated caller and the hidden caller."}}},args:{defaultUsj:tn,options:Fx}},qx={hasExternalUI:!0,view:{...Or(),noteMode:"expandInline"}},ai={render:(t,e)=>Hn(t,e,it),parameters:{docs:{description:{story:'This story demonstrates inserting notes. Use the Project menu (hamburger) or the toolbar buttons above the editor to insert footnotes, cross-references, and endnotes at the current cursor position. Selecting text before inserting a footnote will use that text as the footnote quote. You can also insert by typing "\\f", "\\x", or "\\fe".'}}},args:{defaultUsj:tn,options:qx}},Ux={hasExternalUI:!0,nodes:{noteCallers:["","","","","","","","","",""],noteCallerOnClick:(t,e,n,r,s,i)=>{console.log("Note caller clicked:",t,e,n,r,s,i),alert("Note caller clicked! Check console for details.")}}},li={render:(t,e)=>Hn(t,e,it),parameters:{docs:{description:{story:"This story demonstrates custom note callers and click handling. **Try clicking on the circled number footnote markers ( ) in the text to see the click handler in action!** The click event will show an alert and log details to the browser console."}}},args:{defaultUsj:tn,options:Ux}},ci={render:(t,e)=>Hn(t,e,it),parameters:{docs:{description:{story:'This story demonstrates using a custom marker menu trigger key. **Try typing "?" (question mark) anywhere in the editor text to open the marker menu!** The default trigger is "\\\\" (backslash), but this story changes it to "?" for demonstration. The marker menu allows you to insert USFM markers into the text.'}}},args:{defaultUsj:tn,options:{hasExternalUI:!0,markerMenuTrigger:"?"}}},Bx={"%footnoteEditor_callerDropdown_label%":"Footnote caller","%footnoteEditor_callerDropdown_item_generated%":"Auto-generated","%footnoteEditor_callerDropdown_item_hidden%":"Hidden","%footnoteEditor_callerDropdown_item_custom%":"Custom","%footnoteEditor_callerDropdown_tooltip%":"Footnote caller","%footnoteEditor_cancelButton_tooltip%":"Cancel","%footnoteEditor_copyButton_tooltip%":"Copy footnote","%footnoteEditor_noteType_crossReference_label%":"Cross reference","%footnoteEditor_noteType_endNote_label%":"Endnote","%footnoteEditor_noteType_footnote_label%":"Footnote","%footnoteEditor_noteType_tooltip%":"Change type: Footnote","%footnoteEditor_noteTypeDropdown_label%":"Type","%footnoteEditor_saveButton_tooltip%":"Save"},ui={render:t=>{const e=b.useRef(null),n=b.useRef(),r=b.useRef(),[s,i]=b.useState(),[o,a]=b.useState(),[l,u]=b.useState(),[d,f]=b.useState(),h=b.useMemo(()=>({markerMode:"hidden",noteMode:"collapsed",hasSpacing:!0,isFormattedFont:!0}),[]),p=b.useMemo(()=>({...t.options??{},nodes:{noteCallerOnClick:(v,O,I,D,q,F)=>{var H;const $=v.currentTarget.getBoundingClientRect();if(i($.left),a($.top),u($.height),I){if(n.current)return;const W=(H=F())==null?void 0:H.at(0);if(!W||!et("note",W))return;n.current=O,r.current=[W],f(!0)}}},view:h}),[t.options,h,n]),y=b.useCallback((M,v)=>{var O;if(v&&M){if(n.current)return;console.log(M);const I=M[1];if(!et("note",I))return;const D=(O=e.current)==null?void 0:O.getElementByKey(v);if(!D)return;console.log(I);const q=D.getBoundingClientRect();i(q.left),a(q.top),u(q.height),n.current=v,r.current=[I],f(!0)}},[n]),k=()=>{n.current=void 0,r.current=void 0,f(!1)},C=M=>{var v;n.current&&((v=e.current)==null||v.replaceEmbedUpdate(n.current,M)),k()};return m.jsxs("div",{children:[m.jsx(xs,{...t,options:p,onUsjChange:(M,v,O,I)=>{y(v,I)},ref:e,onScrRefChange:()=>{}}),m.jsxs(cg,{open:d,children:[m.jsx(ug,{className:"tw-absolute",style:{top:o??0,left:s??0,height:l,width:0}}),m.jsx(dg,{className:"tw-w-[500px] tw-p-[10px]",children:m.jsx(Bf,{noteKey:n.current,noteOps:r.current,onSave:C,onClose:k,scrRef:t.scrRef??it,editorOptions:p,localizedStrings:Bx})})]})]})},parameters:{docs:{description:{story:"This story demonstrates the use of the new footnote editor on the side of the  editorial component"}}},args:{defaultUsj:tn,scrRef:it,options:{hasExternalUI:!1,markerMenuTrigger:"\\"}}},di={name:"View Options",render:(t,e)=>{const{markerMode:n,noteMode:r,hasSpacing:s,isFormattedFont:i}=t;return Hn({defaultUsj:tn,options:{hasExternalUI:!0,view:{markerMode:n,noteMode:r,hasSpacing:s,isFormattedFont:i}}},e,it)},argTypes:{markerMode:{control:{type:"select"},options:["hidden","visible","editable"],description:"Controls how USFM markers are displayed in the editor",table:{category:"View Options"}},noteMode:{control:{type:"select"},options:["collapsed","expandInline","expanded"],description:"Controls how notes are displayed in the editor",table:{category:"View Options"}},hasSpacing:{control:{type:"boolean"},description:"Whether to add spacing between paragraphs",table:{category:"View Options"}},isFormattedFont:{control:{type:"boolean"},description:"Whether to use formatted font styling",table:{category:"View Options"}}},parameters:{docs:{description:{story:"Demonstrates the editor view options (marker visibility, spacing, and formatted font) using USX input. Below in the **Controls** tab, try changing the **View Options** to see how they affect the editor display."}}},args:{markerMode:"hidden",noteMode:"collapsed",hasSpacing:!0,isFormattedFont:!0}};var vu,wu,xu;ti.parameters={...ti.parameters,docs:{...(vu=ti.parameters)==null?void 0:vu.docs,source:{originalSource:`{
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef
  }
}`,...(xu=(wu=ti.parameters)==null?void 0:wu.docs)==null?void 0:xu.source}}};var Cu,Su,Tu;ni.parameters={...ni.parameters,docs:{...(Cu=ni.parameters)==null?void 0:Cu.docs,source:{originalSource:`{
  args: {
    defaultUsj: usjEmpty,
    scrRef: defaultScrRef
  }
}`,...(Tu=(Su=ni.parameters)==null?void 0:Su.docs)==null?void 0:Tu.source}}};var Eu,Ou,Mu;ri.parameters={...ri.parameters,docs:{...(Eu=ri.parameters)==null?void 0:Eu.docs,source:{originalSource:`{
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef,
    options: {
      isReadonly: true
    }
  }
}`,...(Mu=(Ou=ri.parameters)==null?void 0:Ou.docs)==null?void 0:Mu.source}}};var Au,ju,Nu;si.parameters={...si.parameters,docs:{...(Au=si.parameters)==null?void 0:Au.docs,source:{originalSource:`{
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'Right-to-left example using a Hebrew snippet (Psalm 1:1). ' + 'The editor is set to RTL via _options.textDirection = "rtl"_. If you want the UI ' + '(tab toolbar) to be RTL click **Switch direction** in the Storybook toolbar.'
      }
    }
  },
  args: {
    defaultUsj: usjHebrew,
    options: {
      hasExternalUI: true,
      textDirection: 'rtl'
    }
  }
}`,...(Nu=(ju=si.parameters)==null?void 0:ju.docs)==null?void 0:Nu.source}}};var Iu,Ru,Pu;ii.parameters={...ii.parameters,docs:{...(Iu=ii.parameters)==null?void 0:Iu.docs,source:{originalSource:`{
  render: args => {
    // eslint-disable-next-line no-null/no-null
    const editorRef = useRef<EditorRef | null>(null);
    useEffect(() => {
      const timeoutId = setTimeout(() => {
        if (editorRef.current) {
          editorRef.current.setAnnotation(annotationRangeWeb1, 'spelling', 'annotationId', handleAnnotationOnClick, handleAnnotationOnRemove);
          editorRef.current.setAnnotation(annotationRangeWeb2, 'grammar', 'abc123', handleAnnotationOnClick, handleAnnotationOnRemove);
        }
      }, 0);
      return () => clearTimeout(timeoutId);
    }, []);
    return <Editorial {...args} ref={editorRef} />;
  },
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef
  }
}`,...(Pu=(Ru=ii.parameters)==null?void 0:Ru.docs)==null?void 0:Pu.source}}};var $u,Du,Lu;oi.parameters={...oi.parameters,docs:{...($u=oi.parameters)==null?void 0:$u.docs,source:{originalSource:`{
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates editing notes inline. Move your cursor to a note caller and ' + 'the note will expand and can be edited. Move the cursor out of the note and it will ' + 'collapse. Click the expanded note caller to toggle between the auto-generated caller ' + 'and the hidden caller.'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    options: inlineNoteOptions
  }
}`,...(Lu=(Du=oi.parameters)==null?void 0:Du.docs)==null?void 0:Lu.source}}};var Fu,qu,Uu;ai.parameters={...ai.parameters,docs:{...(Fu=ai.parameters)==null?void 0:Fu.docs,source:{originalSource:`{
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates inserting notes. Use the Project menu (hamburger) or the ' + 'toolbar buttons above the editor to insert footnotes, cross-references, and endnotes ' + 'at the current cursor position. Selecting text before inserting a footnote will use ' + 'that text as the footnote quote. You can also insert by typing "\\\\f", "\\\\x", or "\\\\fe".'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    options: insertNoteOptions
  }
}`,...(Uu=(qu=ai.parameters)==null?void 0:qu.docs)==null?void 0:Uu.source}}};var Bu,Hu,Wu;li.parameters={...li.parameters,docs:{...(Bu=li.parameters)==null?void 0:Bu.docs,source:{originalSource:`{
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates custom note callers and click handling. **Try clicking on the ' + 'circled number footnote markers ( ) in the text to see the click handler in ' + 'action!** The click event will show an alert and log details to the browser console.'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    options: customNodeOptions
  }
}`,...(Wu=(Hu=li.parameters)==null?void 0:Hu.docs)==null?void 0:Wu.source}}};var Ku,zu,Ju;ci.parameters={...ci.parameters,docs:{...(Ku=ci.parameters)==null?void 0:Ku.docs,source:{originalSource:`{
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates using a custom marker menu trigger key. **Try typing "?" ' + '(question mark) anywhere in the editor text to open the marker menu!** The default ' + 'trigger is "\\\\\\\\" (backslash), but this story changes it to "?" for demonstration. ' + 'The marker menu allows you to insert USFM markers into the text.'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    options: {
      hasExternalUI: true,
      markerMenuTrigger: '?'
    }
  }
}`,...(Ju=(zu=ci.parameters)==null?void 0:zu.docs)==null?void 0:Ju.source}}};var Vu,Gu,Yu;ui.parameters={...ui.parameters,docs:{...(Vu=ui.parameters)==null?void 0:Vu.docs,source:{originalSource:`{
  render: args => {
    // eslint-disable-next-line no-null/no-null
    const editorRef = useRef<EditorRef | null>(null);
    const noteKey = useRef<string>();
    const noteOps = useRef<DeltaOpInsertNoteEmbed[]>();
    const [popoverX, setPopoverX] = useState<number>();
    const [popoverY, setPopoverY] = useState<number>();
    const [popoverHeight, setPopoverHeight] = useState<number>();
    const [showFootnoteEditor, setShowFootnoteEditor] = useState<boolean>();
    const viewOptions = useMemo<ViewOptions>(() => ({
      markerMode: 'hidden',
      noteMode: 'collapsed',
      hasSpacing: true,
      isFormattedFont: true
    }), []);
    const mergedOptions = useMemo<EditorOptions>(() => {
      const base = args.options ?? {};
      return {
        ...base,
        nodes: {
          noteCallerOnClick: (event, noteNodeKey, isCollapsed, _getCaller, _setCaller, getNoteOps) => {
            const targetRect = event.currentTarget.getBoundingClientRect();
            setPopoverX(targetRect.left);
            setPopoverY(targetRect.top);
            setPopoverHeight(targetRect.height);
            if (isCollapsed) {
              // (event as SyntheticEvent<)
              if (noteKey.current) return;

              // Makes sure the note op is the correct type and is defined
              const noteOp = getNoteOps()?.at(0);
              if (!noteOp || !isInsertEmbedOpOfType('note', noteOp)) return;
              noteKey.current = noteNodeKey;
              noteOps.current = [noteOp];
              setShowFootnoteEditor(true);
            }
          }
        },
        view: viewOptions
      };
    }, [args.options, viewOptions, noteKey]);
    const openFootnoteEditorOnNewNote = useCallback((ops?: DeltaOp[], insertedNodeKey?: string) => {
      if (insertedNodeKey && ops) {
        // If we are already editing a note, then returns
        if (noteKey.current) return;

        // Makes sure the node is a note
        console.log(ops);
        const noteOp = ops[1];
        if (!isInsertEmbedOpOfType('note', noteOp)) return;
        const noteElement = editorRef.current?.getElementByKey(insertedNodeKey);
        // Note element must be defined
        if (!noteElement) return;
        console.log(noteOp);
        const targetRect = noteElement.getBoundingClientRect();
        setPopoverX(targetRect.left);
        setPopoverY(targetRect.top);
        setPopoverHeight(targetRect.height);
        noteKey.current = insertedNodeKey;
        noteOps.current = [noteOp];
        setShowFootnoteEditor(true);
      }
    }, [noteKey]);
    const onEditorClose = () => {
      noteKey.current = undefined;
      noteOps.current = undefined;
      setShowFootnoteEditor(false);
    };
    const onEditorSave = (newNoteOps: DeltaOp[]) => {
      if (noteKey.current) {
        editorRef.current?.replaceEmbedUpdate(noteKey.current, newNoteOps);
      }
      onEditorClose();
    };
    return <div>
        <Editorial {...args} options={mergedOptions} onUsjChange={(_usj: Usj, ops?: DeltaOp[], _source?: DeltaSource, insertedNodeKey?: string) => {
        openFootnoteEditorOnNewNote(ops, insertedNodeKey);
      }} ref={editorRef} onScrRefChange={() => undefined} />
        <Popover open={showFootnoteEditor}>
          <PopoverAnchor className="tw-absolute" style={{
          top: popoverY ?? 0,
          left: popoverX ?? 0,
          height: popoverHeight,
          width: 0
        }} />
          <PopoverContent className="tw-w-[500px] tw-p-[10px]">
            <FootnoteEditor noteKey={noteKey.current} noteOps={noteOps.current} onSave={onEditorSave} onClose={onEditorClose} scrRef={args.scrRef ?? defaultScrRef} editorOptions={mergedOptions} localizedStrings={sampleFootnoteEditorLocalizedStrings} />
          </PopoverContent>
        </Popover>
      </div>;
  },
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates the use of the new footnote editor on the side of the ' + ' editorial component'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef,
    options: {
      hasExternalUI: false,
      markerMenuTrigger: '\\\\'
    }
  }
}`,...(Yu=(Gu=ui.parameters)==null?void 0:Gu.docs)==null?void 0:Yu.source}}};var Xu,Zu,Qu;di.parameters={...di.parameters,docs:{...(Xu=di.parameters)==null?void 0:Xu.docs,source:{originalSource:`{
  name: 'View Options',
  render: (args, context) => {
    // Destructure flattened view options from args
    const {
      markerMode,
      noteMode,
      hasSpacing,
      isFormattedFont
    } = args;

    // Reconstruct the args with the options.view settings
    const mergedArgs = {
      defaultUsj: usjWeb,
      options: {
        hasExternalUI: true,
        view: {
          markerMode,
          noteMode,
          hasSpacing,
          isFormattedFont
        }
      }
    };
    return renderEditorialWithToolbar(mergedArgs, context, defaultScrRef);
  },
  argTypes: {
    markerMode: {
      control: {
        type: 'select'
      },
      options: ['hidden', 'visible', 'editable'],
      description: 'Controls how USFM markers are displayed in the editor',
      table: {
        category: 'View Options'
      }
    },
    noteMode: {
      control: {
        type: 'select'
      },
      options: ['collapsed', 'expandInline', 'expanded'],
      description: 'Controls how notes are displayed in the editor',
      table: {
        category: 'View Options'
      }
    },
    hasSpacing: {
      control: {
        type: 'boolean'
      },
      description: 'Whether to add spacing between paragraphs',
      table: {
        category: 'View Options'
      }
    },
    isFormattedFont: {
      control: {
        type: 'boolean'
      },
      description: 'Whether to use formatted font styling',
      table: {
        category: 'View Options'
      }
    }
  },
  parameters: {
    docs: {
      description: {
        story: 'Demonstrates the editor view options (marker visibility, spacing, and formatted font) ' + 'using USX input. Below in the **Controls** tab, try changing the **View Options** ' + 'to see how they affect the editor display.'
      }
    }
  },
  args: {
    markerMode: 'hidden',
    noteMode: 'collapsed',
    hasSpacing: true,
    isFormattedFont: true
  }
}`,...(Qu=(Zu=di.parameters)==null?void 0:Zu.docs)==null?void 0:Qu.source}}};const QC=["Default","Empty","ReadOnly","RTL","Annotated","InlineNoteEditing","InsertNote","CustomNoteOptions","CustomMarkerTrigger","FootnoteEditorView","EditorViewOptions"];export{ii as Annotated,ci as CustomMarkerTrigger,li as CustomNoteOptions,ti as Default,di as EditorViewOptions,ni as Empty,ui as FootnoteEditorView,oi as InlineNoteEditing,ai as InsertNote,si as RTL,ri as ReadOnly,QC as __namedExportsOrder,ZC as default};
