var Pv=Object.defineProperty;var Rv=(n,e,t)=>e in n?Pv(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var It=(n,e,t)=>Rv(n,typeof e!="symbol"?e+"":e,t);import{j as S}from"./jsx-runtime-4U518VT9.js";import{c as Xn,g as Lv,r as C}from"./iframe-Bv3bWykC.js";import{_ as Tm,H as Dv,p as Ws,O as Ks,D as jv,U as Fv,B as qv,C as gd}from"./index-CxcOfNM5.js";import{r as Nt}from"./index-o4MUuzIP.js";import{c as Bv,d as Uv,e as zv,g as Wv}from"./floating-ui.react-dom-BNWfmB-O.js";import{M as Kv}from"./markdown-renderer.component-CmSkmW0K.js";import{C as Hv,a as Jv,b as Vv,d as Gv}from"./card-y4bYAdtE.js";import{B as Yv}from"./book-chapter-control.component-CxAEetjt.js";import{T as Xv}from"./tab-toolbar.component-BjgEl3qf.js";import{B as xi}from"./button-C4DTw0e8.js";import{D as Qv,a as Zv,b as ek,c as tk}from"./dropdown-menu-DjZIWVOa.js";import{C as nk}from"./chevron-down-F7wygLG8.js";import{c as en}from"./createLucideIcon-B8_ouSpe.js";import{F as Sn}from"./file-text-DEMOUX-0.js";import"./index-DKG0ebt4.js";import"./shadcn-ui.util-DMJ19wEV.js";import"./book-item.utils-iUoXWbqG.js";import"./command-DxgNr-OG.js";import"./index-BLOrSidn.js";import"./index-1B3azlGo.js";import"./index-C7gl_bTl.js";import"./index-CqpLP0GU.js";import"./index-DYYfsWV9.js";import"./index-DVvLRDlQ.js";import"./index-BQjUaenS.js";import"./index-BlhTT8Kl.js";import"./index-CmdqBkVA.js";import"./Combination-CtRmH8mS.js";import"./index-B1bw5oxv.js";import"./index-Dl-EoO6R.js";import"./index-vrS8v1qU.js";import"./dialog-DFhr9nJG.js";import"./x-CltABTbY.js";import"./search-BrFuiBp3.js";import"./index.es-D4jfZzAn.js";import"./index-B_P4TyHR.js";import"./check-D1Gn6nZV.js";import"./popover-CG5_7W5p.js";import"./index-DFbcrOq2.js";import"./index-B7c1hA2o.js";import"./index-CwScwZeR.js";import"./chevron-left-BehUSbhe.js";import"./chevron-right-C8eUbdt-.js";import"./arrow-right-kYJOyA1i.js";import"./tab-dropdown-menu.component-tnXaNK33.js";import"./tooltip-yM7laDMz.js";import"./index-CevVC9SK.js";import"./menu.util-Dxh7JGT4.js";import"./menu-icon.component-B8UZXi-N.js";import"./tab-toolbar-container.component-COccXiIP.js";import"./index-BPbCuWFR.js";import"./menu.context-DF154ny9.js";import"./index-CxALBWdZ.js";import"./index-Dh4Sd2UR.js";import"./index-CeEE-FCB.js";import"./circle-t_HnDm0I.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rk=[["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 18h18",key:"1h113x"}],["path",{d:"M3 6h18",key:"d0wm0j"}]],Yo=en("AlignJustify",rk);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ik=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]],sk=en("Ban",ik);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ok=[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"m17 12 3-2v8",key:"1hhhft"}]],vi=en("Heading1",ok);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ak=[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M21 18h-4c0-4 4-3 4-6 0-1.5-2-2.5-4-1",key:"9jr5yi"}]],zf=en("Heading2",ak);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lk=[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M17.5 10.5c1.7-1 3.5 0 3.5 1.5a2 2 0 0 1-2 2",key:"68ncm8"}],["path",{d:"M17 17.5c2 1.5 4 .3 4-1.5a2 2 0 0 0-2-2",key:"1ejuhz"}]],Ac=en("Heading3",lk);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ck=[["path",{d:"M16 12H3",key:"1a2rj7"}],["path",{d:"M16 6H3",key:"1wxfjs"}],["path",{d:"M10 18H3",key:"13769t"}],["path",{d:"M21 6v10a2 2 0 0 1-2 2h-5",key:"ilrcs8"}],["path",{d:"m16 16-2 2 2 2",key:"kkc6pm"}]],uk=en("ListEnd",ck);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dk=[["path",{d:"M21 7v6h-6",key:"3ptur4"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7",key:"1kgawr"}]],fk=en("Redo",dk);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hk=[["path",{d:"m18 14 4 4-4 4",key:"10pe0f"}],["path",{d:"m18 2 4 4-4 4",key:"pucp1d"}],["path",{d:"M2 18h1.973a4 4 0 0 0 3.3-1.7l5.454-8.6a4 4 0 0 1 3.3-1.7H22",key:"1ailkh"}],["path",{d:"M2 6h1.972a4 4 0 0 1 3.6 2.2",key:"km57vx"}],["path",{d:"M22 18h-6.041a4 4 0 0 1-3.3-1.8l-.359-.45",key:"os18l9"}]],gk=en("Shuffle",hk);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pk=[["path",{d:"m4 19 8-8",key:"hr47gm"}],["path",{d:"m12 19-8-8",key:"1dhhmo"}],["path",{d:"M20 12h-4c0-1.5.442-2 1.5-2.5S20 8.334 20 7.002c0-.472-.17-.93-.484-1.29a2.105 2.105 0 0 0-2.617-.436c-.42.239-.738.614-.899 1.06",key:"1dfcux"}]],mk=en("Superscript",pk);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yk=[["path",{d:"M17 6H3",key:"16j9eg"}],["path",{d:"M21 12H8",key:"scolzb"}],["path",{d:"M21 18H8",key:"1wfozv"}],["path",{d:"M3 12v6",key:"fv4c87"}]],Oc=en("TextQuote",yk);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _k=[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]],bk=en("Undo",_k);function J(n,...e){const t=new URL("https://lexical.dev/docs/error"),r=new URLSearchParams;r.append("code",n);for(const i of e)r.append("v",i);throw t.search=r.toString(),Error(`Minified Lexical error #${n}; visit ${t.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}const tn=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,vk=tn&&"documentMode"in document?document.documentMode:null,dn=tn&&/Mac|iPod|iPhone|iPad/.test(navigator.platform),Fr=tn&&/^(?!.*Seamonkey)(?=.*Firefox).*/i.test(navigator.userAgent),qa=!(!tn||!("InputEvent"in window)||vk)&&"getTargetRanges"in new window.InputEvent("input"),Hs=tn&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent),Ii=tn&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,kk=tn&&/Android/.test(navigator.userAgent),Em=tn&&/^(?=.*Chrome).*/i.test(navigator.userAgent),Wf=tn&&kk&&Em,Ba=tn&&/AppleWebKit\/[\d.]+/.test(navigator.userAgent)&&!Em;function Ua(...n){const e=[];for(const t of n)if(t&&typeof t=="string")for(const[r]of t.matchAll(/\S+/g))e.push(r);return e}const xk=1,Ck=3,wk=9,Sk=11,qr=0,Nm=1,Pi=2,Tk=0,Ek=1,Nk=2,za=4,Wa=8,pd=128,Mk=1792|(112|(3|za|Wa)|pd),md=1,yd=2,_d=3,bd=4,vd=5,kd=6,vl=Hs||Ii||Ba?" ":"​",Dn=`

`,Ak=Fr?" ":vl,Mm="֑-߿יִ-﷽ﹰ-ﻼ",Am="A-Za-zÀ-ÖØ-öø-ʸ̀-֐ࠀ-῿‎Ⰰ-﬜︀-﹯﻽-￿",Ok=new RegExp("^[^"+Am+"]*["+Mm+"]"),$k=new RegExp("^[^"+Mm+"]*["+Am+"]"),sr={bold:1,capitalize:1024,code:16,highlight:pd,italic:2,lowercase:256,strikethrough:za,subscript:32,superscript:64,underline:Wa,uppercase:512},Ik={directionless:1,unmergeable:2},Kf={center:yd,end:kd,justify:bd,left:md,right:_d,start:vd},Pk={[yd]:"center",[kd]:"end",[bd]:"justify",[md]:"left",[_d]:"right",[vd]:"start"},Rk={normal:0,segmented:2,token:1},Lk={[Tk]:"normal",[Nk]:"segmented",[Ek]:"token"},Hf="$config";function Om(n,e,t,r,i,s){let o=n.getFirstChild();for(;o!==null;){const a=o.__key;o.__parent===e&&(F(o)&&Om(o,a,t,r,i,s),t.has(a)||s.delete(a),i.push(a)),o=o.getNextSibling()}}const Dk=100;let du=!1,xd=0;function jk(n){xd=n.timeStamp}function $c(n,e,t){const r=n.nodeName==="BR",i=e.__lexicalLineBreak;return i&&(n===i||r&&n.previousSibling===i)||r&&Ml(n,t)!==void 0}function Fk(n,e,t){const r=Yt(jt(t));let i=null,s=null;r!==null&&r.anchorNode===n&&(i=r.anchorOffset,s=r.focusOffset);const o=n.nodeValue;o!==null&&Kd(e,o,i,s,!1)}function qk(n,e,t){if(q(n)){const r=n.anchor.getNode();if(r.is(t)&&n.format!==r.getFormat())return!1}return Un(e)&&t.isAttached()}function Bk(n,e,t,r){for(let i=n;i&&!Fx(i);i=bo(i)){const s=Ml(i,e);if(s!==void 0){const o=ce(s,t);if(o)return ve(o)||!Te(i)?void 0:[i,o]}else if(i===r)return[r,My(t)]}}function $m(n,e,t){du=!0;const r=performance.now()-xd>Dk;try{Et(n,()=>{const i=K()||function(d){return d.getEditorState().read(()=>{const h=K();return h!==null?h.clone():null})}(n),s=new Map,o=n.getRootElement(),a=n._editorState,l=n._blockCursorElement;let c=!1,u="";for(let d=0;d<e.length;d++){const h=e[d],p=h.type,m=h.target,y=Bk(m,n,a,o);if(!y)continue;const[b,_]=y;if(p==="characterData")r&&W(_)&&Un(m)&&qk(i,m,_)&&Fk(m,_,n);else if(p==="childList"){c=!0;const x=h.addedNodes;for(let M=0;M<x.length;M++){const L=x[M],A=Ey(L),I=L.parentNode;if(I!=null&&L!==l&&A===null&&!$c(L,I,n)){if(Fr){const B=(Te(L)?L.innerText:null)||L.nodeValue;B&&(u+=B)}I.removeChild(L)}}const T=h.removedNodes,P=T.length;if(P>0){let M=0;for(let L=0;L<P;L++){const A=T[L];($c(A,m,n)||l===A)&&(m.appendChild(A),M++)}P!==M&&s.set(b,_)}}}if(s.size>0)for(const[d,h]of s)h.reconcileObservedMutation(d,n);const f=t.takeRecords();if(f.length>0){for(let d=0;d<f.length;d++){const h=f[d],p=h.addedNodes,m=h.target;for(let y=0;y<p.length;y++){const b=p[y],_=b.parentNode;_==null||b.nodeName!=="BR"||$c(b,m,n)||_.removeChild(b)}}t.takeRecords()}i!==null&&(c&&it(i),Fr&&Py(n)&&i.insertRawText(u))})}finally{du=!1}}function Im(n){const e=n._observer;e!==null&&$m(n,e.takeRecords(),e)}function Pm(n){(function(e){xd===0&&jt(e).addEventListener("textInput",jk,!0)})(n),n._observer=new MutationObserver((e,t)=>{$m(n,e,t)})}let Uk=class{constructor(e,t){this.key=e,this.parse=t.parse.bind(t),this.unparse=(t.unparse||Kk).bind(t),this.isEqual=(t.isEqual||Object.is).bind(t),this.defaultValue=this.parse(void 0)}};function Rm(n,e){return new Uk(n,e)}function Ri(n,e,t="latest"){const r=(t==="latest"?n.getLatest():n).__state;return r?r.getValue(e):e.defaultValue}function Pn(n,e,t){let r;if(Qe(),typeof t=="function"){const s=n.getLatest(),o=Ri(s,e);if(r=t(o),e.isEqual(o,r))return s}else r=t;const i=n.getWritable();return Dm(i).updateFromKnown(e,r),i}function zk(n){const e=new Map,t=new Set;for(let r=typeof n=="function"?n:n.replace;r.prototype&&r.prototype.getType!==void 0;r=Object.getPrototypeOf(r)){const{ownNodeConfig:i}=Gd(r);if(i&&i.stateConfigs)for(const s of i.stateConfigs){let o;"stateConfig"in s?(o=s.stateConfig,s.flat&&t.add(o.key)):o=s,e.set(o.key,o)}}return{flatKeys:t,sharedConfigMap:e}}let Wk=class Lm{constructor(e,t,r=void 0,i=new Map,s=void 0){this.node=e,this.sharedNodeState=t,this.unknownState=r,this.knownState=i;const{sharedConfigMap:o}=this.sharedNodeState,a=s!==void 0?s:function(l,c,u){let f=u.size;if(c)for(const d in c){const h=l.get(d);h&&u.has(h)||f++}return f}(o,r,i);this.size=a}getValue(e){const t=this.knownState.get(e);if(t!==void 0)return t;this.sharedNodeState.sharedConfigMap.set(e.key,e);let r=e.defaultValue;if(this.unknownState&&e.key in this.unknownState){const i=this.unknownState[e.key];i!==void 0&&(r=e.parse(i)),this.updateFromKnown(e,r)}return r}getInternalState(){return[this.unknownState,this.knownState]}toJSON(){const e={...this.unknownState},t={};for(const[r,i]of this.knownState)r.isEqual(i,r.defaultValue)?delete e[r.key]:e[r.key]=r.unparse(i);for(const r of this.sharedNodeState.flatKeys)r in e&&(t[r]=e[r],delete e[r]);return Jf(e)&&(t.$=e),t}getWritable(e){if(this.node===e)return this;const{sharedNodeState:t,unknownState:r}=this,i=new Map(this.knownState);return new Lm(e,t,function(s,o,a){let l;if(a)for(const[c,u]of Object.entries(a)){const f=s.get(c);f?o.has(f)||o.set(f,f.parse(u)):(l=l||{},l[c]=u)}return l}(t.sharedConfigMap,i,r),i,this.size)}updateFromKnown(e,t){const r=e.key;this.sharedNodeState.sharedConfigMap.set(r,e);const{knownState:i,unknownState:s}=this;i.has(e)||s&&r in s||(s&&(delete s[r],this.unknownState=Jf(s)),this.size++),i.set(e,t)}updateFromUnknown(e,t){const r=this.sharedNodeState.sharedConfigMap.get(e);r?this.updateFromKnown(r,r.parse(t)):(this.unknownState=this.unknownState||{},e in this.unknownState||this.size++,this.unknownState[e]=t)}updateFromJSON(e){const{knownState:t}=this;for(const r of t.keys())t.set(r,r.defaultValue);if(this.size=t.size,this.unknownState=void 0,e)for(const[r,i]of Object.entries(e))this.updateFromUnknown(r,i)}};function Dm(n){const e=n.getWritable(),t=e.__state?e.__state.getWritable(e):new Wk(e,jm(e));return e.__state=t,t}function jm(n){return n.__state?n.__state.sharedNodeState:Sy(Ol(),n.getType()).sharedNodeState}function Jf(n){if(n)for(const e in n)return n}function Kk(n){return n}function Vf(n,e,t){for(const[r,i]of e.knownState){if(n.has(r.key))continue;n.add(r.key);const s=t?t.getValue(r):r.defaultValue;if(s!==i&&!r.isEqual(s,i))return!0}return!1}function Gf(n,e,t){const{unknownState:r}=e,i=t?t.unknownState:void 0;if(r){for(const[s,o]of Object.entries(r))if(!n.has(s)&&(n.add(s),o!==(i?i[s]:void 0)))return!0}return!1}function Yf(n,e){const t=n.__state;return t&&t.node===n?t.getWritable(e):t}function Xf(n,e){const t=n.__mode,r=n.__format,i=n.__style,s=e.__mode,o=e.__format,a=e.__style,l=n.__state,c=e.__state;return(t===null||t===s)&&(r===null||r===o)&&(i===null||i===a)&&(n.__state===null||l===c||function(u,f){if(u===f)return!0;if(u&&f&&u.size!==f.size)return!1;const d=new Set;return!(u&&Vf(d,u,f)||f&&Vf(d,f,u)||u&&Gf(d,u,f)||f&&Gf(d,f,u))}(l,c))}function Qf(n,e){const t=n.mergeWithSibling(e),r=Ie()._normalizedNodes;return r.add(n.__key),r.add(e.__key),t}function Zf(n){let e,t,r=n;if(r.__text!==""||!r.isSimpleText()||r.isUnmergeable()){for(;(e=r.getPreviousSibling())!==null&&W(e)&&e.isSimpleText()&&!e.isUnmergeable();){if(e.__text!==""){if(Xf(e,r)){r=Qf(e,r);break}break}e.remove()}for(;(t=r.getNextSibling())!==null&&W(t)&&t.isSimpleText()&&!t.isUnmergeable();){if(t.__text!==""){if(Xf(r,t)){r=Qf(r,t);break}break}t.remove()}}else r.remove()}function Js(n){return eh(n.anchor),eh(n.focus),n}function eh(n){for(;n.type==="element";){const e=n.getNode(),t=n.offset;let r,i;if(t===e.getChildrenSize()?(r=e.getChildAtIndex(t-1),i=!0):(r=e.getChildAtIndex(t),i=!1),W(r)){n.set(r.__key,i?r.getTextContentSize():0,"text",!0);break}if(!F(r))break;n.set(r.__key,i?r.getChildrenSize():0,"element",!0)}}let or,yt,Vs,kl,fu,hu,Br,Ht,gu,Gs,Fe="",mt="",cn=null,un="",On="",Fm=!1,Ys=!1,Ea=null;function Ka(n,e){const t=Br.get(n);if(e!==null){const r=yu(n);r.parentNode===e&&e.removeChild(r)}if(Ht.has(n)||yt._keyToDOMMap.delete(n),F(t)){const r=Ja(t,Br);pu(r,0,r.length-1,null)}t!==void 0&&Hd(Gs,Vs,kl,t,"destroyed")}function pu(n,e,t,r){let i=e;for(;i<=t;++i){const s=n[i];s!==void 0&&Ka(s,r)}}function Mr(n,e){n.setProperty("text-align",e)}const Hk="40px";function qm(n,e){const t=or.theme.indent;if(typeof t=="string"){const i=n.classList.contains(t);e>0&&!i?n.classList.add(t):e<1&&i&&n.classList.remove(t)}const r=getComputedStyle(n).getPropertyValue("--lexical-indent-base-value")||Hk;n.style.setProperty("padding-inline-start",e===0?"":`calc(${e} * ${r})`)}function Bm(n,e){const t=n.style;e===0?Mr(t,""):e===md?Mr(t,"left"):e===yd?Mr(t,"center"):e===_d?Mr(t,"right"):e===bd?Mr(t,"justify"):e===vd?Mr(t,"start"):e===kd&&Mr(t,"end")}function Ha(n,e){const t=Ht.get(n);t===void 0&&J(60);const r=t.createDOM(or,yt);if(function(i,s,o){const a=o._keyToDOMMap;(function(l,c,u){const f=`__lexicalKey_${c._key}`;l[f]=u})(s,o,i),a.set(i,s)}(n,r,yt),W(t)?r.setAttribute("data-lexical-text","true"):ve(t)&&r.setAttribute("data-lexical-decorator","true"),F(t)){const i=t.__indent,s=t.__size;if(i!==0&&qm(r,i),s!==0){const a=s-1;(function(l,c,u,f){const d=mt;mt="",mu(l,u,0,c,u.getDOMSlot(f)),zm(u,f),mt=d})(Ja(t,Ht),a,t,r)}const o=t.__format;o!==0&&Bm(r,o),t.isInline()||Um(null,t,r),Al(t)&&(Fe+=Dn,On+=Dn)}else{const i=t.getTextContent();if(ve(t)){const s=t.decorate(yt,or);s!==null&&Wm(n,s),r.contentEditable="false"}else W(t)&&(t.isDirectionless()||(mt+=i));Fe+=i,On+=i}return e!==null&&e.insertChild(r),Hd(Gs,Vs,kl,t,"created"),r}function mu(n,e,t,r,i){const s=Fe;Fe="";let o=t;for(;o<=r;++o){Ha(n[o],i);const a=Ht.get(n[o]);a!==null&&W(a)&&(cn===null&&(cn=a.getFormat()),un===""&&(un=a.getStyle()))}Al(e)&&(Fe+=Dn),i.element.__lexicalTextContent=Fe,Fe=s+Fe}function th(n,e){if(n){const t=n.__last;if(t){const r=e.get(t);if(r)return Ir(r)?"line-break":ve(r)&&r.isInline()?"decorator":null}return"empty"}return null}function Um(n,e,t){const r=th(n,Br),i=th(e,Ht);r!==i&&e.getDOMSlot(t).setManagedLineBreak(i)}function zm(n,e){const t=e.__lexicalDirTextContent||"",r=e.__lexicalDir||"";if(t!==mt||r!==Ea){const i=mt==="",s=i?Ea:function(o){return Ok.test(o)?"rtl":$k.test(o)?"ltr":null}(mt);if(s!==r){const o=e.classList,a=or.theme;let l=r!==null?a[r]:void 0,c=s!==null?a[s]:void 0;if(l!==void 0){if(typeof l=="string"){const u=Ua(l);l=a[r]=u}o.remove(...l)}if(s===null||i&&s==="ltr")e.removeAttribute("dir");else{if(c!==void 0){if(typeof c=="string"){const u=Ua(c);c=a[s]=u}c!==void 0&&o.add(...c)}e.dir=s}Ys||(n.getWritable().__dir=s)}Ea=s,e.__lexicalDirTextContent=mt,e.__lexicalDir=s}}function Jk(n,e,t){const r=mt;var i;mt="",cn=null,un="",function(s,o,a){const l=Fe,c=s.__size,u=o.__size;Fe="";const f=a.element;if(c===1&&u===1){const d=s.__first,h=o.__first;if(d===h)$s(d,f);else{const m=yu(d),y=Ha(h,null);try{f.replaceChild(y,m)}catch(b){if(typeof b=="object"&&b!=null){const _=`${b.toString()} Parent: ${f.tagName}, new child: {tag: ${y.tagName} key: ${h}}, old child: {tag: ${m.tagName}, key: ${d}}.`;throw new Error(_)}throw b}Ka(d,null)}const p=Ht.get(h);W(p)&&(cn===null&&(cn=p.getFormat()),un===""&&(un=p.getStyle()))}else{const d=Ja(s,Br),h=Ja(o,Ht);if(d.length!==c&&J(227),h.length!==u&&J(228),c===0)u!==0&&mu(h,o,0,u-1,a);else if(u===0){if(c!==0){const p=a.after==null&&a.before==null&&a.element.__lexicalLineBreak==null;pu(d,0,c-1,p?null:f),p&&(f.textContent="")}}else(function(p,m,y,b,_,x){const T=b-1,P=_-1;let M,L,A=x.getFirstChild(),I=0,B=0;for(;I<=T&&B<=P;){const w=m[I],R=y[B];if(w===R)A=Ic($s(R,x.element)),I++,B++;else{M===void 0&&(M=new Set(m)),L===void 0&&(L=new Set(y));const D=L.has(w),z=M.has(R);if(D)if(z){const H=qi(yt,R);H===A?A=Ic($s(R,x.element)):(x.withBefore(A).insertChild(H),$s(R,x.element)),I++,B++}else Ha(R,x.withBefore(A)),B++;else A=Ic(yu(w)),Ka(w,x.element),I++}const j=Ht.get(R);j!==null&&W(j)&&(cn===null&&(cn=j.getFormat()),un===""&&(un=j.getStyle()))}const k=I>T,N=B>P;if(k&&!N){const w=y[P+1],R=w===void 0?null:yt.getElementByKey(w);mu(y,p,B,P,x.withBefore(R))}else N&&!k&&pu(m,I,T,x.element)})(o,d,h,c,u,a)}Al(o)&&(Fe+=Dn),f.__lexicalTextContent=Fe,Fe=l+Fe}(n,e,e.getDOMSlot(t)),zm(e,t),i=e,cn==null||cn===i.__textFormat||Ys||i.setTextFormat(cn),function(s){un===""||un===s.__textStyle||Ys||s.setTextStyle(un)}(e),mt=r}function Ja(n,e){const t=[];let r=n.__first;for(;r!==null;){const i=e.get(r);i===void 0&&J(101),t.push(r),r=i.__next}return t}function $s(n,e){const t=Br.get(n);let r=Ht.get(n);t!==void 0&&r!==void 0||J(61);const i=Fm||hu.has(n)||fu.has(n),s=qi(yt,n);if(t===r&&!i){if(F(t)){const o=s.__lexicalTextContent;o!==void 0&&(Fe+=o,On+=o);const a=s.__lexicalDirTextContent;a!==void 0&&(mt+=a)}else{const o=t.getTextContent();W(t)&&!t.isDirectionless()&&(mt+=o),On+=o,Fe+=o}return s}if(t!==r&&i&&Hd(Gs,Vs,kl,r,"updated"),r.updateDOM(t,s,or)){const o=Ha(n,null);return e===null&&J(62),e.replaceChild(o,s),Ka(n,null),o}if(F(t)&&F(r)){const o=r.__indent;o!==t.__indent&&qm(s,o);const a=r.__format;a!==t.__format&&Bm(s,a),i&&(Jk(t,r,s),et(r)||r.isInline()||Um(t,r,s)),Al(r)&&(Fe+=Dn,On+=Dn)}else{const o=r.getTextContent();if(ve(r)){const a=r.decorate(yt,or);a!==null&&Wm(n,a)}else W(r)&&!r.isDirectionless()&&(mt+=o);Fe+=o,On+=o}if(!Ys&&et(r)&&r.__cachedText!==On){const o=r.getWritable();o.__cachedText=On,r=o}return s}function Wm(n,e){let t=yt._pendingDecorators;const r=yt._decorators;if(t===null){if(r[n]===e)return;t=Ny(yt)}t[n]=e}function Ic(n){let e=n.nextSibling;return e!==null&&e===yt._blockCursorElement&&(e=e.nextSibling),e}function Vk(n,e,t,r,i,s){Fe="",On="",mt="",Fm=r===Pi,Ea=null,yt=t,or=t._config,Vs=t._nodes,kl=yt._listeners.mutation,fu=i,hu=s,Br=n._nodeMap,Ht=e._nodeMap,Ys=e._readOnly,gu=new Map(t._keyToDOMMap);const o=new Map;return Gs=o,$s("root",null),yt=void 0,Vs=void 0,fu=void 0,hu=void 0,Br=void 0,Ht=void 0,or=void 0,gu=void 0,Gs=void 0,o}function yu(n){const e=gu.get(n);return e===void 0&&J(75,n),e}function ie(n){return{type:n}}const fr=ie("SELECTION_CHANGE_COMMAND"),Gk=ie("SELECTION_INSERT_CLIPBOARD_NODES_COMMAND"),Km=ie("CLICK_COMMAND"),pn=ie("DELETE_CHARACTER_COMMAND"),nr=ie("INSERT_LINE_BREAK_COMMAND"),Xs=ie("INSERT_PARAGRAPH_COMMAND"),$r=ie("CONTROLLED_TEXT_INSERTION_COMMAND"),ti=ie("PASTE_COMMAND"),Va=ie("REMOVE_TEXT_COMMAND"),Li=ie("DELETE_WORD_COMMAND"),Di=ie("DELETE_LINE_COMMAND"),Qn=ie("FORMAT_TEXT_COMMAND"),uo=ie("UNDO_COMMAND"),fo=ie("REDO_COMMAND"),Qi=ie("KEYDOWN_COMMAND"),Cd=ie("KEY_ARROW_RIGHT_COMMAND"),Yk=ie("MOVE_TO_END"),wd=ie("KEY_ARROW_LEFT_COMMAND"),Xk=ie("MOVE_TO_START"),Sd=ie("KEY_ARROW_UP_COMMAND"),Td=ie("KEY_ARROW_DOWN_COMMAND"),ji=ie("KEY_ENTER_COMMAND"),Hm=ie("KEY_SPACE_COMMAND"),Ed=ie("KEY_BACKSPACE_COMMAND"),xl=ie("KEY_ESCAPE_COMMAND"),Nd=ie("KEY_DELETE_COMMAND"),Md=ie("KEY_TAB_COMMAND"),Qk=ie("INSERT_TAB_COMMAND"),Zk=ie("INDENT_CONTENT_COMMAND"),nh=ie("OUTDENT_CONTENT_COMMAND"),Cl=ie("DROP_COMMAND"),ex=ie("FORMAT_ELEMENT_COMMAND"),Ad=ie("DRAGSTART_COMMAND"),Jm=ie("DRAGOVER_COMMAND"),tx=ie("DRAGEND_COMMAND"),hr=ie("COPY_COMMAND"),ni=ie("CUT_COMMAND"),Ga=ie("SELECT_ALL_COMMAND"),Od=ie("CLEAR_EDITOR_COMMAND"),Vm=ie("CLEAR_HISTORY_COMMAND"),Is=ie("CAN_REDO_COMMAND"),Ps=ie("CAN_UNDO_COMMAND"),nx=ie("FOCUS_COMMAND"),rx=ie("BLUR_COMMAND"),ix=ie("KEY_MODIFIER_COMMAND"),Tn=Object.freeze({}),_u=30,bu=[["keydown",function(n,e){if(Fs=n.timeStamp,Gm=n.key,!e.isComposing()&&!Y(e,Qi,n)&&n.key!=null){if(Pc&&Ah(n))return Et(e,()=>{Xo(e,Rc)}),Pc=!1,void(Rc="");if(function(t){return we(t,"ArrowRight",{shiftKey:"any"})}(n))Y(e,Cd,n);else if(function(t){return we(t,"ArrowRight",Mn)}(n))Y(e,Yk,n);else if(function(t){return we(t,"ArrowLeft",{shiftKey:"any"})}(n))Y(e,wd,n);else if(function(t){return we(t,"ArrowLeft",Mn)}(n))Y(e,Xk,n);else if(function(t){return we(t,"ArrowUp",{altKey:"any",shiftKey:"any"})}(n))Y(e,Sd,n);else if(function(t){return we(t,"ArrowDown",{altKey:"any",shiftKey:"any"})}(n))Y(e,Td,n);else if(function(t){return we(t,"Enter",{altKey:"any",ctrlKey:"any",metaKey:"any",shiftKey:!0})}(n))qs=!0,Y(e,ji,n);else if(function(t){return t.key===" "}(n))Y(e,Hm,n);else if(function(t){return dn&&we(t,"o",{ctrlKey:!0})}(n))n.preventDefault(),qs=!0,Y(e,nr,!0);else if(function(t){return we(t,"Enter",{altKey:"any",ctrlKey:"any",metaKey:"any"})}(n))qs=!1,Y(e,ji,n);else if(function(t){return we(t,"Backspace",{shiftKey:"any"})||dn&&we(t,"h",{ctrlKey:!0})}(n))Ah(n)?Y(e,Ed,n):(n.preventDefault(),Y(e,pn,!0));else if(function(t){return t.key==="Escape"}(n))Y(e,xl,n);else if(function(t){return we(t,"Delete",{})||dn&&we(t,"d",{ctrlKey:!0})}(n))(function(t){return t.key==="Delete"})(n)?Y(e,Nd,n):(n.preventDefault(),Y(e,pn,!1));else if(function(t){return we(t,"Backspace",Mh)}(n))n.preventDefault(),Y(e,Li,!0);else if(function(t){return we(t,"Delete",Mh)}(n))n.preventDefault(),Y(e,Li,!1);else if(function(t){return dn&&we(t,"Backspace",{metaKey:!0})}(n))n.preventDefault(),Y(e,Di,!0);else if(function(t){return dn&&(we(t,"Delete",{metaKey:!0})||we(t,"k",{ctrlKey:!0}))}(n))n.preventDefault(),Y(e,Di,!1);else if(function(t){return we(t,"b",Mn)}(n))n.preventDefault(),Y(e,Qn,"bold");else if(function(t){return we(t,"u",Mn)}(n))n.preventDefault(),Y(e,Qn,"underline");else if(function(t){return we(t,"i",Mn)}(n))n.preventDefault(),Y(e,Qn,"italic");else if(function(t){return we(t,"Tab",{shiftKey:"any"})}(n))Y(e,Md,n);else if(function(t){return we(t,"z",Mn)}(n))n.preventDefault(),Y(e,uo,void 0);else if(function(t){return dn?we(t,"z",{metaKey:!0,shiftKey:!0}):we(t,"y",{ctrlKey:!0})||we(t,"z",{ctrlKey:!0,shiftKey:!0})}(n))n.preventDefault(),Y(e,fo,void 0);else{const t=e._editorState._selection;t===null||q(t)?Oh(n)&&(n.preventDefault(),Y(e,Ga,n)):function(r){return we(r,"c",Mn)}(n)?(n.preventDefault(),Y(e,hr,n)):function(r){return we(r,"x",Mn)}(n)?(n.preventDefault(),Y(e,ni,n)):Oh(n)&&(n.preventDefault(),Y(e,Ga,n))}(function(t){return t.ctrlKey||t.shiftKey||t.altKey||t.metaKey})(n)&&Y(e,ix,n)}}],["pointerdown",function(n,e){const t=n.target,r=n.pointerType;ii(t)&&r!=="touch"&&r!=="pen"&&n.button===0&&Et(e,()=>{Th(t)||(ku=!0)})}],["compositionstart",function(n,e){Et(e,()=>{const t=K();if(q(t)&&!e.isComposing()){const r=t.anchor,i=t.anchor.getNode();Ze(r.key),(n.timeStamp<Fs+_u||r.type==="element"||!t.isCollapsed()||i.getFormat()!==t.format||W(i)&&i.getStyle()!==t.style)&&Y(e,$r,Ak)}})}],["compositionend",function(n,e){Fr?Ts=!0:Ii||!Hs&&!Ba?Et(e,()=>{Xo(e,n.data)}):(Pc=!0,Rc=n.data)}],["input",function(n,e){n.stopPropagation(),Et(e,()=>{if(Te(n.target)&&Th(n.target))return;const t=K(),r=n.data,i=ey(n);if(r!=null&&q(t)&&Qm(t,i,r,n.timeStamp,!1)){Ts&&(Xo(e,r),Ts=!1);const s=t.anchor.getNode(),o=Yt(jt(e));if(o===null)return;const a=t.isBackward(),l=a?t.anchor.offset:t.focus.offset,c=a?t.focus.offset:t.anchor.offset;qa&&!t.isCollapsed()&&W(s)&&o.anchorNode!==null&&s.getTextContent().slice(0,l)+r+s.getTextContent().slice(l+c)===$y(o.anchorNode)||Y(e,$r,r);const u=r.length;Fr&&u>1&&n.inputType==="insertCompositionText"&&!e.isComposing()&&(t.anchor.offset-=u),Hs||Ii||Ba||!e.isComposing()||(Fs=0,Ze(null))}else Wd(!1,e,r!==null?r:void 0),Ts&&(Xo(e,r||void 0),Ts=!1);(function(){Qe();const s=Ie();Im(s)})()},{event:n}),Ci=null}],["click",function(n,e){Et(e,()=>{const t=K(),r=Yt(jt(e)),i=es();if(r){if(q(t)){const s=t.anchor,o=s.getNode();if(s.type==="element"&&s.offset===0&&t.isCollapsed()&&!et(o)&&me().getChildrenSize()===1&&o.getTopLevelElementOrThrow().isEmpty()&&i!==null&&t.is(i))r.removeAllRanges(),t.dirty=!0;else if(n.detail===3&&!t.isCollapsed()&&o!==t.focus.getNode()){const a=function(l,c){let u=l;for(;u!==me()&&u!=null;){if(c(u))return u;u=u.getParent()}return null}(o,l=>F(l)&&!l.isInline());F(a)&&a.select(0)}}else if(n.pointerType==="touch"||n.pointerType==="pen"){const s=r.anchorNode;(Te(s)||Un(s))&&it(Id(i,r,e,n))}}Y(e,Km,n)})}],["cut",Tn],["copy",Tn],["dragstart",Tn],["dragover",Tn],["dragend",Tn],["paste",Tn],["focus",Tn],["blur",Tn],["drop",Tn]];qa&&bu.push(["beforeinput",(n,e)=>function(t,r){const i=t.inputType,s=ey(t);i==="deleteCompositionText"||Fr&&Py(r)||i!=="insertCompositionText"&&Et(r,()=>{const o=K();if(i==="deleteContentBackward"){if(o===null){const h=es();if(!q(h))return;it(h.clone())}if(q(o)){const h=o.anchor.key===o.focus.key;if(a=t.timeStamp,Gm==="MediaLast"&&a<Fs+_u&&r.isComposing()&&h){if(Ze(null),Fs=0,setTimeout(()=>{Et(r,()=>{Ze(null)})},_u),q(o)){const p=o.anchor.getNode();p.markDirty(),W(p)||J(142),Zm(o,p)}}else{Ze(null),t.preventDefault();const p=o.anchor.getNode(),m=p.getTextContent(),y=p.canInsertTextAfter(),b=o.anchor.offset===0&&o.focus.offset===m.length;let _=Wf&&h&&!b&&y;if(_&&o.isCollapsed()&&(_=!ve(Eu(o.anchor,!0))),!_){Y(r,pn,!0);const x=K();Wf&&q(x)&&x.isCollapsed()&&(Or=x,setTimeout(()=>Or=null))}}return}}var a;if(!q(o))return;const l=t.data;Ci!==null&&Wd(!1,r,Ci),o.dirty&&Ci===null||!o.isCollapsed()||et(o.anchor.getNode())||s===null||o.applyDOMRange(s),Ci=null;const c=o.anchor,u=o.focus,f=c.getNode(),d=u.getNode();if(i!=="insertText"&&i!=="insertTranspose")switch(t.preventDefault(),i){case"insertFromYank":case"insertFromDrop":case"insertReplacementText":Y(r,$r,t);break;case"insertFromComposition":Ze(null),Y(r,$r,t);break;case"insertLineBreak":Ze(null),Y(r,nr,!1);break;case"insertParagraph":Ze(null),qs&&!Ii?(qs=!1,Y(r,nr,!1)):Y(r,Xs,void 0);break;case"insertFromPaste":case"insertFromPasteAsQuotation":Y(r,ti,t);break;case"deleteByComposition":(function(h,p){return h!==p||F(h)||F(p)||!Rr(h)||!Rr(p)})(f,d)&&Y(r,Va,t);break;case"deleteByDrag":case"deleteByCut":Y(r,Va,t);break;case"deleteContent":Y(r,pn,!1);break;case"deleteWordBackward":Y(r,Li,!0);break;case"deleteWordForward":Y(r,Li,!1);break;case"deleteHardLineBackward":case"deleteSoftLineBackward":Y(r,Di,!0);break;case"deleteContentForward":case"deleteHardLineForward":case"deleteSoftLineForward":Y(r,Di,!1);break;case"formatStrikeThrough":Y(r,Qn,"strikethrough");break;case"formatBold":Y(r,Qn,"bold");break;case"formatItalic":Y(r,Qn,"italic");break;case"formatUnderline":Y(r,Qn,"underline");break;case"historyUndo":Y(r,uo,void 0);break;case"historyRedo":Y(r,fo,void 0)}else{if(l===`
`)t.preventDefault(),Y(r,nr,!1);else if(l===Dn)t.preventDefault(),Y(r,Xs,void 0);else if(l==null&&t.dataTransfer){const h=t.dataTransfer.getData("text/plain");t.preventDefault(),o.insertRawText(h)}else l!=null&&Qm(o,s,l,t.timeStamp,!0)?(t.preventDefault(),Y(r,$r,l)):Ci=l;Ym=t.timeStamp}})}(n,e)]);let Fs=0,Gm=null,Ym=0,Ci=null;const Ya=new WeakMap;let vu=!1,ku=!1,qs=!1,Ts=!1,Pc=!1,Rc="",Or=null,Xm=[0,"",0,"root",0];function Qm(n,e,t,r,i){const s=n.anchor,o=n.focus,a=s.getNode(),l=Ie(),c=Yt(jt(l)),u=c!==null?c.anchorNode:null,f=s.key,d=l.getElementByKey(f),h=t.length;return f!==o.key||!W(a)||(!i&&(!qa||Ym<r+50)||a.isDirty()&&h<2||Ay(t))&&s.offset!==o.offset&&!a.isComposing()||An(a)||a.isDirty()&&h>1||(i||!qa)&&d!==null&&!a.isComposing()&&u!==Fi(d)||c!==null&&e!==null&&(!e.collapsed||e.startContainer!==c.anchorNode||e.startOffset!==c.anchorOffset)||a.getFormat()!==n.format||a.getStyle()!==n.style||function(p,m){if(m.isSegmented())return!0;if(!p.isCollapsed())return!1;const y=p.anchor.offset,b=m.getParentOrThrow(),_=Rr(m);return y===0?!m.canInsertTextBefore()||!b.canInsertTextBefore()&&!m.isComposing()||_||function(x){const T=x.getPreviousSibling();return(W(T)||F(T)&&T.isInline())&&!T.canInsertTextAfter()}(m):y===m.getTextContentSize()&&(!m.canInsertTextAfter()||!b.canInsertTextAfter()&&!m.isComposing()||_)}(n,a)}function rh(n,e){return Un(n)&&n.nodeValue!==null&&e!==0&&e!==n.nodeValue.length}function ih(n,e,t){const{anchorNode:r,anchorOffset:i,focusNode:s,focusOffset:o}=n;vu&&(vu=!1,rh(r,i)&&rh(s,o)&&!Or)||Et(e,()=>{if(!t)return void it(null);if(!_o(e,r,s))return;let a=K();if(Or&&q(a)&&a.isCollapsed()){const l=a.anchor,c=Or.anchor;(l.key===c.key&&l.offset===c.offset+1||l.offset===1&&c.getNode().is(l.getNode().getPreviousSibling()))&&(a=Or.clone(),it(a))}if(Or=null,q(a)){const l=a.anchor,c=l.getNode();if(a.isCollapsed()){n.type==="Range"&&n.anchorNode===n.focusNode&&(a.dirty=!0);const u=jt(e).event,f=u?u.timeStamp:performance.now(),[d,h,p,m,y]=Xm,b=me(),_=e.isComposing()===!1&&b.getTextContent()==="";if(f<y+200&&l.offset===p&&l.key===m)Na(a,d,h);else if(l.type==="text")W(c)||J(141),Zm(a,c);else if(l.type==="element"&&!_){F(c)||J(259);const x=l.getNode();x.isEmpty()?function(T,P){const M=P.getTextFormat(),L=P.getTextStyle();Na(T,M,L)}(a,x):Na(a,0,"")}}else{const u=l.key,f=a.focus.key,d=a.getNodes(),h=d.length,p=a.isBackward(),m=p?o:i,y=p?i:o,b=p?f:u,_=p?u:f;let x=Mk,T=!1;for(let P=0;P<h;P++){const M=d[P],L=M.getTextContentSize();if(W(M)&&L!==0&&!(P===0&&M.__key===b&&m===L||P===h-1&&M.__key===_&&y===0)&&(T=!0,x&=M.getFormat(),x===0))break}a.format=T?x:0}}Y(e,fr,void 0)})}function Na(n,e,t){n.format===e&&n.style===t||(n.format=e,n.style=t,n.dirty=!0)}function Zm(n,e){Na(n,e.getFormat(),e.getStyle())}function ey(n){if(!n.getTargetRanges)return null;const e=n.getTargetRanges();return e.length===0?null:e[0]}function Xo(n,e){const t=n._compositionKey;if(Ze(null),t!==null&&e!=null){if(e===""){const r=ce(t),i=Fi(n.getElementByKey(t));return void(i!==null&&i.nodeValue!==null&&W(r)&&Kd(r,i.nodeValue,null,null,!0))}if(e[e.length-1]===`
`){const r=K();if(q(r)){const i=r.focus;return r.anchor.set(i.key,i.offset,i.type),void Y(n,ji,null)}}}Wd(!0,n,e)}function ty(n){let e=n.__lexicalEventHandles;return e===void 0&&(e=[],n.__lexicalEventHandles=e),e}const Ei=new Map;function ny(n){const e=Rx(n.target);if(e===null)return;const t=Ty(e.anchorNode);if(t===null)return;ku&&(ku=!1,Et(t,()=>{const l=es(),c=e.anchorNode;(Te(c)||Un(c))&&it(Id(l,e,t,n))}));const r=zd(t),i=r[r.length-1],s=i._key,o=Ei.get(s),a=o||i;a!==t&&ih(e,a,!1),ih(e,t,!0),t!==i?Ei.set(s,t):o&&Ei.delete(s)}function sh(n){n._lexicalHandled=!0}function oh(n){return n._lexicalHandled===!0}function sx(n){const e=n.ownerDocument,t=Ya.get(e);if(t===void 0)return;const r=t-1;r>=0||J(164),Ya.set(e,r),r===0&&e.removeEventListener("selectionchange",ny);const i=Nl(n);Ud(i)?(function(o){if(o._parentEditor!==null){const a=zd(o),l=a[a.length-1]._key;Ei.get(l)===o&&Ei.delete(l)}else Ei.delete(o._key)}(i),n.__lexicalEditor=null):i&&J(198);const s=ty(n);for(let o=0;o<s.length;o++)s[o]();n.__lexicalEventHandles=[]}function xu(n,e,t){Qe();const r=n.__key,i=n.getParent();if(i===null)return;const s=function(a){const l=K();if(!q(l)||!F(a))return l;const{anchor:c,focus:u}=l,f=c.getNode(),d=u.getNode();return Nu(f,a)&&c.set(a.__key,0,"element"),Nu(d,a)&&u.set(a.__key,0,"element"),l}(n);let o=!1;if(q(s)&&e){const a=s.anchor,l=s.focus;a.key===r&&(Qa(a,n,i,n.getPreviousSibling(),n.getNextSibling()),o=!0),l.key===r&&(Qa(l,n,i,n.getPreviousSibling(),n.getNextSibling()),o=!0)}else pt(s)&&e&&n.isSelected()&&n.selectPrevious();if(q(s)&&e&&!o){const a=n.getIndexWithinParent();Lr(n),Xa(s,i,a,-1)}else Lr(n);t||vn(i)||i.canBeEmpty()||!i.isEmpty()||xu(i,e),e&&s&&et(i)&&i.isEmpty()&&i.selectEnd()}let Zi=class{static getType(){const{ownNodeType:e}=Gd(this);return e===void 0&&J(64,this.name),e}static clone(e){J(65,this.name)}$config(){return{}}config(e,t){const r=t.extends||Object.getPrototypeOf(this.constructor);return Object.assign(t,{extends:r,type:e}),{[e]:t}}afterCloneFrom(e){this.__key===e.__key?(this.__parent=e.__parent,this.__next=e.__next,this.__prev=e.__prev,this.__state=e.__state):e.__state&&(this.__state=e.__state.getWritable(this))}constructor(e){this.__type=this.constructor.getType(),this.__parent=null,this.__prev=null,this.__next=null,Object.defineProperty(this,"__state",{configurable:!0,enumerable:!1,value:void 0,writable:!0}),Nx(this,e)}getType(){return this.__type}isInline(){J(137,this.constructor.name)}isAttached(){let e=this.__key;for(;e!==null;){if(e==="root")return!0;const t=ce(e);if(t===null)break;e=t.__parent}return!1}isSelected(e){const t=e||K();if(t==null)return!1;const r=t.getNodes().some(i=>i.__key===this.__key);if(W(this))return r;if(q(t)&&t.anchor.type==="element"&&t.focus.type==="element"){if(t.isCollapsed())return!1;const i=this.getParent();if(ve(this)&&this.isInline()&&i){const s=t.isBackward()?t.focus:t.anchor;if(i.is(s.getNode())&&s.offset===i.getChildrenSize()&&this.is(i.getLastChild()))return!1}}return r}getKey(){return this.__key}getIndexWithinParent(){const e=this.getParent();if(e===null)return-1;let t=e.getFirstChild(),r=0;for(;t!==null;){if(this.is(t))return r;r++,t=t.getNextSibling()}return-1}getParent(){const e=this.getLatest().__parent;return e===null?null:ce(e)}getParentOrThrow(){const e=this.getParent();return e===null&&J(66,this.__key),e}getTopLevelElement(){let e=this;for(;e!==null;){const t=e.getParent();if(vn(t))return F(e)||e===this&&ve(e)||J(194),e;e=t}return null}getTopLevelElementOrThrow(){const e=this.getTopLevelElement();return e===null&&J(67,this.__key),e}getParents(){const e=[];let t=this.getParent();for(;t!==null;)e.push(t),t=t.getParent();return e}getParentKeys(){const e=[];let t=this.getParent();for(;t!==null;)e.push(t.__key),t=t.getParent();return e}getPreviousSibling(){const e=this.getLatest().__prev;return e===null?null:ce(e)}getPreviousSiblings(){const e=[],t=this.getParent();if(t===null)return e;let r=t.getFirstChild();for(;r!==null&&!r.is(this);)e.push(r),r=r.getNextSibling();return e}getNextSibling(){const e=this.getLatest().__next;return e===null?null:ce(e)}getNextSiblings(){const e=[];let t=this.getNextSibling();for(;t!==null;)e.push(t),t=t.getNextSibling();return e}getCommonAncestor(e){const t=F(this)?this:this.getParent(),r=F(e)?e:e.getParent(),i=t&&r?Us(t,r):null;return i?i.commonAncestor:null}is(e){return e!=null&&this.__key===e.__key}isBefore(e){const t=Us(this,e);return t!==null&&(t.type==="descendant"||(t.type==="branch"?By(t)===-1:(t.type!=="same"&&t.type!=="ancestor"&&J(279),!1)))}isParentOf(e){const t=Us(this,e);return t!==null&&t.type==="ancestor"}getNodesBetween(e){const t=this.isBefore(e),r=[],i=new Set;let s=this;for(;s!==null;){const o=s.__key;if(i.has(o)||(i.add(o),r.push(s)),s===e)break;const a=F(s)?t?s.getFirstChild():s.getLastChild():null;if(a!==null){s=a;continue}const l=t?s.getNextSibling():s.getPreviousSibling();if(l!==null){s=l;continue}const c=s.getParentOrThrow();if(i.has(c.__key)||r.push(c),c===e)break;let u=null,f=c;do{if(f===null&&J(68),u=t?f.getNextSibling():f.getPreviousSibling(),f=f.getParent(),f===null)break;u!==null||i.has(f.__key)||r.push(f)}while(u===null);s=u}return t||r.reverse(),r}isDirty(){const e=Ie()._dirtyLeaves;return e!==null&&e.has(this.__key)}getLatest(){const e=ce(this.__key);return e===null&&J(113),e}getWritable(){Qe();const e=gr(),t=Ie(),r=e._nodeMap,i=this.__key,s=this.getLatest(),o=t._cloneNotNeeded,a=K();if(a!==null&&a.setCachedNodes(null),o.has(i))return el(s),s;const l=Vd(s);return o.add(i),el(l),r.set(i,l),l}getTextContent(){return""}getTextContentSize(){return this.getTextContent().length}createDOM(e,t){J(70)}updateDOM(e,t,r){J(71)}exportDOM(e){return{element:this.createDOM(e._config,e)}}exportJSON(){const e=this.__state?this.__state.toJSON():void 0;return{type:this.__type,version:1,...e}}static importJSON(e){J(18,this.name)}updateFromJSON(e){return function(t,r){const i=t.getWritable(),s=r.$;let o=s;for(const a of jm(i).flatKeys)a in r&&(o!==void 0&&o!==s||(o={...s}),o[a]=r[a]);return(i.__state||o)&&Dm(t).updateFromJSON(o),i}(this,e)}static transform(){return null}remove(e){xu(this,!0,e)}replace(e,t){Qe();let r=K();r!==null&&(r=r.clone()),Bc(this,e);const i=this.getLatest(),s=this.__key,o=e.__key,a=e.getWritable(),l=this.getParentOrThrow().getWritable(),c=l.__size;Lr(a);const u=i.getPreviousSibling(),f=i.getNextSibling(),d=i.__prev,h=i.__next,p=i.__parent;if(xu(i,!1,!0),u===null?l.__first=o:u.getWritable().__next=o,a.__prev=d,f===null?l.__last=o:f.getWritable().__prev=o,a.__next=h,a.__parent=p,l.__size=c,t&&(F(this)&&F(a)||J(139),this.getChildren().forEach(m=>{a.append(m)})),q(r)){it(r);const m=r.anchor,y=r.focus;m.key===s&&uh(m,a),y.key===s&&uh(y,a)}return Zn()===s&&Ze(o),a}insertAfter(e,t=!0){Qe(),Bc(this,e);const r=this.getWritable(),i=e.getWritable(),s=i.getParent(),o=K();let a=!1,l=!1;if(s!==null){const h=e.getIndexWithinParent();if(Lr(i),q(o)){const p=s.__key,m=o.anchor,y=o.focus;a=m.type==="element"&&m.key===p&&m.offset===h+1,l=y.type==="element"&&y.key===p&&y.offset===h+1}}const c=this.getNextSibling(),u=this.getParentOrThrow().getWritable(),f=i.__key,d=r.__next;if(c===null?u.__last=f:c.getWritable().__prev=f,u.__size++,r.__next=f,i.__next=d,i.__prev=r.__key,i.__parent=r.__parent,t&&q(o)){const h=this.getIndexWithinParent();Xa(o,u,h+1);const p=u.__key;a&&o.anchor.set(p,h+2,"element"),l&&o.focus.set(p,h+2,"element")}return e}insertBefore(e,t=!0){Qe(),Bc(this,e);const r=this.getWritable(),i=e.getWritable(),s=i.__key;Lr(i);const o=this.getPreviousSibling(),a=this.getParentOrThrow().getWritable(),l=r.__prev,c=this.getIndexWithinParent();o===null?a.__first=s:o.getWritable().__next=s,a.__size++,r.__prev=s,i.__prev=l,i.__next=r.__key,i.__parent=r.__parent;const u=K();return t&&q(u)&&Xa(u,this.getParentOrThrow(),c),e}isParentRequired(){return!1}createParentElementNode(){return Ot()}selectStart(){return this.selectPrevious()}selectEnd(){return this.selectNext(0,0)}selectPrevious(e,t){Qe();const r=this.getPreviousSibling(),i=this.getParentOrThrow();if(r===null)return i.select(0,0);if(F(r))return r.select();if(!W(r)){const s=r.getIndexWithinParent()+1;return i.select(s,s)}return r.select(e,t)}selectNext(e,t){Qe();const r=this.getNextSibling(),i=this.getParentOrThrow();if(r===null)return i.select();if(F(r))return r.select(0,0);if(!W(r)){const s=r.getIndexWithinParent();return i.select(s,s)}return r.select(e,t)}markDirty(){this.getWritable()}reconcileObservedMutation(e,t){this.markDirty()}},ho=class ry extends Zi{static getType(){return"linebreak"}static clone(e){return new ry(e.__key)}constructor(e){super(e)}getTextContent(){return`
`}createDOM(){return document.createElement("br")}updateDOM(){return!1}isInline(){return!0}static importDOM(){return{br:e=>function(t){const r=t.parentElement;if(r!==null&&tl(r)){const i=r.firstChild;if(i===t||i.nextSibling===t&&Qo(i)){const s=r.lastChild;if(s===t||s.previousSibling===t&&Qo(s))return!0}}return!1}(e)||function(t){const r=t.parentElement;if(r!==null&&tl(r)){const i=r.firstChild;if(i===t||i.nextSibling===t&&Qo(i))return!1;const s=r.lastChild;if(s===t||s.previousSibling===t&&Qo(s))return!0}return!1}(e)?null:{conversion:ox,priority:0}}}static importJSON(e){return Ur().updateFromJSON(e)}};function ox(n){return{node:Ur()}}function Ur(){return Ae(new ho)}function Ir(n){return n instanceof ho}function Qo(n){return Un(n)&&/^( |\t|\r?\n)+$/.test(n.textContent||"")}function Lc(n,e){return 16&e?"code":e&pd?"mark":32&e?"sub":64&e?"sup":null}function Dc(n,e){return 1&e?"strong":2&e?"em":"span"}function iy(n,e,t,r,i){const s=r.classList;let o=Mi(i,"base");o!==void 0&&s.add(...o),o=Mi(i,"underlineStrikethrough");let a=!1;const l=e&Wa&&e&za;o!==void 0&&(t&Wa&&t&za?(a=!0,l||s.add(...o)):l&&s.remove(...o));for(const c in sr){const u=sr[c];if(o=Mi(i,c),o!==void 0)if(t&u){if(a&&(c==="underline"||c==="strikethrough")){e&u&&s.remove(...o);continue}e&u&&(!l||c!=="underline")&&c!=="strikethrough"||s.add(...o)}else e&u&&s.remove(...o)}}function sy(n,e,t){const r=e.firstChild,i=t.isComposing(),s=n+(i?vl:"");if(r==null)e.textContent=s;else{const o=r.nodeValue;if(o!==s)if(i||Fr){const[a,l,c]=function(u,f){const d=u.length,h=f.length;let p=0,m=0;for(;p<d&&p<h&&u[p]===f[p];)p++;for(;m+p<d&&m+p<h&&u[d-m-1]===f[h-m-1];)m++;return[p,d-p-m,f.slice(p,h-m)]}(o,s);l!==0&&r.deleteData(a,l),r.insertData(a,c)}else r.nodeValue=s}}function ah(n,e,t,r,i,s){sy(i,n,e);const o=s.theme.text;o!==void 0&&iy(0,0,r,n,o)}function Zo(n,e){const t=document.createElement(e);return t.appendChild(n),t}let At=class oy extends Zi{static getType(){return"text"}static clone(e){return new oy(e.__text,e.__key)}afterCloneFrom(e){super.afterCloneFrom(e),this.__text=e.__text,this.__format=e.__format,this.__style=e.__style,this.__mode=e.__mode,this.__detail=e.__detail}constructor(e="",t){super(t),this.__text=e,this.__format=0,this.__style="",this.__mode=0,this.__detail=0}getFormat(){return this.getLatest().__format}getDetail(){return this.getLatest().__detail}getMode(){const e=this.getLatest();return Lk[e.__mode]}getStyle(){return this.getLatest().__style}isToken(){return this.getLatest().__mode===1}isComposing(){return this.__key===Zn()}isSegmented(){return this.getLatest().__mode===2}isDirectionless(){return!!(1&this.getLatest().__detail)}isUnmergeable(){return!!(2&this.getLatest().__detail)}hasFormat(e){const t=sr[e];return!!(this.getFormat()&t)}isSimpleText(){return this.__type==="text"&&this.__mode===0}getTextContent(){return this.getLatest().__text}getFormatFlags(e,t){return Za(this.getLatest().__format,e,t)}canHaveFormat(){return!0}isInline(){return!0}createDOM(e,t){const r=this.__format,i=Lc(0,r),s=Dc(0,r),o=i===null?s:i,a=document.createElement(o);let l=a;this.hasFormat("code")&&a.setAttribute("spellcheck","false"),i!==null&&(l=document.createElement(s),a.appendChild(l)),ah(l,this,0,r,this.__text,e);const c=this.__style;return c!==""&&(a.style.cssText=c),a}updateDOM(e,t,r){const i=this.__text,s=e.__format,o=this.__format,a=Lc(0,s),l=Lc(0,o),c=Dc(0,s),u=Dc(0,o);if((a===null?c:a)!==(l===null?u:l))return!0;if(a===l&&c!==u){const m=t.firstChild;m==null&&J(48);const y=document.createElement(u);return ah(y,this,0,o,i,r),t.replaceChild(y,m),!1}let f=t;l!==null&&a!==null&&(f=t.firstChild,f==null&&J(49)),sy(i,f,this);const d=r.theme.text;d!==void 0&&s!==o&&iy(0,s,o,f,d);const h=e.__style,p=this.__style;return h!==p&&(t.style.cssText=p),!1}static importDOM(){return{"#text":()=>({conversion:ux,priority:0}),b:()=>({conversion:lx,priority:0}),code:()=>({conversion:En,priority:0}),em:()=>({conversion:En,priority:0}),i:()=>({conversion:En,priority:0}),mark:()=>({conversion:En,priority:0}),s:()=>({conversion:En,priority:0}),span:()=>({conversion:ax,priority:0}),strong:()=>({conversion:En,priority:0}),sub:()=>({conversion:En,priority:0}),sup:()=>({conversion:En,priority:0}),u:()=>({conversion:En,priority:0})}}static importJSON(e){return de().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setTextContent(e.text).setFormat(e.format).setDetail(e.detail).setMode(e.mode).setStyle(e.style)}exportDOM(e){let{element:t}=super.exportDOM(e);return Te(t)||J(132),t.style.whiteSpace="pre-wrap",this.hasFormat("lowercase")?t.style.textTransform="lowercase":this.hasFormat("uppercase")?t.style.textTransform="uppercase":this.hasFormat("capitalize")&&(t.style.textTransform="capitalize"),this.hasFormat("bold")&&(t=Zo(t,"b")),this.hasFormat("italic")&&(t=Zo(t,"i")),this.hasFormat("strikethrough")&&(t=Zo(t,"s")),this.hasFormat("underline")&&(t=Zo(t,"u")),{element:t}}exportJSON(){return{detail:this.getDetail(),format:this.getFormat(),mode:this.getMode(),style:this.getStyle(),text:this.getTextContent(),...super.exportJSON()}}selectionTransform(e,t){}setFormat(e){const t=this.getWritable();return t.__format=typeof e=="string"?sr[e]:e,t}setDetail(e){const t=this.getWritable();return t.__detail=typeof e=="string"?Ik[e]:e,t}setStyle(e){const t=this.getWritable();return t.__style=e,t}toggleFormat(e){const t=Za(this.getFormat(),e,null);return this.setFormat(t)}toggleDirectionless(){const e=this.getWritable();return e.__detail^=1,e}toggleUnmergeable(){const e=this.getWritable();return e.__detail^=2,e}setMode(e){const t=Rk[e];if(this.__mode===t)return this;const r=this.getWritable();return r.__mode=t,r}setTextContent(e){if(this.__text===e)return this;const t=this.getWritable();return t.__text=e,t}select(e,t){Qe();let r=e,i=t;const s=K(),o=this.getTextContent(),a=this.__key;if(typeof o=="string"){const l=o.length;r===void 0&&(r=l),i===void 0&&(i=l)}else r=0,i=0;if(!q(s))return hy(a,r,a,i,"text","text");{const l=Zn();l!==s.anchor.key&&l!==s.focus.key||Ze(a),s.setTextNodeRange(this,r,this,i)}return s}selectStart(){return this.select(0,0)}selectEnd(){const e=this.getTextContentSize();return this.select(e,e)}spliceText(e,t,r,i){const s=this.getWritable(),o=s.__text,a=r.length;let l=e;l<0&&(l=a+l,l<0&&(l=0));const c=K();if(i&&q(c)){const f=e+a;c.setTextNodeRange(s,f,s,f)}const u=o.slice(0,l)+r+o.slice(l+t);return s.__text=u,s}canInsertTextBefore(){return!0}canInsertTextAfter(){return!0}splitText(...e){Qe();const t=this.getLatest(),r=t.getTextContent();if(r==="")return[];const i=t.__key,s=Zn(),o=r.length;e.sort((A,I)=>A-I),e.push(o);const a=[],l=e.length;for(let A=0,I=0;A<o&&I<=l;I++){const B=e[I];B>A&&(a.push(r.slice(A,B)),A=B)}const c=a.length;if(c===1)return[t];const u=a[0],f=t.getParent();let d;const h=t.getFormat(),p=t.getStyle(),m=t.__detail;let y=!1,b=null,_=null;const x=K();if(q(x)){const[A,I]=x.isBackward()?[x.focus,x.anchor]:[x.anchor,x.focus];A.type==="text"&&A.key===i&&(b=A),I.type==="text"&&I.key===i&&(_=I)}t.isSegmented()?(d=de(u),d.__format=h,d.__style=p,d.__detail=m,d.__state=Yf(t,d),y=!0):d=t.setTextContent(u);const T=[d];for(let A=1;A<c;A++){const I=de(a[A]);I.__format=h,I.__style=p,I.__detail=m,I.__state=Yf(t,I);const B=I.__key;s===i&&Ze(B),T.push(I)}const P=b?b.offset:null,M=_?_.offset:null;let L=0;for(const A of T){if(!b&&!_)break;const I=L+A.getTextContentSize();if(b!==null&&P!==null&&P<=I&&P>=L&&(b.set(A.getKey(),P-L,"text"),P<I&&(b=null)),_!==null&&M!==null&&M<=I&&M>=L){_.set(A.getKey(),M-L,"text");break}L=I}if(f!==null){(function(B){const k=B.getPreviousSibling(),N=B.getNextSibling();k!==null&&el(k),N!==null&&el(N)})(this);const A=f.getWritable(),I=this.getIndexWithinParent();y?(A.splice(I,0,T),this.remove()):A.splice(I,1,T),q(x)&&Xa(x,f,I,c-1)}return T}mergeWithSibling(e){const t=e===this.getPreviousSibling();t||e===this.getNextSibling()||J(50);const r=this.__key,i=e.__key,s=this.__text,o=s.length;Zn()===i&&Ze(r);const a=K();if(q(a)){const f=a.anchor,d=a.focus;f!==null&&f.key===i&&yh(f,t,r,e,o),d!==null&&d.key===i&&yh(d,t,r,e,o)}const l=e.__text,c=t?l+s:s+l;this.setTextContent(c);const u=this.getWritable();return e.remove(),u}isTextEntity(){return!1}};function ax(n){return{forChild:$d(n.style),node:null}}function lx(n){const e=n,t=e.style.fontWeight==="normal";return{forChild:$d(e.style,t?void 0:"bold"),node:null}}const lh=new WeakMap;function cx(n){if(!Te(n))return!1;if(n.nodeName==="PRE")return!0;const e=n.style.whiteSpace;return typeof e=="string"&&e.startsWith("pre")}function ux(n){const e=n;n.parentElement===null&&J(129);let t=e.textContent||"";if(function(r){let i,s=r.parentNode;const o=[r];for(;s!==null&&(i=lh.get(s))===void 0&&!cx(s);)o.push(s),s=s.parentNode;const a=i===void 0?s:i;for(let l=0;l<o.length;l++)lh.set(o[l],a);return a}(e)!==null){const r=t.split(/(\r?\n|\t)/),i=[],s=r.length;for(let o=0;o<s;o++){const a=r[o];a===`
`||a===`\r
`?i.push(Ur()):a==="	"?i.push(po()):a!==""&&i.push(de(a))}return{node:i}}if(t=t.replace(/\r/g,"").replace(/[ \t\n]+/g," "),t==="")return{node:null};if(t[0]===" "){let r=e,i=!0;for(;r!==null&&(r=ch(r,!1))!==null;){const s=r.textContent||"";if(s.length>0){/[ \t\n]$/.test(s)&&(t=t.slice(1)),i=!1;break}}i&&(t=t.slice(1))}if(t[t.length-1]===" "){let r=e,i=!0;for(;r!==null&&(r=ch(r,!0))!==null;)if((r.textContent||"").replace(/^( |\t|\r?\n)+/,"").length>0){i=!1;break}i&&(t=t.slice(0,t.length-1))}return t===""?{node:null}:{node:de(t)}}function ch(n,e){let t=n;for(;;){let r;for(;(r=e?t.nextSibling:t.previousSibling)===null;){const s=t.parentElement;if(s===null)return null;t=s}if(t=r,Te(t)){const s=t.style.display;if(s===""&&!Ou(t)||s!==""&&!s.startsWith("inline"))return null}let i=t;for(;(i=e?t.firstChild:t.lastChild)!==null;)t=i;if(Un(t))return t;if(t.nodeName==="BR")return null}}const dx={code:"code",em:"italic",i:"italic",mark:"highlight",s:"strikethrough",strong:"bold",sub:"subscript",sup:"superscript",u:"underline"};function En(n){const e=dx[n.nodeName.toLowerCase()];return e===void 0?{node:null}:{forChild:$d(n.style,e),node:null}}function de(n=""){return Ae(new At(n))}function W(n){return n instanceof At}function $d(n,e){const t=n.fontWeight,r=n.textDecoration.split(" "),i=t==="700"||t==="bold",s=r.includes("line-through"),o=n.fontStyle==="italic",a=r.includes("underline"),l=n.verticalAlign;return c=>(W(c)&&(i&&!c.hasFormat("bold")&&c.toggleFormat("bold"),s&&!c.hasFormat("strikethrough")&&c.toggleFormat("strikethrough"),o&&!c.hasFormat("italic")&&c.toggleFormat("italic"),a&&!c.hasFormat("underline")&&c.toggleFormat("underline"),l!=="sub"||c.hasFormat("subscript")||c.toggleFormat("subscript"),l!=="super"||c.hasFormat("superscript")||c.toggleFormat("superscript"),e&&!c.hasFormat(e)&&c.toggleFormat(e)),c)}class go extends At{static getType(){return"tab"}static clone(e){return new go(e.__key)}constructor(e){super("	",e),this.__detail=2}static importDOM(){return null}createDOM(e){const t=super.createDOM(e),r=Mi(e.theme,"tab");return r!==void 0&&t.classList.add(...r),t}static importJSON(e){return po().updateFromJSON(e)}setTextContent(e){return e!=="	"&&e!==""&&J(126),super.setTextContent("	")}spliceText(e,t,r,i){return r===""&&t===0||r==="	"&&t===1||J(286),this}setDetail(e){return e!==2&&J(127),this}setMode(e){return e!=="normal"&&J(128),this}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}}function po(){return Ae(new go)}function ay(n){return n instanceof go}class fx{constructor(e,t,r){this._selection=null,this.key=e,this.offset=t,this.type=r}is(e){return this.key===e.key&&this.offset===e.offset&&this.type===e.type}isBefore(e){return this.key===e.key?this.offset<e.offset:qy(gn(jn(this,"next")),gn(jn(e,"next")))<0}getNode(){const e=ce(this.key);return e===null&&J(20),e}set(e,t,r,i){const s=this._selection,o=this.key;i&&this.key===e&&this.offset===t&&this.type===r||(this.key=e,this.offset=t,this.type=r,ts()||(Zn()===o&&Ze(e),s!==null&&(s.setCachedNodes(null),s.dirty=!0)))}}function wt(n,e,t){return new fx(n,e,t)}function jc(n,e){let t=e.__key,r=n.offset,i="element";if(W(e)){i="text";const s=e.getTextContentSize();r>s&&(r=s)}else if(!F(e)){const s=e.getNextSibling();if(W(s))t=s.__key,r=0,i="text";else{const o=e.getParent();o&&(t=o.__key,r=e.getIndexWithinParent()+1)}}n.set(t,r,i)}function uh(n,e){if(F(e)){const t=e.getLastDescendant();F(t)||W(t)?jc(n,t):jc(n,e)}else jc(n,e)}let ly=class cy{constructor(e){this._cachedNodes=null,this._nodes=e,this.dirty=!1}getCachedNodes(){return this._cachedNodes}setCachedNodes(e){this._cachedNodes=e}is(e){if(!pt(e))return!1;const t=this._nodes,r=e._nodes;return t.size===r.size&&Array.from(t).every(i=>r.has(i))}isCollapsed(){return!1}isBackward(){return!1}getStartEndPoints(){return null}add(e){this.dirty=!0,this._nodes.add(e),this._cachedNodes=null}delete(e){this.dirty=!0,this._nodes.delete(e),this._cachedNodes=null}clear(){this.dirty=!0,this._nodes.clear(),this._cachedNodes=null}has(e){return this._nodes.has(e)}clone(){return new cy(new Set(this._nodes))}extract(){return this.getNodes()}insertRawText(e){}insertText(){}insertNodes(e){const t=this.getNodes(),r=t.length,i=t[r-1];let s;if(W(i))s=i.select();else{const o=i.getIndexWithinParent()+1;s=i.getParentOrThrow().select(o,o)}s.insertNodes(e);for(let o=0;o<r;o++)t[o].remove()}getNodes(){const e=this._cachedNodes;if(e!==null)return e;const t=this._nodes,r=[];for(const i of t){const s=ce(i);s!==null&&r.push(s)}return ts()||(this._cachedNodes=r),r}getTextContent(){const e=this.getNodes();let t="";for(let r=0;r<e.length;r++)t+=e[r].getTextContent();return t}deleteNodes(){const e=this.getNodes();if((K()||es())===this&&e[0]){const t=Be(e[0],"next");Gx(lr(t,t))}for(const t of e)t.remove()}};function q(n){return n instanceof mo}let mo=class uy{constructor(e,t,r,i){this.anchor=e,this.focus=t,e._selection=this,t._selection=this,this._cachedNodes=null,this.format=r,this.style=i,this.dirty=!1}getCachedNodes(){return this._cachedNodes}setCachedNodes(e){this._cachedNodes=e}is(e){return!!q(e)&&this.anchor.is(e.anchor)&&this.focus.is(e.focus)&&this.format===e.format&&this.style===e.style}isCollapsed(){return this.anchor.is(this.focus)}getNodes(){const e=this._cachedNodes;if(e!==null)return e;const t=function(r){const i=[],[s,o]=r.getTextSlices();s&&i.push(s.caret.origin);const a=new Set,l=new Set;for(const c of r)if(Jt(c)){const{origin:u}=c;i.length===0?a.add(u):(l.add(u),i.push(u))}else{const{origin:u}=c;F(u)&&l.has(u)||i.push(u)}if(o&&i.push(o.caret.origin),zr(r.focus)&&F(r.focus.origin)&&r.focus.getNodeAtCaret()===null)for(let c=Xt(r.focus.origin,"previous");Jt(c)&&a.has(c.origin)&&!c.origin.isEmpty()&&c.origin.is(i[i.length-1]);c=Qs(c))a.delete(c.origin),i.pop();for(;i.length>1;){const c=i[i.length-1];if(!F(c)||l.has(c)||c.isEmpty()||a.has(c))break;i.pop()}if(i.length===0&&r.isCollapsed()){const c=gn(r.anchor),u=gn(r.anchor.getFlipped()),f=h=>rr(h)?h.origin:h.getNodeAtCaret(),d=f(c)||f(u)||(r.anchor.getNodeAtCaret()?c.origin:u.origin);i.push(d)}return i}(zy(Dh(this),"next"));return ts()||(this._cachedNodes=t),t}setTextNodeRange(e,t,r,i){this.anchor.set(e.__key,t,"text"),this.focus.set(r.__key,i,"text")}getTextContent(){const e=this.getNodes();if(e.length===0)return"";const t=e[0],r=e[e.length-1],i=this.anchor,s=this.focus,o=i.isBefore(s),[a,l]=Cu(this);let c="",u=!0;for(let f=0;f<e.length;f++){const d=e[f];if(F(d)&&!d.isInline())u||(c+=`
`),u=!d.isEmpty();else if(u=!1,W(d)){let h=d.getTextContent();d===t?d===r?i.type==="element"&&s.type==="element"&&s.offset!==i.offset||(h=a<l?h.slice(a,l):h.slice(l,a)):h=o?h.slice(a):h.slice(l):d===r&&(h=o?h.slice(0,l):h.slice(0,a)),c+=h}else!ve(d)&&!Ir(d)||d===r&&this.isCollapsed()||(c+=d.getTextContent())}return c}applyDOMRange(e){const t=Ie(),r=t.getEditorState()._selection,i=fy(e.startContainer,e.startOffset,e.endContainer,e.endOffset,t,r);if(i===null)return;const[s,o]=i;this.anchor.set(s.key,s.offset,s.type,!0),this.focus.set(o.key,o.offset,o.type,!0),Js(this)}clone(){const e=this.anchor,t=this.focus;return new uy(wt(e.key,e.offset,e.type),wt(t.key,t.offset,t.type),this.format,this.style)}toggleFormat(e){this.format=Za(this.format,e,null),this.dirty=!0}setFormat(e){this.format=e,this.dirty=!0}setStyle(e){this.style=e,this.dirty=!0}hasFormat(e){const t=sr[e];return!!(this.format&t)}insertRawText(e){const t=e.split(/(\r?\n|\t)/),r=[],i=t.length;for(let s=0;s<i;s++){const o=t[s];o===`
`||o===`\r
`?r.push(Ur()):o==="	"?r.push(po()):r.push(de(o))}this.insertNodes(r)}insertText(e){const t=this.anchor,r=this.focus,i=this.format,s=this.style;let o=t,a=r;!this.isCollapsed()&&r.isBefore(t)&&(o=r,a=t),o.type==="element"&&function(y,b,_,x){const T=y.getNode(),P=T.getChildAtIndex(y.offset),M=de(),L=et(T)?Ot().append(M):M;M.setFormat(_),M.setStyle(x),P===null?T.append(L):P.insertBefore(L),y.is(b)&&b.set(M.__key,0,"text"),y.set(M.__key,0,"text")}(o,a,i,s),a.type==="element"&&Zs(a,gn(jn(a,"next")));const l=o.offset;let c=a.offset;const u=this.getNodes(),f=u.length;let d=u[0];W(d)||J(26);const h=d.getTextContent().length,p=d.getParentOrThrow();let m=u[f-1];if(f===1&&a.type==="element"&&(c=h,a.set(o.key,c,"text")),this.isCollapsed()&&l===h&&(An(d)||!d.canInsertTextAfter()||!p.canInsertTextAfter()&&d.getNextSibling()===null)){let y=d.getNextSibling();if(W(y)&&y.canInsertTextBefore()&&!An(y)||(y=de(),y.setFormat(i),y.setStyle(s),p.canInsertTextAfter()?d.insertAfter(y):p.insertAfter(y)),y.select(0,0),d=y,e!=="")return void this.insertText(e)}else if(this.isCollapsed()&&l===0&&(An(d)||!d.canInsertTextBefore()||!p.canInsertTextBefore()&&d.getPreviousSibling()===null)){let y=d.getPreviousSibling();if(W(y)&&!An(y)||(y=de(),y.setFormat(i),p.canInsertTextBefore()?d.insertBefore(y):p.insertBefore(y)),y.select(),d=y,e!=="")return void this.insertText(e)}else if(d.isSegmented()&&l!==h){const y=de(d.getTextContent());y.setFormat(i),d.replace(y),d=y}else if(!this.isCollapsed()&&e!==""){const y=m.getParent();if(!p.canInsertTextBefore()||!p.canInsertTextAfter()||F(y)&&(!y.canInsertTextBefore()||!y.canInsertTextAfter()))return this.insertText(""),dy(this.anchor,this.focus,null),void this.insertText(e)}if(f===1){if(Rr(d)){const x=de(e);return x.select(),void d.replace(x)}const y=d.getFormat(),b=d.getStyle();if(l!==c||y===i&&b===s){if(ay(d)){const x=de(e);return x.setFormat(i),x.setStyle(s),x.select(),void d.replace(x)}}else{if(d.getTextContent()!==""){const x=de(e);if(x.setFormat(i),x.setStyle(s),x.select(),l===0)d.insertBefore(x,!1);else{const[T]=d.splitText(l);T.insertAfter(x,!1)}return void(x.isComposing()&&this.anchor.type==="text"&&(this.anchor.offset-=e.length))}d.setFormat(i),d.setStyle(s)}const _=c-l;d=d.spliceText(l,_,e,!0),d.getTextContent()===""?d.remove():this.anchor.type==="text"&&(d.isComposing()?this.anchor.offset-=e.length:(this.format=y,this.style=b))}else{const y=new Set([...d.getParentKeys(),...m.getParentKeys()]),b=F(d)?d:d.getParentOrThrow();let _=F(m)?m:m.getParentOrThrow(),x=m;if(!b.is(_)&&_.isInline())do x=_,_=_.getParentOrThrow();while(_.isInline());if(a.type==="text"&&(c!==0||m.getTextContent()==="")||a.type==="element"&&m.getIndexWithinParent()<c)if(W(m)&&!Rr(m)&&c!==m.getTextContentSize()){if(m.isSegmented()){const A=de(m.getTextContent());m.replace(A),m=A}et(a.getNode())||a.type!=="text"||(m=m.spliceText(0,c,"")),y.add(m.__key)}else{const A=m.getParentOrThrow();A.canBeEmpty()||A.getChildrenSize()!==1?m.remove():A.remove()}else y.add(m.__key);const T=_.getChildren(),P=new Set(u),M=b.is(_),L=b.isInline()&&d.getNextSibling()===null?b:d;for(let A=T.length-1;A>=0;A--){const I=T[A];if(I.is(d)||F(I)&&I.isParentOf(d))break;I.isAttached()&&(!P.has(I)||I.is(x)?M||L.insertAfter(I,!1):I.remove())}if(!M){let A=_,I=null;for(;A!==null;){const B=A.getChildren(),k=B.length;(k===0||B[k-1].is(I))&&(y.delete(A.__key),I=A),A=A.getParent()}}if(Rr(d))if(l===h)d.select();else{const A=de(e);A.select(),d.replace(A)}else d=d.spliceText(l,h-l,e,!0),d.getTextContent()===""?d.remove():d.isComposing()&&this.anchor.type==="text"&&(this.anchor.offset-=e.length);for(let A=1;A<f;A++){const I=u[A],B=I.__key;y.has(B)||I.remove()}}}removeText(){const e=K()===this;$a(this,Yx(Dh(this))),e&&K()!==this&&it(this)}formatText(e,t=null){if(this.isCollapsed())return this.toggleFormat(e),void Ze(null);const r=this.getNodes(),i=[];for(const T of r)W(T)&&i.push(T);const s=T=>{r.forEach(P=>{if(F(P)){const M=P.getFormatFlags(e,T);P.setTextFormat(M)}})},o=i.length;if(o===0)return this.toggleFormat(e),Ze(null),void s(t);const a=this.anchor,l=this.focus,c=this.isBackward(),u=c?l:a,f=c?a:l;let d=0,h=i[0],p=u.type==="element"?0:u.offset;if(u.type==="text"&&p===h.getTextContentSize()&&(d=1,h=i[1],p=0),h==null)return;const m=h.getFormatFlags(e,t);s(m);const y=o-1;let b=i[y];const _=f.type==="text"?f.offset:b.getTextContentSize();if(h.is(b)){if(p===_)return;if(An(h)||p===0&&_===h.getTextContentSize())h.setFormat(m);else{const T=h.splitText(p,_),P=p===0?T[0]:T[1];P.setFormat(m),u.type==="text"&&u.set(P.__key,0,"text"),f.type==="text"&&f.set(P.__key,_-p,"text")}return void(this.format=m)}p===0||An(h)||([,h]=h.splitText(p),p=0),h.setFormat(m);const x=b.getFormatFlags(e,m);_>0&&(_===b.getTextContentSize()||An(b)||([b]=b.splitText(_)),b.setFormat(x));for(let T=d+1;T<y;T++){const P=i[T],M=P.getFormatFlags(e,x);P.setFormat(M)}u.type==="text"&&u.set(h.__key,p,"text"),f.type==="text"&&f.set(b.__key,_,"text"),this.format=m|x}insertNodes(e){if(e.length===0)return;if(this.isCollapsed()||this.removeText(),this.anchor.key==="root"){this.insertParagraph();const p=K();return q(p)||J(134),p.insertNodes(e)}const t=(this.isBackward()?this.focus:this.anchor).getNode(),r=zc(t,Rt),i=e[e.length-1];if(F(r)&&"__language"in r){if("__language"in e[0])this.insertText(e[0].getTextContent());else{const p=Fc(this);r.splice(p,0,e),i.selectEnd()}return}if(!e.some(p=>(F(p)||ve(p))&&!p.isInline())){F(r)||J(211,t.constructor.name,t.getType());const p=Fc(this);return r.splice(p,0,e),void i.selectEnd()}const s=function(p){const m=Ot();let y=null;for(let b=0;b<p.length;b++){const _=p[b],x=Ir(_);if(x||ve(_)&&_.isInline()||F(_)&&_.isInline()||W(_)||_.isParentRequired()){if(y===null&&(y=_.createParentElementNode(),m.append(y),x))continue;y!==null&&y.append(_)}else m.append(_),y=null}return m}(e),o=s.getLastDescendant(),a=s.getChildren(),l=!F(r)||!r.isEmpty()?this.insertParagraph():null,c=a[a.length-1];let u=a[0];var f;F(f=u)&&Rt(f)&&!f.isEmpty()&&F(r)&&(!r.isEmpty()||r.canMergeWhenEmpty())&&(F(r)||J(211,t.constructor.name,t.getType()),r.append(...u.getChildren()),u=a[1]),u&&(r===null&&J(212,t.constructor.name,t.getType()),function(p,m,y){const b=m.getParentOrThrow().getLastChild();let _=m;const x=[m];for(;_!==b;)_.getNextSibling()||J(140),_=_.getNextSibling(),x.push(_);let T=p;for(const P of x)T=T.insertAfter(P)}(r,u));const d=zc(o,Rt);l&&F(d)&&(l.canMergeWhenEmpty()||Rt(c))&&(d.append(...l.getChildren()),l.remove()),F(r)&&r.isEmpty()&&r.remove(),o.selectEnd();const h=F(r)?r.getLastChild():null;Ir(h)&&d!==r&&h.remove()}insertParagraph(){if(this.anchor.key==="root"){const o=Ot();return me().splice(this.anchor.offset,0,[o]),o.select(),o}const e=Fc(this),t=zc(this.anchor.getNode(),Rt);F(t)||J(213);const r=t.getChildAtIndex(e),i=r?[r,...r.getNextSiblings()]:[],s=t.insertNewAfter(this,!1);return s?(s.append(...i),s.selectStart(),s):null}insertLineBreak(e){const t=Ur();if(this.insertNodes([t]),e){const r=t.getParentOrThrow(),i=t.getIndexWithinParent();r.select(i,i)}}extract(){const e=this.getNodes(),t=e.length,r=t-1,i=this.anchor,s=this.focus;let o=e[0],a=e[r];const[l,c]=Cu(this);if(t===0)return[];if(t===1){if(W(o)&&!this.isCollapsed()){const f=l>c?c:l,d=l>c?l:c,h=o.splitText(f,d),p=f===0?h[0]:h[1];return p!=null?[p]:[]}return[o]}const u=i.isBefore(s);if(W(o)){const f=u?l:c;f===o.getTextContentSize()?e.shift():f!==0&&([,o]=o.splitText(f),e[0]=o)}if(W(a)){const f=a.getTextContent().length,d=u?c:l;d===0?e.pop():d!==f&&([a]=a.splitText(d),e[r]=a)}return e}modify(e,t,r){if(_h(this,e,t,r))return;const i=e==="move",s=Ie(),o=Yt(jt(s));if(!o)return;const a=s._blockCursorElement,l=s._rootElement,c=this.focus.getNode();if(l===null||a===null||!F(c)||c.isInline()||c.canBeEmpty()||Mu(a,s,l),this.dirty){let u=qi(s,this.anchor.key),f=qi(s,this.focus.key);this.anchor.type==="text"&&(u=Fi(u)),this.focus.type==="text"&&(f=Fi(f)),u&&f&&py(o,u,this.anchor.offset,f,this.focus.offset)}if(function(u,f,d,h){u.modify(f,d,h)}(o,e,t?"backward":"forward",r),o.rangeCount>0){const u=o.getRangeAt(0),f=this.anchor.getNode(),d=et(f)?f:Ix(f);if(this.applyDOMRange(u),this.dirty=!0,!i){const h=this.getNodes(),p=[];let m=!1;for(let y=0;y<h.length;y++){const b=h[y];Nu(b,d)?p.push(b):m=!0}if(m&&p.length>0)if(t){const y=p[0];F(y)?y.selectStart():y.getParentOrThrow().selectStart()}else{const y=p[p.length-1];F(y)?y.selectEnd():y.getParentOrThrow().selectEnd()}o.anchorNode===u.startContainer&&o.anchorOffset===u.startOffset||function(y){const b=y.focus,_=y.anchor,x=_.key,T=_.offset,P=_.type;_.set(b.key,b.offset,b.type,!0),b.set(x,T,P,!0)}(this)}}r==="lineboundary"&&_h(this,e,t,r,"decorators")}forwardDeletion(e,t,r){if(!r&&(e.type==="element"&&F(t)&&e.offset===t.getChildrenSize()||e.type==="text"&&e.offset===t.getTextContentSize())){const i=t.getParent(),s=t.getNextSibling()||(i===null?null:i.getNextSibling());if(F(s)&&s.isShadowRoot())return!0}return!1}deleteCharacter(e){const t=this.isCollapsed();if(this.isCollapsed()){const r=this.anchor;let i=r.getNode();if(this.forwardDeletion(r,i,e))return;const s=Qd(jn(r,e?"previous":"next"));if(s.getTextSlices().every(a=>a===null||a.distance===0)){let a={type:"initial"};for(const l of s.iterNodeCarets("shadowRoot"))if(Jt(l)){if(!l.origin.isInline()){if(l.origin.isShadowRoot()){if(a.type==="merge-block")break;if(F(s.anchor.origin)&&s.anchor.origin.isEmpty()){const c=gn(l);$a(this,lr(c,c)),s.anchor.origin.remove()}return}a.type!=="merge-next-block"&&a.type!=="merge-block"||(a={block:a.block,caret:l,type:"merge-block"})}}else{if(a.type==="merge-block")break;if(zr(l)){if(F(l.origin)){if(l.origin.isInline()){if(!l.origin.isParentOf(s.anchor.origin))break}else a={block:l.origin,type:"merge-next-block"};continue}if(ve(l.origin)){if(!l.origin.isIsolated())if(a.type==="merge-next-block"&&(l.origin.isKeyboardSelectable()||!l.origin.isInline())&&F(s.anchor.origin)&&s.anchor.origin.isEmpty()){s.anchor.origin.remove();const c=gy();c.add(l.origin.getKey()),it(c)}else l.origin.remove();return}break}}if(a.type==="merge-block"){const{caret:l,block:c}=a;return $a(this,lr(!l.origin.isEmpty()&&c.isEmpty()?Il(Be(c,l.direction)):s.anchor,l)),this.removeText()}}const o=this.focus;if(this.modify("extend",e,"character"),this.isCollapsed()){if(e&&r.offset===0&&fh(this,r.getNode()))return}else{const a=o.type==="text"?o.getNode():null;if(i=r.type==="text"?r.getNode():null,a!==null&&a.isSegmented()){const l=o.offset,c=a.getTextContentSize();if(a.is(i)||e&&l!==c||!e&&l!==0)return void hh(a,e,l)}else if(i!==null&&i.isSegmented()){const l=r.offset,c=i.getTextContentSize();if(i.is(a)||e&&l!==0||!e&&l!==c)return void hh(i,e,l)}(function(l,c){const u=l.anchor,f=l.focus,d=u.getNode(),h=f.getNode();if(d===h&&u.type==="text"&&f.type==="text"){const p=u.offset,m=f.offset,y=p<m,b=y?p:m,_=y?m:p,x=_-1;b!==x&&function(T){return!(Ay(T)||hx(T))}(d.getTextContent().slice(b,_))&&(c?f.set(f.key,x,f.type):u.set(u.key,x,u.type))}})(this,e)}}if(this.removeText(),e&&!t&&this.isCollapsed()&&this.anchor.type==="element"&&this.anchor.offset===0){const r=this.anchor.getNode();r.isEmpty()&&et(r.getParent())&&r.getPreviousSibling()===null&&fh(this,r)}}deleteLine(e){this.isCollapsed()&&this.modify("extend",e,"lineboundary"),this.isCollapsed()?this.deleteCharacter(e):this.removeText()}deleteWord(e){if(this.isCollapsed()){const t=this.anchor,r=t.getNode();if(this.forwardDeletion(t,r,e))return;this.modify("extend",e,"word")}this.removeText()}isBackward(){return this.focus.isBefore(this.anchor)}getStartEndPoints(){return[this.anchor,this.focus]}};function pt(n){return n instanceof ly}function dh(n){const e=n.offset;if(n.type==="text")return e;const t=n.getNode();return e===t.getChildrenSize()?t.getTextContent().length:0}function Cu(n){const e=n.getStartEndPoints();if(e===null)return[0,0];const[t,r]=e;return t.type==="element"&&r.type==="element"&&t.key===r.key&&t.offset===r.offset?[0,0]:[dh(t),dh(r)]}function fh(n,e){for(let t=e;t;t=t.getParent()){if(F(t)){if(t.collapseAtStart(n))return!0;if(vn(t))break}if(t.getPreviousSibling())break}return!1}const hx=(()=>{try{const n=new RegExp("\\p{Emoji}","u"),e=n.test.bind(n);if(e("❤️")&&e("#️⃣")&&e("👍"))return e}catch{}return()=>!1})();function hh(n,e,t){const r=n,i=r.getTextContent().split(/(?=\s)/g),s=i.length;let o=0,a=0;for(let c=0;c<s;c++){const u=c===s-1;if(a=o,o+=i[c].length,e&&o===t||o>t||u){i.splice(c,1),u&&(a=void 0);break}}const l=i.join("").trim();l===""?r.remove():(r.setTextContent(l),r.select(a,a))}function gh(n,e,t,r){let i,s=e;if(Te(n)){let o=!1;const a=n.childNodes,l=a.length,c=r._blockCursorElement;s===l&&(o=!0,s=l-1);let u=a[s],f=!1;if(u===c)u=a[s+1],f=!0;else if(c!==null){const d=c.parentNode;n===d&&e>Array.prototype.indexOf.call(d.children,c)&&s--}if(i=Ti(u),W(i))s=ir(i,o?"next":"previous");else{let d=Ti(n);if(d===null)return null;if(F(d)){const h=r.getElementByKey(d.getKey());h===null&&J(214),[d,s]=d.getDOMSlot(h).resolveChildIndex(d,h,n,e),F(d)||J(215),o&&s>=d.getChildrenSize()&&(s=Math.max(0,d.getChildrenSize()-1));let m=d.getChildAtIndex(s);if(F(m)&&function(y,b,_){const x=y.getParent();return _===null||x===null||!x.canBeEmpty()||x!==_.getNode()}(m,0,t)){const y=o?m.getLastDescendant():m.getFirstDescendant();y===null?d=m:(m=y,d=F(m)?m:m.getParentOrThrow()),s=0}W(m)?(i=m,d=null,s=ir(m,o?"next":"previous")):m!==d&&o&&!f&&(F(d)||J(216),s=Math.min(d.getChildrenSize(),s+1))}else{const h=d.getIndexWithinParent();s=e===0&&ve(d)&&Ti(n)===d?h:h+1,d=d.getParentOrThrow()}if(F(d))return wt(d.__key,s,"element")}}else i=Ti(n);return W(i)?wt(i.__key,ir(i,s,"clamp"),"text"):null}function ph(n,e,t){const r=n.offset,i=n.getNode();if(r===0){const s=i.getPreviousSibling(),o=i.getParent();if(e){if((t||!e)&&s===null&&F(o)&&o.isInline()){const a=o.getPreviousSibling();W(a)&&n.set(a.__key,a.getTextContent().length,"text")}}else F(s)&&!t&&s.isInline()?n.set(s.__key,s.getChildrenSize(),"element"):W(s)&&n.set(s.__key,s.getTextContent().length,"text")}else if(r===i.getTextContent().length){const s=i.getNextSibling(),o=i.getParent();if(e&&F(s)&&s.isInline())n.set(s.__key,0,"element");else if((t||e)&&s===null&&F(o)&&o.isInline()&&!o.canInsertTextAfter()){const a=o.getNextSibling();W(a)&&n.set(a.__key,0,"text")}}}function dy(n,e,t){if(n.type==="text"&&e.type==="text"){const r=n.isBefore(e),i=n.is(e);ph(n,r,i),ph(e,!r,i),i&&e.set(n.key,n.offset,n.type);const s=Ie();if(s.isComposing()&&s._compositionKey!==n.key&&q(t)){const o=t.anchor,a=t.focus;n.set(o.key,o.offset,o.type,!0),e.set(a.key,a.offset,a.type,!0)}}}function fy(n,e,t,r,i,s){if(n===null||t===null||!_o(i,n,t))return null;const o=gh(n,e,q(s)?s.anchor:null,i);if(o===null)return null;const a=gh(t,r,q(s)?s.focus:null,i);if(a===null)return null;if(o.type==="element"&&a.type==="element"){const l=Ti(n),c=Ti(t);if(ve(l)&&ve(c))return null}return dy(o,a,s),[o,a]}function wu(n){return F(n)&&!n.isInline()}function hy(n,e,t,r,i,s){const o=gr(),a=new mo(wt(n,e,i),wt(t,r,s),0,"");return a.dirty=!0,o._selection=a,a}function yo(){const n=wt("root",0,"element"),e=wt("root",0,"element");return new mo(n,e,0,"")}function gy(){return new ly(new Set)}function Id(n,e,t,r){const i=t._window;if(i===null)return null;const s=r||i.event,o=s?s.type:void 0,a=o==="selectionchange",l=!du&&(a||o==="beforeinput"||o==="compositionstart"||o==="compositionend"||o==="click"&&s&&s.detail===3||o==="drop"||o===void 0);let c,u,f,d;if(q(n)&&!l)return n.clone();if(e===null)return null;if(c=e.anchorNode,u=e.focusNode,f=e.anchorOffset,d=e.focusOffset,a&&q(n)&&!_o(t,c,u))return n.clone();const h=fy(c,f,u,d,t,n);if(h===null)return null;const[p,m]=h;return new mo(p,m,q(n)?n.format:0,q(n)?n.style:"")}function K(){return gr()._selection}function es(){return Ie()._editorState._selection}function Xa(n,e,t,r=1){const i=n.anchor,s=n.focus,o=i.getNode(),a=s.getNode();if(!e.is(o)&&!e.is(a))return;const l=e.__key;if(n.isCollapsed()){const c=i.offset;if(t<=c&&r>0||t<c&&r<0){const u=Math.max(0,c+r);i.set(l,u,"element"),s.set(l,u,"element"),mh(n)}}else{const c=n.isBackward(),u=c?s:i,f=u.getNode(),d=c?i:s,h=d.getNode();if(e.is(f)){const p=u.offset;(t<=p&&r>0||t<p&&r<0)&&u.set(l,Math.max(0,p+r),"element")}if(e.is(h)){const p=d.offset;(t<=p&&r>0||t<p&&r<0)&&d.set(l,Math.max(0,p+r),"element")}}mh(n)}function mh(n){const e=n.anchor,t=e.offset,r=n.focus,i=r.offset,s=e.getNode(),o=r.getNode();if(n.isCollapsed()){if(!F(s))return;const a=s.getChildrenSize(),l=t>=a,c=l?s.getChildAtIndex(a-1):s.getChildAtIndex(t);if(W(c)){let u=0;l&&(u=c.getTextContentSize()),e.set(c.__key,u,"text"),r.set(c.__key,u,"text")}}else{if(F(s)){const a=s.getChildrenSize(),l=t>=a,c=l?s.getChildAtIndex(a-1):s.getChildAtIndex(t);if(W(c)){let u=0;l&&(u=c.getTextContentSize()),e.set(c.__key,u,"text")}}if(F(o)){const a=o.getChildrenSize(),l=i>=a,c=l?o.getChildAtIndex(a-1):o.getChildAtIndex(i);if(W(c)){let u=0;l&&(u=c.getTextContentSize()),r.set(c.__key,u,"text")}}}}function Qa(n,e,t,r,i){let s=null,o=0,a=null;r!==null?(s=r.__key,W(r)?(o=r.getTextContentSize(),a="text"):F(r)&&(o=r.getChildrenSize(),a="element")):i!==null&&(s=i.__key,W(i)?a="text":F(i)&&(a="element")),s!==null&&a!==null?n.set(s,o,a):(o=e.getIndexWithinParent(),o===-1&&(o=t.getChildrenSize()),n.set(t.__key,o,"element"))}function yh(n,e,t,r,i){n.type==="text"?n.set(t,n.offset+(e?0:i),"text"):n.offset>r.getIndexWithinParent()&&n.set(n.key,n.offset-1,"element")}function py(n,e,t,r,i){try{n.setBaseAndExtent(e,t,r,i)}catch{}}function gx(n,e,t,r,i,s,o){const a=r.anchorNode,l=r.focusNode,c=r.anchorOffset,u=r.focusOffset,f=document.activeElement;if(i.has(vx)&&f!==s||f!==null&&Bd(f))return;if(!q(e))return void(n!==null&&_o(t,a,l)&&r.removeAllRanges());const d=e.anchor,h=e.focus,p=d.key,m=h.key,y=qi(t,p),b=qi(t,m),_=d.offset,x=h.offset,T=e.format,P=e.style,M=e.isCollapsed();let L=y,A=b,I=!1;if(d.type==="text"){L=Fi(y);const j=d.getNode();I=j.getFormat()!==T||j.getStyle()!==P}else q(n)&&n.anchor.type==="text"&&(I=!0);var B,k,N,w,R;if(h.type==="text"&&(A=Fi(b)),L!==null&&A!==null&&(M&&(n===null||I||q(n)&&(n.format!==T||n.style!==P))&&(B=T,k=P,N=_,w=p,R=performance.now(),Xm=[B,k,N,w,R]),c!==_||u!==x||a!==L||l!==A||r.type==="Range"&&M||(f!==null&&s.contains(f)||s.focus({preventScroll:!0}),d.type==="element"))){if(py(r,L,_,A,x),!i.has(kx)&&e.isCollapsed()&&s!==null&&s===document.activeElement){const j=q(e)&&e.anchor.type==="element"?L.childNodes[_]||null:r.rangeCount>0?r.getRangeAt(0):null;if(j!==null){let D;if(j instanceof Text){const z=document.createRange();z.selectNode(j),D=z.getBoundingClientRect()}else D=j.getBoundingClientRect();(function(z,H,V){const G=Ry(V),ee=Jd(G);if(G===null||ee===null)return;let{top:Q,bottom:re}=H,oe=0,X=0,fe=V;for(;fe!==null;){const be=fe===G.body;if(be)oe=0,X=jt(z).innerHeight;else{const ue=fe.getBoundingClientRect();oe=ue.top,X=ue.bottom}let se=0;if(Q<oe?se=-(oe-Q):re>X&&(se=re-X),se!==0)if(be)ee.scrollBy(0,se);else{const ue=fe.scrollTop;fe.scrollTop+=se;const he=fe.scrollTop-ue;Q-=he,re-=he}if(be)break;fe=bo(fe)}})(t,D,s)}}vu=!0}}function px(n){let e=K()||es();e===null&&(e=me().selectEnd()),e.insertNodes(n)}function Fc(n){let e=n;n.isCollapsed()||e.removeText();const t=K();q(t)&&(e=t),q(e)||J(161);const r=e.anchor;let i=r.getNode(),s=r.offset;for(;!Rt(i);){const o=i;if([i,s]=mx(i,s),o.is(i))break}return s}function mx(n,e){const t=n.getParent();if(!t){const i=Ot();return me().append(i),i.select(),[me(),0]}if(W(n)){const i=n.splitText(e);if(i.length===0)return[t,n.getIndexWithinParent()];const s=e===0?0:1;return[t,i[0].getIndexWithinParent()+s]}if(!F(n)||e===0)return[t,n.getIndexWithinParent()];const r=n.getChildAtIndex(e);if(r){const i=new mo(wt(n.__key,e,"element"),wt(n.__key,e,"element"),0,""),s=n.insertNewAfter(i);s&&s.append(r,...r.getNextSiblings())}return[t,n.getIndexWithinParent()+1]}function _h(n,e,t,r,i="decorators-and-blocks"){if(e==="move"&&r==="character"&&!n.isCollapsed()){const[u,f]=t===n.isBackward()?[n.focus,n.anchor]:[n.anchor,n.focus];return f.set(u.key,u.offset,u.type),!0}const s=jn(n.focus,t?"previous":"next"),o=r==="lineboundary",a=e==="move";let l=s,c=i==="decorators-and-blocks";if(!Uy(l)){for(const u of l){c=!1;const{origin:f}=u;if(!ve(f)||f.isIsolated()||(l=u,!o||!f.isInline()))break}if(c)for(const u of Qd(s).iterNodeCarets(e==="extend"?"shadowRoot":"root")){if(Jt(u))u.origin.isInline()||(l=u);else{if(F(u.origin))continue;ve(u.origin)&&!u.origin.isInline()&&(l=u)}break}}if(l===s)return!1;if(a&&!o&&ve(l.origin)&&l.origin.isKeyboardSelectable()){const u=gy();return u.add(l.origin.getKey()),it(u),!0}return l=gn(l),a&&Zs(n.anchor,l),Zs(n.focus,l),c||!o}let We=null,Ke=null,Ct=!1,qc=!1,Ma=0;const bh={characterData:!0,childList:!0,subtree:!0};function ts(){return Ct||We!==null&&We._readOnly}function Qe(){Ct&&J(13)}function my(){Ma>99&&J(14)}function gr(){return We===null&&J(195,yy()),We}function Ie(){return Ke===null&&J(196,yy()),Ke}function yy(){let n=0;const e=new Set,t=El.version;if(typeof window<"u")for(const i of document.querySelectorAll("[contenteditable]")){const s=Nl(i);if(Ud(s))n++;else if(s){let o=String(s.constructor.version||"<0.17.1");o===t&&(o+=" (separately built, likely a bundler configuration issue)"),e.add(o)}}let r=` Detected on the page: ${n} compatible editor(s) with version ${t}`;return e.size&&(r+=` and incompatible editors with versions ${Array.from(e).join(", ")}`),r}function yx(){return Ke}function vh(n,e,t){const r=e.__type,i=Sy(n,r);let s=t.get(r);s===void 0&&(s=Array.from(i.transforms),t.set(r,s));const o=s.length;for(let a=0;a<o&&(s[a](e),e.isAttached());a++);}function kh(n,e){return n!==void 0&&n.__key!==e&&n.isAttached()}function _y(n,e){if(!e)return;const t=n._updateTags;let r=e;Array.isArray(e)||(r=[e]);for(const i of r)t.add(i)}function by(n){return Pd(n,Ie()._nodes)}function Pd(n,e){const t=n.type,r=e.get(t);r===void 0&&J(17,t);const i=r.klass;n.type!==i.getType()&&J(18,i.name);const s=i.importJSON(n),o=n.children;if(F(s)&&Array.isArray(o))for(let a=0;a<o.length;a++){const l=Pd(o[a],e);s.append(l)}return s}function xh(n,e,t){const r=We,i=Ct,s=Ke;We=e,Ct=!0,Ke=n;try{return t()}finally{We=r,Ct=i,Ke=s}}function In(n,e){const t=n._pendingEditorState,r=n._rootElement,i=n._headless||r===null;if(t===null)return;const s=n._editorState,o=s._selection,a=t._selection,l=n._dirtyType!==qr,c=We,u=Ct,f=Ke,d=n._updating,h=n._observer;let p=null;if(n._pendingEditorState=null,n._editorState=t,!i&&l&&h!==null){Ke=n,We=t,Ct=!1,n._updating=!0;try{const M=n._dirtyType,L=n._dirtyElements,A=n._dirtyLeaves;h.disconnect(),p=Vk(s,t,n,M,L,A)}catch(M){if(M instanceof Error&&n._onError(M),qc)throw M;return wy(n,null,r,t),Pm(n),n._dirtyType=Pi,qc=!0,In(n,s),void(qc=!1)}finally{h.observe(r,bh),n._updating=d,We=c,Ct=u,Ke=f}}t._readOnly||(t._readOnly=!0);const m=n._dirtyLeaves,y=n._dirtyElements,b=n._normalizedNodes,_=n._updateTags,x=n._deferred;l&&(n._dirtyType=qr,n._cloneNotNeeded.clear(),n._dirtyLeaves=new Set,n._dirtyElements=new Map,n._normalizedNodes=new Set,n._updateTags=new Set),function(M,L){const A=M._decorators;let I=M._pendingDecorators||A;const B=L._nodeMap;let k;for(k in I)B.has(k)||(I===A&&(I=Ny(M)),delete I[k])}(n,t);const T=i?null:Yt(jt(n));if(n._editable&&T!==null&&(l||a===null||a.dirty)&&r!==null&&!_.has(xx)){Ke=n,We=t;try{if(h!==null&&h.disconnect(),l||a===null||a.dirty){const M=n._blockCursorElement;M!==null&&Mu(M,n,r),gx(o,a,n,T,_,r)}(function(M,L,A){let I=M._blockCursorElement;if(q(A)&&A.isCollapsed()&&A.anchor.type==="element"&&L.contains(document.activeElement)){const B=A.anchor,k=B.getNode(),N=B.offset;let w=!1,R=null;if(N===k.getChildrenSize())Uc(k.getChildAtIndex(N-1))&&(w=!0);else{const j=k.getChildAtIndex(N);if(j!==null&&Uc(j)){const D=j.getPreviousSibling();(D===null||Uc(D))&&(w=!0,R=M.getElementByKey(j.__key))}}if(w){const j=M.getElementByKey(k.__key);return I===null&&(M._blockCursorElement=I=function(D){const z=D.theme,H=document.createElement("div");H.contentEditable="false",H.setAttribute("data-lexical-cursor","true");let V=z.blockCursor;if(V!==void 0){if(typeof V=="string"){const G=Ua(V);V=z.blockCursor=G}V!==void 0&&H.classList.add(...V)}return H}(M._config)),L.style.caretColor="transparent",void(R===null?j.appendChild(I):j.insertBefore(I,R))}}I!==null&&Mu(I,M,L)})(n,r,a)}finally{h!==null&&h.observe(r,bh),Ke=f,We=c}}p!==null&&function(M,L,A,I,B){const k=Array.from(M._listeners.mutation),N=k.length;for(let w=0;w<N;w++){const[R,j]=k[w];for(const D of j){const z=L.get(D);z!==void 0&&R(z,{dirtyLeaves:I,prevEditorState:B,updateTags:A})}}}(n,p,_,m,s),q(a)||a===null||o!==null&&o.is(a)||n.dispatchCommand(fr,void 0);const P=n._pendingDecorators;P!==null&&(n._decorators=P,n._pendingDecorators=null,Bs("decorator",n,!0,P)),function(M,L,A){const I=Eh(L),B=Eh(A);I!==B&&Bs("textcontent",M,!0,B)}(n,e||s,t),Bs("update",n,!0,{dirtyElements:y,dirtyLeaves:m,editorState:t,mutatedNodes:p,normalizedNodes:b,prevEditorState:e||s,tags:_}),function(M,L){if(M._deferred=[],L.length!==0){const A=M._updating;M._updating=!0;try{for(let I=0;I<L.length;I++)L[I]()}finally{M._updating=A}}}(n,x),function(M){const L=M._updates;if(L.length!==0){const A=L.shift();if(A){const[I,B]=A;wl(M,I,B)}}}(n)}function Bs(n,e,t,...r){const i=e._updating;e._updating=t;try{const s=Array.from(e._listeners[n]);for(let o=0;o<s.length;o++)s[o].apply(null,r)}finally{e._updating=i}}function Ch(n,e){const t=n._updates;let r=e||!1;for(;t.length!==0;){const i=t.shift();if(i){const[s,o]=i,a=n._pendingEditorState;let l;o!==void 0&&(l=o.onUpdate,o.skipTransforms&&(r=!0),o.discrete&&(a===null&&J(191),a._flushSync=!0),l&&n._deferred.push(l),_y(n,o.tag)),a==null?wl(n,s,o):s()}}return r}function wl(n,e,t){const r=n._updateTags;let i,s=!1,o=!1;t!==void 0&&(i=t.onUpdate,_y(n,t.tag),s=t.skipTransforms||!1,o=t.discrete||!1),i&&n._deferred.push(i);const a=n._editorState;let l=n._pendingEditorState,c=!1;(l===null||l._readOnly)&&(l=n._pendingEditorState=ky(l||a),c=!0),l._flushSync=o;const u=We,f=Ct,d=Ke,h=n._updating;We=l,Ct=!1,n._updating=!0,Ke=n;const p=n._headless||n.getRootElement()===null;Fd(null);try{c&&(p?a._selection!==null&&(l._selection=a._selection.clone()):l._selection=function(_,x){const T=_.getEditorState()._selection,P=Yt(jt(_));return q(T)||T==null?Id(T,P,_,x):T.clone()}(n,t&&t.event||null));const y=n._compositionKey;e(),s=Ch(n,s),function(_,x){const T=x.getEditorState()._selection,P=_._selection;if(q(P)){const M=P.anchor,L=P.focus;let A;if(M.type==="text"&&(A=M.getNode(),A.selectionTransform(T,P)),L.type==="text"){const I=L.getNode();A!==I&&I.selectionTransform(T,P)}}}(l,n),n._dirtyType!==qr&&(s?function(_,x){const T=x._dirtyLeaves,P=_._nodeMap;for(const M of T){const L=P.get(M);W(L)&&L.isAttached()&&L.isSimpleText()&&!L.isUnmergeable()&&Zf(L)}}(l,n):function(_,x){const T=x._dirtyLeaves,P=x._dirtyElements,M=_._nodeMap,L=Zn(),A=new Map;let I=T,B=I.size,k=P,N=k.size;for(;B>0||N>0;){if(B>0){x._dirtyLeaves=new Set;for(const w of I){const R=M.get(w);W(R)&&R.isAttached()&&R.isSimpleText()&&!R.isUnmergeable()&&Zf(R),R!==void 0&&kh(R,L)&&vh(x,R,A),T.add(w)}if(I=x._dirtyLeaves,B=I.size,B>0){Ma++;continue}}x._dirtyLeaves=new Set,x._dirtyElements=new Map,k.delete("root")&&k.set("root",!0);for(const w of k){const R=w[0],j=w[1];if(P.set(R,j),!j)continue;const D=M.get(R);D!==void 0&&kh(D,L)&&vh(x,D,A)}I=x._dirtyLeaves,B=I.size,k=x._dirtyElements,N=k.size,Ma++}x._dirtyLeaves=T,x._dirtyElements=P}(l,n),Ch(n),function(_,x,T,P){const M=_._nodeMap,L=x._nodeMap,A=[];for(const[I]of P){const B=L.get(I);B!==void 0&&(B.isAttached()||(F(B)&&Om(B,I,M,L,A,P),M.has(I)||P.delete(I),A.push(I)))}for(const I of A)L.delete(I);for(const I of T){const B=L.get(I);B===void 0||B.isAttached()||(M.has(I)||T.delete(I),L.delete(I))}}(a,l,n._dirtyLeaves,n._dirtyElements)),y!==n._compositionKey&&(l._flushSync=!0);const b=l._selection;if(q(b)){const _=l._nodeMap,x=b.anchor.key,T=b.focus.key;_.get(x)!==void 0&&_.get(T)!==void 0||J(19)}else pt(b)&&b._nodes.size===0&&(l._selection=null)}catch(y){return y instanceof Error&&n._onError(y),n._pendingEditorState=a,n._dirtyType=Pi,n._cloneNotNeeded.clear(),n._dirtyLeaves=new Set,n._dirtyElements.clear(),void In(n)}finally{We=u,Ct=f,Ke=d,n._updating=h,Ma=0}n._dirtyType!==qr||n._deferred.length>0||function(y,b){const _=b.getEditorState()._selection,x=y._selection;if(x!==null){if(x.dirty||!x.is(_))return!0}else if(_!==null)return!0;return!1}(l,n)?l._flushSync?(l._flushSync=!1,In(n)):c&&Tx(()=>{In(n)}):(l._flushSync=!1,c&&(r.clear(),n._deferred=[],n._pendingEditorState=null))}function Et(n,e,t){Ke===n&&t===void 0?e():wl(n,e,t)}let _x=class Aa{constructor(e,t,r){this.element=e,this.before=t||null,this.after=r||null}withBefore(e){return new Aa(this.element,e,this.after)}withAfter(e){return new Aa(this.element,this.before,e)}withElement(e){return this.element===e?this:new Aa(e,this.before,this.after)}insertChild(e){const t=this.before||this.getManagedLineBreak();return t!==null&&t.parentElement!==this.element&&J(222),this.element.insertBefore(e,t),this}removeChild(e){return e.parentElement!==this.element&&J(223),this.element.removeChild(e),this}replaceChild(e,t){return t.parentElement!==this.element&&J(224),this.element.replaceChild(e,t),this}getFirstChild(){const e=this.after?this.after.nextSibling:this.element.firstChild;return e===this.before||e===this.getManagedLineBreak()?null:e}getManagedLineBreak(){return this.element.__lexicalLineBreak||null}setManagedLineBreak(e){if(e===null)this.removeManagedLineBreak();else{const t=e==="decorator"&&(Ii||Hs);this.insertManagedLineBreak(t)}}removeManagedLineBreak(){const e=this.getManagedLineBreak();if(e){const t=this.element,r=e.nodeName==="IMG"?e.nextSibling:null;r&&t.removeChild(r),t.removeChild(e),t.__lexicalLineBreak=void 0}}insertManagedLineBreak(e){const t=this.getManagedLineBreak();if(t){if(e===(t.nodeName==="IMG"))return;this.removeManagedLineBreak()}const r=this.element,i=this.before,s=document.createElement("br");if(r.insertBefore(s,i),e){const o=document.createElement("img");o.setAttribute("data-lexical-linebreak","true"),o.style.cssText="display: inline !important; border: 0px !important; margin: 0px !important;",o.alt="",r.insertBefore(o,s),r.__lexicalLineBreak=o}else r.__lexicalLineBreak=s}getFirstChildOffset(){let e=0;for(let t=this.after;t!==null;t=t.previousSibling)e++;return e}resolveChildIndex(e,t,r,i){if(r===this.element){const l=this.getFirstChildOffset();return[e,Math.min(l+e.getChildrenSize(),Math.max(l,i))]}const s=wh(t,r);s.push(i);const o=wh(t,this.element);let a=e.getIndexWithinParent();for(let l=0;l<o.length;l++){const c=s[l],u=o[l];if(c===void 0||c<u)break;if(c>u){a+=1;break}}return[e.getParentOrThrow(),a]}};function wh(n,e){const t=[];let r=e;for(;r!==n&&r!==null;r=r.parentNode){let i=0;for(let s=r.previousSibling;s!==null;s=s.previousSibling)i++;t.push(i)}return r!==n&&J(225),t.reverse()}let ht=class extends Zi{constructor(e){super(e),this.__first=null,this.__last=null,this.__size=0,this.__format=0,this.__style="",this.__indent=0,this.__dir=null,this.__textFormat=0,this.__textStyle=""}afterCloneFrom(e){super.afterCloneFrom(e),this.__key===e.__key&&(this.__first=e.__first,this.__last=e.__last,this.__size=e.__size),this.__indent=e.__indent,this.__format=e.__format,this.__style=e.__style,this.__dir=e.__dir,this.__textFormat=e.__textFormat,this.__textStyle=e.__textStyle}getFormat(){return this.getLatest().__format}getFormatType(){const e=this.getFormat();return Pk[e]||""}getStyle(){return this.getLatest().__style}getIndent(){return this.getLatest().__indent}getChildren(){const e=[];let t=this.getFirstChild();for(;t!==null;)e.push(t),t=t.getNextSibling();return e}getChildrenKeys(){const e=[];let t=this.getFirstChild();for(;t!==null;)e.push(t.__key),t=t.getNextSibling();return e}getChildrenSize(){return this.getLatest().__size}isEmpty(){return this.getChildrenSize()===0}isDirty(){const e=Ie()._dirtyElements;return e!==null&&e.has(this.__key)}isLastChild(){const e=this.getLatest(),t=this.getParentOrThrow().getLastChild();return t!==null&&t.is(e)}getAllTextNodes(){const e=[];let t=this.getFirstChild();for(;t!==null;){if(W(t)&&e.push(t),F(t)){const r=t.getAllTextNodes();e.push(...r)}t=t.getNextSibling()}return e}getFirstDescendant(){let e=this.getFirstChild();for(;F(e);){const t=e.getFirstChild();if(t===null)break;e=t}return e}getLastDescendant(){let e=this.getLastChild();for(;F(e);){const t=e.getLastChild();if(t===null)break;e=t}return e}getDescendantByIndex(e){const t=this.getChildren(),r=t.length;if(e>=r){const s=t[r-1];return F(s)&&s.getLastDescendant()||s||null}const i=t[e];return F(i)&&i.getFirstDescendant()||i||null}getFirstChild(){const e=this.getLatest().__first;return e===null?null:ce(e)}getFirstChildOrThrow(){const e=this.getFirstChild();return e===null&&J(45,this.__key),e}getLastChild(){const e=this.getLatest().__last;return e===null?null:ce(e)}getLastChildOrThrow(){const e=this.getLastChild();return e===null&&J(96,this.__key),e}getChildAtIndex(e){const t=this.getChildrenSize();let r,i;if(e<t/2){for(r=this.getFirstChild(),i=0;r!==null&&i<=e;){if(i===e)return r;r=r.getNextSibling(),i++}return null}for(r=this.getLastChild(),i=t-1;r!==null&&i>=e;){if(i===e)return r;r=r.getPreviousSibling(),i--}return null}getTextContent(){let e="";const t=this.getChildren(),r=t.length;for(let i=0;i<r;i++){const s=t[i];e+=s.getTextContent(),F(s)&&i!==r-1&&!s.isInline()&&(e+=Dn)}return e}getTextContentSize(){let e=0;const t=this.getChildren(),r=t.length;for(let i=0;i<r;i++){const s=t[i];e+=s.getTextContentSize(),F(s)&&i!==r-1&&!s.isInline()&&(e+=Dn.length)}return e}getDirection(){return this.getLatest().__dir}getTextFormat(){return this.getLatest().__textFormat}hasFormat(e){if(e!==""){const t=Kf[e];return!!(this.getFormat()&t)}return!1}hasTextFormat(e){const t=sr[e];return!!(this.getTextFormat()&t)}getFormatFlags(e,t){return Za(this.getLatest().__textFormat,e,t)}getTextStyle(){return this.getLatest().__textStyle}select(e,t){Qe();const r=K();let i=e,s=t;const o=this.getChildrenSize();if(!this.canBeEmpty()){if(e===0&&t===0){const l=this.getFirstChild();if(W(l)||F(l))return l.select(0,0)}else if(!(e!==void 0&&e!==o||t!==void 0&&t!==o)){const l=this.getLastChild();if(W(l)||F(l))return l.select()}}i===void 0&&(i=o),s===void 0&&(s=o);const a=this.__key;return q(r)?(r.anchor.set(a,i,"element"),r.focus.set(a,s,"element"),r.dirty=!0,r):hy(a,i,a,s,"element","element")}selectStart(){const e=this.getFirstDescendant();return e?e.selectStart():this.select()}selectEnd(){const e=this.getLastDescendant();return e?e.selectEnd():this.select()}clear(){const e=this.getWritable();return this.getChildren().forEach(t=>t.remove()),e}append(...e){return this.splice(this.getChildrenSize(),0,e)}setDirection(e){const t=this.getWritable();return t.__dir=e,t}setFormat(e){return this.getWritable().__format=e!==""?Kf[e]:0,this}setStyle(e){return this.getWritable().__style=e||"",this}setTextFormat(e){const t=this.getWritable();return t.__textFormat=e,t}setTextStyle(e){const t=this.getWritable();return t.__textStyle=e,t}setIndent(e){return this.getWritable().__indent=e,this}splice(e,t,r){const i=r.length,s=this.getChildrenSize(),o=this.getWritable();e+t<=s||J(226,String(e),String(t),String(s));const a=o.__key,l=[],c=[],u=this.getChildAtIndex(e+t);let f=null,d=s-t+i;if(e!==0)if(e===s)f=this.getLastChild();else{const p=this.getChildAtIndex(e);p!==null&&(f=p.getPreviousSibling())}if(t>0){let p=f===null?this.getFirstChild():f.getNextSibling();for(let m=0;m<t;m++){p===null&&J(100);const y=p.getNextSibling(),b=p.__key;Lr(p.getWritable()),c.push(b),p=y}}let h=f;for(let p=0;p<i;p++){const m=r[p];h!==null&&m.is(h)&&(f=h=h.getPreviousSibling());const y=m.getWritable();y.__parent===a&&d--,Lr(y);const b=m.__key;if(h===null)o.__first=b,y.__prev=null;else{const _=h.getWritable();_.__next=b,y.__prev=_.__key}m.__key===a&&J(76),y.__parent=a,l.push(b),h=m}if(e+t===s)h!==null&&(h.getWritable().__next=null,o.__last=h.__key);else if(u!==null){const p=u.getWritable();if(h!==null){const m=h.getWritable();p.__prev=h.__key,m.__next=u.__key}else p.__prev=null}if(o.__size=d,c.length){const p=K();if(q(p)){const m=new Set(c),y=new Set(l),{anchor:b,focus:_}=p;Sh(b,m,y)&&Qa(b,b.getNode(),this,f,u),Sh(_,m,y)&&Qa(_,_.getNode(),this,f,u),d!==0||this.canBeEmpty()||vn(this)||this.remove()}}return o}getDOMSlot(e){return new _x(e)}exportDOM(e){const{element:t}=super.exportDOM(e);if(Te(t)){const r=this.getIndent();r>0&&(t.style.paddingInlineStart=40*r+"px");const i=this.getDirection();i&&(t.dir=i)}return{element:t}}exportJSON(){const e={children:[],direction:this.getDirection(),format:this.getFormatType(),indent:this.getIndent(),...super.exportJSON()},t=this.getTextFormat(),r=this.getTextStyle();return t!==0&&(e.textFormat=t),r!==""&&(e.textStyle=r),e}updateFromJSON(e){return super.updateFromJSON(e).setFormat(e.format).setIndent(e.indent).setDirection(e.direction).setTextFormat(e.textFormat||0).setTextStyle(e.textStyle||"")}insertNewAfter(e,t){return null}canIndent(){return!0}collapseAtStart(e){return!1}excludeFromCopy(e){return!1}canReplaceWith(e){return!0}canInsertAfter(e){return!0}canBeEmpty(){return!0}canInsertTextBefore(){return!0}canInsertTextAfter(){return!0}isInline(){return!1}isShadowRoot(){return!1}canMergeWith(e){return!1}extractWithChild(e,t,r){return!1}canMergeWhenEmpty(){return!1}reconcileObservedMutation(e,t){const r=this.getDOMSlot(e);let i=r.getFirstChild();for(let s=this.getFirstChild();s;s=s.getNextSibling()){const o=t.getElementByKey(s.getKey());o!==null&&(i==null?(r.insertChild(o),i=o):i!==o&&r.replaceChild(o,i),i=i.nextSibling)}}};function F(n){return n instanceof ht}function Sh(n,e,t){let r=n.getNode();for(;r;){const i=r.__key;if(e.has(i)&&!t.has(i))return!0;r=r.getParent()}return!1}class pr extends Zi{decorate(e,t){J(47)}isIsolated(){return!1}isInline(){return!0}isKeyboardSelectable(){return!0}}function ve(n){return n instanceof pr}let Rd=class vy extends ht{static getType(){return"root"}static clone(){return new vy}constructor(){super("root"),this.__cachedText=null}getTopLevelElementOrThrow(){J(51)}getTextContent(){const e=this.__cachedText;return!ts()&&Ie()._dirtyType!==qr||e===null?super.getTextContent():e}remove(){J(52)}replace(e){J(53)}insertBefore(e){J(54)}insertAfter(e){J(55)}updateDOM(e,t){return!1}splice(e,t,r){for(const i of r)F(i)||ve(i)||J(282);return super.splice(e,t,r)}static importJSON(e){return me().updateFromJSON(e)}collapseAtStart(){return!0}};function et(n){return n instanceof Rd}function ky(n){return new Sl(new Map(n._nodeMap))}function Ld(){return new Sl(new Map([["root",new Rd]]))}function xy(n){const e=n.exportJSON(),t=n.constructor;if(e.type!==t.getType()&&J(130,t.name),F(n)){const r=e.children;Array.isArray(r)||J(59,t.name);const i=n.getChildren();for(let s=0;s<i.length;s++){const o=xy(i[s]);r.push(o)}}return e}class Sl{constructor(e,t){this._nodeMap=e,this._selection=t||null,this._flushSync=!1,this._readOnly=!1}isEmpty(){return this._nodeMap.size===1&&this._selection===null}read(e,t){return xh(t&&t.editor||null,this,e)}clone(e){const t=new Sl(this._nodeMap,e===void 0?this._selection:e);return t._readOnly=!0,t}toJSON(){return xh(null,this,()=>({root:xy(me())}))}}const Su="historic",bx="history-push",Pr="history-merge",Cy="paste",vx="collaboration",kx="skip-scroll-into-view",xx="skip-dom-selection";class Dd extends ht{static getType(){return"artificial"}createDOM(e){return document.createElement("div")}}class mr extends ht{static getType(){return"paragraph"}static clone(e){return new mr(e.__key)}createDOM(e){const t=document.createElement("p"),r=Mi(e.theme,"paragraph");return r!==void 0&&t.classList.add(...r),t}updateDOM(e,t,r){return!1}static importDOM(){return{p:e=>({conversion:Cx,priority:0})}}exportDOM(e){const{element:t}=super.exportDOM(e);if(Te(t)){this.isEmpty()&&t.append(document.createElement("br"));const r=this.getFormatType();r&&(t.style.textAlign=r)}return{element:t}}static importJSON(e){return Ot().updateFromJSON(e)}exportJSON(){return{...super.exportJSON(),textFormat:this.getTextFormat(),textStyle:this.getTextStyle()}}insertNewAfter(e,t){const r=Ot();r.setTextFormat(e.format),r.setTextStyle(e.style);const i=this.getDirection();return r.setDirection(i),r.setFormat(this.getFormatType()),r.setStyle(this.getStyle()),this.insertAfter(r,t),r}collapseAtStart(){const e=this.getChildren();if(e.length===0||W(e[0])&&e[0].getTextContent().trim()===""){if(this.getNextSibling()!==null)return this.selectNext(),this.remove(),!0;if(this.getPreviousSibling()!==null)return this.selectPrevious(),this.remove(),!0}return!1}}function Cx(n){const e=Ot();return n.style&&(e.setFormat(n.style.textAlign),Dx(n,e)),{node:e}}function Ot(){return Ae(new mr)}function jd(n){return n instanceof mr}const ne=0,ri=1,Oa=2,Tl=3,Ni=4;function wy(n,e,t,r){const i=n._keyToDOMMap;i.clear(),n._editorState=Ld(),n._pendingEditorState=r,n._compositionKey=null,n._dirtyType=qr,n._cloneNotNeeded.clear(),n._dirtyLeaves=new Set,n._dirtyElements.clear(),n._normalizedNodes=new Set,n._updateTags=new Set,n._updates=[],n._blockCursorElement=null;const s=n._observer;s!==null&&(s.disconnect(),n._observer=null),e!==null&&(e.textContent=""),t!==null&&(t.textContent="",i.set("root",t))}function wx(n){const e=n||{},t=yx(),r=e.theme||{},i=n===void 0?t:e.parentEditor||null,s=e.disableEvents||!1,o=Ld(),a=e.namespace||(i!==null?i._config.namespace:Oy()),l=e.editorState,c=[Rd,At,ho,go,mr,Dd,...e.nodes||[]],{onError:u,html:f}=e,d=e.editable===void 0||e.editable;let h;if(n===void 0&&t!==null)h=t._nodes;else{h=new Map;for(let m=0;m<c.length;m++){let y=c[m],b=null,_=null;if(typeof y!="function"){const L=y;y=L.replace,b=L.with,_=L.withKlass||null}const{ownNodeConfig:x}=Gd(y),T=y.getType(),P=y.transform(),M=new Set;x&&x.$transform&&M.add(x.$transform),P!==null&&M.add(P),h.set(T,{exportDOM:f&&f.export?f.export.get(y):void 0,klass:y,replace:b,replaceWithKlass:_,sharedNodeState:zk(c[m]),transforms:M})}}const p=new El(o,i,h,{disableEvents:s,namespace:a,theme:r},u||console.error,function(m,y){const b=new Map,_=new Set,x=T=>{Object.keys(T).forEach(P=>{let M=b.get(P);M===void 0&&(M=[],b.set(P,M)),M.push(T[P])})};return m.forEach(T=>{const P=T.klass.importDOM;if(P==null||_.has(P))return;_.add(P);const M=P.call(T.klass);M!==null&&x(M)}),y&&x(y),b}(h,f?f.import:void 0),d,n);return l!==void 0&&(p._pendingEditorState=l,p._dirtyType=Pi),p}class El{constructor(e,t,r,i,s,o,a,l){this._createEditorArgs=l,this._parentEditor=t,this._rootElement=null,this._editorState=e,this._pendingEditorState=null,this._compositionKey=null,this._deferred=[],this._keyToDOMMap=new Map,this._updates=[],this._updating=!1,this._listeners={decorator:new Set,editable:new Set,mutation:new Map,root:new Set,textcontent:new Set,update:new Set},this._commands=new Map,this._config=i,this._nodes=r,this._decorators={},this._pendingDecorators=null,this._dirtyType=qr,this._cloneNotNeeded=new Set,this._dirtyLeaves=new Set,this._dirtyElements=new Map,this._normalizedNodes=new Set,this._updateTags=new Set,this._observer=null,this._key=Oy(),this._onError=s,this._htmlConversions=o,this._editable=a,this._headless=t!==null&&t._headless,this._window=null,this._blockCursorElement=null}isComposing(){return this._compositionKey!=null}registerUpdateListener(e){const t=this._listeners.update;return t.add(e),()=>{t.delete(e)}}registerEditableListener(e){const t=this._listeners.editable;return t.add(e),()=>{t.delete(e)}}registerDecoratorListener(e){const t=this._listeners.decorator;return t.add(e),()=>{t.delete(e)}}registerTextContentListener(e){const t=this._listeners.textcontent;return t.add(e),()=>{t.delete(e)}}registerRootListener(e){const t=this._listeners.root;return e(this._rootElement,null),t.add(e),()=>{e(null,this._rootElement),t.delete(e)}}registerCommand(e,t,r){r===void 0&&J(35);const i=this._commands;i.has(e)||i.set(e,[new Set,new Set,new Set,new Set,new Set]);const s=i.get(e);s===void 0&&J(36,String(e));const o=s[r];return o.add(t),()=>{o.delete(t),s.every(a=>a.size===0)&&i.delete(e)}}registerMutationListener(e,t,r){const i=this.resolveRegisteredNodeAfterReplacements(this.getRegisteredNode(e)).klass,s=this._listeners.mutation;let o=s.get(t);o===void 0&&(o=new Set,s.set(t,o)),o.add(i);const a=r&&r.skipInitialization;return a!==void 0&&a||this.initializeMutationListener(t,i),()=>{o.delete(i),o.size===0&&s.delete(t)}}getRegisteredNode(e){const t=this._nodes.get(e.getType());return t===void 0&&J(37,e.name),t}resolveRegisteredNodeAfterReplacements(e){for(;e.replaceWithKlass;)e=this.getRegisteredNode(e.replaceWithKlass);return e}initializeMutationListener(e,t){const r=this._editorState,i=Ph(r).get(t.getType());if(!i)return;const s=new Map;for(const o of i.keys())s.set(o,"created");s.size>0&&e(s,{dirtyLeaves:new Set,prevEditorState:r,updateTags:new Set(["registerMutationListener"])})}registerNodeTransformToKlass(e,t){const r=this.getRegisteredNode(e);return r.transforms.add(t),r}registerNodeTransform(e,t){const r=this.registerNodeTransformToKlass(e,t),i=[r],s=r.replaceWithKlass;if(s!=null){const o=this.registerNodeTransformToKlass(s,t);i.push(o)}return function(o,a){const l=Ph(o.getEditorState()),c=[];for(const u of a){const f=l.get(u);f&&c.push(f)}c.length!==0&&o.update(()=>{for(const u of c)for(const f of u.keys()){const d=ce(f);d&&d.markDirty()}},o._pendingEditorState===null?{tag:Pr}:void 0)}(this,i.map(o=>o.klass.getType())),()=>{i.forEach(o=>o.transforms.delete(t))}}hasNode(e){return this._nodes.has(e.getType())}hasNodes(e){return e.every(this.hasNode.bind(this))}dispatchCommand(e,t){return Y(this,e,t)}getDecorators(){return this._decorators}getRootElement(){return this._rootElement}getKey(){return this._key}setRootElement(e){const t=this._rootElement;if(e!==t){const r=Mi(this._config.theme,"root"),i=this._pendingEditorState||this._editorState;if(this._rootElement=e,wy(this,t,e,i),t!==null&&(this._config.disableEvents||sx(t),r!=null&&t.classList.remove(...r)),e!==null){const s=Jd(e),o=e.style;o.userSelect="text",o.whiteSpace="pre-wrap",o.wordBreak="break-word",e.setAttribute("data-lexical-editor","true"),this._window=s,this._dirtyType=Pi,Pm(this),this._updateTags.add(Pr),In(this),this._config.disableEvents||function(a,l){const c=a.ownerDocument,u=Ya.get(c);(u===void 0||u<1)&&c.addEventListener("selectionchange",ny),Ya.set(c,(u||0)+1),a.__lexicalEditor=l;const f=ty(a);for(let d=0;d<bu.length;d++){const[h,p]=bu[d],m=typeof p=="function"?y=>{oh(y)||(sh(y),(l.isEditable()||h==="click")&&p(y,l))}:y=>{if(oh(y))return;sh(y);const b=l.isEditable();switch(h){case"cut":return b&&Y(l,ni,y);case"copy":return Y(l,hr,y);case"paste":return b&&Y(l,ti,y);case"dragstart":return b&&Y(l,Ad,y);case"dragover":return b&&Y(l,Jm,y);case"dragend":return b&&Y(l,tx,y);case"focus":return b&&Y(l,nx,y);case"blur":return b&&Y(l,rx,y);case"drop":return b&&Y(l,Cl,y)}};a.addEventListener(h,m),f.push(()=>{a.removeEventListener(h,m)})}}(e,this),r!=null&&e.classList.add(...r)}else this._window=null,this._updateTags.add(Pr),In(this);Bs("root",this,!1,e,t)}}getElementByKey(e){return this._keyToDOMMap.get(e)||null}getEditorState(){return this._editorState}setEditorState(e,t){e.isEmpty()&&J(38);let r=e;r._readOnly&&(r=ky(e),r._selection=e._selection?e._selection.clone():null),Im(this);const i=this._pendingEditorState,s=this._updateTags,o=t!==void 0?t.tag:null;i===null||i.isEmpty()||(o!=null&&s.add(o),In(this)),this._pendingEditorState=r,this._dirtyType=Pi,this._dirtyElements.set("root",!1),this._compositionKey=null,o!=null&&s.add(o),this._updating||In(this)}parseEditorState(e,t){return function(r,i,s){const o=Ld(),a=We,l=Ct,c=Ke,u=i._dirtyElements,f=i._dirtyLeaves,d=i._cloneNotNeeded,h=i._dirtyType;i._dirtyElements=new Map,i._dirtyLeaves=new Set,i._cloneNotNeeded=new Set,i._dirtyType=0,We=o,Ct=!1,Ke=i,Fd(null);try{const p=i._nodes;Pd(r.root,p),s&&s(),o._readOnly=!0}catch(p){p instanceof Error&&i._onError(p)}finally{i._dirtyElements=u,i._dirtyLeaves=f,i._cloneNotNeeded=d,i._dirtyType=h,We=a,Ct=l,Ke=c}return o}(typeof e=="string"?JSON.parse(e):e,this,t)}read(e){return In(this),this.getEditorState().read(e,{editor:this})}update(e,t){(function(r,i,s){r._updating?r._updates.push([i,s]):wl(r,i,s)})(this,e,t)}focus(e,t={}){const r=this._rootElement;r!==null&&(r.setAttribute("autocapitalize","off"),Et(this,()=>{const i=K(),s=me();i!==null?i.dirty||it(i.clone()):s.getChildrenSize()!==0&&(t.defaultSelection==="rootStart"?s.selectStart():s.selectEnd()),Ly("focus"),Ox(()=>{r.removeAttribute("autocapitalize"),e&&e()})}),this._pendingEditorState===null&&r.removeAttribute("autocapitalize"))}blur(){const e=this._rootElement;e!==null&&e.blur();const t=Yt(this._window);t!==null&&t.removeAllRanges()}isEditable(){return this._editable}setEditable(e){this._editable!==e&&(this._editable=e,Bs("editable",this,!0,e))}toJSON(){return{editorState:this._editorState.toJSON()}}}El.version="0.34.0+prod.esm";let Tu=null;function Fd(n){Tu=n}let Sx=1;function Sy(n,e){const t=qd(n,e);return t===void 0&&J(30,e),t}function qd(n,e){return n._nodes.get(e)}const Tx=typeof queueMicrotask=="function"?queueMicrotask:n=>{Promise.resolve().then(n)};function Th(n){return ve(ar(n))}function Bd(n){const e=document.activeElement;if(!Te(e))return!1;const t=e.nodeName;return ve(ar(n))&&(t==="INPUT"||t==="TEXTAREA"||e.contentEditable==="true"&&Nl(e)==null)}function _o(n,e,t){const r=n.getRootElement();try{return r!==null&&r.contains(e)&&r.contains(t)&&e!==null&&!Bd(e)&&Ty(e)===n}catch{return!1}}function Ud(n){return n instanceof El}function Ty(n){let e=n;for(;e!=null;){const t=Nl(e);if(Ud(t))return t;e=bo(e)}return null}function Nl(n){return n?n.__lexicalEditor:null}function Rr(n){return ay(n)||n.isToken()}function An(n){return Rr(n)||n.isSegmented()}function Un(n){return ii(n)&&n.nodeType===Ck}function Ex(n){return ii(n)&&n.nodeType===wk}function Fi(n){let e=n;for(;e!=null;){if(Un(e))return e;e=e.firstChild}return null}function Za(n,e,t){const r=sr[e];if(t!==null&&(n&r)==(t&r))return n;let i=n^r;return e==="subscript"?i&=-65:e==="superscript"?i&=-33:e==="lowercase"?(i&=-513,i&=-1025):e==="uppercase"?(i&=-257,i&=-1025):e==="capitalize"&&(i&=-257,i&=-513),i}function Nx(n,e){const t=function(){const o=Tu;return Tu=null,o}();if((e=e||t&&t.__key)!=null)return void(n.__key=e);Qe(),my();const r=Ie(),i=gr(),s=""+Sx++;i._nodeMap.set(s,n),F(n)?r._dirtyElements.set(s,!0):r._dirtyLeaves.add(s),r._cloneNotNeeded.add(s),r._dirtyType=Nm,n.__key=s}function Lr(n){const e=n.getParent();if(e!==null){const t=n.getWritable(),r=e.getWritable(),i=n.getPreviousSibling(),s=n.getNextSibling(),o=s!==null?s.__key:null,a=i!==null?i.__key:null,l=i!==null?i.getWritable():null,c=s!==null?s.getWritable():null;i===null&&(r.__first=o),s===null&&(r.__last=a),l!==null&&(l.__next=o),c!==null&&(c.__prev=a),t.__prev=null,t.__next=null,t.__parent=null,r.__size--}}function el(n){my();const e=n.getLatest(),t=e.__parent,r=gr(),i=Ie(),s=r._nodeMap,o=i._dirtyElements;t!==null&&function(l,c,u){let f=l;for(;f!==null;){if(u.has(f))return;const d=c.get(f);if(d===void 0)break;u.set(f,!1),f=d.__parent}}(t,s,o);const a=e.__key;i._dirtyType=Nm,F(n)?o.set(a,!0):i._dirtyLeaves.add(a)}function Ze(n){Qe();const e=Ie(),t=e._compositionKey;if(n!==t){if(e._compositionKey=n,t!==null){const r=ce(t);r!==null&&r.getWritable()}if(n!==null){const r=ce(n);r!==null&&r.getWritable()}}}function Zn(){return ts()?null:Ie()._compositionKey}function ce(n,e){const t=(e||gr())._nodeMap.get(n);return t===void 0?null:t}function Ey(n,e){const t=Ml(n,Ie());return t!==void 0?ce(t,e):null}function Ml(n,e){return n[`__lexicalKey_${e._key}`]}function ar(n,e){let t=n;for(;t!=null;){const r=Ey(t,e);if(r!==null)return r;t=bo(t)}return null}function Ny(n){const e=n._decorators,t=Object.assign({},e);return n._pendingDecorators=t,t}function Eh(n){return n.read(()=>me().getTextContent())}function me(){return My(gr())}function My(n){return n._nodeMap.get("root")}function it(n){Qe();const e=gr();n!==null&&(n.dirty=!0,n.setCachedNodes(null)),e._selection=n}function Ti(n){const e=Ie(),t=function(r,i){let s=r;for(;s!=null;){const o=Ml(s,i);if(o!==void 0)return o;s=bo(s)}return null}(n,e);return t===null?n===e.getRootElement()?ce("root"):null:ce(t)}function Ay(n){return/[\uD800-\uDBFF][\uDC00-\uDFFF]/g.test(n)}function zd(n){const e=[];let t=n;for(;t!==null;)e.push(t),t=t._parentEditor;return e}function Oy(){return Math.random().toString(36).replace(/[^a-z]+/g,"").substring(0,5)}function $y(n){return Un(n)?n.nodeValue:null}function Wd(n,e,t){const r=Yt(jt(e));if(r===null)return;const i=r.anchorNode;let{anchorOffset:s,focusOffset:o}=r;if(i!==null){let a=$y(i);const l=ar(i);if(a!==null&&W(l)){if(a===vl&&t){const c=t.length;a=t,s=c,o=c}a!==null&&Kd(l,a,s,o,n)}}}function Kd(n,e,t,r,i){let s=n;if(s.isAttached()&&(i||!s.isDirty())){const o=s.isComposing();let a=e;(o||i)&&e[e.length-1]===vl&&(a=e.slice(0,-1));const l=s.getTextContent();if(i||a!==l){if(a===""){if(Ze(null),Hs||Ii||Ba)s.remove();else{const m=Ie();setTimeout(()=>{m.update(()=>{s.isAttached()&&s.remove()})},20)}return}const c=s.getParent(),u=es(),f=s.getTextContentSize(),d=Zn(),h=s.getKey();if(s.isToken()||d!==null&&h===d&&!o||q(u)&&(c!==null&&!c.canInsertTextBefore()&&u.anchor.offset===0||u.anchor.key===n.__key&&u.anchor.offset===0&&!s.canInsertTextBefore()&&!o||u.focus.key===n.__key&&u.focus.offset===f&&!s.canInsertTextAfter()&&!o))return void s.markDirty();const p=K();if(!q(p)||t===null||r===null)return void Nh(s,a,p);if(p.setTextNodeRange(s,t,s,r),s.isSegmented()){const m=de(s.getTextContent());s.replace(m),s=m}Nh(s,a,p)}}}function Nh(n,e,t){if(n.setTextContent(e),q(t)){const r=n.getKey();for(const i of["anchor","focus"]){const s=t[i];s.type==="text"&&s.key===r&&(s.offset=ir(n,s.offset,"clamp"))}}}function ea(n,e,t){const r=e[t]||!1;return r==="any"||r===n[t]}function Mx(n,e){return ea(n,e,"altKey")&&ea(n,e,"ctrlKey")&&ea(n,e,"shiftKey")&&ea(n,e,"metaKey")}function we(n,e,t){return Mx(n,t)&&n.key.toLowerCase()===e.toLowerCase()}const Mn={ctrlKey:!dn,metaKey:dn},Mh={altKey:dn,ctrlKey:!dn};function Ah(n){return n.key==="Backspace"}function Oh(n){return we(n,"a",Mn)}function Iy(n){const e=me();if(q(n)){const t=n.anchor,r=n.focus,i=t.getNode().getTopLevelElementOrThrow().getParentOrThrow();return t.set(i.getKey(),0,"element"),r.set(i.getKey(),i.getChildrenSize(),"element"),Js(n),n}{const t=e.select(0,e.getChildrenSize());return it(Js(t)),t}}function Mi(n,e){n.__lexicalClassNameCache===void 0&&(n.__lexicalClassNameCache={});const t=n.__lexicalClassNameCache,r=t[e];if(r!==void 0)return r;const i=n[e];if(typeof i=="string"){const s=Ua(i);return t[e]=s,s}return i}function Hd(n,e,t,r,i){if(t.size===0)return;const s=r.__type,o=r.__key,a=e.get(s);a===void 0&&J(33,s);const l=a.klass;let c=n.get(l);c===void 0&&(c=new Map,n.set(l,c));const u=c.get(o),f=u==="destroyed"&&i==="created";(u===void 0||f)&&c.set(o,f?"updated":i)}function $h(n,e,t){const r=n.getParent();let i=t,s=n;return r!==null&&(e&&t===0?(i=s.getIndexWithinParent(),s=r):e||t!==s.getChildrenSize()||(i=s.getIndexWithinParent()+1,s=r)),s.getChildAtIndex(e?i-1:i)}function Eu(n,e){const t=n.offset;if(n.type==="element")return $h(n.getNode(),e,t);{const r=n.getNode();if(e&&t===0||!e&&t===r.getTextContentSize()){const i=e?r.getPreviousSibling():r.getNextSibling();return i===null?$h(r.getParentOrThrow(),e,r.getIndexWithinParent()+(e?0:1)):i}}return null}function Py(n){const e=jt(n).event,t=e&&e.inputType;return t==="insertFromPaste"||t==="insertFromPasteAsQuotation"}function Y(n,e,t){return function(r,i,s){const o=zd(r);for(let a=4;a>=0;a--)for(let l=0;l<o.length;l++){const c=o[l],u=c._commands.get(i);if(u!==void 0){const f=u[a];if(f!==void 0){const d=Array.from(f),h=d.length;let p=!1;if(Et(c,()=>{for(let m=0;m<h;m++)if(d[m](s,r))return void(p=!0)}),p)return p}}}return!1}(n,e,t)}function Al(n){return!et(n)&&!n.isLastChild()&&!n.isInline()}function qi(n,e){const t=n._keyToDOMMap.get(e);return t===void 0&&J(75,e),t}function bo(n){const e=n.assignedSlot||n.parentElement;return Au(e)?e.host:e}function Ry(n){return Ex(n)?n:Te(n)?n.ownerDocument:null}function Ax(n){return Ie()._updateTags.has(n)}function Ly(n){Qe(),Ie()._updateTags.add(n)}function Ox(n){Qe(),Ie()._deferred.push(n)}function Nu(n,e){let t=n.getParent();for(;t!==null;){if(t.is(e))return!0;t=t.getParent()}return!1}function Jd(n){const e=Ry(n);return e?e.defaultView:null}function jt(n){const e=n._window;return e===null&&J(78),e}function $x(n){return F(n)&&n.isInline()||ve(n)&&n.isInline()}function Ix(n){let e=n.getParentOrThrow();for(;e!==null;){if(vn(e))return e;e=e.getParentOrThrow()}return e}function vn(n){return et(n)||F(n)&&n.isShadowRoot()}function Ae(n){const e=Ie(),t=n.getType(),r=qd(e,t);r===void 0&&J(200,n.constructor.name,t);const{replace:i,replaceWithKlass:s}=r;if(i!==null){const o=i(n),a=o.constructor;return s!==null?o instanceof s||J(201,s.name,s.getType(),a.name,a.getType(),n.constructor.name,t):o instanceof n.constructor&&a!==n.constructor||J(202,a.name,a.getType(),n.constructor.name,t),o.__key===n.__key&&J(203,n.constructor.name,t,a.name,a.getType()),o}return n}function Bc(n,e){!et(n.getParent())||F(e)||ve(e)||J(99)}function Px(n){const e=ce(n);return e===null&&J(63,n),e}function Uc(n){return(ve(n)||F(n)&&!n.canBeEmpty())&&!n.isInline()}function Mu(n,e,t){t.style.removeProperty("caret-color"),e._blockCursorElement=null;const r=n.parentElement;r!==null&&r.removeChild(n)}function Yt(n){return tn?(n||window).getSelection():null}function Rx(n){const e=Jd(n);return e?e.getSelection():null}function Dy(n){return Te(n)&&n.tagName==="A"}function Te(n){return ii(n)&&n.nodeType===xk}function ii(n){return typeof n=="object"&&n!==null&&"nodeType"in n&&typeof n.nodeType=="number"}function Au(n){return ii(n)&&n.nodeType===Sk}function Ou(n){const e=new RegExp(/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|mark|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var|#text)$/,"i");return n.nodeName.match(e)!==null}function tl(n){const e=new RegExp(/^(address|article|aside|blockquote|canvas|dd|div|dl|dt|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hr|li|main|nav|noscript|ol|p|pre|section|table|td|tfoot|ul|video)$/,"i");return n.nodeName.match(e)!==null}function Rt(n){if(ve(n)&&!n.isInline())return!0;if(!F(n)||vn(n))return!1;const e=n.getFirstChild(),t=e===null||Ir(e)||W(e)||e.isInline();return!n.isInline()&&n.canBeEmpty()!==!1&&t}function zc(n,e){let t=n;for(;t!==null&&t.getParent()!==null&&!e(t);)t=t.getParentOrThrow();return e(t)?t:null}function Ol(){return Ie()}const Ih=new WeakMap,Lx=new Map;function Ph(n){if(!n._readOnly&&n.isEmpty())return Lx;n._readOnly||J(192);let e=Ih.get(n);return e||(e=function(t){const r=new Map;for(const[i,s]of t._nodeMap){const o=s.__type;let a=r.get(o);a||(a=new Map,r.set(o,a)),a.set(i,s)}return r}(n),Ih.set(n,e)),e}function Vd(n){const e=n.constructor.clone(n);return e.afterCloneFrom(n),e}function Dx(n,e){const t=parseInt(n.style.paddingInlineStart,10)||0,r=Math.round(t/40);e.setIndent(r)}function jx(n){n.__lexicalUnmanaged=!0}function Fx(n){return n.__lexicalUnmanaged===!0}function Es(n,e){return function(t,r){return Object.prototype.hasOwnProperty.call(t,r)}(n,e)&&n[e]!==Zi[e]}function Gd(n){const e=Hf in n.prototype?n.prototype[Hf]():void 0,t=function(o){return o===pr||o===ht||o===Zi}(n),r=!t&&Es(n,"getType")?n.getType():void 0;let i,s=r;if(e)if(r)i=e[r];else for(const[o,a]of Object.entries(e))s=o,i=a;if(!t&&s&&(Es(n,"getType")||(n.getType=()=>s),Es(n,"clone")||(n.clone=o=>(Fd(o),new n)),Es(n,"importJSON")||(n.importJSON=i&&i.$importJSON||(o=>new n().updateFromJSON(o))),!Es(n,"importDOM")&&i)){const{importDOM:o}=i;o&&(n.importDOM=()=>o)}return{ownNodeConfig:i,ownNodeType:s}}const qx={next:"previous",previous:"next"};let Yd=class{constructor(e){this.origin=e}[Symbol.iterator](){return $l({hasNext:zr,initial:this.getAdjacentCaret(),map:e=>e,step:e=>e.getAdjacentCaret()})}getAdjacentCaret(){return Be(this.getNodeAtCaret(),this.direction)}getSiblingCaret(){return Be(this.origin,this.direction)}remove(){const e=this.getNodeAtCaret();return e&&e.remove(),this}replaceOrInsert(e,t){const r=this.getNodeAtCaret();return e.is(this.origin)||e.is(r)||(r===null?this.insert(e):r.replace(e,t)),this}splice(e,t,r="next"){const i=r===this.direction?t:Array.from(t).reverse();let s=this;const o=this.getParentAtCaret(),a=new Map;for(let l=s.getAdjacentCaret();l!==null&&a.size<e;l=l.getAdjacentCaret()){const c=l.origin.getWritable();a.set(c.getKey(),c)}for(const l of i){if(a.size>0){const c=s.getNodeAtCaret();if(c){if(a.delete(c.getKey()),a.delete(l.getKey()),!(c.is(l)||s.origin.is(l))){const u=l.getParent();u&&u.is(o)&&l.remove(),c.replace(l)}}else c===null&&J(263,Array.from(a).join(" "))}else s.insert(l);s=Be(l,this.direction)}for(const l of a.values())l.remove();return this}},$u=class jy extends Yd{constructor(){super(...arguments);It(this,"type","child")}getLatest(){const t=this.origin.getLatest();return t===this.origin?this:Xt(t,this.direction)}getParentCaret(t="root"){return Be(Xd(this.getParentAtCaret(),t),this.direction)}getFlipped(){const t=ns(this.direction);return Be(this.getNodeAtCaret(),t)||Xt(this.origin,t)}getParentAtCaret(){return this.origin}getChildCaret(){return this}isSameNodeCaret(t){return t instanceof jy&&this.direction===t.direction&&this.origin.is(t.origin)}isSamePointCaret(t){return this.isSameNodeCaret(t)}};const Bx={root:et,shadowRoot:vn};function ns(n){return qx[n]}function Xd(n,e="root"){return Bx[e](n)?null:n}let nl=class Iu extends Yd{constructor(){super(...arguments);It(this,"type","sibling")}getLatest(){const t=this.origin.getLatest();return t===this.origin?this:Be(t,this.direction)}getSiblingCaret(){return this}getParentAtCaret(){return this.origin.getParent()}getChildCaret(){return F(this.origin)?Xt(this.origin,this.direction):null}getParentCaret(t="root"){return Be(Xd(this.getParentAtCaret(),t),this.direction)}getFlipped(){const t=ns(this.direction);return Be(this.getNodeAtCaret(),t)||Xt(this.origin.getParentOrThrow(),t)}isSamePointCaret(t){return t instanceof Iu&&this.direction===t.direction&&this.origin.is(t.origin)}isSameNodeCaret(t){return(t instanceof Iu||t instanceof rl)&&this.direction===t.direction&&this.origin.is(t.origin)}},rl=class Pu extends Yd{constructor(t,r){super(t);It(this,"type","text");this.offset=r}getLatest(){const t=this.origin.getLatest();return t===this.origin?this:Wr(t,this.direction,this.offset)}getParentAtCaret(){return this.origin.getParent()}getChildCaret(){return null}getParentCaret(t="root"){return Be(Xd(this.getParentAtCaret(),t),this.direction)}getFlipped(){return Wr(this.origin,ns(this.direction),this.offset)}isSamePointCaret(t){return t instanceof Pu&&this.direction===t.direction&&this.origin.is(t.origin)&&this.offset===t.offset}isSameNodeCaret(t){return(t instanceof nl||t instanceof Pu)&&this.direction===t.direction&&this.origin.is(t.origin)}getSiblingCaret(){return Be(this.origin,this.direction)}};function rr(n){return n instanceof rl}function zr(n){return n instanceof nl}function Jt(n){return n instanceof $u}const Ux={next:class extends rl{constructor(){super(...arguments);It(this,"direction","next")}getNodeAtCaret(){return this.origin.getNextSibling()}insert(e){return this.origin.insertAfter(e),this}},previous:class extends rl{constructor(){super(...arguments);It(this,"direction","previous")}getNodeAtCaret(){return this.origin.getPreviousSibling()}insert(e){return this.origin.insertBefore(e),this}}},zx={next:class extends nl{constructor(){super(...arguments);It(this,"direction","next")}getNodeAtCaret(){return this.origin.getNextSibling()}insert(e){return this.origin.insertAfter(e),this}},previous:class extends nl{constructor(){super(...arguments);It(this,"direction","previous")}getNodeAtCaret(){return this.origin.getPreviousSibling()}insert(e){return this.origin.insertBefore(e),this}}},Wx={next:class extends $u{constructor(){super(...arguments);It(this,"direction","next")}getNodeAtCaret(){return this.origin.getFirstChild()}insert(e){return this.origin.splice(0,0,[e]),this}},previous:class extends $u{constructor(){super(...arguments);It(this,"direction","previous")}getNodeAtCaret(){return this.origin.getLastChild()}insert(e){return this.origin.splice(this.origin.getChildrenSize(),0,[e]),this}}};function Be(n,e){return n?new zx[e](n):null}function Wr(n,e,t){return n?new Ux[e](n,ir(n,t)):null}function ir(n,e,t="error"){const r=n.getTextContentSize();let i=e==="next"?r:e==="previous"?0:e;return(i<0||i>r)&&(t!=="clamp"&&function(s,...o){const a=new URL("https://lexical.dev/docs/error"),l=new URLSearchParams;l.append("code",s);for(const c of o)l.append("v",c);a.search=l.toString(),console.warn(`Minified Lexical warning #${s}; visit ${a.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}(284,String(e),String(r),n.getKey()),i=i<0?0:r),i}function Rh(n,e){return new Jx(n,e)}function Xt(n,e){return F(n)?new Wx[e](n):null}function Kx(n){return n&&n.getChildCaret()||n}function Qs(n){return n&&Kx(n.getAdjacentCaret())}let Hx=class Fy{constructor(e,t,r){It(this,"type","node-caret-range");this.anchor=e,this.focus=t,this.direction=r}getLatest(){const e=this.anchor.getLatest(),t=this.focus.getLatest();return e===this.anchor&&t===this.focus?this:new Fy(e,t,this.direction)}isCollapsed(){return this.anchor.isSamePointCaret(this.focus)}getTextSlices(){const e=i=>{const s=this[i].getLatest();return rr(s)?function(o,a){const{direction:l,origin:c}=o,u=ir(c,a==="focus"?ns(l):l);return Rh(o,u-o.offset)}(s,i):null},t=e("anchor"),r=e("focus");if(t&&r){const{caret:i}=t,{caret:s}=r;if(i.isSameNodeCaret(s))return[Rh(i,s.offset-i.offset),null]}return[t,r]}iterNodeCarets(e="root"){const t=rr(this.anchor)?this.anchor.getSiblingCaret():this.anchor.getLatest(),r=this.focus.getLatest(),i=rr(r),s=o=>o.isSameNodeCaret(r)?null:Qs(o)||o.getParentCaret(e);return $l({hasNext:o=>o!==null&&!(i&&r.isSameNodeCaret(o)),initial:t.isSameNodeCaret(r)?null:s(t),map:o=>o,step:s})}[Symbol.iterator](){return this.iterNodeCarets("root")}},Jx=class{constructor(e,t){It(this,"type","slice");this.caret=e,this.distance=t}getSliceIndices(){const{distance:e,caret:{offset:t}}=this,r=t+e;return r<t?[r,t]:[t,r]}getTextContent(){const[e,t]=this.getSliceIndices();return this.caret.origin.getTextContent().slice(e,t)}getTextContentSize(){return Math.abs(this.distance)}removeTextSlice(){const{caret:{origin:e,direction:t}}=this,[r,i]=this.getSliceIndices(),s=e.getTextContent();return Wr(e.setTextContent(s.slice(0,r)+s.slice(i)),t,r)}};function Qd(n){return lr(n,Be(me(),n.direction))}function Vx(n){return lr(n,n)}function lr(n,e){return n.direction!==e.direction&&J(265),new Hx(n,e,n.direction)}function $l(n){const{initial:e,hasNext:t,step:r,map:i}=n;let s=e;return{[Symbol.iterator](){return this},next(){if(!t(s))return{done:!0,value:void 0};const o={done:!1,value:i(s)};return s=r(s),o}}}function qy(n,e){const t=Us(n.origin,e.origin);switch(t===null&&J(275,n.origin.getKey(),e.origin.getKey()),t.type){case"same":{const r=n.type==="text",i=e.type==="text";return r&&i?function(s,o){return Math.sign(s-o)}(n.offset,e.offset):n.type===e.type?0:r?-1:i?1:n.type==="child"?-1:1}case"ancestor":return n.type==="child"?-1:1;case"descendant":return e.type==="child"?1:-1;case"branch":return By(t)}}function By(n){const{a:e,b:t}=n,r=e.__key,i=t.__key;let s=e,o=t;for(;s&&o;s=s.getNextSibling(),o=o.getNextSibling()){if(s.__key===i)return-1;if(o.__key===r)return 1}return s===null?1:-1}function ta(n,e){return e.is(n)}function Lh(n){return F(n)?[n.getLatest(),null]:[n.getParent(),n.getLatest()]}function Us(n,e){if(n.is(e))return{commonAncestor:n,type:"same"};const t=new Map;for(let[r,i]=Lh(n);r;i=r,r=r.getParent())t.set(r,i);for(let[r,i]=Lh(e);r;i=r,r=r.getParent()){const s=t.get(r);if(s!==void 0)return s===null?(ta(n,r)||J(276),{commonAncestor:r,type:"ancestor"}):i===null?(ta(e,r)||J(277),{commonAncestor:r,type:"descendant"}):((F(s)||ta(n,s))&&(F(i)||ta(e,i))&&r.is(s.getParent())&&r.is(i.getParent())||J(278),{a:s,b:i,commonAncestor:r,type:"branch"})}return null}function jn(n,e){const{type:t,key:r,offset:i}=n,s=Px(n.key);return t==="text"?(W(s)||J(266,s.getType(),r),Wr(s,e,i)):(F(s)||J(267,s.getType(),r),Xx(s,n.offset,e))}function Zs(n,e){const{origin:t,direction:r}=e,i=r==="next";rr(e)?n.set(t.getKey(),e.offset,"text"):zr(e)?W(t)?n.set(t.getKey(),ir(t,r),"text"):n.set(t.getParentOrThrow().getKey(),t.getIndexWithinParent()+(i?1:0),"element"):(Jt(e)&&F(t)||J(268),n.set(t.getKey(),i?0:t.getChildrenSize(),"element"))}function Gx(n){const e=K(),t=q(e)?e:yo();return $a(t,n),it(t),t}function $a(n,e){Zs(n.anchor,e.anchor),Zs(n.focus,e.focus)}function Dh(n){const{anchor:e,focus:t}=n,r=jn(e,"next"),i=jn(t,"next"),s=qy(r,i)<=0?"next":"previous";return lr(Bi(r,s),Bi(i,s))}function Il(n){const{direction:e,origin:t}=n,r=Be(t,ns(e)).getNodeAtCaret();return r?Be(r,e):Xt(t.getParentOrThrow(),e)}function jh(n,e="root"){const t=[n];for(let r=Jt(n)?n.getParentCaret(e):n.getSiblingCaret();r!==null;r=r.getParentCaret(e))t.push(Il(r));return t}function Wc(n){return!!n&&n.origin.isAttached()}function Yx(n,e="removeEmptySlices"){if(n.isCollapsed())return n;const t="root",r="next";let i=e;const s=zy(n,r),o=jh(s.anchor,t),a=jh(s.focus.getFlipped(),t),l=new Set,c=[];for(const p of s.iterNodeCarets(t))if(Jt(p))l.add(p.origin.getKey());else if(zr(p)){const{origin:m}=p;F(m)&&!l.has(m.getKey())||c.push(m)}for(const p of c)p.remove();for(const p of s.getTextSlices()){if(!p)continue;const{origin:m}=p.caret,y=m.getTextContentSize(),b=Il(Be(m,r)),_=m.getMode();if(Math.abs(p.distance)===y&&i==="removeEmptySlices"||_==="token"&&p.distance!==0)b.remove();else if(p.distance!==0){i="removeEmptySlices";let x=p.removeTextSlice();const T=p.caret.origin;if(_==="segmented"){const P=x.origin,M=de(P.getTextContent()).setStyle(P.getStyle()).setFormat(P.getFormat());b.replaceOrInsert(M),x=Wr(M,r,x.offset)}T.is(o[0].origin)&&(o[0]=x),T.is(a[0].origin)&&(a[0]=x.getFlipped())}}let u,f;for(const p of o)if(Wc(p)){u=gn(p);break}for(const p of a)if(Wc(p)){f=gn(p);break}const d=function(p,m,y){if(!p||!m)return null;const b=p.getParentAtCaret(),_=m.getParentAtCaret();if(!b||!_)return null;const x=b.getParents().reverse();x.push(b);const T=_.getParents().reverse();T.push(_);const P=Math.min(x.length,T.length);let M;for(M=0;M<P&&x[M]===T[M];M++);const L=(B,k)=>{let N;for(let w=M;w<B.length;w++){const R=B[w];if(vn(R))return;!N&&k(R)&&(N=R)}return N},A=L(x,Rt),I=A&&L(T,B=>y.has(B.getKey())&&Rt(B));return A&&I?[A,I]:null}(u,f,l);if(d){const[p,m]=d;Xt(p,"previous").splice(0,m.getChildren()),m.remove()}const h=[u,f,...o,...a].find(Wc);if(h)return Vx(Bi(gn(h),n.direction));J(269,JSON.stringify(o.map(p=>p.origin.__key)))}function gn(n){const e=function(i){let s=i;for(;Jt(s);){const o=Qs(s);if(!Jt(o))break;s=o}return s}(n.getLatest()),{direction:t}=e;if(W(e.origin))return rr(e)?e:Wr(e.origin,t,t);const r=e.getAdjacentCaret();return zr(r)&&W(r.origin)?Wr(r.origin,t,ns(t)):e}function Uy(n){return rr(n)&&n.offset!==ir(n.origin,n.direction)}function Bi(n,e){return n.direction===e?n:n.getFlipped()}function zy(n,e){return n.direction===e?n:lr(Bi(n.focus,e),Bi(n.anchor,e))}function Xx(n,e,t){let r=Xt(n,"next");for(let i=0;i<e;i++){const s=r.getAdjacentCaret();if(s===null)break;r=s}return Bi(r,t)}const Qx=new Map;function Fh(n){let e=n;for(;e!=null;){if(e.nodeType===Node.TEXT_NODE)return e;e=e.firstChild}return null}function qh(n){const e=n.parentNode;if(e==null)throw new Error("Should never happen");return[e,Array.from(e.childNodes).indexOf(n)]}function Zx(n,e,t,r,i){const s=e.getKey(),o=r.getKey(),a=document.createRange();let l=n.getElementByKey(s),c=n.getElementByKey(o),u=t,f=i;if(W(e)&&(l=Fh(l)),W(r)&&(c=Fh(c)),e===void 0||r===void 0||l===null||c===null)return null;l.nodeName==="BR"&&([l,u]=qh(l)),c.nodeName==="BR"&&([c,f]=qh(c));const d=l.firstChild;l===c&&d!=null&&d.nodeName==="BR"&&u===0&&f===0&&(f=1);try{a.setStart(l,u),a.setEnd(c,f)}catch{return null}return!a.collapsed||u===f&&s===o||(a.setStart(c,f),a.setEnd(l,u)),a}function eC(n,e){const t=n.getRootElement();if(t===null)return[];const r=t.getBoundingClientRect(),i=getComputedStyle(t),s=parseFloat(i.paddingLeft)+parseFloat(i.paddingRight),o=Array.from(e.getClientRects());let a,l=o.length;o.sort((c,u)=>{const f=c.top-u.top;return Math.abs(f)<=3?c.left-u.left:f});for(let c=0;c<l;c++){const u=o[c],f=a&&a.top<=u.top&&a.top+a.height>u.top&&a.left+a.width>u.left,d=u.width+s===r.width;f||d?(o.splice(c--,1),l--):a=u}return o}function tC(n){const e={};if(!n)return e;const t=n.split(";");for(const r of t)if(r!==""){const[i,s]=r.split(/:([^]+)/);i&&s&&(e[i.trim()]=s.trim())}return e}function Wy(n,e){const t=n.getStartEndPoints();if(e.isSelected(n)&&!An(e)&&t!==null){const[r,i]=t,s=n.isBackward(),o=r.getNode(),a=i.getNode(),l=e.is(o),c=e.is(a);if(l||c){const[u,f]=Cu(n),d=o.is(a),h=e.is(s?a:o),p=e.is(s?o:a);let m,y=0;d?(y=u>f?f:u,m=u>f?u:f):h?(y=s?f:u,m=void 0):p&&(y=0,m=s?u:f),e.__text=e.__text.slice(y,m)}}return e}function nC(n){const e=n.getStyle(),t=tC(e);Qx.set(e,t)}function rC(n,e){const t=n.getFormatType(),r=n.getIndent();t!==e.getFormatType()&&e.setFormat(t),r!==e.getIndent()&&e.setIndent(r)}function iC(n,e,t=rC){if(n===null)return;const r=n.getStartEndPoints(),i=new Map;let s=null;if(r){const[o,a]=r;s=yo(),s.anchor.set(o.key,o.offset,o.type),s.focus.set(a.key,a.offset,a.type);const l=Kc(o.getNode(),Rt),c=Kc(a.getNode(),Rt);F(l)&&i.set(l.getKey(),l),F(c)&&i.set(c.getKey(),c)}for(const o of n.getNodes())if(F(o)&&Rt(o))i.set(o.getKey(),o);else if(r===null){const a=Kc(o,Rt);F(a)&&i.set(a.getKey(),a)}for(const[o,a]of i){const l=e();t(a,l),a.replace(l,!0),s&&(o===s.anchor.key&&s.anchor.set(l.getKey(),s.anchor.offset,s.anchor.type),o===s.focus.key&&s.focus.set(l.getKey(),s.focus.offset,s.focus.type))}s&&n.is(K())&&it(s)}function Ky(n){const e=n.anchor.getNode(),t=et(e)?e:e.getParentOrThrow(),r=Ol().getElementByKey(t.getKey());if(r===null)return!1;const i=r.ownerDocument.defaultView;return i===null?!1:i.getComputedStyle(r).writingMode==="vertical-rl"}function il(n,e){let t=Ky(n)?!e:e;Hy(n)&&(t=!t);const r=jn(n.focus,t?"previous":"next");if(Uy(r))return!1;for(const i of Qd(r)){if(Jt(i))return!i.origin.isInline();if(!F(i.origin)){if(ve(i.origin))return!0;break}}return!1}function sC(n,e,t,r){n.modify(e?"extend":"move",t,r)}function Hy(n){const e=n.anchor.getNode();return(et(e)?e:e.getParentOrThrow()).getDirection()==="rtl"}function sl(n,e,t){const r=Hy(n);let i;i=Ky(n)||r?!t:t,sC(n,e,i,"character")}function Kc(n,e){let t=n;for(;t!==null&&t.getParent()!==null&&!e(t);)t=t.getParentOrThrow();return e(t)?t:null}function oC(n,...e){const t=new URL("https://lexical.dev/docs/error"),r=new URLSearchParams;r.append("code",n);for(const i of e)r.append("v",i);throw t.search=r.toString(),Error(`Minified Lexical error #${n}; visit ${t.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}const vo=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,aC=vo&&"documentMode"in document?document.documentMode:null,lC=vo&&/Mac|iPod|iPhone|iPad/.test(navigator.platform),cC=vo&&/^(?!.*Seamonkey)(?=.*Firefox).*/i.test(navigator.userAgent);!(!vo||!("InputEvent"in window)||aC)&&"getTargetRanges"in new window.InputEvent("input");function Jy(...n){const e=[];for(const t of n)if(t&&typeof t=="string")for(const[r]of t.matchAll(/\S+/g))e.push(r);return e}function He(...n){return()=>{for(let e=n.length-1;e>=0;e--)n[e]();n.length=0}}const uC=vo,Ru=lC,dC=cC;function ct(n,...e){const t=Jy(...e);t.length>0&&n.classList.add(...t)}function Dr(n,...e){const t=Jy(...e);t.length>0&&n.classList.remove(...t)}function ko(n,e){return Array.from(fC(n))}function fC(n,e){return hC("next",n)}function hC(n,e,t){const r=me(),i=e||r,s=F(i)?Xt(i,n):Be(i,n),o=gC(i),a=function(c,u){const f=Uh(Be(c,u));return f&&f[0]}(i,n);let l=o;return $l({hasNext:c=>c!==null,initial:s,map:c=>({depth:l,node:c.origin}),step:c=>{if(c.isSameNodeCaret(a))return null;Jt(c)&&l++;const u=Uh(c);return!u||u[0].isSameNodeCaret(a)?null:(l+=u[1],u[0])}})}function gC(n){let e=-1;for(let t=n;t!==null;t=t.getParent())e++;return e}function pC(n){const e=Qt(n,t=>F(t)&&!t.isInline());return F(e)||oC(4,n.__key),e}const Qt=(n,e)=>{let t=n;for(;t!==me()&&t!=null;){if(e(t))return t;t=t.getParent()}return null};function Vy(n,e,t,r){const i=s=>s instanceof e;return n.registerNodeTransform(e,s=>{const o=(a=>{const l=a.getChildren();for(let f=0;f<l.length;f++){const d=l[f];if(i(d))return null}let c=a,u=a;for(;c!==null;)if(u=c,c=c.getParent(),i(c))return{child:u,parent:c};return null})(s);if(o!==null){const{child:a,parent:l}=o;if(a.is(s)){r(l,s);const c=a.getNextSiblings(),u=c.length;if(l.insertAfter(a),u!==0){const f=t(l);a.insertAfter(f);for(let d=0;d<u;d++)f.append(c[d])}l.canBeEmpty()||l.getChildrenSize()!==0||l.remove()}}})}function Rn(n,e){return n!==null&&Object.getPrototypeOf(n).constructor.name===e.name}let Hc=!(dC||!uC)&&void 0;function mC(n){let e=1;if(function(){if(Hc===void 0){const t=document.createElement("div");t.style.cssText="position: absolute; opacity: 0; width: 100px; left: -1000px;",document.body.appendChild(t);const r=t.getBoundingClientRect();t.style.setProperty("zoom","2"),Hc=t.getBoundingClientRect().width===r.width,document.body.removeChild(t)}return Hc}())for(;n;)e*=Number(window.getComputedStyle(n).getPropertyValue("zoom")),n=n.parentElement;return e}function Gy(n,e){const t=[],r=Array.from(n).reverse();for(let i=r.pop();i!==void 0;i=r.pop())if(e(i))t.push(i);else if(F(i))for(const s of yC(i))r.push(s);return t}function yC(n){return _C(Xt(n,"previous"))}function _C(n){return $l({hasNext:zr,initial:n.getAdjacentCaret(),map:e=>e.origin.getLatest(),step:e=>e.getAdjacentCaret()})}function Bh(n){Il(Be(n,"next")).splice(1,n.getChildren())}function Uh(n,e="root"){let t=0,r=n,i=Qs(r);for(;i===null;){if(t--,i=r.getParentCaret(e),!i)return null;r=i,i=Qs(r)}return i&&[i,t]}var na={exports:{}},Jc,zh;function bC(){if(zh)return Jc;zh=1;var n=-1,e=1,t=0;function r(k,N,w,R,j){if(k===N)return k?[[t,k]]:[];if(w!=null){var D=I(k,N,w);if(D)return D}var z=a(k,N),H=k.substring(0,z);k=k.substring(z),N=N.substring(z),z=c(k,N);var V=k.substring(k.length-z);k=k.substring(0,k.length-z),N=N.substring(0,N.length-z);var G=i(k,N);return H&&G.unshift([t,H]),V&&G.push([t,V]),_(G,j),R&&f(G),G}function i(k,N){var w;if(!k)return[[e,N]];if(!N)return[[n,k]];var R=k.length>N.length?k:N,j=k.length>N.length?N:k,D=R.indexOf(j);if(D!==-1)return w=[[e,R.substring(0,D)],[t,j],[e,R.substring(D+j.length)]],k.length>N.length&&(w[0][0]=w[2][0]=n),w;if(j.length===1)return[[n,k],[e,N]];var z=u(k,N);if(z){var H=z[0],V=z[1],G=z[2],ee=z[3],Q=z[4],re=r(H,G),oe=r(V,ee);return re.concat([[t,Q]],oe)}return s(k,N)}function s(k,N){for(var w=k.length,R=N.length,j=Math.ceil((w+R)/2),D=j,z=2*j,H=new Array(z),V=new Array(z),G=0;G<z;G++)H[G]=-1,V[G]=-1;H[D+1]=0,V[D+1]=0;for(var ee=w-R,Q=ee%2!==0,re=0,oe=0,X=0,fe=0,be=0;be<j;be++){for(var se=-be+re;se<=be-oe;se+=2){var ue=D+se,he;se===-be||se!==be&&H[ue-1]<H[ue+1]?he=H[ue+1]:he=H[ue-1]+1;for(var ke=he-se;he<w&&ke<R&&k.charAt(he)===N.charAt(ke);)he++,ke++;if(H[ue]=he,he>w)oe+=2;else if(ke>R)re+=2;else if(Q){var Ce=D+ee-se;if(Ce>=0&&Ce<z&&V[Ce]!==-1){var Se=w-V[Ce];if(he>=Se)return o(k,N,he,ke)}}}for(var Le=-be+X;Le<=be-fe;Le+=2){var Ce=D+Le,Se;Le===-be||Le!==be&&V[Ce-1]<V[Ce+1]?Se=V[Ce+1]:Se=V[Ce-1]+1;for(var st=Se-Le;Se<w&&st<R&&k.charAt(w-Se-1)===N.charAt(R-st-1);)Se++,st++;if(V[Ce]=Se,Se>w)fe+=2;else if(st>R)X+=2;else if(!Q){var ue=D+ee-Le;if(ue>=0&&ue<z&&H[ue]!==-1){var he=H[ue],ke=D+he-ue;if(Se=w-Se,he>=Se)return o(k,N,he,ke)}}}}return[[n,k],[e,N]]}function o(k,N,w,R){var j=k.substring(0,w),D=N.substring(0,R),z=k.substring(w),H=N.substring(R),V=r(j,D),G=r(z,H);return V.concat(G)}function a(k,N){if(!k||!N||k.charAt(0)!==N.charAt(0))return 0;for(var w=0,R=Math.min(k.length,N.length),j=R,D=0;w<j;)k.substring(D,j)==N.substring(D,j)?(w=j,D=w):R=j,j=Math.floor((R-w)/2+w);return x(k.charCodeAt(j-1))&&j--,j}function l(k,N){var w=k.length,R=N.length;if(w==0||R==0)return 0;w>R?k=k.substring(w-R):w<R&&(N=N.substring(0,w));var j=Math.min(w,R);if(k==N)return j;for(var D=0,z=1;;){var H=k.substring(j-z),V=N.indexOf(H);if(V==-1)return D;z+=V,(V==0||k.substring(j-z)==N.substring(0,z))&&(D=z,z++)}}function c(k,N){if(!k||!N||k.slice(-1)!==N.slice(-1))return 0;for(var w=0,R=Math.min(k.length,N.length),j=R,D=0;w<j;)k.substring(k.length-j,k.length-D)==N.substring(N.length-j,N.length-D)?(w=j,D=w):R=j,j=Math.floor((R-w)/2+w);return T(k.charCodeAt(k.length-j))&&j--,j}function u(k,N){var w=k.length>N.length?k:N,R=k.length>N.length?N:k;if(w.length<4||R.length*2<w.length)return null;function j(oe,X,fe){for(var be=oe.substring(fe,fe+Math.floor(oe.length/4)),se=-1,ue="",he,ke,Ce,Se;(se=X.indexOf(be,se+1))!==-1;){var Le=a(oe.substring(fe),X.substring(se)),st=c(oe.substring(0,fe),X.substring(0,se));ue.length<st+Le&&(ue=X.substring(se-st,se)+X.substring(se,se+Le),he=oe.substring(0,fe-st),ke=oe.substring(fe+Le),Ce=X.substring(0,se-st),Se=X.substring(se+Le))}return ue.length*2>=oe.length?[he,ke,Ce,Se,ue]:null}var D=j(w,R,Math.ceil(w.length/4)),z=j(w,R,Math.ceil(w.length/2)),H;if(!D&&!z)return null;z?D?H=D[4].length>z[4].length?D:z:H=z:H=D;var V,G,ee,Q;k.length>N.length?(V=H[0],G=H[1],ee=H[2],Q=H[3]):(ee=H[0],Q=H[1],V=H[2],G=H[3]);var re=H[4];return[V,G,ee,Q,re]}function f(k){for(var N=!1,w=[],R=0,j=null,D=0,z=0,H=0,V=0,G=0;D<k.length;)k[D][0]==t?(w[R++]=D,z=V,H=G,V=0,G=0,j=k[D][1]):(k[D][0]==e?V+=k[D][1].length:G+=k[D][1].length,j&&j.length<=Math.max(z,H)&&j.length<=Math.max(V,G)&&(k.splice(w[R-1],0,[n,j]),k[w[R-1]+1][0]=e,R--,R--,D=R>0?w[R-1]:-1,z=0,H=0,V=0,G=0,j=null,N=!0)),D++;for(N&&_(k),b(k),D=1;D<k.length;){if(k[D-1][0]==n&&k[D][0]==e){var ee=k[D-1][1],Q=k[D][1],re=l(ee,Q),oe=l(Q,ee);re>=oe?(re>=ee.length/2||re>=Q.length/2)&&(k.splice(D,0,[t,Q.substring(0,re)]),k[D-1][1]=ee.substring(0,ee.length-re),k[D+1][1]=Q.substring(re),D++):(oe>=ee.length/2||oe>=Q.length/2)&&(k.splice(D,0,[t,ee.substring(0,oe)]),k[D-1][0]=e,k[D-1][1]=Q.substring(0,Q.length-oe),k[D+1][0]=n,k[D+1][1]=ee.substring(oe),D++),D++}D++}}var d=/[^a-zA-Z0-9]/,h=/\s/,p=/[\r\n]/,m=/\n\r?\n$/,y=/^\r?\n\r?\n/;function b(k){function N(oe,X){if(!oe||!X)return 6;var fe=oe.charAt(oe.length-1),be=X.charAt(0),se=fe.match(d),ue=be.match(d),he=se&&fe.match(h),ke=ue&&be.match(h),Ce=he&&fe.match(p),Se=ke&&be.match(p),Le=Ce&&oe.match(m),st=Se&&X.match(y);return Le||st?5:Ce||Se?4:se&&!he&&ke?3:he||ke?2:se||ue?1:0}for(var w=1;w<k.length-1;){if(k[w-1][0]==t&&k[w+1][0]==t){var R=k[w-1][1],j=k[w][1],D=k[w+1][1],z=c(R,j);if(z){var H=j.substring(j.length-z);R=R.substring(0,R.length-z),j=H+j.substring(0,j.length-z),D=H+D}for(var V=R,G=j,ee=D,Q=N(R,j)+N(j,D);j.charAt(0)===D.charAt(0);){R+=j.charAt(0),j=j.substring(1)+D.charAt(0),D=D.substring(1);var re=N(R,j)+N(j,D);re>=Q&&(Q=re,V=R,G=j,ee=D)}k[w-1][1]!=V&&(V?k[w-1][1]=V:(k.splice(w-1,1),w--),k[w][1]=G,ee?k[w+1][1]=ee:(k.splice(w+1,1),w--))}w++}}function _(k,N){k.push([t,""]);for(var w=0,R=0,j=0,D="",z="",H;w<k.length;){if(w<k.length-1&&!k[w][1]){k.splice(w,1);continue}switch(k[w][0]){case e:j++,z+=k[w][1],w++;break;case n:R++,D+=k[w][1],w++;break;case t:var V=w-j-R-1;if(N){if(V>=0&&M(k[V][1])){var G=k[V][1].slice(-1);if(k[V][1]=k[V][1].slice(0,-1),D=G+D,z=G+z,!k[V][1]){k.splice(V,1),w--;var ee=V-1;k[ee]&&k[ee][0]===e&&(j++,z=k[ee][1]+z,ee--),k[ee]&&k[ee][0]===n&&(R++,D=k[ee][1]+D,ee--),V=ee}}if(P(k[w][1])){var G=k[w][1].charAt(0);k[w][1]=k[w][1].slice(1),D+=G,z+=G}}if(w<k.length-1&&!k[w][1]){k.splice(w,1);break}if(D.length>0||z.length>0){D.length>0&&z.length>0&&(H=a(z,D),H!==0&&(V>=0?k[V][1]+=z.substring(0,H):(k.splice(0,0,[t,z.substring(0,H)]),w++),z=z.substring(H),D=D.substring(H)),H=c(z,D),H!==0&&(k[w][1]=z.substring(z.length-H)+k[w][1],z=z.substring(0,z.length-H),D=D.substring(0,D.length-H)));var Q=j+R;D.length===0&&z.length===0?(k.splice(w-Q,Q),w=w-Q):D.length===0?(k.splice(w-Q,Q,[e,z]),w=w-Q+1):z.length===0?(k.splice(w-Q,Q,[n,D]),w=w-Q+1):(k.splice(w-Q,Q,[n,D],[e,z]),w=w-Q+2)}w!==0&&k[w-1][0]===t?(k[w-1][1]+=k[w][1],k.splice(w,1)):w++,j=0,R=0,D="",z="";break}}k[k.length-1][1]===""&&k.pop();var re=!1;for(w=1;w<k.length-1;)k[w-1][0]===t&&k[w+1][0]===t&&(k[w][1].substring(k[w][1].length-k[w-1][1].length)===k[w-1][1]?(k[w][1]=k[w-1][1]+k[w][1].substring(0,k[w][1].length-k[w-1][1].length),k[w+1][1]=k[w-1][1]+k[w+1][1],k.splice(w-1,1),re=!0):k[w][1].substring(0,k[w+1][1].length)==k[w+1][1]&&(k[w-1][1]+=k[w+1][1],k[w][1]=k[w][1].substring(k[w+1][1].length)+k[w+1][1],k.splice(w+1,1),re=!0)),w++;re&&_(k,N)}function x(k){return k>=55296&&k<=56319}function T(k){return k>=56320&&k<=57343}function P(k){return T(k.charCodeAt(0))}function M(k){return x(k.charCodeAt(k.length-1))}function L(k){for(var N=[],w=0;w<k.length;w++)k[w][1].length>0&&N.push(k[w]);return N}function A(k,N,w,R){return M(k)||P(R)?null:L([[t,k],[n,N],[e,w],[t,R]])}function I(k,N,w){var R=typeof w=="number"?{index:w,length:0}:w.oldRange,j=typeof w=="number"?null:w.newRange,D=k.length,z=N.length;if(R.length===0&&(j===null||j.length===0)){var H=R.index,V=k.slice(0,H),G=k.slice(H),ee=j?j.index:null;e:{var Q=H+z-D;if(ee!==null&&ee!==Q||Q<0||Q>z)break e;var re=N.slice(0,Q),oe=N.slice(Q);if(oe!==G)break e;var X=Math.min(H,Q),fe=V.slice(0,X),be=re.slice(0,X);if(fe!==be)break e;var se=V.slice(X),ue=re.slice(X);return A(fe,se,ue,G)}e:{if(ee!==null&&ee!==H)break e;var he=H,re=N.slice(0,he),oe=N.slice(he);if(re!==V)break e;var ke=Math.min(D-he,z-he),Ce=G.slice(G.length-ke),Se=oe.slice(oe.length-ke);if(Ce!==Se)break e;var se=G.slice(0,G.length-ke),ue=oe.slice(0,oe.length-ke);return A(V,se,ue,Ce)}}if(R.length>0&&j&&j.length===0)e:{var fe=k.slice(0,R.index),Ce=k.slice(R.index+R.length),X=fe.length,ke=Ce.length;if(z<X+ke)break e;var be=N.slice(0,X),Se=N.slice(z-ke);if(fe!==be||Ce!==Se)break e;var se=k.slice(X,D-ke),ue=N.slice(X,z-ke);return A(fe,se,ue,Ce)}return null}function B(k,N,w,R){return r(k,N,w,R,!0)}return B.INSERT=e,B.DELETE=n,B.EQUAL=t,Jc=B,Jc}var Rs={exports:{}};Rs.exports;var Wh;function Yy(){return Wh||(Wh=1,function(n,e){var t=200,r="__lodash_hash_undefined__",i=9007199254740991,s="[object Arguments]",o="[object Array]",a="[object Boolean]",l="[object Date]",c="[object Error]",u="[object Function]",f="[object GeneratorFunction]",d="[object Map]",h="[object Number]",p="[object Object]",m="[object Promise]",y="[object RegExp]",b="[object Set]",_="[object String]",x="[object Symbol]",T="[object WeakMap]",P="[object ArrayBuffer]",M="[object DataView]",L="[object Float32Array]",A="[object Float64Array]",I="[object Int8Array]",B="[object Int16Array]",k="[object Int32Array]",N="[object Uint8Array]",w="[object Uint8ClampedArray]",R="[object Uint16Array]",j="[object Uint32Array]",D=/[\\^$.*+?()[\]{}|]/g,z=/\w*$/,H=/^\[object .+?Constructor\]$/,V=/^(?:0|[1-9]\d*)$/,G={};G[s]=G[o]=G[P]=G[M]=G[a]=G[l]=G[L]=G[A]=G[I]=G[B]=G[k]=G[d]=G[h]=G[p]=G[y]=G[b]=G[_]=G[x]=G[N]=G[w]=G[R]=G[j]=!0,G[c]=G[u]=G[T]=!1;var ee=typeof Xn=="object"&&Xn&&Xn.Object===Object&&Xn,Q=typeof self=="object"&&self&&self.Object===Object&&self,re=ee||Q||Function("return this")(),oe=e&&!e.nodeType&&e,X=oe&&!0&&n&&!n.nodeType&&n,fe=X&&X.exports===oe;function be(g,v){return g.set(v[0],v[1]),g}function se(g,v){return g.add(v),g}function ue(g,v){for(var E=-1,U=g?g.length:0;++E<U&&v(g[E],E,g)!==!1;);return g}function he(g,v){for(var E=-1,U=v.length,le=g.length;++E<U;)g[le+E]=v[E];return g}function ke(g,v,E,U){for(var le=-1,te=g?g.length:0;++le<te;)E=v(E,g[le],le,g);return E}function Ce(g,v){for(var E=-1,U=Array(g);++E<g;)U[E]=v(E);return U}function Se(g,v){return g==null?void 0:g[v]}function Le(g){var v=!1;if(g!=null&&typeof g.toString!="function")try{v=!!(g+"")}catch{}return v}function st(g){var v=-1,E=Array(g.size);return g.forEach(function(U,le){E[++v]=[le,U]}),E}function us(g,v){return function(E){return g(v(E))}}function Oo(g){var v=-1,E=Array(g.size);return g.forEach(function(U){E[++v]=U}),E}var zl=Array.prototype,Wl=Function.prototype,ci=Object.prototype,ds=re["__core-js_shared__"],$o=function(){var g=/[^.]+$/.exec(ds&&ds.keys&&ds.keys.IE_PROTO||"");return g?"Symbol(src)_1."+g:""}(),Io=Wl.toString,rn=ci.hasOwnProperty,ui=ci.toString,Kl=RegExp("^"+Io.call(rn).replace(D,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),xr=fe?re.Buffer:void 0,di=re.Symbol,fs=re.Uint8Array,$t=us(Object.getPrototypeOf,Object),Po=Object.create,Ro=ci.propertyIsEnumerable,Hl=zl.splice,hs=Object.getOwnPropertySymbols,fi=xr?xr.isBuffer:void 0,Lo=us(Object.keys,Object),hi=zt(re,"DataView"),Cr=zt(re,"Map"),Ut=zt(re,"Promise"),gi=zt(re,"Set"),gs=zt(re,"WeakMap"),wr=zt(Object,"create"),ps=gt(hi),Sr=gt(Cr),ms=gt(Ut),ys=gt(gi),_s=gt(gs),Jn=di?di.prototype:void 0,Do=Jn?Jn.valueOf:void 0;function kn(g){var v=-1,E=g?g.length:0;for(this.clear();++v<E;){var U=g[v];this.set(U[0],U[1])}}function Jl(){this.__data__=wr?wr(null):{}}function Vl(g){return this.has(g)&&delete this.__data__[g]}function Gl(g){var v=this.__data__;if(wr){var E=v[g];return E===r?void 0:E}return rn.call(v,g)?v[g]:void 0}function jo(g){var v=this.__data__;return wr?v[g]!==void 0:rn.call(v,g)}function bs(g,v){var E=this.__data__;return E[g]=wr&&v===void 0?r:v,this}kn.prototype.clear=Jl,kn.prototype.delete=Vl,kn.prototype.get=Gl,kn.prototype.has=jo,kn.prototype.set=bs;function Ye(g){var v=-1,E=g?g.length:0;for(this.clear();++v<E;){var U=g[v];this.set(U[0],U[1])}}function Yl(){this.__data__=[]}function Xl(g){var v=this.__data__,E=mi(v,g);if(E<0)return!1;var U=v.length-1;return E==U?v.pop():Hl.call(v,E,1),!0}function Ql(g){var v=this.__data__,E=mi(v,g);return E<0?void 0:v[E][1]}function Zl(g){return mi(this.__data__,g)>-1}function ec(g,v){var E=this.__data__,U=mi(E,g);return U<0?E.push([g,v]):E[U][1]=v,this}Ye.prototype.clear=Yl,Ye.prototype.delete=Xl,Ye.prototype.get=Ql,Ye.prototype.has=Zl,Ye.prototype.set=ec;function ot(g){var v=-1,E=g?g.length:0;for(this.clear();++v<E;){var U=g[v];this.set(U[0],U[1])}}function tc(){this.__data__={hash:new kn,map:new(Cr||Ye),string:new kn}}function nc(g){return Er(this,g).delete(g)}function rc(g){return Er(this,g).get(g)}function ic(g){return Er(this,g).has(g)}function sc(g,v){return Er(this,g).set(g,v),this}ot.prototype.clear=tc,ot.prototype.delete=nc,ot.prototype.get=rc,ot.prototype.has=ic,ot.prototype.set=sc;function vt(g){this.__data__=new Ye(g)}function oc(){this.__data__=new Ye}function ac(g){return this.__data__.delete(g)}function lc(g){return this.__data__.get(g)}function cc(g){return this.__data__.has(g)}function uc(g,v){var E=this.__data__;if(E instanceof Ye){var U=E.__data__;if(!Cr||U.length<t-1)return U.push([g,v]),this;E=this.__data__=new ot(U)}return E.set(g,v),this}vt.prototype.clear=oc,vt.prototype.delete=ac,vt.prototype.get=lc,vt.prototype.has=cc,vt.prototype.set=uc;function pi(g,v){var E=Cs(g)||_i(g)?Ce(g.length,String):[],U=E.length,le=!!U;for(var te in g)rn.call(g,te)&&!(le&&(te=="length"||wc(te,U)))&&E.push(te);return E}function Fo(g,v,E){var U=g[v];(!(rn.call(g,v)&&Wo(U,E))||E===void 0&&!(v in g))&&(g[v]=E)}function mi(g,v){for(var E=g.length;E--;)if(Wo(g[E][0],v))return E;return-1}function sn(g,v){return g&&xs(v,Ss(v),g)}function vs(g,v,E,U,le,te,_e){var ye;if(U&&(ye=te?U(g,le,te,_e):U(g)),ye!==void 0)return ye;if(!an(g))return g;var De=Cs(g);if(De){if(ye=xc(g),!v)return bc(g,ye)}else{var xe=Cn(g),at=xe==u||xe==f;if(Ko(g))return yi(g,v);if(xe==p||xe==s||at&&!te){if(Le(g))return te?g:{};if(ye=on(at?{}:g),!v)return vc(g,sn(ye,g))}else{if(!G[xe])return te?g:{};ye=Cc(g,xe,vs,v)}}_e||(_e=new vt);var kt=_e.get(g);if(kt)return kt;if(_e.set(g,ye),!De)var je=E?kc(g):Ss(g);return ue(je||g,function(lt,Xe){je&&(Xe=lt,lt=g[Xe]),Fo(ye,Xe,vs(lt,v,E,U,Xe,g,_e))}),ye}function dc(g){return an(g)?Po(g):{}}function fc(g,v,E){var U=v(g);return Cs(g)?U:he(U,E(g))}function hc(g){return ui.call(g)}function gc(g){if(!an(g)||Tc(g))return!1;var v=ws(g)||Le(g)?Kl:H;return v.test(gt(g))}function pc(g){if(!Uo(g))return Lo(g);var v=[];for(var E in Object(g))rn.call(g,E)&&E!="constructor"&&v.push(E);return v}function yi(g,v){if(v)return g.slice();var E=new g.constructor(g.length);return g.copy(E),E}function ks(g){var v=new g.constructor(g.byteLength);return new fs(v).set(new fs(g)),v}function Tr(g,v){var E=v?ks(g.buffer):g.buffer;return new g.constructor(E,g.byteOffset,g.byteLength)}function qo(g,v,E){var U=v?E(st(g),!0):st(g);return ke(U,be,new g.constructor)}function Bo(g){var v=new g.constructor(g.source,z.exec(g));return v.lastIndex=g.lastIndex,v}function mc(g,v,E){var U=v?E(Oo(g),!0):Oo(g);return ke(U,se,new g.constructor)}function yc(g){return Do?Object(Do.call(g)):{}}function _c(g,v){var E=v?ks(g.buffer):g.buffer;return new g.constructor(E,g.byteOffset,g.length)}function bc(g,v){var E=-1,U=g.length;for(v||(v=Array(U));++E<U;)v[E]=g[E];return v}function xs(g,v,E,U){E||(E={});for(var le=-1,te=v.length;++le<te;){var _e=v[le],ye=void 0;Fo(E,_e,ye===void 0?g[_e]:ye)}return E}function vc(g,v){return xs(g,xn(g),v)}function kc(g){return fc(g,Ss,xn)}function Er(g,v){var E=g.__data__;return Sc(v)?E[typeof v=="string"?"string":"hash"]:E.map}function zt(g,v){var E=Se(g,v);return gc(E)?E:void 0}var xn=hs?us(hs,Object):Nc,Cn=hc;(hi&&Cn(new hi(new ArrayBuffer(1)))!=M||Cr&&Cn(new Cr)!=d||Ut&&Cn(Ut.resolve())!=m||gi&&Cn(new gi)!=b||gs&&Cn(new gs)!=T)&&(Cn=function(g){var v=ui.call(g),E=v==p?g.constructor:void 0,U=E?gt(E):void 0;if(U)switch(U){case ps:return M;case Sr:return d;case ms:return m;case ys:return b;case _s:return T}return v});function xc(g){var v=g.length,E=g.constructor(v);return v&&typeof g[0]=="string"&&rn.call(g,"index")&&(E.index=g.index,E.input=g.input),E}function on(g){return typeof g.constructor=="function"&&!Uo(g)?dc($t(g)):{}}function Cc(g,v,E,U){var le=g.constructor;switch(v){case P:return ks(g);case a:case l:return new le(+g);case M:return Tr(g,U);case L:case A:case I:case B:case k:case N:case w:case R:case j:return _c(g,U);case d:return qo(g,U,E);case h:case _:return new le(g);case y:return Bo(g);case b:return mc(g,U,E);case x:return yc(g)}}function wc(g,v){return v=v??i,!!v&&(typeof g=="number"||V.test(g))&&g>-1&&g%1==0&&g<v}function Sc(g){var v=typeof g;return v=="string"||v=="number"||v=="symbol"||v=="boolean"?g!=="__proto__":g===null}function Tc(g){return!!$o&&$o in g}function Uo(g){var v=g&&g.constructor,E=typeof v=="function"&&v.prototype||ci;return g===E}function gt(g){if(g!=null){try{return Io.call(g)}catch{}try{return g+""}catch{}}return""}function zo(g){return vs(g,!0,!0)}function Wo(g,v){return g===v||g!==g&&v!==v}function _i(g){return Ec(g)&&rn.call(g,"callee")&&(!Ro.call(g,"callee")||ui.call(g)==s)}var Cs=Array.isArray;function bi(g){return g!=null&&Ho(g.length)&&!ws(g)}function Ec(g){return Jo(g)&&bi(g)}var Ko=fi||Mc;function ws(g){var v=an(g)?ui.call(g):"";return v==u||v==f}function Ho(g){return typeof g=="number"&&g>-1&&g%1==0&&g<=i}function an(g){var v=typeof g;return!!g&&(v=="object"||v=="function")}function Jo(g){return!!g&&typeof g=="object"}function Ss(g){return bi(g)?pi(g):pc(g)}function Nc(){return[]}function Mc(){return!1}n.exports=zo}(Rs,Rs.exports)),Rs.exports}var Ls={exports:{}};Ls.exports;var Kh;function Xy(){return Kh||(Kh=1,function(n,e){var t=200,r="__lodash_hash_undefined__",i=1,s=2,o=9007199254740991,a="[object Arguments]",l="[object Array]",c="[object AsyncFunction]",u="[object Boolean]",f="[object Date]",d="[object Error]",h="[object Function]",p="[object GeneratorFunction]",m="[object Map]",y="[object Number]",b="[object Null]",_="[object Object]",x="[object Promise]",T="[object Proxy]",P="[object RegExp]",M="[object Set]",L="[object String]",A="[object Symbol]",I="[object Undefined]",B="[object WeakMap]",k="[object ArrayBuffer]",N="[object DataView]",w="[object Float32Array]",R="[object Float64Array]",j="[object Int8Array]",D="[object Int16Array]",z="[object Int32Array]",H="[object Uint8Array]",V="[object Uint8ClampedArray]",G="[object Uint16Array]",ee="[object Uint32Array]",Q=/[\\^$.*+?()[\]{}|]/g,re=/^\[object .+?Constructor\]$/,oe=/^(?:0|[1-9]\d*)$/,X={};X[w]=X[R]=X[j]=X[D]=X[z]=X[H]=X[V]=X[G]=X[ee]=!0,X[a]=X[l]=X[k]=X[u]=X[N]=X[f]=X[d]=X[h]=X[m]=X[y]=X[_]=X[P]=X[M]=X[L]=X[B]=!1;var fe=typeof Xn=="object"&&Xn&&Xn.Object===Object&&Xn,be=typeof self=="object"&&self&&self.Object===Object&&self,se=fe||be||Function("return this")(),ue=e&&!e.nodeType&&e,he=ue&&!0&&n&&!n.nodeType&&n,ke=he&&he.exports===ue,Ce=ke&&fe.process,Se=function(){try{return Ce&&Ce.binding&&Ce.binding("util")}catch{}}(),Le=Se&&Se.isTypedArray;function st(g,v){for(var E=-1,U=g==null?0:g.length,le=0,te=[];++E<U;){var _e=g[E];v(_e,E,g)&&(te[le++]=_e)}return te}function us(g,v){for(var E=-1,U=v.length,le=g.length;++E<U;)g[le+E]=v[E];return g}function Oo(g,v){for(var E=-1,U=g==null?0:g.length;++E<U;)if(v(g[E],E,g))return!0;return!1}function zl(g,v){for(var E=-1,U=Array(g);++E<g;)U[E]=v(E);return U}function Wl(g){return function(v){return g(v)}}function ci(g,v){return g.has(v)}function ds(g,v){return g==null?void 0:g[v]}function $o(g){var v=-1,E=Array(g.size);return g.forEach(function(U,le){E[++v]=[le,U]}),E}function Io(g,v){return function(E){return g(v(E))}}function rn(g){var v=-1,E=Array(g.size);return g.forEach(function(U){E[++v]=U}),E}var ui=Array.prototype,Kl=Function.prototype,xr=Object.prototype,di=se["__core-js_shared__"],fs=Kl.toString,$t=xr.hasOwnProperty,Po=function(){var g=/[^.]+$/.exec(di&&di.keys&&di.keys.IE_PROTO||"");return g?"Symbol(src)_1."+g:""}(),Ro=xr.toString,Hl=RegExp("^"+fs.call($t).replace(Q,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),hs=ke?se.Buffer:void 0,fi=se.Symbol,Lo=se.Uint8Array,hi=xr.propertyIsEnumerable,Cr=ui.splice,Ut=fi?fi.toStringTag:void 0,gi=Object.getOwnPropertySymbols,gs=hs?hs.isBuffer:void 0,wr=Io(Object.keys,Object),ps=xn(se,"DataView"),Sr=xn(se,"Map"),ms=xn(se,"Promise"),ys=xn(se,"Set"),_s=xn(se,"WeakMap"),Jn=xn(Object,"create"),Do=gt(ps),kn=gt(Sr),Jl=gt(ms),Vl=gt(ys),Gl=gt(_s),jo=fi?fi.prototype:void 0,bs=jo?jo.valueOf:void 0;function Ye(g){var v=-1,E=g==null?0:g.length;for(this.clear();++v<E;){var U=g[v];this.set(U[0],U[1])}}function Yl(){this.__data__=Jn?Jn(null):{},this.size=0}function Xl(g){var v=this.has(g)&&delete this.__data__[g];return this.size-=v?1:0,v}function Ql(g){var v=this.__data__;if(Jn){var E=v[g];return E===r?void 0:E}return $t.call(v,g)?v[g]:void 0}function Zl(g){var v=this.__data__;return Jn?v[g]!==void 0:$t.call(v,g)}function ec(g,v){var E=this.__data__;return this.size+=this.has(g)?0:1,E[g]=Jn&&v===void 0?r:v,this}Ye.prototype.clear=Yl,Ye.prototype.delete=Xl,Ye.prototype.get=Ql,Ye.prototype.has=Zl,Ye.prototype.set=ec;function ot(g){var v=-1,E=g==null?0:g.length;for(this.clear();++v<E;){var U=g[v];this.set(U[0],U[1])}}function tc(){this.__data__=[],this.size=0}function nc(g){var v=this.__data__,E=yi(v,g);if(E<0)return!1;var U=v.length-1;return E==U?v.pop():Cr.call(v,E,1),--this.size,!0}function rc(g){var v=this.__data__,E=yi(v,g);return E<0?void 0:v[E][1]}function ic(g){return yi(this.__data__,g)>-1}function sc(g,v){var E=this.__data__,U=yi(E,g);return U<0?(++this.size,E.push([g,v])):E[U][1]=v,this}ot.prototype.clear=tc,ot.prototype.delete=nc,ot.prototype.get=rc,ot.prototype.has=ic,ot.prototype.set=sc;function vt(g){var v=-1,E=g==null?0:g.length;for(this.clear();++v<E;){var U=g[v];this.set(U[0],U[1])}}function oc(){this.size=0,this.__data__={hash:new Ye,map:new(Sr||ot),string:new Ye}}function ac(g){var v=zt(this,g).delete(g);return this.size-=v?1:0,v}function lc(g){return zt(this,g).get(g)}function cc(g){return zt(this,g).has(g)}function uc(g,v){var E=zt(this,g),U=E.size;return E.set(g,v),this.size+=E.size==U?0:1,this}vt.prototype.clear=oc,vt.prototype.delete=ac,vt.prototype.get=lc,vt.prototype.has=cc,vt.prototype.set=uc;function pi(g){var v=-1,E=g==null?0:g.length;for(this.__data__=new vt;++v<E;)this.add(g[v])}function Fo(g){return this.__data__.set(g,r),this}function mi(g){return this.__data__.has(g)}pi.prototype.add=pi.prototype.push=Fo,pi.prototype.has=mi;function sn(g){var v=this.__data__=new ot(g);this.size=v.size}function vs(){this.__data__=new ot,this.size=0}function dc(g){var v=this.__data__,E=v.delete(g);return this.size=v.size,E}function fc(g){return this.__data__.get(g)}function hc(g){return this.__data__.has(g)}function gc(g,v){var E=this.__data__;if(E instanceof ot){var U=E.__data__;if(!Sr||U.length<t-1)return U.push([g,v]),this.size=++E.size,this;E=this.__data__=new vt(U)}return E.set(g,v),this.size=E.size,this}sn.prototype.clear=vs,sn.prototype.delete=dc,sn.prototype.get=fc,sn.prototype.has=hc,sn.prototype.set=gc;function pc(g,v){var E=_i(g),U=!E&&Wo(g),le=!E&&!U&&bi(g),te=!E&&!U&&!le&&Jo(g),_e=E||U||le||te,ye=_e?zl(g.length,String):[],De=ye.length;for(var xe in g)$t.call(g,xe)&&!(_e&&(xe=="length"||le&&(xe=="offset"||xe=="parent")||te&&(xe=="buffer"||xe=="byteLength"||xe=="byteOffset")||Cc(xe,De)))&&ye.push(xe);return ye}function yi(g,v){for(var E=g.length;E--;)if(zo(g[E][0],v))return E;return-1}function ks(g,v,E){var U=v(g);return _i(g)?U:us(U,E(g))}function Tr(g){return g==null?g===void 0?I:b:Ut&&Ut in Object(g)?Cn(g):Uo(g)}function qo(g){return an(g)&&Tr(g)==a}function Bo(g,v,E,U,le){return g===v?!0:g==null||v==null||!an(g)&&!an(v)?g!==g&&v!==v:mc(g,v,E,U,Bo,le)}function mc(g,v,E,U,le,te){var _e=_i(g),ye=_i(v),De=_e?l:on(g),xe=ye?l:on(v);De=De==a?_:De,xe=xe==a?_:xe;var at=De==_,kt=xe==_,je=De==xe;if(je&&bi(g)){if(!bi(v))return!1;_e=!0,at=!1}if(je&&!at)return te||(te=new sn),_e||Jo(g)?xs(g,v,E,U,le,te):vc(g,v,De,E,U,le,te);if(!(E&i)){var lt=at&&$t.call(g,"__wrapped__"),Xe=kt&&$t.call(v,"__wrapped__");if(lt||Xe){var Vn=lt?g.value():g,wn=Xe?v.value():v;return te||(te=new sn),le(Vn,wn,E,U,te)}}return je?(te||(te=new sn),kc(g,v,E,U,le,te)):!1}function yc(g){if(!Ho(g)||Sc(g))return!1;var v=Ko(g)?Hl:re;return v.test(gt(g))}function _c(g){return an(g)&&ws(g.length)&&!!X[Tr(g)]}function bc(g){if(!Tc(g))return wr(g);var v=[];for(var E in Object(g))$t.call(g,E)&&E!="constructor"&&v.push(E);return v}function xs(g,v,E,U,le,te){var _e=E&i,ye=g.length,De=v.length;if(ye!=De&&!(_e&&De>ye))return!1;var xe=te.get(g);if(xe&&te.get(v))return xe==v;var at=-1,kt=!0,je=E&s?new pi:void 0;for(te.set(g,v),te.set(v,g);++at<ye;){var lt=g[at],Xe=v[at];if(U)var Vn=_e?U(Xe,lt,at,v,g,te):U(lt,Xe,at,g,v,te);if(Vn!==void 0){if(Vn)continue;kt=!1;break}if(je){if(!Oo(v,function(wn,Nr){if(!ci(je,Nr)&&(lt===wn||le(lt,wn,E,U,te)))return je.push(Nr)})){kt=!1;break}}else if(!(lt===Xe||le(lt,Xe,E,U,te))){kt=!1;break}}return te.delete(g),te.delete(v),kt}function vc(g,v,E,U,le,te,_e){switch(E){case N:if(g.byteLength!=v.byteLength||g.byteOffset!=v.byteOffset)return!1;g=g.buffer,v=v.buffer;case k:return!(g.byteLength!=v.byteLength||!te(new Lo(g),new Lo(v)));case u:case f:case y:return zo(+g,+v);case d:return g.name==v.name&&g.message==v.message;case P:case L:return g==v+"";case m:var ye=$o;case M:var De=U&i;if(ye||(ye=rn),g.size!=v.size&&!De)return!1;var xe=_e.get(g);if(xe)return xe==v;U|=s,_e.set(g,v);var at=xs(ye(g),ye(v),U,le,te,_e);return _e.delete(g),at;case A:if(bs)return bs.call(g)==bs.call(v)}return!1}function kc(g,v,E,U,le,te){var _e=E&i,ye=Er(g),De=ye.length,xe=Er(v),at=xe.length;if(De!=at&&!_e)return!1;for(var kt=De;kt--;){var je=ye[kt];if(!(_e?je in v:$t.call(v,je)))return!1}var lt=te.get(g);if(lt&&te.get(v))return lt==v;var Xe=!0;te.set(g,v),te.set(v,g);for(var Vn=_e;++kt<De;){je=ye[kt];var wn=g[je],Nr=v[je];if(U)var Uf=_e?U(Nr,wn,je,v,g,te):U(wn,Nr,je,g,v,te);if(!(Uf===void 0?wn===Nr||le(wn,Nr,E,U,te):Uf)){Xe=!1;break}Vn||(Vn=je=="constructor")}if(Xe&&!Vn){var Vo=g.constructor,Go=v.constructor;Vo!=Go&&"constructor"in g&&"constructor"in v&&!(typeof Vo=="function"&&Vo instanceof Vo&&typeof Go=="function"&&Go instanceof Go)&&(Xe=!1)}return te.delete(g),te.delete(v),Xe}function Er(g){return ks(g,Ss,xc)}function zt(g,v){var E=g.__data__;return wc(v)?E[typeof v=="string"?"string":"hash"]:E.map}function xn(g,v){var E=ds(g,v);return yc(E)?E:void 0}function Cn(g){var v=$t.call(g,Ut),E=g[Ut];try{g[Ut]=void 0;var U=!0}catch{}var le=Ro.call(g);return U&&(v?g[Ut]=E:delete g[Ut]),le}var xc=gi?function(g){return g==null?[]:(g=Object(g),st(gi(g),function(v){return hi.call(g,v)}))}:Nc,on=Tr;(ps&&on(new ps(new ArrayBuffer(1)))!=N||Sr&&on(new Sr)!=m||ms&&on(ms.resolve())!=x||ys&&on(new ys)!=M||_s&&on(new _s)!=B)&&(on=function(g){var v=Tr(g),E=v==_?g.constructor:void 0,U=E?gt(E):"";if(U)switch(U){case Do:return N;case kn:return m;case Jl:return x;case Vl:return M;case Gl:return B}return v});function Cc(g,v){return v=v??o,!!v&&(typeof g=="number"||oe.test(g))&&g>-1&&g%1==0&&g<v}function wc(g){var v=typeof g;return v=="string"||v=="number"||v=="symbol"||v=="boolean"?g!=="__proto__":g===null}function Sc(g){return!!Po&&Po in g}function Tc(g){var v=g&&g.constructor,E=typeof v=="function"&&v.prototype||xr;return g===E}function Uo(g){return Ro.call(g)}function gt(g){if(g!=null){try{return fs.call(g)}catch{}try{return g+""}catch{}}return""}function zo(g,v){return g===v||g!==g&&v!==v}var Wo=qo(function(){return arguments}())?qo:function(g){return an(g)&&$t.call(g,"callee")&&!hi.call(g,"callee")},_i=Array.isArray;function Cs(g){return g!=null&&ws(g.length)&&!Ko(g)}var bi=gs||Mc;function Ec(g,v){return Bo(g,v)}function Ko(g){if(!Ho(g))return!1;var v=Tr(g);return v==h||v==p||v==c||v==T}function ws(g){return typeof g=="number"&&g>-1&&g%1==0&&g<=o}function Ho(g){var v=typeof g;return g!=null&&(v=="object"||v=="function")}function an(g){return g!=null&&typeof g=="object"}var Jo=Le?Wl(Le):_c;function Ss(g){return Cs(g)?pc(g):bc(g)}function Nc(){return[]}function Mc(){return!1}n.exports=Ec}(Ls,Ls.exports)),Ls.exports}var ra={},Hh;function vC(){if(Hh)return ra;Hh=1,Object.defineProperty(ra,"__esModule",{value:!0});const n=Yy(),e=Xy();var t;return function(r){function i(l={},c={},u=!1){typeof l!="object"&&(l={}),typeof c!="object"&&(c={});let f=n(c);u||(f=Object.keys(f).reduce((d,h)=>(f[h]!=null&&(d[h]=f[h]),d),{}));for(const d in l)l[d]!==void 0&&c[d]===void 0&&(f[d]=l[d]);return Object.keys(f).length>0?f:void 0}r.compose=i;function s(l={},c={}){typeof l!="object"&&(l={}),typeof c!="object"&&(c={});const u=Object.keys(l).concat(Object.keys(c)).reduce((f,d)=>(e(l[d],c[d])||(f[d]=c[d]===void 0?null:c[d]),f),{});return Object.keys(u).length>0?u:void 0}r.diff=s;function o(l={},c={}){l=l||{};const u=Object.keys(c).reduce((f,d)=>(c[d]!==l[d]&&l[d]!==void 0&&(f[d]=c[d]),f),{});return Object.keys(l).reduce((f,d)=>(l[d]!==c[d]&&c[d]===void 0&&(f[d]=null),f),u)}r.invert=o;function a(l,c,u=!1){if(typeof l!="object")return c;if(typeof c!="object")return;if(!u)return c;const f=Object.keys(c).reduce((d,h)=>(l[h]===void 0&&(d[h]=c[h]),d),{});return Object.keys(f).length>0?f:void 0}r.transform=a}(t||(t={})),ra.default=t,ra}var ia={},Jh;function Qy(){if(Jh)return ia;Jh=1,Object.defineProperty(ia,"__esModule",{value:!0});var n;return function(e){function t(r){return typeof r.delete=="number"?r.delete:typeof r.retain=="number"?r.retain:typeof r.retain=="object"&&r.retain!==null?1:typeof r.insert=="string"?r.insert.length:1}e.length=t}(n||(n={})),ia.default=n,ia}var sa={},Vh;function kC(){if(Vh)return sa;Vh=1,Object.defineProperty(sa,"__esModule",{value:!0});const n=Qy();class e{constructor(r){this.ops=r,this.index=0,this.offset=0}hasNext(){return this.peekLength()<1/0}next(r){r||(r=1/0);const i=this.ops[this.index];if(i){const s=this.offset,o=n.default.length(i);if(r>=o-s?(r=o-s,this.index+=1,this.offset=0):this.offset+=r,typeof i.delete=="number")return{delete:r};{const a={};return i.attributes&&(a.attributes=i.attributes),typeof i.retain=="number"?a.retain=r:typeof i.retain=="object"&&i.retain!==null?a.retain=i.retain:typeof i.insert=="string"?a.insert=i.insert.substr(s,r):a.insert=i.insert,a}}else return{retain:1/0}}peek(){return this.ops[this.index]}peekLength(){return this.ops[this.index]?n.default.length(this.ops[this.index])-this.offset:1/0}peekType(){const r=this.ops[this.index];return r?typeof r.delete=="number"?"delete":typeof r.retain=="number"||typeof r.retain=="object"&&r.retain!==null?"retain":"insert":"retain"}rest(){if(this.hasNext()){if(this.offset===0)return this.ops.slice(this.index);{const r=this.offset,i=this.index,s=this.next(),o=this.ops.slice(this.index);return this.offset=r,this.index=i,[s].concat(o)}}else return[]}}return sa.default=e,sa}var Gh;function xC(){return Gh||(Gh=1,function(n,e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeMap=e.OpIterator=e.Op=void 0;const t=bC(),r=Yy(),i=Xy(),s=vC();e.AttributeMap=s.default;const o=Qy();e.Op=o.default;const a=kC();e.OpIterator=a.default;const l="\0",c=(f,d)=>{if(typeof f!="object"||f===null)throw new Error(`cannot retain a ${typeof f}`);if(typeof d!="object"||d===null)throw new Error(`cannot retain a ${typeof d}`);const h=Object.keys(f)[0];if(!h||h!==Object.keys(d)[0])throw new Error(`embed types not matched: ${h} != ${Object.keys(d)[0]}`);return[h,f[h],d[h]]};class u{constructor(d){Array.isArray(d)?this.ops=d:d!=null&&Array.isArray(d.ops)?this.ops=d.ops:this.ops=[]}static registerEmbed(d,h){this.handlers[d]=h}static unregisterEmbed(d){delete this.handlers[d]}static getHandler(d){const h=this.handlers[d];if(!h)throw new Error(`no handlers for embed type "${d}"`);return h}insert(d,h){const p={};return typeof d=="string"&&d.length===0?this:(p.insert=d,h!=null&&typeof h=="object"&&Object.keys(h).length>0&&(p.attributes=h),this.push(p))}delete(d){return d<=0?this:this.push({delete:d})}retain(d,h){if(typeof d=="number"&&d<=0)return this;const p={retain:d};return h!=null&&typeof h=="object"&&Object.keys(h).length>0&&(p.attributes=h),this.push(p)}push(d){let h=this.ops.length,p=this.ops[h-1];if(d=r(d),typeof p=="object"){if(typeof d.delete=="number"&&typeof p.delete=="number")return this.ops[h-1]={delete:p.delete+d.delete},this;if(typeof p.delete=="number"&&d.insert!=null&&(h-=1,p=this.ops[h-1],typeof p!="object"))return this.ops.unshift(d),this;if(i(d.attributes,p.attributes)){if(typeof d.insert=="string"&&typeof p.insert=="string")return this.ops[h-1]={insert:p.insert+d.insert},typeof d.attributes=="object"&&(this.ops[h-1].attributes=d.attributes),this;if(typeof d.retain=="number"&&typeof p.retain=="number")return this.ops[h-1]={retain:p.retain+d.retain},typeof d.attributes=="object"&&(this.ops[h-1].attributes=d.attributes),this}}return h===this.ops.length?this.ops.push(d):this.ops.splice(h,0,d),this}chop(){const d=this.ops[this.ops.length-1];return d&&typeof d.retain=="number"&&!d.attributes&&this.ops.pop(),this}filter(d){return this.ops.filter(d)}forEach(d){this.ops.forEach(d)}map(d){return this.ops.map(d)}partition(d){const h=[],p=[];return this.forEach(m=>{(d(m)?h:p).push(m)}),[h,p]}reduce(d,h){return this.ops.reduce(d,h)}changeLength(){return this.reduce((d,h)=>h.insert?d+o.default.length(h):h.delete?d-h.delete:d,0)}length(){return this.reduce((d,h)=>d+o.default.length(h),0)}slice(d=0,h=1/0){const p=[],m=new a.default(this.ops);let y=0;for(;y<h&&m.hasNext();){let b;y<d?b=m.next(d-y):(b=m.next(h-y),p.push(b)),y+=o.default.length(b)}return new u(p)}compose(d){const h=new a.default(this.ops),p=new a.default(d.ops),m=[],y=p.peek();if(y!=null&&typeof y.retain=="number"&&y.attributes==null){let _=y.retain;for(;h.peekType()==="insert"&&h.peekLength()<=_;)_-=h.peekLength(),m.push(h.next());y.retain-_>0&&p.next(y.retain-_)}const b=new u(m);for(;h.hasNext()||p.hasNext();)if(p.peekType()==="insert")b.push(p.next());else if(h.peekType()==="delete")b.push(h.next());else{const _=Math.min(h.peekLength(),p.peekLength()),x=h.next(_),T=p.next(_);if(T.retain){const P={};if(typeof x.retain=="number")P.retain=typeof T.retain=="number"?_:T.retain;else if(typeof T.retain=="number")x.retain==null?P.insert=x.insert:P.retain=x.retain;else{const L=x.retain==null?"insert":"retain",[A,I,B]=c(x[L],T.retain),k=u.getHandler(A);P[L]={[A]:k.compose(I,B,L==="retain")}}const M=s.default.compose(x.attributes,T.attributes,typeof x.retain=="number");if(M&&(P.attributes=M),b.push(P),!p.hasNext()&&i(b.ops[b.ops.length-1],P)){const L=new u(h.rest());return b.concat(L).chop()}}else typeof T.delete=="number"&&(typeof x.retain=="number"||typeof x.retain=="object"&&x.retain!==null)&&b.push(T)}return b.chop()}concat(d){const h=new u(this.ops.slice());return d.ops.length>0&&(h.push(d.ops[0]),h.ops=h.ops.concat(d.ops.slice(1))),h}diff(d,h){if(this.ops===d.ops)return new u;const p=[this,d].map(x=>x.map(T=>{if(T.insert!=null)return typeof T.insert=="string"?T.insert:l;const P=x===d?"on":"with";throw new Error("diff() called "+P+" non-document")}).join("")),m=new u,y=t(p[0],p[1],h,!0),b=new a.default(this.ops),_=new a.default(d.ops);return y.forEach(x=>{let T=x[1].length;for(;T>0;){let P=0;switch(x[0]){case t.INSERT:P=Math.min(_.peekLength(),T),m.push(_.next(P));break;case t.DELETE:P=Math.min(T,b.peekLength()),b.next(P),m.delete(P);break;case t.EQUAL:P=Math.min(b.peekLength(),_.peekLength(),T);const M=b.next(P),L=_.next(P);i(M.insert,L.insert)?m.retain(P,s.default.diff(M.attributes,L.attributes)):m.push(L).delete(P);break}T-=P}}),m.chop()}eachLine(d,h=`
`){const p=new a.default(this.ops);let m=new u,y=0;for(;p.hasNext();){if(p.peekType()!=="insert")return;const b=p.peek(),_=o.default.length(b)-p.peekLength(),x=typeof b.insert=="string"?b.insert.indexOf(h,_)-_:-1;if(x<0)m.push(p.next());else if(x>0)m.push(p.next(x));else{if(d(m,p.next(1).attributes||{},y)===!1)return;y+=1,m=new u}}m.length()>0&&d(m,{},y)}invert(d){const h=new u;return this.reduce((p,m)=>{if(m.insert)h.delete(o.default.length(m));else{if(typeof m.retain=="number"&&m.attributes==null)return h.retain(m.retain),p+m.retain;if(m.delete||typeof m.retain=="number"){const y=m.delete||m.retain;return d.slice(p,p+y).forEach(_=>{m.delete?h.push(_):m.retain&&m.attributes&&h.retain(o.default.length(_),s.default.invert(m.attributes,_.attributes))}),p+y}else if(typeof m.retain=="object"&&m.retain!==null){const y=d.slice(p,p+1),b=new a.default(y.ops).next(),[_,x,T]=c(m.retain,b.insert),P=u.getHandler(_);return h.retain({[_]:P.invert(x,T)},s.default.invert(m.attributes,b.attributes)),p+1}}return p},0),h.chop()}transform(d,h=!1){if(h=!!h,typeof d=="number")return this.transformPosition(d,h);const p=d,m=new a.default(this.ops),y=new a.default(p.ops),b=new u;for(;m.hasNext()||y.hasNext();)if(m.peekType()==="insert"&&(h||y.peekType()!=="insert"))b.retain(o.default.length(m.next()));else if(y.peekType()==="insert")b.push(y.next());else{const _=Math.min(m.peekLength(),y.peekLength()),x=m.next(_),T=y.next(_);if(x.delete)continue;if(T.delete)b.push(T);else{const P=x.retain,M=T.retain;let L=typeof M=="object"&&M!==null?M:_;if(typeof P=="object"&&P!==null&&typeof M=="object"&&M!==null){const A=Object.keys(P)[0];if(A===Object.keys(M)[0]){const I=u.getHandler(A);I&&(L={[A]:I.transform(P[A],M[A],h)})}}b.retain(L,s.default.transform(x.attributes,T.attributes,h))}}return b.chop()}transformPosition(d,h=!1){h=!!h;const p=new a.default(this.ops);let m=0;for(;p.hasNext()&&m<=d;){const y=p.peekLength(),b=p.peekType();if(p.next(),b==="delete"){d-=Math.min(y,d-m);continue}else b==="insert"&&(m<d||!h)&&(d+=y);m+=y}return d}}u.Op=o.default,u.OpIterator=a.default,u.AttributeMap=s.default,u.handlers={},e.default=u,n.exports=u,n.exports.default=u}(na,na.exports)),na.exports}var CC=xC();const Ds=Lv(CC);var wC=Object.getOwnPropertyNames,SC=Object.getOwnPropertySymbols,TC=Object.prototype.hasOwnProperty;function Yh(n,e){return function(r,i,s){return n(r,i,s)&&e(r,i,s)}}function oa(n){return function(t,r,i){if(!t||!r||typeof t!="object"||typeof r!="object")return n(t,r,i);var s=i.cache,o=s.get(t),a=s.get(r);if(o&&a)return o===r&&a===t;s.set(t,r),s.set(r,t);var l=n(t,r,i);return s.delete(t),s.delete(r),l}}function Xh(n){return wC(n).concat(SC(n))}var EC=Object.hasOwn||function(n,e){return TC.call(n,e)};function si(n,e){return n===e||!n&&!e&&n!==n&&e!==e}var NC="__v",MC="__o",AC="_owner",Qh=Object.getOwnPropertyDescriptor,Zh=Object.keys;function OC(n,e,t){var r=n.length;if(e.length!==r)return!1;for(;r-- >0;)if(!t.equals(n[r],e[r],r,r,n,e,t))return!1;return!0}function $C(n,e){return si(n.getTime(),e.getTime())}function IC(n,e){return n.name===e.name&&n.message===e.message&&n.cause===e.cause&&n.stack===e.stack}function PC(n,e){return n===e}function eg(n,e,t){var r=n.size;if(r!==e.size)return!1;if(!r)return!0;for(var i=new Array(r),s=n.entries(),o,a,l=0;(o=s.next())&&!o.done;){for(var c=e.entries(),u=!1,f=0;(a=c.next())&&!a.done;){if(i[f]){f++;continue}var d=o.value,h=a.value;if(t.equals(d[0],h[0],l,f,n,e,t)&&t.equals(d[1],h[1],d[0],h[0],n,e,t)){u=i[f]=!0;break}f++}if(!u)return!1;l++}return!0}var RC=si;function LC(n,e,t){var r=Zh(n),i=r.length;if(Zh(e).length!==i)return!1;for(;i-- >0;)if(!Zy(n,e,t,r[i]))return!1;return!0}function Ns(n,e,t){var r=Xh(n),i=r.length;if(Xh(e).length!==i)return!1;for(var s,o,a;i-- >0;)if(s=r[i],!Zy(n,e,t,s)||(o=Qh(n,s),a=Qh(e,s),(o||a)&&(!o||!a||o.configurable!==a.configurable||o.enumerable!==a.enumerable||o.writable!==a.writable)))return!1;return!0}function DC(n,e){return si(n.valueOf(),e.valueOf())}function jC(n,e){return n.source===e.source&&n.flags===e.flags}function tg(n,e,t){var r=n.size;if(r!==e.size)return!1;if(!r)return!0;for(var i=new Array(r),s=n.values(),o,a;(o=s.next())&&!o.done;){for(var l=e.values(),c=!1,u=0;(a=l.next())&&!a.done;){if(!i[u]&&t.equals(o.value,a.value,o.value,a.value,n,e,t)){c=i[u]=!0;break}u++}if(!c)return!1}return!0}function FC(n,e){var t=n.length;if(e.length!==t)return!1;for(;t-- >0;)if(n[t]!==e[t])return!1;return!0}function qC(n,e){return n.hostname===e.hostname&&n.pathname===e.pathname&&n.protocol===e.protocol&&n.port===e.port&&n.hash===e.hash&&n.username===e.username&&n.password===e.password}function Zy(n,e,t,r){return(r===AC||r===MC||r===NC)&&(n.$$typeof||e.$$typeof)?!0:EC(e,r)&&t.equals(n[r],e[r],r,r,n,e,t)}var BC="[object Arguments]",UC="[object Boolean]",zC="[object Date]",WC="[object Error]",KC="[object Map]",HC="[object Number]",JC="[object Object]",VC="[object RegExp]",GC="[object Set]",YC="[object String]",XC="[object URL]",QC=Array.isArray,ng=typeof ArrayBuffer=="function"&&ArrayBuffer.isView?ArrayBuffer.isView:null,rg=Object.assign,ZC=Object.prototype.toString.call.bind(Object.prototype.toString);function ew(n){var e=n.areArraysEqual,t=n.areDatesEqual,r=n.areErrorsEqual,i=n.areFunctionsEqual,s=n.areMapsEqual,o=n.areNumbersEqual,a=n.areObjectsEqual,l=n.arePrimitiveWrappersEqual,c=n.areRegExpsEqual,u=n.areSetsEqual,f=n.areTypedArraysEqual,d=n.areUrlsEqual;return function(p,m,y){if(p===m)return!0;if(p==null||m==null)return!1;var b=typeof p;if(b!==typeof m)return!1;if(b!=="object")return b==="number"?o(p,m,y):b==="function"?i(p,m,y):!1;var _=p.constructor;if(_!==m.constructor)return!1;if(_===Object)return a(p,m,y);if(QC(p))return e(p,m,y);if(ng!=null&&ng(p))return f(p,m,y);if(_===Date)return t(p,m,y);if(_===RegExp)return c(p,m,y);if(_===Map)return s(p,m,y);if(_===Set)return u(p,m,y);var x=ZC(p);return x===zC?t(p,m,y):x===VC?c(p,m,y):x===KC?s(p,m,y):x===GC?u(p,m,y):x===JC?typeof p.then!="function"&&typeof m.then!="function"&&a(p,m,y):x===XC?d(p,m,y):x===WC?r(p,m,y):x===BC?a(p,m,y):x===UC||x===HC||x===YC?l(p,m,y):!1}}function tw(n){var e=n.circular,t=n.createCustomConfig,r=n.strict,i={areArraysEqual:r?Ns:OC,areDatesEqual:$C,areErrorsEqual:IC,areFunctionsEqual:PC,areMapsEqual:r?Yh(eg,Ns):eg,areNumbersEqual:RC,areObjectsEqual:r?Ns:LC,arePrimitiveWrappersEqual:DC,areRegExpsEqual:jC,areSetsEqual:r?Yh(tg,Ns):tg,areTypedArraysEqual:r?Ns:FC,areUrlsEqual:qC};if(t&&(i=rg({},i,t(i))),e){var s=oa(i.areArraysEqual),o=oa(i.areMapsEqual),a=oa(i.areObjectsEqual),l=oa(i.areSetsEqual);i=rg({},i,{areArraysEqual:s,areMapsEqual:o,areObjectsEqual:a,areSetsEqual:l})}return i}function nw(n){return function(e,t,r,i,s,o,a){return n(e,t,a)}}function rw(n){var e=n.circular,t=n.comparator,r=n.createState,i=n.equals,s=n.strict;if(r)return function(l,c){var u=r(),f=u.cache,d=f===void 0?e?new WeakMap:void 0:f,h=u.meta;return t(l,c,{cache:d,equals:i,meta:h,strict:s})};if(e)return function(l,c){return t(l,c,{cache:new WeakMap,equals:i,meta:void 0,strict:s})};var o={cache:void 0,equals:i,meta:void 0,strict:s};return function(l,c){return t(l,c,o)}}var $n=yr();yr({strict:!0});yr({circular:!0});yr({circular:!0,strict:!0});yr({createInternalComparator:function(){return si}});yr({strict:!0,createInternalComparator:function(){return si}});yr({circular:!0,createInternalComparator:function(){return si}});yr({circular:!0,createInternalComparator:function(){return si},strict:!0});function yr(n){n===void 0&&(n={});var e=n.circular,t=e===void 0?!1:e,r=n.createInternalComparator,i=n.createState,s=n.strict,o=s===void 0?!1:s,a=tw(n),l=ew(a),c=r?r(l):nw(l);return rw({circular:t,comparator:l,createState:i,equals:c,strict:o})}const e_=C.createContext(null);function iw(n,e){return{getTheme:function(){return e??null}}}function ge(){const n=C.useContext(e_);return n==null&&function(e,...t){const r=new URL("https://lexical.dev/docs/error"),i=new URLSearchParams;i.append("code",e);for(const s of t)i.append("v",s);throw r.search=i.toString(),Error(`Minified Lexical error #${e}; visit ${r.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}(8),n}function sw(n,e){const t=e.body?e.body.childNodes:[];let r=[];const i=[];for(let s=0;s<t.length;s++){const o=t[s];if(!r_.has(o.nodeName)){const a=i_(o,n,i,!1);a!==null&&(r=r.concat(a))}}return function(s){for(const o of s)o.getNextSibling()instanceof Dd&&o.insertAfter(Ur());for(const o of s){const a=o.getChildren();for(const l of a)o.insertBefore(l);o.remove()}}(i),r}function t_(n,e){if(typeof document>"u"||typeof window>"u"&&global.window===void 0)throw new Error("To use $generateHtmlFromNodes in headless mode please initialize a headless browser implementation such as JSDom before calling this function.");const t=document.createElement("div"),r=me().getChildren();for(let i=0;i<r.length;i++)n_(n,r[i],t,e);return t.innerHTML}function n_(n,e,t,r=null){let i=r===null||e.isSelected(r);const s=F(e)&&e.excludeFromCopy("html");let o=e;if(r!==null){let h=Vd(e);h=W(h)&&r!==null?Wy(r,h):h,o=h}const a=F(o)?o.getChildren():[],l=qd(n,o.getType());let c;c=l&&l.exportDOM!==void 0?l.exportDOM(n,o):o.exportDOM(n);const{element:u,after:f}=c;if(!u)return!1;const d=document.createDocumentFragment();for(let h=0;h<a.length;h++){const p=a[h],m=n_(n,p,d,r);!i&&F(e)&&m&&e.extractWithChild(p,r,"html")&&(i=!0)}if(i&&!s){if((Te(u)||Au(u))&&u.append(d),t.append(u),f){const h=f.call(o,u);h&&(Au(u)?u.replaceChildren(h):u.replaceWith(h))}}else t.append(d);return i}const r_=new Set(["STYLE","SCRIPT"]);function i_(n,e,t,r,i=new Map,s){let o=[];if(r_.has(n.nodeName))return o;let a=null;const l=function(p,m){const{nodeName:y}=p,b=m._htmlConversions.get(y.toLowerCase());let _=null;if(b!==void 0)for(const x of b){const T=x(p);T!==null&&(_===null||(_.priority||0)<=(T.priority||0))&&(_=T)}return _!==null?_.conversion:null}(n,e),c=l?l(n):null;let u=null;if(c!==null){u=c.after;const p=c.node;if(a=Array.isArray(p)?p[p.length-1]:p,a!==null){for(const[,m]of i)if(a=m(a,s),!a)break;a&&o.push(...Array.isArray(p)?p:[a])}c.forChild!=null&&i.set(n.nodeName,c.forChild)}const f=n.childNodes;let d=[];const h=(a==null||!vn(a))&&(a!=null&&wu(a)||r);for(let p=0;p<f.length;p++)d.push(...i_(f[p],e,t,h,new Map(i),a));return u!=null&&(d=u(d)),tl(n)&&(d=ow(n,d,h?()=>{const p=new Dd;return t.push(p),p}:Ot)),a==null?d.length>0?o=o.concat(d):tl(n)&&function(p){return p.nextSibling==null||p.previousSibling==null?!1:Ou(p.nextSibling)&&Ou(p.previousSibling)}(n)&&(o=o.concat(Ur())):F(a)&&a.append(...d),o}function ow(n,e,t){const r=n.style.textAlign,i=[];let s=[];for(let o=0;o<e.length;o++){const a=e[o];if(wu(a))r&&!a.getFormat()&&a.setFormat(r),i.push(a);else if(s.push(a),o===e.length-1||o<e.length-1&&wu(e[o+1])){const l=t();l.setFormat(r),l.append(...s),i.push(l),s=[]}}return i}const aw=new Set(["http:","https:","mailto:","sms:","tel:"]);let s_=class o_ extends ht{static getType(){return"link"}static clone(e){return new o_(e.__url,{rel:e.__rel,target:e.__target,title:e.__title},e.__key)}constructor(e="",t={},r){super(r);const{target:i=null,rel:s=null,title:o=null}=t;this.__url=e,this.__target=i,this.__rel=s,this.__title=o}createDOM(e){const t=document.createElement("a");return this.updateLinkDOM(null,t,e),ct(t,e.theme.link),t}updateLinkDOM(e,t,r){if(Dy(t)){e&&e.__url===this.__url||(t.href=this.sanitizeUrl(this.__url));for(const i of["target","rel","title"]){const s=`__${i}`,o=this[s];e&&e[s]===o||(o?t[i]=o:t.removeAttribute(i))}}}updateDOM(e,t,r){return this.updateLinkDOM(e,t,r),!1}static importDOM(){return{a:e=>({conversion:lw,priority:1})}}static importJSON(e){return Lu().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setURL(e.url).setRel(e.rel||null).setTarget(e.target||null).setTitle(e.title||null)}sanitizeUrl(e){e=ig(e);try{const t=new URL(ig(e));if(!aw.has(t.protocol))return"about:blank"}catch{return e}return e}exportJSON(){return{...super.exportJSON(),rel:this.getRel(),target:this.getTarget(),title:this.getTitle(),url:this.getURL()}}getURL(){return this.getLatest().__url}setURL(e){const t=this.getWritable();return t.__url=e,t}getTarget(){return this.getLatest().__target}setTarget(e){const t=this.getWritable();return t.__target=e,t}getRel(){return this.getLatest().__rel}setRel(e){const t=this.getWritable();return t.__rel=e,t}getTitle(){return this.getLatest().__title}setTitle(e){const t=this.getWritable();return t.__title=e,t}insertNewAfter(e,t=!0){const r=Lu(this.__url,{rel:this.__rel,target:this.__target,title:this.__title});return this.insertAfter(r,t),r}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}canBeEmpty(){return!1}isInline(){return!0}extractWithChild(e,t,r){if(!q(t))return!1;const i=t.anchor.getNode(),s=t.focus.getNode();return this.isParentOf(i)&&this.isParentOf(s)&&t.getTextContent().length>0}isEmailURI(){return this.__url.startsWith("mailto:")}isWebSiteURI(){return this.__url.startsWith("https://")||this.__url.startsWith("http://")}};function lw(n){let e=null;if(Dy(n)){const t=n.textContent;(t!==null&&t!==""||n.children.length>0)&&(e=Lu(n.getAttribute("href")||"",{rel:n.getAttribute("rel"),target:n.getAttribute("target"),title:n.getAttribute("title")}))}return{node:e}}function Lu(n="",e){return Ae(new s_(n,e))}function cw(n){return n instanceof s_}const uw=/^\+?[0-9\s()-]{5,}$/;function ig(n){return n.match(/^[a-z][a-z0-9+.-]*:/i)||n.match(/^[/#.]/)?n:n.includes("@")?`mailto:${n}`:uw.test(n)?`tel:${n}`:`https://${n}`}const a_=[];let l_=class c_ extends ht{static getType(){return"mark"}static clone(e){return new c_(e.__ids,e.__key)}static importDOM(){return null}static importJSON(e){return sg().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setIDs(e.ids)}exportJSON(){return{...super.exportJSON(),ids:this.getIDs()}}constructor(e=a_,t){super(t),this.__ids=e}createDOM(e){const t=document.createElement("mark");return ct(t,e.theme.mark),this.__ids.length>1&&ct(t,e.theme.markOverlap),t}updateDOM(e,t,r){const i=e.__ids,s=this.__ids,o=i.length,a=s.length,l=r.theme.markOverlap;return o!==a&&(o===1?a===2&&ct(t,l):a===1&&Dr(t,l)),!1}hasID(e){return this.getIDs().includes(e)}getIDs(){return Array.from(this.getLatest().__ids)}setIDs(e){const t=this.getWritable();return t.__ids=e,t}addID(e){const t=this.getWritable();return t.__ids.includes(e)?t:t.setIDs([...t.__ids,e])}deleteID(e){const t=this.getWritable(),r=t.__ids.indexOf(e);if(r===-1)return t;const i=Array.from(t.__ids);return i.splice(r,1),t.setIDs(i)}insertNewAfter(e,t=!0){const r=sg(this.__ids);return this.insertAfter(r,t),r}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}canBeEmpty(){return!1}isInline(){return!0}extractWithChild(e,t,r){if(!q(t)||r==="html")return!1;const i=t.anchor,s=t.focus,o=i.getNode(),a=s.getNode(),l=t.isBackward()?i.offset-s.offset:s.offset-i.offset;return this.isParentOf(o)&&this.isParentOf(a)&&this.getTextContent().length===l}excludeFromCopy(e){return e!=="clone"}};function sg(n=a_){return Ae(new l_(n))}function dw(n){return n instanceof l_}function ol(n,...e){const t=new URL("https://lexical.dev/docs/error"),r=new URLSearchParams;r.append("code",n);for(const i of e)r.append("v",i);throw t.search=r.toString(),Error(`Minified Lexical error #${n}; visit ${t.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}function u_(n,e=K()){return e==null&&ol(166),q(e)&&e.isCollapsed()||e.getNodes().length===0?"":t_(n,e)}function fw(n,e=K()){return e==null&&ol(166),q(e)&&e.isCollapsed()||e.getNodes().length===0?null:JSON.stringify(hw(n,e))}function og(n,e){const t=n.getData("text/plain")||n.getData("text/uri-list");t!=null&&e.insertRawText(t)}function ag(n,e,t){const r=n.getData("application/x-lexical-editor");if(r)try{const a=JSON.parse(r);if(a.namespace===t._config.namespace&&Array.isArray(a.nodes))return lg(t,gw(a.nodes),e)}catch{}const i=n.getData("text/html"),s=n.getData("text/plain");if(i&&s!==i)try{const a=new DOMParser().parseFromString(function(l){return window.trustedTypes&&window.trustedTypes.createPolicy?window.trustedTypes.createPolicy("lexical",{createHTML:c=>c}).createHTML(l):l}(i),"text/html");return lg(t,sw(t,a),e)}catch{}const o=s||n.getData("text/uri-list");if(o!=null)if(q(e)){const a=o.split(/(\r?\n|\t)/);a[a.length-1]===""&&a.pop();for(let l=0;l<a.length;l++){const c=K();if(q(c)){const u=a[l];u===`
`||u===`\r
`?c.insertParagraph():u==="	"?c.insertNodes([po()]):c.insertText(u)}}}else e.insertRawText(o)}function lg(n,e,t){n.dispatchCommand(Gk,{nodes:e,selection:t})||(t.insertNodes(e),function(r){if(q(r)&&r.isCollapsed()){const i=r.anchor;let s=null;const o=jn(i,"previous");if(o)if(rr(o))s=o.origin;else{const a=lr(o,Xt(me(),"next").getFlipped());for(const l of a){if(W(l.origin)){s=l.origin;break}if(F(l.origin)&&!l.origin.isInline())break}}if(s&&W(s)){const a=s.getFormat(),l=s.getStyle();r.format===a&&r.style===l||(r.format=a,r.style=l,r.dirty=!0)}}}(t))}function d_(n,e,t,r=[]){let i=e===null||t.isSelected(e);const s=F(t)&&t.excludeFromCopy("html");let o=t;if(e!==null){let c=Vd(t);c=W(c)&&e!==null?Wy(e,c):c,o=c}const a=F(o)?o.getChildren():[],l=function(c){const u=c.exportJSON(),f=c.constructor;if(u.type!==f.getType()&&ol(58,f.name),F(c)){const d=u.children;Array.isArray(d)||ol(59,f.name)}return u}(o);if(W(o)){const c=o.__text;c.length>0?l.text=c:i=!1}for(let c=0;c<a.length;c++){const u=a[c],f=d_(n,e,u,l.children);!i&&F(t)&&f&&t.extractWithChild(u,e,"clone")&&(i=!0)}if(i&&!s)r.push(l);else if(Array.isArray(l.children))for(let c=0;c<l.children.length;c++){const u=l.children[c];r.push(u)}return i}function hw(n,e){const t=[],r=me().getChildren();for(let i=0;i<r.length;i++)d_(n,e,r[i],t);return{namespace:n._config.namespace,nodes:t}}function gw(n){const e=[];for(let t=0;t<n.length;t++){const r=n[t],i=by(r);W(i)&&nC(i),e.push(i)}return e}let ki=null;async function cg(n,e,t){if(ki!==null)return!1;if(e!==null)return new Promise((c,u)=>{n.update(()=>{c(ug(n,e,t))})});const r=n.getRootElement(),i=n._window||window,s=window.document,o=Yt(i);if(r===null||o===null)return!1;const a=s.createElement("span");a.style.cssText="position: fixed; top: -1000px;",a.append(s.createTextNode("#")),r.append(a);const l=new Range;return l.setStart(a,0),l.setEnd(a,1),o.removeAllRanges(),o.addRange(l),new Promise((c,u)=>{const f=n.registerCommand(hr,d=>(Rn(d,ClipboardEvent)&&(f(),ki!==null&&(window.clearTimeout(ki),ki=null),c(ug(n,d,t))),!0),Ni);ki=window.setTimeout(()=>{f(),ki=null,c(!1)},50),s.execCommand("copy"),a.remove()})}function ug(n,e,t){if(t===void 0){const i=Yt(n._window);if(!i)return!1;const s=i.anchorNode,o=i.focusNode;if(s!==null&&o!==null&&!_o(n,s,o))return!1;const a=K();if(a===null)return!1;t=mw(a)}e.preventDefault();const r=e.clipboardData;return r!==null&&(yw(r,t),!0)}const pw=[["text/html",u_],["application/x-lexical-editor",fw]];function mw(n=K()){const e={"text/plain":n?n.getTextContent():""};if(n){const t=Ol();for(const[r,i]of pw){const s=i(t,n);s!==null&&(e[r]=s)}}return e}function yw(n,e){for(const t in e){const r=e[t];r!==void 0&&n.setData(t,r)}}const Zd=/^(\d+(?:\.\d+)?)px$/,Ai={BOTH:3,NO_STATUS:0,ROW:1};let ef=class f_ extends ht{static getType(){return"tablecell"}static clone(e){return new f_(e.__headerState,e.__colSpan,e.__width,e.__key)}afterCloneFrom(e){super.afterCloneFrom(e),this.__rowSpan=e.__rowSpan,this.__backgroundColor=e.__backgroundColor,this.__verticalAlign=e.__verticalAlign}static importDOM(){return{td:e=>({conversion:dg,priority:0}),th:e=>({conversion:dg,priority:0})}}static importJSON(e){return h_().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setHeaderStyles(e.headerState).setColSpan(e.colSpan||1).setRowSpan(e.rowSpan||1).setWidth(e.width||void 0).setBackgroundColor(e.backgroundColor||null).setVerticalAlign(e.verticalAlign||void 0)}constructor(e=Ai.NO_STATUS,t=1,r,i){super(i),this.__colSpan=t,this.__rowSpan=1,this.__headerState=e,this.__width=r,this.__backgroundColor=null,this.__verticalAlign=void 0}createDOM(e){const t=document.createElement(this.getTag());return this.__width&&(t.style.width=`${this.__width}px`),this.__colSpan>1&&(t.colSpan=this.__colSpan),this.__rowSpan>1&&(t.rowSpan=this.__rowSpan),this.__backgroundColor!==null&&(t.style.backgroundColor=this.__backgroundColor),Du(this.__verticalAlign)&&(t.style.verticalAlign=this.__verticalAlign),ct(t,e.theme.tableCell,this.hasHeader()&&e.theme.tableCellHeader),t}exportDOM(e){const t=super.exportDOM(e);if(Te(t.element)){const r=t.element;r.setAttribute("data-temporary-table-cell-lexical-key",this.getKey()),r.style.border="1px solid black",this.__colSpan>1&&(r.colSpan=this.__colSpan),this.__rowSpan>1&&(r.rowSpan=this.__rowSpan),r.style.width=`${this.getWidth()||75}px`,r.style.verticalAlign=this.getVerticalAlign()||"top",r.style.textAlign="start",this.__backgroundColor===null&&this.hasHeader()&&(r.style.backgroundColor="#f2f3f5")}return t}exportJSON(){return{...super.exportJSON(),...Du(this.__verticalAlign)&&{verticalAlign:this.__verticalAlign},backgroundColor:this.getBackgroundColor(),colSpan:this.__colSpan,headerState:this.__headerState,rowSpan:this.__rowSpan,width:this.getWidth()}}getColSpan(){return this.getLatest().__colSpan}setColSpan(e){const t=this.getWritable();return t.__colSpan=e,t}getRowSpan(){return this.getLatest().__rowSpan}setRowSpan(e){const t=this.getWritable();return t.__rowSpan=e,t}getTag(){return this.hasHeader()?"th":"td"}setHeaderStyles(e,t=Ai.BOTH){const r=this.getWritable();return r.__headerState=e&t|r.__headerState&~t,r}getHeaderStyles(){return this.getLatest().__headerState}setWidth(e){const t=this.getWritable();return t.__width=e,t}getWidth(){return this.getLatest().__width}getBackgroundColor(){return this.getLatest().__backgroundColor}setBackgroundColor(e){const t=this.getWritable();return t.__backgroundColor=e,t}getVerticalAlign(){return this.getLatest().__verticalAlign}setVerticalAlign(e){const t=this.getWritable();return t.__verticalAlign=e||void 0,t}toggleHeaderStyle(e){const t=this.getWritable();return(t.__headerState&e)===e?t.__headerState-=e:t.__headerState+=e,t}hasHeaderState(e){return(this.getHeaderStyles()&e)===e}hasHeader(){return this.getLatest().__headerState!==Ai.NO_STATUS}updateDOM(e){return e.__headerState!==this.__headerState||e.__width!==this.__width||e.__colSpan!==this.__colSpan||e.__rowSpan!==this.__rowSpan||e.__backgroundColor!==this.__backgroundColor||e.__verticalAlign!==this.__verticalAlign}isShadowRoot(){return!0}collapseAtStart(){return!0}canBeEmpty(){return!1}canIndent(){return!1}};function Du(n){return n==="middle"||n==="bottom"}function dg(n){const e=n,t=n.nodeName.toLowerCase();let r;Zd.test(e.style.width)&&(r=parseFloat(e.style.width));const i=h_(t==="th"?Ai.ROW:Ai.NO_STATUS,e.colSpan,r);i.__rowSpan=e.rowSpan;const s=e.style.backgroundColor;s!==""&&(i.__backgroundColor=s);const o=e.style.verticalAlign;Du(o)&&(i.__verticalAlign=o);const a=e.style,l=(a&&a.textDecoration||"").split(" "),c=a.fontWeight==="700"||a.fontWeight==="bold",u=l.includes("line-through"),f=a.fontStyle==="italic",d=l.includes("underline");return{after:h=>{const p=[];let m=null;const y=()=>{if(m){const b=m.getFirstChild();Ir(b)&&m.getChildrenSize()===1&&b.remove()}};for(const b of h)$x(b)||W(b)||Ir(b)?(W(b)&&(c&&b.toggleFormat("bold"),u&&b.toggleFormat("strikethrough"),f&&b.toggleFormat("italic"),d&&b.toggleFormat("underline")),m?m.append(b):(m=Ot().append(b),p.push(m))):(p.push(b),y(),m=null);return y(),p.length===0&&p.push(Ot()),p},node:i}}function h_(n=Ai.NO_STATUS,e=1,t){return Ae(new ef(n,e,t))}function Mt(n){return n instanceof ef}function qe(n,...e){const t=new URL("https://lexical.dev/docs/error"),r=new URLSearchParams;r.append("code",n);for(const i of e)r.append("v",i);throw t.search=r.toString(),Error(`Minified Lexical error #${n}; visit ${t.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}class Pl extends ht{static getType(){return"tablerow"}static clone(e){return new Pl(e.__height,e.__key)}static importDOM(){return{tr:e=>({conversion:_w,priority:0})}}static importJSON(e){return g_().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setHeight(e.height)}constructor(e,t){super(t),this.__height=e}exportJSON(){const e=this.getHeight();return{...super.exportJSON(),...e===void 0?void 0:{height:e}}}createDOM(e){const t=document.createElement("tr");return this.__height&&(t.style.height=`${this.__height}px`),ct(t,e.theme.tableRow),t}extractWithChild(e,t,r){return r==="html"}isShadowRoot(){return!0}setHeight(e){const t=this.getWritable();return t.__height=e,t}getHeight(){return this.getLatest().__height}updateDOM(e){return e.__height!==this.__height}canBeEmpty(){return!1}canIndent(){return!1}}function _w(n){const e=n;let t;return Zd.test(e.style.height)&&(t=parseFloat(e.style.height)),{after:r=>Gy(r,Mt),node:g_(t)}}function g_(n){return Ae(new Pl(n))}function xo(n){return n instanceof Pl}const p_=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,bw=p_&&"documentMode"in document?document.documentMode:null;p_&&"InputEvent"in window&&!bw&&new window.InputEvent("input");function vw(n,e,t){const[r,i,s]=m_(n,e,t);return i===null&&qe(207),s===null&&qe(208),[r,i,s]}function m_(n,e,t){const r=[];let i=null,s=null;function o(l){let c=r[l];return c===void 0&&(r[l]=c=[]),c}const a=n.getChildren();for(let l=0;l<a.length;l++){const c=a[l];xo(c)||qe(209);const u=o(l);for(let f=c.getFirstChild(),d=0;f!=null;f=f.getNextSibling()){for(Mt(f)||qe(147);u[d]!==void 0;)d++;const h={cell:f,startColumn:d,startRow:l},{__rowSpan:p,__colSpan:m}=f;for(let y=0;y<p&&!(l+y>=a.length);y++){const b=o(l+y);for(let _=0;_<m;_++)b[d+_]=h}e!==null&&i===null&&e.is(f)&&(i=h),t!==null&&s===null&&t.is(f)&&(s=h)}}return[r,i,s]}function kw(n){let e;if(n instanceof ef)e=n;else if("__type"in n){const i=Qt(n,Mt);Mt(i)||qe(148),e=i}else{const i=Qt(n.getNode(),Mt);Mt(i)||qe(148),e=i}const t=e.getParent();xo(t)||qe(149);const r=t.getParent();return x_(r)||qe(210),[e,t,r]}function xw(n,e,t){let r,i=Math.min(e.startColumn,t.startColumn),s=Math.min(e.startRow,t.startRow),o=Math.max(e.startColumn+e.cell.__colSpan-1,t.startColumn+t.cell.__colSpan-1),a=Math.max(e.startRow+e.cell.__rowSpan-1,t.startRow+t.cell.__rowSpan-1);do{r=!1;for(let l=0;l<n.length;l++)for(let c=0;c<n[0].length;c++){const u=n[l][c];if(!u)continue;const f=u.startColumn+u.cell.__colSpan-1,d=u.startRow+u.cell.__rowSpan-1,h=u.startColumn<=o&&f>=i,p=u.startRow<=a&&d>=s;if(h&&p){const m=Math.min(i,u.startColumn),y=Math.max(o,f),b=Math.min(s,u.startRow),_=Math.max(a,d);m===i&&y===o&&b===s&&_===a||(i=m,o=y,s=b,a=_,r=!0)}}}while(r);return{maxColumn:o,maxRow:a,minColumn:i,minRow:s}}function fg(n){const[e,,t]=kw(n),r=t.getChildren(),i=r.length,s=r[0].getChildren().length,o=new Array(i);for(let a=0;a<i;a++)o[a]=new Array(s);for(let a=0;a<i;a++){const l=r[a].getChildren();let c=0;for(let u=0;u<l.length;u++){for(;o[a][c];)c++;const f=l[u],d=f.__rowSpan||1,h=f.__colSpan||1;for(let p=0;p<d;p++)for(let m=0;m<h;m++)o[a+p][c+m]=f;if(e===f)return{colSpan:h,columnIndex:c,rowIndex:a,rowSpan:d};c+=h}}return null}function hg(n){const[[e,t,r,i],[s,o,a,l]]=["anchor","focus"].map(c=>{const u=n[c].getNode(),f=Qt(u,Mt);Mt(f)||qe(238,c,u.getKey(),u.getType());const d=f.getParent();xo(d)||qe(239,c);const h=d.getParent();return x_(h)||qe(240,c),[u,f,d,h]});return i.is(l)||qe(241),{anchorCell:t,anchorNode:e,anchorRow:r,anchorTable:i,focusCell:o,focusNode:s,focusRow:a,focusTable:l}}let Cw=class y_{constructor(e,t,r){this.anchor=t,this.focus=r,t._selection=this,r._selection=this,this._cachedNodes=null,this.dirty=!1,this.tableKey=e}getStartEndPoints(){return[this.anchor,this.focus]}isValid(){return this.tableKey!=="root"&&this.anchor.key!=="root"&&this.anchor.type==="element"&&this.focus.key!=="root"&&this.focus.type==="element"}isBackward(){return this.focus.isBefore(this.anchor)}getCachedNodes(){return this._cachedNodes}setCachedNodes(e){this._cachedNodes=e}is(e){return __(e)&&this.tableKey===e.tableKey&&this.anchor.is(e.anchor)&&this.focus.is(e.focus)}set(e,t,r){this.dirty=this.dirty||e!==this.tableKey||t!==this.anchor.key||r!==this.focus.key,this.tableKey=e,this.anchor.key=t,this.focus.key=r,this._cachedNodes=null}clone(){return new y_(this.tableKey,wt(this.anchor.key,this.anchor.offset,this.anchor.type),wt(this.focus.key,this.focus.offset,this.focus.type))}isCollapsed(){return!1}extract(){return this.getNodes()}insertRawText(e){}insertText(){}hasFormat(e){let t=0;this.getNodes().filter(Mt).forEach(i=>{const s=i.getFirstChild();jd(s)&&(t|=s.getTextFormat())});const r=sr[e];return!!(t&r)}insertNodes(e){const t=this.focus.getNode();F(t)||qe(151),Js(t.select(0,t.getChildrenSize())).insertNodes(e)}getShape(){const{anchorCell:e,focusCell:t}=hg(this),r=fg(e);r===null&&qe(153);const i=fg(t);i===null&&qe(155);const s=Math.min(r.columnIndex,i.columnIndex),o=Math.max(r.columnIndex+r.colSpan-1,i.columnIndex+i.colSpan-1),a=Math.min(r.rowIndex,i.rowIndex),l=Math.max(r.rowIndex+r.rowSpan-1,i.rowIndex+i.rowSpan-1);return{fromX:Math.min(s,o),fromY:Math.min(a,l),toX:Math.max(s,o),toY:Math.max(a,l)}}getNodes(){if(!this.isValid())return[];const e=this._cachedNodes;if(e!==null)return e;const{anchorTable:t,anchorCell:r,focusCell:i}=hg(this),s=i.getParents()[1];if(s!==t){if(t.isParentOf(i)){const y=s.getParent();y==null&&qe(159),this.set(this.tableKey,i.getKey(),y.getKey())}else{const y=t.getParent();y==null&&qe(158),this.set(this.tableKey,y.getKey(),i.getKey())}return this.getNodes()}const[o,a,l]=vw(t,r,i),{minColumn:c,maxColumn:u,minRow:f,maxRow:d}=xw(o,a,l),h=new Map([[t.getKey(),t]]);let p=null;for(let y=f;y<=d;y++)for(let b=c;b<=u;b++){const{cell:_}=o[y][b],x=_.getParent();xo(x)||qe(160),x!==p&&(h.set(x.getKey(),x),p=x),h.has(_.getKey())||ww(_,T=>{h.set(T.getKey(),T)})}const m=Array.from(h.values());return ts()||(this._cachedNodes=m),m}getTextContent(){const e=this.getNodes().filter(r=>Mt(r));let t="";for(let r=0;r<e.length;r++){const i=e[r],s=i.__parent,o=(e[r+1]||{}).__parent;t+=i.getTextContent()+(o!==s?`
`:"	")}return t}};function __(n){return n instanceof Cw}function ww(n,e){const t=[[n]];for(let r=t.at(-1);r!==void 0&&t.length>0;r=t.at(-1)){const i=r.pop();i===void 0?t.pop():e(i)!==!1&&F(i)&&t.push(i.getChildren())}}function Ms(n){return Te(n)&&n.nodeName==="TABLE"}function Sw(n,e){for(let t=e,r=null;t!==null;t=t.getParent()){if(n.is(t))return r;Mt(t)&&(r=t)}return null}function Tw(n,e,t){return Sw(n,ar(e,t))}function gg(n,e,t){if(!e.theme.tableAlignment)return;const r=[],i=[];for(const s of["center","right"]){const o=e.theme.tableAlignment[s];o&&(s===t?i:r).push(o)}Dr(n,...r),ct(n,...i)}const Ew=new WeakSet;function pg(n=Ol()){return Ew.has(n)}let b_=class v_ extends ht{static getType(){return"table"}getColWidths(){return this.getLatest().__colWidths}setColWidths(e){const t=this.getWritable();return t.__colWidths=e,t}static clone(e){return new v_(e.__key)}afterCloneFrom(e){super.afterCloneFrom(e),this.__colWidths=e.__colWidths,this.__rowStriping=e.__rowStriping,this.__frozenColumnCount=e.__frozenColumnCount,this.__frozenRowCount=e.__frozenRowCount}static importDOM(){return{table:e=>({conversion:Nw,priority:1})}}static importJSON(e){return k_().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setRowStriping(e.rowStriping||!1).setFrozenColumns(e.frozenColumnCount||0).setFrozenRows(e.frozenRowCount||0).setColWidths(e.colWidths)}constructor(e){super(e),this.__rowStriping=!1,this.__frozenColumnCount=0,this.__frozenRowCount=0}exportJSON(){return{...super.exportJSON(),colWidths:this.getColWidths(),frozenColumnCount:this.__frozenColumnCount?this.__frozenColumnCount:void 0,frozenRowCount:this.__frozenRowCount?this.__frozenRowCount:void 0,rowStriping:this.__rowStriping?this.__rowStriping:void 0}}extractWithChild(e,t,r){return r==="html"}getDOMSlot(e){const t=Ms(e)?e:e.querySelector("table");return Ms(t)||qe(229),super.getDOMSlot(e).withElement(t).withAfter(t.querySelector("colgroup"))}createDOM(e,t){const r=document.createElement("table");this.__style&&(r.style.cssText=this.__style);const i=document.createElement("colgroup");if(r.appendChild(i),jx(i),ct(r,e.theme.table),this.updateTableElement(null,r,e),pg(t)){const s=document.createElement("div"),o=e.theme.tableScrollableWrapper;return o?ct(s,o):s.style.cssText="overflow-x: auto;",s.appendChild(r),this.updateTableWrapper(null,s,r,e),s}return r}updateTableWrapper(e,t,r,i){this.__frozenColumnCount!==(e?e.__frozenColumnCount:0)&&function(s,o,a,l){l>0?(ct(s,a.theme.tableFrozenColumn),o.setAttribute("data-lexical-frozen-column","true")):(Dr(s,a.theme.tableFrozenColumn),o.removeAttribute("data-lexical-frozen-column"))}(t,r,i,this.__frozenColumnCount),this.__frozenRowCount!==(e?e.__frozenRowCount:0)&&function(s,o,a,l){l>0?(ct(s,a.theme.tableFrozenRow),o.setAttribute("data-lexical-frozen-row","true")):(Dr(s,a.theme.tableFrozenRow),o.removeAttribute("data-lexical-frozen-row"))}(t,r,i,this.__frozenRowCount)}updateTableElement(e,t,r){this.__style!==(e?e.__style:"")&&(t.style.cssText=this.__style),this.__rowStriping!==(!!e&&e.__rowStriping)&&function(i,s,o){o?(ct(i,s.theme.tableRowStriping),i.setAttribute("data-lexical-row-striping","true")):(Dr(i,s.theme.tableRowStriping),i.removeAttribute("data-lexical-row-striping"))}(t,r,this.__rowStriping),function(i,s,o,a){const l=i.querySelector("colgroup");if(!l)return;const c=[];for(let u=0;u<o;u++){const f=document.createElement("col"),d=a&&a[u];d&&(f.style.width=`${d}px`),c.push(f)}l.replaceChildren(...c)}(t,0,this.getColumnCount(),this.getColWidths()),gg(t,r,this.getFormatType())}updateDOM(e,t,r){const i=this.getDOMSlot(t).element;return t===i===pg()||(Te(s=t)&&s.nodeName==="DIV"&&this.updateTableWrapper(e,t,i,r),this.updateTableElement(e,i,r),!1);var s}exportDOM(e){const t=super.exportDOM(e),{element:r}=t;return{after:i=>{if(t.after&&(i=t.after(i)),!Ms(i)&&Te(i)&&(i=i.querySelector("table")),!Ms(i))return null;gg(i,e._config,this.getFormatType());const[s]=m_(this,null,null),o=new Map;for(const u of s)for(const f of u){const d=f.cell.getKey();o.has(d)||o.set(d,{colSpan:f.cell.getColSpan(),startColumn:f.startColumn})}const a=new Set;for(const u of i.querySelectorAll(":scope > tr > [data-temporary-table-cell-lexical-key]")){const f=u.getAttribute("data-temporary-table-cell-lexical-key");if(f){const d=o.get(f);if(u.removeAttribute("data-temporary-table-cell-lexical-key"),d){o.delete(f);for(let h=0;h<d.colSpan;h++)a.add(h+d.startColumn)}}}const l=i.querySelector(":scope > colgroup");if(l){const u=Array.from(i.querySelectorAll(":scope > colgroup > col")).filter((f,d)=>a.has(d));l.replaceChildren(...u)}const c=i.querySelectorAll(":scope > tr");if(c.length>0){const u=document.createElement("tbody");for(const f of c)u.appendChild(f);i.append(u)}return i},element:!Ms(r)&&Te(r)?r.querySelector("table"):r}}canBeEmpty(){return!1}isShadowRoot(){return!0}getCordsFromCellNode(e,t){const{rows:r,domRows:i}=t;for(let s=0;s<r;s++){const o=i[s];if(o!=null)for(let a=0;a<o.length;a++){const l=o[a];if(l==null)continue;const{elem:c}=l,u=Tw(this,c);if(u!==null&&e.is(u))return{x:a,y:s}}}throw new Error("Cell not found in table.")}getDOMCellFromCords(e,t,r){const{domRows:i}=r,s=i[t];if(s==null)return null;const o=s[e<s.length?e:s.length-1];return o??null}getDOMCellFromCordsOrThrow(e,t,r){const i=this.getDOMCellFromCords(e,t,r);if(!i)throw new Error("Cell not found at cords.");return i}getCellNodeFromCords(e,t,r){const i=this.getDOMCellFromCords(e,t,r);if(i==null)return null;const s=ar(i.elem);return Mt(s)?s:null}getCellNodeFromCordsOrThrow(e,t,r){const i=this.getCellNodeFromCords(e,t,r);if(!i)throw new Error("Node at cords not TableCellNode.");return i}getRowStriping(){return!!this.getLatest().__rowStriping}setRowStriping(e){const t=this.getWritable();return t.__rowStriping=e,t}setFrozenColumns(e){const t=this.getWritable();return t.__frozenColumnCount=e,t}getFrozenColumns(){return this.getLatest().__frozenColumnCount}setFrozenRows(e){const t=this.getWritable();return t.__frozenRowCount=e,t}getFrozenRows(){return this.getLatest().__frozenRowCount}canSelectBefore(){return!0}canIndent(){return!1}getColumnCount(){const e=this.getFirstChild();if(!e)return 0;let t=0;return e.getChildren().forEach(r=>{Mt(r)&&(t+=r.getColSpan())}),t}};function Nw(n){const e=k_();n.hasAttribute("data-lexical-row-striping")&&e.setRowStriping(!0),n.hasAttribute("data-lexical-frozen-column")&&e.setFrozenColumns(1),n.hasAttribute("data-lexical-frozen-row")&&e.setFrozenRows(1);const t=n.querySelector(":scope > colgroup");if(t){let r=[];for(const i of t.querySelectorAll(":scope > col")){let s=i.style.width||"";if(!Zd.test(s)&&(s=i.getAttribute("width")||"",!/^\d+$/.test(s))){r=void 0;break}r.push(parseFloat(s))}r&&e.setColWidths(r)}return{after:r=>Gy(r,xo),node:e}}function k_(){return Ae(new b_)}function x_(n){return n instanceof b_}const C_=Object.freeze({"	":"\\t","\n":"\\n"}),mg=new RegExp(Object.keys(C_).join("|"),"g"),fn=Object.freeze({ancestorHasNextSibling:"|",ancestorIsLastChild:" ",hasNextSibling:"├",isLastChild:"└",selectedChar:"^",selectedLine:">"}),Mw=[n=>n.hasFormat("bold")&&"Bold",n=>n.hasFormat("code")&&"Code",n=>n.hasFormat("italic")&&"Italic",n=>n.hasFormat("strikethrough")&&"Strikethrough",n=>n.hasFormat("subscript")&&"Subscript",n=>n.hasFormat("superscript")&&"Superscript",n=>n.hasFormat("underline")&&"Underline",n=>n.hasFormat("highlight")&&"Highlight"],Aw=[n=>n.hasTextFormat("bold")&&"Bold",n=>n.hasTextFormat("code")&&"Code",n=>n.hasTextFormat("italic")&&"Italic",n=>n.hasTextFormat("strikethrough")&&"Strikethrough",n=>n.hasTextFormat("subscript")&&"Subscript",n=>n.hasTextFormat("superscript")&&"Superscript",n=>n.hasTextFormat("underline")&&"Underline",n=>n.hasTextFormat("highlight")&&"Highlight"],Ow=[n=>n.isDirectionless()&&"Directionless",n=>n.isUnmergeable()&&"Unmergeable"],$w=[n=>n.isToken()&&"Token",n=>n.isSegmented()&&"Segmented"];function Iw(n,e,t,r,i=!1){const s=n.getEditorState(),o=n._config,a=n._compositionKey,l=n._editable;if(t){let d="";return s.read(()=>{d=function(h){const p=document.createElement("div");return p.innerHTML=h.trim(),S_(p,0).innerHTML}(t_(n))}),d}let c=` root
`;const u=s.read(()=>{const d=K();return w_(me(),(h,p)=>{const m=`(${h.getKey()})`,y=h.getType()||"",b=h.isSelected();c+=`${b?fn.selectedLine:" "} ${p.join(" ")} ${m} ${y} ${function(_,x,T=!1){const P=x?x(_,T):void 0;if(P!==void 0&&P.length>0)return P;if(W(_)){const M=_.getTextContent(),L=M.length===0?"(empty)":`"${yg(M,T)}"`,A=function(I){return[_g(I),Pw(I),Rw(I),bg(I)].filter(Boolean).join(", ")}(_);return[L,A.length!==0?`{ ${A} }`:null].filter(Boolean).join(" ").trim()}if(cw(_)){const M=_.getURL(),L=M.length===0?"(empty)":`"${yg(M,T)}"`,A=function(I){return[Lw(I),Dw(I),jw(I),bg(I)].filter(Boolean).join(", ")}(_);return[L,A.length!==0?`{ ${A} }`:null].filter(Boolean).join(" ").trim()}if(dw(_))return`ids: [ ${_.getIDs().join(", ")} ]`;if(jd(_)){const M=function(A){let I=Aw.map(B=>B(A)).filter(Boolean).join(", ").toLocaleLowerCase();return I!==""&&(I="format: "+I),I}(_);let L=M!==""?`{ ${M} }`:"";return L+=_.__style?`(${_.__style})`:"",L}return""}(h,r,i)}
`,c+=function({indent:_,isSelected:x,node:T,nodeKeyDisplay:P,selection:M,typeDisplay:L}){if(!W(T)||!q(M)||!x||F(T))return"";const A=M.anchor,I=M.focus;if(T.getTextContent()===""||A.getNode()===M.focus.getNode()&&A.offset===I.offset)return"";const[B,k]=function(H,V){const G=V.getStartEndPoints();if(pt(V)||G===null)return[-1,-1];const[ee,Q]=G,re=H.getTextContent(),oe=re.length;let X=-1,fe=-1;if(ee.type==="text"&&Q.type==="text"){const ue=ee.getNode(),he=Q.getNode();ue===he&&H===ue&&ee.offset!==Q.offset?[X,fe]=ee.offset<Q.offset?[ee.offset,Q.offset]:[Q.offset,ee.offset]:[X,fe]=H===ue?ue.isBefore(he)?[ee.offset,oe]:[0,ee.offset]:H===he?he.isBefore(ue)?[Q.offset,oe]:[0,Q.offset]:[0,oe]}const be=(re.slice(0,X).match(mg)||[]).length,se=(re.slice(X,fe).match(mg)||[]).length;return[X+be,fe+be+se]}(T,M);if(B===k)return"";const N=_[_.length-1]===fn.hasNextSibling?fn.ancestorHasNextSibling:fn.ancestorIsLastChild,w=[..._.slice(0,_.length-1),N],R=Array(B+1).fill(" "),j=Array(k-B).fill(fn.selectedChar),D=L.length+2,z=Array(P.length+D).fill(" ");return[fn.selectedLine,w.join(" "),[...z,...R,...j].join("")].join(" ")+`
`}({indent:p,isSelected:b,node:h,nodeKeyDisplay:m,selection:d,typeDisplay:y})}),d===null?": null":q(d)?function(h){let p="";const m=_g(h);p+=`: range ${m!==""?`{ ${m} }`:""} ${h.style!==""?`{ style: ${h.style} } `:""}`;const y=h.anchor,b=h.focus,_=y.offset,x=b.offset;return p+=`
  ├ anchor { key: ${y.key}, offset: ${_===null?"null":_}, type: ${y.type} }`,p+=`
  └ focus { key: ${b.key}, offset: ${x===null?"null":x}, type: ${b.type} }`,p}(d):__(d)?function(h){return`: table
  └ { table: ${h.tableKey}, anchorCell: ${h.anchor.key}, focusCell: ${h.focus.key} }`}(d):function(h){return pt(h)?`: node
  └ [${Array.from(h._nodes).join(", ")}]`:""}(d)});if(c+=`
 selection`+u,c+=`

 commands:`,e.length)for(const{index:d,type:h,payload:p}of e)c+=`
  └ ${d}. { type: ${h}, payload: ${p instanceof Event?p.constructor.name:p} }`;else c+=`
  └ None dispatched.`;const{version:f}=n.constructor;return c+=`

 editor${f?` (v${f})`:""}:`,c+=`
  └ namespace ${o.namespace}`,a!==null&&(c+=`
  └ compositionKey ${a}`),c+=`
  └ editable ${String(l)}`,c}function w_(n,e,t=[]){const r=n.getChildren(),i=r.length;r.forEach((s,o)=>{e(s,t.concat(o===i-1?fn.isLastChild:fn.hasNextSibling)),F(s)&&w_(s,e,t.concat(o===i-1?fn.ancestorIsLastChild:fn.ancestorHasNextSibling))})}function yg(n,e=!1){const t=Object.entries(C_).reduce((r,[i,s])=>r.replace(new RegExp(i,"g"),String(s)),n);return e?t.replace(/[^\s]/g,"*"):t}function Pw(n){let e=Ow.map(t=>t(n)).filter(Boolean).join(", ").toLocaleLowerCase();return e!==""&&(e="detail: "+e),e}function Rw(n){let e=$w.map(t=>t(n)).filter(Boolean).join(", ").toLocaleLowerCase();return e!==""&&(e="mode: "+e),e}function _g(n){let e=Mw.map(t=>t(n)).filter(Boolean).join(", ").toLocaleLowerCase();return e!==""&&(e="format: "+e),e}function Lw(n){let e=n.getTarget();return e!=null&&(e="target: "+e),e}function Dw(n){let e=n.getRel();return e!=null&&(e="rel: "+e),e}function jw(n){let e=n.getTitle();return e!=null&&(e="title: "+e),e}function bg(n){if(!n.__state)return!1;const e=[];for(const[r,i]of n.__state.knownState.entries()){if(r.isEqual(i,r.defaultValue))continue;const s=JSON.stringify(r.unparse(i));e.push(`[${r.key}: ${s}]`)}let t=e.join(",");return t!==""&&(t="state: "+t),t}function S_(n,e){const t=new Array(1+e++).join("  "),r=new Array(e-1).join("  ");let i;for(let s=0;s<n.children.length;s++)i=document.createTextNode(`
`+t),n.insertBefore(i,n.children[s]),S_(n.children[s],e),n.lastElementChild===n.children[s]&&(i=document.createTextNode(`
`+r),n.appendChild(i));return n}const Fw=C.forwardRef(function({treeTypeButtonClassName:n,timeTravelButtonClassName:e,timeTravelPanelSliderClassName:t,timeTravelPanelButtonClassName:r,viewClassName:i,timeTravelPanelClassName:s,editorState:o,setEditorState:a,setEditorReadOnly:l,generateContent:c,commandsLog:u=[]},f){const[d,h]=C.useState([]),[p,m]=C.useState(""),[y,b]=C.useState(!1),[_,x]=C.useState(!1),T=C.useRef(0),P=C.useRef(null),[M,L]=C.useState(!1),[A,I]=C.useState(!1),[B,k]=C.useState(!1),N=C.useRef(),w=C.useRef([]),R=C.useRef(0),j=C.useCallback(z=>{const H=++R.current;c(z).then(V=>{H===R.current&&m(V)}).catch(V=>{H===R.current&&m(`Error rendering tree: ${V.message}

Stack:
${V.stack}`)})},[c]);C.useEffect(()=>{if(!(!B&&o._nodeMap.size>1e3&&(I(!0),!B))&&(N.current!==o||w.current!==u)){const z=N.current!==o;N.current=o,w.current=u,j(_),!y&&z&&h(H=>[...H,[Date.now(),o]])}},[o,j,_,B,y,u]);const D=d.length;return C.useEffect(()=>{if(M){let z;const H=()=>{const V=T.current;if(V===D-1)return void L(!1);const G=d[V][0],ee=d[V+1][0];z=setTimeout(()=>{T.current++;const Q=T.current,re=P.current;re!==null&&(re.value=String(Q)),a(d[Q][1]),H()},ee-G)};return H(),()=>{clearTimeout(z)}}},[d,M,D,a]),S.jsxs("div",{className:i,children:[!B&&A?S.jsxs("div",{style:{padding:20},children:[S.jsx("span",{style:{marginRight:20},children:"Detected large EditorState, this can impact debugging performance."}),S.jsx("button",{onClick:()=>{k(!0)},style:{background:"transparent",border:"1px solid white",color:"white",cursor:"pointer",padding:5},children:"Show full tree"})]}):null,B?null:S.jsx("button",{onClick:()=>(j(!_),void x(!_)),className:n,type:"button",children:_?"Tree":"Export DOM"}),!y&&(B||!A)&&D>2&&S.jsx("button",{onClick:()=>{l(!0),T.current=D-1,b(!0)},className:e,type:"button",children:"Time Travel"}),(B||!A)&&S.jsx("pre",{ref:f,children:p}),y&&(B||!A)&&S.jsxs("div",{className:s,children:[S.jsx("button",{className:r,onClick:()=>{T.current===D-1&&(T.current=1),L(!M)},type:"button",children:M?"Pause":"Play"}),S.jsx("input",{className:t,ref:P,onChange:z=>{const H=Number(z.target.value),V=d[H];V&&(T.current=H,a(V[1]))},type:"range",min:"1",max:D-1}),S.jsx("button",{className:r,onClick:()=>{l(!1);const z=d.length-1,H=d[z];a(H[1]);const V=P.current;V!==null&&(V.value=String(z)),b(!1),L(!1)},type:"button",children:"Exit"})]})]})});function qw(n,e){const t=new Set;let r=0;for(const[i]of n._commands)t.add(n.registerCommand(i,s=>(e(o=>{r+=1;const a=[...o];return a.push({index:r,payload:s,type:i.type?i.type:"UNKNOWN"}),a.length>10&&a.shift(),a}),!1),Ni));return()=>t.forEach(i=>i())}function Bw(n){const[e,t]=C.useState([]);return C.useEffect(()=>qw(n,t),[n]),C.useMemo(()=>e,[e])}function Uw({treeTypeButtonClassName:n,timeTravelButtonClassName:e,timeTravelPanelSliderClassName:t,timeTravelPanelButtonClassName:r,timeTravelPanelClassName:i,viewClassName:s,editor:o,customPrintNode:a}){const l=C.createRef(),[c,u]=C.useState(o.getEditorState()),f=Bw(o);return C.useEffect(()=>He(o.registerUpdateListener(({editorState:d})=>{u(d)}),o.registerEditableListener(()=>{u(o.getEditorState())})),[o]),C.useEffect(()=>{const d=l.current;if(d!==null)return d.__lexicalEditor=o,()=>{d.__lexicalEditor=null}},[o,l]),S.jsx(Fw,{treeTypeButtonClassName:n,timeTravelButtonClassName:e,timeTravelPanelSliderClassName:t,timeTravelPanelButtonClassName:r,viewClassName:s,timeTravelPanelClassName:i,setEditorReadOnly:d=>{const h=o.getRootElement();h!=null&&(h.contentEditable=d?"false":"true")},editorState:c,setEditorState:d=>o.setEditorState(d),generateContent:async function(d){return Iw(o,f,d,a)},ref:l,commandsLog:f})}const T_=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,zw=T_?C.useLayoutEffect:C.useEffect,aa={tag:Pr};function E_({initialConfig:n,children:e}){const t=C.useMemo(()=>{const{theme:r,namespace:i,nodes:s,onError:o,editorState:a,html:l}=n,c=iw(null,r),u=wx({editable:n.editable,html:l,namespace:i,nodes:s,onError:f=>o(f,u),theme:r});return function(f,d){if(d!==null){if(d===void 0)f.update(()=>{const h=me();if(h.isEmpty()){const p=Ot();h.append(p);const m=T_?document.activeElement:null;(K()!==null||m!==null&&m===f.getRootElement())&&p.select()}},aa);else if(d!==null)switch(typeof d){case"string":{const h=f.parseEditorState(d);f.setEditorState(h,aa);break}case"object":f.setEditorState(d,aa);break;case"function":f.update(()=>{me().isEmpty()&&d(f)},aa)}}}(u,a),[u,c]},[]);return zw(()=>{const r=n.editable,[i]=t;i.setEditable(r===void 0||r)},[]),S.jsx(e_.Provider,{value:t,children:e})}function N_(){return me().getTextContent()}function M_(n,e=!0){if(n)return!1;let t=N_();return e&&(t=t.trim()),t===""}function Ww(n){if(!M_(n,!1))return!1;const e=me().getChildren(),t=e.length;if(t>1)return!1;for(let r=0;r<t;r++){const i=e[r];if(ve(i))return!1;if(F(i)){if(!jd(i)||i.__indent!==0)return!1;const s=i.getChildren(),o=s.length;for(let a=0;a<o;a++){const l=s[r];if(!W(l))return!1}}}return!0}function tf(n){return()=>Ww(n)}const A_=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0?C.useLayoutEffect:C.useEffect;function Kw({editor:n,ariaActiveDescendant:e,ariaAutoComplete:t,ariaControls:r,ariaDescribedBy:i,ariaErrorMessage:s,ariaExpanded:o,ariaInvalid:a,ariaLabel:l,ariaLabelledBy:c,ariaMultiline:u,ariaOwns:f,ariaRequired:d,autoCapitalize:h,className:p,id:m,role:y="textbox",spellCheck:b=!0,style:_,tabIndex:x,"data-testid":T,...P},M){const[L,A]=C.useState(n.isEditable()),I=C.useCallback(k=>{k&&k.ownerDocument&&k.ownerDocument.defaultView?n.setRootElement(k):n.setRootElement(null)},[n]),B=C.useMemo(()=>function(...k){return N=>{k.forEach(w=>{typeof w=="function"?w(N):w!=null&&(w.current=N)})}}(M,I),[I,M]);return A_(()=>(A(n.isEditable()),n.registerEditableListener(k=>{A(k)})),[n]),S.jsx("div",{"aria-activedescendant":L?e:void 0,"aria-autocomplete":L?t:"none","aria-controls":L?r:void 0,"aria-describedby":i,...s!=null?{"aria-errormessage":s}:{},"aria-expanded":L&&y==="combobox"?!!o:void 0,...a!=null?{"aria-invalid":a}:{},"aria-label":l,"aria-labelledby":c,"aria-multiline":u,"aria-owns":L?f:void 0,"aria-readonly":!L||void 0,"aria-required":d,autoCapitalize:h,className:p,contentEditable:L,"data-testid":T,id:m,ref:B,role:y,spellCheck:b,style:_,tabIndex:x,...P})}const Hw=C.forwardRef(Kw);function vg(n){return n.getEditorState().read(tf(n.isComposing()))}const O_=C.forwardRef(Jw);function Jw(n,e){const{placeholder:t,...r}=n,[i]=ge();return S.jsxs(S.Fragment,{children:[S.jsx(Hw,{editor:i,...r,ref:e}),t!=null&&S.jsx(Vw,{editor:i,content:t})]})}function Vw({content:n,editor:e}){const t=function(o){const[a,l]=C.useState(()=>vg(o));return A_(()=>{function c(){const u=vg(o);l(u)}return c(),He(o.registerUpdateListener(()=>{c()}),o.registerEditableListener(()=>{c()}))},[o]),a}(e),[r,i]=C.useState(e.isEditable());if(C.useLayoutEffect(()=>(i(e.isEditable()),e.registerEditableListener(o=>{i(o)})),[e]),!t)return null;let s=null;return typeof n=="function"?s=n(r):n!==null&&(s=n),s===null?null:S.jsx("div",{"aria-hidden":!0,children:s})}function $_({editorRef:n}){const[e]=ge();return C.useEffect(()=>{typeof n=="function"?n(e):typeof n=="object"&&(n.current=e)},[e]),null}function ju(n,e){return ju=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},ju(n,e)}var kg={error:null},Gw=function(n){var e,t;function r(){for(var s,o=arguments.length,a=new Array(o),l=0;l<o;l++)a[l]=arguments[l];return(s=n.call.apply(n,[this].concat(a))||this).state=kg,s.resetErrorBoundary=function(){for(var c,u=arguments.length,f=new Array(u),d=0;d<u;d++)f[d]=arguments[d];s.props.onReset==null||(c=s.props).onReset.apply(c,f),s.reset()},s}t=n,(e=r).prototype=Object.create(t.prototype),e.prototype.constructor=e,ju(e,t),r.getDerivedStateFromError=function(s){return{error:s}};var i=r.prototype;return i.reset=function(){this.setState(kg)},i.componentDidCatch=function(s,o){var a,l;(a=(l=this.props).onError)==null||a.call(l,s,o)},i.componentDidUpdate=function(s,o){var a,l,c,u,f=this.state.error,d=this.props.resetKeys;f!==null&&o.error!==null&&((c=s.resetKeys)===void 0&&(c=[]),(u=d)===void 0&&(u=[]),c.length!==u.length||c.some(function(h,p){return!Object.is(h,u[p])}))&&((a=(l=this.props).onResetKeysChange)==null||a.call(l,s.resetKeys,d),this.reset())},i.render=function(){var s=this.state.error,o=this.props,a=o.fallbackRender,l=o.FallbackComponent,c=o.fallback;if(s!==null){var u={error:s,resetErrorBoundary:this.resetErrorBoundary};if(C.isValidElement(c))return c;if(typeof a=="function")return a(u);if(l)return C.createElement(l,u);throw new Error("react-error-boundary requires either a fallback, fallbackRender, or FallbackComponent prop")}return this.props.children},r}(C.Component);function I_({children:n,onError:e}){return S.jsx(Gw,{fallback:S.jsx("div",{style:{border:"1px solid #f00",color:"#f00",padding:"8px"},children:"An error was thrown."}),onError:e,children:n})}const la=0,Fu=1,qu=2,Wt=0,Yw=1,xg=2,Xw=3,Qw=4;function Zw(n,e,t,r,i){if(n===null||t.size===0&&r.size===0&&!i)return Wt;const s=e._selection,o=n._selection;if(i)return Yw;if(!(q(s)&&q(o)&&o.isCollapsed()&&s.isCollapsed()))return Wt;const a=function(b,_,x){const T=b._nodeMap,P=[];for(const M of _){const L=T.get(M);L!==void 0&&P.push(L)}for(const[M,L]of x){if(!L)continue;const A=T.get(M);A===void 0||et(A)||P.push(A)}return P}(e,t,r);if(a.length===0)return Wt;if(a.length>1){const b=e._nodeMap,_=b.get(s.anchor.key),x=b.get(o.anchor.key);return _&&x&&!n._nodeMap.has(_.__key)&&W(_)&&_.__text.length===1&&s.anchor.offset===1?xg:Wt}const l=a[0],c=n._nodeMap.get(l.__key);if(!W(c)||!W(l)||c.__mode!==l.__mode)return Wt;const u=c.__text,f=l.__text;if(u===f)return Wt;const d=s.anchor,h=o.anchor;if(d.key!==h.key||d.type!=="text")return Wt;const p=d.offset,m=h.offset,y=f.length-u.length;return y===1&&m===p-1?xg:y===-1&&m===p+1?Xw:y===-1&&m===p?Qw:Wt}function e0(n,e){let t=Date.now(),r=Wt;return(i,s,o,a,l,c)=>{const u=Date.now();if(c.has(Su))return r=Wt,t=u,qu;const f=Zw(i,s,a,l,n.isComposing()),d=(()=>{const h=o===null||o.editor===n,p=c.has(bx);if(!p&&h&&c.has(Pr))return la;if(i===null)return Fu;const m=s._selection;return a.size>0||l.size>0?p===!1&&f!==Wt&&f===r&&u<t+e&&h||a.size===1&&function(y,b,_){const x=b._nodeMap.get(y),T=_._nodeMap.get(y),P=b._selection,M=_._selection;return!(q(P)&&q(M)&&P.anchor.type==="element"&&P.focus.type==="element"&&M.anchor.type==="text"&&M.focus.type==="text"||!W(x)||!W(T)||x.__parent!==T.__parent)&&JSON.stringify(b.read(()=>x.exportJSON()))===JSON.stringify(_.read(()=>T.exportJSON()))}(Array.from(a)[0],i,s)?la:Fu:m!==null?la:qu})();return t=u,r=f,d}}function Cg(n){n.undoStack=[],n.redoStack=[],n.current=null}function t0(n,e,t){const r=e0(n,t);return He(n.registerCommand(uo,()=>(function(s,o){const a=o.redoStack,l=o.undoStack;if(l.length!==0){const c=o.current,u=l.pop();c!==null&&(a.push(c),s.dispatchCommand(Is,!0)),l.length===0&&s.dispatchCommand(Ps,!1),o.current=u||null,u&&u.editor.setEditorState(u.editorState,{tag:Su})}}(n,e),!0),ne),n.registerCommand(fo,()=>(function(s,o){const a=o.redoStack,l=o.undoStack;if(a.length!==0){const c=o.current;c!==null&&(l.push(c),s.dispatchCommand(Ps,!0));const u=a.pop();a.length===0&&s.dispatchCommand(Is,!1),o.current=u||null,u&&u.editor.setEditorState(u.editorState,{tag:Su})}}(n,e),!0),ne),n.registerCommand(Od,()=>(Cg(e),!1),ne),n.registerCommand(Vm,()=>(Cg(e),n.dispatchCommand(Is,!1),n.dispatchCommand(Ps,!1),!0),ne),n.registerUpdateListener(({editorState:s,prevEditorState:o,dirtyLeaves:a,dirtyElements:l,tags:c})=>{const u=e.current,f=e.redoStack,d=e.undoStack,h=u===null?null:u.editorState;if(u!==null&&s===h)return;const p=r(o,s,u,a,l,c);if(p===Fu)f.length!==0&&(e.redoStack=[],n.dispatchCommand(Is,!1)),u!==null&&(d.push({...u}),n.dispatchCommand(Ps,!0));else if(p===qu)return;e.current={editor:n,editorState:s}}))}function n0(){return{current:null,redoStack:[],undoStack:[]}}function P_({delay:n,externalHistoryState:e}){const[t]=ge();return function(r,i,s=1e3){const o=C.useMemo(()=>i||n0(),[i]);C.useEffect(()=>t0(r,o,s),[s,r,o])}(t,e,n),null}const r0=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0?C.useLayoutEffect:C.useEffect;function i0(n){return{initialValueFn:()=>n.isEditable(),subscribe:e=>n.registerEditableListener(e)}}function R_(){return function(n){const[e]=ge(),t=C.useMemo(()=>n(e),[e,n]),[r,i]=C.useState(()=>t.initialValueFn()),s=C.useRef(r);return r0(()=>{const{initialValueFn:o,subscribe:a}=t,l=o();return s.current!==l&&(s.current=l,i(l)),a(c=>{s.current=c,i(c)})},[t,n]),r}(i0)}function L_(n){const e=window.location.origin,t=r=>{if(r.origin!==e)return;const i=n.getRootElement();if(document.activeElement!==i)return;const s=r.data;if(typeof s=="string"){let o;try{o=JSON.parse(s)}catch{return}if(o&&o.protocol==="nuanria_messaging"&&o.type==="request"){const a=o.payload;if(a&&a.functionId==="makeChanges"){const l=a.args;if(l){const[c,u,f,d,h,p]=l;n.update(()=>{const m=K();if(q(m)){const y=m.anchor;let b=y.getNode(),_=0,x=0;if(W(b)&&c>=0&&u>=0&&(_=c,x=c+u,m.setTextNodeRange(b,_,b,x)),_===x&&f===""||(m.insertRawText(f),b=y.getNode()),W(b)){_=d,x=d+h;const T=b.getTextContentSize();_=_>T?T:_,x=x>T?T:x,m.setTextNodeRange(b,_,b,x)}r.stopImmediatePropagation()}})}}}}};return window.addEventListener("message",t,!0),()=>{window.removeEventListener("message",t,!0)}}function wg(n,e){if(document.caretRangeFromPoint!==void 0){const t=document.caretRangeFromPoint(n,e);return t===null?null:{node:t.startContainer,offset:t.startOffset}}if(document.caretPositionFromPoint!=="undefined"){const t=document.caretPositionFromPoint(n,e);return t===null?null:{node:t.offsetNode,offset:t.offset}}return null}const rs=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,s0=rs&&"documentMode"in document?document.documentMode:null,o0=!(!rs||!("InputEvent"in window)||s0)&&"getTargetRanges"in new window.InputEvent("input"),a0=rs&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent),Sg=rs&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,l0=rs&&/^(?=.*Chrome).*/i.test(navigator.userAgent),c0=rs&&/AppleWebKit\/[\d.]+/.test(navigator.userAgent)&&!l0,Tg=ie("DRAG_DROP_PASTE_FILE");function ca(n){let e=null;if(Rn(n,DragEvent)?e=n.dataTransfer:Rn(n,ClipboardEvent)&&(e=n.clipboardData),e===null)return[!1,[],!1];const t=e.types,r=t.includes("Files"),i=t.includes("text/html")||t.includes("text/plain");return[r,Array.from(e.files),i]}function Eg(n){const e=K();if(!q(e))return!1;const t=new Set,r=e.getNodes();for(let i=0;i<r.length;i++){const s=r[i],o=s.getKey();if(t.has(o))continue;const a=Qt(s,c=>F(c)&&!c.isInline());if(a===null)continue;const l=a.getKey();a.canIndent()&&!t.has(l)&&(t.add(l),n(a))}return t.size>0}function Ng(n){const e=ar(n);return ve(e)}function Vc(n){for(const e of["lowercase","uppercase","capitalize"])n.hasFormat(e)&&n.toggleFormat(e)}function u0(n){return He(n.registerCommand(Km,e=>{const t=K();return!!pt(t)&&(t.clear(),!0)},ne),n.registerCommand(pn,e=>{const t=K();return q(t)?(t.deleteCharacter(e),!0):!!pt(t)&&(t.deleteNodes(),!0)},ne),n.registerCommand(Li,e=>{const t=K();return!!q(t)&&(t.deleteWord(e),!0)},ne),n.registerCommand(Di,e=>{const t=K();return!!q(t)&&(t.deleteLine(e),!0)},ne),n.registerCommand($r,e=>{const t=K();if(typeof e=="string")t!==null&&t.insertText(e);else{if(t===null)return!1;const r=e.dataTransfer;if(r!=null)ag(r,t,n);else if(q(t)){const i=e.data;return i&&t.insertText(i),!0}}return!0},ne),n.registerCommand(Va,()=>{const e=K();return!!q(e)&&(e.removeText(),!0)},ne),n.registerCommand(Qn,e=>{const t=K();return!!q(t)&&(t.formatText(e),!0)},ne),n.registerCommand(ex,e=>{const t=K();if(!q(t)&&!pt(t))return!1;const r=t.getNodes();for(const i of r){const s=Qt(i,o=>F(o)&&!o.isInline());s!==null&&s.setFormat(e)}return!0},ne),n.registerCommand(nr,e=>{const t=K();return!!q(t)&&(t.insertLineBreak(e),!0)},ne),n.registerCommand(Xs,()=>{const e=K();return!!q(e)&&(e.insertParagraph(),!0)},ne),n.registerCommand(Qk,()=>(px([po()]),!0),ne),n.registerCommand(Zk,()=>Eg(e=>{const t=e.getIndent();e.setIndent(t+1)}),ne),n.registerCommand(nh,()=>Eg(e=>{const t=e.getIndent();t>0&&e.setIndent(Math.max(0,t-1))}),ne),n.registerCommand(Sd,e=>{const t=K();if(pt(t)){const r=t.getNodes();if(r.length>0)return r[0].selectPrevious(),!0}else if(q(t)){const r=Eu(t.focus,!0);if(!e.shiftKey&&ve(r)&&!r.isIsolated()&&!r.isInline())return r.selectPrevious(),e.preventDefault(),!0}return!1},ne),n.registerCommand(Td,e=>{const t=K();if(pt(t)){const r=t.getNodes();if(r.length>0)return r[0].selectNext(0,0),!0}else if(q(t)){if(function(i){const s=i.focus;return s.key==="root"&&s.offset===me().getChildrenSize()}(t))return e.preventDefault(),!0;const r=Eu(t.focus,!1);if(!e.shiftKey&&ve(r)&&!r.isIsolated()&&!r.isInline())return r.selectNext(),e.preventDefault(),!0}return!1},ne),n.registerCommand(wd,e=>{const t=K();if(pt(t)){const r=t.getNodes();if(r.length>0)return e.preventDefault(),r[0].selectPrevious(),!0}if(!q(t))return!1;if(il(t,!0)){const r=e.shiftKey;return e.preventDefault(),sl(t,r,!0),!0}return!1},ne),n.registerCommand(Cd,e=>{const t=K();if(pt(t)){const i=t.getNodes();if(i.length>0)return e.preventDefault(),i[0].selectNext(0,0),!0}if(!q(t))return!1;const r=e.shiftKey;return!!il(t,!1)&&(e.preventDefault(),sl(t,r,!1),!0)},ne),n.registerCommand(Ed,e=>{if(Ng(e.target))return!1;const t=K();if(q(t)){if(function(r){if(!r.isCollapsed())return!1;const{anchor:i}=r;if(i.offset!==0)return!1;const s=i.getNode();if(et(s))return!1;const o=pC(s);return o.getIndent()>0&&(o.is(s)||s.is(o.getFirstDescendant()))}(t))return e.preventDefault(),n.dispatchCommand(nh,void 0);if(Sg&&navigator.language==="ko-KR")return!1}else if(!pt(t))return!1;return e.preventDefault(),n.dispatchCommand(pn,!0)},ne),n.registerCommand(Nd,e=>{if(Ng(e.target))return!1;const t=K();return!(!q(t)&&!pt(t))&&(e.preventDefault(),n.dispatchCommand(pn,!1))},ne),n.registerCommand(ji,e=>{const t=K();if(!q(t))return!1;if(Vc(t),e!==null){if((Sg||a0||c0)&&o0)return!1;if(e.preventDefault(),e.shiftKey)return n.dispatchCommand(nr,!1)}return n.dispatchCommand(Xs,void 0)},ne),n.registerCommand(xl,()=>{const e=K();return!!q(e)&&(n.blur(),!0)},ne),n.registerCommand(Cl,e=>{const[,t]=ca(e);if(t.length>0){const i=wg(e.clientX,e.clientY);if(i!==null){const{offset:s,node:o}=i,a=ar(o);if(a!==null){const l=yo();if(W(a))l.anchor.set(a.getKey(),s,"text"),l.focus.set(a.getKey(),s,"text");else{const u=a.getParentOrThrow().getKey(),f=a.getIndexWithinParent()+1;l.anchor.set(u,f,"element"),l.focus.set(u,f,"element")}const c=Js(l);it(c)}n.dispatchCommand(Tg,t)}return e.preventDefault(),!0}const r=K();return!!q(r)},ne),n.registerCommand(Ad,e=>{const[t]=ca(e),r=K();return!(t&&!q(r))},ne),n.registerCommand(Jm,e=>{const[t]=ca(e),r=K();if(t&&!q(r))return!1;const i=wg(e.clientX,e.clientY);if(i!==null){const s=ar(i.node);ve(s)&&e.preventDefault()}return!0},ne),n.registerCommand(Ga,()=>(Iy(),!0),ne),n.registerCommand(hr,e=>(cg(n,Rn(e,ClipboardEvent)?e:null),!0),ne),n.registerCommand(ni,e=>(async function(t,r){await cg(r,Rn(t,ClipboardEvent)?t:null),r.update(()=>{const i=K();q(i)?i.removeText():pt(i)&&i.getNodes().forEach(s=>s.remove())})}(e,n),!0),ne),n.registerCommand(ti,e=>{const[,t,r]=ca(e);return t.length>0&&!r?(n.dispatchCommand(Tg,t),!0):ii(e.target)&&Bd(e.target)?!1:K()!==null&&(function(i,s){i.preventDefault(),s.update(()=>{const o=K(),a=Rn(i,InputEvent)||Rn(i,KeyboardEvent)?null:i.clipboardData;a!=null&&o!==null&&ag(a,o,s)},{tag:Cy})}(e,n),!0)},ne),n.registerCommand(Hm,e=>{const t=K();return q(t)&&Vc(t),!1},ne),n.registerCommand(Md,e=>{const t=K();return q(t)&&Vc(t),!1},ne))}const Bu=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0?C.useLayoutEffect:C.useEffect;function Mg(n){return n.getEditorState().read(tf(n.isComposing()))}function d0({contentEditable:n,placeholder:e=null,ErrorBoundary:t}){const[r]=ge(),i=function(s,o){const[a,l]=C.useState(()=>s.getDecorators());return Bu(()=>s.registerDecoratorListener(c=>{Nt.flushSync(()=>{l(c)})}),[s]),C.useEffect(()=>{l(s.getDecorators())},[s]),C.useMemo(()=>{const c=[],u=Object.keys(a);for(let f=0;f<u.length;f++){const d=u[f],h=S.jsx(o,{onError:m=>s._onError(m),children:S.jsx(C.Suspense,{fallback:null,children:a[d]})}),p=s.getElementByKey(d);p!==null&&c.push(Nt.createPortal(h,p,d))}return c},[o,a,s])}(r,t);return function(s){Bu(()=>He(u0(s),L_(s)),[s])}(r),S.jsxs(S.Fragment,{children:[n,S.jsx(f0,{content:e}),i]})}function f0({content:n}){const[e]=ge(),t=function(i){const[s,o]=C.useState(()=>Mg(i));return Bu(()=>{function a(){const l=Mg(i);o(l)}return a(),He(i.registerUpdateListener(()=>{a()}),i.registerEditableListener(()=>{a()}))},[i]),s}(e),r=R_();return t?typeof n=="function"?n(r):n:null}const Uu=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,h0=Uu?C.useLayoutEffect:C.useEffect;let g0=class{constructor(e){this.key=e,this.ref={current:null},this.setRefElement=this.setRefElement.bind(this)}setRefElement(e){this.ref={current:e}}};const Ag=n=>{const e=document.getElementById("typeahead-menu");if(!e)return;const t=e.getBoundingClientRect();t.top+t.height>window.innerHeight&&e.scrollIntoView({block:"center"}),t.top<0&&e.scrollIntoView({block:"center"}),n.scrollIntoView({block:"nearest"})};function Og(n,e){const t=n.getBoundingClientRect(),r=e.getBoundingClientRect();return t.top>r.top&&t.top<r.bottom}function p0(n,e,t,r){const[i]=ge();C.useEffect(()=>{if(e!=null&&n!=null){const s=i.getRootElement(),o=s!=null?function(f,d){let h=getComputedStyle(f);const p=h.position==="absolute",m=/(auto|scroll)/;if(h.position==="fixed")return document.body;for(let y=f;y=y.parentElement;)if(h=getComputedStyle(y),(!p||h.position!=="static")&&m.test(h.overflow+h.overflowY+h.overflowX))return y;return document.body}(s):document.body;let a=!1,l=Og(e,o);const c=function(){a||(window.requestAnimationFrame(function(){t(),a=!1}),a=!0);const f=Og(e,o);f!==l&&(l=f,r!=null&&r(f))},u=new ResizeObserver(t);return window.addEventListener("resize",t),document.addEventListener("scroll",c,{capture:!0,passive:!0}),u.observe(e),()=>{u.unobserve(e),window.removeEventListener("resize",t),document.removeEventListener("scroll",c,!0)}}},[e,i,r,t,n])}const $g=ie("SCROLL_TYPEAHEAD_OPTION_INTO_VIEW_COMMAND");function m0({close:n,editor:e,anchorElementRef:t,resolution:r,options:i,menuRenderFn:s,onSelectOption:o,shouldSplitNodeWithQuery:a=!1,commandPriority:l=ri,preselectFirstItem:c=!0}){const[u,f]=C.useState(null),d=r.match&&r.match.matchingString;C.useEffect(()=>{c&&f(0)},[d,c]);const h=C.useCallback(m=>{e.update(()=>{const y=r.match!=null&&a?function(b){const _=K();if(!q(_)||!_.isCollapsed())return null;const x=_.anchor;if(x.type!=="text")return null;const T=x.getNode();if(!T.isSimpleText())return null;const P=x.offset,M=T.getTextContent().slice(0,P),L=b.replaceableString.length,A=P-function(B,k,N){let w=N;for(let R=w;R<=k.length;R++)B.slice(-R)===k.substring(0,R)&&(w=R);return w}(M,b.matchingString,L);if(A<0)return null;let I;return A===0?[I]=T.splitText(P):[,I]=T.splitText(A,P),I}(r.match):null;o(m,y,n,r.match?r.match.matchingString:"")})},[e,a,r.match,o,n]),p=C.useCallback(m=>{const y=e.getRootElement();y!==null&&(y.setAttribute("aria-activedescendant","typeahead-item-"+m),f(m))},[e]);return C.useEffect(()=>()=>{const m=e.getRootElement();m!==null&&m.removeAttribute("aria-activedescendant")},[e]),h0(()=>{i===null?f(null):u===null&&c&&p(0)},[i,u,p,c]),C.useEffect(()=>He(e.registerCommand($g,({option:m})=>!(!m.ref||m.ref.current==null)&&(Ag(m.ref.current),!0),l)),[e,p,l]),C.useEffect(()=>He(e.registerCommand(Td,m=>{const y=m;if(i!==null&&i.length){const b=u===null?0:u!==i.length-1?u+1:0;p(b);const _=i[b];_.ref!=null&&_.ref.current&&e.dispatchCommand($g,{index:b,option:_}),y.preventDefault(),y.stopImmediatePropagation()}return!0},l),e.registerCommand(Sd,m=>{const y=m;if(i!==null&&i.length){const b=u===null?i.length-1:u!==0?u-1:i.length-1;p(b);const _=i[b];_.ref!=null&&_.ref.current&&Ag(_.ref.current),y.preventDefault(),y.stopImmediatePropagation()}return!0},l),e.registerCommand(xl,m=>{const y=m;return y.preventDefault(),y.stopImmediatePropagation(),n(),!0},l),e.registerCommand(Md,m=>{const y=m;return i!==null&&u!==null&&i[u]!=null&&(y.preventDefault(),y.stopImmediatePropagation(),h(i[u]),!0)},l),e.registerCommand(ji,m=>i!==null&&u!==null&&i[u]!=null&&(m!==null&&(m.preventDefault(),m.stopImmediatePropagation()),h(i[u]),!0),l)),[h,n,e,i,u,p,l]),s(t,C.useMemo(()=>({options:i,selectOptionAndCleanUp:h,selectedIndex:u,setHighlightedIndex:f}),[h,u,i]),r.match?r.match.matchingString:"")}function Ig(n,e){e!=null&&(n.className=e),n.setAttribute("aria-label","Typeahead menu"),n.setAttribute("role","listbox"),n.style.display="block",n.style.position="absolute"}function y0({options:n,onWillOpen:e,onClose:t,onOpen:r,onSelectOption:i,menuRenderFn:s,anchorClassName:o,commandPriority:a=ri,parent:l}){const[c]=ge(),[u,f]=C.useState(null),d=C.useRef(null),h=function(_,x,T,P=Uu?document.body:void 0,M=!0){const[L]=ge(),A=Uu?document.createElement("div"):null,I=C.useRef(A),B=C.useCallback(()=>{if(I.current===null||P===void 0)return;I.current.style.top=I.current.style.bottom;const N=L.getRootElement(),w=I.current,R=w.firstChild;if(N!==null&&_!==null){const{left:j,top:D,width:z,height:H}=_.getRect(),V=I.current.offsetHeight;if(w.style.top=`${D+V+3+(M?window.pageYOffset:0)}px`,w.style.left=`${j+window.pageXOffset}px`,w.style.height=`${H}px`,w.style.width=`${z}px`,R!==null){R.style.top=`${D}`;const G=R.getBoundingClientRect(),ee=G.height,Q=G.width,re=N.getBoundingClientRect();j+Q>re.right&&(w.style.left=`${re.right-Q+window.pageXOffset}px`),(D+ee>window.innerHeight||D+ee>re.bottom)&&D-re.top>ee+H&&(w.style.top=`${D-ee-H+(M?window.pageYOffset:0)}px`)}w.isConnected||(Ig(w,T),P.append(w)),w.setAttribute("id","typeahead-menu"),N.setAttribute("aria-controls","typeahead-menu")}},[L,_,M,T,P]);C.useEffect(()=>{const N=L.getRootElement();return _!==null&&B(),()=>{N!==null&&N.removeAttribute("aria-controls");const w=I.current;w!==null&&w.isConnected&&(w.remove(),w.removeAttribute("id"))}},[L,B,_]);const k=C.useCallback(N=>{_!==null&&(N||x(null))},[_,x]);return p0(_,I.current,B,k),A!=null&&A===I.current&&(Ig(A,T),P!=null&&P.append(A)),I}(u,f,o,l),p=C.useCallback(()=>{f(null),t!=null&&u!==null&&t()},[t,u]),m=C.useCallback(_=>{f(_),r!=null&&u===null&&r(_)},[r,u]),y=C.useCallback(_=>{_.preventDefault(),e!=null&&e(_);const x=mC(_.target);m({getRect:()=>new DOMRect(_.clientX/x,_.clientY/x,1,1)})},[m,e]),b=C.useCallback(_=>{u!==null&&d.current!=null&&_.target!=null&&ii(_.target)&&!d.current.contains(_.target)&&p()},[p,u]);return C.useEffect(()=>{const _=c.getRootElement();if(_)return _.addEventListener("contextmenu",y),()=>_.removeEventListener("contextmenu",y)},[c,y]),C.useEffect(()=>(document.addEventListener("click",b),()=>document.removeEventListener("click",b)),[c,b]),h.current===null||u===null||c===null?null:S.jsx(m0,{close:p,resolution:u,editor:c,anchorElementRef:h,options:n,menuRenderFn:(_,x)=>s(_,x,{setMenuRef:T=>{d.current=T}}),onSelectOption:i,commandPriority:a})}function _0({defaultSelection:n}){const[e]=ge();return C.useEffect(()=>{e.focus(()=>{const t=document.activeElement,r=e.getRootElement();r===null||t!==null&&r.contains(t)||r.focus({preventScroll:!0})},{defaultSelection:n})},[n,e]),null}const b0=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0?C.useLayoutEffect:C.useEffect;function v0({onClear:n}){const[e]=ge();return b0(()=>e.registerCommand(Od,t=>(e.update(()=>{if(n==null){const r=me(),i=K(),s=Ot();r.clear(),r.append(s),i!==null&&s.select(),q(i)&&(i.format=0)}else n()}),!0),ne),[e,n]),null}const Pg=[["Cat","rgb(125, 50, 0)"],["Dog","rgb(100, 0, 0)"],["Rabbit","rgb(150, 0, 0)"],["Frog","rgb(200, 0, 0)"],["Fox","rgb(200, 75, 0)"],["Hedgehog","rgb(0, 75, 0)"],["Pigeon","rgb(0, 125, 0)"],["Squirrel","rgb(75, 100, 0)"],["Bear","rgb(125, 100, 0)"],["Tiger","rgb(0, 0, 150)"],["Leopard","rgb(0, 0, 200)"],["Zebra","rgb(0, 0, 250)"],["Wolf","rgb(0, 100, 150)"],["Owl","rgb(0, 100, 100)"],["Gull","rgb(100, 0, 100)"],["Squid","rgb(150, 0, 150)"]],Rg=Pg[Math.floor(Math.random()*Pg.length)],k0=C.createContext({clientID:0,color:Rg[1],isCollabActive:!1,name:Rg[0],yjsDocMap:new Map});function D_(n,e){return C.useContext(k0)}const x0=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0?C.useLayoutEffect:C.useEffect;function C0({ignoreHistoryMergeTagChange:n=!0,ignoreSelectionChange:e=!1,onChange:t}){const[r]=ge();return x0(()=>{if(t)return r.registerUpdateListener(({editorState:i,dirtyElements:s,dirtyLeaves:o,prevEditorState:a,tags:l})=>{e&&s.size===0&&o.size===0||n&&l.has(Pr)||a.isEmpty()||t(i,r,l)})},[r,n,e,t]),null}const is=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,w0=is&&"documentMode"in document?document.documentMode:null,S0=!(!is||!("InputEvent"in window)||w0)&&"getTargetRanges"in new window.InputEvent("input"),T0=is&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent),Lg=is&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,E0=is&&/^(?=.*Chrome).*/i.test(navigator.userAgent),N0=is&&/AppleWebKit\/[\d.]+/.test(navigator.userAgent)&&!E0;function Dg(n,e){e.update(()=>{if(n!==null){const t=Rn(n,KeyboardEvent)?null:n.clipboardData,r=K();if(r!==null&&t!=null){n.preventDefault();const i=u_(e);i!==null&&t.setData("text/html",i),t.setData("text/plain",r.getTextContent())}}})}function M0(n){return He(n.registerCommand(pn,e=>{const t=K();return!!q(t)&&(t.deleteCharacter(e),!0)},ne),n.registerCommand(Li,e=>{const t=K();return!!q(t)&&(t.deleteWord(e),!0)},ne),n.registerCommand(Di,e=>{const t=K();return!!q(t)&&(t.deleteLine(e),!0)},ne),n.registerCommand($r,e=>{const t=K();if(!q(t))return!1;if(typeof e=="string")t.insertText(e);else{const r=e.dataTransfer;if(r!=null)og(r,t);else{const i=e.data;i&&t.insertText(i)}}return!0},ne),n.registerCommand(Va,()=>{const e=K();return!!q(e)&&(e.removeText(),!0)},ne),n.registerCommand(nr,e=>{const t=K();return!!q(t)&&(t.insertLineBreak(e),!0)},ne),n.registerCommand(Xs,()=>{const e=K();return!!q(e)&&(e.insertLineBreak(),!0)},ne),n.registerCommand(wd,e=>{const t=K();if(!q(t))return!1;const r=e,i=r.shiftKey;return!!il(t,!0)&&(r.preventDefault(),sl(t,i,!0),!0)},ne),n.registerCommand(Cd,e=>{const t=K();if(!q(t))return!1;const r=e,i=r.shiftKey;return!!il(t,!1)&&(r.preventDefault(),sl(t,i,!1),!0)},ne),n.registerCommand(Ed,e=>{const t=K();return!!q(t)&&(!Lg||navigator.language!=="ko-KR")&&(e.preventDefault(),n.dispatchCommand(pn,!0))},ne),n.registerCommand(Nd,e=>{const t=K();return!!q(t)&&(e.preventDefault(),n.dispatchCommand(pn,!1))},ne),n.registerCommand(ji,e=>{const t=K();if(!q(t))return!1;if(e!==null){if((Lg||T0||N0)&&S0)return!1;e.preventDefault()}return n.dispatchCommand(nr,!1)},ne),n.registerCommand(Ga,()=>(Iy(),!0),ne),n.registerCommand(hr,e=>{const t=K();return!!q(t)&&(Dg(e,n),!0)},ne),n.registerCommand(ni,e=>{const t=K();return!!q(t)&&(function(r,i){Dg(r,i),i.update(()=>{const s=K();q(s)&&s.removeText()})}(e,n),!0)},ne),n.registerCommand(ti,e=>{const t=K();return!!q(t)&&(function(r,i){r.preventDefault(),i.update(()=>{const s=K(),o=Rn(r,ClipboardEvent)?r.clipboardData:null;o!=null&&q(s)&&og(o,s)},{tag:Cy})}(e,n),!0)},ne),n.registerCommand(Cl,e=>{const t=K();return!!q(t)&&(e.preventDefault(),!0)},ne),n.registerCommand(Ad,e=>{const t=K();return!!q(t)&&(e.preventDefault(),!0)},ne))}const zu=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0?C.useLayoutEffect:C.useEffect;function jg(n){return n.getEditorState().read(tf(n.isComposing()))}function A0({contentEditable:n,placeholder:e=null,ErrorBoundary:t}){const[r]=ge(),i=function(s,o){const[a,l]=C.useState(()=>s.getDecorators());return zu(()=>s.registerDecoratorListener(c=>{Nt.flushSync(()=>{l(c)})}),[s]),C.useEffect(()=>{l(s.getDecorators())},[s]),C.useMemo(()=>{const c=[],u=Object.keys(a);for(let f=0;f<u.length;f++){const d=u[f],h=S.jsx(o,{onError:m=>s._onError(m),children:S.jsx(C.Suspense,{fallback:null,children:a[d]})}),p=s.getElementByKey(d);p!==null&&c.push(Nt.createPortal(h,p,d))}return c},[o,a,s])}(r,t);return function(s){zu(()=>He(M0(s),L_(s)),[s])}(r),S.jsxs(S.Fragment,{children:[n,S.jsx(O0,{content:e}),i]})}function O0({content:n}){const[e]=ge(),t=function(i){const[s,o]=C.useState(()=>jg(i));return zu(()=>{function a(){const l=jg(i);o(l)}return a(),He(i.registerUpdateListener(()=>{a()}),i.registerEditableListener(()=>{a()}))},[i]),s}(e),r=R_();return t?typeof n=="function"?n(r):n:null}const mn=()=>new Map,Wu=n=>{const e=mn();return n.forEach((t,r)=>{e.set(r,t)}),e},ss=(n,e,t)=>{let r=n.get(e);return r===void 0&&n.set(e,r=t()),r},$0=(n,e)=>{const t=[];for(const[r,i]of n)t.push(e(i,r));return t},I0=(n,e)=>{for(const[t,r]of n)if(e(r,t))return!0;return!1},Ui=()=>new Set,Gc=n=>n[n.length-1],zi=Array.from,P0=Array.isArray;class R0{constructor(){this._observers=mn()}on(e,t){return ss(this._observers,e,Ui).add(t),t}once(e,t){const r=(...i)=>{this.off(e,r),t(...i)};this.on(e,r)}off(e,t){const r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return zi((this._observers.get(e)||mn()).values()).forEach(r=>r(...t))}destroy(){this._observers=mn()}}const Kr=Math.floor,Ia=Math.abs,j_=(n,e)=>n<e?n:e,os=(n,e)=>n>e?n:e,L0=n=>n!==0?n<0:1/n<0,Fg=1,qg=2,Yc=4,Xc=8,D0=32,F_=64,al=128,j0=31,Bg=63,zs=127,F0=2147483647,q0=Number.isInteger||(n=>typeof n=="number"&&isFinite(n)&&Kr(n)===n),B0=n=>n.toLowerCase(),U0=/^\s*/g,z0=n=>n.replace(U0,""),W0=/([A-Z])/g,Ug=(n,e)=>z0(n.replace(W0,t=>`${e}${B0(t)}`)),K0=n=>{const e=unescape(encodeURIComponent(n)),t=e.length,r=new Uint8Array(t);for(let i=0;i<t;i++)r[i]=e.codePointAt(i);return r},eo=typeof TextEncoder<"u"?new TextEncoder:null,H0=n=>eo.encode(n),J0=eo?H0:K0;let Qc=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Qc&&Qc.decode(new Uint8Array).length===1&&(Qc=null);class Co{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const nf=()=>new Co,V0=n=>{let e=n.cpos;for(let t=0;t<n.bufs.length;t++)e+=n.bufs[t].length;return e},Ln=n=>{const e=new Uint8Array(V0(n));let t=0;for(let r=0;r<n.bufs.length;r++){const i=n.bufs[r];e.set(i,t),t+=i.length}return e.set(new Uint8Array(n.cbuf.buffer,0,n.cpos),t),e},G0=(n,e)=>{const t=n.cbuf.length;t-n.cpos<e&&(n.bufs.push(new Uint8Array(n.cbuf.buffer,0,n.cpos)),n.cbuf=new Uint8Array(os(t,e)*2),n.cpos=0)},ze=(n,e)=>{const t=n.cbuf.length;n.cpos===t&&(n.bufs.push(n.cbuf),n.cbuf=new Uint8Array(t*2),n.cpos=0),n.cbuf[n.cpos++]=e},Ku=ze,Ee=(n,e)=>{for(;e>zs;)ze(n,al|zs&e),e=Kr(e/128);ze(n,zs&e)},rf=(n,e)=>{const t=L0(e);for(t&&(e=-e),ze(n,(e>Bg?al:0)|(t?F_:0)|Bg&e),e=Kr(e/64);e>0;)ze(n,(e>zs?al:0)|zs&e),e=Kr(e/128)},Hu=new Uint8Array(3e4),Y0=Hu.length/3,X0=(n,e)=>{if(e.length<Y0){const t=eo.encodeInto(e,Hu).written||0;Ee(n,t);for(let r=0;r<t;r++)ze(n,Hu[r])}else Tt(n,J0(e))},Q0=(n,e)=>{const t=unescape(encodeURIComponent(e)),r=t.length;Ee(n,r);for(let i=0;i<r;i++)ze(n,t.codePointAt(i))},Oi=eo&&eo.encodeInto?X0:Q0,sf=(n,e)=>{const t=n.cbuf.length,r=n.cpos,i=j_(t-r,e.length),s=e.length-i;n.cbuf.set(e.subarray(0,i),r),n.cpos+=i,s>0&&(n.bufs.push(n.cbuf),n.cbuf=new Uint8Array(os(t*2,s)),n.cbuf.set(e.subarray(i)),n.cpos=s)},Tt=(n,e)=>{Ee(n,e.byteLength),sf(n,e)},of=(n,e)=>{G0(n,e);const t=new DataView(n.cbuf.buffer,n.cpos,e);return n.cpos+=e,t},Z0=(n,e)=>of(n,4).setFloat32(0,e,!1),eS=(n,e)=>of(n,8).setFloat64(0,e,!1),tS=(n,e)=>of(n,8).setBigInt64(0,e,!1),zg=new DataView(new ArrayBuffer(4)),nS=n=>(zg.setFloat32(0,n),zg.getFloat32(0)===n),to=(n,e)=>{switch(typeof e){case"string":ze(n,119),Oi(n,e);break;case"number":q0(e)&&Ia(e)<=F0?(ze(n,125),rf(n,e)):nS(e)?(ze(n,124),Z0(n,e)):(ze(n,123),eS(n,e));break;case"bigint":ze(n,122),tS(n,e);break;case"object":if(e===null)ze(n,126);else if(P0(e)){ze(n,117),Ee(n,e.length);for(let t=0;t<e.length;t++)to(n,e[t])}else if(e instanceof Uint8Array)ze(n,116),Tt(n,e);else{ze(n,118);const t=Object.keys(e);Ee(n,t.length);for(let r=0;r<t.length;r++){const i=t[r];Oi(n,i),to(n,e[i])}}break;case"boolean":ze(n,e?120:121);break;default:ze(n,127)}};class Wg extends Co{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&Ee(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const Kg=n=>{n.count>0&&(rf(n.encoder,n.count===1?n.s:-n.s),n.count>1&&Ee(n.encoder,n.count-2))};class Pa{constructor(){this.encoder=new Co,this.s=0,this.count=0}write(e){this.s===e?this.count++:(Kg(this),this.count=1,this.s=e)}toUint8Array(){return Kg(this),Ln(this.encoder)}}const Hg=n=>{if(n.count>0){const e=n.diff*2+(n.count===1?0:1);rf(n.encoder,e),n.count>1&&Ee(n.encoder,n.count-2)}};class Zc{constructor(){this.encoder=new Co,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(Hg(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return Hg(this),Ln(this.encoder)}}class rS{constructor(){this.sarr=[],this.s="",this.lensE=new Pa}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new Co;return this.sarr.push(this.s),this.s="",Oi(e,this.sarr.join("")),sf(e,this.lensE.toUint8Array()),Ln(e)}}const Wi=n=>new Error(n),yn=()=>{throw Wi("Method unimplemented")},Hr=()=>{throw Wi("Unexpected case")},iS=crypto.getRandomValues.bind(crypto),q_=()=>iS(new Uint32Array(1))[0],sS="10000000-1000-4000-8000"+-1e11,oS=()=>sS.replace(/[018]/g,n=>(n^q_()&15>>n/4).toString(16)),Jg=n=>new Promise(n);Promise.all.bind(Promise);const Vg=n=>n===void 0?null:n;class aS{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}}let B_=new aS,lS=!0;try{typeof localStorage<"u"&&localStorage&&(B_=localStorage,lS=!1)}catch{}const cS=B_,uS=Object.assign,dS=Object.keys,fS=(n,e)=>{for(const t in n)e(n[t],t)},Gg=n=>dS(n).length,hS=n=>{for(const e in n)return!1;return!0},gS=(n,e)=>{for(const t in n)if(!e(n[t],t))return!1;return!0},pS=(n,e)=>Object.prototype.hasOwnProperty.call(n,e),mS=(n,e)=>n===e||Gg(n)===Gg(e)&&gS(n,(t,r)=>(t!==void 0||pS(e,r))&&e[r]===t),yS=Object.freeze,U_=n=>{for(const e in n){const t=n[e];(typeof t=="object"||typeof t=="function")&&U_(n[e])}return yS(n)},af=(n,e,t=0)=>{try{for(;t<n.length;t++)n[t](...e)}finally{t<n.length&&af(n,e,t+1)}},_S=(n,e)=>e.includes(n);var z_={};const no=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";let ln;const bS=()=>{if(ln===void 0)if(no){ln=mn();const n=process.argv;let e=null;for(let t=0;t<n.length;t++){const r=n[t];r[0]==="-"?(e!==null&&ln.set(e,""),e=r):e!==null&&(ln.set(e,r),e=null)}e!==null&&ln.set(e,"")}else typeof location=="object"?(ln=mn(),(location.search||"?").slice(1).split("&").forEach(n=>{if(n.length!==0){const[e,t]=n.split("=");ln.set(`--${Ug(e,"-")}`,t),ln.set(`-${Ug(e,"-")}`,t)}})):ln=mn();return ln},Ju=n=>bS().has(n),ll=n=>Vg(no?z_[n.toUpperCase().replaceAll("-","_")]:cS.getItem(n)),W_=n=>Ju("--"+n)||ll(n)!==null;W_("production");const vS=no&&_S(z_.FORCE_COLOR,["true","1","2"]),kS=vS||!Ju("--no-colors")&&!W_("no-color")&&(!no||process.stdout.isTTY)&&(!no||Ju("--color")||ll("COLORTERM")!==null||(ll("TERM")||"").includes("color"));class xS{constructor(e,t){this.left=e,this.right=t}}const Nn=(n,e)=>new xS(n,e);typeof DOMParser<"u"&&new DOMParser;const CS=n=>$0(n,(e,t)=>`${t}:${e};`).join(""),zn=Symbol,K_=zn(),H_=zn(),wS=zn(),SS=zn(),TS=zn(),J_=zn(),ES=zn(),lf=zn(),NS=zn(),MS=n=>{var i;n.length===1&&((i=n[0])==null?void 0:i.constructor)===Function&&(n=n[0]());const e=[],t=[];let r=0;for(;r<n.length;r++){const s=n[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)e.push(s);else if(s.constructor===Object)break}for(r>0&&t.push(e.join(""));r<n.length;r++){const s=n[r];s instanceof Symbol||t.push(s)}return t},AS={[K_]:Nn("font-weight","bold"),[H_]:Nn("font-weight","normal"),[wS]:Nn("color","blue"),[TS]:Nn("color","green"),[SS]:Nn("color","grey"),[J_]:Nn("color","red"),[ES]:Nn("color","purple"),[lf]:Nn("color","orange"),[NS]:Nn("color","black")},OS=n=>{var o;n.length===1&&((o=n[0])==null?void 0:o.constructor)===Function&&(n=n[0]());const e=[],t=[],r=mn();let i=[],s=0;for(;s<n.length;s++){const a=n[s],l=AS[a];if(l!==void 0)r.set(l.left,l.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const c=CS(r);s>0||c.length>0?(e.push("%c"+a),t.push(c)):e.push(a)}else break}}for(s>0&&(i=t,i.unshift(e.join("")));s<n.length;s++){const a=n[s];a instanceof Symbol||i.push(a)}return i},V_=kS?OS:MS,$S=(...n)=>{console.log(...V_(n)),G_.forEach(e=>e.print(n))},IS=(...n)=>{console.warn(...V_(n)),n.unshift(lf),G_.forEach(e=>e.print(n))},G_=Ui(),Y_=n=>({[Symbol.iterator](){return this},next:n}),PS=(n,e)=>Y_(()=>{let t;do t=n.next();while(!t.done&&!e(t.value));return t}),eu=(n,e)=>Y_(()=>{const{done:t,value:r}=n.next();return{done:t,value:t?void 0:e(r)}});class RS{constructor(e,t){this.clock=e,this.len=t}}class LS{constructor(){this.clients=new Map}}const X_=(n,e,t)=>e.clients.forEach((r,i)=>{const s=n.doc.store.clients.get(i);if(s!=null){const o=s[s.length-1],a=o.id.clock+o.length;for(let l=0,c=r[l];l<r.length&&c.clock<a;c=r[++l])ib(n,s,c.clock,c.len,t)}}),DS=(n,e)=>{let t=0,r=n.length-1;for(;t<=r;){const i=Kr((t+r)/2),s=n[i],o=s.clock;if(o<=e){if(e<o+s.len)return i;t=i+1}else r=i-1}return null},Q_=(n,e)=>{const t=n.clients.get(e.client);return t!==void 0&&DS(t,e.clock)!==null},Z_=n=>{n.clients.forEach(e=>{e.sort((i,s)=>i.clock-s.clock);let t,r;for(t=1,r=1;t<e.length;t++){const i=e[r-1],s=e[t];i.clock+i.len>=s.clock?i.len=os(i.len,s.clock+s.len-i.clock):(r<t&&(e[r]=s),r++)}e.length=r})},eb=(n,e,t,r)=>{ss(n.clients,e,()=>[]).push(new RS(t,r))},jS=(n,e)=>{Ee(n.restEncoder,e.clients.size),zi(e.clients.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{n.resetDsCurVal(),Ee(n.restEncoder,t);const i=r.length;Ee(n.restEncoder,i);for(let s=0;s<i;s++){const o=r[s];n.writeDsClock(o.clock),n.writeDsLen(o.len)}})},tb=q_;class wo extends R0{constructor({guid:e=oS(),collectionid:t=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=tb(),this.guid=e,this.collectionid=t,this.share=new Map,this.store=new VS,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=Jg(c=>{this.on("load",()=>{this.isLoaded=!0,c(this)})});const l=()=>Jg(c=>{const u=f=>{(f===void 0||f===!0)&&(this.off("sync",u),c())};this.on("sync",u)});this.on("sync",c=>{c===!1&&this.isSynced&&(this.whenSynced=l()),this.isSynced=c===void 0||c===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=l()}load(){const e=this._item;e!==null&&!this.shouldLoad&&Oe(e.parent.doc,t=>{t.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(zi(this.subdocs).map(e=>e.guid))}transact(e,t=null){return Oe(this,e,t)}get(e,t=nt){const r=ss(this.share,e,()=>{const s=new t;return s._integrate(this,null),s}),i=r.constructor;if(t!==nt&&i!==t)if(i===nt){const s=new t;s._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=r._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=r._length,this.share.set(e,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,jr)}getText(e=""){return this.get(e,dl)}getMap(e=""){return this.get(e,Ki)}getXmlElement(e=""){return this.get(e,so)}getXmlFragment(e=""){return this.get(e,Hi)}toJSON(){const e={};return this.share.forEach((t,r)=>{e[r]=t.toJSON()}),e}destroy(){this.isDestroyed=!0,zi(this.subdocs).forEach(t=>t.destroy());const e=this._item;if(e!==null){this._item=null;const t=e.content;t.doc=new wo({guid:this.guid,...t.opts,shouldLoad:!1}),t.doc._item=e,Oe(e.parent.doc,r=>{const i=t.doc;e.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class FS{constructor(){this.restEncoder=nf()}toUint8Array(){return Ln(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){Ee(this.restEncoder,e)}writeDsLen(e){Ee(this.restEncoder,e)}}class qS extends FS{writeLeftID(e){Ee(this.restEncoder,e.client),Ee(this.restEncoder,e.clock)}writeRightID(e){Ee(this.restEncoder,e.client),Ee(this.restEncoder,e.clock)}writeClient(e){Ee(this.restEncoder,e)}writeInfo(e){Ku(this.restEncoder,e)}writeString(e){Oi(this.restEncoder,e)}writeParentInfo(e){Ee(this.restEncoder,e?1:0)}writeTypeRef(e){Ee(this.restEncoder,e)}writeLen(e){Ee(this.restEncoder,e)}writeAny(e){to(this.restEncoder,e)}writeBuf(e){Tt(this.restEncoder,e)}writeJSON(e){Oi(this.restEncoder,JSON.stringify(e))}writeKey(e){Oi(this.restEncoder,e)}}class BS{constructor(){this.restEncoder=nf(),this.dsCurrVal=0}toUint8Array(){return Ln(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const t=e-this.dsCurrVal;this.dsCurrVal=e,Ee(this.restEncoder,t)}writeDsLen(e){e===0&&Hr(),Ee(this.restEncoder,e-1),this.dsCurrVal+=e}}class US extends BS{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Zc,this.clientEncoder=new Pa,this.leftClockEncoder=new Zc,this.rightClockEncoder=new Zc,this.infoEncoder=new Wg(Ku),this.stringEncoder=new rS,this.parentInfoEncoder=new Wg(Ku),this.typeRefEncoder=new Pa,this.lenEncoder=new Pa}toUint8Array(){const e=nf();return Ee(e,0),Tt(e,this.keyClockEncoder.toUint8Array()),Tt(e,this.clientEncoder.toUint8Array()),Tt(e,this.leftClockEncoder.toUint8Array()),Tt(e,this.rightClockEncoder.toUint8Array()),Tt(e,Ln(this.infoEncoder)),Tt(e,this.stringEncoder.toUint8Array()),Tt(e,Ln(this.parentInfoEncoder)),Tt(e,this.typeRefEncoder.toUint8Array()),Tt(e,this.lenEncoder.toUint8Array()),sf(e,Ln(this.restEncoder)),Ln(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){to(this.restEncoder,e)}writeBuf(e){Tt(this.restEncoder,e)}writeJSON(e){to(this.restEncoder,e)}writeKey(e){const t=this.keyMap.get(e);t===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(t)}}const zS=(n,e,t,r)=>{r=os(r,e[0].id.clock);const i=Fn(e,r);Ee(n.restEncoder,e.length-i),n.writeClient(t),Ee(n.restEncoder,r);const s=e[i];s.write(n,r-s.id.clock);for(let o=i+1;o<e.length;o++)e[o].write(n,0)},WS=(n,e,t)=>{const r=new Map;t.forEach((i,s)=>{xt(e,s)>i&&r.set(s,i)}),cf(e).forEach((i,s)=>{t.has(s)||r.set(s,0)}),Ee(n.restEncoder,r.size),zi(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{zS(n,e.clients.get(i),i,s)})},KS=(n,e)=>WS(n,e.doc.store,e.beforeState);class HS{constructor(){this.l=[]}}const Yg=()=>new HS,Xg=(n,e)=>n.l.push(e),Qg=(n,e)=>{const t=n.l,r=t.length;n.l=t.filter(i=>e!==i),r===n.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},nb=(n,e,t)=>af(n.l,[e,t]);class Ra{constructor(e,t){this.client=e,this.clock=t}}const ua=(n,e)=>n===e||n!==null&&e!==null&&n.client===e.client&&n.clock===e.clock,Re=(n,e)=>new Ra(n,e),JS=n=>{for(const[e,t]of n.doc.share.entries())if(t===n)return e;throw Hr()},wi=(n,e)=>e===void 0?!n.deleted:e.sv.has(n.id.client)&&(e.sv.get(n.id.client)||0)>n.id.clock&&!Q_(e.ds,n.id),Vu=(n,e)=>{const t=ss(n.meta,Vu,Ui),r=n.doc.store;t.has(e)||(e.sv.forEach((i,s)=>{i<xt(r,s)&&cr(n,Re(s,i))}),X_(n,e.ds,i=>{}),t.add(e))};class VS{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const cf=n=>{const e=new Map;return n.clients.forEach((t,r)=>{const i=t[t.length-1];e.set(r,i.id.clock+i.length)}),e},xt=(n,e)=>{const t=n.clients.get(e);if(t===void 0)return 0;const r=t[t.length-1];return r.id.clock+r.length},rb=(n,e)=>{let t=n.clients.get(e.id.client);if(t===void 0)t=[],n.clients.set(e.id.client,t);else{const r=t[t.length-1];if(r.id.clock+r.length!==e.id.clock)throw Hr()}t.push(e)},Fn=(n,e)=>{let t=0,r=n.length-1,i=n[r],s=i.id.clock;if(s===e)return r;let o=Kr(e/(s+i.length-1)*r);for(;t<=r;){if(i=n[o],s=i.id.clock,s<=e){if(e<s+i.length)return o;t=o+1}else r=o-1;o=Kr((t+r)/2)}throw Hr()},GS=(n,e)=>{const t=n.clients.get(e.client);return t[Fn(t,e.clock)]},tu=GS,Gu=(n,e,t)=>{const r=Fn(e,t),i=e[r];return i.id.clock<t&&i instanceof ut?(e.splice(r+1,0,Cb(n,i,t-i.id.clock)),r+1):r},cr=(n,e)=>{const t=n.doc.store.clients.get(e.client);return t[Gu(n,t,e.clock)]},Zg=(n,e,t)=>{const r=e.clients.get(t.client),i=Fn(r,t.clock),s=r[i];return t.clock!==s.id.clock+s.length-1&&s.constructor!==Yn&&r.splice(i+1,0,Cb(n,s,t.clock-s.id.clock+1)),s},YS=(n,e,t)=>{const r=n.clients.get(e.id.client);r[Fn(r,e.id.clock)]=t},ib=(n,e,t,r,i)=>{if(r===0)return;const s=t+r;let o=Gu(n,e,t),a;do a=e[o++],s<a.id.clock+a.length&&Gu(n,e,s),i(a);while(o<e.length&&e[o].id.clock<s)};class XS{constructor(e,t,r){this.doc=e,this.deleteSet=new LS,this.beforeState=cf(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=t,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const ep=(n,e)=>e.deleteSet.clients.size===0&&!I0(e.afterState,(t,r)=>e.beforeState.get(r)!==t)?!1:(Z_(e.deleteSet),KS(n,e),jS(n,e.deleteSet),!0),tp=(n,e,t)=>{const r=e._item;(r===null||r.id.clock<(n.beforeState.get(r.id.client)||0)&&!r.deleted)&&ss(n.changed,e,Ui).add(t)},La=(n,e)=>{let t=n[e],r=n[e-1],i=e;for(;i>0;t=r,r=n[--i-1]){if(r.deleted===t.deleted&&r.constructor===t.constructor&&r.mergeWith(t)){t instanceof ut&&t.parentSub!==null&&t.parent._map.get(t.parentSub)===t&&t.parent._map.set(t.parentSub,r);continue}break}const s=e-i;return s&&n.splice(e+1-s,s),s},QS=(n,e,t)=>{for(const[r,i]of n.clients.entries()){const s=e.clients.get(r);for(let o=i.length-1;o>=0;o--){const a=i[o],l=a.clock+a.len;for(let c=Fn(s,a.clock),u=s[c];c<s.length&&u.id.clock<l;u=s[++c]){const f=s[c];if(a.clock+a.len<=f.id.clock)break;f instanceof ut&&f.deleted&&!f.keep&&t(f)&&f.gc(e,!1)}}}},ZS=(n,e)=>{n.clients.forEach((t,r)=>{const i=e.clients.get(r);for(let s=t.length-1;s>=0;s--){const o=t[s],a=j_(i.length-1,1+Fn(i,o.clock+o.len-1));for(let l=a,c=i[l];l>0&&c.id.clock>=o.clock;c=i[l])l-=1+La(i,l)}})},sb=(n,e)=>{if(e<n.length){const t=n[e],r=t.doc,i=r.store,s=t.deleteSet,o=t._mergeStructs;try{Z_(s),t.afterState=cf(t.doc.store),r.emit("beforeObserverCalls",[t,r]);const a=[];t.changed.forEach((l,c)=>a.push(()=>{(c._item===null||!c._item.deleted)&&c._callObserver(t,l)})),a.push(()=>{t.changedParentTypes.forEach((l,c)=>{c._dEH.l.length>0&&(c._item===null||!c._item.deleted)&&(l=l.filter(u=>u.target._item===null||!u.target._item.deleted),l.forEach(u=>{u.currentTarget=c,u._path=null}),l.sort((u,f)=>u.path.length-f.path.length),nb(c._dEH,l,t))})}),a.push(()=>r.emit("afterTransaction",[t,r])),af(a,[]),t._needFormattingCleanup&&u1(t)}finally{r.gc&&QS(s,i,r.gcFilter),ZS(s,i),t.afterState.forEach((u,f)=>{const d=t.beforeState.get(f)||0;if(d!==u){const h=i.clients.get(f),p=os(Fn(h,d),1);for(let m=h.length-1;m>=p;)m-=1+La(h,m)}});for(let u=o.length-1;u>=0;u--){const{client:f,clock:d}=o[u].id,h=i.clients.get(f),p=Fn(h,d);p+1<h.length&&La(h,p+1)>1||p>0&&La(h,p)}if(!t.local&&t.afterState.get(r.clientID)!==t.beforeState.get(r.clientID)&&($S(lf,K_,"[yjs] ",H_,J_,"Changed the client-id because another client seems to be using it."),r.clientID=tb()),r.emit("afterTransactionCleanup",[t,r]),r._observers.has("update")){const u=new qS;ep(u,t)&&r.emit("update",[u.toUint8Array(),t.origin,r,t])}if(r._observers.has("updateV2")){const u=new US;ep(u,t)&&r.emit("updateV2",[u.toUint8Array(),t.origin,r,t])}const{subdocsAdded:a,subdocsLoaded:l,subdocsRemoved:c}=t;(a.size>0||c.size>0||l.size>0)&&(a.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),c.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:l,added:a,removed:c},r,t]),c.forEach(u=>u.destroy())),n.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,n])):sb(n,e+1)}}},Oe=(n,e,t=null,r=!0)=>{const i=n._transactionCleanups;let s=!1,o=null;n._transaction===null&&(s=!0,n._transaction=new XS(n,t,r),i.push(n._transaction),i.length===1&&n.emit("beforeAllTransactions",[n]),n.emit("beforeTransaction",[n._transaction,n]));try{o=e(n._transaction)}finally{if(s){const a=n._transaction===i[0];n._transaction=null,a&&sb(i,0)}}return o},np="You must not compute changes after the event-handler fired.";class Rl{constructor(e,t){this.target=e,this.currentTarget=e,this.transaction=t,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=e1(this.currentTarget,this.target))}deletes(e){return Q_(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Wi(np);const e=new Map,t=this.target;this.transaction.changed.get(t).forEach(i=>{if(i!==null){const s=t._map.get(i);let o,a;if(this.adds(s)){let l=s.left;for(;l!==null&&this.adds(l);)l=l.left;if(this.deletes(s))if(l!==null&&this.deletes(l))o="delete",a=Gc(l.content.getContent());else return;else l!==null&&this.deletes(l)?(o="update",a=Gc(l.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=Gc(s.content.getContent());else return;e.set(i,{action:o,oldValue:a})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw Wi(np);const t=this.target,r=Ui(),i=Ui(),s=[];if(e={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(t).has(null)){let a=null;const l=()=>{a&&s.push(a)};for(let c=t._start;c!==null;c=c.right)c.deleted?this.deletes(c)&&!this.adds(c)&&((a===null||a.delete===void 0)&&(l(),a={delete:0}),a.delete+=c.length,i.add(c)):this.adds(c)?((a===null||a.insert===void 0)&&(l(),a={insert:[]}),a.insert=a.insert.concat(c.content.getContent()),r.add(c)):((a===null||a.retain===void 0)&&(l(),a={retain:0}),a.retain+=c.length);a!==null&&a.retain===void 0&&l()}this._changes=e}return e}}const e1=(n,e)=>{const t=[];for(;e._item!==null&&e!==n;){if(e._item.parentSub!==null)t.unshift(e._item.parentSub);else{let r=0,i=e._item.parent._start;for(;i!==e._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;t.unshift(r)}e=e._item.parent}return t},ft=()=>{IS("Invalid access: Add Yjs type to a document before reading data.")},ob=80;let uf=0;class t1{constructor(e,t){e.marker=!0,this.p=e,this.index=t,this.timestamp=uf++}}const n1=n=>{n.timestamp=uf++},ab=(n,e,t)=>{n.p.marker=!1,n.p=e,e.marker=!0,n.index=t,n.timestamp=uf++},r1=(n,e,t)=>{if(n.length>=ob){const r=n.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return ab(r,e,t),r}else{const r=new t1(e,t);return n.push(r),r}},Ll=(n,e)=>{if(n._start===null||e===0||n._searchMarker===null)return null;const t=n._searchMarker.length===0?null:n._searchMarker.reduce((s,o)=>Ia(e-s.index)<Ia(e-o.index)?s:o);let r=n._start,i=0;for(t!==null&&(r=t.p,i=t.index,n1(t));r.right!==null&&i<e;){if(!r.deleted&&r.countable){if(e<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>e;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return t!==null&&Ia(t.index-i)<r.parent.length/ob?(ab(t,r,i),t):r1(n._searchMarker,r,i)},ro=(n,e,t)=>{for(let r=n.length-1;r>=0;r--){const i=n[r];if(t>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){n.splice(r,1);continue}i.p=s,s.marker=!0}(e<i.index||t>0&&e===i.index)&&(i.index=os(e,i.index+t))}},Dl=(n,e,t)=>{const r=n,i=e.changedParentTypes;for(;ss(i,n,()=>[]).push(t),n._item!==null;)n=n._item.parent;nb(r._eH,t,e)};class nt{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Yg(),this._dEH=Yg(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,t){this.doc=e,this._item=t}_copy(){throw yn()}clone(){throw yn()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,t){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){Xg(this._eH,e)}observeDeep(e){Xg(this._dEH,e)}unobserve(e){Qg(this._eH,e)}unobserveDeep(e){Qg(this._dEH,e)}toJSON(){}}const lb=(n,e,t)=>{n.doc??ft(),e<0&&(e=n._length+e),t<0&&(t=n._length+t);let r=t-e;const i=[];let s=n._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=e)e-=o.length;else{for(let a=e;a<o.length&&r>0;a++)i.push(o[a]),r--;e=0}}s=s.right}return i},cb=n=>{n.doc??ft();const e=[];let t=n._start;for(;t!==null;){if(t.countable&&!t.deleted){const r=t.content.getContent();for(let i=0;i<r.length;i++)e.push(r[i])}t=t.right}return e},io=(n,e)=>{let t=0,r=n._start;for(n.doc??ft();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)e(i[s],t++,n)}r=r.right}},ub=(n,e)=>{const t=[];return io(n,(r,i)=>{t.push(e(r,i,n))}),t},i1=n=>{let e=n._start,t=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(t===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};t=e.content.getContent(),r=0,e=e.right}const i=t[r++];return t.length<=r&&(t=null),{done:!1,value:i}}}},db=(n,e)=>{n.doc??ft();const t=Ll(n,e);let r=n._start;for(t!==null&&(r=t.p,e-=t.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},cl=(n,e,t,r)=>{let i=t;const s=n.doc,o=s.clientID,a=s.store,l=t===null?e._start:t.right;let c=[];const u=()=>{c.length>0&&(i=new ut(Re(o,xt(a,o)),i,i&&i.lastId,l,l&&l.id,e,null,new Ji(c)),i.integrate(n,0),c=[])};r.forEach(f=>{if(f===null)c.push(f);else switch(f.constructor){case Number:case Object:case Boolean:case Array:case String:c.push(f);break;default:switch(u(),f.constructor){case Uint8Array:case ArrayBuffer:i=new ut(Re(o,xt(a,o)),i,i&&i.lastId,l,l&&l.id,e,null,new jl(new Uint8Array(f))),i.integrate(n,0);break;case wo:i=new ut(Re(o,xt(a,o)),i,i&&i.lastId,l,l&&l.id,e,null,new Fl(f)),i.integrate(n,0);break;default:if(f instanceof nt)i=new ut(Re(o,xt(a,o)),i,i&&i.lastId,l,l&&l.id,e,null,new _r(f)),i.integrate(n,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},fb=()=>Wi("Length exceeded!"),hb=(n,e,t,r)=>{if(t>e._length)throw fb();if(t===0)return e._searchMarker&&ro(e._searchMarker,t,r.length),cl(n,e,null,r);const i=t,s=Ll(e,t);let o=e._start;for(s!==null&&(o=s.p,t-=s.index,t===0&&(o=o.prev,t+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(t<=o.length){t<o.length&&cr(n,Re(o.id.client,o.id.clock+t));break}t-=o.length}return e._searchMarker&&ro(e._searchMarker,i,r.length),cl(n,e,o,r)},s1=(n,e,t)=>{let i=(e._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:e._start}).p;if(i)for(;i.right;)i=i.right;return cl(n,e,i,t)},gb=(n,e,t,r)=>{if(r===0)return;const i=t,s=r,o=Ll(e,t);let a=e._start;for(o!==null&&(a=o.p,t-=o.index);a!==null&&t>0;a=a.right)!a.deleted&&a.countable&&(t<a.length&&cr(n,Re(a.id.client,a.id.clock+t)),t-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&cr(n,Re(a.id.client,a.id.clock+r)),a.delete(n),r-=a.length),a=a.right;if(r>0)throw fb();e._searchMarker&&ro(e._searchMarker,i,-s+r)},ul=(n,e,t)=>{const r=e._map.get(t);r!==void 0&&r.delete(n)},df=(n,e,t,r)=>{const i=e._map.get(t)||null,s=n.doc,o=s.clientID;let a;if(r==null)a=new Ji([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:a=new Ji([r]);break;case Uint8Array:a=new jl(r);break;case wo:a=new Fl(r);break;default:if(r instanceof nt)a=new _r(r);else throw new Error("Unexpected content type")}new ut(Re(o,xt(s.store,o)),i,i&&i.lastId,null,null,e,t,a).integrate(n,0)},ff=(n,e)=>{n.doc??ft();const t=n._map.get(e);return t!==void 0&&!t.deleted?t.content.getContent()[t.length-1]:void 0},pb=n=>{const e={};return n.doc??ft(),n._map.forEach((t,r)=>{t.deleted||(e[r]=t.content.getContent()[t.length-1])}),e},mb=(n,e)=>{n.doc??ft();const t=n._map.get(e);return t!==void 0&&!t.deleted},o1=(n,e)=>{const t={};return n._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!e.sv.has(s.id.client)||s.id.clock>=(e.sv.get(s.id.client)||0));)s=s.left;s!==null&&wi(s,e)&&(t[i]=s.content.getContent()[s.length-1])}),t},da=n=>(n.doc??ft(),PS(n._map.entries(),e=>!e[1].deleted));class yb extends Rl{}class jr extends nt{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const t=new jr;return t.push(e),t}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new jr}clone(){const e=new jr;return e.insert(0,this.toArray().map(t=>t instanceof nt?t.clone():t)),e}get length(){return this.doc??ft(),this._length}_callObserver(e,t){super._callObserver(e,t),Dl(this,e,new yb(this,e))}insert(e,t){this.doc!==null?Oe(this.doc,r=>{hb(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}push(e){this.doc!==null?Oe(this.doc,t=>{s1(t,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,t=1){this.doc!==null?Oe(this.doc,r=>{gb(r,this,e,t)}):this._prelimContent.splice(e,t)}get(e){return db(this,e)}toArray(){return cb(this)}slice(e=0,t=this.length){return lb(this,e,t)}toJSON(){return this.map(e=>e instanceof nt?e.toJSON():e)}map(e){return ub(this,e)}forEach(e){io(this,e)}[Symbol.iterator](){return i1(this)}_write(e){e.writeTypeRef(m1)}}class a1 extends Rl{constructor(e,t,r){super(e,t),this.keysChanged=r}}class Ki extends nt{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,t){super._integrate(e,t),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new Ki}clone(){const e=new Ki;return this.forEach((t,r)=>{e.set(r,t instanceof nt?t.clone():t)}),e}_callObserver(e,t){Dl(this,e,new a1(this,e,t))}toJSON(){this.doc??ft();const e={};return this._map.forEach((t,r)=>{if(!t.deleted){const i=t.content.getContent()[t.length-1];e[r]=i instanceof nt?i.toJSON():i}}),e}get size(){return[...da(this)].length}keys(){return eu(da(this),e=>e[0])}values(){return eu(da(this),e=>e[1].content.getContent()[e[1].length-1])}entries(){return eu(da(this),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this.doc??ft(),this._map.forEach((t,r)=>{t.deleted||e(t.content.getContent()[t.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?Oe(this.doc,t=>{ul(t,this,e)}):this._prelimContent.delete(e)}set(e,t){return this.doc!==null?Oe(this.doc,r=>{df(r,this,e,t)}):this._prelimContent.set(e,t),t}get(e){return ff(this,e)}has(e){return mb(this,e)}clear(){this.doc!==null?Oe(this.doc,e=>{this.forEach(function(t,r,i){ul(e,i,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(y1)}}const er=(n,e)=>n===e||typeof n=="object"&&typeof e=="object"&&n&&e&&mS(n,e);class Yu{constructor(e,t,r,i){this.left=e,this.right=t,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&Hr(),this.right.content.constructor){case Je:this.right.deleted||as(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const rp=(n,e,t)=>{for(;e.right!==null&&t>0;){switch(e.right.content.constructor){case Je:e.right.deleted||as(e.currentAttributes,e.right.content);break;default:e.right.deleted||(t<e.right.length&&cr(n,Re(e.right.id.client,e.right.id.clock+t)),e.index+=e.right.length,t-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},fa=(n,e,t,r)=>{const i=new Map,s=r?Ll(e,t):null;if(s){const o=new Yu(s.p.left,s.p,s.index,i);return rp(n,o,t-s.index)}else{const o=new Yu(null,e._start,0,i);return rp(n,o,t)}},_b=(n,e,t,r)=>{for(;t.right!==null&&(t.right.deleted===!0||t.right.content.constructor===Je&&er(r.get(t.right.content.key),t.right.content.value));)t.right.deleted||r.delete(t.right.content.key),t.forward();const i=n.doc,s=i.clientID;r.forEach((o,a)=>{const l=t.left,c=t.right,u=new ut(Re(s,xt(i.store,s)),l,l&&l.lastId,c,c&&c.id,e,null,new Je(a,o));u.integrate(n,0),t.right=u,t.forward()})},as=(n,e)=>{const{key:t,value:r}=e;r===null?n.delete(t):n.set(t,r)},bb=(n,e)=>{for(;n.right!==null;){if(!(n.right.deleted||n.right.content.constructor===Je&&er(e[n.right.content.key]??null,n.right.content.value)))break;n.forward()}},vb=(n,e,t,r)=>{const i=n.doc,s=i.clientID,o=new Map;for(const a in r){const l=r[a],c=t.currentAttributes.get(a)??null;if(!er(c,l)){o.set(a,c);const{left:u,right:f}=t;t.right=new ut(Re(s,xt(i.store,s)),u,u&&u.lastId,f,f&&f.id,e,null,new Je(a,l)),t.right.integrate(n,0),t.forward()}}return o},nu=(n,e,t,r,i)=>{t.currentAttributes.forEach((d,h)=>{i[h]===void 0&&(i[h]=null)});const s=n.doc,o=s.clientID;bb(t,i);const a=vb(n,e,t,i),l=r.constructor===String?new qn(r):r instanceof nt?new _r(r):new ls(r);let{left:c,right:u,index:f}=t;e._searchMarker&&ro(e._searchMarker,t.index,l.getLength()),u=new ut(Re(o,xt(s.store,o)),c,c&&c.lastId,u,u&&u.id,e,null,l),u.integrate(n,0),t.right=u,t.index=f,t.forward(),_b(n,e,t,a)},ip=(n,e,t,r,i)=>{const s=n.doc,o=s.clientID;bb(t,i);const a=vb(n,e,t,i);e:for(;t.right!==null&&(r>0||a.size>0&&(t.right.deleted||t.right.content.constructor===Je));){if(!t.right.deleted)switch(t.right.content.constructor){case Je:{const{key:l,value:c}=t.right.content,u=i[l];if(u!==void 0){if(er(u,c))a.delete(l);else{if(r===0)break e;a.set(l,c)}t.right.delete(n)}else t.currentAttributes.set(l,c);break}default:r<t.right.length&&cr(n,Re(t.right.id.client,t.right.id.clock+r)),r-=t.right.length;break}t.forward()}if(r>0){let l="";for(;r>0;r--)l+=`
`;t.right=new ut(Re(o,xt(s.store,o)),t.left,t.left&&t.left.lastId,t.right,t.right&&t.right.id,e,null,new qn(l)),t.right.integrate(n,0),t.forward()}_b(n,e,t,a)},kb=(n,e,t,r,i)=>{let s=e;const o=mn();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===Je){const c=s.content;o.set(c.key,c)}s=s.right}let a=0,l=!1;for(;e!==s;){if(t===e&&(l=!0),!e.deleted){const c=e.content;switch(c.constructor){case Je:{const{key:u,value:f}=c,d=r.get(u)??null;(o.get(u)!==c||d===f)&&(e.delete(n),a++,!l&&(i.get(u)??null)===f&&d!==f&&(d===null?i.delete(u):i.set(u,d))),!l&&!e.deleted&&as(i,c);break}}}e=e.right}return a},l1=(n,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const t=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===Je){const r=e.content.key;t.has(r)?e.delete(n):t.add(r)}e=e.left}},c1=n=>{let e=0;return Oe(n.doc,t=>{let r=n._start,i=n._start,s=mn();const o=Wu(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case Je:as(o,i.content);break;default:e+=kb(t,r,i,s,o),s=Wu(o),r=i;break}i=i.right}}),e},u1=n=>{const e=new Set,t=n.doc;for(const[r,i]of n.afterState.entries()){const s=n.beforeState.get(r)||0;i!==s&&ib(n,t.store.clients.get(r),s,i,o=>{!o.deleted&&o.content.constructor===Je&&o.constructor!==Yn&&e.add(o.parent)})}Oe(t,r=>{X_(n,n.deleteSet,i=>{if(i instanceof Yn||!i.parent._hasFormatting||e.has(i.parent))return;const s=i.parent;i.content.constructor===Je?e.add(s):l1(r,i)});for(const i of e)c1(i)})},sp=(n,e,t)=>{const r=t,i=Wu(e.currentAttributes),s=e.right;for(;t>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case _r:case ls:case qn:t<e.right.length&&cr(n,Re(e.right.id.client,e.right.id.clock+t)),t-=e.right.length,e.right.delete(n);break}e.forward()}s&&kb(n,s,e.right,i,e.currentAttributes);const o=(e.left||e.right).parent;return o._searchMarker&&ro(o._searchMarker,e.index,-r+t),e};class d1 extends Rl{constructor(e,t,r){super(e,t),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,t=[];Oe(e,r=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const l={};let c="",u=0,f=0;const d=()=>{if(a!==null){let h=null;switch(a){case"delete":f>0&&(h={delete:f}),f=0;break;case"insert":(typeof c=="object"||c.length>0)&&(h={insert:c},i.size>0&&(h.attributes={},i.forEach((p,m)=>{p!==null&&(h.attributes[m]=p)}))),c="";break;case"retain":u>0&&(h={retain:u},hS(l)||(h.attributes=uS({},l))),u=0;break}h&&t.push(h),a=null}};for(;o!==null;){switch(o.content.constructor){case _r:case ls:this.adds(o)?this.deletes(o)||(d(),a="insert",c=o.content.getContent()[0],d()):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),f+=1):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=1);break;case qn:this.adds(o)?this.deletes(o)||(a!=="insert"&&(d(),a="insert"),c+=o.content.str):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),f+=o.length):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=o.length);break;case Je:{const{key:h,value:p}=o.content;if(this.adds(o)){if(!this.deletes(o)){const m=i.get(h)??null;er(m,p)?p!==null&&o.delete(r):(a==="retain"&&d(),er(p,s.get(h)??null)?delete l[h]:l[h]=p)}}else if(this.deletes(o)){s.set(h,p);const m=i.get(h)??null;er(m,p)||(a==="retain"&&d(),l[h]=m)}else if(!o.deleted){s.set(h,p);const m=l[h];m!==void 0&&(er(m,p)?m!==null&&o.delete(r):(a==="retain"&&d(),p===null?delete l[h]:l[h]=p))}o.deleted||(a==="insert"&&d(),as(i,o.content));break}}o=o.right}for(d();t.length>0;){const h=t[t.length-1];if(h.retain!==void 0&&h.attributes===void 0)t.pop();else break}}),this._delta=t}return this._delta}}class dl extends nt{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??ft(),this._length}_integrate(e,t){super._integrate(e,t);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new dl}clone(){const e=new dl;return e.applyDelta(this.toDelta()),e}_callObserver(e,t){super._callObserver(e,t);const r=new d1(this,e,t);Dl(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){this.doc??ft();let e="",t=this._start;for(;t!==null;)!t.deleted&&t.countable&&t.content.constructor===qn&&(e+=t.content.str),t=t.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:t=!0}={}){this.doc!==null?Oe(this.doc,r=>{const i=new Yu(null,this._start,0,new Map);for(let s=0;s<e.length;s++){const o=e[s];if(o.insert!==void 0){const a=!t&&typeof o.insert=="string"&&s===e.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&nu(r,this,i,a,o.attributes||{})}else o.retain!==void 0?ip(r,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&sp(r,i,o.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,t,r){this.doc??ft();const i=[],s=new Map,o=this.doc;let a="",l=this._start;function c(){if(a.length>0){const f={};let d=!1;s.forEach((p,m)=>{d=!0,f[m]=p});const h={insert:a};d&&(h.attributes=f),i.push(h),a=""}}const u=()=>{for(;l!==null;){if(wi(l,e)||t!==void 0&&wi(l,t))switch(l.content.constructor){case qn:{const f=s.get("ychange");e!==void 0&&!wi(l,e)?(f===void 0||f.user!==l.id.client||f.type!=="removed")&&(c(),s.set("ychange",r?r("removed",l.id):{type:"removed"})):t!==void 0&&!wi(l,t)?(f===void 0||f.user!==l.id.client||f.type!=="added")&&(c(),s.set("ychange",r?r("added",l.id):{type:"added"})):f!==void 0&&(c(),s.delete("ychange")),a+=l.content.str;break}case _r:case ls:{c();const f={insert:l.content.getContent()[0]};if(s.size>0){const d={};f.attributes=d,s.forEach((h,p)=>{d[p]=h})}i.push(f);break}case Je:wi(l,e)&&(c(),as(s,l.content));break}l=l.right}c()};return e||t?Oe(o,f=>{e&&Vu(f,e),t&&Vu(f,t),u()},"cleanup"):u(),i}insert(e,t,r){if(t.length<=0)return;const i=this.doc;i!==null?Oe(i,s=>{const o=fa(s,this,e,!r);r||(r={},o.currentAttributes.forEach((a,l)=>{r[l]=a})),nu(s,this,o,t,r)}):this._pending.push(()=>this.insert(e,t,r))}insertEmbed(e,t,r){const i=this.doc;i!==null?Oe(i,s=>{const o=fa(s,this,e,!r);nu(s,this,o,t,r||{})}):this._pending.push(()=>this.insertEmbed(e,t,r||{}))}delete(e,t){if(t===0)return;const r=this.doc;r!==null?Oe(r,i=>{sp(i,fa(i,this,e,!0),t)}):this._pending.push(()=>this.delete(e,t))}format(e,t,r){if(t===0)return;const i=this.doc;i!==null?Oe(i,s=>{const o=fa(s,this,e,!1);o.right!==null&&ip(s,this,o,t,r)}):this._pending.push(()=>this.format(e,t,r))}removeAttribute(e){this.doc!==null?Oe(this.doc,t=>{ul(t,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,t){this.doc!==null?Oe(this.doc,r=>{df(r,this,e,t)}):this._pending.push(()=>this.setAttribute(e,t))}getAttribute(e){return ff(this,e)}getAttributes(){return pb(this)}_write(e){e.writeTypeRef(_1)}}class ru{constructor(e,t=()=>!0){this._filter=t,this._root=e,this._currentNode=e._start,this._firstCall=!0,e.doc??ft()}[Symbol.iterator](){return this}next(){let e=this._currentNode,t=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(t)))do if(t=e.content.type,!e.deleted&&(t.constructor===so||t.constructor===Hi)&&t._start!==null)e=t._start;else for(;e!==null;){const r=e.next;if(r!==null){e=r;break}else e.parent===this._root?e=null:e=e.parent._item}while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class Hi extends nt{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Hi}clone(){const e=new Hi;return e.insert(0,this.toArray().map(t=>t instanceof nt?t.clone():t)),e}get length(){return this.doc??ft(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new ru(this,e)}querySelector(e){e=e.toUpperCase();const r=new ru(this,i=>i.nodeName&&i.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),zi(new ru(this,t=>t.nodeName&&t.nodeName.toUpperCase()===e))}_callObserver(e,t){Dl(this,e,new f1(this,t,e))}toString(){return ub(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,t={},r){const i=e.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),io(this,s=>{i.insertBefore(s.toDOM(e,t,r),null)}),i}insert(e,t){this.doc!==null?Oe(this.doc,r=>{hb(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}insertAfter(e,t){if(this.doc!==null)Oe(this.doc,r=>{const i=e&&e instanceof nt?e._item:e;cl(r,this,i,t)});else{const r=this._prelimContent,i=e===null?0:r.findIndex(s=>s===e)+1;if(i===0&&e!==null)throw Wi("Reference item not found");r.splice(i,0,...t)}}delete(e,t=1){this.doc!==null?Oe(this.doc,r=>{gb(r,this,e,t)}):this._prelimContent.splice(e,t)}toArray(){return cb(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return db(this,e)}slice(e=0,t=this.length){return lb(this,e,t)}forEach(e){io(this,e)}_write(e){e.writeTypeRef(v1)}}class so extends Hi{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,t){super._integrate(e,t),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new so(this.nodeName)}clone(){const e=new so(this.nodeName),t=this.getAttributes();return fS(t,(r,i)=>{typeof r=="string"&&e.setAttribute(i,r)}),e.insert(0,this.toArray().map(r=>r instanceof nt?r.clone():r)),e}toString(){const e=this.getAttributes(),t=[],r=[];for(const a in e)r.push(a);r.sort();const i=r.length;for(let a=0;a<i;a++){const l=r[a];t.push(l+'="'+e[l]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=t.length>0?" "+t.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(e){this.doc!==null?Oe(this.doc,t=>{ul(t,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,t){this.doc!==null?Oe(this.doc,r=>{df(r,this,e,t)}):this._prelimAttrs.set(e,t)}getAttribute(e){return ff(this,e)}hasAttribute(e){return mb(this,e)}getAttributes(e){return e?o1(this,e):pb(this)}toDOM(e=document,t={},r){const i=e.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return io(this,o=>{i.appendChild(o.toDOM(e,t,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(e){e.writeTypeRef(b1),e.writeKey(this.nodeName)}}class f1 extends Rl{constructor(e,t,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,t.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class xb{constructor(e,t){this.id=e,this.length=t}get deleted(){throw yn()}mergeWith(e){return!1}write(e,t,r){throw yn()}integrate(e,t){throw yn()}}const h1=0;class Yn extends xb{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){t>0&&(this.id.clock+=t,this.length-=t),rb(e.doc.store,this)}write(e,t){e.writeInfo(h1),e.writeLen(this.length-t)}getMissing(e,t){return null}}class jl{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new jl(this.content)}splice(e){throw yn()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeBuf(this.content)}getRef(){return 3}}class fl{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new fl(this.len)}splice(e){const t=new fl(this.len-e);return this.len=e,t}mergeWith(e){return this.len+=e.len,!0}integrate(e,t){eb(e.deleteSet,t.id.client,t.id.clock,this.len),t.markDeleted()}delete(e){}gc(e){}write(e,t){e.writeLen(this.len-t)}getRef(){return 1}}const g1=(n,e)=>new wo({guid:n,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class Fl{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const t={};this.opts=t,e.gc||(t.gc=!1),e.autoLoad&&(t.autoLoad=!0),e.meta!==null&&(t.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Fl(g1(this.doc.guid,this.opts))}splice(e){throw yn()}mergeWith(e){return!1}integrate(e,t){this.doc._item=t,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,t){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}class ls{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new ls(this.embed)}splice(e){throw yn()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeJSON(this.embed)}getRef(){return 5}}class Je{constructor(e,t){this.key=e,this.value=t}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Je(this.key,this.value)}splice(e){throw yn()}mergeWith(e){return!1}integrate(e,t){const r=t.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,t){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const p1=ll("node_env")==="development";class Ji{constructor(e){this.arr=e,p1&&U_(e)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Ji(this.arr)}splice(e){const t=new Ji(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){const r=this.arr.length;e.writeLen(r-t);for(let i=t;i<r;i++){const s=this.arr[i];e.writeAny(s)}}getRef(){return 8}}class qn{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new qn(this.str)}splice(e){const t=new qn(this.str.slice(e));this.str=this.str.slice(0,e);const r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"�",t.str="�"+t.str.slice(1)),t}mergeWith(e){return this.str+=e.str,!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeString(t===0?this.str:this.str.slice(t))}getRef(){return 4}}const m1=0,y1=1,_1=2,b1=3,v1=4;class _r{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new _r(this.type._copy())}splice(e){throw yn()}mergeWith(e){return!1}integrate(e,t){this.type._integrate(e.doc,t)}delete(e){let t=this.type._start;for(;t!==null;)t.deleted?t.id.clock<(e.beforeState.get(t.id.client)||0)&&e._mergeStructs.push(t):t.delete(e),t=t.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let t=this.type._start;for(;t!==null;)t.gc(e,!0),t=t.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,t){this.type._write(e)}getRef(){return 7}}const Cb=(n,e,t)=>{const{client:r,clock:i}=e.id,s=new ut(Re(r,i+t),e,Re(r,i+t-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(t));return e.deleted&&s.markDeleted(),e.keep&&(s.keep=!0),e.redone!==null&&(s.redone=Re(e.redone.client,e.redone.clock+t)),e.right=s,s.right!==null&&(s.right.left=s),n._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),e.length=t,s};class ut extends xb{constructor(e,t,r,i,s,o,a,l){super(e,l.getLength()),this.origin=r,this.left=t,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=l,this.info=this.content.isCountable()?qg:0}set marker(e){(this.info&Xc)>0!==e&&(this.info^=Xc)}get marker(){return(this.info&Xc)>0}get keep(){return(this.info&Fg)>0}set keep(e){this.keep!==e&&(this.info^=Fg)}get countable(){return(this.info&qg)>0}get deleted(){return(this.info&Yc)>0}set deleted(e){this.deleted!==e&&(this.info^=Yc)}markDeleted(){this.info|=Yc}getMissing(e,t){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=xt(t,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=xt(t,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Ra&&this.id.client!==this.parent.client&&this.parent.clock>=xt(t,this.parent.client))return this.parent.client;if(this.origin&&(this.left=Zg(e,t,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=cr(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===Yn||this.right&&this.right.constructor===Yn)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===ut?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===ut&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Ra){const r=tu(t,this.parent);r.constructor===Yn?this.parent=null:this.parent=r.content.type}return null}integrate(e,t){if(t>0&&(this.id.clock+=t,this.left=Zg(e,e.doc.store,Re(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(t),this.length-=t),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),ua(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(ua(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(tu(e.doc.store,i.origin)))s.has(tu(e.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),rb(e.doc.store,this),this.content.integrate(e,this),tp(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new Yn(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:Re(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&ua(e.origin,this.lastId)&&this.right===e&&ua(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const t=this.parent._searchMarker;return t&&t.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const t=this.parent;this.countable&&this.parentSub===null&&(t._length-=this.length),this.markDeleted(),eb(e.deleteSet,this.id.client,this.id.clock,this.length),tp(e,t,this.parentSub),this.content.delete(e)}}gc(e,t){if(!this.deleted)throw Hr();this.content.gc(e),t?YS(e,this,new Yn(this.id,this.length)):this.content=new fl(this.length)}write(e,t){const r=t>0?Re(this.id.client,this.id.clock+t-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&j0|(r===null?0:al)|(i===null?0:F_)|(s===null?0:D0);if(e.writeInfo(o),r!==null&&e.writeLeftID(r),i!==null&&e.writeRightID(i),r===null&&i===null){const a=this.parent;if(a._item!==void 0){const l=a._item;if(l===null){const c=JS(a);e.writeParentInfo(!0),e.writeString(c)}else e.writeParentInfo(!1),e.writeLeftID(l.id)}else a.constructor===String?(e.writeParentInfo(!0),e.writeString(a)):a.constructor===Ra?(e.writeParentInfo(!1),e.writeLeftID(a)):Hr();s!==null&&e.writeString(s)}this.content.write(e,t)}}const wb=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},Sb="__ $YJS$ __";wb[Sb]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");wb[Sb]=!0;const k1=ie("TOGGLE_CONNECT_COMMAND");var x1=Object.defineProperty,C1=(n,e,t)=>e in n?x1(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Z=(n,e,t)=>C1(n,typeof e!="symbol"?e+"":e,t);const iu=n=>Ae(by(n)),Jr=Rm("cid",{parse:n=>typeof n=="string"?n:void 0}),Vr=Rm("segment",{parse:n=>typeof n=="string"?n:void 0}),Xu="unknown",Tb=1;class oi extends ht{constructor(e="",t="",r,i){super(i),Z(this,"__tag"),Z(this,"__marker"),Z(this,"__unknownAttributes"),this.__tag=e,this.__marker=t,this.__unknownAttributes=r}static getType(){return"unknown"}static clone(e){const{__tag:t,__marker:r,__unknownAttributes:i,__key:s}=e;return new oi(t,r,i,s)}static importDOM(){return{[Xu]:e=>S1(e)?{conversion:w1,priority:1}:null}}static importJSON(e){return Eb().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setTag(e.tag).setMarker(e.marker).setUnknownAttributes(e.unknownAttributes)}setTag(e){if(this.__tag===e)return this;const t=this.getWritable();return t.__tag=e,t}getTag(){return this.getLatest().__tag}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement(Xu);return e.style.display="none",e}updateDOM(){return!1}exportDOM(){return{element:null}}exportJSON(){return{...super.exportJSON(),type:this.getType(),tag:this.getTag(),marker:this.getMarker(),unknownAttributes:this.getUnknownAttributes(),version:Tb}}canBeEmpty(){return!0}isInline(){return!0}extractWithChild(){return!1}excludeFromCopy(e){return e!=="clone"}}function w1(n){const e=n.getAttribute("data-tag")??"",t=n.getAttribute("data-marker")??"";return{node:Eb(e,t)}}function Eb(n,e,t){return Ae(new oi(n,e,t))}function S1(n){return(n==null?void 0:n.tagName)===Xu}function So(n){return n instanceof oi}const ql="id",Nb=1;class Ft extends ht{constructor(e="",t,r){super(r),Z(this,"__marker",ql),Z(this,"__code"),Z(this,"__unknownAttributes"),this.__code=e,this.__unknownAttributes=t}static getType(){return"book"}static clone(e){const{__code:t,__unknownAttributes:r,__key:i}=e;return new Ft(t,r,i)}static importJSON(e){const{code:t}=e;return Mb(t).updateFromJSON(e)}static isValidBookCode(e){return Dv(e)}updateFromJSON(e){return super.updateFromJSON(e).setCode(e.code).setUnknownAttributes(e.unknownAttributes)}getMarker(){return this.getLatest().__marker}setCode(e){if(this.__code===e)return this;const t=this.getWritable();return t.__code=e,t}getCode(){return this.getLatest().__code}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("p");return e.setAttribute("data-marker",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`),e.setAttribute("data-code",this.__code),e}updateDOM(){return!1}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),code:this.getCode(),unknownAttributes:this.getUnknownAttributes(),version:Nb}}}function Mb(n,e){return Ae(new Ft(n,e))}function _n(n){return n instanceof Ft}function T1(n){return(n==null?void 0:n.type)===Ft.getType()}const Ne=" ",Qu="​",hf=`${Ne}|`,gf="p",Gr="+",pf="-",hl="chapter",Zu="verse",op="invalid",E1="text-spacing",N1="formatted-font",M1="marker-",mf="external-usj-mutation",Ab="selection-change",ed="cursor-change",td="annotation-change",nd="delta-change",A1=[mf,Ab,ed,td,nd],yf="c",Ob=1;class nn extends ht{constructor(e="",t,r,i,s,o){super(o),Z(this,"__marker"),Z(this,"__number"),Z(this,"__sid"),Z(this,"__altnumber"),Z(this,"__pubnumber"),Z(this,"__unknownAttributes"),this.__marker=yf,this.__number=e,this.__sid=t,this.__altnumber=r,this.__pubnumber=i,this.__unknownAttributes=s}static getType(){return"chapter"}static clone(e){const{__number:t,__sid:r,__altnumber:i,__pubnumber:s,__unknownAttributes:o,__key:a}=e;return new nn(t,r,i,s,o,a)}static importJSON(e){return $b().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setNumber(e.number).setSid(e.sid).setAltnumber(e.altnumber).setPubnumber(e.pubnumber).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}setNumber(e){if(this.__number===e)return this;const t=this.getWritable();return t.__number=e,t}getNumber(){return this.getLatest().__number}setSid(e){if(this.__sid===e)return this;const t=this.getWritable();return t.__sid=e,t}getSid(){return this.getLatest().__sid}setAltnumber(e){if(this.__altnumber===e)return this;const t=this.getWritable();return t.__altnumber=e,t}getAltnumber(){return this.getLatest().__altnumber}setPubnumber(e){if(this.__pubnumber===e)return this;const t=this.getWritable();return t.__pubnumber=e,t}getPubnumber(){return this.getLatest().__pubnumber}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("p");return e.setAttribute("data-marker",this.__marker),e.classList.add(hl,`usfm_${this.__marker}`),e.setAttribute("data-number",this.__number),e}updateDOM(){return!1}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),number:this.getNumber(),sid:this.getSid(),altnumber:this.getAltnumber(),pubnumber:this.getPubnumber(),unknownAttributes:this.getUnknownAttributes(),version:Ob}}}function $b(n,e,t,r,i){return Ae(new nn(n,e,t,r,i))}function _f(n){return n instanceof nn}function O1(n){return(n==null?void 0:n.type)===nn.getType()}const Ib=["fr","fq","fqa","fk","ft","fl","fw","fp","fv","fdc","fm"],Pb=["xo","xop","xk","xq","xt","xta","xot","xnt","xdc"],$1=["ca","cp","va","vp","add","bk","dc","em","jmp","k","nd","ord","pn","png","qt","rb","rq","sig","sls","tl","w","wa","wg","wh","wj","bd","it","bdit","no","sc","sup","ior","iqt","qac","qs","litl","lik","liv","liv1","liv2","liv3","liv4","liv5",...Ib,...Pb],Rb=1;class Pe extends ht{constructor(e="",t,r){super(r),Z(this,"__marker"),Z(this,"__unknownAttributes"),this.__marker=e,this.__unknownAttributes=t}static getType(){return"char"}static clone(e){const{__marker:t,__unknownAttributes:r,__key:i}=e;return new Pe(t,r,i)}static isValidMarker(e){return e!==void 0&&$1.includes(e)}static isValidFootnoteMarker(e){return e!==void 0&&Ib.includes(e)}static isValidCrossReferenceMarker(e){return e!==void 0&&Pb.includes(e)}static importDOM(){return{span:e=>P1(e)?{conversion:I1,priority:1}:null}}static importJSON(e){return hn().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("span");return e.setAttribute("data-marker",this.__marker),e.setAttribute("title",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`),e}updateDOM(){return!1}exportDOM(e){const{element:t}=super.exportDOM(e);return t&&Te(t)&&(t.setAttribute("data-marker",this.getMarker()),t.classList.add(this.getType(),`usfm_${this.getMarker()}`)),{element:t}}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),unknownAttributes:this.getUnknownAttributes(),version:Rb}}insertNewAfter(e,t){const r=hn(this.getMarker());return r.setTextFormat(e.format),r.setTextStyle(e.style),r.setDirection(this.getDirection()),r.setFormat(this.getFormatType()),r.setStyle(this.getTextStyle()),this.insertAfter(r,t),r}canBeEmpty(){return!1}isInline(){return!0}}function I1(n){const e=n.getAttribute("data-marker")??"f";return{node:hn(e)}}function hn(n,e){return Ae(new Pe(n,e))}function P1(n){if(!n)return!1;const e=n.getAttribute("data-marker")??"";return Pe.isValidMarker(e)&&n.classList.contains(Pe.getType())}function Me(n){return n instanceof Pe}function R1(n){return(n==null?void 0:n.type)===Pe.getType()}const Lb=1,L1="c",Db="span";class Wn extends pr{constructor(e="",t=!1,r,i,s,o,a){super(a),Z(this,"__marker"),Z(this,"__number"),Z(this,"__showMarker"),Z(this,"__sid"),Z(this,"__altnumber"),Z(this,"__pubnumber"),Z(this,"__unknownAttributes"),this.__marker=L1,this.__number=e,this.__showMarker=t,this.__sid=r,this.__altnumber=i,this.__pubnumber=s,this.__unknownAttributes=o}static getType(){return"immutable-chapter"}static clone(e){const{__number:t,__showMarker:r,__sid:i,__altnumber:s,__pubnumber:o,__unknownAttributes:a,__key:l}=e;return new Wn(t,r,i,s,o,a,l)}static importDOM(){return{span:e=>jb(e)?{conversion:D1,priority:1}:null}}static importJSON(e){return bf().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setNumber(e.number).setShowMarker(e.showMarker).setSid(e.sid).setAltnumber(e.altnumber).setPubnumber(e.pubnumber).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}setNumber(e){if(this.__number===e)return this;const t=this.getWritable();return t.__number=e,t}getNumber(){return this.getLatest().__number}setShowMarker(e=!1){if(this.__showMarker===e)return this;const t=this.getWritable();return t.__showMarker=e,t}getShowMarker(){return this.getLatest().__showMarker}setSid(e){if(this.__sid===e)return this;const t=this.getWritable();return t.__sid=e,t}getSid(){return this.getLatest().__sid}setAltnumber(e){if(this.__altnumber===e)return this;const t=this.getWritable();return t.__altnumber=e,t}getAltnumber(){return this.getLatest().__altnumber}setPubnumber(e){if(this.__pubnumber===e)return this;const t=this.getWritable();return t.__pubnumber=e,t}getPubnumber(){return this.getLatest().__pubnumber}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement(Db);return e.setAttribute("data-marker",this.__marker),e.classList.add(hl,`usfm_${this.__marker}`),this.__showMarker&&e.classList.add("marker"),e.setAttribute("data-number",this.__number),e}updateDOM(){return!1}exportDOM(e){const{element:t}=super.exportDOM(e);return t&&Te(t)&&(t.setAttribute("data-marker",this.getMarker()),t.classList.add(hl,`usfm_${this.getMarker()}`),t.setAttribute("data-number",this.getNumber())),{element:t}}decorate(){return this.getShowMarker()?Eo(this.getMarker(),this.getNumber()):this.getNumber()}exportJSON(){return{type:this.getType(),marker:this.getMarker(),number:this.getNumber(),showMarker:this.getShowMarker(),sid:this.getSid(),altnumber:this.getAltnumber(),pubnumber:this.getPubnumber(),unknownAttributes:this.getUnknownAttributes(),version:Lb}}isInline(){return!1}isKeyboardSelectable(){return!1}}function D1(n){const e=n.getAttribute("data-number")??"0";return{node:bf(e)}}function bf(n,e,t,r,i,s){return Ae(new Wn(n,e,t,r,i,s))}function jb(n){return n?n.classList.contains(hl)&&n.tagName.toLowerCase()===Db:!1}function To(n){return n instanceof Wn}function j1(n){return(n==null?void 0:n.type)===Wn.getType()}const Fb=1;class ur extends mr{static getType(){return"implied-para"}static clone(e){return new ur(e.__key)}static importJSON(e){return Vt().updateFromJSON(e)}getMarker(){return gf}exportJSON(){return{...super.exportJSON(),type:this.getType(),version:Fb}}insertNewAfter(e,t){const r=Vt();return r.setTextFormat(e.format),r.setTextStyle(e.style),r.setDirection(this.getDirection()),r.setFormat(this.getFormatType()),r.setStyle(this.getTextStyle()),this.insertAfter(r,t),r}}function Vt(){return Ae(new ur)}function Bn(n){return n instanceof ur}function vf(n){return(n==null?void 0:n.type)===ur.getType()}const Yr="zmsc-s",$i="zmsc-e",F1=[Yr,$i],q1=["ts-s","ts-e","t-s","t-e","ts","qt1-s","qt1-e","qt2-s","qt2-e","qt3-s","qt3-e","qt4-s","qt4-e","qt5-s","qt5-e","qt-s","qt-e",Yr,$i],qb=1;class bn extends pr{constructor(e="",t,r,i,s){super(s),Z(this,"__marker"),Z(this,"__sid"),Z(this,"__eid"),Z(this,"__unknownAttributes"),this.__marker=e,this.__sid=t,this.__eid=r,this.__unknownAttributes=i}static getType(){return"ms"}static clone(e){const{__marker:t,__sid:r,__eid:i,__unknownAttributes:s,__key:o}=e;return new bn(t,r,i,s,o)}static importJSON(e){return Bb().updateFromJSON(e)}static isValidMarker(e){return e!==void 0&&(q1.includes(e)||e.startsWith("z"))}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setSid(e.sid).setEid(e.eid).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}setSid(e){if(this.__sid===e)return this;const t=this.getWritable();return t.__sid=e,t}getSid(){return this.getLatest().__sid}setEid(e){if(this.__eid===e)return this;const t=this.getWritable();return t.__eid=e,t}getEid(){return this.getLatest().__eid}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("span");return e.setAttribute("data-marker",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`),e}updateDOM(){return!1}decorate(){return""}exportJSON(){return{type:this.getType(),marker:this.getMarker(),sid:this.getSid(),eid:this.getEid(),unknownAttributes:this.getUnknownAttributes(),version:qb}}isKeyboardSelectable(){return!1}}function B1(n){return F1.includes(n)}function Bb(n,e,t,r){return Ae(new bn(n,e,t,r))}function Bl(n){return n instanceof bn}const Ub="f",U1=[Ub,"fe","ef","efe","x","ex"],zb=1;class Ve extends ht{constructor(e=Ub,t,r=!0,i,s,o){super(o),Z(this,"__marker"),Z(this,"__caller"),Z(this,"__isCollapsed"),Z(this,"__category"),Z(this,"__unknownAttributes"),this.__marker=e,this.__caller=t??(e==="x"||e==="ex"?pf:Gr),this.__isCollapsed=r,this.__category=i,this.__unknownAttributes=s}static getType(){return"note"}static clone(e){const{__marker:t,__caller:r,__isCollapsed:i,__category:s,__unknownAttributes:o,__key:a}=e;return new Ve(t,r,i,s,o,a)}static importDOM(){return{span:e=>W1(e)?{conversion:z1,priority:1}:null}}static importJSON(e){return kf().updateFromJSON(e)}static isValidMarker(e){return e!==void 0&&U1.includes(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setCaller(e.caller).setIsCollapsed(e.isCollapsed).setCategory(e.category).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}setCaller(e){if(this.__caller===e)return this;const t=this.getWritable();return t.__caller=e,t}getCaller(){return this.getLatest().__caller}setIsCollapsed(e){if(this.__isCollapsed===e)return this;const t=this.getWritable();return t.__isCollapsed=e,t}toggleIsCollapsed(){const e=this.getWritable();return e.__isCollapsed=!e.__isCollapsed,e}getIsCollapsed(){return this.getLatest().__isCollapsed}setCategory(e){if(this.__category===e)return this;const t=this.getWritable();return t.__category=e,t}getCategory(){return this.getLatest().__category}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("span");return e.setAttribute("data-marker",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`,this.__isCollapsed?"collapsed":"expanded"),e.setAttribute("data-caller",this.__caller),e}updateDOM(e){return e.__isCollapsed!==this.__isCollapsed}exportDOM(e){const{element:t}=super.exportDOM(e);return t&&Te(t)&&(t.setAttribute("data-marker",this.getMarker()),t.classList.add(this.getType(),`usfm_${this.getMarker()}`,this.getIsCollapsed()?"collapsed":"expanded"),t.setAttribute("data-caller",this.getCaller())),{element:t}}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),caller:this.getCaller(),isCollapsed:this.getIsCollapsed(),category:this.getCategory(),unknownAttributes:this.getUnknownAttributes(),version:zb}}canBeEmpty(){return!1}isInline(){return!0}}function z1(n){const e=n.getAttribute("data-marker")??"f",t=n.getAttribute("data-caller")??"",r=n.classList.contains("collapsed");return{node:kf(e,t,r)}}function kf(n,e,t,r,i){return Ae(new Ve(n,e,t,r,i))}function W1(n){if(!n)return!1;const e=n.getAttribute("data-marker")??"";return Ve.isValidMarker(e)&&n.classList.contains(Ve.getType())}function pe(n){return n instanceof Ve}const K1=["ide","sts","rem","h","toc1","toc2","toc3","toca1","toca2","toca3","imt","imt1","imt2","imt3","imt4","is","is1","is2","ip","ipi","im","imi","ipq","imq","ipr","iq","iq1","iq2","iq3","ili","ili1","ili2","ib","iot","io","io1","io2","io3","io4","iex","imte","imte1","imte2","ie","mt","mt1","mt2","mt3","mt4","mte","mte1","mte2","cl","cd","ms","ms1","ms2","ms3","mr","s","s1","s2","s3","s4","sr","r","d","sp","sd","sd1","sd2","sd3","sd4",gf,"m","po","cls","pr","pc","pm","pmo","pmc","pmr","pi","pi1","pi2","pi3","mi","lit","nb","q","q1","q2","q3","q4","qr","qc","qa","qm","qm1","qm2","qm3","qd","b","lh","li","li1","li2","li3","li4","lf","lim","lim1","lim2","lim3","lim4","pb"],Wb=1;class St extends mr{constructor(e=gf,t,r){super(r),Z(this,"__marker"),Z(this,"__unknownAttributes"),this.__marker=e,this.__unknownAttributes=t}static getType(){return"para"}static clone(e){const{__marker:t,__unknownAttributes:r,__key:i}=e;return new St(t,r,i)}static isValidMarker(e){return e!==void 0&&K1.includes(e)}static importDOM(){return{p:()=>({conversion:H1,priority:1})}}static importJSON(e){return oo().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("p");return e.setAttribute("data-marker",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`),e}exportDOM(e){const{element:t}=super.exportDOM(e);return t&&Te(t)&&(t.setAttribute("data-marker",this.getMarker()),t.classList.add(this.getType(),`usfm_${this.getMarker()}`)),{element:t}}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),unknownAttributes:this.getUnknownAttributes(),version:Wb}}insertNewAfter(e,t){const r=oo(this.getMarker());return r.setTextFormat(e.format),r.setTextStyle(e.style),r.setDirection(this.getDirection()),r.setFormat(this.getFormatType()),r.setStyle(this.getTextStyle()),this.insertAfter(r,t),r}}function H1(n){const e=n.getAttribute("data-marker")??void 0,t=oo(e);if(n.style){t.setFormat(n.style.textAlign);const r=parseInt(n.style.textIndent,10)/20;r>0&&t.setIndent(r)}return{node:t}}function oo(n,e){return Ae(new St(n,e))}function dt(n){return n instanceof St}function J1(n){return(n==null?void 0:n.type)===St.getType()}const xf="v",Kb=1;class _t extends At{constructor(e="",t,r,i,s,o,a){super(t??e,a),Z(this,"__marker"),Z(this,"__number"),Z(this,"__sid"),Z(this,"__altnumber"),Z(this,"__pubnumber"),Z(this,"__unknownAttributes"),this.__marker=xf,this.__number=e,this.__sid=r,this.__altnumber=i,this.__pubnumber=s,this.__unknownAttributes=o}static getType(){return"verse"}static clone(e){const{__number:t,__text:r,__sid:i,__altnumber:s,__pubnumber:o,__unknownAttributes:a,__key:l}=e;return new _t(t,r,i,s,o,a,l)}static importJSON(e){return Hb().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setNumber(e.number).setSid(e.sid).setAltnumber(e.altnumber).setPubnumber(e.pubnumber).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}setNumber(e){if(this.__number===e)return this;const t=this.getWritable();return t.__number=e,t}getNumber(){return this.getLatest().__number}setSid(e){if(this.__sid===e)return this;const t=this.getWritable();return t.__sid=e,t}getSid(){return this.getLatest().__sid}setAltnumber(e){if(this.__altnumber===e)return this;const t=this.getWritable();return t.__altnumber=e,t}getAltnumber(){return this.getLatest().__altnumber}setPubnumber(e){if(this.__pubnumber===e)return this;const t=this.getWritable();return t.__pubnumber=e,t}getPubnumber(){return this.getLatest().__pubnumber}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(e){const t=super.createDOM(e);return t.setAttribute("data-marker",this.__marker),t.classList.add(Zu,`usfm_${this.__marker}`),t.setAttribute("data-number",this.__number),t}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),number:this.getNumber(),sid:this.getSid(),altnumber:this.getAltnumber(),pubnumber:this.getPubnumber(),unknownAttributes:this.getUnknownAttributes(),version:Kb}}}function Hb(n,e,t,r,i,s){return Ae(new _t(n,e,t,r,i,s))}function Cf(n){return n instanceof _t}function V1(n){return(n==null?void 0:n.type)===_t.getType()}function G1(n){return O1(n)||j1(n)}function Lt(n){return _f(n)||To(n)}function Y1(n,e){return n.find(t=>Lt(t)&&t.getNumber()===e.toString())}function X1(n,e=!1){return n.find((t,r)=>(!e||r>0)&&Lt(t))}function wf(n){var e;if(!n)return;if(Lt(n))return n;let t=(e=n.getTopLevelElement())==null?void 0:e.getPreviousSibling();for(;t&&!Lt(t);)t=t.getPreviousSibling();if(t&&Lt(t))return t}function Jb(n){let e=n;for(;e!==null;){if(pe(e))return e;e=e.getParent()}}function Q1(n){return _n(n)||_f(n)||Me(n)||To(n)||Bn(n)||Bl(n)||dt(n)||pe(n)||Cf(n)||So(n)}function Z1(n){var e;if(n.anchor.type==="element"){const r=n.anchor.getNode(),i=n.anchor.offset;if(i<r.getChildrenSize())return r.getChildAtIndex(i)}const t=n.anchor.getNode();return t.getNextSibling()??((e=t.getParent())==null?void 0:e.getNextSibling())??null}function eT(n){var e;const t=n.anchor.offset;if(n.anchor.type==="element"&&t>0)return n.anchor.getNode().getChildAtIndex(t-1);const r=n.anchor.getNode();return r.getPreviousSibling()??((e=r.getParent())==null?void 0:e.getPreviousSibling())??null}function Kt(n){return dt(n)||Bn(n)}function tT(n,e){let t=n.getParent();for(;t;){if(t.getKey()===e)return!0;t=t.getParent()}return!1}function Xr(n,e){const t=Ri(e,Jr),r=!!(n.cid&&t),i=!n.cid&&!t;return n.style===e.getMarker()&&(i||r&&n.cid===t)}function nT(n,e){const t=F(n)?n:n.getParent(),r=F(e)?e:e.getParent(),i=t&&r?Us(t,r):void 0;return i?i.commonAncestor:void 0}function rT(n){const e=n.getStartEndPoints();if(!e)return;const[t,r]=e,i=n.isBackward()?t:r;n.focus.set(i.key,i.offset,i.type),n.anchor.set(i.key,i.offset,i.type)}function Sf(n){return(n==null?void 0:n.type)===At.getType()}function iT(n,e){if(!e)return;const t=n.findIndex(r=>r===e);t&&(n.length=t)}function sT(n,e){if(!e)return n;const t=e.getIndexWithinParent();return n.splice(t+1,n.length-t-1)}function Kn(n){return`\\${n}`}function Vi(n){return`\\${n}*`}function Vb(n,e,t){const r=Kn(n);if(e!=null&&e.startsWith(r)){const i=parseInt(e.slice(r.length),10);isNaN(i)||(t=i.toString())}return t}function Eo(n,e){let t=Kn(n);return e&&(t+=`${Ne}${e}`),t+=" ",t}function Gb(n){return Sf(n)?n.text:R1(n)?n.children.map(e=>Gb(e)).join(""):""}function oT(n){return n.map(e=>Gb(e)).join(" ").trim()}function Tf(n){return Ne+n+" "}function Ef(n){return n.reduce((e,t)=>e+(Me(t)?` ${t.getTextContent()}`:""),"").trim()}function Ge(n,e=qv){const t={...n};return e.forEach(r=>{Reflect.deleteProperty(t,r)}),Object.keys(t).length===0?void 0:t}function aT(n,e){const t=e.getElementByKey(n.getKey());return t?t.tagName.toLowerCase():void 0}function Ue(n){return Object.fromEntries(Object.entries(n).filter(([,e])=>e!==void 0))}function Yb(n){if(!n)return;const e=n.getNodes();if(e.length>0)return n.isBackward()?e[e.length-1]:e[0]}function rd(n,e){if(!e)return(n+1).toString();const t=e.split("-");if(t.length===2)return parseInt(t[1])?`${parseInt(t[1])+1}`:`${parseInt(t[0])+1}`;const r=RegExp(/^(\d+)([a-yA-Y]{1,3})$/).exec(e);if(!r)return(parseInt(e)+1).toString();const i=String.fromCharCode(r[2].charCodeAt(0)+1);return`${r[1]}${i}`}function Nf(n,e){if(!e)return!1;const t=e.split("-").map(r=>parseInt(r));if(t.length<1||t.length>2||t[0]>t[1])throw new Error("isVerseInRange: invalid range");return t.length===1?n===t[0]:t.length===2&&isNaN(t[1])?n>=t[0]:(t.length===2&&isNaN(t[0])||n>=t[0])&&n<=t[1]}function lT(n){return!!n&&n.includes("-")}const cT=1;class ai extends At{constructor(e="",t="opening",r){super(su(e,t),r),Z(this,"__marker"),Z(this,"__markerSyntax"),this.__marker=e,this.__markerSyntax=t}static getType(){return"marker"}static clone(e){return new ai(e.__marker,e.__markerSyntax,e.__key)}static importJSON(e){return Gi().updateFromJSON(e)}updateFromJSON(e){const{marker:t,markerSyntax:r="opening"}=e;return super.updateFromJSON(e).setMarker(t).setMarkerSyntax(r)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t.__text=su(e,t.__markerSyntax),t}getMarker(){return this.getLatest().__marker}setMarkerSyntax(e){if(this.__markerSyntax===e)return this;const t=this.getWritable();return t.__markerSyntax=e,t.__text=su(t.__marker,e),t}getMarkerSyntax(){return this.getLatest().__markerSyntax}createDOM(e){const t=super.createDOM(e);return t.setAttribute("data-marker",this.__marker),t.classList.add(this.__markerSyntax),t}exportJSON(){return{...super.exportJSON(),type:this.getType(),text:this.getTextContent(),marker:this.getMarker(),markerSyntax:this.getMarkerSyntax(),version:cT}}}function Gi(n,e){return Ae(new ai(n,e))}function No(n){return n instanceof ai}function su(n,e){return e==="closing"?Vi(n):e==="selfClosing"?Vi(""):Kn(n)}const tr="internal-comment",uT=[tr],dT={},fT=1;class tt extends ht{constructor(e=dT,t){super(t),Z(this,"__typedIDs"),this.__typedIDs=e}static getType(){return"typed-mark"}static clone(e){const t=JSON.parse(JSON.stringify(e.__typedIDs));return new tt(t,e.__key)}static isReservedType(e){return uT.includes(e)}static importDOM(){return null}static importJSON(e){return ao().updateFromJSON(e)}exportJSON(){return{...super.exportJSON(),type:this.getType(),typedIDs:this.getTypedIDs(),version:fT}}createDOM(e){const t=document.createElement("mark");for(const[r,i]of Object.entries(this.__typedIDs))ct(t,ha(e.theme.typedMark,r)),i.length>1&&ct(t,ha(e.theme.typedMarkOverlap,r));return t}updateDOM(e,t,r){for(const[i,s]of Object.entries(this.__typedIDs)){const o=e.__typedIDs[i].length,a=s.length,l=ha(r.theme.typedMark,i),c=ha(r.theme.typedMarkOverlap,i);o!==a&&(o===0?a===1&&ct(t,l):a===0&&Dr(t,l),o===1?a===2&&ct(t,c):a===1&&Dr(t,c))}return!1}updateFromJSON(e){return super.updateFromJSON(e).setTypedIDs(e.typedIDs)}hasID(e,t){const r=this.getTypedIDs()[e];if(!r)return!1;for(const i of r)if(t===i)return!0;return!1}getTypedIDs(){const e=this.getLatest();return rt(e)?e.__typedIDs:{}}setTypedIDs(e){const t=this.getWritable();return t.__typedIDs=e,t}addID(e,t){const r=this.getWritable();if(!rt(r))return;const i=r.__typedIDs[e]??[];r.__typedIDs[e]=i;for(const s of i)if(t===s)return;i.push(t)}deleteID(e,t){const r=this.getWritable();if(!rt(r))return;const i=r.__typedIDs[e];for(let s=0;s<i.length;s++)if(t===i[s]){i.splice(s,1);return}}hasNoIDsForEveryType(){return Object.values(this.getTypedIDs()).every(e=>e===void 0||e.length===0)}insertNewAfter(e,t=!0){const r=ao(this.__typedIDs);return this.insertAfter(r,t),r}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}canBeEmpty(){return!1}isInline(){return!0}extractWithChild(e,t,r){if(!q(t)||r==="html")return!1;const i=t.anchor,s=t.focus,o=i.getNode(),a=s.getNode(),l=t.isBackward()?i.offset-s.offset:s.offset-i.offset;return this.isParentOf(o)&&this.isParentOf(a)&&this.getTextContent().length===l}excludeFromCopy(e){return e!=="clone"}}function ha(n,e){return`${n}-${e}`}function ao(n){return Ae(new tt(n))}function rt(n){return n instanceof tt}function hT(n){return(n==null?void 0:n.type)===tt.getType()}function Xb(n){const e=n.getChildren();let t=null;for(const r of e)t===null?n.insertBefore(r):t.insertAfter(r),t=r;n.remove()}function Qb(n,e,t,r){const i=n.getNodes(),s=n.anchor.offset,o=n.focus.offset,a=i.length,l=n.isBackward(),c=l?o:s,u=l?s:o;let f,d;for(let h=0;h<a;h++){const p=i[h];if(F(d)&&d.isParentOf(p))continue;const m=h===0,y=h===a-1;let b=null;if(W(p)){const _=p.getTextContentSize(),x=m?c:0,T=y?u:_;if(x===0&&T===0)continue;const P=p.splitText(x,T);b=P.length>1&&(P.length===3||m&&!y||T===_)?P[1]:P[0]}else{if(rt(p))continue;F(p)&&p.isInline()&&(b=p)}if(b!==null){if(b&&b.is(f))continue;const _=b.getParent();(_==null||!_.is(f))&&(d=void 0),f=_,d===void 0&&(d=ao({[e]:[t]}),b.insertBefore(d)),d.append(b)}else f=void 0,d=void 0}e===tr&&F(d)&&(l?d.selectStart():d.selectEnd())}function gT(n,e,t){let r=n;for(;r!==null;){if(rt(r))return r.getTypedIDs()[e];if(W(r)&&t===r.getTextContentSize()){const i=r.getNextSibling();if(rt(i))return i.getTypedIDs()[e]}r=r.getParent()}}function ap(n){return`external-${n}`}const Zb=1;class br extends pr{constructor(e="",t="",r){super(r),Z(this,"__textType"),Z(this,"__text"),this.__textType=e,this.__text=t}static getType(){return"immutable-typed-text"}static clone(e){const{__textType:t,__text:r,__key:i}=e;return new br(t,r,i)}static importDOM(){return{span:e=>mT(e)?{conversion:pT,priority:1}:null}}static importJSON(e){return Yi().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setTextType(e.textType).setTextContent(e.text)}setTextType(e){if(this.__textType===e)return this;const t=this.getWritable();return t.__textType=e,t}getTextType(){return this.getLatest().__textType}setTextContent(e){if(this.__text===e)return this;const t=this.getWritable();return t.__text=e,t}getTextContent(){return this.getLatest().__text}createDOM(){const e=document.createElement("span");return e.setAttribute("data-text-type",this.__textType),e.classList.add(this.__textType),e}updateDOM(){return!1}exportDOM(e){const{element:t}=super.exportDOM(e);return t&&Te(t)&&t.setAttribute("data-text-type",this.getTextType()),{element:t}}decorate(){return this.getTextContent()}exportJSON(){return{type:this.getType(),textType:this.getTextType(),text:this.getTextContent(),version:Zb}}isKeyboardSelectable(){return!1}}function pT(n){const e=n.getAttribute("data-text-type")??"",t=n.textContent??"";return{node:Yi(e,t)}}function Yi(n,e){return Ae(new br(n,e))}function mT(n){return(n==null?void 0:n.tagName)==="span"}function gl(n){return n instanceof br}function yT(n){return(n==null?void 0:n.type)===br.getType()}const pl="unmatched",ev=1;class vr extends pr{constructor(e="",t){super(t),Z(this,"__marker"),this.__marker=e}static getType(){return"unmatched"}static clone(e){const{__marker:t,__key:r}=e;return new vr(t,r)}static importDOM(){return{[pl]:e=>bT(e)?{conversion:_T,priority:1}:null}}static importJSON(e){return Mf().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}createDOM(){const e=document.createElement(pl);e.setAttribute("data-marker",this.__marker),e.classList.add(op);const t=this.__marker.endsWith("*");return e.title=t?"This closing marker has no matching opening marker!":"This opening marker has no matching closing marker!",e}updateDOM(){return!1}exportDOM(e){const{element:t}=super.exportDOM(e);return t&&Te(t)&&(t.setAttribute("data-marker",this.getMarker()),t.classList.add(op)),{element:t}}decorate(){return`\\${this.getMarker()}${Qu}`}exportJSON(){return{type:this.getType(),marker:this.getMarker(),version:ev}}isKeyboardSelectable(){return!1}}function _T(n){const e=n.getAttribute("data-marker")??"";return{node:Mf(e)}}function Mf(n){return Ae(new vr(n))}function bT(n){return(n==null?void 0:n.tagName)===pl}function tv(n){return n instanceof vr}const vT=[Ft,Wn,nn,_t,Pe,Ve,bn,ai,oi,br,vr,St,ur,{replace:mr,with:()=>Vt(),withKlass:ur}];var $;(function(n){n.FileIdentification="FileIdentification",n.Headers="Headers",n.Remarks="Remarks",n.Introduction="Introduction",n.DivisionMarks="DivisionMarks",n.Paragraphs="Paragraphs",n.Poetry="Poetry",n.TitlesHeadings="TitlesHeadings",n.Tables="Tables",n.CenterTables="CenterTables",n.RightTables="RightTables",n.Lists="Lists",n.Footnotes="Footnotes",n.CrossReferences="CrossReferences",n.SpecialText="SpecialText",n.CharacterStyling="CharacterStyling",n.Breaks="Breaks",n.SpecialFeatures="SpecialFeatures",n.PeripheralReferences="PeripheralReferences",n.PeripheralMaterials="PeripheralMaterials",n.Uncategorized="Uncategorized"})($||($={}));var O;(function(n){n.Paragraph="Paragraph",n.Character="Character",n.Note="Note",n.Unknown="Unknown"})(O||(O={}));const kT={id:{category:$.FileIdentification,type:O.Paragraph,description:"File identification information (BOOKID, FILENAME, EDITOR, MODIFICATION DATE)",hasEndMarker:!1,children:{FileIdentification:["usfm","ide"],Headers:["h","h1","h2","h3","toc1","toc2","toc3"],Remarks:["rem","sts","restore"],Introduction:["imt","imt1","imt2","imt3","imt4","imte","imte1","imte2","is","is1","is2","iot","io","io1","io2","io3","io4","ior","ip","im","ipi","imi","ili","ili1","ili2","ipq","imq","ipr","ib","iq","iq1","iq2","iq3","iex","ie"],DivisionMarks:["c","cl"],TitlesHeadings:["mt","mt1","mt2","mt3","mt4"]}},usfm:{category:$.FileIdentification,type:O.Paragraph,description:"File markup version information",hasEndMarker:!1,children:void 0},ide:{category:$.FileIdentification,type:O.Paragraph,description:"File encoding information",hasEndMarker:!1,children:{Remarks:["rem","sts"]}},h:{category:$.Headers,type:O.Paragraph,description:"Running header text for a book (basic)",hasEndMarker:!1,children:{Headers:["toc1","toc2","toc3","toca1","toca2","toca3"]}},h1:{category:$.Headers,type:O.Paragraph,description:"Running header text",hasEndMarker:!1,children:{Headers:["toc1","toc2","toc3","toca1","toca2","toca3"]}},h2:{category:$.Headers,type:O.Paragraph,description:"Running header text, left side of page",hasEndMarker:!1,children:{Headers:["toc1","toc2","toc3","toca1","toca2","toca3"]}},h3:{category:$.Headers,type:O.Paragraph,description:"Running header text, right side of page",hasEndMarker:!1,children:{Headers:["toc1","toc2","toc3","toca1","toca2","toca3"]}},toc1:{category:$.Headers,type:O.Paragraph,description:"Long table of contents text",hasEndMarker:!1,children:void 0},toc2:{category:$.Headers,type:O.Paragraph,description:"Short table of contents text",hasEndMarker:!1,children:void 0},toc3:{category:$.Headers,type:O.Paragraph,description:"Book Abbreviation",hasEndMarker:!1,children:void 0},toca1:{category:$.Headers,type:O.Paragraph,description:"Alternative language long table of contents text",hasEndMarker:!1,children:void 0},toca2:{category:$.Headers,type:O.Paragraph,description:"Alternative language short table of contents text",hasEndMarker:!1,children:void 0},toca3:{category:$.Headers,type:O.Paragraph,description:"Alternative language book Abbreviation",hasEndMarker:!1,children:void 0},rem:{category:$.Remarks,type:O.Paragraph,description:"Comments and remarks",hasEndMarker:!1,children:void 0},sts:{category:$.Remarks,type:O.Paragraph,description:"Status of this file",hasEndMarker:!1,children:void 0},restore:{category:$.Remarks,type:O.Paragraph,description:"Project restore information",hasEndMarker:!1,children:void 0},imt:{category:$.Introduction,type:O.Paragraph,description:"Introduction major title, level 1 (if single level) (basic)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imt1:{category:$.Introduction,type:O.Paragraph,description:"Introduction major title, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imt2:{category:$.Introduction,type:O.Paragraph,description:"Introduction major title, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imt3:{category:$.Introduction,type:O.Paragraph,description:"Introduction major title, level 3",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imt4:{category:$.Introduction,type:O.Paragraph,description:"Introduction major title, level 4 (usually within parenthesis)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imte:{category:$.Introduction,type:O.Paragraph,description:"Introduction major title at introduction end, level 1 (if single level)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imte1:{category:$.Introduction,type:O.Paragraph,description:"Introduction major title at introduction end, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imte2:{category:$.Introduction,type:O.Paragraph,description:"Introduction major title at introduction end, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},is:{category:$.Introduction,type:O.Paragraph,description:"Introduction section heading, level 1 (if single level) (basic)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"],CharacterStyling:["no"]}},is1:{category:$.Introduction,type:O.Paragraph,description:"Introduction section heading, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},is2:{category:$.Introduction,type:O.Paragraph,description:"Introduction section heading, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},iot:{category:$.Introduction,type:O.Paragraph,description:"Introduction outline title (basic)",hasEndMarker:!1,children:{Introduction:["iqt"],CharacterStyling:["no"]}},io:{category:$.Introduction,type:O.Paragraph,description:"Introduction outline text, level 1 (if single level)",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},io1:{category:$.Introduction,type:O.Paragraph,description:"Introduction outline text, level 1 (if multiple levels) (basic)",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},io2:{category:$.Introduction,type:O.Paragraph,description:"Introduction outline text, level 2",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},io3:{category:$.Introduction,type:O.Paragraph,description:"Introduction outline text, level 3",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},io4:{category:$.Introduction,type:O.Paragraph,description:"Introduction outline text, level 4",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ior:{category:$.Introduction,type:O.Character,description:"Introduction references range for outline entry; for marking references separately",hasEndMarker:!0,children:void 0},ip:{category:$.Introduction,type:O.Paragraph,description:"Introduction prose paragraph (basic)",hasEndMarker:!1,children:{Introduction:["iqt"],Footnotes:["f","fe","fm"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},im:{category:$.Introduction,type:O.Paragraph,description:"Introduction prose paragraph, with no first line indent (may occur after poetry)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ipi:{category:$.Introduction,type:O.Paragraph,description:"Introduction prose paragraph, indented, with first line indent",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},imi:{category:$.Introduction,type:O.Paragraph,description:"Introduction prose paragraph text, indented, with no first line indent",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ili:{category:$.Introduction,type:O.Paragraph,description:"A list entry, level 1 (if single level)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ili1:{category:$.Introduction,type:O.Paragraph,description:"A list entry, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ili2:{category:$.Introduction,type:O.Paragraph,description:"A list entry, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ipq:{category:$.Introduction,type:O.Paragraph,description:"Introduction prose paragraph, quote from the body text",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},imq:{category:$.Introduction,type:O.Paragraph,description:"Introduction prose paragraph, quote from the body text, with no first line indent",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ipr:{category:$.Introduction,type:O.Paragraph,description:"Introduction prose paragraph, right aligned",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},ib:{category:$.Introduction,type:O.Paragraph,description:"Introduction blank line",hasEndMarker:!1,children:{Introduction:["iqt"]}},iq:{category:$.Introduction,type:O.Paragraph,description:"Introduction poetry text, level 1 (if single level)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},iq1:{category:$.Introduction,type:O.Paragraph,description:"Introduction poetry text, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},iq2:{category:$.Introduction,type:O.Paragraph,description:"Introduction poetry text, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},iq3:{category:$.Introduction,type:O.Paragraph,description:"Introduction poetry text, level 3",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},iex:{category:$.Introduction,type:O.Paragraph,description:"Introduction explanatory or bridge text (e.g. explanation of missing book in Short Old Testament)",hasEndMarker:!1,children:{Introduction:["iqt"],CharacterStyling:["no"]}},iqt:{category:$.Introduction,type:O.Character,description:"For quoted scripture text appearing in the introduction",hasEndMarker:!0,children:void 0},ie:{category:$.Introduction,type:O.Paragraph,description:"Introduction ending marker",hasEndMarker:!1,children:void 0},c:{category:$.DivisionMarks,type:O.Paragraph,description:"Chapter number",hasEndMarker:!1,children:{DivisionMarks:["ca","cp","cl","cd"],Paragraphs:["p","m","po","pr","cls","pi","pi1","pi2","pi3","pc","mi","nb"],Poetry:["q","q1","q2","q3","q4","qc","qr","qa","qd","b"],TitlesHeadings:["mte","ms","ms1","ms2","ms3","s","s1","s2","s3","s4","r","sp","d","sd","sd1","sd2","sd3","sd4"],Lists:["lh","li","li1","li2","li3","li4","lf","lim","lim1","lim2","lim3","lim4"],Footnotes:["f","fe"],SpecialText:["lit"],Breaks:["pb"]}},ca:{category:$.DivisionMarks,type:O.Character,description:"Second (alternate) chapter number (for coding dual versification; useful for places where different traditions of chapter breaks need to be supported in the same translation)",hasEndMarker:!0,children:void 0},cp:{category:$.DivisionMarks,type:O.Paragraph,description:"Published chapter number (chapter string that should appear in the published text)",hasEndMarker:!1,children:{Footnotes:["f"]}},cl:{category:$.DivisionMarks,type:O.Paragraph,description:"Chapter label used for translations that add a word such as 'Chapter' before chapter numbers (e.g. Psalms). The subsequent text is the chapter label.",hasEndMarker:!1,children:void 0},cd:{category:$.DivisionMarks,type:O.Paragraph,description:"Chapter Description (Publishing option D, e.g. in Russian Bibles)",hasEndMarker:!1,children:{DivisionMarks:["vp"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},v:{category:$.DivisionMarks,type:O.Character,description:"A verse number",hasEndMarker:!1,children:void 0},va:{category:$.DivisionMarks,type:O.Character,description:"Second (alternate) verse number (for coding dual numeration in Psalms; see also NRSV Exo 22.1-4)",hasEndMarker:!0,children:void 0},vp:{category:$.DivisionMarks,type:O.Character,description:"Published verse marker (verse string that should appear in the published text)",hasEndMarker:!0,children:void 0},p:{category:$.Paragraphs,type:O.Paragraph,description:"Paragraph text, with first line indent (basic)",hasEndMarker:!1,children:{Paragraphs:["pmo","pm","pmc","pmr"],Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},m:{category:$.Paragraphs,type:O.Paragraph,description:"Paragraph text, with no first line indent (may occur after poetry) (basic)",hasEndMarker:!1,children:{Paragraphs:["pmo","pm","pmc","pmr"],Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},po:{category:$.Paragraphs,type:O.Paragraph,description:"Letter opening",hasEndMarker:!1,children:{Paragraphs:["pmo","pm","pmc","pmr"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pr:{category:$.Paragraphs,type:O.Paragraph,description:"Text refrain (paragraph text, right aligned)",hasEndMarker:!1,children:{Paragraphs:["pmo","pm","pmc","pmr"],Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},cls:{category:$.Paragraphs,type:O.Paragraph,description:"Letter Closing",hasEndMarker:!1,children:{SpecialText:["tl","sig","pn","png","addpn","add"]}},pmo:{category:$.Paragraphs,type:O.Paragraph,description:"Embedded text opening",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pm:{category:$.Paragraphs,type:O.Paragraph,description:"Embedded text paragraph",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pmc:{category:$.Paragraphs,type:O.Paragraph,description:"Embedded text closing",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pmr:{category:$.Paragraphs,type:O.Paragraph,description:"Embedded text refrain (e.g. Then all the people shall say, 'Amen!')",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pi:{category:$.Paragraphs,type:O.Paragraph,description:"Paragraph text, level 1 indent (if single level), with first line indent; often used for discourse (basic)",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pi1:{category:$.Paragraphs,type:O.Paragraph,description:"Paragraph text, level 1 indent (if multiple levels), with first line indent; often used for discourse",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pi2:{category:$.Paragraphs,type:O.Paragraph,description:"Paragraph text, level 2 indent, with first line indent; often used for discourse",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pi3:{category:$.Paragraphs,type:O.Paragraph,description:"Paragraph text, level 3 indent, with first line indent; often used for discourse",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pc:{category:$.Paragraphs,type:O.Paragraph,description:"Paragraph text, centered (for Inscription)",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},mi:{category:$.Paragraphs,type:O.Paragraph,description:"Paragraph text, indented, with no first line indent; often used for discourse",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},nb:{category:$.Paragraphs,type:O.Paragraph,description:"Paragraph text, with no break from previous paragraph text (at chapter boundary) (basic)",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q:{category:$.Poetry,type:O.Paragraph,description:"Poetry text, level 1 indent (if single level)",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q1:{category:$.Poetry,type:O.Paragraph,description:"Poetry text, level 1 indent (if multiple levels) (basic)",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q2:{category:$.Poetry,type:O.Paragraph,description:"Poetry text, level 2 indent (basic)",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q3:{category:$.Poetry,type:O.Paragraph,description:"Poetry text, level 3 indent",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q4:{category:$.Poetry,type:O.Paragraph,description:"Poetry text, level 4 indent",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qc:{category:$.Poetry,type:O.Paragraph,description:"Poetry text, centered",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qr:{category:$.Poetry,type:O.Paragraph,description:"Poetry text, Right Aligned",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qs:{category:$.Poetry,type:O.Character,description:"Poetry text, Selah",hasEndMarker:!0,children:{Footnotes:["f"],CrossReferences:["x"]}},qa:{category:$.Poetry,type:O.Paragraph,description:"Poetry text, Acrostic marker/heading",hasEndMarker:!1,children:void 0},qac:{category:$.Poetry,type:O.Character,description:"Poetry text, Acrostic markup of the first character of a line of acrostic poetry",hasEndMarker:!0,children:void 0},qm:{category:$.Poetry,type:O.Paragraph,description:"Poetry text, embedded, level 1 indent (if single level)",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qm1:{category:$.Poetry,type:O.Paragraph,description:"Poetry text, embedded, level 1 indent (if multiple levels)",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qm2:{category:$.Poetry,type:O.Paragraph,description:"Poetry text, embedded, level 2 indent",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qm3:{category:$.Poetry,type:O.Paragraph,description:"Poetry text, embedded, level 3 indent",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qd:{category:$.Poetry,type:O.Paragraph,description:"A Hebrew musical performance annotation, similar in content to Hebrew descriptive title.",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},b:{category:$.Poetry,type:O.Paragraph,description:"Poetry text stanza break (e.g. stanza break) (basic)",hasEndMarker:!1,children:void 0},mt:{category:$.TitlesHeadings,type:O.Paragraph,description:"The main title of the book (if single level)",hasEndMarker:!1,children:{Footnotes:["f"],CrossReferences:["x"]}},mt1:{category:$.TitlesHeadings,type:O.Paragraph,description:"The main title of the book (if multiple levels) (basic)",hasEndMarker:!1,children:{Footnotes:["f"],CrossReferences:["x"]}},mt2:{category:$.TitlesHeadings,type:O.Paragraph,description:"A secondary title usually occurring before the main title (basic)",hasEndMarker:!1,children:{Footnotes:["f"],CrossReferences:["x"]}},mt3:{category:$.TitlesHeadings,type:O.Paragraph,description:"A secondary title occurring after the main title",hasEndMarker:!1,children:{Footnotes:["f"],CrossReferences:["x"]}},mt4:{category:$.TitlesHeadings,type:O.Paragraph,description:"A small secondary title sometimes occurring within parentheses",hasEndMarker:!1,children:void 0},mte:{category:$.TitlesHeadings,type:O.Paragraph,description:"The main title of the book repeated at the end of the book, level 1 (if single level)",hasEndMarker:!1,children:void 0},mte1:{category:$.TitlesHeadings,type:O.Paragraph,description:"The main title of the book repeated at the end of the book, level 1 (if multiple levels)",hasEndMarker:!1,children:{TitlesHeadings:["mte2"]}},mte2:{category:$.TitlesHeadings,type:O.Paragraph,description:"A secondary title occurring before or after the 'ending' main title",hasEndMarker:!1,children:void 0},ms:{category:$.TitlesHeadings,type:O.Paragraph,description:"A major section division heading, level 1 (if single level) (basic)",hasEndMarker:!1,children:{TitlesHeadings:["mr"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},ms1:{category:$.TitlesHeadings,type:O.Paragraph,description:"A major section division heading, level 1 (if multiple levels)",hasEndMarker:!1,children:{TitlesHeadings:["mr"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},ms2:{category:$.TitlesHeadings,type:O.Paragraph,description:"A major section division heading, level 2",hasEndMarker:!1,children:{TitlesHeadings:["mr"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},ms3:{category:$.TitlesHeadings,type:O.Paragraph,description:"A major section division heading, level 3",hasEndMarker:!1,children:{TitlesHeadings:["mr"],Footnotes:["f","fe"]}},mr:{category:$.TitlesHeadings,type:O.Paragraph,description:"A major section division references range heading (basic)",hasEndMarker:!1,children:void 0},s:{category:$.TitlesHeadings,type:O.Paragraph,description:"A section heading, level 1 (if single level) (basic)",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},s1:{category:$.TitlesHeadings,type:O.Paragraph,description:"A section heading, level 1 (if multiple levels)",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},s2:{category:$.TitlesHeadings,type:O.Paragraph,description:"A section heading, level 2 (e.g. Proverbs 22-24)",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},s3:{category:$.TitlesHeadings,type:O.Paragraph,description:"A section heading, level 3 (e.g. Genesis 'The First Day')",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},s4:{category:$.TitlesHeadings,type:O.Paragraph,description:"A section heading, level 4",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},sr:{category:$.TitlesHeadings,type:O.Paragraph,description:"A section division references range heading",hasEndMarker:!1,children:void 0},r:{category:$.TitlesHeadings,type:O.Paragraph,description:"Parallel reference(s) (basic)",hasEndMarker:!1,children:void 0},sp:{category:$.TitlesHeadings,type:O.Paragraph,description:"A heading, to identify the speaker (e.g. Job)",hasEndMarker:!1,children:{Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},d:{category:$.TitlesHeadings,type:O.Paragraph,description:"A Hebrew text heading, to provide description (e.g. Psalms)",hasEndMarker:!1,children:{Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},sd:{category:$.TitlesHeadings,type:O.Paragraph,description:"Vertical space used to divide the text into sections, level 1 (if single level)",hasEndMarker:!1,children:void 0},sd1:{category:$.TitlesHeadings,type:O.Paragraph,description:"Vertical space used to divide the text into sections, level 1 (if multiple levels)",hasEndMarker:!1,children:void 0},sd2:{category:$.TitlesHeadings,type:O.Paragraph,description:"Vertical space used to divide the text into sections, level 2",hasEndMarker:!1,children:void 0},sd3:{category:$.TitlesHeadings,type:O.Paragraph,description:"Vertical space used to divide the text into sections, level 3",hasEndMarker:!1,children:void 0},sd4:{category:$.TitlesHeadings,type:O.Paragraph,description:"Vertical space used to divide the text into sections, level 4",hasEndMarker:!1,children:void 0},lh:{category:$.Lists,type:O.Paragraph,description:"List header (introductory remark)",hasEndMarker:!1,children:{Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li:{category:$.Lists,type:O.Paragraph,description:"A list entry, level 1 (if single level)",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li1:{category:$.Lists,type:O.Paragraph,description:"A list entry, level 1 (if multiple levels)",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li2:{category:$.Lists,type:O.Paragraph,description:"A list entry, level 2",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li3:{category:$.Lists,type:O.Paragraph,description:"A list entry, level 3",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li4:{category:$.Lists,type:O.Paragraph,description:"A list entry, level 4",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lf:{category:$.Lists,type:O.Paragraph,description:"List footer (concluding remark)",hasEndMarker:!1,children:{Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim:{category:$.Lists,type:O.Paragraph,description:"An embedded list entry, level 1 (if single level)",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim1:{category:$.Lists,type:O.Paragraph,description:"An embedded list entry, level 1 (if multiple levels)",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim2:{category:$.Lists,type:O.Paragraph,description:"An embedded list entry, level 2",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim3:{category:$.Lists,type:O.Paragraph,description:"An embedded list item, level 3",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim4:{category:$.Lists,type:O.Paragraph,description:"An embedded list entry, level 4",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},litl:{category:$.Lists,type:O.Character,description:"List entry total text",hasEndMarker:!0,children:void 0},lik:{category:$.Lists,type:O.Character,description:"Structured list entry key text",hasEndMarker:!0,children:void 0},liv:{category:$.Lists,type:O.Character,description:"Structured list entry value 1 content (if single value)",hasEndMarker:!0,children:void 0},liv1:{category:$.Lists,type:O.Character,description:"Structured list entry value 1 content (if multiple values)",hasEndMarker:!0,children:void 0},liv2:{category:$.Lists,type:O.Character,description:"Structured list entry value 2 content",hasEndMarker:!0,children:void 0},liv3:{category:$.Lists,type:O.Character,description:"Structured list entry value 3 content",hasEndMarker:!0,children:void 0},liv4:{category:$.Lists,type:O.Character,description:"Structured list entry value 4 content",hasEndMarker:!0,children:void 0},liv5:{category:$.Lists,type:O.Character,description:"Structured list entry value 5 content",hasEndMarker:!0,children:void 0},f:{category:$.Footnotes,type:O.Note,description:"A Footnote text item (basic)",hasEndMarker:!0,children:{Footnotes:["fr","ft","fk","fq","fqa","fl","fw","fp","fv","fdc"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},fe:{category:$.Footnotes,type:O.Note,description:"An Endnote text item",hasEndMarker:!0,children:{Footnotes:["fr","ft","fk","fq","fqa","fl","fw","fp","fv","fdc"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},fr:{category:$.Footnotes,type:O.Character,description:"The origin reference for the footnote (basic)",hasEndMarker:!0,children:void 0},ft:{category:$.Footnotes,type:O.Character,description:"Footnote text, Protocanon (basic)",hasEndMarker:!0,children:void 0},fk:{category:$.Footnotes,type:O.Character,description:"A footnote keyword (basic)",hasEndMarker:!0,children:void 0},fq:{category:$.Footnotes,type:O.Character,description:"A footnote scripture quote or alternate rendering (basic)",hasEndMarker:!0,children:void 0},fqa:{category:$.Footnotes,type:O.Character,description:"A footnote alternate rendering for a portion of scripture text",hasEndMarker:!0,children:void 0},fl:{category:$.Footnotes,type:O.Character,description:"A footnote label text item, for marking or 'labelling' the type or alternate translation being provided in the note.",hasEndMarker:!0,children:void 0},fw:{category:$.Footnotes,type:O.Character,description:"A footnote witness list, for distinguishing a list of sigla representing witnesses in critical editions.",hasEndMarker:!0,children:void 0},fp:{category:$.Footnotes,type:O.Character,description:"A Footnote additional paragraph marker",hasEndMarker:!0,children:void 0},fv:{category:$.Footnotes,type:O.Character,description:"A verse number within the footnote text",hasEndMarker:!0,children:void 0},fdc:{category:$.Footnotes,type:O.Character,description:"Footnote text, applies to Deuterocanon only",hasEndMarker:!0,children:void 0},fm:{category:$.Footnotes,type:O.Character,description:"An additional footnote marker location for a previous footnote",hasEndMarker:!0,children:void 0},x:{category:$.CrossReferences,type:O.Note,description:"A list of cross references (basic)",hasEndMarker:!0,children:{CrossReferences:["xo","xop","xt","xta","xk","xq","xot","xnt","xdc"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},xo:{category:$.CrossReferences,type:O.Character,description:"The cross reference origin reference (basic)",hasEndMarker:!0,children:void 0},xop:{category:$.CrossReferences,type:O.Character,description:"Published cross reference origin reference (origin reference that should appear in the published text)",hasEndMarker:!0,children:void 0},xt:{category:$.CrossReferences,type:O.Character,description:"The cross reference target reference(s), protocanon only (basic)",hasEndMarker:!0,children:void 0},xta:{category:$.CrossReferences,type:O.Character,description:"Cross reference target references added text",hasEndMarker:!0,children:void 0},xk:{category:$.CrossReferences,type:O.Character,description:"A cross reference keyword",hasEndMarker:!0,children:void 0},xq:{category:$.CrossReferences,type:O.Character,description:"A cross-reference quotation from the scripture text",hasEndMarker:!0,children:void 0},xot:{category:$.CrossReferences,type:O.Character,description:"Cross-reference target reference(s), Old Testament only",hasEndMarker:!0,children:void 0},xnt:{category:$.CrossReferences,type:O.Character,description:"Cross-reference target reference(s), New Testament only",hasEndMarker:!0,children:void 0},xdc:{category:$.CrossReferences,type:O.Character,description:"Cross-reference target reference(s), Deuterocanon only",hasEndMarker:!0,children:void 0},rq:{category:$.CrossReferences,type:O.Character,description:"A cross-reference indicating the source text for the preceding quotation.",hasEndMarker:!0,children:void 0},qt:{category:$.SpecialText,type:O.Character,description:"For Old Testament quoted text appearing in the New Testament (basic)",hasEndMarker:!0,children:void 0},nd:{category:$.SpecialText,type:O.Character,description:"For name of deity (basic)",hasEndMarker:!0,children:void 0},tl:{category:$.SpecialText,type:O.Character,description:"For transliterated words",hasEndMarker:!0,children:void 0},dc:{category:$.SpecialText,type:O.Character,description:"Deuterocanonical/LXX additions or insertions in the Protocanonical text",hasEndMarker:!0,children:void 0},bk:{category:$.SpecialText,type:O.Character,description:"For the quoted name of a book",hasEndMarker:!0,children:void 0},sig:{category:$.SpecialText,type:O.Character,description:"For the signature of the author of an Epistle",hasEndMarker:!0,children:void 0},pn:{category:$.SpecialText,type:O.Character,description:"For a proper name",hasEndMarker:!0,children:void 0},png:{category:$.SpecialText,type:O.Character,description:"For a geographic proper name",hasEndMarker:!0,children:void 0},addpn:{category:$.SpecialText,type:O.Character,description:"For chinese words to be dot underline & underline",hasEndMarker:!0,children:void 0},wj:{category:$.SpecialText,type:O.Character,description:"For marking the words of Jesus",hasEndMarker:!0,children:void 0},k:{category:$.SpecialText,type:O.Character,description:"For a keyword",hasEndMarker:!0,children:void 0},sls:{category:$.SpecialText,type:O.Character,description:"To represent where the original text is in a secondary language or from an alternate text source",hasEndMarker:!0,children:void 0},ord:{category:$.SpecialText,type:O.Character,description:"For the text portion of an ordinal number",hasEndMarker:!0,children:void 0},add:{category:$.SpecialText,type:O.Character,description:"For a translational addition to the text",hasEndMarker:!0,children:void 0},lit:{category:$.SpecialText,type:O.Paragraph,description:"For a comment or note inserted for liturgical use",hasEndMarker:!1,children:void 0},no:{category:$.CharacterStyling,type:O.Character,description:"A character style, use normal text",hasEndMarker:!0,children:void 0},it:{category:$.CharacterStyling,type:O.Character,description:"A character style, use italic text",hasEndMarker:!0,children:void 0},bd:{category:$.CharacterStyling,type:O.Character,description:"A character style, use bold text",hasEndMarker:!0,children:void 0},bdit:{category:$.CharacterStyling,type:O.Character,description:"A character style, use bold + italic text",hasEndMarker:!0,children:void 0},em:{category:$.CharacterStyling,type:O.Character,description:"A character style, use emphasized text style",hasEndMarker:!0,children:void 0},sc:{category:$.CharacterStyling,type:O.Character,description:"A character style, for small capitalization text",hasEndMarker:!0,children:void 0},sup:{category:$.CharacterStyling,type:O.Character,description:"A character style, for superscript text. Typically for use in critical edition footnotes.",hasEndMarker:!0,children:void 0},pb:{category:$.Breaks,type:O.Paragraph,description:"Page Break used for new reader portions and children's bibles where content is controlled by the page",hasEndMarker:!1,children:void 0}},Ar={DivisionMarks:{add:["v","c"],remove:[]},Paragraphs:{add:["p"],remove:[]},Poetry:{add:["q","q1","q2","q3","q4","b"],remove:[]},TitlesHeadings:{add:["mte","ms","ms1","ms2","ms3","s","s1","s2","s3","s4","r","sp","d","sd","sd1","sd2","sd3","sd4"],remove:[]}},xT={p:{children:Ar},q:{children:Ar},q1:{children:Ar},q2:{children:Ar},q3:{children:Ar},q4:{children:Ar},b:{children:Ar},qm:{children:{Paragraphs:{add:["p"],remove:[]}}},c:{type:O.Paragraph,children:null},v:{children:null}};function lp(n){const e=kT[n],t=xT[n];if(!e)return;if(!t)return e;let r=e.children?{...e.children}:void 0;if(t.children===null&&(r=void 0),t.children){r=r||{};for(const[i,s]of Object.entries(t.children)){const o=i;if(s===null)Reflect.deleteProperty(r,o);else{let a=r[o]||[];s.remove&&(a=a.filter(l=>!s.remove.includes(l))),s.add&&(a=[...new Set([...a,...s.add])]),a.length>0?r[o]=a:Reflect.deleteProperty(r,o)}}Object.keys(r).length===0&&(r=void 0)}return{...e,...t,children:r}}function cp(n,e,t){const r={type:Ws,version:Ks,content:n},i=e.serializeEditorState(r,t);return vf(i.root.children[0])?i.root.children[0].children[0]:i.root.children[0]}function id(n,e){if(!n||!W(n))return[void 0,void 0];const t=n.getTextContent();if(e>=0&&e<t.length)return[n,e];let r=n.getNextSibling();if(!r){const s=n.getParent();rt(s)&&(r=s.getNextSibling())}if(!r||!rt(r)&&!W(r))return[void 0,void 0];const i=e-t.length;return r&&W(r)?id(r,i):id(r.getFirstChild()??void 0,i)}function up(n){const e=jv(n.jsonPath);let t=me();for(const r of e){if(!t||!F(t))return[void 0,void 0];t=t.getChildAtIndex(r)??void 0}return id(t,n.offset)}function dp(n){return F(n)?"element":"text"}function Af(n){const{start:e}=n;let{end:t}=n;t===void 0&&(t=e);const[r,i]=up(e),[s,o]=up(t);if(!r||!s||i===void 0||o===void 0)return;const a=yo();return a.anchor=wt(r.getKey(),i,dp(r)),a.focus=wt(s.getKey(),o,dp(s)),a}function fp(n,e){const t=[];let r=n;for(;r!=null&&r.getParent();){const i=r.getParent();if(i){const s=i==null?void 0:i.getChildren().indexOf(r);s>=0&&t.unshift(s)}r=i}return{jsonPath:Fv(t),offset:e}}function nv(){const n=K();if(!n||!q(n))return;const e=n.isBackward()?n.focus.getNode():n.anchor.getNode(),t=n.isBackward()?n.focus.offset:n.anchor.offset,r=fp(e,t);if(n.isCollapsed())return{start:r};const i=n.isBackward()?n.anchor.getNode():n.focus.getNode(),s=n.isBackward()?n.anchor.offset:n.focus.offset,o=fp(i,s);return{start:r,end:o}}const rv="v",iv=1;class bt extends pr{constructor(e="",t=!1,r,i,s,o,a){super(a),Z(this,"__marker"),Z(this,"__number"),Z(this,"__showMarker"),Z(this,"__sid"),Z(this,"__altnumber"),Z(this,"__pubnumber"),Z(this,"__unknownAttributes"),this.__marker=rv,this.__number=e,this.__showMarker=t,this.__sid=r,this.__altnumber=i,this.__pubnumber=s,this.__unknownAttributes=o}static getType(){return"immutable-verse"}static clone(e){const{__number:t,__showMarker:r,__sid:i,__altnumber:s,__pubnumber:o,__unknownAttributes:a,__key:l}=e;return new bt(t,r,i,s,o,a,l)}static importDOM(){return{span:e=>wT(e)?{conversion:CT,priority:1}:null}}static importJSON(e){return Of().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setNumber(e.number).setShowMarker(e.showMarker).setSid(e.sid).setAltnumber(e.altnumber).setPubnumber(e.pubnumber).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}setNumber(e){if(this.__number===e)return this;const t=this.getWritable();return t.__number=e,t}getNumber(){return this.getLatest().__number}setShowMarker(e=!1){if(this.__showMarker===e)return this;const t=this.getWritable();return t.__showMarker=e,t}getShowMarker(){return this.getLatest().__showMarker}setSid(e){if(this.__sid===e)return this;const t=this.getWritable();return t.__sid=e,t}getSid(){return this.getLatest().__sid}setAltnumber(e){if(this.__altnumber===e)return this;const t=this.getWritable();return t.__altnumber=e,t}getAltnumber(){return this.getLatest().__altnumber}setPubnumber(e){if(this.__pubnumber===e)return this;const t=this.getWritable();return t.__pubnumber=e,t}getPubnumber(){return this.getLatest().__pubnumber}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("span");return e.setAttribute("data-marker",this.__marker),e.classList.add(Zu,`usfm_${this.__marker}`),this.__showMarker&&e.classList.add("marker"),e.setAttribute("data-number",this.__number),e}updateDOM(){return!1}exportDOM(e){const{element:t}=super.exportDOM(e);return t&&Te(t)&&(t.setAttribute("data-marker",this.getMarker()),t.classList.add(Zu,`usfm_${this.getMarker()}`),t.setAttribute("data-number",this.getNumber())),{element:t}}decorate(){return S.jsx("span",{children:this.getShowMarker()?Eo(this.getMarker(),this.getNumber()):Qu+this.getNumber()+Qu})}exportJSON(){return{type:this.getType(),marker:this.getMarker(),number:this.getNumber(),showMarker:this.getShowMarker(),sid:this.getSid(),altnumber:this.getAltnumber(),pubnumber:this.getPubnumber(),unknownAttributes:this.getUnknownAttributes(),version:iv}}isKeyboardSelectable(){return!1}}function CT(n){const e=n.getAttribute("data-number")??"0";return{node:Of(e)}}function Of(n,e,t,r,i,s){return Ae(new bt(n,e,t,r,i,s))}function wT(n){return((n==null?void 0:n.getAttribute("data-marker"))??void 0)===rv}function cs(n){return n instanceof bt}function ST(n){return(n==null?void 0:n.type)===bt.getType()}function Dt(n){return Cf(n)||cs(n)}function TT(n){return V1(n)||ST(n)}function ET(n,e,t,r,i,s,o){if(!Ve.isValidMarker(n))throw new Error(`$insertNote: Invalid note marker '${n}'`);const a=t?Af(t):K();if(!q(a))return;const l=NT(a,n,r,o);if(l===void 0)return;const c=ov(n,e,l,i,s);return sv(c,a,i),c}function sv(n,e,t){const r=(t==null?void 0:t.noteMode)==="collapsed";if(n.setIsCollapsed(r),e.isCollapsed()||rT(e),e.insertNodes([n]),!r){const i=n.getChildren().reverse().find(Me);i==null||i.selectEnd()}}function NT(n,e,t,r){const i=[],{chapterNum:s,verseNum:o}=t??{};switch(e){case"f":case"fe":case"ef":case"efe":if(s!==void 0&&o!==void 0&&i.push(hn("fr").append(de(`${s}:${o}`))),!n.isCollapsed()){const a=n.getTextContent().trim();if(a.length>0){const l=hn("fq");l.append(de(a)),i.push(l)}}i.push(hn("ft").append(de("-")));break;case"x":case"ex":s!==void 0&&o!==void 0&&i.push(hn("xo").append(de(`${s}:${o}`))),i.push(hn("xt").append(de("-")));break;default:r==null||r.warn(`$createNoteChildren: Unsupported note marker '${e}'`);return}return i}function ov(n,e,t,r,i,s){const o=(r==null?void 0:r.noteMode)!=="expanded",a=kf(n,e,o);s&&Pn(a,Vr,()=>s);let l,c;(r==null?void 0:r.markerMode)==="editable"?(l=Gi(n),c=Gi(n,"closing")):(r==null?void 0:r.markerMode)==="visible"&&(l=Yi("marker",Kn(n)+Ne),c=Yi("marker",Vi(n)+Ne));let u;if(l&&a.append(l),(r==null?void 0:r.markerMode)==="editable")e===""?a.append(...t):(u=de(Tf(a.__caller)),a.append(u,...t));else{const f=()=>de(Ne),d=t.flatMap(AT(f));if(e==="")a.append(...d);else{const h=Ef(t);let p=()=>{};i!=null&&i.noteCallerOnClick&&(p=i.noteCallerOnClick),u=Rf(a.__caller,h,p),a.append(u,f(),...d)}}return c&&a.append(c),a}function hp(n){var e;if(typeof n=="string"){const i=ce(n);return pe(i)?i:void 0}const t=ko();if(t.length<=0)return;const r=(e=t.filter(i=>pe(i.node))[n])==null?void 0:e.node;if(pe(r))return r}function MT(n,e){const t=(e==null?void 0:e.noteMode)==="collapsed";if(n.setIsCollapsed(t),t){const r=n.getPreviousSibling();if(cs(r)||!r){const i=n.getParent();if(i){const s=n.getIndexWithinParent();i.select(s,s)}}else r.selectEnd()}else{const r=n.getChildren().reverse().find(Me);r==null||r.selectEnd()}}function AT(n){return e=>gl(e)?[e]:[e,n()]}function OT(n){return n.find(e=>dt(e))}function $T(n,e){return F(n)?n.getChildren().find(t=>Dt(t)&&Nf(e,t.getNumber())):void 0}function IT(n,e){return e===0?OT(n):n.map(t=>$T(t,e)).filter(t=>t)[0]}function gp(n){return!n||!F(n)?void 0:n.getChildren().findLast(e=>Dt(e))}function av(n){var e,t;if(!n||Lt(n))return;if(Dt(n))return n;let r=rt(n.getParent())?(e=n.getParent())==null?void 0:e.getPreviousSibling():n.getPreviousSibling();for(;r&&!Dt(r)&&!Lt(r);)r=r.getPreviousSibling();if(r&&Dt(r))return r;let i=(t=n.getTopLevelElement())==null?void 0:t.getPreviousSibling(),s=gp(i),o=s;for(;i&&!s&&!Lt(i);)s=o,i=i.getPreviousSibling(),o=gp(i);if(!(!s&&Lt(i)))return s}function PT(n){return Q1(n)||cs(n)}function $f(n){if(W(n)){const e=n.getTextContent();!e.endsWith(" ")&&!e.endsWith(Ne)&&n.setTextContent(`${e} `)}}function lv(n){if(W(n)){const e=n.getTextContent();e.startsWith(" ")&&n.setTextContent(e.trimStart())}}function If(n,e){return n.getEditorState().read(()=>!ce(e))}const RT=["style"],LT=["style","code"],ml=["style","cid"],DT=["style","number","sid","altnumber","pubnumber"],jT=["style","number","sid","altnumber","pubnumber"],FT=["style","sid","eid"],qT=["style","caller","category","contents"],BT=["chapter","immutable-chapter","verse","immutable-verse","ms","note","unmatched"],lo=`
`;function UT(n,e){const t=ce(n);if(!Zt(t))return;const r=cv(t);return r===void 0?void 0:[{retain:r},...e,{delete:1}]}function cv(n){if(!n)return;const e=ko();let t=0;const r=[];let i,s;const o=n.getKey();let a;for(const l of e){const c=l.node;for(let u=r.length-1;u>=0;u--)if(co(r[u],l)){const f=r[u];if(r.splice(u,1),t+=1,a&&f.getKey()===a.getKey())return t-1}if(i&&co(i,l)&&(i=void 0,s=void 0),i){if(c.getKey()===o)return s;continue}if(c.getKey()===o){if(W(c)||Zt(c))return t;qt(c)&&(a=c)}if(qt(c)&&(r.includes(c)||r.push(c)),pe(c)){i=c,s=t,t+=1;continue}t+=uv(c)}if(a)return t}function pp(n,e){if(n.length<2||!KT(n[0])||!WT(n[1]))return;const t=n[0].retain;return e.read(()=>{const r=zT(t);return r==null?void 0:r.getKey()})}function zT(n){const e=ko();let t=0;const r=[];let i,s;for(const o of e){const a=o.node;for(let c=r.length-1;c>=0;c--)if(co(r[c],o)){const u=r[c];if(r.splice(c,1),t===n)return u;t+=1}if(i&&co(i,o)&&(i=void 0,s=void 0),i){if(s===n)return i;continue}if(qt(a)&&(r.includes(a)||r.push(a)),pe(a)){if(i=a,s=t,t===n)return a;t+=1;continue}const l=uv(a);if(W(a)&&l>0&&n>=t&&n<t+l||Zt(a)&&t===n)return a;t+=l}for(const o of r){if(t===n)return o;t+=1}}function co(n,e){return n?e?!tT(e.node,n.getKey()):!0:!1}function Zt(n){return Lt(n)||Dt(n)||Bl(n)||pe(n)||tv(n)}function qt(n){return Kt(n)||_n(n)}function As(n,e){return e.insert!=null&&typeof e.insert=="object"&&n in e.insert}function WT(n){if(n.insert==null||typeof n.insert!="object")return!1;const e=Object.keys(n.insert)[0];return n.insert!=null&&typeof n.insert=="object"&&e in n.insert&&BT.includes(e)}function KT(n){return n.retain!=null&&typeof n.retain=="number"}function uv(n){return W(n)?n.getTextContentSize():Zt(n)?1:0}function sd(n,e){const t={insert:n.__text},r=Ri(n,Vr);if(r&&(t.attributes={segment:r}),e&&e.length>0){let i=e.map(s=>{const o={style:s.__marker},a=Ri(s,Jr);a&&(o.cid=a);const l=s.getUnknownAttributes();return l&&Object.keys(l).length>0&&Object.assign(o,l),o});i.length===1&&(i=i[0]),t.attributes={...t.attributes,char:i}}return t}function mp(n){const e=new Ds;return n.isEmpty()||n.read(()=>{const t=me();if(!t||t.isEmpty())return;const r=t.getChildren();if(r.length===1&&Bn(r[0])&&(!r[0].getChildren()||r[0].getChildrenSize()===0))return;const i=HT();for(const s of i)e.push(s)}),e}function Pf(n,e){const t=[],r=ko(n),i=[],s=[],o={children:[],contentsOps:[]};for(let a=0;a<r.length;a++){const l=r[a].node;t.push(...yp(l,a,r,i,s,o))}for(const a of i)t.push(...yp(a,r.length,r,i,s,o));return t}function HT(){return Pf()}function yp(n,e,t,r,i,s){if(!n)return[];const o=[];return JT(n,o,r),VT(n,o,i,s),GT(n,e,t,i),Lt(n)&&o.push(QT(n)),Dt(n)&&o.push(eE(n)),Bl(n)&&o.push(tE(n)),tv(n)&&o.push(nE(n)),YT(n,o,s),o}function JT(n,e,t){if(!n.isInline()){const r=t.pop();_n(r)?e.push(XT(r)):dt(r)?e.push(ZT(r)):Bn(r)&&e.push({insert:lo})}qt(n)&&(t.includes(n)||t.push(n))}function VT(n,e,t,r){var i;if(!W(n))return;const s=n.getParent();if(pe(s)&&s.getFirstChild()===n)return;const o=sd(n,t);if(r.children.includes(n)){const a=n.getTextContent();if(!a||a===Ne||a.startsWith(hf))return;(i=r.contentsOps)==null||i.push(o)}else e.push(o)}function GT(n,e,t,r){Me(n)&&!r.includes(n)&&r.push(n);const i=t[e+1];for(const s of r.toReversed())co(s,i)&&r.pop()}function YT(n,e,t){var r,i;if(!pe(n))return;ko(n).forEach(o=>t.children.push(o.node));const s=rE(n);t.contentsOps=(i=(r=s.insert.note)==null?void 0:r.contents)==null?void 0:i.ops,e.push(s)}function XT(n){const e={style:ql,code:n.__code};return{insert:lo,attributes:{book:e}}}function QT(n){const e={style:yf,number:n.__number};return n.__sid&&(e.sid=n.__sid),n.__altnumber&&(e.altnumber=n.__altnumber),n.__pubnumber&&(e.pubnumber=n.__pubnumber),{insert:{chapter:e}}}function ZT(n){const e={style:n.__marker};return{insert:lo,attributes:{para:e}}}function eE(n){const e={style:xf,number:n.__number};return n.__sid&&(e.sid=n.__sid),n.__altnumber&&(e.altnumber=n.__altnumber),n.__pubnumber&&(e.pubnumber=n.__pubnumber),{insert:{verse:e}}}function tE(n){const e={style:n.__marker};return n.__sid&&(e.sid=n.__sid),n.__eid&&(e.eid=n.__eid),{insert:{milestone:e}}}function nE(n){return{insert:{unmatched:{marker:n.__marker}}}}function rE(n){const e={style:n.__marker,caller:n.__caller};n.__category&&(e.category=n.__category),n.getChildrenSize()>1&&(e.contents={ops:[]});const t={insert:{note:e}},r=Ri(n,Vr);return r&&(t.attributes={segment:r}),t}const dv=1;class Gt extends pr{constructor(e=Gr,t="",r,i){super(i),Z(this,"__caller"),Z(this,"__previewText"),Z(this,"__onClick"),this.__caller=e,this.__previewText=t,this.__onClick=r??(()=>{})}static getType(){return"immutable-note-caller"}static clone(e){const{__caller:t,__previewText:r,__onClick:i,__key:s}=e;return new Gt(t,r,i,s)}static importDOM(){return{span:e=>sE(e)?{conversion:iE,priority:1}:null}}static importJSON(e){return Rf().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setCaller(e.caller).setPreviewText(e.previewText).setOnClick(e.onClick)}setCaller(e){if(this.__caller===e)return this;const t=this.getWritable();return t.__caller=e,t}getCaller(){return this.getLatest().__caller}setPreviewText(e){if(this.__previewText===e)return this;const t=this.getWritable();return t.__previewText=e,t}getPreviewText(){return this.getLatest().__previewText}setOnClick(e){if(this.__onClick===e)return this;const t=this.getWritable();return t.__onClick=e,t}getOnClick(){return this.getLatest().__onClick}createDOM(){const e=document.createElement("span");return e.classList.add(this.__type),e.setAttribute("data-caller",this.__caller),e.setAttribute("data-preview-text",this.__previewText),e}updateDOM(e){return e.__caller!==this.__caller}exportDOM(e){const{element:t}=super.exportDOM(e);return t&&Te(t)&&(t.classList.add(this.getType()),t.setAttribute("data-caller",this.getCaller()),t.setAttribute("data-preview-text",this.getPreviewText())),{element:t}}decorate(e){const t=this.getParent();if(!t)return null;const r=t.getKey(),i=t.getIsCollapsed(),s=this.__key,o=l=>{var c;return(c=this.__onClick)==null?void 0:c.call(this,l,r,i,()=>oE(e,r),u=>aE(e,r,s,u),()=>lE(e,r))},a=`${this.__caller}_${this.__previewText}}`.replace(/\s+/g,"").substring(0,25);return S.jsx("button",{onClick:o,title:this.__previewText,"data-caller-id":a,children:this.__caller===Gr&&i?"":this.__caller})}exportJSON(){return{type:this.getType(),caller:this.getCaller(),previewText:this.getPreviewText(),onClick:this.getOnClick(),version:dv}}isKeyboardSelectable(){return!1}}function iE(n){const e=n.getAttribute("data-caller")??"",t=n.getAttribute("data-preview-text")??"";return{node:Rf(e,t)}}function Rf(n,e,t){return Ae(new Gt(n,e,t))}function sE(n){return n?n.classList.contains(Gt.getType()):!1}function kr(n){return n instanceof Gt}function oE(n,e){return n.read(()=>{const t=ce(e);if(!pe(t))throw new Error(`getNoteCaller: Note node not found: ${e}`);return t.getCaller()})}function aE(n,e,t,r){n.update(()=>{const i=ce(e);if(!pe(i))throw new Error(`setNoteCaller: Note node not found: ${e}`);i.setCaller(r);const s=ce(t);if(!kr(s))throw new Error(`setNoteCaller: Caller node not found: ${t}`);s.setCaller(r)})}function lE(n,e){return n.read(()=>{const t=ce(e);if(!pe(t))throw new Error(`getNoteOps: Note node not found: ${e}`);return Pf(t)})}const cE=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],uE=[Gt,bt,...vT],dE=C.forwardRef((n,e)=>{const{coords:t,children:r,style:i,...s}=n,o=t!==void 0;return S.jsx("div",{ref:e,className:"floating-box","aria-hidden":!o,style:{...i,position:"absolute",zIndex:1e3,top:t==null?void 0:t.y,left:t==null?void 0:t.x,visibility:o?"visible":"hidden",opacity:o?1:0},...s,children:r})});function fE(){const[n,e]=C.useState(void 0),[t,r]=C.useState(),i=C.useRef(null),s=C.useCallback((a,l)=>{i.current&&i.current();const c=a.commonAncestorContainer.nodeType===a.commonAncestorContainer.TEXT_NODE?a:a.commonAncestorContainer;i.current=Bv(c,l,()=>{Uv(c,l,{placement:"bottom-start",middleware:[zv(),Wv()]}).then(u=>{r(u.placement),e(f=>(f==null?void 0:f.x)===u.x&&(f==null?void 0:f.y)===u.y?f:{x:u.x,y:u.y})}).catch(()=>{e(void 0)})})},[]),o=C.useCallback(()=>{i.current&&(e(void 0),i.current(),i.current=null)},[]);return C.useEffect(()=>o,[o]),{coords:n,placement:t,updatePosition:s,cleanup:o}}function hE({isOpen:n,floatingBoxRef:e}){const{coords:t,updatePosition:r,cleanup:i,placement:s}=fE();return C.useEffect(()=>{var o;if(!n||!e.current){i();return}const a=(o=window.getSelection())==null?void 0:o.getRangeAt(0);if(!a){i();return}return r(a,e.current),i},[i,n,e,r]),{coords:t,placement:s}}const gE=document.body,pE=C.memo(dE);function mE({isOpen:n=!1,children:e}){const t=C.useRef(null),{coords:r,placement:i}=hE({isOpen:n,floatingBoxRef:t}),s=C.useMemo(()=>r?typeof e=="function"?e:()=>e:()=>null,[e,r]);return Nt.createPortal(S.jsx(pE,{ref:t,coords:r,style:r?void 0:{display:"none"},children:s({isOpen:n,placement:i})}),gE)}const fv=C.createContext(void 0);function Lf(){const n=C.useContext(fv);if(!n)throw new Error("useMenuContext must be used within a MenuProvider");return n}function yE(n,e){const[t,r]=C.useState(0),[i,s]=C.useState(-1),o=C.useMemo(()=>n??[],[n]),a={menuItems:o,activeIndex:t,selectedIndex:i,onSelectOption:e??(()=>{})},l=C.useCallback(()=>{r(f=>{const d=o.length;return d?(f-1+d)%d:0})},[o.length]),c=C.useCallback(()=>{r(f=>{const d=o.length;return d?(f+1)%d:0})},[o.length]),u=C.useCallback(()=>{const f=o.length;if(t>=0&&t<f){const d=o[t];e==null||e(d),s(t)}},[t,o,e]);return{state:a,moveUp:l,moveDown:c,select:u,setActiveIndex:r,setSelectedIndex:s}}function _E({children:n,menuItems:e,onSelectOption:t,...r}){const i=yE(e,t);return S.jsx(fv.Provider,{value:i,children:S.jsx("div",{...r,children:n})})}const hv=C.forwardRef(({index:n,children:e,onMouseEnter:t,onClick:r,...i},s)=>{const{state:{activeIndex:o},setActiveIndex:a,setSelectedIndex:l,select:c}=Lf(),u=C.useCallback(d=>{c(),l(-1),r==null||r(d)},[r,c,l]),f=C.useCallback(d=>{a(n),t==null||t(d)},[n,a,t]);return S.jsx("button",{ref:s,role:"menuitem",...i,onClick:u,onMouseEnter:f,"aria-selected":n!==void 0&&o===n?"true":void 0,tabIndex:-1,children:e})});function bE({children:n,autoIndex:e=!0,...t}){const r=C.useRef(null),{state:{activeIndex:i,menuItems:s}}=Lf(),o=C.useMemo(()=>s?typeof n=="function"?n:()=>n:()=>null,[n,s]),a=C.useMemo(()=>{const l=o(s);return e?C.Children.map(l,(c,u)=>C.isValidElement(c)&&c.type===hv&&c.props.index===void 0?C.cloneElement(c,{index:u}):c):l},[o,e,s]);return C.useEffect(()=>{if(r.current){const l=r.current,c=l.children[i];if(c){const u=l.getBoundingClientRect(),f=c.getBoundingClientRect();f.bottom>u.bottom?l.scrollTop+=f.bottom-u.bottom:f.top<u.top&&(l.scrollTop-=u.top-f.top)}}},[i]),S.jsx("div",{ref:r,role:"menu",...t,children:a})}const ou={Root:_E,Options:bE,Option:hv},vE=(n,e,t)=>Da(n,t).toLowerCase().includes(e.toLowerCase()),_p=n=>Object.keys(n).find(e=>typeof n[e]=="string")||"",Da=(n,e)=>{const t=n[e];return typeof t=="string"?t:String(t)};function kE(n){const{query:e,items:t,filterBy:r,filter:i,sortBy:s,sortingOptions:o}=n,{caseSensitive:a=!1,priorityOrder:l=["exact","startsWith","contains"]}=o||{},c=a?e:e.toLowerCase();let u,f;i?(f=i,u=t.length>0?_p(t[0]):""):(u=r||(t.length>0?_p(t[0]):""),f=(p,m)=>vE(p,m,u));const d=s||u,h=new Map;return t.filter(p=>{try{return f(p,e)}catch(m){return console.warn("Error filtering item:",p,m),!1}}).sort((p,m)=>{const y=x=>(h.has(x)||h.set(x,Da(x,d).toLowerCase()),h.get(x)??""),b=a?Da(p,d):y(p),_=a?Da(m,d):y(m);for(const x of l)switch(x){case"exact":if(b===c&&_!==c)return-1;if(_===c&&b!==c)return 1;break;case"startsWith":if(b.startsWith(c)&&!_.startsWith(c))return-1;if(_.startsWith(c)&&!b.startsWith(c))return 1;break;case"contains":{const T=b.indexOf(c),P=_.indexOf(c);if(T!==-1&&P===-1)return-1;if(P!==-1&&T===-1)return 1;if(T!==-1&&P!==-1)return T-P;break}}return b.localeCompare(_)})}function xE(n){const{query:e,items:t,filterBy:r,filter:i,sortBy:s,sortingOptions:o}=n;return C.useMemo(()=>kE({query:e,items:t,filterBy:r,filter:i,sortBy:s,sortingOptions:o}),[e,t,r,i,s,o])}function CE(){const{moveUp:n,moveDown:e,select:t}=Lf();return C.useMemo(()=>({moveUp:n,moveDown:e,select:t}),[n,e,t])}const wE=()=>{const n=CE(),[e]=ge();C.useEffect(()=>{const t=r=>{const i={ArrowDown:()=>n==null?void 0:n.moveDown(),ArrowUp:()=>n==null?void 0:n.moveUp(),Enter:()=>n==null?void 0:n.select(),Tab:()=>n==null?void 0:n.select()}[r.key];return i?(i(),r.preventDefault(),r.stopPropagation(),!0):!1};return e.registerCommand(Qi,t,Tl)},[e,n])};function SE(){return wE(),null}function TE(n){const{options:e,onSelectOption:t,onClose:r,inverse:i,query:s,menuOpenKey:o}=n,[a]=ge(),l=s!==void 0,[c,u]=C.useState(""),f=l?s??"":c,d=xE({query:f,items:e,filterBy:"name"}),h=p=>{r==null||r(),t?t(p):p.action(a)};return C.useEffect(()=>a.registerCommand(Qi,p=>{if(l)return!1;const m={Escape:()=>r==null?void 0:r(),Backspace:()=>{f.length===0?r==null||r():u(y=>y.slice(0,-1))}}[p.key];return m?(p.stopPropagation(),p.preventDefault(),m(),!0):p.key.length===1?(p.stopPropagation(),p.preventDefault(),p.key!==o&&u(y=>y+p.key),!0):!1},Tl),[a,l,f,o,r]),S.jsxs(ou.Root,{className:`autocomplete-menu-container ${i?"inverse":""}`,menuItems:d,onSelectOption:p=>h(p),children:[!l&&S.jsx("input",{value:f,type:"text",disabled:!0}),S.jsx(SE,{}),S.jsx(ou.Options,{className:"autocomplete-menu-options",autoIndex:!1,children:p=>p.map((m,y)=>S.jsxs(ou.Option,{index:y,children:[S.jsx("span",{className:"label",children:m.label??m.name}),S.jsx("span",{className:"description",children:m.description})]},m.name))})]})}function EE({trigger:n,items:e}){const[t]=ge(),[r,i]=C.useState(!1),s=C.useCallback(o=>{o.key==="Escape"&&r?(i(!1),t.focus()):o.key===n&&!r&&(o.preventDefault(),i(!0))},[t,n,r]);return C.useEffect(()=>t.registerRootListener(o=>{if(o)return o.addEventListener("keydown",s),()=>{o.removeEventListener("keydown",s)}}),[t,s]),C.useEffect(()=>t.registerUpdateListener(({prevEditorState:o,editorState:a})=>{const l=o.read(()=>{const c=K();if(q(c))return c});a.read(()=>{const c=K();!q(c)||l!=null&&l.is(c)||i(!1)})}),[t]),e&&S.jsx(mE,{isOpen:r,children:({placement:o})=>S.jsx(TE,{options:e,onClose:()=>i(!1),inverse:o==="top-start",menuOpenKey:n})})}function NE({scriptureReference:n,contextMarker:e,getMarkerAction:t}){return{markersMenuItems:C.useMemo(()=>{if(!e||!n)return;const r=lp(e);if(r!=null&&r.children)return Object.values(r.children).flatMap(i=>i.map(s=>{const o=lp(s),{action:a}=t(s,o);return{name:s,label:s,description:(o==null?void 0:o.description)??"",action:l=>{a({editor:l,reference:n})}}}))},[e,t,n])}}function ja(n,e){return`${n}:${e}`}function ME(n,e){C.useEffect(()=>{if(!n.hasNodes([tt]))throw new Error("AnnotationPlugin: TypedMarkNode not registered on editor!");const t=new Map;return He(Vy(n,tt,r=>ao(r.getTypedIDs()),(r,i)=>{for(const[s,o]of Object.entries(r.getTypedIDs()))o.forEach(a=>{i.addID(s,a)})}),n.registerMutationListener(tt,r=>{n.getEditorState().read(()=>{for(const[i,s]of r){const o=ce(i);let a={};s==="destroyed"?a=t.get(i)??{}:rt(o)&&(a=o.getTypedIDs());for(const[l,c]of Object.entries(a))if(!tt.isReservedType(l))for(const u of c){let f=e.get(ja(l,u));a[l]=c,t.set(i,a),s==="destroyed"?f!==void 0&&(f.delete(i),f.size===0&&e.delete(ja(l,u))):(f===void 0&&(f=new Set,e.set(ja(l,u),f)),f.has(i)||f.add(i))}}})},{skipInitialization:!0}))},[n,e])}const AE=C.forwardRef(function({logger:n},e){const[t]=ge(),r=C.useMemo(()=>new Map,[]);return ME(t,r),C.useImperativeHandle(e,()=>({addAnnotation(i,s,o){if(tt.isReservedType(s))throw new Error(`addAnnotation: Can't directly add this reserved annotation type '${s}'. Use the appropriate plugin instead.`);t.update(()=>{const a=Af(i);if(a===void 0){n==null||n.error("Failed to find start or end node of the annotation.");return}Qb(a,s,o)},{tag:td})},removeAnnotation(i,s){if(tt.isReservedType(i))throw new Error(`removeAnnotation: Can't directly remove this reserved annotation type '${i}'. Use the appropriate plugin instead.`);const o=r.get(ja(i,s));o!==void 0&&setTimeout(()=>{t.update(()=>{for(const a of o){const l=ce(a);rt(l)&&(l.deleteID(i,s),l.hasNoIDsForEveryType()&&Xb(l))}},{tag:td})})}})),null});function OE({ignoreHistoryMergeTagChange:n=!0,ignoreSelectionChange:e=!1,onChange:t}){const[r]=ge();return C.useLayoutEffect(()=>{if(t)return r.registerUpdateListener(i=>{const{editorState:s,dirtyElements:o,dirtyLeaves:a,prevEditorState:l,tags:c}=i;if(e&&o.size===0&&a.size===0||n&&c.has(Pr)||l.isEmpty())return;const u=$E(r,i);u.length!==0&&t(s,r,c,u)})},[r,n,e,t]),null}function $E(n,{dirtyLeaves:e,prevEditorState:t}){let r=new Ds;return n.getEditorState().read(()=>{const i=e.values().next().value??"";if(e.size===1&&W(ce(i))){const s=ce(i),o=cv(s);if(W(s)&&o!==void 0){const a=t.read(()=>{const u=ce(i);return new Ds([W(u)?sd(u):{insert:""}])}),l=new Ds([sd(s)]),c=new Ds(o>0?[{retain:o}]:[]);r=r.concat(c).concat(a.diff(l))}}else{const s=mp(t),o=mp(n.getEditorState());r=s.diff(o)}}),r.ops}function IE(n,e,t,r){let i=0;n.forEach(s=>{if("retain"in s)i+=PE(s,i,e,r);else if("delete"in s){if(typeof s.delete!="number"||s.delete<=0){r==null||r.error(`Invalid delete operation: ${JSON.stringify(s)}`);return}r==null||r.debug(`Delete: ${s.delete}`),LE(i,s.delete,r)}else"insert"in s?typeof s.insert=="string"?(r==null||r.debug(`Insert: '${s.insert}'`),i+=DE(i,s.insert,s.attributes,e,r)):typeof s.insert=="object"&&s.insert!==null?(r==null||r.debug(`Insert embed: ${JSON.stringify(s.insert)}`),FE(i,s,e,t,r)?i+=1:r==null||r.error(`Failed to process insert embed operation: ${JSON.stringify(s.insert)} at index ${i}. Document may be inconsistent.`)):r==null||r.error(`Insert of unknown type: ${JSON.stringify(s.insert)}`):r==null||r.error(`Unknown operation: ${JSON.stringify(s)}`)})}function PE(n,e,t,r){return typeof n.retain!="number"||n.retain<0?(r==null||r.error(`Invalid retain operation: ${JSON.stringify(n)}`),0):(r==null||r.debug(`Retain: ${n.retain}`),n.attributes&&(r==null||r.debug(`Retain attributes: ${JSON.stringify(n.attributes)}`),RE(e,n.retain,n.attributes,t,r)),n.retain)}function RE(n,e,t,r,i){i==null||i.debug(`Applying attributes for range [${n}, ${n+e-1}] with attributes: ${JSON.stringify(t)}`);let s=e,o=0,a=-1;const l=me();function c(u){if(s<=0)return!0;if(W(u)){const f=u.getTextContentSize();if(n<o+f&&o<n+e){const d=Math.max(0,n-o),h=f-d,p=Math.min(s,h);if(p>0){let m=u;const y=d>0,b=p<f-d;if(y&&b){const[,_]=u.splitText(d);[m]=_.splitText(p)}else y?[,m]=u.splitText(d):b&&([m]=u.splitText(p));if(Qr(t)){const _=m.getParent();if(Me(_)){const x=t.char;let T;Array.isArray(x)?a>=0&&a<=x.length-1&&(T=x[a]):a===0&&(T=x);const P=T?Xr(T,_):!1;if(P&&Array.isArray(x)&&x.length>1){const M=de("");m.replace(M);const L=typeof t.segment=="string"?t.segment:void 0,A=Mo(x.slice(1),r,m,L);let I=M;for(const B of A)I.insertAfter(B),I=B;M.remove(),Pt(t,m)}else if(P)Pt(t,m);else{m.remove();const M=bp(m,t,r,i);if(M&&M.length>0){let L=_;for(const A of M)L.insertAfter(A),L=A}}}else{const x=de("");m.replace(x);const T=bp(m,t,r,i);if(T&&T.length>0){let P=x;for(const M of T)P.insertAfter(M),P=M;x.remove()}else x.replace(m)}}else Pt(t,m);s-=p}}o+=f}else if(Zt(u))n<=o&&o<n+e&&s>0&&(vp(u,t),s-=1),o+=1;else if(Me(u)){a+=1;let f=!1;if(n<=o&&o<n+e&&s>0)if(Qr(t)){const d=t.char;let h;if(Array.isArray(d)?a>=0&&a<=d.length-1&&(h=d[a]):a===0&&(h=d),h){u.setMarker(h.style),typeof h.cid=="string"&&Pn(u,Jr,()=>h.cid);const p=Ge(h,ml);p&&Object.keys(p).length>0?u.setUnknownAttributes({...u.getUnknownAttributes()??{},...p}):u.setUnknownAttributes(void 0)}}else(t.char===!1||t.char===null||JE(t.char))&&(f=!0);if(s>0){const d=u.getChildren();for(const h of d){if(s<=0)break;if(c(h)&&s<=0)return f&&Bh(u),!0}}f&&Bh(u),a-=1}else if(qt(u)){const f=u.getChildren();for(const h of f){if(s<=0)break;if(c(h)&&s<=0)return!0}const d=1;if(n<=o&&o<n+s&&s>0){if(!Bn(u))vp(u,t);else if(Df(t)){const h=pv(t.para);h&&u.replace(h,!0)}s-=d}o+=d}else if(F(u)){const f=u.getChildren();for(const d of f){if(s<=0)break;if(c(d)&&s<=0)return!0}}return s<=0}c(l),s>0&&(i==null||i.warn(`$applyAttributes: Not all characters in the retain operation (length ${e}) could be processed. Remaining: ${s}. targetIndex: ${n}, final currentIndex: ${o}`))}function bp(n,e,t,r){var i;const s=typeof e.segment=="string"?e.segment:void 0,o=Mo(e.char,t,n,s),a=o.find(Me);if(!a){r==null||r.error(`Failed to create CharNode for text transformation. Style: ${Array.isArray(e.char)?e.char[0].style:(i=e.char)==null?void 0:i.style}. Falling back to standard text attributes.`),Pt(e,n);return}const l={};mv.forEach(f=>{n.hasFormat(f)&&(l[f]="true")});const c={};Object.entries(e).forEach(([f,d])=>{f==="segment"||f==="char"||(typeof d=="string"?c[f]=d:d===!0?c[f]="true":d===!1&&(c[f]="false"))});const u={...a.getUnknownAttributes()??{},...l,...c};return Object.keys(u).length>0&&a.setUnknownAttributes(u),Pt(e,n),o}function vp(n,e){for(const t of Object.keys(e)){const r=e[t];if(t==="char"&&Me(n)&&Qr(e)){const i=r;if(n.setMarker(i.style),typeof i.cid=="string"){const o=i.cid;Pn(n,Jr,()=>o)}const s=Ge(i,ml);s&&Object.keys(s).length>0&&n.setUnknownAttributes({...n.getUnknownAttributes()??{},...s});continue}typeof r=="string"&&(Lt(n)||Dt(n)||Bl(n)||pe(n)||So(n)?n.setUnknownAttributes({...n.getUnknownAttributes()??{},[t]:r}):(_n(n)||dt(n)||Me(n))&&(t==="style"&&!_n(n)?n.setMarker(r):t==="code"&&_n(n)?n.setCode(r):n.setUnknownAttributes({...n.getUnknownAttributes()??{},[t]:r})),t==="segment"&&Pn(n,Vr,()=>r))}}function LE(n,e,t){if(e<=0)return;const r=me();let i=0,s=e;function o(a){if(s<=0)return!0;if(W(a)){let l=a.getTextContentSize();if(n<i+l&&i<n+s){const c=Math.max(0,n-i),u=l-c,f=Math.min(s,u);f>0&&(a.spliceText(c,f,""),a.getTextContentSize()===0&&a.remove(),t==null||t.debug(`Deleted ${f} length from TextNode (key: ${a.getKey()}) at nodeOffset ${c}. Original targetIndex: ${n}, current currentIndex: ${i}.`),s-=f,l-=f)}i+=l}else if(Zt(a))n<=i&&i<n+s?(a.remove(),t==null||t.debug(`Deleted embed node (key: ${a.getKey()}) at currentIndex: ${i}. Original targetIndex: ${n}, remainingToDelete: ${s}.`),s-=1):i+=1;else if(qt(a)){const l=a.getChildren().slice(),c=a.getChildren();for(const u of c){if(s<=0)break;if(o(u)&&s<=0)return!0}if(n<=i&&i<n+s&&qt(a)){s-=1;const u=a.getChildren().length;if(l.length>0&&u===0){const f=a.getParent();((f==null?void 0:f.getChildren())??[]).length>1?(a.remove(),t==null||t.debug(`Removed entire ParaNode that had all its content deleted at currentIndex: ${i}. Original targetIndex: ${n}, remainingToDelete: ${s}.`)):(a.replace(Vt(),!0),t==null||t.debug(`Replaced last ParaNode with ImpliedParaNode at currentIndex: ${i}. Original targetIndex: ${n}, remainingToDelete: ${s}.`))}else if(s>0){const f=a.getNextSibling();if(f&&Kt(f)){let d=i+1;const h=f.getChildren();for(const m of h){if(s<=0)break;const y=i;if(i=d,o(m)){i=y;break}W(m)?d+=m.getTextContentSize():Zt(m)&&(d+=1),i=y}const p=f.getChildren();for(const m of p)m.remove(),a.append(m);f.remove(),t==null||t.debug(`Merged next paragraph into current one after deleting symbolic close at currentIndex: ${i}. Original targetIndex: ${n}, remainingToDelete: ${s}.`)}else a.replace(Vt(),!0)}else dt(a)?a.replace(Vt(),!0):a.remove()}i+=1}else if(F(a)){const l=a.getChildren();for(const c of l){if(s<=0)break;if(o(c)&&s<=0)return!0}}return s<=0}o(r),s>0&&(t==null||t.warn(`Delete operation could not remove all requested characters. Remaining to delete: ${s}. Original targetIndex: ${n}, OT length: ${e}. Final currentIndex: ${i}`))}function DE(n,e,t,r,i){if(e===lo)return kp(n,t,i);if(e.endsWith(lo)&&!Df(t)){const s=e.slice(0,-1);let o=0;if(s.length>0){if(Qr(t))throw new Error("Text + LF should not have char attributes");o+=yl(n,s,t,i)}return o+=kp(n+o,t,i),o}else return Qr(t)?jE(n,e,t,r,i):yl(n,e,t,i)}function jE(n,e,t,r,i){i==null||i.debug(`Attempting to insert CharNode with text "${e}" and attributes ${JSON.stringify(t.char)} at index ${n}`);const s=de(e);Pt(t,s);let o;{let h=function(y){if(W(y)){const b=y.getTextContentSize();if(n>=m&&n<m+b){const _=y.getParent();return Me(_)&&(o=_),!0}m+=b}else if(Zt(y))m+=1;else if(Me(y)){const b=y.getChildren();for(const _ of b)if(h(_))return!0}else if(F(y)){const b=y.getChildren();for(const _ of b)if(h(_))return!0;qt(y)&&(m+=1)}return!1};const p=me();let m=0;h(p)}let a=t.char;if(Array.isArray(a)){if(o){const h=a[0];h&&Xr(h,o)?(a=a.slice(1),a.length===1&&(a=a[0])):o=void 0}}else o&&(Xr(a,o)||(o=void 0));const l=typeof t.segment=="string"?t.segment:void 0,c=Mo(a,r,s,l,o?[o]:void 0);if(c.length===0)return e.length;const u=c.find(Me);if(!u)return i==null||i.error(`CharNode style is missing for text "${e}". Attributes: ${JSON.stringify(t.char)}. Falling back to rich text insertion.`),yl(n,e,void 0,i);const f={};for(const[h,p]of Object.entries(t))h!=="char"&&h!=="segment"&&typeof p=="string"&&(f[h]=p);Object.keys(f).length>0&&u.setUnknownAttributes(f);let d=!0;for(const h of c)if(!gv(n,h,i)){d=!1;break}return d?e.length:(i==null||i.error(`Failed to insert CharNode with text "${e}" at index ${n}. Falling back to rich text.`),yl(n,e,void 0,i))}function yl(n,e,t,r){if(e.length<=0)return r==null||r.debug("Attempted to insert empty string. No action taken."),0;const i=me();let s=0,o=!1;function a(l){if(o)return!0;if(W(l)){const c=l.getTextContentSize();if(n>=s&&n<=s+c){const u=n-s,f=de(e);if(Pt(t,f),u===0)l.insertBefore(f);else if(u===c){const d=l.getParent();Me(d)&&!Qr(t)?d.insertAfter(f):l.insertAfter(f)}else{const[,d]=l.splitText(u);d.insertBefore(f)}return r==null||r.debug(`Inserted text "${e}" in/around TextNode (key: ${l.getKey()}) at nodeOffset ${u}. Original targetIndex: ${n}, currentIndex at node start: ${s}.`),o=!0,!0}s+=c}else if(Zt(l))s+=1;else if(Me(l)){if(!o&&n===s){const u=de(e);Pt(t,u);const f=l.getFirstChild();return f?f.insertBefore(u):l.append(u),r==null||r.debug(`Inserted text "${e}" at beginning of CharNode ${l.getType()} (key: ${l.getKey()}).`),o=!0,!0}const c=l.getChildren();for(const u of c){if(a(u))return!0;if(o)break}if(!o&&n===s){const u=de(e);return Pt(t,u),l.append(u),r==null||r.debug(`Appended text "${e}" to end of CharNode ${l.getType()} (key: ${l.getKey()}).`),o=!0,!0}}else if(qt(l)){if(!o&&n===s){const u=de(e);Pt(t,u);const f=l.getFirstChild();return f?f.insertBefore(u):l.append(u),r==null||r.debug(`Inserted text "${e}" at beginning of container ${l.getType()} (key: ${l.getKey()}).`),o=!0,!0}const c=l.getChildren();for(const u of c){if(a(u))return!0;if(o)break}if(!o&&n===s){const u=de(e);return Pt(t,u),l.append(u),r==null||r.debug(`Appended text "${e}" to end of container ${l.getType()} (key: ${l.getKey()}).`),o=!0,!0}s+=1}else if(F(l)){const c=l.getChildren();for(const u of c){if(a(u))return!0;if(o)break}}return o}if(a(i),!o&&n===s){r==null||r.debug(`Insertion point matches end of document (targetIndex: ${n}, final currentIndex: ${s}). Appending text to new ParaNode.`);const l=de(e);Pt(t,l);const c=Vt().append(l);i.append(c),o=!0}return o?e.length:(r==null||r.warn(`$insertRichText: Could not find insertion point for text "${e}" at targetIndex ${n}. Final currentIndex: ${s}. Text not inserted.`),0)}function gv(n,e,t){const r=me();let i=0,s=!1;function o(a){if(s)return!0;if(a===r&&n===0&&!r.getFirstChild())return e.isInline()?(t==null||t.debug(`$insertNodeAtCharacterOffset: Inserting inline node ${e.getType()} into empty root, wrapped in ImpliedParaNode. targetIndex: ${n}`),r.append(Vt().append(e))):(t==null||t.debug(`$insertNodeAtCharacterOffset: Inserting block node ${e.getType()} directly into empty root. targetIndex: ${n}`),r.append(e)),s=!0,!0;if(!F(a))return!1;const l=a.getChildren();for(const c of l){if(n===i&&!s){if(a===r&&e.isInline())if(Kt(c)){t==null||t.debug(`$insertNodeAtCharacterOffset: Inserting inline node ${e.getType()} into existing ${c.getType()} at beginning. targetIndex: ${n}`);const u=c.getFirstChild();u?u.insertBefore(e):c.append(e)}else t==null||t.debug(`$insertNodeAtCharacterOffset: Inserting inline node ${e.getType()} into root before ${c.getType()}, wrapping in ImpliedParaNode. targetIndex: ${n}`),c.insertBefore(Vt().append(e));else c.insertBefore(e),t==null||t.debug(`$insertNodeAtCharacterOffset: Inserted node ${e.getType()} (key: ${e.getKey()}) before child ${c.getType()} (key: ${c.getKey()}) in ${a.getType()} (key: ${a.getKey()}). targetIndex: ${n}, currentIndex: ${i}`);return s=!0,!0}if(W(c)){const u=c.getTextContentSize();if(!s&&n>i&&n<i+u){const f=n-i,[d]=c.splitText(f);return d.insertAfter(e),t==null||t.debug(`$insertNodeAtCharacterOffset: Inserted node ${e.getType()} (key: ${e.getKey()}) by splitting TextNode (key: ${c.getKey()}) at offset ${f}. targetIndex: ${n}, currentIndex at node start: ${i}`),s=!0,!0}i+=u}else if(Zt(c))i+=1;else if(Me(c)){if(o(c))return!0}else if(qt(c)){const u=c;if(o(u))return!0;const f=i;if(Bn(u)&&qt(e)&&n===f&&!s)return t==null||t.debug(`$insertNodeAtCharacterOffset: Replacing ImpliedParaNode (key: ${u.getKey()}) with block node '${e.getType()}' (key: ${e.getKey()}) at OT index ${n}.`),c.replace(e,!0),i=f+1,s=!0,!0;i+=1}else if(F(c)&&o(c))return!0;if(s)return!0}return F(a)&&!s&&(n===i||a===r&&n>i)?a===r?(e.isInline()?(t==null||t.debug(`$insertNodeAtCharacterOffset: Appending inline node ${e.getType()} to root. Wrapping in new ImpliedParaNode. targetIndex: ${n}, current document OT length: ${i}.`),r.append(Vt().append(e))):(t==null||t.debug(`$insertNodeAtCharacterOffset: Appending block node ${e.getType()} to root. targetIndex: ${n}, current document OT length: ${i}.`),r.append(e)),s=!0,!0):Kt(a)?Bn(a)&&dt(e)&&n===i?(t==null||t.debug(`$insertNodeAtCharacterOffset: Replacing ImpliedParaNode container (key: ${a.getKey()}) with ParaNode ${e.getType()} (key: ${e.getKey()}) via append logic. targetIndex: ${n}`),a.replace(e,!0),s=!0,!0):e.isInline()||!Kt(e)?(t==null||t.debug(`$insertNodeAtCharacterOffset: Appending node ${e.getType()} to existing container ${a.getType()} (key: ${a.getKey()}). targetIndex: ${n}, container end OT index: ${i}.`),a.append(e),s=!0,!0):(t==null||t.debug(`$insertNodeAtCharacterOffset: Inserting block node ${e.getType()} after container ${a.getType()} (key: ${a.getKey()}). targetIndex: ${n}, container end OT index: ${i}.`),a.insertAfter(e),s=!0,!0):(Me(a)?(t==null||t.debug(`$insertNodeAtCharacterOffset: Inserting node ${e.getType()} after CharNode (key: ${a.getKey()}). targetIndex: ${n}, element end OT index: ${i}.`),a.insertAfter(e)):e.isInline()||!Kt(e)?(t==null||t.debug(`$insertNodeAtCharacterOffset: Appending node ${e.getType()} to generic element ${a.getType()} (key: ${a.getKey()}). targetIndex: ${n}, element end OT index: ${i}.`),a.append(e)):(t==null||t.debug(`$insertNodeAtCharacterOffset: Inserting block node ${e.getType()} after generic element ${a.getType()} (key: ${a.getKey()}). targetIndex: ${n}, element end OT index: ${i}.`),a.insertAfter(e)),s=!0,!0):s}return o(r),s||t==null||t.warn(`$insertNodeAtCharacterOffset: Could not find insertion point for node ${e.getType()} (key: ${e.getKey()}) at targetIndex ${n}. Final currentIndex: ${i}. Node not inserted.`),s}function FE(n,e,t,r,i){let s;return As("chapter",e)?s=qE(e.insert.chapter,t):As("verse",e)?s=BE(e.insert.verse,t):As("ms",e)?s=UE(e.insert.ms):As("unmatched",e)?s=zE(e.insert.unmatched):As("note",e)&&(s=WE(e,t,r,i)),s?gv(n,s,i):(i==null||i.error(`$insertEmbedAtCurrentIndex: Cannot create LexicalNode for embed object: ${JSON.stringify(e.insert)}`),!1)}function kp(n,e,t){let r;Df(e)?r=pv(e.para):HE(e)&&(r=KE(e.book)),r??(r=Vt());const i=r,s=dt(i),o=Bn(i);let a=0,l=!1;function c(u){if(l)return!0;if(W(u)){const f=u.getTextContentSize();if(n>=a&&n<=a+f){const d=u.getParent();if(dt(d)&&(s||o)){t==null||t.debug(`Splitting ParaNode (marker: ${d.getMarker()}) with LF attributes at targetIndex ${n}`);const h=n-a,[p]=h>0?u.splitText(h):[void 0];let m=p==null?void 0:p.getPreviousSibling();for(;m;){const y=m;m=m.getPreviousSibling();const b=i.getFirstChild();b?b.insertBefore(y):i.append(y)}return p&&i.append(p),d.insertBefore(i),l=!0,!0}}a+=f}else if(Zt(u))a+=1;else if(qt(u)){const f=u.getChildren();for(const d of f){if(c(d))return!0;if(l)break}if(n===a){if(Bn(u)&&i)return t==null||t.debug(`Replacing ImpliedParaNode (key: ${u.getKey()}) with ParaNode at targetIndex ${n}`),u.replace(i,!0),l=!0,!0;if(dt(u)&&i){const d=u;return t==null||t.debug(`Creating new block node with LF attributes after existing ParaNode (marker: ${d.getMarker()}) at targetIndex ${n}`),d.insertAfter(i),l=!0,!0}}if(a+=1,n===a&&dt(u)&&i)return t==null||t.debug(`Creating new block node after existing ParaNode (marker: ${u.getMarker()}) at targetIndex ${n}`),u.insertAfter(i),l=!0,!0}else if(F(u)){const f=u.getChildren();for(const d of f){if(c(d))return!0;if(l)break}}return l}return c(me()),l||t==null||t.warn(`Could not find location to handle newline with para attributes at targetIndex ${n}. Final currentIndex: ${a}.`),1}function qE(n,e){if(!n)return;const{number:t,sid:r,altnumber:i,pubnumber:s}=n;if(!t)return;const o=Ge(n,DT);let a;if(e.markerMode==="editable")a=$b(t,r,i,s,o);else{const l=e.markerMode==="visible";a=bf(t,l,r,i,s,o)}return a}function BE(n,e){if(!n)return;const{style:t,number:r,sid:i,altnumber:s,pubnumber:o}=n;if(!r)return;const a=Ge(n,jT);let l;if(e.markerMode==="editable"){if(!t)return;const c=Eo(t,r);l=Hb(r,c,i,s,o,a)}else{const c=e.markerMode==="visible";l=Of(r,c,i,s,o,a)}return l}function UE(n){if(!n)return;const{style:e,sid:t,eid:r}=n;if(!e)return;const i=Ge(n,FT);return Bb(e,t,r,i)}function zE(n){if(!n)return;const{marker:e}=n;if(e)return Mf(e)}function WE(n,e,t,r){var i;const s=n.insert;if(!s.note)return;const{style:o,caller:a,category:l,contents:c}=s.note;if(!o||a==null)return;a===""&&(r==null||r.warn("Note has empty caller. Only use for note editing."));const u=Ge(s.note,qT),f=(i=n.attributes)==null?void 0:i.segment;let d;f&&typeof f=="string"&&(d=f);const h=[];for(const p of(c==null?void 0:c.ops)??[])if(typeof p.insert=="string")if(Qr(p.attributes)){const m=Mo(p.attributes.char,e,de(p.insert),void 0,h);h.push(...m)}else h.push(de(p.insert));return ov(o,a,h,e,t,d).setCategory(l).setUnknownAttributes(u)}function KE(n){const{style:e,code:t}=n;if(!e||e!==ql||!t||!Ft.isValidBookCode(t))return;const r=Ge(n,LT);return Mb(t,r)}function pv(n){const{style:e}=n;if(!e)return;const t=Ge(n,RT);return oo(e,t)}function Mo(n,e,t,r,i){if(Array.isArray(n)){if(n.length===0)throw new Error("Empty charAttr array");const s=n[0],o=i==null?void 0:i[i.length-1];if(Me(o)&&Xr(s,o))return n.length>1?Mo(n.slice(1),e,t).forEach(u=>o.append(u)):t&&o.append(t),[];const a=n.reduceRight((u,f,d)=>{const h=hn(f.style,Ge(f,ml));if(typeof f.cid=="string"&&Pn(h,Jr,()=>f.cid),r&&d===n.length-1&&Pn(h,Vr,()=>r),u)if(Me(u)){const p=u.getMarker(),m=[];au(p,m,e),m.forEach(b=>h.append(b)),h.append(u);const y=[];lu(p,y,e),y.forEach(b=>h.append(b))}else h.append(u);return h},t),l=[],c=n[0];return au(c.style,l,e),l.push(a),lu(c.style,l,e),l}else{const s=i==null?void 0:i[i.length-1];if(Me(s)&&Xr(n,s))return t&&s.append(t),[];const o=[];au(n.style,o,e);const a=hn(n.style,Ge(n,ml));return typeof n.cid=="string"&&Pn(a,Jr,()=>n.cid),r&&Pn(a,Vr,()=>r),t&&a.append(t),o.push(a),lu(n.style,o,e),o}}function au(n,e,t){(t==null?void 0:t.markerMode)==="editable"?e.push(Gi(n)):(t==null?void 0:t.markerMode)==="visible"&&e.push(Yi("marker",Kn(n)))}function lu(n,e,t,r=!1){Pe.isValidFootnoteMarker(n)||Pe.isValidCrossReferenceMarker(n)||((t==null?void 0:t.markerMode)==="editable"?r?e.push(Gi("","selfClosing")):e.push(Gi(n,"closing")):(t==null?void 0:t.markerMode)==="visible"&&e.push(Yi("marker",Vi(r?"":n))))}function HE(n){return!!n&&!!n.book&&typeof n.book=="object"&&n.book!==null&&"style"in n.book&&typeof n.book.style=="string"&&"code"in n.book&&typeof n.book.code=="string"}function Df(n){return!!n&&!!n.para&&typeof n.para=="object"&&n.para!==null&&"style"in n.para&&typeof n.para.style=="string"}function Qr(n){return!!n&&!!n.char&&typeof n.char=="object"&&n.char!==null&&(!Array.isArray(n.char)&&"style"in n.char&&typeof n.char.style=="string"||Array.isArray(n.char)&&n.char.length>0&&"style"in n.char[0]&&typeof n.char[0].style=="string")}function JE(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&Object.keys(n).length===0}function Pt(n,e){if(n)for(const t of Object.keys(n)){if(t==="segment"&&typeof n[t]=="string"){const r=n[t];Pn(e,Vr,()=>r);continue}if(VE(t)){const r=!!n[t],i=t,s=e.hasFormat(i);(r&&!s||!r&&s)&&e.toggleFormat(i)}}}const mv=["bold","underline","strikethrough","italic","highlight","code","subscript","superscript","lowercase","uppercase","capitalize"];function VE(n){return mv.includes(n)}function GE({viewOptions:n}){const[e]=ge();return YE(e,n),null}function YE(n,e){C.useEffect(()=>{if(!n.hasNodes([Wn,bt,Ve]))throw new Error("ArrowNavigationPlugin: ImmutableChapterNode, ImmutableVerseNode or NoteNode not registered on editor!");const t=r=>{if(r.key!=="ArrowLeft"&&r.key!=="ArrowRight")return!1;const i=K();if(!q(i)||!i.isCollapsed())return!1;const s=n.getRootElement();if(!s)return!1;const o=s.dir||"ltr";let a=!1;return XE(o,r.key)?a=ZE(i):QE(o,r.key)&&(a=eN(i,e)),a&&r.preventDefault(),a};return n.registerCommand(Qi,t,Tl)},[n,e])}function XE(n,e){return n==="ltr"&&e==="ArrowRight"||n==="rtl"&&e==="ArrowLeft"}function QE(n,e){return n==="ltr"&&e==="ArrowLeft"||n==="rtl"&&e==="ArrowRight"}function ZE(n){var e,t,r;const i=n.anchor.getNode(),s=Z1(n);if(pe(s)&&!No(s.getFirstChild())){if(Kt(i)){if(n.anchor.offset===i.getChildrenSize())return!1}else if(n.anchor.offset!==i.getTextContentSize())return!1;if(s.getIsCollapsed()){if(s.is((e=s.getParent())==null?void 0:e.getLastChild()))return(r=(t=s.getParent())==null?void 0:t.getNextSibling())==null||r.selectStart(),!0}else return gl(s.getFirstChild())?s.select(2,2):s.select(1,1),!0}if(Kt(i)&&pe(s)&&s.getIsCollapsed()){const a=s.getNextSibling();return a?a.selectStart():s.selectEnd(),!0}const o=s==null?void 0:s.getParent();if(gl(s)&&pe(o)&&s.is(o==null?void 0:o.getLastChild())){const a=o.getNextSibling();return a?a.selectStart():o.selectEnd(),!0}return!1}function eN(n,e){const t=eT(n);if(To(t)&&!t.getPreviousSibling())return!0;if(n.anchor.offset!==0)return!1;const r=n.anchor.getNode();if(_n(r.getParent()))return!0;if(pe(t)&&t.getIsCollapsed()){const s=t.getPreviousSibling();if(!cs(s))return!1;const o=t.getParent();if(!o)return!1;const a=t.getIndexWithinParent();return o.select(a,a),!0}if(Kt(t)&&(e==null?void 0:e.noteMode)==="collapsed"){const s=t.getLastChild();if(!s)return!1;const o=Qt(s,a=>pe(a));if(pe(o)&&o.getIsCollapsed()){const a=o.getParent();if(!a)return!1;const l=o.getIndexWithinParent();return a.select(l,l),!0}}const i=Jb(r);if(!i||i.getIsCollapsed())return!1;if(kr(t)){const s=i.getParent();if(!s)return!1;const o=i.getIndexWithinParent();return s.select(o,o),!0}return!1}function tN(){const[n]=ge();return nN(n),null}function nN(n){C.useEffect(()=>{if(!n.hasNodes([Pe]))throw new Error("CharNodePlugin: CharNode not registered on editor!");return n.registerNodeTransform(Pe,rN)},[n])}function rN(n){if(!Me(n))return;if(n.isEmpty()){n.remove();return}const e=n.getMarker(),t=Ri(n,Jr),r=n.getUnknownAttributes(),i=n.getNextSibling();Me(i)&&Xr({style:e,cid:t},i)&&$n(r,i.getUnknownAttributes())&&(n.append(...i.getChildren()),i.remove());const s=n.getPreviousSibling();Me(s)&&Xr({style:e,cid:t},s)&&$n(r,s.getUnknownAttributes())&&(s.append(...n.getChildren()),n.remove())}function yv(n){return n.replaceAll("	"," ")}const jf=n=>{navigator.clipboard.read().then(async e=>{if((await navigator.permissions.query({name:"clipboard-read"})).state==="denied"){alert("Not allowed to paste from clipboard.");return}const t=new DataTransfer,r=e[0];for(const s of r.types){const o=await(await r.getType(s)).text();t.setData(s,yv(o))}const i=new ClipboardEvent("paste",{clipboardData:t});n.dispatchCommand(ti,i)})},Ff=n=>{navigator.clipboard.read().then(async()=>{if((await navigator.permissions.query({name:"clipboard-read"})).state==="denied"){alert("Not allowed to paste from clipboard.");return}const e=new DataTransfer,t=await navigator.clipboard.readText();e.setData("text/plain",yv(t));const r=new ClipboardEvent("paste",{clipboardData:e});n.dispatchCommand(ti,r)})};function iN(){const[n]=ge();return C.useEffect(()=>{const e=t=>{const{key:r,shiftKey:i,metaKey:s,ctrlKey:o,altKey:a}=t;!(Ru?s:o)||a||(!i&&r.toLowerCase()==="c"?(t.preventDefault(),n.dispatchCommand(hr,null)):!i&&r.toLowerCase()==="x"?(t.preventDefault(),n.dispatchCommand(ni,null)):r.toLowerCase()==="v"&&(t.preventDefault(),i?Ff(n):jf(n)))};return n.registerRootListener((t,r)=>{r!==null&&r.removeEventListener("keydown",e),t!==null&&t.addEventListener("keydown",e)})},[n]),null}function sN({logger:n}){const[e]=ge();return C.useEffect(()=>He(e.registerCommand(Qi,t=>t.key!=="\\"&&t.key!=="/"?!1:(t.preventDefault(),!0),Oa),e.registerCommand(ti,t=>{var r;const i=(r=t.clipboardData)==null?void 0:r.getData("text/plain");return!i||!i.includes("\\")&&!i.includes("/")?!1:(n==null||n.info("CommandMenuPlugin: paste containing backslash or forward slash ignored."),t.preventDefault(),!0)},Oa),e.registerCommand(Cl,t=>{var r;const i=(r=t.dataTransfer)==null?void 0:r.getData("text/plain");return!i||!i.includes("\\")&&!i.includes("/")?!1:(n==null||n.info("CommandMenuPlugin: drag containing backslash or forward slash ignored."),t.preventDefault(),!0)},Oa)),[e,n]),null}function oN({index:n,isSelected:e,onClick:t,onMouseEnter:r,option:i}){let s="item";return e&&(s+=" selected"),i.isDisabled&&(s+=" disabled"),S.jsx("li",{tabIndex:-1,className:s,ref:i.setRefElement,role:"option","aria-selected":e,"aria-disabled":i.isDisabled,id:"typeahead-item-"+n,onMouseEnter:r,onClick:i.isDisabled?void 0:t,children:S.jsx("span",{className:"text",children:i.title})},i.key)}function aN({options:n,selectedItemIndex:e,onOptionClick:t,onOptionMouseEnter:r}){return S.jsx("div",{className:"typeahead-popover",children:S.jsx("ul",{children:n.map((i,s)=>S.jsx(oN,{index:s,isSelected:e===s,onClick:()=>t(i,s),onMouseEnter:()=>r(s),option:i},i.key))})})}class ga extends g0{constructor(e,t){super(e),Z(this,"title"),Z(this,"onSelect"),Z(this,"isDisabled"),this.title=e,this.onSelect=t.onSelect.bind(this),this.isDisabled=t.isDisabled||!1}}function lN(n,e="editor-input"){return n?n.classList.contains(e):!1}function cN(){const[n]=ge(),[e,t]=C.useState(()=>!n.isEditable()),r=C.useRef(void 0),i=C.useRef(void 0),s=C.useRef(void 0),o=C.useMemo(()=>[new ga("Cut",{onSelect:()=>{n.dispatchCommand(ni,null)},isDisabled:e}),new ga("Copy",{onSelect:()=>{n.dispatchCommand(hr,null)}}),new ga("Paste",{onSelect:()=>{jf(n)},isDisabled:e}),new ga("Paste as Plain Text",{onSelect:()=>{Ff(n)},isDisabled:e})],[n,e]),a=C.useCallback((l,c,u)=>{n.update(()=>{l==null||l.onSelect(c),u()})},[n]);return C.useEffect(()=>{var l;i.current=((l=n.getRootElement())==null?void 0:l.className)??""},[n]),C.useEffect(()=>{const l=()=>{var c;(c=s.current)==null||c.call(s)};return window.addEventListener("scroll",l,!0),()=>{window.removeEventListener("scroll",l,!0)}},[]),C.useEffect(()=>n.registerEditableListener(l=>{t(!l)}),[n]),S.jsx(y0,{options:o,onSelectOption:a,onWillOpen:l=>{r.current=l.target},menuRenderFn:(l,{selectedIndex:c,options:u,selectOptionAndCleanUp:f,setHighlightedIndex:d},{setMenuRef:h})=>(s.current=()=>f(void 0),l.current&&!lN(r.current,i.current)&&!jb(r.current)?Nt.createPortal(S.jsx("div",{className:"typeahead-popover auto-embed-menu",style:{marginLeft:l.current.style.width,userSelect:"none",width:200},ref:h,children:S.jsx(aN,{options:o,selectedItemIndex:c,onOptionClick:(p,m)=>{p.isDisabled||(d(m),f(p))},onOptionMouseEnter:p=>{d(p)}})}),l.current):null)})}function uN({isEditable:n}){const[e]=ge();return C.useLayoutEffect(()=>{e.setEditable(n)},[e,n]),null}function dN({scripture:n,nodeOptions:e,editorAdaptor:t,viewOptions:r,logger:i}){const[s]=ge();return C.useEffect(()=>{var o;(o=t.initialize)==null||o.call(t,e,i)},[t,i,e]),C.useEffect(()=>{var o;(o=t.reset)==null||o.call(t);const a=t.serializeEditorState(n,r);if(a==null){i==null||i.warn("LoadStatePlugin: serializedEditorState was null or undefined. Skipping editor update.");return}try{const l=s.parseEditorState(a);queueMicrotask(()=>{s.update(()=>{s.setEditorState(l),s.dispatchCommand(Vm,void 0)},{tag:mf})})}catch{i==null||i.error("LoadStatePlugin: error parsing or setting editor state.")}},[s,t,i,n,r]),null}function fN({expandedNoteKeyRef:n,nodeOptions:e,viewOptions:t,logger:r}){const[i]=ge();return hN(e,r),gN(i,n,t,r),null}function hN(n,e){const t=C.useRef(void 0),r=n.noteCallers;C.useEffect(()=>{let i=r;(!i||i.length<=0)&&(i=cE),t.current!==i&&(t.current=i,xN("note-callers",i,e))},[e,r])}function gN(n,e,t,r){C.useEffect(()=>{if(!n.hasNodes([Pe,Ve,Gt]))throw new Error("NoteNodePlugin: CharNode, NoteNode or ImmutableNoteCallerNode not registered on editor!");const i=s=>n.update(()=>kN(s));return He(n.registerNodeTransform(Ve,s=>pN(s,t)),n.registerNodeTransform(Pe,mN),n.registerNodeTransform(At,yN),n.registerNodeTransform(Gt,_N),n.registerMutationListener(Gt,(s,{prevEditorState:o})=>bN(s,o)),n.registerCommand(fr,()=>vN(n,e,t,r),ri),n.registerRootListener((s,o)=>{o!==null&&o.removeEventListener("dblclick",i),s!==null&&s.addEventListener("dblclick",i)}))},[n,e,r,t])}function pN(n,e){const t=n.getChildren();if(!t.some(r=>kr(r))&&(e==null?void 0:e.markerMode)!=="editable"&&n.getCaller()!==""&&n.remove(),t.length>0){const r=t[0];W(r)&&!No(r)&&n.insertBefore(r)}}function mN(n){const e=n.getParentOrThrow(),t=e.getChildren(),r=t.find(o=>kr(o));if(!Me(n)||!pe(e)||!r)return;const i=Ef(t);r.getPreviewText()!==i&&r.setPreviewText(i);const s=n.getNextSibling();W(s)?s.getTextContent()!==Ne&&s.setTextContent(Ne):n.insertAfter(de(Ne))}function yN(n){const e=Jb(n),t=e==null?void 0:e.getChildren(),r=t==null?void 0:t.find(s=>kr(s));if(!W(n)||!pe(e)||!r||!t)return;const i=Ef(t);r.getPreviewText()!==i&&r.setPreviewText(i),!(No(n)||!pe(n.getParent()))&&n.getTextContent()!==Ne&&(n.setTextContent(Ne),n.selectEnd())}function _N(n){if(!kr(n))return;const e=n.getNextSibling();!W(e)||No(e)?n.insertAfter(de(Ne)):e.getTextContent()!==Ne&&e.setTextContent(Ne)}function bN(n,e){for(const[t,r]of n){if(r!=="destroyed")continue;const i=e.read(()=>{const o=ce(t),a=o==null?void 0:o.getParent();return kr(o)&&pe(a)&&a.getCaller()===Gr}),s=document.querySelector(".editor-input");!i||!s||(s.classList.add("reset-counters"),s.offsetHeight,s.classList.remove("reset-counters"))}}function vN(n,e,t,r){var i;if((t==null?void 0:t.noteMode)!=="expandInline")return!1;const s=K();if(!q(s)||!s.isCollapsed())return!1;const o=s.anchor,a=o.getNode();if(e.current){const l=Qt(a,c=>pe(c));if(l)e.current!==l.getKey()&&(e.current=l.getKey());else{const c=ce(e.current);c&&!c.getIsCollapsed()&&(r==null||r.debug("Cursor moved away from NoteNode, collapsing it"),Os(n,e.current,r)),e.current=void 0}}if(o.offset===0){const l=a.getPreviousSibling();if(pe(l)){r==null||r.debug("Cursor is just after a NoteNode");const c=l.getKey();l.getIsCollapsed()?e.current=c:e.current=void 0,Os(n,c,r)}}if(o.offset===a.getTextContentSize()){const l=a.getNextSibling();if(pe(l)){r==null||r.debug("Cursor is just before a NoteNode");const c=l.getKey();l.getIsCollapsed()?e.current=c:e.current=void 0,Os(n,c,r)}else if(!l){const c=Qt(a,u=>pe(u));if(c&&c.getIsCollapsed()&&Kt(c.getParent())&&c.is((i=c.getParent())==null?void 0:i.getLastChild())){r==null||r.debug("Cursor is at end of note at end of para");const u=c.getKey();e.current=u,Os(n,u,r)}}}if(Kt(a)){const l=a.getChildAtIndex(o.offset),c=l==null?void 0:l.getPreviousSibling();if(cs(c)&&pe(l)){r==null||r.debug("Cursor is between verse and NoteNode");const u=l.getKey();l.getIsCollapsed()?e.current=u:e.current=void 0,Os(n,u,r)}}return!1}function Os(n,e,t){const r=ce(e);try{r==null||r.toggleIsCollapsed()}catch(i){if(i instanceof Error&&i.message.includes("read only"))t==null||t.warn("Fallback triggered after stabilization - edge case"),setTimeout(()=>{n.update(()=>{r==null||r.toggleIsCollapsed()})},0);else throw i}}function kN(n){const e=K();if(!q(e))return;const t=e.anchor,r=e.focus,i=t.getNode(),s=r.getNode();if(pe(i)&&W(s)){n.preventDefault();const o=yo();o.anchor.set(s.getKey(),0,"text"),o.focus.set(s.getKey(),r.offset,"text"),it(o)}}function xN(n,e,t){for(const r of document.styleSheets)try{const i=r.cssRules||r.rules;for(const s of i)if(CN(s,n)){const o=e.map(a=>`"${a}"`).join(" ");s.symbols=o;return}}catch{continue}t==null||t.warn(`Editor: counter style "${n}" not found.`)}function CN(n,e){return typeof n=="object"&&n!==null&&"name"in n&&n.name===e&&"symbols"in n&&typeof n.symbols=="string"}function wN({onChange:n}){const[e]=ge();return C.useEffect(()=>e.registerCommand(fr,()=>{const t=e.read(()=>nv());return n==null||n(t),!1},ri),[e,n]),null}function SN(){const[n]=ge();return TN(n),null}function TN(n){C.useEffect(()=>{if(!n.hasNodes([St]))throw new Error("ParaNodePlugin: ParaNode not registered on editor!");return n.registerNodeTransform(St,e=>EN(e,n))},[n])}function EN(n,e){If(e,n.getKey())&&lv(n.getFirstChild()),!(!dt(n)||n.getMarker()!=="b"||n.isEmpty()||!e.getEditorState().read(()=>{const t=ce(n.getKey());return dt(t)&&((t==null?void 0:t.isEmpty())??!1)}))&&n.clear()}function _v({onStateChange:n}){const[e]=ge(),[t,r]=C.useState(e),i=C.useRef(!1),s=C.useRef(!1),o=C.useRef(),a=C.useCallback(()=>{const l=K();if(q(l)){const c=l.anchor.getNode();let u=c.getKey()==="root"?c:Qt(c,d=>{const h=d.getParent();return h!==null&&vn(h)});u===null&&(u=c.getTopLevelElementOrThrow());const f=u.getKey();t.getElementByKey(f)!==null&&(dt(u)||_n(u)||To(u))&&(o.current=u.getMarker(),n==null||n(i.current,s.current,o.current))}},[t,n]);return C.useEffect(()=>e.registerCommand(fr,(l,c)=>(a(),r(c),!1),Ni),[e,a]),C.useEffect(()=>He(t.registerUpdateListener(({editorState:l})=>{l.read(()=>{a()})}),t.registerCommand(Ps,l=>(i.current=l,n==null||n(i.current,s.current,o.current),!1),Ni),t.registerCommand(Is,l=>(s.current=l,n==null||n(i.current,s.current,o.current),!1),Ni)),[a,t,n]),null}function NN({textDirection:n}){const[e]=ge();return MN(e,n),AN(e),null}function MN(n,e){C.useEffect(()=>{function t(){const r=n.getRootElement();if(!r||e==="auto")return;r.dir=e;const i=n._config.theme.placeholder,s=document.getElementsByClassName(i)[0];s&&(s.dir=e)}return t(),n.registerUpdateListener(({dirtyElements:r})=>{r.size>0&&t()})},[n,e])}function AN(n){C.useEffect(()=>{const e=t=>{if(t.key!=="ArrowLeft"&&t.key!=="ArrowRight")return!1;const r=K();if(!q(r))return!1;const i=r.anchor.getNode(),s=Qt(i,f=>aT(f,n)==="p");if(!s)return!1;const o=n.getElementByKey(s.getKey());if(!o)return!1;const a=o.parentElement,l=o.dir||"ltr",c=((a==null?void 0:a.dir)??"")||"ltr";if(!a||l===c)return!1;const u=a.dir==="rtl"&&t.key==="ArrowLeft"||a.dir==="ltr"&&t.key==="ArrowRight";return r.modify("move",u,"character"),t.preventDefault(),!0};return n.registerCommand(Qi,e,Tl)},[n])}function ON(){const[n]=ge();return $N(n),null}function $N(n){C.useEffect(()=>{if(!n.hasNodes([Pe,bt,Ve,At,_t]))throw new Error("TextSpacingPlugin: CharNode, ImmutableVerseNode, NoteNode, TextNode or VerseNode not registered on editor!");return He(n.registerNodeTransform(At,IN),n.registerNodeTransform(At,e=>PN(e,n)),n.registerNodeTransform(_t,xp),n.registerNodeTransform(bt,xp))},[n])}function IN(n){if(!n.isAttached())return;const e=n.getTextContent(),t=n.getNextSibling(),r=n.getParent();n.getMode()!=="normal"||e.endsWith(" ")&&e.length>1||pe(t)||Me(r)||rt(r)||So(r)||(e===" "&&!Dt(t)?n.setTextContent(""):$f(n))}function PN(n,e){const t=n.getParent();!So(t)||!n.isAttached()||If(e,n.getKey())&&t.insertAfter(n)}function xp(n){if(!n.isAttached())return;const e=n.getPreviousSibling();e&&!Dt(e)&&!W(e)&&!So(e)&&n.insertBefore(de(" "))}function RN({trigger:n,scriptureReference:e,contextMarker:t,getMarkerAction:r}){const{markersMenuItems:i}=NE({scriptureReference:e,contextMarker:t,getMarkerAction:r});return S.jsx(EE,{trigger:n,items:i})}function LN({trigger:n,scrRef:e,getMarkerAction:t}){const{book:r,chapterNum:i,verseNum:s,verse:o}=e,a=C.useMemo(()=>e,[r,i,s,o]),[l]=ge(),[c]=DN(l);return jN(l),S.jsx(RN,{trigger:n,scriptureReference:a,contextMarker:c,getMarkerAction:t})}function DN(n){const[e,t]=C.useState();return C.useEffect(()=>n.registerCommand(fr,()=>(n.read(()=>{const r=K();if(!q(r)){e&&t(void 0);return}const i=ce(r.anchor.key),s=ce(r.focus.key);if(!i||!s){e&&t(void 0);return}const o=nT(i,s);if(!o||!PT(o)){e&&t(void 0);return}const a=o.getMarker();e!==a&&t(a)}),!1),ri),[e,n]),[e]}function jN(n){C.useEffect(()=>{if(!n.hasNodes([_t,bt]))throw new Error("UsjNodesMenuPlugin: VerseNode or ImmutableVerseNode not registered on editor!");const e={},t={};return He(n.registerNodeTransform(bt,r=>Cp(r,n,e)),n.registerNodeTransform(_t,r=>Cp(r,n,e)),n.registerMutationListener(bt,r=>Ep(r,n,e,t)),n.registerMutationListener(_t,r=>Ep(r,n,e,t)))},[n])}function Cp(n,e,t){Ax(mf)||If(e,n.getKey())&&BN(n,t)}function wp(n){return RegExp(/(\d+)([a-zA-Z]+)?(-(\d+)([a-zA-Z]+)?)?/).exec(n)}const Sp=2,FN=3,Tp=4,qN=5;function BN(n,e){var t;const r=wf(n),i=r==null?void 0:r.getNumber();if(!i)return;const s=e[i];if(!s)return;let o=parseInt(n.getNumber()),a=((t=wp(n.getNumber()))==null?void 0:t[Sp])??"";s.forEach(l=>{const c=ce(l);if(!c)return;const u=c.getNumber(),f=parseInt(u),d=wp(u),h=!!(d!=null&&d[FN]),p=h?parseInt(d[Tp]):f;if(p<o||f>o||p===o&&a)return;const m=(d==null?void 0:d[Sp])??"",y=(d==null?void 0:d[qN])??"",b=h?rd(parseInt(d[Tp]),void 0):"";let _=`${m}`;_+=h?`-${b}${y}`:"";const x=rd(f,void 0);c.setNumber(`${x}${_}`),o=parseInt(h?b:x),a=h?y:m})}function Ep(n,e,t,r){e.getEditorState().read(()=>{for(const[i,s]of n){const o=ce(i);if(Dt(o)){if(s==="created"){const a=wf(o);if(!a)continue;const l=a.getNumber();t[l]||(t[l]=[]),t[l].push(i),r[i]=l}else if(s==="destroyed"){const a=r[i],l=t[a];if(!l)continue;const c=l.findIndex(u=>u===i);if(c===-1)continue;l.splice(c,1),Reflect.deleteProperty(r,i)}}}})}const bv="formatted",UN="unformatted";let qf;function zN(n){const e=WN(n);if(!e)throw new Error(`Invalid view mode: ${n}`);qf=e}zN(bv);const Ao=()=>qf;function WN(n){let e;switch(n){case bv:e={markerMode:"hidden",noteMode:"collapsed",hasSpacing:!0,isFormattedFont:!0};break;case UN:e={markerMode:"editable",noteMode:"expanded",hasSpacing:!1,isFormattedFont:!1};break}return e}function KN(n){if(n)return n.markerMode==="editable"?_t:bt}function HN(n){const e=[],t=n??qf;return t&&(e.push(`${M1}${t.markerMode}`),t.hasSpacing&&e.push(E1),t.isFormattedFont&&e.push(N1)),e}let od;function JN(n){n&&(od=n)}function VN(n){return n.isEmpty()?Tm:GN(n.toJSON())}function GN(n){if(!n.root||!n.root.children)return;const e=n.root.children;if(e.length===1&&vf(e[0])&&(!e[0].children||e[0].children.length===0))return Tm;const t=vv(e),r=Gn(t);return r?{type:Ws,version:Ks,content:r}:void 0}function YN(n,e){const{type:t,marker:r,unknownAttributes:i}=n;let s;return n.code!==""&&(s=n.code),Ue({type:t,marker:r,code:s,...i,content:e})}function XN(n){const{marker:e,number:t,sid:r,altnumber:i,pubnumber:s,unknownAttributes:o}=n;return Ue({type:nn.getType(),marker:e,number:t,sid:r,altnumber:i,pubnumber:s,...o})}function QN(n,e){const{marker:t,sid:r,altnumber:i,pubnumber:s,unknownAttributes:o}=n,a=e&&typeof e[0]=="string"?e[0]:void 0;let{number:l}=n;return l=Vb(t,a,l),Ue({type:nn.getType(),marker:t,number:l,sid:r,altnumber:i,pubnumber:s,...o})}function ZN(n){const{marker:e,sid:t,altnumber:r,pubnumber:i,unknownAttributes:s}=n,{text:o}=n;let{number:a}=n;return a=Vb(e,o,a),Ue({type:_t.getType(),marker:e,number:a,sid:t,altnumber:r,pubnumber:i,...s})}function eM(n,e){const{type:t,marker:r,unknownAttributes:i}=n;return e==null||e.forEach((s,o)=>{typeof s=="string"&&s.startsWith(Ne)&&(e[o]=s.slice(1))}),Ue({type:t,marker:r,...i,content:e})}function tM(n,e){const{type:t,marker:r,unknownAttributes:i}=n;return Ue({type:t,marker:r,...i,content:e})}function nM(n,e){const{type:t,marker:r,caller:i,category:s,unknownAttributes:o}=n;return Ue({type:t,marker:r,caller:i,category:s,...o,content:e})}function Si(n){const{type:e,marker:t,sid:r,eid:i,unknownAttributes:s}=n;return Ue({type:e,marker:t,sid:r,eid:i,...s})}function rM(n){return n.text}function iM(n,e){const{tag:t,marker:r,unknownAttributes:i}=n;return Ue({type:t,marker:r,...i,content:e})}function sM(n){const{marker:e}=n;return{type:pl,marker:e}}function Np(n,e){const t=n[n.length-1];t&&typeof t=="string"?n[n.length-1]=t+e:n.push(e)}function oM(n,e,t,r,i){const s=bn.getType(),o=e.filter(a=>!t.includes(a));if(t.filter(a=>!e.includes(a)).forEach(a=>{const l=Si({type:s,marker:$i,eid:a});i.push(l)}),o.forEach(a=>{const l=Si({type:s,marker:Yr,sid:a});i.push(l)}),e.length===0){const a=Si({type:s,marker:Yr});i.push(a)}if(i.push(...n),e.length===0){const a=Si({type:s,marker:$i});i.push(a)}(!r||!hT(r))&&e.forEach(a=>{const l=Si({type:s,marker:$i,eid:a});i.push(l)})}function Gn(n,e){const t=[];let r,i=[];return n.forEach((s,o)=>{const a=s,l=s,c=s,u=s,f=s,d=s,h=s,p=s;switch(s.type){case Ft.getType():t.push(YN(a,Gn(a.children)));break;case Wn.getType():t.push(XN(s));break;case nn.getType():t.push(QN(l,Gn(l.children)));break;case bt.getType():case _t.getType():t.push(ZN(s));break;case Pe.getType():t.push(eM(c,Gn(c.children)));break;case St.getType():t.push(tM(u,Gn(u.children)));break;case Ve.getType():t.push(nM(f,Gn(f.children,f.caller)));break;case br.getType():case Gt.getType():case ho.getType():case ai.getType():break;case tt.getType():if(r=Gn(h.children),r){const m=h.typedIDs[tr];if(m)oM(r,m,i,n[o+1],t),i=m;else{const y=r.shift();y&&(typeof y=="string"?Np(t,y):t.push(y)),r.length>0&&t.push(...r)}}break;case bn.getType():t.push(Si(s));break;case At.getType():d.text&&d.text!==Ne&&!d.text.startsWith(hf)&&(!e||d.text!==Tf(e))&&Np(t,rM(d));break;case oi.getType():t.push(iM(p,Gn(p.children)));break;case vr.getType():t.push(sM(s));break;default:od==null||od.error(`Unexpected node type '${s.type}'!`)}}),t&&t.length>0?t:void 0}function vv(n){const e=n.findIndex(t=>vf(t));if(e>=0){const t=n.slice(0,e),r=n[e].children,i=vv(n.slice(e+1));n=[...t,...r,...i]}return n}const cu={initialize:JN,deserializeEditorState:VN},Mp=kv([]),aM={type:ho.getType(),version:1};let _l=[],ae,Fa,ad,$e;function lM(n,e){_l=[],dM(n),fM(e)}function cM(n=0){}function uM(n,e){ae=e??Ao();let t;return n?(n.type!==Ws&&($e==null||$e.warn(`This USJ type '${n.type}' didn't match the expected type '${Ws}'.`)),n.version!==Ks&&($e==null||$e.warn(`This USJ version '${n.version}' didn't match the expected version '${Ks}'.`)),n.content.length>0?t=cd(js(n.content)):t=[Mp]):t=[Mp],ad==null||ad(_l),{root:{children:t,direction:null,format:"",indent:0,type:"root",version:1}}}function dM(n){n&&(Fa=n),n!=null&&n.addMissingComments&&(ad=n.addMissingComments)}function fM(n){n&&($e=n)}function hM(n){return!n||n.length!==1||typeof n[0]!="string"?"":n[0]}function gM(n){const{marker:e,code:t}=n;e!==ql&&($e==null||$e.warn(`Unexpected book marker '${e}'!`)),(!t||!Ft.isValidBookCode(t))&&($e==null||$e.warn(`Unexpected book code '${t}'!`));const r=[];((ae==null?void 0:ae.markerMode)==="editable"||(ae==null?void 0:ae.markerMode)==="visible")&&r.push(ei("marker",Kn(e)+" "+t+Ne));const i=hM(n.content);i&&r.push(Zr(i));const s=Ge(n);return Ue({type:Ft.getType(),marker:e,code:t??"",unknownAttributes:s,children:r,direction:null,format:"",indent:0,version:Nb})}function pM(n){const{marker:e,number:t,sid:r,altnumber:i,pubnumber:s}=n;e!==yf&&($e==null||$e.warn(`Unexpected chapter marker '${e}'!`));const o=Ge(n);let a;return(ae==null?void 0:ae.markerMode)==="visible"&&(a=!0),(ae==null?void 0:ae.markerMode)==="editable"?Ue({type:nn.getType(),marker:e,number:t??"",sid:r,altnumber:i,pubnumber:s,unknownAttributes:o,children:[Zr(Eo(e,t)??"")],direction:null,format:"",indent:0,version:Ob}):Ue({type:Wn.getType(),marker:e,number:t??"",showMarker:a,sid:r,altnumber:i,pubnumber:s,unknownAttributes:o,version:Lb})}function mM(n){const{marker:e,number:t,sid:r,altnumber:i,pubnumber:s}=n;e!==xf&&($e==null||$e.warn(`Unexpected verse marker '${e}'!`));const o=(KN(ae)??bt).getType(),a=(ae==null?void 0:ae.markerMode)==="editable"?Kb:iv;let l,c;(ae==null?void 0:ae.markerMode)==="editable"?l=Eo(e,t):(ae==null?void 0:ae.markerMode)==="visible"&&(c=!0);const u=Ge(n);return Ue({type:o,text:l,marker:e,number:t??"",sid:r,altnumber:i,pubnumber:s,showMarker:c,unknownAttributes:u,version:a})}function yM(n,e=[]){const{marker:t}=n;Pe.isValidMarker(t)||$e==null||$e.warn(`Unexpected char marker '${t}'!`),(ae==null?void 0:ae.markerMode)==="editable"&&e.forEach(i=>{Sf(i)&&(i.text=Ne+i.text)});const r=Ge(n);return Ue({type:Pe.getType(),marker:t,unknownAttributes:r,children:[...e],direction:null,format:"",indent:0,textFormat:0,textStyle:"",version:Rb})}function kv(n){return{type:ur.getType(),children:n,direction:null,format:"",indent:0,textFormat:0,textStyle:"",version:Fb}}function _M(n,e=[]){const{marker:t}=n;St.isValidMarker(t)||$e==null||$e.warn(`Unexpected para marker '${t}'!`);const r=[];(ae==null?void 0:ae.markerMode)==="editable"?r.push(Xi(t),Zr(Ne)):(ae==null?void 0:ae.markerMode)==="visible"&&r.push(ei("marker",Kn(t)+Ne)),r.push(...e);const i=Ge(n);return Ue({type:St.getType(),marker:t,unknownAttributes:i,children:r,direction:null,format:"",indent:0,textFormat:0,textStyle:"",version:Wb})}function bM(n,e){const t=oT(e);let r=()=>{};return Fa!=null&&Fa.noteCallerOnClick&&(r=Fa.noteCallerOnClick),Ue({type:Gt.getType(),caller:n,previewText:t,onClick:r,version:dv})}function vM(n,e){const{marker:t,category:r}=n;Ve.isValidMarker(t)||$e==null||$e.warn(`Unexpected note marker '${t}'!`);const i=n.caller??"*",s=(ae==null?void 0:ae.noteMode)!=="expanded",o=Ge(n);let a,l;(ae==null?void 0:ae.markerMode)==="editable"?(a=Xi(t),l=Xi(t,"closing")):(ae==null?void 0:ae.markerMode)==="visible"&&(a=ei("marker",Kn(t)+Ne),l=ei("marker",Vi(t)+Ne));const c=[];let u;if(a&&c.push(a),(ae==null?void 0:ae.markerMode)==="editable")u=Zr(Tf(i)),c.push(u,...e);else{const f=Zr(Ne);u=bM(i,e),c.push(u,f,...e.flatMap(kM(f)))}return l&&c.push(l),Ue({type:Ve.getType(),marker:t,caller:i,isCollapsed:s,category:r,unknownAttributes:o,children:c,direction:null,format:"",indent:0,version:zb})}function kM(n){return e=>yT(e)?[e]:[e,n]}function xM(n){const{marker:e,sid:t,eid:r}=n;(!e||!bn.isValidMarker(e))&&($e==null||$e.warn(`Unexpected milestone marker '${e}'!`));const i=Ge(n);return Ue({type:bn.getType(),marker:e,sid:t,eid:r,unknownAttributes:i,version:qb})}function Ap(n,e=[]){return{type:tt.getType(),typedIDs:{[tr]:e},children:n,direction:null,format:"",indent:0,version:1}}function CM(n,e){const{marker:t}=n,r=n.type,i=Ge(n),s=[...e];return s.forEach(o=>{Sf(o)&&(o.mode="token")}),Ue({type:oi.getType(),tag:r,marker:t,unknownAttributes:i,children:s,direction:null,format:"",indent:0,version:Tb})}function wM(n){return{type:vr.getType(),marker:n,version:ev}}function Xi(n,e="opening"){return{type:ai.getType(),marker:n,markerSyntax:e,text:"",detail:0,format:0,mode:"normal",style:"",version:1}}function Zr(n,e="normal"){return{type:At.getType(),text:n,detail:0,format:0,mode:e,style:"",version:1}}function ei(n,e){return{type:br.getType(),text:e,textType:n,version:Zb}}function Op(n,e){(ae==null?void 0:ae.markerMode)==="editable"?e.push(Xi(n)):(ae==null?void 0:ae.markerMode)==="visible"&&e.push(ei("marker",Kn(n)))}function $p(n,e,t=!1){Pe.isValidFootnoteMarker(n)||Pe.isValidCrossReferenceMarker(n)||((ae==null?void 0:ae.markerMode)==="editable"?t?e.push(Xi("","selfClosing")):e.push(Xi(n,"closing")):(ae==null?void 0:ae.markerMode)==="visible"&&e.push(ei("marker",Vi(t?"":n))))}function SM(n,e){if(n.type!=="ms")return;const t=[];if(n.sid&&t.push(`sid="${n.sid}"`),n.eid&&t.push(`eid="${n.eid}"`),t.length<=0)return;const r=hf+t.join(" ");(ae==null?void 0:ae.markerMode)==="editable"?e.push(Zr(r)):(ae==null?void 0:ae.markerMode)==="visible"&&e.push(ei("attribute",r))}function Ip(n,e){return n.length<=0||e===0?n:n.map(t=>t-e)}function TM(n,e){const t=n.indexOf(e,0);t>-1&&n.splice(t,1)}function Pp(n,e){e.marker===Yr&&e.sid!==void 0&&n.push(e.sid),e.marker===$i&&e.eid!==void 0&&TM(n,e.eid)}function ld(n,e,t=!1,r=[]){if(e.length<=0||e[0]>=n.length)return n;const i=e.shift(),s=e.length>0?e.shift():n.length-1;if(i===void 0||s===void 0||s>=n.length||n.length<=0)return n;const o=n.slice(0,i),a=t?[Ap(o,[...r])]:o,l=n[i];Pp(r,l);const c=ld(n.slice(i+1,s),Ip(e,i+1),l.marker===Yr,r),u=Ap(c,[...r]),f=n[s];Pp(r,f);const d=ld(n.slice(s+1),Ip(e,s+1),f.marker===Yr,r);return[...a,u,...d]}function js(n){const e=[],t=[];return n==null||n.forEach(r=>{if(typeof r=="string")r&&t.push(Zr(r));else if(!r.type)$e==null||$e.error("Marker type is missing!");else switch(r.type){case Ft.getType():t.push(gM(r));break;case nn.getType():t.push(pM(r));break;case _t.getType():ae!=null&&ae.hasSpacing||t.push(aM),t.push(mM(r));break;case Pe.getType():Op(r.marker,t),t.push(yM(r,js(r.content))),$p(r.marker,t);break;case St.getType():t.push(_M(r,js(r.content)));break;case Ve.getType():t.push(vM(r,js(r.content)));break;case bn.getType():B1(r.marker)&&(e.push(t.length),r.sid!==void 0&&(_l==null||_l.push(r.sid))),t.push(xM(r)),Op(r.marker,t),SM(r,t),$p(r.marker,t,!0);break;case vr.getType():t.push(wM(r.marker));break;default:$e==null||$e.warn(`Unknown type-marker '${r.type}-${r.marker}'!`),t.push(CM(r,js(r.content)))}}),ld(t,e)}function cd(n){const e=n.findIndex(t=>T1(t)||G1(t)||J1(t));if(e>=0){const t=cd(n.slice(0,e)),r=n[e],i=cd(n.slice(e+1));return[...t,r,...i]}else if(n.some(t=>"text"in t&&"mode"in t||TT(t)))return[kv(n)];return n}const ud={initialize:lM,reset:cM,serializeEditorState:uM},pa=n=>{if(!Ve.isValidMarker(n)||!n.includes("f"))throw new Error(`Invalid footnote marker '${n}'`);return{action:e=>{const{chapterNum:t,verseNum:r}=e.reference,i=[];return t!==void 0&&r!==void 0&&i.push({type:"char",marker:"fr",content:[`${t}:${r}`]}),e.noteText&&i.push({type:"char",marker:"fq",content:[e.noteText]}),i.push({type:"char",marker:"ft",content:["-"]}),[{type:"note",marker:n,caller:Gr,content:i}]}}},Rp=n=>{if(!Ve.isValidMarker(n)||!n.includes("x"))throw new Error(`Invalid cross-reference marker '${n}'`);return{action:e=>{const{chapterNum:t,verseNum:r}=e.reference,i=[];return t!==void 0&&r!==void 0&&i.push({type:"char",marker:"xo",content:[`${t}:${r}`]}),i.push({type:"char",marker:"xt",content:["-"]}),[{type:"note",marker:n,caller:pf,content:i}]}}},EM={c:{action:n=>{const{chapterNum:e}=n.reference;return[{type:"chapter",marker:"c",number:`${e+1}`}]}},v:{action:n=>{const{verseNum:e,verse:t}=n.reference;return[{type:"verse",marker:"v",number:`${rd(e,t)}`}]}},f:pa("f"),fe:pa("fe"),ef:pa("ef"),efe:pa("efe"),x:Rp("x"),ex:Rp("ex")};function NM(n,e,t,r,i){const s=MM(n);return{action:o=>{o.editor.update(()=>{var a;const l=K();q(l)&&(o.noteText=l.getTextContent());const c=(a=s==null?void 0:s.action)==null?void 0:a.call(s,o);if(!c)return;const u=cp(c,ud,r),f=iu(u);if(q(l)){const d=l.anchor.getNode();if(pe(f))sv(f,l,r),f.getIsCollapsed()||(e.current=f.getKey());else if(l.getTextContent().length>0)AM(l,()=>iu(u));else if(F(f)&&!f.isInline()){const h=l.insertParagraph();if(h){const p=h.getChildren();f.append(...p),h.replace(f),f.selectStart()}}else if(W(d)&&!No(d)&&pe(d.getParent())&&l.isCollapsed()){let h=d.insertAfter(f);if(gl(f)){const p={...r||Ao(),markerMode:"hidden"},m=cp(c,ud,p),y=iu(m);h=h.insertAfter(y)}h.insertAfter(de(Ne))}else{l.insertNodes([f]),RM(f);const h=f.getNextSibling();h?h.selectStart():f.selectStart()}}else l==null||l.insertNodes([f])},i)},label:s==null?void 0:s.label}}function MM(n){let e=EM[n];return e||(St.isValidMarker(n)?e={action:()=>[{type:St.getType(),marker:n,content:[]}]}:Pe.isValidMarker(n)&&(e={action:()=>[{type:Pe.getType(),marker:n,content:["-"]}]})),e}function AM(n,e){const t=n.getNodes(),[r,i]=OM(n);let s;t.forEach((o,a)=>{if(F(s)&&s.isParentOf(o))return;const l=$M(o,a===0,a===t.length-1,r,i);if(!l){s=void 0;return}s||(s=e(),l.insertBefore(s)),PM(l,s)}),(W(s)||F(s))&&s.selectEnd()}function OM(n){const e=n.anchor.offset,t=n.focus.offset;return n.isBackward()?[t,e]:[e,t]}function $M(n,e,t,r,i){if(!(rt(n)||pe(n)||pe(n.getParent()))){if(W(n))return IM(n,e,t,r,i);if(F(n)&&n.isInline())return n}}function IM(n,e,t,r,i){const s=n.getTextContentSize(),o=e?r:0,a=t?i:s;if(o===0&&a===0)return;const l=n.splitText(o,a);return l.length===1?l[0]:l.length===3||a===s?l[1]:l[0]}function PM(n,e){var t;if(W(e)){const r=Lp(n,e);e.setTextContent(r),n.remove()}else if(F(e)){const r=e.getChildrenSize();e.append(n);for(let i=0;i<r;i++)(t=e.getFirstChild())==null||t.remove();Lp(n,e)}}function Lp(n,e){let t=n.getTextContent();if(W(n)&&e.isInline()&&t.startsWith(" ")){t=t.trimStart(),n.setTextContent(t);const r=e.getPreviousSibling();$f(r),W(r)||e.insertBefore(de(" "))}return t}function RM(n){Dt(n)&&($f(n.getPreviousSibling()),lv(n.getNextSibling()))}const xv={chapter:"chapter",verse:"verse",char:"char",para:"para",typedMark:"editor-typed-mark",typedMarkOverlap:"editor-typed-markOverlap",mark:"editor-mark",markOverlap:"editor-markOverlap",placeholder:"editor-placeholder",paragraph:"editor-paragraph",quote:"editor-quote",heading:{h1:"editor-heading-h1",h2:"editor-heading-h2",h3:"editor-heading-h3",h4:"editor-heading-h4",h5:"editor-heading-h5"},list:{nested:{listitem:"editor-nested-listitem"},ol:"editor-list-ol",ul:"editor-list-ul",listitem:"editor-listitem"},image:"editor-image",link:"editor-link",text:{bold:"editor-text-bold",italic:"editor-text-italic",overflowed:"editor-text-overflowed",hashtag:"editor-text-hashtag",underline:"editor-text-underline",strikethrough:"editor-text-strikethrough",underlineStrikethrough:"editor-text-underlineStrikethrough"}};function LM({options:n,editedUsjRef:e,usj:t,setUsj:r}){const{view:i,nodes:s}=n||{},{hasSpacing:o,isFormattedFont:a,markerMode:l}=i||{};return C.useEffect(()=>{e.current&&!$n(e.current,t)&&r(e.current)},[e,o,a,l,s,r,t]),null}function DM({scrRef:n,onScrRefChange:e}){const[t]=ge(),r=C.useRef(!1),i=C.useRef(!1),{book:s,chapterNum:o,verseNum:a}=n;return C.useEffect(()=>t.registerMutationListener(Ft,l=>{t.update(()=>{for(const[c,u]of l){const f=ce(c);f&&_n(f)&&u==="created"&&Dp(o,a,i)}},{tag:ed})},{skipInitialization:!0}),[t,o,a]),C.useEffect(()=>{r.current?r.current=!1:t.update(()=>Dp(o,a,i),{tag:ed})},[t,o,a]),C.useEffect(()=>t.registerCommand(fr,()=>(i.current?i.current=!1:jM(s,o,a,e,r),!1),ri),[t,s,o,a,e]),null}function Dp(n,e,t){var r;const i=Yb(K()),s=(r=av(i))==null?void 0:r.getNumber();if(lT(s)&&Nf(e,s))return;const o=me().getChildren(),a=Y1(o,n),l=sT(o,a),c=X1(l,!!a);if(c&&!a||!a)return;iT(l,c);const u=IT(l,e);if(u){if(dt(u)){const f=u.getFirstChild();W(f)?f.select(0,0):u.select(0,0)}else u.selectNext(0,0);t.current=!0}}function jM(n,e,t,r,i){const s=Yb(K());if(!s)return;const o=wf(s),a=parseInt((o==null?void 0:o.getNumber())??"1",10),l=av(s),c=l==null?void 0:l.getNumber(),u=parseInt(c??"0",10),f=c?Nf(t,c):t===u;if(i.current=!!(o&&a!==e||!f),i.current){const d={book:n,chapterNum:a,verseNum:u};c!=null&&u.toString()!==c&&(d.verse=c),r(d)}}function FM(n){return _n(n)?`${n.__code}`:_f(n)?`${n.__marker} "${n.__number}"`:Me(n)?`${n.__marker}`:To(n)?`${n.__marker} "${n.__number}"`:kr(n)?`${n.__caller}`:cs(n)?`${n.__marker} "${n.__number}"`:pe(n)?`${n.__marker} "${n.__caller}"`+(n.__isCollapsed?" (collapsed)":" (expanded)"):dt(n)?`${n.__marker}`:rt(n)?`ids: [ ${JSON.stringify(n.getTypedIDs())} ]`:Cf(n)?`${n.__marker} "${n.__number}"`:""}function qM(){const[n]=ge();return S.jsx(Uw,{viewClassName:"tree-view-output",treeTypeButtonClassName:"debug-treetype-button",timeTravelPanelClassName:"debug-timetravel-panel",timeTravelButtonClassName:"debug-timetravel-button",timeTravelPanelSliderClassName:"debug-timetravel-panel-slider",timeTravelPanelButtonClassName:"debug-timetravel-panel-button",customPrintNode:FM,editor:n})}const Cv=C.createContext(null),jp=4;function BM({children:n,className:e,onClick:t,title:r}){const i=C.useRef(null),s=C.useContext(Cv);if(s===null)throw new Error("DropDownItem must be used within a DropDown");const{registerItem:o}=s;return C.useEffect(()=>{i&&i.current&&o(i)},[i,o]),S.jsx("button",{className:e,onClick:t,ref:i,title:r,type:"button",children:n})}function UM({children:n,dropDownRef:e,onClose:t}){const[r,i]=C.useState(),[s,o]=C.useState(),a=C.useCallback(u=>{i(f=>f?[...f,u]:[u])},[i]),l=u=>{if(!r)return;const f=u.key;["Escape","ArrowUp","ArrowDown","Tab"].includes(f)&&u.preventDefault(),f==="Escape"||f==="Tab"?t():f==="ArrowUp"?o(d=>{if(!d)return r[0];const h=r.indexOf(d)-1;return r[h===-1?r.length-1:h]}):f==="ArrowDown"&&o(d=>d?r[r.indexOf(d)+1]:r[0])},c=C.useMemo(()=>({registerItem:a}),[a]);return C.useEffect(()=>{r&&!s&&o(r[0]),s&&s.current&&s.current.focus()},[r,s]),S.jsx(Cv.Provider,{value:c,children:S.jsx("div",{className:"dropdown",ref:e,onKeyDown:l,children:n})})}function zM({disabled:n=!1,buttonLabel:e,buttonAriaLabel:t,buttonClassName:r,buttonIconClassName:i,children:s,stopCloseOnClickSelf:o}){const a=C.useRef(null),l=C.useRef(null),[c,u]=C.useState(!1),f=()=>{u(!1),l&&l.current&&l.current.focus()};return C.useEffect(()=>{const d=l.current,h=a.current;if(c&&d!==null&&h!==null){const{top:p,left:m}=d.getBoundingClientRect();h.style.top=`${p+d.offsetHeight+jp}px`,h.style.left=`${Math.min(m,window.innerWidth-h.offsetWidth-20)}px`}},[a,l,c]),C.useEffect(()=>{const d=l.current;if(d!==null&&c){const h=p=>{const m=p.target;o&&a.current&&a.current.contains(m)||d.contains(m)||u(!1)};return document.addEventListener("click",h),()=>{document.removeEventListener("click",h)}}return()=>{}},[a,l,c,o]),C.useEffect(()=>{const d=()=>{if(c){const h=l.current,p=a.current;if(h!==null&&p!==null){const{top:m}=h.getBoundingClientRect(),y=m+h.offsetHeight+jp;y!==p.getBoundingClientRect().top&&(p.style.top=`${y}px`)}}};return document.addEventListener("scroll",d),()=>{document.removeEventListener("scroll",d)}},[l,a,c]),S.jsxs(S.Fragment,{children:[S.jsxs("button",{type:"button",disabled:n,"aria-label":t||e,className:r,onClick:()=>u(!c),ref:l,children:[i&&S.jsx("span",{className:i}),e&&S.jsx("span",{className:"text dropdown-button-text",children:e}),S.jsx("i",{className:"chevron-down"})]}),c&&Nt.createPortal(S.jsx(UM,{dropDownRef:a,onClose:f,children:s}),document.body)]})}const dd={m:"m - Paragraph - Margin - No First Line Indent",ms:"ms - Heading - Major Section Level 1",nb:"nb - Paragraph - No Break with Previous Paragraph",p:"p - Paragraph - Normal - First Line Indent",pi:"pi - Paragraph - Indented - Level 1 - First Line Indent",q1:"q1 - Poetry - Indent Level 1",q2:"q2 - Poetry - Indent Level 2",r:"r - Heading - Parallel References",s:"s - Heading - Section Level 1"},fd={...dd,ide:"ide - File - Encoding",h:"h - File - Header",h1:"h1 - File - Header",h2:"h2 - File - Left Header",h3:"h3 - File - Right Header",toc1:"toc1 - File - Long Table of Contents Text",toc2:"toc2 - File - Short Table of Contents Text",toc3:"toc3 - File - Book Abbreviation",cl:"cl - Chapter - Publishing Label",mt:"mt - Title - Major Title Level 1",mt1:"mt1 - Title - Major Title Level 1",mt2:"mt2 - Title - Major Title Level 2",mt3:"mt3 - Title - Major Title Level 3",mt4:"mt4 - Title - Major Title Level 4",ms1:"ms1 - Heading - Major Section Level 1",ms2:"ms2 - Heading - Major Section Level 2",ms3:"ms3 - Heading - Major Section Level 3",b:"b - Poetry - Stanza Break (Blank Line)"};function WM({editorRef:n,blockMarker:e,disabled:t=!1}){return S.jsx(zM,{disabled:t,buttonClassName:"toolbar-item block-controls",buttonIconClassName:"icon block-marker "+KM(e),buttonLabel:HM(e),buttonAriaLabel:"Formatting options for block type",children:Object.keys(dd).map(r=>S.jsxs(BM,{className:"item block-marker "+JM(e===r),onClick:()=>{var i;return(i=n.current)==null?void 0:i.formatPara(r)},children:[S.jsx("i",{className:"icon block-marker "+r}),S.jsx("span",{className:"text usfm_"+r,children:dd[r]})]},r))})}function KM(n){return n&&n in fd?n:"ban"}function HM(n){return n&&n in fd?fd[n]:"No Style"}function JM(n){return n?"active dropdown-item-active":""}function Fp(){return S.jsx("div",{className:"divider"})}const VM=C.forwardRef(function({editorRef:n,isReadonly:e=!1,onStateChange:t},r){const[i]=ge(),[s,o]=C.useState(i),[a,l]=C.useState(),[c,u]=C.useState(!1),[f,d]=C.useState(!1),h=C.useCallback((p,m,y)=>{u(p),d(m),l(y),t==null||t(p,m,y)},[t]);return C.useEffect(()=>i.registerCommand(fr,(p,m)=>(o(m),!1),Ni),[i]),S.jsxs(S.Fragment,{children:[S.jsx(_v,{onStateChange:h}),S.jsxs("div",{className:"toolbar",children:[S.jsx("button",{disabled:!c||e,onClick:()=>{s.dispatchCommand(uo,void 0)},title:Ru?"Undo (⌘Z)":"Undo (Ctrl+Z)",type:"button",className:"toolbar-item spaced","aria-label":"Undo",children:S.jsx("i",{className:"format undo"})}),S.jsx("button",{disabled:!f||e,onClick:()=>{s.dispatchCommand(fo,void 0)},title:Ru?"Redo (⌘Y)":"Redo (Ctrl+Y)",type:"button",className:"toolbar-item","aria-label":"Redo",children:S.jsx("i",{className:"format redo"})}),S.jsx(Fp,{}),s===i&&S.jsxs(S.Fragment,{children:[S.jsx(WM,{editorRef:n,blockMarker:a,disabled:e}),S.jsx(Fp,{})]}),S.jsx("div",{ref:r,className:"end-container"})]})]})}),qp={namespace:"platformEditor",theme:xv,editable:!0,editorState:void 0,onError(n){throw n},nodes:[tt,...uE]},GM=Ao(),YM={},XM={};function QM(){return S.jsx("div",{className:"editor-placeholder",children:"Enter some Scripture..."})}const wv=C.forwardRef(function({defaultUsj:n,scrRef:e,onScrRefChange:t,onSelectionChange:r,onUsjChange:i,onStateChange:s,options:o,logger:a,children:l},c){const u=C.useRef(null),f=C.useRef(null),d=C.useRef(null),h=C.useRef(n),p=C.useRef(),[m,y]=C.useState(n),[b,_]=C.useState(0),{isReadonly:x=!1,hasExternalUI:T=!1,hasSpellCheck:P=!1,textDirection:M="ltr",markerMenuTrigger:L="\\",view:A=GM,nodes:I=YM,debug:B=!1}=o??XM;qp.editable=!x,cu.initialize(a),C.useImperativeHandle(c,()=>({focus(){var N;(N=u.current)==null||N.focus()},undo(){var N;(N=u.current)==null||N.dispatchCommand(uo,void 0)},redo(){var N;(N=u.current)==null||N.dispatchCommand(fo,void 0)},cut(){var N;(N=u.current)==null||N.dispatchCommand(ni,null)},copy(){var N;(N=u.current)==null||N.dispatchCommand(hr,null)},paste(){u.current&&jf(u.current)},pastePlainText(){u.current&&Ff(u.current)},getUsj(){return h.current},setUsj(N){if(!$n(h.current,N)){h.current=N;const w=$n(m,N);y(N),w&&_(R=>R+1)}},applyUpdate(N,w="remote"){var R,j;(R=u.current)==null||R.update(()=>{w==="remote"&&Ly(nd),IE(N,A,I,a)},{discrete:!0});const D=(j=u.current)==null?void 0:j.getEditorState();if(!D)return;const z=cu.deserializeEditorState(D);if(z){const H=!$n(h.current,z);if(H&&(h.current=z),H||!$n(m,z)){const V=pp(N,D);i==null||i(z,N,w,V)}}},replaceEmbedUpdate(N,w){var R;const j=(R=u.current)==null?void 0:R.read(()=>UT(N,w));j&&this.applyUpdate(j)},getSelection(){var N;return(N=u.current)==null?void 0:N.read(nv)},setSelection(N){var w;(w=u.current)==null||w.update(()=>{const R=Af(N);R!==void 0&&it(R)},{tag:Ab})},addAnnotation(N,w,R){var j;(j=f.current)==null||j.addAnnotation(N,ap(w),R)},removeAnnotation(N,w){var R;(R=f.current)==null||R.removeAnnotation(ap(N),w)},formatPara(N){var w;(w=u.current)==null||w.update(()=>{const R=K();q(R)&&iC(R,()=>oo(N))})},insertNote(N,w,R){var j;(j=u.current)==null||j.update(()=>{const D=ET(N,w,R,e,A,I,a);D&&!D.getIsCollapsed()&&(p.current=D.getKey())})},selectNote(N){var w;(w=u.current)==null||w.update(()=>{const R=hp(N);R&&(MT(R,A),R.getIsCollapsed()||(p.current=R.getKey()))})},getNoteOps(N){var w;return(w=u.current)==null?void 0:w.read(()=>{const R=hp(N);if(R)return Pf(R)})},get toolbarEndRef(){return d}}));const k=C.useCallback((N,w,R,j)=>{if(A1.some(z=>R.has(z)))return;const D=cu.deserializeEditorState(N);if(D){const z=!$n(h.current,D);if(z&&(h.current=D),z||!$n(m,D)){const H=R.has(nd)?"remote":"local",V=pp(j,N);i==null||i(D,j,H,V)}}},[m,i]);return S.jsxs(E_,{initialConfig:qp,children:[S.jsx(uN,{isEditable:!x}),S.jsxs("div",{className:"editor-container",children:[T?S.jsx(_v,{onStateChange:s}):S.jsx("div",{className:"editor-toolbar-container"+(x?"-readonly":"-editable"),children:S.jsx(VM,{ref:d,editorRef:c,isReadonly:x,onStateChange:s})}),S.jsxs("div",{className:"editor-inner",children:[S.jsx($_,{editorRef:u}),S.jsx(d0,{contentEditable:S.jsx(O_,{className:`editor-input usfm ${HN(A).join(" ")}`,spellCheck:P}),placeholder:S.jsx(QM,{}),ErrorBoundary:I_}),S.jsx(P_,{}),e&&t&&S.jsx(DM,{scrRef:e,onScrRefChange:t}),e&&S.jsx(LN,{trigger:L,scrRef:e,getMarkerAction:(N,w)=>NM(N,p,w,A)}),S.jsx(LM,{options:{view:A,nodes:I},editedUsjRef:h,usj:m,setUsj:y}),S.jsx(dN,{scripture:m,nodeOptions:I,editorAdaptor:ud,viewOptions:A,logger:a},b),S.jsx(wN,{onChange:r}),S.jsx(OE,{onChange:k,ignoreSelectionChange:!0,ignoreHistoryMergeTagChange:!0}),S.jsx(AE,{ref:f,logger:a}),S.jsx(GE,{viewOptions:A}),S.jsx(tN,{}),S.jsx(iN,{}),S.jsx(sN,{logger:a}),S.jsx(cN,{}),S.jsx(fN,{expandedNoteKeyRef:p,nodeOptions:I,viewOptions:A,logger:a}),S.jsx(SN,{}),S.jsx(NN,{textDirection:M}),S.jsx(ON,{}),l]}),B&&S.jsx(qM,{})]})]})}),Ul=C.forwardRef(function(n,e){const{children:t,...r}=n;return S.jsx(wv,{ref:e,...r})});function Sv(){return Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5)}function bl(n,e,t,r,i){return{author:e,content:n,deleted:i===void 0?!1:i,id:t===void 0?Sv():t,timeStamp:r===void 0?performance.timeOrigin+performance.now():r,type:"comment"}}function Tv(n,e,t){return{comments:e,id:t===void 0?Sv():t,quote:n,type:"thread"}}function Bp(n){return{comments:Array.from(n.comments),id:n.id,quote:n.quote,type:"thread"}}function ZM(n){return{author:n.author,content:"[Deleted Comment]",deleted:!0,id:n.id,timeStamp:n.timeStamp,type:"comment"}}function uu(n){const e=n._changeListeners;for(const t of e)t()}class eA{constructor(e,t){Z(this,"_editor"),Z(this,"_comments"),Z(this,"_changeListeners"),Z(this,"_collabProvider"),Z(this,"logger"),this._comments=[],this._editor=e,this.logger=t,this._collabProvider=null,this._changeListeners=new Set}isCollaborative(){return this._collabProvider!==null}getComments(){return this._comments}setComments(e){this._comments=e,uu(this)}addComment(e,t,r){const i=Array.from(this._comments),s=this._getCollabComments();if(t!==void 0&&e.type==="comment")for(let o=0;o<i.length;o++){const a=i[o];if(a.type==="thread"&&a.id===t.id){const l=Bp(a);i.splice(o,1,l);const c=r!==void 0?r:l.comments.length;if(this.isCollaborative()&&s!==null){const u=s.get(o).get("comments");this._withRemoteTransaction(()=>{const f=this._createCollabSharedMap(e);u.insert(c,[f])})}l.comments.splice(c,0,e);break}}else{const o=r!==void 0?r:i.length;this.isCollaborative()&&s!==null&&this._withRemoteTransaction(()=>{const a=this._createCollabSharedMap(e);s.insert(o,[a])}),i.splice(o,0,e)}this._comments=i,uu(this)}deleteCommentOrThread(e,t){const r=Array.from(this._comments),i=this._getCollabComments();let s=null;if(t!==void 0)for(let o=0;o<r.length;o++){const a=r[o];if(a.type==="thread"&&a.id===t.id){const l=Bp(a);r.splice(o,1,l);const c=l.comments;if(s=c.indexOf(e),this.isCollaborative()&&i!==null){const u=i.get(o).get("comments"),f=s;this._withRemoteTransaction(()=>{u.delete(f)})}c.splice(s,1);break}}else s=r.indexOf(e),this.isCollaborative()&&i!==null&&this._withRemoteTransaction(()=>{i.delete(s)}),r.splice(s,1);return this._comments=r,uu(this),e.type==="comment"?{index:s,markedComment:ZM(e)}:null}registerOnChange(e){const t=this._changeListeners;return t.add(e),()=>{t.delete(e)}}_withRemoteTransaction(e){const t=this._collabProvider;t!==null&&t.doc.transact(e,this)}_withLocalTransaction(e){const t=this._collabProvider;try{this._collabProvider=null,e()}finally{this._collabProvider=t}}_getCollabComments(){const e=this._collabProvider;return e!==null?e.doc.get("comments",jr):null}_createCollabSharedMap(e){const t=new Ki,r=e.type,i=e.id;if(t.set("type",r),t.set("id",i),r==="comment")t.set("author",e.author),t.set("content",e.content),t.set("deleted",e.deleted),t.set("timeStamp",e.timeStamp);else{t.set("quote",e.quote);const s=new jr;e.comments.forEach((o,a)=>{const l=this._createCollabSharedMap(o);s.insert(a,[l])}),t.set("comments",s)}return t}registerCollaboration(e){this._collabProvider=e;const t=this._getCollabComments(),r=()=>{e.connect()},i=()=>{try{e.disconnect()}catch{}},s=this._editor.registerCommand(k1,a=>{var l,c;return r!==void 0&&i!==void 0&&(a?((l=this.logger)==null||l.info("Comments connected!"),r()):((c=this.logger)==null||c.info("Comments disconnected!"),i())),!1},ri),o=(a,l)=>{if(l.origin!==this){for(const c of a)if(c instanceof yb){const u=c.target,f=c.delta;let d=0;for(const h of f){const p=h.insert,m=h.retain,y=h.delete,b=u.parent,_=u===t?void 0:b instanceof Ki&&this._comments.find(x=>x.id===b.get("id"));if(Array.isArray(p)){const x=d;p.slice().reverse().forEach(T=>{const P=T.get("id"),M=T.get("type")==="thread"?Tv(T.get("quote"),T.get("comments").toArray().map(L=>bl(L.get("content"),L.get("author"),L.get("id"),L.get("timeStamp"),L.get("deleted"))),P):bl(T.get("content"),T.get("author"),P,T.get("timeStamp"),T.get("deleted"));this._withLocalTransaction(()=>{this.addComment(M,_,x)})})}else if(typeof m=="number")d+=m;else if(typeof y=="number")for(let x=0;x<y;x++){const T=_===void 0||_===!1?this._comments[d]:_.comments[d];this._withLocalTransaction(()=>{this.deleteCommentOrThread(T,_)}),d++}}}}};return t===null?()=>null:(t.observeDeep(o),r(),()=>{t.unobserveDeep(o),s(),this._collabProvider=null})}}function tA(n){const[e,t]=C.useState(n.getComments());return C.useEffect(()=>n.registerOnChange(()=>{t(n.getComments())}),[n]),e}function nA({onClose:n,children:e,title:t,closeOnClickOutside:r}){const i=C.useRef(null);return C.useEffect(()=>{i.current!==null&&i.current.focus()},[]),C.useEffect(()=>{let s=null;const o=c=>{c.key==="Escape"&&n()},a=c=>{const u=c.target;i.current!==null&&!i.current.contains(u)&&r&&n()},l=i.current;return l!==null&&(s=l.parentElement,s!==null&&s.addEventListener("click",a)),window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o),s!==null&&(s==null||s.removeEventListener("click",a))}},[r,n]),S.jsx("div",{className:"Modal__overlay",role:"dialog",children:S.jsxs("div",{className:"Modal__modal",tabIndex:-1,ref:i,children:[S.jsx("h2",{className:"Modal__title",children:t}),S.jsx("button",{className:"Modal__closeButton","aria-label":"Close modal",type:"button",onClick:n,children:"X"}),S.jsx("div",{className:"Modal__content",children:e})]})})}function rA({onClose:n,children:e,title:t,closeOnClickOutside:r=!1}){return Nt.createPortal(S.jsx(nA,{onClose:n,title:t,closeOnClickOutside:r,children:e}),document.body)}function Ev(){const[n,e]=C.useState(null),t=C.useCallback(()=>{e(null)},[]),r=C.useMemo(()=>{if(n===null)return null;const{title:s,content:o,closeOnClickOutside:a}=n;return S.jsx(rA,{onClose:t,title:s,closeOnClickOutside:a,children:o})},[n,t]),i=C.useCallback((s,o,a=!1)=>{e({closeOnClickOutside:a,content:o(t),title:s})},[t]);return[r,i]}const iA={...xv,paragraph:"CommentEditorTheme__paragraph"};function sA(...n){return n.filter(Boolean).join(" ")}function dr({"data-test-id":n,children:e,className:t,onClick:r,disabled:i,small:s,title:o}){return S.jsx("button",{disabled:i,className:sA("Button__root",i&&"Button__disabled",s&&"Button__small",t),onClick:r,title:o,"aria-label":o,...n&&{"data-test-id":n},children:e})}function oA({className:n}){return S.jsx(O_,{className:n||"ContentEditable__root"})}function aA({children:n,className:e}){return S.jsx("div",{className:e||"Placeholder__root",children:n})}const Up=ie("INSERT_INLINE_COMMAND");function lA({anchorKey:n,editor:e,showComments:t,onAddComment:r}){const i=C.useRef(null),s=C.useCallback(()=>{const o=i.current,a=e.getRootElement(),l=e.getElementByKey(n);if(o!==null&&a!==null&&l!==null){const{right:c}=a.getBoundingClientRect(),{top:u}=l.getBoundingClientRect();o.style.left=`${c-20}px`,o.style.top=`${u-30}px`}},[n,e]);return C.useEffect(()=>(window.addEventListener("resize",s),()=>{window.removeEventListener("resize",s)}),[e,s]),C.useLayoutEffect(()=>{s()},[n,e,t,s]),S.jsx("div",{className:"CommentPlugin_AddCommentBox",ref:i,children:S.jsx("button",{className:"CommentPlugin_AddCommentBox_button",onClick:r,children:S.jsx("i",{className:"icon add-comment"})})})}function cA({onEscape:n}){const[e]=ge();return C.useEffect(()=>e.registerCommand(xl,t=>n(t),Oa),[e,n]),null}function Nv({className:n,autoFocus:e,onEscape:t,onChange:r,editorRef:i,placeholder:s="Type a comment..."}){return S.jsx(E_,{initialConfig:{namespace:"Commenting",nodes:[],onError:o=>{throw o},theme:iA},children:S.jsxs("div",{className:"CommentPlugin_CommentInputBox_EditorContainer",children:[S.jsx(A0,{contentEditable:S.jsx(oA,{className:n}),placeholder:S.jsx(aA,{children:s}),ErrorBoundary:I_}),S.jsx(C0,{onChange:r}),S.jsx(P_,{}),e!==!1&&S.jsx(_0,{}),S.jsx(cA,{onEscape:t}),S.jsx(v0,{}),i!==void 0&&S.jsx($_,{editorRef:i})]})})}function Mv(n,e){return C.useCallback((t,r)=>{t.read(()=>{n(N_()),e(!M_(r.isComposing(),!0))})},[e,n])}function uA({editor:n,cancelAddComment:e,submitAddComment:t}){const[r,i]=C.useState(""),[s,o]=C.useState(!1),a=C.useRef(null),l=C.useMemo(()=>({container:document.createElement("div"),elements:[]}),[]),c=C.useRef(null),u=Ov(),f=C.useCallback(()=>{n.getEditorState().read(()=>{const m=K();if(q(m)){c.current=m.clone();const y=m.anchor,b=m.focus,_=Zx(n,y.getNode(),y.offset,b.getNode(),b.offset),x=a.current;if(_!==null&&x!==null){const{left:T,bottom:P,width:M}=_.getBoundingClientRect(),L=eC(n,_);let A=L.length===1?T+M/2-125:T-125;A<10&&(A=10),x.style.left=`${A}px`,x.style.top=`${P+20+(window.pageYOffset||document.documentElement.scrollTop)}px`;const I=L.length,{container:B}=l,k=l.elements,N=k.length;for(let w=0;w<I;w++){const R=L[w];let j=k[w];j===void 0&&(j=document.createElement("span"),k[w]=j,B.appendChild(j));const D=`position:absolute;top:${R.top+(window.pageYOffset||document.documentElement.scrollTop)}px;left:${R.left}px;height:${R.height}px;width:${R.width}px;background-color:rgba(255, 212, 0, 0.3);pointer-events:none;z-index:5;`;j.style.cssText=D}for(let w=N-1;w>=I;w--){const R=k[w];B.removeChild(R),k.pop()}}}})},[n,l]);C.useLayoutEffect(()=>{f();const m=l.container,y=document.body;return y!==null?(y.appendChild(m),()=>{y.removeChild(m)}):()=>{}},[l.container,f]),C.useEffect(()=>(window.addEventListener("resize",f),()=>{window.removeEventListener("resize",f)}),[f]);const d=m=>(m.preventDefault(),e(),!0),h=()=>{if(s){let m=n.getEditorState().read(()=>{const y=c.current;return y?y.getTextContent():""});m.length>100&&(m=m.slice(0,99)+"…"),t(Tv(m,[bl(r,u)]),!0,void 0,c.current),c.current=null}},p=Mv(i,o);return S.jsxs("div",{className:"CommentPlugin_CommentInputBox",ref:a,children:[S.jsx(Nv,{className:"CommentPlugin_CommentInputBox_Editor",onEscape:d,onChange:p}),S.jsxs("div",{className:"CommentPlugin_CommentInputBox_Buttons",children:[S.jsx(dr,{onClick:e,className:"CommentPlugin_CommentInputBox_Button",children:"Cancel"}),S.jsx(dr,{onClick:h,disabled:!s,className:"CommentPlugin_CommentInputBox_Button primary",children:"Comment"})]})]})}function dA({submitAddComment:n,thread:e,placeholder:t}){const[r,i]=C.useState(""),[s,o]=C.useState(!1),a=C.useRef(null),l=Ov(),c=Mv(i,o);return S.jsxs(S.Fragment,{children:[S.jsx(Nv,{className:"CommentPlugin_CommentsPanel_Editor",autoFocus:!1,onEscape:()=>!0,onChange:c,editorRef:a,placeholder:t}),S.jsx(dr,{className:"CommentPlugin_CommentsPanel_SendButton",onClick:()=>{if(s){n(bl(r,l),!1,e);const u=a.current;u!==null&&u.dispatchCommand(Od,void 0)}},disabled:!s,children:S.jsx("i",{className:"send"})})]})}function Av({commentOrThread:n,deleteCommentOrThread:e,onClose:t,thread:r=void 0}){return S.jsxs(S.Fragment,{children:["Are you sure you want to delete this ",n.type,"?",S.jsxs("div",{className:"Modal__content",children:[S.jsx(dr,{onClick:()=>{e(n,r),t()},children:"Delete"})," ",S.jsx(dr,{onClick:()=>{t()},children:"Cancel"})]})]})}function zp({comment:n,deleteComment:e,thread:t,rtf:r}){const i=Math.round((n.timeStamp-(performance.timeOrigin+performance.now()))/1e3),s=Math.round(i/60),[o,a]=Ev();return S.jsxs("li",{className:"CommentPlugin_CommentsPanel_List_Comment",children:[S.jsxs("div",{className:"CommentPlugin_CommentsPanel_List_Details",children:[S.jsx("span",{className:"CommentPlugin_CommentsPanel_List_Comment_Author",children:n.author}),S.jsxs("span",{className:"CommentPlugin_CommentsPanel_List_Comment_Time",children:["· ",i>-10?"Just now":r.format(s,"minute")]})]}),S.jsx("p",{className:n.deleted?"CommentPlugin_CommentsPanel_DeletedComment":"",children:n.content}),!n.deleted&&S.jsxs(S.Fragment,{children:[S.jsx(dr,{onClick:()=>{a("Delete Comment",l=>S.jsx(Av,{commentOrThread:n,deleteCommentOrThread:e,thread:t,onClose:l}))},className:"CommentPlugin_CommentsPanel_List_DeleteButton",children:S.jsx("i",{className:"delete"})}),o]})]})}function fA({activeIDs:n,comments:e,deleteCommentOrThread:t,listRef:r,submitAddComment:i,markNodeMap:s}){const[o]=ge(),[a,l]=C.useState(0),[c,u]=Ev(),f=C.useMemo(()=>new Intl.RelativeTimeFormat("en",{localeMatcher:"best fit",numeric:"auto",style:"short"}),[]);return C.useEffect(()=>{const d=setTimeout(()=>{l(a+1)},1e4);return()=>{clearTimeout(d)}},[a]),S.jsx("ul",{className:"CommentPlugin_CommentsPanel_List",ref:r,children:e.map(d=>{const h=d.id;return d.type==="thread"?S.jsxs("li",{onClick:()=>{const p=s.get(h);if(p!==void 0&&(n===null||n.indexOf(h)===-1)){const m=document.activeElement;o.update(()=>{const y=Array.from(p)[0],b=ce(y);rt(b)&&b.selectStart()},{onUpdate(){m!==null&&m.focus()}})}},className:`CommentPlugin_CommentsPanel_List_Thread ${s.has(h)?"interactive":""} ${n.indexOf(h)===-1?"":"active"}`,children:[S.jsxs("div",{className:"CommentPlugin_CommentsPanel_List_Thread_QuoteBox",children:[S.jsxs("blockquote",{className:"CommentPlugin_CommentsPanel_List_Thread_Quote",children:["> ",S.jsx("span",{children:d.quote})]}),S.jsx(dr,{onClick:()=>{u("Delete Thread",p=>S.jsx(Av,{commentOrThread:d,deleteCommentOrThread:t,onClose:p}))},className:"CommentPlugin_CommentsPanel_List_DeleteButton",children:S.jsx("i",{className:"delete"})}),c]}),S.jsx("ul",{className:"CommentPlugin_CommentsPanel_List_Thread_Comments",children:d.comments.map(p=>S.jsx(zp,{comment:p,deleteComment:t,thread:d,rtf:f},p.id))}),S.jsx("div",{className:"CommentPlugin_CommentsPanel_List_Thread_Editor",children:S.jsx(dA,{submitAddComment:i,thread:d,placeholder:"Reply to comment..."})})]},h):S.jsx(zp,{comment:d,deleteComment:t,rtf:f},h)})})}function hA({activeIDs:n,deleteCommentOrThread:e,comments:t,submitAddComment:r,markNodeMap:i}){const s=C.useRef(null),o=t.length===0;return S.jsxs("div",{className:"CommentPlugin_CommentsPanel",children:[S.jsx("h2",{className:"CommentPlugin_CommentsPanel_Heading",children:"Comments"}),o?S.jsx("div",{className:"CommentPlugin_CommentsPanel_Empty",children:"No Comments"}):S.jsx(fA,{activeIDs:n,comments:t,deleteCommentOrThread:e,listRef:s,submitAddComment:r,markNodeMap:i})]})}function Ov(){const n=D_(),{yjsDocMap:e,name:t}=n;return e.has("comments")?t:"Scripture User"}function gA({providerFactory:n,setCommentStore:e,onChange:t,showCommentsContainerRef:r,commentContainerRef:i,logger:s}){const o=D_(),[a]=ge(),l=C.useMemo(()=>{const A=new eA(a,s);return t&&A.registerOnChange(t),e==null||e(A),A},[a,s,t,e]),c=tA(l),u=C.useMemo(()=>new Map,[]),[f,d]=C.useState(),[h,p]=C.useState([]),[m,y]=C.useState(!1),[b,_]=C.useState(!1),{yjsDocMap:x}=o;C.useEffect(()=>{if(n){const A=n("comments",x);return l.registerCollaboration(A)}return()=>{}},[l,n,x]);const T=C.useCallback(()=>{a.update(()=>{const A=K();A!==null&&(A.dirty=!0)}),y(!1)},[a]),P=C.useCallback((A,I)=>{if(A.type==="comment"){const B=l.deleteCommentOrThread(A,I);if(!B)return;const{markedComment:k,index:N}=B;l.addComment(k,I,N)}else{l.deleteCommentOrThread(A);const B=I!==void 0?I.id:A.id,k=u.get(B);k!==void 0&&setTimeout(()=>{a.update(()=>{for(const N of k){const w=ce(N);rt(w)&&(w.deleteID(tr,B),w.hasNoIDsForEveryType()&&Xb(w))}})})}},[l,a,u]),M=C.useCallback((A,I,B,k)=>{l.addComment(A,B),I&&(a.update(()=>{q(k)&&Qb(k,tr,A.id)}),y(!1))},[l,a]);C.useEffect(()=>{const A=[];for(const I of h){const B=u.get(I);if(B!==void 0)for(const k of B){const N=a.getElementByKey(k);N!==null&&(N.classList.add("selected"),A.push(N),_(!0))}}return()=>{for(const I of A)I.classList.remove("selected")}},[h,a,u]),C.useEffect(()=>{if(!a.hasNodes([tt]))throw new Error("CommentPlugin: TypedMarkNode not registered on editor!");const A=new Map;return He(Vy(a,tt,I=>ao(I.getTypedIDs()),(I,B)=>{for(const[k,N]of Object.entries(I.getTypedIDs()))N.forEach(w=>{B.addID(k,w)})}),a.registerMutationListener(tt,I=>{a.getEditorState().read(()=>{for(const[B,k]of I){const N=ce(B);let w=[];k==="destroyed"?w=A.get(B)??[]:rt(N)&&(w=N.getTypedIDs()[tr]??[]);for(const R of w){let j=u.get(R);A.set(B,w),k==="destroyed"?j!==void 0&&(j.delete(B),j.size===0&&u.delete(R)):(j===void 0&&(j=new Set,u.set(R,j)),j.has(B)||j.add(B))}}})},{skipInitialization:!1}),a.registerUpdateListener(({editorState:I,tags:B})=>{I.read(()=>{const k=K();let N=!1,w=!1;if(q(k)){const R=k.anchor.getNode();if(W(R)){const j=gT(R,tr,k.anchor.offset)??[];j!==null&&(p(j),N=!0),k.isCollapsed()||(d(R.getKey()),w=!0)}}N||p(R=>R.length===0?R:[]),w||d(null),!B.has("collaboration")&&q(k)&&y(!1)})}),a.registerCommand(Up,()=>{const I=window.getSelection();return I!==null&&I.removeAllRanges(),y(!0),!0},ne))},[a,u]);const L=()=>{a.dispatchCommand(Up,void 0)};return S.jsxs(S.Fragment,{children:[m&&Nt.createPortal(S.jsx(uA,{editor:a,cancelAddComment:T,submitAddComment:M}),document.body),f!=null&&!m&&Nt.createPortal(S.jsx(lA,{anchorKey:f,editor:a,showComments:b,onAddComment:L}),document.body),r!==null&&Nt.createPortal(S.jsx(dr,{className:`CommentPlugin_ShowCommentsButton ${b?"active":""}`,onClick:()=>_(!b),title:b?"Hide Comments":"Show Comments",children:S.jsx("i",{className:"comments"})}),(r==null?void 0:r.current)??document.body),b&&Nt.createPortal(S.jsx(hA,{comments:c,submitAddComment:M,deleteCommentOrThread:P,activeIDs:h,markNodeMap:u}),(i==null?void 0:i.current)??document.body)]})}function pA(){const n=C.useRef(void 0),e=C.useCallback(t=>{n.current=t},[]);return[n,e]}function mA(n,e){var t,r;const i=((t=e.current)==null?void 0:t.getComments())??[],s=i==null?void 0:i.map(a=>a.id),o=n.map(a=>{const l=s.findIndex(c=>c===a);return l!==void 0&&l>=0?i[l]:{comments:[{author:"unknown",content:"Comment not found",deleted:!1,id:"",timeStamp:0,type:"comment"}],id:a,quote:"",type:"thread"}});i.forEach(a=>{n.includes(a.id)||o.push(a)}),o&&((r=e.current)==null||r.setComments(o))}function yA(n,e){C.useEffect(()=>{var t;n.options??(n.options={}),(t=n.options).nodes??(t.nodes={}),n.options.nodes.addMissingComments=r=>{mA(r,e)}},[e,n])}C.forwardRef(function(n,e){const t=C.useRef(null),r=C.useRef(!0),i=C.useRef(null),[s,o]=C.useState(null),{children:a,onCommentChange:l,onUsjChange:c,showCommentsContainerRef:u,...f}=n,{options:{isReadonly:d}={}}=n,[h,p]=pA();yA(f,h),C.useImperativeHandle(e,()=>({focus(){var b;(b=t.current)==null||b.focus()},undo(){var b;(b=t.current)==null||b.undo()},redo(){var b;(b=t.current)==null||b.redo()},cut(){var b;(b=t.current)==null||b.cut()},copy(){var b;(b=t.current)==null||b.copy()},paste(){var b;(b=t.current)==null||b.paste()},pastePlainText(){var b;(b=t.current)==null||b.pastePlainText()},getUsj(){var b;return(b=t.current)==null?void 0:b.getUsj()},setUsj(b){var _;(_=t.current)==null||_.setUsj(b)},applyUpdate(b,_){var x;(x=t.current)==null||x.applyUpdate(b,_)},replaceEmbedUpdate(b,_){var x;return(x=t.current)==null?void 0:x.replaceEmbedUpdate(b,_)},getSelection(){var b;return(b=t.current)==null?void 0:b.getSelection()},setSelection(b){var _;(_=t.current)==null||_.setSelection(b)},addAnnotation(b,_,x){var T;(T=t.current)==null||T.addAnnotation(b,_,x)},removeAnnotation(b,_){var x;(x=t.current)==null||x.removeAnnotation(b,_)},formatPara(b){var _;(_=t.current)==null||_.formatPara(b)},insertNote(b,_,x){var T;(T=t.current)==null||T.insertNote(b,_,x)},selectNote(b){var _;(_=t.current)==null||_.selectNote(b)},getNoteOps(b){var _;return(_=t.current)==null?void 0:_.getNoteOps(b)},setComments(b){var _;(_=h.current)==null||_.setComments(b),r.current=!0},get toolbarEndRef(){return s}}));const m=C.useCallback((b,_,x,T)=>{var P;if(!c)return;const M=(P=h.current)==null?void 0:P.getComments();c(b,M,_,x,T)},[h,c]),y=C.useCallback(()=>{var b;if(!l||r.current){r.current=!1;return}const _=(b=h.current)==null?void 0:b.getComments();l(_)},[h,r,l]);return C.useEffect(()=>{var b;return o(((b=t.current)==null?void 0:b.toolbarEndRef)??null),()=>o(null)},[]),S.jsxs(wv,{ref:t,onUsjChange:m,...f,children:[S.jsx(gA,{setCommentStore:p,onChange:y,showCommentsContainerRef:d?null:u??s,commentContainerRef:i,logger:f.logger}),S.jsx("div",{ref:i,className:"comment-container"})]})});const Bf=C.memo(function({viewMode:e,description:t,children:r}){const i=e==="story",s=C.useMemo(()=>!i||typeof t!="string"||!t.trim()?null:S.jsxs(Hv,{className:"tw-w-full",children:[S.jsx(Jv,{className:"tw-pb-2",children:S.jsx(Vv,{className:"tw-text-sm tw-font-medium tw-text-muted-foreground",children:"Story Description"})}),S.jsx(Gv,{className:"tw-pt-2",children:S.jsx(Kv,{className:"tw-prose-sm tw-max-w-none tw-text-muted-foreground",markdown:t})})]}),[t,i]);return S.jsxs("div",{style:{display:"grid",gap:8},children:[r,s]})});Bf.__docgenInfo={description:"",methods:[],displayName:"CanvasWithDescription",props:{viewMode:{required:!1,tsType:{name:"string"},description:""},description:{required:!1,tsType:{name:"string"},description:""},children:{required:!0,tsType:{name:"ReactNode"},description:""}}};const hd={m:"m - Paragraph - Margin - No First Line Indent",ms:"ms - Heading - Major Section Level 1",nb:"nb - Paragraph - No Break with Previous Paragraph",p:"p - Paragraph - Normal - First Line Indent",pi:"pi - Paragraph - Indented - Level 1 - First Line Indent",q1:"q1 - Poetry - Indent Level 1",q2:"q2 - Poetry - Indent Level 2",r:"r - Heading - Parallel References",s:"s - Heading - Section Level 1"},Wp={...hd,ide:"ide - File - Encoding",h:"h - File - Header",h1:"h1 - File - Header",h2:"h2 - File - Left Header",h3:"h3 - File - Right Header",toc1:"toc1 - File - Long Table of Contents Text",toc2:"toc2 - File - Short Table of Contents Text",toc3:"toc3 - File - Book Abbreviation",cl:"cl - Chapter - Publishing Label",mt:"mt - Title - Major Title Level 1",mt1:"mt1 - Title - Major Title Level 1",mt2:"mt2 - Title - Major Title Level 2",mt3:"mt3 - Title - Major Title Level 3",mt4:"mt4 - Title - Major Title Level 4",ms1:"ms1 - Heading - Major Section Level 1",ms2:"ms2 - Heading - Major Section Level 2",ms3:"ms3 - Heading - Major Section Level 3",b:"b - Poetry - Stanza Break (Blank Line)"},Kp={m:Yo,ms:vi,nb:Yo,p:Yo,pi:Yo,q1:Oc,q2:Oc,r:vi,s:vi,ide:Sn,h:Sn,h1:Sn,h2:Sn,h3:Sn,toc1:Sn,toc2:Sn,toc3:Sn,cl:Sn,mt:vi,mt1:vi,mt2:zf,mt3:Ac,mt4:Ac,ms1:vi,ms2:zf,ms3:Ac,b:Oc};function Hp({blockMarker:n,className:e}){const t=n&&n in Kp?Kp[n]:sk;return S.jsx(t,{className:e,size:16})}function $v({editorRef:n,blockMarker:e}){return S.jsxs(Qv,{children:[S.jsx(Zv,{asChild:!0,children:S.jsxs(xi,{variant:"outline",className:"","aria-label":"Formatting options for block type",children:[S.jsx(Hp,{blockMarker:e,className:"tw-me-2"}),_A(e),S.jsx(nk,{className:"tw-ms-2"})]})}),S.jsx(ek,{children:Object.keys(hd).map(t=>S.jsxs(tk,{className:`item block-marker ${bA(e===t)}`,onClick:()=>{var r;return(r=n.current)==null?void 0:r.formatPara(t)},children:[S.jsx(Hp,{blockMarker:t,className:"tw-me-2"}),S.jsx("span",{className:`text usfm_${t}`,children:hd[t]})]},t))})]})}function _A(n){return n&&n in Wp?Wp[n]:"No Style"}function bA(n){return n?"active dropdown-item-active":""}$v.__docgenInfo={description:"",methods:[],displayName:"BlockFormatDropDown",props:{editorRef:{required:!0,tsType:{name:"MutableRefObject",elements:[{name:"union",raw:"EditorRef | null",elements:[{name:"EditorRef"},{name:"null"}]}],raw:"MutableRefObject<EditorRef | null>"},description:""},blockMarker:{required:!0,tsType:{name:"union",raw:"string | undefined",elements:[{name:"string"},{name:"undefined"}]},description:""}}};const vA={columns:{"platformScriptureEditor.edit":{label:"Edit",order:1},"platformScriptureEditor.insert":{label:"Insert",order:2}},groups:{"platformScriptureEditor.clipboard":{column:"platformScriptureEditor.edit",order:1},"platformScriptureEditor.insertNote":{column:"platformScriptureEditor.insert",order:1}},items:[{label:"Insert footnote",group:"platformScriptureEditor.insertNote",order:1,command:"platformScriptureEditor.insertFootnoteAtSelection",localizeNotes:""},{label:"Insert cross-reference",group:"platformScriptureEditor.insertNote",order:2,command:"platformScriptureEditor.insertCrossReferenceAtSelection",localizeNotes:""},{label:"Insert endnote",group:"platformScriptureEditor.insertNote",order:3,command:"platformScriptureEditor.insertEndnoteAtSelection",localizeNotes:""},{label:"Cut",group:"platformScriptureEditor.clipboard",order:1,command:"platformScriptureEditor.cut",localizeNotes:""},{label:"Copy",group:"platformScriptureEditor.clipboard",order:2,command:"platformScriptureEditor.copy",localizeNotes:""},{label:"Paste",group:"platformScriptureEditor.clipboard",order:3,command:"platformScriptureEditor.paste",localizeNotes:""},{label:"Paste as plain text",group:"platformScriptureEditor.clipboard",order:4,command:"platformScriptureEditor.pastePlainText",localizeNotes:""}]};function Iv({editorRef:n,scrRef:e,onScrRefChange:t,isReadonly:r=!1,canUndo:i=!1,canRedo:s=!1,blockMarker:o}){const a=()=>{var d;(d=n.current)==null||d.insertNote("f")},l=()=>{var d;(d=n.current)==null||d.insertNote("x")},c=()=>{var d;(d=n.current)==null||d.insertNote("fe")},u=d=>{var h,p,m,y;switch(d.command){case"platformScriptureEditor.insertFootnoteAtSelection":a();break;case"platformScriptureEditor.insertCrossReferenceAtSelection":l();break;case"platformScriptureEditor.insertEndnoteAtSelection":c();break;case"platformScriptureEditor.cut":(h=n.current)==null||h.cut();break;case"platformScriptureEditor.copy":(p=n.current)==null||p.copy();break;case"platformScriptureEditor.paste":(m=n.current)==null||m.paste();break;case"platformScriptureEditor.pastePlainText":(y=n.current)==null||y.pastePlainText();break;default:throw new Error(`Unknown onSelectProjectMenuItem command: ${d.command}`)}},f=()=>{};return S.jsx(Xv,{onSelectProjectMenuItem:u,onSelectViewInfoMenuItem:f,projectMenuData:vA,className:"toolbar",startAreaChildren:S.jsxs(S.Fragment,{children:[S.jsx("div",{className:"tw-flex tw-h-full tw-items-center",children:S.jsx(Yv,{scrRef:e,handleSubmit:t})}),!r&&S.jsxs(S.Fragment,{children:[S.jsx(xi,{"aria-label":"Undo",title:"Undo",variant:"ghost",size:"icon",onClick:()=>{var d;return(d=n.current)==null?void 0:d.undo()},disabled:!i,children:S.jsx(bk,{})}),S.jsx(xi,{"aria-label":"Redo",title:"Redo",variant:"ghost",size:"icon",onClick:()=>{var d;return(d=n.current)==null?void 0:d.redo()},disabled:!s,children:S.jsx(fk,{})}),S.jsx($v,{editorRef:n,blockMarker:o}),S.jsx(xi,{"aria-label":"Insert footnote",title:"Insert footnote",variant:"ghost",size:"icon",onClick:a,children:S.jsx(mk,{})}),S.jsx(xi,{"aria-label":"Insert cross-reference",title:"Insert cross-reference",variant:"ghost",size:"icon",onClick:l,children:S.jsx(gk,{})}),S.jsx(xi,{"aria-label":"Insert endnote",title:"Insert endnote",variant:"ghost",size:"icon",onClick:c,children:S.jsx(uk,{})})]})]})})}Iv.__docgenInfo={description:"",methods:[],displayName:"PlatformToolbar",props:{editorRef:{required:!0,tsType:{name:"RefObject",elements:[{name:"union",raw:"MarginalRef | EditorRef | null",elements:[{name:"MarginalRef"},{name:"EditorRef"},{name:"null"}]}],raw:"RefObject<MarginalRef | EditorRef | null>"},description:""},scrRef:{required:!0,tsType:{name:"SerializedVerseRef"},description:""},onScrRefChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(scrRef: SerializedVerseRef) => void",signature:{arguments:[{type:{name:"SerializedVerseRef"},name:"scrRef"}],return:{name:"void"}}},description:""},isReadonly:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},canUndo:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},canRedo:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},blockMarker:{required:!1,tsType:{name:"string"},description:""}}};function li(n,e,t){var d,h,p,m;const r=C.useRef(null),[i,s]=C.useState(t),[o,a]=C.useState(!1),[l,c]=C.useState(!1),[u,f]=C.useState();return S.jsxs(Bf,{viewMode:e.viewMode,description:((p=(h=(d=e.parameters)==null?void 0:d.docs)==null?void 0:h.description)==null?void 0:p.story)??((m=e.parameters)==null?void 0:m.description),children:[S.jsx(Iv,{editorRef:r,scrRef:i,onScrRefChange:s,isReadonly:!1,canUndo:o,canRedo:l,blockMarker:u}),S.jsx(Ul,{...n,ref:r,scrRef:i,onScrRefChange:s,onStateChange:(y,b,_)=>{a(y),c(b),f(_)}})]})}li.__docgenInfo={description:`Render function that combines the Editorial component with a PlatformToolbar. This provides a
complete editing experience with undo/redo, navigation, and other toolbar features.

Use this as a render function in a Storybook story, not as a component.`,methods:[],displayName:"renderEditorialWithToolbar"};const kA='<usx version="3.1" />',xA=gd(kA),CA=`<?xml version="1.0" encoding="utf-8"?>
<usx version="3.1">
  <book code="PSA" style="id">World English Bible (WEB)</book>
  <para style="mt1">The Psalms</para>
  <chapter number="1" style="c" sid="PSA 1" />
  <para style="q1">
    <verse number="1" style="v" sid="PSA 1:1" />Blessed is the man who doesn’t walk in the counsel of the wicked<note caller="+" style="f"><char style="fr">1:1 </char><char style="ft">Or "sinful"</char></note>,</para>
  <para style="q2" vid="PSA 1:1">nor stand on the path<note caller="+" style="f"><char style="fr">1:1 </char><char style="ft">Hebrew: "way"</char></note> of sinners,</para>
  <para style="q2" vid="PSA 1:1">nor sit in the seat of scoffers;<verse eid="PSA 1:1" /></para>
  <para style="q1">
    <verse number="2" style="v" sid="PSA 1:2" /><note caller="+" style="f"><char style="fr" closed="false">1:2 </char><char style="ft" closed="false">After verse</char></note> but his delight is in Yahweh’s<note caller="+" style="f"><char style="fr" closed="false">1:2 </char><char style="ft" closed="false">“Yahweh” is God’s proper Name, sometimes rendered “LORD” (all caps) in other translations.</char></note> law.<note caller="+" style="f"><char style="fr" closed="false">1:2 </char><char style="ft" closed="false">End of Para</char></note></para>
  <para style="q2" vid="PSA 1:2">On his law he meditates day and night.<note caller="+" style="f"><char style="fr" closed="false">1:2 </char><char style="ft" closed="false">End of Doc</char></note><verse eid="PSA 1:2" /></para>
</usx>
`,Hn=gd(CA),wA={start:{jsonPath:"$.content[3].content[1]",offset:15},end:{jsonPath:"$.content[3].content[1]",offset:18}},SA={start:{jsonPath:"$.content[3].content[1]",offset:15},end:{jsonPath:"$.content[3].content[1]",offset:22}},TA=`<?xml version="1.0" encoding="utf-8"?>
<usx version="3.1">
  <book code="PSA" style="id">תהילים</book>
  <para style="mt1">תהילים</para>
  <chapter number="1" style="c" sid="PSA 1" />
  <para style="q1">
    <verse number="1" style="v" sid="PSA 1:1" />אשרי האיש אשר לא הלך בעצת רשעים,</para>
  <para style="q2" vid="PSA 1:1">ובדרך חטאים לא עמד,</para>
  <para style="q2" vid="PSA 1:1">ובמושב לצים לא ישב.<verse eid="PSA 1:1" /></para>
  <para style="q1">
    <verse number="2" style="v" sid="PSA 1:2" />כי אם בתורת יהוה חפצו,</para>
  <para style="q2" vid="PSA 1:2">ובתורתו יהגה יומם ולילה.<verse eid="PSA 1:2" /></para>
</usx>
`,EA=gd(TA),Bt={book:"PSA",chapterNum:1,verseNum:1},qO={title:"Demo/Editorial",component:Ul,tags:["autodocs"],parameters:{docs:{description:{component:`
**Demo Only:** This component is provided for demonstration purposes only. For production applications, developers should import the Scripture Editor component directly from:
- npm [@eten-tech-foundation/platform-editor](https://www.npmjs.com/package/@eten-tech-foundation/platform-editor)
- github [eten-tech-foundation/platform-editor](https://github.com/eten-tech-foundation/scripture-editors/tree/main/packages/platform)

This demo version is included in Storybook to showcase the component's functionality and usage patterns.

**Known Limitation:** In the Docs view, all story examples may show the same note caller style due to global state management in the editor component. To see the correct note caller behavior for each story (default lowercase letters vs custom symbols), please view the individual stories in the Canvas view instead of the Docs view.
        `}}},argTypes:{ref:{control:"object",description:"Reference to the editor instance",defaultValue:null},defaultUsj:{control:"object",description:"Default USJ object to initialize the editor with",defaultValue:{type:Ws,version:Ks,content:[""]}},scrRef:{control:"object",description:"Scripture reference",defaultValue:Bt},options:{control:"object",description:"Options to configure the editor (EditorOptions)",defaultValue:{},table:{type:{summary:"EditorOptions",detail:'{ isReadonly?: boolean; hasSpellCheck?: boolean; textDirection?: "ltr" | "rtl" | "auto"; markerMenuTrigger?: string; nodes?: UsjNodeOptions; }'}}}}},ma={args:{defaultUsj:Hn,scrRef:Bt}},ya={args:{defaultUsj:xA,scrRef:Bt}},_a={args:{defaultUsj:Hn,scrRef:Bt,options:{isReadonly:!0}}},ba={render:(n,e)=>li(n,e,Bt),parameters:{docs:{description:{story:'Right-to-left example using a Hebrew snippet (Psalm 1:1). The editor is set to RTL via _options.textDirection = "rtl"_. If you want the UI (tab toolbar) to be RTL click **Switch direction** in the Storybook toolbar.'}}},args:{defaultUsj:EA,options:{hasExternalUI:!0,textDirection:"rtl"}}},va={render:n=>{const e=C.useRef(null);return C.useEffect(()=>{const t=setTimeout(()=>{e.current&&(e.current.addAnnotation(wA,"spelling","annotationId"),e.current.addAnnotation(SA,"grammar","abc123"))},0);return()=>clearTimeout(t)},[]),S.jsx(Ul,{...n,ref:e})},args:{defaultUsj:Hn,scrRef:Bt}},NA={hasExternalUI:!0,view:{...Ao(),noteMode:"expandInline"},nodes:{noteCallerOnClick:(n,e,t,r,i)=>{t||(r()===Gr?i(pf):i(Gr))}}},ka={render:(n,e)=>li(n,e,Bt),parameters:{docs:{description:{story:"This story demonstrates editing notes inline. Move your cursor to a note caller and the note will expand and can be edited. Move the cursor out of the note and it will collapse. Click the expanded note caller to toggle between the auto-generated caller and the hidden caller."}}},args:{defaultUsj:Hn,options:NA}},MA={hasExternalUI:!0,view:{...Ao(),noteMode:"expandInline"}},xa={render:(n,e)=>li(n,e,Bt),parameters:{docs:{description:{story:'This story demonstrates inserting notes. Use the Project menu (hamburger) or the toolbar buttons above the editor to insert footnotes, cross-references, and endnotes at the current cursor position. Selecting text before inserting a footnote will use that text as the footnote quote. You can also insert by typing "\\f", "\\x", or "\\fe".'}}},args:{defaultUsj:Hn,options:MA}},AA={hasExternalUI:!0,nodes:{noteCallers:["①","②","③","④","⑤","⑥","⑦","⑧","⑨","⑩"],noteCallerOnClick:(n,e,t,r,i,s)=>{console.log("Note caller clicked:",n,e,t,r,i,s),alert("Note caller clicked! Check console for details.")}}},Ca={render:(n,e)=>li(n,e,Bt),parameters:{docs:{description:{story:"This story demonstrates custom note callers and click handling. **Try clicking on the circled number footnote markers (① ②) in the text to see the click handler in action!** The click event will show an alert and log details to the browser console."}}},args:{defaultUsj:Hn,options:AA}},wa={render:(n,e)=>li(n,e,Bt),parameters:{docs:{description:{story:'This story demonstrates using a custom marker menu trigger key. **Try typing "?" (question mark) anywhere in the editor text to open the marker menu!** The default trigger is "\\\\" (backslash), but this story changes it to "?" for demonstration. The marker menu allows you to insert USFM markers into the text.'}}},args:{defaultUsj:Hn,options:{hasExternalUI:!0,markerMenuTrigger:"?"}}},Sa={render:(n,e)=>{var c,u,f,d;const t=C.useRef(null),[r,i]=C.useState(null),[s,o]=C.useState(!1),a=C.useMemo(()=>({...n.options??{},view:{markerMode:s?"visible":"hidden",hasSpacing:!0,isFormattedFont:!0}}),[n.options,s]);C.useEffect(()=>{var p,m;const h=(m=(p=t.current)==null?void 0:p.toolbarEndRef)==null?void 0:m.current;if(h)i(h);else{const y=window.setTimeout(()=>{var _,x;const b=(x=(_=t.current)==null?void 0:_.toolbarEndRef)==null?void 0:x.current;b&&i(b)},0);return()=>window.clearTimeout(y)}},[a]);const l=C.useCallback(()=>o(h=>!h),[]);return S.jsxs(Bf,{viewMode:e.viewMode,description:((f=(u=(c=e.parameters)==null?void 0:c.docs)==null?void 0:u.description)==null?void 0:f.story)??((d=e.parameters)==null?void 0:d.description),children:[S.jsx(Ul,{...n,options:a,ref:t}),r&&Nt.createPortal(S.jsx("button",{type:"button",title:"Show/hide markers","aria-label":"Show/hide markers","aria-pressed":s,className:`toolbar-item ${s?"active":""}`,onClick:l,children:S.jsx("span",{className:"icon pilcrow-icon","aria-hidden":"true",children:"¶"})}),r)]})},parameters:{docs:{description:{story:"This story demonstrates the Markers view, which shows USFM markers inline with the text. Click the **Show/hide markers** (¶) button in the editor toolbar to toggle the Markers view on and off. "}}},args:{defaultUsj:Hn,scrRef:Bt}},Ta={name:"View Options",render:(n,e)=>li(n,e,Bt),parameters:{docs:{description:{story:'Demonstrates the editor view options (marker visibility, spacing, and formatted font) using USX input. Below in the **Controls** tab, try changing the **options.view** values to see how they affect the editor display. Valid values for **markerMode** are _"hidden"_, _"visible"_, and _"editable"_. Valid values for **noteMode** are _"collapsed"_, _"expandInline"_, and _"expanded"_.'}}},args:{defaultUsj:Hn,options:{hasExternalUI:!0,view:{markerMode:"hidden",noteMode:"collapsed",hasSpacing:!0,isFormattedFont:!0}}}};var Jp,Vp,Gp;ma.parameters={...ma.parameters,docs:{...(Jp=ma.parameters)==null?void 0:Jp.docs,source:{originalSource:`{
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef
  }
}`,...(Gp=(Vp=ma.parameters)==null?void 0:Vp.docs)==null?void 0:Gp.source}}};var Yp,Xp,Qp;ya.parameters={...ya.parameters,docs:{...(Yp=ya.parameters)==null?void 0:Yp.docs,source:{originalSource:`{
  args: {
    defaultUsj: usjEmpty,
    scrRef: defaultScrRef
  }
}`,...(Qp=(Xp=ya.parameters)==null?void 0:Xp.docs)==null?void 0:Qp.source}}};var Zp,em,tm;_a.parameters={..._a.parameters,docs:{...(Zp=_a.parameters)==null?void 0:Zp.docs,source:{originalSource:`{
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef,
    options: {
      isReadonly: true
    }
  }
}`,...(tm=(em=_a.parameters)==null?void 0:em.docs)==null?void 0:tm.source}}};var nm,rm,im;ba.parameters={...ba.parameters,docs:{...(nm=ba.parameters)==null?void 0:nm.docs,source:{originalSource:`{
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'Right-to-left example using a Hebrew snippet (Psalm 1:1). ' + 'The editor is set to RTL via _options.textDirection = "rtl"_. If you want the UI ' + '(tab toolbar) to be RTL click **Switch direction** in the Storybook toolbar.'
      }
    }
  },
  args: {
    defaultUsj: usjHebrew,
    options: {
      hasExternalUI: true,
      textDirection: 'rtl'
    }
  }
}`,...(im=(rm=ba.parameters)==null?void 0:rm.docs)==null?void 0:im.source}}};var sm,om,am;va.parameters={...va.parameters,docs:{...(sm=va.parameters)==null?void 0:sm.docs,source:{originalSource:`{
  render: args => {
    // eslint-disable-next-line no-null/no-null
    const editorRef = useRef<EditorRef | null>(null);
    useEffect(() => {
      const timeoutId = setTimeout(() => {
        if (editorRef.current) {
          editorRef.current.addAnnotation(annotationRangeWeb1, 'spelling', 'annotationId');
          editorRef.current.addAnnotation(annotationRangeWeb2, 'grammar', 'abc123');
        }
      }, 0);
      return () => clearTimeout(timeoutId);
    }, []);
    return <Editorial {...args} ref={editorRef} />;
  },
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef
  }
}`,...(am=(om=va.parameters)==null?void 0:om.docs)==null?void 0:am.source}}};var lm,cm,um;ka.parameters={...ka.parameters,docs:{...(lm=ka.parameters)==null?void 0:lm.docs,source:{originalSource:`{
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates editing notes inline. Move your cursor to a note caller and ' + 'the note will expand and can be edited. Move the cursor out of the note and it will ' + 'collapse. Click the expanded note caller to toggle between the auto-generated caller ' + 'and the hidden caller.'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    options: inlineNoteOptions
  }
}`,...(um=(cm=ka.parameters)==null?void 0:cm.docs)==null?void 0:um.source}}};var dm,fm,hm;xa.parameters={...xa.parameters,docs:{...(dm=xa.parameters)==null?void 0:dm.docs,source:{originalSource:`{
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates inserting notes. Use the Project menu (hamburger) or the ' + 'toolbar buttons above the editor to insert footnotes, cross-references, and endnotes ' + 'at the current cursor position. Selecting text before inserting a footnote will use ' + 'that text as the footnote quote. You can also insert by typing "\\\\f", "\\\\x", or "\\\\fe".'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    options: insertNoteOptions
  }
}`,...(hm=(fm=xa.parameters)==null?void 0:fm.docs)==null?void 0:hm.source}}};var gm,pm,mm;Ca.parameters={...Ca.parameters,docs:{...(gm=Ca.parameters)==null?void 0:gm.docs,source:{originalSource:`{
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates custom note callers and click handling. **Try clicking on the ' + 'circled number footnote markers (① ②) in the text to see the click handler in ' + 'action!** The click event will show an alert and log details to the browser console.'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    options: customNodeOptions
  }
}`,...(mm=(pm=Ca.parameters)==null?void 0:pm.docs)==null?void 0:mm.source}}};var ym,_m,bm;wa.parameters={...wa.parameters,docs:{...(ym=wa.parameters)==null?void 0:ym.docs,source:{originalSource:`{
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates using a custom marker menu trigger key. **Try typing "?" ' + '(question mark) anywhere in the editor text to open the marker menu!** The default ' + 'trigger is "\\\\\\\\" (backslash), but this story changes it to "?" for demonstration. ' + 'The marker menu allows you to insert USFM markers into the text.'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    options: {
      hasExternalUI: true,
      markerMenuTrigger: '?'
    }
  }
}`,...(bm=(_m=wa.parameters)==null?void 0:_m.docs)==null?void 0:bm.source}}};var vm,km,xm;Sa.parameters={...Sa.parameters,docs:{...(vm=Sa.parameters)==null?void 0:vm.docs,source:{originalSource:`{
  render: (args, context) => {
    // eslint-disable-next-line no-null/no-null
    const editorRef = useRef<EditorRef | null>(null);
    // eslint-disable-next-line no-null/no-null
    const [toolbarEndEl, setToolbarEndEl] = useState<HTMLElement | null>(null);
    const [showMarkers, setShowMarkers] = useState(false);
    const mergedOptions = useMemo(() => {
      const base = args.options ?? {};
      const view: ViewOptions = {
        markerMode: showMarkers ? 'visible' : 'hidden',
        hasSpacing: true,
        isFormattedFont: true
      };
      return {
        ...base,
        view
      };
    }, [args.options, showMarkers]);
    useEffect(() => {
      const el = editorRef.current?.toolbarEndRef?.current;
      if (el) setToolbarEndEl(el);else {
        // Retry once on next tick in case the toolbar mounts after the ref effect
        const id = window.setTimeout(() => {
          const el2 = editorRef.current?.toolbarEndRef?.current;
          if (el2) setToolbarEndEl(el2);
        }, 0);
        return () => window.clearTimeout(id);
      }
      return undefined;
    }, [mergedOptions]);
    const handleShowMarkerToggle = useCallback(() => setShowMarkers(v => !v), []);
    return <CanvasWithDescription viewMode={context.viewMode} description={context.parameters?.docs?.description?.story ?? context.parameters?.description}>
        <Editorial {...args} options={mergedOptions} ref={editorRef} />
        {toolbarEndEl && createPortal(<button type="button" title="Show/hide markers" aria-label="Show/hide markers" aria-pressed={showMarkers} className={\`toolbar-item \${showMarkers ? 'active' : ''}\`} onClick={handleShowMarkerToggle}>
              <span className="icon pilcrow-icon" aria-hidden="true">
                ¶
              </span>
            </button>, toolbarEndEl)}
      </CanvasWithDescription>;
  },
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates the Markers view, which shows USFM markers inline with the ' + 'text. Click the **Show/hide markers** (¶) button in the editor toolbar to toggle the ' + 'Markers view on and off. '
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef
  }
}`,...(xm=(km=Sa.parameters)==null?void 0:km.docs)==null?void 0:xm.source}}};var Cm,wm,Sm;Ta.parameters={...Ta.parameters,docs:{...(Cm=Ta.parameters)==null?void 0:Cm.docs,source:{originalSource:`{
  name: 'View Options',
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'Demonstrates the editor view options (marker visibility, spacing, and formatted font) ' + 'using USX input. Below in the **Controls** tab, try changing the **options.view** ' + 'values to see how they affect the editor display. Valid values for **markerMode** are ' + '_"hidden"_, _"visible"_, and _"editable"_. Valid values for **noteMode** are ' + '_"collapsed"_, _"expandInline"_, and _"expanded"_.'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    options: {
      hasExternalUI: true,
      view: {
        markerMode: 'hidden',
        noteMode: 'collapsed',
        hasSpacing: true,
        isFormattedFont: true
      }
    }
  }
}`,...(Sm=(wm=Ta.parameters)==null?void 0:wm.docs)==null?void 0:Sm.source}}};const BO=["Default","Empty","ReadOnly","RTL","Annotated","InlineNoteEditing","InsertNote","CustomNoteOptions","CustomMarkerTrigger","MarkersView","ViewOptionsStory"];export{va as Annotated,wa as CustomMarkerTrigger,Ca as CustomNoteOptions,ma as Default,ya as Empty,ka as InlineNoteEditing,xa as InsertNote,Sa as MarkersView,ba as RTL,_a as ReadOnly,Ta as ViewOptionsStory,BO as __namedExportsOrder,qO as default};
