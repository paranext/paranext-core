var np=Object.defineProperty;var rp=(t,e,n)=>e in t?np(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var sn=(t,e,n)=>rp(t,typeof e!="symbol"?e+"":e,n);import{j as m}from"./jsx-runtime-C9lP4xZD.js";import{c as cn,g as sp,r as b}from"./iframe-Dk8KDq2X.js";import{G as od,m as lt,F as ip,N as us,P as ds,J as op,I as ad,C as ap,X as lp,_ as cp,v as up,U as dp,L as hp,w as fp,D as Vr,$ as pp,Z as Wa}from"./index-DJl4I_01.js";import{h as bn,G as Ot,i as ld,N as Z,k as Ie,l as yi,g as gp,j as re,D as vt,v as mp,w as Ll,H as ss,O as se,_ as Y,$ as yp,p as Xe,a as ue,Y as Zr,q as Qr,V as cd,s as xe,U as ud,C as Ka,R as pa,t as Ja,B as bp,u as dd,F as _p,y as hd,z as kp,A as vp,I as fd,J as wp,K as xp,M as Cp,S as Sp,T as Tp,Z as kr,a0 as za,a1 as pd,a2 as Ep,a3 as gd,a4 as Op,a5 as Mp,a6 as Ap,a7 as md,a8 as Hi,a9 as yd,aa as Dl,ab as jp,ac as Wi,ad as Ki,ae as Np,af as Ip,ag as Fl,ah as Rp,ai as Wo,aj as Pp,ak as $p,al as ql,am as Ul,an as Lp,ao as Dp,ap as Fp,aq as qp,ar as Up,as as Bp,at as Hp,au as Wp,av as Kp,aw as Jp,ax as zp,ay as Vp,az as Ji,aA as Gp,aB as bd,aC as Bl,f as _d,W as Va,L as Yp,n as kd,x as vd,aD as Ee,aE as vr,aF as wd,aG as Hl,aH as wr,aI as _n,o as Nt,aJ as Ti,r as ws,aK as ga,aL as _e,aM as bi,aN as zi,aO as Xp,aP as Zp,aQ as Qp,aR as xd,aS as Cd,aT as Ga,aU as At,aV as eg,aW as Sd,aX as xr,aY as tg,aZ as Wl,a_ as ng,a$ as rg,b0 as sg,b1 as ig,d as og,b as ag,c as lg}from"./LexicalTable.prod-iuD9O5o1.js";import{r as jt}from"./index-yvZ7PgRA.js";import{d as an,Q as cg}from"./index-D4WxyQbG.js";import{c as ug,d as dg,e as hg,g as fg}from"./floating-ui.react-dom-C4IeDNVo.js";import{M as pg}from"./markdown-renderer.component-CwFDFTDb.js";import{C as gg,a as mg,b as yg,d as bg}from"./card-3ER-D7sk.js";import{B as _g}from"./book-chapter-control.component-CVLxPUzw.js";import{T as kg}from"./tab-toolbar.component-BIiTPCUG.js";import{B as mt}from"./button-BsaZIIm5.js";import{D as Ya,a as Xa,b as Za,c as vg,j as Td,e as Ed,l as ir}from"./dropdown-menu-DyjTTjFf.js";import{C as wg}from"./chevron-down-DkwsC5fz.js";import{c as rt}from"./createLucideIcon-M8N92ijB.js";import{F as Ht}from"./file-text-eGzDQh5M.js";import{a as is,T as os,b as _i,c as as,d as xg}from"./tooltip-Cw5VMs5J.js";import{I as Cg}from"./input-DGUH-WHj.js";import{X as Sg}from"./x-B4ZZC3ku.js";import{C as Tg}from"./check-GWvxucFY.js";import{C as Eg}from"./copy-CYSIpuCj.js";import{P as Og,c as Mg,b as Ag}from"./popover-BBIH3R04.js";import"./preload-helper-CTOgD26E.js";import"./index-Bl2C2VvJ.js";import"./index-BT79Gz9L.js";import"./shadcn-ui.util-DMJ19wEV.js";import"./book-item.utils-CN_laTeo.js";import"./command-Dyc65-5A.js";import"./index-B6IUxA0A.js";import"./index-DVjb_yKA.js";import"./index-CPwXPwa2.js";import"./index-KYlmHo3f.js";import"./index-Curs6ubg.js";import"./index-CgF_C4Do.js";import"./index-CavaIO4R.js";import"./index-CDS99ctC.js";import"./index-B97wndpY.js";import"./index-Cg-idBe1.js";import"./index-DvEyGQQn.js";import"./dialog-B17rN5_J.js";import"./search-CRIHHPAz.js";import"./chevron-left-CCIkhIar.js";import"./chevron-right-CDrBKN2F.js";import"./arrow-right-vBM8PkHf.js";import"./tab-dropdown-menu.component-BYcD27i9.js";import"./menu.util-Dxh7JGT4.js";import"./menu-icon.component-CukNDcXN.js";import"./tab-toolbar-container.component-BbC5KO53.js";import"./index-BPbCuWFR.js";import"./index-SwLvMHoi.js";import"./index-DTAXz6r9.js";import"./index-CMGOdVf-.js";import"./index-D5D5Qknc.js";import"./index-DGEUPA-u.js";import"./index-ybRRKJFx.js";import"./index-C-quGXKF.js";import"./index-Bf0V49m4.js";import"./index-BM0Dj7xm.js";import"./index-CUYehjOf.js";import"./circle-BPd0eyBR.js";import"./index-CAR5Y8N9.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jg=[["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 18h18",key:"1h113x"}],["path",{d:"M3 6h18",key:"d0wm0j"}]],Vs=rt("AlignJustify",jg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ng=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]],Ig=rt("Ban",Ng);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rg=[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"m17 12 3-2v8",key:"1hhhft"}]],nr=rt("Heading1",Rg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pg=[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M21 18h-4c0-4 4-3 4-6 0-1.5-2-2.5-4-1",key:"9jr5yi"}]],Kl=rt("Heading2",Pg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $g=[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M17.5 10.5c1.7-1 3.5 0 3.5 1.5a2 2 0 0 1-2 2",key:"68ncm8"}],["path",{d:"M17 17.5c2 1.5 4 .3 4-1.5a2 2 0 0 0-2-2",key:"1ejuhz"}]],Ko=rt("Heading3",$g);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lg=[["path",{d:"M16 12H3",key:"1a2rj7"}],["path",{d:"M16 6H3",key:"1wxfjs"}],["path",{d:"M10 18H3",key:"13769t"}],["path",{d:"M21 6v10a2 2 0 0 1-2 2h-5",key:"ilrcs8"}],["path",{d:"m16 16-2 2 2 2",key:"kkc6pm"}]],Dg=rt("ListEnd",Lg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fg=[["path",{d:"M21 7v6h-6",key:"3ptur4"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7",key:"1kgawr"}]],qg=rt("Redo",Fg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ug=[["path",{d:"m18 14 4 4-4 4",key:"10pe0f"}],["path",{d:"m18 2 4 4-4 4",key:"pucp1d"}],["path",{d:"M2 18h1.973a4 4 0 0 0 3.3-1.7l5.454-8.6a4 4 0 0 1 3.3-1.7H22",key:"1ailkh"}],["path",{d:"M2 6h1.972a4 4 0 0 1 3.6 2.2",key:"km57vx"}],["path",{d:"M22 18h-6.041a4 4 0 0 1-3.3-1.8l-.359-.45",key:"os18l9"}]],Bg=rt("Shuffle",Ug);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hg=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"M9 17c2 0 2.8-1 2.8-2.8V10c0-2 1-3.3 3.2-3",key:"m1af9g"}],["path",{d:"M9 11.2h5.7",key:"3zgcl2"}]],Od=rt("SquareFunction",Hg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wg=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M16 8.9V7H8l4 5-4 5h8v-1.9",key:"9nih0i"}]],Md=rt("SquareSigma",Wg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kg=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],Ad=rt("SquareX",Kg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jg=[["path",{d:"m4 19 8-8",key:"hr47gm"}],["path",{d:"m12 19-8-8",key:"1dhhmo"}],["path",{d:"M20 12h-4c0-1.5.442-2 1.5-2.5S20 8.334 20 7.002c0-.472-.17-.93-.484-1.29a2.105 2.105 0 0 0-2.617-.436c-.42.239-.738.614-.899 1.06",key:"1dfcux"}]],zg=rt("Superscript",Jg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vg=[["path",{d:"M17 6H3",key:"16j9eg"}],["path",{d:"M21 12H8",key:"scolzb"}],["path",{d:"M21 18H8",key:"1wfozv"}],["path",{d:"M3 12v6",key:"fv4c87"}]],Jo=rt("TextQuote",Vg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gg=[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]],Yg=rt("Undo",Gg);var Gs={exports:{}},zo,Jl;function Xg(){if(Jl)return zo;Jl=1;var t=-1,e=1,n=0;function r(_,j,x,P,E){if(_===j)return _?[[n,_]]:[];if(x!=null){var M=H(_,j,x);if(M)return M}var N=a(_,j),D=_.substring(0,N);_=_.substring(N),j=j.substring(N),N=u(_,j);var U=_.substring(_.length-N);_=_.substring(0,_.length-N),j=j.substring(0,j.length-N);var B=s(_,j);return D&&B.unshift([n,D]),U&&B.push([n,U]),v(B,E),P&&f(B),B}function s(_,j){var x;if(!_)return[[e,j]];if(!j)return[[t,_]];var P=_.length>j.length?_:j,E=_.length>j.length?j:_,M=P.indexOf(E);if(M!==-1)return x=[[e,P.substring(0,M)],[n,E],[e,P.substring(M+E.length)]],_.length>j.length&&(x[0][0]=x[2][0]=t),x;if(E.length===1)return[[t,_],[e,j]];var N=d(_,j);if(N){var D=N[0],U=N[1],B=N[2],z=N[3],J=N[4],X=r(D,B),ne=r(U,z);return X.concat([[n,J]],ne)}return i(_,j)}function i(_,j){for(var x=_.length,P=j.length,E=Math.ceil((x+P)/2),M=E,N=2*E,D=new Array(N),U=new Array(N),B=0;B<N;B++)D[B]=-1,U[B]=-1;D[M+1]=0,U[M+1]=0;for(var z=x-P,J=z%2!==0,X=0,ne=0,V=0,de=0,ye=0;ye<E;ye++){for(var te=-ye+X;te<=ye-ne;te+=2){var ie=M+te,oe;te===-ye||te!==ye&&D[ie-1]<D[ie+1]?oe=D[ie+1]:oe=D[ie-1]+1;for(var he=oe-te;oe<x&&he<P&&_.charAt(oe)===j.charAt(he);)oe++,he++;if(D[ie]=oe,oe>x)ne+=2;else if(he>P)X+=2;else if(J){var pe=M+z-te;if(pe>=0&&pe<N&&U[pe]!==-1){var me=x-U[pe];if(oe>=me)return o(_,j,oe,he)}}}for(var Oe=-ye+V;Oe<=ye-de;Oe+=2){var pe=M+Oe,me;Oe===-ye||Oe!==ye&&U[pe-1]<U[pe+1]?me=U[pe+1]:me=U[pe-1]+1;for(var Ue=me-Oe;me<x&&Ue<P&&_.charAt(x-me-1)===j.charAt(P-Ue-1);)me++,Ue++;if(U[pe]=me,me>x)de+=2;else if(Ue>P)V+=2;else if(!J){var ie=M+z-Oe;if(ie>=0&&ie<N&&D[ie]!==-1){var oe=D[ie],he=M+oe-ie;if(me=x-me,oe>=me)return o(_,j,oe,he)}}}}return[[t,_],[e,j]]}function o(_,j,x,P){var E=_.substring(0,x),M=j.substring(0,P),N=_.substring(x),D=j.substring(P),U=r(E,M),B=r(N,D);return U.concat(B)}function a(_,j){if(!_||!j||_.charAt(0)!==j.charAt(0))return 0;for(var x=0,P=Math.min(_.length,j.length),E=P,M=0;x<E;)_.substring(M,E)==j.substring(M,E)?(x=E,M=x):P=E,E=Math.floor((P-x)/2+x);return O(_.charCodeAt(E-1))&&E--,E}function l(_,j){var x=_.length,P=j.length;if(x==0||P==0)return 0;x>P?_=_.substring(x-P):x<P&&(j=j.substring(0,x));var E=Math.min(x,P);if(_==j)return E;for(var M=0,N=1;;){var D=_.substring(E-N),U=j.indexOf(D);if(U==-1)return M;N+=U,(U==0||_.substring(E-N)==j.substring(0,N))&&(M=N,N++)}}function u(_,j){if(!_||!j||_.slice(-1)!==j.slice(-1))return 0;for(var x=0,P=Math.min(_.length,j.length),E=P,M=0;x<E;)_.substring(_.length-E,_.length-M)==j.substring(j.length-E,j.length-M)?(x=E,M=x):P=E,E=Math.floor((P-x)/2+x);return I(_.charCodeAt(_.length-E))&&E--,E}function d(_,j){var x=_.length>j.length?_:j,P=_.length>j.length?j:_;if(x.length<4||P.length*2<x.length)return null;function E(ne,V,de){for(var ye=ne.substring(de,de+Math.floor(ne.length/4)),te=-1,ie="",oe,he,pe,me;(te=V.indexOf(ye,te+1))!==-1;){var Oe=a(ne.substring(de),V.substring(te)),Ue=u(ne.substring(0,de),V.substring(0,te));ie.length<Ue+Oe&&(ie=V.substring(te-Ue,te)+V.substring(te,te+Oe),oe=ne.substring(0,de-Ue),he=ne.substring(de+Oe),pe=V.substring(0,te-Ue),me=V.substring(te+Oe))}return ie.length*2>=ne.length?[oe,he,pe,me,ie]:null}var M=E(x,P,Math.ceil(x.length/4)),N=E(x,P,Math.ceil(x.length/2)),D;if(!M&&!N)return null;N?M?D=M[4].length>N[4].length?M:N:D=N:D=M;var U,B,z,J;_.length>j.length?(U=D[0],B=D[1],z=D[2],J=D[3]):(z=D[0],J=D[1],U=D[2],B=D[3]);var X=D[4];return[U,B,z,J,X]}function f(_){for(var j=!1,x=[],P=0,E=null,M=0,N=0,D=0,U=0,B=0;M<_.length;)_[M][0]==n?(x[P++]=M,N=U,D=B,U=0,B=0,E=_[M][1]):(_[M][0]==e?U+=_[M][1].length:B+=_[M][1].length,E&&E.length<=Math.max(N,D)&&E.length<=Math.max(U,B)&&(_.splice(x[P-1],0,[t,E]),_[x[P-1]+1][0]=e,P--,P--,M=P>0?x[P-1]:-1,N=0,D=0,U=0,B=0,E=null,j=!0)),M++;for(j&&v(_),A(_),M=1;M<_.length;){if(_[M-1][0]==t&&_[M][0]==e){var z=_[M-1][1],J=_[M][1],X=l(z,J),ne=l(J,z);X>=ne?(X>=z.length/2||X>=J.length/2)&&(_.splice(M,0,[n,J.substring(0,X)]),_[M-1][1]=z.substring(0,z.length-X),_[M+1][1]=J.substring(X),M++):(ne>=z.length/2||ne>=J.length/2)&&(_.splice(M,0,[n,z.substring(0,ne)]),_[M-1][0]=e,_[M-1][1]=J.substring(0,J.length-ne),_[M+1][0]=t,_[M+1][1]=z.substring(ne),M++),M++}M++}}var h=/[^a-zA-Z0-9]/,p=/\s/,y=/[\r\n]/,k=/\n\r?\n$/,C=/^\r?\n\r?\n/;function A(_){function j(ne,V){if(!ne||!V)return 6;var de=ne.charAt(ne.length-1),ye=V.charAt(0),te=de.match(h),ie=ye.match(h),oe=te&&de.match(p),he=ie&&ye.match(p),pe=oe&&de.match(y),me=he&&ye.match(y),Oe=pe&&ne.match(k),Ue=me&&V.match(C);return Oe||Ue?5:pe||me?4:te&&!oe&&he?3:oe||he?2:te||ie?1:0}for(var x=1;x<_.length-1;){if(_[x-1][0]==n&&_[x+1][0]==n){var P=_[x-1][1],E=_[x][1],M=_[x+1][1],N=u(P,E);if(N){var D=E.substring(E.length-N);P=P.substring(0,P.length-N),E=D+E.substring(0,E.length-N),M=D+M}for(var U=P,B=E,z=M,J=j(P,E)+j(E,M);E.charAt(0)===M.charAt(0);){P+=E.charAt(0),E=E.substring(1)+M.charAt(0),M=M.substring(1);var X=j(P,E)+j(E,M);X>=J&&(J=X,U=P,B=E,z=M)}_[x-1][1]!=U&&(U?_[x-1][1]=U:(_.splice(x-1,1),x--),_[x][1]=B,z?_[x+1][1]=z:(_.splice(x+1,1),x--))}x++}}function v(_,j){_.push([n,""]);for(var x=0,P=0,E=0,M="",N="",D;x<_.length;){if(x<_.length-1&&!_[x][1]){_.splice(x,1);continue}switch(_[x][0]){case e:E++,N+=_[x][1],x++;break;case t:P++,M+=_[x][1],x++;break;case n:var U=x-E-P-1;if(j){if(U>=0&&q(_[U][1])){var B=_[U][1].slice(-1);if(_[U][1]=_[U][1].slice(0,-1),M=B+M,N=B+N,!_[U][1]){_.splice(U,1),x--;var z=U-1;_[z]&&_[z][0]===e&&(E++,N=_[z][1]+N,z--),_[z]&&_[z][0]===t&&(P++,M=_[z][1]+M,z--),U=z}}if(L(_[x][1])){var B=_[x][1].charAt(0);_[x][1]=_[x][1].slice(1),M+=B,N+=B}}if(x<_.length-1&&!_[x][1]){_.splice(x,1);break}if(M.length>0||N.length>0){M.length>0&&N.length>0&&(D=a(N,M),D!==0&&(U>=0?_[U][1]+=N.substring(0,D):(_.splice(0,0,[n,N.substring(0,D)]),x++),N=N.substring(D),M=M.substring(D)),D=u(N,M),D!==0&&(_[x][1]=N.substring(N.length-D)+_[x][1],N=N.substring(0,N.length-D),M=M.substring(0,M.length-D)));var J=E+P;M.length===0&&N.length===0?(_.splice(x-J,J),x=x-J):M.length===0?(_.splice(x-J,J,[e,N]),x=x-J+1):N.length===0?(_.splice(x-J,J,[t,M]),x=x-J+1):(_.splice(x-J,J,[t,M],[e,N]),x=x-J+2)}x!==0&&_[x-1][0]===n?(_[x-1][1]+=_[x][1],_.splice(x,1)):x++,E=0,P=0,M="",N="";break}}_[_.length-1][1]===""&&_.pop();var X=!1;for(x=1;x<_.length-1;)_[x-1][0]===n&&_[x+1][0]===n&&(_[x][1].substring(_[x][1].length-_[x-1][1].length)===_[x-1][1]?(_[x][1]=_[x-1][1]+_[x][1].substring(0,_[x][1].length-_[x-1][1].length),_[x+1][1]=_[x-1][1]+_[x+1][1],_.splice(x-1,1),X=!0):_[x][1].substring(0,_[x+1][1].length)==_[x+1][1]&&(_[x-1][1]+=_[x+1][1],_[x][1]=_[x][1].substring(_[x+1][1].length)+_[x+1][1],_.splice(x+1,1),X=!0)),x++;X&&v(_,j)}function O(_){return _>=55296&&_<=56319}function I(_){return _>=56320&&_<=57343}function L(_){return I(_.charCodeAt(0))}function q(_){return O(_.charCodeAt(_.length-1))}function F(_){for(var j=[],x=0;x<_.length;x++)_[x][1].length>0&&j.push(_[x]);return j}function $(_,j,x,P){return q(_)||L(P)?null:F([[n,_],[t,j],[e,x],[n,P]])}function H(_,j,x){var P=typeof x=="number"?{index:x,length:0}:x.oldRange,E=typeof x=="number"?null:x.newRange,M=_.length,N=j.length;if(P.length===0&&(E===null||E.length===0)){var D=P.index,U=_.slice(0,D),B=_.slice(D),z=E?E.index:null;e:{var J=D+N-M;if(z!==null&&z!==J||J<0||J>N)break e;var X=j.slice(0,J),ne=j.slice(J);if(ne!==B)break e;var V=Math.min(D,J),de=U.slice(0,V),ye=X.slice(0,V);if(de!==ye)break e;var te=U.slice(V),ie=X.slice(V);return $(de,te,ie,B)}e:{if(z!==null&&z!==D)break e;var oe=D,X=j.slice(0,oe),ne=j.slice(oe);if(X!==U)break e;var he=Math.min(M-oe,N-oe),pe=B.slice(B.length-he),me=ne.slice(ne.length-he);if(pe!==me)break e;var te=B.slice(0,B.length-he),ie=ne.slice(0,ne.length-he);return $(U,te,ie,pe)}}if(P.length>0&&E&&E.length===0)e:{var de=_.slice(0,P.index),pe=_.slice(P.index+P.length),V=de.length,he=pe.length;if(N<V+he)break e;var ye=j.slice(0,V),me=j.slice(N-he);if(de!==ye||pe!==me)break e;var te=_.slice(V,M-he),ie=j.slice(V,N-he);return $(de,te,ie,pe)}return null}function W(_,j,x,P){return r(_,j,x,P,!0)}return W.INSERT=e,W.DELETE=t,W.EQUAL=n,zo=W,zo}var es={exports:{}};es.exports;var zl;function jd(){return zl||(zl=1,function(t,e){var n=200,r="__lodash_hash_undefined__",s=9007199254740991,i="[object Arguments]",o="[object Array]",a="[object Boolean]",l="[object Date]",u="[object Error]",d="[object Function]",f="[object GeneratorFunction]",h="[object Map]",p="[object Number]",y="[object Object]",k="[object Promise]",C="[object RegExp]",A="[object Set]",v="[object String]",O="[object Symbol]",I="[object WeakMap]",L="[object ArrayBuffer]",q="[object DataView]",F="[object Float32Array]",$="[object Float64Array]",H="[object Int8Array]",W="[object Int16Array]",_="[object Int32Array]",j="[object Uint8Array]",x="[object Uint8ClampedArray]",P="[object Uint16Array]",E="[object Uint32Array]",M=/[\\^$.*+?()[\]{}|]/g,N=/\w*$/,D=/^\[object .+?Constructor\]$/,U=/^(?:0|[1-9]\d*)$/,B={};B[i]=B[o]=B[L]=B[q]=B[a]=B[l]=B[F]=B[$]=B[H]=B[W]=B[_]=B[h]=B[p]=B[y]=B[C]=B[A]=B[v]=B[O]=B[j]=B[x]=B[P]=B[E]=!0,B[u]=B[d]=B[I]=!1;var z=typeof cn=="object"&&cn&&cn.Object===Object&&cn,J=typeof self=="object"&&self&&self.Object===Object&&self,X=z||J||Function("return this")(),ne=e&&!e.nodeType&&e,V=ne&&!0&&t&&!t.nodeType&&t,de=V&&V.exports===ne;function ye(c,g){return c.set(g[0],g[1]),c}function te(c,g){return c.add(g),c}function ie(c,g){for(var w=-1,R=c?c.length:0;++w<R&&g(c[w],w,c)!==!1;);return c}function oe(c,g){for(var w=-1,R=g.length,ee=c.length;++w<R;)c[ee+w]=g[w];return c}function he(c,g,w,R){for(var ee=-1,G=c?c.length:0;++ee<G;)w=g(w,c[ee],ee,c);return w}function pe(c,g){for(var w=-1,R=Array(c);++w<c;)R[w]=g(w);return R}function me(c,g){return c==null?void 0:c[g]}function Oe(c){var g=!1;if(c!=null&&typeof c.toString!="function")try{g=!!(c+"")}catch{}return g}function Ue(c){var g=-1,w=Array(c.size);return c.forEach(function(R,ee){w[++g]=[ee,R]}),w}function Nr(c,g){return function(w){return c(g(w))}}function Ms(c){var g=-1,w=Array(c.size);return c.forEach(function(R){w[++g]=R}),w}var no=Array.prototype,ro=Function.prototype,Kn=Object.prototype,Ir=X["__core-js_shared__"],As=function(){var c=/[^.]+$/.exec(Ir&&Ir.keys&&Ir.keys.IE_PROTO||"");return c?"Symbol(src)_1."+c:""}(),js=ro.toString,xt=Kn.hasOwnProperty,Jn=Kn.toString,so=RegExp("^"+js.call(xt).replace(M,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Sn=de?X.Buffer:void 0,zn=X.Symbol,Rr=X.Uint8Array,at=Nr(Object.getPrototypeOf,Object),Ns=Object.create,Is=Kn.propertyIsEnumerable,io=no.splice,Pr=Object.getOwnPropertySymbols,Vn=Sn?Sn.isBuffer:void 0,Rs=Nr(Object.keys,Object),Gn=pt(X,"DataView"),Tn=pt(X,"Map"),ft=pt(X,"Promise"),Yn=pt(X,"Set"),$r=pt(X,"WeakMap"),En=pt(Object,"create"),Lr=Ve(Gn),On=Ve(Tn),Dr=Ve(ft),Fr=Ve(Yn),qr=Ve($r),nn=zn?zn.prototype:void 0,Ps=nn?nn.valueOf:void 0;function Ft(c){var g=-1,w=c?c.length:0;for(this.clear();++g<w;){var R=c[g];this.set(R[0],R[1])}}function oo(){this.__data__=En?En(null):{}}function ao(c){return this.has(c)&&delete this.__data__[c]}function lo(c){var g=this.__data__;if(En){var w=g[c];return w===r?void 0:w}return xt.call(g,c)?g[c]:void 0}function $s(c){var g=this.__data__;return En?g[c]!==void 0:xt.call(g,c)}function Ur(c,g){var w=this.__data__;return w[c]=En&&g===void 0?r:g,this}Ft.prototype.clear=oo,Ft.prototype.delete=ao,Ft.prototype.get=lo,Ft.prototype.has=$s,Ft.prototype.set=Ur;function Le(c){var g=-1,w=c?c.length:0;for(this.clear();++g<w;){var R=c[g];this.set(R[0],R[1])}}function co(){this.__data__=[]}function uo(c){var g=this.__data__,w=Zn(g,c);if(w<0)return!1;var R=g.length-1;return w==R?g.pop():io.call(g,w,1),!0}function ho(c){var g=this.__data__,w=Zn(g,c);return w<0?void 0:g[w][1]}function fo(c){return Zn(this.__data__,c)>-1}function po(c,g){var w=this.__data__,R=Zn(w,c);return R<0?w.push([c,g]):w[R][1]=g,this}Le.prototype.clear=co,Le.prototype.delete=uo,Le.prototype.get=ho,Le.prototype.has=fo,Le.prototype.set=po;function Be(c){var g=-1,w=c?c.length:0;for(this.clear();++g<w;){var R=c[g];this.set(R[0],R[1])}}function go(){this.__data__={hash:new Ft,map:new(Tn||Le),string:new Ft}}function mo(c){return An(this,c).delete(c)}function yo(c){return An(this,c).get(c)}function bo(c){return An(this,c).has(c)}function _o(c,g){return An(this,c).set(c,g),this}Be.prototype.clear=go,Be.prototype.delete=mo,Be.prototype.get=yo,Be.prototype.has=bo,Be.prototype.set=_o;function Ze(c){this.__data__=new Le(c)}function ko(){this.__data__=new Le}function vo(c){return this.__data__.delete(c)}function wo(c){return this.__data__.get(c)}function xo(c){return this.__data__.has(c)}function Co(c,g){var w=this.__data__;if(w instanceof Le){var R=w.__data__;if(!Tn||R.length<n-1)return R.push([c,g]),this;w=this.__data__=new Be(R)}return w.set(c,g),this}Ze.prototype.clear=ko,Ze.prototype.delete=vo,Ze.prototype.get=wo,Ze.prototype.has=xo,Ze.prototype.set=Co;function Xn(c,g){var w=Kr(c)||er(c)?pe(c.length,String):[],R=w.length,ee=!!R;for(var G in c)xt.call(c,G)&&!(ee&&(G=="length"||Do(G,R)))&&w.push(G);return w}function Ls(c,g,w){var R=c[g];(!(xt.call(c,g)&&Bs(R,w))||w===void 0&&!(g in c))&&(c[g]=w)}function Zn(c,g){for(var w=c.length;w--;)if(Bs(c[w][0],g))return w;return-1}function Ct(c,g){return c&&Wr(g,zr(g),c)}function Br(c,g,w,R,ee,G,ce){var le;if(R&&(le=G?R(c,ee,G,ce):R(c)),le!==void 0)return le;if(!Tt(c))return c;var Me=Kr(c);if(Me){if(le=$o(c),!g)return Io(c,le)}else{var fe=Ut(c),He=fe==d||fe==f;if(Hs(c))return Qn(c,g);if(fe==y||fe==i||He&&!G){if(Oe(c))return G?c:{};if(le=St(He?{}:c),!g)return Ro(c,Ct(le,c))}else{if(!B[fe])return G?c:{};le=Lo(c,fe,Br,g)}}ce||(ce=new Ze);var Qe=ce.get(c);if(Qe)return Qe;if(ce.set(c,le),!Me)var Ae=w?Po(c):zr(c);return ie(Ae||c,function(We,De){Ae&&(De=We,We=c[De]),Ls(le,De,Br(We,g,w,R,De,c,ce))}),le}function So(c){return Tt(c)?Ns(c):{}}function To(c,g,w){var R=g(c);return Kr(c)?R:oe(R,w(c))}function Eo(c){return Jn.call(c)}function Oo(c){if(!Tt(c)||qo(c))return!1;var g=Jr(c)||Oe(c)?so:D;return g.test(Ve(c))}function Mo(c){if(!qs(c))return Rs(c);var g=[];for(var w in Object(c))xt.call(c,w)&&w!="constructor"&&g.push(w);return g}function Qn(c,g){if(g)return c.slice();var w=new c.constructor(c.length);return c.copy(w),w}function Hr(c){var g=new c.constructor(c.byteLength);return new Rr(g).set(new Rr(c)),g}function Mn(c,g){var w=g?Hr(c.buffer):c.buffer;return new c.constructor(w,c.byteOffset,c.byteLength)}function Ds(c,g,w){var R=g?w(Ue(c),!0):Ue(c);return he(R,ye,new c.constructor)}function Fs(c){var g=new c.constructor(c.source,N.exec(c));return g.lastIndex=c.lastIndex,g}function Ao(c,g,w){var R=g?w(Ms(c),!0):Ms(c);return he(R,te,new c.constructor)}function jo(c){return Ps?Object(Ps.call(c)):{}}function No(c,g){var w=g?Hr(c.buffer):c.buffer;return new c.constructor(w,c.byteOffset,c.length)}function Io(c,g){var w=-1,R=c.length;for(g||(g=Array(R));++w<R;)g[w]=c[w];return g}function Wr(c,g,w,R){w||(w={});for(var ee=-1,G=g.length;++ee<G;){var ce=g[ee],le=void 0;Ls(w,ce,le===void 0?c[ce]:le)}return w}function Ro(c,g){return Wr(c,qt(c),g)}function Po(c){return To(c,zr,qt)}function An(c,g){var w=c.__data__;return Fo(g)?w[typeof g=="string"?"string":"hash"]:w.map}function pt(c,g){var w=me(c,g);return Oo(w)?w:void 0}var qt=Pr?Nr(Pr,Object):Bo,Ut=Eo;(Gn&&Ut(new Gn(new ArrayBuffer(1)))!=q||Tn&&Ut(new Tn)!=h||ft&&Ut(ft.resolve())!=k||Yn&&Ut(new Yn)!=A||$r&&Ut(new $r)!=I)&&(Ut=function(c){var g=Jn.call(c),w=g==y?c.constructor:void 0,R=w?Ve(w):void 0;if(R)switch(R){case Lr:return q;case On:return h;case Dr:return k;case Fr:return A;case qr:return I}return g});function $o(c){var g=c.length,w=c.constructor(g);return g&&typeof c[0]=="string"&&xt.call(c,"index")&&(w.index=c.index,w.input=c.input),w}function St(c){return typeof c.constructor=="function"&&!qs(c)?So(at(c)):{}}function Lo(c,g,w,R){var ee=c.constructor;switch(g){case L:return Hr(c);case a:case l:return new ee(+c);case q:return Mn(c,R);case F:case $:case H:case W:case _:case j:case x:case P:case E:return No(c,R);case h:return Ds(c,R,w);case p:case v:return new ee(c);case C:return Fs(c);case A:return Ao(c,R,w);case O:return jo(c)}}function Do(c,g){return g=g??s,!!g&&(typeof c=="number"||U.test(c))&&c>-1&&c%1==0&&c<g}function Fo(c){var g=typeof c;return g=="string"||g=="number"||g=="symbol"||g=="boolean"?c!=="__proto__":c===null}function qo(c){return!!As&&As in c}function qs(c){var g=c&&c.constructor,w=typeof g=="function"&&g.prototype||Kn;return c===w}function Ve(c){if(c!=null){try{return js.call(c)}catch{}try{return c+""}catch{}}return""}function Us(c){return Br(c,!0,!0)}function Bs(c,g){return c===g||c!==c&&g!==g}function er(c){return Uo(c)&&xt.call(c,"callee")&&(!Is.call(c,"callee")||Jn.call(c)==i)}var Kr=Array.isArray;function tr(c){return c!=null&&Ws(c.length)&&!Jr(c)}function Uo(c){return Ks(c)&&tr(c)}var Hs=Vn||Ho;function Jr(c){var g=Tt(c)?Jn.call(c):"";return g==d||g==f}function Ws(c){return typeof c=="number"&&c>-1&&c%1==0&&c<=s}function Tt(c){var g=typeof c;return!!c&&(g=="object"||g=="function")}function Ks(c){return!!c&&typeof c=="object"}function zr(c){return tr(c)?Xn(c):Mo(c)}function Bo(){return[]}function Ho(){return!1}t.exports=Us}(es,es.exports)),es.exports}var ts={exports:{}};ts.exports;var Vl;function Nd(){return Vl||(Vl=1,function(t,e){var n=200,r="__lodash_hash_undefined__",s=1,i=2,o=9007199254740991,a="[object Arguments]",l="[object Array]",u="[object AsyncFunction]",d="[object Boolean]",f="[object Date]",h="[object Error]",p="[object Function]",y="[object GeneratorFunction]",k="[object Map]",C="[object Number]",A="[object Null]",v="[object Object]",O="[object Promise]",I="[object Proxy]",L="[object RegExp]",q="[object Set]",F="[object String]",$="[object Symbol]",H="[object Undefined]",W="[object WeakMap]",_="[object ArrayBuffer]",j="[object DataView]",x="[object Float32Array]",P="[object Float64Array]",E="[object Int8Array]",M="[object Int16Array]",N="[object Int32Array]",D="[object Uint8Array]",U="[object Uint8ClampedArray]",B="[object Uint16Array]",z="[object Uint32Array]",J=/[\\^$.*+?()[\]{}|]/g,X=/^\[object .+?Constructor\]$/,ne=/^(?:0|[1-9]\d*)$/,V={};V[x]=V[P]=V[E]=V[M]=V[N]=V[D]=V[U]=V[B]=V[z]=!0,V[a]=V[l]=V[_]=V[d]=V[j]=V[f]=V[h]=V[p]=V[k]=V[C]=V[v]=V[L]=V[q]=V[F]=V[W]=!1;var de=typeof cn=="object"&&cn&&cn.Object===Object&&cn,ye=typeof self=="object"&&self&&self.Object===Object&&self,te=de||ye||Function("return this")(),ie=e&&!e.nodeType&&e,oe=ie&&!0&&t&&!t.nodeType&&t,he=oe&&oe.exports===ie,pe=he&&de.process,me=function(){try{return pe&&pe.binding&&pe.binding("util")}catch{}}(),Oe=me&&me.isTypedArray;function Ue(c,g){for(var w=-1,R=c==null?0:c.length,ee=0,G=[];++w<R;){var ce=c[w];g(ce,w,c)&&(G[ee++]=ce)}return G}function Nr(c,g){for(var w=-1,R=g.length,ee=c.length;++w<R;)c[ee+w]=g[w];return c}function Ms(c,g){for(var w=-1,R=c==null?0:c.length;++w<R;)if(g(c[w],w,c))return!0;return!1}function no(c,g){for(var w=-1,R=Array(c);++w<c;)R[w]=g(w);return R}function ro(c){return function(g){return c(g)}}function Kn(c,g){return c.has(g)}function Ir(c,g){return c==null?void 0:c[g]}function As(c){var g=-1,w=Array(c.size);return c.forEach(function(R,ee){w[++g]=[ee,R]}),w}function js(c,g){return function(w){return c(g(w))}}function xt(c){var g=-1,w=Array(c.size);return c.forEach(function(R){w[++g]=R}),w}var Jn=Array.prototype,so=Function.prototype,Sn=Object.prototype,zn=te["__core-js_shared__"],Rr=so.toString,at=Sn.hasOwnProperty,Ns=function(){var c=/[^.]+$/.exec(zn&&zn.keys&&zn.keys.IE_PROTO||"");return c?"Symbol(src)_1."+c:""}(),Is=Sn.toString,io=RegExp("^"+Rr.call(at).replace(J,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Pr=he?te.Buffer:void 0,Vn=te.Symbol,Rs=te.Uint8Array,Gn=Sn.propertyIsEnumerable,Tn=Jn.splice,ft=Vn?Vn.toStringTag:void 0,Yn=Object.getOwnPropertySymbols,$r=Pr?Pr.isBuffer:void 0,En=js(Object.keys,Object),Lr=qt(te,"DataView"),On=qt(te,"Map"),Dr=qt(te,"Promise"),Fr=qt(te,"Set"),qr=qt(te,"WeakMap"),nn=qt(Object,"create"),Ps=Ve(Lr),Ft=Ve(On),oo=Ve(Dr),ao=Ve(Fr),lo=Ve(qr),$s=Vn?Vn.prototype:void 0,Ur=$s?$s.valueOf:void 0;function Le(c){var g=-1,w=c==null?0:c.length;for(this.clear();++g<w;){var R=c[g];this.set(R[0],R[1])}}function co(){this.__data__=nn?nn(null):{},this.size=0}function uo(c){var g=this.has(c)&&delete this.__data__[c];return this.size-=g?1:0,g}function ho(c){var g=this.__data__;if(nn){var w=g[c];return w===r?void 0:w}return at.call(g,c)?g[c]:void 0}function fo(c){var g=this.__data__;return nn?g[c]!==void 0:at.call(g,c)}function po(c,g){var w=this.__data__;return this.size+=this.has(c)?0:1,w[c]=nn&&g===void 0?r:g,this}Le.prototype.clear=co,Le.prototype.delete=uo,Le.prototype.get=ho,Le.prototype.has=fo,Le.prototype.set=po;function Be(c){var g=-1,w=c==null?0:c.length;for(this.clear();++g<w;){var R=c[g];this.set(R[0],R[1])}}function go(){this.__data__=[],this.size=0}function mo(c){var g=this.__data__,w=Qn(g,c);if(w<0)return!1;var R=g.length-1;return w==R?g.pop():Tn.call(g,w,1),--this.size,!0}function yo(c){var g=this.__data__,w=Qn(g,c);return w<0?void 0:g[w][1]}function bo(c){return Qn(this.__data__,c)>-1}function _o(c,g){var w=this.__data__,R=Qn(w,c);return R<0?(++this.size,w.push([c,g])):w[R][1]=g,this}Be.prototype.clear=go,Be.prototype.delete=mo,Be.prototype.get=yo,Be.prototype.has=bo,Be.prototype.set=_o;function Ze(c){var g=-1,w=c==null?0:c.length;for(this.clear();++g<w;){var R=c[g];this.set(R[0],R[1])}}function ko(){this.size=0,this.__data__={hash:new Le,map:new(On||Be),string:new Le}}function vo(c){var g=pt(this,c).delete(c);return this.size-=g?1:0,g}function wo(c){return pt(this,c).get(c)}function xo(c){return pt(this,c).has(c)}function Co(c,g){var w=pt(this,c),R=w.size;return w.set(c,g),this.size+=w.size==R?0:1,this}Ze.prototype.clear=ko,Ze.prototype.delete=vo,Ze.prototype.get=wo,Ze.prototype.has=xo,Ze.prototype.set=Co;function Xn(c){var g=-1,w=c==null?0:c.length;for(this.__data__=new Ze;++g<w;)this.add(c[g])}function Ls(c){return this.__data__.set(c,r),this}function Zn(c){return this.__data__.has(c)}Xn.prototype.add=Xn.prototype.push=Ls,Xn.prototype.has=Zn;function Ct(c){var g=this.__data__=new Be(c);this.size=g.size}function Br(){this.__data__=new Be,this.size=0}function So(c){var g=this.__data__,w=g.delete(c);return this.size=g.size,w}function To(c){return this.__data__.get(c)}function Eo(c){return this.__data__.has(c)}function Oo(c,g){var w=this.__data__;if(w instanceof Be){var R=w.__data__;if(!On||R.length<n-1)return R.push([c,g]),this.size=++w.size,this;w=this.__data__=new Ze(R)}return w.set(c,g),this.size=w.size,this}Ct.prototype.clear=Br,Ct.prototype.delete=So,Ct.prototype.get=To,Ct.prototype.has=Eo,Ct.prototype.set=Oo;function Mo(c,g){var w=er(c),R=!w&&Bs(c),ee=!w&&!R&&tr(c),G=!w&&!R&&!ee&&Ks(c),ce=w||R||ee||G,le=ce?no(c.length,String):[],Me=le.length;for(var fe in c)at.call(c,fe)&&!(ce&&(fe=="length"||ee&&(fe=="offset"||fe=="parent")||G&&(fe=="buffer"||fe=="byteLength"||fe=="byteOffset")||Lo(fe,Me)))&&le.push(fe);return le}function Qn(c,g){for(var w=c.length;w--;)if(Us(c[w][0],g))return w;return-1}function Hr(c,g,w){var R=g(c);return er(c)?R:Nr(R,w(c))}function Mn(c){return c==null?c===void 0?H:A:ft&&ft in Object(c)?Ut(c):qs(c)}function Ds(c){return Tt(c)&&Mn(c)==a}function Fs(c,g,w,R,ee){return c===g?!0:c==null||g==null||!Tt(c)&&!Tt(g)?c!==c&&g!==g:Ao(c,g,w,R,Fs,ee)}function Ao(c,g,w,R,ee,G){var ce=er(c),le=er(g),Me=ce?l:St(c),fe=le?l:St(g);Me=Me==a?v:Me,fe=fe==a?v:fe;var He=Me==v,Qe=fe==v,Ae=Me==fe;if(Ae&&tr(c)){if(!tr(g))return!1;ce=!0,He=!1}if(Ae&&!He)return G||(G=new Ct),ce||Ks(c)?Wr(c,g,w,R,ee,G):Ro(c,g,Me,w,R,ee,G);if(!(w&s)){var We=He&&at.call(c,"__wrapped__"),De=Qe&&at.call(g,"__wrapped__");if(We||De){var rn=We?c.value():c,Bt=De?g.value():g;return G||(G=new Ct),ee(rn,Bt,w,R,G)}}return Ae?(G||(G=new Ct),Po(c,g,w,R,ee,G)):!1}function jo(c){if(!Ws(c)||Fo(c))return!1;var g=Hs(c)?io:X;return g.test(Ve(c))}function No(c){return Tt(c)&&Jr(c.length)&&!!V[Mn(c)]}function Io(c){if(!qo(c))return En(c);var g=[];for(var w in Object(c))at.call(c,w)&&w!="constructor"&&g.push(w);return g}function Wr(c,g,w,R,ee,G){var ce=w&s,le=c.length,Me=g.length;if(le!=Me&&!(ce&&Me>le))return!1;var fe=G.get(c);if(fe&&G.get(g))return fe==g;var He=-1,Qe=!0,Ae=w&i?new Xn:void 0;for(G.set(c,g),G.set(g,c);++He<le;){var We=c[He],De=g[He];if(R)var rn=ce?R(De,We,He,g,c,G):R(We,De,He,c,g,G);if(rn!==void 0){if(rn)continue;Qe=!1;break}if(Ae){if(!Ms(g,function(Bt,jn){if(!Kn(Ae,jn)&&(We===Bt||ee(We,Bt,w,R,G)))return Ae.push(jn)})){Qe=!1;break}}else if(!(We===De||ee(We,De,w,R,G))){Qe=!1;break}}return G.delete(c),G.delete(g),Qe}function Ro(c,g,w,R,ee,G,ce){switch(w){case j:if(c.byteLength!=g.byteLength||c.byteOffset!=g.byteOffset)return!1;c=c.buffer,g=g.buffer;case _:return!(c.byteLength!=g.byteLength||!G(new Rs(c),new Rs(g)));case d:case f:case C:return Us(+c,+g);case h:return c.name==g.name&&c.message==g.message;case L:case F:return c==g+"";case k:var le=As;case q:var Me=R&s;if(le||(le=xt),c.size!=g.size&&!Me)return!1;var fe=ce.get(c);if(fe)return fe==g;R|=i,ce.set(c,g);var He=Wr(le(c),le(g),R,ee,G,ce);return ce.delete(c),He;case $:if(Ur)return Ur.call(c)==Ur.call(g)}return!1}function Po(c,g,w,R,ee,G){var ce=w&s,le=An(c),Me=le.length,fe=An(g),He=fe.length;if(Me!=He&&!ce)return!1;for(var Qe=Me;Qe--;){var Ae=le[Qe];if(!(ce?Ae in g:at.call(g,Ae)))return!1}var We=G.get(c);if(We&&G.get(g))return We==g;var De=!0;G.set(c,g),G.set(g,c);for(var rn=ce;++Qe<Me;){Ae=le[Qe];var Bt=c[Ae],jn=g[Ae];if(R)var $l=ce?R(jn,Bt,Ae,g,c,G):R(Bt,jn,Ae,c,g,G);if(!($l===void 0?Bt===jn||ee(Bt,jn,w,R,G):$l)){De=!1;break}rn||(rn=Ae=="constructor")}if(De&&!rn){var Js=c.constructor,zs=g.constructor;Js!=zs&&"constructor"in c&&"constructor"in g&&!(typeof Js=="function"&&Js instanceof Js&&typeof zs=="function"&&zs instanceof zs)&&(De=!1)}return G.delete(c),G.delete(g),De}function An(c){return Hr(c,zr,$o)}function pt(c,g){var w=c.__data__;return Do(g)?w[typeof g=="string"?"string":"hash"]:w.map}function qt(c,g){var w=Ir(c,g);return jo(w)?w:void 0}function Ut(c){var g=at.call(c,ft),w=c[ft];try{c[ft]=void 0;var R=!0}catch{}var ee=Is.call(c);return R&&(g?c[ft]=w:delete c[ft]),ee}var $o=Yn?function(c){return c==null?[]:(c=Object(c),Ue(Yn(c),function(g){return Gn.call(c,g)}))}:Bo,St=Mn;(Lr&&St(new Lr(new ArrayBuffer(1)))!=j||On&&St(new On)!=k||Dr&&St(Dr.resolve())!=O||Fr&&St(new Fr)!=q||qr&&St(new qr)!=W)&&(St=function(c){var g=Mn(c),w=g==v?c.constructor:void 0,R=w?Ve(w):"";if(R)switch(R){case Ps:return j;case Ft:return k;case oo:return O;case ao:return q;case lo:return W}return g});function Lo(c,g){return g=g??o,!!g&&(typeof c=="number"||ne.test(c))&&c>-1&&c%1==0&&c<g}function Do(c){var g=typeof c;return g=="string"||g=="number"||g=="symbol"||g=="boolean"?c!=="__proto__":c===null}function Fo(c){return!!Ns&&Ns in c}function qo(c){var g=c&&c.constructor,w=typeof g=="function"&&g.prototype||Sn;return c===w}function qs(c){return Is.call(c)}function Ve(c){if(c!=null){try{return Rr.call(c)}catch{}try{return c+""}catch{}}return""}function Us(c,g){return c===g||c!==c&&g!==g}var Bs=Ds(function(){return arguments}())?Ds:function(c){return Tt(c)&&at.call(c,"callee")&&!Gn.call(c,"callee")},er=Array.isArray;function Kr(c){return c!=null&&Jr(c.length)&&!Hs(c)}var tr=$r||Ho;function Uo(c,g){return Fs(c,g)}function Hs(c){if(!Ws(c))return!1;var g=Mn(c);return g==p||g==y||g==u||g==I}function Jr(c){return typeof c=="number"&&c>-1&&c%1==0&&c<=o}function Ws(c){var g=typeof c;return c!=null&&(g=="object"||g=="function")}function Tt(c){return c!=null&&typeof c=="object"}var Ks=Oe?ro(Oe):No;function zr(c){return Kr(c)?Mo(c):Io(c)}function Bo(){return[]}function Ho(){return!1}t.exports=Uo}(ts,ts.exports)),ts.exports}var Ys={},Gl;function Zg(){if(Gl)return Ys;Gl=1,Object.defineProperty(Ys,"__esModule",{value:!0});const t=jd(),e=Nd();var n;return function(r){function s(l={},u={},d=!1){typeof l!="object"&&(l={}),typeof u!="object"&&(u={});let f=t(u);d||(f=Object.keys(f).reduce((h,p)=>(f[p]!=null&&(h[p]=f[p]),h),{}));for(const h in l)l[h]!==void 0&&u[h]===void 0&&(f[h]=l[h]);return Object.keys(f).length>0?f:void 0}r.compose=s;function i(l={},u={}){typeof l!="object"&&(l={}),typeof u!="object"&&(u={});const d=Object.keys(l).concat(Object.keys(u)).reduce((f,h)=>(e(l[h],u[h])||(f[h]=u[h]===void 0?null:u[h]),f),{});return Object.keys(d).length>0?d:void 0}r.diff=i;function o(l={},u={}){l=l||{};const d=Object.keys(u).reduce((f,h)=>(u[h]!==l[h]&&l[h]!==void 0&&(f[h]=u[h]),f),{});return Object.keys(l).reduce((f,h)=>(l[h]!==u[h]&&u[h]===void 0&&(f[h]=null),f),d)}r.invert=o;function a(l,u,d=!1){if(typeof l!="object")return u;if(typeof u!="object")return;if(!d)return u;const f=Object.keys(u).reduce((h,p)=>(l[p]===void 0&&(h[p]=u[p]),h),{});return Object.keys(f).length>0?f:void 0}r.transform=a}(n||(n={})),Ys.default=n,Ys}var Xs={},Yl;function Id(){if(Yl)return Xs;Yl=1,Object.defineProperty(Xs,"__esModule",{value:!0});var t;return function(e){function n(r){return typeof r.delete=="number"?r.delete:typeof r.retain=="number"?r.retain:typeof r.retain=="object"&&r.retain!==null?1:typeof r.insert=="string"?r.insert.length:1}e.length=n}(t||(t={})),Xs.default=t,Xs}var Zs={},Xl;function Qg(){if(Xl)return Zs;Xl=1,Object.defineProperty(Zs,"__esModule",{value:!0});const t=Id();class e{constructor(r){this.ops=r,this.index=0,this.offset=0}hasNext(){return this.peekLength()<1/0}next(r){r||(r=1/0);const s=this.ops[this.index];if(s){const i=this.offset,o=t.default.length(s);if(r>=o-i?(r=o-i,this.index+=1,this.offset=0):this.offset+=r,typeof s.delete=="number")return{delete:r};{const a={};return s.attributes&&(a.attributes=s.attributes),typeof s.retain=="number"?a.retain=r:typeof s.retain=="object"&&s.retain!==null?a.retain=s.retain:typeof s.insert=="string"?a.insert=s.insert.substr(i,r):a.insert=s.insert,a}}else return{retain:1/0}}peek(){return this.ops[this.index]}peekLength(){return this.ops[this.index]?t.default.length(this.ops[this.index])-this.offset:1/0}peekType(){const r=this.ops[this.index];return r?typeof r.delete=="number"?"delete":typeof r.retain=="number"||typeof r.retain=="object"&&r.retain!==null?"retain":"insert":"retain"}rest(){if(this.hasNext()){if(this.offset===0)return this.ops.slice(this.index);{const r=this.offset,s=this.index,i=this.next(),o=this.ops.slice(this.index);return this.offset=r,this.index=s,[i].concat(o)}}else return[]}}return Zs.default=e,Zs}var Zl;function em(){return Zl||(Zl=1,function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeMap=e.OpIterator=e.Op=void 0;const n=Xg(),r=jd(),s=Nd(),i=Zg();e.AttributeMap=i.default;const o=Id();e.Op=o.default;const a=Qg();e.OpIterator=a.default;const l="\0",u=(f,h)=>{if(typeof f!="object"||f===null)throw new Error(`cannot retain a ${typeof f}`);if(typeof h!="object"||h===null)throw new Error(`cannot retain a ${typeof h}`);const p=Object.keys(f)[0];if(!p||p!==Object.keys(h)[0])throw new Error(`embed types not matched: ${p} != ${Object.keys(h)[0]}`);return[p,f[p],h[p]]};class d{constructor(h){Array.isArray(h)?this.ops=h:h!=null&&Array.isArray(h.ops)?this.ops=h.ops:this.ops=[]}static registerEmbed(h,p){this.handlers[h]=p}static unregisterEmbed(h){delete this.handlers[h]}static getHandler(h){const p=this.handlers[h];if(!p)throw new Error(`no handlers for embed type "${h}"`);return p}insert(h,p){const y={};return typeof h=="string"&&h.length===0?this:(y.insert=h,p!=null&&typeof p=="object"&&Object.keys(p).length>0&&(y.attributes=p),this.push(y))}delete(h){return h<=0?this:this.push({delete:h})}retain(h,p){if(typeof h=="number"&&h<=0)return this;const y={retain:h};return p!=null&&typeof p=="object"&&Object.keys(p).length>0&&(y.attributes=p),this.push(y)}push(h){let p=this.ops.length,y=this.ops[p-1];if(h=r(h),typeof y=="object"){if(typeof h.delete=="number"&&typeof y.delete=="number")return this.ops[p-1]={delete:y.delete+h.delete},this;if(typeof y.delete=="number"&&h.insert!=null&&(p-=1,y=this.ops[p-1],typeof y!="object"))return this.ops.unshift(h),this;if(s(h.attributes,y.attributes)){if(typeof h.insert=="string"&&typeof y.insert=="string")return this.ops[p-1]={insert:y.insert+h.insert},typeof h.attributes=="object"&&(this.ops[p-1].attributes=h.attributes),this;if(typeof h.retain=="number"&&typeof y.retain=="number")return this.ops[p-1]={retain:y.retain+h.retain},typeof h.attributes=="object"&&(this.ops[p-1].attributes=h.attributes),this}}return p===this.ops.length?this.ops.push(h):this.ops.splice(p,0,h),this}chop(){const h=this.ops[this.ops.length-1];return h&&typeof h.retain=="number"&&!h.attributes&&this.ops.pop(),this}filter(h){return this.ops.filter(h)}forEach(h){this.ops.forEach(h)}map(h){return this.ops.map(h)}partition(h){const p=[],y=[];return this.forEach(k=>{(h(k)?p:y).push(k)}),[p,y]}reduce(h,p){return this.ops.reduce(h,p)}changeLength(){return this.reduce((h,p)=>p.insert?h+o.default.length(p):p.delete?h-p.delete:h,0)}length(){return this.reduce((h,p)=>h+o.default.length(p),0)}slice(h=0,p=1/0){const y=[],k=new a.default(this.ops);let C=0;for(;C<p&&k.hasNext();){let A;C<h?A=k.next(h-C):(A=k.next(p-C),y.push(A)),C+=o.default.length(A)}return new d(y)}compose(h){const p=new a.default(this.ops),y=new a.default(h.ops),k=[],C=y.peek();if(C!=null&&typeof C.retain=="number"&&C.attributes==null){let v=C.retain;for(;p.peekType()==="insert"&&p.peekLength()<=v;)v-=p.peekLength(),k.push(p.next());C.retain-v>0&&y.next(C.retain-v)}const A=new d(k);for(;p.hasNext()||y.hasNext();)if(y.peekType()==="insert")A.push(y.next());else if(p.peekType()==="delete")A.push(p.next());else{const v=Math.min(p.peekLength(),y.peekLength()),O=p.next(v),I=y.next(v);if(I.retain){const L={};if(typeof O.retain=="number")L.retain=typeof I.retain=="number"?v:I.retain;else if(typeof I.retain=="number")O.retain==null?L.insert=O.insert:L.retain=O.retain;else{const F=O.retain==null?"insert":"retain",[$,H,W]=u(O[F],I.retain),_=d.getHandler($);L[F]={[$]:_.compose(H,W,F==="retain")}}const q=i.default.compose(O.attributes,I.attributes,typeof O.retain=="number");if(q&&(L.attributes=q),A.push(L),!y.hasNext()&&s(A.ops[A.ops.length-1],L)){const F=new d(p.rest());return A.concat(F).chop()}}else typeof I.delete=="number"&&(typeof O.retain=="number"||typeof O.retain=="object"&&O.retain!==null)&&A.push(I)}return A.chop()}concat(h){const p=new d(this.ops.slice());return h.ops.length>0&&(p.push(h.ops[0]),p.ops=p.ops.concat(h.ops.slice(1))),p}diff(h,p){if(this.ops===h.ops)return new d;const y=[this,h].map(O=>O.map(I=>{if(I.insert!=null)return typeof I.insert=="string"?I.insert:l;const L=O===h?"on":"with";throw new Error("diff() called "+L+" non-document")}).join("")),k=new d,C=n(y[0],y[1],p,!0),A=new a.default(this.ops),v=new a.default(h.ops);return C.forEach(O=>{let I=O[1].length;for(;I>0;){let L=0;switch(O[0]){case n.INSERT:L=Math.min(v.peekLength(),I),k.push(v.next(L));break;case n.DELETE:L=Math.min(I,A.peekLength()),A.next(L),k.delete(L);break;case n.EQUAL:L=Math.min(A.peekLength(),v.peekLength(),I);const q=A.next(L),F=v.next(L);s(q.insert,F.insert)?k.retain(L,i.default.diff(q.attributes,F.attributes)):k.push(F).delete(L);break}I-=L}}),k.chop()}eachLine(h,p=`
`){const y=new a.default(this.ops);let k=new d,C=0;for(;y.hasNext();){if(y.peekType()!=="insert")return;const A=y.peek(),v=o.default.length(A)-y.peekLength(),O=typeof A.insert=="string"?A.insert.indexOf(p,v)-v:-1;if(O<0)k.push(y.next());else if(O>0)k.push(y.next(O));else{if(h(k,y.next(1).attributes||{},C)===!1)return;C+=1,k=new d}}k.length()>0&&h(k,{},C)}invert(h){const p=new d;return this.reduce((y,k)=>{if(k.insert)p.delete(o.default.length(k));else{if(typeof k.retain=="number"&&k.attributes==null)return p.retain(k.retain),y+k.retain;if(k.delete||typeof k.retain=="number"){const C=k.delete||k.retain;return h.slice(y,y+C).forEach(v=>{k.delete?p.push(v):k.retain&&k.attributes&&p.retain(o.default.length(v),i.default.invert(k.attributes,v.attributes))}),y+C}else if(typeof k.retain=="object"&&k.retain!==null){const C=h.slice(y,y+1),A=new a.default(C.ops).next(),[v,O,I]=u(k.retain,A.insert),L=d.getHandler(v);return p.retain({[v]:L.invert(O,I)},i.default.invert(k.attributes,A.attributes)),y+1}}return y},0),p.chop()}transform(h,p=!1){if(p=!!p,typeof h=="number")return this.transformPosition(h,p);const y=h,k=new a.default(this.ops),C=new a.default(y.ops),A=new d;for(;k.hasNext()||C.hasNext();)if(k.peekType()==="insert"&&(p||C.peekType()!=="insert"))A.retain(o.default.length(k.next()));else if(C.peekType()==="insert")A.push(C.next());else{const v=Math.min(k.peekLength(),C.peekLength()),O=k.next(v),I=C.next(v);if(O.delete)continue;if(I.delete)A.push(I);else{const L=O.retain,q=I.retain;let F=typeof q=="object"&&q!==null?q:v;if(typeof L=="object"&&L!==null&&typeof q=="object"&&q!==null){const $=Object.keys(L)[0];if($===Object.keys(q)[0]){const H=d.getHandler($);H&&(F={[$]:H.transform(L[$],q[$],p)})}}A.retain(F,i.default.transform(O.attributes,I.attributes,p))}}return A.chop()}transformPosition(h,p=!1){p=!!p;const y=new a.default(this.ops);let k=0;for(;y.hasNext()&&k<=h;){const C=y.peekLength(),A=y.peekType();if(y.next(),A==="delete"){h-=Math.min(C,h-k);continue}else A==="insert"&&(k<h||!p)&&(h+=C);k+=C}return h}}d.Op=o.default,d.OpIterator=a.default,d.AttributeMap=i.default,d.handlers={},e.default=d,t.exports=d,t.exports.default=d}(Gs,Gs.exports)),Gs.exports}var tm=em();const ns=sp(tm),nm=new Set(["http:","https:","mailto:","sms:","tel:"]);let Rd=class Pd extends bn{constructor(n="",r={},s){super(s);sn(this,"__url");sn(this,"__target");sn(this,"__rel");sn(this,"__title");const{target:i=null,rel:o=null,title:a=null}=r;this.__url=n,this.__target=i,this.__rel=o,this.__title=a}static getType(){return"link"}static clone(n){return new Pd(n.__url,{rel:n.__rel,target:n.__target,title:n.__title},n.__key)}createDOM(n){const r=document.createElement("a");return this.updateLinkDOM(null,r,n),Ot(r,n.theme.link),r}updateLinkDOM(n,r,s){if(ld(r)){n&&n.__url===this.__url||(r.href=this.sanitizeUrl(this.__url));for(const i of["target","rel","title"]){const o=`__${i}`,a=this[o];n&&n[o]===a||(a?r[i]=a:r.removeAttribute(i))}}}updateDOM(n,r,s){return this.updateLinkDOM(n,r,s),!1}static importDOM(){return{a:n=>({conversion:rm,priority:1})}}static importJSON(n){return ma().updateFromJSON(n)}updateFromJSON(n){return super.updateFromJSON(n).setURL(n.url).setRel(n.rel||null).setTarget(n.target||null).setTitle(n.title||null)}sanitizeUrl(n){n=Ql(n);try{const r=new URL(Ql(n));if(!nm.has(r.protocol))return"about:blank"}catch{return n}return n}exportJSON(){return{...super.exportJSON(),rel:this.getRel(),target:this.getTarget(),title:this.getTitle(),url:this.getURL()}}getURL(){return this.getLatest().__url}setURL(n){const r=this.getWritable();return r.__url=n,r}getTarget(){return this.getLatest().__target}setTarget(n){const r=this.getWritable();return r.__target=n,r}getRel(){return this.getLatest().__rel}setRel(n){const r=this.getWritable();return r.__rel=n,r}getTitle(){return this.getLatest().__title}setTitle(n){const r=this.getWritable();return r.__title=n,r}insertNewAfter(n,r=!0){const s=ma(this.__url,{rel:this.__rel,target:this.__target,title:this.__title});return this.insertAfter(s,r),s}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}canBeEmpty(){return!1}isInline(){return!0}extractWithChild(n,r,s){if(!Z(r))return!1;const i=r.anchor.getNode(),o=r.focus.getNode();return this.isParentOf(i)&&this.isParentOf(o)&&r.getTextContent().length>0}isEmailURI(){return this.__url.startsWith("mailto:")}isWebSiteURI(){return this.__url.startsWith("https://")||this.__url.startsWith("http://")}};function rm(t){let e=null;if(ld(t)){const n=t.textContent;(n!==null&&n!==""||t.children.length>0)&&(e=ma(t.getAttribute("href")||"",{rel:t.getAttribute("rel"),target:t.getAttribute("target"),title:t.getAttribute("title")}))}return{node:e}}function ma(t="",e){return Ie(new Rd(t,e))}function sm(t){return t instanceof Rd}const im=/^\+?[0-9\s()-]{5,}$/;function Ql(t){return t.match(/^[a-z][a-z0-9+.-]*:/i)||t.match(/^[/#.]/)?t:t.includes("@")?`mailto:${t}`:im.test(t)?`tel:${t}`:`https://${t}`}const $d=[];let Ld=class Dd extends bn{constructor(n=$d,r){super(r);sn(this,"__ids");this.__ids=n}static getType(){return"mark"}static clone(n){return new Dd(n.__ids,n.__key)}static importDOM(){return null}static importJSON(n){return ec().updateFromJSON(n)}updateFromJSON(n){return super.updateFromJSON(n).setIDs(n.ids)}exportJSON(){return{...super.exportJSON(),ids:this.getIDs()}}createDOM(n){const r=document.createElement("mark");return Ot(r,n.theme.mark),this.__ids.length>1&&Ot(r,n.theme.markOverlap),r}updateDOM(n,r,s){const i=n.__ids,o=this.__ids,a=i.length,l=o.length,u=s.theme.markOverlap;return a!==l&&(a===1?l===2&&Ot(r,u):l===1&&yi(r,u)),!1}hasID(n){return this.getIDs().includes(n)}getIDs(){return Array.from(this.getLatest().__ids)}setIDs(n){const r=this.getWritable();return r.__ids=n,r}addID(n){const r=this.getWritable();return r.__ids.includes(n)?r:r.setIDs([...r.__ids,n])}deleteID(n){const r=this.getWritable(),s=r.__ids.indexOf(n);if(s===-1)return r;const i=Array.from(r.__ids);return i.splice(s,1),r.setIDs(i)}insertNewAfter(n,r=!0){const s=ec(this.__ids);return this.insertAfter(s,r),s}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}canBeEmpty(){return!1}isInline(){return!0}extractWithChild(n,r,s){if(!Z(r)||s==="html")return!1;const i=r.anchor,o=r.focus,a=i.getNode(),l=o.getNode(),u=r.isBackward()?i.offset-o.offset:o.offset-i.offset;return this.isParentOf(a)&&this.isParentOf(l)&&this.getTextContent().length===u}excludeFromCopy(n){return n!=="clone"}};function ec(t=$d){return Ie(new Ld(t))}function om(t){return t instanceof Ld}const Fd=Object.freeze({"	":"\\t","\n":"\\n"}),tc=new RegExp(Object.keys(Fd).join("|"),"g"),Mt=Object.freeze({ancestorHasNextSibling:"|",ancestorIsLastChild:" ",hasNextSibling:"",isLastChild:"",selectedChar:"^",selectedLine:">"}),am=[t=>t.hasFormat("bold")&&"Bold",t=>t.hasFormat("code")&&"Code",t=>t.hasFormat("italic")&&"Italic",t=>t.hasFormat("strikethrough")&&"Strikethrough",t=>t.hasFormat("subscript")&&"Subscript",t=>t.hasFormat("superscript")&&"Superscript",t=>t.hasFormat("underline")&&"Underline",t=>t.hasFormat("highlight")&&"Highlight"],lm=[t=>t.hasTextFormat("bold")&&"Bold",t=>t.hasTextFormat("code")&&"Code",t=>t.hasTextFormat("italic")&&"Italic",t=>t.hasTextFormat("strikethrough")&&"Strikethrough",t=>t.hasTextFormat("subscript")&&"Subscript",t=>t.hasTextFormat("superscript")&&"Superscript",t=>t.hasTextFormat("underline")&&"Underline",t=>t.hasTextFormat("highlight")&&"Highlight"],cm=[t=>t.isDirectionless()&&"Directionless",t=>t.isUnmergeable()&&"Unmergeable"],um=[t=>t.isToken()&&"Token",t=>t.isSegmented()&&"Segmented"];function dm(t,e,n,r,s=!1){const i=t.getEditorState(),o=t._config,a=t._compositionKey,l=t._editable;if(n){let h="";return i.read(()=>{h=function(p){const y=document.createElement("div");return y.innerHTML=p.trim(),Ud(y,0).innerHTML}(gp(t))}),h}let u=` root
`;const d=i.read(()=>{const h=re();return qd(vt(),(p,y)=>{const k=`(${p.getKey()})`,C=p.getType()||"",A=p.isSelected();u+=`${A?Mt.selectedLine:" "} ${y.join(" ")} ${k} ${C} ${function(v,O,I=!1){const L=O?O(v,I):void 0;if(L!==void 0&&L.length>0)return L;if(Y(v)){const q=v.getTextContent(),F=q.length===0?"(empty)":`"${nc(q,I)}"`,$=function(H){return[rc(H),hm(H),fm(H),sc(H)].filter(Boolean).join(", ")}(v);return[F,$.length!==0?`{ ${$} }`:null].filter(Boolean).join(" ").trim()}if(sm(v)){const q=v.getURL(),F=q.length===0?"(empty)":`"${nc(q,I)}"`,$=function(H){return[pm(H),gm(H),mm(H),sc(H)].filter(Boolean).join(", ")}(v);return[F,$.length!==0?`{ ${$} }`:null].filter(Boolean).join(" ").trim()}if(om(v))return`ids: [ ${v.getIDs().join(", ")} ]`;if(yp(v)){const q=function($){let H=lm.map(W=>W($)).filter(Boolean).join(", ").toLocaleLowerCase();return H!==""&&(H="format: "+H),H}(v);let F=q!==""?`{ ${q} }`:"";return F+=v.__style?`(${v.__style})`:"",F}return""}(p,r,s)}
`,u+=function({indent:v,isSelected:O,node:I,nodeKeyDisplay:L,selection:q,typeDisplay:F}){if(!Y(I)||!Z(q)||!O||se(I))return"";const $=q.anchor,H=q.focus;if(I.getTextContent()===""||$.getNode()===q.focus.getNode()&&$.offset===H.offset)return"";const[W,_]=function(D,U){const B=U.getStartEndPoints();if(Ll(U)||B===null)return[-1,-1];const[z,J]=B,X=D.getTextContent(),ne=X.length;let V=-1,de=-1;if(z.type==="text"&&J.type==="text"){const ie=z.getNode(),oe=J.getNode();ie===oe&&D===ie&&z.offset!==J.offset?[V,de]=z.offset<J.offset?[z.offset,J.offset]:[J.offset,z.offset]:[V,de]=D===ie?ie.isBefore(oe)?[z.offset,ne]:[0,z.offset]:D===oe?oe.isBefore(ie)?[J.offset,ne]:[0,J.offset]:[0,ne]}const ye=(X.slice(0,V).match(tc)||[]).length,te=(X.slice(V,de).match(tc)||[]).length;return[V+ye,de+ye+te]}(I,q);if(W===_)return"";const j=v[v.length-1]===Mt.hasNextSibling?Mt.ancestorHasNextSibling:Mt.ancestorIsLastChild,x=[...v.slice(0,v.length-1),j],P=Array(W+1).fill(" "),E=Array(_-W).fill(Mt.selectedChar),M=F.length+2,N=Array(L.length+M).fill(" ");return[Mt.selectedLine,x.join(" "),[...N,...P,...E].join("")].join(" ")+`
`}({indent:y,isSelected:A,node:p,nodeKeyDisplay:k,selection:h,typeDisplay:C})}),h===null?": null":Z(h)?function(p){let y="";const k=rc(p);y+=`: range ${k!==""?`{ ${k} }`:""} ${p.style!==""?`{ style: ${p.style} } `:""}`;const C=p.anchor,A=p.focus,v=C.offset,O=A.offset;return y+=`
   anchor { key: ${C.key}, offset: ${v===null?"null":v}, type: ${C.type} }`,y+=`
   focus { key: ${A.key}, offset: ${O===null?"null":O}, type: ${A.type} }`,y}(h):mp(h)?function(p){return`: table
   { table: ${p.tableKey}, anchorCell: ${p.anchor.key}, focusCell: ${p.focus.key} }`}(h):function(p){return Ll(p)?`: node
   [${Array.from(p._nodes).join(", ")}]`:""}(h)});if(u+=`
 selection`+d,u+=`

 commands:`,e.length)for(const{index:h,type:p,payload:y}of e)u+=`
   ${h}. { type: ${p}, payload: ${y instanceof Event?y.constructor.name:y} }`;else u+=`
   None dispatched.`;const{version:f}=t.constructor;return u+=`

 editor${f?` (v${f})`:""}:`,u+=`
   namespace ${o.namespace}`,a!==null&&(u+=`
   compositionKey ${a}`),u+=`
   editable ${String(l)}`,u}function qd(t,e,n=[]){const r=t.getChildren(),s=r.length;r.forEach((i,o)=>{e(i,n.concat(o===s-1?Mt.isLastChild:Mt.hasNextSibling)),se(i)&&qd(i,e,n.concat(o===s-1?Mt.ancestorIsLastChild:Mt.ancestorHasNextSibling))})}function nc(t,e=!1){const n=Object.entries(Fd).reduce((r,[s,i])=>r.replace(new RegExp(s,"g"),String(i)),t);return e?n.replace(/[^\s]/g,"*"):n}function hm(t){let e=cm.map(n=>n(t)).filter(Boolean).join(", ").toLocaleLowerCase();return e!==""&&(e="detail: "+e),e}function fm(t){let e=um.map(n=>n(t)).filter(Boolean).join(", ").toLocaleLowerCase();return e!==""&&(e="mode: "+e),e}function rc(t){let e=am.map(n=>n(t)).filter(Boolean).join(", ").toLocaleLowerCase();return e!==""&&(e="format: "+e),e}function pm(t){let e=t.getTarget();return e!=null&&(e="target: "+e),e}function gm(t){let e=t.getRel();return e!=null&&(e="rel: "+e),e}function mm(t){let e=t.getTitle();return e!=null&&(e="title: "+e),e}function sc(t){if(!t.__state)return!1;const e=[];for(const[r,s]of t.__state.knownState.entries()){if(r.isEqual(s,r.defaultValue))continue;const i=JSON.stringify(r.unparse(s));e.push(`[${r.key}: ${i}]`)}let n=e.join(",");return n!==""&&(n="state: "+n),n}function Ud(t,e){const n=new Array(1+e++).join("  "),r=new Array(e-1).join("  ");let s;for(let i=0;i<t.children.length;i++)s=document.createTextNode(`
`+n),t.insertBefore(s,t.children[i]),Ud(t.children[i],e),t.lastElementChild===t.children[i]&&(s=document.createTextNode(`
`+r),t.appendChild(s));return t}const ym=b.forwardRef(function({treeTypeButtonClassName:t,timeTravelButtonClassName:e,timeTravelPanelSliderClassName:n,timeTravelPanelButtonClassName:r,viewClassName:s,timeTravelPanelClassName:i,editorState:o,setEditorState:a,setEditorReadOnly:l,generateContent:u,commandsLog:d=[]},f){const[h,p]=b.useState([]),[y,k]=b.useState(""),[C,A]=b.useState(!1),[v,O]=b.useState(!1),I=b.useRef(0),L=b.useRef(null),[q,F]=b.useState(!1),[$,H]=b.useState(!1),[W,_]=b.useState(!1),j=b.useRef(null),x=b.useRef([]),P=b.useRef(0),E=b.useCallback(N=>{const D=++P.current;u(N).then(U=>{D===P.current&&k(U)}).catch(U=>{D===P.current&&k(`Error rendering tree: ${U.message}

Stack:
${U.stack}`)})},[u]);b.useEffect(()=>{if(!(!W&&o._nodeMap.size>1e3&&(H(!0),!W))&&(j.current!==o||x.current!==d)){const N=j.current!==o;j.current=o,x.current=d,E(v),!C&&N&&p(D=>[...D,[Date.now(),o]])}},[o,E,v,W,C,d]);const M=h.length;return b.useEffect(()=>{if(q){let N;const D=()=>{const U=I.current;if(U===M-1)return void F(!1);const B=h[U][0],z=h[U+1][0];N=setTimeout(()=>{I.current++;const J=I.current,X=L.current;X!==null&&(X.value=String(J)),a(h[J][1]),D()},z-B)};return D(),()=>{clearTimeout(N)}}},[h,q,M,a]),m.jsxs("div",{className:s,children:[!W&&$?m.jsxs("div",{style:{padding:20},children:[m.jsx("span",{style:{marginRight:20},children:"Detected large EditorState, this can impact debugging performance."}),m.jsx("button",{onClick:()=>{_(!0)},style:{background:"transparent",border:"1px solid white",color:"white",cursor:"pointer",padding:5},children:"Show full tree"})]}):null,W?null:m.jsx("button",{onClick:()=>(E(!v),void O(!v)),className:t,type:"button",children:v?"Tree":"Export DOM"}),!C&&(W||!$)&&M>2&&m.jsx("button",{onClick:()=>{l(!0),I.current=M-1,A(!0)},className:e,type:"button",children:"Time Travel"}),(W||!$)&&m.jsx("pre",{ref:f,children:y}),C&&(W||!$)&&m.jsxs("div",{className:i,children:[m.jsx("button",{className:r,onClick:()=>{I.current===M-1&&(I.current=1),F(!q)},type:"button",children:q?"Pause":"Play"}),m.jsx("input",{className:n,ref:L,onChange:N=>{const D=Number(N.target.value),U=h[D];U&&(I.current=D,a(U[1]))},type:"range",min:"1",max:M-1}),m.jsx("button",{className:r,onClick:()=>{l(!1);const N=h.length-1,D=h[N];a(D[1]);const U=L.current;U!==null&&(U.value=String(N)),A(!1),F(!1)},type:"button",children:"Exit"})]})]})});function bm(t,e){const n=new Set;let r=0;for(const[s]of t._commands)n.add(t.registerCommand(s,i=>(e(o=>{r+=1;const a=[...o];return a.push({index:r,payload:i,type:s.type?s.type:"UNKNOWN"}),a.length>10&&a.shift(),a}),!1),ss));return()=>n.forEach(s=>s())}function _m(t){const[e,n]=b.useState([]);return b.useEffect(()=>bm(t,n),[t]),b.useMemo(()=>e,[e])}function km({treeTypeButtonClassName:t,timeTravelButtonClassName:e,timeTravelPanelSliderClassName:n,timeTravelPanelButtonClassName:r,timeTravelPanelClassName:s,viewClassName:i,editor:o,customPrintNode:a}){const l=b.createRef(),[u,d]=b.useState(o.getEditorState()),f=_m(o);return b.useEffect(()=>Xe(o.registerUpdateListener(({editorState:h})=>{d(h)}),o.registerEditableListener(()=>{d(o.getEditorState())})),[o]),b.useEffect(()=>{const h=l.current;if(h!==null)return h.__lexicalEditor=o,()=>{h.__lexicalEditor=null}},[o,l]),m.jsx(ym,{treeTypeButtonClassName:t,timeTravelButtonClassName:e,timeTravelPanelSliderClassName:n,timeTravelPanelButtonClassName:r,viewClassName:i,timeTravelPanelClassName:s,setEditorReadOnly:h=>{const p=o.getRootElement();p!=null&&(p.contentEditable=h?"false":"true")},editorState:u,setEditorState:h=>o.setEditorState(h),generateContent:async function(h){return dm(o,f,h,a)},ref:l,commandsLog:f})}function Bd({editorRef:t}){const[e]=ue();return b.useEffect(()=>{typeof t=="function"?t(e):typeof t=="object"&&(t.current=e)},[e]),null}function vm(t,e,n,r,s){if(t===null||n.size===0&&r.size===0&&!s)return 0;const i=e._selection,o=t._selection;if(s)return 1;if(!(Z(i)&&Z(o)&&o.isCollapsed()&&i.isCollapsed()))return 0;const a=function(A,v,O){const I=A._nodeMap,L=[];for(const q of v){const F=I.get(q);F!==void 0&&L.push(F)}for(const[q,F]of O){if(!F)continue;const $=I.get(q);$===void 0||_p($)||L.push($)}return L}(e,n,r);if(a.length===0)return 0;if(a.length>1){const A=e._nodeMap,v=A.get(i.anchor.key),O=A.get(o.anchor.key);return v&&O&&!t._nodeMap.has(v.__key)&&Y(v)&&v.__text.length===1&&i.anchor.offset===1?2:0}const l=a[0],u=t._nodeMap.get(l.__key);if(!Y(u)||!Y(l)||u.__mode!==l.__mode)return 0;const d=u.__text,f=l.__text;if(d===f)return 0;const h=i.anchor,p=o.anchor;if(h.key!==p.key||h.type!=="text")return 0;const y=h.offset,k=p.offset,C=f.length-d.length;return C===1&&k===y-1?2:C===-1&&k===y+1?3:C===-1&&k===y?4:0}function wm(t,e){let n=Date.now(),r=0;return(s,i,o,a,l,u)=>{const d=Date.now();if(u.has(pa))return r=0,n=d,2;const f=vm(s,i,a,l,t.isComposing()),h=(()=>{const p=o===null||o.editor===t,y=u.has(bp);if(!y&&p&&u.has(dd))return 0;if(s===null)return 1;const k=i._selection;if(!(a.size>0||l.size>0))return k!==null?0:2;const C=typeof e=="number"?e:e.peek();return y===!1&&f!==0&&f===r&&d<n+C&&p||a.size===1&&function(A,v,O){const I=v._nodeMap.get(A),L=O._nodeMap.get(A),q=v._selection,F=O._selection;return!(Z(q)&&Z(F)&&q.anchor.type==="element"&&q.focus.type==="element"&&F.anchor.type==="text"&&F.focus.type==="text"||!Y(I)||!Y(L)||I.__parent!==L.__parent)&&JSON.stringify(v.read(()=>I.exportJSON()))===JSON.stringify(O.read(()=>L.exportJSON()))}(Array.from(a)[0],s,i)?0:1})();return n=d,r=f,h}}function ic(t){t.undoStack=[],t.redoStack=[],t.current=null}function Hd(t,e,n){const r=wm(t,n);return Xe(t.registerCommand(Ja,()=>(function(i,o){const a=o.redoStack,l=o.undoStack;if(l.length!==0){const u=o.current,d=l.pop();u!==null&&(a.push(u),i.dispatchCommand(Zr,!0)),l.length===0&&i.dispatchCommand(Qr,!1),o.current=d||null,d&&d.editor.setEditorState(d.editorState,{tag:pa})}}(t,e),!0),xe),t.registerCommand(Ka,()=>(function(i,o){const a=o.redoStack,l=o.undoStack;if(a.length!==0){const u=o.current;u!==null&&(l.push(u),i.dispatchCommand(Qr,!0));const d=a.pop();a.length===0&&i.dispatchCommand(Zr,!1),o.current=d||null,d&&d.editor.setEditorState(d.editorState,{tag:pa})}}(t,e),!0),xe),t.registerCommand(ud,()=>(ic(e),!1),xe),t.registerCommand(cd,()=>(ic(e),t.dispatchCommand(Zr,!1),t.dispatchCommand(Qr,!1),!0),xe),t.registerUpdateListener(({editorState:i,prevEditorState:o,dirtyLeaves:a,dirtyElements:l,tags:u})=>{const d=e.current,f=e.redoStack,h=e.undoStack,p=d===null?null:d.editorState;if(d!==null&&i===p)return;const y=r(o,i,d,a,l,u);if(y===1)f.length!==0&&(e.redoStack=[],t.dispatchCommand(Zr,!1)),d!==null&&(h.push({...d}),t.dispatchCommand(Qr,!0));else if(y===2)return;e.current={editor:t,editorState:i}}))}function Wd(){return{current:null,redoStack:[],undoStack:[]}}const Vo=hd({build:(t,{delay:e,createInitialHistoryState:n,disabled:r})=>xp({delay:e,disabled:r,historyState:n(t)}),config:wp({createInitialHistoryState:Wd,delay:300,disabled:typeof window>"u"}),name:"@lexical/history/History",register:(t,e,n)=>{const r=n.getOutput();return fd(()=>r.disabled.value?void 0:Hd(t,r.historyState.value,r.delay))}});hd({dependencies:[kp(Vo,{createInitialHistoryState:()=>{throw new Error("SharedHistory did not inherit parent history")},disabled:!0})],name:"@lexical/history/SharedHistory",register(t,e,n){const{output:r}=n.getDependency(Vo),s=function(o){return o?vp(o,Vo.name):null}(t._parentEditor);if(!s)return()=>{};const i=s.output;return fd(()=>Cp(()=>{r.delay.value=i.delay.value,r.historyState.value=i.historyState.value,r.disabled.value=i.disabled.value}))}});function Kd({delay:t,externalHistoryState:e}){const[n]=ue();return function(r,s,i=1e3){const o=b.useMemo(()=>s||Wd(),[s]);b.useEffect(()=>Hd(r,o,i),[i,r,o])}(n,e,t),null}const ya=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,xm=ya?b.useLayoutEffect:b.useEffect;let Cm=class{constructor(e){sn(this,"key");sn(this,"ref");this.key=e,this.ref={current:null},this.setRefElement=this.setRefElement.bind(this)}setRefElement(e){this.ref={current:e}}};const oc=t=>{const e=document.getElementById("typeahead-menu");if(!e)return;const n=e.getBoundingClientRect();n.top+n.height>window.innerHeight&&e.scrollIntoView({block:"center"}),n.top<0&&e.scrollIntoView({block:"center"}),t.scrollIntoView({block:"nearest"})};function ac(t,e){const n=t.getBoundingClientRect(),r=e.getBoundingClientRect();return n.top>=r.top-6&&n.top<=r.bottom+6}function Sm(t,e,n,r){const[s]=ue();b.useEffect(()=>{if(e!=null&&t!=null){const i=s.getRootElement(),o=i!=null?function(f){let h=getComputedStyle(f);const p=h.position==="absolute",y=/(auto|scroll)/;if(h.position==="fixed")return document.body;for(let k=f;k=k.parentElement;)if(h=getComputedStyle(k),(!p||h.position!=="static")&&y.test(h.overflow+h.overflowY+h.overflowX))return k;return document.body}(i):document.body;let a=!1,l=ac(e,o);const u=function(){a||(window.requestAnimationFrame(function(){n(),a=!1}),a=!0);const f=ac(e,o);f!==l&&(l=f,r!=null&&r(f))},d=new ResizeObserver(n);return window.addEventListener("resize",n),document.addEventListener("scroll",u,{capture:!0,passive:!0}),d.observe(e),()=>{d.unobserve(e),window.removeEventListener("resize",n),document.removeEventListener("scroll",u,!0)}}},[e,s,r,n,t])}const lc=za("SCROLL_TYPEAHEAD_OPTION_INTO_VIEW_COMMAND");function Tm({close:t,editor:e,anchorElementRef:n,resolution:r,options:s,menuRenderFn:i,onSelectOption:o,shouldSplitNodeWithQuery:a=!1,commandPriority:l=kr,preselectFirstItem:u=!0}){const[d,f]=b.useState(null),h=d!==null?Math.min(s.length-1,d):null,p=r.match&&r.match.matchingString;b.useEffect(()=>{u&&f(0)},[p,u]);const y=b.useCallback(C=>{e.update(()=>{const A=r.match!=null&&a?function(v){const O=re();if(!Z(O)||!O.isCollapsed())return null;const I=O.anchor;if(I.type!=="text")return null;const L=I.getNode();if(!L.isSimpleText())return null;const q=I.offset,F=L.getTextContent().slice(0,q),$=v.replaceableString.length,H=q-function(_,j,x){let P=x;for(let E=P;E<=j.length;E++)_.slice(-E)===j.substring(0,E)&&(P=E);return P}(F,v.matchingString,$);if(H<0)return null;let W;return H===0?[W]=L.splitText(q):[,W]=L.splitText(H,q),W}(r.match):null;o(C,A,t,r.match?r.match.matchingString:"")})},[e,a,r.match,o,t]),k=b.useCallback(C=>{const A=e.getRootElement();A!==null&&(A.setAttribute("aria-activedescendant","typeahead-item-"+C),f(C))},[e]);return b.useEffect(()=>()=>{const C=e.getRootElement();C!==null&&C.removeAttribute("aria-activedescendant")},[e]),xm(()=>{s===null?f(null):h===null&&u&&k(0)},[s,h,k,u]),b.useEffect(()=>Xe(e.registerCommand(lc,({option:C})=>!(!C.ref||C.ref.current==null)&&(oc(C.ref.current),!0),l)),[e,k,l]),b.useEffect(()=>Xe(e.registerCommand(Mp,C=>{const A=C;if(s!==null&&s.length){const v=h===null?0:h!==s.length-1?h+1:0;k(v);const O=s[v];if(!O)return k(-1),A.preventDefault(),A.stopImmediatePropagation(),!0;O.ref&&O.ref.current&&e.dispatchCommand(lc,{index:v,option:O}),A.preventDefault(),A.stopImmediatePropagation()}return!0},l),e.registerCommand(Op,C=>{const A=C;if(s!==null&&s.length){const v=h===null?s.length-1:h!==0?h-1:s.length-1;k(v);const O=s[v];if(!O)return k(-1),A.preventDefault(),A.stopImmediatePropagation(),!0;O.ref&&O.ref.current&&oc(O.ref.current),A.preventDefault(),A.stopImmediatePropagation()}return!0},l),e.registerCommand(gd,C=>{const A=C;return A.preventDefault(),A.stopImmediatePropagation(),t(),!0},l),e.registerCommand(Ep,C=>{const A=C;return s!==null&&h!==null&&s[h]!=null&&(A.preventDefault(),A.stopImmediatePropagation(),y(s[h]),!0)},l),e.registerCommand(pd,C=>s!==null&&h!==null&&s[h]!=null&&(C!==null&&(C.preventDefault(),C.stopImmediatePropagation()),y(s[h]),!0),l)),[y,t,e,s,h,k,l]),i(n,b.useMemo(()=>({options:s,selectOptionAndCleanUp:y,selectedIndex:h,setHighlightedIndex:f}),[y,h,s]),r.match?r.match.matchingString:"")}function cc(t,e){e!=null&&(t.className=e),t.setAttribute("aria-label","Typeahead menu"),t.setAttribute("role","listbox"),t.style.display="block",t.style.position="absolute"}function Em({options:t,onWillOpen:e,onClose:n,onOpen:r,onSelectOption:s,menuRenderFn:i,anchorClassName:o,commandPriority:a=kr,parent:l}){const[u]=ue(),[d,f]=b.useState(null),h=b.useRef(null),p=function(v,O,I,L=ya?document.body:void 0,q=!0){const[F]=ue(),$=ya?document.createElement("div"):null,H=b.useRef($),W=b.useCallback(()=>{if(H.current===null||L===void 0)return;H.current.style.top=H.current.style.bottom;const j=F.getRootElement(),x=H.current,P=x.firstChild;if(j!==null&&v!==null){const{left:E,top:M,width:N,height:D}=v.getRect(),U=H.current.offsetHeight;if(x.style.top=`${M+U+3+(q?window.pageYOffset:0)}px`,x.style.left=`${E+window.pageXOffset}px`,x.style.height=`${D}px`,x.style.width=`${N}px`,P!==null){P.style.top=`${M}`;const B=P.getBoundingClientRect(),z=B.height,J=B.width,X=j.getBoundingClientRect();E+J>X.right&&(x.style.left=`${X.right-J+window.pageXOffset}px`),(M+z>window.innerHeight||M+z>X.bottom)&&M-X.top>z+D&&(x.style.top=`${M-z-D+(q?window.pageYOffset:0)}px`)}x.isConnected||(cc(x,I),L.append(x)),x.setAttribute("id","typeahead-menu"),j.setAttribute("aria-controls","typeahead-menu")}},[F,v,q,I,L]);b.useEffect(()=>{const j=F.getRootElement();return v!==null&&W(),()=>{j!==null&&j.removeAttribute("aria-controls");const x=H.current;x!==null&&x.isConnected&&(x.remove(),x.removeAttribute("id"))}},[F,W,v]);const _=b.useCallback(j=>{v!==null&&(j||O(null))},[v,O]);return Sm(v,H.current,W,_),$!=null&&$===H.current&&(cc($,I),L!=null&&L.append($)),H}(d,f,o,l),y=b.useCallback(()=>{f(null),n!=null&&d!==null&&n()},[n,d]),k=b.useCallback(v=>{f(v),r!=null&&d===null&&r(v)},[r,d]),C=b.useCallback(v=>{v.preventDefault(),e!=null&&e(v);const O=Sp(v.target);k({getRect:()=>new DOMRect(v.clientX/O,v.clientY/O,1,1)})},[k,e]),A=b.useCallback(v=>{d!==null&&h.current!=null&&v.target!=null&&Tp(v.target)&&!h.current.contains(v.target)&&y()},[y,d]);return b.useEffect(()=>{const v=u.getRootElement();if(v)return v.addEventListener("contextmenu",C),()=>v.removeEventListener("contextmenu",C)},[u,C]),b.useEffect(()=>(document.addEventListener("click",A),()=>document.removeEventListener("click",A)),[u,A]),p.current===null||d===null||u===null?null:m.jsx(Tm,{close:y,resolution:d,editor:u,anchorElementRef:p,options:t,menuRenderFn:(v,O)=>i(v,O,{setMenuRef:I=>{h.current=I}}),onSelectOption:s,commandPriority:a})}const uc=[["Cat","rgb(125, 50, 0)"],["Dog","rgb(100, 0, 0)"],["Rabbit","rgb(150, 0, 0)"],["Frog","rgb(200, 0, 0)"],["Fox","rgb(200, 75, 0)"],["Hedgehog","rgb(0, 75, 0)"],["Pigeon","rgb(0, 125, 0)"],["Squirrel","rgb(75, 100, 0)"],["Bear","rgb(125, 100, 0)"],["Tiger","rgb(0, 0, 150)"],["Leopard","rgb(0, 0, 200)"],["Zebra","rgb(0, 0, 250)"],["Wolf","rgb(0, 100, 150)"],["Owl","rgb(0, 100, 100)"],["Gull","rgb(100, 0, 100)"],["Squid","rgb(150, 0, 150)"]],dc=uc[Math.floor(Math.random()*uc.length)],Jd=b.createContext(null);function zd(){return{color:dc[1],isCollabActive:!1,name:dc[0],yjsDocMap:new Map}}const Om=zd();function Mm({children:t}){const e=b.useMemo(()=>zd(),[]);return m.jsx(Jd.Provider,{value:e,children:t})}function Vd(t,e){let n=b.useContext(Jd);return n==null&&function(r,...s){const i=new URL("https://lexical.dev/docs/error"),o=new URLSearchParams;o.append("code",r);for(const a of s)o.append("v",a);i.search=o.toString(),console.warn(`Minified Lexical warning #${r}; visit ${i.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}(319),n=n??Om,n}const Bn=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,Am=Bn&&"documentMode"in document?document.documentMode:null,jm=Bn&&/Mac|iPod|iPhone|iPad/.test(navigator.platform),Nm=!(!Bn||!("InputEvent"in window)||Am)&&"getTargetRanges"in new window.InputEvent("input"),Im=Bn&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent),hc=Bn&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,Rm=Bn&&/^(?=.*Chrome).*/i.test(navigator.userAgent),Pm=Bn&&/AppleWebKit\/[\d.]+/.test(navigator.userAgent)&&jm&&!Rm;function fc(t,e){e.update(()=>{if(t!==null){const n=yd(t,KeyboardEvent)?null:t.clipboardData,r=re();if(r!==null&&!r.isCollapsed()&&n!=null){t.preventDefault();const s=Hp(e);s!==null&&n.setData("text/html",s),n.setData("text/plain",r.getTextContent())}}})}function $m(t){return Xe(t.registerCommand(Wo,e=>{const n=re();return!!Z(n)&&(n.deleteCharacter(e),!0)},xe),t.registerCommand(Bp,e=>{const n=re();return!!Z(n)&&(n.deleteWord(e),!0)},xe),t.registerCommand(Up,e=>{const n=re();return!!Z(n)&&(n.deleteLine(e),!0)},xe),t.registerCommand(qp,e=>{const n=re();if(!Z(n))return!1;if(typeof e=="string")n.insertText(e);else{const r=e.dataTransfer;if(r!=null)Dl(r,n);else{const s=e.data;s&&n.insertText(s)}}return!0},xe),t.registerCommand(Fp,()=>{const e=re();return!!Z(e)&&(e.removeText(),!0)},xe),t.registerCommand(Fl,e=>{const n=re();return!!Z(n)&&(n.insertLineBreak(e),!0)},xe),t.registerCommand(Dp,()=>{const e=re();return!!Z(e)&&(e.insertLineBreak(),!0)},xe),t.registerCommand(Lp,e=>{const n=re();if(!Z(n))return!1;const r=e,s=r.shiftKey;return!!ql(n,!0)&&(r.preventDefault(),Ul(n,s,!0),!0)},xe),t.registerCommand($p,e=>{const n=re();if(!Z(n))return!1;const r=e,s=r.shiftKey;return!!ql(n,!1)&&(r.preventDefault(),Ul(n,s,!1),!0)},xe),t.registerCommand(Pp,e=>{const n=re();return!!Z(n)&&(!hc||navigator.language!=="ko-KR")&&(e.preventDefault(),t.dispatchCommand(Wo,!0))},xe),t.registerCommand(Rp,e=>{const n=re();return!!Z(n)&&(e.preventDefault(),t.dispatchCommand(Wo,!1))},xe),t.registerCommand(pd,e=>{const n=re();if(!Z(n))return!1;if(e!==null){if((hc||Im||Pm)&&Nm)return!1;e.preventDefault()}return t.dispatchCommand(Fl,!1)},xe),t.registerCommand(Np,()=>(Ip(),!0),xe),t.registerCommand(Ki,e=>{const n=re();return!!Z(n)&&(fc(e,t),!0)},xe),t.registerCommand(Wi,e=>{const n=re();return!!Z(n)&&(function(r,s){fc(r,s),s.update(()=>{const i=re();Z(i)&&i.removeText()})}(e,t),!0)},xe),t.registerCommand(Hi,e=>{const n=re();return!!Z(n)&&(function(r,s){r.preventDefault(),s.update(()=>{const i=re(),o=yd(r,ClipboardEvent)?r.clipboardData:null;o!=null&&Z(i)&&Dl(o,i)},{tag:jp})}(e,t),!0)},xe),t.registerCommand(md,e=>{const n=re();return!!Z(n)&&(e.preventDefault(),!0)},xe),t.registerCommand(Ap,e=>{const n=re();return!!Z(n)&&(e.preventDefault(),!0)},xe))}function Lm(t,...e){const n=new URL("https://lexical.dev/docs/error"),r=new URLSearchParams;r.append("code",t);for(const s of e)r.append("v",s);throw n.search=r.toString(),Error(`Minified Lexical error #${t}; visit ${n.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}const Qa=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0?b.useLayoutEffect:b.useEffect;function Dm({editor:t,ErrorBoundary:e}){return function(n,r){const[s,i]=b.useState(()=>n.getDecorators());return Qa(()=>n.registerDecoratorListener(o=>{jt.flushSync(()=>{i(o)})}),[n]),b.useEffect(()=>{i(n.getDecorators())},[n]),b.useMemo(()=>{const o=[],a=Object.keys(s);for(let l=0;l<a.length;l++){const u=a[l],d=m.jsx(r,{onError:h=>n._onError(h),children:m.jsx(b.Suspense,{fallback:null,children:s[u]})}),f=n.getElementByKey(u);f!==null&&o.push(jt.createPortal(d,f,u))}return o},[r,s,n])}(t,e)}function Fm({editor:t,ErrorBoundary:e}){return function(n){const r=Jp.maybeFromEditor(n);if(r&&r.hasExtensionByName(zp.name)){for(const s of["@lexical/plain-text","@lexical/rich-text"])r.hasExtensionByName(s)&&Lm(320,s);return!0}return!1}(t)?null:m.jsx(Dm,{editor:t,ErrorBoundary:e})}function pc(t){return t.getEditorState().read(Vp(t.isComposing()))}function qm({contentEditable:t,placeholder:e=null,ErrorBoundary:n}){const[r]=ue();return function(s){Qa(()=>Xe($m(s),Wp(s)),[s])}(r),m.jsxs(m.Fragment,{children:[t,m.jsx(Um,{content:e}),m.jsx(Fm,{editor:r,ErrorBoundary:n})]})}function Um({content:t}){const[e]=ue(),n=function(s){const[i,o]=b.useState(()=>pc(s));return Qa(()=>{function a(){const l=pc(s);o(l)}return a(),Xe(s.registerUpdateListener(()=>{a()}),s.registerEditableListener(()=>{a()}))},[s]),i}(e),r=Kp();return n?typeof t=="function"?t(r):t:null}const It=()=>new Map,ba=t=>{const e=It();return t.forEach((n,r)=>{e.set(r,n)}),e},Cr=(t,e,n)=>{let r=t.get(e);return r===void 0&&t.set(e,r=n()),r},Bm=(t,e)=>{const n=[];for(const[r,s]of t)n.push(e(s,r));return n},Hm=(t,e)=>{for(const[n,r]of t)if(e(r,n))return!0;return!1},lr=()=>new Set,Go=t=>t[t.length-1],cr=Array.from,Wm=Array.isArray;class Km{constructor(){this._observers=It()}on(e,n){return Cr(this._observers,e,lr).add(n),n}once(e,n){const r=(...s)=>{this.off(e,r),n(...s)};this.on(e,r)}off(e,n){const r=this._observers.get(e);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(e))}emit(e,n){return cr((this._observers.get(e)||It()).values()).forEach(r=>r(...n))}destroy(){this._observers=It()}}const $n=Math.floor,ki=Math.abs,Gd=(t,e)=>t<e?t:e,Sr=(t,e)=>t>e?t:e,Jm=t=>t!==0?t<0:1/t<0,gc=1,mc=2,Yo=4,Xo=8,zm=32,Yd=64,Ei=128,Vm=31,yc=63,ls=127,Gm=2147483647,Ym=Number.isInteger||(t=>typeof t=="number"&&isFinite(t)&&$n(t)===t),Xm=t=>t.toLowerCase(),Zm=/^\s*/g,Qm=t=>t.replace(Zm,""),ey=/([A-Z])/g,bc=(t,e)=>Qm(t.replace(ey,n=>`${e}${Xm(n)}`)),ty=t=>{const e=unescape(encodeURIComponent(t)),n=e.length,r=new Uint8Array(n);for(let s=0;s<n;s++)r[s]=e.codePointAt(s);return r},hs=typeof TextEncoder<"u"?new TextEncoder:null,ny=t=>hs.encode(t),ry=hs?ny:ty;let Zo=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Zo&&Zo.decode(new Uint8Array).length===1&&(Zo=null);class xs{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const el=()=>new xs,sy=t=>{let e=t.cpos;for(let n=0;n<t.bufs.length;n++)e+=t.bufs[n].length;return e},Jt=t=>{const e=new Uint8Array(sy(t));let n=0;for(let r=0;r<t.bufs.length;r++){const s=t.bufs[r];e.set(s,n),n+=s.length}return e.set(new Uint8Array(t.cbuf.buffer,0,t.cpos),n),e},iy=(t,e)=>{const n=t.cbuf.length;n-t.cpos<e&&(t.bufs.push(new Uint8Array(t.cbuf.buffer,0,t.cpos)),t.cbuf=new Uint8Array(Sr(n,e)*2),t.cpos=0)},Re=(t,e)=>{const n=t.cbuf.length;t.cpos===n&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(n*2),t.cpos=0),t.cbuf[t.cpos++]=e},_a=Re,be=(t,e)=>{for(;e>ls;)Re(t,Ei|ls&e),e=$n(e/128);Re(t,ls&e)},tl=(t,e)=>{const n=Jm(e);for(n&&(e=-e),Re(t,(e>yc?Ei:0)|(n?Yd:0)|yc&e),e=$n(e/64);e>0;)Re(t,(e>ls?Ei:0)|ls&e),e=$n(e/128)},ka=new Uint8Array(3e4),oy=ka.length/3,ay=(t,e)=>{if(e.length<oy){const n=hs.encodeInto(e,ka).written||0;be(t,n);for(let r=0;r<n;r++)Re(t,ka[r])}else st(t,ry(e))},ly=(t,e)=>{const n=unescape(encodeURIComponent(e)),r=n.length;be(t,r);for(let s=0;s<r;s++)Re(t,n.codePointAt(s))},or=hs&&hs.encodeInto?ay:ly,nl=(t,e)=>{const n=t.cbuf.length,r=t.cpos,s=Gd(n-r,e.length),i=e.length-s;t.cbuf.set(e.subarray(0,s),r),t.cpos+=s,i>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(Sr(n*2,i)),t.cbuf.set(e.subarray(s)),t.cpos=i)},st=(t,e)=>{be(t,e.byteLength),nl(t,e)},rl=(t,e)=>{iy(t,e);const n=new DataView(t.cbuf.buffer,t.cpos,e);return t.cpos+=e,n},cy=(t,e)=>rl(t,4).setFloat32(0,e,!1),uy=(t,e)=>rl(t,8).setFloat64(0,e,!1),dy=(t,e)=>rl(t,8).setBigInt64(0,e,!1),_c=new DataView(new ArrayBuffer(4)),hy=t=>(_c.setFloat32(0,t),_c.getFloat32(0)===t),fs=(t,e)=>{switch(typeof e){case"string":Re(t,119),or(t,e);break;case"number":Ym(e)&&ki(e)<=Gm?(Re(t,125),tl(t,e)):hy(e)?(Re(t,124),cy(t,e)):(Re(t,123),uy(t,e));break;case"bigint":Re(t,122),dy(t,e);break;case"object":if(e===null)Re(t,126);else if(Wm(e)){Re(t,117),be(t,e.length);for(let n=0;n<e.length;n++)fs(t,e[n])}else if(e instanceof Uint8Array)Re(t,116),st(t,e);else{Re(t,118);const n=Object.keys(e);be(t,n.length);for(let r=0;r<n.length;r++){const s=n[r];or(t,s),fs(t,e[s])}}break;case"boolean":Re(t,e?120:121);break;default:Re(t,127)}};class kc extends xs{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&be(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const vc=t=>{t.count>0&&(tl(t.encoder,t.count===1?t.s:-t.s),t.count>1&&be(t.encoder,t.count-2))};class vi{constructor(){this.encoder=new xs,this.s=0,this.count=0}write(e){this.s===e?this.count++:(vc(this),this.count=1,this.s=e)}toUint8Array(){return vc(this),Jt(this.encoder)}}const wc=t=>{if(t.count>0){const e=t.diff*2+(t.count===1?0:1);tl(t.encoder,e),t.count>1&&be(t.encoder,t.count-2)}};class Qo{constructor(){this.encoder=new xs,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(wc(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return wc(this),Jt(this.encoder)}}class fy{constructor(){this.sarr=[],this.s="",this.lensE=new vi}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new xs;return this.sarr.push(this.s),this.s="",or(e,this.sarr.join("")),nl(e,this.lensE.toUint8Array()),Jt(e)}}const ur=t=>new Error(t),Rt=()=>{throw ur("Method unimplemented")},Ln=()=>{throw ur("Unexpected case")},py=crypto.getRandomValues.bind(crypto),Xd=()=>py(new Uint32Array(1))[0],gy="10000000-1000-4000-8000"+-1e11,my=()=>gy.replace(/[018]/g,t=>(t^Xd()&15>>t/4).toString(16)),xc=t=>new Promise(t);Promise.all.bind(Promise);const Cc=t=>t===void 0?null:t;class yy{constructor(){this.map=new Map}setItem(e,n){this.map.set(e,n)}getItem(e){return this.map.get(e)}}let Zd=new yy,by=!0;try{typeof localStorage<"u"&&localStorage&&(Zd=localStorage,by=!1)}catch{}const _y=Zd,ky=Object.assign,vy=Object.keys,wy=(t,e)=>{for(const n in t)e(t[n],n)},Sc=t=>vy(t).length,xy=t=>{for(const e in t)return!1;return!0},Cy=(t,e)=>{for(const n in t)if(!e(t[n],n))return!1;return!0},Sy=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),Ty=(t,e)=>t===e||Sc(t)===Sc(e)&&Cy(t,(n,r)=>(n!==void 0||Sy(e,r))&&e[r]===n),Ey=Object.freeze,Qd=t=>{for(const e in t){const n=t[e];(typeof n=="object"||typeof n=="function")&&Qd(t[e])}return Ey(t)},sl=(t,e,n=0)=>{try{for(;n<t.length;n++)t[n](...e)}finally{n<t.length&&sl(t,e,n+1)}},Oy=(t,e)=>e.includes(t);var eh={};const ps=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";let Et;const My=()=>{if(Et===void 0)if(ps){Et=It();const t=process.argv;let e=null;for(let n=0;n<t.length;n++){const r=t[n];r[0]==="-"?(e!==null&&Et.set(e,""),e=r):e!==null&&(Et.set(e,r),e=null)}e!==null&&Et.set(e,"")}else typeof location=="object"?(Et=It(),(location.search||"?").slice(1).split("&").forEach(t=>{if(t.length!==0){const[e,n]=t.split("=");Et.set(`--${bc(e,"-")}`,n),Et.set(`-${bc(e,"-")}`,n)}})):Et=It();return Et},va=t=>My().has(t),Oi=t=>Cc(ps?eh[t.toUpperCase().replaceAll("-","_")]:_y.getItem(t)),th=t=>va("--"+t)||Oi(t)!==null;th("production");const Ay=ps&&Oy(eh.FORCE_COLOR,["true","1","2"]),jy=Ay||!va("--no-colors")&&!th("no-color")&&(!ps||process.stdout.isTTY)&&(!ps||va("--color")||Oi("COLORTERM")!==null||(Oi("TERM")||"").includes("color"));class Ny{constructor(e,n){this.left=e,this.right=n}}const Wt=(t,e)=>new Ny(t,e);typeof DOMParser<"u"&&new DOMParser;const Iy=t=>Bm(t,(e,n)=>`${n}:${e};`).join(""),Xt=Symbol,nh=Xt(),rh=Xt(),Ry=Xt(),Py=Xt(),$y=Xt(),sh=Xt(),Ly=Xt(),il=Xt(),Dy=Xt(),Fy=t=>{var s;t.length===1&&((s=t[0])==null?void 0:s.constructor)===Function&&(t=t[0]());const e=[],n=[];let r=0;for(;r<t.length;r++){const i=t[r];if(i===void 0)break;if(i.constructor===String||i.constructor===Number)e.push(i);else if(i.constructor===Object)break}for(r>0&&n.push(e.join(""));r<t.length;r++){const i=t[r];i instanceof Symbol||n.push(i)}return n},qy={[nh]:Wt("font-weight","bold"),[rh]:Wt("font-weight","normal"),[Ry]:Wt("color","blue"),[$y]:Wt("color","green"),[Py]:Wt("color","grey"),[sh]:Wt("color","red"),[Ly]:Wt("color","purple"),[il]:Wt("color","orange"),[Dy]:Wt("color","black")},Uy=t=>{var o;t.length===1&&((o=t[0])==null?void 0:o.constructor)===Function&&(t=t[0]());const e=[],n=[],r=It();let s=[],i=0;for(;i<t.length;i++){const a=t[i],l=qy[a];if(l!==void 0)r.set(l.left,l.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const u=Iy(r);i>0||u.length>0?(e.push("%c"+a),n.push(u)):e.push(a)}else break}}for(i>0&&(s=n,s.unshift(e.join("")));i<t.length;i++){const a=t[i];a instanceof Symbol||s.push(a)}return s},ih=jy?Uy:Fy,By=(...t)=>{console.log(...ih(t)),oh.forEach(e=>e.print(t))},Hy=(...t)=>{console.warn(...ih(t)),t.unshift(il),oh.forEach(e=>e.print(t))},oh=lr(),ah=t=>({[Symbol.iterator](){return this},next:t}),Wy=(t,e)=>ah(()=>{let n;do n=t.next();while(!n.done&&!e(n.value));return n}),ea=(t,e)=>ah(()=>{const{done:n,value:r}=t.next();return{done:n,value:n?void 0:e(r)}});class Ky{constructor(e,n){this.clock=e,this.len=n}}class Jy{constructor(){this.clients=new Map}}const lh=(t,e,n)=>e.clients.forEach((r,s)=>{const i=t.doc.store.clients.get(s);if(i!=null){const o=i[i.length-1],a=o.id.clock+o.length;for(let l=0,u=r[l];l<r.length&&u.clock<a;u=r[++l])gh(t,i,u.clock,u.len,n)}}),zy=(t,e)=>{let n=0,r=t.length-1;for(;n<=r;){const s=$n((n+r)/2),i=t[s],o=i.clock;if(o<=e){if(e<o+i.len)return s;n=s+1}else r=s-1}return null},ch=(t,e)=>{const n=t.clients.get(e.client);return n!==void 0&&zy(n,e.clock)!==null},uh=t=>{t.clients.forEach(e=>{e.sort((s,i)=>s.clock-i.clock);let n,r;for(n=1,r=1;n<e.length;n++){const s=e[r-1],i=e[n];s.clock+s.len>=i.clock?s.len=Sr(s.len,i.clock+i.len-s.clock):(r<n&&(e[r]=i),r++)}e.length=r})},dh=(t,e,n,r)=>{Cr(t.clients,e,()=>[]).push(new Ky(n,r))},Vy=(t,e)=>{be(t.restEncoder,e.clients.size),cr(e.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{t.resetDsCurVal(),be(t.restEncoder,n);const s=r.length;be(t.restEncoder,s);for(let i=0;i<s;i++){const o=r[i];t.writeDsClock(o.clock),t.writeDsLen(o.len)}})},hh=Xd;class Cs extends Km{constructor({guid:e=my(),collectionid:n=null,gc:r=!0,gcFilter:s=()=>!0,meta:i=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=s,this.clientID=hh(),this.guid=e,this.collectionid=n,this.share=new Map,this.store=new sb,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=i,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=xc(u=>{this.on("load",()=>{this.isLoaded=!0,u(this)})});const l=()=>xc(u=>{const d=f=>{(f===void 0||f===!0)&&(this.off("sync",d),u())};this.on("sync",d)});this.on("sync",u=>{u===!1&&this.isSynced&&(this.whenSynced=l()),this.isSynced=u===void 0||u===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=l()}load(){const e=this._item;e!==null&&!this.shouldLoad&&ve(e.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(cr(this.subdocs).map(e=>e.guid))}transact(e,n=null){return ve(this,e,n)}get(e,n=qe){const r=Cr(this.share,e,()=>{const i=new n;return i._integrate(this,null),i}),s=r.constructor;if(n!==qe&&s!==n)if(s===qe){const i=new n;i._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=i}),i._start=r._start;for(let o=i._start;o!==null;o=o.right)o.parent=i;return i._length=r._length,this.share.set(e,i),i._integrate(this,null),i}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,Pn)}getText(e=""){return this.get(e,ji)}getMap(e=""){return this.get(e,dr)}getXmlElement(e=""){return this.get(e,ys)}getXmlFragment(e=""){return this.get(e,hr)}toJSON(){const e={};return this.share.forEach((n,r)=>{e[r]=n.toJSON()}),e}destroy(){this.isDestroyed=!0,cr(this.subdocs).forEach(n=>n.destroy());const e=this._item;if(e!==null){this._item=null;const n=e.content;n.doc=new Cs({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=e,ve(e.parent.doc,r=>{const s=n.doc;e.deleted||r.subdocsAdded.add(s),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class Gy{constructor(){this.restEncoder=el()}toUint8Array(){return Jt(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){be(this.restEncoder,e)}writeDsLen(e){be(this.restEncoder,e)}}class Yy extends Gy{writeLeftID(e){be(this.restEncoder,e.client),be(this.restEncoder,e.clock)}writeRightID(e){be(this.restEncoder,e.client),be(this.restEncoder,e.clock)}writeClient(e){be(this.restEncoder,e)}writeInfo(e){_a(this.restEncoder,e)}writeString(e){or(this.restEncoder,e)}writeParentInfo(e){be(this.restEncoder,e?1:0)}writeTypeRef(e){be(this.restEncoder,e)}writeLen(e){be(this.restEncoder,e)}writeAny(e){fs(this.restEncoder,e)}writeBuf(e){st(this.restEncoder,e)}writeJSON(e){or(this.restEncoder,JSON.stringify(e))}writeKey(e){or(this.restEncoder,e)}}class Xy{constructor(){this.restEncoder=el(),this.dsCurrVal=0}toUint8Array(){return Jt(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const n=e-this.dsCurrVal;this.dsCurrVal=e,be(this.restEncoder,n)}writeDsLen(e){e===0&&Ln(),be(this.restEncoder,e-1),this.dsCurrVal+=e}}class Zy extends Xy{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Qo,this.clientEncoder=new vi,this.leftClockEncoder=new Qo,this.rightClockEncoder=new Qo,this.infoEncoder=new kc(_a),this.stringEncoder=new fy,this.parentInfoEncoder=new kc(_a),this.typeRefEncoder=new vi,this.lenEncoder=new vi}toUint8Array(){const e=el();return be(e,0),st(e,this.keyClockEncoder.toUint8Array()),st(e,this.clientEncoder.toUint8Array()),st(e,this.leftClockEncoder.toUint8Array()),st(e,this.rightClockEncoder.toUint8Array()),st(e,Jt(this.infoEncoder)),st(e,this.stringEncoder.toUint8Array()),st(e,Jt(this.parentInfoEncoder)),st(e,this.typeRefEncoder.toUint8Array()),st(e,this.lenEncoder.toUint8Array()),nl(e,Jt(this.restEncoder)),Jt(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){fs(this.restEncoder,e)}writeBuf(e){st(this.restEncoder,e)}writeJSON(e){fs(this.restEncoder,e)}writeKey(e){const n=this.keyMap.get(e);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(n)}}const Qy=(t,e,n,r)=>{r=Sr(r,e[0].id.clock);const s=zt(e,r);be(t.restEncoder,e.length-s),t.writeClient(n),be(t.restEncoder,r);const i=e[s];i.write(t,r-i.id.clock);for(let o=s+1;o<e.length;o++)e[o].write(t,0)},eb=(t,e,n)=>{const r=new Map;n.forEach((s,i)=>{tt(e,i)>s&&r.set(i,s)}),ol(e).forEach((s,i)=>{n.has(i)||r.set(i,0)}),be(t.restEncoder,r.size),cr(r.entries()).sort((s,i)=>i[0]-s[0]).forEach(([s,i])=>{Qy(t,e.clients.get(s),s,i)})},tb=(t,e)=>eb(t,e.doc.store,e.beforeState);class nb{constructor(){this.l=[]}}const Tc=()=>new nb,Ec=(t,e)=>t.l.push(e),Oc=(t,e)=>{const n=t.l,r=n.length;t.l=n.filter(s=>e!==s),r===t.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},fh=(t,e,n)=>sl(t.l,[e,n]);class wi{constructor(e,n){this.client=e,this.clock=n}}const Qs=(t,e)=>t===e||t!==null&&e!==null&&t.client===e.client&&t.clock===e.clock,Te=(t,e)=>new wi(t,e),rb=t=>{for(const[e,n]of t.doc.share.entries())if(n===t)return e;throw Ln()},rr=(t,e)=>e===void 0?!t.deleted:e.sv.has(t.id.client)&&(e.sv.get(t.id.client)||0)>t.id.clock&&!ch(e.ds,t.id),wa=(t,e)=>{const n=Cr(t.meta,wa,lr),r=t.doc.store;n.has(e)||(e.sv.forEach((s,i)=>{s<tt(r,i)&&hn(t,Te(i,s))}),lh(t,e.ds,s=>{}),n.add(e))};class sb{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const ol=t=>{const e=new Map;return t.clients.forEach((n,r)=>{const s=n[n.length-1];e.set(r,s.id.clock+s.length)}),e},tt=(t,e)=>{const n=t.clients.get(e);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},ph=(t,e)=>{let n=t.clients.get(e.id.client);if(n===void 0)n=[],t.clients.set(e.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==e.id.clock)throw Ln()}n.push(e)},zt=(t,e)=>{let n=0,r=t.length-1,s=t[r],i=s.id.clock;if(i===e)return r;let o=$n(e/(i+s.length-1)*r);for(;n<=r;){if(s=t[o],i=s.id.clock,i<=e){if(e<i+s.length)return o;n=o+1}else r=o-1;o=$n((n+r)/2)}throw Ln()},ib=(t,e)=>{const n=t.clients.get(e.client);return n[zt(n,e.clock)]},ta=ib,xa=(t,e,n)=>{const r=zt(e,n),s=e[r];return s.id.clock<n&&s instanceof Ke?(e.splice(r+1,0,Rh(t,s,n-s.id.clock)),r+1):r},hn=(t,e)=>{const n=t.doc.store.clients.get(e.client);return n[xa(t,n,e.clock)]},Mc=(t,e,n)=>{const r=e.clients.get(n.client),s=zt(r,n.clock),i=r[s];return n.clock!==i.id.clock+i.length-1&&i.constructor!==ln&&r.splice(s+1,0,Rh(t,i,n.clock-i.id.clock+1)),i},ob=(t,e,n)=>{const r=t.clients.get(e.id.client);r[zt(r,e.id.clock)]=n},gh=(t,e,n,r,s)=>{if(r===0)return;const i=n+r;let o=xa(t,e,n),a;do a=e[o++],i<a.id.clock+a.length&&xa(t,e,i),s(a);while(o<e.length&&e[o].id.clock<i)};class ab{constructor(e,n,r){this.doc=e,this.deleteSet=new Jy,this.beforeState=ol(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const Ac=(t,e)=>e.deleteSet.clients.size===0&&!Hm(e.afterState,(n,r)=>e.beforeState.get(r)!==n)?!1:(uh(e.deleteSet),tb(t,e),Vy(t,e.deleteSet),!0),jc=(t,e,n)=>{const r=e._item;(r===null||r.id.clock<(t.beforeState.get(r.id.client)||0)&&!r.deleted)&&Cr(t.changed,e,lr).add(n)},xi=(t,e)=>{let n=t[e],r=t[e-1],s=e;for(;s>0;n=r,r=t[--s-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof Ke&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const i=e-s;return i&&t.splice(e+1-i,i),i},lb=(t,e,n)=>{for(const[r,s]of t.clients.entries()){const i=e.clients.get(r);for(let o=s.length-1;o>=0;o--){const a=s[o],l=a.clock+a.len;for(let u=zt(i,a.clock),d=i[u];u<i.length&&d.id.clock<l;d=i[++u]){const f=i[u];if(a.clock+a.len<=f.id.clock)break;f instanceof Ke&&f.deleted&&!f.keep&&n(f)&&f.gc(e,!1)}}}},cb=(t,e)=>{t.clients.forEach((n,r)=>{const s=e.clients.get(r);for(let i=n.length-1;i>=0;i--){const o=n[i],a=Gd(s.length-1,1+zt(s,o.clock+o.len-1));for(let l=a,u=s[l];l>0&&u.id.clock>=o.clock;u=s[l])l-=1+xi(s,l)}})},mh=(t,e)=>{if(e<t.length){const n=t[e],r=n.doc,s=r.store,i=n.deleteSet,o=n._mergeStructs;try{uh(i),n.afterState=ol(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((l,u)=>a.push(()=>{(u._item===null||!u._item.deleted)&&u._callObserver(n,l)})),a.push(()=>{n.changedParentTypes.forEach((l,u)=>{u._dEH.l.length>0&&(u._item===null||!u._item.deleted)&&(l=l.filter(d=>d.target._item===null||!d.target._item.deleted),l.forEach(d=>{d.currentTarget=u,d._path=null}),l.sort((d,f)=>d.path.length-f.path.length),fh(u._dEH,l,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),sl(a,[]),n._needFormattingCleanup&&kb(n)}finally{r.gc&&lb(i,s,r.gcFilter),cb(i,s),n.afterState.forEach((d,f)=>{const h=n.beforeState.get(f)||0;if(h!==d){const p=s.clients.get(f),y=Sr(zt(p,h),1);for(let k=p.length-1;k>=y;)k-=1+xi(p,k)}});for(let d=o.length-1;d>=0;d--){const{client:f,clock:h}=o[d].id,p=s.clients.get(f),y=zt(p,h);y+1<p.length&&xi(p,y+1)>1||y>0&&xi(p,y)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(By(il,nh,"[yjs] ",rh,sh,"Changed the client-id because another client seems to be using it."),r.clientID=hh()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const d=new Yy;Ac(d,n)&&r.emit("update",[d.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const d=new Zy;Ac(d,n)&&r.emit("updateV2",[d.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:l,subdocsRemoved:u}=n;(a.size>0||u.size>0||l.size>0)&&(a.forEach(d=>{d.clientID=r.clientID,d.collectionid==null&&(d.collectionid=r.collectionid),r.subdocs.add(d)}),u.forEach(d=>r.subdocs.delete(d)),r.emit("subdocs",[{loaded:l,added:a,removed:u},r,n]),u.forEach(d=>d.destroy())),t.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,t])):mh(t,e+1)}}},ve=(t,e,n=null,r=!0)=>{const s=t._transactionCleanups;let i=!1,o=null;t._transaction===null&&(i=!0,t._transaction=new ab(t,n,r),s.push(t._transaction),s.length===1&&t.emit("beforeAllTransactions",[t]),t.emit("beforeTransaction",[t._transaction,t]));try{o=e(t._transaction)}finally{if(i){const a=t._transaction===s[0];t._transaction=null,a&&mh(s,0)}}return o},Nc="You must not compute changes after the event-handler fired.";class Vi{constructor(e,n){this.target=e,this.currentTarget=e,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=ub(this.currentTarget,this.target))}deletes(e){return ch(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw ur(Nc);const e=new Map,n=this.target;this.transaction.changed.get(n).forEach(s=>{if(s!==null){const i=n._map.get(s);let o,a;if(this.adds(i)){let l=i.left;for(;l!==null&&this.adds(l);)l=l.left;if(this.deletes(i))if(l!==null&&this.deletes(l))o="delete",a=Go(l.content.getContent());else return;else l!==null&&this.deletes(l)?(o="update",a=Go(l.content.getContent())):(o="add",a=void 0)}else if(this.deletes(i))o="delete",a=Go(i.content.getContent());else return;e.set(s,{action:o,oldValue:a})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw ur(Nc);const n=this.target,r=lr(),s=lr(),i=[];if(e={added:r,deleted:s,delta:i,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const l=()=>{a&&i.push(a)};for(let u=n._start;u!==null;u=u.right)u.deleted?this.deletes(u)&&!this.adds(u)&&((a===null||a.delete===void 0)&&(l(),a={delete:0}),a.delete+=u.length,s.add(u)):this.adds(u)?((a===null||a.insert===void 0)&&(l(),a={insert:[]}),a.insert=a.insert.concat(u.content.getContent()),r.add(u)):((a===null||a.retain===void 0)&&(l(),a={retain:0}),a.retain+=u.length);a!==null&&a.retain===void 0&&l()}this._changes=e}return e}}const ub=(t,e)=>{const n=[];for(;e._item!==null&&e!==t;){if(e._item.parentSub!==null)n.unshift(e._item.parentSub);else{let r=0,s=e._item.parent._start;for(;s!==e._item&&s!==null;)!s.deleted&&s.countable&&(r+=s.length),s=s.right;n.unshift(r)}e=e._item.parent}return n},ze=()=>{Hy("Invalid access: Add Yjs type to a document before reading data.")},yh=80;let al=0;class db{constructor(e,n){e.marker=!0,this.p=e,this.index=n,this.timestamp=al++}}const hb=t=>{t.timestamp=al++},bh=(t,e,n)=>{t.p.marker=!1,t.p=e,e.marker=!0,t.index=n,t.timestamp=al++},fb=(t,e,n)=>{if(t.length>=yh){const r=t.reduce((s,i)=>s.timestamp<i.timestamp?s:i);return bh(r,e,n),r}else{const r=new db(e,n);return t.push(r),r}},Gi=(t,e)=>{if(t._start===null||e===0||t._searchMarker===null)return null;const n=t._searchMarker.length===0?null:t._searchMarker.reduce((i,o)=>ki(e-i.index)<ki(e-o.index)?i:o);let r=t._start,s=0;for(n!==null&&(r=n.p,s=n.index,hb(n));r.right!==null&&s<e;){if(!r.deleted&&r.countable){if(e<s+r.length)break;s+=r.length}r=r.right}for(;r.left!==null&&s>e;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);return n!==null&&ki(n.index-s)<r.parent.length/yh?(bh(n,r,s),n):fb(t._searchMarker,r,s)},gs=(t,e,n)=>{for(let r=t.length-1;r>=0;r--){const s=t[r];if(n>0){let i=s.p;for(i.marker=!1;i&&(i.deleted||!i.countable);)i=i.left,i&&!i.deleted&&i.countable&&(s.index-=i.length);if(i===null||i.marker===!0){t.splice(r,1);continue}s.p=i,i.marker=!0}(e<s.index||n>0&&e===s.index)&&(s.index=Sr(e,s.index+n))}},Yi=(t,e,n)=>{const r=t,s=e.changedParentTypes;for(;Cr(s,t,()=>[]).push(n),t._item!==null;)t=t._item.parent;fh(r._eH,n,e)};class qe{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Tc(),this._dEH=Tc(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,n){this.doc=e,this._item=n}_copy(){throw Rt()}clone(){throw Rt()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,n){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){Ec(this._eH,e)}observeDeep(e){Ec(this._dEH,e)}unobserve(e){Oc(this._eH,e)}unobserveDeep(e){Oc(this._dEH,e)}toJSON(){}}const _h=(t,e,n)=>{t.doc??ze(),e<0&&(e=t._length+e),n<0&&(n=t._length+n);let r=n-e;const s=[];let i=t._start;for(;i!==null&&r>0;){if(i.countable&&!i.deleted){const o=i.content.getContent();if(o.length<=e)e-=o.length;else{for(let a=e;a<o.length&&r>0;a++)s.push(o[a]),r--;e=0}}i=i.right}return s},kh=t=>{t.doc??ze();const e=[];let n=t._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let s=0;s<r.length;s++)e.push(r[s])}n=n.right}return e},ms=(t,e)=>{let n=0,r=t._start;for(t.doc??ze();r!==null;){if(r.countable&&!r.deleted){const s=r.content.getContent();for(let i=0;i<s.length;i++)e(s[i],n++,t)}r=r.right}},vh=(t,e)=>{const n=[];return ms(t,(r,s)=>{n.push(e(r,s,t))}),n},pb=t=>{let e=t._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};n=e.content.getContent(),r=0,e=e.right}const s=n[r++];return n.length<=r&&(n=null),{done:!1,value:s}}}},wh=(t,e)=>{t.doc??ze();const n=Gi(t,e);let r=t._start;for(n!==null&&(r=n.p,e-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},Mi=(t,e,n,r)=>{let s=n;const i=t.doc,o=i.clientID,a=i.store,l=n===null?e._start:n.right;let u=[];const d=()=>{u.length>0&&(s=new Ke(Te(o,tt(a,o)),s,s&&s.lastId,l,l&&l.id,e,null,new fr(u)),s.integrate(t,0),u=[])};r.forEach(f=>{if(f===null)u.push(f);else switch(f.constructor){case Number:case Object:case Boolean:case Array:case String:u.push(f);break;default:switch(d(),f.constructor){case Uint8Array:case ArrayBuffer:s=new Ke(Te(o,tt(a,o)),s,s&&s.lastId,l,l&&l.id,e,null,new Xi(new Uint8Array(f))),s.integrate(t,0);break;case Cs:s=new Ke(Te(o,tt(a,o)),s,s&&s.lastId,l,l&&l.id,e,null,new Zi(f)),s.integrate(t,0);break;default:if(f instanceof qe)s=new Ke(Te(o,tt(a,o)),s,s&&s.lastId,l,l&&l.id,e,null,new kn(f)),s.integrate(t,0);else throw new Error("Unexpected content type in insert operation")}}}),d()},xh=()=>ur("Length exceeded!"),Ch=(t,e,n,r)=>{if(n>e._length)throw xh();if(n===0)return e._searchMarker&&gs(e._searchMarker,n,r.length),Mi(t,e,null,r);const s=n,i=Gi(e,n);let o=e._start;for(i!==null&&(o=i.p,n-=i.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&hn(t,Te(o.id.client,o.id.clock+n));break}n-=o.length}return e._searchMarker&&gs(e._searchMarker,s,r.length),Mi(t,e,o,r)},gb=(t,e,n)=>{let s=(e._searchMarker||[]).reduce((i,o)=>o.index>i.index?o:i,{index:0,p:e._start}).p;if(s)for(;s.right;)s=s.right;return Mi(t,e,s,n)},Sh=(t,e,n,r)=>{if(r===0)return;const s=n,i=r,o=Gi(e,n);let a=e._start;for(o!==null&&(a=o.p,n-=o.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&hn(t,Te(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&hn(t,Te(a.id.client,a.id.clock+r)),a.delete(t),r-=a.length),a=a.right;if(r>0)throw xh();e._searchMarker&&gs(e._searchMarker,s,-i+r)},Ai=(t,e,n)=>{const r=e._map.get(n);r!==void 0&&r.delete(t)},ll=(t,e,n,r)=>{const s=e._map.get(n)||null,i=t.doc,o=i.clientID;let a;if(r==null)a=new fr([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:a=new fr([r]);break;case Uint8Array:a=new Xi(r);break;case Cs:a=new Zi(r);break;default:if(r instanceof qe)a=new kn(r);else throw new Error("Unexpected content type")}new Ke(Te(o,tt(i.store,o)),s,s&&s.lastId,null,null,e,n,a).integrate(t,0)},cl=(t,e)=>{t.doc??ze();const n=t._map.get(e);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},Th=t=>{const e={};return t.doc??ze(),t._map.forEach((n,r)=>{n.deleted||(e[r]=n.content.getContent()[n.length-1])}),e},Eh=(t,e)=>{t.doc??ze();const n=t._map.get(e);return n!==void 0&&!n.deleted},mb=(t,e)=>{const n={};return t._map.forEach((r,s)=>{let i=r;for(;i!==null&&(!e.sv.has(i.id.client)||i.id.clock>=(e.sv.get(i.id.client)||0));)i=i.left;i!==null&&rr(i,e)&&(n[s]=i.content.getContent()[i.length-1])}),n},ei=t=>(t.doc??ze(),Wy(t._map.entries(),e=>!e[1].deleted));class Oh extends Vi{}class Pn extends qe{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const n=new Pn;return n.push(e),n}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Pn}clone(){const e=new Pn;return e.insert(0,this.toArray().map(n=>n instanceof qe?n.clone():n)),e}get length(){return this.doc??ze(),this._length}_callObserver(e,n){super._callObserver(e,n),Yi(this,e,new Oh(this,e))}insert(e,n){this.doc!==null?ve(this.doc,r=>{Ch(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}push(e){this.doc!==null?ve(this.doc,n=>{gb(n,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,n=1){this.doc!==null?ve(this.doc,r=>{Sh(r,this,e,n)}):this._prelimContent.splice(e,n)}get(e){return wh(this,e)}toArray(){return kh(this)}slice(e=0,n=this.length){return _h(this,e,n)}toJSON(){return this.map(e=>e instanceof qe?e.toJSON():e)}map(e){return vh(this,e)}forEach(e){ms(this,e)}[Symbol.iterator](){return pb(this)}_write(e){e.writeTypeRef(Tb)}}class yb extends Vi{constructor(e,n,r){super(e,n),this.keysChanged=r}}class dr extends qe{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,n){super._integrate(e,n),this._prelimContent.forEach((r,s)=>{this.set(s,r)}),this._prelimContent=null}_copy(){return new dr}clone(){const e=new dr;return this.forEach((n,r)=>{e.set(r,n instanceof qe?n.clone():n)}),e}_callObserver(e,n){Yi(this,e,new yb(this,e,n))}toJSON(){this.doc??ze();const e={};return this._map.forEach((n,r)=>{if(!n.deleted){const s=n.content.getContent()[n.length-1];e[r]=s instanceof qe?s.toJSON():s}}),e}get size(){return[...ei(this)].length}keys(){return ea(ei(this),e=>e[0])}values(){return ea(ei(this),e=>e[1].content.getContent()[e[1].length-1])}entries(){return ea(ei(this),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this.doc??ze(),this._map.forEach((n,r)=>{n.deleted||e(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?ve(this.doc,n=>{Ai(n,this,e)}):this._prelimContent.delete(e)}set(e,n){return this.doc!==null?ve(this.doc,r=>{ll(r,this,e,n)}):this._prelimContent.set(e,n),n}get(e){return cl(this,e)}has(e){return Eh(this,e)}clear(){this.doc!==null?ve(this.doc,e=>{this.forEach(function(n,r,s){Ai(e,s,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(Eb)}}const un=(t,e)=>t===e||typeof t=="object"&&typeof e=="object"&&t&&e&&Ty(t,e);class Ca{constructor(e,n,r,s){this.left=e,this.right=n,this.index=r,this.currentAttributes=s}forward(){switch(this.right===null&&Ln(),this.right.content.constructor){case Pe:this.right.deleted||Tr(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Ic=(t,e,n)=>{for(;e.right!==null&&n>0;){switch(e.right.content.constructor){case Pe:e.right.deleted||Tr(e.currentAttributes,e.right.content);break;default:e.right.deleted||(n<e.right.length&&hn(t,Te(e.right.id.client,e.right.id.clock+n)),e.index+=e.right.length,n-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},ti=(t,e,n,r)=>{const s=new Map,i=r?Gi(e,n):null;if(i){const o=new Ca(i.p.left,i.p,i.index,s);return Ic(t,o,n-i.index)}else{const o=new Ca(null,e._start,0,s);return Ic(t,o,n)}},Mh=(t,e,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===Pe&&un(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const s=t.doc,i=s.clientID;r.forEach((o,a)=>{const l=n.left,u=n.right,d=new Ke(Te(i,tt(s.store,i)),l,l&&l.lastId,u,u&&u.id,e,null,new Pe(a,o));d.integrate(t,0),n.right=d,n.forward()})},Tr=(t,e)=>{const{key:n,value:r}=e;r===null?t.delete(n):t.set(n,r)},Ah=(t,e)=>{for(;t.right!==null;){if(!(t.right.deleted||t.right.content.constructor===Pe&&un(e[t.right.content.key]??null,t.right.content.value)))break;t.forward()}},jh=(t,e,n,r)=>{const s=t.doc,i=s.clientID,o=new Map;for(const a in r){const l=r[a],u=n.currentAttributes.get(a)??null;if(!un(u,l)){o.set(a,u);const{left:d,right:f}=n;n.right=new Ke(Te(i,tt(s.store,i)),d,d&&d.lastId,f,f&&f.id,e,null,new Pe(a,l)),n.right.integrate(t,0),n.forward()}}return o},na=(t,e,n,r,s)=>{n.currentAttributes.forEach((h,p)=>{s[p]===void 0&&(s[p]=null)});const i=t.doc,o=i.clientID;Ah(n,s);const a=jh(t,e,n,s),l=r.constructor===String?new Vt(r):r instanceof qe?new kn(r):new Er(r);let{left:u,right:d,index:f}=n;e._searchMarker&&gs(e._searchMarker,n.index,l.getLength()),d=new Ke(Te(o,tt(i.store,o)),u,u&&u.lastId,d,d&&d.id,e,null,l),d.integrate(t,0),n.right=d,n.index=f,n.forward(),Mh(t,e,n,a)},Rc=(t,e,n,r,s)=>{const i=t.doc,o=i.clientID;Ah(n,s);const a=jh(t,e,n,s);e:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===Pe));){if(!n.right.deleted)switch(n.right.content.constructor){case Pe:{const{key:l,value:u}=n.right.content,d=s[l];if(d!==void 0){if(un(d,u))a.delete(l);else{if(r===0)break e;a.set(l,u)}n.right.delete(t)}else n.currentAttributes.set(l,u);break}default:r<n.right.length&&hn(t,Te(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let l="";for(;r>0;r--)l+=`
`;n.right=new Ke(Te(o,tt(i.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,e,null,new Vt(l)),n.right.integrate(t,0),n.forward()}Mh(t,e,n,a)},Nh=(t,e,n,r,s)=>{let i=e;const o=It();for(;i&&(!i.countable||i.deleted);){if(!i.deleted&&i.content.constructor===Pe){const u=i.content;o.set(u.key,u)}i=i.right}let a=0,l=!1;for(;e!==i;){if(n===e&&(l=!0),!e.deleted){const u=e.content;switch(u.constructor){case Pe:{const{key:d,value:f}=u,h=r.get(d)??null;(o.get(d)!==u||h===f)&&(e.delete(t),a++,!l&&(s.get(d)??null)===f&&h!==f&&(h===null?s.delete(d):s.set(d,h))),!l&&!e.deleted&&Tr(s,u);break}}}e=e.right}return a},bb=(t,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const n=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===Pe){const r=e.content.key;n.has(r)?e.delete(t):n.add(r)}e=e.left}},_b=t=>{let e=0;return ve(t.doc,n=>{let r=t._start,s=t._start,i=It();const o=ba(i);for(;s;){if(s.deleted===!1)switch(s.content.constructor){case Pe:Tr(o,s.content);break;default:e+=Nh(n,r,s,i,o),i=ba(o),r=s;break}s=s.right}}),e},kb=t=>{const e=new Set,n=t.doc;for(const[r,s]of t.afterState.entries()){const i=t.beforeState.get(r)||0;s!==i&&gh(t,n.store.clients.get(r),i,s,o=>{!o.deleted&&o.content.constructor===Pe&&o.constructor!==ln&&e.add(o.parent)})}ve(n,r=>{lh(t,t.deleteSet,s=>{if(s instanceof ln||!s.parent._hasFormatting||e.has(s.parent))return;const i=s.parent;s.content.constructor===Pe?e.add(i):bb(r,s)});for(const s of e)_b(s)})},Pc=(t,e,n)=>{const r=n,s=ba(e.currentAttributes),i=e.right;for(;n>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case kn:case Er:case Vt:n<e.right.length&&hn(t,Te(e.right.id.client,e.right.id.clock+n)),n-=e.right.length,e.right.delete(t);break}e.forward()}i&&Nh(t,i,e.right,s,e.currentAttributes);const o=(e.left||e.right).parent;return o._searchMarker&&gs(o._searchMarker,e.index,-r+n),e};class vb extends Vi{constructor(e,n,r){super(e,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(s=>{s===null?this.childListChanged=!0:this.keysChanged.add(s)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,n=[];ve(e,r=>{const s=new Map,i=new Map;let o=this.target._start,a=null;const l={};let u="",d=0,f=0;const h=()=>{if(a!==null){let p=null;switch(a){case"delete":f>0&&(p={delete:f}),f=0;break;case"insert":(typeof u=="object"||u.length>0)&&(p={insert:u},s.size>0&&(p.attributes={},s.forEach((y,k)=>{y!==null&&(p.attributes[k]=y)}))),u="";break;case"retain":d>0&&(p={retain:d},xy(l)||(p.attributes=ky({},l))),d=0;break}p&&n.push(p),a=null}};for(;o!==null;){switch(o.content.constructor){case kn:case Er:this.adds(o)?this.deletes(o)||(h(),a="insert",u=o.content.getContent()[0],h()):this.deletes(o)?(a!=="delete"&&(h(),a="delete"),f+=1):o.deleted||(a!=="retain"&&(h(),a="retain"),d+=1);break;case Vt:this.adds(o)?this.deletes(o)||(a!=="insert"&&(h(),a="insert"),u+=o.content.str):this.deletes(o)?(a!=="delete"&&(h(),a="delete"),f+=o.length):o.deleted||(a!=="retain"&&(h(),a="retain"),d+=o.length);break;case Pe:{const{key:p,value:y}=o.content;if(this.adds(o)){if(!this.deletes(o)){const k=s.get(p)??null;un(k,y)?y!==null&&o.delete(r):(a==="retain"&&h(),un(y,i.get(p)??null)?delete l[p]:l[p]=y)}}else if(this.deletes(o)){i.set(p,y);const k=s.get(p)??null;un(k,y)||(a==="retain"&&h(),l[p]=k)}else if(!o.deleted){i.set(p,y);const k=l[p];k!==void 0&&(un(k,y)?k!==null&&o.delete(r):(a==="retain"&&h(),y===null?delete l[p]:l[p]=y))}o.deleted||(a==="insert"&&h(),Tr(s,o.content));break}}o=o.right}for(h();n.length>0;){const p=n[n.length-1];if(p.retain!==void 0&&p.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class ji extends qe{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??ze(),this._length}_integrate(e,n){super._integrate(e,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new ji}clone(){const e=new ji;return e.applyDelta(this.toDelta()),e}_callObserver(e,n){super._callObserver(e,n);const r=new vb(this,e,n);Yi(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){this.doc??ze();let e="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Vt&&(e+=n.content.str),n=n.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:n=!0}={}){this.doc!==null?ve(this.doc,r=>{const s=new Ca(null,this._start,0,new Map);for(let i=0;i<e.length;i++){const o=e[i];if(o.insert!==void 0){const a=!n&&typeof o.insert=="string"&&i===e.length-1&&s.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&na(r,this,s,a,o.attributes||{})}else o.retain!==void 0?Rc(r,this,s,o.retain,o.attributes||{}):o.delete!==void 0&&Pc(r,s,o.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,n,r){this.doc??ze();const s=[],i=new Map,o=this.doc;let a="",l=this._start;function u(){if(a.length>0){const f={};let h=!1;i.forEach((y,k)=>{h=!0,f[k]=y});const p={insert:a};h&&(p.attributes=f),s.push(p),a=""}}const d=()=>{for(;l!==null;){if(rr(l,e)||n!==void 0&&rr(l,n))switch(l.content.constructor){case Vt:{const f=i.get("ychange");e!==void 0&&!rr(l,e)?(f===void 0||f.user!==l.id.client||f.type!=="removed")&&(u(),i.set("ychange",r?r("removed",l.id):{type:"removed"})):n!==void 0&&!rr(l,n)?(f===void 0||f.user!==l.id.client||f.type!=="added")&&(u(),i.set("ychange",r?r("added",l.id):{type:"added"})):f!==void 0&&(u(),i.delete("ychange")),a+=l.content.str;break}case kn:case Er:{u();const f={insert:l.content.getContent()[0]};if(i.size>0){const h={};f.attributes=h,i.forEach((p,y)=>{h[y]=p})}s.push(f);break}case Pe:rr(l,e)&&(u(),Tr(i,l.content));break}l=l.right}u()};return e||n?ve(o,f=>{e&&wa(f,e),n&&wa(f,n),d()},"cleanup"):d(),s}insert(e,n,r){if(n.length<=0)return;const s=this.doc;s!==null?ve(s,i=>{const o=ti(i,this,e,!r);r||(r={},o.currentAttributes.forEach((a,l)=>{r[l]=a})),na(i,this,o,n,r)}):this._pending.push(()=>this.insert(e,n,r))}insertEmbed(e,n,r){const s=this.doc;s!==null?ve(s,i=>{const o=ti(i,this,e,!r);na(i,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(e,n,r||{}))}delete(e,n){if(n===0)return;const r=this.doc;r!==null?ve(r,s=>{Pc(s,ti(s,this,e,!0),n)}):this._pending.push(()=>this.delete(e,n))}format(e,n,r){if(n===0)return;const s=this.doc;s!==null?ve(s,i=>{const o=ti(i,this,e,!1);o.right!==null&&Rc(i,this,o,n,r)}):this._pending.push(()=>this.format(e,n,r))}removeAttribute(e){this.doc!==null?ve(this.doc,n=>{Ai(n,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,n){this.doc!==null?ve(this.doc,r=>{ll(r,this,e,n)}):this._pending.push(()=>this.setAttribute(e,n))}getAttribute(e){return cl(this,e)}getAttributes(){return Th(this)}_write(e){e.writeTypeRef(Ob)}}class ra{constructor(e,n=()=>!0){this._filter=n,this._root=e,this._currentNode=e._start,this._firstCall=!0,e.doc??ze()}[Symbol.iterator](){return this}next(){let e=this._currentNode,n=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(n)))do if(n=e.content.type,!e.deleted&&(n.constructor===ys||n.constructor===hr)&&n._start!==null)e=n._start;else for(;e!==null;){const r=e.next;if(r!==null){e=r;break}else e.parent===this._root?e=null:e=e.parent._item}while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class hr extends qe{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new hr}clone(){const e=new hr;return e.insert(0,this.toArray().map(n=>n instanceof qe?n.clone():n)),e}get length(){return this.doc??ze(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new ra(this,e)}querySelector(e){e=e.toUpperCase();const r=new ra(this,s=>s.nodeName&&s.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),cr(new ra(this,n=>n.nodeName&&n.nodeName.toUpperCase()===e))}_callObserver(e,n){Yi(this,e,new wb(this,n,e))}toString(){return vh(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,n={},r){const s=e.createDocumentFragment();return r!==void 0&&r._createAssociation(s,this),ms(this,i=>{s.insertBefore(i.toDOM(e,n,r),null)}),s}insert(e,n){this.doc!==null?ve(this.doc,r=>{Ch(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}insertAfter(e,n){if(this.doc!==null)ve(this.doc,r=>{const s=e&&e instanceof qe?e._item:e;Mi(r,this,s,n)});else{const r=this._prelimContent,s=e===null?0:r.findIndex(i=>i===e)+1;if(s===0&&e!==null)throw ur("Reference item not found");r.splice(s,0,...n)}}delete(e,n=1){this.doc!==null?ve(this.doc,r=>{Sh(r,this,e,n)}):this._prelimContent.splice(e,n)}toArray(){return kh(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return wh(this,e)}slice(e=0,n=this.length){return _h(this,e,n)}forEach(e){ms(this,e)}_write(e){e.writeTypeRef(Ab)}}class ys extends hr{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,n){super._integrate(e,n),this._prelimAttrs.forEach((r,s)=>{this.setAttribute(s,r)}),this._prelimAttrs=null}_copy(){return new ys(this.nodeName)}clone(){const e=new ys(this.nodeName),n=this.getAttributes();return wy(n,(r,s)=>{typeof r=="string"&&e.setAttribute(s,r)}),e.insert(0,this.toArray().map(r=>r instanceof qe?r.clone():r)),e}toString(){const e=this.getAttributes(),n=[],r=[];for(const a in e)r.push(a);r.sort();const s=r.length;for(let a=0;a<s;a++){const l=r[a];n.push(l+'="'+e[l]+'"')}const i=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${i}${o}>${super.toString()}</${i}>`}removeAttribute(e){this.doc!==null?ve(this.doc,n=>{Ai(n,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,n){this.doc!==null?ve(this.doc,r=>{ll(r,this,e,n)}):this._prelimAttrs.set(e,n)}getAttribute(e){return cl(this,e)}hasAttribute(e){return Eh(this,e)}getAttributes(e){return e?mb(this,e):Th(this)}toDOM(e=document,n={},r){const s=e.createElement(this.nodeName),i=this.getAttributes();for(const o in i){const a=i[o];typeof a=="string"&&s.setAttribute(o,a)}return ms(this,o=>{s.appendChild(o.toDOM(e,n,r))}),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(Mb),e.writeKey(this.nodeName)}}class wb extends Vi{constructor(e,n,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(s=>{s===null?this.childListChanged=!0:this.attributesChanged.add(s)})}}class Ih{constructor(e,n){this.id=e,this.length=n}get deleted(){throw Rt()}mergeWith(e){return!1}write(e,n,r){throw Rt()}integrate(e,n){throw Rt()}}const xb=0;class ln extends Ih{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){n>0&&(this.id.clock+=n,this.length-=n),ph(e.doc.store,this)}write(e,n){e.writeInfo(xb),e.writeLen(this.length-n)}getMissing(e,n){return null}}class Xi{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Xi(this.content)}splice(e){throw Rt()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeBuf(this.content)}getRef(){return 3}}class Ni{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Ni(this.len)}splice(e){const n=new Ni(this.len-e);return this.len=e,n}mergeWith(e){return this.len+=e.len,!0}integrate(e,n){dh(e.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(e){}gc(e){}write(e,n){e.writeLen(this.len-n)}getRef(){return 1}}const Cb=(t,e)=>new Cs({guid:t,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class Zi{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const n={};this.opts=n,e.gc||(n.gc=!1),e.autoLoad&&(n.autoLoad=!0),e.meta!==null&&(n.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Zi(Cb(this.doc.guid,this.opts))}splice(e){throw Rt()}mergeWith(e){return!1}integrate(e,n){this.doc._item=n,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,n){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}class Er{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Er(this.embed)}splice(e){throw Rt()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeJSON(this.embed)}getRef(){return 5}}class Pe{constructor(e,n){this.key=e,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Pe(this.key,this.value)}splice(e){throw Rt()}mergeWith(e){return!1}integrate(e,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,n){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const Sb=Oi("node_env")==="development";class fr{constructor(e){this.arr=e,Sb&&Qd(e)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new fr(this.arr)}splice(e){const n=new fr(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let s=n;s<r;s++){const i=this.arr[s];e.writeAny(i)}}getRef(){return 8}}class Vt{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Vt(this.str)}splice(e){const n=new Vt(this.str.slice(e));this.str=this.str.slice(0,e);const r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"",n.str=""+n.str.slice(1)),n}mergeWith(e){return this.str+=e.str,!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const Tb=0,Eb=1,Ob=2,Mb=3,Ab=4;class kn{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new kn(this.type._copy())}splice(e){throw Rt()}mergeWith(e){return!1}integrate(e,n){this.type._integrate(e.doc,n)}delete(e){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(e.beforeState.get(n.id.client)||0)&&e._mergeStructs.push(n):n.delete(e),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let n=this.type._start;for(;n!==null;)n.gc(e,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,n){this.type._write(e)}getRef(){return 7}}const Rh=(t,e,n)=>{const{client:r,clock:s}=e.id,i=new Ke(Te(r,s+n),e,Te(r,s+n-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(n));return e.deleted&&i.markDeleted(),e.keep&&(i.keep=!0),e.redone!==null&&(i.redone=Te(e.redone.client,e.redone.clock+n)),e.right=i,i.right!==null&&(i.right.left=i),t._mergeStructs.push(i),i.parentSub!==null&&i.right===null&&i.parent._map.set(i.parentSub,i),e.length=n,i};class Ke extends Ih{constructor(e,n,r,s,i,o,a,l){super(e,l.getLength()),this.origin=r,this.left=n,this.right=s,this.rightOrigin=i,this.parent=o,this.parentSub=a,this.redone=null,this.content=l,this.info=this.content.isCountable()?mc:0}set marker(e){(this.info&Xo)>0!==e&&(this.info^=Xo)}get marker(){return(this.info&Xo)>0}get keep(){return(this.info&gc)>0}set keep(e){this.keep!==e&&(this.info^=gc)}get countable(){return(this.info&mc)>0}get deleted(){return(this.info&Yo)>0}set deleted(e){this.deleted!==e&&(this.info^=Yo)}markDeleted(){this.info|=Yo}getMissing(e,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=tt(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=tt(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===wi&&this.id.client!==this.parent.client&&this.parent.clock>=tt(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=Mc(e,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=hn(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===ln||this.right&&this.right.constructor===ln)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===Ke?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===Ke&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===wi){const r=ta(n,this.parent);r.constructor===ln?this.parent=null:this.parent=r.content.type}return null}integrate(e,n){if(n>0&&(this.id.clock+=n,this.left=Mc(e,e.doc.store,Te(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,s;if(r!==null)s=r.right;else if(this.parentSub!==null)for(s=this.parent._map.get(this.parentSub)||null;s!==null&&s.left!==null;)s=s.left;else s=this.parent._start;const i=new Set,o=new Set;for(;s!==null&&s!==this.right;){if(o.add(s),i.add(s),Qs(this.origin,s.origin)){if(s.id.client<this.id.client)r=s,i.clear();else if(Qs(this.rightOrigin,s.rightOrigin))break}else if(s.origin!==null&&o.has(ta(e.doc.store,s.origin)))i.has(ta(e.doc.store,s.origin))||(r=s,i.clear());else break;s=s.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),ph(e.doc.store,this),this.content.integrate(e,this),jc(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new ln(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:Te(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&Qs(e.origin,this.lastId)&&this.right===e&&Qs(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),dh(e.deleteSet,this.id.client,this.id.clock,this.length),jc(e,n,this.parentSub),this.content.delete(e)}}gc(e,n){if(!this.deleted)throw Ln();this.content.gc(e),n?ob(e,this,new ln(this.id,this.length)):this.content=new Ni(this.length)}write(e,n){const r=n>0?Te(this.id.client,this.id.clock+n-1):this.origin,s=this.rightOrigin,i=this.parentSub,o=this.content.getRef()&Vm|(r===null?0:Ei)|(s===null?0:Yd)|(i===null?0:zm);if(e.writeInfo(o),r!==null&&e.writeLeftID(r),s!==null&&e.writeRightID(s),r===null&&s===null){const a=this.parent;if(a._item!==void 0){const l=a._item;if(l===null){const u=rb(a);e.writeParentInfo(!0),e.writeString(u)}else e.writeParentInfo(!1),e.writeLeftID(l.id)}else a.constructor===String?(e.writeParentInfo(!0),e.writeString(a)):a.constructor===wi?(e.writeParentInfo(!1),e.writeLeftID(a)):Ln();i!==null&&e.writeString(i)}this.content.write(e,n)}}const Ph=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},$h="__ $YJS$ __";Ph[$h]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");Ph[$h]=!0;Ji("ychange",{isEqual:(t,e)=>t===e,parse:t=>t??null});const jb=za("TOGGLE_CONNECT_COMMAND");var Nb=Object.defineProperty,Ib=(t,e,n)=>e in t?Nb(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,K=(t,e,n)=>Ib(t,typeof e!="symbol"?e+"":e,n);const sa=t=>Ie(Qp(t)),Dn=Ji("cid",{parse:t=>typeof t=="string"?t:void 0}),fn=Ji("segment",{parse:t=>typeof t=="string"?t:void 0}),Rb=Ji("textType",{parse:t=>typeof t=="string"?t:void 0}),Lh=1;class vn extends wr{constructor(e="",n="",r){super(r),K(this,"__textType"),K(this,"__text"),this.__textType=e,this.__text=n}static getType(){return"immutable-typed-text"}static clone(e){const{__textType:n,__text:r,__key:s}=e;return new vn(n,r,s)}static importDOM(){return{span:e=>$b(e)?{conversion:Pb,priority:1}:null}}static importJSON(e){return pr().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setTextType(e.textType).setTextContent(e.text)}setTextType(e){if(this.__textType===e)return this;const n=this.getWritable();return n.__textType=e,n}getTextType(){return this.getLatest().__textType}setTextContent(e){if(this.__text===e)return this;const n=this.getWritable();return n.__text=e,n}getTextContent(){return this.getLatest().__text}createDOM(){const e=document.createElement("span");return e.setAttribute("data-text-type",this.__textType),e.classList.add(this.__textType),e}updateDOM(){return!1}exportDOM(e){const{element:n}=super.exportDOM(e);return n&&_n(n)&&n.setAttribute("data-text-type",this.getTextType()),{element:n}}decorate(){return this.getTextContent()}exportJSON(){return{type:this.getType(),textType:this.getTextType(),text:this.getTextContent(),version:Lh}}isKeyboardSelectable(){return!1}}function Pb(t){const e=t.getAttribute("data-text-type")??"",n=t.textContent??"";return{node:pr(e,n)}}function pr(t,e){return Ie(new vn(t,e))}function $b(t){return(t==null?void 0:t.tagName)==="span"}function Ii(t){return t instanceof vn}function Dh(t){return(t==null?void 0:t.type)===vn.getType()}const Lb=["type","marker","content"],Sa="unknown",Fh=1;class Hn extends bn{constructor(e="",n,r,s){super(s),K(this,"__tag"),K(this,"__marker"),K(this,"__unknownAttributes"),this.__tag=e,this.__marker=n,this.__unknownAttributes=r}static getType(){return"unknown"}static clone(e){const{__tag:n,__marker:r,__unknownAttributes:s,__key:i}=e;return new Hn(n,r,s,i)}static importDOM(){return{[Sa]:e=>Fb(e)?{conversion:Db,priority:1}:null}}static importJSON(e){return ul().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setTag(e.tag).setMarker(e.marker).setUnknownAttributes(e.unknownAttributes)}setTag(e){if(this.__tag===e)return this;const n=this.getWritable();return n.__tag=e,n}getTag(){return this.getLatest().__tag}setMarker(e){if(this.__marker===e)return this;const n=this.getWritable();return n.__marker=e,n}getMarker(){return this.getLatest().__marker}setUnknownAttributes(e){const n=this.getWritable();return n.__unknownAttributes=e,n}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement(Sa);return e.style.display="none",e}updateDOM(){return!1}exportDOM(){return{element:null}}exportJSON(){return{...super.exportJSON(),type:this.getType(),tag:this.getTag(),marker:this.getMarker(),unknownAttributes:this.getUnknownAttributes(),version:Fh}}canBeEmpty(){return!0}isInline(){return!0}extractWithChild(){return!1}excludeFromCopy(e){return e!=="clone"}}function Db(t){const e=t.getAttribute("data-tag")??"",n=t.getAttribute("data-marker")??"";return{node:ul(e,n)}}function ul(t,e,n){return Ie(new Hn(t,e,n))}function Fb(t){return(t==null?void 0:t.tagName)===Sa}function Zt(t){return t instanceof Hn}const bs="id",qh=1,qb=["type","marker","code","content"];class ht extends bn{constructor(e="",n,r){super(r),K(this,"__marker",bs),K(this,"__code"),K(this,"__unknownAttributes"),this.__code=e,this.__unknownAttributes=n}static getType(){return"book"}static clone(e){const{__code:n,__unknownAttributes:r,__key:s}=e;return new ht(n,r,s)}static importJSON(e){const{code:n}=e;return Uh(n).updateFromJSON(e)}static isValidBookCode(e){return ip(e)}updateFromJSON(e){return super.updateFromJSON(e).setCode(e.code).setUnknownAttributes(e.unknownAttributes)}getMarker(){return this.getLatest().__marker}setCode(e){if(this.__code===e)return this;const n=this.getWritable();return n.__code=e,n}getCode(){return this.getLatest().__code}setUnknownAttributes(e){const n=this.getWritable();return n.__unknownAttributes=e,n}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("p");return e.setAttribute("data-marker",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`),e.setAttribute("data-code",this.__code),e}updateDOM(){return!1}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),code:this.getCode(),unknownAttributes:this.getUnknownAttributes(),version:qh}}}function Uh(t,e){return Ie(new ht(t,e))}function Pt(t){return t instanceof ht}function Ub(t){return(t==null?void 0:t.type)===ht.getType()}const ke="",Ta="",Gt=ke,dl=`${ke}|`,Qi="p",$t="+",gr="-",Ri="chapter",Ea="verse",$c="invalid",Bb="text-spacing",Hb="formatted-font",Wb="marker-",hl="external-usj-mutation",Bh="selection-change",Oa="cursor-change",Ma="annotation-change",Aa="delta-change",Kb=[hl,Bh,Oa,Ma,Aa],Pi="c",Hh=1,Jb=["type","marker","number","sid","altnumber","pubnumber","content"];class wt extends bn{constructor(e="",n,r,s,i,o){super(o),K(this,"__marker"),K(this,"__number"),K(this,"__sid"),K(this,"__altnumber"),K(this,"__pubnumber"),K(this,"__unknownAttributes"),this.__marker=Pi,this.__number=e,this.__sid=n,this.__altnumber=r,this.__pubnumber=s,this.__unknownAttributes=i}static getType(){return"chapter"}static clone(e){const{__number:n,__sid:r,__altnumber:s,__pubnumber:i,__unknownAttributes:o,__key:a}=e;return new wt(n,r,s,i,o,a)}static importJSON(e){return Wh().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setNumber(e.number).setSid(e.sid).setAltnumber(e.altnumber).setPubnumber(e.pubnumber).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const n=this.getWritable();return n.__marker=e,n}getMarker(){return this.getLatest().__marker}setNumber(e){if(this.__number===e)return this;const n=this.getWritable();return n.__number=e,n}getNumber(){return this.getLatest().__number}setSid(e){if(this.__sid===e)return this;const n=this.getWritable();return n.__sid=e,n}getSid(){return this.getLatest().__sid}setAltnumber(e){if(this.__altnumber===e)return this;const n=this.getWritable();return n.__altnumber=e,n}getAltnumber(){return this.getLatest().__altnumber}setPubnumber(e){if(this.__pubnumber===e)return this;const n=this.getWritable();return n.__pubnumber=e,n}getPubnumber(){return this.getLatest().__pubnumber}setUnknownAttributes(e){const n=this.getWritable();return n.__unknownAttributes=e,n}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("p");return e.setAttribute("data-marker",this.__marker),e.classList.add(Ri,`usfm_${this.__marker}`),e.setAttribute("data-number",this.__number),e}updateDOM(){return!1}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),number:this.getNumber(),sid:this.getSid(),altnumber:this.getAltnumber(),pubnumber:this.getPubnumber(),unknownAttributes:this.getUnknownAttributes(),version:Hh}}}function Wh(t,e,n,r,s){return Ie(new wt(t,e,n,r,s))}function fl(t){return t instanceof wt}function zb(t){return(t==null?void 0:t.type)===wt.getType()}const Kh=["fr","fq","fqa","fk","ft","fl","fw","fp","fv","fdc","fm"],Jh=["xo","xop","xk","xq","xt","xta","xot","xnt","xdc"],Vb=["ca","cp","va","vp","add","bk","dc","em","jmp","k","nd","ord","pn","png","qt","rb","rq","sig","sls","tl","w","wa","wg","wh","wj","bd","it","bdit","no","sc","sup","ior","iqt","qac","qs","litl","lik","liv","liv1","liv2","liv3","liv4","liv5",...Kh,...Jh],zh=1,Gb=["type","marker","content"];class Ce extends bn{constructor(e="",n,r){super(r),K(this,"__marker"),K(this,"__unknownAttributes"),this.__marker=e,this.__unknownAttributes=n}static getType(){return"char"}static clone(e){const{__marker:n,__unknownAttributes:r,__key:s}=e;return new Ce(n,r,s)}static isValidMarker(e){return e!==void 0&&Vb.includes(e)}static isValidFootnoteMarker(e){return e!==void 0&&Kh.includes(e)}static isValidCrossReferenceMarker(e){return e!==void 0&&Jh.includes(e)}static importDOM(){return{span:e=>Xb(e)?{conversion:Yb,priority:1}:null}}static importJSON(e){return gt().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const n=this.getWritable();return n.__marker=e,n}getMarker(){return this.getLatest().__marker}setUnknownAttributes(e){const n=this.getWritable();return n.__unknownAttributes=e,n}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("span");return e.setAttribute("data-marker",this.__marker),e.setAttribute("title",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`),e}updateDOM(){return!1}exportDOM(e){const{element:n}=super.exportDOM(e);return n&&_n(n)&&(n.setAttribute("data-marker",this.getMarker()),n.classList.add(this.getType(),`usfm_${this.getMarker()}`)),{element:n}}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),unknownAttributes:this.getUnknownAttributes(),version:zh}}insertNewAfter(e,n){const r=gt(this.getMarker());return r.setDirection(this.getDirection()),r.setFormat(this.getFormatType()),r.setStyle(this.getTextStyle()),this.insertAfter(r,n),r}canBeEmpty(){return!1}isInline(){return!0}}function Yb(t){const e=t.getAttribute("data-marker")??"f";return{node:gt(e)}}function gt(t,e){return Ie(new Ce(t,e))}function Xb(t){if(!t)return!1;const e=t.getAttribute("data-marker")??"";return Ce.isValidMarker(e)&&t.classList.contains(Ce.getType())}function ge(t){return t instanceof Ce}function Zb(t){return(t==null?void 0:t.type)===Ce.getType()}const Vh=1,Qb="c",Gh="span";class Qt extends wr{constructor(e="",n=!1,r,s,i,o,a){super(a),K(this,"__marker"),K(this,"__number"),K(this,"__showMarker"),K(this,"__sid"),K(this,"__altnumber"),K(this,"__pubnumber"),K(this,"__unknownAttributes"),this.__marker=Qb,this.__number=e,this.__showMarker=n,this.__sid=r,this.__altnumber=s,this.__pubnumber=i,this.__unknownAttributes=o}static getType(){return"immutable-chapter"}static clone(e){const{__number:n,__showMarker:r,__sid:s,__altnumber:i,__pubnumber:o,__unknownAttributes:a,__key:l}=e;return new Qt(n,r,s,i,o,a,l)}static importDOM(){return{span:e=>Yh(e)?{conversion:e_,priority:1}:null}}static importJSON(e){return pl().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setNumber(e.number).setShowMarker(e.showMarker).setSid(e.sid).setAltnumber(e.altnumber).setPubnumber(e.pubnumber).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const n=this.getWritable();return n.__marker=e,n}getMarker(){return this.getLatest().__marker}setNumber(e){if(this.__number===e)return this;const n=this.getWritable();return n.__number=e,n}getNumber(){return this.getLatest().__number}setShowMarker(e=!1){if(this.__showMarker===e)return this;const n=this.getWritable();return n.__showMarker=e,n}getShowMarker(){return this.getLatest().__showMarker}setSid(e){if(this.__sid===e)return this;const n=this.getWritable();return n.__sid=e,n}getSid(){return this.getLatest().__sid}setAltnumber(e){if(this.__altnumber===e)return this;const n=this.getWritable();return n.__altnumber=e,n}getAltnumber(){return this.getLatest().__altnumber}setPubnumber(e){if(this.__pubnumber===e)return this;const n=this.getWritable();return n.__pubnumber=e,n}getPubnumber(){return this.getLatest().__pubnumber}setUnknownAttributes(e){const n=this.getWritable();return n.__unknownAttributes=e,n}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement(Gh);return e.setAttribute("data-marker",this.__marker),e.classList.add(Ri,`usfm_${this.__marker}`),this.__showMarker&&e.classList.add("marker"),e.setAttribute("data-number",this.__number),e}updateDOM(){return!1}exportDOM(e){const{element:n}=super.exportDOM(e);return n&&_n(n)&&(n.setAttribute("data-marker",this.getMarker()),n.classList.add(Ri,`usfm_${this.getMarker()}`),n.setAttribute("data-number",this.getNumber())),{element:n}}decorate(){return this.getShowMarker()?Ts(this.getMarker(),this.getNumber()):this.getNumber()}exportJSON(){return{type:this.getType(),marker:this.getMarker(),number:this.getNumber(),showMarker:this.getShowMarker(),sid:this.getSid(),altnumber:this.getAltnumber(),pubnumber:this.getPubnumber(),unknownAttributes:this.getUnknownAttributes(),version:Vh}}isInline(){return!1}isKeyboardSelectable(){return!1}}function e_(t){const e=t.getAttribute("data-number")??"0";return{node:pl(e)}}function pl(t,e,n,r,s,i){return Ie(new Qt(t,e,n,r,s,i))}function Yh(t){return t?t.classList.contains(Ri)&&t.tagName.toLowerCase()===Gh:!1}function Ss(t){return t instanceof Qt}function t_(t){return(t==null?void 0:t.type)===Qt.getType()}const Xh=1;class pn extends Va{static getType(){return"implied-para"}static clone(e){return new pn(e.__key)}static importJSON(e){return bt().updateFromJSON(e)}getMarker(){return Qi}exportJSON(){return{...super.exportJSON(),type:this.getType(),version:Xh}}insertNewAfter(e,n){const r=bt();return r.setTextFormat(e.format),r.setTextStyle(e.style),r.setDirection(this.getDirection()),r.setFormat(this.getFormatType()),r.setStyle(this.getTextStyle()),this.insertAfter(r,n),r}}function bt(){return Ie(new pn)}function Yt(t){return t instanceof pn}function gl(t){return(t==null?void 0:t.type)===pn.getType()}const Fn="zmsc-s",ar="zmsc-e",n_=[Fn,ar],r_=["ts-s","ts-e","t-s","t-e","ts","qt1-s","qt1-e","qt2-s","qt2-e","qt3-s","qt3-e","qt4-s","qt4-e","qt5-s","qt5-e","qt-s","qt-e",Fn,ar],Zh=1,s_=["type","marker","sid","eid","content"];class Lt extends wr{constructor(e="",n,r,s,i){super(i),K(this,"__marker"),K(this,"__sid"),K(this,"__eid"),K(this,"__unknownAttributes"),this.__marker=e,this.__sid=n,this.__eid=r,this.__unknownAttributes=s}static getType(){return"ms"}static clone(e){const{__marker:n,__sid:r,__eid:s,__unknownAttributes:i,__key:o}=e;return new Lt(n,r,s,i,o)}static importJSON(e){return Qh().updateFromJSON(e)}static isValidMarker(e){return e!==void 0&&(r_.includes(e)||e.startsWith("z"))}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setSid(e.sid).setEid(e.eid).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const n=this.getWritable();return n.__marker=e,n}getMarker(){return this.getLatest().__marker}setSid(e){if(this.__sid===e)return this;const n=this.getWritable();return n.__sid=e,n}getSid(){return this.getLatest().__sid}setEid(e){if(this.__eid===e)return this;const n=this.getWritable();return n.__eid=e,n}getEid(){return this.getLatest().__eid}setUnknownAttributes(e){const n=this.getWritable();return n.__unknownAttributes=e,n}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("span");return e.setAttribute("data-marker",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`),e}updateDOM(){return!1}decorate(){return""}exportJSON(){return{type:this.getType(),marker:this.getMarker(),sid:this.getSid(),eid:this.getEid(),unknownAttributes:this.getUnknownAttributes(),version:Zh}}isKeyboardSelectable(){return!1}}function i_(t){return n_.includes(t)}function Qh(t,e,n,r){return Ie(new Lt(t,e,n,r))}function eo(t){return t instanceof Lt}const ml="f",o_=[ml,"fe","ef","efe","x","ex"],a_=["type","marker","caller","category","content"],ef=1;class $e extends bn{constructor(e=ml,n,r=!0,s,i,o){super(o),K(this,"__marker"),K(this,"__caller"),K(this,"__isCollapsed"),K(this,"__category"),K(this,"__unknownAttributes"),this.__marker=e,this.__caller=n??(e==="x"||e==="ex"?gr:$t),this.__isCollapsed=r,this.__category=s,this.__unknownAttributes=i}static getType(){return"note"}static clone(e){const{__marker:n,__caller:r,__isCollapsed:s,__category:i,__unknownAttributes:o,__key:a}=e;return new $e(n,r,s,i,o,a)}static importDOM(){return{span:e=>c_(e)?{conversion:l_,priority:1}:null}}static importJSON(e){return yl().updateFromJSON(e)}static isValidMarker(e){return e!==void 0&&o_.includes(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setCaller(e.caller).setIsCollapsed(e.isCollapsed).setCategory(e.category).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const n=this.getWritable();return n.__marker=e,n}getMarker(){return this.getLatest().__marker}setCaller(e){if(this.__caller===e)return this;const n=this.getWritable();return n.__caller=e,n}getCaller(){return this.getLatest().__caller}setIsCollapsed(e){if(this.__isCollapsed===e)return this;const n=this.getWritable();return n.__isCollapsed=e,n}toggleIsCollapsed(){const e=this.getWritable();return e.__isCollapsed=!e.__isCollapsed,e}getIsCollapsed(){return this.getLatest().__isCollapsed}setCategory(e){if(this.__category===e)return this;const n=this.getWritable();return n.__category=e,n}getCategory(){return this.getLatest().__category}setUnknownAttributes(e){const n=this.getWritable();return n.__unknownAttributes=e,n}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("span");return e.setAttribute("data-marker",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`,this.__isCollapsed?"collapsed":"expanded"),e.setAttribute("data-caller",this.__caller),e}updateDOM(e){return e.__isCollapsed!==this.__isCollapsed}exportDOM(e){const{element:n}=super.exportDOM(e);return n&&_n(n)&&(n.setAttribute("data-marker",this.getMarker()),n.classList.add(this.getType(),`usfm_${this.getMarker()}`,this.getIsCollapsed()?"collapsed":"expanded"),n.setAttribute("data-caller",this.getCaller())),{element:n}}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),caller:this.getCaller(),isCollapsed:this.getIsCollapsed(),category:this.getCategory(),unknownAttributes:this.getUnknownAttributes(),version:ef}}canBeEmpty(){return!1}isInline(){return!0}}function l_(t){const e=t.getAttribute("data-marker")??"f",n=t.getAttribute("data-caller")??"",r=t.classList.contains("collapsed");return{node:yl(e,n,r)}}function yl(t,e,n,r,s){return Ie(new $e(t,e,n,r,s))}function c_(t){if(!t)return!1;const e=t.getAttribute("data-marker")??"";return $e.isValidMarker(e)&&t.classList.contains($e.getType())}function ae(t){return t instanceof $e}const u_=["ide","sts","rem","h","toc1","toc2","toc3","toca1","toca2","toca3","imt","imt1","imt2","imt3","imt4","is","is1","is2","ip","ipi","im","imi","ipq","imq","ipr","iq","iq1","iq2","iq3","ili","ili1","ili2","ib","iot","io","io1","io2","io3","io4","iex","imte","imte1","imte2","ie","mt","mt1","mt2","mt3","mt4","mte","mte1","mte2","cl","cd","ms","ms1","ms2","ms3","mr","s","s1","s2","s3","s4","sr","r","d","sp","sd","sd1","sd2","sd3","sd4",Qi,"m","po","cls","pr","pc","pm","pmo","pmc","pmr","pi","pi1","pi2","pi3","mi","lit","nb","q","q1","q2","q3","q4","qr","qc","qa","qm","qm1","qm2","qm3","qd","b","lh","li","li1","li2","li3","li4","lf","lim","lim1","lim2","lim3","lim4","pb"],tf=1,d_=["type","marker","content"];class nt extends Va{constructor(e=Qi,n,r){super(r),K(this,"__marker"),K(this,"__unknownAttributes"),this.__marker=e,this.__unknownAttributes=n}static getType(){return"para"}static clone(e){const{__marker:n,__unknownAttributes:r,__key:s}=e;return new nt(n,r,s)}static isValidMarker(e){return e!==void 0&&u_.includes(e)}static importDOM(){return{p:()=>({conversion:h_,priority:1})}}static importJSON(e){return _s().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const n=this.getWritable();return n.__marker=e,n}getMarker(){return this.getLatest().__marker}setUnknownAttributes(e){const n=this.getWritable();return n.__unknownAttributes=e,n}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("p");return e.setAttribute("data-marker",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`),e}exportDOM(e){const{element:n}=super.exportDOM(e);return n&&_n(n)&&(n.setAttribute("data-marker",this.getMarker()),n.classList.add(this.getType(),`usfm_${this.getMarker()}`)),{element:n}}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),unknownAttributes:this.getUnknownAttributes(),version:tf}}insertNewAfter(e,n){const r=_s(this.getMarker());return r.setTextFormat(e.format),r.setTextStyle(e.style),r.setDirection(this.getDirection()),r.setFormat(this.getFormatType()),r.setStyle(this.getTextStyle()),this.insertAfter(r,n),r}}function h_(t){const e=t.getAttribute("data-marker")??void 0,n=_s(e);if(t.style){n.setFormat(t.style.textAlign);const r=parseInt(t.style.textIndent,10)/20;r>0&&n.setIndent(r)}return{node:n}}function _s(t,e){return Ie(new nt(t,e))}function Je(t){return t instanceof nt}function f_(t){return(t==null?void 0:t.type)===nt.getType()}const $i="v",nf=1,p_=["type","marker","number","sid","altnumber","pubnumber","content"];class Ge extends Nt{constructor(e="",n,r,s,i,o,a){super(n??e,a),K(this,"__marker"),K(this,"__number"),K(this,"__sid"),K(this,"__altnumber"),K(this,"__pubnumber"),K(this,"__unknownAttributes"),this.__marker=$i,this.__number=e,this.__sid=r,this.__altnumber=s,this.__pubnumber=i,this.__unknownAttributes=o}static getType(){return"verse"}static clone(e){const{__number:n,__text:r,__sid:s,__altnumber:i,__pubnumber:o,__unknownAttributes:a,__key:l}=e;return new Ge(n,r,s,i,o,a,l)}static importJSON(e){return rf().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setNumber(e.number).setSid(e.sid).setAltnumber(e.altnumber).setPubnumber(e.pubnumber).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const n=this.getWritable();return n.__marker=e,n}getMarker(){return this.getLatest().__marker}setNumber(e){if(this.__number===e)return this;const n=this.getWritable();return n.__number=e,n}getNumber(){return this.getLatest().__number}setSid(e){if(this.__sid===e)return this;const n=this.getWritable();return n.__sid=e,n}getSid(){return this.getLatest().__sid}setAltnumber(e){if(this.__altnumber===e)return this;const n=this.getWritable();return n.__altnumber=e,n}getAltnumber(){return this.getLatest().__altnumber}setPubnumber(e){if(this.__pubnumber===e)return this;const n=this.getWritable();return n.__pubnumber=e,n}getPubnumber(){return this.getLatest().__pubnumber}setUnknownAttributes(e){const n=this.getWritable();return n.__unknownAttributes=e,n}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(e){const n=super.createDOM(e);return n.setAttribute("data-marker",this.__marker),n.classList.add(Ea,`usfm_${this.__marker}`),n.setAttribute("data-number",this.__number),n}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),number:this.getNumber(),sid:this.getSid(),altnumber:this.getAltnumber(),pubnumber:this.getPubnumber(),unknownAttributes:this.getUnknownAttributes(),version:nf}}}function rf(t,e,n,r,s,i){return Ie(new Ge(t,e,n,r,s,i))}function bl(t){return t instanceof Ge}function g_(t){return(t==null?void 0:t.type)===Ge.getType()}function m_(t){return zb(t)||t_(t)}function ut(t){return fl(t)||Ss(t)}function y_(t,e){return t.find(n=>ut(n)&&n.getNumber()===e.toString())}function b_(t,e=!1){return t.find((n,r)=>(!e||r>0)&&ut(n))}function _l(t){var e;if(!t)return;if(ut(t))return t;let n=(e=t.getTopLevelElement())==null?void 0:e.getPreviousSibling();for(;n&&!ut(n);)n=n.getPreviousSibling();if(n&&ut(n))return n}function sf(t){let e=t;for(;e!==null;){if(ae(e))return e;e=e.getParent()}}function __(t){return Pt(t)||fl(t)||ge(t)||Ss(t)||Yt(t)||eo(t)||Je(t)||ae(t)||bl(t)||Zt(t)}function k_(t){var e;if(t.anchor.type==="element"){const r=t.anchor.getNode(),s=t.anchor.offset;if(s<r.getChildrenSize())return r.getChildAtIndex(s)}const n=t.anchor.getNode();return n.getNextSibling()??((e=n.getParent())==null?void 0:e.getNextSibling())??null}function v_(t){var e;const n=t.anchor.offset;if(t.anchor.type==="element"&&n>0)return t.anchor.getNode().getChildAtIndex(n-1);const r=t.anchor.getNode();return r.getPreviousSibling()??((e=r.getParent())==null?void 0:e.getPreviousSibling())??null}function yt(t){return Je(t)||Yt(t)}function w_(t,e){let n=t.getParent();for(;n;){if(n.getKey()===e)return!0;n=n.getParent()}return!1}function qn(t,e){const n=xr(e,Dn),r=!!(t.cid&&n),s=!t.cid&&!n;return t.style===e.getMarker()&&(s||r&&t.cid===n)}function x_(t,e){const n=se(t)?t:t.getParent(),r=se(e)?e:e.getParent(),s=n&&r?Zp(n,r):void 0;return s?s.commonAncestor:void 0}function C_(t){const e=t.getStartEndPoints();if(!e)return;const[n,r]=e,s=t.isBackward()?n:r;t.focus.set(s.key,s.offset,s.type),t.anchor.set(s.key,s.offset,s.type)}function kl(t){return(t==null?void 0:t.type)===Nt.getType()}function S_(t,e){if(!e)return;const n=t.findIndex(r=>r===e);n&&(t.length=n)}function T_(t,e){if(!e)return t;const n=e.getIndexWithinParent();return t.splice(n+1,t.length-n-1)}function en(t){return`\\${t}`}function mr(t){return`\\${t}*`}function of(t,e,n){const r=en(t);if(e!=null&&e.startsWith(r)){const s=parseInt(e.slice(r.length),10);isNaN(s)||(n=s.toString())}return n}function Ts(t,e){let n=en(t);return e&&(n+=`${ke}${e}`),n+=" ",n}function af(t){return A_(t)||Dh(t)&&t.textType==="marker"?"":kl(t)&&t.text!==ke?t.text:Zb(t)?t.children.map(e=>af(e)).join(""):""}function E_(t){return t.map(e=>af(e)).filter(e=>e.length>0).join(" ").trim()}function vl(t){return" "+t+ke}function wl(t){const e=[];for(const n of t){if(!ge(n))continue;const r=lf(n);r!==Gt&&r.length>0&&e.push(r)}return e.join(" ").trim()}function lf(t){return Dt(t)||Or(t)?"":Y(t)?t.getTextContent():se(t)?t.getChildren().map(e=>lf(e)).join(""):""}function Or(t){return Ii(t)&&t.getTextType()==="marker"}function je(t,e=pp){const n={...t};return e.forEach(r=>{Reflect.deleteProperty(n,r)}),Object.keys(n).length===0?void 0:n}function Ne(t){return Object.fromEntries(Object.entries(t).filter(([,e])=>e!==void 0))}function cf(t){if(!t)return;const e=t.getNodes();if(e.length>0)return t.isBackward()?e[e.length-1]:e[0]}function ja(t,e){if(!e)return(t+1).toString();const n=e.split("-");if(n.length===2)return parseInt(n[1])?`${parseInt(n[1])+1}`:`${parseInt(n[0])+1}`;const r=RegExp(/^(\d+)([a-yA-Y]{1,3})$/).exec(e);if(!r)return(parseInt(e)+1).toString();const s=String.fromCharCode(r[2].charCodeAt(0)+1);return`${r[1]}${s}`}function xl(t,e){if(!e)return!1;const n=e.split("-").map(r=>parseInt(r));if(n.length<1||n.length>2||n[0]>n[1])throw new Error("isVerseInRange: invalid range");return n.length===1?t===n[0]:n.length===2&&isNaN(n[1])?t>=n[0]:(n.length===2&&isNaN(n[0])||t>=n[0])&&t<=n[1]}function O_(t){return!!t&&t.includes("-")}const M_=1;class wn extends Nt{constructor(e="",n="opening",r){super(ia(e,n),r),K(this,"__marker"),K(this,"__markerSyntax"),this.__marker=e,this.__markerSyntax=n}static getType(){return"marker"}static clone(e){return new wn(e.__marker,e.__markerSyntax,e.__key)}static importJSON(e){return yr().updateFromJSON(e)}updateFromJSON(e){const{marker:n,markerSyntax:r="opening"}=e;return super.updateFromJSON(e).setMarker(n).setMarkerSyntax(r)}setMarker(e){if(this.__marker===e)return this;const n=this.getWritable();return n.__marker=e,n.__text=ia(e,n.__markerSyntax),n}getMarker(){return this.getLatest().__marker}setMarkerSyntax(e){if(this.__markerSyntax===e)return this;const n=this.getWritable();return n.__markerSyntax=e,n.__text=ia(n.__marker,e),n}getMarkerSyntax(){return this.getLatest().__markerSyntax}createDOM(e){const n=super.createDOM(e);return n.setAttribute("data-marker",this.__marker),n.classList.add(this.__markerSyntax),n}exportJSON(){return{...super.exportJSON(),type:this.getType(),text:this.getTextContent(),marker:this.getMarker(),markerSyntax:this.getMarkerSyntax(),version:M_}}}function yr(t,e){return Ie(new wn(t,e))}function Dt(t){return t instanceof wn}function A_(t){return(t==null?void 0:t.type)===wn.getType()}function ia(t,e){return e==="closing"?mr(t):e==="selfClosing"?mr(""):en(t)}const dn="internal-comment",j_=[dn],uf=Object.freeze({}),Na=Object.freeze({}),Ia=Object.freeze({}),N_=1,Kt=new Map,Nn=new Map;class Fe extends bn{constructor(e=uf,n,r,s){super(s),K(this,"__typedIDs"),K(this,"__typedOnClicks"),K(this,"__typedOnRemoves"),K(this,"__domOnClickListener"),K(this,"__suppressOnRemoveCallbacks"),this.__typedIDs=ni(e),this.__typedOnClicks=oa(n),this.__typedOnRemoves=aa(r),this.pruneTypedOnClicks(),this.pruneTypedOnRemoves(),this.syncTypedOnClicksToRegistry(),this.syncTypedOnRemovesToRegistry()}static getType(){return"typed-mark"}static clone(e){const n=ni(e.__typedIDs),r=oa(e.__typedOnClicks),s=aa(e.__typedOnRemoves);return new Fe(n,r,s,e.__key)}static isReservedType(e){return j_.includes(e)}static importDOM(){return null}static importJSON(e){return ks().updateFromJSON(e)}exportJSON(){return{...super.exportJSON(),type:this.getType(),typedIDs:this.getTypedIDs(),version:N_}}createDOM(e,n){const r=document.createElement("mark");for(const[i,o]of Object.entries(this.__typedIDs)){Ot(r,In(e.theme.typedMark,i)),o.length>1&&Ot(r,In(e.theme.typedMarkOverlap,i));for(const a of o)Ot(r,In("annotationId",a))}const s=this.getOrCreateDOMClickListener(n);return r.addEventListener("click",s),r}updateDOM(e,n,r){const s=new Set([...Object.keys(e.__typedIDs??{}),...Object.keys(this.__typedIDs??{})]);for(const i of s){const o=e.__typedIDs[i]??[],a=this.__typedIDs[i]??[],l=o.length,u=a.length,d=In(r.theme.typedMark,i),f=In(r.theme.typedMarkOverlap,i);l!==u&&(l===0?u===1&&Ot(n,d):u===0&&yi(n,d),l===1?u===2&&Ot(n,f):u===1&&yi(n,f));const h=new Set(o),p=new Set(a);for(const y of o)p.has(y)||yi(n,In("annotationId",y));for(const y of a)h.has(y)||Ot(n,In("annotationId",y))}return!1}updateFromJSON(e){return super.updateFromJSON(e).setTypedIDs(e.typedIDs)}hasID(e,n){const r=this.getTypedIDs()[e];if(!r)return!1;for(const s of r)if(n===s)return!0;return!1}getTypedIDs(){const e=this.getLatest();return Se(e)?e.__typedIDs:{}}setTypedIDs(e){const n=this.getWritable(),r=ni(n.__typedIDs);n.__typedIDs=ni(e),n.dispatchRemovedIDs(r,n.__typedIDs,"removed"),n.pruneTypedOnClicks(),n.pruneTypedOnRemoves(),n.syncTypedOnClicksToRegistry(),n.syncTypedOnRemovesToRegistry();const s=n.mergeWithAdjacentTypedMarks();return s.hasNoIDsForEveryType()&&s.getParent()!==null&&Li(s),s}setTypedOnClicks(e){const n=this.getWritable();return n.__typedOnClicks=oa(e),n.pruneTypedOnClicks(),n.syncTypedOnClicksToRegistry(),n}getTypedOnClicks(){const e=this.getLatest();return Se(e)?Kt.get(e.getKey())??{}:{}}setTypedOnRemoves(e){const n=this.getWritable();return n.__typedOnRemoves=aa(e),n.pruneTypedOnRemoves(),n.syncTypedOnRemovesToRegistry(),n}getTypedOnRemoves(){const e=this.getLatest();return Se(e)?Nn.get(e.getKey())??{}:{}}addID(e,n,r,s){const i=this.getWritable();if(!Se(i))return;lt(e),lt(n);let o=i.__typedIDs[e];o||(o=[],i.__typedIDs[e]=o);for(const a of o)if(n===a){r&&i.setOnClickFor(e,n,r),s&&i.setOnRemoveFor(e,n,s);return}o.push(n),r&&i.setOnClickFor(e,n,r),s&&i.setOnRemoveFor(e,n,s)}deleteID(e,n){const r=this.getWritable();if(!Se(r))return;const s=r.__typedIDs[e];if(!s||s.length===0)return;for(let o=0;o<s.length;o++)if(n===s[o]){s.splice(o,1),r.invokeOnRemove(e,n,"removed");break}r.removeOnClickFor(e,n),r.removeOnRemoveFor(e,n),r.pruneTypedOnClicks(),r.pruneTypedOnRemoves();const i=r.mergeWithAdjacentTypedMarks();i.hasNoIDsForEveryType()&&i.getParent()!==null&&Li(i)}hasNoIDsForEveryType(){return Object.values(this.getTypedIDs()).every(e=>e===void 0||e.length===0)}insertNewAfter(e,n=!0){const r=ks(this.__typedIDs,this.getTypedOnClicks());return this.insertAfter(r,n),r}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}canBeEmpty(){return!1}isInline(){return!0}extractWithChild(e,n,r){if(!Z(n)||r==="html")return!1;const s=n.anchor,i=n.focus,o=s.getNode(),a=i.getNode(),l=n.isBackward()?s.offset-i.offset:i.offset-s.offset;return this.isParentOf(o)&&this.isParentOf(a)&&this.getTextContent().length===l}excludeFromCopy(e){return e!=="clone"}remove(e){const n=this.getWritable(),r=this.getTypedIDs();n.__suppressOnRemoveCallbacks?n.__suppressOnRemoveCallbacks=void 0:n.dispatchOnRemoveForTypedIDs(r,"destroyed"),Kt.delete(n.getKey()),Nn.delete(n.getKey()),n.__typedOnClicks=void 0,n.__typedOnRemoves=void 0,super.remove.call(n,e)}getOrCreateDOMClickListener(e){return this.__domOnClickListener||(this.__domOnClickListener=n=>{this.handleDOMClick(n,e)}),this.__domOnClickListener}handleDOMClick(e,n){const r=Kt.get(this.getKey());if(!r)return;const s=[];for(const[o,a]of Object.entries(r))for(const[l,u]of Object.entries(a))u&&s.push([u,o,l]);if(s.length===0)return;const i=n.read(()=>this.getTextContent());for(const[o,a,l]of s)o(e,a,l,i)}ensureOnClickMapMutable(){if(this.__typedOnClicks===void 0||this.__typedOnClicks===Na){const e=Kt.get(this.getKey());this.__typedOnClicks=e??{}}return this.__typedOnClicks}syncTypedOnClicksToRegistry(){if(!this.__typedOnClicks||Object.keys(this.__typedOnClicks).length===0){Kt.delete(this.getKey()),this.__typedOnClicks&&Object.keys(this.__typedOnClicks).length===0&&(this.__typedOnClicks=void 0);return}Kt.set(this.getKey(),this.__typedOnClicks)}setOnClickFor(e,n,r){lt(e),lt(n);const s=this.ensureOnClickMapMutable(),i=s[e]??(s[e]={});i[n]=r,this.syncTypedOnClicksToRegistry()}removeOnClickFor(e,n){if(!this.__typedOnClicks)return;const r=this.__typedOnClicks[e];if(!r)return;const s=ri(r,n);if(Object.keys(s).length>0)this.__typedOnClicks={...this.__typedOnClicks,[e]:s};else{const i=ri(this.__typedOnClicks,e);this.__typedOnClicks=Object.keys(i).length>0?i:void 0}this.syncTypedOnClicksToRegistry()}pruneTypedOnClicks(){if(!this.__typedOnClicks||this.__typedOnClicks===Na){this.__typedOnClicks=void 0,this.syncTypedOnClicksToRegistry();return}const e={};for(const[n,r]of Object.entries(this.__typedOnClicks)){const s=this.__typedIDs[n];if(!s||s.length===0)continue;const i=new Set(s),o={};for(const[a,l]of Object.entries(r))i.has(a)&&(o[a]=l);Object.keys(o).length>0&&(e[n]=o)}this.__typedOnClicks=Object.keys(e).length>0?e:void 0,this.syncTypedOnClicksToRegistry()}ensureOnRemoveMapMutable(){if(this.__typedOnRemoves===void 0||this.__typedOnRemoves===Ia){const e=Nn.get(this.getKey());this.__typedOnRemoves=e??{}}return this.__typedOnRemoves}syncTypedOnRemovesToRegistry(){if(!this.__typedOnRemoves||Object.keys(this.__typedOnRemoves).length===0){Nn.delete(this.getKey()),this.__typedOnRemoves&&Object.keys(this.__typedOnRemoves).length===0&&(this.__typedOnRemoves=void 0);return}Nn.set(this.getKey(),this.__typedOnRemoves)}setOnRemoveFor(e,n,r){lt(e),lt(n);const s=this.ensureOnRemoveMapMutable(),i=s[e]??(s[e]={});i[n]=r,this.syncTypedOnRemovesToRegistry()}removeOnRemoveFor(e,n){if(!this.__typedOnRemoves)return;const r=this.__typedOnRemoves[e];if(!r)return;const s=ri(r,n);if(Object.keys(s).length>0)this.__typedOnRemoves={...this.__typedOnRemoves,[e]:s};else{const i=ri(this.__typedOnRemoves,e);this.__typedOnRemoves=Object.keys(i).length>0?i:void 0}this.syncTypedOnRemovesToRegistry()}pruneTypedOnRemoves(){if(!this.__typedOnRemoves||this.__typedOnRemoves===Ia){this.__typedOnRemoves=void 0,this.syncTypedOnRemovesToRegistry();return}const e={};for(const[n,r]of Object.entries(this.__typedOnRemoves)){const s=this.__typedIDs[n];if(!s||s.length===0)continue;const i=new Set(s),o={};for(const[a,l]of Object.entries(r))i.has(a)&&(o[a]=l);Object.keys(o).length>0&&(e[n]=o)}this.__typedOnRemoves=Object.keys(e).length>0?e:void 0,this.syncTypedOnRemovesToRegistry()}invokeOnRemove(e,n,r){var s;const i=(s=this.getTypedOnRemoves()[e])==null?void 0:s[n];i&&(i(e,n,r,this.getTextContent()),this.removeOnRemoveFor(e,n))}dispatchRemovedIDs(e,n,r){const s=I_(e,n);if(s.length!==0)for(const[i,o]of s)this.invokeOnRemove(i,o,r)}dispatchOnRemoveForTypedIDs(e,n){for(const[r,s]of Object.entries(e))if(s)for(const i of s)this.invokeOnRemove(r,i,n)}mergeWithAdjacentTypedMarks(){if(this.hasNoIDsForEveryType())return this;let e=this.getPreviousSibling();for(;Se(e)&&Dc(e.getTypedIDs(),this.getTypedIDs());)this.mergeWithPreviousTypedMark(e),e=this.getPreviousSibling();let n=this.getNextSibling();for(;Se(n)&&Dc(this.getTypedIDs(),n.getTypedIDs());)this.mergeWithNextTypedMark(n),n=this.getNextSibling();return this}mergeWithPreviousTypedMark(e){this.mergeOnClicksFrom(e.getTypedOnClicks()),this.mergeOnRemovesFrom(e.getTypedOnRemoves());const n=e.getChildren();n.length>0&&this.splice(0,0,n),Kt.delete(e.getKey()),Nn.delete(e.getKey()),e.getWritable().__suppressOnRemoveCallbacks=!0,e.remove()}mergeWithNextTypedMark(e){this.mergeOnClicksFrom(e.getTypedOnClicks()),this.mergeOnRemovesFrom(e.getTypedOnRemoves());const n=e.getChildren();n.length>0&&this.append(...n),Kt.delete(e.getKey()),Nn.delete(e.getKey()),e.getWritable().__suppressOnRemoveCallbacks=!0,e.remove()}mergeOnClicksFrom(e){if(!e||Object.keys(e).length===0)return;const n=R_(this.getTypedOnClicks(),e);Object.keys(n).length!==0&&this.setTypedOnClicks(n)}mergeOnRemovesFrom(e){if(!e||Object.keys(e).length===0)return;const n=P_(this.getTypedOnRemoves(),e);Object.keys(n).length!==0&&this.setTypedOnRemoves(n)}}function ni(t=uf){const e={};for(const[n,r]of Object.entries(t)){if(lt(n),!Array.isArray(r)){e[n]=[];continue}const s=[];for(const i of r)lt(i),s.push(i);e[n]=s}return e}function oa(t){if(!t||t===Na)return;const e={};for(const[n,r]of Object.entries(t)){lt(n);const s={};for(const[i,o]of Object.entries(r))lt(i),s[i]=o;Object.keys(s).length>0&&(e[n]=s)}return Object.keys(e).length>0?e:void 0}function aa(t){if(!t||t===Ia)return;const e={};for(const[n,r]of Object.entries(t)){lt(n);const s={};for(const[i,o]of Object.entries(r))lt(i),s[i]=o;Object.keys(s).length>0&&(e[n]=s)}return Object.keys(e).length>0?e:void 0}function ri(t,e){const n={};for(const[r,s]of Object.entries(t))r!==e&&(n[r]=s);return n}function Lc(t){const e={};for(const[n,r]of Object.entries(t))!r||r.length===0||(e[n]=[...r].sort());return e}function I_(t,e){const n=[];for(const[r,s]of Object.entries(t)){const i=new Set(e[r]??[]);for(const o of s??[])i.has(o)||n.push([r,o])}return n}function Dc(t,e){const n=Lc(t),r=Lc(e),s=Object.keys(n).sort(),i=Object.keys(r).sort();if(s.length!==i.length)return!1;for(let o=0;o<s.length;o++){const a=s[o];if(a!==i[o])return!1;const l=n[a],u=r[a];if(!l||!u||l.length!==u.length)return!1;for(let d=0;d<l.length;d++)if(l[d]!==u[d])return!1}return!0}function R_(t,e){const n={},r=new Set([...Object.keys(t),...Object.keys(e)]);for(const s of r){const i=t[s]??{},o=e[s]??{},a=new Set([...Object.keys(i),...Object.keys(o)]),l={};for(const u of a){const d=i[u]??o[u];d&&(l[u]=d)}Object.keys(l).length>0&&(n[s]=l)}return n}function P_(t,e){const n={},r=new Set([...Object.keys(t),...Object.keys(e)]);for(const s of r){const i=t[s]??{},o=e[s]??{},a=new Set([...Object.keys(i),...Object.keys(o)]),l={};for(const u of a){const d=i[u]??o[u];d&&(l[u]=d)}Object.keys(l).length>0&&(n[s]=l)}return n}function In(t,e){return`${t}-${e}`}function Fc(t){return`external-${t}`}function ks(t,e,n){return Ie(new Fe(t,e,n))}function Se(t){return t instanceof Fe}function $_(t){return(t==null?void 0:t.type)===Fe.getType()}function Li(t){const e=t.getChildren();let n=null;for(const r of e)n===null?t.insertBefore(r):n.insertAfter(r),n=r;t.remove(),Kt.delete(t.getKey())}function df(t,e,n,r,s){const i=t.getNodes(),o=t.anchor.offset,a=t.focus.offset,l=i.length,u=t.isBackward(),d=u?a:o,f=u?o:a;let h,p;for(let y=0;y<l;y++){const k=i[y];if(se(p)&&p.isParentOf(k))continue;const C=y===0,A=y===l-1;let v=null;if(Y(k)){const O=k.getTextContentSize(),I=C?d:0,L=A?f:O;if(I===0&&L===0)continue;const q=k.splitText(I,L);v=q.length>1&&(q.length===3||C&&!A||L===O)?q[1]:q[0]}else{if(Se(k))continue;se(k)&&k.isInline()&&(v=k)}if(v!==null){if(v&&v.is(h))continue;const O=v.getParent();(O==null||!O.is(h))&&(p=void 0),h=O,p===void 0&&(p=ks(),p.addID(e,n,r,s),v.insertBefore(p)),p.append(v)}else h=void 0,p=void 0}e===dn&&se(p)&&(u?p.selectStart():p.selectEnd())}function L_(t,e,n){let r=t;for(;r!==null;){if(Se(r))return r.getTypedIDs()[e];if(Y(r)&&n===r.getTextContentSize()){const s=r.getNextSibling();if(Se(s))return s.getTypedIDs()[e]}r=r.getParent()}}const Di="unmatched",hf=1;class xn extends wr{constructor(e="",n){super(n),K(this,"__marker"),this.__marker=e}static getType(){return"unmatched"}static clone(e){const{__marker:n,__key:r}=e;return new xn(n,r)}static importDOM(){return{[Di]:e=>F_(e)?{conversion:D_,priority:1}:null}}static importJSON(e){return Cl().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker)}setMarker(e){if(this.__marker===e)return this;const n=this.getWritable();return n.__marker=e,n}getMarker(){return this.getLatest().__marker}createDOM(){const e=document.createElement(Di);e.setAttribute("data-marker",this.__marker),e.classList.add($c);const n=this.__marker.endsWith("*");return e.title=n?"This closing marker has no matching opening marker!":"This opening marker has no matching closing marker!",e}updateDOM(){return!1}exportDOM(e){const{element:n}=super.exportDOM(e);return n&&_n(n)&&(n.setAttribute("data-marker",this.getMarker()),n.classList.add($c)),{element:n}}decorate(){return`\\${this.getMarker()}${Ta}`}exportJSON(){return{type:this.getType(),marker:this.getMarker(),version:hf}}isKeyboardSelectable(){return!1}}function D_(t){const e=t.getAttribute("data-marker")??"";return{node:Cl(e)}}function Cl(t){return Ie(new xn(t))}function F_(t){return(t==null?void 0:t.tagName)===Di}function ff(t){return t instanceof xn}const q_=[ht,Qt,wt,Ge,Ce,$e,Lt,wn,Hn,vn,xn,nt,pn,{replace:Va,with:()=>bt(),withKlass:pn}];var T;(function(t){t.FileIdentification="FileIdentification",t.Headers="Headers",t.Remarks="Remarks",t.Introduction="Introduction",t.DivisionMarks="DivisionMarks",t.Paragraphs="Paragraphs",t.Poetry="Poetry",t.TitlesHeadings="TitlesHeadings",t.Tables="Tables",t.CenterTables="CenterTables",t.RightTables="RightTables",t.Lists="Lists",t.Footnotes="Footnotes",t.CrossReferences="CrossReferences",t.SpecialText="SpecialText",t.CharacterStyling="CharacterStyling",t.Breaks="Breaks",t.SpecialFeatures="SpecialFeatures",t.PeripheralReferences="PeripheralReferences",t.PeripheralMaterials="PeripheralMaterials",t.Uncategorized="Uncategorized"})(T||(T={}));var S;(function(t){t.Paragraph="Paragraph",t.Character="Character",t.Note="Note",t.Unknown="Unknown"})(S||(S={}));const U_={id:{category:T.FileIdentification,type:S.Paragraph,description:"File identification information (BOOKID, FILENAME, EDITOR, MODIFICATION DATE)",hasEndMarker:!1,children:{FileIdentification:["usfm","ide"],Headers:["h","h1","h2","h3","toc1","toc2","toc3"],Remarks:["rem","sts","restore"],Introduction:["imt","imt1","imt2","imt3","imt4","imte","imte1","imte2","is","is1","is2","iot","io","io1","io2","io3","io4","ior","ip","im","ipi","imi","ili","ili1","ili2","ipq","imq","ipr","ib","iq","iq1","iq2","iq3","iex","ie"],DivisionMarks:["c","cl"],TitlesHeadings:["mt","mt1","mt2","mt3","mt4"]}},usfm:{category:T.FileIdentification,type:S.Paragraph,description:"File markup version information",hasEndMarker:!1,children:void 0},ide:{category:T.FileIdentification,type:S.Paragraph,description:"File encoding information",hasEndMarker:!1,children:{Remarks:["rem","sts"]}},h:{category:T.Headers,type:S.Paragraph,description:"Running header text for a book (basic)",hasEndMarker:!1,children:{Headers:["toc1","toc2","toc3","toca1","toca2","toca3"]}},h1:{category:T.Headers,type:S.Paragraph,description:"Running header text",hasEndMarker:!1,children:{Headers:["toc1","toc2","toc3","toca1","toca2","toca3"]}},h2:{category:T.Headers,type:S.Paragraph,description:"Running header text, left side of page",hasEndMarker:!1,children:{Headers:["toc1","toc2","toc3","toca1","toca2","toca3"]}},h3:{category:T.Headers,type:S.Paragraph,description:"Running header text, right side of page",hasEndMarker:!1,children:{Headers:["toc1","toc2","toc3","toca1","toca2","toca3"]}},toc1:{category:T.Headers,type:S.Paragraph,description:"Long table of contents text",hasEndMarker:!1,children:void 0},toc2:{category:T.Headers,type:S.Paragraph,description:"Short table of contents text",hasEndMarker:!1,children:void 0},toc3:{category:T.Headers,type:S.Paragraph,description:"Book Abbreviation",hasEndMarker:!1,children:void 0},toca1:{category:T.Headers,type:S.Paragraph,description:"Alternative language long table of contents text",hasEndMarker:!1,children:void 0},toca2:{category:T.Headers,type:S.Paragraph,description:"Alternative language short table of contents text",hasEndMarker:!1,children:void 0},toca3:{category:T.Headers,type:S.Paragraph,description:"Alternative language book Abbreviation",hasEndMarker:!1,children:void 0},rem:{category:T.Remarks,type:S.Paragraph,description:"Comments and remarks",hasEndMarker:!1,children:void 0},sts:{category:T.Remarks,type:S.Paragraph,description:"Status of this file",hasEndMarker:!1,children:void 0},restore:{category:T.Remarks,type:S.Paragraph,description:"Project restore information",hasEndMarker:!1,children:void 0},imt:{category:T.Introduction,type:S.Paragraph,description:"Introduction major title, level 1 (if single level) (basic)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imt1:{category:T.Introduction,type:S.Paragraph,description:"Introduction major title, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imt2:{category:T.Introduction,type:S.Paragraph,description:"Introduction major title, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imt3:{category:T.Introduction,type:S.Paragraph,description:"Introduction major title, level 3",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imt4:{category:T.Introduction,type:S.Paragraph,description:"Introduction major title, level 4 (usually within parenthesis)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imte:{category:T.Introduction,type:S.Paragraph,description:"Introduction major title at introduction end, level 1 (if single level)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imte1:{category:T.Introduction,type:S.Paragraph,description:"Introduction major title at introduction end, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imte2:{category:T.Introduction,type:S.Paragraph,description:"Introduction major title at introduction end, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},is:{category:T.Introduction,type:S.Paragraph,description:"Introduction section heading, level 1 (if single level) (basic)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"],CharacterStyling:["no"]}},is1:{category:T.Introduction,type:S.Paragraph,description:"Introduction section heading, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},is2:{category:T.Introduction,type:S.Paragraph,description:"Introduction section heading, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},iot:{category:T.Introduction,type:S.Paragraph,description:"Introduction outline title (basic)",hasEndMarker:!1,children:{Introduction:["iqt"],CharacterStyling:["no"]}},io:{category:T.Introduction,type:S.Paragraph,description:"Introduction outline text, level 1 (if single level)",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},io1:{category:T.Introduction,type:S.Paragraph,description:"Introduction outline text, level 1 (if multiple levels) (basic)",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},io2:{category:T.Introduction,type:S.Paragraph,description:"Introduction outline text, level 2",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},io3:{category:T.Introduction,type:S.Paragraph,description:"Introduction outline text, level 3",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},io4:{category:T.Introduction,type:S.Paragraph,description:"Introduction outline text, level 4",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ior:{category:T.Introduction,type:S.Character,description:"Introduction references range for outline entry; for marking references separately",hasEndMarker:!0,children:void 0},ip:{category:T.Introduction,type:S.Paragraph,description:"Introduction prose paragraph (basic)",hasEndMarker:!1,children:{Introduction:["iqt"],Footnotes:["f","fe","fm"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},im:{category:T.Introduction,type:S.Paragraph,description:"Introduction prose paragraph, with no first line indent (may occur after poetry)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ipi:{category:T.Introduction,type:S.Paragraph,description:"Introduction prose paragraph, indented, with first line indent",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},imi:{category:T.Introduction,type:S.Paragraph,description:"Introduction prose paragraph text, indented, with no first line indent",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ili:{category:T.Introduction,type:S.Paragraph,description:"A list entry, level 1 (if single level)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ili1:{category:T.Introduction,type:S.Paragraph,description:"A list entry, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ili2:{category:T.Introduction,type:S.Paragraph,description:"A list entry, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ipq:{category:T.Introduction,type:S.Paragraph,description:"Introduction prose paragraph, quote from the body text",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},imq:{category:T.Introduction,type:S.Paragraph,description:"Introduction prose paragraph, quote from the body text, with no first line indent",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ipr:{category:T.Introduction,type:S.Paragraph,description:"Introduction prose paragraph, right aligned",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},ib:{category:T.Introduction,type:S.Paragraph,description:"Introduction blank line",hasEndMarker:!1,children:{Introduction:["iqt"]}},iq:{category:T.Introduction,type:S.Paragraph,description:"Introduction poetry text, level 1 (if single level)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},iq1:{category:T.Introduction,type:S.Paragraph,description:"Introduction poetry text, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},iq2:{category:T.Introduction,type:S.Paragraph,description:"Introduction poetry text, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},iq3:{category:T.Introduction,type:S.Paragraph,description:"Introduction poetry text, level 3",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},iex:{category:T.Introduction,type:S.Paragraph,description:"Introduction explanatory or bridge text (e.g. explanation of missing book in Short Old Testament)",hasEndMarker:!1,children:{Introduction:["iqt"],CharacterStyling:["no"]}},iqt:{category:T.Introduction,type:S.Character,description:"For quoted scripture text appearing in the introduction",hasEndMarker:!0,children:void 0},ie:{category:T.Introduction,type:S.Paragraph,description:"Introduction ending marker",hasEndMarker:!1,children:void 0},c:{category:T.DivisionMarks,type:S.Paragraph,description:"Chapter number",hasEndMarker:!1,children:{DivisionMarks:["ca","cp","cl","cd"],Paragraphs:["p","m","po","pr","cls","pi","pi1","pi2","pi3","pc","mi","nb"],Poetry:["q","q1","q2","q3","q4","qc","qr","qa","qd","b"],TitlesHeadings:["mte","ms","ms1","ms2","ms3","s","s1","s2","s3","s4","r","sp","d","sd","sd1","sd2","sd3","sd4"],Lists:["lh","li","li1","li2","li3","li4","lf","lim","lim1","lim2","lim3","lim4"],Footnotes:["f","fe"],SpecialText:["lit"],Breaks:["pb"]}},ca:{category:T.DivisionMarks,type:S.Character,description:"Second (alternate) chapter number (for coding dual versification; useful for places where different traditions of chapter breaks need to be supported in the same translation)",hasEndMarker:!0,children:void 0},cp:{category:T.DivisionMarks,type:S.Paragraph,description:"Published chapter number (chapter string that should appear in the published text)",hasEndMarker:!1,children:{Footnotes:["f"]}},cl:{category:T.DivisionMarks,type:S.Paragraph,description:"Chapter label used for translations that add a word such as 'Chapter' before chapter numbers (e.g. Psalms). The subsequent text is the chapter label.",hasEndMarker:!1,children:void 0},cd:{category:T.DivisionMarks,type:S.Paragraph,description:"Chapter Description (Publishing option D, e.g. in Russian Bibles)",hasEndMarker:!1,children:{DivisionMarks:["vp"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},v:{category:T.DivisionMarks,type:S.Character,description:"A verse number",hasEndMarker:!1,children:void 0},va:{category:T.DivisionMarks,type:S.Character,description:"Second (alternate) verse number (for coding dual numeration in Psalms; see also NRSV Exo 22.1-4)",hasEndMarker:!0,children:void 0},vp:{category:T.DivisionMarks,type:S.Character,description:"Published verse marker (verse string that should appear in the published text)",hasEndMarker:!0,children:void 0},p:{category:T.Paragraphs,type:S.Paragraph,description:"Paragraph text, with first line indent (basic)",hasEndMarker:!1,children:{Paragraphs:["pmo","pm","pmc","pmr"],Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},m:{category:T.Paragraphs,type:S.Paragraph,description:"Paragraph text, with no first line indent (may occur after poetry) (basic)",hasEndMarker:!1,children:{Paragraphs:["pmo","pm","pmc","pmr"],Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},po:{category:T.Paragraphs,type:S.Paragraph,description:"Letter opening",hasEndMarker:!1,children:{Paragraphs:["pmo","pm","pmc","pmr"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pr:{category:T.Paragraphs,type:S.Paragraph,description:"Text refrain (paragraph text, right aligned)",hasEndMarker:!1,children:{Paragraphs:["pmo","pm","pmc","pmr"],Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},cls:{category:T.Paragraphs,type:S.Paragraph,description:"Letter Closing",hasEndMarker:!1,children:{SpecialText:["tl","sig","pn","png","addpn","add"]}},pmo:{category:T.Paragraphs,type:S.Paragraph,description:"Embedded text opening",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pm:{category:T.Paragraphs,type:S.Paragraph,description:"Embedded text paragraph",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pmc:{category:T.Paragraphs,type:S.Paragraph,description:"Embedded text closing",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pmr:{category:T.Paragraphs,type:S.Paragraph,description:"Embedded text refrain (e.g. Then all the people shall say, 'Amen!')",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pi:{category:T.Paragraphs,type:S.Paragraph,description:"Paragraph text, level 1 indent (if single level), with first line indent; often used for discourse (basic)",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pi1:{category:T.Paragraphs,type:S.Paragraph,description:"Paragraph text, level 1 indent (if multiple levels), with first line indent; often used for discourse",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pi2:{category:T.Paragraphs,type:S.Paragraph,description:"Paragraph text, level 2 indent, with first line indent; often used for discourse",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pi3:{category:T.Paragraphs,type:S.Paragraph,description:"Paragraph text, level 3 indent, with first line indent; often used for discourse",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pc:{category:T.Paragraphs,type:S.Paragraph,description:"Paragraph text, centered (for Inscription)",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},mi:{category:T.Paragraphs,type:S.Paragraph,description:"Paragraph text, indented, with no first line indent; often used for discourse",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},nb:{category:T.Paragraphs,type:S.Paragraph,description:"Paragraph text, with no break from previous paragraph text (at chapter boundary) (basic)",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q:{category:T.Poetry,type:S.Paragraph,description:"Poetry text, level 1 indent (if single level)",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q1:{category:T.Poetry,type:S.Paragraph,description:"Poetry text, level 1 indent (if multiple levels) (basic)",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q2:{category:T.Poetry,type:S.Paragraph,description:"Poetry text, level 2 indent (basic)",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q3:{category:T.Poetry,type:S.Paragraph,description:"Poetry text, level 3 indent",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q4:{category:T.Poetry,type:S.Paragraph,description:"Poetry text, level 4 indent",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qc:{category:T.Poetry,type:S.Paragraph,description:"Poetry text, centered",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qr:{category:T.Poetry,type:S.Paragraph,description:"Poetry text, Right Aligned",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qs:{category:T.Poetry,type:S.Character,description:"Poetry text, Selah",hasEndMarker:!0,children:{Footnotes:["f"],CrossReferences:["x"]}},qa:{category:T.Poetry,type:S.Paragraph,description:"Poetry text, Acrostic marker/heading",hasEndMarker:!1,children:void 0},qac:{category:T.Poetry,type:S.Character,description:"Poetry text, Acrostic markup of the first character of a line of acrostic poetry",hasEndMarker:!0,children:void 0},qm:{category:T.Poetry,type:S.Paragraph,description:"Poetry text, embedded, level 1 indent (if single level)",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qm1:{category:T.Poetry,type:S.Paragraph,description:"Poetry text, embedded, level 1 indent (if multiple levels)",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qm2:{category:T.Poetry,type:S.Paragraph,description:"Poetry text, embedded, level 2 indent",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qm3:{category:T.Poetry,type:S.Paragraph,description:"Poetry text, embedded, level 3 indent",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qd:{category:T.Poetry,type:S.Paragraph,description:"A Hebrew musical performance annotation, similar in content to Hebrew descriptive title.",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},b:{category:T.Poetry,type:S.Paragraph,description:"Poetry text stanza break (e.g. stanza break) (basic)",hasEndMarker:!1,children:void 0},mt:{category:T.TitlesHeadings,type:S.Paragraph,description:"The main title of the book (if single level)",hasEndMarker:!1,children:{Footnotes:["f"],CrossReferences:["x"]}},mt1:{category:T.TitlesHeadings,type:S.Paragraph,description:"The main title of the book (if multiple levels) (basic)",hasEndMarker:!1,children:{Footnotes:["f"],CrossReferences:["x"]}},mt2:{category:T.TitlesHeadings,type:S.Paragraph,description:"A secondary title usually occurring before the main title (basic)",hasEndMarker:!1,children:{Footnotes:["f"],CrossReferences:["x"]}},mt3:{category:T.TitlesHeadings,type:S.Paragraph,description:"A secondary title occurring after the main title",hasEndMarker:!1,children:{Footnotes:["f"],CrossReferences:["x"]}},mt4:{category:T.TitlesHeadings,type:S.Paragraph,description:"A small secondary title sometimes occurring within parentheses",hasEndMarker:!1,children:void 0},mte:{category:T.TitlesHeadings,type:S.Paragraph,description:"The main title of the book repeated at the end of the book, level 1 (if single level)",hasEndMarker:!1,children:void 0},mte1:{category:T.TitlesHeadings,type:S.Paragraph,description:"The main title of the book repeated at the end of the book, level 1 (if multiple levels)",hasEndMarker:!1,children:{TitlesHeadings:["mte2"]}},mte2:{category:T.TitlesHeadings,type:S.Paragraph,description:"A secondary title occurring before or after the 'ending' main title",hasEndMarker:!1,children:void 0},ms:{category:T.TitlesHeadings,type:S.Paragraph,description:"A major section division heading, level 1 (if single level) (basic)",hasEndMarker:!1,children:{TitlesHeadings:["mr"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},ms1:{category:T.TitlesHeadings,type:S.Paragraph,description:"A major section division heading, level 1 (if multiple levels)",hasEndMarker:!1,children:{TitlesHeadings:["mr"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},ms2:{category:T.TitlesHeadings,type:S.Paragraph,description:"A major section division heading, level 2",hasEndMarker:!1,children:{TitlesHeadings:["mr"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},ms3:{category:T.TitlesHeadings,type:S.Paragraph,description:"A major section division heading, level 3",hasEndMarker:!1,children:{TitlesHeadings:["mr"],Footnotes:["f","fe"]}},mr:{category:T.TitlesHeadings,type:S.Paragraph,description:"A major section division references range heading (basic)",hasEndMarker:!1,children:void 0},s:{category:T.TitlesHeadings,type:S.Paragraph,description:"A section heading, level 1 (if single level) (basic)",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},s1:{category:T.TitlesHeadings,type:S.Paragraph,description:"A section heading, level 1 (if multiple levels)",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},s2:{category:T.TitlesHeadings,type:S.Paragraph,description:"A section heading, level 2 (e.g. Proverbs 22-24)",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},s3:{category:T.TitlesHeadings,type:S.Paragraph,description:"A section heading, level 3 (e.g. Genesis 'The First Day')",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},s4:{category:T.TitlesHeadings,type:S.Paragraph,description:"A section heading, level 4",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},sr:{category:T.TitlesHeadings,type:S.Paragraph,description:"A section division references range heading",hasEndMarker:!1,children:void 0},r:{category:T.TitlesHeadings,type:S.Paragraph,description:"Parallel reference(s) (basic)",hasEndMarker:!1,children:void 0},sp:{category:T.TitlesHeadings,type:S.Paragraph,description:"A heading, to identify the speaker (e.g. Job)",hasEndMarker:!1,children:{Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},d:{category:T.TitlesHeadings,type:S.Paragraph,description:"A Hebrew text heading, to provide description (e.g. Psalms)",hasEndMarker:!1,children:{Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},sd:{category:T.TitlesHeadings,type:S.Paragraph,description:"Vertical space used to divide the text into sections, level 1 (if single level)",hasEndMarker:!1,children:void 0},sd1:{category:T.TitlesHeadings,type:S.Paragraph,description:"Vertical space used to divide the text into sections, level 1 (if multiple levels)",hasEndMarker:!1,children:void 0},sd2:{category:T.TitlesHeadings,type:S.Paragraph,description:"Vertical space used to divide the text into sections, level 2",hasEndMarker:!1,children:void 0},sd3:{category:T.TitlesHeadings,type:S.Paragraph,description:"Vertical space used to divide the text into sections, level 3",hasEndMarker:!1,children:void 0},sd4:{category:T.TitlesHeadings,type:S.Paragraph,description:"Vertical space used to divide the text into sections, level 4",hasEndMarker:!1,children:void 0},lh:{category:T.Lists,type:S.Paragraph,description:"List header (introductory remark)",hasEndMarker:!1,children:{Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li:{category:T.Lists,type:S.Paragraph,description:"A list entry, level 1 (if single level)",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li1:{category:T.Lists,type:S.Paragraph,description:"A list entry, level 1 (if multiple levels)",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li2:{category:T.Lists,type:S.Paragraph,description:"A list entry, level 2",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li3:{category:T.Lists,type:S.Paragraph,description:"A list entry, level 3",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li4:{category:T.Lists,type:S.Paragraph,description:"A list entry, level 4",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lf:{category:T.Lists,type:S.Paragraph,description:"List footer (concluding remark)",hasEndMarker:!1,children:{Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim:{category:T.Lists,type:S.Paragraph,description:"An embedded list entry, level 1 (if single level)",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim1:{category:T.Lists,type:S.Paragraph,description:"An embedded list entry, level 1 (if multiple levels)",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim2:{category:T.Lists,type:S.Paragraph,description:"An embedded list entry, level 2",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim3:{category:T.Lists,type:S.Paragraph,description:"An embedded list item, level 3",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim4:{category:T.Lists,type:S.Paragraph,description:"An embedded list entry, level 4",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},litl:{category:T.Lists,type:S.Character,description:"List entry total text",hasEndMarker:!0,children:void 0},lik:{category:T.Lists,type:S.Character,description:"Structured list entry key text",hasEndMarker:!0,children:void 0},liv:{category:T.Lists,type:S.Character,description:"Structured list entry value 1 content (if single value)",hasEndMarker:!0,children:void 0},liv1:{category:T.Lists,type:S.Character,description:"Structured list entry value 1 content (if multiple values)",hasEndMarker:!0,children:void 0},liv2:{category:T.Lists,type:S.Character,description:"Structured list entry value 2 content",hasEndMarker:!0,children:void 0},liv3:{category:T.Lists,type:S.Character,description:"Structured list entry value 3 content",hasEndMarker:!0,children:void 0},liv4:{category:T.Lists,type:S.Character,description:"Structured list entry value 4 content",hasEndMarker:!0,children:void 0},liv5:{category:T.Lists,type:S.Character,description:"Structured list entry value 5 content",hasEndMarker:!0,children:void 0},f:{category:T.Footnotes,type:S.Note,description:"A Footnote text item (basic)",hasEndMarker:!0,children:{Footnotes:["fr","ft","fk","fq","fqa","fl","fw","fp","fv","fdc"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},fe:{category:T.Footnotes,type:S.Note,description:"An Endnote text item",hasEndMarker:!0,children:{Footnotes:["fr","ft","fk","fq","fqa","fl","fw","fp","fv","fdc"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},fr:{category:T.Footnotes,type:S.Character,description:"The origin reference for the footnote (basic)",hasEndMarker:!0,children:void 0},ft:{category:T.Footnotes,type:S.Character,description:"Footnote text, Protocanon (basic)",hasEndMarker:!0,children:void 0},fk:{category:T.Footnotes,type:S.Character,description:"A footnote keyword (basic)",hasEndMarker:!0,children:void 0},fq:{category:T.Footnotes,type:S.Character,description:"A footnote scripture quote or alternate rendering (basic)",hasEndMarker:!0,children:void 0},fqa:{category:T.Footnotes,type:S.Character,description:"A footnote alternate rendering for a portion of scripture text",hasEndMarker:!0,children:void 0},fl:{category:T.Footnotes,type:S.Character,description:"A footnote label text item, for marking or 'labelling' the type or alternate translation being provided in the note.",hasEndMarker:!0,children:void 0},fw:{category:T.Footnotes,type:S.Character,description:"A footnote witness list, for distinguishing a list of sigla representing witnesses in critical editions.",hasEndMarker:!0,children:void 0},fp:{category:T.Footnotes,type:S.Character,description:"A Footnote additional paragraph marker",hasEndMarker:!0,children:void 0},fv:{category:T.Footnotes,type:S.Character,description:"A verse number within the footnote text",hasEndMarker:!0,children:void 0},fdc:{category:T.Footnotes,type:S.Character,description:"Footnote text, applies to Deuterocanon only",hasEndMarker:!0,children:void 0},fm:{category:T.Footnotes,type:S.Character,description:"An additional footnote marker location for a previous footnote",hasEndMarker:!0,children:void 0},x:{category:T.CrossReferences,type:S.Note,description:"A list of cross references (basic)",hasEndMarker:!0,children:{CrossReferences:["xo","xop","xt","xta","xk","xq","xot","xnt","xdc"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},xo:{category:T.CrossReferences,type:S.Character,description:"The cross reference origin reference (basic)",hasEndMarker:!0,children:void 0},xop:{category:T.CrossReferences,type:S.Character,description:"Published cross reference origin reference (origin reference that should appear in the published text)",hasEndMarker:!0,children:void 0},xt:{category:T.CrossReferences,type:S.Character,description:"The cross reference target reference(s), protocanon only (basic)",hasEndMarker:!0,children:void 0},xta:{category:T.CrossReferences,type:S.Character,description:"Cross reference target references added text",hasEndMarker:!0,children:void 0},xk:{category:T.CrossReferences,type:S.Character,description:"A cross reference keyword",hasEndMarker:!0,children:void 0},xq:{category:T.CrossReferences,type:S.Character,description:"A cross-reference quotation from the scripture text",hasEndMarker:!0,children:void 0},xot:{category:T.CrossReferences,type:S.Character,description:"Cross-reference target reference(s), Old Testament only",hasEndMarker:!0,children:void 0},xnt:{category:T.CrossReferences,type:S.Character,description:"Cross-reference target reference(s), New Testament only",hasEndMarker:!0,children:void 0},xdc:{category:T.CrossReferences,type:S.Character,description:"Cross-reference target reference(s), Deuterocanon only",hasEndMarker:!0,children:void 0},rq:{category:T.CrossReferences,type:S.Character,description:"A cross-reference indicating the source text for the preceding quotation.",hasEndMarker:!0,children:void 0},qt:{category:T.SpecialText,type:S.Character,description:"For Old Testament quoted text appearing in the New Testament (basic)",hasEndMarker:!0,children:void 0},nd:{category:T.SpecialText,type:S.Character,description:"For name of deity (basic)",hasEndMarker:!0,children:void 0},tl:{category:T.SpecialText,type:S.Character,description:"For transliterated words",hasEndMarker:!0,children:void 0},dc:{category:T.SpecialText,type:S.Character,description:"Deuterocanonical/LXX additions or insertions in the Protocanonical text",hasEndMarker:!0,children:void 0},bk:{category:T.SpecialText,type:S.Character,description:"For the quoted name of a book",hasEndMarker:!0,children:void 0},sig:{category:T.SpecialText,type:S.Character,description:"For the signature of the author of an Epistle",hasEndMarker:!0,children:void 0},pn:{category:T.SpecialText,type:S.Character,description:"For a proper name",hasEndMarker:!0,children:void 0},png:{category:T.SpecialText,type:S.Character,description:"For a geographic proper name",hasEndMarker:!0,children:void 0},addpn:{category:T.SpecialText,type:S.Character,description:"For chinese words to be dot underline & underline",hasEndMarker:!0,children:void 0},wj:{category:T.SpecialText,type:S.Character,description:"For marking the words of Jesus",hasEndMarker:!0,children:void 0},k:{category:T.SpecialText,type:S.Character,description:"For a keyword",hasEndMarker:!0,children:void 0},sls:{category:T.SpecialText,type:S.Character,description:"To represent where the original text is in a secondary language or from an alternate text source",hasEndMarker:!0,children:void 0},ord:{category:T.SpecialText,type:S.Character,description:"For the text portion of an ordinal number",hasEndMarker:!0,children:void 0},add:{category:T.SpecialText,type:S.Character,description:"For a translational addition to the text",hasEndMarker:!0,children:void 0},lit:{category:T.SpecialText,type:S.Paragraph,description:"For a comment or note inserted for liturgical use",hasEndMarker:!1,children:void 0},no:{category:T.CharacterStyling,type:S.Character,description:"A character style, use normal text",hasEndMarker:!0,children:void 0},it:{category:T.CharacterStyling,type:S.Character,description:"A character style, use italic text",hasEndMarker:!0,children:void 0},bd:{category:T.CharacterStyling,type:S.Character,description:"A character style, use bold text",hasEndMarker:!0,children:void 0},bdit:{category:T.CharacterStyling,type:S.Character,description:"A character style, use bold + italic text",hasEndMarker:!0,children:void 0},em:{category:T.CharacterStyling,type:S.Character,description:"A character style, use emphasized text style",hasEndMarker:!0,children:void 0},sc:{category:T.CharacterStyling,type:S.Character,description:"A character style, for small capitalization text",hasEndMarker:!0,children:void 0},sup:{category:T.CharacterStyling,type:S.Character,description:"A character style, for superscript text. Typically for use in critical edition footnotes.",hasEndMarker:!0,children:void 0},pb:{category:T.Breaks,type:S.Paragraph,description:"Page Break used for new reader portions and children's bibles where content is controlled by the page",hasEndMarker:!1,children:void 0}},Rn={DivisionMarks:{add:["v","c"],remove:[]},Paragraphs:{add:["p"],remove:[]},Poetry:{add:["q","q1","q2","q3","q4","b"],remove:[]},TitlesHeadings:{add:["mte","ms","ms1","ms2","ms3","s","s1","s2","s3","s4","r","sp","d","sd","sd1","sd2","sd3","sd4"],remove:[]}},B_={p:{children:Rn},q:{children:Rn},q1:{children:Rn},q2:{children:Rn},q3:{children:Rn},q4:{children:Rn},b:{children:Rn},qm:{children:{Paragraphs:{add:["p"],remove:[]}}},c:{type:S.Paragraph,children:null},v:{children:null}};function qc(t){const e=U_[t],n=B_[t];if(!e)return;if(!n)return e;let r=e.children?{...e.children}:void 0;if(n.children===null&&(r=void 0),n.children){r=r||{};for(const[s,i]of Object.entries(n.children)){const o=s;if(i===null)Reflect.deleteProperty(r,o);else{let a=r[o]||[];i.remove&&(a=a.filter(l=>!i.remove.includes(l))),i.add&&(a=[...new Set([...a,...i.add])]),a.length>0?r[o]=a:Reflect.deleteProperty(r,o)}}Object.keys(r).length===0&&(r=void 0)}return{...e,...n,children:r}}function Uc(t,e,n){const r={type:us,version:ds,content:t},s=e.serializeEditorState(r,n);return gl(s.root.children[0])?s.root.children[0].children[0]:s.root.children[0]}const H_=["style"],W_=["style","code"],Fi=["style","cid"],K_=["style","number","sid","altnumber","pubnumber"],J_=["style","number","sid","altnumber","pubnumber"],z_=["style","sid","eid"],V_=["style","caller","category","contents"],G_=["tag","marker","contents"],Y_=["chapter","immutable-chapter","verse","immutable-verse","ms","note","unknown","unmatched"],vs=`
`;function X_(t,e){const n=Ee(t);if(!kt(n))return;const r=pf(n);return r===void 0?void 0:[{retain:r},...e,{delete:1}]}function pf(t){if(!t)return;const e=vr();let n=0;const r=[],s=[],i=t.getKey();let o;for(const a of e){const l=a.node;for(let d=r.length-1;d>=0;d--)if(br(r[d],a)){const f=r[d];if(r.splice(d,1),n+=1,o&&f.getKey()===o.getKey())return n-1}for(let d=s.length-1;d>=0;d--)br(s[d].node,a)&&s.splice(d,1);const u=s[s.length-1];if(u){if(l.getKey()===i)return u.position;continue}if(l.getKey()===i){if(Y(l)||kt(l))return n;it(l)&&(o=l)}if(it(l)&&(r.includes(l)||r.push(l)),ae(l)||Zt(l)){if(l.getKey()===i)return n;s.push({node:l,position:n}),n+=1;continue}n+=gf(l)}if(o)return n}function Bc(t,e){if(t.length<2||!ek(t[0])||!Q_(t[1]))return;const n=t[0].retain;return e.read(()=>{const r=Z_(n);return r==null?void 0:r.getKey()})}function Z_(t){const e=vr();let n=0;const r=[],s=[];for(const i of e){const o=i.node;for(let u=r.length-1;u>=0;u--)if(br(r[u],i)){const d=r[u];if(r.splice(u,1),n===t)return d;n+=1}for(let u=s.length-1;u>=0;u--)br(s[u].node,i)&&s.splice(u,1);const a=s[s.length-1];if(a){if(a.position===t)return a.node;continue}if(it(o)&&(r.includes(o)||r.push(o)),ae(o)||Zt(o)){if(n===t)return o;s.push({node:o,position:n}),n+=1;continue}const l=gf(o);if(Y(o)&&l>0&&t>=n&&t<n+l||kt(o)&&n===t)return o;n+=l}for(const i of r){if(n===t)return i;n+=1}}function br(t,e){return t?e?!w_(e.node,t.getKey()):!0:!1}function kt(t){return ut(t)||dt(t)||eo(t)||ae(t)||Zt(t)||ff(t)}function it(t){return yt(t)||Pt(t)}function et(t,e){return(e==null?void 0:e.insert)!=null&&typeof e.insert=="object"&&t in e.insert}function Q_(t){if(t.insert==null||typeof t.insert!="object")return!1;const e=Object.keys(t.insert)[0];return t.insert!=null&&typeof t.insert=="object"&&e in t.insert&&Y_.includes(e)}function ek(t){return t.retain!=null&&typeof t.retain=="number"}function gf(t){return Y(t)?t.getTextContentSize():kt(t)?1:0}function Sl(t){const{start:e}=t;let{end:n}=t;n??(n=e);let[r,s]=Hc(e),[i,o]=Hc(n);if(!r||!i||s===void 0||o===void 0)return;[r,s]=Wc(r,s),[i,o]=Wc(i,o);const a=wd();return a.anchor=Hl(r.getKey(),s,Kc(r)),a.focus=Hl(i.getKey(),o,Kc(i)),a}function mf(){const t=re();if(!t||!Z(t))return;const e=t.isBackward()?t.focus.getNode():t.anchor.getNode(),n=t.isBackward()?t.focus.offset:t.anchor.offset,r=Jc(e,n);if(t.isCollapsed())return{start:r};const s=t.isBackward()?t.anchor.getNode():t.focus.getNode(),i=t.isBackward()?t.anchor.offset:t.focus.offset,o=Jc(s,i);return{start:r,end:o}}function Hc(t){if(op(t)){const e=ad(t.jsonPath);let n=vt();for(const r of e){if(!n||!se(n))return[void 0,void 0];n=yf(n,r)}if(n&&Se(n)&&(n=n.getFirstChild()??void 0),n&&se(n)){const r=tk(n,t.offset);return[n,r]}return Ra(n,t.offset)}if(ap(t)||lp(t)){const e=Gr(t.jsonPath);if(!e)return[void 0,void 0];if(se(e)){const r=e.getLastChild();if(r&&Y(r))return[r,r.getTextContent().length]}const n=e.getNextSibling();return n&&se(n)?[n,0]:[void 0,void 0]}if(cp(t)){const e=Gr(t.jsonPath);if(!e)return[void 0,void 0];if(se(e)){const r=e.getLastChild();if(r&&Y(r))return[r,r.getTextContent().length]}const n=e.getNextSibling();return n&&se(n)?[n,0]:[void 0,void 0]}if(up(t)){const e=Gr(t.jsonPath);if(!e||!se(e))return[void 0,void 0];const n=la(e,"opening");if(n)return[n,0];const r=e.getFirstChild();return r&&Y(r)?[r,0]:[void 0,void 0]}if(dp(t)){const e=Gr(t.jsonPath);if(!e||!se(e))return[void 0,void 0];const n=la(e,"closing");if(n){const s=n.getTextContent(),i=Math.min(t.closingMarkerOffset,s.length);return[n,i]}const r=e.getLastChild();return r&&Y(r)?[r,r.getTextContent().length]:[void 0,void 0]}if(hp(t)){const e=t.jsonPath.match(/\.(\w+)$|^\$\.(\w+)$|\['([^']+)'\]$/),n=(e==null?void 0:e[1])??(e==null?void 0:e[2])??(e==null?void 0:e[3]),r=Gr(t.jsonPath);if(!r||!se(r))return[void 0,void 0];if(n==="marker"){const i=la(r,"opening");if(i){const o=t.propertyOffset+1,a=i.getTextContent();return[i,Math.min(o,a.length)]}}const s=r.getFirstChild();return s&&Y(s)?[s,0]:[void 0,void 0]}throw new Error(`Unsupported UsjDocumentLocation type: ${fp(t)}. All UsjDocumentLocation subtypes should be supported: UsjMarkerLocation, UsjClosingMarkerLocation, UsjTextContentLocation, UsjPropertyValueLocation, UsjAttributeKeyLocation, UsjAttributeMarkerLocation, andUsjClosingAttributeMarkerLocation. Received: ${JSON.stringify(t)}`)}function tk(t,e){const n=t.getChildren();let r=0;for(let s=0;s<=n.length;s++){if(r===e)return s;if(s>=n.length)break;Es(n[s])||(r+=1)}return n.length}function Wc(t,e){if(!Or(t))return[t,e];const n=t.getTextContent().length;if(e<0||e>=n)return[t,e];const r=t.getParent();if(!r||!se(r))return[t,e];const s=t.getIndexWithinParent();return s<0?[t,e]:[r,s]}function Kc(t){return se(t)?"element":"text"}function Ra(t,e){if(!t||!Y(t))return[void 0,void 0];const n=t.getTextContent();if(e>=0&&e<n.length)return[t,e];let r=t.getNextSibling();if(!r){const i=t.getParent();Se(i)&&(r=i.getNextSibling())}if(!r||!Se(r)&&!Y(r))return e===n.length?[t,e]:[void 0,void 0];const s=e-n.length;return r&&Y(r)?Ra(r,s):Ra(r.getFirstChild()??void 0,s)}function la(t,e){const n=t.getChildren();for(const r of n){if(Dt(r)&&r.getMarkerSyntax()===e||e==="closing"&&Dt(r)&&r.getMarkerSyntax()==="selfClosing")return r;if(Or(r)){const s=r.getTextContent().endsWith("*");if(e==="opening"&&!s||e==="closing"&&s)return r}}}function Gr(t){const e=new RegExp(/^(\$(?:\.content\[\d+\])*)(?:\.|$|\[)/).exec(t),n=e?e[1]:t,r=ad(n);let s=vt();for(const i of r){if(!s||!se(s))return;s=yf(s,i)}return s}function yf(t,e){const n=t.getChildren();let r=0;for(const s of n)if(!Es(s)){if(r===e)return s;r+=1}}function Jc(t,e){if(Dt(t)){const n=t.getMarkerSyntax(),r=nk(t),s=r?Vr(Yr(r)):Vr(Yr(t));if(n==="closing"||n==="selfClosing")return{jsonPath:s,closingMarkerOffset:e};if(e===0)return{jsonPath:s};const i=`${s}.marker`,o=Math.max(0,e-1);return{jsonPath:i,propertyOffset:o}}if(se(t)){const n=t.getChildAtIndex(e);if(Or(n))return{jsonPath:Vr(Yr(t))};const r=ik(t,e);return{jsonPath:Vr(Yr(t)),offset:r}}return{jsonPath:Vr(Yr(t)),offset:e}}function nk(t){const e=t.getParent();if(!e||!se(e))return;const n=rk(t);return n&&!it(n)&&!Y(n)?n:e}function rk(t){let e=t.getPreviousSibling();for(;e;){if(!Es(e))return e;e=e.getPreviousSibling()}}function Yr(t){const e=[];let n=t;for(;n!=null&&n.getParent();){const r=n.getParent();if(r){const s=sk(r,n);s>=0&&e.unshift(s)}n=r}return e}function sk(t,e){const n=t.getChildren();let r=0;for(const s of n){if(Es(s)){if(s===e)return-1;continue}if(s===e)return r;r+=1}return-1}function ik(t,e){const n=t.getChildren();let r=0;for(let s=0;s<e&&s<n.length;s++)Es(n[s])||r++;return r}function Es(t){if(!t)return!1;if(tg(t)||Dt(t)||Or(t))return!0;if(Y(t)){const e=xr(t,Rb);if(e==="marker-trailing-space"||e==="attribute")return!0}return!1}const bf="v",_f=1;class Ye extends wr{constructor(e="",n=!1,r,s,i,o,a){super(a),K(this,"__marker"),K(this,"__number"),K(this,"__showMarker"),K(this,"__sid"),K(this,"__altnumber"),K(this,"__pubnumber"),K(this,"__unknownAttributes"),this.__marker=bf,this.__number=e,this.__showMarker=n,this.__sid=r,this.__altnumber=s,this.__pubnumber=i,this.__unknownAttributes=o}static getType(){return"immutable-verse"}static clone(e){const{__number:n,__showMarker:r,__sid:s,__altnumber:i,__pubnumber:o,__unknownAttributes:a,__key:l}=e;return new Ye(n,r,s,i,o,a,l)}static importDOM(){return{span:e=>ak(e)?{conversion:ok,priority:1}:null}}static importJSON(e){return Tl().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setNumber(e.number).setShowMarker(e.showMarker).setSid(e.sid).setAltnumber(e.altnumber).setPubnumber(e.pubnumber).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const n=this.getWritable();return n.__marker=e,n}getMarker(){return this.getLatest().__marker}setNumber(e){if(this.__number===e)return this;const n=this.getWritable();return n.__number=e,n}getNumber(){return this.getLatest().__number}setShowMarker(e=!1){if(this.__showMarker===e)return this;const n=this.getWritable();return n.__showMarker=e,n}getShowMarker(){return this.getLatest().__showMarker}setSid(e){if(this.__sid===e)return this;const n=this.getWritable();return n.__sid=e,n}getSid(){return this.getLatest().__sid}setAltnumber(e){if(this.__altnumber===e)return this;const n=this.getWritable();return n.__altnumber=e,n}getAltnumber(){return this.getLatest().__altnumber}setPubnumber(e){if(this.__pubnumber===e)return this;const n=this.getWritable();return n.__pubnumber=e,n}getPubnumber(){return this.getLatest().__pubnumber}setUnknownAttributes(e){const n=this.getWritable();return n.__unknownAttributes=e,n}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("span");return e.setAttribute("data-marker",this.__marker),e.classList.add(Ea,`usfm_${this.__marker}`),this.__showMarker&&e.classList.add("marker"),e.setAttribute("data-number",this.__number),e}updateDOM(){return!1}exportDOM(e){const{element:n}=super.exportDOM(e);return n&&_n(n)&&(n.setAttribute("data-marker",this.getMarker()),n.classList.add(Ea,`usfm_${this.getMarker()}`),n.setAttribute("data-number",this.getNumber())),{element:n}}decorate(){return m.jsx("span",{children:this.getShowMarker()?Ts(this.getMarker(),this.getNumber()):Ta+this.getNumber()+Ta})}exportJSON(){return{type:this.getType(),marker:this.getMarker(),number:this.getNumber(),showMarker:this.getShowMarker(),sid:this.getSid(),altnumber:this.getAltnumber(),pubnumber:this.getPubnumber(),unknownAttributes:this.getUnknownAttributes(),version:_f}}isKeyboardSelectable(){return!1}}function ok(t){const e=t.getAttribute("data-number")??"0";return{node:Tl(e)}}function Tl(t,e,n,r,s,i){return Ie(new Ye(t,e,n,r,s,i))}function ak(t){return((t==null?void 0:t.getAttribute("data-marker"))??void 0)===bf}function Mr(t){return t instanceof Ye}function lk(t){return(t==null?void 0:t.type)===Ye.getType()}function dt(t){return bl(t)||Mr(t)}function ck(t){return g_(t)||lk(t)}function uk(t,e,n,r,s,i,o){if(!$e.isValidMarker(t))throw new Error(`$insertNote: Invalid note marker '${t}'`);const a=n?Sl(n):re();if(!Z(a))return;const l=dk(a,t,r,o);if(l===void 0)return;const u=vf(t,e,l,s,i);return kf(u,a,s),u}function kf(t,e,n){const r=(n==null?void 0:n.noteMode)==="collapsed";if(t.setIsCollapsed(r),e.isCollapsed()||C_(e),e.insertNodes([t]),!r){const s=t.getChildren().reverse().find(ge);s==null||s.selectEnd()}}function dk(t,e,n,r){const s=[],{chapterNum:i,verseNum:o}=n??{};switch(e){case"f":case"fe":case"ef":case"efe":if(i!==void 0&&o!==void 0&&s.push(gt("fr").append(_e(`${i}:${o} `))),!t.isCollapsed()){const a=t.getTextContent().trim();if(a.length>0){const l=gt("fq").append(_e(a));s.push(l)}}s.push(gt("ft").append(_e(Gt)));break;case"x":case"ex":if(i!==void 0&&o!==void 0&&s.push(gt("xo").append(_e(`${i}:${o} `))),!t.isCollapsed()){const a=t.getTextContent().trim();if(a.length>0){const l=gt("xq").append(_e(a));s.push(l)}}s.push(gt("xt").append(_e(Gt)));break;default:r==null||r.warn(`$createNoteChildren: Unsupported note marker '${e}'`);return}return s}function vf(t,e,n,r,s,i){const o=(r==null?void 0:r.noteMode)!=="expanded",a=yl(t,e,o);i&&At(a,fn,()=>i);let l,u;(r==null?void 0:r.markerMode)==="editable"?(l=yr(t),u=yr(t,"closing")):(r==null?void 0:r.markerMode)==="visible"&&(l=pr("marker",en(t)+ke),u=pr("marker",mr(t)+ke));let d;if(l&&a.append(l),(r==null?void 0:r.markerMode)==="editable")e===""?a.append(...n):(d=_e(vl(a.__caller)),a.append(d,...n));else{const f=()=>_e(ke),h=n.flatMap(fk(f));if(e==="")a.append(...h);else{const p=wl(n);let y=()=>{};s!=null&&s.noteCallerOnClick&&(y=s.noteCallerOnClick),d=Al(a.__caller,p,y),a.append(d,f(),...h)}}return u&&a.append(u),a}function zc(t){var e;if(typeof t=="string"){const s=Ee(t);return ae(s)?s:void 0}const n=vr();if(n.length<=0)return;const r=(e=n.filter(s=>ae(s.node))[t])==null?void 0:e.node;if(ae(r))return r}function hk(t,e){const n=(e==null?void 0:e.noteMode)==="collapsed";if(t.setIsCollapsed(n),n){const r=t.getPreviousSibling();if(Mr(r)||!r){const s=t.getParent();if(s){const i=t.getIndexWithinParent();s.select(i,i)}}else r.selectEnd()}else{const r=t.getChildren().reverse().find(ge);r==null||r.selectEnd()}}function fk(t){return e=>Ii(e)?[e]:[e,t()]}function pk(t){return t.find(e=>Je(e))}function gk(t,e){return se(t)?t.getChildren().find(n=>dt(n)&&xl(e,n.getNumber())):void 0}function mk(t,e){return e===0?pk(t):t.map(n=>gk(n,e)).filter(n=>n)[0]}function Vc(t){return!t||!se(t)?void 0:t.getChildren().findLast(e=>dt(e))}function wf(t){var e,n;if(!t||ut(t))return;if(dt(t))return t;let r=Se(t.getParent())?(e=t.getParent())==null?void 0:e.getPreviousSibling():t.getPreviousSibling();for(;r&&!dt(r)&&!ut(r);)r=r.getPreviousSibling();if(r&&dt(r))return r;let s=(n=t.getTopLevelElement())==null?void 0:n.getPreviousSibling(),i=Vc(s),o=i;for(;s&&!i&&!ut(s);)i=o,s=s.getPreviousSibling(),o=Vc(s);if(!(!i&&ut(s)))return i}function yk(t){return __(t)||Mr(t)}function El(t){if(Y(t)){const e=t.getTextContent();!e.endsWith(" ")&&!e.endsWith(ke)&&t.setTextContent(`${e} `)}}function xf(t){if(Y(t)){const e=t.getTextContent();e.startsWith(" ")&&t.setTextContent(e.trimStart())}}function Ol(t,e){return t.getEditorState().read(()=>!Ee(e))}function Pa(t,e){const n={insert:t.__text},r=xr(t,fn);if(r&&(n.attributes={segment:r}),e&&e.length>0){const s=Cf(e);s&&(n.attributes={...n.attributes,char:s})}return n}function Gc(t){const e=new ns;return t.isEmpty()||t.read(()=>{const n=vt();if(!n||n.isEmpty())return;const r=n.getChildren();if(r.length===1&&Yt(r[0])&&(!r[0].getChildren()||r[0].getChildrenSize()===0))return;const s=bk();for(const i of s)e.push(i)}),e}function Ml(t,e){const n=[],r=vr(t),s=[],i=[],o=[],a=new Set;for(let l=0;l<r.length;l++){const u=r[l].node;n.push(...Yc(u,l,r,s,i,o,a))}for(const l of s)n.push(...Yc(l,r.length,r,s,i,o,a));return n}function bk(){return Ml()}function Yc(t,e,n,r,s,i,o){if(!t)return[];const a=[],l=n[e+1];return _k(t,a,r),kk(t,a,s,i,o),vk(t,e,n,s,o,i,a),ut(t)&&a.push(Sk(t)),dt(t)&&a.push(Ek(t)),eo(t)&&a.push(Ok(t)),ff(t)&&a.push(Mk(t)),xk(t,a,i),wk(t,a,i),Ik(l,i),a}function _k(t,e,n){if(!t.isInline()){const r=n.pop();Pt(r)?e.push(Ck(r)):Je(r)?e.push(Tk(r)):Yt(r)&&e.push({insert:vs})}it(t)&&(n.includes(t)||n.push(t))}function kk(t,e,n,r,s){var i;if(!Y(t))return;const o=t.getParent();if(ae(o)&&o.getFirstChild()===t)return;const a=t.getTextContent(),l=a.startsWith(dl),u=ge(o)?o:void 0,d=!!u&&a===Gt&&u.getChildrenSize()===1,f=Pa(t,n),h=to(t,r);if(h){if(!a||a===ke||l)return;(i=h.contentsOps)==null||i.push(f)}else d||l&&u||e.push(f);const p=a!==""&&!d&&!(l&&u);if(n.length>0&&p)for(const y of n)s.add(y)}function vk(t,e,n,r,s,i,o){var a;ge(t)&&!r.includes(t)&&r.push(t);const l=n[e+1];for(const u of r.toReversed())if(br(u,l)){if(r.pop(),!s.has(u)){const d=jk(u),f=to(u,i);f?(a=f.contentsOps)==null||a.push(d):o.push(d)}s.delete(u)}}function wk(t,e,n){var r,s;if(!ae(t))return;const i=Ak(t),o=to(t,n),a={node:t,children:vr(t).map(l=>l.node),contentsOps:(s=(r=i.insert.note)==null?void 0:r.contents)==null?void 0:s.ops};n.push(a),o!=null&&o.contentsOps?o.contentsOps.push(i):e.push(i)}function xk(t,e,n){var r,s;if(!Zt(t))return;const i=Nk(t),o=to(t,n),a={node:t,children:vr(t).map(l=>l.node),contentsOps:(s=(r=i.insert.unknown)==null?void 0:r.contents)==null?void 0:s.ops};n.push(a),o!=null&&o.contentsOps?o.contentsOps.push(i):e.push(i)}function Ck(t){const e={style:bs,code:t.__code};return{insert:vs,attributes:{book:e}}}function Sk(t){const e={style:Pi,number:t.__number};return t.__sid&&(e.sid=t.__sid),t.__altnumber&&(e.altnumber=t.__altnumber),t.__pubnumber&&(e.pubnumber=t.__pubnumber),{insert:{chapter:e}}}function Tk(t){const e={style:t.__marker};return{insert:vs,attributes:{para:e}}}function Ek(t){const e={style:$i,number:t.__number};return t.__sid&&(e.sid=t.__sid),t.__altnumber&&(e.altnumber=t.__altnumber),t.__pubnumber&&(e.pubnumber=t.__pubnumber),{insert:{verse:e}}}function Ok(t){const e={style:t.__marker};return t.__sid&&(e.sid=t.__sid),t.__eid&&(e.eid=t.__eid),{insert:{milestone:e}}}function Mk(t){return{insert:{unmatched:{marker:t.__marker}}}}function Ak(t){const e={style:t.__marker,caller:t.__caller};t.__category&&(e.category=t.__category),t.getChildrenSize()>1&&(e.contents={ops:[]});const n={insert:{note:e}},r=xr(t,fn);return r&&(n.attributes={segment:r}),n}function jk(t){const e={insert:""},n=Cf([t]);return n&&(e.attributes={char:n}),e}function Nk(t){const e={tag:t.getTag()},n=t.getMarker();n&&(e.marker=n);const r=t.getUnknownAttributes();return r&&Object.assign(e,r),t.getChildrenSize()>0&&(e.contents={ops:[]}),{insert:{unknown:e}}}function to(t,e){for(let n=e.length-1;n>=0;n--){const r=e[n];if(r.children.includes(t))return r}}function Ik(t,e){for(let n=e.length-1;n>=0;n--)br(e[n].node,t)&&e.splice(n,1)}function Cf(t){if(t.length===0)return;const e=t.map(Rk);return e.length===1?e[0]:e}function Rk(t){const e={style:t.__marker},n=xr(t,Dn);n&&(e.cid=n);const r=t.getUnknownAttributes();return r&&Object.keys(r).length>0&&Object.assign(e,r),e}const Sf=1;class _t extends wr{constructor(e=$t,n="",r,s){super(s),K(this,"__caller"),K(this,"__previewText"),K(this,"__onClick"),this.__caller=e,this.__previewText=n,this.__onClick=r??(()=>{})}static getType(){return"immutable-note-caller"}static clone(e){const{__caller:n,__previewText:r,__onClick:s,__key:i}=e;return new _t(n,r,s,i)}static importDOM(){return{span:e=>$k(e)?{conversion:Pk,priority:1}:null}}static importJSON(e){return Al().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setCaller(e.caller).setPreviewText(e.previewText).setOnClick(e.onClick)}setCaller(e){if(this.__caller===e)return this;const n=this.getWritable();return n.__caller=e,n}getCaller(){return this.getLatest().__caller}setPreviewText(e){if(this.__previewText===e)return this;const n=this.getWritable();return n.__previewText=e,n}getPreviewText(){return this.getLatest().__previewText}setOnClick(e){if(this.__onClick===e)return this;const n=this.getWritable();return n.__onClick=e,n}getOnClick(){return this.getLatest().__onClick}createDOM(){const e=document.createElement("span");return e.classList.add(this.__type),e.setAttribute("data-caller",this.__caller),e.setAttribute("data-preview-text",this.__previewText),e}updateDOM(e){return e.__caller!==this.__caller}exportDOM(e){const{element:n}=super.exportDOM(e);return n&&_n(n)&&(n.classList.add(this.getType()),n.setAttribute("data-caller",this.getCaller()),n.setAttribute("data-preview-text",this.getPreviewText())),{element:n}}decorate(e){const n=this.getParent();if(!n)return null;const r=n.getKey(),s=n.getIsCollapsed(),i=this.__key,o=l=>{var u;return(u=this.__onClick)==null?void 0:u.call(this,l,r,s,()=>Lk(e,r),d=>Dk(e,r,i,d),()=>Fk(e,r))},a=`${this.__caller}_${this.__previewText}}`.replace(/\s+/g,"").substring(0,25);return m.jsx("button",{onClick:o,title:this.__previewText,"data-caller-id":a,children:this.__caller===$t&&s?"":this.__caller})}exportJSON(){return{type:this.getType(),caller:this.getCaller(),previewText:this.getPreviewText(),onClick:this.getOnClick(),version:Sf}}isKeyboardSelectable(){return!1}}function Pk(t){const e=t.getAttribute("data-caller")??"",n=t.getAttribute("data-preview-text")??"";return{node:Al(e,n)}}function Al(t,e,n){return Ie(new _t(t,e,n))}function $k(t){return t?t.classList.contains(_t.getType()):!1}function Cn(t){return t instanceof _t}function Lk(t,e){return t.read(()=>{const n=Ee(e);if(!ae(n))throw new Error(`getNoteCaller: Note node not found: ${e}`);return n.getCaller()})}function Dk(t,e,n,r){t.update(()=>{const s=Ee(e);if(!ae(s))throw new Error(`setNoteCaller: Note node not found: ${e}`);s.setCaller(r);const i=Ee(n);if(!Cn(i))throw new Error(`setNoteCaller: Caller node not found: ${n}`);i.setCaller(r)})}function Fk(t,e){return t.read(()=>{const n=Ee(e);if(!ae(n))throw new Error(`getNoteOps: Note node not found: ${e}`);return Ml(n)})}const qk=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],Uk=[_t,Ye,...q_],Bk=b.forwardRef((t,e)=>{const{coords:n,children:r,style:s,...i}=t,o=n!==void 0;return m.jsx("div",{ref:e,className:"floating-box","aria-hidden":!o,style:{...s,position:"absolute",zIndex:1e3,top:n==null?void 0:n.y,left:n==null?void 0:n.x,visibility:o?"visible":"hidden",opacity:o?1:0},...i,children:r})});function Hk(){const[t,e]=b.useState(void 0),[n,r]=b.useState(),s=b.useRef(null),i=b.useCallback((a,l)=>{s.current&&s.current();const u=a.commonAncestorContainer.nodeType===a.commonAncestorContainer.TEXT_NODE?a:a.commonAncestorContainer;s.current=ug(u,l,()=>{dg(u,l,{placement:"bottom-start",middleware:[hg(),fg()]}).then(d=>{r(d.placement),e(f=>(f==null?void 0:f.x)===d.x&&(f==null?void 0:f.y)===d.y?f:{x:d.x,y:d.y})}).catch(()=>{e(void 0)})})},[]),o=b.useCallback(()=>{s.current&&(e(void 0),s.current(),s.current=null)},[]);return b.useEffect(()=>o,[o]),{coords:t,placement:n,updatePosition:i,cleanup:o}}function Wk({isOpen:t,floatingBoxRef:e}){const{coords:n,updatePosition:r,cleanup:s,placement:i}=Hk();return b.useEffect(()=>{var o;if(!t||!e.current){s();return}const a=(o=window.getSelection())==null?void 0:o.getRangeAt(0);if(!a){s();return}return r(a,e.current),s},[s,t,e,r]),{coords:n,placement:i}}const Kk=document.body,Jk=b.memo(Bk);function zk({isOpen:t=!1,children:e}){const n=b.useRef(null),{coords:r,placement:s}=Wk({isOpen:t,floatingBoxRef:n}),i=b.useMemo(()=>r?typeof e=="function"?e:()=>e:()=>null,[e,r]);return jt.createPortal(m.jsx(Jk,{ref:n,coords:r,style:r?void 0:{display:"none"},children:i({isOpen:t,placement:s})}),Kk)}const Tf=b.createContext(void 0);function jl(){const t=b.useContext(Tf);if(!t)throw new Error("useMenuContext must be used within a MenuProvider");return t}function Vk(t,e){const[n,r]=b.useState(0),[s,i]=b.useState(-1),o=b.useMemo(()=>t??[],[t]),a={menuItems:o,activeIndex:n,selectedIndex:s,onSelectOption:e??(()=>{})},l=b.useCallback(()=>{r(f=>{const h=o.length;return h?(f-1+h)%h:0})},[o.length]),u=b.useCallback(()=>{r(f=>{const h=o.length;return h?(f+1)%h:0})},[o.length]),d=b.useCallback(()=>{const f=o.length;if(n>=0&&n<f){const h=o[n];e==null||e(h),i(n)}},[n,o,e]);return{state:a,moveUp:l,moveDown:u,select:d,setActiveIndex:r,setSelectedIndex:i}}function Gk({children:t,menuItems:e,onSelectOption:n,...r}){const s=Vk(e,n);return m.jsx(Tf.Provider,{value:s,children:m.jsx("div",{...r,children:t})})}const Ef=b.forwardRef(({index:t,children:e,onMouseEnter:n,onClick:r,...s},i)=>{const{state:{activeIndex:o},setActiveIndex:a,setSelectedIndex:l,select:u}=jl(),d=b.useCallback(h=>{u(),l(-1),r==null||r(h)},[r,u,l]),f=b.useCallback(h=>{a(t),n==null||n(h)},[t,a,n]);return m.jsx("button",{ref:i,role:"menuitem",...s,onClick:d,onMouseEnter:f,"aria-selected":t!==void 0&&o===t?"true":void 0,tabIndex:-1,children:e})});function Yk({children:t,autoIndex:e=!0,...n}){const r=b.useRef(null),{state:{activeIndex:s,menuItems:i}}=jl(),o=b.useMemo(()=>i?typeof t=="function"?t:()=>t:()=>null,[t,i]),a=b.useMemo(()=>{const l=o(i);return e?b.Children.map(l,(u,d)=>b.isValidElement(u)&&u.type===Ef&&u.props.index===void 0?b.cloneElement(u,{index:d}):u):l},[o,e,i]);return b.useEffect(()=>{if(r.current){const l=r.current,u=l.children[s];if(u){const d=l.getBoundingClientRect(),f=u.getBoundingClientRect();f.bottom>d.bottom?l.scrollTop+=f.bottom-d.bottom:f.top<d.top&&(l.scrollTop-=d.top-f.top)}}},[s]),m.jsx("div",{ref:r,role:"menu",...n,children:a})}const ca={Root:Gk,Options:Yk,Option:Ef},Xk=(t,e,n)=>Ci(t,n).toLowerCase().includes(e.toLowerCase()),Xc=t=>Object.keys(t).find(e=>typeof t[e]=="string")||"",Ci=(t,e)=>{const n=t[e];return typeof n=="string"?n:String(n)};function Zk(t){const{query:e,items:n,filterBy:r,filter:s,sortBy:i,sortingOptions:o}=t,{caseSensitive:a=!1,priorityOrder:l=["exact","startsWith","contains"]}=o||{},u=a?e:e.toLowerCase();let d,f;s?(f=s,d=n.length>0?Xc(n[0]):""):(d=r||(n.length>0?Xc(n[0]):""),f=(y,k)=>Xk(y,k,d));const h=i||d,p=new Map;return n.filter(y=>{try{return f(y,e)}catch(k){return console.warn("Error filtering item:",y,k),!1}}).sort((y,k)=>{const C=O=>(p.has(O)||p.set(O,Ci(O,h).toLowerCase()),p.get(O)??""),A=a?Ci(y,h):C(y),v=a?Ci(k,h):C(k);for(const O of l)switch(O){case"exact":if(A===u&&v!==u)return-1;if(v===u&&A!==u)return 1;break;case"startsWith":if(A.startsWith(u)&&!v.startsWith(u))return-1;if(v.startsWith(u)&&!A.startsWith(u))return 1;break;case"contains":{const I=A.indexOf(u),L=v.indexOf(u);if(I!==-1&&L===-1)return-1;if(L!==-1&&I===-1)return 1;if(I!==-1&&L!==-1)return I-L;break}}return A.localeCompare(v)})}function Qk(t){const{query:e,items:n,filterBy:r,filter:s,sortBy:i,sortingOptions:o}=t;return b.useMemo(()=>Zk({query:e,items:n,filterBy:r,filter:s,sortBy:i,sortingOptions:o}),[e,n,r,s,i,o])}function ev(){const{moveUp:t,moveDown:e,select:n}=jl();return b.useMemo(()=>({moveUp:t,moveDown:e,select:n}),[t,e,n])}const tv=()=>{const t=ev(),[e]=ue();b.useEffect(()=>{const n=r=>{const s={ArrowDown:()=>t==null?void 0:t.moveDown(),ArrowUp:()=>t==null?void 0:t.moveUp(),Enter:()=>t==null?void 0:t.select(),Tab:()=>t==null?void 0:t.select()}[r.key];return s?(s(),r.preventDefault(),r.stopPropagation(),!0):!1};return e.registerCommand(zi,n,Ga)},[e,t])};function nv(){return tv(),null}function rv(t){const{options:e,onSelectOption:n,onClose:r,inverse:s,query:i,menuOpenKey:o}=t,[a]=ue(),l=i!==void 0,[u,d]=b.useState(""),f=l?i??"":u,h=Qk({query:f,items:e,filterBy:"name"}),p=y=>{r==null||r(),n?n(y):y.action(a)};return b.useEffect(()=>a.registerCommand(zi,y=>{if(l)return!1;const k={Escape:()=>r==null?void 0:r(),Backspace:()=>{f.length===0?r==null||r():d(C=>C.slice(0,-1))}}[y.key];return k?(y.stopPropagation(),y.preventDefault(),k(),!0):y.key.length===1?(y.stopPropagation(),y.preventDefault(),y.key!==o&&d(C=>C+y.key),!0):!1},Ga),[a,l,f,o,r]),m.jsxs(ca.Root,{className:`autocomplete-menu-container ${s?"inverse":""}`,menuItems:h,onSelectOption:y=>p(y),children:[!l&&m.jsx("input",{value:f,type:"text",disabled:!0}),m.jsx(nv,{}),m.jsx(ca.Options,{className:"autocomplete-menu-options",autoIndex:!1,children:y=>y.map((k,C)=>m.jsxs(ca.Option,{index:C,children:[m.jsx("span",{className:"label",children:k.label??k.name}),m.jsx("span",{className:"description",children:k.description})]},k.name))})]})}function sv({trigger:t,items:e}){const[n]=ue(),[r,s]=b.useState(!1),i=b.useCallback(o=>{o.key==="Escape"&&r?(s(!1),n.focus()):o.key===t&&!r&&(o.preventDefault(),s(!0))},[n,t,r]);return b.useEffect(()=>n.registerRootListener(o=>{if(o)return o.addEventListener("keydown",i),()=>{o.removeEventListener("keydown",i)}}),[n,i]),b.useEffect(()=>n.registerUpdateListener(({prevEditorState:o,editorState:a})=>{const l=o.read(()=>{const u=re();if(Z(u))return u});a.read(()=>{const u=re();!Z(u)||l!=null&&l.is(u)||s(!1)})}),[n]),e&&m.jsx(zk,{isOpen:r,children:({placement:o})=>m.jsx(rv,{options:e,onClose:()=>s(!1),inverse:o==="top-start",menuOpenKey:t})})}function iv({scriptureReference:t,contextMarker:e,getMarkerAction:n}){return{markersMenuItems:b.useMemo(()=>{if(!e||!t)return;const r=qc(e);if(r!=null&&r.children)return Object.values(r.children).flatMap(s=>s.map(i=>{const o=qc(i),{action:a}=n(i,o);return{name:i,label:i,description:(o==null?void 0:o.description)??"",action:l=>{a({editor:l,reference:t})}}}))},[e,n,t])}}function cs(t,e){return`${t}:${e}`}function ov(t,e){b.useEffect(()=>{if(!t.hasNodes([Fe]))throw new Error("AnnotationPlugin: TypedMarkNode not registered on editor!");const n=new Map;return Xe(Cd(t,Fe,r=>ks(r.getTypedIDs(),r.getTypedOnClicks(),r.getTypedOnRemoves()),(r,s)=>{const i=r.getTypedOnClicks(),o=r.getTypedOnRemoves();for(const[a,l]of Object.entries(r.getTypedIDs()))l.forEach(u=>{var d,f;const h=(d=i[a])==null?void 0:d[u],p=(f=o[a])==null?void 0:f[u];s.addID(a,u,h,p)});r.getWritable().__suppressOnRemoveCallbacks=!0}),t.registerMutationListener(Fe,r=>{t.getEditorState().read(()=>{for(const[s,i]of r){const o=Ee(s);let a={};i==="destroyed"?a=n.get(s)??{}:Se(o)&&(a=o.getTypedIDs());for(const[l,u]of Object.entries(a))if(!Fe.isReservedType(l))for(const d of u){let f=e.get(cs(l,d));a[l]=u,n.set(s,a),i==="destroyed"?f!==void 0&&(f.delete(s),f.size===0&&e.delete(cs(l,d))):(f===void 0&&(f=new Set,e.set(cs(l,d),f)),f.has(s)||f.add(s))}}})},{skipInitialization:!0}))},[t,e])}const av=b.forwardRef(function({logger:t},e){const[n]=ue(),r=b.useMemo(()=>new Map,[]);ov(n,r);const s=(i,o,a)=>{const l=Array.from(a??r.get(cs(i,o))??[]);if(l.length!==0)for(const u of l){const d=Ee(u);Se(d)&&(d.deleteID(i,o),d.hasNoIDsForEveryType()&&Li(d))}};return b.useImperativeHandle(e,()=>({setAnnotation(i,o,a,l,u){if(Fe.isReservedType(o))throw new Error(`setAnnotation: Can't directly set this reserved annotation type '${o}'. Use the appropriate plugin instead.`);n.update(()=>{const d=Sl(i);if(d===void 0){t==null||t.error("Failed to find start or end node of the annotation.");return}s(o,a),df(d,o,a,l,u)},{tag:Ma})},removeAnnotation(i,o){if(Fe.isReservedType(i))throw new Error(`removeAnnotation: Can't directly remove this reserved annotation type '${i}'. Use the appropriate plugin instead.`);const a=r.get(cs(i,o));a===void 0||a.size===0||n.update(()=>{s(i,o,a)},{tag:Ma})}})),null});function lv({ignoreHistoryMergeTagChange:t=!0,ignoreSelectionChange:e=!1,onChange:n}){const[r]=ue();return b.useLayoutEffect(()=>{if(n)return r.registerUpdateListener(s=>{const{editorState:i,dirtyElements:o,dirtyLeaves:a,prevEditorState:l,tags:u}=s;if(e&&o.size===0&&a.size===0||t&&u.has(dd)||l.isEmpty())return;const d=cv(r,s);d.length!==0&&n(i,r,u,d)})},[r,t,e,n]),null}function cv(t,{dirtyLeaves:e,prevEditorState:n}){let r=new ns;return t.getEditorState().read(()=>{const s=e.values().next().value??"";if(e.size===1&&Y(Ee(s))){const i=Ee(s),o=pf(i);if(Y(i)&&o!==void 0){const a=n.read(()=>{const d=Ee(s);return new ns([Y(d)?Pa(d):{insert:""}])}),l=new ns([Pa(i)]),u=new ns(o>0?[{retain:o}]:[]);r=r.concat(u).concat(a.diff(l))}}else{const i=Gc(n),o=Gc(t.getEditorState());r=i.diff(o)}}),r.ops}function uv(t,e,n,r){let s=0;t.forEach(i=>{if("retain"in i)s+=dv(i,s,e,r);else if("delete"in i){if(typeof i.delete!="number"||i.delete<=0){r==null||r.error(`Invalid delete operation: ${JSON.stringify(i)}`);return}r==null||r.debug(`Delete: ${i.delete}`),fv(s,i.delete,r)}else"insert"in i?typeof i.insert=="string"?(r==null||r.debug(`Insert: '${i.insert}'`),s+=pv(s,i.insert,i.attributes,e,r)):typeof i.insert=="object"&&i.insert!==null?(r==null||r.debug(`Insert embed: ${JSON.stringify(i.insert)}`),mv(s,i,e,n,r)?s+=1:r==null||r.error(`Failed to process insert embed operation: ${JSON.stringify(i.insert)} at index ${s}. Document may be inconsistent.`)):r==null||r.error(`Insert of unknown type: ${JSON.stringify(i.insert)}`):r==null||r.error(`Unknown operation: ${JSON.stringify(i)}`)})}function dv(t,e,n,r){return typeof t.retain!="number"||t.retain<0?(r==null||r.error(`Invalid retain operation: ${JSON.stringify(t)}`),0):(r==null||r.debug(`Retain: ${t.retain}`),t.attributes&&(r==null||r.debug(`Retain attributes: ${JSON.stringify(t.attributes)}`),hv(e,t.retain,t.attributes,n,r)),t.retain)}function hv(t,e,n,r,s){s==null||s.debug(`Applying attributes for range [${t}, ${t+e-1}] with attributes: ${JSON.stringify(n)}`);let i=e,o=0,a=-1;const l=vt();function u(d){if(i<=0)return!0;if(Y(d)){const f=d.getTextContentSize();if(t<o+f&&o<t+e){const h=Math.max(0,t-o),p=f-h,y=Math.min(i,p);if(y>0){let k=d;const C=h>0,A=y<f-h;if(C&&A){const[,v]=d.splitText(h);[k]=v.splitText(y)}else C?[,k]=d.splitText(h):A&&([k]=d.splitText(y));if(gn(n)){const v=k.getParent();if(ge(v)){const O=n.char;let I;Array.isArray(O)?a>=0&&a<=O.length-1&&(I=O[a]):a===0&&(I=O);const L=I?qn(I,v):!1;if(L&&Array.isArray(O)&&O.length>1){const q=_e("");k.replace(q);const F=typeof n.segment=="string"?n.segment:void 0,$=Ar(O.slice(1),r,k,F);let H=q;for(const W of $)H.insertAfter(W),H=W;q.remove(),ct(n,k)}else if(L)ct(n,k);else{k.remove();const q=Zc(k,n,r,s);if(q&&q.length>0){let F=v;for(const $ of q)F.insertAfter($),F=$}}}else{const O=_e("");k.replace(O);const I=Zc(k,n,r,s);if(I&&I.length>0){let L=O;for(const q of I)L.insertAfter(q),L=q;O.remove()}else O.replace(k)}}else ct(n,k);i-=y}}o+=f}else if(kt(d))t<=o&&o<t+e&&i>0&&(Qc(d,n),i-=1),o+=1;else if(ge(d)){a+=1;let f=!1;if(t<=o&&o<t+e&&i>0)if(gn(n)){const h=n.char;let p;if(Array.isArray(h)?a>=0&&a<=h.length-1&&(p=h[a]):a===0&&(p=h),p){d.setMarker(p.style),typeof p.cid=="string"&&At(d,Dn,()=>p.cid);const y=je(p,Fi);y&&Object.keys(y).length>0?d.setUnknownAttributes({...d.getUnknownAttributes()??{},...y}):d.setUnknownAttributes(void 0)}}else(n.char===!1||n.char===null||Cv(n.char))&&(f=!0);if(i>0){const h=d.getChildren();for(const p of h){if(i<=0)break;if(u(p)&&i<=0)return f&&Wl(d),!0}}f&&Wl(d),a-=1}else if(it(d)){const f=d.getChildren();for(const p of f){if(i<=0)break;if(u(p)&&i<=0)return!0}const h=1;if(t<=o&&o<t+i&&i>0){if(!Yt(d))Qc(d,n);else if(Nl(n)){const p=Mf(n.para);p&&d.replace(p,!0)}i-=h}o+=h}else if(se(d)){const f=d.getChildren();for(const h of f){if(i<=0)break;if(u(h)&&i<=0)return!0}}return i<=0}u(l),i>0&&(s==null||s.warn(`$applyAttributes: Not all characters in the retain operation (length ${e}) could be processed. Remaining: ${i}. targetIndex: ${t}, final currentIndex: ${o}`))}function Zc(t,e,n,r){var s;const i=typeof e.segment=="string"?e.segment:void 0,o=Ar(e.char,n,t,i),a=o.find(ge);if(!a){r==null||r.error(`Failed to create CharNode for text transformation. Style: ${Array.isArray(e.char)?e.char[0].style:(s=e.char)==null?void 0:s.style}. Falling back to standard text attributes.`),ct(e,t);return}const l={};Nf.forEach(f=>{t.hasFormat(f)&&(l[f]="true")});const u={};Object.entries(e).forEach(([f,h])=>{f==="segment"||f==="char"||(typeof h=="string"?u[f]=h:h===!0?u[f]="true":h===!1&&(u[f]="false"))});const d={...a.getUnknownAttributes()??{},...l,...u};return Object.keys(d).length>0&&a.setUnknownAttributes(d),ct(e,t),o}function Qc(t,e){for(const n of Object.keys(e)){const r=e[n];if(n==="char"&&ge(t)&&gn(e)){const s=r;if(t.setMarker(s.style),typeof s.cid=="string"){const o=s.cid;At(t,Dn,()=>o)}const i=je(s,Fi);i&&Object.keys(i).length>0&&t.setUnknownAttributes({...t.getUnknownAttributes()??{},...i});continue}typeof r=="string"&&(ut(t)||dt(t)||eo(t)||ae(t)||Zt(t)?t.setUnknownAttributes({...t.getUnknownAttributes()??{},[n]:r}):(Pt(t)||Je(t)||ge(t))&&(n==="style"&&!Pt(t)?t.setMarker(r):n==="code"&&Pt(t)?t.setCode(r):t.setUnknownAttributes({...t.getUnknownAttributes()??{},[n]:r})),n==="segment"&&At(t,fn,()=>r))}}function fv(t,e,n){if(e<=0)return;const r=vt();let s=0,i=e;function o(a){if(i<=0)return!0;if(Y(a)){let l=a.getTextContentSize();if(t<s+l&&s<t+i){const u=Math.max(0,t-s),d=l-u,f=Math.min(i,d);f>0&&(a.spliceText(u,f,""),a.getTextContentSize()===0&&a.remove(),n==null||n.debug(`Deleted ${f} length from TextNode (key: ${a.getKey()}) at nodeOffset ${u}. Original targetIndex: ${t}, current currentIndex: ${s}.`),i-=f,l-=f)}s+=l}else if(kt(a))t<=s&&s<t+i?(a.remove(),n==null||n.debug(`Deleted embed node (key: ${a.getKey()}) at currentIndex: ${s}. Original targetIndex: ${t}, remainingToDelete: ${i}.`),i-=1):s+=1;else if(it(a)){const l=a.getChildren().slice(),u=a.getChildren();for(const d of u){if(i<=0)break;if(o(d)&&i<=0)return!0}if(t<=s&&s<t+i&&it(a)){i-=1;const d=a.getChildren().length;if(l.length>0&&d===0){const f=a.getParent();((f==null?void 0:f.getChildren())??[]).length>1?(a.remove(),n==null||n.debug(`Removed entire ParaNode that had all its content deleted at currentIndex: ${s}. Original targetIndex: ${t}, remainingToDelete: ${i}.`)):(a.replace(bt(),!0),n==null||n.debug(`Replaced last ParaNode with ImpliedParaNode at currentIndex: ${s}. Original targetIndex: ${t}, remainingToDelete: ${i}.`))}else if(i>0){const f=a.getNextSibling();if(f&&yt(f)){let h=s+1;const p=f.getChildren();for(const k of p){if(i<=0)break;const C=s;if(s=h,o(k)){s=C;break}Y(k)?h+=k.getTextContentSize():kt(k)&&(h+=1),s=C}const y=f.getChildren();for(const k of y)k.remove(),a.append(k);f.remove(),n==null||n.debug(`Merged next paragraph into current one after deleting symbolic close at currentIndex: ${s}. Original targetIndex: ${t}, remainingToDelete: ${i}.`)}else a.replace(bt(),!0)}else Je(a)?a.replace(bt(),!0):a.remove()}s+=1}else if(se(a)){const l=a.getChildren();for(const u of l){if(i<=0)break;if(o(u)&&i<=0)return!0}}return i<=0}o(r),i>0&&(n==null||n.warn(`Delete operation could not remove all requested characters. Remaining to delete: ${i}. Original targetIndex: ${t}, OT length: ${e}. Final currentIndex: ${s}`))}function pv(t,e,n,r,s){if(e===vs)return eu(t,n,s);if(e.endsWith(vs)&&!Nl(n)){const i=e.slice(0,-1);let o=0;if(i.length>0){if(gn(n))throw new Error("Text + LF should not have char attributes");o+=qi(t,i,n,s)}return o+=eu(t+o,n,s),o}else return gn(n)?gv(t,e,n,r,s):qi(t,e,n,s)}function gv(t,e,n,r,s){s==null||s.debug(`Attempting to insert CharNode with text "${e}" and attributes ${JSON.stringify(n.char)} at index ${t}`);const i=_e(e===""?Gt:e);ct(n,i);let o;{let p=function(C){if(Y(C)){const A=C.getTextContentSize();if(t>=k&&t<k+A){const v=C.getParent();return ge(v)&&(o=v),!0}k+=A}else if(kt(C))k+=1;else if(ge(C)){const A=C.getChildren();for(const v of A)if(p(v))return!0}else if(se(C)){const A=C.getChildren();for(const v of A)if(p(v))return!0;it(C)&&(k+=1)}return!1};const y=vt();let k=0;p(y)}let a=n.char;if(Array.isArray(a)){if(o){const p=a[0];p&&qn(p,o)?(a=a.slice(1),a.length===1&&(a=a[0])):o=void 0}}else o&&(qn(a,o)||(o=void 0));const l=typeof n.segment=="string"?n.segment:void 0,u=Ar(a,r,i,l,o?[o]:void 0);if(u.length===0)return e.length;const d=u.find(ge);if(!d)return s==null||s.error(`CharNode style is missing for text "${e}". Attributes: ${JSON.stringify(n.char)}. Falling back to rich text insertion.`),qi(t,e,void 0,s);const f={};for(const[p,y]of Object.entries(n))p!=="char"&&p!=="segment"&&typeof y=="string"&&(f[p]=y);Object.keys(f).length>0&&d.setUnknownAttributes(f);let h=!0;for(const p of u)if(!Of(t,p,s)){h=!1;break}return h?e.length:(s==null||s.error(`Failed to insert CharNode with text "${e}" at index ${t}. Falling back to rich text.`),qi(t,e,void 0,s))}function qi(t,e,n,r){if(e.length<=0)return r==null||r.debug("Attempted to insert empty string. No action taken."),0;const s=vt();let i=0,o=!1;function a(l){if(o)return!0;if(Y(l)){const u=l.getTextContentSize();if(t>=i&&t<=i+u){const d=t-i,f=_e(e);if(ct(n,f),d===0)l.insertBefore(f);else if(d===u){const h=l.getParent();ge(h)&&!gn(n)?h.insertAfter(f):l.insertAfter(f)}else{const[,h]=l.splitText(d);h.insertBefore(f)}return r==null||r.debug(`Inserted text "${e}" in/around TextNode (key: ${l.getKey()}) at nodeOffset ${d}. Original targetIndex: ${t}, currentIndex at node start: ${i}.`),o=!0,!0}i+=u}else if(kt(l))i+=1;else if(ge(l)){if(!o&&t===i){const d=_e(e);ct(n,d);const f=l.getFirstChild();return f?f.insertBefore(d):l.append(d),r==null||r.debug(`Inserted text "${e}" at beginning of CharNode ${l.getType()} (key: ${l.getKey()}).`),o=!0,!0}const u=l.getChildren();for(const d of u){if(a(d))return!0;if(o)break}if(!o&&t===i){const d=_e(e);return ct(n,d),l.append(d),r==null||r.debug(`Appended text "${e}" to end of CharNode ${l.getType()} (key: ${l.getKey()}).`),o=!0,!0}}else if(it(l)){if(!o&&t===i){const d=_e(e);ct(n,d);const f=l.getFirstChild();return f?f.insertBefore(d):l.append(d),r==null||r.debug(`Inserted text "${e}" at beginning of container ${l.getType()} (key: ${l.getKey()}).`),o=!0,!0}const u=l.getChildren();for(const d of u){if(a(d))return!0;if(o)break}if(!o&&t===i){const d=_e(e);return ct(n,d),l.append(d),r==null||r.debug(`Appended text "${e}" to end of container ${l.getType()} (key: ${l.getKey()}).`),o=!0,!0}i+=1}else if(se(l)){const u=l.getChildren();for(const d of u){if(a(d))return!0;if(o)break}}return o}if(a(s),!o&&t===i){r==null||r.debug(`Insertion point matches end of document (targetIndex: ${t}, final currentIndex: ${i}). Appending text to new ParaNode.`);const l=_e(e);ct(n,l);const u=bt().append(l);s.append(u),o=!0}return o?e.length:(r==null||r.warn(`$insertRichText: Could not find insertion point for text "${e}" at targetIndex ${t}. Final currentIndex: ${i}. Text not inserted.`),0)}function Of(t,e,n){const r=vt();let s=0,i=!1;function o(a){if(i)return!0;if(a===r&&t===0&&!r.getFirstChild())return e.isInline()?(n==null||n.debug(`$insertNodeAtCharacterOffset: Inserting inline node ${e.getType()} into empty root, wrapped in ImpliedParaNode. targetIndex: ${t}`),r.append(bt().append(e))):(n==null||n.debug(`$insertNodeAtCharacterOffset: Inserting block node ${e.getType()} directly into empty root. targetIndex: ${t}`),r.append(e)),i=!0,!0;if(!se(a))return!1;const l=a.getChildren();for(const u of l){if(t===s&&!i){if(a===r&&e.isInline())if(yt(u)){n==null||n.debug(`$insertNodeAtCharacterOffset: Inserting inline node ${e.getType()} into existing ${u.getType()} at beginning. targetIndex: ${t}`);const d=u.getFirstChild();d?d.insertBefore(e):u.append(e)}else n==null||n.debug(`$insertNodeAtCharacterOffset: Inserting inline node ${e.getType()} into root before ${u.getType()}, wrapping in ImpliedParaNode. targetIndex: ${t}`),u.insertBefore(bt().append(e));else u.insertBefore(e),n==null||n.debug(`$insertNodeAtCharacterOffset: Inserted node ${e.getType()} (key: ${e.getKey()}) before child ${u.getType()} (key: ${u.getKey()}) in ${a.getType()} (key: ${a.getKey()}). targetIndex: ${t}, currentIndex: ${s}`);return i=!0,!0}if(Y(u)){const d=u.getTextContentSize();if(!i&&t>s&&t<s+d){const f=t-s,[h]=u.splitText(f);return h.insertAfter(e),n==null||n.debug(`$insertNodeAtCharacterOffset: Inserted node ${e.getType()} (key: ${e.getKey()}) by splitting TextNode (key: ${u.getKey()}) at offset ${f}. targetIndex: ${t}, currentIndex at node start: ${s}`),i=!0,!0}s+=d}else if(kt(u))s+=1;else if(ge(u)){if(o(u))return!0}else if(it(u)){const d=u;if(o(d))return!0;const f=s;if(Yt(d)&&it(e)&&t===f&&!i)return n==null||n.debug(`$insertNodeAtCharacterOffset: Replacing ImpliedParaNode (key: ${d.getKey()}) with block node '${e.getType()}' (key: ${e.getKey()}) at OT index ${t}.`),u.replace(e,!0),s=f+1,i=!0,!0;s+=1}else if(se(u)&&o(u))return!0;if(i)return!0}return se(a)&&!i&&(t===s||a===r&&t>s)?a===r?(e.isInline()?(n==null||n.debug(`$insertNodeAtCharacterOffset: Appending inline node ${e.getType()} to root. Wrapping in new ImpliedParaNode. targetIndex: ${t}, current document OT length: ${s}.`),r.append(bt().append(e))):(n==null||n.debug(`$insertNodeAtCharacterOffset: Appending block node ${e.getType()} to root. targetIndex: ${t}, current document OT length: ${s}.`),r.append(e)),i=!0,!0):yt(a)?Yt(a)&&Je(e)&&t===s?(n==null||n.debug(`$insertNodeAtCharacterOffset: Replacing ImpliedParaNode container (key: ${a.getKey()}) with ParaNode ${e.getType()} (key: ${e.getKey()}) via append logic. targetIndex: ${t}`),a.replace(e,!0),i=!0,!0):e.isInline()||!yt(e)?(n==null||n.debug(`$insertNodeAtCharacterOffset: Appending node ${e.getType()} to existing container ${a.getType()} (key: ${a.getKey()}). targetIndex: ${t}, container end OT index: ${s}.`),a.append(e),i=!0,!0):(n==null||n.debug(`$insertNodeAtCharacterOffset: Inserting block node ${e.getType()} after container ${a.getType()} (key: ${a.getKey()}). targetIndex: ${t}, container end OT index: ${s}.`),a.insertAfter(e),i=!0,!0):(ge(a)?(n==null||n.debug(`$insertNodeAtCharacterOffset: Inserting node ${e.getType()} after CharNode (key: ${a.getKey()}). targetIndex: ${t}, element end OT index: ${s}.`),a.insertAfter(e)):e.isInline()||!yt(e)?(n==null||n.debug(`$insertNodeAtCharacterOffset: Appending node ${e.getType()} to generic element ${a.getType()} (key: ${a.getKey()}). targetIndex: ${t}, element end OT index: ${s}.`),a.append(e)):(n==null||n.debug(`$insertNodeAtCharacterOffset: Inserting block node ${e.getType()} after generic element ${a.getType()} (key: ${a.getKey()}). targetIndex: ${t}, element end OT index: ${s}.`),a.insertAfter(e)),i=!0,!0):i}return o(r),i||n==null||n.warn(`$insertNodeAtCharacterOffset: Could not find insertion point for node ${e.getType()} (key: ${e.getKey()}) at targetIndex ${t}. Final currentIndex: ${s}. Node not inserted.`),i}function mv(t,e,n,r,s){let i;return et("chapter",e)?i=bv(e.insert.chapter,n):et("verse",e)?i=_v(e.insert.verse,n):et("ms",e)?i=kv(e.insert.ms):et("note",e)?i=Af(e,n,r,s):et("unknown",e)?i=jf(e,n,r,s):et("unmatched",e)&&(i=wv(e.insert.unmatched)),i?Of(t,i,s):(s==null||s.error(`$insertEmbedAtCurrentIndex: Cannot create LexicalNode for embed object: ${JSON.stringify(e.insert)}`),!1)}function eu(t,e,n){let r;Nl(e)?r=Mf(e.para):xv(e)&&(r=yv(e.book)),r??(r=bt());const s=r,i=Je(s),o=Yt(s);let a=0,l=!1;function u(d){if(l)return!0;if(Y(d)){const f=d.getTextContentSize();if(t>=a&&t<=a+f){const h=d.getParent();if(Je(h)&&(i||o)){n==null||n.debug(`Splitting ParaNode (marker: ${h.getMarker()}) with LF attributes at targetIndex ${t}`);const p=t-a,[y]=p>0?d.splitText(p):[void 0];let k=y==null?void 0:y.getPreviousSibling();for(;k;){const C=k;k=k.getPreviousSibling();const A=s.getFirstChild();A?A.insertBefore(C):s.append(C)}return y&&s.append(y),h.insertBefore(s),l=!0,!0}}a+=f}else if(kt(d))a+=1;else if(it(d)){const f=d.getChildren();for(const h of f){if(u(h))return!0;if(l)break}if(t===a){if(Yt(d)&&s)return n==null||n.debug(`Replacing ImpliedParaNode (key: ${d.getKey()}) with ParaNode at targetIndex ${t}`),d.replace(s,!0),l=!0,!0;if(Je(d)&&s){const h=d;return n==null||n.debug(`Creating new block node with LF attributes after existing ParaNode (marker: ${h.getMarker()}) at targetIndex ${t}`),h.insertAfter(s),l=!0,!0}}if(a+=1,t===a&&Je(d)&&s)return n==null||n.debug(`Creating new block node after existing ParaNode (marker: ${d.getMarker()}) at targetIndex ${t}`),d.insertAfter(s),l=!0,!0}else if(se(d)){const f=d.getChildren();for(const h of f){if(u(h))return!0;if(l)break}}return l}return u(vt()),l||n==null||n.warn(`Could not find location to handle newline with para attributes at targetIndex ${t}. Final currentIndex: ${a}.`),1}function yv(t){const{style:e,code:n}=t;if(!e||e!==bs||!n||!ht.isValidBookCode(n))return;const r=je(t,W_);return Uh(n,r)}function Mf(t){const{style:e}=t;if(!e)return;const n=je(t,H_);return _s(e,n)}function bv(t,e){if(!t)return;const{number:n,sid:r,altnumber:s,pubnumber:i}=t;if(!n)return;const o=je(t,K_);let a;if(e.markerMode==="editable")a=Wh(n,r,s,i,o);else{const l=e.markerMode==="visible";a=pl(n,l,r,s,i,o)}return a}function _v(t,e){if(!t)return;const{style:n,number:r,sid:s,altnumber:i,pubnumber:o}=t;if(!r)return;const a=je(t,J_);let l;if(e.markerMode==="editable"){if(!n)return;const u=Ts(n,r);l=rf(r,u,s,i,o,a)}else{const u=e.markerMode==="visible";l=Tl(r,u,s,i,o,a)}return l}function kv(t){if(!t)return;const{style:e,sid:n,eid:r}=t;if(!e)return;const s=je(t,z_);return Qh(e,n,r,s)}function Af(t,e,n,r){var s;const i=t.insert;if(!i.note)return;const{style:o,caller:a,category:l,contents:u}=i.note;if(!o||a==null)return;a===""&&(r==null||r.warn("Note has empty caller. Only use for note editing."));const d=je(i.note,V_),f=(s=t.attributes)==null?void 0:s.segment;let h;f&&typeof f=="string"&&(h=f);const p=[];for(const y of(u==null?void 0:u.ops)??[])if(typeof y.insert=="string")if(gn(y.attributes)){const k=Ar(y.attributes.char,e,_e(y.insert),void 0,p);p.push(...k)}else p.push(_e(y.insert));return vf(o,a,p,e,n,h).setCategory(l).setUnknownAttributes(d)}function jf(t,e,n,r){var s;const i=t.insert.unknown;if(!i)return;const{tag:o,marker:a,contents:l}=i;if(!o)return;const u=je(i,G_),d=ul(o,a,u),f=(l==null?void 0:l.ops)??[];f.length>0&&vv(f,e,n,r).forEach(p=>d.append(p));const h=(s=t.attributes)==null?void 0:s.segment;return typeof h=="string"&&At(d,fn,()=>h),d}function vv(t,e,n,r){const s=[];for(const i of t){if(typeof i.insert=="string"){if(gn(i.attributes)){const o=_e(i.insert),a=Ar(i.attributes.char,e,o,void 0,s);s.push(...a)}else s.push(_e(i.insert));continue}if(!(!i.insert||typeof i.insert!="object")){if(et("unknown",i)){const o=jf(i,e,n,r);o&&s.push(o);continue}if(et("note",i)){const o=Af(i,e,n,r);o&&s.push(o);continue}r==null||r.warn(`$createInlineNodesFromOps: Unsupported embed inside unknown contents: ${JSON.stringify(i.insert)}`)}}return s}function wv(t){if(!t)return;const{marker:e}=t;if(e)return Cl(e)}function Ar(t,e,n,r,s){if(Y(n)&&n.getTextContentSize()===0&&n.setTextContent(Gt),Array.isArray(t)){if(t.length===0)throw new Error("Empty charAttr array");const i=t[0],o=s==null?void 0:s[s.length-1];if(ge(o)&&qn(i,o))return t.length>1?Ar(t.slice(1),e,n).forEach(u=>o.append(u)):n&&o.append(n),[];const a=t.reduceRight((u,d,f)=>{const h=gt(d.style,je(d,Fi));if(typeof d.cid=="string"&&At(h,Dn,()=>d.cid),r&&f===t.length-1&&At(h,fn,()=>r),u)if(ge(u)){const p=u.getMarker(),y=[];ua(p,y,e),y.forEach(C=>h.append(C)),h.append(u);const k=[];da(p,k,e),k.forEach(C=>h.append(C))}else h.append(u);return h},n),l=t[0];return ua(l.style,a,e),da(l.style,a,e),[a]}else{const i=s==null?void 0:s[s.length-1];if(ge(i)&&qn(t,i))return n&&i.append(n),[];const o=gt(t.style,je(t,Fi));return typeof t.cid=="string"&&At(o,Dn,()=>t.cid),r&&At(o,fn,()=>r),n&&o.append(n),ua(t.style,o,e),da(t.style,o,e),[o]}}function ua(t,e,n){let r;if((n==null?void 0:n.markerMode)==="editable"?r=yr(t):(n==null?void 0:n.markerMode)==="visible"&&(r=pr("marker",en(t))),r)if(Array.isArray(e))e.push(r);else{const s=e.getFirstChild();s?s.insertBefore(r):e.append(r)}}function da(t,e,n,r=!1){if(Ce.isValidFootnoteMarker(t)||Ce.isValidCrossReferenceMarker(t))return;let s;(n==null?void 0:n.markerMode)==="editable"?r?s=yr("","selfClosing"):s=yr(t,"closing"):(n==null?void 0:n.markerMode)==="visible"&&(s=pr("marker",mr(r?"":t))),s&&(Array.isArray(e)?e.push(s):e.append(s))}function xv(t){return!!t&&!!t.book&&typeof t.book=="object"&&t.book!==null&&"style"in t.book&&typeof t.book.style=="string"&&"code"in t.book&&typeof t.book.code=="string"}function Nl(t){return!!t&&!!t.para&&typeof t.para=="object"&&t.para!==null&&"style"in t.para&&typeof t.para.style=="string"}function gn(t){return!!t&&!!t.char&&typeof t.char=="object"&&t.char!==null&&(!Array.isArray(t.char)&&"style"in t.char&&typeof t.char.style=="string"||Array.isArray(t.char)&&t.char.length>0&&"style"in t.char[0]&&typeof t.char[0].style=="string")}function Cv(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)&&Object.keys(t).length===0}function ct(t,e){if(t)for(const n of Object.keys(t)){if(n==="segment"&&typeof t[n]=="string"){const r=t[n];At(e,fn,()=>r);continue}if(Sv(n)){const r=!!t[n],s=n,i=e.hasFormat(s);(r&&!i||!r&&i)&&e.toggleFormat(s)}}}const Nf=["bold","underline","strikethrough","italic","highlight","code","subscript","superscript","lowercase","uppercase","capitalize"];function Sv(t){return Nf.includes(t)}function Tv({viewOptions:t}){const[e]=ue();return Ev(e,t),null}function Ev(t,e){b.useEffect(()=>{if(!t.hasNodes([Qt,Ye,$e]))throw new Error("ArrowNavigationPlugin: ImmutableChapterNode, ImmutableVerseNode or NoteNode not registered on editor!");const n=r=>{if(r.key!=="ArrowLeft"&&r.key!=="ArrowRight")return!1;const s=re();if(!Z(s)||!s.isCollapsed())return!1;const i=t.getRootElement();if(!i)return!1;const o=i.dir||"ltr";let a=!1;return Ov(o,r.key)?a=Av(s):Mv(o,r.key)&&(a=jv(s,e)),a&&r.preventDefault(),a};return t.registerCommand(zi,n,Ga)},[t,e])}function Ov(t,e){return t==="ltr"&&e==="ArrowRight"||t==="rtl"&&e==="ArrowLeft"}function Mv(t,e){return t==="ltr"&&e==="ArrowLeft"||t==="rtl"&&e==="ArrowRight"}function Av(t){var e,n,r;const s=t.anchor.getNode(),i=k_(t);if(ae(i)&&!Dt(i.getFirstChild())){if(yt(s)){if(t.anchor.offset===s.getChildrenSize())return!1}else if(t.anchor.offset!==s.getTextContentSize())return!1;if(i.getIsCollapsed()){if(i.is((e=i.getParent())==null?void 0:e.getLastChild()))return(r=(n=i.getParent())==null?void 0:n.getNextSibling())==null||r.selectStart(),!0}else return Ii(i.getFirstChild())?i.select(2,2):i.select(1,1),!0}if(yt(s)&&ae(i)&&i.getIsCollapsed()){const a=i.getNextSibling();return a?a.selectStart():i.selectEnd(),!0}const o=i==null?void 0:i.getParent();if(Ii(i)&&ae(o)&&i.is(o==null?void 0:o.getLastChild())){const a=o.getNextSibling();return a?a.selectStart():o.selectEnd(),!0}return!1}function jv(t,e){const n=v_(t);if(Ss(n)&&!n.getPreviousSibling())return!0;if(t.anchor.offset!==0)return!1;const r=t.anchor.getNode();if(Pt(r.getParent()))return!0;if(ae(n)&&n.getIsCollapsed()){const i=n.getPreviousSibling();if(!Mr(i))return!1;const o=n.getParent();if(!o)return!1;const a=n.getIndexWithinParent();return o.select(a,a),!0}if(yt(n)&&(e==null?void 0:e.noteMode)==="collapsed"){const i=n.getLastChild();if(!i)return!1;const o=Ti(i,a=>ae(a));if(ae(o)&&o.getIsCollapsed()){const a=o.getParent();if(!a)return!1;const l=o.getIndexWithinParent();return a.select(l,l),!0}}const s=sf(r);if(!s||s.getIsCollapsed())return!1;if(Cn(n)){const i=s.getParent();if(!i)return!1;const o=s.getIndexWithinParent();return i.select(o,o),!0}return!1}function Nv(){const[t]=ue();return Iv(t),null}function Iv(t){b.useEffect(()=>{if(!t.hasNodes([Ce]))throw new Error("CharNodePlugin: CharNode not registered on editor!");return Xe(t.registerNodeTransform(Ce,Rv),t.registerNodeTransform(Nt,Pv))},[t])}function Rv(t){if(!ge(t))return;if(t.isEmpty()){t.remove();return}const e=t.getMarker(),n=xr(t,Dn),r=t.getUnknownAttributes(),s=t.getNextSibling();ge(s)&&qn({style:e,cid:n},s)&&an(r,s.getUnknownAttributes())&&(t.append(...s.getChildren()),s.remove());const i=t.getPreviousSibling();ge(i)&&qn({style:e,cid:n},i)&&an(r,i.getUnknownAttributes())&&(i.append(...t.getChildren()),t.remove())}function Pv(t){const e=t.getParent();if(!ge(e)||e.getChildrenSize()!==1)return;const n=t.getTextContent();n.length>1&&n.startsWith(Gt)&&(t.setTextContent(n.slice(1)),t.selectEnd())}function If(t){return t.replaceAll("	"," ")}const Il=t=>{navigator.clipboard.read().then(async e=>{if((await navigator.permissions.query({name:"clipboard-read"})).state==="denied"){alert("Not allowed to paste from clipboard.");return}const n=new DataTransfer,r=e[0];for(const i of r.types){const o=await(await r.getType(i)).text();n.setData(i,If(o))}const s=new ClipboardEvent("paste",{clipboardData:n});t.dispatchCommand(Hi,s)})},Rl=t=>{navigator.clipboard.read().then(async()=>{if((await navigator.permissions.query({name:"clipboard-read"})).state==="denied"){alert("Not allowed to paste from clipboard.");return}const e=new DataTransfer,n=await navigator.clipboard.readText();e.setData("text/plain",If(n));const r=new ClipboardEvent("paste",{clipboardData:e});t.dispatchCommand(Hi,r)})};function $v(){const[t]=ue();return b.useEffect(()=>{const e=n=>{const{key:r,shiftKey:s,metaKey:i,ctrlKey:o,altKey:a}=n;!(ga?i:o)||a||(!s&&r.toLowerCase()==="c"?(n.preventDefault(),t.dispatchCommand(Ki,null)):!s&&r.toLowerCase()==="x"?(n.preventDefault(),t.dispatchCommand(Wi,null)):r.toLowerCase()==="v"&&(n.preventDefault(),s?Rl(t):Il(t)))};return t.registerRootListener((n,r)=>{r!==null&&r.removeEventListener("keydown",e),n!==null&&n.addEventListener("keydown",e)})},[t]),null}function Lv({logger:t}){const[e]=ue();return b.useEffect(()=>Xe(e.registerCommand(zi,n=>n.key!=="\\"&&n.key!=="/"?!1:(n.preventDefault(),!0),bi),e.registerCommand(Hi,n=>{var r;const s=(r=n.clipboardData)==null?void 0:r.getData("text/plain");return!s||!s.includes("\\")&&!s.includes("/")?!1:(t==null||t.info("CommandMenuPlugin: paste containing backslash or forward slash ignored."),n.preventDefault(),!0)},bi),e.registerCommand(md,n=>{var r;const s=(r=n.dataTransfer)==null?void 0:r.getData("text/plain");return!s||!s.includes("\\")&&!s.includes("/")?!1:(t==null||t.info("CommandMenuPlugin: drag containing backslash or forward slash ignored."),n.preventDefault(),!0)},bi)),[e,t]),null}function Dv({index:t,isSelected:e,onClick:n,onMouseEnter:r,option:s}){let i="item";return e&&(i+=" selected"),s.isDisabled&&(i+=" disabled"),m.jsx("li",{tabIndex:-1,className:i,ref:s.setRefElement,role:"option","aria-selected":e,"aria-disabled":s.isDisabled,id:"typeahead-item-"+t,onMouseEnter:r,onClick:s.isDisabled?void 0:n,children:m.jsx("span",{className:"text",children:s.title})},s.key)}function Fv({options:t,selectedItemIndex:e,onOptionClick:n,onOptionMouseEnter:r}){return m.jsx("div",{className:"typeahead-popover",children:m.jsx("ul",{children:t.map((s,i)=>m.jsx(Dv,{index:i,isSelected:e===i,onClick:()=>n(s,i),onMouseEnter:()=>r(i),option:s},s.key))})})}class si extends Cm{constructor(e,n){super(e),K(this,"title"),K(this,"onSelect"),K(this,"isDisabled"),this.title=e,this.onSelect=n.onSelect.bind(this),this.isDisabled=n.isDisabled||!1}}function qv(t,e="editor-input"){return t?t.classList.contains(e):!1}function Uv(){const[t]=ue(),[e,n]=b.useState(()=>!t.isEditable()),r=b.useRef(void 0),s=b.useRef(void 0),i=b.useRef(void 0),o=b.useMemo(()=>[new si("Cut",{onSelect:()=>{t.dispatchCommand(Wi,null)},isDisabled:e}),new si("Copy",{onSelect:()=>{t.dispatchCommand(Ki,null)}}),new si("Paste",{onSelect:()=>{Il(t)},isDisabled:e}),new si("Paste as Plain Text",{onSelect:()=>{Rl(t)},isDisabled:e})],[t,e]),a=b.useCallback((l,u,d)=>{t.update(()=>{l==null||l.onSelect(u),d()})},[t]);return b.useEffect(()=>{var l;s.current=((l=t.getRootElement())==null?void 0:l.className)??""},[t]),b.useEffect(()=>{const l=()=>{var u;(u=i.current)==null||u.call(i)};return window.addEventListener("scroll",l,!0),()=>{window.removeEventListener("scroll",l,!0)}},[]),b.useEffect(()=>t.registerEditableListener(l=>{n(!l)}),[t]),m.jsx(Em,{options:o,onSelectOption:a,onWillOpen:l=>{r.current=l.target},menuRenderFn:(l,{selectedIndex:u,options:d,selectOptionAndCleanUp:f,setHighlightedIndex:h},{setMenuRef:p})=>(i.current=()=>f(void 0),l.current&&!qv(r.current,s.current)&&!Yh(r.current)?jt.createPortal(m.jsx("div",{className:"typeahead-popover auto-embed-menu",style:{marginLeft:l.current.style.width,userSelect:"none",width:200},ref:p,children:m.jsx(Fv,{options:o,selectedItemIndex:u,onOptionClick:(y,k)=>{y.isDisabled||(h(k),f(y))},onOptionMouseEnter:y=>{h(y)}})}),l.current):null)})}function Bv({isEditable:t}){const[e]=ue();return b.useLayoutEffect(()=>{e.setEditable(t)},[e,t]),null}function Hv({scripture:t,scriptureRef:e,nodeOptions:n,editorAdaptor:r,viewOptions:s,logger:i}){const[o]=ue();return b.useEffect(()=>{var a;(a=r.initialize)==null||a.call(r,n,i)},[r,i,n]),b.useEffect(()=>{var a;const l=(e==null?void 0:e.current)??t;(a=r.reset)==null||a.call(r);const u=r.serializeEditorState(l,s);if(u==null){i==null||i.warn("LoadStatePlugin: serializedEditorState was null or undefined. Skipping editor update.");return}try{const d=o.parseEditorState(u);queueMicrotask(()=>{o.update(()=>{o.setEditorState(d),o.dispatchCommand(cd,void 0)},{tag:hl})})}catch{i==null||i.error("LoadStatePlugin: error parsing or setting editor state.")}},[o,r,i,t,e,s]),null}function Wv({expandedNoteKeyRef:t,nodeOptions:e,viewOptions:n,logger:r}){const[s]=ue();return Kv(e,r),Jv(s,t,n,r),null}function Kv(t,e){const n=b.useRef(void 0),r=t.noteCallers;b.useEffect(()=>{let s=r;(!s||s.length<=0)&&(s=qk),n.current!==s&&(n.current=s,ew("note-callers",s,e))},[e,r])}function Jv(t,e,n,r){b.useEffect(()=>{if(!t.hasNodes([Ce,$e,_t]))throw new Error("NoteNodePlugin: CharNode, NoteNode or ImmutableNoteCallerNode not registered on editor!");const s=i=>t.update(()=>Qv(i));return Xe(t.registerNodeTransform($e,i=>zv(i,n)),t.registerNodeTransform(Ce,Vv),t.registerNodeTransform(Nt,Gv),t.registerNodeTransform(_t,Yv),t.registerMutationListener(_t,(i,{prevEditorState:o})=>Xv(i,o)),t.registerCommand(ws,()=>Zv(t,e,n,r),kr),t.registerRootListener((i,o)=>{o!==null&&o.removeEventListener("dblclick",s),i!==null&&i.addEventListener("dblclick",s)}))},[t,e,r,n])}function zv(t,e){const n=t.getChildren();if(!n.some(r=>Cn(r))&&(e==null?void 0:e.markerMode)!=="editable"&&t.getCaller()!==""&&t.remove(),n.length>0){const r=n[0];Y(r)&&!Dt(r)&&t.insertBefore(r)}}function Vv(t){const e=t.getParentOrThrow(),n=e.getChildren(),r=n.find(o=>Cn(o));if(!ge(t)||!ae(e)||!r)return;const s=wl(n);r.getPreviewText()!==s&&r.setPreviewText(s);const i=t.getNextSibling();Y(i)?i.getTextContent()!==ke&&i.setTextContent(ke):t.insertAfter(_e(ke))}function Gv(t){const e=sf(t),n=e==null?void 0:e.getChildren(),r=n==null?void 0:n.find(o=>Cn(o));if(!Y(t)||!ae(e)||!r||!n)return;const s=t.getParent();if(!Dt(t)&&ae(s)&&t.getTextContent()!==ke&&(t.setTextContent(ke),t.selectEnd()),ge(s)&&s.getChildrenSize()===1){const o=t.getTextContent();o.length>1&&o.startsWith(Gt)&&(t.setTextContent(o.slice(1)),t.selectEnd())}const i=wl(n);r.getPreviewText()!==i&&r.setPreviewText(i)}function Yv(t){if(!Cn(t))return;const e=t.getNextSibling();!Y(e)||Dt(e)?t.insertAfter(_e(ke)):e.getTextContent()!==ke&&e.setTextContent(ke)}function Xv(t,e){for(const[n,r]of t){if(r!=="destroyed")continue;const s=e.read(()=>{const o=Ee(n),a=o==null?void 0:o.getParent();return Cn(o)&&ae(a)&&a.getCaller()===$t}),i=document.querySelector(".editor-input");!s||!i||(i.classList.add("reset-counters"),i.offsetHeight,i.classList.remove("reset-counters"))}}function Zv(t,e,n,r){var s;if((n==null?void 0:n.noteMode)!=="expandInline")return!1;const i=re();if(!Z(i)||!i.isCollapsed())return!1;const o=i.anchor,a=o.getNode();if(e.current){const l=Ti(a,u=>ae(u));if(l)e.current!==l.getKey()&&(e.current=l.getKey());else{const u=Ee(e.current);u&&!u.getIsCollapsed()&&(r==null||r.debug("Cursor moved away from NoteNode, collapsing it"),Xr(t,e.current,r)),e.current=void 0}}if(o.offset===0){const l=a.getPreviousSibling();if(ae(l)){r==null||r.debug("Cursor is just after a NoteNode");const u=l.getKey();l.getIsCollapsed()?e.current=u:e.current=void 0,Xr(t,u,r)}}if(o.offset===a.getTextContentSize()){const l=a.getNextSibling();if(ae(l)){r==null||r.debug("Cursor is just before a NoteNode");const u=l.getKey();l.getIsCollapsed()?e.current=u:e.current=void 0,Xr(t,u,r)}else if(!l){const u=Ti(a,d=>ae(d));if(u&&u.getIsCollapsed()&&yt(u.getParent())&&u.is((s=u.getParent())==null?void 0:s.getLastChild())){r==null||r.debug("Cursor is at end of note at end of para");const d=u.getKey();e.current=d,Xr(t,d,r)}}}if(yt(a)){const l=a.getChildAtIndex(o.offset),u=l==null?void 0:l.getPreviousSibling();if(Mr(u)&&ae(l)){r==null||r.debug("Cursor is between verse and NoteNode");const d=l.getKey();l.getIsCollapsed()?e.current=d:e.current=void 0,Xr(t,d,r)}}return!1}function Xr(t,e,n){const r=Ee(e);try{r==null||r.toggleIsCollapsed()}catch(s){if(s instanceof Error&&s.message.includes("read only"))n==null||n.warn("Fallback triggered after stabilization - edge case"),setTimeout(()=>{t.update(()=>{r==null||r.toggleIsCollapsed()})},0);else throw s}}function Qv(t){const e=re();if(!Z(e))return;const n=e.anchor,r=e.focus,s=n.getNode(),i=r.getNode();if(ae(s)&&Y(i)){t.preventDefault();const o=wd();o.anchor.set(i.getKey(),0,"text"),o.focus.set(i.getKey(),r.offset,"text"),bd(o)}}function ew(t,e,n){for(const r of document.styleSheets)try{const s=r.cssRules||r.rules;for(const i of s)if(tw(i,t)){const o=e.map(a=>`"${a}"`).join(" ");i.symbols=o;return}}catch{continue}n==null||n.warn(`Editor: counter style "${t}" not found.`)}function tw(t,e){return typeof t=="object"&&t!==null&&"name"in t&&t.name===e&&"symbols"in t&&typeof t.symbols=="string"}function nw({onChange:t}){const[e]=ue();return b.useEffect(()=>e.registerCommand(ws,()=>{const n=e.read(mf);return t==null||t(n),!1},kr),[e,t]),null}function rw(){const[t]=ue();return sw(t),null}function sw(t){b.useEffect(()=>{if(!t.hasNodes([nt]))throw new Error("ParaNodePlugin: ParaNode not registered on editor!");return t.registerNodeTransform(nt,e=>iw(e,t))},[t])}function iw(t,e){Ol(e,t.getKey())&&xf(t.getFirstChild()),!(!Je(t)||t.getMarker()!=="b"||t.isEmpty()||!e.getEditorState().read(()=>{const n=Ee(t.getKey());return Je(n)&&((n==null?void 0:n.isEmpty())??!1)}))&&t.clear()}function Rf({onStateChange:t}){const[e]=ue(),[n,r]=b.useState(e),s=b.useRef(!1),i=b.useRef(!1),o=b.useRef(),a=b.useRef(),l=b.useCallback(()=>{const u=re();let d;if(Z(u)){const f=u.anchor.getNode(),h=u.focus.getNode();let p=f.getKey()==="root"?f:Ti(f,A=>{const v=A.getParent();return v!==null&&Xp(v)});p===null&&(p=f.getTopLevelElementOrThrow());const y=p.getKey(),k=n.getElementByKey(y),C=x_(f,h);if(C&&yk(C)&&(d=C.getMarker()),k!==null&&(Je(p)||Pt(p)||Ss(p))){o.current=p.getMarker(),a.current=d,t==null||t({canUndo:s.current,canRedo:i.current,blockMarker:o.current,contextMarker:d});return}}a.current=d},[n,t]);return b.useEffect(()=>e.registerCommand(ws,(u,d)=>(l(),r(d),!1),ss),[e,l]),b.useEffect(()=>Xe(n.registerUpdateListener(({editorState:u})=>{u.read(()=>{l()})}),n.registerCommand(Qr,u=>(s.current=u,t==null||t({canUndo:s.current,canRedo:i.current,blockMarker:o.current,contextMarker:a.current}),!1),ss),n.registerCommand(Zr,u=>(i.current=u,t==null||t({canUndo:s.current,canRedo:i.current,blockMarker:o.current,contextMarker:a.current}),!1),ss)),[l,n,t]),null}function ow({textDirection:t}){const[e]=ue();return aw(e,t),null}function aw(t,e){b.useEffect(()=>(tu(t,e),t.registerUpdateListener(({dirtyElements:n})=>{n.size>0&&tu(t,e)})),[t,e])}function tu(t,e){if(e==="auto")return;const n=t.getRootElement();n&&(n.dir=e);const r=t._config.theme.placeholder,s=document.getElementsByClassName(r)[0];s&&(s.dir=e)}function lw(){const[t]=ue();return cw(t),null}function cw(t){b.useEffect(()=>{if(!t.hasNodes([Ce,Ye,$e,Nt,Ge]))throw new Error("TextSpacingPlugin: CharNode, ImmutableVerseNode, NoteNode, TextNode or VerseNode not registered on editor!");return Xe(t.registerNodeTransform(Nt,uw),t.registerNodeTransform(Nt,e=>dw(e,t)),t.registerNodeTransform(Ge,nu),t.registerNodeTransform(Ye,nu))},[t])}function uw(t){if(!t.isAttached())return;const e=t.getTextContent(),n=t.getNextSibling(),r=t.getParent();t.getMode()!=="normal"||e.endsWith(" ")&&e.length>1||ae(n)||ge(r)||Se(r)||Zt(r)||(e===" "&&!dt(n)?t.setTextContent(""):El(t))}function dw(t,e){const n=t.getParent();!Zt(n)||!t.isAttached()||Ol(e,t.getKey())&&n.insertAfter(t)}function nu(t){if(!t.isAttached())return;const e=t.getPreviousSibling();e&&!dt(e)&&!Y(e)&&!Zt(e)&&t.insertBefore(_e(" "))}function hw({trigger:t,scriptureReference:e,contextMarker:n,getMarkerAction:r}){const{markersMenuItems:s}=iv({scriptureReference:e,contextMarker:n,getMarkerAction:r});return m.jsx(sv,{trigger:t,items:s})}function fw({trigger:t,scrRef:e,contextMarker:n,getMarkerAction:r}){const{book:s,chapterNum:i,verseNum:o,verse:a,versificationStr:l}=e,u=b.useMemo(()=>({book:s,chapterNum:i,verseNum:o,verse:a,versificationStr:l}),[s,i,o,a,l]),[d]=ue();return pw(d),m.jsx(hw,{trigger:t,scriptureReference:u,contextMarker:n,getMarkerAction:r})}function pw(t){b.useEffect(()=>{if(!t.hasNodes([Ge,Ye]))throw new Error("UsjNodesMenuPlugin: VerseNode or ImmutableVerseNode not registered on editor!");const e={},n={};return Xe(t.registerNodeTransform(Ye,r=>ru(r,t,e)),t.registerNodeTransform(Ge,r=>ru(r,t,e)),t.registerMutationListener(Ye,r=>au(r,t,e,n)),t.registerMutationListener(Ge,r=>au(r,t,e,n)))},[t])}function ru(t,e,n){eg(hl)||Ol(e,t.getKey())&&yw(t,n)}const su=2,gw=3,iu=4,mw=5;function yw(t,e){var n;const r=_l(t),s=r==null?void 0:r.getNumber();if(!s)return;const i=e[s];if(!i)return;let o=parseInt(t.getNumber()),a=((n=ou(t.getNumber()))==null?void 0:n[su])??"";i.forEach(l=>{const u=Ee(l);if(!u)return;const d=u.getNumber(),f=parseInt(d),h=ou(d),p=!!(h!=null&&h[gw]),y=p?parseInt(h[iu]):f;if(y<o||f>o||y===o&&a)return;const k=(h==null?void 0:h[su])??"",C=(h==null?void 0:h[mw])??"",A=p?ja(parseInt(h[iu]),void 0):"";let v=`${k}`;v+=p?`-${A}${C}`:"";const O=ja(f,void 0);u.setNumber(`${O}${v}`),o=parseInt(p?A:O),a=p?C:k})}function ou(t){return RegExp(/(\d+)([a-zA-Z]+)?(-(\d+)([a-zA-Z]+)?)?/).exec(t)}function au(t,e,n,r){e.getEditorState().read(()=>{for(const[s,i]of t){const o=Ee(s);if(dt(o)){if(i==="created"){const a=_l(o);if(!a)continue;const l=a.getNumber();n[l]||(n[l]=[]),n[l].push(s),r[s]=l}else if(i==="destroyed"){const a=r[s],l=n[a];if(!l)continue;const u=l.findIndex(d=>d===s);if(u===-1)continue;l.splice(u,1),Reflect.deleteProperty(r,s)}}}})}const Pf="formatted",bw="unformatted";let Pl;function _w(t){const e=kw(t);if(!e)throw new Error(`Invalid view mode: ${t}`);Pl=e}_w(Pf);const jr=()=>Pl;function kw(t){let e;switch(t){case Pf:e={markerMode:"hidden",noteMode:"collapsed",hasSpacing:!0,isFormattedFont:!0};break;case bw:e={markerMode:"editable",noteMode:"expanded",hasSpacing:!1,isFormattedFont:!1};break}return e}function vw(t){if(t)return t.markerMode==="editable"?Ge:Ye}function ww(t){const e=[],n=t??Pl;return n&&(e.push(`${Wb}${n.markerMode}`),n.hasSpacing&&e.push(Bb),n.isFormattedFont&&e.push(Hb)),e}let $a;function xw(t){t&&($a=t)}function Cw(t){return t.isEmpty()?od:Sw(t.toJSON())}function Sw(t){if(!t.root||!t.root.children)return;const e=t.root.children;if(e.length===1&&gl(e[0])&&(!e[0].children||e[0].children.length===0))return od;const n=$f(e),r=on(n);return r?{type:us,version:ds,content:r}:void 0}function Tw(t,e){const{type:n,marker:r,unknownAttributes:s}=t;let i;return t.code!==""&&(i=t.code),Ne({type:n,marker:r,code:i,...s,content:e})}function Ew(t){const{marker:e,number:n,sid:r,altnumber:s,pubnumber:i,unknownAttributes:o}=t;return Ne({type:wt.getType(),marker:e,number:n,sid:r,altnumber:s,pubnumber:i,...o})}function Ow(t,e){const{marker:n,sid:r,altnumber:s,pubnumber:i,unknownAttributes:o}=t,a=e&&typeof e[0]=="string"?e[0]:void 0;let{number:l}=t;return l=of(n,a,l),Ne({type:wt.getType(),marker:n,number:l,sid:r,altnumber:s,pubnumber:i,...o})}function Mw(t){const{marker:e,sid:n,altnumber:r,pubnumber:s,unknownAttributes:i}=t,{text:o}=t;let{number:a}=t;return a=of(e,o,a),Ne({type:Ge.getType(),marker:e,number:a,sid:n,altnumber:r,pubnumber:s,...i})}function Aw(t,e){const{type:n,marker:r,unknownAttributes:s}=t,i=r===""?void 0:r;return e==null||e.forEach((o,a)=>{typeof o=="string"&&o.startsWith(ke)&&(e[a]=o.slice(1))}),Ne({type:n,marker:i,...s,content:e})}function jw(t,e){const{type:n,marker:r,unknownAttributes:s}=t;return Ne({type:n,marker:r,...s,content:e})}function Nw(t,e){const{type:n,marker:r,caller:s,category:i,unknownAttributes:o}=t;return Ne({type:n,marker:r,caller:s,category:i,...o,content:e})}function sr(t){const{type:e,marker:n,sid:r,eid:s,unknownAttributes:i}=t;return Ne({type:e,marker:n===""?void 0:n,sid:r,eid:s,...i})}function Iw(t){return t.text}function Rw(t,e){const{tag:n,marker:r,unknownAttributes:s}=t;return Ne({type:n,marker:r,...s,content:e})}function Pw(t){const{marker:e}=t;return{type:Di,marker:e===""?void 0:e}}function lu(t,e){const n=t[t.length-1];n&&typeof n=="string"?t[t.length-1]=n+e:t.push(e)}function $w(t,e,n,r,s){const i=Lt.getType(),o=e.filter(a=>!n.includes(a));if(n.filter(a=>!e.includes(a)).forEach(a=>{const l=sr({type:i,marker:ar,eid:a});s.push(l)}),o.forEach(a=>{const l=sr({type:i,marker:Fn,sid:a});s.push(l)}),e.length===0){const a=sr({type:i,marker:Fn});s.push(a)}if(s.push(...t),e.length===0){const a=sr({type:i,marker:ar});s.push(a)}(!r||!$_(r))&&e.forEach(a=>{const l=sr({type:i,marker:ar,eid:a});s.push(l)})}function on(t,e){const n=[];let r,s=[];return t.forEach((i,o)=>{const a=i,l=i,u=i,d=i,f=i,h=i,p=i,y=i;switch(i.type){case ht.getType():n.push(Tw(a,on(a.children)));break;case Qt.getType():n.push(Ew(i));break;case wt.getType():n.push(Ow(l,on(l.children)));break;case Ye.getType():case Ge.getType():n.push(Mw(i));break;case Ce.getType():n.push(Aw(u,on(u.children)));break;case nt.getType():n.push(jw(d,on(d.children)));break;case $e.getType():n.push(Nw(f,on(f.children,f.caller)));break;case vn.getType():case _t.getType():case xd.getType():case wn.getType():break;case Fe.getType():if(r=on(p.children),r){const k=p.typedIDs[dn];if(k)$w(r,k,s,t[o+1],n),s=k;else{const C=r.shift();C&&(typeof C=="string"?lu(n,C):n.push(C)),r.length>0&&n.push(...r)}}break;case Lt.getType():n.push(sr(i));break;case Nt.getType():h.text&&h.text!==ke&&!h.text.startsWith(dl)&&(!e||h.text!==vl(e))&&lu(n,Iw(h));break;case Hn.getType():n.push(Rw(y,on(y.children)));break;case xn.getType():n.push(Pw(i));break;default:$a==null||$a.error(`Unexpected node type '${i.type}'!`)}}),n&&n.length>0?n:void 0}function $f(t){const e=t.findIndex(n=>gl(n));if(e>=0){const n=t.slice(0,e),r=t[e].children,s=$f(t.slice(e+1));t=[...n,...r,...s]}return t}const ha={initialize:xw,deserializeEditorState:Cw},cu=Lf([]),Lw={type:xd.getType(),version:1};let Ui=[],Q,Si,La,we;function Dw(t,e){Ui=[],Uw(t),Bw(e)}function Fw(t=0){}function qw(t,e){Q=e??jr();let n;return t?(t.type!==us&&(we==null||we.warn(`This USJ type '${t.type}' didn't match the expected type '${us}'.`)),t.version!==ds&&(we==null||we.warn(`This USJ version '${t.version}' didn't match the expected version '${ds}'.`)),t.content.length>0?n=Fa(rs(t.content)):n=[cu]):n=[cu],La==null||La(Ui),{root:{children:n,direction:null,format:"",indent:0,type:"root",version:1}}}function Uw(t){t&&(Si=t),t!=null&&t.addMissingComments&&(La=t.addMissingComments)}function Bw(t){t&&(we=t)}function Hw(t){return!t||t.length!==1||typeof t[0]!="string"?"":t[0]}function Ww(t){let{marker:e}=t;e!==bs&&(we==null||we.warn(`Unexpected book marker '${e}'!`)),e=e??bs;const{code:n}=t;(!n||!ht.isValidBookCode(n))&&(we==null||we.warn(`Unexpected book code '${n}'!`));const r=[];((Q==null?void 0:Q.markerMode)==="editable"||(Q==null?void 0:Q.markerMode)==="visible")&&r.push(Un("marker",en(e)+" "+n+ke));const s=Hw(t.content);s&&r.push(mn(s));const i=je(t,qb);return Ne({type:ht.getType(),marker:e,code:n??"",unknownAttributes:i,children:r,direction:null,format:"",indent:0,version:qh})}function Kw(t){let{marker:e}=t;e!==Pi&&(we==null||we.warn(`Unexpected chapter marker '${e}'!`)),e=e??Pi;const{number:n,sid:r,altnumber:s,pubnumber:i}=t,o=je(t,Jb);let a;return(Q==null?void 0:Q.markerMode)==="visible"&&(a=!0),(Q==null?void 0:Q.markerMode)==="editable"?Ne({type:wt.getType(),marker:e,number:n??"",sid:r,altnumber:s,pubnumber:i,unknownAttributes:o,children:[mn(Ts(e,n)??"")],direction:null,format:"",indent:0,version:Hh}):Ne({type:Qt.getType(),marker:e,number:n??"",showMarker:a,sid:r,altnumber:s,pubnumber:i,unknownAttributes:o,version:Vh})}function Jw(t){let{marker:e}=t;e!==$i&&(we==null||we.warn(`Unexpected verse marker '${e}'!`)),e=e??$i;const{number:n,sid:r,altnumber:s,pubnumber:i}=t,o=(vw(Q)??Ye).getType(),a=(Q==null?void 0:Q.markerMode)==="editable"?nf:_f;let l,u;(Q==null?void 0:Q.markerMode)==="editable"?l=Ts(e,n):(Q==null?void 0:Q.markerMode)==="visible"&&(u=!0);const d=je(t,p_);return Ne({type:o,text:l,marker:e,number:n??"",sid:r,altnumber:s,pubnumber:i,showMarker:u,unknownAttributes:d,version:a})}function zw(t,e=[]){let{marker:n}=t;Ce.isValidMarker(n)||we==null||we.warn(`Unexpected char marker '${n}'!`),n=n??"";const r=[];(Q==null?void 0:Q.markerMode)==="editable"&&e.forEach(i=>{kl(i)&&(i.text=ke+i.text)}),e.length===0&&e.push(mn(Gt)),Df(t.marker??"",r),r.push(...e),Ff(t.marker??"",r);const s=je(t,Gb);return Ne({type:Ce.getType(),marker:n,unknownAttributes:s,children:r,direction:null,format:"",indent:0,version:zh})}function Lf(t){return{type:pn.getType(),children:t,direction:null,format:"",indent:0,textFormat:0,textStyle:"",version:Xh}}function Vw(t,e=[]){let{marker:n}=t;nt.isValidMarker(n)||we==null||we.warn(`Unexpected para marker '${n}'!`),n=n??Qi;const r=[];(Q==null?void 0:Q.markerMode)==="editable"?r.push(_r(n),mn(ke,"marker-trailing-space")):(Q==null?void 0:Q.markerMode)==="visible"&&r.push(Un("marker",en(n)+ke)),r.push(...e);const s=je(t,d_);return Ne({type:nt.getType(),marker:n,unknownAttributes:s,children:r,direction:null,format:"",indent:0,textFormat:0,textStyle:"",version:tf})}function Gw(t,e){const n=E_(e);let r=()=>{};return Si!=null&&Si.noteCallerOnClick&&(r=Si.noteCallerOnClick),Ne({type:_t.getType(),caller:t,previewText:n,onClick:r,version:Sf})}function Yw(t,e){let{marker:n}=t;$e.isValidMarker(n)||we==null||we.warn(`Unexpected note marker '${n}'!`),n=n??ml;const{category:r}=t,s=t.caller??"*",i=(Q==null?void 0:Q.noteMode)!=="expanded",o=je(t,a_);let a,l;(Q==null?void 0:Q.markerMode)==="editable"?(a=_r(n),l=_r(n,"closing")):(Q==null?void 0:Q.markerMode)==="visible"&&(a=Un("marker",en(n)+" "),l=Un("marker",mr(n)));const u=[];let d;if(a&&u.push(a),(Q==null?void 0:Q.markerMode)==="editable")d=mn(vl(s)),u.push(d,...e);else{const f=mn(ke);d=Gw(s,e),u.push(d,f,...e.flatMap(Xw(f)))}return l&&u.push(l),Ne({type:$e.getType(),marker:n,caller:s,isCollapsed:i,category:r,unknownAttributes:o,children:u,direction:null,format:"",indent:0,version:ef})}function Xw(t){return e=>Dh(e)?[e]:[e,t]}function Zw(t){let{marker:e}=t;(!e||!Lt.isValidMarker(e))&&(we==null||we.warn(`Unexpected milestone marker '${e}'!`)),e=e??"";const{sid:n,eid:r}=t,s=je(t,s_);return Ne({type:Lt.getType(),marker:e,sid:n,eid:r,unknownAttributes:s,version:Zh})}function uu(t,e=[]){return{type:Fe.getType(),typedIDs:{[dn]:e},children:t,direction:null,format:"",indent:0,version:1}}function Qw(t,e){const{marker:n}=t,r=t.type,s=je(t,Lb),i=[...e];return i.forEach(o=>{kl(o)&&(o.mode="token")}),Ne({type:Hn.getType(),tag:r,marker:n,unknownAttributes:s,children:i,direction:null,format:"",indent:0,version:Fh})}function ex(t){return{type:xn.getType(),marker:t,version:hf}}function _r(t,e="opening"){return{type:wn.getType(),marker:t,markerSyntax:e,text:"",detail:0,format:0,mode:"normal",style:"",version:1}}function mn(t,e=void 0,n="normal"){const r={type:Nt.getType(),text:t,detail:0,format:0,mode:n,style:"",version:1};return e!==void 0&&(r[Sd]={textType:e}),r}function Un(t,e){return{type:vn.getType(),text:e,textType:t,version:Lh}}function Df(t,e){(Q==null?void 0:Q.markerMode)==="editable"?e.push(_r(t)):(Q==null?void 0:Q.markerMode)==="visible"&&e.push(Un("marker",en(t)))}function Ff(t,e,n=!1){Ce.isValidFootnoteMarker(t)||Ce.isValidCrossReferenceMarker(t)||((Q==null?void 0:Q.markerMode)==="editable"?n?e.push(_r("","selfClosing")):e.push(_r(t,"closing")):(Q==null?void 0:Q.markerMode)==="visible"&&e.push(Un("marker",mr(n?"":t))))}function tx(t,e){if(t.type!=="ms")return;const n=[];if(t.sid&&n.push(`sid="${t.sid}"`),t.eid&&n.push(`eid="${t.eid}"`),n.length<=0)return;const r=dl+n.join(" ");(Q==null?void 0:Q.markerMode)==="editable"?e.push(mn(r,"attribute")):(Q==null?void 0:Q.markerMode)==="visible"&&e.push(Un("attribute",r))}function du(t,e){return t.length<=0||e===0?t:t.map(n=>n-e)}function nx(t,e){const n=t.indexOf(e,0);n>-1&&t.splice(n,1)}function hu(t,e){e.marker===Fn&&e.sid!==void 0&&t.push(e.sid),e.marker===ar&&e.eid!==void 0&&nx(t,e.eid)}function Da(t,e,n=!1,r=[]){if(e.length<=0||e[0]>=t.length)return t;const s=e.shift(),i=e.length>0?e.shift():t.length-1;if(s===void 0||i===void 0||i>=t.length||t.length<=0)return t;const o=t.slice(0,s),a=n?[uu(o,[...r])]:o,l=t[s];hu(r,l);const u=Da(t.slice(s+1,i),du(e,s+1),l.marker===Fn,r),d=uu(u,[...r]),f=t[i];hu(r,f);const h=Da(t.slice(i+1),du(e,i+1),f.marker===Fn,r);return[...a,d,...h]}function rs(t){const e=[],n=[];return t==null||t.forEach(r=>{if(typeof r=="string")r&&n.push(mn(r));else if(!r.type)we==null||we.error("Marker type is missing!");else switch(r.type){case ht.getType():n.push(Ww(r));break;case wt.getType():n.push(Kw(r));break;case Ge.getType():Q!=null&&Q.hasSpacing||n.push(Lw),n.push(Jw(r));break;case Ce.getType():n.push(zw(r,rs(r.content)));break;case nt.getType():n.push(Vw(r,rs(r.content)));break;case $e.getType():n.push(Yw(r,rs(r.content)));break;case Lt.getType():i_(r.marker??"")&&(e.push(n.length),r.sid!==void 0&&(Ui==null||Ui.push(r.sid))),n.push(Zw(r)),Df(r.marker??"",n),tx(r,n),Ff(r.marker??"",n,!0);break;case xn.getType():n.push(ex(r.marker??""));break;default:we==null||we.warn(`Unknown type-marker '${r.type}-${r.marker}'!`),n.push(Qw(r,rs(r.content)))}}),Da(n,e)}function Fa(t){const e=t.findIndex(n=>Ub(n)||m_(n)||f_(n));if(e>=0){const n=Fa(t.slice(0,e)),r=t[e],s=Fa(t.slice(e+1));return[...n,r,...s]}else if(t.some(n=>"text"in n&&"mode"in n||ck(n)))return[Lf(t)];return t}const qa={initialize:Dw,reset:Fw,serializeEditorState:qw},ii=t=>{if(!$e.isValidMarker(t)||!t.includes("f"))throw new Error(`Invalid footnote marker '${t}'`);return{action:e=>{const{chapterNum:n,verseNum:r}=e.reference,s=[];return n!==void 0&&r!==void 0&&s.push({type:"char",marker:"fr",content:[`${n}:${r} `]}),e.noteText&&s.push({type:"char",marker:"fq",content:[e.noteText]}),s.push({type:"char",marker:"ft"}),[{type:"note",marker:t,caller:$t,content:s}]}}},fu=t=>{if(!$e.isValidMarker(t)||!t.includes("x"))throw new Error(`Invalid cross-reference marker '${t}'`);return{action:e=>{const{chapterNum:n,verseNum:r}=e.reference,s=[];return n!==void 0&&r!==void 0&&s.push({type:"char",marker:"xo",content:[`${n}:${r} `]}),e.noteText&&s.push({type:"char",marker:"xq",content:[e.noteText]}),s.push({type:"char",marker:"xt"}),[{type:"note",marker:t,caller:gr,content:s}]}}},rx={c:{action:t=>{const{chapterNum:e}=t.reference;return[{type:"chapter",marker:"c",number:`${e+1}`}]}},v:{action:t=>{const{verseNum:e,verse:n}=t.reference;return[{type:"verse",marker:"v",number:`${ja(e,n)}`}]}},f:ii("f"),fe:ii("fe"),ef:ii("ef"),efe:ii("efe"),x:fu("x"),ex:fu("ex")};function sx(t,e,n,r,s){const i=ix(t);return{action:o=>{o.editor.update(()=>{var a;const l=re();Z(l)&&(o.noteText=l.getTextContent());const u=(a=i==null?void 0:i.action)==null?void 0:a.call(i,o);if(!u)return;const d=Uc(u,qa,r),f=sa(d);if(Z(l)){const h=l.anchor.getNode();if(ae(f))kf(f,l,r),f.getIsCollapsed()||(e.current=f.getKey());else if(l.getTextContent().length>0)ox(l,()=>sa(d));else if(se(f)&&!f.isInline()){const p=l.insertParagraph();if(p){const y=p.getChildren();f.append(...y),p.replace(f),f.selectStart()}}else if(Y(h)&&!Dt(h)&&ae(h.getParent())&&l.isCollapsed()){let p=h.insertAfter(f);if(Or(f)){const y={...r||jr(),markerMode:"hidden"},k=Uc(u,qa,y),C=sa(k);p=p.insertAfter(C)}p.insertAfter(_e(ke))}else{l.insertNodes([f]),dx(f);const p=f.getNextSibling();p?p.selectStart():f.selectStart()}}else l==null||l.insertNodes([f])},s)},label:i==null?void 0:i.label}}function ix(t){let e=rx[t];return e||(nt.isValidMarker(t)?e={action:()=>[{type:nt.getType(),marker:t,content:[]}]}:Ce.isValidMarker(t)&&(e={action:()=>[{type:Ce.getType(),marker:t}]})),e}function ox(t,e){const n=t.getNodes(),[r,s]=ax(t);let i;n.forEach((o,a)=>{if(se(i)&&i.isParentOf(o))return;const l=lx(o,a===0,a===n.length-1,r,s);if(!l){i=void 0;return}i||(i=e(),l.insertBefore(i)),ux(l,i)}),(Y(i)||se(i))&&i.selectEnd()}function ax(t){const e=t.anchor.offset,n=t.focus.offset;return t.isBackward()?[n,e]:[e,n]}function lx(t,e,n,r,s){if(!(Se(t)||ae(t)||ae(t.getParent()))){if(Y(t))return cx(t,e,n,r,s);if(se(t)&&t.isInline())return t}}function cx(t,e,n,r,s){const i=t.getTextContentSize(),o=e?r:0,a=n?s:i;if(o===0&&a===0)return;const l=t.splitText(o,a);return l.length===1?l[0]:l.length===3||a===i?l[1]:l[0]}function ux(t,e){var n;if(Y(e)){const r=pu(t,e);e.setTextContent(r),t.remove()}else if(se(e)){const r=e.getChildrenSize();e.append(t);for(let s=0;s<r;s++)(n=e.getFirstChild())==null||n.remove();pu(t,e)}}function pu(t,e){let n=t.getTextContent();if(Y(t)&&e.isInline()&&n.startsWith(" ")){n=n.trimStart(),t.setTextContent(n);const r=e.getPreviousSibling();El(r),Y(r)||e.insertBefore(_e(" "))}return n}function dx(t){dt(t)&&(El(t.getPreviousSibling()),xf(t.getNextSibling()))}const qf={chapter:"chapter",verse:"verse",char:"char",para:"para",typedMark:"editor-typed-mark",typedMarkOverlap:"editor-typed-markOverlap",mark:"editor-mark",markOverlap:"editor-markOverlap",placeholder:"editor-placeholder",paragraph:"editor-paragraph",quote:"editor-quote",heading:{h1:"editor-heading-h1",h2:"editor-heading-h2",h3:"editor-heading-h3",h4:"editor-heading-h4",h5:"editor-heading-h5"},list:{nested:{listitem:"editor-nested-listitem"},ol:"editor-list-ol",ul:"editor-list-ul",listitem:"editor-listitem"},image:"editor-image",link:"editor-link",text:{bold:"editor-text-bold",italic:"editor-text-italic",overflowed:"editor-text-overflowed",hashtag:"editor-text-hashtag",underline:"editor-text-underline",strikethrough:"editor-text-strikethrough",underlineStrikethrough:"editor-text-underlineStrikethrough"}};function hx({scrRef:t,onScrRefChange:e}){const[n]=ue(),r=b.useRef(!1),s=b.useRef(!1),{book:i,chapterNum:o,verseNum:a}=t;return b.useEffect(()=>n.registerMutationListener(ht,l=>{n.update(()=>{for(const[u,d]of l){const f=Ee(u);f&&Pt(f)&&d==="created"&&gu(o,a,s)}},{tag:Oa})},{skipInitialization:!0}),[n,o,a]),b.useEffect(()=>{r.current?r.current=!1:n.update(()=>gu(o,a,s),{tag:Oa})},[n,o,a]),b.useEffect(()=>n.registerCommand(ws,()=>(s.current?s.current=!1:fx(i,o,a,e,r),!1),kr),[n,i,o,a,e]),null}function gu(t,e,n){var r;const s=cf(re()),i=(r=wf(s))==null?void 0:r.getNumber();if(O_(i)&&xl(e,i))return;const o=vt().getChildren(),a=y_(o,t),l=T_(o,a),u=b_(l,!!a);if(u&&!a||!a)return;S_(l,u);const d=mk(l,e);if(d){if(Je(d)){const f=d.getFirstChild();Y(f)?f.select(0,0):d.select(0,0)}else d.selectNext(0,0);n.current=!0}}function fx(t,e,n,r,s){const i=cf(re());if(!i)return;const o=_l(i),a=parseInt((o==null?void 0:o.getNumber())??"1",10),l=wf(i),u=l==null?void 0:l.getNumber(),d=parseInt(u??"0",10),f=u?xl(n,u):n===d;if(s.current=!!(o&&a!==e||!f),s.current){const h={book:t,chapterNum:a,verseNum:d};u!=null&&d.toString()!==u&&(h.verse=u),r(h)}}function px(t){return Pt(t)?`${t.__code}`:fl(t)?`${t.__marker} "${t.__number}"`:ge(t)?`${t.__marker}`:Ss(t)?`${t.__marker} "${t.__number}"`:Cn(t)?`${t.__caller}`:Mr(t)?`${t.__marker} "${t.__number}"`:ae(t)?`${t.__marker} "${t.__caller}"`+(t.__isCollapsed?" (collapsed)":" (expanded)"):Je(t)?`${t.__marker}`:Y(t)?`"${t.__text}"${gx(t)}`:Se(t)?`ids: [ ${JSON.stringify(t.getTypedIDs())} ]`:bl(t)?`${t.__marker} "${t.__number}"`:""}function gx(t){return t.__state?" "+JSON.stringify(t.__state.toJSON()[Sd]):""}function mx(){const[t]=ue();return m.jsx(km,{viewClassName:"tree-view-output",treeTypeButtonClassName:"debug-treetype-button",timeTravelPanelClassName:"debug-timetravel-panel",timeTravelButtonClassName:"debug-timetravel-button",timeTravelPanelSliderClassName:"debug-timetravel-panel-slider",timeTravelPanelButtonClassName:"debug-timetravel-panel-button",customPrintNode:px,editor:t})}const Uf=b.createContext(null),mu=4;function yx({children:t,className:e,onClick:n,title:r}){const s=b.useRef(null),i=b.useContext(Uf);if(i===null)throw new Error("DropDownItem must be used within a DropDown");const{registerItem:o}=i;return b.useEffect(()=>{s&&s.current&&o(s)},[s,o]),m.jsx("button",{className:e,onClick:n,ref:s,title:r,type:"button",children:t})}function bx({children:t,dropDownRef:e,onClose:n}){const[r,s]=b.useState(),[i,o]=b.useState(),a=b.useCallback(d=>{s(f=>f?[...f,d]:[d])},[s]),l=d=>{if(!r)return;const f=d.key;["Escape","ArrowUp","ArrowDown","Tab"].includes(f)&&d.preventDefault(),f==="Escape"||f==="Tab"?n():f==="ArrowUp"?o(h=>{if(!h)return r[0];const p=r.indexOf(h)-1;return r[p===-1?r.length-1:p]}):f==="ArrowDown"&&o(h=>h?r[r.indexOf(h)+1]:r[0])},u=b.useMemo(()=>({registerItem:a}),[a]);return b.useEffect(()=>{r&&!i&&o(r[0]),i&&i.current&&i.current.focus()},[r,i]),m.jsx(Uf.Provider,{value:u,children:m.jsx("div",{className:"dropdown",ref:e,onKeyDown:l,children:t})})}function _x({disabled:t=!1,buttonLabel:e,buttonAriaLabel:n,buttonClassName:r,buttonIconClassName:s,children:i,stopCloseOnClickSelf:o}){const a=b.useRef(null),l=b.useRef(null),[u,d]=b.useState(!1),f=()=>{d(!1),l&&l.current&&l.current.focus()};return b.useEffect(()=>{const h=l.current,p=a.current;if(u&&h!==null&&p!==null){const{top:y,left:k}=h.getBoundingClientRect();p.style.top=`${y+h.offsetHeight+mu}px`,p.style.left=`${Math.min(k,window.innerWidth-p.offsetWidth-20)}px`}},[a,l,u]),b.useEffect(()=>{const h=l.current;if(h!==null&&u){const p=y=>{const k=y.target;o&&a.current&&a.current.contains(k)||h.contains(k)||d(!1)};return document.addEventListener("click",p),()=>{document.removeEventListener("click",p)}}return()=>{}},[a,l,u,o]),b.useEffect(()=>{const h=()=>{if(u){const p=l.current,y=a.current;if(p!==null&&y!==null){const{top:k}=p.getBoundingClientRect(),C=k+p.offsetHeight+mu;C!==y.getBoundingClientRect().top&&(y.style.top=`${C}px`)}}};return document.addEventListener("scroll",h),()=>{document.removeEventListener("scroll",h)}},[l,a,u]),m.jsxs(m.Fragment,{children:[m.jsxs("button",{type:"button",disabled:t,"aria-label":n||e,className:r,onClick:()=>d(!u),ref:l,children:[s&&m.jsx("span",{className:s}),e&&m.jsx("span",{className:"text dropdown-button-text",children:e}),m.jsx("i",{className:"chevron-down"})]}),u&&jt.createPortal(m.jsx(bx,{dropDownRef:a,onClose:f,children:i}),document.body)]})}const Ua={m:"m - Paragraph - Margin - No First Line Indent",ms:"ms - Heading - Major Section Level 1",nb:"nb - Paragraph - No Break with Previous Paragraph",p:"p - Paragraph - Normal - First Line Indent",pi:"pi - Paragraph - Indented - Level 1 - First Line Indent",q1:"q1 - Poetry - Indent Level 1",q2:"q2 - Poetry - Indent Level 2",r:"r - Heading - Parallel References",s:"s - Heading - Section Level 1"},Ba={...Ua,ide:"ide - File - Encoding",h:"h - File - Header",h1:"h1 - File - Header",h2:"h2 - File - Left Header",h3:"h3 - File - Right Header",toc1:"toc1 - File - Long Table of Contents Text",toc2:"toc2 - File - Short Table of Contents Text",toc3:"toc3 - File - Book Abbreviation",cl:"cl - Chapter - Publishing Label",mt:"mt - Title - Major Title Level 1",mt1:"mt1 - Title - Major Title Level 1",mt2:"mt2 - Title - Major Title Level 2",mt3:"mt3 - Title - Major Title Level 3",mt4:"mt4 - Title - Major Title Level 4",ms1:"ms1 - Heading - Major Section Level 1",ms2:"ms2 - Heading - Major Section Level 2",ms3:"ms3 - Heading - Major Section Level 3",b:"b - Poetry - Stanza Break (Blank Line)"};function kx({editorRef:t,blockMarker:e,disabled:n=!1}){return m.jsx(_x,{disabled:n,buttonClassName:"toolbar-item block-controls",buttonIconClassName:"icon block-marker "+vx(e),buttonLabel:wx(e),buttonAriaLabel:"Formatting options for block type",children:Object.keys(Ua).map(r=>m.jsxs(yx,{className:"item block-marker "+xx(e===r),onClick:()=>{var s;return(s=t.current)==null?void 0:s.formatPara(r)},children:[m.jsx("i",{className:"icon block-marker "+r}),m.jsx("span",{className:"text usfm_"+r,children:Ua[r]})]},r))})}function vx(t){return t&&t in Ba?t:"ban"}function wx(t){return t&&t in Ba?Ba[t]:"No Style"}function xx(t){return t?"active dropdown-item-active":""}function yu(){return m.jsx("div",{className:"divider"})}const Cx=b.forwardRef(function({editorRef:t,isReadonly:e=!1,onStateChange:n},r){const[s]=ue(),[i,o]=b.useState(s),[a,l]=b.useState(),[u,d]=b.useState(!1),[f,h]=b.useState(!1),p=b.useCallback(({canUndo:y,canRedo:k,blockMarker:C,contextMarker:A})=>{d(y),h(k),l(C),n==null||n({canUndo:y,canRedo:k,blockMarker:C,contextMarker:A})},[n]);return b.useEffect(()=>s.registerCommand(ws,(y,k)=>(o(k),!1),ss),[s]),m.jsxs(m.Fragment,{children:[m.jsx(Rf,{onStateChange:p}),m.jsxs("div",{className:"toolbar",children:[m.jsx("button",{disabled:!u||e,onClick:()=>{i.dispatchCommand(Ja,void 0)},title:ga?"Undo (Z)":"Undo (Ctrl+Z)",type:"button",className:"toolbar-item spaced","aria-label":"Undo",children:m.jsx("i",{className:"format undo"})}),m.jsx("button",{disabled:!f||e,onClick:()=>{i.dispatchCommand(Ka,void 0)},title:ga?"Redo (Y)":"Redo (Ctrl+Y)",type:"button",className:"toolbar-item","aria-label":"Redo",children:m.jsx("i",{className:"format redo"})}),m.jsx(yu,{}),i===s&&m.jsxs(m.Fragment,{children:[m.jsx(kx,{editorRef:t,blockMarker:a,disabled:e}),m.jsx(yu,{})]}),m.jsx("div",{ref:r,className:"end-container"})]})]})}),bu={namespace:"platformEditor",theme:qf,editable:!0,editorState:void 0,onError(t){throw t},nodes:[Fe,...Uk]},Sx=jr(),Tx={},Ex={};function Ox(){return m.jsx("div",{className:"editor-placeholder",children:"Enter some Scripture..."})}const Bf=b.forwardRef(function({defaultUsj:t,scrRef:e,onScrRefChange:n,onSelectionChange:r,onUsjChange:s,onStateChange:i,options:o,logger:a,children:l},u){const d=b.useRef(null),f=b.useRef(null),h=b.useRef(null),p=b.useRef(t),y=b.useRef(),[k,C]=b.useState(t),[A,v]=b.useState(0),[O,I]=b.useState(),{isReadonly:L=!1,hasExternalUI:q=!1,hasSpellCheck:F=!1,textDirection:$="ltr",markerMenuTrigger:H="\\",view:W=Sx,nodes:_=Tx,debug:j=!1}=o??Ex;bu.editable=!L,ha.initialize(a),b.useImperativeHandle(u,()=>({focus(){var E;(E=d.current)==null||E.focus()},undo(){var E;(E=d.current)==null||E.dispatchCommand(Ja,void 0)},redo(){var E;(E=d.current)==null||E.dispatchCommand(Ka,void 0)},cut(){var E;(E=d.current)==null||E.dispatchCommand(Wi,null)},copy(){var E;(E=d.current)==null||E.dispatchCommand(Ki,null)},paste(){d.current&&Il(d.current)},pastePlainText(){d.current&&Rl(d.current)},getUsj(){return p.current},setUsj(E){if(!an(p.current,E)){p.current=E;const M=an(k,E);C(E),M&&v(N=>N+1)}},applyUpdate(E,M="remote"){var N,D;(N=d.current)==null||N.update(()=>{M==="remote"&&Bl(Aa),uv(E,W,_,a)},{discrete:!0});const U=(D=d.current)==null?void 0:D.getEditorState();if(!U)return;const B=ha.deserializeEditorState(U);if(B){const z=!an(p.current,B);if(z&&(p.current=B),z||!an(k,B)){const J=Bc(E,U);s==null||s(B,E,M,J)}}},replaceEmbedUpdate(E,M){var N;const D=(N=d.current)==null?void 0:N.read(()=>X_(E,M));D&&this.applyUpdate(D)},getSelection(){var E;return(E=d.current)==null?void 0:E.read(mf)},setSelection(E){var M;(M=d.current)==null||M.update(()=>{const N=Sl(E);N!==void 0&&(bd(N),Bl(Bh))})},setAnnotation(E,M,N,D,U){var B;(B=f.current)==null||B.setAnnotation(E,Fc(M),N,D,U)},removeAnnotation(E,M){var N;(N=f.current)==null||N.removeAnnotation(Fc(E),M)},formatPara(E){var M;(M=d.current)==null||M.update(()=>{const N=re();Z(N)&&Gp(N,()=>_s(E))})},getElementByKey(E){var M;return(M=d.current)==null?void 0:M.read(()=>{var N;return((N=d.current)==null?void 0:N.getElementByKey(E))??void 0})},insertNote(E,M,N){var D;(D=d.current)==null||D.update(()=>{const U=uk(E,M,N,e,W,_,a);U&&!U.getIsCollapsed()&&(y.current=U.getKey())})},selectNote(E){var M;(M=d.current)==null||M.update(()=>{const N=zc(E);N&&(hk(N,W),N.getIsCollapsed()||(y.current=N.getKey()))})},getNoteOps(E){var M;return(M=d.current)==null?void 0:M.read(()=>{const N=zc(E);if(N)return Ml(N)})},get toolbarEndRef(){return h}}));const x=b.useCallback((E,M,N,D)=>{if(Kb.some(B=>N.has(B)))return;const U=ha.deserializeEditorState(E);if(U){const B=!an(p.current,U);if(B&&(p.current=U),B||!an(k,U)){const z=N.has(Aa)?"remote":"local",J=Bc(D,E);s==null||s(U,D,z,J)}}},[k,s]),P=b.useCallback(E=>{I(E.contextMarker),i==null||i(E)},[i]);return m.jsxs(_d,{initialConfig:bu,children:[m.jsx(Bv,{isEditable:!L}),m.jsxs("div",{className:"editor-container",children:[q?m.jsx(Rf,{onStateChange:P}):m.jsx("div",{className:"editor-toolbar-container"+(L?"-readonly":"-editable"),children:m.jsx(Cx,{ref:h,editorRef:u,isReadonly:L,onStateChange:P})}),m.jsxs("div",{className:"editor-inner",children:[m.jsx(Bd,{editorRef:d}),m.jsx(Yp,{contentEditable:m.jsx(vd,{className:`editor-input usfm ${ww(W).join(" ")}`,spellCheck:F}),placeholder:m.jsx(Ox,{}),ErrorBoundary:kd}),m.jsx(Kd,{}),e&&n&&m.jsx(hx,{scrRef:e,onScrRefChange:n}),e&&m.jsx(fw,{trigger:H,scrRef:e,contextMarker:O,getMarkerAction:(E,M)=>sx(E,y,M,W)}),m.jsx(Hv,{scripture:k,scriptureRef:p,nodeOptions:_,editorAdaptor:qa,viewOptions:W,logger:a},A),m.jsx(nw,{onChange:r}),m.jsx(lv,{onChange:x,ignoreSelectionChange:!0,ignoreHistoryMergeTagChange:!0}),m.jsx(av,{ref:f,logger:a}),m.jsx(Tv,{viewOptions:W}),m.jsx(Nv,{}),m.jsx($v,{}),m.jsx(Lv,{logger:a}),m.jsx(Uv,{}),m.jsx(Wv,{expandedNoteKeyRef:y,nodeOptions:_,viewOptions:W,logger:a}),m.jsx(rw,{}),m.jsx(ow,{textDirection:$}),m.jsx(lw,{}),l]}),j&&m.jsx(mx,{})]})]})}),Os=b.forwardRef(function(t,e){const{children:n,...r}=t;return m.jsx(Bf,{ref:e,...r})});function Hf(){return Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5)}function Bi(t,e,n,r,s){return{author:e,content:t,deleted:s===void 0?!1:s,id:n===void 0?Hf():n,timeStamp:r===void 0?performance.timeOrigin+performance.now():r,type:"comment"}}function Wf(t,e,n){return{comments:e,id:n===void 0?Hf():n,quote:t,type:"thread"}}function _u(t){return{comments:Array.from(t.comments),id:t.id,quote:t.quote,type:"thread"}}function Mx(t){return{author:t.author,content:"[Deleted Comment]",deleted:!0,id:t.id,timeStamp:t.timeStamp,type:"comment"}}function fa(t){const e=t._changeListeners;for(const n of e)n()}class Ax{constructor(e,n){K(this,"_editor"),K(this,"_comments"),K(this,"_changeListeners"),K(this,"_collabProvider"),K(this,"logger"),this._comments=[],this._editor=e,this.logger=n,this._collabProvider=null,this._changeListeners=new Set}isCollaborative(){return this._collabProvider!==null}getComments(){return this._comments}setComments(e){this._comments=e,fa(this)}addComment(e,n,r){const s=Array.from(this._comments),i=this._getCollabComments();if(n!==void 0&&e.type==="comment")for(let o=0;o<s.length;o++){const a=s[o];if(a.type==="thread"&&a.id===n.id){const l=_u(a);s.splice(o,1,l);const u=r!==void 0?r:l.comments.length;if(this.isCollaborative()&&i!==null){const d=i.get(o).get("comments");this._withRemoteTransaction(()=>{const f=this._createCollabSharedMap(e);d.insert(u,[f])})}l.comments.splice(u,0,e);break}}else{const o=r!==void 0?r:s.length;this.isCollaborative()&&i!==null&&this._withRemoteTransaction(()=>{const a=this._createCollabSharedMap(e);i.insert(o,[a])}),s.splice(o,0,e)}this._comments=s,fa(this)}deleteCommentOrThread(e,n){const r=Array.from(this._comments),s=this._getCollabComments();let i=null;if(n!==void 0)for(let o=0;o<r.length;o++){const a=r[o];if(a.type==="thread"&&a.id===n.id){const l=_u(a);r.splice(o,1,l);const u=l.comments;if(i=u.indexOf(e),this.isCollaborative()&&s!==null){const d=s.get(o).get("comments"),f=i;this._withRemoteTransaction(()=>{d.delete(f)})}u.splice(i,1);break}}else i=r.indexOf(e),this.isCollaborative()&&s!==null&&this._withRemoteTransaction(()=>{s.delete(i)}),r.splice(i,1);return this._comments=r,fa(this),e.type==="comment"?{index:i,markedComment:Mx(e)}:null}registerOnChange(e){const n=this._changeListeners;return n.add(e),()=>{n.delete(e)}}_withRemoteTransaction(e){const n=this._collabProvider;n!==null&&n.doc.transact(e,this)}_withLocalTransaction(e){const n=this._collabProvider;try{this._collabProvider=null,e()}finally{this._collabProvider=n}}_getCollabComments(){const e=this._collabProvider;return e!==null?e.doc.get("comments",Pn):null}_createCollabSharedMap(e){const n=new dr,r=e.type,s=e.id;if(n.set("type",r),n.set("id",s),r==="comment")n.set("author",e.author),n.set("content",e.content),n.set("deleted",e.deleted),n.set("timeStamp",e.timeStamp);else{n.set("quote",e.quote);const i=new Pn;e.comments.forEach((o,a)=>{const l=this._createCollabSharedMap(o);i.insert(a,[l])}),n.set("comments",i)}return n}registerCollaboration(e){this._collabProvider=e;const n=this._getCollabComments(),r=()=>{e.connect()},s=()=>{try{e.disconnect()}catch{}},i=this._editor.registerCommand(jb,a=>{var l,u;return r!==void 0&&s!==void 0&&(a?((l=this.logger)==null||l.info("Comments connected!"),r()):((u=this.logger)==null||u.info("Comments disconnected!"),s())),!1},kr),o=(a,l)=>{if(l.origin!==this){for(const u of a)if(u instanceof Oh){const d=u.target,f=u.delta;let h=0;for(const p of f){const y=p.insert,k=p.retain,C=p.delete,A=d.parent,v=d===n?void 0:A instanceof dr&&this._comments.find(O=>O.id===A.get("id"));if(Array.isArray(y)){const O=h;y.slice().reverse().forEach(I=>{const L=I.get("id"),q=I.get("type")==="thread"?Wf(I.get("quote"),I.get("comments").toArray().map(F=>Bi(F.get("content"),F.get("author"),F.get("id"),F.get("timeStamp"),F.get("deleted"))),L):Bi(I.get("content"),I.get("author"),L,I.get("timeStamp"),I.get("deleted"));this._withLocalTransaction(()=>{this.addComment(q,v,O)})})}else if(typeof k=="number")h+=k;else if(typeof C=="number")for(let O=0;O<C;O++){const I=v===void 0||v===!1?this._comments[h]:v.comments[h];this._withLocalTransaction(()=>{this.deleteCommentOrThread(I,v)}),h++}}}}};return n===null?()=>null:(n.observeDeep(o),r(),()=>{n.unobserveDeep(o),i(),this._collabProvider=null})}}function jx(t){const[e,n]=b.useState(t.getComments());return b.useEffect(()=>t.registerOnChange(()=>{n(t.getComments())}),[t]),e}function Nx({onClose:t,children:e,title:n,closeOnClickOutside:r}){const s=b.useRef(null);return b.useEffect(()=>{s.current!==null&&s.current.focus()},[]),b.useEffect(()=>{let i=null;const o=u=>{u.key==="Escape"&&t()},a=u=>{const d=u.target;s.current!==null&&!s.current.contains(d)&&r&&t()},l=s.current;return l!==null&&(i=l.parentElement,i!==null&&i.addEventListener("click",a)),window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o),i!==null&&(i==null||i.removeEventListener("click",a))}},[r,t]),m.jsx("div",{className:"Modal__overlay",role:"dialog",children:m.jsxs("div",{className:"Modal__modal",tabIndex:-1,ref:s,children:[m.jsx("h2",{className:"Modal__title",children:n}),m.jsx("button",{className:"Modal__closeButton","aria-label":"Close modal",type:"button",onClick:t,children:"X"}),m.jsx("div",{className:"Modal__content",children:e})]})})}function Ix({onClose:t,children:e,title:n,closeOnClickOutside:r=!1}){return jt.createPortal(m.jsx(Nx,{onClose:t,title:n,closeOnClickOutside:r,children:e}),document.body)}function Kf(){const[t,e]=b.useState(null),n=b.useCallback(()=>{e(null)},[]),r=b.useMemo(()=>{if(t===null)return null;const{title:i,content:o,closeOnClickOutside:a}=t;return m.jsx(Ix,{onClose:n,title:i,closeOnClickOutside:a,children:o})},[t,n]),s=b.useCallback((i,o,a=!1)=>{e({closeOnClickOutside:a,content:o(n),title:i})},[n]);return[r,s]}const Rx={...qf,paragraph:"CommentEditorTheme__paragraph"};function Px(...t){return t.filter(Boolean).join(" ")}function yn({"data-test-id":t,children:e,className:n,onClick:r,disabled:s,small:i,title:o}){return m.jsx("button",{disabled:s,className:Px("Button__root",s&&"Button__disabled",i&&"Button__small",n),onClick:r,title:o,"aria-label":o,...t&&{"data-test-id":t},children:e})}function $x({className:t}){return m.jsx(vd,{className:t||"ContentEditable__root"})}function Lx({children:t,className:e}){return m.jsx("div",{className:e||"Placeholder__root",children:t})}const ku=za("INSERT_INLINE_COMMAND");function Dx({anchorKey:t,editor:e,showComments:n,onAddComment:r}){const s=b.useRef(null),i=b.useCallback(()=>{const o=s.current,a=e.getRootElement(),l=e.getElementByKey(t);if(o!==null&&a!==null&&l!==null){const{right:u}=a.getBoundingClientRect(),{top:d}=l.getBoundingClientRect();o.style.left=`${u-20}px`,o.style.top=`${d-30}px`}},[t,e]);return b.useEffect(()=>(window.addEventListener("resize",i),()=>{window.removeEventListener("resize",i)}),[e,i]),b.useLayoutEffect(()=>{i()},[t,e,n,i]),m.jsx("div",{className:"CommentPlugin_AddCommentBox",ref:s,children:m.jsx("button",{className:"CommentPlugin_AddCommentBox_button",onClick:r,children:m.jsx("i",{className:"icon add-comment"})})})}function Fx({onEscape:t}){const[e]=ue();return b.useEffect(()=>e.registerCommand(gd,n=>t(n),bi),[e,t]),null}function Jf({className:t,autoFocus:e,onEscape:n,onChange:r,editorRef:s,placeholder:i="Type a comment..."}){return m.jsx(_d,{initialConfig:{namespace:"Commenting",nodes:[],onError:o=>{throw o},theme:Rx},children:m.jsxs("div",{className:"CommentPlugin_CommentInputBox_EditorContainer",children:[m.jsx(qm,{contentEditable:m.jsx($x,{className:t}),placeholder:m.jsx(Lx,{children:i}),ErrorBoundary:kd}),m.jsx(og,{onChange:r}),m.jsx(Kd,{}),e!==!1&&m.jsx(ag,{}),m.jsx(Fx,{onEscape:n}),m.jsx(lg,{}),s!==void 0&&m.jsx(Bd,{editorRef:s})]})})}function zf(t,e){return b.useCallback((n,r)=>{n.read(()=>{t(sg()),e(!ig(r.isComposing(),!0))})},[e,t])}function qx({editor:t,cancelAddComment:e,submitAddComment:n}){const[r,s]=b.useState(""),[i,o]=b.useState(!1),a=b.useRef(null),l=b.useMemo(()=>({container:document.createElement("div"),elements:[]}),[]),u=b.useRef(null),d=Gf(),f=b.useCallback(()=>{t.getEditorState().read(()=>{const k=re();if(Z(k)){u.current=k.clone();const C=k.anchor,A=k.focus,v=ng(t,C.getNode(),C.offset,A.getNode(),A.offset),O=a.current;if(v!==null&&O!==null){const{left:I,bottom:L,width:q}=v.getBoundingClientRect(),F=rg(t,v);let $=F.length===1?I+q/2-125:I-125;$<10&&($=10),O.style.left=`${$}px`,O.style.top=`${L+20+(window.pageYOffset||document.documentElement.scrollTop)}px`;const H=F.length,{container:W}=l,_=l.elements,j=_.length;for(let x=0;x<H;x++){const P=F[x];let E=_[x];E===void 0&&(E=document.createElement("span"),_[x]=E,W.appendChild(E));const M=`position:absolute;top:${P.top+(window.pageYOffset||document.documentElement.scrollTop)}px;left:${P.left}px;height:${P.height}px;width:${P.width}px;background-color:rgba(255, 212, 0, 0.3);pointer-events:none;z-index:5;`;E.style.cssText=M}for(let x=j-1;x>=H;x--){const P=_[x];W.removeChild(P),_.pop()}}}})},[t,l]);b.useLayoutEffect(()=>{f();const k=l.container,C=document.body;return C!==null?(C.appendChild(k),()=>{C.removeChild(k)}):()=>{}},[l.container,f]),b.useEffect(()=>(window.addEventListener("resize",f),()=>{window.removeEventListener("resize",f)}),[f]);const h=k=>(k.preventDefault(),e(),!0),p=()=>{if(i){let k=t.getEditorState().read(()=>{const C=u.current;return C?C.getTextContent():""});k.length>100&&(k=k.slice(0,99)+""),n(Wf(k,[Bi(r,d)]),!0,void 0,u.current),u.current=null}},y=zf(s,o);return m.jsxs("div",{className:"CommentPlugin_CommentInputBox",ref:a,children:[m.jsx(Jf,{className:"CommentPlugin_CommentInputBox_Editor",onEscape:h,onChange:y}),m.jsxs("div",{className:"CommentPlugin_CommentInputBox_Buttons",children:[m.jsx(yn,{onClick:e,className:"CommentPlugin_CommentInputBox_Button",children:"Cancel"}),m.jsx(yn,{onClick:p,disabled:!i,className:"CommentPlugin_CommentInputBox_Button primary",children:"Comment"})]})]})}function Ux({submitAddComment:t,thread:e,placeholder:n}){const[r,s]=b.useState(""),[i,o]=b.useState(!1),a=b.useRef(null),l=Gf(),u=zf(s,o);return m.jsxs(m.Fragment,{children:[m.jsx(Jf,{className:"CommentPlugin_CommentsPanel_Editor",autoFocus:!1,onEscape:()=>!0,onChange:u,editorRef:a,placeholder:n}),m.jsx(yn,{className:"CommentPlugin_CommentsPanel_SendButton",onClick:()=>{if(i){t(Bi(r,l),!1,e);const d=a.current;d!==null&&d.dispatchCommand(ud,void 0)}},disabled:!i,children:m.jsx("i",{className:"send"})})]})}function Vf({commentOrThread:t,deleteCommentOrThread:e,onClose:n,thread:r=void 0}){return m.jsxs(m.Fragment,{children:["Are you sure you want to delete this ",t.type,"?",m.jsxs("div",{className:"Modal__content",children:[m.jsx(yn,{onClick:()=>{e(t,r),n()},children:"Delete"})," ",m.jsx(yn,{onClick:()=>{n()},children:"Cancel"})]})]})}function vu({comment:t,deleteComment:e,thread:n,rtf:r}){const s=Math.round((t.timeStamp-(performance.timeOrigin+performance.now()))/1e3),i=Math.round(s/60),[o,a]=Kf();return m.jsxs("li",{className:"CommentPlugin_CommentsPanel_List_Comment",children:[m.jsxs("div",{className:"CommentPlugin_CommentsPanel_List_Details",children:[m.jsx("span",{className:"CommentPlugin_CommentsPanel_List_Comment_Author",children:t.author}),m.jsxs("span",{className:"CommentPlugin_CommentsPanel_List_Comment_Time",children:[" ",s>-10?"Just now":r.format(i,"minute")]})]}),m.jsx("p",{className:t.deleted?"CommentPlugin_CommentsPanel_DeletedComment":"",children:t.content}),!t.deleted&&m.jsxs(m.Fragment,{children:[m.jsx(yn,{onClick:()=>{a("Delete Comment",l=>m.jsx(Vf,{commentOrThread:t,deleteCommentOrThread:e,thread:n,onClose:l}))},className:"CommentPlugin_CommentsPanel_List_DeleteButton",children:m.jsx("i",{className:"delete"})}),o]})]})}function Bx({activeIDs:t,comments:e,deleteCommentOrThread:n,listRef:r,submitAddComment:s,markNodeMap:i}){const[o]=ue(),[a,l]=b.useState(0),[u,d]=Kf(),f=b.useMemo(()=>new Intl.RelativeTimeFormat("en",{localeMatcher:"best fit",numeric:"auto",style:"short"}),[]);return b.useEffect(()=>{const h=setTimeout(()=>{l(a+1)},1e4);return()=>{clearTimeout(h)}},[a]),m.jsx("ul",{className:"CommentPlugin_CommentsPanel_List",ref:r,children:e.map(h=>{const p=h.id;return h.type==="thread"?m.jsxs("li",{onClick:()=>{const y=i.get(p);if(y!==void 0&&(t===null||t.indexOf(p)===-1)){const k=document.activeElement;o.update(()=>{const C=Array.from(y)[0],A=Ee(C);Se(A)&&A.selectStart()},{onUpdate(){k!==null&&k.focus()}})}},className:`CommentPlugin_CommentsPanel_List_Thread ${i.has(p)?"interactive":""} ${t.indexOf(p)===-1?"":"active"}`,children:[m.jsxs("div",{className:"CommentPlugin_CommentsPanel_List_Thread_QuoteBox",children:[m.jsxs("blockquote",{className:"CommentPlugin_CommentsPanel_List_Thread_Quote",children:["> ",m.jsx("span",{children:h.quote})]}),m.jsx(yn,{onClick:()=>{d("Delete Thread",y=>m.jsx(Vf,{commentOrThread:h,deleteCommentOrThread:n,onClose:y}))},className:"CommentPlugin_CommentsPanel_List_DeleteButton",children:m.jsx("i",{className:"delete"})}),u]}),m.jsx("ul",{className:"CommentPlugin_CommentsPanel_List_Thread_Comments",children:h.comments.map(y=>m.jsx(vu,{comment:y,deleteComment:n,thread:h,rtf:f},y.id))}),m.jsx("div",{className:"CommentPlugin_CommentsPanel_List_Thread_Editor",children:m.jsx(Ux,{submitAddComment:s,thread:h,placeholder:"Reply to comment..."})})]},p):m.jsx(vu,{comment:h,deleteComment:n,rtf:f},p)})})}function Hx({activeIDs:t,deleteCommentOrThread:e,comments:n,submitAddComment:r,markNodeMap:s}){const i=b.useRef(null),o=n.length===0;return m.jsxs("div",{className:"CommentPlugin_CommentsPanel",children:[m.jsx("h2",{className:"CommentPlugin_CommentsPanel_Heading",children:"Comments"}),o?m.jsx("div",{className:"CommentPlugin_CommentsPanel_Empty",children:"No Comments"}):m.jsx(Bx,{activeIDs:t,comments:n,deleteCommentOrThread:e,listRef:i,submitAddComment:r,markNodeMap:s})]})}function Gf(){const t=Vd(),{yjsDocMap:e,name:n}=t;return e.has("comments")?n:"Scripture User"}function Wx({providerFactory:t,setCommentStore:e,onChange:n,showCommentsContainerRef:r,commentContainerRef:s,logger:i}){const o=Vd(),[a]=ue(),l=b.useMemo(()=>{const $=new Ax(a,i);return n&&$.registerOnChange(n),e==null||e($),$},[a,i,n,e]),u=jx(l),d=b.useMemo(()=>new Map,[]),[f,h]=b.useState(),[p,y]=b.useState([]),[k,C]=b.useState(!1),[A,v]=b.useState(!1),{yjsDocMap:O}=o;b.useEffect(()=>{if(t){const $=t("comments",O);return l.registerCollaboration($)}return()=>{}},[l,t,O]);const I=b.useCallback(()=>{a.update(()=>{const $=re();$!==null&&($.dirty=!0)}),C(!1)},[a]),L=b.useCallback(($,H)=>{if($.type==="comment"){const W=l.deleteCommentOrThread($,H);if(!W)return;const{markedComment:_,index:j}=W;l.addComment(_,H,j)}else{l.deleteCommentOrThread($);const W=H!==void 0?H.id:$.id,_=d.get(W);_!==void 0&&setTimeout(()=>{a.update(()=>{for(const j of _){const x=Ee(j);Se(x)&&(x.deleteID(dn,W),x.hasNoIDsForEveryType()&&Li(x))}})})}},[l,a,d]),q=b.useCallback(($,H,W,_)=>{l.addComment($,W),H&&(a.update(()=>{Z(_)&&df(_,dn,$.id)}),C(!1))},[l,a]);b.useEffect(()=>{const $=[];for(const H of p){const W=d.get(H);if(W!==void 0)for(const _ of W){const j=a.getElementByKey(_);j!==null&&(j.classList.add("selected"),$.push(j),v(!0))}}return()=>{for(const H of $)H.classList.remove("selected")}},[p,a,d]),b.useEffect(()=>{if(!a.hasNodes([Fe]))throw new Error("CommentPlugin: TypedMarkNode not registered on editor!");const $=new Map;return Xe(Cd(a,Fe,H=>ks(H.getTypedIDs()),(H,W)=>{for(const[_,j]of Object.entries(H.getTypedIDs()))j.forEach(x=>{W.addID(_,x)})}),a.registerMutationListener(Fe,H=>{a.getEditorState().read(()=>{for(const[W,_]of H){const j=Ee(W);let x=[];_==="destroyed"?x=$.get(W)??[]:Se(j)&&(x=j.getTypedIDs()[dn]??[]);for(const P of x){let E=d.get(P);$.set(W,x),_==="destroyed"?E!==void 0&&(E.delete(W),E.size===0&&d.delete(P)):(E===void 0&&(E=new Set,d.set(P,E)),E.has(W)||E.add(W))}}})},{skipInitialization:!1}),a.registerUpdateListener(({editorState:H,tags:W})=>{H.read(()=>{const _=re();let j=!1,x=!1;if(Z(_)){const P=_.anchor.getNode();if(Y(P)){const E=L_(P,dn,_.anchor.offset)??[];E!==null&&(y(E),j=!0),_.isCollapsed()||(h(P.getKey()),x=!0)}}j||y(P=>P.length===0?P:[]),x||h(null),!W.has("collaboration")&&Z(_)&&C(!1)})}),a.registerCommand(ku,()=>{const H=window.getSelection();return H!==null&&H.removeAllRanges(),C(!0),!0},xe))},[a,d]);const F=()=>{a.dispatchCommand(ku,void 0)};return m.jsxs(m.Fragment,{children:[k&&jt.createPortal(m.jsx(qx,{editor:a,cancelAddComment:I,submitAddComment:q}),document.body),f!=null&&!k&&jt.createPortal(m.jsx(Dx,{anchorKey:f,editor:a,showComments:A,onAddComment:F}),document.body),r!==null&&jt.createPortal(m.jsx(yn,{className:`CommentPlugin_ShowCommentsButton ${A?"active":""}`,onClick:()=>v(!A),title:A?"Hide Comments":"Show Comments",children:m.jsx("i",{className:"comments"})}),(r==null?void 0:r.current)??document.body),A&&jt.createPortal(m.jsx(Hx,{comments:u,submitAddComment:q,deleteCommentOrThread:L,activeIDs:p,markNodeMap:d}),(s==null?void 0:s.current)??document.body)]})}function Kx(){const t=b.useRef(void 0),e=b.useCallback(n=>{t.current=n},[]);return[t,e]}function Jx(t,e){var n,r;const s=((n=e.current)==null?void 0:n.getComments())??[],i=s==null?void 0:s.map(a=>a.id),o=t.map(a=>{const l=i.findIndex(u=>u===a);return l!==void 0&&l>=0?s[l]:{comments:[{author:"unknown",content:"Comment not found",deleted:!1,id:"",timeStamp:0,type:"comment"}],id:a,quote:"",type:"thread"}});s.forEach(a=>{t.includes(a.id)||o.push(a)}),o&&((r=e.current)==null||r.setComments(o))}function zx(t,e){b.useEffect(()=>{var n;t.options??(t.options={}),(n=t.options).nodes??(n.nodes={}),t.options.nodes.addMissingComments=r=>{Jx(r,e)}},[e,t])}b.forwardRef(function(t,e){const n=b.useRef(null),r=b.useRef(!0),s=b.useRef(null),[i,o]=b.useState(null),{children:a,onCommentChange:l,onUsjChange:u,showCommentsContainerRef:d,...f}=t,{logger:h,options:{isReadonly:p}={}}=t,[y,k]=Kx();zx(f,y),b.useEffect(()=>{},[h]),b.useImperativeHandle(e,()=>({focus(){var v;(v=n.current)==null||v.focus()},undo(){var v;(v=n.current)==null||v.undo()},redo(){var v;(v=n.current)==null||v.redo()},cut(){var v;(v=n.current)==null||v.cut()},copy(){var v;(v=n.current)==null||v.copy()},paste(){var v;(v=n.current)==null||v.paste()},pastePlainText(){var v;(v=n.current)==null||v.pastePlainText()},getUsj(){var v;return(v=n.current)==null?void 0:v.getUsj()},setUsj(v){var O;(O=n.current)==null||O.setUsj(v)},applyUpdate(v,O){var I;(I=n.current)==null||I.applyUpdate(v,O)},replaceEmbedUpdate(v,O){var I;return(I=n.current)==null?void 0:I.replaceEmbedUpdate(v,O)},getSelection(){var v;return(v=n.current)==null?void 0:v.getSelection()},setSelection(v){var O;(O=n.current)==null||O.setSelection(v)},setAnnotation(v,O,I,L,q){var F;(F=n.current)==null||F.setAnnotation(v,O,I,L,q)},removeAnnotation(v,O){var I;(I=n.current)==null||I.removeAnnotation(v,O)},formatPara(v){var O;(O=n.current)==null||O.formatPara(v)},getElementByKey(v){var O;return(O=n.current)==null?void 0:O.getElementByKey(v)},insertNote(v,O,I){var L;(L=n.current)==null||L.insertNote(v,O,I)},selectNote(v){var O;(O=n.current)==null||O.selectNote(v)},getNoteOps(v){var O;return(O=n.current)==null?void 0:O.getNoteOps(v)},setComments(v){var O;(O=y.current)==null||O.setComments(v),r.current=!0},get toolbarEndRef(){return i}}));const C=b.useCallback((v,O,I,L)=>{var q;if(!u)return;const F=(q=y.current)==null?void 0:q.getComments();u(v,F,O,I,L)},[y,u]),A=b.useCallback(()=>{var v;if(!l||r.current){r.current=!1;return}const O=(v=y.current)==null?void 0:v.getComments();l(O)},[y,r,l]);return b.useEffect(()=>{var v;return o(((v=n.current)==null?void 0:v.toolbarEndRef)??null),()=>o(null)},[]),m.jsx(Mm,{children:m.jsxs(Bf,{ref:n,onUsjChange:C,...f,children:[m.jsx(Wx,{setCommentStore:k,onChange:A,showCommentsContainerRef:p?null:d??i,commentContainerRef:s,logger:f.logger}),m.jsx("div",{ref:s,className:"comment-container"})]})})});const Yf=b.memo(function({viewMode:e,description:n,children:r}){const s=e==="story",i=b.useMemo(()=>!s||typeof n!="string"||!n.trim()?null:m.jsxs(gg,{className:"tw-w-full",children:[m.jsx(mg,{className:"tw-pb-2",children:m.jsx(yg,{className:"tw-text-sm tw-font-medium tw-text-muted-foreground",children:"Story Description"})}),m.jsx(bg,{className:"tw-pt-2",children:m.jsx(pg,{className:"tw-prose-sm tw-max-w-none tw-text-muted-foreground",markdown:n})})]}),[n,s]);return m.jsxs("div",{style:{display:"grid",gap:8},children:[r,i]})});Yf.__docgenInfo={description:"",methods:[],displayName:"CanvasWithDescription",props:{viewMode:{required:!1,tsType:{name:"string"},description:""},description:{required:!1,tsType:{name:"string"},description:""},children:{required:!0,tsType:{name:"ReactNode"},description:""}}};const Ha={m:"m - Paragraph - Margin - No First Line Indent",ms:"ms - Heading - Major Section Level 1",nb:"nb - Paragraph - No Break with Previous Paragraph",p:"p - Paragraph - Normal - First Line Indent",pi:"pi - Paragraph - Indented - Level 1 - First Line Indent",q1:"q1 - Poetry - Indent Level 1",q2:"q2 - Poetry - Indent Level 2",r:"r - Heading - Parallel References",s:"s - Heading - Section Level 1"},wu={...Ha,ide:"ide - File - Encoding",h:"h - File - Header",h1:"h1 - File - Header",h2:"h2 - File - Left Header",h3:"h3 - File - Right Header",toc1:"toc1 - File - Long Table of Contents Text",toc2:"toc2 - File - Short Table of Contents Text",toc3:"toc3 - File - Book Abbreviation",cl:"cl - Chapter - Publishing Label",mt:"mt - Title - Major Title Level 1",mt1:"mt1 - Title - Major Title Level 1",mt2:"mt2 - Title - Major Title Level 2",mt3:"mt3 - Title - Major Title Level 3",mt4:"mt4 - Title - Major Title Level 4",ms1:"ms1 - Heading - Major Section Level 1",ms2:"ms2 - Heading - Major Section Level 2",ms3:"ms3 - Heading - Major Section Level 3",b:"b - Poetry - Stanza Break (Blank Line)"},xu={m:Vs,ms:nr,nb:Vs,p:Vs,pi:Vs,q1:Jo,q2:Jo,r:nr,s:nr,ide:Ht,h:Ht,h1:Ht,h2:Ht,h3:Ht,toc1:Ht,toc2:Ht,toc3:Ht,cl:Ht,mt:nr,mt1:nr,mt2:Kl,mt3:Ko,mt4:Ko,ms1:nr,ms2:Kl,ms3:Ko,b:Jo};function Cu({blockMarker:t,className:e}){const n=t&&t in xu?xu[t]:Ig;return m.jsx(n,{className:e,size:16})}function Xf({editorRef:t,blockMarker:e}){return m.jsxs(Ya,{children:[m.jsx(Xa,{asChild:!0,children:m.jsxs(mt,{variant:"outline",className:"","aria-label":"Formatting options for block type",children:[m.jsx(Cu,{blockMarker:e,className:"tw-me-2"}),Vx(e),m.jsx(wg,{className:"tw-ms-2"})]})}),m.jsx(Za,{children:Object.keys(Ha).map(n=>m.jsxs(vg,{className:`item block-marker ${Gx(e===n)}`,onClick:()=>{var r;return(r=t.current)==null?void 0:r.formatPara(n)},children:[m.jsx(Cu,{blockMarker:n,className:"tw-me-2"}),m.jsx("span",{className:`text usfm_${n}`,children:Ha[n]})]},n))})]})}function Vx(t){return t&&t in wu?wu[t]:"No Style"}function Gx(t){return t?"active dropdown-item-active":""}Xf.__docgenInfo={description:"",methods:[],displayName:"BlockFormatDropDown",props:{editorRef:{required:!0,tsType:{name:"MutableRefObject",elements:[{name:"union",raw:"EditorRef | null",elements:[{name:"EditorRef"},{name:"null"}]}],raw:"MutableRefObject<EditorRef | null>"},description:""},blockMarker:{required:!0,tsType:{name:"union",raw:"string | undefined",elements:[{name:"string"},{name:"undefined"}]},description:""}}};const Yx={columns:{"platformScriptureEditor.edit":{label:"Edit",order:1},"platformScriptureEditor.insert":{label:"Insert",order:2}},groups:{"platformScriptureEditor.clipboard":{column:"platformScriptureEditor.edit",order:1},"platformScriptureEditor.insertNote":{column:"platformScriptureEditor.insert",order:1}},items:[{label:"Insert footnote",group:"platformScriptureEditor.insertNote",order:1,command:"platformScriptureEditor.insertFootnoteAtSelection",localizeNotes:""},{label:"Insert cross-reference",group:"platformScriptureEditor.insertNote",order:2,command:"platformScriptureEditor.insertCrossReferenceAtSelection",localizeNotes:""},{label:"Insert endnote",group:"platformScriptureEditor.insertNote",order:3,command:"platformScriptureEditor.insertEndnoteAtSelection",localizeNotes:""},{label:"Cut",group:"platformScriptureEditor.clipboard",order:1,command:"platformScriptureEditor.cut",localizeNotes:""},{label:"Copy",group:"platformScriptureEditor.clipboard",order:2,command:"platformScriptureEditor.copy",localizeNotes:""},{label:"Paste",group:"platformScriptureEditor.clipboard",order:3,command:"platformScriptureEditor.paste",localizeNotes:""},{label:"Paste as plain text",group:"platformScriptureEditor.clipboard",order:4,command:"platformScriptureEditor.pastePlainText",localizeNotes:""}]};function Zf({editorRef:t,scrRef:e,onScrRefChange:n,isReadonly:r=!1,canUndo:s=!1,canRedo:i=!1,blockMarker:o}){const a=()=>{var h;(h=t.current)==null||h.insertNote("f")},l=()=>{var h;(h=t.current)==null||h.insertNote("x")},u=()=>{var h;(h=t.current)==null||h.insertNote("fe")},d=h=>{var p,y,k,C;switch(h.command){case"platformScriptureEditor.insertFootnoteAtSelection":a();break;case"platformScriptureEditor.insertCrossReferenceAtSelection":l();break;case"platformScriptureEditor.insertEndnoteAtSelection":u();break;case"platformScriptureEditor.cut":(p=t.current)==null||p.cut();break;case"platformScriptureEditor.copy":(y=t.current)==null||y.copy();break;case"platformScriptureEditor.paste":(k=t.current)==null||k.paste();break;case"platformScriptureEditor.pastePlainText":(C=t.current)==null||C.pastePlainText();break;default:throw new Error(`Unknown onSelectProjectMenuItem command: ${h.command}`)}},f=()=>{};return m.jsx(kg,{onSelectProjectMenuItem:d,onSelectViewInfoMenuItem:f,projectMenuData:Yx,className:"toolbar",startAreaChildren:m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"tw-flex tw-h-full tw-items-center",children:m.jsx(_g,{scrRef:e,handleSubmit:n})}),!r&&m.jsxs(m.Fragment,{children:[m.jsx(mt,{"aria-label":"Undo",title:"Undo",variant:"ghost",size:"icon",onClick:()=>{var h;return(h=t.current)==null?void 0:h.undo()},disabled:!s,children:m.jsx(Yg,{})}),m.jsx(mt,{"aria-label":"Redo",title:"Redo",variant:"ghost",size:"icon",onClick:()=>{var h;return(h=t.current)==null?void 0:h.redo()},disabled:!i,children:m.jsx(qg,{})}),m.jsx(Xf,{editorRef:t,blockMarker:o}),m.jsx(mt,{"aria-label":"Insert footnote",title:"Insert footnote",variant:"ghost",size:"icon",onClick:a,children:m.jsx(zg,{})}),m.jsx(mt,{"aria-label":"Insert cross-reference",title:"Insert cross-reference",variant:"ghost",size:"icon",onClick:l,children:m.jsx(Bg,{})}),m.jsx(mt,{"aria-label":"Insert endnote",title:"Insert endnote",variant:"ghost",size:"icon",onClick:u,children:m.jsx(Dg,{})})]})]})})}Zf.__docgenInfo={description:"",methods:[],displayName:"PlatformToolbar",props:{editorRef:{required:!0,tsType:{name:"RefObject",elements:[{name:"union",raw:"EditorRef | null",elements:[{name:"EditorRef"},{name:"null"}]}],raw:"RefObject<EditorRef | null>"},description:""},scrRef:{required:!0,tsType:{name:"SerializedVerseRef"},description:""},onScrRefChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(scrRef: SerializedVerseRef) => void",signature:{arguments:[{type:{name:"SerializedVerseRef"},name:"scrRef"}],return:{name:"void"}}},description:""},isReadonly:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},canUndo:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},canRedo:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},blockMarker:{required:!1,tsType:{name:"string"},description:""}}};function Wn(t,e,n){var h,p,y,k;const r=b.useRef(null),[s,i]=b.useState(n),[o,a]=b.useState(!1),[l,u]=b.useState(!1),[d,f]=b.useState();return m.jsxs(Yf,{viewMode:e.viewMode,description:((y=(p=(h=e.parameters)==null?void 0:h.docs)==null?void 0:p.description)==null?void 0:y.story)??((k=e.parameters)==null?void 0:k.description),children:[m.jsx(Zf,{editorRef:r,scrRef:s,onScrRefChange:i,isReadonly:!1,canUndo:o,canRedo:l,blockMarker:d}),m.jsx(Os,{...t,ref:r,scrRef:s,onScrRefChange:i,onStateChange:({canUndo:C,canRedo:A,blockMarker:v})=>{a(C),u(A),f(v)}})]})}Wn.__docgenInfo={description:`Render function that combines the Editorial component with a PlatformToolbar. This provides a
complete editing experience with undo/redo, navigation, and other toolbar features.

Use this as a render function in a Storybook story, not as a component.`,methods:[],displayName:"renderEditorialWithToolbar"};const Xx='<usx version="3.1" />',Zx=Wa(Xx),Qx=`<?xml version="1.0" encoding="utf-8"?>
<usx version="3.1">
  <book code="PSA" style="id">World English Bible (WEB)</book>
  <para style="mt1">The Psalms</para>
  <chapter number="1" style="c" sid="PSA 1" />
  <para style="q1">
    <verse number="1" style="v" sid="PSA 1:1" />Blessed is the man who doesnt walk in the counsel of the wicked<note caller="+" style="f"><char style="fr">1:1 </char><char style="ft">Or "sinful"</char></note>,</para>
  <para style="q2" vid="PSA 1:1">nor stand on the path<note caller="+" style="f"><char style="fr">1:1 </char><char style="ft">Hebrew: "way"</char></note> of sinners,</para>
  <para style="q2" vid="PSA 1:1">nor sit in the seat of scoffers;<verse eid="PSA 1:1" /></para>
  <para style="q1">
    <verse number="2" style="v" sid="PSA 1:2" /><note caller="+" style="f"><char style="fr" closed="false">1:2 </char><char style="ft" closed="false">After verse</char></note> but his delight is in Yahwehs<note caller="+" style="f"><char style="fr" closed="false">1:2 </char><char style="ft" closed="false">Yahweh is Gods proper Name, sometimes rendered LORD (all caps) in other translations.</char></note> law.<note caller="+" style="f"><char style="fr" closed="false">1:2 </char><char style="ft" closed="false">End of Para</char></note></para>
  <para style="q2" vid="PSA 1:2">On his law he meditates day and night.<note caller="+" style="f"><char style="fr" closed="false">1:2 </char><char style="ft" closed="false">End of Doc</char></note><verse eid="PSA 1:2" /></para>
</usx>
`,tn=Wa(Qx),eC={start:{jsonPath:"$.content[3].content[1]",offset:15},end:{jsonPath:"$.content[3].content[1]",offset:18}},tC={start:{jsonPath:"$.content[3].content[1]",offset:15},end:{jsonPath:"$.content[3].content[1]",offset:22}},nC=`<?xml version="1.0" encoding="utf-8"?>
<usx version="3.1">
  <book code="PSA" style="id"></book>
  <para style="mt1"></para>
  <chapter number="1" style="c" sid="PSA 1" />
  <para style="q1">
    <verse number="1" style="v" sid="PSA 1:1" />      ,</para>
  <para style="q2" vid="PSA 1:1">   ,</para>
  <para style="q2" vid="PSA 1:1">   .<verse eid="PSA 1:1" /></para>
  <para style="q1">
    <verse number="2" style="v" sid="PSA 1:2" />    ,</para>
  <para style="q2" vid="PSA 1:2">   .<verse eid="PSA 1:2" /></para>
</usx>
`,rC=Wa(nC),sC=(t,e,n)=>t==="generated"?m.jsxs(m.Fragment,{children:[m.jsx("p",{children:"+"})," ",e["%footnoteEditor_callerDropdown_item_generated%"]]}):t==="hidden"?m.jsxs(m.Fragment,{children:[m.jsx("p",{children:"-"})," ",e["%footnoteEditor_callerDropdown_item_hidden%"]]}):m.jsxs(m.Fragment,{children:[m.jsx("p",{children:n})," ",e["%footnoteEditor_callerDropdown_item_custom%"]]});function Qf({callerType:t,updateCallerType:e,customCaller:n,updateCustomCaller:r,localizedStrings:s}){const i=b.useRef(null),o=b.useRef(null),a=b.useRef(!1),[l,u]=b.useState(t),[d,f]=b.useState(n),[h,p]=b.useState(!1);b.useEffect(()=>{u(t)},[t]),b.useEffect(()=>{d!==n&&f(n)},[n]);const y=C=>{a.current=!1,p(C),C||(l!=="custom"||d?(e(l),r(d)):(u(t),f(n)))},k=C=>{var A,v,O,I;C.stopPropagation(),document.activeElement===o.current&&C.key==="ArrowDown"||C.key==="ArrowRight"?((A=i.current)==null||A.focus(),a.current=!0):document.activeElement===i.current&&C.key==="ArrowUp"?((v=o.current)==null||v.focus(),a.current=!1):document.activeElement===i.current&&C.key==="ArrowLeft"&&((O=i.current)==null?void 0:O.selectionStart)===0&&((I=o.current)==null||I.focus(),a.current=!1),l==="custom"&&C.key==="Enter"&&(document.activeElement===o.current||document.activeElement===i.current)&&y(!1)};return m.jsxs(Ya,{open:h,onOpenChange:y,children:[m.jsx(is,{children:m.jsxs(os,{children:[m.jsx(_i,{asChild:!0,children:m.jsx(Xa,{asChild:!0,children:m.jsx(mt,{variant:"outline",className:"tw-h-6",children:sC(t,s,n)})})}),m.jsx(as,{children:s["%footnoteEditor_callerDropdown_tooltip%"]})]})}),m.jsxs(Za,{className:"tw-z-[300]",onClick:()=>{a.current&&(a.current=!1)},onKeyDown:k,onMouseMove:()=>{var C;a.current&&((C=i.current)==null||C.focus())},children:[m.jsx(Td,{children:s["%footnoteEditor_callerDropdown_label%"]}),m.jsx(Ed,{}),m.jsx(ir,{checked:l==="generated",onCheckedChange:()=>u("generated"),children:m.jsxs("div",{className:"tw-flex tw-w-full tw-justify-between",children:[m.jsx("span",{children:s["%footnoteEditor_callerDropdown_item_generated%"]}),m.jsx("span",{className:"tw-w-10 tw-text-center",children:$t})]})}),m.jsx(ir,{checked:l==="hidden",onCheckedChange:()=>u("hidden"),children:m.jsxs("div",{className:"tw-flex tw-w-full tw-justify-between",children:[m.jsx("span",{children:s["%footnoteEditor_callerDropdown_item_hidden%"]}),m.jsx("span",{className:"tw-w-10 tw-text-center",children:gr})]})}),m.jsx(ir,{ref:o,checked:l==="custom",onCheckedChange:()=>u("custom"),onClick:C=>{var A;C.stopPropagation(),a.current=!0,(A=i.current)==null||A.focus()},onSelect:C=>C.preventDefault(),children:m.jsxs("div",{className:"tw-flex tw-w-full tw-justify-between",children:[m.jsx("span",{children:s["%footnoteEditor_callerDropdown_item_custom%"]}),m.jsx(Cg,{tabIndex:0,onMouseDown:C=>{C.stopPropagation(),u("custom"),a.current=!0},ref:i,className:"tw-h-auto tw-w-10 tw-p-0 tw-text-center",value:d,onKeyDown:C=>{C.key==="Enter"||C.key==="ArrowUp"||C.key==="ArrowDown"||C.key==="ArrowLeft"||C.key==="ArrowRight"||C.stopPropagation()},maxLength:1,onChange:C=>f(C.target.value)})]})})]})]})}Qf.__docgenInfo={description:"",methods:[],displayName:"FootnoteCallerDropdown",props:{callerType:{required:!0,tsType:{name:"union",raw:"'generated' | 'hidden' | 'custom'",elements:[{name:"literal",value:"'generated'"},{name:"literal",value:"'hidden'"},{name:"literal",value:"'custom'"}]},description:"The caller type value to pass to the dropdown"},updateCallerType:{required:!0,tsType:{name:"signature",type:"function",raw:"(newCallerType: FootnoteCallerType) => void",signature:{arguments:[{type:{name:"union",raw:"'generated' | 'hidden' | 'custom'",elements:[{name:"literal",value:"'generated'"},{name:"literal",value:"'hidden'"},{name:"literal",value:"'custom'"}]},name:"newCallerType"}],return:{name:"void"}}},description:"Function to update the caller type"},customCaller:{required:!0,tsType:{name:"string"},description:"The custom caller to pass to the custom caller input field"},updateCustomCaller:{required:!0,tsType:{name:"signature",type:"function",raw:"(newCustomCaller: string) => void",signature:{arguments:[{type:{name:"string"},name:"newCustomCaller"}],return:{name:"void"}}},description:"FUnction to update the custom caller"},localizedStrings:{required:!0,tsType:{name:"signature",type:"object",raw:`{
  [localizedKey in (typeof FOOTNOTE_EDITOR_STRING_KEYS)[number]]?: string;
}`,signature:{properties:[{key:{name:"unknown[number]",raw:"(typeof FOOTNOTE_EDITOR_STRING_KEYS)[number]",required:!1},value:{name:"string"}}]}},description:"Localized strings from the parent component"}}};const iC=(t,e)=>t==="f"?m.jsxs(m.Fragment,{children:[m.jsx(Od,{})," ",e["%footnoteEditor_noteType_footnote_label%"]]}):t==="fe"?m.jsxs(m.Fragment,{children:[m.jsx(Md,{})," ",e["%footnoteEditor_noteType_endNote_label%"]]}):m.jsxs(m.Fragment,{children:[m.jsx(Ad,{})," ",e["%footnoteEditor_noteType_crossReference_label%"]]}),oC=(t,e)=>{if(t==="x")return e["%footnoteEditor_noteType_crossReference_label%"];let n=e["%footnoteEditor_noteType_endNote_label%"];return t==="f"&&(n=e["%footnoteEditor_noteType_footnote_label%"]),cg(e["%footnoteEditor_noteType_tooltip%"]??"",{noteType:n})};function ep({noteType:t,handleNoteTypeChange:e,localizedStrings:n,isTypeSwitchable:r}){return m.jsxs(Ya,{children:[m.jsx(is,{children:m.jsxs(os,{children:[m.jsx(xg,{asChild:!0,children:m.jsx(Xa,{asChild:!0,children:m.jsx(mt,{variant:"outline",className:"tw-h-6",children:iC(t,n)})})}),m.jsx(as,{children:m.jsx("p",{children:oC(t,n)})})]})}),m.jsxs(Za,{className:"tw-z-[300]",children:[m.jsx(Td,{children:n["%footnoteEditor_noteTypeDropdown_label%"]}),m.jsx(Ed,{}),m.jsxs(ir,{disabled:t!=="x"&&!r,checked:t==="x",onCheckedChange:()=>e("x"),className:"tw-gap-2",children:[m.jsx(Ad,{}),m.jsx("span",{children:n["%footnoteEditor_noteType_crossReference_label%"]})]}),m.jsxs(ir,{disabled:t==="x"&&!r,checked:t==="f",onCheckedChange:()=>e("f"),className:"tw-gap-2",children:[m.jsx(Od,{}),m.jsx("span",{children:n["%footnoteEditor_noteType_footnote_label%"]})]}),m.jsxs(ir,{disabled:t==="x"&&!r,checked:t==="fe",onCheckedChange:()=>e("fe"),className:"tw-gap-2",children:[m.jsx(Md,{}),m.jsx("span",{children:n["%footnoteEditor_noteType_endNote_label%"]})]})]})]})}ep.__docgenInfo={description:"",methods:[],displayName:"FootnoteTypeDropdown",props:{noteType:{required:!0,tsType:{name:"string"},description:""},handleNoteTypeChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(newNoteType: string) => void",signature:{arguments:[{type:{name:"string"},name:"newNoteType"}],return:{name:"void"}}},description:""},localizedStrings:{required:!0,tsType:{name:"signature",type:"object",raw:`{
  [localizedKey in (typeof FOOTNOTE_EDITOR_STRING_KEYS)[number]]?: string;
}`,signature:{properties:[{key:{name:"unknown[number]",raw:"(typeof FOOTNOTE_EDITOR_STRING_KEYS)[number]",required:!1},value:{name:"string"}}]}},description:""},isTypeSwitchable:{required:!0,tsType:{name:"boolean"},description:""}}};function aC(t){var n;const e=(n=t.attributes)==null?void 0:n.char;e.style&&(e.style==="ft"&&(e.style="xt"),e.style==="fr"&&(e.style="xo"),e.style==="fq"&&(e.style="xq"))}function lC(t){var n;const e=(n=t.attributes)==null?void 0:n.char;e.style&&(e.style==="xt"&&(e.style="ft"),e.style==="xo"&&(e.style="fr"),e.style==="xq"&&(e.style="fq"))}const cC={type:"USJ",version:"3.1",content:[{type:"para"}]};function tp({classNameForEditor:t,noteOps:e,onSave:n,onClose:r,scrRef:s,noteKey:i,editorOptions:o,localizedStrings:a}){const l=b.useRef(null),u=b.createRef(),[d,f]=b.useState("generated"),[h,p]=b.useState("*"),[y,k]=b.useState("f"),[C,A]=b.useState(!1),v=b.useMemo(()=>({...o,markerMenuTrigger:o.markerMenuTrigger??"\\",hasExternalUI:!0,view:{...o.view??jr(),noteMode:"expanded"}}),[o]);b.useEffect(()=>{var F;(F=l.current)==null||F.focus()}),b.useEffect(()=>{var H,W;let F;const $=e==null?void 0:e.at(0);if($&&et("note",$)){const _=(H=$.insert.note)==null?void 0:H.caller;let j="custom";_===$t?j="generated":_===gr?j="hidden":_&&p(_),f(j),k(((W=$.insert.note)==null?void 0:W.style)??"f"),F=setTimeout(()=>{var x;(x=l.current)==null||x.applyUpdate([$])},0)}return()=>{F&&clearTimeout(F)}},[e,i]);const O=b.useCallback(()=>{var $,H;const F=(H=($=l.current)==null?void 0:$.getNoteOps(0))==null?void 0:H.at(0);F&&et("note",F)&&(F.insert.note&&(d==="custom"?F.insert.note.caller=h:F.insert.note.caller=d==="generated"?$t:gr),n([F]))},[d,h,n]),I=()=>{var $;const F=($=u.current)==null?void 0:$.getElementsByClassName("editor-input")[0];F!=null&&F.textContent&&navigator.clipboard.writeText(F.textContent)},L=F=>{var H,W,_,j,x;k(F);const $=(W=(H=l.current)==null?void 0:H.getNoteOps(0))==null?void 0:W.at(0);if($&&et("note",$)){$.insert.note&&($.insert.note.style=F);const P=(j=(_=$.insert.note)==null?void 0:_.contents)==null?void 0:j.ops;y!=="x"&&F==="x"?P==null||P.forEach(E=>aC(E)):y==="x"&&F!=="x"&&(P==null||P.forEach(E=>lC(E))),(x=l.current)==null||x.applyUpdate([$,{delete:1}])}},q=F=>{var H,W,_,j,x;const $=(W=(H=l.current)==null?void 0:H.getNoteOps(0))==null?void 0:W.at(0);if($&&et("note",$)){F.content.length>1&&setTimeout(()=>{var M;(M=l.current)==null||M.applyUpdate([{retain:2},{delete:1}])},0);const P=(_=$.insert.note)==null?void 0:_.style,E=(x=(j=$.insert.note)==null?void 0:j.contents)==null?void 0:x.ops;P||A(!1),A(P==="x"?!!(E!=null&&E.every(M=>{var D,U;if(!((D=M.attributes)!=null&&D.char))return!0;const N=((U=M.attributes)==null?void 0:U.char).style;return N==="xt"||N==="xo"||N==="xq"})):!!(E!=null&&E.every(M=>{var D,U;if(!((D=M.attributes)!=null&&D.char))return!0;const N=((U=M.attributes)==null?void 0:U.char).style;return N==="ft"||N==="fr"||N==="fq"})))}else A(!1)};return m.jsxs("div",{className:"footnote-editor tw-grid tw-gap-[12px]",children:[m.jsxs("div",{className:"tw-flex",children:[m.jsxs("div",{className:"tw-flex tw-gap-4",children:[m.jsx(ep,{isTypeSwitchable:C,noteType:y,handleNoteTypeChange:L,localizedStrings:a}),m.jsx(Qf,{callerType:d,updateCallerType:f,customCaller:h,updateCustomCaller:p,localizedStrings:a})]}),m.jsxs("div",{className:"tw-flex tw-w-full tw-justify-end tw-gap-4",children:[m.jsx(is,{children:m.jsxs(os,{children:[m.jsx(_i,{asChild:!0,children:m.jsx(mt,{onClick:r,className:"tw-h-6 tw-w-6",size:"icon",variant:"secondary",children:m.jsx(Sg,{})})}),m.jsx(as,{children:m.jsx("p",{children:a["%footnoteEditor_cancelButton_tooltip%"]})})]})}),m.jsx(is,{children:m.jsxs(os,{children:[m.jsx(_i,{asChild:!0,children:m.jsx(mt,{onClick:O,className:"tw-h-6 tw-w-6",size:"icon",variant:"default",children:m.jsx(Tg,{})})}),m.jsx(as,{children:a["%footnoteEditor_saveButton_tooltip%"]})]})})]})]}),m.jsxs("div",{ref:u,className:"tw-relative tw-rounded-[6px] tw-border-2 tw-border-ring",children:[m.jsx("div",{className:t,children:m.jsx(Os,{options:v,onUsjChange:q,defaultUsj:cC,onScrRefChange:()=>{},scrRef:s,ref:l})}),m.jsx("div",{className:"tw-absolute tw-bottom-0 tw-right-0",children:m.jsx(is,{children:m.jsxs(os,{children:[m.jsx(_i,{asChild:!0,children:m.jsx(mt,{onClick:I,className:"tw-h-6 tw-w-6",variant:"ghost",size:"icon",children:m.jsx(Eg,{})})}),m.jsx(as,{children:m.jsx("p",{children:a["%footnoteEditor_copyButton_tooltip%"]})})]})})})]})]})}tp.__docgenInfo={description:`Component to edit footnotes from within the editor component

@param FootnoteEditorProps - The properties for the footnote editor component`,methods:[],displayName:"FootnoteEditor",props:{classNameForEditor:{required:!1,tsType:{name:"string"},description:"Class name for styling the embedded `Editor` component in this editor popover"},noteOps:{required:!0,tsType:{name:"union",raw:"DeltaOpInsertNoteEmbed[] | undefined",elements:[{name:"Array",elements:[{name:"DeltaOpInsertNoteEmbed"}],raw:"DeltaOpInsertNoteEmbed[]"},{name:"undefined"}]},description:"Delta ops for the current note being edited that are applied to the note editorial"},onSave:{required:!0,tsType:{name:"signature",type:"function",raw:"(noteOps: DeltaOpInsertNoteEmbed[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"DeltaOpInsertNoteEmbed"}],raw:"DeltaOpInsertNoteEmbed[]"},name:"noteOps"}],return:{name:"void"}}},description:"External function to handle saving changes to the footnote"},onClose:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:`External function to handle closing the footnote editor. Gets called when the editor is closed
without saving changes`},scrRef:{required:!0,tsType:{name:"SerializedVerseRef"},description:"The scripture reference for the parent editor"},noteKey:{required:!0,tsType:{name:"union",raw:"string | undefined",elements:[{name:"string"},{name:"undefined"}]},description:"The unique note key to identify the note being edited used to apply changes to the note"},editorOptions:{required:!0,tsType:{name:"EditorOptions"},description:"View options of the parent editor"},localizedStrings:{required:!0,tsType:{name:"signature",type:"object",raw:`{
  [localizedKey in (typeof FOOTNOTE_EDITOR_STRING_KEYS)[number]]?: string;
}`,signature:{properties:[{key:{name:"unknown[number]",raw:"(typeof FOOTNOTE_EDITOR_STRING_KEYS)[number]",required:!1},value:{name:"string"}}]}},description:"Localized strings to be passed to the footnote editor component"}}};const ot={book:"PSA",chapterNum:1,verseNum:1},x0={title:"Demo/Editorial",component:Os,tags:["autodocs"],parameters:{docs:{description:{component:`
**Demo Only:** This component is provided for demonstration purposes only. For production applications, developers should import the Scripture Editor component directly from:
- npm [@eten-tech-foundation/platform-editor](https://www.npmjs.com/package/@eten-tech-foundation/platform-editor)
- github [eten-tech-foundation/platform-editor](https://github.com/eten-tech-foundation/scripture-editors/tree/main/packages/platform)

This demo version is included in Storybook to showcase the component's functionality and usage patterns.

**Known Limitation:** In the Docs view, all story examples may show the same note caller style due to global state management in the editor component. To see the correct note caller behavior for each story (default lowercase letters vs custom symbols), please view the individual stories in the Canvas view instead of the Docs view.
        `}}},argTypes:{ref:{control:"object",description:"Reference to the editor instance",defaultValue:null},defaultUsj:{control:"object",description:"Default USJ object to initialize the editor with",defaultValue:{type:us,version:ds,content:[""]}},scrRef:{control:"object",description:"Scripture reference",defaultValue:ot},options:{control:"object",description:"Options to configure the editor (EditorOptions)",defaultValue:{},table:{type:{summary:"EditorOptions",detail:'{ isReadonly?: boolean; hasSpellCheck?: boolean; textDirection?: "ltr" | "rtl" | "auto"; markerMenuTrigger?: string; nodes?: UsjNodeOptions; }'}}}}},oi={args:{defaultUsj:tn,scrRef:ot}},ai={args:{defaultUsj:Zx,scrRef:ot}},li={args:{defaultUsj:tn,scrRef:ot,options:{isReadonly:!0}}},ci={render:(t,e)=>Wn(t,e,ot),parameters:{docs:{description:{story:'Right-to-left example using a Hebrew snippet (Psalm 1:1). The editor is set to RTL via _options.textDirection = "rtl"_. If you want the UI (tab toolbar) to be RTL click **Switch direction** in the Storybook toolbar.'}}},args:{defaultUsj:rC,options:{hasExternalUI:!0,textDirection:"rtl"}}};function Su(t,e,n,r){console.log("handleAnnotationOnClick",{event:t,type:e,id:n,textContent:r})}function Tu(t,e,n,r){console.log("handleAnnotationOnRemove",{type:t,id:e,cause:n,textContent:r})}const ui={render:t=>{const e=b.useRef(null);return b.useEffect(()=>{const n=setTimeout(()=>{e.current&&(e.current.setAnnotation(eC,"spelling","annotationId",Su,Tu),e.current.setAnnotation(tC,"grammar","abc123",Su,Tu))},0);return()=>clearTimeout(n)},[]),m.jsx(Os,{...t,ref:e})},args:{defaultUsj:tn,scrRef:ot}},uC={hasExternalUI:!0,view:{...jr(),noteMode:"expandInline"},nodes:{noteCallerOnClick:(t,e,n,r,s)=>{n||(r()===$t?s(gr):s($t))}}},di={render:(t,e)=>Wn(t,e,ot),parameters:{docs:{description:{story:"This story demonstrates editing notes inline. Move your cursor to a note caller and the note will expand and can be edited. Move the cursor out of the note and it will collapse. Click the expanded note caller to toggle between the auto-generated caller and the hidden caller."}}},args:{defaultUsj:tn,options:uC}},dC={hasExternalUI:!0,view:{...jr(),noteMode:"expandInline"}},hi={render:(t,e)=>Wn(t,e,ot),parameters:{docs:{description:{story:'This story demonstrates inserting notes. Use the Project menu (hamburger) or the toolbar buttons above the editor to insert footnotes, cross-references, and endnotes at the current cursor position. Selecting text before inserting a footnote will use that text as the footnote quote. You can also insert by typing "\\f", "\\x", or "\\fe".'}}},args:{defaultUsj:tn,options:dC}},hC={hasExternalUI:!0,nodes:{noteCallers:["","","","","","","","","",""],noteCallerOnClick:(t,e,n,r,s,i)=>{console.log("Note caller clicked:",t,e,n,r,s,i),alert("Note caller clicked! Check console for details.")}}},fi={render:(t,e)=>Wn(t,e,ot),parameters:{docs:{description:{story:"This story demonstrates custom note callers and click handling. **Try clicking on the circled number footnote markers ( ) in the text to see the click handler in action!** The click event will show an alert and log details to the browser console."}}},args:{defaultUsj:tn,options:hC}},pi={render:(t,e)=>Wn(t,e,ot),parameters:{docs:{description:{story:'This story demonstrates using a custom marker menu trigger key. **Try typing "?" (question mark) anywhere in the editor text to open the marker menu!** The default trigger is "\\\\" (backslash), but this story changes it to "?" for demonstration. The marker menu allows you to insert USFM markers into the text.'}}},args:{defaultUsj:tn,options:{hasExternalUI:!0,markerMenuTrigger:"?"}}},fC={"%footnoteEditor_callerDropdown_label%":"Footnote caller","%footnoteEditor_callerDropdown_item_generated%":"Auto-generated","%footnoteEditor_callerDropdown_item_hidden%":"Hidden","%footnoteEditor_callerDropdown_item_custom%":"Custom","%footnoteEditor_callerDropdown_tooltip%":"Footnote caller","%footnoteEditor_cancelButton_tooltip%":"Cancel","%footnoteEditor_copyButton_tooltip%":"Copy footnote","%footnoteEditor_noteType_crossReference_label%":"Cross reference","%footnoteEditor_noteType_endNote_label%":"Endnote","%footnoteEditor_noteType_footnote_label%":"Footnote","%footnoteEditor_noteType_tooltip%":"Change type: Footnote","%footnoteEditor_noteTypeDropdown_label%":"Type","%footnoteEditor_saveButton_tooltip%":"Save"},gi={render:t=>{const e=b.useRef(null),n=b.useRef(),r=b.useRef(),[s,i]=b.useState(),[o,a]=b.useState(),[l,u]=b.useState(),[d,f]=b.useState(),h=b.useMemo(()=>({markerMode:"hidden",noteMode:"collapsed",hasSpacing:!0,isFormattedFont:!0}),[]),p=b.useMemo(()=>({...t.options??{},nodes:{noteCallerOnClick:(v,O,I,L,q,F)=>{var H;const $=v.currentTarget.getBoundingClientRect();if(i($.left),a($.top),u($.height),I){if(n.current)return;const W=(H=F())==null?void 0:H.at(0);if(!W||!et("note",W))return;n.current=O,r.current=[W],f(!0)}}},view:h}),[t.options,h,n]),y=b.useCallback((A,v)=>{var O;if(v&&A){if(n.current)return;console.log(A);const I=A[1];if(!et("note",I))return;const L=(O=e.current)==null?void 0:O.getElementByKey(v);if(!L)return;console.log(I);const q=L.getBoundingClientRect();i(q.left),a(q.top),u(q.height),n.current=v,r.current=[I],f(!0)}},[n]),k=()=>{n.current=void 0,r.current=void 0,f(!1)},C=A=>{var v;n.current&&((v=e.current)==null||v.replaceEmbedUpdate(n.current,A)),k()};return m.jsxs("div",{children:[m.jsx(Os,{...t,options:p,onUsjChange:(A,v,O,I)=>{y(v,I)},ref:e,onScrRefChange:()=>{}}),m.jsxs(Og,{open:d,children:[m.jsx(Mg,{className:"tw-absolute",style:{top:o??0,left:s??0,height:l,width:0}}),m.jsx(Ag,{className:"tw-w-[500px] tw-p-[10px]",children:m.jsx(tp,{noteKey:n.current,noteOps:r.current,onSave:C,onClose:k,scrRef:t.scrRef??ot,editorOptions:p,localizedStrings:fC})})]})]})},parameters:{docs:{description:{story:"This story demonstrates the use of the new footnote editor on the side of the  editorial component"}}},args:{defaultUsj:tn,scrRef:ot,options:{hasExternalUI:!1,markerMenuTrigger:"\\"}}},mi={name:"View Options",render:(t,e)=>{const{markerMode:n,noteMode:r,hasSpacing:s,isFormattedFont:i}=t;return Wn({defaultUsj:tn,options:{hasExternalUI:!0,view:{markerMode:n,noteMode:r,hasSpacing:s,isFormattedFont:i}}},e,ot)},argTypes:{markerMode:{control:{type:"select"},options:["hidden","visible","editable"],description:"Controls how USFM markers are displayed in the editor",table:{category:"View Options"}},noteMode:{control:{type:"select"},options:["collapsed","expandInline","expanded"],description:"Controls how notes are displayed in the editor",table:{category:"View Options"}},hasSpacing:{control:{type:"boolean"},description:"Whether to add spacing between paragraphs",table:{category:"View Options"}},isFormattedFont:{control:{type:"boolean"},description:"Whether to use formatted font styling",table:{category:"View Options"}}},parameters:{docs:{description:{story:"Demonstrates the editor view options (marker visibility, spacing, and formatted font) using USX input. Below in the **Controls** tab, try changing the **View Options** to see how they affect the editor display."}}},args:{markerMode:"hidden",noteMode:"collapsed",hasSpacing:!0,isFormattedFont:!0}};var Eu,Ou,Mu;oi.parameters={...oi.parameters,docs:{...(Eu=oi.parameters)==null?void 0:Eu.docs,source:{originalSource:`{
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef
  }
}`,...(Mu=(Ou=oi.parameters)==null?void 0:Ou.docs)==null?void 0:Mu.source}}};var Au,ju,Nu;ai.parameters={...ai.parameters,docs:{...(Au=ai.parameters)==null?void 0:Au.docs,source:{originalSource:`{
  args: {
    defaultUsj: usjEmpty,
    scrRef: defaultScrRef
  }
}`,...(Nu=(ju=ai.parameters)==null?void 0:ju.docs)==null?void 0:Nu.source}}};var Iu,Ru,Pu;li.parameters={...li.parameters,docs:{...(Iu=li.parameters)==null?void 0:Iu.docs,source:{originalSource:`{
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef,
    options: {
      isReadonly: true
    }
  }
}`,...(Pu=(Ru=li.parameters)==null?void 0:Ru.docs)==null?void 0:Pu.source}}};var $u,Lu,Du;ci.parameters={...ci.parameters,docs:{...($u=ci.parameters)==null?void 0:$u.docs,source:{originalSource:`{
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'Right-to-left example using a Hebrew snippet (Psalm 1:1). ' + 'The editor is set to RTL via _options.textDirection = "rtl"_. If you want the UI ' + '(tab toolbar) to be RTL click **Switch direction** in the Storybook toolbar.'
      }
    }
  },
  args: {
    defaultUsj: usjHebrew,
    options: {
      hasExternalUI: true,
      textDirection: 'rtl'
    }
  }
}`,...(Du=(Lu=ci.parameters)==null?void 0:Lu.docs)==null?void 0:Du.source}}};var Fu,qu,Uu;ui.parameters={...ui.parameters,docs:{...(Fu=ui.parameters)==null?void 0:Fu.docs,source:{originalSource:`{
  render: args => {
    // eslint-disable-next-line no-null/no-null
    const editorRef = useRef<EditorRef | null>(null);
    useEffect(() => {
      const timeoutId = setTimeout(() => {
        if (editorRef.current) {
          editorRef.current.setAnnotation(annotationRangeWeb1, 'spelling', 'annotationId', handleAnnotationOnClick, handleAnnotationOnRemove);
          editorRef.current.setAnnotation(annotationRangeWeb2, 'grammar', 'abc123', handleAnnotationOnClick, handleAnnotationOnRemove);
        }
      }, 0);
      return () => clearTimeout(timeoutId);
    }, []);
    return <Editorial {...args} ref={editorRef} />;
  },
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef
  }
}`,...(Uu=(qu=ui.parameters)==null?void 0:qu.docs)==null?void 0:Uu.source}}};var Bu,Hu,Wu;di.parameters={...di.parameters,docs:{...(Bu=di.parameters)==null?void 0:Bu.docs,source:{originalSource:`{
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates editing notes inline. Move your cursor to a note caller and ' + 'the note will expand and can be edited. Move the cursor out of the note and it will ' + 'collapse. Click the expanded note caller to toggle between the auto-generated caller ' + 'and the hidden caller.'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    options: inlineNoteOptions
  }
}`,...(Wu=(Hu=di.parameters)==null?void 0:Hu.docs)==null?void 0:Wu.source}}};var Ku,Ju,zu;hi.parameters={...hi.parameters,docs:{...(Ku=hi.parameters)==null?void 0:Ku.docs,source:{originalSource:`{
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates inserting notes. Use the Project menu (hamburger) or the ' + 'toolbar buttons above the editor to insert footnotes, cross-references, and endnotes ' + 'at the current cursor position. Selecting text before inserting a footnote will use ' + 'that text as the footnote quote. You can also insert by typing "\\\\f", "\\\\x", or "\\\\fe".'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    options: insertNoteOptions
  }
}`,...(zu=(Ju=hi.parameters)==null?void 0:Ju.docs)==null?void 0:zu.source}}};var Vu,Gu,Yu;fi.parameters={...fi.parameters,docs:{...(Vu=fi.parameters)==null?void 0:Vu.docs,source:{originalSource:`{
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates custom note callers and click handling. **Try clicking on the ' + 'circled number footnote markers ( ) in the text to see the click handler in ' + 'action!** The click event will show an alert and log details to the browser console.'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    options: customNodeOptions
  }
}`,...(Yu=(Gu=fi.parameters)==null?void 0:Gu.docs)==null?void 0:Yu.source}}};var Xu,Zu,Qu;pi.parameters={...pi.parameters,docs:{...(Xu=pi.parameters)==null?void 0:Xu.docs,source:{originalSource:`{
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates using a custom marker menu trigger key. **Try typing "?" ' + '(question mark) anywhere in the editor text to open the marker menu!** The default ' + 'trigger is "\\\\\\\\" (backslash), but this story changes it to "?" for demonstration. ' + 'The marker menu allows you to insert USFM markers into the text.'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    options: {
      hasExternalUI: true,
      markerMenuTrigger: '?'
    }
  }
}`,...(Qu=(Zu=pi.parameters)==null?void 0:Zu.docs)==null?void 0:Qu.source}}};var ed,td,nd;gi.parameters={...gi.parameters,docs:{...(ed=gi.parameters)==null?void 0:ed.docs,source:{originalSource:`{
  render: args => {
    // eslint-disable-next-line no-null/no-null
    const editorRef = useRef<EditorRef | null>(null);
    const noteKey = useRef<string>();
    const noteOps = useRef<DeltaOpInsertNoteEmbed[]>();
    const [popoverX, setPopoverX] = useState<number>();
    const [popoverY, setPopoverY] = useState<number>();
    const [popoverHeight, setPopoverHeight] = useState<number>();
    const [showFootnoteEditor, setShowFootnoteEditor] = useState<boolean>();
    const viewOptions = useMemo<ViewOptions>(() => ({
      markerMode: 'hidden',
      noteMode: 'collapsed',
      hasSpacing: true,
      isFormattedFont: true
    }), []);
    const mergedOptions = useMemo<EditorOptions>(() => {
      const base = args.options ?? {};
      return {
        ...base,
        nodes: {
          noteCallerOnClick: (event, noteNodeKey, isCollapsed, _getCaller, _setCaller, getNoteOps) => {
            const targetRect = event.currentTarget.getBoundingClientRect();
            setPopoverX(targetRect.left);
            setPopoverY(targetRect.top);
            setPopoverHeight(targetRect.height);
            if (isCollapsed) {
              // (event as SyntheticEvent<)
              if (noteKey.current) return;

              // Makes sure the note op is the correct type and is defined
              const noteOp = getNoteOps()?.at(0);
              if (!noteOp || !isInsertEmbedOpOfType('note', noteOp)) return;
              noteKey.current = noteNodeKey;
              noteOps.current = [noteOp];
              setShowFootnoteEditor(true);
            }
          }
        },
        view: viewOptions
      };
    }, [args.options, viewOptions, noteKey]);
    const openFootnoteEditorOnNewNote = useCallback((ops?: DeltaOp[], insertedNodeKey?: string) => {
      if (insertedNodeKey && ops) {
        // If we are already editing a note, then returns
        if (noteKey.current) return;

        // Makes sure the node is a note
        console.log(ops);
        const noteOp = ops[1];
        if (!isInsertEmbedOpOfType('note', noteOp)) return;
        const noteElement = editorRef.current?.getElementByKey(insertedNodeKey);
        // Note element must be defined
        if (!noteElement) return;
        console.log(noteOp);
        const targetRect = noteElement.getBoundingClientRect();
        setPopoverX(targetRect.left);
        setPopoverY(targetRect.top);
        setPopoverHeight(targetRect.height);
        noteKey.current = insertedNodeKey;
        noteOps.current = [noteOp];
        setShowFootnoteEditor(true);
      }
    }, [noteKey]);
    const onEditorClose = () => {
      noteKey.current = undefined;
      noteOps.current = undefined;
      setShowFootnoteEditor(false);
    };
    const onEditorSave = (newNoteOps: DeltaOp[]) => {
      if (noteKey.current) {
        editorRef.current?.replaceEmbedUpdate(noteKey.current, newNoteOps);
      }
      onEditorClose();
    };
    return <div>
        <Editorial {...args} options={mergedOptions} onUsjChange={(_usj: Usj, ops?: DeltaOp[], _source?: DeltaSource, insertedNodeKey?: string) => {
        openFootnoteEditorOnNewNote(ops, insertedNodeKey);
      }} ref={editorRef} onScrRefChange={() => undefined} />
        <Popover open={showFootnoteEditor}>
          <PopoverAnchor className="tw-absolute" style={{
          top: popoverY ?? 0,
          left: popoverX ?? 0,
          height: popoverHeight,
          width: 0
        }} />
          <PopoverContent className="tw-w-[500px] tw-p-[10px]">
            <FootnoteEditor noteKey={noteKey.current} noteOps={noteOps.current} onSave={onEditorSave} onClose={onEditorClose} scrRef={args.scrRef ?? defaultScrRef} editorOptions={mergedOptions} localizedStrings={sampleFootnoteEditorLocalizedStrings} />
          </PopoverContent>
        </Popover>
      </div>;
  },
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates the use of the new footnote editor on the side of the ' + ' editorial component'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef,
    options: {
      hasExternalUI: false,
      markerMenuTrigger: '\\\\'
    }
  }
}`,...(nd=(td=gi.parameters)==null?void 0:td.docs)==null?void 0:nd.source}}};var rd,sd,id;mi.parameters={...mi.parameters,docs:{...(rd=mi.parameters)==null?void 0:rd.docs,source:{originalSource:`{
  name: 'View Options',
  render: (args, context) => {
    // Destructure flattened view options from args
    const {
      markerMode,
      noteMode,
      hasSpacing,
      isFormattedFont
    } = args;

    // Reconstruct the args with the options.view settings
    const mergedArgs = {
      defaultUsj: usjWeb,
      options: {
        hasExternalUI: true,
        view: {
          markerMode,
          noteMode,
          hasSpacing,
          isFormattedFont
        }
      }
    };
    return renderEditorialWithToolbar(mergedArgs, context, defaultScrRef);
  },
  argTypes: {
    markerMode: {
      control: {
        type: 'select'
      },
      options: ['hidden', 'visible', 'editable'],
      description: 'Controls how USFM markers are displayed in the editor',
      table: {
        category: 'View Options'
      }
    },
    noteMode: {
      control: {
        type: 'select'
      },
      options: ['collapsed', 'expandInline', 'expanded'],
      description: 'Controls how notes are displayed in the editor',
      table: {
        category: 'View Options'
      }
    },
    hasSpacing: {
      control: {
        type: 'boolean'
      },
      description: 'Whether to add spacing between paragraphs',
      table: {
        category: 'View Options'
      }
    },
    isFormattedFont: {
      control: {
        type: 'boolean'
      },
      description: 'Whether to use formatted font styling',
      table: {
        category: 'View Options'
      }
    }
  },
  parameters: {
    docs: {
      description: {
        story: 'Demonstrates the editor view options (marker visibility, spacing, and formatted font) ' + 'using USX input. Below in the **Controls** tab, try changing the **View Options** ' + 'to see how they affect the editor display.'
      }
    }
  },
  args: {
    markerMode: 'hidden',
    noteMode: 'collapsed',
    hasSpacing: true,
    isFormattedFont: true
  }
}`,...(id=(sd=mi.parameters)==null?void 0:sd.docs)==null?void 0:id.source}}};const C0=["Default","Empty","ReadOnly","RTL","Annotated","InlineNoteEditing","InsertNote","CustomNoteOptions","CustomMarkerTrigger","FootnoteEditorView","EditorViewOptions"];export{ui as Annotated,pi as CustomMarkerTrigger,fi as CustomNoteOptions,oi as Default,mi as EditorViewOptions,ai as Empty,gi as FootnoteEditorView,di as InlineNoteEditing,hi as InsertNote,ci as RTL,li as ReadOnly,C0 as __namedExportsOrder,x0 as default};
