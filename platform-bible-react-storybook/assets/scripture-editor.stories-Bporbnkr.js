import{j as m}from"./jsx-runtime-CCV0dITx.js";import{c as an,g as Zf,r as _}from"./iframe-Tvmt7_Ly.js";import{H as md,m as ot,V as Qf,T as ss,O as is,w as ep,L as tp,I as np,D as za}from"./index-Dk3kgKOJ.js";import{e as pn,r as Ot,v as yd,_ as X,i as Ne,j as ki,g as rp,P as re,w as $t,C as sp,y as $l,V as Xr,k as we,s as ee,l as ip,p as Xe,o as ce,Z as zr,t as Kr,Q as bd,J as xe,X as _d,u as Ka,M as ha,A as Ja,O as op,B as kd,E as ap,F as lp,G as cp,$ as yr,I as Va,K as vd,R as up,L as wd,S as dp,U as hp,Y as fp,a0 as xd,a1 as zi,a2 as Cd,a3 as ql,a4 as pp,a5 as Ki,a6 as Ji,a7 as gp,a8 as mp,a9 as Dl,aa as yp,ab as Wo,ac as bp,ad as _p,ae as Ll,af as Fl,ag as kp,ah as vp,ai as wp,aj as xp,ak as Cp,al as Sp,am as Tp,an as Ep,ao as Op,ap as Mp,aq as Ap,ar as Sd,as as jp,f as Td,z as Ga,a as Np,b as Ed,x as Od,at as Te,au as bs,av as Md,aw as Ul,ax as br,ay as gn,q as At,az as os,h as _s,aA as fa,aB as ve,aC as vi,aD as ks,aE as Ip,aF as Rp,aG as Pp,aH as Ad,aI as jd,aJ as Vi,aK as $p,aL as vs,aM as Bl,aN as Jt,aO as Nd,aP as qp,aQ as Dp,aR as Lp,aS as Fp,n as Up,c as Bp,d as Hp}from"./LexicalTable.prod-qGivjrHx.js";import{r as yt}from"./index-CbYGkoHH.js";import{c as Wp,d as zp,e as Kp,g as Jp}from"./floating-ui.react-dom-DEV1vZ0E.js";import{M as Vp}from"./markdown-renderer.component-B7nxRzMb.js";import{C as Gp,a as Yp,b as Xp,d as Zp}from"./card-aBqylKzq.js";import{B as Qp}from"./book-chapter-control.component-Dk2GfT6_.js";import{T as eg}from"./tab-toolbar.component-WLShfk_8.js";import{B as mt}from"./button-CclLtg2Q.js";import{D as Ya,a as Xa,b as Za,c as tg,j as Id,e as Rd,l as Zr}from"./dropdown-menu-DgG8T2o1.js";import{C as ng}from"./chevron-down-BEABRCPZ.js";import{c as rt}from"./createLucideIcon-J5Z7yCho.js";import{F as Bt}from"./file-text-DptyOLkl.js";import{a as Qr,T as es,b as wi,c as ts,d as rg}from"./tooltip-DNU9XWdF.js";import{I as sg}from"./input-BWHqNiYx.js";import{v as ig}from"./index-DcB2WZF4.js";import{X as og}from"./x-D3xWewqr.js";import{C as ag}from"./check-E5c2fE1q.js";import{C as lg}from"./copy-DrJInVjX.js";import{P as cg,c as ug,b as dg}from"./popover-BZ0BvI6u.js";import"./index-D2w9gCAG.js";import"./index-CvyEX3Wp.js";import"./shadcn-ui.util-DMJ19wEV.js";import"./book-item.utils-DqZkiJRU.js";import"./command-BCPMN-99.js";import"./index-dlXYcUEh.js";import"./index-DTAXz6r9.js";import"./index-krxWvl1i.js";import"./index-zzJcAQs3.js";import"./index-CK9aa0ZV.js";import"./index-9svm5nks.js";import"./index-BhT6yfrs.js";import"./index-NCwKt4hG.js";import"./index-D-rOYJS_.js";import"./index-9AmvvDPF.js";import"./index-CL6xdip1.js";import"./index-Cdc5zMGQ.js";import"./index-LBj7Ao12.js";import"./index-DBLsL_9T.js";import"./dialog-Bpm6UVaS.js";import"./index-Czfav6j7.js";import"./search-DSq7pMFu.js";import"./index.es-D4jfZzAn.js";import"./chevron-left-DohRCQwE.js";import"./chevron-right-Der2hSRJ.js";import"./arrow-right-DbN-Wafp.js";import"./tab-dropdown-menu.component-B2R3ztB7.js";import"./menu.util-Dxh7JGT4.js";import"./menu-icon.component-Cj9vU59d.js";import"./tab-toolbar-container.component-DEd2xuhB.js";import"./index-BPbCuWFR.js";import"./index-BnrSNJZv.js";import"./index-DNNspnz2.js";import"./index-DxCk9gax.js";import"./index-BVMZXHq6.js";import"./index-DMetyUjQ.js";import"./index-Detjv0F6.js";import"./index-DxPkWIMg.js";import"./circle-CmLs83xt.js";import"./index-ChCKDeH_.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hg=[["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 18h18",key:"1h113x"}],["path",{d:"M3 6h18",key:"d0wm0j"}]],Vs=rt("AlignJustify",hg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fg=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]],pg=rt("Ban",fg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gg=[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"m17 12 3-2v8",key:"1hhhft"}]],tr=rt("Heading1",gg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mg=[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M21 18h-4c0-4 4-3 4-6 0-1.5-2-2.5-4-1",key:"9jr5yi"}]],Hl=rt("Heading2",mg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yg=[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M17.5 10.5c1.7-1 3.5 0 3.5 1.5a2 2 0 0 1-2 2",key:"68ncm8"}],["path",{d:"M17 17.5c2 1.5 4 .3 4-1.5a2 2 0 0 0-2-2",key:"1ejuhz"}]],zo=rt("Heading3",yg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bg=[["path",{d:"M16 12H3",key:"1a2rj7"}],["path",{d:"M16 6H3",key:"1wxfjs"}],["path",{d:"M10 18H3",key:"13769t"}],["path",{d:"M21 6v10a2 2 0 0 1-2 2h-5",key:"ilrcs8"}],["path",{d:"m16 16-2 2 2 2",key:"kkc6pm"}]],_g=rt("ListEnd",bg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kg=[["path",{d:"M21 7v6h-6",key:"3ptur4"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7",key:"1kgawr"}]],vg=rt("Redo",kg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wg=[["path",{d:"m18 14 4 4-4 4",key:"10pe0f"}],["path",{d:"m18 2 4 4-4 4",key:"pucp1d"}],["path",{d:"M2 18h1.973a4 4 0 0 0 3.3-1.7l5.454-8.6a4 4 0 0 1 3.3-1.7H22",key:"1ailkh"}],["path",{d:"M2 6h1.972a4 4 0 0 1 3.6 2.2",key:"km57vx"}],["path",{d:"M22 18h-6.041a4 4 0 0 1-3.3-1.8l-.359-.45",key:"os18l9"}]],xg=rt("Shuffle",wg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cg=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"M9 17c2 0 2.8-1 2.8-2.8V10c0-2 1-3.3 3.2-3",key:"m1af9g"}],["path",{d:"M9 11.2h5.7",key:"3zgcl2"}]],Pd=rt("SquareFunction",Cg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sg=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M16 8.9V7H8l4 5-4 5h8v-1.9",key:"9nih0i"}]],$d=rt("SquareSigma",Sg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tg=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],Eg=rt("SquareX",Tg);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Og=[["path",{d:"m4 19 8-8",key:"hr47gm"}],["path",{d:"m12 19-8-8",key:"1dhhmo"}],["path",{d:"M20 12h-4c0-1.5.442-2 1.5-2.5S20 8.334 20 7.002c0-.472-.17-.93-.484-1.29a2.105 2.105 0 0 0-2.617-.436c-.42.239-.738.614-.899 1.06",key:"1dfcux"}]],Mg=rt("Superscript",Og);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ag=[["path",{d:"M17 6H3",key:"16j9eg"}],["path",{d:"M21 12H8",key:"scolzb"}],["path",{d:"M21 18H8",key:"1wfozv"}],["path",{d:"M3 12v6",key:"fv4c87"}]],Ko=rt("TextQuote",Ag);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jg=[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]],Ng=rt("Undo",jg);var Gs={exports:{}},Jo,Wl;function Ig(){if(Wl)return Jo;Wl=1;var t=-1,e=1,n=0;function r(k,I,x,P,O){if(k===I)return k?[[n,k]]:[];if(x!=null){var M=H(k,I,x);if(M)return M}var N=a(k,I),D=k.substring(0,N);k=k.substring(N),I=I.substring(N),N=u(k,I);var L=k.substring(k.length-N);k=k.substring(0,k.length-N),I=I.substring(0,I.length-N);var F=s(k,I);return D&&F.unshift([n,D]),L&&F.push([n,L]),v(F,O),P&&f(F),F}function s(k,I){var x;if(!k)return[[e,I]];if(!I)return[[t,k]];var P=k.length>I.length?k:I,O=k.length>I.length?I:k,M=P.indexOf(O);if(M!==-1)return x=[[e,P.substring(0,M)],[n,O],[e,P.substring(M+O.length)]],k.length>I.length&&(x[0][0]=x[2][0]=t),x;if(O.length===1)return[[t,k],[e,I]];var N=d(k,I);if(N){var D=N[0],L=N[1],F=N[2],J=N[3],K=N[4],Y=r(D,F),ne=r(L,J);return Y.concat([[n,K]],ne)}return i(k,I)}function i(k,I){for(var x=k.length,P=I.length,O=Math.ceil((x+P)/2),M=O,N=2*O,D=new Array(N),L=new Array(N),F=0;F<N;F++)D[F]=-1,L[F]=-1;D[M+1]=0,L[M+1]=0;for(var J=x-P,K=J%2!==0,Y=0,ne=0,V=0,ue=0,ye=0;ye<O;ye++){for(var te=-ye+Y;te<=ye-ne;te+=2){var se=M+te,ie;te===-ye||te!==ye&&D[se-1]<D[se+1]?ie=D[se+1]:ie=D[se-1]+1;for(var de=ie-te;ie<x&&de<P&&k.charAt(ie)===I.charAt(de);)ie++,de++;if(D[se]=ie,ie>x)ne+=2;else if(de>P)Y+=2;else if(K){var fe=M+J-te;if(fe>=0&&fe<N&&L[fe]!==-1){var ge=x-L[fe];if(ie>=ge)return o(k,I,ie,de)}}}for(var Oe=-ye+V;Oe<=ye-ue;Oe+=2){var fe=M+Oe,ge;Oe===-ye||Oe!==ye&&L[fe-1]<L[fe+1]?ge=L[fe+1]:ge=L[fe-1]+1;for(var Ue=ge-Oe;ge<x&&Ue<P&&k.charAt(x-ge-1)===I.charAt(P-Ue-1);)ge++,Ue++;if(L[fe]=ge,ge>x)ue+=2;else if(Ue>P)V+=2;else if(!K){var se=M+J-Oe;if(se>=0&&se<N&&D[se]!==-1){var ie=D[se],de=M+ie-se;if(ge=x-ge,ie>=ge)return o(k,I,ie,de)}}}}return[[t,k],[e,I]]}function o(k,I,x,P){var O=k.substring(0,x),M=I.substring(0,P),N=k.substring(x),D=I.substring(P),L=r(O,M),F=r(N,D);return L.concat(F)}function a(k,I){if(!k||!I||k.charAt(0)!==I.charAt(0))return 0;for(var x=0,P=Math.min(k.length,I.length),O=P,M=0;x<O;)k.substring(M,O)==I.substring(M,O)?(x=O,M=x):P=O,O=Math.floor((P-x)/2+x);return E(k.charCodeAt(O-1))&&O--,O}function l(k,I){var x=k.length,P=I.length;if(x==0||P==0)return 0;x>P?k=k.substring(x-P):x<P&&(I=I.substring(0,x));var O=Math.min(x,P);if(k==I)return O;for(var M=0,N=1;;){var D=k.substring(O-N),L=I.indexOf(D);if(L==-1)return M;N+=L,(L==0||k.substring(O-N)==I.substring(0,N))&&(M=N,N++)}}function u(k,I){if(!k||!I||k.slice(-1)!==I.slice(-1))return 0;for(var x=0,P=Math.min(k.length,I.length),O=P,M=0;x<O;)k.substring(k.length-O,k.length-M)==I.substring(I.length-O,I.length-M)?(x=O,M=x):P=O,O=Math.floor((P-x)/2+x);return j(k.charCodeAt(k.length-O))&&O--,O}function d(k,I){var x=k.length>I.length?k:I,P=k.length>I.length?I:k;if(x.length<4||P.length*2<x.length)return null;function O(ne,V,ue){for(var ye=ne.substring(ue,ue+Math.floor(ne.length/4)),te=-1,se="",ie,de,fe,ge;(te=V.indexOf(ye,te+1))!==-1;){var Oe=a(ne.substring(ue),V.substring(te)),Ue=u(ne.substring(0,ue),V.substring(0,te));se.length<Ue+Oe&&(se=V.substring(te-Ue,te)+V.substring(te,te+Oe),ie=ne.substring(0,ue-Ue),de=ne.substring(ue+Oe),fe=V.substring(0,te-Ue),ge=V.substring(te+Oe))}return se.length*2>=ne.length?[ie,de,fe,ge,se]:null}var M=O(x,P,Math.ceil(x.length/4)),N=O(x,P,Math.ceil(x.length/2)),D;if(!M&&!N)return null;N?M?D=M[4].length>N[4].length?M:N:D=N:D=M;var L,F,J,K;k.length>I.length?(L=D[0],F=D[1],J=D[2],K=D[3]):(J=D[0],K=D[1],L=D[2],F=D[3]);var Y=D[4];return[L,F,J,K,Y]}function f(k){for(var I=!1,x=[],P=0,O=null,M=0,N=0,D=0,L=0,F=0;M<k.length;)k[M][0]==n?(x[P++]=M,N=L,D=F,L=0,F=0,O=k[M][1]):(k[M][0]==e?L+=k[M][1].length:F+=k[M][1].length,O&&O.length<=Math.max(N,D)&&O.length<=Math.max(L,F)&&(k.splice(x[P-1],0,[t,O]),k[x[P-1]+1][0]=e,P--,P--,M=P>0?x[P-1]:-1,N=0,D=0,L=0,F=0,O=null,I=!0)),M++;for(I&&v(k),A(k),M=1;M<k.length;){if(k[M-1][0]==t&&k[M][0]==e){var J=k[M-1][1],K=k[M][1],Y=l(J,K),ne=l(K,J);Y>=ne?(Y>=J.length/2||Y>=K.length/2)&&(k.splice(M,0,[n,K.substring(0,Y)]),k[M-1][1]=J.substring(0,J.length-Y),k[M+1][1]=K.substring(Y),M++):(ne>=J.length/2||ne>=K.length/2)&&(k.splice(M,0,[n,J.substring(0,ne)]),k[M-1][0]=e,k[M-1][1]=K.substring(0,K.length-ne),k[M+1][0]=t,k[M+1][1]=J.substring(ne),M++),M++}M++}}var h=/[^a-zA-Z0-9]/,p=/\s/,y=/[\r\n]/,b=/\n\r?\n$/,C=/^\r?\n\r?\n/;function A(k){function I(ne,V){if(!ne||!V)return 6;var ue=ne.charAt(ne.length-1),ye=V.charAt(0),te=ue.match(h),se=ye.match(h),ie=te&&ue.match(p),de=se&&ye.match(p),fe=ie&&ue.match(y),ge=de&&ye.match(y),Oe=fe&&ne.match(b),Ue=ge&&V.match(C);return Oe||Ue?5:fe||ge?4:te&&!ie&&de?3:ie||de?2:te||se?1:0}for(var x=1;x<k.length-1;){if(k[x-1][0]==n&&k[x+1][0]==n){var P=k[x-1][1],O=k[x][1],M=k[x+1][1],N=u(P,O);if(N){var D=O.substring(O.length-N);P=P.substring(0,P.length-N),O=D+O.substring(0,O.length-N),M=D+M}for(var L=P,F=O,J=M,K=I(P,O)+I(O,M);O.charAt(0)===M.charAt(0);){P+=O.charAt(0),O=O.substring(1)+M.charAt(0),M=M.substring(1);var Y=I(P,O)+I(O,M);Y>=K&&(K=Y,L=P,F=O,J=M)}k[x-1][1]!=L&&(L?k[x-1][1]=L:(k.splice(x-1,1),x--),k[x][1]=F,J?k[x+1][1]=J:(k.splice(x+1,1),x--))}x++}}function v(k,I){k.push([n,""]);for(var x=0,P=0,O=0,M="",N="",D;x<k.length;){if(x<k.length-1&&!k[x][1]){k.splice(x,1);continue}switch(k[x][0]){case e:O++,N+=k[x][1],x++;break;case t:P++,M+=k[x][1],x++;break;case n:var L=x-O-P-1;if(I){if(L>=0&&q(k[L][1])){var F=k[L][1].slice(-1);if(k[L][1]=k[L][1].slice(0,-1),M=F+M,N=F+N,!k[L][1]){k.splice(L,1),x--;var J=L-1;k[J]&&k[J][0]===e&&(O++,N=k[J][1]+N,J--),k[J]&&k[J][0]===t&&(P++,M=k[J][1]+M,J--),L=J}}if($(k[x][1])){var F=k[x][1].charAt(0);k[x][1]=k[x][1].slice(1),M+=F,N+=F}}if(x<k.length-1&&!k[x][1]){k.splice(x,1);break}if(M.length>0||N.length>0){M.length>0&&N.length>0&&(D=a(N,M),D!==0&&(L>=0?k[L][1]+=N.substring(0,D):(k.splice(0,0,[n,N.substring(0,D)]),x++),N=N.substring(D),M=M.substring(D)),D=u(N,M),D!==0&&(k[x][1]=N.substring(N.length-D)+k[x][1],N=N.substring(0,N.length-D),M=M.substring(0,M.length-D)));var K=O+P;M.length===0&&N.length===0?(k.splice(x-K,K),x=x-K):M.length===0?(k.splice(x-K,K,[e,N]),x=x-K+1):N.length===0?(k.splice(x-K,K,[t,M]),x=x-K+1):(k.splice(x-K,K,[t,M],[e,N]),x=x-K+2)}x!==0&&k[x-1][0]===n?(k[x-1][1]+=k[x][1],k.splice(x,1)):x++,O=0,P=0,M="",N="";break}}k[k.length-1][1]===""&&k.pop();var Y=!1;for(x=1;x<k.length-1;)k[x-1][0]===n&&k[x+1][0]===n&&(k[x][1].substring(k[x][1].length-k[x-1][1].length)===k[x-1][1]?(k[x][1]=k[x-1][1]+k[x][1].substring(0,k[x][1].length-k[x-1][1].length),k[x+1][1]=k[x-1][1]+k[x+1][1],k.splice(x-1,1),Y=!0):k[x][1].substring(0,k[x+1][1].length)==k[x+1][1]&&(k[x-1][1]+=k[x+1][1],k[x][1]=k[x][1].substring(k[x+1][1].length)+k[x+1][1],k.splice(x+1,1),Y=!0)),x++;Y&&v(k,I)}function E(k){return k>=55296&&k<=56319}function j(k){return k>=56320&&k<=57343}function $(k){return j(k.charCodeAt(0))}function q(k){return E(k.charCodeAt(k.length-1))}function B(k){for(var I=[],x=0;x<k.length;x++)k[x][1].length>0&&I.push(k[x]);return I}function U(k,I,x,P){return q(k)||$(P)?null:B([[n,k],[t,I],[e,x],[n,P]])}function H(k,I,x){var P=typeof x=="number"?{index:x,length:0}:x.oldRange,O=typeof x=="number"?null:x.newRange,M=k.length,N=I.length;if(P.length===0&&(O===null||O.length===0)){var D=P.index,L=k.slice(0,D),F=k.slice(D),J=O?O.index:null;e:{var K=D+N-M;if(J!==null&&J!==K||K<0||K>N)break e;var Y=I.slice(0,K),ne=I.slice(K);if(ne!==F)break e;var V=Math.min(D,K),ue=L.slice(0,V),ye=Y.slice(0,V);if(ue!==ye)break e;var te=L.slice(V),se=Y.slice(V);return U(ue,te,se,F)}e:{if(J!==null&&J!==D)break e;var ie=D,Y=I.slice(0,ie),ne=I.slice(ie);if(Y!==L)break e;var de=Math.min(M-ie,N-ie),fe=F.slice(F.length-de),ge=ne.slice(ne.length-de);if(fe!==ge)break e;var te=F.slice(0,F.length-de),se=ne.slice(0,ne.length-de);return U(L,te,se,fe)}}if(P.length>0&&O&&O.length===0)e:{var ue=k.slice(0,P.index),fe=k.slice(P.index+P.length),V=ue.length,de=fe.length;if(N<V+de)break e;var ye=I.slice(0,V),ge=I.slice(N-de);if(ue!==ye||fe!==ge)break e;var te=k.slice(V,M-de),se=I.slice(V,N-de);return U(ue,te,se,fe)}return null}function W(k,I,x,P){return r(k,I,x,P,!0)}return W.INSERT=e,W.DELETE=t,W.EQUAL=n,Jo=W,Jo}var Jr={exports:{}};Jr.exports;var zl;function qd(){return zl||(zl=1,function(t,e){var n=200,r="__lodash_hash_undefined__",s=9007199254740991,i="[object Arguments]",o="[object Array]",a="[object Boolean]",l="[object Date]",u="[object Error]",d="[object Function]",f="[object GeneratorFunction]",h="[object Map]",p="[object Number]",y="[object Object]",b="[object Promise]",C="[object RegExp]",A="[object Set]",v="[object String]",E="[object Symbol]",j="[object WeakMap]",$="[object ArrayBuffer]",q="[object DataView]",B="[object Float32Array]",U="[object Float64Array]",H="[object Int8Array]",W="[object Int16Array]",k="[object Int32Array]",I="[object Uint8Array]",x="[object Uint8ClampedArray]",P="[object Uint16Array]",O="[object Uint32Array]",M=/[\\^$.*+?()[\]{}|]/g,N=/\w*$/,D=/^\[object .+?Constructor\]$/,L=/^(?:0|[1-9]\d*)$/,F={};F[i]=F[o]=F[$]=F[q]=F[a]=F[l]=F[B]=F[U]=F[H]=F[W]=F[k]=F[h]=F[p]=F[y]=F[C]=F[A]=F[v]=F[E]=F[I]=F[x]=F[P]=F[O]=!0,F[u]=F[d]=F[j]=!1;var J=typeof an=="object"&&an&&an.Object===Object&&an,K=typeof self=="object"&&self&&self.Object===Object&&self,Y=J||K||Function("return this")(),ne=e&&!e.nodeType&&e,V=ne&&!0&&t&&!t.nodeType&&t,ue=V&&V.exports===ne;function ye(c,g){return c.set(g[0],g[1]),c}function te(c,g){return c.add(g),c}function se(c,g){for(var w=-1,R=c?c.length:0;++w<R&&g(c[w],w,c)!==!1;);return c}function ie(c,g){for(var w=-1,R=g.length,Q=c.length;++w<R;)c[Q+w]=g[w];return c}function de(c,g,w,R){for(var Q=-1,G=c?c.length:0;++Q<G;)w=g(w,c[Q],Q,c);return w}function fe(c,g){for(var w=-1,R=Array(c);++w<c;)R[w]=g(w);return R}function ge(c,g){return c==null?void 0:c[g]}function Oe(c){var g=!1;if(c!=null&&typeof c.toString!="function")try{g=!!(c+"")}catch{}return g}function Ue(c){var g=-1,w=Array(c.size);return c.forEach(function(R,Q){w[++g]=[Q,R]}),w}function Er(c,g){return function(w){return c(g(w))}}function Ms(c){var g=-1,w=Array(c.size);return c.forEach(function(R){w[++g]=R}),w}var no=Array.prototype,ro=Function.prototype,Wn=Object.prototype,Or=Y["__core-js_shared__"],As=function(){var c=/[^.]+$/.exec(Or&&Or.keys&&Or.keys.IE_PROTO||"");return c?"Symbol(src)_1."+c:""}(),js=ro.toString,xt=Wn.hasOwnProperty,zn=Wn.toString,so=RegExp("^"+js.call(xt).replace(M,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),vn=ue?Y.Buffer:void 0,Kn=Y.Symbol,Mr=Y.Uint8Array,it=Er(Object.getPrototypeOf,Object),Ns=Object.create,Is=Wn.propertyIsEnumerable,io=no.splice,Ar=Object.getOwnPropertySymbols,Jn=vn?vn.isBuffer:void 0,Rs=Er(Object.keys,Object),Vn=ft(Y,"DataView"),wn=ft(Y,"Map"),ht=ft(Y,"Promise"),Gn=ft(Y,"Set"),jr=ft(Y,"WeakMap"),xn=ft(Object,"create"),Nr=Ve(Vn),Cn=Ve(wn),Ir=Ve(ht),Rr=Ve(Gn),Pr=Ve(jr),nn=Kn?Kn.prototype:void 0,Ps=nn?nn.valueOf:void 0;function Dt(c){var g=-1,w=c?c.length:0;for(this.clear();++g<w;){var R=c[g];this.set(R[0],R[1])}}function oo(){this.__data__=xn?xn(null):{}}function ao(c){return this.has(c)&&delete this.__data__[c]}function lo(c){var g=this.__data__;if(xn){var w=g[c];return w===r?void 0:w}return xt.call(g,c)?g[c]:void 0}function $s(c){var g=this.__data__;return xn?g[c]!==void 0:xt.call(g,c)}function $r(c,g){var w=this.__data__;return w[c]=xn&&g===void 0?r:g,this}Dt.prototype.clear=oo,Dt.prototype.delete=ao,Dt.prototype.get=lo,Dt.prototype.has=$s,Dt.prototype.set=$r;function qe(c){var g=-1,w=c?c.length:0;for(this.clear();++g<w;){var R=c[g];this.set(R[0],R[1])}}function co(){this.__data__=[]}function uo(c){var g=this.__data__,w=Xn(g,c);if(w<0)return!1;var R=g.length-1;return w==R?g.pop():io.call(g,w,1),!0}function ho(c){var g=this.__data__,w=Xn(g,c);return w<0?void 0:g[w][1]}function fo(c){return Xn(this.__data__,c)>-1}function po(c,g){var w=this.__data__,R=Xn(w,c);return R<0?w.push([c,g]):w[R][1]=g,this}qe.prototype.clear=co,qe.prototype.delete=uo,qe.prototype.get=ho,qe.prototype.has=fo,qe.prototype.set=po;function Be(c){var g=-1,w=c?c.length:0;for(this.clear();++g<w;){var R=c[g];this.set(R[0],R[1])}}function go(){this.__data__={hash:new Dt,map:new(wn||qe),string:new Dt}}function mo(c){return Tn(this,c).delete(c)}function yo(c){return Tn(this,c).get(c)}function bo(c){return Tn(this,c).has(c)}function _o(c,g){return Tn(this,c).set(c,g),this}Be.prototype.clear=go,Be.prototype.delete=mo,Be.prototype.get=yo,Be.prototype.has=bo,Be.prototype.set=_o;function Ze(c){this.__data__=new qe(c)}function ko(){this.__data__=new qe}function vo(c){return this.__data__.delete(c)}function wo(c){return this.__data__.get(c)}function xo(c){return this.__data__.has(c)}function Co(c,g){var w=this.__data__;if(w instanceof qe){var R=w.__data__;if(!wn||R.length<n-1)return R.push([c,g]),this;w=this.__data__=new Be(R)}return w.set(c,g),this}Ze.prototype.clear=ko,Ze.prototype.delete=vo,Ze.prototype.get=wo,Ze.prototype.has=xo,Ze.prototype.set=Co;function Yn(c,g){var w=Fr(c)||Qn(c)?fe(c.length,String):[],R=w.length,Q=!!R;for(var G in c)xt.call(c,G)&&!(Q&&(G=="length"||Do(G,R)))&&w.push(G);return w}function qs(c,g,w){var R=c[g];(!(xt.call(c,g)&&Bs(R,w))||w===void 0&&!(g in c))&&(c[g]=w)}function Xn(c,g){for(var w=c.length;w--;)if(Bs(c[w][0],g))return w;return-1}function Ct(c,g){return c&&Lr(g,Br(g),c)}function qr(c,g,w,R,Q,G,le){var ae;if(R&&(ae=G?R(c,Q,G,le):R(c)),ae!==void 0)return ae;if(!Tt(c))return c;var Me=Fr(c);if(Me){if(ae=$o(c),!g)return Io(c,ae)}else{var he=Ft(c),He=he==d||he==f;if(Hs(c))return Zn(c,g);if(he==y||he==i||He&&!G){if(Oe(c))return G?c:{};if(ae=St(He?{}:c),!g)return Ro(c,Ct(ae,c))}else{if(!F[he])return G?c:{};ae=qo(c,he,qr,g)}}le||(le=new Ze);var Qe=le.get(c);if(Qe)return Qe;if(le.set(c,ae),!Me)var Ae=w?Po(c):Br(c);return se(Ae||c,function(We,De){Ae&&(De=We,We=c[De]),qs(ae,De,qr(We,g,w,R,De,c,le))}),ae}function So(c){return Tt(c)?Ns(c):{}}function To(c,g,w){var R=g(c);return Fr(c)?R:ie(R,w(c))}function Eo(c){return zn.call(c)}function Oo(c){if(!Tt(c)||Fo(c))return!1;var g=Ur(c)||Oe(c)?so:D;return g.test(Ve(c))}function Mo(c){if(!Fs(c))return Rs(c);var g=[];for(var w in Object(c))xt.call(c,w)&&w!="constructor"&&g.push(w);return g}function Zn(c,g){if(g)return c.slice();var w=new c.constructor(c.length);return c.copy(w),w}function Dr(c){var g=new c.constructor(c.byteLength);return new Mr(g).set(new Mr(c)),g}function Sn(c,g){var w=g?Dr(c.buffer):c.buffer;return new c.constructor(w,c.byteOffset,c.byteLength)}function Ds(c,g,w){var R=g?w(Ue(c),!0):Ue(c);return de(R,ye,new c.constructor)}function Ls(c){var g=new c.constructor(c.source,N.exec(c));return g.lastIndex=c.lastIndex,g}function Ao(c,g,w){var R=g?w(Ms(c),!0):Ms(c);return de(R,te,new c.constructor)}function jo(c){return Ps?Object(Ps.call(c)):{}}function No(c,g){var w=g?Dr(c.buffer):c.buffer;return new c.constructor(w,c.byteOffset,c.length)}function Io(c,g){var w=-1,R=c.length;for(g||(g=Array(R));++w<R;)g[w]=c[w];return g}function Lr(c,g,w,R){w||(w={});for(var Q=-1,G=g.length;++Q<G;){var le=g[Q],ae=void 0;qs(w,le,ae===void 0?c[le]:ae)}return w}function Ro(c,g){return Lr(c,Lt(c),g)}function Po(c){return To(c,Br,Lt)}function Tn(c,g){var w=c.__data__;return Lo(g)?w[typeof g=="string"?"string":"hash"]:w.map}function ft(c,g){var w=ge(c,g);return Oo(w)?w:void 0}var Lt=Ar?Er(Ar,Object):Bo,Ft=Eo;(Vn&&Ft(new Vn(new ArrayBuffer(1)))!=q||wn&&Ft(new wn)!=h||ht&&Ft(ht.resolve())!=b||Gn&&Ft(new Gn)!=A||jr&&Ft(new jr)!=j)&&(Ft=function(c){var g=zn.call(c),w=g==y?c.constructor:void 0,R=w?Ve(w):void 0;if(R)switch(R){case Nr:return q;case Cn:return h;case Ir:return b;case Rr:return A;case Pr:return j}return g});function $o(c){var g=c.length,w=c.constructor(g);return g&&typeof c[0]=="string"&&xt.call(c,"index")&&(w.index=c.index,w.input=c.input),w}function St(c){return typeof c.constructor=="function"&&!Fs(c)?So(it(c)):{}}function qo(c,g,w,R){var Q=c.constructor;switch(g){case $:return Dr(c);case a:case l:return new Q(+c);case q:return Sn(c,R);case B:case U:case H:case W:case k:case I:case x:case P:case O:return No(c,R);case h:return Ds(c,R,w);case p:case v:return new Q(c);case C:return Ls(c);case A:return Ao(c,R,w);case E:return jo(c)}}function Do(c,g){return g=g??s,!!g&&(typeof c=="number"||L.test(c))&&c>-1&&c%1==0&&c<g}function Lo(c){var g=typeof c;return g=="string"||g=="number"||g=="symbol"||g=="boolean"?c!=="__proto__":c===null}function Fo(c){return!!As&&As in c}function Fs(c){var g=c&&c.constructor,w=typeof g=="function"&&g.prototype||Wn;return c===w}function Ve(c){if(c!=null){try{return js.call(c)}catch{}try{return c+""}catch{}}return""}function Us(c){return qr(c,!0,!0)}function Bs(c,g){return c===g||c!==c&&g!==g}function Qn(c){return Uo(c)&&xt.call(c,"callee")&&(!Is.call(c,"callee")||zn.call(c)==i)}var Fr=Array.isArray;function er(c){return c!=null&&Ws(c.length)&&!Ur(c)}function Uo(c){return zs(c)&&er(c)}var Hs=Jn||Ho;function Ur(c){var g=Tt(c)?zn.call(c):"";return g==d||g==f}function Ws(c){return typeof c=="number"&&c>-1&&c%1==0&&c<=s}function Tt(c){var g=typeof c;return!!c&&(g=="object"||g=="function")}function zs(c){return!!c&&typeof c=="object"}function Br(c){return er(c)?Yn(c):Mo(c)}function Bo(){return[]}function Ho(){return!1}t.exports=Us}(Jr,Jr.exports)),Jr.exports}var Vr={exports:{}};Vr.exports;var Kl;function Dd(){return Kl||(Kl=1,function(t,e){var n=200,r="__lodash_hash_undefined__",s=1,i=2,o=9007199254740991,a="[object Arguments]",l="[object Array]",u="[object AsyncFunction]",d="[object Boolean]",f="[object Date]",h="[object Error]",p="[object Function]",y="[object GeneratorFunction]",b="[object Map]",C="[object Number]",A="[object Null]",v="[object Object]",E="[object Promise]",j="[object Proxy]",$="[object RegExp]",q="[object Set]",B="[object String]",U="[object Symbol]",H="[object Undefined]",W="[object WeakMap]",k="[object ArrayBuffer]",I="[object DataView]",x="[object Float32Array]",P="[object Float64Array]",O="[object Int8Array]",M="[object Int16Array]",N="[object Int32Array]",D="[object Uint8Array]",L="[object Uint8ClampedArray]",F="[object Uint16Array]",J="[object Uint32Array]",K=/[\\^$.*+?()[\]{}|]/g,Y=/^\[object .+?Constructor\]$/,ne=/^(?:0|[1-9]\d*)$/,V={};V[x]=V[P]=V[O]=V[M]=V[N]=V[D]=V[L]=V[F]=V[J]=!0,V[a]=V[l]=V[k]=V[d]=V[I]=V[f]=V[h]=V[p]=V[b]=V[C]=V[v]=V[$]=V[q]=V[B]=V[W]=!1;var ue=typeof an=="object"&&an&&an.Object===Object&&an,ye=typeof self=="object"&&self&&self.Object===Object&&self,te=ue||ye||Function("return this")(),se=e&&!e.nodeType&&e,ie=se&&!0&&t&&!t.nodeType&&t,de=ie&&ie.exports===se,fe=de&&ue.process,ge=function(){try{return fe&&fe.binding&&fe.binding("util")}catch{}}(),Oe=ge&&ge.isTypedArray;function Ue(c,g){for(var w=-1,R=c==null?0:c.length,Q=0,G=[];++w<R;){var le=c[w];g(le,w,c)&&(G[Q++]=le)}return G}function Er(c,g){for(var w=-1,R=g.length,Q=c.length;++w<R;)c[Q+w]=g[w];return c}function Ms(c,g){for(var w=-1,R=c==null?0:c.length;++w<R;)if(g(c[w],w,c))return!0;return!1}function no(c,g){for(var w=-1,R=Array(c);++w<c;)R[w]=g(w);return R}function ro(c){return function(g){return c(g)}}function Wn(c,g){return c.has(g)}function Or(c,g){return c==null?void 0:c[g]}function As(c){var g=-1,w=Array(c.size);return c.forEach(function(R,Q){w[++g]=[Q,R]}),w}function js(c,g){return function(w){return c(g(w))}}function xt(c){var g=-1,w=Array(c.size);return c.forEach(function(R){w[++g]=R}),w}var zn=Array.prototype,so=Function.prototype,vn=Object.prototype,Kn=te["__core-js_shared__"],Mr=so.toString,it=vn.hasOwnProperty,Ns=function(){var c=/[^.]+$/.exec(Kn&&Kn.keys&&Kn.keys.IE_PROTO||"");return c?"Symbol(src)_1."+c:""}(),Is=vn.toString,io=RegExp("^"+Mr.call(it).replace(K,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ar=de?te.Buffer:void 0,Jn=te.Symbol,Rs=te.Uint8Array,Vn=vn.propertyIsEnumerable,wn=zn.splice,ht=Jn?Jn.toStringTag:void 0,Gn=Object.getOwnPropertySymbols,jr=Ar?Ar.isBuffer:void 0,xn=js(Object.keys,Object),Nr=Lt(te,"DataView"),Cn=Lt(te,"Map"),Ir=Lt(te,"Promise"),Rr=Lt(te,"Set"),Pr=Lt(te,"WeakMap"),nn=Lt(Object,"create"),Ps=Ve(Nr),Dt=Ve(Cn),oo=Ve(Ir),ao=Ve(Rr),lo=Ve(Pr),$s=Jn?Jn.prototype:void 0,$r=$s?$s.valueOf:void 0;function qe(c){var g=-1,w=c==null?0:c.length;for(this.clear();++g<w;){var R=c[g];this.set(R[0],R[1])}}function co(){this.__data__=nn?nn(null):{},this.size=0}function uo(c){var g=this.has(c)&&delete this.__data__[c];return this.size-=g?1:0,g}function ho(c){var g=this.__data__;if(nn){var w=g[c];return w===r?void 0:w}return it.call(g,c)?g[c]:void 0}function fo(c){var g=this.__data__;return nn?g[c]!==void 0:it.call(g,c)}function po(c,g){var w=this.__data__;return this.size+=this.has(c)?0:1,w[c]=nn&&g===void 0?r:g,this}qe.prototype.clear=co,qe.prototype.delete=uo,qe.prototype.get=ho,qe.prototype.has=fo,qe.prototype.set=po;function Be(c){var g=-1,w=c==null?0:c.length;for(this.clear();++g<w;){var R=c[g];this.set(R[0],R[1])}}function go(){this.__data__=[],this.size=0}function mo(c){var g=this.__data__,w=Zn(g,c);if(w<0)return!1;var R=g.length-1;return w==R?g.pop():wn.call(g,w,1),--this.size,!0}function yo(c){var g=this.__data__,w=Zn(g,c);return w<0?void 0:g[w][1]}function bo(c){return Zn(this.__data__,c)>-1}function _o(c,g){var w=this.__data__,R=Zn(w,c);return R<0?(++this.size,w.push([c,g])):w[R][1]=g,this}Be.prototype.clear=go,Be.prototype.delete=mo,Be.prototype.get=yo,Be.prototype.has=bo,Be.prototype.set=_o;function Ze(c){var g=-1,w=c==null?0:c.length;for(this.clear();++g<w;){var R=c[g];this.set(R[0],R[1])}}function ko(){this.size=0,this.__data__={hash:new qe,map:new(Cn||Be),string:new qe}}function vo(c){var g=ft(this,c).delete(c);return this.size-=g?1:0,g}function wo(c){return ft(this,c).get(c)}function xo(c){return ft(this,c).has(c)}function Co(c,g){var w=ft(this,c),R=w.size;return w.set(c,g),this.size+=w.size==R?0:1,this}Ze.prototype.clear=ko,Ze.prototype.delete=vo,Ze.prototype.get=wo,Ze.prototype.has=xo,Ze.prototype.set=Co;function Yn(c){var g=-1,w=c==null?0:c.length;for(this.__data__=new Ze;++g<w;)this.add(c[g])}function qs(c){return this.__data__.set(c,r),this}function Xn(c){return this.__data__.has(c)}Yn.prototype.add=Yn.prototype.push=qs,Yn.prototype.has=Xn;function Ct(c){var g=this.__data__=new Be(c);this.size=g.size}function qr(){this.__data__=new Be,this.size=0}function So(c){var g=this.__data__,w=g.delete(c);return this.size=g.size,w}function To(c){return this.__data__.get(c)}function Eo(c){return this.__data__.has(c)}function Oo(c,g){var w=this.__data__;if(w instanceof Be){var R=w.__data__;if(!Cn||R.length<n-1)return R.push([c,g]),this.size=++w.size,this;w=this.__data__=new Ze(R)}return w.set(c,g),this.size=w.size,this}Ct.prototype.clear=qr,Ct.prototype.delete=So,Ct.prototype.get=To,Ct.prototype.has=Eo,Ct.prototype.set=Oo;function Mo(c,g){var w=Qn(c),R=!w&&Bs(c),Q=!w&&!R&&er(c),G=!w&&!R&&!Q&&zs(c),le=w||R||Q||G,ae=le?no(c.length,String):[],Me=ae.length;for(var he in c)it.call(c,he)&&!(le&&(he=="length"||Q&&(he=="offset"||he=="parent")||G&&(he=="buffer"||he=="byteLength"||he=="byteOffset")||qo(he,Me)))&&ae.push(he);return ae}function Zn(c,g){for(var w=c.length;w--;)if(Us(c[w][0],g))return w;return-1}function Dr(c,g,w){var R=g(c);return Qn(c)?R:Er(R,w(c))}function Sn(c){return c==null?c===void 0?H:A:ht&&ht in Object(c)?Ft(c):Fs(c)}function Ds(c){return Tt(c)&&Sn(c)==a}function Ls(c,g,w,R,Q){return c===g?!0:c==null||g==null||!Tt(c)&&!Tt(g)?c!==c&&g!==g:Ao(c,g,w,R,Ls,Q)}function Ao(c,g,w,R,Q,G){var le=Qn(c),ae=Qn(g),Me=le?l:St(c),he=ae?l:St(g);Me=Me==a?v:Me,he=he==a?v:he;var He=Me==v,Qe=he==v,Ae=Me==he;if(Ae&&er(c)){if(!er(g))return!1;le=!0,He=!1}if(Ae&&!He)return G||(G=new Ct),le||zs(c)?Lr(c,g,w,R,Q,G):Ro(c,g,Me,w,R,Q,G);if(!(w&s)){var We=He&&it.call(c,"__wrapped__"),De=Qe&&it.call(g,"__wrapped__");if(We||De){var rn=We?c.value():c,Ut=De?g.value():g;return G||(G=new Ct),Q(rn,Ut,w,R,G)}}return Ae?(G||(G=new Ct),Po(c,g,w,R,Q,G)):!1}function jo(c){if(!Ws(c)||Lo(c))return!1;var g=Hs(c)?io:Y;return g.test(Ve(c))}function No(c){return Tt(c)&&Ur(c.length)&&!!V[Sn(c)]}function Io(c){if(!Fo(c))return xn(c);var g=[];for(var w in Object(c))it.call(c,w)&&w!="constructor"&&g.push(w);return g}function Lr(c,g,w,R,Q,G){var le=w&s,ae=c.length,Me=g.length;if(ae!=Me&&!(le&&Me>ae))return!1;var he=G.get(c);if(he&&G.get(g))return he==g;var He=-1,Qe=!0,Ae=w&i?new Yn:void 0;for(G.set(c,g),G.set(g,c);++He<ae;){var We=c[He],De=g[He];if(R)var rn=le?R(De,We,He,g,c,G):R(We,De,He,c,g,G);if(rn!==void 0){if(rn)continue;Qe=!1;break}if(Ae){if(!Ms(g,function(Ut,En){if(!Wn(Ae,En)&&(We===Ut||Q(We,Ut,w,R,G)))return Ae.push(En)})){Qe=!1;break}}else if(!(We===De||Q(We,De,w,R,G))){Qe=!1;break}}return G.delete(c),G.delete(g),Qe}function Ro(c,g,w,R,Q,G,le){switch(w){case I:if(c.byteLength!=g.byteLength||c.byteOffset!=g.byteOffset)return!1;c=c.buffer,g=g.buffer;case k:return!(c.byteLength!=g.byteLength||!G(new Rs(c),new Rs(g)));case d:case f:case C:return Us(+c,+g);case h:return c.name==g.name&&c.message==g.message;case $:case B:return c==g+"";case b:var ae=As;case q:var Me=R&s;if(ae||(ae=xt),c.size!=g.size&&!Me)return!1;var he=le.get(c);if(he)return he==g;R|=i,le.set(c,g);var He=Lr(ae(c),ae(g),R,Q,G,le);return le.delete(c),He;case U:if($r)return $r.call(c)==$r.call(g)}return!1}function Po(c,g,w,R,Q,G){var le=w&s,ae=Tn(c),Me=ae.length,he=Tn(g),He=he.length;if(Me!=He&&!le)return!1;for(var Qe=Me;Qe--;){var Ae=ae[Qe];if(!(le?Ae in g:it.call(g,Ae)))return!1}var We=G.get(c);if(We&&G.get(g))return We==g;var De=!0;G.set(c,g),G.set(g,c);for(var rn=le;++Qe<Me;){Ae=ae[Qe];var Ut=c[Ae],En=g[Ae];if(R)var Pl=le?R(En,Ut,Ae,g,c,G):R(Ut,En,Ae,c,g,G);if(!(Pl===void 0?Ut===En||Q(Ut,En,w,R,G):Pl)){De=!1;break}rn||(rn=Ae=="constructor")}if(De&&!rn){var Ks=c.constructor,Js=g.constructor;Ks!=Js&&"constructor"in c&&"constructor"in g&&!(typeof Ks=="function"&&Ks instanceof Ks&&typeof Js=="function"&&Js instanceof Js)&&(De=!1)}return G.delete(c),G.delete(g),De}function Tn(c){return Dr(c,Br,$o)}function ft(c,g){var w=c.__data__;return Do(g)?w[typeof g=="string"?"string":"hash"]:w.map}function Lt(c,g){var w=Or(c,g);return jo(w)?w:void 0}function Ft(c){var g=it.call(c,ht),w=c[ht];try{c[ht]=void 0;var R=!0}catch{}var Q=Is.call(c);return R&&(g?c[ht]=w:delete c[ht]),Q}var $o=Gn?function(c){return c==null?[]:(c=Object(c),Ue(Gn(c),function(g){return Vn.call(c,g)}))}:Bo,St=Sn;(Nr&&St(new Nr(new ArrayBuffer(1)))!=I||Cn&&St(new Cn)!=b||Ir&&St(Ir.resolve())!=E||Rr&&St(new Rr)!=q||Pr&&St(new Pr)!=W)&&(St=function(c){var g=Sn(c),w=g==v?c.constructor:void 0,R=w?Ve(w):"";if(R)switch(R){case Ps:return I;case Dt:return b;case oo:return E;case ao:return q;case lo:return W}return g});function qo(c,g){return g=g??o,!!g&&(typeof c=="number"||ne.test(c))&&c>-1&&c%1==0&&c<g}function Do(c){var g=typeof c;return g=="string"||g=="number"||g=="symbol"||g=="boolean"?c!=="__proto__":c===null}function Lo(c){return!!Ns&&Ns in c}function Fo(c){var g=c&&c.constructor,w=typeof g=="function"&&g.prototype||vn;return c===w}function Fs(c){return Is.call(c)}function Ve(c){if(c!=null){try{return Mr.call(c)}catch{}try{return c+""}catch{}}return""}function Us(c,g){return c===g||c!==c&&g!==g}var Bs=Ds(function(){return arguments}())?Ds:function(c){return Tt(c)&&it.call(c,"callee")&&!Vn.call(c,"callee")},Qn=Array.isArray;function Fr(c){return c!=null&&Ur(c.length)&&!Hs(c)}var er=jr||Ho;function Uo(c,g){return Ls(c,g)}function Hs(c){if(!Ws(c))return!1;var g=Sn(c);return g==p||g==y||g==u||g==j}function Ur(c){return typeof c=="number"&&c>-1&&c%1==0&&c<=o}function Ws(c){var g=typeof c;return c!=null&&(g=="object"||g=="function")}function Tt(c){return c!=null&&typeof c=="object"}var zs=Oe?ro(Oe):No;function Br(c){return Fr(c)?Mo(c):Io(c)}function Bo(){return[]}function Ho(){return!1}t.exports=Uo}(Vr,Vr.exports)),Vr.exports}var Ys={},Jl;function Rg(){if(Jl)return Ys;Jl=1,Object.defineProperty(Ys,"__esModule",{value:!0});const t=qd(),e=Dd();var n;return function(r){function s(l={},u={},d=!1){typeof l!="object"&&(l={}),typeof u!="object"&&(u={});let f=t(u);d||(f=Object.keys(f).reduce((h,p)=>(f[p]!=null&&(h[p]=f[p]),h),{}));for(const h in l)l[h]!==void 0&&u[h]===void 0&&(f[h]=l[h]);return Object.keys(f).length>0?f:void 0}r.compose=s;function i(l={},u={}){typeof l!="object"&&(l={}),typeof u!="object"&&(u={});const d=Object.keys(l).concat(Object.keys(u)).reduce((f,h)=>(e(l[h],u[h])||(f[h]=u[h]===void 0?null:u[h]),f),{});return Object.keys(d).length>0?d:void 0}r.diff=i;function o(l={},u={}){l=l||{};const d=Object.keys(u).reduce((f,h)=>(u[h]!==l[h]&&l[h]!==void 0&&(f[h]=u[h]),f),{});return Object.keys(l).reduce((f,h)=>(l[h]!==u[h]&&u[h]===void 0&&(f[h]=null),f),d)}r.invert=o;function a(l,u,d=!1){if(typeof l!="object")return u;if(typeof u!="object")return;if(!d)return u;const f=Object.keys(u).reduce((h,p)=>(l[p]===void 0&&(h[p]=u[p]),h),{});return Object.keys(f).length>0?f:void 0}r.transform=a}(n||(n={})),Ys.default=n,Ys}var Xs={},Vl;function Ld(){if(Vl)return Xs;Vl=1,Object.defineProperty(Xs,"__esModule",{value:!0});var t;return function(e){function n(r){return typeof r.delete=="number"?r.delete:typeof r.retain=="number"?r.retain:typeof r.retain=="object"&&r.retain!==null?1:typeof r.insert=="string"?r.insert.length:1}e.length=n}(t||(t={})),Xs.default=t,Xs}var Zs={},Gl;function Pg(){if(Gl)return Zs;Gl=1,Object.defineProperty(Zs,"__esModule",{value:!0});const t=Ld();class e{constructor(r){this.ops=r,this.index=0,this.offset=0}hasNext(){return this.peekLength()<1/0}next(r){r||(r=1/0);const s=this.ops[this.index];if(s){const i=this.offset,o=t.default.length(s);if(r>=o-i?(r=o-i,this.index+=1,this.offset=0):this.offset+=r,typeof s.delete=="number")return{delete:r};{const a={};return s.attributes&&(a.attributes=s.attributes),typeof s.retain=="number"?a.retain=r:typeof s.retain=="object"&&s.retain!==null?a.retain=s.retain:typeof s.insert=="string"?a.insert=s.insert.substr(i,r):a.insert=s.insert,a}}else return{retain:1/0}}peek(){return this.ops[this.index]}peekLength(){return this.ops[this.index]?t.default.length(this.ops[this.index])-this.offset:1/0}peekType(){const r=this.ops[this.index];return r?typeof r.delete=="number"?"delete":typeof r.retain=="number"||typeof r.retain=="object"&&r.retain!==null?"retain":"insert":"retain"}rest(){if(this.hasNext()){if(this.offset===0)return this.ops.slice(this.index);{const r=this.offset,s=this.index,i=this.next(),o=this.ops.slice(this.index);return this.offset=r,this.index=s,[i].concat(o)}}else return[]}}return Zs.default=e,Zs}var Yl;function $g(){return Yl||(Yl=1,function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeMap=e.OpIterator=e.Op=void 0;const n=Ig(),r=qd(),s=Dd(),i=Rg();e.AttributeMap=i.default;const o=Ld();e.Op=o.default;const a=Pg();e.OpIterator=a.default;const l="\0",u=(f,h)=>{if(typeof f!="object"||f===null)throw new Error(`cannot retain a ${typeof f}`);if(typeof h!="object"||h===null)throw new Error(`cannot retain a ${typeof h}`);const p=Object.keys(f)[0];if(!p||p!==Object.keys(h)[0])throw new Error(`embed types not matched: ${p} != ${Object.keys(h)[0]}`);return[p,f[p],h[p]]};class d{constructor(h){Array.isArray(h)?this.ops=h:h!=null&&Array.isArray(h.ops)?this.ops=h.ops:this.ops=[]}static registerEmbed(h,p){this.handlers[h]=p}static unregisterEmbed(h){delete this.handlers[h]}static getHandler(h){const p=this.handlers[h];if(!p)throw new Error(`no handlers for embed type "${h}"`);return p}insert(h,p){const y={};return typeof h=="string"&&h.length===0?this:(y.insert=h,p!=null&&typeof p=="object"&&Object.keys(p).length>0&&(y.attributes=p),this.push(y))}delete(h){return h<=0?this:this.push({delete:h})}retain(h,p){if(typeof h=="number"&&h<=0)return this;const y={retain:h};return p!=null&&typeof p=="object"&&Object.keys(p).length>0&&(y.attributes=p),this.push(y)}push(h){let p=this.ops.length,y=this.ops[p-1];if(h=r(h),typeof y=="object"){if(typeof h.delete=="number"&&typeof y.delete=="number")return this.ops[p-1]={delete:y.delete+h.delete},this;if(typeof y.delete=="number"&&h.insert!=null&&(p-=1,y=this.ops[p-1],typeof y!="object"))return this.ops.unshift(h),this;if(s(h.attributes,y.attributes)){if(typeof h.insert=="string"&&typeof y.insert=="string")return this.ops[p-1]={insert:y.insert+h.insert},typeof h.attributes=="object"&&(this.ops[p-1].attributes=h.attributes),this;if(typeof h.retain=="number"&&typeof y.retain=="number")return this.ops[p-1]={retain:y.retain+h.retain},typeof h.attributes=="object"&&(this.ops[p-1].attributes=h.attributes),this}}return p===this.ops.length?this.ops.push(h):this.ops.splice(p,0,h),this}chop(){const h=this.ops[this.ops.length-1];return h&&typeof h.retain=="number"&&!h.attributes&&this.ops.pop(),this}filter(h){return this.ops.filter(h)}forEach(h){this.ops.forEach(h)}map(h){return this.ops.map(h)}partition(h){const p=[],y=[];return this.forEach(b=>{(h(b)?p:y).push(b)}),[p,y]}reduce(h,p){return this.ops.reduce(h,p)}changeLength(){return this.reduce((h,p)=>p.insert?h+o.default.length(p):p.delete?h-p.delete:h,0)}length(){return this.reduce((h,p)=>h+o.default.length(p),0)}slice(h=0,p=1/0){const y=[],b=new a.default(this.ops);let C=0;for(;C<p&&b.hasNext();){let A;C<h?A=b.next(h-C):(A=b.next(p-C),y.push(A)),C+=o.default.length(A)}return new d(y)}compose(h){const p=new a.default(this.ops),y=new a.default(h.ops),b=[],C=y.peek();if(C!=null&&typeof C.retain=="number"&&C.attributes==null){let v=C.retain;for(;p.peekType()==="insert"&&p.peekLength()<=v;)v-=p.peekLength(),b.push(p.next());C.retain-v>0&&y.next(C.retain-v)}const A=new d(b);for(;p.hasNext()||y.hasNext();)if(y.peekType()==="insert")A.push(y.next());else if(p.peekType()==="delete")A.push(p.next());else{const v=Math.min(p.peekLength(),y.peekLength()),E=p.next(v),j=y.next(v);if(j.retain){const $={};if(typeof E.retain=="number")$.retain=typeof j.retain=="number"?v:j.retain;else if(typeof j.retain=="number")E.retain==null?$.insert=E.insert:$.retain=E.retain;else{const B=E.retain==null?"insert":"retain",[U,H,W]=u(E[B],j.retain),k=d.getHandler(U);$[B]={[U]:k.compose(H,W,B==="retain")}}const q=i.default.compose(E.attributes,j.attributes,typeof E.retain=="number");if(q&&($.attributes=q),A.push($),!y.hasNext()&&s(A.ops[A.ops.length-1],$)){const B=new d(p.rest());return A.concat(B).chop()}}else typeof j.delete=="number"&&(typeof E.retain=="number"||typeof E.retain=="object"&&E.retain!==null)&&A.push(j)}return A.chop()}concat(h){const p=new d(this.ops.slice());return h.ops.length>0&&(p.push(h.ops[0]),p.ops=p.ops.concat(h.ops.slice(1))),p}diff(h,p){if(this.ops===h.ops)return new d;const y=[this,h].map(E=>E.map(j=>{if(j.insert!=null)return typeof j.insert=="string"?j.insert:l;const $=E===h?"on":"with";throw new Error("diff() called "+$+" non-document")}).join("")),b=new d,C=n(y[0],y[1],p,!0),A=new a.default(this.ops),v=new a.default(h.ops);return C.forEach(E=>{let j=E[1].length;for(;j>0;){let $=0;switch(E[0]){case n.INSERT:$=Math.min(v.peekLength(),j),b.push(v.next($));break;case n.DELETE:$=Math.min(j,A.peekLength()),A.next($),b.delete($);break;case n.EQUAL:$=Math.min(A.peekLength(),v.peekLength(),j);const q=A.next($),B=v.next($);s(q.insert,B.insert)?b.retain($,i.default.diff(q.attributes,B.attributes)):b.push(B).delete($);break}j-=$}}),b.chop()}eachLine(h,p=`
`){const y=new a.default(this.ops);let b=new d,C=0;for(;y.hasNext();){if(y.peekType()!=="insert")return;const A=y.peek(),v=o.default.length(A)-y.peekLength(),E=typeof A.insert=="string"?A.insert.indexOf(p,v)-v:-1;if(E<0)b.push(y.next());else if(E>0)b.push(y.next(E));else{if(h(b,y.next(1).attributes||{},C)===!1)return;C+=1,b=new d}}b.length()>0&&h(b,{},C)}invert(h){const p=new d;return this.reduce((y,b)=>{if(b.insert)p.delete(o.default.length(b));else{if(typeof b.retain=="number"&&b.attributes==null)return p.retain(b.retain),y+b.retain;if(b.delete||typeof b.retain=="number"){const C=b.delete||b.retain;return h.slice(y,y+C).forEach(v=>{b.delete?p.push(v):b.retain&&b.attributes&&p.retain(o.default.length(v),i.default.invert(b.attributes,v.attributes))}),y+C}else if(typeof b.retain=="object"&&b.retain!==null){const C=h.slice(y,y+1),A=new a.default(C.ops).next(),[v,E,j]=u(b.retain,A.insert),$=d.getHandler(v);return p.retain({[v]:$.invert(E,j)},i.default.invert(b.attributes,A.attributes)),y+1}}return y},0),p.chop()}transform(h,p=!1){if(p=!!p,typeof h=="number")return this.transformPosition(h,p);const y=h,b=new a.default(this.ops),C=new a.default(y.ops),A=new d;for(;b.hasNext()||C.hasNext();)if(b.peekType()==="insert"&&(p||C.peekType()!=="insert"))A.retain(o.default.length(b.next()));else if(C.peekType()==="insert")A.push(C.next());else{const v=Math.min(b.peekLength(),C.peekLength()),E=b.next(v),j=C.next(v);if(E.delete)continue;if(j.delete)A.push(j);else{const $=E.retain,q=j.retain;let B=typeof q=="object"&&q!==null?q:v;if(typeof $=="object"&&$!==null&&typeof q=="object"&&q!==null){const U=Object.keys($)[0];if(U===Object.keys(q)[0]){const H=d.getHandler(U);H&&(B={[U]:H.transform($[U],q[U],p)})}}A.retain(B,i.default.transform(E.attributes,j.attributes,p))}}return A.chop()}transformPosition(h,p=!1){p=!!p;const y=new a.default(this.ops);let b=0;for(;y.hasNext()&&b<=h;){const C=y.peekLength(),A=y.peekType();if(y.next(),A==="delete"){h-=Math.min(C,h-b);continue}else A==="insert"&&(b<h||!p)&&(h+=C);b+=C}return h}}d.Op=o.default,d.OpIterator=a.default,d.AttributeMap=i.default,d.handlers={},e.default=d,t.exports=d,t.exports.default=d}(Gs,Gs.exports)),Gs.exports}var qg=$g();const Gr=Zf(qg);var Dg=Object.getOwnPropertyNames,Lg=Object.getOwnPropertySymbols,Fg=Object.prototype.hasOwnProperty;function Xl(t,e){return function(r,s,i){return t(r,s,i)&&e(r,s,i)}}function Qs(t){return function(n,r,s){if(!n||!r||typeof n!="object"||typeof r!="object")return t(n,r,s);var i=s.cache,o=i.get(n),a=i.get(r);if(o&&a)return o===r&&a===n;i.set(n,r),i.set(r,n);var l=t(n,r,s);return i.delete(n),i.delete(r),l}}function Zl(t){return Dg(t).concat(Lg(t))}var Ug=Object.hasOwn||function(t,e){return Fg.call(t,e)};function Fn(t,e){return t===e||!t&&!e&&t!==t&&e!==e}var Bg="__v",Hg="__o",Wg="_owner",Ql=Object.getOwnPropertyDescriptor,ec=Object.keys;function zg(t,e,n){var r=t.length;if(e.length!==r)return!1;for(;r-- >0;)if(!n.equals(t[r],e[r],r,r,t,e,n))return!1;return!0}function Kg(t,e){return Fn(t.getTime(),e.getTime())}function Jg(t,e){return t.name===e.name&&t.message===e.message&&t.cause===e.cause&&t.stack===e.stack}function Vg(t,e){return t===e}function tc(t,e,n){var r=t.size;if(r!==e.size)return!1;if(!r)return!0;for(var s=new Array(r),i=t.entries(),o,a,l=0;(o=i.next())&&!o.done;){for(var u=e.entries(),d=!1,f=0;(a=u.next())&&!a.done;){if(s[f]){f++;continue}var h=o.value,p=a.value;if(n.equals(h[0],p[0],l,f,t,e,n)&&n.equals(h[1],p[1],h[0],p[0],t,e,n)){d=s[f]=!0;break}f++}if(!d)return!1;l++}return!0}var Gg=Fn;function Yg(t,e,n){var r=ec(t),s=r.length;if(ec(e).length!==s)return!1;for(;s-- >0;)if(!Fd(t,e,n,r[s]))return!1;return!0}function Hr(t,e,n){var r=Zl(t),s=r.length;if(Zl(e).length!==s)return!1;for(var i,o,a;s-- >0;)if(i=r[s],!Fd(t,e,n,i)||(o=Ql(t,i),a=Ql(e,i),(o||a)&&(!o||!a||o.configurable!==a.configurable||o.enumerable!==a.enumerable||o.writable!==a.writable)))return!1;return!0}function Xg(t,e){return Fn(t.valueOf(),e.valueOf())}function Zg(t,e){return t.source===e.source&&t.flags===e.flags}function nc(t,e,n){var r=t.size;if(r!==e.size)return!1;if(!r)return!0;for(var s=new Array(r),i=t.values(),o,a;(o=i.next())&&!o.done;){for(var l=e.values(),u=!1,d=0;(a=l.next())&&!a.done;){if(!s[d]&&n.equals(o.value,a.value,o.value,a.value,t,e,n)){u=s[d]=!0;break}d++}if(!u)return!1}return!0}function Qg(t,e){var n=t.length;if(e.length!==n)return!1;for(;n-- >0;)if(t[n]!==e[n])return!1;return!0}function em(t,e){return t.hostname===e.hostname&&t.pathname===e.pathname&&t.protocol===e.protocol&&t.port===e.port&&t.hash===e.hash&&t.username===e.username&&t.password===e.password}function Fd(t,e,n,r){return(r===Wg||r===Hg||r===Bg)&&(t.$$typeof||e.$$typeof)?!0:Ug(e,r)&&n.equals(t[r],e[r],r,r,t,e,n)}var tm="[object Arguments]",nm="[object Boolean]",rm="[object Date]",sm="[object Error]",im="[object Map]",om="[object Number]",am="[object Object]",lm="[object RegExp]",cm="[object Set]",um="[object String]",dm="[object URL]",hm=Array.isArray,rc=typeof ArrayBuffer=="function"&&ArrayBuffer.isView?ArrayBuffer.isView:null,sc=Object.assign,fm=Object.prototype.toString.call.bind(Object.prototype.toString);function pm(t){var e=t.areArraysEqual,n=t.areDatesEqual,r=t.areErrorsEqual,s=t.areFunctionsEqual,i=t.areMapsEqual,o=t.areNumbersEqual,a=t.areObjectsEqual,l=t.arePrimitiveWrappersEqual,u=t.areRegExpsEqual,d=t.areSetsEqual,f=t.areTypedArraysEqual,h=t.areUrlsEqual;return function(y,b,C){if(y===b)return!0;if(y==null||b==null)return!1;var A=typeof y;if(A!==typeof b)return!1;if(A!=="object")return A==="number"?o(y,b,C):A==="function"?s(y,b,C):!1;var v=y.constructor;if(v!==b.constructor)return!1;if(v===Object)return a(y,b,C);if(hm(y))return e(y,b,C);if(rc!=null&&rc(y))return f(y,b,C);if(v===Date)return n(y,b,C);if(v===RegExp)return u(y,b,C);if(v===Map)return i(y,b,C);if(v===Set)return d(y,b,C);var E=fm(y);return E===rm?n(y,b,C):E===lm?u(y,b,C):E===im?i(y,b,C):E===cm?d(y,b,C):E===am?typeof y.then!="function"&&typeof b.then!="function"&&a(y,b,C):E===dm?h(y,b,C):E===sm?r(y,b,C):E===tm?a(y,b,C):E===nm||E===om||E===um?l(y,b,C):!1}}function gm(t){var e=t.circular,n=t.createCustomConfig,r=t.strict,s={areArraysEqual:r?Hr:zg,areDatesEqual:Kg,areErrorsEqual:Jg,areFunctionsEqual:Vg,areMapsEqual:r?Xl(tc,Hr):tc,areNumbersEqual:Gg,areObjectsEqual:r?Hr:Yg,arePrimitiveWrappersEqual:Xg,areRegExpsEqual:Zg,areSetsEqual:r?Xl(nc,Hr):nc,areTypedArraysEqual:r?Hr:Qg,areUrlsEqual:em};if(n&&(s=sc({},s,n(s))),e){var i=Qs(s.areArraysEqual),o=Qs(s.areMapsEqual),a=Qs(s.areObjectsEqual),l=Qs(s.areSetsEqual);s=sc({},s,{areArraysEqual:i,areMapsEqual:o,areObjectsEqual:a,areSetsEqual:l})}return s}function mm(t){return function(e,n,r,s,i,o,a){return t(e,n,a)}}function ym(t){var e=t.circular,n=t.comparator,r=t.createState,s=t.equals,i=t.strict;if(r)return function(l,u){var d=r(),f=d.cache,h=f===void 0?e?new WeakMap:void 0:f,p=d.meta;return n(l,u,{cache:h,equals:s,meta:p,strict:i})};if(e)return function(l,u){return n(l,u,{cache:new WeakMap,equals:s,meta:void 0,strict:i})};var o={cache:void 0,equals:s,meta:void 0,strict:i};return function(l,u){return n(l,u,o)}}var zt=mn();mn({strict:!0});mn({circular:!0});mn({circular:!0,strict:!0});mn({createInternalComparator:function(){return Fn}});mn({strict:!0,createInternalComparator:function(){return Fn}});mn({circular:!0,createInternalComparator:function(){return Fn}});mn({circular:!0,createInternalComparator:function(){return Fn},strict:!0});function mn(t){t===void 0&&(t={});var e=t.circular,n=e===void 0?!1:e,r=t.createInternalComparator,s=t.createState,i=t.strict,o=i===void 0?!1:i,a=gm(t),l=pm(a),u=r?r(l):mm(l);return ym({circular:n,comparator:l,createState:s,equals:u,strict:o})}const bm=new Set(["http:","https:","mailto:","sms:","tel:"]);let Ud=class Bd extends pn{static getType(){return"link"}static clone(e){return new Bd(e.__url,{rel:e.__rel,target:e.__target,title:e.__title},e.__key)}constructor(e="",n={},r){super(r);const{target:s=null,rel:i=null,title:o=null}=n;this.__url=e,this.__target=s,this.__rel=i,this.__title=o}createDOM(e){const n=document.createElement("a");return this.updateLinkDOM(null,n,e),Ot(n,e.theme.link),n}updateLinkDOM(e,n,r){if(yd(n)){e&&e.__url===this.__url||(n.href=this.sanitizeUrl(this.__url));for(const s of["target","rel","title"]){const i=`__${s}`,o=this[i];e&&e[i]===o||(o?n[s]=o:n.removeAttribute(s))}}}updateDOM(e,n,r){return this.updateLinkDOM(e,n,r),!1}static importDOM(){return{a:e=>({conversion:_m,priority:1})}}static importJSON(e){return pa().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setURL(e.url).setRel(e.rel||null).setTarget(e.target||null).setTitle(e.title||null)}sanitizeUrl(e){e=ic(e);try{const n=new URL(ic(e));if(!bm.has(n.protocol))return"about:blank"}catch{return e}return e}exportJSON(){return{...super.exportJSON(),rel:this.getRel(),target:this.getTarget(),title:this.getTitle(),url:this.getURL()}}getURL(){return this.getLatest().__url}setURL(e){const n=this.getWritable();return n.__url=e,n}getTarget(){return this.getLatest().__target}setTarget(e){const n=this.getWritable();return n.__target=e,n}getRel(){return this.getLatest().__rel}setRel(e){const n=this.getWritable();return n.__rel=e,n}getTitle(){return this.getLatest().__title}setTitle(e){const n=this.getWritable();return n.__title=e,n}insertNewAfter(e,n=!0){const r=pa(this.__url,{rel:this.__rel,target:this.__target,title:this.__title});return this.insertAfter(r,n),r}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}canBeEmpty(){return!1}isInline(){return!0}extractWithChild(e,n,r){if(!X(n))return!1;const s=n.anchor.getNode(),i=n.focus.getNode();return this.isParentOf(s)&&this.isParentOf(i)&&n.getTextContent().length>0}isEmailURI(){return this.__url.startsWith("mailto:")}isWebSiteURI(){return this.__url.startsWith("https://")||this.__url.startsWith("http://")}};function _m(t){let e=null;if(yd(t)){const n=t.textContent;(n!==null&&n!==""||t.children.length>0)&&(e=pa(t.getAttribute("href")||"",{rel:t.getAttribute("rel"),target:t.getAttribute("target"),title:t.getAttribute("title")}))}return{node:e}}function pa(t="",e){return Ne(new Ud(t,e))}function km(t){return t instanceof Ud}const vm=/^\+?[0-9\s()-]{5,}$/;function ic(t){return t.match(/^[a-z][a-z0-9+.-]*:/i)||t.match(/^[/#.]/)?t:t.includes("@")?`mailto:${t}`:vm.test(t)?`tel:${t}`:`https://${t}`}const Hd=[];let Wd=class zd extends pn{static getType(){return"mark"}static clone(e){return new zd(e.__ids,e.__key)}static importDOM(){return null}static importJSON(e){return oc().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setIDs(e.ids)}exportJSON(){return{...super.exportJSON(),ids:this.getIDs()}}constructor(e=Hd,n){super(n),this.__ids=e}createDOM(e){const n=document.createElement("mark");return Ot(n,e.theme.mark),this.__ids.length>1&&Ot(n,e.theme.markOverlap),n}updateDOM(e,n,r){const s=e.__ids,i=this.__ids,o=s.length,a=i.length,l=r.theme.markOverlap;return o!==a&&(o===1?a===2&&Ot(n,l):a===1&&ki(n,l)),!1}hasID(e){return this.getIDs().includes(e)}getIDs(){return Array.from(this.getLatest().__ids)}setIDs(e){const n=this.getWritable();return n.__ids=e,n}addID(e){const n=this.getWritable();return n.__ids.includes(e)?n:n.setIDs([...n.__ids,e])}deleteID(e){const n=this.getWritable(),r=n.__ids.indexOf(e);if(r===-1)return n;const s=Array.from(n.__ids);return s.splice(r,1),n.setIDs(s)}insertNewAfter(e,n=!0){const r=oc(this.__ids);return this.insertAfter(r,n),r}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}canBeEmpty(){return!1}isInline(){return!0}extractWithChild(e,n,r){if(!X(n)||r==="html")return!1;const s=n.anchor,i=n.focus,o=s.getNode(),a=i.getNode(),l=n.isBackward()?s.offset-i.offset:i.offset-s.offset;return this.isParentOf(o)&&this.isParentOf(a)&&this.getTextContent().length===l}excludeFromCopy(e){return e!=="clone"}};function oc(t=Hd){return Ne(new Wd(t))}function wm(t){return t instanceof Wd}const Kd=Object.freeze({"	":"\\t","\n":"\\n"}),ac=new RegExp(Object.keys(Kd).join("|"),"g"),Mt=Object.freeze({ancestorHasNextSibling:"|",ancestorIsLastChild:" ",hasNextSibling:"",isLastChild:"",selectedChar:"^",selectedLine:">"}),xm=[t=>t.hasFormat("bold")&&"Bold",t=>t.hasFormat("code")&&"Code",t=>t.hasFormat("italic")&&"Italic",t=>t.hasFormat("strikethrough")&&"Strikethrough",t=>t.hasFormat("subscript")&&"Subscript",t=>t.hasFormat("superscript")&&"Superscript",t=>t.hasFormat("underline")&&"Underline",t=>t.hasFormat("highlight")&&"Highlight"],Cm=[t=>t.hasTextFormat("bold")&&"Bold",t=>t.hasTextFormat("code")&&"Code",t=>t.hasTextFormat("italic")&&"Italic",t=>t.hasTextFormat("strikethrough")&&"Strikethrough",t=>t.hasTextFormat("subscript")&&"Subscript",t=>t.hasTextFormat("superscript")&&"Superscript",t=>t.hasTextFormat("underline")&&"Underline",t=>t.hasTextFormat("highlight")&&"Highlight"],Sm=[t=>t.isDirectionless()&&"Directionless",t=>t.isUnmergeable()&&"Unmergeable"],Tm=[t=>t.isToken()&&"Token",t=>t.isSegmented()&&"Segmented"];function Em(t,e,n,r,s=!1){const i=t.getEditorState(),o=t._config,a=t._compositionKey,l=t._editable;if(n){let h="";return i.read(()=>{h=function(p){const y=document.createElement("div");return y.innerHTML=p.trim(),Vd(y,0).innerHTML}(rp(t))}),h}let u=` root
`;const d=i.read(()=>{const h=re();return Jd($t(),(p,y)=>{const b=`(${p.getKey()})`,C=p.getType()||"",A=p.isSelected();u+=`${A?Mt.selectedLine:" "} ${y.join(" ")} ${b} ${C} ${function(v,E,j=!1){const $=E?E(v,j):void 0;if($!==void 0&&$.length>0)return $;if(ee(v)){const q=v.getTextContent(),B=q.length===0?"(empty)":`"${lc(q,j)}"`,U=function(H){return[cc(H),Om(H),Mm(H),uc(H)].filter(Boolean).join(", ")}(v);return[B,U.length!==0?`{ ${U} }`:null].filter(Boolean).join(" ").trim()}if(km(v)){const q=v.getURL(),B=q.length===0?"(empty)":`"${lc(q,j)}"`,U=function(H){return[Am(H),jm(H),Nm(H),uc(H)].filter(Boolean).join(", ")}(v);return[B,U.length!==0?`{ ${U} }`:null].filter(Boolean).join(" ").trim()}if(wm(v))return`ids: [ ${v.getIDs().join(", ")} ]`;if(ip(v)){const q=function(U){let H=Cm.map(W=>W(U)).filter(Boolean).join(", ").toLocaleLowerCase();return H!==""&&(H="format: "+H),H}(v);let B=q!==""?`{ ${q} }`:"";return B+=v.__style?`(${v.__style})`:"",B}return""}(p,r,s)}
`,u+=function({indent:v,isSelected:E,node:j,nodeKeyDisplay:$,selection:q,typeDisplay:B}){if(!ee(j)||!X(q)||!E||we(j))return"";const U=q.anchor,H=q.focus;if(j.getTextContent()===""||U.getNode()===q.focus.getNode()&&U.offset===H.offset)return"";const[W,k]=function(D,L){const F=L.getStartEndPoints();if($l(L)||F===null)return[-1,-1];const[J,K]=F,Y=D.getTextContent(),ne=Y.length;let V=-1,ue=-1;if(J.type==="text"&&K.type==="text"){const se=J.getNode(),ie=K.getNode();se===ie&&D===se&&J.offset!==K.offset?[V,ue]=J.offset<K.offset?[J.offset,K.offset]:[K.offset,J.offset]:[V,ue]=D===se?se.isBefore(ie)?[J.offset,ne]:[0,J.offset]:D===ie?ie.isBefore(se)?[K.offset,ne]:[0,K.offset]:[0,ne]}const ye=(Y.slice(0,V).match(ac)||[]).length,te=(Y.slice(V,ue).match(ac)||[]).length;return[V+ye,ue+ye+te]}(j,q);if(W===k)return"";const I=v[v.length-1]===Mt.hasNextSibling?Mt.ancestorHasNextSibling:Mt.ancestorIsLastChild,x=[...v.slice(0,v.length-1),I],P=Array(W+1).fill(" "),O=Array(k-W).fill(Mt.selectedChar),M=B.length+2,N=Array($.length+M).fill(" ");return[Mt.selectedLine,x.join(" "),[...N,...P,...O].join("")].join(" ")+`
`}({indent:y,isSelected:A,node:p,nodeKeyDisplay:b,selection:h,typeDisplay:C})}),h===null?": null":X(h)?function(p){let y="";const b=cc(p);y+=`: range ${b!==""?`{ ${b} }`:""} ${p.style!==""?`{ style: ${p.style} } `:""}`;const C=p.anchor,A=p.focus,v=C.offset,E=A.offset;return y+=`
   anchor { key: ${C.key}, offset: ${v===null?"null":v}, type: ${C.type} }`,y+=`
   focus { key: ${A.key}, offset: ${E===null?"null":E}, type: ${A.type} }`,y}(h):sp(h)?function(p){return`: table
   { table: ${p.tableKey}, anchorCell: ${p.anchor.key}, focusCell: ${p.focus.key} }`}(h):function(p){return $l(p)?`: node
   [${Array.from(p._nodes).join(", ")}]`:""}(h)});if(u+=`
 selection`+d,u+=`

 commands:`,e.length)for(const{index:h,type:p,payload:y}of e)u+=`
   ${h}. { type: ${p}, payload: ${y instanceof Event?y.constructor.name:y} }`;else u+=`
   None dispatched.`;const{version:f}=t.constructor;return u+=`

 editor${f?` (v${f})`:""}:`,u+=`
   namespace ${o.namespace}`,a!==null&&(u+=`
   compositionKey ${a}`),u+=`
   editable ${String(l)}`,u}function Jd(t,e,n=[]){const r=t.getChildren(),s=r.length;r.forEach((i,o)=>{e(i,n.concat(o===s-1?Mt.isLastChild:Mt.hasNextSibling)),we(i)&&Jd(i,e,n.concat(o===s-1?Mt.ancestorIsLastChild:Mt.ancestorHasNextSibling))})}function lc(t,e=!1){const n=Object.entries(Kd).reduce((r,[s,i])=>r.replace(new RegExp(s,"g"),String(i)),t);return e?n.replace(/[^\s]/g,"*"):n}function Om(t){let e=Sm.map(n=>n(t)).filter(Boolean).join(", ").toLocaleLowerCase();return e!==""&&(e="detail: "+e),e}function Mm(t){let e=Tm.map(n=>n(t)).filter(Boolean).join(", ").toLocaleLowerCase();return e!==""&&(e="mode: "+e),e}function cc(t){let e=xm.map(n=>n(t)).filter(Boolean).join(", ").toLocaleLowerCase();return e!==""&&(e="format: "+e),e}function Am(t){let e=t.getTarget();return e!=null&&(e="target: "+e),e}function jm(t){let e=t.getRel();return e!=null&&(e="rel: "+e),e}function Nm(t){let e=t.getTitle();return e!=null&&(e="title: "+e),e}function uc(t){if(!t.__state)return!1;const e=[];for(const[r,s]of t.__state.knownState.entries()){if(r.isEqual(s,r.defaultValue))continue;const i=JSON.stringify(r.unparse(s));e.push(`[${r.key}: ${i}]`)}let n=e.join(",");return n!==""&&(n="state: "+n),n}function Vd(t,e){const n=new Array(1+e++).join("  "),r=new Array(e-1).join("  ");let s;for(let i=0;i<t.children.length;i++)s=document.createTextNode(`
`+n),t.insertBefore(s,t.children[i]),Vd(t.children[i],e),t.lastElementChild===t.children[i]&&(s=document.createTextNode(`
`+r),t.appendChild(s));return t}const Im=_.forwardRef(function({treeTypeButtonClassName:t,timeTravelButtonClassName:e,timeTravelPanelSliderClassName:n,timeTravelPanelButtonClassName:r,viewClassName:s,timeTravelPanelClassName:i,editorState:o,setEditorState:a,setEditorReadOnly:l,generateContent:u,commandsLog:d=[]},f){const[h,p]=_.useState([]),[y,b]=_.useState(""),[C,A]=_.useState(!1),[v,E]=_.useState(!1),j=_.useRef(0),$=_.useRef(null),[q,B]=_.useState(!1),[U,H]=_.useState(!1),[W,k]=_.useState(!1),I=_.useRef(),x=_.useRef([]),P=_.useRef(0),O=_.useCallback(N=>{const D=++P.current;u(N).then(L=>{D===P.current&&b(L)}).catch(L=>{D===P.current&&b(`Error rendering tree: ${L.message}

Stack:
${L.stack}`)})},[u]);_.useEffect(()=>{if(!(!W&&o._nodeMap.size>1e3&&(H(!0),!W))&&(I.current!==o||x.current!==d)){const N=I.current!==o;I.current=o,x.current=d,O(v),!C&&N&&p(D=>[...D,[Date.now(),o]])}},[o,O,v,W,C,d]);const M=h.length;return _.useEffect(()=>{if(q){let N;const D=()=>{const L=j.current;if(L===M-1)return void B(!1);const F=h[L][0],J=h[L+1][0];N=setTimeout(()=>{j.current++;const K=j.current,Y=$.current;Y!==null&&(Y.value=String(K)),a(h[K][1]),D()},J-F)};return D(),()=>{clearTimeout(N)}}},[h,q,M,a]),m.jsxs("div",{className:s,children:[!W&&U?m.jsxs("div",{style:{padding:20},children:[m.jsx("span",{style:{marginRight:20},children:"Detected large EditorState, this can impact debugging performance."}),m.jsx("button",{onClick:()=>{k(!0)},style:{background:"transparent",border:"1px solid white",color:"white",cursor:"pointer",padding:5},children:"Show full tree"})]}):null,W?null:m.jsx("button",{onClick:()=>(O(!v),void E(!v)),className:t,type:"button",children:v?"Tree":"Export DOM"}),!C&&(W||!U)&&M>2&&m.jsx("button",{onClick:()=>{l(!0),j.current=M-1,A(!0)},className:e,type:"button",children:"Time Travel"}),(W||!U)&&m.jsx("pre",{ref:f,children:y}),C&&(W||!U)&&m.jsxs("div",{className:i,children:[m.jsx("button",{className:r,onClick:()=>{j.current===M-1&&(j.current=1),B(!q)},type:"button",children:q?"Pause":"Play"}),m.jsx("input",{className:n,ref:$,onChange:N=>{const D=Number(N.target.value),L=h[D];L&&(j.current=D,a(L[1]))},type:"range",min:"1",max:M-1}),m.jsx("button",{className:r,onClick:()=>{l(!1);const N=h.length-1,D=h[N];a(D[1]);const L=$.current;L!==null&&(L.value=String(N)),A(!1),B(!1)},type:"button",children:"Exit"})]})]})});function Rm(t,e){const n=new Set;let r=0;for(const[s]of t._commands)n.add(t.registerCommand(s,i=>(e(o=>{r+=1;const a=[...o];return a.push({index:r,payload:i,type:s.type?s.type:"UNKNOWN"}),a.length>10&&a.shift(),a}),!1),Xr));return()=>n.forEach(s=>s())}function Pm(t){const[e,n]=_.useState([]);return _.useEffect(()=>Rm(t,n),[t]),_.useMemo(()=>e,[e])}function $m({treeTypeButtonClassName:t,timeTravelButtonClassName:e,timeTravelPanelSliderClassName:n,timeTravelPanelButtonClassName:r,timeTravelPanelClassName:s,viewClassName:i,editor:o,customPrintNode:a}){const l=_.createRef(),[u,d]=_.useState(o.getEditorState()),f=Pm(o);return _.useEffect(()=>Xe(o.registerUpdateListener(({editorState:h})=>{d(h)}),o.registerEditableListener(()=>{d(o.getEditorState())})),[o]),_.useEffect(()=>{const h=l.current;if(h!==null)return h.__lexicalEditor=o,()=>{h.__lexicalEditor=null}},[o,l]),m.jsx(Im,{treeTypeButtonClassName:t,timeTravelButtonClassName:e,timeTravelPanelSliderClassName:n,timeTravelPanelButtonClassName:r,viewClassName:i,timeTravelPanelClassName:s,setEditorReadOnly:h=>{const p=o.getRootElement();p!=null&&(p.contentEditable=h?"false":"true")},editorState:u,setEditorState:h=>o.setEditorState(h),generateContent:async function(h){return Em(o,f,h,a)},ref:l,commandsLog:f})}function Gd({editorRef:t}){const[e]=ce();return _.useEffect(()=>{typeof t=="function"?t(e):typeof t=="object"&&(t.current=e)},[e]),null}const ei=0,ga=1,ma=2,pt=0,qm=1,dc=2,Dm=3,Lm=4;function Fm(t,e,n,r,s){if(t===null||n.size===0&&r.size===0&&!s)return pt;const i=e._selection,o=t._selection;if(s)return qm;if(!(X(i)&&X(o)&&o.isCollapsed()&&i.isCollapsed()))return pt;const a=function(A,v,E){const j=A._nodeMap,$=[];for(const q of v){const B=j.get(q);B!==void 0&&$.push(B)}for(const[q,B]of E){if(!B)continue;const U=j.get(q);U===void 0||ap(U)||$.push(U)}return $}(e,n,r);if(a.length===0)return pt;if(a.length>1){const A=e._nodeMap,v=A.get(i.anchor.key),E=A.get(o.anchor.key);return v&&E&&!t._nodeMap.has(v.__key)&&ee(v)&&v.__text.length===1&&i.anchor.offset===1?dc:pt}const l=a[0],u=t._nodeMap.get(l.__key);if(!ee(u)||!ee(l)||u.__mode!==l.__mode)return pt;const d=u.__text,f=l.__text;if(d===f)return pt;const h=i.anchor,p=o.anchor;if(h.key!==p.key||h.type!=="text")return pt;const y=h.offset,b=p.offset,C=f.length-d.length;return C===1&&b===y-1?dc:C===-1&&b===y+1?Dm:C===-1&&b===y?Lm:pt}function Um(t,e){let n=Date.now(),r=pt;return(s,i,o,a,l,u)=>{const d=Date.now();if(u.has(ha))return r=pt,n=d,ma;const f=Fm(s,i,a,l,t.isComposing()),h=(()=>{const p=o===null||o.editor===t,y=u.has(op);if(!y&&p&&u.has(kd))return ei;if(s===null)return ga;const b=i._selection;return a.size>0||l.size>0?y===!1&&f!==pt&&f===r&&d<n+e&&p||a.size===1&&function(C,A,v){const E=A._nodeMap.get(C),j=v._nodeMap.get(C),$=A._selection,q=v._selection;return!(X($)&&X(q)&&$.anchor.type==="element"&&$.focus.type==="element"&&q.anchor.type==="text"&&q.focus.type==="text"||!ee(E)||!ee(j)||E.__parent!==j.__parent)&&JSON.stringify(A.read(()=>E.exportJSON()))===JSON.stringify(v.read(()=>j.exportJSON()))}(Array.from(a)[0],s,i)?ei:ga:b!==null?ei:ma})();return n=d,r=f,h}}function hc(t){t.undoStack=[],t.redoStack=[],t.current=null}function Bm(t,e,n){const r=Um(t,n);return Xe(t.registerCommand(Ja,()=>(function(i,o){const a=o.redoStack,l=o.undoStack;if(l.length!==0){const u=o.current,d=l.pop();u!==null&&(a.push(u),i.dispatchCommand(zr,!0)),l.length===0&&i.dispatchCommand(Kr,!1),o.current=d||null,d&&d.editor.setEditorState(d.editorState,{tag:ha})}}(t,e),!0),xe),t.registerCommand(Ka,()=>(function(i,o){const a=o.redoStack,l=o.undoStack;if(a.length!==0){const u=o.current;u!==null&&(l.push(u),i.dispatchCommand(Kr,!0));const d=a.pop();a.length===0&&i.dispatchCommand(zr,!1),o.current=d||null,d&&d.editor.setEditorState(d.editorState,{tag:ha})}}(t,e),!0),xe),t.registerCommand(_d,()=>(hc(e),!1),xe),t.registerCommand(bd,()=>(hc(e),t.dispatchCommand(zr,!1),t.dispatchCommand(Kr,!1),!0),xe),t.registerUpdateListener(({editorState:i,prevEditorState:o,dirtyLeaves:a,dirtyElements:l,tags:u})=>{const d=e.current,f=e.redoStack,h=e.undoStack,p=d===null?null:d.editorState;if(d!==null&&i===p)return;const y=r(o,i,d,a,l,u);if(y===ga)f.length!==0&&(e.redoStack=[],t.dispatchCommand(zr,!1)),d!==null&&(h.push({...d}),t.dispatchCommand(Kr,!0));else if(y===ma)return;e.current={editor:t,editorState:i}}))}function Hm(){return{current:null,redoStack:[],undoStack:[]}}function Yd({delay:t,externalHistoryState:e}){const[n]=ce();return function(r,s,i=1e3){const o=_.useMemo(()=>s||Hm(),[s]);_.useEffect(()=>Bm(r,o,i),[i,r,o])}(n,e,t),null}const ya=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,Wm=ya?_.useLayoutEffect:_.useEffect;let zm=class{constructor(e){this.key=e,this.ref={current:null},this.setRefElement=this.setRefElement.bind(this)}setRefElement(e){this.ref={current:e}}};const fc=t=>{const e=document.getElementById("typeahead-menu");if(!e)return;const n=e.getBoundingClientRect();n.top+n.height>window.innerHeight&&e.scrollIntoView({block:"center"}),n.top<0&&e.scrollIntoView({block:"center"}),t.scrollIntoView({block:"nearest"})};function pc(t,e){const n=t.getBoundingClientRect(),r=e.getBoundingClientRect();return n.top>r.top&&n.top<r.bottom}function Km(t,e,n,r){const[s]=ce();_.useEffect(()=>{if(e!=null&&t!=null){const i=s.getRootElement(),o=i!=null?function(f,h){let p=getComputedStyle(f);const y=p.position==="absolute",b=/(auto|scroll)/;if(p.position==="fixed")return document.body;for(let C=f;C=C.parentElement;)if(p=getComputedStyle(C),(!y||p.position!=="static")&&b.test(p.overflow+p.overflowY+p.overflowX))return C;return document.body}(i):document.body;let a=!1,l=pc(e,o);const u=function(){a||(window.requestAnimationFrame(function(){n(),a=!1}),a=!0);const f=pc(e,o);f!==l&&(l=f,r!=null&&r(f))},d=new ResizeObserver(n);return window.addEventListener("resize",n),document.addEventListener("scroll",u,{capture:!0,passive:!0}),d.observe(e),()=>{d.unobserve(e),window.removeEventListener("resize",n),document.removeEventListener("scroll",u,!0)}}},[e,s,r,n,t])}const gc=Va("SCROLL_TYPEAHEAD_OPTION_INTO_VIEW_COMMAND");function Jm({close:t,editor:e,anchorElementRef:n,resolution:r,options:s,menuRenderFn:i,onSelectOption:o,shouldSplitNodeWithQuery:a=!1,commandPriority:l=yr,preselectFirstItem:u=!0}){const[d,f]=_.useState(null),h=r.match&&r.match.matchingString;_.useEffect(()=>{u&&f(0)},[h,u]);const p=_.useCallback(b=>{e.update(()=>{const C=r.match!=null&&a?function(A){const v=re();if(!X(v)||!v.isCollapsed())return null;const E=v.anchor;if(E.type!=="text")return null;const j=E.getNode();if(!j.isSimpleText())return null;const $=E.offset,q=j.getTextContent().slice(0,$),B=A.replaceableString.length,U=$-function(W,k,I){let x=I;for(let P=x;P<=k.length;P++)W.slice(-P)===k.substring(0,P)&&(x=P);return x}(q,A.matchingString,B);if(U<0)return null;let H;return U===0?[H]=j.splitText($):[,H]=j.splitText(U,$),H}(r.match):null;o(b,C,t,r.match?r.match.matchingString:"")})},[e,a,r.match,o,t]),y=_.useCallback(b=>{const C=e.getRootElement();C!==null&&(C.setAttribute("aria-activedescendant","typeahead-item-"+b),f(b))},[e]);return _.useEffect(()=>()=>{const b=e.getRootElement();b!==null&&b.removeAttribute("aria-activedescendant")},[e]),Wm(()=>{s===null?f(null):d===null&&u&&y(0)},[s,d,y,u]),_.useEffect(()=>Xe(e.registerCommand(gc,({option:b})=>!(!b.ref||b.ref.current==null)&&(fc(b.ref.current),!0),l)),[e,y,l]),_.useEffect(()=>Xe(e.registerCommand(hp,b=>{const C=b;if(s!==null&&s.length){const A=d===null?0:d!==s.length-1?d+1:0;y(A);const v=s[A];v.ref!=null&&v.ref.current&&e.dispatchCommand(gc,{index:A,option:v}),C.preventDefault(),C.stopImmediatePropagation()}return!0},l),e.registerCommand(dp,b=>{const C=b;if(s!==null&&s.length){const A=d===null?s.length-1:d!==0?d-1:s.length-1;y(A);const v=s[A];v.ref!=null&&v.ref.current&&fc(v.ref.current),C.preventDefault(),C.stopImmediatePropagation()}return!0},l),e.registerCommand(wd,b=>{const C=b;return C.preventDefault(),C.stopImmediatePropagation(),t(),!0},l),e.registerCommand(up,b=>{const C=b;return s!==null&&d!==null&&s[d]!=null&&(C.preventDefault(),C.stopImmediatePropagation(),p(s[d]),!0)},l),e.registerCommand(vd,b=>s!==null&&d!==null&&s[d]!=null&&(b!==null&&(b.preventDefault(),b.stopImmediatePropagation()),p(s[d]),!0),l)),[p,t,e,s,d,y,l]),i(n,_.useMemo(()=>({options:s,selectOptionAndCleanUp:p,selectedIndex:d,setHighlightedIndex:f}),[p,d,s]),r.match?r.match.matchingString:"")}function mc(t,e){e!=null&&(t.className=e),t.setAttribute("aria-label","Typeahead menu"),t.setAttribute("role","listbox"),t.style.display="block",t.style.position="absolute"}function Vm({options:t,onWillOpen:e,onClose:n,onOpen:r,onSelectOption:s,menuRenderFn:i,anchorClassName:o,commandPriority:a=yr,parent:l}){const[u]=ce(),[d,f]=_.useState(null),h=_.useRef(null),p=function(v,E,j,$=ya?document.body:void 0,q=!0){const[B]=ce(),U=ya?document.createElement("div"):null,H=_.useRef(U),W=_.useCallback(()=>{if(H.current===null||$===void 0)return;H.current.style.top=H.current.style.bottom;const I=B.getRootElement(),x=H.current,P=x.firstChild;if(I!==null&&v!==null){const{left:O,top:M,width:N,height:D}=v.getRect(),L=H.current.offsetHeight;if(x.style.top=`${M+L+3+(q?window.pageYOffset:0)}px`,x.style.left=`${O+window.pageXOffset}px`,x.style.height=`${D}px`,x.style.width=`${N}px`,P!==null){P.style.top=`${M}`;const F=P.getBoundingClientRect(),J=F.height,K=F.width,Y=I.getBoundingClientRect();O+K>Y.right&&(x.style.left=`${Y.right-K+window.pageXOffset}px`),(M+J>window.innerHeight||M+J>Y.bottom)&&M-Y.top>J+D&&(x.style.top=`${M-J-D+(q?window.pageYOffset:0)}px`)}x.isConnected||(mc(x,j),$.append(x)),x.setAttribute("id","typeahead-menu"),I.setAttribute("aria-controls","typeahead-menu")}},[B,v,q,j,$]);_.useEffect(()=>{const I=B.getRootElement();return v!==null&&W(),()=>{I!==null&&I.removeAttribute("aria-controls");const x=H.current;x!==null&&x.isConnected&&(x.remove(),x.removeAttribute("id"))}},[B,W,v]);const k=_.useCallback(I=>{v!==null&&(I||E(null))},[v,E]);return Km(v,H.current,W,k),U!=null&&U===H.current&&(mc(U,j),$!=null&&$.append(U)),H}(d,f,o,l),y=_.useCallback(()=>{f(null),n!=null&&d!==null&&n()},[n,d]),b=_.useCallback(v=>{f(v),r!=null&&d===null&&r(v)},[r,d]),C=_.useCallback(v=>{v.preventDefault(),e!=null&&e(v);const E=lp(v.target);b({getRect:()=>new DOMRect(v.clientX/E,v.clientY/E,1,1)})},[b,e]),A=_.useCallback(v=>{d!==null&&h.current!=null&&v.target!=null&&cp(v.target)&&!h.current.contains(v.target)&&y()},[y,d]);return _.useEffect(()=>{const v=u.getRootElement();if(v)return v.addEventListener("contextmenu",C),()=>v.removeEventListener("contextmenu",C)},[u,C]),_.useEffect(()=>(document.addEventListener("click",A),()=>document.removeEventListener("click",A)),[u,A]),p.current===null||d===null||u===null?null:m.jsx(Jm,{close:y,resolution:d,editor:u,anchorElementRef:p,options:t,menuRenderFn:(v,E)=>i(v,E,{setMenuRef:j=>{h.current=j}}),onSelectOption:s,commandPriority:a})}const yc=[["Cat","rgb(125, 50, 0)"],["Dog","rgb(100, 0, 0)"],["Rabbit","rgb(150, 0, 0)"],["Frog","rgb(200, 0, 0)"],["Fox","rgb(200, 75, 0)"],["Hedgehog","rgb(0, 75, 0)"],["Pigeon","rgb(0, 125, 0)"],["Squirrel","rgb(75, 100, 0)"],["Bear","rgb(125, 100, 0)"],["Tiger","rgb(0, 0, 150)"],["Leopard","rgb(0, 0, 200)"],["Zebra","rgb(0, 0, 250)"],["Wolf","rgb(0, 100, 150)"],["Owl","rgb(0, 100, 100)"],["Gull","rgb(100, 0, 100)"],["Squid","rgb(150, 0, 150)"]],bc=yc[Math.floor(Math.random()*yc.length)],Gm=_.createContext({clientID:0,color:bc[1],isCollabActive:!1,name:bc[0],yjsDocMap:new Map});function Xd(t,e){return _.useContext(Gm)}const _r=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,Ym=_r&&"documentMode"in document?document.documentMode:null,Xm=!(!_r||!("InputEvent"in window)||Ym)&&"getTargetRanges"in new window.InputEvent("input"),Zm=_r&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent),_c=_r&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,Qm=_r&&/^(?=.*Chrome).*/i.test(navigator.userAgent),ey=_r&&/AppleWebKit\/[\d.]+/.test(navigator.userAgent)&&!Qm;function kc(t,e){e.update(()=>{if(t!==null){const n=Cd(t,KeyboardEvent)?null:t.clipboardData,r=re();if(r!==null&&n!=null){t.preventDefault();const s=Tp(e);s!==null&&n.setData("text/html",s),n.setData("text/plain",r.getTextContent())}}})}function ty(t){return Xe(t.registerCommand(Wo,e=>{const n=re();return!!X(n)&&(n.deleteCharacter(e),!0)},xe),t.registerCommand(Sp,e=>{const n=re();return!!X(n)&&(n.deleteWord(e),!0)},xe),t.registerCommand(Cp,e=>{const n=re();return!!X(n)&&(n.deleteLine(e),!0)},xe),t.registerCommand(xp,e=>{const n=re();if(!X(n))return!1;if(typeof e=="string")n.insertText(e);else{const r=e.dataTransfer;if(r!=null)ql(r,n);else{const s=e.data;s&&n.insertText(s)}}return!0},xe),t.registerCommand(wp,()=>{const e=re();return!!X(e)&&(e.removeText(),!0)},xe),t.registerCommand(Dl,e=>{const n=re();return!!X(n)&&(n.insertLineBreak(e),!0)},xe),t.registerCommand(vp,()=>{const e=re();return!!X(e)&&(e.insertLineBreak(),!0)},xe),t.registerCommand(kp,e=>{const n=re();if(!X(n))return!1;const r=e,s=r.shiftKey;return!!Ll(n,!0)&&(r.preventDefault(),Fl(n,s,!0),!0)},xe),t.registerCommand(_p,e=>{const n=re();if(!X(n))return!1;const r=e,s=r.shiftKey;return!!Ll(n,!1)&&(r.preventDefault(),Fl(n,s,!1),!0)},xe),t.registerCommand(bp,e=>{const n=re();return!!X(n)&&(!_c||navigator.language!=="ko-KR")&&(e.preventDefault(),t.dispatchCommand(Wo,!0))},xe),t.registerCommand(yp,e=>{const n=re();return!!X(n)&&(e.preventDefault(),t.dispatchCommand(Wo,!1))},xe),t.registerCommand(vd,e=>{const n=re();if(!X(n))return!1;if(e!==null){if((_c||Zm||ey)&&Xm)return!1;e.preventDefault()}return t.dispatchCommand(Dl,!1)},xe),t.registerCommand(gp,()=>(mp(),!0),xe),t.registerCommand(Ji,e=>{const n=re();return!!X(n)&&(kc(e,t),!0)},xe),t.registerCommand(Ki,e=>{const n=re();return!!X(n)&&(function(r,s){kc(r,s),s.update(()=>{const i=re();X(i)&&i.removeText()})}(e,t),!0)},xe),t.registerCommand(zi,e=>{const n=re();return!!X(n)&&(function(r,s){r.preventDefault(),s.update(()=>{const i=re(),o=Cd(r,ClipboardEvent)?r.clipboardData:null;o!=null&&X(i)&&ql(o,i)},{tag:pp})}(e,t),!0)},xe),t.registerCommand(xd,e=>{const n=re();return!!X(n)&&(e.preventDefault(),!0)},xe),t.registerCommand(fp,e=>{const n=re();return!!X(n)&&(e.preventDefault(),!0)},xe))}const ba=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0?_.useLayoutEffect:_.useEffect;function vc(t){return t.getEditorState().read(Mp(t.isComposing()))}function ny({contentEditable:t,placeholder:e=null,ErrorBoundary:n}){const[r]=ce(),s=function(i,o){const[a,l]=_.useState(()=>i.getDecorators());return ba(()=>i.registerDecoratorListener(u=>{yt.flushSync(()=>{l(u)})}),[i]),_.useEffect(()=>{l(i.getDecorators())},[i]),_.useMemo(()=>{const u=[],d=Object.keys(a);for(let f=0;f<d.length;f++){const h=d[f],p=m.jsx(o,{onError:b=>i._onError(b),children:m.jsx(_.Suspense,{fallback:null,children:a[h]})}),y=i.getElementByKey(h);y!==null&&u.push(yt.createPortal(p,y,h))}return u},[o,a,i])}(r,n);return function(i){ba(()=>Xe(ty(i),Ep(i)),[i])}(r),m.jsxs(m.Fragment,{children:[t,m.jsx(ry,{content:e}),s]})}function ry({content:t}){const[e]=ce(),n=function(s){const[i,o]=_.useState(()=>vc(s));return ba(()=>{function a(){const l=vc(s);o(l)}return a(),Xe(s.registerUpdateListener(()=>{a()}),s.registerEditableListener(()=>{a()}))},[s]),i}(e),r=Op();return n?typeof t=="function"?t(r):t:null}const jt=()=>new Map,_a=t=>{const e=jt();return t.forEach((n,r)=>{e.set(r,n)}),e},kr=(t,e,n)=>{let r=t.get(e);return r===void 0&&t.set(e,r=n()),r},sy=(t,e)=>{const n=[];for(const[r,s]of t)n.push(e(s,r));return n},iy=(t,e)=>{for(const[n,r]of t)if(e(r,n))return!0;return!1},or=()=>new Set,Vo=t=>t[t.length-1],ar=Array.from,oy=Array.isArray;class ay{constructor(){this._observers=jt()}on(e,n){return kr(this._observers,e,or).add(n),n}once(e,n){const r=(...s)=>{this.off(e,r),n(...s)};this.on(e,r)}off(e,n){const r=this._observers.get(e);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(e))}emit(e,n){return ar((this._observers.get(e)||jt()).values()).forEach(r=>r(...n))}destroy(){this._observers=jt()}}const Nn=Math.floor,xi=Math.abs,Zd=(t,e)=>t<e?t:e,vr=(t,e)=>t>e?t:e,ly=t=>t!==0?t<0:1/t<0,wc=1,xc=2,Go=4,Yo=8,cy=32,Qd=64,Mi=128,uy=31,Cc=63,ns=127,dy=2147483647,hy=Number.isInteger||(t=>typeof t=="number"&&isFinite(t)&&Nn(t)===t),fy=t=>t.toLowerCase(),py=/^\s*/g,gy=t=>t.replace(py,""),my=/([A-Z])/g,Sc=(t,e)=>gy(t.replace(my,n=>`${e}${fy(n)}`)),yy=t=>{const e=unescape(encodeURIComponent(t)),n=e.length,r=new Uint8Array(n);for(let s=0;s<n;s++)r[s]=e.codePointAt(s);return r},as=typeof TextEncoder<"u"?new TextEncoder:null,by=t=>as.encode(t),_y=as?by:yy;let Xo=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Xo&&Xo.decode(new Uint8Array).length===1&&(Xo=null);class ws{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const Qa=()=>new ws,ky=t=>{let e=t.cpos;for(let n=0;n<t.bufs.length;n++)e+=t.bufs[n].length;return e},Vt=t=>{const e=new Uint8Array(ky(t));let n=0;for(let r=0;r<t.bufs.length;r++){const s=t.bufs[r];e.set(s,n),n+=s.length}return e.set(new Uint8Array(t.cbuf.buffer,0,t.cpos),n),e},vy=(t,e)=>{const n=t.cbuf.length;n-t.cpos<e&&(t.bufs.push(new Uint8Array(t.cbuf.buffer,0,t.cpos)),t.cbuf=new Uint8Array(vr(n,e)*2),t.cpos=0)},Ie=(t,e)=>{const n=t.cbuf.length;t.cpos===n&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(n*2),t.cpos=0),t.cbuf[t.cpos++]=e},ka=Ie,be=(t,e)=>{for(;e>ns;)Ie(t,Mi|ns&e),e=Nn(e/128);Ie(t,ns&e)},el=(t,e)=>{const n=ly(e);for(n&&(e=-e),Ie(t,(e>Cc?Mi:0)|(n?Qd:0)|Cc&e),e=Nn(e/64);e>0;)Ie(t,(e>ns?Mi:0)|ns&e),e=Nn(e/128)},va=new Uint8Array(3e4),wy=va.length/3,xy=(t,e)=>{if(e.length<wy){const n=as.encodeInto(e,va).written||0;be(t,n);for(let r=0;r<n;r++)Ie(t,va[r])}else st(t,_y(e))},Cy=(t,e)=>{const n=unescape(encodeURIComponent(e)),r=n.length;be(t,r);for(let s=0;s<r;s++)Ie(t,n.codePointAt(s))},sr=as&&as.encodeInto?xy:Cy,tl=(t,e)=>{const n=t.cbuf.length,r=t.cpos,s=Zd(n-r,e.length),i=e.length-s;t.cbuf.set(e.subarray(0,s),r),t.cpos+=s,i>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(vr(n*2,i)),t.cbuf.set(e.subarray(s)),t.cpos=i)},st=(t,e)=>{be(t,e.byteLength),tl(t,e)},nl=(t,e)=>{vy(t,e);const n=new DataView(t.cbuf.buffer,t.cpos,e);return t.cpos+=e,n},Sy=(t,e)=>nl(t,4).setFloat32(0,e,!1),Ty=(t,e)=>nl(t,8).setFloat64(0,e,!1),Ey=(t,e)=>nl(t,8).setBigInt64(0,e,!1),Tc=new DataView(new ArrayBuffer(4)),Oy=t=>(Tc.setFloat32(0,t),Tc.getFloat32(0)===t),ls=(t,e)=>{switch(typeof e){case"string":Ie(t,119),sr(t,e);break;case"number":hy(e)&&xi(e)<=dy?(Ie(t,125),el(t,e)):Oy(e)?(Ie(t,124),Sy(t,e)):(Ie(t,123),Ty(t,e));break;case"bigint":Ie(t,122),Ey(t,e);break;case"object":if(e===null)Ie(t,126);else if(oy(e)){Ie(t,117),be(t,e.length);for(let n=0;n<e.length;n++)ls(t,e[n])}else if(e instanceof Uint8Array)Ie(t,116),st(t,e);else{Ie(t,118);const n=Object.keys(e);be(t,n.length);for(let r=0;r<n.length;r++){const s=n[r];sr(t,s),ls(t,e[s])}}break;case"boolean":Ie(t,e?120:121);break;default:Ie(t,127)}};class Ec extends ws{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&be(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const Oc=t=>{t.count>0&&(el(t.encoder,t.count===1?t.s:-t.s),t.count>1&&be(t.encoder,t.count-2))};class Ci{constructor(){this.encoder=new ws,this.s=0,this.count=0}write(e){this.s===e?this.count++:(Oc(this),this.count=1,this.s=e)}toUint8Array(){return Oc(this),Vt(this.encoder)}}const Mc=t=>{if(t.count>0){const e=t.diff*2+(t.count===1?0:1);el(t.encoder,e),t.count>1&&be(t.encoder,t.count-2)}};class Zo{constructor(){this.encoder=new ws,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(Mc(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return Mc(this),Vt(this.encoder)}}class My{constructor(){this.sarr=[],this.s="",this.lensE=new Ci}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new ws;return this.sarr.push(this.s),this.s="",sr(e,this.sarr.join("")),tl(e,this.lensE.toUint8Array()),Vt(e)}}const lr=t=>new Error(t),Nt=()=>{throw lr("Method unimplemented")},In=()=>{throw lr("Unexpected case")},Ay=crypto.getRandomValues.bind(crypto),eh=()=>Ay(new Uint32Array(1))[0],jy="10000000-1000-4000-8000"+-1e11,Ny=()=>jy.replace(/[018]/g,t=>(t^eh()&15>>t/4).toString(16)),Ac=t=>new Promise(t);Promise.all.bind(Promise);const jc=t=>t===void 0?null:t;class Iy{constructor(){this.map=new Map}setItem(e,n){this.map.set(e,n)}getItem(e){return this.map.get(e)}}let th=new Iy,Ry=!0;try{typeof localStorage<"u"&&localStorage&&(th=localStorage,Ry=!1)}catch{}const Py=th,$y=Object.assign,qy=Object.keys,Dy=(t,e)=>{for(const n in t)e(t[n],n)},Nc=t=>qy(t).length,Ly=t=>{for(const e in t)return!1;return!0},Fy=(t,e)=>{for(const n in t)if(!e(t[n],n))return!1;return!0},Uy=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),By=(t,e)=>t===e||Nc(t)===Nc(e)&&Fy(t,(n,r)=>(n!==void 0||Uy(e,r))&&e[r]===n),Hy=Object.freeze,nh=t=>{for(const e in t){const n=t[e];(typeof n=="object"||typeof n=="function")&&nh(t[e])}return Hy(t)},rl=(t,e,n=0)=>{try{for(;n<t.length;n++)t[n](...e)}finally{n<t.length&&rl(t,e,n+1)}},Wy=(t,e)=>e.includes(t);var rh={};const cs=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";let Et;const zy=()=>{if(Et===void 0)if(cs){Et=jt();const t=process.argv;let e=null;for(let n=0;n<t.length;n++){const r=t[n];r[0]==="-"?(e!==null&&Et.set(e,""),e=r):e!==null&&(Et.set(e,r),e=null)}e!==null&&Et.set(e,"")}else typeof location=="object"?(Et=jt(),(location.search||"?").slice(1).split("&").forEach(t=>{if(t.length!==0){const[e,n]=t.split("=");Et.set(`--${Sc(e,"-")}`,n),Et.set(`-${Sc(e,"-")}`,n)}})):Et=jt();return Et},wa=t=>zy().has(t),Ai=t=>jc(cs?rh[t.toUpperCase().replaceAll("-","_")]:Py.getItem(t)),sh=t=>wa("--"+t)||Ai(t)!==null;sh("production");const Ky=cs&&Wy(rh.FORCE_COLOR,["true","1","2"]),Jy=Ky||!wa("--no-colors")&&!sh("no-color")&&(!cs||process.stdout.isTTY)&&(!cs||wa("--color")||Ai("COLORTERM")!==null||(Ai("TERM")||"").includes("color"));class Vy{constructor(e,n){this.left=e,this.right=n}}const Ht=(t,e)=>new Vy(t,e);typeof DOMParser<"u"&&new DOMParser;const Gy=t=>sy(t,(e,n)=>`${n}:${e};`).join(""),Qt=Symbol,ih=Qt(),oh=Qt(),Yy=Qt(),Xy=Qt(),Zy=Qt(),ah=Qt(),Qy=Qt(),sl=Qt(),eb=Qt(),tb=t=>{var s;t.length===1&&((s=t[0])==null?void 0:s.constructor)===Function&&(t=t[0]());const e=[],n=[];let r=0;for(;r<t.length;r++){const i=t[r];if(i===void 0)break;if(i.constructor===String||i.constructor===Number)e.push(i);else if(i.constructor===Object)break}for(r>0&&n.push(e.join(""));r<t.length;r++){const i=t[r];i instanceof Symbol||n.push(i)}return n},nb={[ih]:Ht("font-weight","bold"),[oh]:Ht("font-weight","normal"),[Yy]:Ht("color","blue"),[Zy]:Ht("color","green"),[Xy]:Ht("color","grey"),[ah]:Ht("color","red"),[Qy]:Ht("color","purple"),[sl]:Ht("color","orange"),[eb]:Ht("color","black")},rb=t=>{var o;t.length===1&&((o=t[0])==null?void 0:o.constructor)===Function&&(t=t[0]());const e=[],n=[],r=jt();let s=[],i=0;for(;i<t.length;i++){const a=t[i],l=nb[a];if(l!==void 0)r.set(l.left,l.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const u=Gy(r);i>0||u.length>0?(e.push("%c"+a),n.push(u)):e.push(a)}else break}}for(i>0&&(s=n,s.unshift(e.join("")));i<t.length;i++){const a=t[i];a instanceof Symbol||s.push(a)}return s},lh=Jy?rb:tb,sb=(...t)=>{console.log(...lh(t)),ch.forEach(e=>e.print(t))},ib=(...t)=>{console.warn(...lh(t)),t.unshift(sl),ch.forEach(e=>e.print(t))},ch=or(),uh=t=>({[Symbol.iterator](){return this},next:t}),ob=(t,e)=>uh(()=>{let n;do n=t.next();while(!n.done&&!e(n.value));return n}),Qo=(t,e)=>uh(()=>{const{done:n,value:r}=t.next();return{done:n,value:n?void 0:e(r)}});class ab{constructor(e,n){this.clock=e,this.len=n}}class lb{constructor(){this.clients=new Map}}const dh=(t,e,n)=>e.clients.forEach((r,s)=>{const i=t.doc.store.clients.get(s);if(i!=null){const o=i[i.length-1],a=o.id.clock+o.length;for(let l=0,u=r[l];l<r.length&&u.clock<a;u=r[++l])bh(t,i,u.clock,u.len,n)}}),cb=(t,e)=>{let n=0,r=t.length-1;for(;n<=r;){const s=Nn((n+r)/2),i=t[s],o=i.clock;if(o<=e){if(e<o+i.len)return s;n=s+1}else r=s-1}return null},hh=(t,e)=>{const n=t.clients.get(e.client);return n!==void 0&&cb(n,e.clock)!==null},fh=t=>{t.clients.forEach(e=>{e.sort((s,i)=>s.clock-i.clock);let n,r;for(n=1,r=1;n<e.length;n++){const s=e[r-1],i=e[n];s.clock+s.len>=i.clock?s.len=vr(s.len,i.clock+i.len-s.clock):(r<n&&(e[r]=i),r++)}e.length=r})},ph=(t,e,n,r)=>{kr(t.clients,e,()=>[]).push(new ab(n,r))},ub=(t,e)=>{be(t.restEncoder,e.clients.size),ar(e.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{t.resetDsCurVal(),be(t.restEncoder,n);const s=r.length;be(t.restEncoder,s);for(let i=0;i<s;i++){const o=r[i];t.writeDsClock(o.clock),t.writeDsLen(o.len)}})},gh=eh;class xs extends ay{constructor({guid:e=Ny(),collectionid:n=null,gc:r=!0,gcFilter:s=()=>!0,meta:i=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=s,this.clientID=gh(),this.guid=e,this.collectionid=n,this.share=new Map,this.store=new kb,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=i,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=Ac(u=>{this.on("load",()=>{this.isLoaded=!0,u(this)})});const l=()=>Ac(u=>{const d=f=>{(f===void 0||f===!0)&&(this.off("sync",d),u())};this.on("sync",d)});this.on("sync",u=>{u===!1&&this.isSynced&&(this.whenSynced=l()),this.isSynced=u===void 0||u===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=l()}load(){const e=this._item;e!==null&&!this.shouldLoad&&_e(e.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(ar(this.subdocs).map(e=>e.guid))}transact(e,n=null){return _e(this,e,n)}get(e,n=Fe){const r=kr(this.share,e,()=>{const i=new n;return i._integrate(this,null),i}),s=r.constructor;if(n!==Fe&&s!==n)if(s===Fe){const i=new n;i._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=i}),i._start=r._start;for(let o=i._start;o!==null;o=o.right)o.parent=i;return i._length=r._length,this.share.set(e,i),i._integrate(this,null),i}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,jn)}getText(e=""){return this.get(e,Ii)}getMap(e=""){return this.get(e,cr)}getXmlElement(e=""){return this.get(e,hs)}getXmlFragment(e=""){return this.get(e,ur)}toJSON(){const e={};return this.share.forEach((n,r)=>{e[r]=n.toJSON()}),e}destroy(){this.isDestroyed=!0,ar(this.subdocs).forEach(n=>n.destroy());const e=this._item;if(e!==null){this._item=null;const n=e.content;n.doc=new xs({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=e,_e(e.parent.doc,r=>{const s=n.doc;e.deleted||r.subdocsAdded.add(s),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class db{constructor(){this.restEncoder=Qa()}toUint8Array(){return Vt(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){be(this.restEncoder,e)}writeDsLen(e){be(this.restEncoder,e)}}class hb extends db{writeLeftID(e){be(this.restEncoder,e.client),be(this.restEncoder,e.clock)}writeRightID(e){be(this.restEncoder,e.client),be(this.restEncoder,e.clock)}writeClient(e){be(this.restEncoder,e)}writeInfo(e){ka(this.restEncoder,e)}writeString(e){sr(this.restEncoder,e)}writeParentInfo(e){be(this.restEncoder,e?1:0)}writeTypeRef(e){be(this.restEncoder,e)}writeLen(e){be(this.restEncoder,e)}writeAny(e){ls(this.restEncoder,e)}writeBuf(e){st(this.restEncoder,e)}writeJSON(e){sr(this.restEncoder,JSON.stringify(e))}writeKey(e){sr(this.restEncoder,e)}}class fb{constructor(){this.restEncoder=Qa(),this.dsCurrVal=0}toUint8Array(){return Vt(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const n=e-this.dsCurrVal;this.dsCurrVal=e,be(this.restEncoder,n)}writeDsLen(e){e===0&&In(),be(this.restEncoder,e-1),this.dsCurrVal+=e}}class pb extends fb{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Zo,this.clientEncoder=new Ci,this.leftClockEncoder=new Zo,this.rightClockEncoder=new Zo,this.infoEncoder=new Ec(ka),this.stringEncoder=new My,this.parentInfoEncoder=new Ec(ka),this.typeRefEncoder=new Ci,this.lenEncoder=new Ci}toUint8Array(){const e=Qa();return be(e,0),st(e,this.keyClockEncoder.toUint8Array()),st(e,this.clientEncoder.toUint8Array()),st(e,this.leftClockEncoder.toUint8Array()),st(e,this.rightClockEncoder.toUint8Array()),st(e,Vt(this.infoEncoder)),st(e,this.stringEncoder.toUint8Array()),st(e,Vt(this.parentInfoEncoder)),st(e,this.typeRefEncoder.toUint8Array()),st(e,this.lenEncoder.toUint8Array()),tl(e,Vt(this.restEncoder)),Vt(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){ls(this.restEncoder,e)}writeBuf(e){st(this.restEncoder,e)}writeJSON(e){ls(this.restEncoder,e)}writeKey(e){const n=this.keyMap.get(e);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(n)}}const gb=(t,e,n,r)=>{r=vr(r,e[0].id.clock);const s=Gt(e,r);be(t.restEncoder,e.length-s),t.writeClient(n),be(t.restEncoder,r);const i=e[s];i.write(t,r-i.id.clock);for(let o=s+1;o<e.length;o++)e[o].write(t,0)},mb=(t,e,n)=>{const r=new Map;n.forEach((s,i)=>{et(e,i)>s&&r.set(i,s)}),il(e).forEach((s,i)=>{n.has(i)||r.set(i,0)}),be(t.restEncoder,r.size),ar(r.entries()).sort((s,i)=>i[0]-s[0]).forEach(([s,i])=>{gb(t,e.clients.get(s),s,i)})},yb=(t,e)=>mb(t,e.doc.store,e.beforeState);class bb{constructor(){this.l=[]}}const Ic=()=>new bb,Rc=(t,e)=>t.l.push(e),Pc=(t,e)=>{const n=t.l,r=n.length;t.l=n.filter(s=>e!==s),r===t.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},mh=(t,e,n)=>rl(t.l,[e,n]);class Si{constructor(e,n){this.client=e,this.clock=n}}const ti=(t,e)=>t===e||t!==null&&e!==null&&t.client===e.client&&t.clock===e.clock,Se=(t,e)=>new Si(t,e),_b=t=>{for(const[e,n]of t.doc.share.entries())if(n===t)return e;throw In()},nr=(t,e)=>e===void 0?!t.deleted:e.sv.has(t.id.client)&&(e.sv.get(t.id.client)||0)>t.id.clock&&!hh(e.ds,t.id),xa=(t,e)=>{const n=kr(t.meta,xa,or),r=t.doc.store;n.has(e)||(e.sv.forEach((s,i)=>{s<et(r,i)&&un(t,Se(i,s))}),dh(t,e.ds,s=>{}),n.add(e))};class kb{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const il=t=>{const e=new Map;return t.clients.forEach((n,r)=>{const s=n[n.length-1];e.set(r,s.id.clock+s.length)}),e},et=(t,e)=>{const n=t.clients.get(e);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},yh=(t,e)=>{let n=t.clients.get(e.id.client);if(n===void 0)n=[],t.clients.set(e.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==e.id.clock)throw In()}n.push(e)},Gt=(t,e)=>{let n=0,r=t.length-1,s=t[r],i=s.id.clock;if(i===e)return r;let o=Nn(e/(i+s.length-1)*r);for(;n<=r;){if(s=t[o],i=s.id.clock,i<=e){if(e<i+s.length)return o;n=o+1}else r=o-1;o=Nn((n+r)/2)}throw In()},vb=(t,e)=>{const n=t.clients.get(e.client);return n[Gt(n,e.clock)]},ea=vb,Ca=(t,e,n)=>{const r=Gt(e,n),s=e[r];return s.id.clock<n&&s instanceof ze?(e.splice(r+1,0,qh(t,s,n-s.id.clock)),r+1):r},un=(t,e)=>{const n=t.doc.store.clients.get(e.client);return n[Ca(t,n,e.clock)]},$c=(t,e,n)=>{const r=e.clients.get(n.client),s=Gt(r,n.clock),i=r[s];return n.clock!==i.id.clock+i.length-1&&i.constructor!==on&&r.splice(s+1,0,qh(t,i,n.clock-i.id.clock+1)),i},wb=(t,e,n)=>{const r=t.clients.get(e.id.client);r[Gt(r,e.id.clock)]=n},bh=(t,e,n,r,s)=>{if(r===0)return;const i=n+r;let o=Ca(t,e,n),a;do a=e[o++],i<a.id.clock+a.length&&Ca(t,e,i),s(a);while(o<e.length&&e[o].id.clock<i)};class xb{constructor(e,n,r){this.doc=e,this.deleteSet=new lb,this.beforeState=il(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const qc=(t,e)=>e.deleteSet.clients.size===0&&!iy(e.afterState,(n,r)=>e.beforeState.get(r)!==n)?!1:(fh(e.deleteSet),yb(t,e),ub(t,e.deleteSet),!0),Dc=(t,e,n)=>{const r=e._item;(r===null||r.id.clock<(t.beforeState.get(r.id.client)||0)&&!r.deleted)&&kr(t.changed,e,or).add(n)},Ti=(t,e)=>{let n=t[e],r=t[e-1],s=e;for(;s>0;n=r,r=t[--s-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof ze&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const i=e-s;return i&&t.splice(e+1-i,i),i},Cb=(t,e,n)=>{for(const[r,s]of t.clients.entries()){const i=e.clients.get(r);for(let o=s.length-1;o>=0;o--){const a=s[o],l=a.clock+a.len;for(let u=Gt(i,a.clock),d=i[u];u<i.length&&d.id.clock<l;d=i[++u]){const f=i[u];if(a.clock+a.len<=f.id.clock)break;f instanceof ze&&f.deleted&&!f.keep&&n(f)&&f.gc(e,!1)}}}},Sb=(t,e)=>{t.clients.forEach((n,r)=>{const s=e.clients.get(r);for(let i=n.length-1;i>=0;i--){const o=n[i],a=Zd(s.length-1,1+Gt(s,o.clock+o.len-1));for(let l=a,u=s[l];l>0&&u.id.clock>=o.clock;u=s[l])l-=1+Ti(s,l)}})},_h=(t,e)=>{if(e<t.length){const n=t[e],r=n.doc,s=r.store,i=n.deleteSet,o=n._mergeStructs;try{fh(i),n.afterState=il(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((l,u)=>a.push(()=>{(u._item===null||!u._item.deleted)&&u._callObserver(n,l)})),a.push(()=>{n.changedParentTypes.forEach((l,u)=>{u._dEH.l.length>0&&(u._item===null||!u._item.deleted)&&(l=l.filter(d=>d.target._item===null||!d.target._item.deleted),l.forEach(d=>{d.currentTarget=u,d._path=null}),l.sort((d,f)=>d.path.length-f.path.length),mh(u._dEH,l,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),rl(a,[]),n._needFormattingCleanup&&$b(n)}finally{r.gc&&Cb(i,s,r.gcFilter),Sb(i,s),n.afterState.forEach((d,f)=>{const h=n.beforeState.get(f)||0;if(h!==d){const p=s.clients.get(f),y=vr(Gt(p,h),1);for(let b=p.length-1;b>=y;)b-=1+Ti(p,b)}});for(let d=o.length-1;d>=0;d--){const{client:f,clock:h}=o[d].id,p=s.clients.get(f),y=Gt(p,h);y+1<p.length&&Ti(p,y+1)>1||y>0&&Ti(p,y)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(sb(sl,ih,"[yjs] ",oh,ah,"Changed the client-id because another client seems to be using it."),r.clientID=gh()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const d=new hb;qc(d,n)&&r.emit("update",[d.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const d=new pb;qc(d,n)&&r.emit("updateV2",[d.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:l,subdocsRemoved:u}=n;(a.size>0||u.size>0||l.size>0)&&(a.forEach(d=>{d.clientID=r.clientID,d.collectionid==null&&(d.collectionid=r.collectionid),r.subdocs.add(d)}),u.forEach(d=>r.subdocs.delete(d)),r.emit("subdocs",[{loaded:l,added:a,removed:u},r,n]),u.forEach(d=>d.destroy())),t.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,t])):_h(t,e+1)}}},_e=(t,e,n=null,r=!0)=>{const s=t._transactionCleanups;let i=!1,o=null;t._transaction===null&&(i=!0,t._transaction=new xb(t,n,r),s.push(t._transaction),s.length===1&&t.emit("beforeAllTransactions",[t]),t.emit("beforeTransaction",[t._transaction,t]));try{o=e(t._transaction)}finally{if(i){const a=t._transaction===s[0];t._transaction=null,a&&_h(s,0)}}return o},Lc="You must not compute changes after the event-handler fired.";class Gi{constructor(e,n){this.target=e,this.currentTarget=e,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=Tb(this.currentTarget,this.target))}deletes(e){return hh(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw lr(Lc);const e=new Map,n=this.target;this.transaction.changed.get(n).forEach(s=>{if(s!==null){const i=n._map.get(s);let o,a;if(this.adds(i)){let l=i.left;for(;l!==null&&this.adds(l);)l=l.left;if(this.deletes(i))if(l!==null&&this.deletes(l))o="delete",a=Vo(l.content.getContent());else return;else l!==null&&this.deletes(l)?(o="update",a=Vo(l.content.getContent())):(o="add",a=void 0)}else if(this.deletes(i))o="delete",a=Vo(i.content.getContent());else return;e.set(s,{action:o,oldValue:a})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw lr(Lc);const n=this.target,r=or(),s=or(),i=[];if(e={added:r,deleted:s,delta:i,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const l=()=>{a&&i.push(a)};for(let u=n._start;u!==null;u=u.right)u.deleted?this.deletes(u)&&!this.adds(u)&&((a===null||a.delete===void 0)&&(l(),a={delete:0}),a.delete+=u.length,s.add(u)):this.adds(u)?((a===null||a.insert===void 0)&&(l(),a={insert:[]}),a.insert=a.insert.concat(u.content.getContent()),r.add(u)):((a===null||a.retain===void 0)&&(l(),a={retain:0}),a.retain+=u.length);a!==null&&a.retain===void 0&&l()}this._changes=e}return e}}const Tb=(t,e)=>{const n=[];for(;e._item!==null&&e!==t;){if(e._item.parentSub!==null)n.unshift(e._item.parentSub);else{let r=0,s=e._item.parent._start;for(;s!==e._item&&s!==null;)!s.deleted&&s.countable&&(r+=s.length),s=s.right;n.unshift(r)}e=e._item.parent}return n},Je=()=>{ib("Invalid access: Add Yjs type to a document before reading data.")},kh=80;let ol=0;class Eb{constructor(e,n){e.marker=!0,this.p=e,this.index=n,this.timestamp=ol++}}const Ob=t=>{t.timestamp=ol++},vh=(t,e,n)=>{t.p.marker=!1,t.p=e,e.marker=!0,t.index=n,t.timestamp=ol++},Mb=(t,e,n)=>{if(t.length>=kh){const r=t.reduce((s,i)=>s.timestamp<i.timestamp?s:i);return vh(r,e,n),r}else{const r=new Eb(e,n);return t.push(r),r}},Yi=(t,e)=>{if(t._start===null||e===0||t._searchMarker===null)return null;const n=t._searchMarker.length===0?null:t._searchMarker.reduce((i,o)=>xi(e-i.index)<xi(e-o.index)?i:o);let r=t._start,s=0;for(n!==null&&(r=n.p,s=n.index,Ob(n));r.right!==null&&s<e;){if(!r.deleted&&r.countable){if(e<s+r.length)break;s+=r.length}r=r.right}for(;r.left!==null&&s>e;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);return n!==null&&xi(n.index-s)<r.parent.length/kh?(vh(n,r,s),n):Mb(t._searchMarker,r,s)},us=(t,e,n)=>{for(let r=t.length-1;r>=0;r--){const s=t[r];if(n>0){let i=s.p;for(i.marker=!1;i&&(i.deleted||!i.countable);)i=i.left,i&&!i.deleted&&i.countable&&(s.index-=i.length);if(i===null||i.marker===!0){t.splice(r,1);continue}s.p=i,i.marker=!0}(e<s.index||n>0&&e===s.index)&&(s.index=vr(e,s.index+n))}},Xi=(t,e,n)=>{const r=t,s=e.changedParentTypes;for(;kr(s,t,()=>[]).push(n),t._item!==null;)t=t._item.parent;mh(r._eH,n,e)};class Fe{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Ic(),this._dEH=Ic(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,n){this.doc=e,this._item=n}_copy(){throw Nt()}clone(){throw Nt()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,n){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){Rc(this._eH,e)}observeDeep(e){Rc(this._dEH,e)}unobserve(e){Pc(this._eH,e)}unobserveDeep(e){Pc(this._dEH,e)}toJSON(){}}const wh=(t,e,n)=>{t.doc??Je(),e<0&&(e=t._length+e),n<0&&(n=t._length+n);let r=n-e;const s=[];let i=t._start;for(;i!==null&&r>0;){if(i.countable&&!i.deleted){const o=i.content.getContent();if(o.length<=e)e-=o.length;else{for(let a=e;a<o.length&&r>0;a++)s.push(o[a]),r--;e=0}}i=i.right}return s},xh=t=>{t.doc??Je();const e=[];let n=t._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let s=0;s<r.length;s++)e.push(r[s])}n=n.right}return e},ds=(t,e)=>{let n=0,r=t._start;for(t.doc??Je();r!==null;){if(r.countable&&!r.deleted){const s=r.content.getContent();for(let i=0;i<s.length;i++)e(s[i],n++,t)}r=r.right}},Ch=(t,e)=>{const n=[];return ds(t,(r,s)=>{n.push(e(r,s,t))}),n},Ab=t=>{let e=t._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};n=e.content.getContent(),r=0,e=e.right}const s=n[r++];return n.length<=r&&(n=null),{done:!1,value:s}}}},Sh=(t,e)=>{t.doc??Je();const n=Yi(t,e);let r=t._start;for(n!==null&&(r=n.p,e-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},ji=(t,e,n,r)=>{let s=n;const i=t.doc,o=i.clientID,a=i.store,l=n===null?e._start:n.right;let u=[];const d=()=>{u.length>0&&(s=new ze(Se(o,et(a,o)),s,s&&s.lastId,l,l&&l.id,e,null,new dr(u)),s.integrate(t,0),u=[])};r.forEach(f=>{if(f===null)u.push(f);else switch(f.constructor){case Number:case Object:case Boolean:case Array:case String:u.push(f);break;default:switch(d(),f.constructor){case Uint8Array:case ArrayBuffer:s=new ze(Se(o,et(a,o)),s,s&&s.lastId,l,l&&l.id,e,null,new Zi(new Uint8Array(f))),s.integrate(t,0);break;case xs:s=new ze(Se(o,et(a,o)),s,s&&s.lastId,l,l&&l.id,e,null,new Qi(f)),s.integrate(t,0);break;default:if(f instanceof Fe)s=new ze(Se(o,et(a,o)),s,s&&s.lastId,l,l&&l.id,e,null,new yn(f)),s.integrate(t,0);else throw new Error("Unexpected content type in insert operation")}}}),d()},Th=()=>lr("Length exceeded!"),Eh=(t,e,n,r)=>{if(n>e._length)throw Th();if(n===0)return e._searchMarker&&us(e._searchMarker,n,r.length),ji(t,e,null,r);const s=n,i=Yi(e,n);let o=e._start;for(i!==null&&(o=i.p,n-=i.index,n===0&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&un(t,Se(o.id.client,o.id.clock+n));break}n-=o.length}return e._searchMarker&&us(e._searchMarker,s,r.length),ji(t,e,o,r)},jb=(t,e,n)=>{let s=(e._searchMarker||[]).reduce((i,o)=>o.index>i.index?o:i,{index:0,p:e._start}).p;if(s)for(;s.right;)s=s.right;return ji(t,e,s,n)},Oh=(t,e,n,r)=>{if(r===0)return;const s=n,i=r,o=Yi(e,n);let a=e._start;for(o!==null&&(a=o.p,n-=o.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&un(t,Se(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&un(t,Se(a.id.client,a.id.clock+r)),a.delete(t),r-=a.length),a=a.right;if(r>0)throw Th();e._searchMarker&&us(e._searchMarker,s,-i+r)},Ni=(t,e,n)=>{const r=e._map.get(n);r!==void 0&&r.delete(t)},al=(t,e,n,r)=>{const s=e._map.get(n)||null,i=t.doc,o=i.clientID;let a;if(r==null)a=new dr([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:a=new dr([r]);break;case Uint8Array:a=new Zi(r);break;case xs:a=new Qi(r);break;default:if(r instanceof Fe)a=new yn(r);else throw new Error("Unexpected content type")}new ze(Se(o,et(i.store,o)),s,s&&s.lastId,null,null,e,n,a).integrate(t,0)},ll=(t,e)=>{t.doc??Je();const n=t._map.get(e);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},Mh=t=>{const e={};return t.doc??Je(),t._map.forEach((n,r)=>{n.deleted||(e[r]=n.content.getContent()[n.length-1])}),e},Ah=(t,e)=>{t.doc??Je();const n=t._map.get(e);return n!==void 0&&!n.deleted},Nb=(t,e)=>{const n={};return t._map.forEach((r,s)=>{let i=r;for(;i!==null&&(!e.sv.has(i.id.client)||i.id.clock>=(e.sv.get(i.id.client)||0));)i=i.left;i!==null&&nr(i,e)&&(n[s]=i.content.getContent()[i.length-1])}),n},ni=t=>(t.doc??Je(),ob(t._map.entries(),e=>!e[1].deleted));class jh extends Gi{}class jn extends Fe{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const n=new jn;return n.push(e),n}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new jn}clone(){const e=new jn;return e.insert(0,this.toArray().map(n=>n instanceof Fe?n.clone():n)),e}get length(){return this.doc??Je(),this._length}_callObserver(e,n){super._callObserver(e,n),Xi(this,e,new jh(this,e))}insert(e,n){this.doc!==null?_e(this.doc,r=>{Eh(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}push(e){this.doc!==null?_e(this.doc,n=>{jb(n,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,n=1){this.doc!==null?_e(this.doc,r=>{Oh(r,this,e,n)}):this._prelimContent.splice(e,n)}get(e){return Sh(this,e)}toArray(){return xh(this)}slice(e=0,n=this.length){return wh(this,e,n)}toJSON(){return this.map(e=>e instanceof Fe?e.toJSON():e)}map(e){return Ch(this,e)}forEach(e){ds(this,e)}[Symbol.iterator](){return Ab(this)}_write(e){e.writeTypeRef(Bb)}}class Ib extends Gi{constructor(e,n,r){super(e,n),this.keysChanged=r}}class cr extends Fe{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,n){super._integrate(e,n),this._prelimContent.forEach((r,s)=>{this.set(s,r)}),this._prelimContent=null}_copy(){return new cr}clone(){const e=new cr;return this.forEach((n,r)=>{e.set(r,n instanceof Fe?n.clone():n)}),e}_callObserver(e,n){Xi(this,e,new Ib(this,e,n))}toJSON(){this.doc??Je();const e={};return this._map.forEach((n,r)=>{if(!n.deleted){const s=n.content.getContent()[n.length-1];e[r]=s instanceof Fe?s.toJSON():s}}),e}get size(){return[...ni(this)].length}keys(){return Qo(ni(this),e=>e[0])}values(){return Qo(ni(this),e=>e[1].content.getContent()[e[1].length-1])}entries(){return Qo(ni(this),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this.doc??Je(),this._map.forEach((n,r)=>{n.deleted||e(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?_e(this.doc,n=>{Ni(n,this,e)}):this._prelimContent.delete(e)}set(e,n){return this.doc!==null?_e(this.doc,r=>{al(r,this,e,n)}):this._prelimContent.set(e,n),n}get(e){return ll(this,e)}has(e){return Ah(this,e)}clear(){this.doc!==null?_e(this.doc,e=>{this.forEach(function(n,r,s){Ni(e,s,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(Hb)}}const ln=(t,e)=>t===e||typeof t=="object"&&typeof e=="object"&&t&&e&&By(t,e);class Sa{constructor(e,n,r,s){this.left=e,this.right=n,this.index=r,this.currentAttributes=s}forward(){switch(this.right===null&&In(),this.right.content.constructor){case Re:this.right.deleted||wr(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Fc=(t,e,n)=>{for(;e.right!==null&&n>0;){switch(e.right.content.constructor){case Re:e.right.deleted||wr(e.currentAttributes,e.right.content);break;default:e.right.deleted||(n<e.right.length&&un(t,Se(e.right.id.client,e.right.id.clock+n)),e.index+=e.right.length,n-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},ri=(t,e,n,r)=>{const s=new Map,i=r?Yi(e,n):null;if(i){const o=new Sa(i.p.left,i.p,i.index,s);return Fc(t,o,n-i.index)}else{const o=new Sa(null,e._start,0,s);return Fc(t,o,n)}},Nh=(t,e,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===Re&&ln(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const s=t.doc,i=s.clientID;r.forEach((o,a)=>{const l=n.left,u=n.right,d=new ze(Se(i,et(s.store,i)),l,l&&l.lastId,u,u&&u.id,e,null,new Re(a,o));d.integrate(t,0),n.right=d,n.forward()})},wr=(t,e)=>{const{key:n,value:r}=e;r===null?t.delete(n):t.set(n,r)},Ih=(t,e)=>{for(;t.right!==null;){if(!(t.right.deleted||t.right.content.constructor===Re&&ln(e[t.right.content.key]??null,t.right.content.value)))break;t.forward()}},Rh=(t,e,n,r)=>{const s=t.doc,i=s.clientID,o=new Map;for(const a in r){const l=r[a],u=n.currentAttributes.get(a)??null;if(!ln(u,l)){o.set(a,u);const{left:d,right:f}=n;n.right=new ze(Se(i,et(s.store,i)),d,d&&d.lastId,f,f&&f.id,e,null,new Re(a,l)),n.right.integrate(t,0),n.forward()}}return o},ta=(t,e,n,r,s)=>{n.currentAttributes.forEach((h,p)=>{s[p]===void 0&&(s[p]=null)});const i=t.doc,o=i.clientID;Ih(n,s);const a=Rh(t,e,n,s),l=r.constructor===String?new Yt(r):r instanceof Fe?new yn(r):new xr(r);let{left:u,right:d,index:f}=n;e._searchMarker&&us(e._searchMarker,n.index,l.getLength()),d=new ze(Se(o,et(i.store,o)),u,u&&u.lastId,d,d&&d.id,e,null,l),d.integrate(t,0),n.right=d,n.index=f,n.forward(),Nh(t,e,n,a)},Uc=(t,e,n,r,s)=>{const i=t.doc,o=i.clientID;Ih(n,s);const a=Rh(t,e,n,s);e:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===Re));){if(!n.right.deleted)switch(n.right.content.constructor){case Re:{const{key:l,value:u}=n.right.content,d=s[l];if(d!==void 0){if(ln(d,u))a.delete(l);else{if(r===0)break e;a.set(l,u)}n.right.delete(t)}else n.currentAttributes.set(l,u);break}default:r<n.right.length&&un(t,Se(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let l="";for(;r>0;r--)l+=`
`;n.right=new ze(Se(o,et(i.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,e,null,new Yt(l)),n.right.integrate(t,0),n.forward()}Nh(t,e,n,a)},Ph=(t,e,n,r,s)=>{let i=e;const o=jt();for(;i&&(!i.countable||i.deleted);){if(!i.deleted&&i.content.constructor===Re){const u=i.content;o.set(u.key,u)}i=i.right}let a=0,l=!1;for(;e!==i;){if(n===e&&(l=!0),!e.deleted){const u=e.content;switch(u.constructor){case Re:{const{key:d,value:f}=u,h=r.get(d)??null;(o.get(d)!==u||h===f)&&(e.delete(t),a++,!l&&(s.get(d)??null)===f&&h!==f&&(h===null?s.delete(d):s.set(d,h))),!l&&!e.deleted&&wr(s,u);break}}}e=e.right}return a},Rb=(t,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const n=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===Re){const r=e.content.key;n.has(r)?e.delete(t):n.add(r)}e=e.left}},Pb=t=>{let e=0;return _e(t.doc,n=>{let r=t._start,s=t._start,i=jt();const o=_a(i);for(;s;){if(s.deleted===!1)switch(s.content.constructor){case Re:wr(o,s.content);break;default:e+=Ph(n,r,s,i,o),i=_a(o),r=s;break}s=s.right}}),e},$b=t=>{const e=new Set,n=t.doc;for(const[r,s]of t.afterState.entries()){const i=t.beforeState.get(r)||0;s!==i&&bh(t,n.store.clients.get(r),i,s,o=>{!o.deleted&&o.content.constructor===Re&&o.constructor!==on&&e.add(o.parent)})}_e(n,r=>{dh(t,t.deleteSet,s=>{if(s instanceof on||!s.parent._hasFormatting||e.has(s.parent))return;const i=s.parent;s.content.constructor===Re?e.add(i):Rb(r,s)});for(const s of e)Pb(s)})},Bc=(t,e,n)=>{const r=n,s=_a(e.currentAttributes),i=e.right;for(;n>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case yn:case xr:case Yt:n<e.right.length&&un(t,Se(e.right.id.client,e.right.id.clock+n)),n-=e.right.length,e.right.delete(t);break}e.forward()}i&&Ph(t,i,e.right,s,e.currentAttributes);const o=(e.left||e.right).parent;return o._searchMarker&&us(o._searchMarker,e.index,-r+n),e};class qb extends Gi{constructor(e,n,r){super(e,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(s=>{s===null?this.childListChanged=!0:this.keysChanged.add(s)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,n=[];_e(e,r=>{const s=new Map,i=new Map;let o=this.target._start,a=null;const l={};let u="",d=0,f=0;const h=()=>{if(a!==null){let p=null;switch(a){case"delete":f>0&&(p={delete:f}),f=0;break;case"insert":(typeof u=="object"||u.length>0)&&(p={insert:u},s.size>0&&(p.attributes={},s.forEach((y,b)=>{y!==null&&(p.attributes[b]=y)}))),u="";break;case"retain":d>0&&(p={retain:d},Ly(l)||(p.attributes=$y({},l))),d=0;break}p&&n.push(p),a=null}};for(;o!==null;){switch(o.content.constructor){case yn:case xr:this.adds(o)?this.deletes(o)||(h(),a="insert",u=o.content.getContent()[0],h()):this.deletes(o)?(a!=="delete"&&(h(),a="delete"),f+=1):o.deleted||(a!=="retain"&&(h(),a="retain"),d+=1);break;case Yt:this.adds(o)?this.deletes(o)||(a!=="insert"&&(h(),a="insert"),u+=o.content.str):this.deletes(o)?(a!=="delete"&&(h(),a="delete"),f+=o.length):o.deleted||(a!=="retain"&&(h(),a="retain"),d+=o.length);break;case Re:{const{key:p,value:y}=o.content;if(this.adds(o)){if(!this.deletes(o)){const b=s.get(p)??null;ln(b,y)?y!==null&&o.delete(r):(a==="retain"&&h(),ln(y,i.get(p)??null)?delete l[p]:l[p]=y)}}else if(this.deletes(o)){i.set(p,y);const b=s.get(p)??null;ln(b,y)||(a==="retain"&&h(),l[p]=b)}else if(!o.deleted){i.set(p,y);const b=l[p];b!==void 0&&(ln(b,y)?b!==null&&o.delete(r):(a==="retain"&&h(),y===null?delete l[p]:l[p]=y))}o.deleted||(a==="insert"&&h(),wr(s,o.content));break}}o=o.right}for(h();n.length>0;){const p=n[n.length-1];if(p.retain!==void 0&&p.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class Ii extends Fe{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??Je(),this._length}_integrate(e,n){super._integrate(e,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new Ii}clone(){const e=new Ii;return e.applyDelta(this.toDelta()),e}_callObserver(e,n){super._callObserver(e,n);const r=new qb(this,e,n);Xi(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){this.doc??Je();let e="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Yt&&(e+=n.content.str),n=n.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:n=!0}={}){this.doc!==null?_e(this.doc,r=>{const s=new Sa(null,this._start,0,new Map);for(let i=0;i<e.length;i++){const o=e[i];if(o.insert!==void 0){const a=!n&&typeof o.insert=="string"&&i===e.length-1&&s.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&ta(r,this,s,a,o.attributes||{})}else o.retain!==void 0?Uc(r,this,s,o.retain,o.attributes||{}):o.delete!==void 0&&Bc(r,s,o.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,n,r){this.doc??Je();const s=[],i=new Map,o=this.doc;let a="",l=this._start;function u(){if(a.length>0){const f={};let h=!1;i.forEach((y,b)=>{h=!0,f[b]=y});const p={insert:a};h&&(p.attributes=f),s.push(p),a=""}}const d=()=>{for(;l!==null;){if(nr(l,e)||n!==void 0&&nr(l,n))switch(l.content.constructor){case Yt:{const f=i.get("ychange");e!==void 0&&!nr(l,e)?(f===void 0||f.user!==l.id.client||f.type!=="removed")&&(u(),i.set("ychange",r?r("removed",l.id):{type:"removed"})):n!==void 0&&!nr(l,n)?(f===void 0||f.user!==l.id.client||f.type!=="added")&&(u(),i.set("ychange",r?r("added",l.id):{type:"added"})):f!==void 0&&(u(),i.delete("ychange")),a+=l.content.str;break}case yn:case xr:{u();const f={insert:l.content.getContent()[0]};if(i.size>0){const h={};f.attributes=h,i.forEach((p,y)=>{h[y]=p})}s.push(f);break}case Re:nr(l,e)&&(u(),wr(i,l.content));break}l=l.right}u()};return e||n?_e(o,f=>{e&&xa(f,e),n&&xa(f,n),d()},"cleanup"):d(),s}insert(e,n,r){if(n.length<=0)return;const s=this.doc;s!==null?_e(s,i=>{const o=ri(i,this,e,!r);r||(r={},o.currentAttributes.forEach((a,l)=>{r[l]=a})),ta(i,this,o,n,r)}):this._pending.push(()=>this.insert(e,n,r))}insertEmbed(e,n,r){const s=this.doc;s!==null?_e(s,i=>{const o=ri(i,this,e,!r);ta(i,this,o,n,r||{})}):this._pending.push(()=>this.insertEmbed(e,n,r||{}))}delete(e,n){if(n===0)return;const r=this.doc;r!==null?_e(r,s=>{Bc(s,ri(s,this,e,!0),n)}):this._pending.push(()=>this.delete(e,n))}format(e,n,r){if(n===0)return;const s=this.doc;s!==null?_e(s,i=>{const o=ri(i,this,e,!1);o.right!==null&&Uc(i,this,o,n,r)}):this._pending.push(()=>this.format(e,n,r))}removeAttribute(e){this.doc!==null?_e(this.doc,n=>{Ni(n,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,n){this.doc!==null?_e(this.doc,r=>{al(r,this,e,n)}):this._pending.push(()=>this.setAttribute(e,n))}getAttribute(e){return ll(this,e)}getAttributes(){return Mh(this)}_write(e){e.writeTypeRef(Wb)}}class na{constructor(e,n=()=>!0){this._filter=n,this._root=e,this._currentNode=e._start,this._firstCall=!0,e.doc??Je()}[Symbol.iterator](){return this}next(){let e=this._currentNode,n=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(n)))do if(n=e.content.type,!e.deleted&&(n.constructor===hs||n.constructor===ur)&&n._start!==null)e=n._start;else for(;e!==null;){const r=e.next;if(r!==null){e=r;break}else e.parent===this._root?e=null:e=e.parent._item}while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class ur extends Fe{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new ur}clone(){const e=new ur;return e.insert(0,this.toArray().map(n=>n instanceof Fe?n.clone():n)),e}get length(){return this.doc??Je(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new na(this,e)}querySelector(e){e=e.toUpperCase();const r=new na(this,s=>s.nodeName&&s.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),ar(new na(this,n=>n.nodeName&&n.nodeName.toUpperCase()===e))}_callObserver(e,n){Xi(this,e,new Db(this,n,e))}toString(){return Ch(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,n={},r){const s=e.createDocumentFragment();return r!==void 0&&r._createAssociation(s,this),ds(this,i=>{s.insertBefore(i.toDOM(e,n,r),null)}),s}insert(e,n){this.doc!==null?_e(this.doc,r=>{Eh(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}insertAfter(e,n){if(this.doc!==null)_e(this.doc,r=>{const s=e&&e instanceof Fe?e._item:e;ji(r,this,s,n)});else{const r=this._prelimContent,s=e===null?0:r.findIndex(i=>i===e)+1;if(s===0&&e!==null)throw lr("Reference item not found");r.splice(s,0,...n)}}delete(e,n=1){this.doc!==null?_e(this.doc,r=>{Oh(r,this,e,n)}):this._prelimContent.splice(e,n)}toArray(){return xh(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return Sh(this,e)}slice(e=0,n=this.length){return wh(this,e,n)}forEach(e){ds(this,e)}_write(e){e.writeTypeRef(Kb)}}class hs extends ur{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,n){super._integrate(e,n),this._prelimAttrs.forEach((r,s)=>{this.setAttribute(s,r)}),this._prelimAttrs=null}_copy(){return new hs(this.nodeName)}clone(){const e=new hs(this.nodeName),n=this.getAttributes();return Dy(n,(r,s)=>{typeof r=="string"&&e.setAttribute(s,r)}),e.insert(0,this.toArray().map(r=>r instanceof Fe?r.clone():r)),e}toString(){const e=this.getAttributes(),n=[],r=[];for(const a in e)r.push(a);r.sort();const s=r.length;for(let a=0;a<s;a++){const l=r[a];n.push(l+'="'+e[l]+'"')}const i=this.nodeName.toLocaleLowerCase(),o=n.length>0?" "+n.join(" "):"";return`<${i}${o}>${super.toString()}</${i}>`}removeAttribute(e){this.doc!==null?_e(this.doc,n=>{Ni(n,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,n){this.doc!==null?_e(this.doc,r=>{al(r,this,e,n)}):this._prelimAttrs.set(e,n)}getAttribute(e){return ll(this,e)}hasAttribute(e){return Ah(this,e)}getAttributes(e){return e?Nb(this,e):Mh(this)}toDOM(e=document,n={},r){const s=e.createElement(this.nodeName),i=this.getAttributes();for(const o in i){const a=i[o];typeof a=="string"&&s.setAttribute(o,a)}return ds(this,o=>{s.appendChild(o.toDOM(e,n,r))}),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(zb),e.writeKey(this.nodeName)}}class Db extends Gi{constructor(e,n,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(s=>{s===null?this.childListChanged=!0:this.attributesChanged.add(s)})}}class $h{constructor(e,n){this.id=e,this.length=n}get deleted(){throw Nt()}mergeWith(e){return!1}write(e,n,r){throw Nt()}integrate(e,n){throw Nt()}}const Lb=0;class on extends $h{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){n>0&&(this.id.clock+=n,this.length-=n),yh(e.doc.store,this)}write(e,n){e.writeInfo(Lb),e.writeLen(this.length-n)}getMissing(e,n){return null}}class Zi{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Zi(this.content)}splice(e){throw Nt()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeBuf(this.content)}getRef(){return 3}}class Ri{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Ri(this.len)}splice(e){const n=new Ri(this.len-e);return this.len=e,n}mergeWith(e){return this.len+=e.len,!0}integrate(e,n){ph(e.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(e){}gc(e){}write(e,n){e.writeLen(this.len-n)}getRef(){return 1}}const Fb=(t,e)=>new xs({guid:t,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class Qi{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const n={};this.opts=n,e.gc||(n.gc=!1),e.autoLoad&&(n.autoLoad=!0),e.meta!==null&&(n.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Qi(Fb(this.doc.guid,this.opts))}splice(e){throw Nt()}mergeWith(e){return!1}integrate(e,n){this.doc._item=n,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,n){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}class xr{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new xr(this.embed)}splice(e){throw Nt()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeJSON(this.embed)}getRef(){return 5}}class Re{constructor(e,n){this.key=e,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Re(this.key,this.value)}splice(e){throw Nt()}mergeWith(e){return!1}integrate(e,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,n){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const Ub=Ai("node_env")==="development";class dr{constructor(e){this.arr=e,Ub&&nh(e)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new dr(this.arr)}splice(e){const n=new dr(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let s=n;s<r;s++){const i=this.arr[s];e.writeAny(i)}}getRef(){return 8}}class Yt{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Yt(this.str)}splice(e){const n=new Yt(this.str.slice(e));this.str=this.str.slice(0,e);const r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"",n.str=""+n.str.slice(1)),n}mergeWith(e){return this.str+=e.str,!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const Bb=0,Hb=1,Wb=2,zb=3,Kb=4;class yn{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new yn(this.type._copy())}splice(e){throw Nt()}mergeWith(e){return!1}integrate(e,n){this.type._integrate(e.doc,n)}delete(e){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(e.beforeState.get(n.id.client)||0)&&e._mergeStructs.push(n):n.delete(e),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let n=this.type._start;for(;n!==null;)n.gc(e,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,n){this.type._write(e)}getRef(){return 7}}const qh=(t,e,n)=>{const{client:r,clock:s}=e.id,i=new ze(Se(r,s+n),e,Se(r,s+n-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(n));return e.deleted&&i.markDeleted(),e.keep&&(i.keep=!0),e.redone!==null&&(i.redone=Se(e.redone.client,e.redone.clock+n)),e.right=i,i.right!==null&&(i.right.left=i),t._mergeStructs.push(i),i.parentSub!==null&&i.right===null&&i.parent._map.set(i.parentSub,i),e.length=n,i};class ze extends $h{constructor(e,n,r,s,i,o,a,l){super(e,l.getLength()),this.origin=r,this.left=n,this.right=s,this.rightOrigin=i,this.parent=o,this.parentSub=a,this.redone=null,this.content=l,this.info=this.content.isCountable()?xc:0}set marker(e){(this.info&Yo)>0!==e&&(this.info^=Yo)}get marker(){return(this.info&Yo)>0}get keep(){return(this.info&wc)>0}set keep(e){this.keep!==e&&(this.info^=wc)}get countable(){return(this.info&xc)>0}get deleted(){return(this.info&Go)>0}set deleted(e){this.deleted!==e&&(this.info^=Go)}markDeleted(){this.info|=Go}getMissing(e,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=et(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=et(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Si&&this.id.client!==this.parent.client&&this.parent.clock>=et(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=$c(e,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=un(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===on||this.right&&this.right.constructor===on)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===ze?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===ze&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Si){const r=ea(n,this.parent);r.constructor===on?this.parent=null:this.parent=r.content.type}return null}integrate(e,n){if(n>0&&(this.id.clock+=n,this.left=$c(e,e.doc.store,Se(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,s;if(r!==null)s=r.right;else if(this.parentSub!==null)for(s=this.parent._map.get(this.parentSub)||null;s!==null&&s.left!==null;)s=s.left;else s=this.parent._start;const i=new Set,o=new Set;for(;s!==null&&s!==this.right;){if(o.add(s),i.add(s),ti(this.origin,s.origin)){if(s.id.client<this.id.client)r=s,i.clear();else if(ti(this.rightOrigin,s.rightOrigin))break}else if(s.origin!==null&&o.has(ea(e.doc.store,s.origin)))i.has(ea(e.doc.store,s.origin))||(r=s,i.clear());else break;s=s.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),yh(e.doc.store,this),this.content.integrate(e,this),Dc(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new on(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:Se(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&ti(e.origin,this.lastId)&&this.right===e&&ti(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),ph(e.deleteSet,this.id.client,this.id.clock,this.length),Dc(e,n,this.parentSub),this.content.delete(e)}}gc(e,n){if(!this.deleted)throw In();this.content.gc(e),n?wb(e,this,new on(this.id,this.length)):this.content=new Ri(this.length)}write(e,n){const r=n>0?Se(this.id.client,this.id.clock+n-1):this.origin,s=this.rightOrigin,i=this.parentSub,o=this.content.getRef()&uy|(r===null?0:Mi)|(s===null?0:Qd)|(i===null?0:cy);if(e.writeInfo(o),r!==null&&e.writeLeftID(r),s!==null&&e.writeRightID(s),r===null&&s===null){const a=this.parent;if(a._item!==void 0){const l=a._item;if(l===null){const u=_b(a);e.writeParentInfo(!0),e.writeString(u)}else e.writeParentInfo(!1),e.writeLeftID(l.id)}else a.constructor===String?(e.writeParentInfo(!0),e.writeString(a)):a.constructor===Si?(e.writeParentInfo(!1),e.writeLeftID(a)):In();i!==null&&e.writeString(i)}this.content.write(e,n)}}const Dh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},Lh="__ $YJS$ __";Dh[Lh]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");Dh[Lh]=!0;const Jb=Va("TOGGLE_CONNECT_COMMAND");var Vb=Object.defineProperty,Gb=(t,e,n)=>e in t?Vb(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,z=(t,e,n)=>Gb(t,typeof e!="symbol"?e+"":e,n);const ra=t=>Ne(Pp(t)),Rn=Nd("cid",{parse:t=>typeof t=="string"?t:void 0}),Pn=Nd("segment",{parse:t=>typeof t=="string"?t:void 0}),Ta="unknown",Fh=1;class Un extends pn{constructor(e="",n,r,s){super(s),z(this,"__tag"),z(this,"__marker"),z(this,"__unknownAttributes"),this.__tag=e,this.__marker=n,this.__unknownAttributes=r}static getType(){return"unknown"}static clone(e){const{__tag:n,__marker:r,__unknownAttributes:s,__key:i}=e;return new Un(n,r,s,i)}static importDOM(){return{[Ta]:e=>Xb(e)?{conversion:Yb,priority:1}:null}}static importJSON(e){return Uh().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setTag(e.tag).setMarker(e.marker).setUnknownAttributes(e.unknownAttributes)}setTag(e){if(this.__tag===e)return this;const n=this.getWritable();return n.__tag=e,n}getTag(){return this.getLatest().__tag}setMarker(e){if(this.__marker===e)return this;const n=this.getWritable();return n.__marker=e,n}getMarker(){return this.getLatest().__marker}setUnknownAttributes(e){const n=this.getWritable();return n.__unknownAttributes=e,n}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement(Ta);return e.style.display="none",e}updateDOM(){return!1}exportDOM(){return{element:null}}exportJSON(){return{...super.exportJSON(),type:this.getType(),tag:this.getTag(),marker:this.getMarker(),unknownAttributes:this.getUnknownAttributes(),version:Fh}}canBeEmpty(){return!0}isInline(){return!0}extractWithChild(){return!1}excludeFromCopy(e){return e!=="clone"}}function Yb(t){const e=t.getAttribute("data-tag")??"",n=t.getAttribute("data-marker")??"";return{node:Uh(e,n)}}function Uh(t,e,n){return Ne(new Un(t,e,n))}function Xb(t){return(t==null?void 0:t.tagName)===Ta}function Cs(t){return t instanceof Un}const fs="id",Bh=1;class ut extends pn{constructor(e="",n,r){super(r),z(this,"__marker",fs),z(this,"__code"),z(this,"__unknownAttributes"),this.__code=e,this.__unknownAttributes=n}static getType(){return"book"}static clone(e){const{__code:n,__unknownAttributes:r,__key:s}=e;return new ut(n,r,s)}static importJSON(e){const{code:n}=e;return Hh(n).updateFromJSON(e)}static isValidBookCode(e){return Qf(e)}updateFromJSON(e){return super.updateFromJSON(e).setCode(e.code).setUnknownAttributes(e.unknownAttributes)}getMarker(){return this.getLatest().__marker}setCode(e){if(this.__code===e)return this;const n=this.getWritable();return n.__code=e,n}getCode(){return this.getLatest().__code}setUnknownAttributes(e){const n=this.getWritable();return n.__unknownAttributes=e,n}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("p");return e.setAttribute("data-marker",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`),e.setAttribute("data-code",this.__code),e}updateDOM(){return!1}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),code:this.getCode(),unknownAttributes:this.getUnknownAttributes(),version:Bh}}}function Hh(t,e){return Ne(new ut(t,e))}function It(t){return t instanceof ut}function Zb(t){return(t==null?void 0:t.type)===ut.getType()}const me="",Ea="",Xt=me,cl=`${me}|`,eo="p",Rt="+",hr="-",Pi="chapter",Oa="verse",Hc="invalid",Qb="text-spacing",e_="formatted-font",t_="marker-",ul="external-usj-mutation",Wh="selection-change",Ma="cursor-change",Aa="annotation-change",ja="delta-change",n_=[ul,Wh,Ma,Aa,ja],$i="c",zh=1;class wt extends pn{constructor(e="",n,r,s,i,o){super(o),z(this,"__marker"),z(this,"__number"),z(this,"__sid"),z(this,"__altnumber"),z(this,"__pubnumber"),z(this,"__unknownAttributes"),this.__marker=$i,this.__number=e,this.__sid=n,this.__altnumber=r,this.__pubnumber=s,this.__unknownAttributes=i}static getType(){return"chapter"}static clone(e){const{__number:n,__sid:r,__altnumber:s,__pubnumber:i,__unknownAttributes:o,__key:a}=e;return new wt(n,r,s,i,o,a)}static importJSON(e){return Kh().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setNumber(e.number).setSid(e.sid).setAltnumber(e.altnumber).setPubnumber(e.pubnumber).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const n=this.getWritable();return n.__marker=e,n}getMarker(){return this.getLatest().__marker}setNumber(e){if(this.__number===e)return this;const n=this.getWritable();return n.__number=e,n}getNumber(){return this.getLatest().__number}setSid(e){if(this.__sid===e)return this;const n=this.getWritable();return n.__sid=e,n}getSid(){return this.getLatest().__sid}setAltnumber(e){if(this.__altnumber===e)return this;const n=this.getWritable();return n.__altnumber=e,n}getAltnumber(){return this.getLatest().__altnumber}setPubnumber(e){if(this.__pubnumber===e)return this;const n=this.getWritable();return n.__pubnumber=e,n}getPubnumber(){return this.getLatest().__pubnumber}setUnknownAttributes(e){const n=this.getWritable();return n.__unknownAttributes=e,n}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("p");return e.setAttribute("data-marker",this.__marker),e.classList.add(Pi,`usfm_${this.__marker}`),e.setAttribute("data-number",this.__number),e}updateDOM(){return!1}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),number:this.getNumber(),sid:this.getSid(),altnumber:this.getAltnumber(),pubnumber:this.getPubnumber(),unknownAttributes:this.getUnknownAttributes(),version:zh}}}function Kh(t,e,n,r,s){return Ne(new wt(t,e,n,r,s))}function dl(t){return t instanceof wt}function r_(t){return(t==null?void 0:t.type)===wt.getType()}const Jh=["fr","fq","fqa","fk","ft","fl","fw","fp","fv","fdc","fm"],Vh=["xo","xop","xk","xq","xt","xta","xot","xnt","xdc"],s_=["ca","cp","va","vp","add","bk","dc","em","jmp","k","nd","ord","pn","png","qt","rb","rq","sig","sls","tl","w","wa","wg","wh","wj","bd","it","bdit","no","sc","sup","ior","iqt","qac","qs","litl","lik","liv","liv1","liv2","liv3","liv4","liv5",...Jh,...Vh],Gh=1;class Ce extends pn{constructor(e="",n,r){super(r),z(this,"__marker"),z(this,"__unknownAttributes"),this.__marker=e,this.__unknownAttributes=n}static getType(){return"char"}static clone(e){const{__marker:n,__unknownAttributes:r,__key:s}=e;return new Ce(n,r,s)}static isValidMarker(e){return e!==void 0&&s_.includes(e)}static isValidFootnoteMarker(e){return e!==void 0&&Jh.includes(e)}static isValidCrossReferenceMarker(e){return e!==void 0&&Vh.includes(e)}static importDOM(){return{span:e=>o_(e)?{conversion:i_,priority:1}:null}}static importJSON(e){return gt().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const n=this.getWritable();return n.__marker=e,n}getMarker(){return this.getLatest().__marker}setUnknownAttributes(e){const n=this.getWritable();return n.__unknownAttributes=e,n}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("span");return e.setAttribute("data-marker",this.__marker),e.setAttribute("title",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`),e}updateDOM(){return!1}exportDOM(e){const{element:n}=super.exportDOM(e);return n&&gn(n)&&(n.setAttribute("data-marker",this.getMarker()),n.classList.add(this.getType(),`usfm_${this.getMarker()}`)),{element:n}}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),unknownAttributes:this.getUnknownAttributes(),version:Gh}}insertNewAfter(e,n){const r=gt(this.getMarker());return r.setTextFormat(e.format),r.setTextStyle(e.style),r.setDirection(this.getDirection()),r.setFormat(this.getFormatType()),r.setStyle(this.getTextStyle()),this.insertAfter(r,n),r}canBeEmpty(){return!1}isInline(){return!0}}function i_(t){const e=t.getAttribute("data-marker")??"f";return{node:gt(e)}}function gt(t,e){return Ne(new Ce(t,e))}function o_(t){if(!t)return!1;const e=t.getAttribute("data-marker")??"";return Ce.isValidMarker(e)&&t.classList.contains(Ce.getType())}function pe(t){return t instanceof Ce}function a_(t){return(t==null?void 0:t.type)===Ce.getType()}const Yh=1,l_="c",Xh="span";class en extends br{constructor(e="",n=!1,r,s,i,o,a){super(a),z(this,"__marker"),z(this,"__number"),z(this,"__showMarker"),z(this,"__sid"),z(this,"__altnumber"),z(this,"__pubnumber"),z(this,"__unknownAttributes"),this.__marker=l_,this.__number=e,this.__showMarker=n,this.__sid=r,this.__altnumber=s,this.__pubnumber=i,this.__unknownAttributes=o}static getType(){return"immutable-chapter"}static clone(e){const{__number:n,__showMarker:r,__sid:s,__altnumber:i,__pubnumber:o,__unknownAttributes:a,__key:l}=e;return new en(n,r,s,i,o,a,l)}static importDOM(){return{span:e=>Zh(e)?{conversion:c_,priority:1}:null}}static importJSON(e){return hl().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setNumber(e.number).setShowMarker(e.showMarker).setSid(e.sid).setAltnumber(e.altnumber).setPubnumber(e.pubnumber).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const n=this.getWritable();return n.__marker=e,n}getMarker(){return this.getLatest().__marker}setNumber(e){if(this.__number===e)return this;const n=this.getWritable();return n.__number=e,n}getNumber(){return this.getLatest().__number}setShowMarker(e=!1){if(this.__showMarker===e)return this;const n=this.getWritable();return n.__showMarker=e,n}getShowMarker(){return this.getLatest().__showMarker}setSid(e){if(this.__sid===e)return this;const n=this.getWritable();return n.__sid=e,n}getSid(){return this.getLatest().__sid}setAltnumber(e){if(this.__altnumber===e)return this;const n=this.getWritable();return n.__altnumber=e,n}getAltnumber(){return this.getLatest().__altnumber}setPubnumber(e){if(this.__pubnumber===e)return this;const n=this.getWritable();return n.__pubnumber=e,n}getPubnumber(){return this.getLatest().__pubnumber}setUnknownAttributes(e){const n=this.getWritable();return n.__unknownAttributes=e,n}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement(Xh);return e.setAttribute("data-marker",this.__marker),e.classList.add(Pi,`usfm_${this.__marker}`),this.__showMarker&&e.classList.add("marker"),e.setAttribute("data-number",this.__number),e}updateDOM(){return!1}exportDOM(e){const{element:n}=super.exportDOM(e);return n&&gn(n)&&(n.setAttribute("data-marker",this.getMarker()),n.classList.add(Pi,`usfm_${this.getMarker()}`),n.setAttribute("data-number",this.getNumber())),{element:n}}decorate(){return this.getShowMarker()?Ts(this.getMarker(),this.getNumber()):this.getNumber()}exportJSON(){return{type:this.getType(),marker:this.getMarker(),number:this.getNumber(),showMarker:this.getShowMarker(),sid:this.getSid(),altnumber:this.getAltnumber(),pubnumber:this.getPubnumber(),unknownAttributes:this.getUnknownAttributes(),version:Yh}}isInline(){return!1}isKeyboardSelectable(){return!1}}function c_(t){const e=t.getAttribute("data-number")??"0";return{node:hl(e)}}function hl(t,e,n,r,s,i){return Ne(new en(t,e,n,r,s,i))}function Zh(t){return t?t.classList.contains(Pi)&&t.tagName.toLowerCase()===Xh:!1}function Ss(t){return t instanceof en}function u_(t){return(t==null?void 0:t.type)===en.getType()}const Qh=1;class dn extends Ga{static getType(){return"implied-para"}static clone(e){return new dn(e.__key)}static importJSON(e){return _t().updateFromJSON(e)}getMarker(){return eo}exportJSON(){return{...super.exportJSON(),type:this.getType(),version:Qh}}insertNewAfter(e,n){const r=_t();return r.setTextFormat(e.format),r.setTextStyle(e.style),r.setDirection(this.getDirection()),r.setFormat(this.getFormatType()),r.setStyle(this.getTextStyle()),this.insertAfter(r,n),r}}function _t(){return Ne(new dn)}function Zt(t){return t instanceof dn}function fl(t){return(t==null?void 0:t.type)===dn.getType()}const $n="zmsc-s",ir="zmsc-e",d_=[$n,ir],h_=["ts-s","ts-e","t-s","t-e","ts","qt1-s","qt1-e","qt2-s","qt2-e","qt3-s","qt3-e","qt4-s","qt4-e","qt5-s","qt5-e","qt-s","qt-e",$n,ir],ef=1;class Pt extends br{constructor(e="",n,r,s,i){super(i),z(this,"__marker"),z(this,"__sid"),z(this,"__eid"),z(this,"__unknownAttributes"),this.__marker=e,this.__sid=n,this.__eid=r,this.__unknownAttributes=s}static getType(){return"ms"}static clone(e){const{__marker:n,__sid:r,__eid:s,__unknownAttributes:i,__key:o}=e;return new Pt(n,r,s,i,o)}static importJSON(e){return tf().updateFromJSON(e)}static isValidMarker(e){return e!==void 0&&(h_.includes(e)||e.startsWith("z"))}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setSid(e.sid).setEid(e.eid).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const n=this.getWritable();return n.__marker=e,n}getMarker(){return this.getLatest().__marker}setSid(e){if(this.__sid===e)return this;const n=this.getWritable();return n.__sid=e,n}getSid(){return this.getLatest().__sid}setEid(e){if(this.__eid===e)return this;const n=this.getWritable();return n.__eid=e,n}getEid(){return this.getLatest().__eid}setUnknownAttributes(e){const n=this.getWritable();return n.__unknownAttributes=e,n}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("span");return e.setAttribute("data-marker",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`),e}updateDOM(){return!1}decorate(){return""}exportJSON(){return{type:this.getType(),marker:this.getMarker(),sid:this.getSid(),eid:this.getEid(),unknownAttributes:this.getUnknownAttributes(),version:ef}}isKeyboardSelectable(){return!1}}function f_(t){return d_.includes(t)}function tf(t,e,n,r){return Ne(new Pt(t,e,n,r))}function to(t){return t instanceof Pt}const pl="f",p_=[pl,"fe","ef","efe","x","ex"],nf=1;class Pe extends pn{constructor(e=pl,n,r=!0,s,i,o){super(o),z(this,"__marker"),z(this,"__caller"),z(this,"__isCollapsed"),z(this,"__category"),z(this,"__unknownAttributes"),this.__marker=e,this.__caller=n??(e==="x"||e==="ex"?hr:Rt),this.__isCollapsed=r,this.__category=s,this.__unknownAttributes=i}static getType(){return"note"}static clone(e){const{__marker:n,__caller:r,__isCollapsed:s,__category:i,__unknownAttributes:o,__key:a}=e;return new Pe(n,r,s,i,o,a)}static importDOM(){return{span:e=>m_(e)?{conversion:g_,priority:1}:null}}static importJSON(e){return gl().updateFromJSON(e)}static isValidMarker(e){return e!==void 0&&p_.includes(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setCaller(e.caller).setIsCollapsed(e.isCollapsed).setCategory(e.category).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const n=this.getWritable();return n.__marker=e,n}getMarker(){return this.getLatest().__marker}setCaller(e){if(this.__caller===e)return this;const n=this.getWritable();return n.__caller=e,n}getCaller(){return this.getLatest().__caller}setIsCollapsed(e){if(this.__isCollapsed===e)return this;const n=this.getWritable();return n.__isCollapsed=e,n}toggleIsCollapsed(){const e=this.getWritable();return e.__isCollapsed=!e.__isCollapsed,e}getIsCollapsed(){return this.getLatest().__isCollapsed}setCategory(e){if(this.__category===e)return this;const n=this.getWritable();return n.__category=e,n}getCategory(){return this.getLatest().__category}setUnknownAttributes(e){const n=this.getWritable();return n.__unknownAttributes=e,n}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("span");return e.setAttribute("data-marker",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`,this.__isCollapsed?"collapsed":"expanded"),e.setAttribute("data-caller",this.__caller),e}updateDOM(e){return e.__isCollapsed!==this.__isCollapsed}exportDOM(e){const{element:n}=super.exportDOM(e);return n&&gn(n)&&(n.setAttribute("data-marker",this.getMarker()),n.classList.add(this.getType(),`usfm_${this.getMarker()}`,this.getIsCollapsed()?"collapsed":"expanded"),n.setAttribute("data-caller",this.getCaller())),{element:n}}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),caller:this.getCaller(),isCollapsed:this.getIsCollapsed(),category:this.getCategory(),unknownAttributes:this.getUnknownAttributes(),version:nf}}canBeEmpty(){return!1}isInline(){return!0}}function g_(t){const e=t.getAttribute("data-marker")??"f",n=t.getAttribute("data-caller")??"",r=t.classList.contains("collapsed");return{node:gl(e,n,r)}}function gl(t,e,n,r,s){return Ne(new Pe(t,e,n,r,s))}function m_(t){if(!t)return!1;const e=t.getAttribute("data-marker")??"";return Pe.isValidMarker(e)&&t.classList.contains(Pe.getType())}function oe(t){return t instanceof Pe}const y_=["ide","sts","rem","h","toc1","toc2","toc3","toca1","toca2","toca3","imt","imt1","imt2","imt3","imt4","is","is1","is2","ip","ipi","im","imi","ipq","imq","ipr","iq","iq1","iq2","iq3","ili","ili1","ili2","ib","iot","io","io1","io2","io3","io4","iex","imte","imte1","imte2","ie","mt","mt1","mt2","mt3","mt4","mte","mte1","mte2","cl","cd","ms","ms1","ms2","ms3","mr","s","s1","s2","s3","s4","sr","r","d","sp","sd","sd1","sd2","sd3","sd4",eo,"m","po","cls","pr","pc","pm","pmo","pmc","pmr","pi","pi1","pi2","pi3","mi","lit","nb","q","q1","q2","q3","q4","qr","qc","qa","qm","qm1","qm2","qm3","qd","b","lh","li","li1","li2","li3","li4","lf","lim","lim1","lim2","lim3","lim4","pb"],rf=1;class tt extends Ga{constructor(e=eo,n,r){super(r),z(this,"__marker"),z(this,"__unknownAttributes"),this.__marker=e,this.__unknownAttributes=n}static getType(){return"para"}static clone(e){const{__marker:n,__unknownAttributes:r,__key:s}=e;return new tt(n,r,s)}static isValidMarker(e){return e!==void 0&&y_.includes(e)}static importDOM(){return{p:()=>({conversion:b_,priority:1})}}static importJSON(e){return ps().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const n=this.getWritable();return n.__marker=e,n}getMarker(){return this.getLatest().__marker}setUnknownAttributes(e){const n=this.getWritable();return n.__unknownAttributes=e,n}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("p");return e.setAttribute("data-marker",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`),e}exportDOM(e){const{element:n}=super.exportDOM(e);return n&&gn(n)&&(n.setAttribute("data-marker",this.getMarker()),n.classList.add(this.getType(),`usfm_${this.getMarker()}`)),{element:n}}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),unknownAttributes:this.getUnknownAttributes(),version:rf}}insertNewAfter(e,n){const r=ps(this.getMarker());return r.setTextFormat(e.format),r.setTextStyle(e.style),r.setDirection(this.getDirection()),r.setFormat(this.getFormatType()),r.setStyle(this.getTextStyle()),this.insertAfter(r,n),r}}function b_(t){const e=t.getAttribute("data-marker")??void 0,n=ps(e);if(t.style){n.setFormat(t.style.textAlign);const r=parseInt(t.style.textIndent,10)/20;r>0&&n.setIndent(r)}return{node:n}}function ps(t,e){return Ne(new tt(t,e))}function Ke(t){return t instanceof tt}function __(t){return(t==null?void 0:t.type)===tt.getType()}const qi="v",sf=1;class Ge extends At{constructor(e="",n,r,s,i,o,a){super(n??e,a),z(this,"__marker"),z(this,"__number"),z(this,"__sid"),z(this,"__altnumber"),z(this,"__pubnumber"),z(this,"__unknownAttributes"),this.__marker=qi,this.__number=e,this.__sid=r,this.__altnumber=s,this.__pubnumber=i,this.__unknownAttributes=o}static getType(){return"verse"}static clone(e){const{__number:n,__text:r,__sid:s,__altnumber:i,__pubnumber:o,__unknownAttributes:a,__key:l}=e;return new Ge(n,r,s,i,o,a,l)}static importJSON(e){return of().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setNumber(e.number).setSid(e.sid).setAltnumber(e.altnumber).setPubnumber(e.pubnumber).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const n=this.getWritable();return n.__marker=e,n}getMarker(){return this.getLatest().__marker}setNumber(e){if(this.__number===e)return this;const n=this.getWritable();return n.__number=e,n}getNumber(){return this.getLatest().__number}setSid(e){if(this.__sid===e)return this;const n=this.getWritable();return n.__sid=e,n}getSid(){return this.getLatest().__sid}setAltnumber(e){if(this.__altnumber===e)return this;const n=this.getWritable();return n.__altnumber=e,n}getAltnumber(){return this.getLatest().__altnumber}setPubnumber(e){if(this.__pubnumber===e)return this;const n=this.getWritable();return n.__pubnumber=e,n}getPubnumber(){return this.getLatest().__pubnumber}setUnknownAttributes(e){const n=this.getWritable();return n.__unknownAttributes=e,n}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(e){const n=super.createDOM(e);return n.setAttribute("data-marker",this.__marker),n.classList.add(Oa,`usfm_${this.__marker}`),n.setAttribute("data-number",this.__number),n}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),number:this.getNumber(),sid:this.getSid(),altnumber:this.getAltnumber(),pubnumber:this.getPubnumber(),unknownAttributes:this.getUnknownAttributes(),version:sf}}}function of(t,e,n,r,s,i){return Ne(new Ge(t,e,n,r,s,i))}function ml(t){return t instanceof Ge}function k_(t){return(t==null?void 0:t.type)===Ge.getType()}function v_(t){return r_(t)||u_(t)}function lt(t){return dl(t)||Ss(t)}function w_(t,e){return t.find(n=>lt(n)&&n.getNumber()===e.toString())}function x_(t,e=!1){return t.find((n,r)=>(!e||r>0)&&lt(n))}function yl(t){var e;if(!t)return;if(lt(t))return t;let n=(e=t.getTopLevelElement())==null?void 0:e.getPreviousSibling();for(;n&&!lt(n);)n=n.getPreviousSibling();if(n&&lt(n))return n}function af(t){let e=t;for(;e!==null;){if(oe(e))return e;e=e.getParent()}}function C_(t){return It(t)||dl(t)||pe(t)||Ss(t)||Zt(t)||to(t)||Ke(t)||oe(t)||ml(t)||Cs(t)}function S_(t){var e;if(t.anchor.type==="element"){const r=t.anchor.getNode(),s=t.anchor.offset;if(s<r.getChildrenSize())return r.getChildAtIndex(s)}const n=t.anchor.getNode();return n.getNextSibling()??((e=n.getParent())==null?void 0:e.getNextSibling())??null}function T_(t){var e;const n=t.anchor.offset;if(t.anchor.type==="element"&&n>0)return t.anchor.getNode().getChildAtIndex(n-1);const r=t.anchor.getNode();return r.getPreviousSibling()??((e=r.getParent())==null?void 0:e.getPreviousSibling())??null}function bt(t){return Ke(t)||Zt(t)}function E_(t,e){let n=t.getParent();for(;n;){if(n.getKey()===e)return!0;n=n.getParent()}return!1}function qn(t,e){const n=vs(e,Rn),r=!!(t.cid&&n),s=!t.cid&&!n;return t.style===e.getMarker()&&(s||r&&t.cid===n)}function O_(t,e){const n=we(t)?t:t.getParent(),r=we(e)?e:e.getParent(),s=n&&r?Rp(n,r):void 0;return s?s.commonAncestor:void 0}function M_(t){const e=t.getStartEndPoints();if(!e)return;const[n,r]=e,s=t.isBackward()?n:r;t.focus.set(s.key,s.offset,s.type),t.anchor.set(s.key,s.offset,s.type)}function bl(t){return(t==null?void 0:t.type)===At.getType()}function A_(t,e){if(!e)return;const n=t.findIndex(r=>r===e);n&&(t.length=n)}function j_(t,e){if(!e)return t;const n=e.getIndexWithinParent();return t.splice(n+1,t.length-n-1)}function tn(t){return`\\${t}`}function fr(t){return`\\${t}*`}function lf(t,e,n){const r=tn(t);if(e!=null&&e.startsWith(r)){const s=parseInt(e.slice(r.length),10);isNaN(s)||(n=s.toString())}return n}function Ts(t,e){let n=tn(t);return e&&(n+=`${me}${e}`),n+=" ",n}function cf(t){return bl(t)&&t.text!==me?t.text:a_(t)?t.children.map(e=>cf(e)).join(""):""}function N_(t){return t.map(e=>cf(e)).filter(e=>e.length>0).join(" ").trim()}function _l(t){return me+t+" "}function kl(t){const e=[];for(const n of t){if(!pe(n))continue;const r=n.getTextContent();r!==Xt&&r.length>0&&e.push(r)}return e.join(" ").trim()}function $e(t,e=np){const n={...t};return e.forEach(r=>{Reflect.deleteProperty(n,r)}),Object.keys(n).length===0?void 0:n}function I_(t,e){const n=e.getElementByKey(t.getKey());return n?n.tagName.toLowerCase():void 0}function je(t){return Object.fromEntries(Object.entries(t).filter(([,e])=>e!==void 0))}function uf(t){if(!t)return;const e=t.getNodes();if(e.length>0)return t.isBackward()?e[e.length-1]:e[0]}function Na(t,e){if(!e)return(t+1).toString();const n=e.split("-");if(n.length===2)return parseInt(n[1])?`${parseInt(n[1])+1}`:`${parseInt(n[0])+1}`;const r=RegExp(/^(\d+)([a-yA-Y]{1,3})$/).exec(e);if(!r)return(parseInt(e)+1).toString();const s=String.fromCharCode(r[2].charCodeAt(0)+1);return`${r[1]}${s}`}function vl(t,e){if(!e)return!1;const n=e.split("-").map(r=>parseInt(r));if(n.length<1||n.length>2||n[0]>n[1])throw new Error("isVerseInRange: invalid range");return n.length===1?t===n[0]:n.length===2&&isNaN(n[1])?t>=n[0]:(n.length===2&&isNaN(n[0])||t>=n[0])&&t<=n[1]}function R_(t){return!!t&&t.includes("-")}const P_=1;class Bn extends At{constructor(e="",n="opening",r){super(sa(e,n),r),z(this,"__marker"),z(this,"__markerSyntax"),this.__marker=e,this.__markerSyntax=n}static getType(){return"marker"}static clone(e){return new Bn(e.__marker,e.__markerSyntax,e.__key)}static importJSON(e){return pr().updateFromJSON(e)}updateFromJSON(e){const{marker:n,markerSyntax:r="opening"}=e;return super.updateFromJSON(e).setMarker(n).setMarkerSyntax(r)}setMarker(e){if(this.__marker===e)return this;const n=this.getWritable();return n.__marker=e,n.__text=sa(e,n.__markerSyntax),n}getMarker(){return this.getLatest().__marker}setMarkerSyntax(e){if(this.__markerSyntax===e)return this;const n=this.getWritable();return n.__markerSyntax=e,n.__text=sa(n.__marker,e),n}getMarkerSyntax(){return this.getLatest().__markerSyntax}createDOM(e){const n=super.createDOM(e);return n.setAttribute("data-marker",this.__marker),n.classList.add(this.__markerSyntax),n}exportJSON(){return{...super.exportJSON(),type:this.getType(),text:this.getTextContent(),marker:this.getMarker(),markerSyntax:this.getMarkerSyntax(),version:P_}}}function pr(t,e){return Ne(new Bn(t,e))}function Es(t){return t instanceof Bn}function sa(t,e){return e==="closing"?fr(t):e==="selfClosing"?fr(""):tn(t)}const cn="internal-comment",$_=[cn],df=Object.freeze({}),Ia=Object.freeze({}),Ra=Object.freeze({}),q_=1,Wt=new Map,On=new Map;class Le extends pn{constructor(e=df,n,r,s){super(s),z(this,"__typedIDs"),z(this,"__typedOnClicks"),z(this,"__typedOnRemoves"),z(this,"__domOnClickListener"),z(this,"__suppressOnRemoveCallbacks"),this.__typedIDs=si(e),this.__typedOnClicks=ia(n),this.__typedOnRemoves=oa(r),this.pruneTypedOnClicks(),this.pruneTypedOnRemoves(),this.syncTypedOnClicksToRegistry(),this.syncTypedOnRemovesToRegistry()}static getType(){return"typed-mark"}static clone(e){const n=si(e.__typedIDs),r=ia(e.__typedOnClicks),s=oa(e.__typedOnRemoves);return new Le(n,r,s,e.__key)}static isReservedType(e){return $_.includes(e)}static importDOM(){return null}static importJSON(e){return gs().updateFromJSON(e)}exportJSON(){return{...super.exportJSON(),type:this.getType(),typedIDs:this.getTypedIDs(),version:q_}}createDOM(e,n){const r=document.createElement("mark");for(const[i,o]of Object.entries(this.__typedIDs)){Ot(r,Mn(e.theme.typedMark,i)),o.length>1&&Ot(r,Mn(e.theme.typedMarkOverlap,i));for(const a of o)Ot(r,Mn("annotationId",a))}const s=this.getOrCreateDOMClickListener(n);return r.addEventListener("click",s),r}updateDOM(e,n,r){const s=new Set([...Object.keys(e.__typedIDs??{}),...Object.keys(this.__typedIDs??{})]);for(const i of s){const o=e.__typedIDs[i]??[],a=this.__typedIDs[i]??[],l=o.length,u=a.length,d=Mn(r.theme.typedMark,i),f=Mn(r.theme.typedMarkOverlap,i);l!==u&&(l===0?u===1&&Ot(n,d):u===0&&ki(n,d),l===1?u===2&&Ot(n,f):u===1&&ki(n,f));const h=new Set(o),p=new Set(a);for(const y of o)p.has(y)||ki(n,Mn("annotationId",y));for(const y of a)h.has(y)||Ot(n,Mn("annotationId",y))}return!1}updateFromJSON(e){return super.updateFromJSON(e).setTypedIDs(e.typedIDs)}hasID(e,n){const r=this.getTypedIDs()[e];if(!r)return!1;for(const s of r)if(n===s)return!0;return!1}getTypedIDs(){const e=this.getLatest();return Ee(e)?e.__typedIDs:{}}setTypedIDs(e){const n=this.getWritable(),r=si(n.__typedIDs);n.__typedIDs=si(e),n.dispatchRemovedIDs(r,n.__typedIDs,"removed"),n.pruneTypedOnClicks(),n.pruneTypedOnRemoves(),n.syncTypedOnClicksToRegistry(),n.syncTypedOnRemovesToRegistry();const s=n.mergeWithAdjacentTypedMarks();return s.hasNoIDsForEveryType()&&s.getParent()!==null&&Di(s),s}setTypedOnClicks(e){const n=this.getWritable();return n.__typedOnClicks=ia(e),n.pruneTypedOnClicks(),n.syncTypedOnClicksToRegistry(),n}getTypedOnClicks(){const e=this.getLatest();return Ee(e)?Wt.get(e.getKey())??{}:{}}setTypedOnRemoves(e){const n=this.getWritable();return n.__typedOnRemoves=oa(e),n.pruneTypedOnRemoves(),n.syncTypedOnRemovesToRegistry(),n}getTypedOnRemoves(){const e=this.getLatest();return Ee(e)?On.get(e.getKey())??{}:{}}addID(e,n,r,s){const i=this.getWritable();if(!Ee(i))return;ot(e),ot(n);let o=i.__typedIDs[e];o||(o=[],i.__typedIDs[e]=o);for(const a of o)if(n===a){r&&i.setOnClickFor(e,n,r),s&&i.setOnRemoveFor(e,n,s);return}o.push(n),r&&i.setOnClickFor(e,n,r),s&&i.setOnRemoveFor(e,n,s)}deleteID(e,n){const r=this.getWritable();if(!Ee(r))return;const s=r.__typedIDs[e];if(!s||s.length===0)return;for(let o=0;o<s.length;o++)if(n===s[o]){s.splice(o,1),r.invokeOnRemove(e,n,"removed");break}r.removeOnClickFor(e,n),r.removeOnRemoveFor(e,n),r.pruneTypedOnClicks(),r.pruneTypedOnRemoves();const i=r.mergeWithAdjacentTypedMarks();i.hasNoIDsForEveryType()&&i.getParent()!==null&&Di(i)}hasNoIDsForEveryType(){return Object.values(this.getTypedIDs()).every(e=>e===void 0||e.length===0)}insertNewAfter(e,n=!0){const r=gs(this.__typedIDs,this.getTypedOnClicks());return this.insertAfter(r,n),r}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}canBeEmpty(){return!1}isInline(){return!0}extractWithChild(e,n,r){if(!X(n)||r==="html")return!1;const s=n.anchor,i=n.focus,o=s.getNode(),a=i.getNode(),l=n.isBackward()?s.offset-i.offset:i.offset-s.offset;return this.isParentOf(o)&&this.isParentOf(a)&&this.getTextContent().length===l}excludeFromCopy(e){return e!=="clone"}remove(e){const n=this.getWritable(),r=this.getTypedIDs();n.__suppressOnRemoveCallbacks?n.__suppressOnRemoveCallbacks=void 0:n.dispatchOnRemoveForTypedIDs(r,"destroyed"),Wt.delete(n.getKey()),On.delete(n.getKey()),n.__typedOnClicks=void 0,n.__typedOnRemoves=void 0,super.remove.call(n,e)}getOrCreateDOMClickListener(e){return this.__domOnClickListener||(this.__domOnClickListener=n=>{this.handleDOMClick(n,e)}),this.__domOnClickListener}handleDOMClick(e,n){const r=Wt.get(this.getKey());if(!r)return;const s=[];for(const[o,a]of Object.entries(r))for(const[l,u]of Object.entries(a))u&&s.push([u,o,l]);if(s.length===0)return;const i=n.read(()=>this.getTextContent());for(const[o,a,l]of s)o(e,a,l,i)}ensureOnClickMapMutable(){if(this.__typedOnClicks===void 0||this.__typedOnClicks===Ia){const e=Wt.get(this.getKey());this.__typedOnClicks=e??{}}return this.__typedOnClicks}syncTypedOnClicksToRegistry(){if(!this.__typedOnClicks||Object.keys(this.__typedOnClicks).length===0){Wt.delete(this.getKey()),this.__typedOnClicks&&Object.keys(this.__typedOnClicks).length===0&&(this.__typedOnClicks=void 0);return}Wt.set(this.getKey(),this.__typedOnClicks)}setOnClickFor(e,n,r){ot(e),ot(n);const s=this.ensureOnClickMapMutable(),i=s[e]??(s[e]={});i[n]=r,this.syncTypedOnClicksToRegistry()}removeOnClickFor(e,n){if(!this.__typedOnClicks)return;const r=this.__typedOnClicks[e];if(!r)return;const s=ii(r,n);if(Object.keys(s).length>0)this.__typedOnClicks={...this.__typedOnClicks,[e]:s};else{const i=ii(this.__typedOnClicks,e);this.__typedOnClicks=Object.keys(i).length>0?i:void 0}this.syncTypedOnClicksToRegistry()}pruneTypedOnClicks(){if(!this.__typedOnClicks||this.__typedOnClicks===Ia){this.__typedOnClicks=void 0,this.syncTypedOnClicksToRegistry();return}const e={};for(const[n,r]of Object.entries(this.__typedOnClicks)){const s=this.__typedIDs[n];if(!s||s.length===0)continue;const i=new Set(s),o={};for(const[a,l]of Object.entries(r))i.has(a)&&(o[a]=l);Object.keys(o).length>0&&(e[n]=o)}this.__typedOnClicks=Object.keys(e).length>0?e:void 0,this.syncTypedOnClicksToRegistry()}ensureOnRemoveMapMutable(){if(this.__typedOnRemoves===void 0||this.__typedOnRemoves===Ra){const e=On.get(this.getKey());this.__typedOnRemoves=e??{}}return this.__typedOnRemoves}syncTypedOnRemovesToRegistry(){if(!this.__typedOnRemoves||Object.keys(this.__typedOnRemoves).length===0){On.delete(this.getKey()),this.__typedOnRemoves&&Object.keys(this.__typedOnRemoves).length===0&&(this.__typedOnRemoves=void 0);return}On.set(this.getKey(),this.__typedOnRemoves)}setOnRemoveFor(e,n,r){ot(e),ot(n);const s=this.ensureOnRemoveMapMutable(),i=s[e]??(s[e]={});i[n]=r,this.syncTypedOnRemovesToRegistry()}removeOnRemoveFor(e,n){if(!this.__typedOnRemoves)return;const r=this.__typedOnRemoves[e];if(!r)return;const s=ii(r,n);if(Object.keys(s).length>0)this.__typedOnRemoves={...this.__typedOnRemoves,[e]:s};else{const i=ii(this.__typedOnRemoves,e);this.__typedOnRemoves=Object.keys(i).length>0?i:void 0}this.syncTypedOnRemovesToRegistry()}pruneTypedOnRemoves(){if(!this.__typedOnRemoves||this.__typedOnRemoves===Ra){this.__typedOnRemoves=void 0,this.syncTypedOnRemovesToRegistry();return}const e={};for(const[n,r]of Object.entries(this.__typedOnRemoves)){const s=this.__typedIDs[n];if(!s||s.length===0)continue;const i=new Set(s),o={};for(const[a,l]of Object.entries(r))i.has(a)&&(o[a]=l);Object.keys(o).length>0&&(e[n]=o)}this.__typedOnRemoves=Object.keys(e).length>0?e:void 0,this.syncTypedOnRemovesToRegistry()}invokeOnRemove(e,n,r){var s;const i=(s=this.getTypedOnRemoves()[e])==null?void 0:s[n];i&&(i(e,n,r,this.getTextContent()),this.removeOnRemoveFor(e,n))}dispatchRemovedIDs(e,n,r){const s=D_(e,n);if(s.length!==0)for(const[i,o]of s)this.invokeOnRemove(i,o,r)}dispatchOnRemoveForTypedIDs(e,n){for(const[r,s]of Object.entries(e))if(s)for(const i of s)this.invokeOnRemove(r,i,n)}mergeWithAdjacentTypedMarks(){if(this.hasNoIDsForEveryType())return this;let e=this.getPreviousSibling();for(;Ee(e)&&zc(e.getTypedIDs(),this.getTypedIDs());)this.mergeWithPreviousTypedMark(e),e=this.getPreviousSibling();let n=this.getNextSibling();for(;Ee(n)&&zc(this.getTypedIDs(),n.getTypedIDs());)this.mergeWithNextTypedMark(n),n=this.getNextSibling();return this}mergeWithPreviousTypedMark(e){this.mergeOnClicksFrom(e.getTypedOnClicks()),this.mergeOnRemovesFrom(e.getTypedOnRemoves());const n=e.getChildren();n.length>0&&this.splice(0,0,n),Wt.delete(e.getKey()),On.delete(e.getKey()),e.getWritable().__suppressOnRemoveCallbacks=!0,e.remove()}mergeWithNextTypedMark(e){this.mergeOnClicksFrom(e.getTypedOnClicks()),this.mergeOnRemovesFrom(e.getTypedOnRemoves());const n=e.getChildren();n.length>0&&this.append(...n),Wt.delete(e.getKey()),On.delete(e.getKey()),e.getWritable().__suppressOnRemoveCallbacks=!0,e.remove()}mergeOnClicksFrom(e){if(!e||Object.keys(e).length===0)return;const n=L_(this.getTypedOnClicks(),e);Object.keys(n).length!==0&&this.setTypedOnClicks(n)}mergeOnRemovesFrom(e){if(!e||Object.keys(e).length===0)return;const n=F_(this.getTypedOnRemoves(),e);Object.keys(n).length!==0&&this.setTypedOnRemoves(n)}}function si(t=df){const e={};for(const[n,r]of Object.entries(t)){if(ot(n),!Array.isArray(r)){e[n]=[];continue}const s=[];for(const i of r)ot(i),s.push(i);e[n]=s}return e}function ia(t){if(!t||t===Ia)return;const e={};for(const[n,r]of Object.entries(t)){ot(n);const s={};for(const[i,o]of Object.entries(r))ot(i),s[i]=o;Object.keys(s).length>0&&(e[n]=s)}return Object.keys(e).length>0?e:void 0}function oa(t){if(!t||t===Ra)return;const e={};for(const[n,r]of Object.entries(t)){ot(n);const s={};for(const[i,o]of Object.entries(r))ot(i),s[i]=o;Object.keys(s).length>0&&(e[n]=s)}return Object.keys(e).length>0?e:void 0}function ii(t,e){const n={};for(const[r,s]of Object.entries(t))r!==e&&(n[r]=s);return n}function Wc(t){const e={};for(const[n,r]of Object.entries(t))!r||r.length===0||(e[n]=[...r].sort());return e}function D_(t,e){const n=[];for(const[r,s]of Object.entries(t)){const i=new Set(e[r]??[]);for(const o of s??[])i.has(o)||n.push([r,o])}return n}function zc(t,e){const n=Wc(t),r=Wc(e),s=Object.keys(n).sort(),i=Object.keys(r).sort();if(s.length!==i.length)return!1;for(let o=0;o<s.length;o++){const a=s[o];if(a!==i[o])return!1;const l=n[a],u=r[a];if(!l||!u||l.length!==u.length)return!1;for(let d=0;d<l.length;d++)if(l[d]!==u[d])return!1}return!0}function L_(t,e){const n={},r=new Set([...Object.keys(t),...Object.keys(e)]);for(const s of r){const i=t[s]??{},o=e[s]??{},a=new Set([...Object.keys(i),...Object.keys(o)]),l={};for(const u of a){const d=i[u]??o[u];d&&(l[u]=d)}Object.keys(l).length>0&&(n[s]=l)}return n}function F_(t,e){const n={},r=new Set([...Object.keys(t),...Object.keys(e)]);for(const s of r){const i=t[s]??{},o=e[s]??{},a=new Set([...Object.keys(i),...Object.keys(o)]),l={};for(const u of a){const d=i[u]??o[u];d&&(l[u]=d)}Object.keys(l).length>0&&(n[s]=l)}return n}function Mn(t,e){return`${t}-${e}`}function Kc(t){return`external-${t}`}function gs(t,e,n){return Ne(new Le(t,e,n))}function Ee(t){return t instanceof Le}function U_(t){return(t==null?void 0:t.type)===Le.getType()}function Di(t){const e=t.getChildren();let n=null;for(const r of e)n===null?t.insertBefore(r):n.insertAfter(r),n=r;t.remove(),Wt.delete(t.getKey())}function hf(t,e,n,r,s){const i=t.getNodes(),o=t.anchor.offset,a=t.focus.offset,l=i.length,u=t.isBackward(),d=u?a:o,f=u?o:a;let h,p;for(let y=0;y<l;y++){const b=i[y];if(we(p)&&p.isParentOf(b))continue;const C=y===0,A=y===l-1;let v=null;if(ee(b)){const E=b.getTextContentSize(),j=C?d:0,$=A?f:E;if(j===0&&$===0)continue;const q=b.splitText(j,$);v=q.length>1&&(q.length===3||C&&!A||$===E)?q[1]:q[0]}else{if(Ee(b))continue;we(b)&&b.isInline()&&(v=b)}if(v!==null){if(v&&v.is(h))continue;const E=v.getParent();(E==null||!E.is(h))&&(p=void 0),h=E,p===void 0&&(p=gs(),p.addID(e,n,r,s),v.insertBefore(p)),p.append(v)}else h=void 0,p=void 0}e===cn&&we(p)&&(u?p.selectStart():p.selectEnd())}function B_(t,e,n){let r=t;for(;r!==null;){if(Ee(r))return r.getTypedIDs()[e];if(ee(r)&&n===r.getTextContentSize()){const s=r.getNextSibling();if(Ee(s))return s.getTypedIDs()[e]}r=r.getParent()}}const ff=1;class bn extends br{constructor(e="",n="",r){super(r),z(this,"__textType"),z(this,"__text"),this.__textType=e,this.__text=n}static getType(){return"immutable-typed-text"}static clone(e){const{__textType:n,__text:r,__key:s}=e;return new bn(n,r,s)}static importDOM(){return{span:e=>W_(e)?{conversion:H_,priority:1}:null}}static importJSON(e){return gr().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setTextType(e.textType).setTextContent(e.text)}setTextType(e){if(this.__textType===e)return this;const n=this.getWritable();return n.__textType=e,n}getTextType(){return this.getLatest().__textType}setTextContent(e){if(this.__text===e)return this;const n=this.getWritable();return n.__text=e,n}getTextContent(){return this.getLatest().__text}createDOM(){const e=document.createElement("span");return e.setAttribute("data-text-type",this.__textType),e.classList.add(this.__textType),e}updateDOM(){return!1}exportDOM(e){const{element:n}=super.exportDOM(e);return n&&gn(n)&&n.setAttribute("data-text-type",this.getTextType()),{element:n}}decorate(){return this.getTextContent()}exportJSON(){return{type:this.getType(),textType:this.getTextType(),text:this.getTextContent(),version:ff}}isKeyboardSelectable(){return!1}}function H_(t){const e=t.getAttribute("data-text-type")??"",n=t.textContent??"";return{node:gr(e,n)}}function gr(t,e){return Ne(new bn(t,e))}function W_(t){return(t==null?void 0:t.tagName)==="span"}function Li(t){return t instanceof bn}function z_(t){return(t==null?void 0:t.type)===bn.getType()}const Fi="unmatched",pf=1;class _n extends br{constructor(e="",n){super(n),z(this,"__marker"),this.__marker=e}static getType(){return"unmatched"}static clone(e){const{__marker:n,__key:r}=e;return new _n(n,r)}static importDOM(){return{[Fi]:e=>J_(e)?{conversion:K_,priority:1}:null}}static importJSON(e){return wl().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker)}setMarker(e){if(this.__marker===e)return this;const n=this.getWritable();return n.__marker=e,n}getMarker(){return this.getLatest().__marker}createDOM(){const e=document.createElement(Fi);e.setAttribute("data-marker",this.__marker),e.classList.add(Hc);const n=this.__marker.endsWith("*");return e.title=n?"This closing marker has no matching opening marker!":"This opening marker has no matching closing marker!",e}updateDOM(){return!1}exportDOM(e){const{element:n}=super.exportDOM(e);return n&&gn(n)&&(n.setAttribute("data-marker",this.getMarker()),n.classList.add(Hc)),{element:n}}decorate(){return`\\${this.getMarker()}${Ea}`}exportJSON(){return{type:this.getType(),marker:this.getMarker(),version:pf}}isKeyboardSelectable(){return!1}}function K_(t){const e=t.getAttribute("data-marker")??"";return{node:wl(e)}}function wl(t){return Ne(new _n(t))}function J_(t){return(t==null?void 0:t.tagName)===Fi}function gf(t){return t instanceof _n}const V_=[ut,en,wt,Ge,Ce,Pe,Pt,Bn,Un,bn,_n,tt,dn,{replace:Ga,with:()=>_t(),withKlass:dn}];var T;(function(t){t.FileIdentification="FileIdentification",t.Headers="Headers",t.Remarks="Remarks",t.Introduction="Introduction",t.DivisionMarks="DivisionMarks",t.Paragraphs="Paragraphs",t.Poetry="Poetry",t.TitlesHeadings="TitlesHeadings",t.Tables="Tables",t.CenterTables="CenterTables",t.RightTables="RightTables",t.Lists="Lists",t.Footnotes="Footnotes",t.CrossReferences="CrossReferences",t.SpecialText="SpecialText",t.CharacterStyling="CharacterStyling",t.Breaks="Breaks",t.SpecialFeatures="SpecialFeatures",t.PeripheralReferences="PeripheralReferences",t.PeripheralMaterials="PeripheralMaterials",t.Uncategorized="Uncategorized"})(T||(T={}));var S;(function(t){t.Paragraph="Paragraph",t.Character="Character",t.Note="Note",t.Unknown="Unknown"})(S||(S={}));const G_={id:{category:T.FileIdentification,type:S.Paragraph,description:"File identification information (BOOKID, FILENAME, EDITOR, MODIFICATION DATE)",hasEndMarker:!1,children:{FileIdentification:["usfm","ide"],Headers:["h","h1","h2","h3","toc1","toc2","toc3"],Remarks:["rem","sts","restore"],Introduction:["imt","imt1","imt2","imt3","imt4","imte","imte1","imte2","is","is1","is2","iot","io","io1","io2","io3","io4","ior","ip","im","ipi","imi","ili","ili1","ili2","ipq","imq","ipr","ib","iq","iq1","iq2","iq3","iex","ie"],DivisionMarks:["c","cl"],TitlesHeadings:["mt","mt1","mt2","mt3","mt4"]}},usfm:{category:T.FileIdentification,type:S.Paragraph,description:"File markup version information",hasEndMarker:!1,children:void 0},ide:{category:T.FileIdentification,type:S.Paragraph,description:"File encoding information",hasEndMarker:!1,children:{Remarks:["rem","sts"]}},h:{category:T.Headers,type:S.Paragraph,description:"Running header text for a book (basic)",hasEndMarker:!1,children:{Headers:["toc1","toc2","toc3","toca1","toca2","toca3"]}},h1:{category:T.Headers,type:S.Paragraph,description:"Running header text",hasEndMarker:!1,children:{Headers:["toc1","toc2","toc3","toca1","toca2","toca3"]}},h2:{category:T.Headers,type:S.Paragraph,description:"Running header text, left side of page",hasEndMarker:!1,children:{Headers:["toc1","toc2","toc3","toca1","toca2","toca3"]}},h3:{category:T.Headers,type:S.Paragraph,description:"Running header text, right side of page",hasEndMarker:!1,children:{Headers:["toc1","toc2","toc3","toca1","toca2","toca3"]}},toc1:{category:T.Headers,type:S.Paragraph,description:"Long table of contents text",hasEndMarker:!1,children:void 0},toc2:{category:T.Headers,type:S.Paragraph,description:"Short table of contents text",hasEndMarker:!1,children:void 0},toc3:{category:T.Headers,type:S.Paragraph,description:"Book Abbreviation",hasEndMarker:!1,children:void 0},toca1:{category:T.Headers,type:S.Paragraph,description:"Alternative language long table of contents text",hasEndMarker:!1,children:void 0},toca2:{category:T.Headers,type:S.Paragraph,description:"Alternative language short table of contents text",hasEndMarker:!1,children:void 0},toca3:{category:T.Headers,type:S.Paragraph,description:"Alternative language book Abbreviation",hasEndMarker:!1,children:void 0},rem:{category:T.Remarks,type:S.Paragraph,description:"Comments and remarks",hasEndMarker:!1,children:void 0},sts:{category:T.Remarks,type:S.Paragraph,description:"Status of this file",hasEndMarker:!1,children:void 0},restore:{category:T.Remarks,type:S.Paragraph,description:"Project restore information",hasEndMarker:!1,children:void 0},imt:{category:T.Introduction,type:S.Paragraph,description:"Introduction major title, level 1 (if single level) (basic)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imt1:{category:T.Introduction,type:S.Paragraph,description:"Introduction major title, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imt2:{category:T.Introduction,type:S.Paragraph,description:"Introduction major title, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imt3:{category:T.Introduction,type:S.Paragraph,description:"Introduction major title, level 3",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imt4:{category:T.Introduction,type:S.Paragraph,description:"Introduction major title, level 4 (usually within parenthesis)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imte:{category:T.Introduction,type:S.Paragraph,description:"Introduction major title at introduction end, level 1 (if single level)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imte1:{category:T.Introduction,type:S.Paragraph,description:"Introduction major title at introduction end, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imte2:{category:T.Introduction,type:S.Paragraph,description:"Introduction major title at introduction end, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},is:{category:T.Introduction,type:S.Paragraph,description:"Introduction section heading, level 1 (if single level) (basic)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"],CharacterStyling:["no"]}},is1:{category:T.Introduction,type:S.Paragraph,description:"Introduction section heading, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},is2:{category:T.Introduction,type:S.Paragraph,description:"Introduction section heading, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},iot:{category:T.Introduction,type:S.Paragraph,description:"Introduction outline title (basic)",hasEndMarker:!1,children:{Introduction:["iqt"],CharacterStyling:["no"]}},io:{category:T.Introduction,type:S.Paragraph,description:"Introduction outline text, level 1 (if single level)",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},io1:{category:T.Introduction,type:S.Paragraph,description:"Introduction outline text, level 1 (if multiple levels) (basic)",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},io2:{category:T.Introduction,type:S.Paragraph,description:"Introduction outline text, level 2",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},io3:{category:T.Introduction,type:S.Paragraph,description:"Introduction outline text, level 3",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},io4:{category:T.Introduction,type:S.Paragraph,description:"Introduction outline text, level 4",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ior:{category:T.Introduction,type:S.Character,description:"Introduction references range for outline entry; for marking references separately",hasEndMarker:!0,children:void 0},ip:{category:T.Introduction,type:S.Paragraph,description:"Introduction prose paragraph (basic)",hasEndMarker:!1,children:{Introduction:["iqt"],Footnotes:["f","fe","fm"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},im:{category:T.Introduction,type:S.Paragraph,description:"Introduction prose paragraph, with no first line indent (may occur after poetry)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ipi:{category:T.Introduction,type:S.Paragraph,description:"Introduction prose paragraph, indented, with first line indent",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},imi:{category:T.Introduction,type:S.Paragraph,description:"Introduction prose paragraph text, indented, with no first line indent",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ili:{category:T.Introduction,type:S.Paragraph,description:"A list entry, level 1 (if single level)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ili1:{category:T.Introduction,type:S.Paragraph,description:"A list entry, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ili2:{category:T.Introduction,type:S.Paragraph,description:"A list entry, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ipq:{category:T.Introduction,type:S.Paragraph,description:"Introduction prose paragraph, quote from the body text",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},imq:{category:T.Introduction,type:S.Paragraph,description:"Introduction prose paragraph, quote from the body text, with no first line indent",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ipr:{category:T.Introduction,type:S.Paragraph,description:"Introduction prose paragraph, right aligned",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},ib:{category:T.Introduction,type:S.Paragraph,description:"Introduction blank line",hasEndMarker:!1,children:{Introduction:["iqt"]}},iq:{category:T.Introduction,type:S.Paragraph,description:"Introduction poetry text, level 1 (if single level)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},iq1:{category:T.Introduction,type:S.Paragraph,description:"Introduction poetry text, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},iq2:{category:T.Introduction,type:S.Paragraph,description:"Introduction poetry text, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},iq3:{category:T.Introduction,type:S.Paragraph,description:"Introduction poetry text, level 3",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},iex:{category:T.Introduction,type:S.Paragraph,description:"Introduction explanatory or bridge text (e.g. explanation of missing book in Short Old Testament)",hasEndMarker:!1,children:{Introduction:["iqt"],CharacterStyling:["no"]}},iqt:{category:T.Introduction,type:S.Character,description:"For quoted scripture text appearing in the introduction",hasEndMarker:!0,children:void 0},ie:{category:T.Introduction,type:S.Paragraph,description:"Introduction ending marker",hasEndMarker:!1,children:void 0},c:{category:T.DivisionMarks,type:S.Paragraph,description:"Chapter number",hasEndMarker:!1,children:{DivisionMarks:["ca","cp","cl","cd"],Paragraphs:["p","m","po","pr","cls","pi","pi1","pi2","pi3","pc","mi","nb"],Poetry:["q","q1","q2","q3","q4","qc","qr","qa","qd","b"],TitlesHeadings:["mte","ms","ms1","ms2","ms3","s","s1","s2","s3","s4","r","sp","d","sd","sd1","sd2","sd3","sd4"],Lists:["lh","li","li1","li2","li3","li4","lf","lim","lim1","lim2","lim3","lim4"],Footnotes:["f","fe"],SpecialText:["lit"],Breaks:["pb"]}},ca:{category:T.DivisionMarks,type:S.Character,description:"Second (alternate) chapter number (for coding dual versification; useful for places where different traditions of chapter breaks need to be supported in the same translation)",hasEndMarker:!0,children:void 0},cp:{category:T.DivisionMarks,type:S.Paragraph,description:"Published chapter number (chapter string that should appear in the published text)",hasEndMarker:!1,children:{Footnotes:["f"]}},cl:{category:T.DivisionMarks,type:S.Paragraph,description:"Chapter label used for translations that add a word such as 'Chapter' before chapter numbers (e.g. Psalms). The subsequent text is the chapter label.",hasEndMarker:!1,children:void 0},cd:{category:T.DivisionMarks,type:S.Paragraph,description:"Chapter Description (Publishing option D, e.g. in Russian Bibles)",hasEndMarker:!1,children:{DivisionMarks:["vp"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},v:{category:T.DivisionMarks,type:S.Character,description:"A verse number",hasEndMarker:!1,children:void 0},va:{category:T.DivisionMarks,type:S.Character,description:"Second (alternate) verse number (for coding dual numeration in Psalms; see also NRSV Exo 22.1-4)",hasEndMarker:!0,children:void 0},vp:{category:T.DivisionMarks,type:S.Character,description:"Published verse marker (verse string that should appear in the published text)",hasEndMarker:!0,children:void 0},p:{category:T.Paragraphs,type:S.Paragraph,description:"Paragraph text, with first line indent (basic)",hasEndMarker:!1,children:{Paragraphs:["pmo","pm","pmc","pmr"],Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},m:{category:T.Paragraphs,type:S.Paragraph,description:"Paragraph text, with no first line indent (may occur after poetry) (basic)",hasEndMarker:!1,children:{Paragraphs:["pmo","pm","pmc","pmr"],Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},po:{category:T.Paragraphs,type:S.Paragraph,description:"Letter opening",hasEndMarker:!1,children:{Paragraphs:["pmo","pm","pmc","pmr"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pr:{category:T.Paragraphs,type:S.Paragraph,description:"Text refrain (paragraph text, right aligned)",hasEndMarker:!1,children:{Paragraphs:["pmo","pm","pmc","pmr"],Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},cls:{category:T.Paragraphs,type:S.Paragraph,description:"Letter Closing",hasEndMarker:!1,children:{SpecialText:["tl","sig","pn","png","addpn","add"]}},pmo:{category:T.Paragraphs,type:S.Paragraph,description:"Embedded text opening",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pm:{category:T.Paragraphs,type:S.Paragraph,description:"Embedded text paragraph",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pmc:{category:T.Paragraphs,type:S.Paragraph,description:"Embedded text closing",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pmr:{category:T.Paragraphs,type:S.Paragraph,description:"Embedded text refrain (e.g. Then all the people shall say, 'Amen!')",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pi:{category:T.Paragraphs,type:S.Paragraph,description:"Paragraph text, level 1 indent (if single level), with first line indent; often used for discourse (basic)",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pi1:{category:T.Paragraphs,type:S.Paragraph,description:"Paragraph text, level 1 indent (if multiple levels), with first line indent; often used for discourse",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pi2:{category:T.Paragraphs,type:S.Paragraph,description:"Paragraph text, level 2 indent, with first line indent; often used for discourse",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pi3:{category:T.Paragraphs,type:S.Paragraph,description:"Paragraph text, level 3 indent, with first line indent; often used for discourse",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pc:{category:T.Paragraphs,type:S.Paragraph,description:"Paragraph text, centered (for Inscription)",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},mi:{category:T.Paragraphs,type:S.Paragraph,description:"Paragraph text, indented, with no first line indent; often used for discourse",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},nb:{category:T.Paragraphs,type:S.Paragraph,description:"Paragraph text, with no break from previous paragraph text (at chapter boundary) (basic)",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q:{category:T.Poetry,type:S.Paragraph,description:"Poetry text, level 1 indent (if single level)",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q1:{category:T.Poetry,type:S.Paragraph,description:"Poetry text, level 1 indent (if multiple levels) (basic)",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q2:{category:T.Poetry,type:S.Paragraph,description:"Poetry text, level 2 indent (basic)",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q3:{category:T.Poetry,type:S.Paragraph,description:"Poetry text, level 3 indent",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q4:{category:T.Poetry,type:S.Paragraph,description:"Poetry text, level 4 indent",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qc:{category:T.Poetry,type:S.Paragraph,description:"Poetry text, centered",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qr:{category:T.Poetry,type:S.Paragraph,description:"Poetry text, Right Aligned",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qs:{category:T.Poetry,type:S.Character,description:"Poetry text, Selah",hasEndMarker:!0,children:{Footnotes:["f"],CrossReferences:["x"]}},qa:{category:T.Poetry,type:S.Paragraph,description:"Poetry text, Acrostic marker/heading",hasEndMarker:!1,children:void 0},qac:{category:T.Poetry,type:S.Character,description:"Poetry text, Acrostic markup of the first character of a line of acrostic poetry",hasEndMarker:!0,children:void 0},qm:{category:T.Poetry,type:S.Paragraph,description:"Poetry text, embedded, level 1 indent (if single level)",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qm1:{category:T.Poetry,type:S.Paragraph,description:"Poetry text, embedded, level 1 indent (if multiple levels)",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qm2:{category:T.Poetry,type:S.Paragraph,description:"Poetry text, embedded, level 2 indent",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qm3:{category:T.Poetry,type:S.Paragraph,description:"Poetry text, embedded, level 3 indent",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qd:{category:T.Poetry,type:S.Paragraph,description:"A Hebrew musical performance annotation, similar in content to Hebrew descriptive title.",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},b:{category:T.Poetry,type:S.Paragraph,description:"Poetry text stanza break (e.g. stanza break) (basic)",hasEndMarker:!1,children:void 0},mt:{category:T.TitlesHeadings,type:S.Paragraph,description:"The main title of the book (if single level)",hasEndMarker:!1,children:{Footnotes:["f"],CrossReferences:["x"]}},mt1:{category:T.TitlesHeadings,type:S.Paragraph,description:"The main title of the book (if multiple levels) (basic)",hasEndMarker:!1,children:{Footnotes:["f"],CrossReferences:["x"]}},mt2:{category:T.TitlesHeadings,type:S.Paragraph,description:"A secondary title usually occurring before the main title (basic)",hasEndMarker:!1,children:{Footnotes:["f"],CrossReferences:["x"]}},mt3:{category:T.TitlesHeadings,type:S.Paragraph,description:"A secondary title occurring after the main title",hasEndMarker:!1,children:{Footnotes:["f"],CrossReferences:["x"]}},mt4:{category:T.TitlesHeadings,type:S.Paragraph,description:"A small secondary title sometimes occurring within parentheses",hasEndMarker:!1,children:void 0},mte:{category:T.TitlesHeadings,type:S.Paragraph,description:"The main title of the book repeated at the end of the book, level 1 (if single level)",hasEndMarker:!1,children:void 0},mte1:{category:T.TitlesHeadings,type:S.Paragraph,description:"The main title of the book repeated at the end of the book, level 1 (if multiple levels)",hasEndMarker:!1,children:{TitlesHeadings:["mte2"]}},mte2:{category:T.TitlesHeadings,type:S.Paragraph,description:"A secondary title occurring before or after the 'ending' main title",hasEndMarker:!1,children:void 0},ms:{category:T.TitlesHeadings,type:S.Paragraph,description:"A major section division heading, level 1 (if single level) (basic)",hasEndMarker:!1,children:{TitlesHeadings:["mr"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},ms1:{category:T.TitlesHeadings,type:S.Paragraph,description:"A major section division heading, level 1 (if multiple levels)",hasEndMarker:!1,children:{TitlesHeadings:["mr"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},ms2:{category:T.TitlesHeadings,type:S.Paragraph,description:"A major section division heading, level 2",hasEndMarker:!1,children:{TitlesHeadings:["mr"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},ms3:{category:T.TitlesHeadings,type:S.Paragraph,description:"A major section division heading, level 3",hasEndMarker:!1,children:{TitlesHeadings:["mr"],Footnotes:["f","fe"]}},mr:{category:T.TitlesHeadings,type:S.Paragraph,description:"A major section division references range heading (basic)",hasEndMarker:!1,children:void 0},s:{category:T.TitlesHeadings,type:S.Paragraph,description:"A section heading, level 1 (if single level) (basic)",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},s1:{category:T.TitlesHeadings,type:S.Paragraph,description:"A section heading, level 1 (if multiple levels)",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},s2:{category:T.TitlesHeadings,type:S.Paragraph,description:"A section heading, level 2 (e.g. Proverbs 22-24)",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},s3:{category:T.TitlesHeadings,type:S.Paragraph,description:"A section heading, level 3 (e.g. Genesis 'The First Day')",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},s4:{category:T.TitlesHeadings,type:S.Paragraph,description:"A section heading, level 4",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},sr:{category:T.TitlesHeadings,type:S.Paragraph,description:"A section division references range heading",hasEndMarker:!1,children:void 0},r:{category:T.TitlesHeadings,type:S.Paragraph,description:"Parallel reference(s) (basic)",hasEndMarker:!1,children:void 0},sp:{category:T.TitlesHeadings,type:S.Paragraph,description:"A heading, to identify the speaker (e.g. Job)",hasEndMarker:!1,children:{Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},d:{category:T.TitlesHeadings,type:S.Paragraph,description:"A Hebrew text heading, to provide description (e.g. Psalms)",hasEndMarker:!1,children:{Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},sd:{category:T.TitlesHeadings,type:S.Paragraph,description:"Vertical space used to divide the text into sections, level 1 (if single level)",hasEndMarker:!1,children:void 0},sd1:{category:T.TitlesHeadings,type:S.Paragraph,description:"Vertical space used to divide the text into sections, level 1 (if multiple levels)",hasEndMarker:!1,children:void 0},sd2:{category:T.TitlesHeadings,type:S.Paragraph,description:"Vertical space used to divide the text into sections, level 2",hasEndMarker:!1,children:void 0},sd3:{category:T.TitlesHeadings,type:S.Paragraph,description:"Vertical space used to divide the text into sections, level 3",hasEndMarker:!1,children:void 0},sd4:{category:T.TitlesHeadings,type:S.Paragraph,description:"Vertical space used to divide the text into sections, level 4",hasEndMarker:!1,children:void 0},lh:{category:T.Lists,type:S.Paragraph,description:"List header (introductory remark)",hasEndMarker:!1,children:{Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li:{category:T.Lists,type:S.Paragraph,description:"A list entry, level 1 (if single level)",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li1:{category:T.Lists,type:S.Paragraph,description:"A list entry, level 1 (if multiple levels)",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li2:{category:T.Lists,type:S.Paragraph,description:"A list entry, level 2",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li3:{category:T.Lists,type:S.Paragraph,description:"A list entry, level 3",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li4:{category:T.Lists,type:S.Paragraph,description:"A list entry, level 4",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lf:{category:T.Lists,type:S.Paragraph,description:"List footer (concluding remark)",hasEndMarker:!1,children:{Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim:{category:T.Lists,type:S.Paragraph,description:"An embedded list entry, level 1 (if single level)",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim1:{category:T.Lists,type:S.Paragraph,description:"An embedded list entry, level 1 (if multiple levels)",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim2:{category:T.Lists,type:S.Paragraph,description:"An embedded list entry, level 2",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim3:{category:T.Lists,type:S.Paragraph,description:"An embedded list item, level 3",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim4:{category:T.Lists,type:S.Paragraph,description:"An embedded list entry, level 4",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},litl:{category:T.Lists,type:S.Character,description:"List entry total text",hasEndMarker:!0,children:void 0},lik:{category:T.Lists,type:S.Character,description:"Structured list entry key text",hasEndMarker:!0,children:void 0},liv:{category:T.Lists,type:S.Character,description:"Structured list entry value 1 content (if single value)",hasEndMarker:!0,children:void 0},liv1:{category:T.Lists,type:S.Character,description:"Structured list entry value 1 content (if multiple values)",hasEndMarker:!0,children:void 0},liv2:{category:T.Lists,type:S.Character,description:"Structured list entry value 2 content",hasEndMarker:!0,children:void 0},liv3:{category:T.Lists,type:S.Character,description:"Structured list entry value 3 content",hasEndMarker:!0,children:void 0},liv4:{category:T.Lists,type:S.Character,description:"Structured list entry value 4 content",hasEndMarker:!0,children:void 0},liv5:{category:T.Lists,type:S.Character,description:"Structured list entry value 5 content",hasEndMarker:!0,children:void 0},f:{category:T.Footnotes,type:S.Note,description:"A Footnote text item (basic)",hasEndMarker:!0,children:{Footnotes:["fr","ft","fk","fq","fqa","fl","fw","fp","fv","fdc"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},fe:{category:T.Footnotes,type:S.Note,description:"An Endnote text item",hasEndMarker:!0,children:{Footnotes:["fr","ft","fk","fq","fqa","fl","fw","fp","fv","fdc"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},fr:{category:T.Footnotes,type:S.Character,description:"The origin reference for the footnote (basic)",hasEndMarker:!0,children:void 0},ft:{category:T.Footnotes,type:S.Character,description:"Footnote text, Protocanon (basic)",hasEndMarker:!0,children:void 0},fk:{category:T.Footnotes,type:S.Character,description:"A footnote keyword (basic)",hasEndMarker:!0,children:void 0},fq:{category:T.Footnotes,type:S.Character,description:"A footnote scripture quote or alternate rendering (basic)",hasEndMarker:!0,children:void 0},fqa:{category:T.Footnotes,type:S.Character,description:"A footnote alternate rendering for a portion of scripture text",hasEndMarker:!0,children:void 0},fl:{category:T.Footnotes,type:S.Character,description:"A footnote label text item, for marking or 'labelling' the type or alternate translation being provided in the note.",hasEndMarker:!0,children:void 0},fw:{category:T.Footnotes,type:S.Character,description:"A footnote witness list, for distinguishing a list of sigla representing witnesses in critical editions.",hasEndMarker:!0,children:void 0},fp:{category:T.Footnotes,type:S.Character,description:"A Footnote additional paragraph marker",hasEndMarker:!0,children:void 0},fv:{category:T.Footnotes,type:S.Character,description:"A verse number within the footnote text",hasEndMarker:!0,children:void 0},fdc:{category:T.Footnotes,type:S.Character,description:"Footnote text, applies to Deuterocanon only",hasEndMarker:!0,children:void 0},fm:{category:T.Footnotes,type:S.Character,description:"An additional footnote marker location for a previous footnote",hasEndMarker:!0,children:void 0},x:{category:T.CrossReferences,type:S.Note,description:"A list of cross references (basic)",hasEndMarker:!0,children:{CrossReferences:["xo","xop","xt","xta","xk","xq","xot","xnt","xdc"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},xo:{category:T.CrossReferences,type:S.Character,description:"The cross reference origin reference (basic)",hasEndMarker:!0,children:void 0},xop:{category:T.CrossReferences,type:S.Character,description:"Published cross reference origin reference (origin reference that should appear in the published text)",hasEndMarker:!0,children:void 0},xt:{category:T.CrossReferences,type:S.Character,description:"The cross reference target reference(s), protocanon only (basic)",hasEndMarker:!0,children:void 0},xta:{category:T.CrossReferences,type:S.Character,description:"Cross reference target references added text",hasEndMarker:!0,children:void 0},xk:{category:T.CrossReferences,type:S.Character,description:"A cross reference keyword",hasEndMarker:!0,children:void 0},xq:{category:T.CrossReferences,type:S.Character,description:"A cross-reference quotation from the scripture text",hasEndMarker:!0,children:void 0},xot:{category:T.CrossReferences,type:S.Character,description:"Cross-reference target reference(s), Old Testament only",hasEndMarker:!0,children:void 0},xnt:{category:T.CrossReferences,type:S.Character,description:"Cross-reference target reference(s), New Testament only",hasEndMarker:!0,children:void 0},xdc:{category:T.CrossReferences,type:S.Character,description:"Cross-reference target reference(s), Deuterocanon only",hasEndMarker:!0,children:void 0},rq:{category:T.CrossReferences,type:S.Character,description:"A cross-reference indicating the source text for the preceding quotation.",hasEndMarker:!0,children:void 0},qt:{category:T.SpecialText,type:S.Character,description:"For Old Testament quoted text appearing in the New Testament (basic)",hasEndMarker:!0,children:void 0},nd:{category:T.SpecialText,type:S.Character,description:"For name of deity (basic)",hasEndMarker:!0,children:void 0},tl:{category:T.SpecialText,type:S.Character,description:"For transliterated words",hasEndMarker:!0,children:void 0},dc:{category:T.SpecialText,type:S.Character,description:"Deuterocanonical/LXX additions or insertions in the Protocanonical text",hasEndMarker:!0,children:void 0},bk:{category:T.SpecialText,type:S.Character,description:"For the quoted name of a book",hasEndMarker:!0,children:void 0},sig:{category:T.SpecialText,type:S.Character,description:"For the signature of the author of an Epistle",hasEndMarker:!0,children:void 0},pn:{category:T.SpecialText,type:S.Character,description:"For a proper name",hasEndMarker:!0,children:void 0},png:{category:T.SpecialText,type:S.Character,description:"For a geographic proper name",hasEndMarker:!0,children:void 0},addpn:{category:T.SpecialText,type:S.Character,description:"For chinese words to be dot underline & underline",hasEndMarker:!0,children:void 0},wj:{category:T.SpecialText,type:S.Character,description:"For marking the words of Jesus",hasEndMarker:!0,children:void 0},k:{category:T.SpecialText,type:S.Character,description:"For a keyword",hasEndMarker:!0,children:void 0},sls:{category:T.SpecialText,type:S.Character,description:"To represent where the original text is in a secondary language or from an alternate text source",hasEndMarker:!0,children:void 0},ord:{category:T.SpecialText,type:S.Character,description:"For the text portion of an ordinal number",hasEndMarker:!0,children:void 0},add:{category:T.SpecialText,type:S.Character,description:"For a translational addition to the text",hasEndMarker:!0,children:void 0},lit:{category:T.SpecialText,type:S.Paragraph,description:"For a comment or note inserted for liturgical use",hasEndMarker:!1,children:void 0},no:{category:T.CharacterStyling,type:S.Character,description:"A character style, use normal text",hasEndMarker:!0,children:void 0},it:{category:T.CharacterStyling,type:S.Character,description:"A character style, use italic text",hasEndMarker:!0,children:void 0},bd:{category:T.CharacterStyling,type:S.Character,description:"A character style, use bold text",hasEndMarker:!0,children:void 0},bdit:{category:T.CharacterStyling,type:S.Character,description:"A character style, use bold + italic text",hasEndMarker:!0,children:void 0},em:{category:T.CharacterStyling,type:S.Character,description:"A character style, use emphasized text style",hasEndMarker:!0,children:void 0},sc:{category:T.CharacterStyling,type:S.Character,description:"A character style, for small capitalization text",hasEndMarker:!0,children:void 0},sup:{category:T.CharacterStyling,type:S.Character,description:"A character style, for superscript text. Typically for use in critical edition footnotes.",hasEndMarker:!0,children:void 0},pb:{category:T.Breaks,type:S.Paragraph,description:"Page Break used for new reader portions and children's bibles where content is controlled by the page",hasEndMarker:!1,children:void 0}},An={DivisionMarks:{add:["v","c"],remove:[]},Paragraphs:{add:["p"],remove:[]},Poetry:{add:["q","q1","q2","q3","q4","b"],remove:[]},TitlesHeadings:{add:["mte","ms","ms1","ms2","ms3","s","s1","s2","s3","s4","r","sp","d","sd","sd1","sd2","sd3","sd4"],remove:[]}},Y_={p:{children:An},q:{children:An},q1:{children:An},q2:{children:An},q3:{children:An},q4:{children:An},b:{children:An},qm:{children:{Paragraphs:{add:["p"],remove:[]}}},c:{type:S.Paragraph,children:null},v:{children:null}};function Jc(t){const e=G_[t],n=Y_[t];if(!e)return;if(!n)return e;let r=e.children?{...e.children}:void 0;if(n.children===null&&(r=void 0),n.children){r=r||{};for(const[s,i]of Object.entries(n.children)){const o=s;if(i===null)Reflect.deleteProperty(r,o);else{let a=r[o]||[];i.remove&&(a=a.filter(l=>!i.remove.includes(l))),i.add&&(a=[...new Set([...a,...i.add])]),a.length>0?r[o]=a:Reflect.deleteProperty(r,o)}}Object.keys(r).length===0&&(r=void 0)}return{...e,...n,children:r}}function Vc(t,e,n){const r={type:ss,version:is,content:t},s=e.serializeEditorState(r,n);return fl(s.root.children[0])?s.root.children[0].children[0]:s.root.children[0]}function Pa(t,e){if(!t||!ee(t))return[void 0,void 0];const n=t.getTextContent();if(e>=0&&e<n.length)return[t,e];let r=t.getNextSibling();if(!r){const i=t.getParent();Ee(i)&&(r=i.getNextSibling())}if(!r||!Ee(r)&&!ee(r))return[void 0,void 0];const s=e-n.length;return r&&ee(r)?Pa(r,s):Pa(r.getFirstChild()??void 0,s)}function Gc(t){const e=ep(t.jsonPath);let n=$t();for(const r of e){if(!n||!we(n))return[void 0,void 0];n=n.getChildAtIndex(r)??void 0}return Pa(n,t.offset)}function Yc(t){return we(t)?"element":"text"}function xl(t){const{start:e}=t;let{end:n}=t;n===void 0&&(n=e);const[r,s]=Gc(e),[i,o]=Gc(n);if(!r||!i||s===void 0||o===void 0)return;const a=Md();return a.anchor=Ul(r.getKey(),s,Yc(r)),a.focus=Ul(i.getKey(),o,Yc(i)),a}function Xc(t,e){const n=[];let r=t;for(;r!=null&&r.getParent();){const s=r.getParent();if(s){const i=s==null?void 0:s.getChildren().indexOf(r);i>=0&&n.unshift(i)}r=s}return{jsonPath:tp(n),offset:e}}function mf(){const t=re();if(!t||!X(t))return;const e=t.isBackward()?t.focus.getNode():t.anchor.getNode(),n=t.isBackward()?t.focus.offset:t.anchor.offset,r=Xc(e,n);if(t.isCollapsed())return{start:r};const s=t.isBackward()?t.anchor.getNode():t.focus.getNode(),i=t.isBackward()?t.anchor.offset:t.focus.offset,o=Xc(s,i);return{start:r,end:o}}const yf="v",bf=1;class Ye extends br{constructor(e="",n=!1,r,s,i,o,a){super(a),z(this,"__marker"),z(this,"__number"),z(this,"__showMarker"),z(this,"__sid"),z(this,"__altnumber"),z(this,"__pubnumber"),z(this,"__unknownAttributes"),this.__marker=yf,this.__number=e,this.__showMarker=n,this.__sid=r,this.__altnumber=s,this.__pubnumber=i,this.__unknownAttributes=o}static getType(){return"immutable-verse"}static clone(e){const{__number:n,__showMarker:r,__sid:s,__altnumber:i,__pubnumber:o,__unknownAttributes:a,__key:l}=e;return new Ye(n,r,s,i,o,a,l)}static importDOM(){return{span:e=>Z_(e)?{conversion:X_,priority:1}:null}}static importJSON(e){return Cl().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setNumber(e.number).setShowMarker(e.showMarker).setSid(e.sid).setAltnumber(e.altnumber).setPubnumber(e.pubnumber).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const n=this.getWritable();return n.__marker=e,n}getMarker(){return this.getLatest().__marker}setNumber(e){if(this.__number===e)return this;const n=this.getWritable();return n.__number=e,n}getNumber(){return this.getLatest().__number}setShowMarker(e=!1){if(this.__showMarker===e)return this;const n=this.getWritable();return n.__showMarker=e,n}getShowMarker(){return this.getLatest().__showMarker}setSid(e){if(this.__sid===e)return this;const n=this.getWritable();return n.__sid=e,n}getSid(){return this.getLatest().__sid}setAltnumber(e){if(this.__altnumber===e)return this;const n=this.getWritable();return n.__altnumber=e,n}getAltnumber(){return this.getLatest().__altnumber}setPubnumber(e){if(this.__pubnumber===e)return this;const n=this.getWritable();return n.__pubnumber=e,n}getPubnumber(){return this.getLatest().__pubnumber}setUnknownAttributes(e){const n=this.getWritable();return n.__unknownAttributes=e,n}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("span");return e.setAttribute("data-marker",this.__marker),e.classList.add(Oa,`usfm_${this.__marker}`),this.__showMarker&&e.classList.add("marker"),e.setAttribute("data-number",this.__number),e}updateDOM(){return!1}exportDOM(e){const{element:n}=super.exportDOM(e);return n&&gn(n)&&(n.setAttribute("data-marker",this.getMarker()),n.classList.add(Oa,`usfm_${this.getMarker()}`),n.setAttribute("data-number",this.getNumber())),{element:n}}decorate(){return m.jsx("span",{children:this.getShowMarker()?Ts(this.getMarker(),this.getNumber()):Ea+this.getNumber()+Ea})}exportJSON(){return{type:this.getType(),marker:this.getMarker(),number:this.getNumber(),showMarker:this.getShowMarker(),sid:this.getSid(),altnumber:this.getAltnumber(),pubnumber:this.getPubnumber(),unknownAttributes:this.getUnknownAttributes(),version:bf}}isKeyboardSelectable(){return!1}}function X_(t){const e=t.getAttribute("data-number")??"0";return{node:Cl(e)}}function Cl(t,e,n,r,s,i){return Ne(new Ye(t,e,n,r,s,i))}function Z_(t){return((t==null?void 0:t.getAttribute("data-marker"))??void 0)===yf}function Cr(t){return t instanceof Ye}function Q_(t){return(t==null?void 0:t.type)===Ye.getType()}function ct(t){return ml(t)||Cr(t)}function ek(t){return k_(t)||Q_(t)}function tk(t,e,n,r,s,i,o){if(!Pe.isValidMarker(t))throw new Error(`$insertNote: Invalid note marker '${t}'`);const a=n?xl(n):re();if(!X(a))return;const l=nk(a,t,r,o);if(l===void 0)return;const u=kf(t,e,l,s,i);return _f(u,a,s),u}function _f(t,e,n){const r=(n==null?void 0:n.noteMode)==="collapsed";if(t.setIsCollapsed(r),e.isCollapsed()||M_(e),e.insertNodes([t]),!r){const s=t.getChildren().reverse().find(pe);s==null||s.selectEnd()}}function nk(t,e,n,r){const s=[],{chapterNum:i,verseNum:o}=n??{};switch(e){case"f":case"fe":case"ef":case"efe":if(i!==void 0&&o!==void 0&&s.push(gt("fr").append(ve(`${i}:${o}`))),!t.isCollapsed()){const a=t.getTextContent().trim();if(a.length>0){const l=gt("fq").append(ve(a));s.push(l)}}s.push(gt("ft").append(ve(Xt)));break;case"x":case"ex":if(i!==void 0&&o!==void 0&&s.push(gt("xo").append(ve(`${i}:${o}`))),!t.isCollapsed()){const a=t.getTextContent().trim();if(a.length>0){const l=gt("xq").append(ve(a));s.push(l)}}s.push(gt("xt").append(ve(Xt)));break;default:r==null||r.warn(`$createNoteChildren: Unsupported note marker '${e}'`);return}return s}function kf(t,e,n,r,s,i){const o=(r==null?void 0:r.noteMode)!=="expanded",a=gl(t,e,o);i&&Jt(a,Pn,()=>i);let l,u;(r==null?void 0:r.markerMode)==="editable"?(l=pr(t),u=pr(t,"closing")):(r==null?void 0:r.markerMode)==="visible"&&(l=gr("marker",tn(t)+me),u=gr("marker",fr(t)+me));let d;if(l&&a.append(l),(r==null?void 0:r.markerMode)==="editable")e===""?a.append(...n):(d=ve(_l(a.__caller)),a.append(d,...n));else{const f=()=>ve(me),h=n.flatMap(sk(f));if(e==="")a.append(...h);else{const p=kl(n);let y=()=>{};s!=null&&s.noteCallerOnClick&&(y=s.noteCallerOnClick),d=Ol(a.__caller,p,y),a.append(d,f(),...h)}}return u&&a.append(u),a}function Zc(t){var e;if(typeof t=="string"){const s=Te(t);return oe(s)?s:void 0}const n=bs();if(n.length<=0)return;const r=(e=n.filter(s=>oe(s.node))[t])==null?void 0:e.node;if(oe(r))return r}function rk(t,e){const n=(e==null?void 0:e.noteMode)==="collapsed";if(t.setIsCollapsed(n),n){const r=t.getPreviousSibling();if(Cr(r)||!r){const s=t.getParent();if(s){const i=t.getIndexWithinParent();s.select(i,i)}}else r.selectEnd()}else{const r=t.getChildren().reverse().find(pe);r==null||r.selectEnd()}}function sk(t){return e=>Li(e)?[e]:[e,t()]}function ik(t){return t.find(e=>Ke(e))}function ok(t,e){return we(t)?t.getChildren().find(n=>ct(n)&&vl(e,n.getNumber())):void 0}function ak(t,e){return e===0?ik(t):t.map(n=>ok(n,e)).filter(n=>n)[0]}function Qc(t){return!t||!we(t)?void 0:t.getChildren().findLast(e=>ct(e))}function vf(t){var e,n;if(!t||lt(t))return;if(ct(t))return t;let r=Ee(t.getParent())?(e=t.getParent())==null?void 0:e.getPreviousSibling():t.getPreviousSibling();for(;r&&!ct(r)&&!lt(r);)r=r.getPreviousSibling();if(r&&ct(r))return r;let s=(n=t.getTopLevelElement())==null?void 0:n.getPreviousSibling(),i=Qc(s),o=i;for(;s&&!i&&!lt(s);)i=o,s=s.getPreviousSibling(),o=Qc(s);if(!(!i&&lt(s)))return i}function lk(t){return C_(t)||Cr(t)}function Sl(t){if(ee(t)){const e=t.getTextContent();!e.endsWith(" ")&&!e.endsWith(me)&&t.setTextContent(`${e} `)}}function wf(t){if(ee(t)){const e=t.getTextContent();e.startsWith(" ")&&t.setTextContent(e.trimStart())}}function Tl(t,e){return t.getEditorState().read(()=>!Te(e))}const ck=["style"],uk=["style","code"],Ui=["style","cid"],dk=["style","number","sid","altnumber","pubnumber"],hk=["style","number","sid","altnumber","pubnumber"],fk=["style","sid","eid"],pk=["style","caller","category","contents"],gk=["chapter","immutable-chapter","verse","immutable-verse","ms","note","unmatched"],ms=`
`;function mk(t,e){const n=Te(t);if(!vt(n))return;const r=xf(n);return r===void 0?void 0:[{retain:r},...e,{delete:1}]}function xf(t){if(!t)return;const e=bs();let n=0;const r=[];let s,i;const o=t.getKey();let a;for(const l of e){const u=l.node;for(let d=r.length-1;d>=0;d--)if(ys(r[d],l)){const f=r[d];if(r.splice(d,1),n+=1,a&&f.getKey()===a.getKey())return n-1}if(s&&ys(s,l)&&(s=void 0,i=void 0),s){if(u.getKey()===o)return i;continue}if(u.getKey()===o){if(ee(u)||vt(u))return n;dt(u)&&(a=u)}if(dt(u)&&(r.includes(u)||r.push(u)),oe(u)){s=u,i=n,n+=1;continue}n+=Cf(u)}if(a)return n}function eu(t,e){if(t.length<2||!_k(t[0])||!bk(t[1]))return;const n=t[0].retain;return e.read(()=>{const r=yk(n);return r==null?void 0:r.getKey()})}function yk(t){const e=bs();let n=0;const r=[];let s,i;for(const o of e){const a=o.node;for(let u=r.length-1;u>=0;u--)if(ys(r[u],o)){const d=r[u];if(r.splice(u,1),n===t)return d;n+=1}if(s&&ys(s,o)&&(s=void 0,i=void 0),s){if(i===t)return s;continue}if(dt(a)&&(r.includes(a)||r.push(a)),oe(a)){if(s=a,i=n,n===t)return a;n+=1;continue}const l=Cf(a);if(ee(a)&&l>0&&t>=n&&t<n+l||vt(a)&&n===t)return a;n+=l}for(const o of r){if(n===t)return o;n+=1}}function ys(t,e){return t?e?!E_(e.node,t.getKey()):!0:!1}function vt(t){return lt(t)||ct(t)||to(t)||oe(t)||gf(t)}function dt(t){return bt(t)||It(t)}function Kt(t,e){return(e==null?void 0:e.insert)!=null&&typeof e.insert=="object"&&t in e.insert}function bk(t){if(t.insert==null||typeof t.insert!="object")return!1;const e=Object.keys(t.insert)[0];return t.insert!=null&&typeof t.insert=="object"&&e in t.insert&&gk.includes(e)}function _k(t){return t.retain!=null&&typeof t.retain=="number"}function Cf(t){return ee(t)?t.getTextContentSize():vt(t)?1:0}function $a(t,e){const n={insert:t.__text},r=vs(t,Pn);if(r&&(n.attributes={segment:r}),e&&e.length>0){const s=Sf(e);s&&(n.attributes={...n.attributes,char:s})}return n}function tu(t){const e=new Gr;return t.isEmpty()||t.read(()=>{const n=$t();if(!n||n.isEmpty())return;const r=n.getChildren();if(r.length===1&&Zt(r[0])&&(!r[0].getChildren()||r[0].getChildrenSize()===0))return;const s=kk();for(const i of s)e.push(i)}),e}function El(t,e){const n=[],r=bs(t),s=[],i=[],o={children:[],contentsOps:[]},a=new Set;for(let l=0;l<r.length;l++){const u=r[l].node;n.push(...nu(u,l,r,s,i,o,a))}for(const l of s)n.push(...nu(l,r.length,r,s,i,o,a));return n}function kk(){return El()}function nu(t,e,n,r,s,i,o){if(!t)return[];const a=[];return vk(t,a,r),wk(t,a,s,i,o),xk(t,e,n,s,o,i,a),lt(t)&&a.push(Tk(t)),ct(t)&&a.push(Ok(t)),to(t)&&a.push(Mk(t)),gf(t)&&a.push(Ak(t)),Ck(t,a,i),a}function vk(t,e,n){if(!t.isInline()){const r=n.pop();It(r)?e.push(Sk(r)):Ke(r)?e.push(Ek(r)):Zt(r)&&e.push({insert:ms})}dt(t)&&(n.includes(t)||n.push(t))}function wk(t,e,n,r,s){var i;if(!ee(t))return;const o=t.getParent();if(oe(o)&&o.getFirstChild()===t)return;const a=t.getTextContent(),l=a.startsWith(cl),u=pe(o)?o:void 0,d=!!u&&a===Xt&&u.getChildrenSize()===1,f=$a(t,n);if(r.children.includes(t)){if(!a||a===me||l)return;(i=r.contentsOps)==null||i.push(f)}else d||l&&u||e.push(f);const h=a!==""&&!d&&!(l&&u);if(n.length>0&&h)for(const p of n)s.add(p)}function xk(t,e,n,r,s,i,o){var a;pe(t)&&!r.includes(t)&&r.push(t);const l=n[e+1];for(const u of r.toReversed())if(ys(u,l)){if(r.pop(),!s.has(u)){const d=Nk(u);i.children.includes(u)?(a=i.contentsOps)==null||a.push(d):o.push(d)}s.delete(u)}}function Ck(t,e,n){var r,s;if(!oe(t))return;bs(t).forEach(o=>n.children.push(o.node));const i=jk(t);n.contentsOps=(s=(r=i.insert.note)==null?void 0:r.contents)==null?void 0:s.ops,e.push(i)}function Sk(t){const e={style:fs,code:t.__code};return{insert:ms,attributes:{book:e}}}function Tk(t){const e={style:$i,number:t.__number};return t.__sid&&(e.sid=t.__sid),t.__altnumber&&(e.altnumber=t.__altnumber),t.__pubnumber&&(e.pubnumber=t.__pubnumber),{insert:{chapter:e}}}function Ek(t){const e={style:t.__marker};return{insert:ms,attributes:{para:e}}}function Ok(t){const e={style:qi,number:t.__number};return t.__sid&&(e.sid=t.__sid),t.__altnumber&&(e.altnumber=t.__altnumber),t.__pubnumber&&(e.pubnumber=t.__pubnumber),{insert:{verse:e}}}function Mk(t){const e={style:t.__marker};return t.__sid&&(e.sid=t.__sid),t.__eid&&(e.eid=t.__eid),{insert:{milestone:e}}}function Ak(t){return{insert:{unmatched:{marker:t.__marker}}}}function jk(t){const e={style:t.__marker,caller:t.__caller};t.__category&&(e.category=t.__category),t.getChildrenSize()>1&&(e.contents={ops:[]});const n={insert:{note:e}},r=vs(t,Pn);return r&&(n.attributes={segment:r}),n}function Nk(t){const e={insert:""},n=Sf([t]);return n&&(e.attributes={char:n}),e}function Sf(t){if(t.length===0)return;const e=t.map(Ik);return e.length===1?e[0]:e}function Ik(t){const e={style:t.__marker},n=vs(t,Rn);n&&(e.cid=n);const r=t.getUnknownAttributes();return r&&Object.keys(r).length>0&&Object.assign(e,r),e}const Tf=1;class kt extends br{constructor(e=Rt,n="",r,s){super(s),z(this,"__caller"),z(this,"__previewText"),z(this,"__onClick"),this.__caller=e,this.__previewText=n,this.__onClick=r??(()=>{})}static getType(){return"immutable-note-caller"}static clone(e){const{__caller:n,__previewText:r,__onClick:s,__key:i}=e;return new kt(n,r,s,i)}static importDOM(){return{span:e=>Pk(e)?{conversion:Rk,priority:1}:null}}static importJSON(e){return Ol().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setCaller(e.caller).setPreviewText(e.previewText).setOnClick(e.onClick)}setCaller(e){if(this.__caller===e)return this;const n=this.getWritable();return n.__caller=e,n}getCaller(){return this.getLatest().__caller}setPreviewText(e){if(this.__previewText===e)return this;const n=this.getWritable();return n.__previewText=e,n}getPreviewText(){return this.getLatest().__previewText}setOnClick(e){if(this.__onClick===e)return this;const n=this.getWritable();return n.__onClick=e,n}getOnClick(){return this.getLatest().__onClick}createDOM(){const e=document.createElement("span");return e.classList.add(this.__type),e.setAttribute("data-caller",this.__caller),e.setAttribute("data-preview-text",this.__previewText),e}updateDOM(e){return e.__caller!==this.__caller}exportDOM(e){const{element:n}=super.exportDOM(e);return n&&gn(n)&&(n.classList.add(this.getType()),n.setAttribute("data-caller",this.getCaller()),n.setAttribute("data-preview-text",this.getPreviewText())),{element:n}}decorate(e){const n=this.getParent();if(!n)return null;const r=n.getKey(),s=n.getIsCollapsed(),i=this.__key,o=l=>{var u;return(u=this.__onClick)==null?void 0:u.call(this,l,r,s,()=>$k(e,r),d=>qk(e,r,i,d),()=>Dk(e,r))},a=`${this.__caller}_${this.__previewText}}`.replace(/\s+/g,"").substring(0,25);return m.jsx("button",{onClick:o,title:this.__previewText,"data-caller-id":a,children:this.__caller===Rt&&s?"":this.__caller})}exportJSON(){return{type:this.getType(),caller:this.getCaller(),previewText:this.getPreviewText(),onClick:this.getOnClick(),version:Tf}}isKeyboardSelectable(){return!1}}function Rk(t){const e=t.getAttribute("data-caller")??"",n=t.getAttribute("data-preview-text")??"";return{node:Ol(e,n)}}function Ol(t,e,n){return Ne(new kt(t,e,n))}function Pk(t){return t?t.classList.contains(kt.getType()):!1}function kn(t){return t instanceof kt}function $k(t,e){return t.read(()=>{const n=Te(e);if(!oe(n))throw new Error(`getNoteCaller: Note node not found: ${e}`);return n.getCaller()})}function qk(t,e,n,r){t.update(()=>{const s=Te(e);if(!oe(s))throw new Error(`setNoteCaller: Note node not found: ${e}`);s.setCaller(r);const i=Te(n);if(!kn(i))throw new Error(`setNoteCaller: Caller node not found: ${n}`);i.setCaller(r)})}function Dk(t,e){return t.read(()=>{const n=Te(e);if(!oe(n))throw new Error(`getNoteOps: Note node not found: ${e}`);return El(n)})}const Lk=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],Fk=[kt,Ye,...V_],Uk=_.forwardRef((t,e)=>{const{coords:n,children:r,style:s,...i}=t,o=n!==void 0;return m.jsx("div",{ref:e,className:"floating-box","aria-hidden":!o,style:{...s,position:"absolute",zIndex:1e3,top:n==null?void 0:n.y,left:n==null?void 0:n.x,visibility:o?"visible":"hidden",opacity:o?1:0},...i,children:r})});function Bk(){const[t,e]=_.useState(void 0),[n,r]=_.useState(),s=_.useRef(null),i=_.useCallback((a,l)=>{s.current&&s.current();const u=a.commonAncestorContainer.nodeType===a.commonAncestorContainer.TEXT_NODE?a:a.commonAncestorContainer;s.current=Wp(u,l,()=>{zp(u,l,{placement:"bottom-start",middleware:[Kp(),Jp()]}).then(d=>{r(d.placement),e(f=>(f==null?void 0:f.x)===d.x&&(f==null?void 0:f.y)===d.y?f:{x:d.x,y:d.y})}).catch(()=>{e(void 0)})})},[]),o=_.useCallback(()=>{s.current&&(e(void 0),s.current(),s.current=null)},[]);return _.useEffect(()=>o,[o]),{coords:t,placement:n,updatePosition:i,cleanup:o}}function Hk({isOpen:t,floatingBoxRef:e}){const{coords:n,updatePosition:r,cleanup:s,placement:i}=Bk();return _.useEffect(()=>{var o;if(!t||!e.current){s();return}const a=(o=window.getSelection())==null?void 0:o.getRangeAt(0);if(!a){s();return}return r(a,e.current),s},[s,t,e,r]),{coords:n,placement:i}}const Wk=document.body,zk=_.memo(Uk);function Kk({isOpen:t=!1,children:e}){const n=_.useRef(null),{coords:r,placement:s}=Hk({isOpen:t,floatingBoxRef:n}),i=_.useMemo(()=>r?typeof e=="function"?e:()=>e:()=>null,[e,r]);return yt.createPortal(m.jsx(zk,{ref:n,coords:r,style:r?void 0:{display:"none"},children:i({isOpen:t,placement:s})}),Wk)}const Ef=_.createContext(void 0);function Ml(){const t=_.useContext(Ef);if(!t)throw new Error("useMenuContext must be used within a MenuProvider");return t}function Jk(t,e){const[n,r]=_.useState(0),[s,i]=_.useState(-1),o=_.useMemo(()=>t??[],[t]),a={menuItems:o,activeIndex:n,selectedIndex:s,onSelectOption:e??(()=>{})},l=_.useCallback(()=>{r(f=>{const h=o.length;return h?(f-1+h)%h:0})},[o.length]),u=_.useCallback(()=>{r(f=>{const h=o.length;return h?(f+1)%h:0})},[o.length]),d=_.useCallback(()=>{const f=o.length;if(n>=0&&n<f){const h=o[n];e==null||e(h),i(n)}},[n,o,e]);return{state:a,moveUp:l,moveDown:u,select:d,setActiveIndex:r,setSelectedIndex:i}}function Vk({children:t,menuItems:e,onSelectOption:n,...r}){const s=Jk(e,n);return m.jsx(Ef.Provider,{value:s,children:m.jsx("div",{...r,children:t})})}const Of=_.forwardRef(({index:t,children:e,onMouseEnter:n,onClick:r,...s},i)=>{const{state:{activeIndex:o},setActiveIndex:a,setSelectedIndex:l,select:u}=Ml(),d=_.useCallback(h=>{u(),l(-1),r==null||r(h)},[r,u,l]),f=_.useCallback(h=>{a(t),n==null||n(h)},[t,a,n]);return m.jsx("button",{ref:i,role:"menuitem",...s,onClick:d,onMouseEnter:f,"aria-selected":t!==void 0&&o===t?"true":void 0,tabIndex:-1,children:e})});function Gk({children:t,autoIndex:e=!0,...n}){const r=_.useRef(null),{state:{activeIndex:s,menuItems:i}}=Ml(),o=_.useMemo(()=>i?typeof t=="function"?t:()=>t:()=>null,[t,i]),a=_.useMemo(()=>{const l=o(i);return e?_.Children.map(l,(u,d)=>_.isValidElement(u)&&u.type===Of&&u.props.index===void 0?_.cloneElement(u,{index:d}):u):l},[o,e,i]);return _.useEffect(()=>{if(r.current){const l=r.current,u=l.children[s];if(u){const d=l.getBoundingClientRect(),f=u.getBoundingClientRect();f.bottom>d.bottom?l.scrollTop+=f.bottom-d.bottom:f.top<d.top&&(l.scrollTop-=d.top-f.top)}}},[s]),m.jsx("div",{ref:r,role:"menu",...n,children:a})}const aa={Root:Vk,Options:Gk,Option:Of},Yk=(t,e,n)=>Ei(t,n).toLowerCase().includes(e.toLowerCase()),ru=t=>Object.keys(t).find(e=>typeof t[e]=="string")||"",Ei=(t,e)=>{const n=t[e];return typeof n=="string"?n:String(n)};function Xk(t){const{query:e,items:n,filterBy:r,filter:s,sortBy:i,sortingOptions:o}=t,{caseSensitive:a=!1,priorityOrder:l=["exact","startsWith","contains"]}=o||{},u=a?e:e.toLowerCase();let d,f;s?(f=s,d=n.length>0?ru(n[0]):""):(d=r||(n.length>0?ru(n[0]):""),f=(y,b)=>Yk(y,b,d));const h=i||d,p=new Map;return n.filter(y=>{try{return f(y,e)}catch(b){return console.warn("Error filtering item:",y,b),!1}}).sort((y,b)=>{const C=E=>(p.has(E)||p.set(E,Ei(E,h).toLowerCase()),p.get(E)??""),A=a?Ei(y,h):C(y),v=a?Ei(b,h):C(b);for(const E of l)switch(E){case"exact":if(A===u&&v!==u)return-1;if(v===u&&A!==u)return 1;break;case"startsWith":if(A.startsWith(u)&&!v.startsWith(u))return-1;if(v.startsWith(u)&&!A.startsWith(u))return 1;break;case"contains":{const j=A.indexOf(u),$=v.indexOf(u);if(j!==-1&&$===-1)return-1;if($!==-1&&j===-1)return 1;if(j!==-1&&$!==-1)return j-$;break}}return A.localeCompare(v)})}function Zk(t){const{query:e,items:n,filterBy:r,filter:s,sortBy:i,sortingOptions:o}=t;return _.useMemo(()=>Xk({query:e,items:n,filterBy:r,filter:s,sortBy:i,sortingOptions:o}),[e,n,r,s,i,o])}function Qk(){const{moveUp:t,moveDown:e,select:n}=Ml();return _.useMemo(()=>({moveUp:t,moveDown:e,select:n}),[t,e,n])}const ev=()=>{const t=Qk(),[e]=ce();_.useEffect(()=>{const n=r=>{const s={ArrowDown:()=>t==null?void 0:t.moveDown(),ArrowUp:()=>t==null?void 0:t.moveUp(),Enter:()=>t==null?void 0:t.select(),Tab:()=>t==null?void 0:t.select()}[r.key];return s?(s(),r.preventDefault(),r.stopPropagation(),!0):!1};return e.registerCommand(ks,n,Vi)},[e,t])};function tv(){return ev(),null}function nv(t){const{options:e,onSelectOption:n,onClose:r,inverse:s,query:i,menuOpenKey:o}=t,[a]=ce(),l=i!==void 0,[u,d]=_.useState(""),f=l?i??"":u,h=Zk({query:f,items:e,filterBy:"name"}),p=y=>{r==null||r(),n?n(y):y.action(a)};return _.useEffect(()=>a.registerCommand(ks,y=>{if(l)return!1;const b={Escape:()=>r==null?void 0:r(),Backspace:()=>{f.length===0?r==null||r():d(C=>C.slice(0,-1))}}[y.key];return b?(y.stopPropagation(),y.preventDefault(),b(),!0):y.key.length===1?(y.stopPropagation(),y.preventDefault(),y.key!==o&&d(C=>C+y.key),!0):!1},Vi),[a,l,f,o,r]),m.jsxs(aa.Root,{className:`autocomplete-menu-container ${s?"inverse":""}`,menuItems:h,onSelectOption:y=>p(y),children:[!l&&m.jsx("input",{value:f,type:"text",disabled:!0}),m.jsx(tv,{}),m.jsx(aa.Options,{className:"autocomplete-menu-options",autoIndex:!1,children:y=>y.map((b,C)=>m.jsxs(aa.Option,{index:C,children:[m.jsx("span",{className:"label",children:b.label??b.name}),m.jsx("span",{className:"description",children:b.description})]},b.name))})]})}function rv({trigger:t,items:e}){const[n]=ce(),[r,s]=_.useState(!1),i=_.useCallback(o=>{o.key==="Escape"&&r?(s(!1),n.focus()):o.key===t&&!r&&(o.preventDefault(),s(!0))},[n,t,r]);return _.useEffect(()=>n.registerRootListener(o=>{if(o)return o.addEventListener("keydown",i),()=>{o.removeEventListener("keydown",i)}}),[n,i]),_.useEffect(()=>n.registerUpdateListener(({prevEditorState:o,editorState:a})=>{const l=o.read(()=>{const u=re();if(X(u))return u});a.read(()=>{const u=re();!X(u)||l!=null&&l.is(u)||s(!1)})}),[n]),e&&m.jsx(Kk,{isOpen:r,children:({placement:o})=>m.jsx(nv,{options:e,onClose:()=>s(!1),inverse:o==="top-start",menuOpenKey:t})})}function sv({scriptureReference:t,contextMarker:e,getMarkerAction:n}){return{markersMenuItems:_.useMemo(()=>{if(!e||!t)return;const r=Jc(e);if(r!=null&&r.children)return Object.values(r.children).flatMap(s=>s.map(i=>{const o=Jc(i),{action:a}=n(i,o);return{name:i,label:i,description:(o==null?void 0:o.description)??"",action:l=>{a({editor:l,reference:t})}}}))},[e,n,t])}}function rs(t,e){return`${t}:${e}`}function iv(t,e){_.useEffect(()=>{if(!t.hasNodes([Le]))throw new Error("AnnotationPlugin: TypedMarkNode not registered on editor!");const n=new Map;return Xe(jd(t,Le,r=>gs(r.getTypedIDs(),r.getTypedOnClicks(),r.getTypedOnRemoves()),(r,s)=>{const i=r.getTypedOnClicks(),o=r.getTypedOnRemoves();for(const[a,l]of Object.entries(r.getTypedIDs()))l.forEach(u=>{var d,f;const h=(d=i[a])==null?void 0:d[u],p=(f=o[a])==null?void 0:f[u];s.addID(a,u,h,p)});r.getWritable().__suppressOnRemoveCallbacks=!0}),t.registerMutationListener(Le,r=>{t.getEditorState().read(()=>{for(const[s,i]of r){const o=Te(s);let a={};i==="destroyed"?a=n.get(s)??{}:Ee(o)&&(a=o.getTypedIDs());for(const[l,u]of Object.entries(a))if(!Le.isReservedType(l))for(const d of u){let f=e.get(rs(l,d));a[l]=u,n.set(s,a),i==="destroyed"?f!==void 0&&(f.delete(s),f.size===0&&e.delete(rs(l,d))):(f===void 0&&(f=new Set,e.set(rs(l,d),f)),f.has(s)||f.add(s))}}})},{skipInitialization:!0}))},[t,e])}const ov=_.forwardRef(function({logger:t},e){const[n]=ce(),r=_.useMemo(()=>new Map,[]);iv(n,r);const s=(i,o,a)=>{const l=Array.from(a??r.get(rs(i,o))??[]);if(l.length!==0)for(const u of l){const d=Te(u);Ee(d)&&(d.deleteID(i,o),d.hasNoIDsForEveryType()&&Di(d))}};return _.useImperativeHandle(e,()=>({setAnnotation(i,o,a,l,u){if(Le.isReservedType(o))throw new Error(`setAnnotation: Can't directly set this reserved annotation type '${o}'. Use the appropriate plugin instead.`);n.update(()=>{const d=xl(i);if(d===void 0){t==null||t.error("Failed to find start or end node of the annotation.");return}s(o,a),hf(d,o,a,l,u)},{tag:Aa})},removeAnnotation(i,o){if(Le.isReservedType(i))throw new Error(`removeAnnotation: Can't directly remove this reserved annotation type '${i}'. Use the appropriate plugin instead.`);const a=r.get(rs(i,o));a===void 0||a.size===0||n.update(()=>{s(i,o,a)},{tag:Aa})}})),null});function av({ignoreHistoryMergeTagChange:t=!0,ignoreSelectionChange:e=!1,onChange:n}){const[r]=ce();return _.useLayoutEffect(()=>{if(n)return r.registerUpdateListener(s=>{const{editorState:i,dirtyElements:o,dirtyLeaves:a,prevEditorState:l,tags:u}=s;if(e&&o.size===0&&a.size===0||t&&u.has(kd)||l.isEmpty())return;const d=lv(r,s);d.length!==0&&n(i,r,u,d)})},[r,t,e,n]),null}function lv(t,{dirtyLeaves:e,prevEditorState:n}){let r=new Gr;return t.getEditorState().read(()=>{const s=e.values().next().value??"";if(e.size===1&&ee(Te(s))){const i=Te(s),o=xf(i);if(ee(i)&&o!==void 0){const a=n.read(()=>{const d=Te(s);return new Gr([ee(d)?$a(d):{insert:""}])}),l=new Gr([$a(i)]),u=new Gr(o>0?[{retain:o}]:[]);r=r.concat(u).concat(a.diff(l))}}else{const i=tu(n),o=tu(t.getEditorState());r=i.diff(o)}}),r.ops}function cv(t,e,n,r){let s=0;t.forEach(i=>{if("retain"in i)s+=uv(i,s,e,r);else if("delete"in i){if(typeof i.delete!="number"||i.delete<=0){r==null||r.error(`Invalid delete operation: ${JSON.stringify(i)}`);return}r==null||r.debug(`Delete: ${i.delete}`),hv(s,i.delete,r)}else"insert"in i?typeof i.insert=="string"?(r==null||r.debug(`Insert: '${i.insert}'`),s+=fv(s,i.insert,i.attributes,e,r)):typeof i.insert=="object"&&i.insert!==null?(r==null||r.debug(`Insert embed: ${JSON.stringify(i.insert)}`),gv(s,i,e,n,r)?s+=1:r==null||r.error(`Failed to process insert embed operation: ${JSON.stringify(i.insert)} at index ${s}. Document may be inconsistent.`)):r==null||r.error(`Insert of unknown type: ${JSON.stringify(i.insert)}`):r==null||r.error(`Unknown operation: ${JSON.stringify(i)}`)})}function uv(t,e,n,r){return typeof t.retain!="number"||t.retain<0?(r==null||r.error(`Invalid retain operation: ${JSON.stringify(t)}`),0):(r==null||r.debug(`Retain: ${t.retain}`),t.attributes&&(r==null||r.debug(`Retain attributes: ${JSON.stringify(t.attributes)}`),dv(e,t.retain,t.attributes,n,r)),t.retain)}function dv(t,e,n,r,s){s==null||s.debug(`Applying attributes for range [${t}, ${t+e-1}] with attributes: ${JSON.stringify(n)}`);let i=e,o=0,a=-1;const l=$t();function u(d){if(i<=0)return!0;if(ee(d)){const f=d.getTextContentSize();if(t<o+f&&o<t+e){const h=Math.max(0,t-o),p=f-h,y=Math.min(i,p);if(y>0){let b=d;const C=h>0,A=y<f-h;if(C&&A){const[,v]=d.splitText(h);[b]=v.splitText(y)}else C?[,b]=d.splitText(h):A&&([b]=d.splitText(y));if(Dn(n)){const v=b.getParent();if(pe(v)){const E=n.char;let j;Array.isArray(E)?a>=0&&a<=E.length-1&&(j=E[a]):a===0&&(j=E);const $=j?qn(j,v):!1;if($&&Array.isArray(E)&&E.length>1){const q=ve("");b.replace(q);const B=typeof n.segment=="string"?n.segment:void 0,U=Os(E.slice(1),r,b,B);let H=q;for(const W of U)H.insertAfter(W),H=W;q.remove(),at(n,b)}else if($)at(n,b);else{b.remove();const q=su(b,n,r,s);if(q&&q.length>0){let B=v;for(const U of q)B.insertAfter(U),B=U}}}else{const E=ve("");b.replace(E);const j=su(b,n,r,s);if(j&&j.length>0){let $=E;for(const q of j)$.insertAfter(q),$=q;E.remove()}else E.replace(b)}}else at(n,b);i-=y}}o+=f}else if(vt(d))t<=o&&o<t+e&&i>0&&(iu(d,n),i-=1),o+=1;else if(pe(d)){a+=1;let f=!1;if(t<=o&&o<t+e&&i>0)if(Dn(n)){const h=n.char;let p;if(Array.isArray(h)?a>=0&&a<=h.length-1&&(p=h[a]):a===0&&(p=h),p){d.setMarker(p.style),typeof p.cid=="string"&&Jt(d,Rn,()=>p.cid);const y=$e(p,Ui);y&&Object.keys(y).length>0?d.setUnknownAttributes({...d.getUnknownAttributes()??{},...y}):d.setUnknownAttributes(void 0)}}else(n.char===!1||n.char===null||xv(n.char))&&(f=!0);if(i>0){const h=d.getChildren();for(const p of h){if(i<=0)break;if(u(p)&&i<=0)return f&&Bl(d),!0}}f&&Bl(d),a-=1}else if(dt(d)){const f=d.getChildren();for(const p of f){if(i<=0)break;if(u(p)&&i<=0)return!0}const h=1;if(t<=o&&o<t+i&&i>0){if(!Zt(d))iu(d,n);else if(Al(n)){const p=Af(n.para);p&&d.replace(p,!0)}i-=h}o+=h}else if(we(d)){const f=d.getChildren();for(const h of f){if(i<=0)break;if(u(h)&&i<=0)return!0}}return i<=0}u(l),i>0&&(s==null||s.warn(`$applyAttributes: Not all characters in the retain operation (length ${e}) could be processed. Remaining: ${i}. targetIndex: ${t}, final currentIndex: ${o}`))}function su(t,e,n,r){var s;const i=typeof e.segment=="string"?e.segment:void 0,o=Os(e.char,n,t,i),a=o.find(pe);if(!a){r==null||r.error(`Failed to create CharNode for text transformation. Style: ${Array.isArray(e.char)?e.char[0].style:(s=e.char)==null?void 0:s.style}. Falling back to standard text attributes.`),at(e,t);return}const l={};jf.forEach(f=>{t.hasFormat(f)&&(l[f]="true")});const u={};Object.entries(e).forEach(([f,h])=>{f==="segment"||f==="char"||(typeof h=="string"?u[f]=h:h===!0?u[f]="true":h===!1&&(u[f]="false"))});const d={...a.getUnknownAttributes()??{},...l,...u};return Object.keys(d).length>0&&a.setUnknownAttributes(d),at(e,t),o}function iu(t,e){for(const n of Object.keys(e)){const r=e[n];if(n==="char"&&pe(t)&&Dn(e)){const s=r;if(t.setMarker(s.style),typeof s.cid=="string"){const o=s.cid;Jt(t,Rn,()=>o)}const i=$e(s,Ui);i&&Object.keys(i).length>0&&t.setUnknownAttributes({...t.getUnknownAttributes()??{},...i});continue}typeof r=="string"&&(lt(t)||ct(t)||to(t)||oe(t)||Cs(t)?t.setUnknownAttributes({...t.getUnknownAttributes()??{},[n]:r}):(It(t)||Ke(t)||pe(t))&&(n==="style"&&!It(t)?t.setMarker(r):n==="code"&&It(t)?t.setCode(r):t.setUnknownAttributes({...t.getUnknownAttributes()??{},[n]:r})),n==="segment"&&Jt(t,Pn,()=>r))}}function hv(t,e,n){if(e<=0)return;const r=$t();let s=0,i=e;function o(a){if(i<=0)return!0;if(ee(a)){let l=a.getTextContentSize();if(t<s+l&&s<t+i){const u=Math.max(0,t-s),d=l-u,f=Math.min(i,d);f>0&&(a.spliceText(u,f,""),a.getTextContentSize()===0&&a.remove(),n==null||n.debug(`Deleted ${f} length from TextNode (key: ${a.getKey()}) at nodeOffset ${u}. Original targetIndex: ${t}, current currentIndex: ${s}.`),i-=f,l-=f)}s+=l}else if(vt(a))t<=s&&s<t+i?(a.remove(),n==null||n.debug(`Deleted embed node (key: ${a.getKey()}) at currentIndex: ${s}. Original targetIndex: ${t}, remainingToDelete: ${i}.`),i-=1):s+=1;else if(dt(a)){const l=a.getChildren().slice(),u=a.getChildren();for(const d of u){if(i<=0)break;if(o(d)&&i<=0)return!0}if(t<=s&&s<t+i&&dt(a)){i-=1;const d=a.getChildren().length;if(l.length>0&&d===0){const f=a.getParent();((f==null?void 0:f.getChildren())??[]).length>1?(a.remove(),n==null||n.debug(`Removed entire ParaNode that had all its content deleted at currentIndex: ${s}. Original targetIndex: ${t}, remainingToDelete: ${i}.`)):(a.replace(_t(),!0),n==null||n.debug(`Replaced last ParaNode with ImpliedParaNode at currentIndex: ${s}. Original targetIndex: ${t}, remainingToDelete: ${i}.`))}else if(i>0){const f=a.getNextSibling();if(f&&bt(f)){let h=s+1;const p=f.getChildren();for(const b of p){if(i<=0)break;const C=s;if(s=h,o(b)){s=C;break}ee(b)?h+=b.getTextContentSize():vt(b)&&(h+=1),s=C}const y=f.getChildren();for(const b of y)b.remove(),a.append(b);f.remove(),n==null||n.debug(`Merged next paragraph into current one after deleting symbolic close at currentIndex: ${s}. Original targetIndex: ${t}, remainingToDelete: ${i}.`)}else a.replace(_t(),!0)}else Ke(a)?a.replace(_t(),!0):a.remove()}s+=1}else if(we(a)){const l=a.getChildren();for(const u of l){if(i<=0)break;if(o(u)&&i<=0)return!0}}return i<=0}o(r),i>0&&(n==null||n.warn(`Delete operation could not remove all requested characters. Remaining to delete: ${i}. Original targetIndex: ${t}, OT length: ${e}. Final currentIndex: ${s}`))}function fv(t,e,n,r,s){if(e===ms)return ou(t,n,s);if(e.endsWith(ms)&&!Al(n)){const i=e.slice(0,-1);let o=0;if(i.length>0){if(Dn(n))throw new Error("Text + LF should not have char attributes");o+=Bi(t,i,n,s)}return o+=ou(t+o,n,s),o}else return Dn(n)?pv(t,e,n,r,s):Bi(t,e,n,s)}function pv(t,e,n,r,s){s==null||s.debug(`Attempting to insert CharNode with text "${e}" and attributes ${JSON.stringify(n.char)} at index ${t}`);const i=ve(e===""?Xt:e);at(n,i);let o;{let p=function(C){if(ee(C)){const A=C.getTextContentSize();if(t>=b&&t<b+A){const v=C.getParent();return pe(v)&&(o=v),!0}b+=A}else if(vt(C))b+=1;else if(pe(C)){const A=C.getChildren();for(const v of A)if(p(v))return!0}else if(we(C)){const A=C.getChildren();for(const v of A)if(p(v))return!0;dt(C)&&(b+=1)}return!1};const y=$t();let b=0;p(y)}let a=n.char;if(Array.isArray(a)){if(o){const p=a[0];p&&qn(p,o)?(a=a.slice(1),a.length===1&&(a=a[0])):o=void 0}}else o&&(qn(a,o)||(o=void 0));const l=typeof n.segment=="string"?n.segment:void 0,u=Os(a,r,i,l,o?[o]:void 0);if(u.length===0)return e.length;const d=u.find(pe);if(!d)return s==null||s.error(`CharNode style is missing for text "${e}". Attributes: ${JSON.stringify(n.char)}. Falling back to rich text insertion.`),Bi(t,e,void 0,s);const f={};for(const[p,y]of Object.entries(n))p!=="char"&&p!=="segment"&&typeof y=="string"&&(f[p]=y);Object.keys(f).length>0&&d.setUnknownAttributes(f);let h=!0;for(const p of u)if(!Mf(t,p,s)){h=!1;break}return h?e.length:(s==null||s.error(`Failed to insert CharNode with text "${e}" at index ${t}. Falling back to rich text.`),Bi(t,e,void 0,s))}function Bi(t,e,n,r){if(e.length<=0)return r==null||r.debug("Attempted to insert empty string. No action taken."),0;const s=$t();let i=0,o=!1;function a(l){if(o)return!0;if(ee(l)){const u=l.getTextContentSize();if(t>=i&&t<=i+u){const d=t-i,f=ve(e);if(at(n,f),d===0)l.insertBefore(f);else if(d===u){const h=l.getParent();pe(h)&&!Dn(n)?h.insertAfter(f):l.insertAfter(f)}else{const[,h]=l.splitText(d);h.insertBefore(f)}return r==null||r.debug(`Inserted text "${e}" in/around TextNode (key: ${l.getKey()}) at nodeOffset ${d}. Original targetIndex: ${t}, currentIndex at node start: ${i}.`),o=!0,!0}i+=u}else if(vt(l))i+=1;else if(pe(l)){if(!o&&t===i){const d=ve(e);at(n,d);const f=l.getFirstChild();return f?f.insertBefore(d):l.append(d),r==null||r.debug(`Inserted text "${e}" at beginning of CharNode ${l.getType()} (key: ${l.getKey()}).`),o=!0,!0}const u=l.getChildren();for(const d of u){if(a(d))return!0;if(o)break}if(!o&&t===i){const d=ve(e);return at(n,d),l.append(d),r==null||r.debug(`Appended text "${e}" to end of CharNode ${l.getType()} (key: ${l.getKey()}).`),o=!0,!0}}else if(dt(l)){if(!o&&t===i){const d=ve(e);at(n,d);const f=l.getFirstChild();return f?f.insertBefore(d):l.append(d),r==null||r.debug(`Inserted text "${e}" at beginning of container ${l.getType()} (key: ${l.getKey()}).`),o=!0,!0}const u=l.getChildren();for(const d of u){if(a(d))return!0;if(o)break}if(!o&&t===i){const d=ve(e);return at(n,d),l.append(d),r==null||r.debug(`Appended text "${e}" to end of container ${l.getType()} (key: ${l.getKey()}).`),o=!0,!0}i+=1}else if(we(l)){const u=l.getChildren();for(const d of u){if(a(d))return!0;if(o)break}}return o}if(a(s),!o&&t===i){r==null||r.debug(`Insertion point matches end of document (targetIndex: ${t}, final currentIndex: ${i}). Appending text to new ParaNode.`);const l=ve(e);at(n,l);const u=_t().append(l);s.append(u),o=!0}return o?e.length:(r==null||r.warn(`$insertRichText: Could not find insertion point for text "${e}" at targetIndex ${t}. Final currentIndex: ${i}. Text not inserted.`),0)}function Mf(t,e,n){const r=$t();let s=0,i=!1;function o(a){if(i)return!0;if(a===r&&t===0&&!r.getFirstChild())return e.isInline()?(n==null||n.debug(`$insertNodeAtCharacterOffset: Inserting inline node ${e.getType()} into empty root, wrapped in ImpliedParaNode. targetIndex: ${t}`),r.append(_t().append(e))):(n==null||n.debug(`$insertNodeAtCharacterOffset: Inserting block node ${e.getType()} directly into empty root. targetIndex: ${t}`),r.append(e)),i=!0,!0;if(!we(a))return!1;const l=a.getChildren();for(const u of l){if(t===s&&!i){if(a===r&&e.isInline())if(bt(u)){n==null||n.debug(`$insertNodeAtCharacterOffset: Inserting inline node ${e.getType()} into existing ${u.getType()} at beginning. targetIndex: ${t}`);const d=u.getFirstChild();d?d.insertBefore(e):u.append(e)}else n==null||n.debug(`$insertNodeAtCharacterOffset: Inserting inline node ${e.getType()} into root before ${u.getType()}, wrapping in ImpliedParaNode. targetIndex: ${t}`),u.insertBefore(_t().append(e));else u.insertBefore(e),n==null||n.debug(`$insertNodeAtCharacterOffset: Inserted node ${e.getType()} (key: ${e.getKey()}) before child ${u.getType()} (key: ${u.getKey()}) in ${a.getType()} (key: ${a.getKey()}). targetIndex: ${t}, currentIndex: ${s}`);return i=!0,!0}if(ee(u)){const d=u.getTextContentSize();if(!i&&t>s&&t<s+d){const f=t-s,[h]=u.splitText(f);return h.insertAfter(e),n==null||n.debug(`$insertNodeAtCharacterOffset: Inserted node ${e.getType()} (key: ${e.getKey()}) by splitting TextNode (key: ${u.getKey()}) at offset ${f}. targetIndex: ${t}, currentIndex at node start: ${s}`),i=!0,!0}s+=d}else if(vt(u))s+=1;else if(pe(u)){if(o(u))return!0}else if(dt(u)){const d=u;if(o(d))return!0;const f=s;if(Zt(d)&&dt(e)&&t===f&&!i)return n==null||n.debug(`$insertNodeAtCharacterOffset: Replacing ImpliedParaNode (key: ${d.getKey()}) with block node '${e.getType()}' (key: ${e.getKey()}) at OT index ${t}.`),u.replace(e,!0),s=f+1,i=!0,!0;s+=1}else if(we(u)&&o(u))return!0;if(i)return!0}return we(a)&&!i&&(t===s||a===r&&t>s)?a===r?(e.isInline()?(n==null||n.debug(`$insertNodeAtCharacterOffset: Appending inline node ${e.getType()} to root. Wrapping in new ImpliedParaNode. targetIndex: ${t}, current document OT length: ${s}.`),r.append(_t().append(e))):(n==null||n.debug(`$insertNodeAtCharacterOffset: Appending block node ${e.getType()} to root. targetIndex: ${t}, current document OT length: ${s}.`),r.append(e)),i=!0,!0):bt(a)?Zt(a)&&Ke(e)&&t===s?(n==null||n.debug(`$insertNodeAtCharacterOffset: Replacing ImpliedParaNode container (key: ${a.getKey()}) with ParaNode ${e.getType()} (key: ${e.getKey()}) via append logic. targetIndex: ${t}`),a.replace(e,!0),i=!0,!0):e.isInline()||!bt(e)?(n==null||n.debug(`$insertNodeAtCharacterOffset: Appending node ${e.getType()} to existing container ${a.getType()} (key: ${a.getKey()}). targetIndex: ${t}, container end OT index: ${s}.`),a.append(e),i=!0,!0):(n==null||n.debug(`$insertNodeAtCharacterOffset: Inserting block node ${e.getType()} after container ${a.getType()} (key: ${a.getKey()}). targetIndex: ${t}, container end OT index: ${s}.`),a.insertAfter(e),i=!0,!0):(pe(a)?(n==null||n.debug(`$insertNodeAtCharacterOffset: Inserting node ${e.getType()} after CharNode (key: ${a.getKey()}). targetIndex: ${t}, element end OT index: ${s}.`),a.insertAfter(e)):e.isInline()||!bt(e)?(n==null||n.debug(`$insertNodeAtCharacterOffset: Appending node ${e.getType()} to generic element ${a.getType()} (key: ${a.getKey()}). targetIndex: ${t}, element end OT index: ${s}.`),a.append(e)):(n==null||n.debug(`$insertNodeAtCharacterOffset: Inserting block node ${e.getType()} after generic element ${a.getType()} (key: ${a.getKey()}). targetIndex: ${t}, element end OT index: ${s}.`),a.insertAfter(e)),i=!0,!0):i}return o(r),i||n==null||n.warn(`$insertNodeAtCharacterOffset: Could not find insertion point for node ${e.getType()} (key: ${e.getKey()}) at targetIndex ${t}. Final currentIndex: ${s}. Node not inserted.`),i}function gv(t,e,n,r,s){let i;return Kt("chapter",e)?i=mv(e.insert.chapter,n):Kt("verse",e)?i=yv(e.insert.verse,n):Kt("ms",e)?i=bv(e.insert.ms):Kt("unmatched",e)?i=_v(e.insert.unmatched):Kt("note",e)&&(i=kv(e,n,r,s)),i?Mf(t,i,s):(s==null||s.error(`$insertEmbedAtCurrentIndex: Cannot create LexicalNode for embed object: ${JSON.stringify(e.insert)}`),!1)}function ou(t,e,n){let r;Al(e)?r=Af(e.para):wv(e)&&(r=vv(e.book)),r??(r=_t());const s=r,i=Ke(s),o=Zt(s);let a=0,l=!1;function u(d){if(l)return!0;if(ee(d)){const f=d.getTextContentSize();if(t>=a&&t<=a+f){const h=d.getParent();if(Ke(h)&&(i||o)){n==null||n.debug(`Splitting ParaNode (marker: ${h.getMarker()}) with LF attributes at targetIndex ${t}`);const p=t-a,[y]=p>0?d.splitText(p):[void 0];let b=y==null?void 0:y.getPreviousSibling();for(;b;){const C=b;b=b.getPreviousSibling();const A=s.getFirstChild();A?A.insertBefore(C):s.append(C)}return y&&s.append(y),h.insertBefore(s),l=!0,!0}}a+=f}else if(vt(d))a+=1;else if(dt(d)){const f=d.getChildren();for(const h of f){if(u(h))return!0;if(l)break}if(t===a){if(Zt(d)&&s)return n==null||n.debug(`Replacing ImpliedParaNode (key: ${d.getKey()}) with ParaNode at targetIndex ${t}`),d.replace(s,!0),l=!0,!0;if(Ke(d)&&s){const h=d;return n==null||n.debug(`Creating new block node with LF attributes after existing ParaNode (marker: ${h.getMarker()}) at targetIndex ${t}`),h.insertAfter(s),l=!0,!0}}if(a+=1,t===a&&Ke(d)&&s)return n==null||n.debug(`Creating new block node after existing ParaNode (marker: ${d.getMarker()}) at targetIndex ${t}`),d.insertAfter(s),l=!0,!0}else if(we(d)){const f=d.getChildren();for(const h of f){if(u(h))return!0;if(l)break}}return l}return u($t()),l||n==null||n.warn(`Could not find location to handle newline with para attributes at targetIndex ${t}. Final currentIndex: ${a}.`),1}function mv(t,e){if(!t)return;const{number:n,sid:r,altnumber:s,pubnumber:i}=t;if(!n)return;const o=$e(t,dk);let a;if(e.markerMode==="editable")a=Kh(n,r,s,i,o);else{const l=e.markerMode==="visible";a=hl(n,l,r,s,i,o)}return a}function yv(t,e){if(!t)return;const{style:n,number:r,sid:s,altnumber:i,pubnumber:o}=t;if(!r)return;const a=$e(t,hk);let l;if(e.markerMode==="editable"){if(!n)return;const u=Ts(n,r);l=of(r,u,s,i,o,a)}else{const u=e.markerMode==="visible";l=Cl(r,u,s,i,o,a)}return l}function bv(t){if(!t)return;const{style:e,sid:n,eid:r}=t;if(!e)return;const s=$e(t,fk);return tf(e,n,r,s)}function _v(t){if(!t)return;const{marker:e}=t;if(e)return wl(e)}function kv(t,e,n,r){var s;const i=t.insert;if(!i.note)return;const{style:o,caller:a,category:l,contents:u}=i.note;if(!o||a==null)return;a===""&&(r==null||r.warn("Note has empty caller. Only use for note editing."));const d=$e(i.note,pk),f=(s=t.attributes)==null?void 0:s.segment;let h;f&&typeof f=="string"&&(h=f);const p=[];for(const y of(u==null?void 0:u.ops)??[])if(typeof y.insert=="string")if(Dn(y.attributes)){const b=Os(y.attributes.char,e,ve(y.insert),void 0,p);p.push(...b)}else p.push(ve(y.insert));return kf(o,a,p,e,n,h).setCategory(l).setUnknownAttributes(d)}function vv(t){const{style:e,code:n}=t;if(!e||e!==fs||!n||!ut.isValidBookCode(n))return;const r=$e(t,uk);return Hh(n,r)}function Af(t){const{style:e}=t;if(!e)return;const n=$e(t,ck);return ps(e,n)}function Os(t,e,n,r,s){if(ee(n)&&n.getTextContentSize()===0&&n.setTextContent(Xt),Array.isArray(t)){if(t.length===0)throw new Error("Empty charAttr array");const i=t[0],o=s==null?void 0:s[s.length-1];if(pe(o)&&qn(i,o))return t.length>1?Os(t.slice(1),e,n).forEach(d=>o.append(d)):n&&o.append(n),[];const a=t.reduceRight((d,f,h)=>{const p=gt(f.style,$e(f,Ui));if(typeof f.cid=="string"&&Jt(p,Rn,()=>f.cid),r&&h===t.length-1&&Jt(p,Pn,()=>r),d)if(pe(d)){const y=d.getMarker(),b=[];la(y,b,e),b.forEach(A=>p.append(A)),p.append(d);const C=[];ca(y,C,e),C.forEach(A=>p.append(A))}else p.append(d);return p},n),l=[],u=t[0];return la(u.style,l,e),l.push(a),ca(u.style,l,e),l}else{const i=s==null?void 0:s[s.length-1];if(pe(i)&&qn(t,i))return n&&i.append(n),[];const o=[];la(t.style,o,e);const a=gt(t.style,$e(t,Ui));return typeof t.cid=="string"&&Jt(a,Rn,()=>t.cid),r&&Jt(a,Pn,()=>r),n&&a.append(n),o.push(a),ca(t.style,o,e),o}}function la(t,e,n){(n==null?void 0:n.markerMode)==="editable"?e.push(pr(t)):(n==null?void 0:n.markerMode)==="visible"&&e.push(gr("marker",tn(t)))}function ca(t,e,n,r=!1){Ce.isValidFootnoteMarker(t)||Ce.isValidCrossReferenceMarker(t)||((n==null?void 0:n.markerMode)==="editable"?r?e.push(pr("","selfClosing")):e.push(pr(t,"closing")):(n==null?void 0:n.markerMode)==="visible"&&e.push(gr("marker",fr(r?"":t))))}function wv(t){return!!t&&!!t.book&&typeof t.book=="object"&&t.book!==null&&"style"in t.book&&typeof t.book.style=="string"&&"code"in t.book&&typeof t.book.code=="string"}function Al(t){return!!t&&!!t.para&&typeof t.para=="object"&&t.para!==null&&"style"in t.para&&typeof t.para.style=="string"}function Dn(t){return!!t&&!!t.char&&typeof t.char=="object"&&t.char!==null&&(!Array.isArray(t.char)&&"style"in t.char&&typeof t.char.style=="string"||Array.isArray(t.char)&&t.char.length>0&&"style"in t.char[0]&&typeof t.char[0].style=="string")}function xv(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)&&Object.keys(t).length===0}function at(t,e){if(t)for(const n of Object.keys(t)){if(n==="segment"&&typeof t[n]=="string"){const r=t[n];Jt(e,Pn,()=>r);continue}if(Cv(n)){const r=!!t[n],s=n,i=e.hasFormat(s);(r&&!i||!r&&i)&&e.toggleFormat(s)}}}const jf=["bold","underline","strikethrough","italic","highlight","code","subscript","superscript","lowercase","uppercase","capitalize"];function Cv(t){return jf.includes(t)}function Sv({viewOptions:t}){const[e]=ce();return Tv(e,t),null}function Tv(t,e){_.useEffect(()=>{if(!t.hasNodes([en,Ye,Pe]))throw new Error("ArrowNavigationPlugin: ImmutableChapterNode, ImmutableVerseNode or NoteNode not registered on editor!");const n=r=>{if(r.key!=="ArrowLeft"&&r.key!=="ArrowRight")return!1;const s=re();if(!X(s)||!s.isCollapsed())return!1;const i=t.getRootElement();if(!i)return!1;const o=i.dir||"ltr";let a=!1;return Ev(o,r.key)?a=Mv(s):Ov(o,r.key)&&(a=Av(s,e)),a&&r.preventDefault(),a};return t.registerCommand(ks,n,Vi)},[t,e])}function Ev(t,e){return t==="ltr"&&e==="ArrowRight"||t==="rtl"&&e==="ArrowLeft"}function Ov(t,e){return t==="ltr"&&e==="ArrowLeft"||t==="rtl"&&e==="ArrowRight"}function Mv(t){var e,n,r;const s=t.anchor.getNode(),i=S_(t);if(oe(i)&&!Es(i.getFirstChild())){if(bt(s)){if(t.anchor.offset===s.getChildrenSize())return!1}else if(t.anchor.offset!==s.getTextContentSize())return!1;if(i.getIsCollapsed()){if(i.is((e=i.getParent())==null?void 0:e.getLastChild()))return(r=(n=i.getParent())==null?void 0:n.getNextSibling())==null||r.selectStart(),!0}else return Li(i.getFirstChild())?i.select(2,2):i.select(1,1),!0}if(bt(s)&&oe(i)&&i.getIsCollapsed()){const a=i.getNextSibling();return a?a.selectStart():i.selectEnd(),!0}const o=i==null?void 0:i.getParent();if(Li(i)&&oe(o)&&i.is(o==null?void 0:o.getLastChild())){const a=o.getNextSibling();return a?a.selectStart():o.selectEnd(),!0}return!1}function Av(t,e){const n=T_(t);if(Ss(n)&&!n.getPreviousSibling())return!0;if(t.anchor.offset!==0)return!1;const r=t.anchor.getNode();if(It(r.getParent()))return!0;if(oe(n)&&n.getIsCollapsed()){const i=n.getPreviousSibling();if(!Cr(i))return!1;const o=n.getParent();if(!o)return!1;const a=n.getIndexWithinParent();return o.select(a,a),!0}if(bt(n)&&(e==null?void 0:e.noteMode)==="collapsed"){const i=n.getLastChild();if(!i)return!1;const o=os(i,a=>oe(a));if(oe(o)&&o.getIsCollapsed()){const a=o.getParent();if(!a)return!1;const l=o.getIndexWithinParent();return a.select(l,l),!0}}const s=af(r);if(!s||s.getIsCollapsed())return!1;if(kn(n)){const i=s.getParent();if(!i)return!1;const o=s.getIndexWithinParent();return i.select(o,o),!0}return!1}function jv(){const[t]=ce();return Nv(t),null}function Nv(t){_.useEffect(()=>{if(!t.hasNodes([Ce]))throw new Error("CharNodePlugin: CharNode not registered on editor!");return Xe(t.registerNodeTransform(Ce,Iv),t.registerNodeTransform(At,Rv))},[t])}function Iv(t){if(!pe(t))return;if(t.isEmpty()){t.remove();return}const e=t.getMarker(),n=vs(t,Rn),r=t.getUnknownAttributes(),s=t.getNextSibling();pe(s)&&qn({style:e,cid:n},s)&&zt(r,s.getUnknownAttributes())&&(t.append(...s.getChildren()),s.remove());const i=t.getPreviousSibling();pe(i)&&qn({style:e,cid:n},i)&&zt(r,i.getUnknownAttributes())&&(i.append(...t.getChildren()),t.remove())}function Rv(t){const e=t.getParent();if(!pe(e)||e.getChildrenSize()!==1)return;const n=t.getTextContent();n.length>1&&n.startsWith(Xt)&&(t.setTextContent(n.slice(1)),t.selectEnd())}function Nf(t){return t.replaceAll("	"," ")}const jl=t=>{navigator.clipboard.read().then(async e=>{if((await navigator.permissions.query({name:"clipboard-read"})).state==="denied"){alert("Not allowed to paste from clipboard.");return}const n=new DataTransfer,r=e[0];for(const i of r.types){const o=await(await r.getType(i)).text();n.setData(i,Nf(o))}const s=new ClipboardEvent("paste",{clipboardData:n});t.dispatchCommand(zi,s)})},Nl=t=>{navigator.clipboard.read().then(async()=>{if((await navigator.permissions.query({name:"clipboard-read"})).state==="denied"){alert("Not allowed to paste from clipboard.");return}const e=new DataTransfer,n=await navigator.clipboard.readText();e.setData("text/plain",Nf(n));const r=new ClipboardEvent("paste",{clipboardData:e});t.dispatchCommand(zi,r)})};function Pv(){const[t]=ce();return _.useEffect(()=>{const e=n=>{const{key:r,shiftKey:s,metaKey:i,ctrlKey:o,altKey:a}=n;!(fa?i:o)||a||(!s&&r.toLowerCase()==="c"?(n.preventDefault(),t.dispatchCommand(Ji,null)):!s&&r.toLowerCase()==="x"?(n.preventDefault(),t.dispatchCommand(Ki,null)):r.toLowerCase()==="v"&&(n.preventDefault(),s?Nl(t):jl(t)))};return t.registerRootListener((n,r)=>{r!==null&&r.removeEventListener("keydown",e),n!==null&&n.addEventListener("keydown",e)})},[t]),null}function $v({logger:t}){const[e]=ce();return _.useEffect(()=>Xe(e.registerCommand(ks,n=>n.key!=="\\"&&n.key!=="/"?!1:(n.preventDefault(),!0),vi),e.registerCommand(zi,n=>{var r;const s=(r=n.clipboardData)==null?void 0:r.getData("text/plain");return!s||!s.includes("\\")&&!s.includes("/")?!1:(t==null||t.info("CommandMenuPlugin: paste containing backslash or forward slash ignored."),n.preventDefault(),!0)},vi),e.registerCommand(xd,n=>{var r;const s=(r=n.dataTransfer)==null?void 0:r.getData("text/plain");return!s||!s.includes("\\")&&!s.includes("/")?!1:(t==null||t.info("CommandMenuPlugin: drag containing backslash or forward slash ignored."),n.preventDefault(),!0)},vi)),[e,t]),null}function qv({index:t,isSelected:e,onClick:n,onMouseEnter:r,option:s}){let i="item";return e&&(i+=" selected"),s.isDisabled&&(i+=" disabled"),m.jsx("li",{tabIndex:-1,className:i,ref:s.setRefElement,role:"option","aria-selected":e,"aria-disabled":s.isDisabled,id:"typeahead-item-"+t,onMouseEnter:r,onClick:s.isDisabled?void 0:n,children:m.jsx("span",{className:"text",children:s.title})},s.key)}function Dv({options:t,selectedItemIndex:e,onOptionClick:n,onOptionMouseEnter:r}){return m.jsx("div",{className:"typeahead-popover",children:m.jsx("ul",{children:t.map((s,i)=>m.jsx(qv,{index:i,isSelected:e===i,onClick:()=>n(s,i),onMouseEnter:()=>r(i),option:s},s.key))})})}class oi extends zm{constructor(e,n){super(e),z(this,"title"),z(this,"onSelect"),z(this,"isDisabled"),this.title=e,this.onSelect=n.onSelect.bind(this),this.isDisabled=n.isDisabled||!1}}function Lv(t,e="editor-input"){return t?t.classList.contains(e):!1}function Fv(){const[t]=ce(),[e,n]=_.useState(()=>!t.isEditable()),r=_.useRef(void 0),s=_.useRef(void 0),i=_.useRef(void 0),o=_.useMemo(()=>[new oi("Cut",{onSelect:()=>{t.dispatchCommand(Ki,null)},isDisabled:e}),new oi("Copy",{onSelect:()=>{t.dispatchCommand(Ji,null)}}),new oi("Paste",{onSelect:()=>{jl(t)},isDisabled:e}),new oi("Paste as Plain Text",{onSelect:()=>{Nl(t)},isDisabled:e})],[t,e]),a=_.useCallback((l,u,d)=>{t.update(()=>{l==null||l.onSelect(u),d()})},[t]);return _.useEffect(()=>{var l;s.current=((l=t.getRootElement())==null?void 0:l.className)??""},[t]),_.useEffect(()=>{const l=()=>{var u;(u=i.current)==null||u.call(i)};return window.addEventListener("scroll",l,!0),()=>{window.removeEventListener("scroll",l,!0)}},[]),_.useEffect(()=>t.registerEditableListener(l=>{n(!l)}),[t]),m.jsx(Vm,{options:o,onSelectOption:a,onWillOpen:l=>{r.current=l.target},menuRenderFn:(l,{selectedIndex:u,options:d,selectOptionAndCleanUp:f,setHighlightedIndex:h},{setMenuRef:p})=>(i.current=()=>f(void 0),l.current&&!Lv(r.current,s.current)&&!Zh(r.current)?yt.createPortal(m.jsx("div",{className:"typeahead-popover auto-embed-menu",style:{marginLeft:l.current.style.width,userSelect:"none",width:200},ref:p,children:m.jsx(Dv,{options:o,selectedItemIndex:u,onOptionClick:(y,b)=>{y.isDisabled||(h(b),f(y))},onOptionMouseEnter:y=>{h(y)}})}),l.current):null)})}function Uv({isEditable:t}){const[e]=ce();return _.useLayoutEffect(()=>{e.setEditable(t)},[e,t]),null}function Bv({scripture:t,nodeOptions:e,editorAdaptor:n,viewOptions:r,logger:s}){const[i]=ce();return _.useEffect(()=>{var o;(o=n.initialize)==null||o.call(n,e,s)},[n,s,e]),_.useEffect(()=>{var o;(o=n.reset)==null||o.call(n);const a=n.serializeEditorState(t,r);if(a==null){s==null||s.warn("LoadStatePlugin: serializedEditorState was null or undefined. Skipping editor update.");return}try{const l=i.parseEditorState(a);queueMicrotask(()=>{i.update(()=>{i.setEditorState(l),i.dispatchCommand(bd,void 0)},{tag:ul})})}catch{s==null||s.error("LoadStatePlugin: error parsing or setting editor state.")}},[i,n,s,t,r]),null}function Hv({expandedNoteKeyRef:t,nodeOptions:e,viewOptions:n,logger:r}){const[s]=ce();return Wv(e,r),zv(s,t,n,r),null}function Wv(t,e){const n=_.useRef(void 0),r=t.noteCallers;_.useEffect(()=>{let s=r;(!s||s.length<=0)&&(s=Lk),n.current!==s&&(n.current=s,Qv("note-callers",s,e))},[e,r])}function zv(t,e,n,r){_.useEffect(()=>{if(!t.hasNodes([Ce,Pe,kt]))throw new Error("NoteNodePlugin: CharNode, NoteNode or ImmutableNoteCallerNode not registered on editor!");const s=i=>t.update(()=>Zv(i));return Xe(t.registerNodeTransform(Pe,i=>Kv(i,n)),t.registerNodeTransform(Ce,Jv),t.registerNodeTransform(At,Vv),t.registerNodeTransform(kt,Gv),t.registerMutationListener(kt,(i,{prevEditorState:o})=>Yv(i,o)),t.registerCommand(_s,()=>Xv(t,e,n,r),yr),t.registerRootListener((i,o)=>{o!==null&&o.removeEventListener("dblclick",s),i!==null&&i.addEventListener("dblclick",s)}))},[t,e,r,n])}function Kv(t,e){const n=t.getChildren();if(!n.some(r=>kn(r))&&(e==null?void 0:e.markerMode)!=="editable"&&t.getCaller()!==""&&t.remove(),n.length>0){const r=n[0];ee(r)&&!Es(r)&&t.insertBefore(r)}}function Jv(t){const e=t.getParentOrThrow(),n=e.getChildren(),r=n.find(o=>kn(o));if(!pe(t)||!oe(e)||!r)return;const s=kl(n);r.getPreviewText()!==s&&r.setPreviewText(s);const i=t.getNextSibling();ee(i)?i.getTextContent()!==me&&i.setTextContent(me):t.insertAfter(ve(me))}function Vv(t){const e=af(t),n=e==null?void 0:e.getChildren(),r=n==null?void 0:n.find(o=>kn(o));if(!ee(t)||!oe(e)||!r||!n)return;const s=t.getParent();if(!Es(t)&&oe(s)&&t.getTextContent()!==me&&(t.setTextContent(me),t.selectEnd()),pe(s)&&s.getChildrenSize()===1){const o=t.getTextContent();o.length>1&&o.startsWith(Xt)&&(t.setTextContent(o.slice(1)),t.selectEnd())}const i=kl(n);r.getPreviewText()!==i&&r.setPreviewText(i)}function Gv(t){if(!kn(t))return;const e=t.getNextSibling();!ee(e)||Es(e)?t.insertAfter(ve(me)):e.getTextContent()!==me&&e.setTextContent(me)}function Yv(t,e){for(const[n,r]of t){if(r!=="destroyed")continue;const s=e.read(()=>{const o=Te(n),a=o==null?void 0:o.getParent();return kn(o)&&oe(a)&&a.getCaller()===Rt}),i=document.querySelector(".editor-input");!s||!i||(i.classList.add("reset-counters"),i.offsetHeight,i.classList.remove("reset-counters"))}}function Xv(t,e,n,r){var s;if((n==null?void 0:n.noteMode)!=="expandInline")return!1;const i=re();if(!X(i)||!i.isCollapsed())return!1;const o=i.anchor,a=o.getNode();if(e.current){const l=os(a,u=>oe(u));if(l)e.current!==l.getKey()&&(e.current=l.getKey());else{const u=Te(e.current);u&&!u.getIsCollapsed()&&(r==null||r.debug("Cursor moved away from NoteNode, collapsing it"),Wr(t,e.current,r)),e.current=void 0}}if(o.offset===0){const l=a.getPreviousSibling();if(oe(l)){r==null||r.debug("Cursor is just after a NoteNode");const u=l.getKey();l.getIsCollapsed()?e.current=u:e.current=void 0,Wr(t,u,r)}}if(o.offset===a.getTextContentSize()){const l=a.getNextSibling();if(oe(l)){r==null||r.debug("Cursor is just before a NoteNode");const u=l.getKey();l.getIsCollapsed()?e.current=u:e.current=void 0,Wr(t,u,r)}else if(!l){const u=os(a,d=>oe(d));if(u&&u.getIsCollapsed()&&bt(u.getParent())&&u.is((s=u.getParent())==null?void 0:s.getLastChild())){r==null||r.debug("Cursor is at end of note at end of para");const d=u.getKey();e.current=d,Wr(t,d,r)}}}if(bt(a)){const l=a.getChildAtIndex(o.offset),u=l==null?void 0:l.getPreviousSibling();if(Cr(u)&&oe(l)){r==null||r.debug("Cursor is between verse and NoteNode");const d=l.getKey();l.getIsCollapsed()?e.current=d:e.current=void 0,Wr(t,d,r)}}return!1}function Wr(t,e,n){const r=Te(e);try{r==null||r.toggleIsCollapsed()}catch(s){if(s instanceof Error&&s.message.includes("read only"))n==null||n.warn("Fallback triggered after stabilization - edge case"),setTimeout(()=>{t.update(()=>{r==null||r.toggleIsCollapsed()})},0);else throw s}}function Zv(t){const e=re();if(!X(e))return;const n=e.anchor,r=e.focus,s=n.getNode(),i=r.getNode();if(oe(s)&&ee(i)){t.preventDefault();const o=Md();o.anchor.set(i.getKey(),0,"text"),o.focus.set(i.getKey(),r.offset,"text"),Sd(o)}}function Qv(t,e,n){for(const r of document.styleSheets)try{const s=r.cssRules||r.rules;for(const i of s)if(ew(i,t)){const o=e.map(a=>`"${a}"`).join(" ");i.symbols=o;return}}catch{continue}n==null||n.warn(`Editor: counter style "${t}" not found.`)}function ew(t,e){return typeof t=="object"&&t!==null&&"name"in t&&t.name===e&&"symbols"in t&&typeof t.symbols=="string"}function tw({onChange:t}){const[e]=ce();return _.useEffect(()=>e.registerCommand(_s,()=>{const n=e.read(()=>mf());return t==null||t(n),!1},yr),[e,t]),null}function nw(){const[t]=ce();return rw(t),null}function rw(t){_.useEffect(()=>{if(!t.hasNodes([tt]))throw new Error("ParaNodePlugin: ParaNode not registered on editor!");return t.registerNodeTransform(tt,e=>sw(e,t))},[t])}function sw(t,e){Tl(e,t.getKey())&&wf(t.getFirstChild()),!(!Ke(t)||t.getMarker()!=="b"||t.isEmpty()||!e.getEditorState().read(()=>{const n=Te(t.getKey());return Ke(n)&&((n==null?void 0:n.isEmpty())??!1)}))&&t.clear()}function If({onStateChange:t}){const[e]=ce(),[n,r]=_.useState(e),s=_.useRef(!1),i=_.useRef(!1),o=_.useRef(),a=_.useRef(),l=_.useCallback(()=>{const u=re();let d;if(X(u)){const f=u.anchor.getNode(),h=u.focus.getNode();let p=f.getKey()==="root"?f:os(f,A=>{const v=A.getParent();return v!==null&&Ip(v)});p===null&&(p=f.getTopLevelElementOrThrow());const y=p.getKey(),b=n.getElementByKey(y),C=O_(f,h);if(C&&lk(C)&&(d=C.getMarker()),b!==null&&(Ke(p)||It(p)||Ss(p))){o.current=p.getMarker(),a.current=d,t==null||t({canUndo:s.current,canRedo:i.current,blockMarker:o.current,contextMarker:d});return}}a.current=d},[n,t]);return _.useEffect(()=>e.registerCommand(_s,(u,d)=>(l(),r(d),!1),Xr),[e,l]),_.useEffect(()=>Xe(n.registerUpdateListener(({editorState:u})=>{u.read(()=>{l()})}),n.registerCommand(Kr,u=>(s.current=u,t==null||t({canUndo:s.current,canRedo:i.current,blockMarker:o.current,contextMarker:a.current}),!1),Xr),n.registerCommand(zr,u=>(i.current=u,t==null||t({canUndo:s.current,canRedo:i.current,blockMarker:o.current,contextMarker:a.current}),!1),Xr)),[l,n,t]),null}function iw({textDirection:t}){const[e]=ce();return ow(e,t),aw(e),null}function ow(t,e){_.useEffect(()=>{function n(){const r=t.getRootElement();if(!r||e==="auto")return;r.dir=e;const s=t._config.theme.placeholder,i=document.getElementsByClassName(s)[0];i&&(i.dir=e)}return n(),t.registerUpdateListener(({dirtyElements:r})=>{r.size>0&&n()})},[t,e])}function aw(t){_.useEffect(()=>{const e=n=>{if(n.key!=="ArrowLeft"&&n.key!=="ArrowRight")return!1;const r=re();if(!X(r))return!1;const s=r.anchor.getNode(),i=os(s,f=>I_(f,t)==="p");if(!i)return!1;const o=t.getElementByKey(i.getKey());if(!o)return!1;const a=o.parentElement,l=o.dir||"ltr",u=((a==null?void 0:a.dir)??"")||"ltr";if(!a||l===u)return!1;const d=a.dir==="rtl"&&n.key==="ArrowLeft"||a.dir==="ltr"&&n.key==="ArrowRight";return r.modify("move",d,"character"),n.preventDefault(),!0};return t.registerCommand(ks,e,Vi)},[t])}function lw(){const[t]=ce();return cw(t),null}function cw(t){_.useEffect(()=>{if(!t.hasNodes([Ce,Ye,Pe,At,Ge]))throw new Error("TextSpacingPlugin: CharNode, ImmutableVerseNode, NoteNode, TextNode or VerseNode not registered on editor!");return Xe(t.registerNodeTransform(At,uw),t.registerNodeTransform(At,e=>dw(e,t)),t.registerNodeTransform(Ge,au),t.registerNodeTransform(Ye,au))},[t])}function uw(t){if(!t.isAttached())return;const e=t.getTextContent(),n=t.getNextSibling(),r=t.getParent();t.getMode()!=="normal"||e.endsWith(" ")&&e.length>1||oe(n)||pe(r)||Ee(r)||Cs(r)||(e===" "&&!ct(n)?t.setTextContent(""):Sl(t))}function dw(t,e){const n=t.getParent();!Cs(n)||!t.isAttached()||Tl(e,t.getKey())&&n.insertAfter(t)}function au(t){if(!t.isAttached())return;const e=t.getPreviousSibling();e&&!ct(e)&&!ee(e)&&!Cs(e)&&t.insertBefore(ve(" "))}function hw({trigger:t,scriptureReference:e,contextMarker:n,getMarkerAction:r}){const{markersMenuItems:s}=sv({scriptureReference:e,contextMarker:n,getMarkerAction:r});return m.jsx(rv,{trigger:t,items:s})}function fw({trigger:t,scrRef:e,contextMarker:n,getMarkerAction:r}){const{book:s,chapterNum:i,verseNum:o,verse:a,versificationStr:l}=e,u=_.useMemo(()=>({book:s,chapterNum:i,verseNum:o,verse:a,versificationStr:l}),[s,i,o,a,l]),[d]=ce();return pw(d),m.jsx(hw,{trigger:t,scriptureReference:u,contextMarker:n,getMarkerAction:r})}function pw(t){_.useEffect(()=>{if(!t.hasNodes([Ge,Ye]))throw new Error("UsjNodesMenuPlugin: VerseNode or ImmutableVerseNode not registered on editor!");const e={},n={};return Xe(t.registerNodeTransform(Ye,r=>lu(r,t,e)),t.registerNodeTransform(Ge,r=>lu(r,t,e)),t.registerMutationListener(Ye,r=>hu(r,t,e,n)),t.registerMutationListener(Ge,r=>hu(r,t,e,n)))},[t])}function lu(t,e,n){$p(ul)||Tl(e,t.getKey())&&yw(t,n)}const cu=2,gw=3,uu=4,mw=5;function yw(t,e){var n;const r=yl(t),s=r==null?void 0:r.getNumber();if(!s)return;const i=e[s];if(!i)return;let o=parseInt(t.getNumber()),a=((n=du(t.getNumber()))==null?void 0:n[cu])??"";i.forEach(l=>{const u=Te(l);if(!u)return;const d=u.getNumber(),f=parseInt(d),h=du(d),p=!!(h!=null&&h[gw]),y=p?parseInt(h[uu]):f;if(y<o||f>o||y===o&&a)return;const b=(h==null?void 0:h[cu])??"",C=(h==null?void 0:h[mw])??"",A=p?Na(parseInt(h[uu]),void 0):"";let v=`${b}`;v+=p?`-${A}${C}`:"";const E=Na(f,void 0);u.setNumber(`${E}${v}`),o=parseInt(p?A:E),a=p?C:b})}function du(t){return RegExp(/(\d+)([a-zA-Z]+)?(-(\d+)([a-zA-Z]+)?)?/).exec(t)}function hu(t,e,n,r){e.getEditorState().read(()=>{for(const[s,i]of t){const o=Te(s);if(ct(o)){if(i==="created"){const a=yl(o);if(!a)continue;const l=a.getNumber();n[l]||(n[l]=[]),n[l].push(s),r[s]=l}else if(i==="destroyed"){const a=r[s],l=n[a];if(!l)continue;const u=l.findIndex(d=>d===s);if(u===-1)continue;l.splice(u,1),Reflect.deleteProperty(r,s)}}}})}const Rf="formatted",bw="unformatted";let Il;function _w(t){const e=kw(t);if(!e)throw new Error(`Invalid view mode: ${t}`);Il=e}_w(Rf);const Sr=()=>Il;function kw(t){let e;switch(t){case Rf:e={markerMode:"hidden",noteMode:"collapsed",hasSpacing:!0,isFormattedFont:!0};break;case bw:e={markerMode:"editable",noteMode:"expanded",hasSpacing:!1,isFormattedFont:!1};break}return e}function vw(t){if(t)return t.markerMode==="editable"?Ge:Ye}function ww(t){const e=[],n=t??Il;return n&&(e.push(`${t_}${n.markerMode}`),n.hasSpacing&&e.push(Qb),n.isFormattedFont&&e.push(e_)),e}let qa;function xw(t){t&&(qa=t)}function Cw(t){return t.isEmpty()?md:Sw(t.toJSON())}function Sw(t){if(!t.root||!t.root.children)return;const e=t.root.children;if(e.length===1&&fl(e[0])&&(!e[0].children||e[0].children.length===0))return md;const n=Pf(e),r=sn(n);return r?{type:ss,version:is,content:r}:void 0}function Tw(t,e){const{type:n,marker:r,unknownAttributes:s}=t;let i;return t.code!==""&&(i=t.code),je({type:n,marker:r,code:i,...s,content:e})}function Ew(t){const{marker:e,number:n,sid:r,altnumber:s,pubnumber:i,unknownAttributes:o}=t;return je({type:wt.getType(),marker:e,number:n,sid:r,altnumber:s,pubnumber:i,...o})}function Ow(t,e){const{marker:n,sid:r,altnumber:s,pubnumber:i,unknownAttributes:o}=t,a=e&&typeof e[0]=="string"?e[0]:void 0;let{number:l}=t;return l=lf(n,a,l),je({type:wt.getType(),marker:n,number:l,sid:r,altnumber:s,pubnumber:i,...o})}function Mw(t){const{marker:e,sid:n,altnumber:r,pubnumber:s,unknownAttributes:i}=t,{text:o}=t;let{number:a}=t;return a=lf(e,o,a),je({type:Ge.getType(),marker:e,number:a,sid:n,altnumber:r,pubnumber:s,...i})}function Aw(t,e){const{type:n,marker:r,unknownAttributes:s}=t,i=r===""?void 0:r;return e==null||e.forEach((o,a)=>{typeof o=="string"&&o.startsWith(me)&&(e[a]=o.slice(1))}),je({type:n,marker:i,...s,content:e})}function jw(t,e){const{type:n,marker:r,unknownAttributes:s}=t;return je({type:n,marker:r,...s,content:e})}function Nw(t,e){const{type:n,marker:r,caller:s,category:i,unknownAttributes:o}=t;return je({type:n,marker:r,caller:s,category:i,...o,content:e})}function rr(t){const{type:e,marker:n,sid:r,eid:s,unknownAttributes:i}=t;return je({type:e,marker:n===""?void 0:n,sid:r,eid:s,...i})}function Iw(t){return t.text}function Rw(t,e){const{tag:n,marker:r,unknownAttributes:s}=t;return je({type:n,marker:r,...s,content:e})}function Pw(t){const{marker:e}=t;return{type:Fi,marker:e===""?void 0:e}}function fu(t,e){const n=t[t.length-1];n&&typeof n=="string"?t[t.length-1]=n+e:t.push(e)}function $w(t,e,n,r,s){const i=Pt.getType(),o=e.filter(a=>!n.includes(a));if(n.filter(a=>!e.includes(a)).forEach(a=>{const l=rr({type:i,marker:ir,eid:a});s.push(l)}),o.forEach(a=>{const l=rr({type:i,marker:$n,sid:a});s.push(l)}),e.length===0){const a=rr({type:i,marker:$n});s.push(a)}if(s.push(...t),e.length===0){const a=rr({type:i,marker:ir});s.push(a)}(!r||!U_(r))&&e.forEach(a=>{const l=rr({type:i,marker:ir,eid:a});s.push(l)})}function sn(t,e){const n=[];let r,s=[];return t.forEach((i,o)=>{const a=i,l=i,u=i,d=i,f=i,h=i,p=i,y=i;switch(i.type){case ut.getType():n.push(Tw(a,sn(a.children)));break;case en.getType():n.push(Ew(i));break;case wt.getType():n.push(Ow(l,sn(l.children)));break;case Ye.getType():case Ge.getType():n.push(Mw(i));break;case Ce.getType():n.push(Aw(u,sn(u.children)));break;case tt.getType():n.push(jw(d,sn(d.children)));break;case Pe.getType():n.push(Nw(f,sn(f.children,f.caller)));break;case bn.getType():case kt.getType():case Ad.getType():case Bn.getType():break;case Le.getType():if(r=sn(p.children),r){const b=p.typedIDs[cn];if(b)$w(r,b,s,t[o+1],n),s=b;else{const C=r.shift();C&&(typeof C=="string"?fu(n,C):n.push(C)),r.length>0&&n.push(...r)}}break;case Pt.getType():n.push(rr(i));break;case At.getType():h.text&&h.text!==me&&!h.text.startsWith(cl)&&(!e||h.text!==_l(e))&&fu(n,Iw(h));break;case Un.getType():n.push(Rw(y,sn(y.children)));break;case _n.getType():n.push(Pw(i));break;default:qa==null||qa.error(`Unexpected node type '${i.type}'!`)}}),n&&n.length>0?n:void 0}function Pf(t){const e=t.findIndex(n=>fl(n));if(e>=0){const n=t.slice(0,e),r=t[e].children,s=Pf(t.slice(e+1));t=[...n,...r,...s]}return t}const ua={initialize:xw,deserializeEditorState:Cw},pu=$f([]),qw={type:Ad.getType(),version:1};let Hi=[],Z,Oi,Da,ke;function Dw(t,e){Hi=[],Uw(t),Bw(e)}function Lw(t=0){}function Fw(t,e){Z=e??Sr();let n;return t?(t.type!==ss&&(ke==null||ke.warn(`This USJ type '${t.type}' didn't match the expected type '${ss}'.`)),t.version!==is&&(ke==null||ke.warn(`This USJ version '${t.version}' didn't match the expected version '${is}'.`)),t.content.length>0?n=Fa(Yr(t.content)):n=[pu]):n=[pu],Da==null||Da(Hi),{root:{children:n,direction:null,format:"",indent:0,type:"root",version:1}}}function Uw(t){t&&(Oi=t),t!=null&&t.addMissingComments&&(Da=t.addMissingComments)}function Bw(t){t&&(ke=t)}function Hw(t){return!t||t.length!==1||typeof t[0]!="string"?"":t[0]}function Ww(t){let{marker:e}=t;e!==fs&&(ke==null||ke.warn(`Unexpected book marker '${e}'!`)),e=e??fs;const{code:n}=t;(!n||!ut.isValidBookCode(n))&&(ke==null||ke.warn(`Unexpected book code '${n}'!`));const r=[];((Z==null?void 0:Z.markerMode)==="editable"||(Z==null?void 0:Z.markerMode)==="visible")&&r.push(Ln("marker",tn(e)+" "+n+me));const s=Hw(t.content);s&&r.push(hn(s));const i=$e(t);return je({type:ut.getType(),marker:e,code:n??"",unknownAttributes:i,children:r,direction:null,format:"",indent:0,version:Bh})}function zw(t){let{marker:e}=t;e!==$i&&(ke==null||ke.warn(`Unexpected chapter marker '${e}'!`)),e=e??$i;const{number:n,sid:r,altnumber:s,pubnumber:i}=t,o=$e(t);let a;return(Z==null?void 0:Z.markerMode)==="visible"&&(a=!0),(Z==null?void 0:Z.markerMode)==="editable"?je({type:wt.getType(),marker:e,number:n??"",sid:r,altnumber:s,pubnumber:i,unknownAttributes:o,children:[hn(Ts(e,n)??"")],direction:null,format:"",indent:0,version:zh}):je({type:en.getType(),marker:e,number:n??"",showMarker:a,sid:r,altnumber:s,pubnumber:i,unknownAttributes:o,version:Yh})}function Kw(t){let{marker:e}=t;e!==qi&&(ke==null||ke.warn(`Unexpected verse marker '${e}'!`)),e=e??qi;const{number:n,sid:r,altnumber:s,pubnumber:i}=t,o=(vw(Z)??Ye).getType(),a=(Z==null?void 0:Z.markerMode)==="editable"?sf:bf;let l,u;(Z==null?void 0:Z.markerMode)==="editable"?l=Ts(e,n):(Z==null?void 0:Z.markerMode)==="visible"&&(u=!0);const d=$e(t);return je({type:o,text:l,marker:e,number:n??"",sid:r,altnumber:s,pubnumber:i,showMarker:u,unknownAttributes:d,version:a})}function Jw(t,e=[]){let{marker:n}=t;Ce.isValidMarker(n)||ke==null||ke.warn(`Unexpected char marker '${n}'!`),n=n??"",(Z==null?void 0:Z.markerMode)==="editable"&&e.forEach(s=>{bl(s)&&(s.text=me+s.text)}),e.length===0&&e.push(hn(Xt));const r=$e(t);return je({type:Ce.getType(),marker:n,unknownAttributes:r,children:[...e],direction:null,format:"",indent:0,textFormat:0,textStyle:"",version:Gh})}function $f(t){return{type:dn.getType(),children:t,direction:null,format:"",indent:0,textFormat:0,textStyle:"",version:Qh}}function Vw(t,e=[]){let{marker:n}=t;tt.isValidMarker(n)||ke==null||ke.warn(`Unexpected para marker '${n}'!`),n=n??eo;const r=[];(Z==null?void 0:Z.markerMode)==="editable"?r.push(mr(n),hn(me)):(Z==null?void 0:Z.markerMode)==="visible"&&r.push(Ln("marker",tn(n)+me)),r.push(...e);const s=$e(t);return je({type:tt.getType(),marker:n,unknownAttributes:s,children:r,direction:null,format:"",indent:0,textFormat:0,textStyle:"",version:rf})}function Gw(t,e){const n=N_(e);let r=()=>{};return Oi!=null&&Oi.noteCallerOnClick&&(r=Oi.noteCallerOnClick),je({type:kt.getType(),caller:t,previewText:n,onClick:r,version:Tf})}function Yw(t,e){let{marker:n}=t;Pe.isValidMarker(n)||ke==null||ke.warn(`Unexpected note marker '${n}'!`),n=n??pl;const{category:r}=t,s=t.caller??"*",i=(Z==null?void 0:Z.noteMode)!=="expanded",o=$e(t);let a,l;(Z==null?void 0:Z.markerMode)==="editable"?(a=mr(n),l=mr(n,"closing")):(Z==null?void 0:Z.markerMode)==="visible"&&(a=Ln("marker",tn(n)+me),l=Ln("marker",fr(n)+me));const u=[];let d;if(a&&u.push(a),(Z==null?void 0:Z.markerMode)==="editable")d=hn(_l(s)),u.push(d,...e);else{const f=hn(me);d=Gw(s,e),u.push(d,f,...e.flatMap(Xw(f)))}return l&&u.push(l),je({type:Pe.getType(),marker:n,caller:s,isCollapsed:i,category:r,unknownAttributes:o,children:u,direction:null,format:"",indent:0,version:nf})}function Xw(t){return e=>z_(e)?[e]:[e,t]}function Zw(t){let{marker:e}=t;(!e||!Pt.isValidMarker(e))&&(ke==null||ke.warn(`Unexpected milestone marker '${e}'!`)),e=e??"";const{sid:n,eid:r}=t,s=$e(t);return je({type:Pt.getType(),marker:e,sid:n,eid:r,unknownAttributes:s,version:ef})}function gu(t,e=[]){return{type:Le.getType(),typedIDs:{[cn]:e},children:t,direction:null,format:"",indent:0,version:1}}function Qw(t,e){const{marker:n}=t,r=t.type,s=$e(t),i=[...e];return i.forEach(o=>{bl(o)&&(o.mode="token")}),je({type:Un.getType(),tag:r,marker:n,unknownAttributes:s,children:i,direction:null,format:"",indent:0,version:Fh})}function ex(t){return{type:_n.getType(),marker:t,version:pf}}function mr(t,e="opening"){return{type:Bn.getType(),marker:t,markerSyntax:e,text:"",detail:0,format:0,mode:"normal",style:"",version:1}}function hn(t,e="normal"){return{type:At.getType(),text:t,detail:0,format:0,mode:e,style:"",version:1}}function Ln(t,e){return{type:bn.getType(),text:e,textType:t,version:ff}}function mu(t,e){(Z==null?void 0:Z.markerMode)==="editable"?e.push(mr(t)):(Z==null?void 0:Z.markerMode)==="visible"&&e.push(Ln("marker",tn(t)))}function yu(t,e,n=!1){Ce.isValidFootnoteMarker(t)||Ce.isValidCrossReferenceMarker(t)||((Z==null?void 0:Z.markerMode)==="editable"?n?e.push(mr("","selfClosing")):e.push(mr(t,"closing")):(Z==null?void 0:Z.markerMode)==="visible"&&e.push(Ln("marker",fr(n?"":t))))}function tx(t,e){if(t.type!=="ms")return;const n=[];if(t.sid&&n.push(`sid="${t.sid}"`),t.eid&&n.push(`eid="${t.eid}"`),n.length<=0)return;const r=cl+n.join(" ");(Z==null?void 0:Z.markerMode)==="editable"?e.push(hn(r)):(Z==null?void 0:Z.markerMode)==="visible"&&e.push(Ln("attribute",r))}function bu(t,e){return t.length<=0||e===0?t:t.map(n=>n-e)}function nx(t,e){const n=t.indexOf(e,0);n>-1&&t.splice(n,1)}function _u(t,e){e.marker===$n&&e.sid!==void 0&&t.push(e.sid),e.marker===ir&&e.eid!==void 0&&nx(t,e.eid)}function La(t,e,n=!1,r=[]){if(e.length<=0||e[0]>=t.length)return t;const s=e.shift(),i=e.length>0?e.shift():t.length-1;if(s===void 0||i===void 0||i>=t.length||t.length<=0)return t;const o=t.slice(0,s),a=n?[gu(o,[...r])]:o,l=t[s];_u(r,l);const u=La(t.slice(s+1,i),bu(e,s+1),l.marker===$n,r),d=gu(u,[...r]),f=t[i];_u(r,f);const h=La(t.slice(i+1),bu(e,i+1),f.marker===$n,r);return[...a,d,...h]}function Yr(t){const e=[],n=[];return t==null||t.forEach(r=>{if(typeof r=="string")r&&n.push(hn(r));else if(!r.type)ke==null||ke.error("Marker type is missing!");else switch(r.type){case ut.getType():n.push(Ww(r));break;case wt.getType():n.push(zw(r));break;case Ge.getType():Z!=null&&Z.hasSpacing||n.push(qw),n.push(Kw(r));break;case Ce.getType():mu(r.marker??"",n),n.push(Jw(r,Yr(r.content))),yu(r.marker??"",n);break;case tt.getType():n.push(Vw(r,Yr(r.content)));break;case Pe.getType():n.push(Yw(r,Yr(r.content)));break;case Pt.getType():f_(r.marker??"")&&(e.push(n.length),r.sid!==void 0&&(Hi==null||Hi.push(r.sid))),n.push(Zw(r)),mu(r.marker??"",n),tx(r,n),yu(r.marker??"",n,!0);break;case _n.getType():n.push(ex(r.marker??""));break;default:ke==null||ke.warn(`Unknown type-marker '${r.type}-${r.marker}'!`),n.push(Qw(r,Yr(r.content)))}}),La(n,e)}function Fa(t){const e=t.findIndex(n=>Zb(n)||v_(n)||__(n));if(e>=0){const n=Fa(t.slice(0,e)),r=t[e],s=Fa(t.slice(e+1));return[...n,r,...s]}else if(t.some(n=>"text"in n&&"mode"in n||ek(n)))return[$f(t)];return t}const Ua={initialize:Dw,reset:Lw,serializeEditorState:Fw},ai=t=>{if(!Pe.isValidMarker(t)||!t.includes("f"))throw new Error(`Invalid footnote marker '${t}'`);return{action:e=>{const{chapterNum:n,verseNum:r}=e.reference,s=[];return n!==void 0&&r!==void 0&&s.push({type:"char",marker:"fr",content:[`${n}:${r}`]}),e.noteText&&s.push({type:"char",marker:"fq",content:[e.noteText]}),s.push({type:"char",marker:"ft"}),[{type:"note",marker:t,caller:Rt,content:s}]}}},ku=t=>{if(!Pe.isValidMarker(t)||!t.includes("x"))throw new Error(`Invalid cross-reference marker '${t}'`);return{action:e=>{const{chapterNum:n,verseNum:r}=e.reference,s=[];return n!==void 0&&r!==void 0&&s.push({type:"char",marker:"xo",content:[`${n}:${r}`]}),e.noteText&&s.push({type:"char",marker:"xq",content:[e.noteText]}),s.push({type:"char",marker:"xt"}),[{type:"note",marker:t,caller:hr,content:s}]}}},rx={c:{action:t=>{const{chapterNum:e}=t.reference;return[{type:"chapter",marker:"c",number:`${e+1}`}]}},v:{action:t=>{const{verseNum:e,verse:n}=t.reference;return[{type:"verse",marker:"v",number:`${Na(e,n)}`}]}},f:ai("f"),fe:ai("fe"),ef:ai("ef"),efe:ai("efe"),x:ku("x"),ex:ku("ex")};function sx(t,e,n,r,s){const i=ix(t);return{action:o=>{o.editor.update(()=>{var a;const l=re();X(l)&&(o.noteText=l.getTextContent());const u=(a=i==null?void 0:i.action)==null?void 0:a.call(i,o);if(!u)return;const d=Vc(u,Ua,r),f=ra(d);if(X(l)){const h=l.anchor.getNode();if(oe(f))_f(f,l,r),f.getIsCollapsed()||(e.current=f.getKey());else if(l.getTextContent().length>0)ox(l,()=>ra(d));else if(we(f)&&!f.isInline()){const p=l.insertParagraph();if(p){const y=p.getChildren();f.append(...y),p.replace(f),f.selectStart()}}else if(ee(h)&&!Es(h)&&oe(h.getParent())&&l.isCollapsed()){let p=h.insertAfter(f);if(Li(f)){const y={...r||Sr(),markerMode:"hidden"},b=Vc(u,Ua,y),C=ra(b);p=p.insertAfter(C)}p.insertAfter(ve(me))}else{l.insertNodes([f]),dx(f);const p=f.getNextSibling();p?p.selectStart():f.selectStart()}}else l==null||l.insertNodes([f])},s)},label:i==null?void 0:i.label}}function ix(t){let e=rx[t];return e||(tt.isValidMarker(t)?e={action:()=>[{type:tt.getType(),marker:t,content:[]}]}:Ce.isValidMarker(t)&&(e={action:()=>[{type:Ce.getType(),marker:t}]})),e}function ox(t,e){const n=t.getNodes(),[r,s]=ax(t);let i;n.forEach((o,a)=>{if(we(i)&&i.isParentOf(o))return;const l=lx(o,a===0,a===n.length-1,r,s);if(!l){i=void 0;return}i||(i=e(),l.insertBefore(i)),ux(l,i)}),(ee(i)||we(i))&&i.selectEnd()}function ax(t){const e=t.anchor.offset,n=t.focus.offset;return t.isBackward()?[n,e]:[e,n]}function lx(t,e,n,r,s){if(!(Ee(t)||oe(t)||oe(t.getParent()))){if(ee(t))return cx(t,e,n,r,s);if(we(t)&&t.isInline())return t}}function cx(t,e,n,r,s){const i=t.getTextContentSize(),o=e?r:0,a=n?s:i;if(o===0&&a===0)return;const l=t.splitText(o,a);return l.length===1?l[0]:l.length===3||a===i?l[1]:l[0]}function ux(t,e){var n;if(ee(e)){const r=vu(t,e);e.setTextContent(r),t.remove()}else if(we(e)){const r=e.getChildrenSize();e.append(t);for(let s=0;s<r;s++)(n=e.getFirstChild())==null||n.remove();vu(t,e)}}function vu(t,e){let n=t.getTextContent();if(ee(t)&&e.isInline()&&n.startsWith(" ")){n=n.trimStart(),t.setTextContent(n);const r=e.getPreviousSibling();Sl(r),ee(r)||e.insertBefore(ve(" "))}return n}function dx(t){ct(t)&&(Sl(t.getPreviousSibling()),wf(t.getNextSibling()))}const qf={chapter:"chapter",verse:"verse",char:"char",para:"para",typedMark:"editor-typed-mark",typedMarkOverlap:"editor-typed-markOverlap",mark:"editor-mark",markOverlap:"editor-markOverlap",placeholder:"editor-placeholder",paragraph:"editor-paragraph",quote:"editor-quote",heading:{h1:"editor-heading-h1",h2:"editor-heading-h2",h3:"editor-heading-h3",h4:"editor-heading-h4",h5:"editor-heading-h5"},list:{nested:{listitem:"editor-nested-listitem"},ol:"editor-list-ol",ul:"editor-list-ul",listitem:"editor-listitem"},image:"editor-image",link:"editor-link",text:{bold:"editor-text-bold",italic:"editor-text-italic",overflowed:"editor-text-overflowed",hashtag:"editor-text-hashtag",underline:"editor-text-underline",strikethrough:"editor-text-strikethrough",underlineStrikethrough:"editor-text-underlineStrikethrough"}};function hx({options:t,editedUsjRef:e,usj:n,setUsj:r}){const{view:s,nodes:i}=t||{},{hasSpacing:o,isFormattedFont:a,markerMode:l}=s||{};return _.useEffect(()=>{e.current&&!zt(e.current,n)&&r(e.current)},[e,o,a,l,i,r,n]),null}function fx({scrRef:t,onScrRefChange:e}){const[n]=ce(),r=_.useRef(!1),s=_.useRef(!1),{book:i,chapterNum:o,verseNum:a}=t;return _.useEffect(()=>n.registerMutationListener(ut,l=>{n.update(()=>{for(const[u,d]of l){const f=Te(u);f&&It(f)&&d==="created"&&wu(o,a,s)}},{tag:Ma})},{skipInitialization:!0}),[n,o,a]),_.useEffect(()=>{r.current?r.current=!1:n.update(()=>wu(o,a,s),{tag:Ma})},[n,o,a]),_.useEffect(()=>n.registerCommand(_s,()=>(s.current?s.current=!1:px(i,o,a,e,r),!1),yr),[n,i,o,a,e]),null}function wu(t,e,n){var r;const s=uf(re()),i=(r=vf(s))==null?void 0:r.getNumber();if(R_(i)&&vl(e,i))return;const o=$t().getChildren(),a=w_(o,t),l=j_(o,a),u=x_(l,!!a);if(u&&!a||!a)return;A_(l,u);const d=ak(l,e);if(d){if(Ke(d)){const f=d.getFirstChild();ee(f)?f.select(0,0):d.select(0,0)}else d.selectNext(0,0);n.current=!0}}function px(t,e,n,r,s){const i=uf(re());if(!i)return;const o=yl(i),a=parseInt((o==null?void 0:o.getNumber())??"1",10),l=vf(i),u=l==null?void 0:l.getNumber(),d=parseInt(u??"0",10),f=u?vl(n,u):n===d;if(s.current=!!(o&&a!==e||!f),s.current){const h={book:t,chapterNum:a,verseNum:d};u!=null&&d.toString()!==u&&(h.verse=u),r(h)}}function gx(t){return It(t)?`${t.__code}`:dl(t)?`${t.__marker} "${t.__number}"`:pe(t)?`${t.__marker}`:Ss(t)?`${t.__marker} "${t.__number}"`:kn(t)?`${t.__caller}`:Cr(t)?`${t.__marker} "${t.__number}"`:oe(t)?`${t.__marker} "${t.__caller}"`+(t.__isCollapsed?" (collapsed)":" (expanded)"):Ke(t)?`${t.__marker}`:Ee(t)?`ids: [ ${JSON.stringify(t.getTypedIDs())} ]`:ml(t)?`${t.__marker} "${t.__number}"`:""}function mx(){const[t]=ce();return m.jsx($m,{viewClassName:"tree-view-output",treeTypeButtonClassName:"debug-treetype-button",timeTravelPanelClassName:"debug-timetravel-panel",timeTravelButtonClassName:"debug-timetravel-button",timeTravelPanelSliderClassName:"debug-timetravel-panel-slider",timeTravelPanelButtonClassName:"debug-timetravel-panel-button",customPrintNode:gx,editor:t})}const Df=_.createContext(null),xu=4;function yx({children:t,className:e,onClick:n,title:r}){const s=_.useRef(null),i=_.useContext(Df);if(i===null)throw new Error("DropDownItem must be used within a DropDown");const{registerItem:o}=i;return _.useEffect(()=>{s&&s.current&&o(s)},[s,o]),m.jsx("button",{className:e,onClick:n,ref:s,title:r,type:"button",children:t})}function bx({children:t,dropDownRef:e,onClose:n}){const[r,s]=_.useState(),[i,o]=_.useState(),a=_.useCallback(d=>{s(f=>f?[...f,d]:[d])},[s]),l=d=>{if(!r)return;const f=d.key;["Escape","ArrowUp","ArrowDown","Tab"].includes(f)&&d.preventDefault(),f==="Escape"||f==="Tab"?n():f==="ArrowUp"?o(h=>{if(!h)return r[0];const p=r.indexOf(h)-1;return r[p===-1?r.length-1:p]}):f==="ArrowDown"&&o(h=>h?r[r.indexOf(h)+1]:r[0])},u=_.useMemo(()=>({registerItem:a}),[a]);return _.useEffect(()=>{r&&!i&&o(r[0]),i&&i.current&&i.current.focus()},[r,i]),m.jsx(Df.Provider,{value:u,children:m.jsx("div",{className:"dropdown",ref:e,onKeyDown:l,children:t})})}function _x({disabled:t=!1,buttonLabel:e,buttonAriaLabel:n,buttonClassName:r,buttonIconClassName:s,children:i,stopCloseOnClickSelf:o}){const a=_.useRef(null),l=_.useRef(null),[u,d]=_.useState(!1),f=()=>{d(!1),l&&l.current&&l.current.focus()};return _.useEffect(()=>{const h=l.current,p=a.current;if(u&&h!==null&&p!==null){const{top:y,left:b}=h.getBoundingClientRect();p.style.top=`${y+h.offsetHeight+xu}px`,p.style.left=`${Math.min(b,window.innerWidth-p.offsetWidth-20)}px`}},[a,l,u]),_.useEffect(()=>{const h=l.current;if(h!==null&&u){const p=y=>{const b=y.target;o&&a.current&&a.current.contains(b)||h.contains(b)||d(!1)};return document.addEventListener("click",p),()=>{document.removeEventListener("click",p)}}return()=>{}},[a,l,u,o]),_.useEffect(()=>{const h=()=>{if(u){const p=l.current,y=a.current;if(p!==null&&y!==null){const{top:b}=p.getBoundingClientRect(),C=b+p.offsetHeight+xu;C!==y.getBoundingClientRect().top&&(y.style.top=`${C}px`)}}};return document.addEventListener("scroll",h),()=>{document.removeEventListener("scroll",h)}},[l,a,u]),m.jsxs(m.Fragment,{children:[m.jsxs("button",{type:"button",disabled:t,"aria-label":n||e,className:r,onClick:()=>d(!u),ref:l,children:[s&&m.jsx("span",{className:s}),e&&m.jsx("span",{className:"text dropdown-button-text",children:e}),m.jsx("i",{className:"chevron-down"})]}),u&&yt.createPortal(m.jsx(bx,{dropDownRef:a,onClose:f,children:i}),document.body)]})}const Ba={m:"m - Paragraph - Margin - No First Line Indent",ms:"ms - Heading - Major Section Level 1",nb:"nb - Paragraph - No Break with Previous Paragraph",p:"p - Paragraph - Normal - First Line Indent",pi:"pi - Paragraph - Indented - Level 1 - First Line Indent",q1:"q1 - Poetry - Indent Level 1",q2:"q2 - Poetry - Indent Level 2",r:"r - Heading - Parallel References",s:"s - Heading - Section Level 1"},Ha={...Ba,ide:"ide - File - Encoding",h:"h - File - Header",h1:"h1 - File - Header",h2:"h2 - File - Left Header",h3:"h3 - File - Right Header",toc1:"toc1 - File - Long Table of Contents Text",toc2:"toc2 - File - Short Table of Contents Text",toc3:"toc3 - File - Book Abbreviation",cl:"cl - Chapter - Publishing Label",mt:"mt - Title - Major Title Level 1",mt1:"mt1 - Title - Major Title Level 1",mt2:"mt2 - Title - Major Title Level 2",mt3:"mt3 - Title - Major Title Level 3",mt4:"mt4 - Title - Major Title Level 4",ms1:"ms1 - Heading - Major Section Level 1",ms2:"ms2 - Heading - Major Section Level 2",ms3:"ms3 - Heading - Major Section Level 3",b:"b - Poetry - Stanza Break (Blank Line)"};function kx({editorRef:t,blockMarker:e,disabled:n=!1}){return m.jsx(_x,{disabled:n,buttonClassName:"toolbar-item block-controls",buttonIconClassName:"icon block-marker "+vx(e),buttonLabel:wx(e),buttonAriaLabel:"Formatting options for block type",children:Object.keys(Ba).map(r=>m.jsxs(yx,{className:"item block-marker "+xx(e===r),onClick:()=>{var s;return(s=t.current)==null?void 0:s.formatPara(r)},children:[m.jsx("i",{className:"icon block-marker "+r}),m.jsx("span",{className:"text usfm_"+r,children:Ba[r]})]},r))})}function vx(t){return t&&t in Ha?t:"ban"}function wx(t){return t&&t in Ha?Ha[t]:"No Style"}function xx(t){return t?"active dropdown-item-active":""}function Cu(){return m.jsx("div",{className:"divider"})}const Cx=_.forwardRef(function({editorRef:t,isReadonly:e=!1,onStateChange:n},r){const[s]=ce(),[i,o]=_.useState(s),[a,l]=_.useState(),[u,d]=_.useState(!1),[f,h]=_.useState(!1),p=_.useCallback(({canUndo:y,canRedo:b,blockMarker:C,contextMarker:A})=>{d(y),h(b),l(C),n==null||n({canUndo:y,canRedo:b,blockMarker:C,contextMarker:A})},[n]);return _.useEffect(()=>s.registerCommand(_s,(y,b)=>(o(b),!1),Xr),[s]),m.jsxs(m.Fragment,{children:[m.jsx(If,{onStateChange:p}),m.jsxs("div",{className:"toolbar",children:[m.jsx("button",{disabled:!u||e,onClick:()=>{i.dispatchCommand(Ja,void 0)},title:fa?"Undo (Z)":"Undo (Ctrl+Z)",type:"button",className:"toolbar-item spaced","aria-label":"Undo",children:m.jsx("i",{className:"format undo"})}),m.jsx("button",{disabled:!f||e,onClick:()=>{i.dispatchCommand(Ka,void 0)},title:fa?"Redo (Y)":"Redo (Ctrl+Y)",type:"button",className:"toolbar-item","aria-label":"Redo",children:m.jsx("i",{className:"format redo"})}),m.jsx(Cu,{}),i===s&&m.jsxs(m.Fragment,{children:[m.jsx(kx,{editorRef:t,blockMarker:a,disabled:e}),m.jsx(Cu,{})]}),m.jsx("div",{ref:r,className:"end-container"})]})]})}),Su={namespace:"platformEditor",theme:qf,editable:!0,editorState:void 0,onError(t){throw t},nodes:[Le,...Fk]},Sx=Sr(),Tx={},Ex={};function Ox(){return m.jsx("div",{className:"editor-placeholder",children:"Enter some Scripture..."})}const Lf=_.forwardRef(function({defaultUsj:t,scrRef:e,onScrRefChange:n,onSelectionChange:r,onUsjChange:s,onStateChange:i,options:o,logger:a,children:l},u){const d=_.useRef(null),f=_.useRef(null),h=_.useRef(null),p=_.useRef(t),y=_.useRef(),[b,C]=_.useState(t),[A,v]=_.useState(0),[E,j]=_.useState(),{isReadonly:$=!1,hasExternalUI:q=!1,hasSpellCheck:B=!1,textDirection:U="ltr",markerMenuTrigger:H="\\",view:W=Sx,nodes:k=Tx,debug:I=!1}=o??Ex;Su.editable=!$,ua.initialize(a),_.useImperativeHandle(u,()=>({focus(){var O;(O=d.current)==null||O.focus()},undo(){var O;(O=d.current)==null||O.dispatchCommand(Ja,void 0)},redo(){var O;(O=d.current)==null||O.dispatchCommand(Ka,void 0)},cut(){var O;(O=d.current)==null||O.dispatchCommand(Ki,null)},copy(){var O;(O=d.current)==null||O.dispatchCommand(Ji,null)},paste(){d.current&&jl(d.current)},pastePlainText(){d.current&&Nl(d.current)},getUsj(){return p.current},setUsj(O){if(!zt(p.current,O)){p.current=O;const M=zt(b,O);C(O),M&&v(N=>N+1)}},applyUpdate(O,M="remote"){var N,D;(N=d.current)==null||N.update(()=>{M==="remote"&&jp(ja),cv(O,W,k,a)},{discrete:!0});const L=(D=d.current)==null?void 0:D.getEditorState();if(!L)return;const F=ua.deserializeEditorState(L);if(F){const J=!zt(p.current,F);if(J&&(p.current=F),J||!zt(b,F)){const K=eu(O,L);s==null||s(F,O,M,K)}}},replaceEmbedUpdate(O,M){var N;const D=(N=d.current)==null?void 0:N.read(()=>mk(O,M));D&&this.applyUpdate(D)},getSelection(){var O;return(O=d.current)==null?void 0:O.read(mf)},setSelection(O){var M;(M=d.current)==null||M.update(()=>{const N=xl(O);N!==void 0&&Sd(N)},{tag:Wh})},setAnnotation(O,M,N,D,L){var F;(F=f.current)==null||F.setAnnotation(O,Kc(M),N,D,L)},removeAnnotation(O,M){var N;(N=f.current)==null||N.removeAnnotation(Kc(O),M)},formatPara(O){var M;(M=d.current)==null||M.update(()=>{const N=re();X(N)&&Ap(N,()=>ps(O))})},getElementByKey(O){var M;return(M=d.current)==null?void 0:M.read(()=>{var N;return((N=d.current)==null?void 0:N.getElementByKey(O))??void 0})},insertNote(O,M,N){var D;(D=d.current)==null||D.update(()=>{const L=tk(O,M,N,e,W,k,a);L&&!L.getIsCollapsed()&&(y.current=L.getKey())})},selectNote(O){var M;(M=d.current)==null||M.update(()=>{const N=Zc(O);N&&(rk(N,W),N.getIsCollapsed()||(y.current=N.getKey()))})},getNoteOps(O){var M;return(M=d.current)==null?void 0:M.read(()=>{const N=Zc(O);if(N)return El(N)})},get toolbarEndRef(){return h}}));const x=_.useCallback((O,M,N,D)=>{if(n_.some(F=>N.has(F)))return;const L=ua.deserializeEditorState(O);if(L){const F=!zt(p.current,L);if(F&&(p.current=L),F||!zt(b,L)){const J=N.has(ja)?"remote":"local",K=eu(D,O);s==null||s(L,D,J,K)}}},[b,s]),P=_.useCallback(O=>{j(O.contextMarker),i==null||i(O)},[i]);return m.jsxs(Td,{initialConfig:Su,children:[m.jsx(Uv,{isEditable:!$}),m.jsxs("div",{className:"editor-container",children:[q?m.jsx(If,{onStateChange:P}):m.jsx("div",{className:"editor-toolbar-container"+($?"-readonly":"-editable"),children:m.jsx(Cx,{ref:h,editorRef:u,isReadonly:$,onStateChange:P})}),m.jsxs("div",{className:"editor-inner",children:[m.jsx(Gd,{editorRef:d}),m.jsx(Np,{contentEditable:m.jsx(Od,{className:`editor-input usfm ${ww(W).join(" ")}`,spellCheck:B}),placeholder:m.jsx(Ox,{}),ErrorBoundary:Ed}),m.jsx(Yd,{}),e&&n&&m.jsx(fx,{scrRef:e,onScrRefChange:n}),e&&m.jsx(fw,{trigger:H,scrRef:e,contextMarker:E,getMarkerAction:(O,M)=>sx(O,y,M,W)}),m.jsx(hx,{options:{view:W,nodes:k},editedUsjRef:p,usj:b,setUsj:C}),m.jsx(Bv,{scripture:b,nodeOptions:k,editorAdaptor:Ua,viewOptions:W,logger:a},A),m.jsx(tw,{onChange:r}),m.jsx(av,{onChange:x,ignoreSelectionChange:!0,ignoreHistoryMergeTagChange:!0}),m.jsx(ov,{ref:f,logger:a}),m.jsx(Sv,{viewOptions:W}),m.jsx(jv,{}),m.jsx(Pv,{}),m.jsx($v,{logger:a}),m.jsx(Fv,{}),m.jsx(Hv,{expandedNoteKeyRef:y,nodeOptions:k,viewOptions:W,logger:a}),m.jsx(nw,{}),m.jsx(iw,{textDirection:U}),m.jsx(lw,{}),l]}),I&&m.jsx(mx,{})]})]})}),Tr=_.forwardRef(function(t,e){const{children:n,...r}=t;return m.jsx(Lf,{ref:e,...r})});function Ff(){return Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5)}function Wi(t,e,n,r,s){return{author:e,content:t,deleted:s===void 0?!1:s,id:n===void 0?Ff():n,timeStamp:r===void 0?performance.timeOrigin+performance.now():r,type:"comment"}}function Uf(t,e,n){return{comments:e,id:n===void 0?Ff():n,quote:t,type:"thread"}}function Tu(t){return{comments:Array.from(t.comments),id:t.id,quote:t.quote,type:"thread"}}function Mx(t){return{author:t.author,content:"[Deleted Comment]",deleted:!0,id:t.id,timeStamp:t.timeStamp,type:"comment"}}function da(t){const e=t._changeListeners;for(const n of e)n()}class Ax{constructor(e,n){z(this,"_editor"),z(this,"_comments"),z(this,"_changeListeners"),z(this,"_collabProvider"),z(this,"logger"),this._comments=[],this._editor=e,this.logger=n,this._collabProvider=null,this._changeListeners=new Set}isCollaborative(){return this._collabProvider!==null}getComments(){return this._comments}setComments(e){this._comments=e,da(this)}addComment(e,n,r){const s=Array.from(this._comments),i=this._getCollabComments();if(n!==void 0&&e.type==="comment")for(let o=0;o<s.length;o++){const a=s[o];if(a.type==="thread"&&a.id===n.id){const l=Tu(a);s.splice(o,1,l);const u=r!==void 0?r:l.comments.length;if(this.isCollaborative()&&i!==null){const d=i.get(o).get("comments");this._withRemoteTransaction(()=>{const f=this._createCollabSharedMap(e);d.insert(u,[f])})}l.comments.splice(u,0,e);break}}else{const o=r!==void 0?r:s.length;this.isCollaborative()&&i!==null&&this._withRemoteTransaction(()=>{const a=this._createCollabSharedMap(e);i.insert(o,[a])}),s.splice(o,0,e)}this._comments=s,da(this)}deleteCommentOrThread(e,n){const r=Array.from(this._comments),s=this._getCollabComments();let i=null;if(n!==void 0)for(let o=0;o<r.length;o++){const a=r[o];if(a.type==="thread"&&a.id===n.id){const l=Tu(a);r.splice(o,1,l);const u=l.comments;if(i=u.indexOf(e),this.isCollaborative()&&s!==null){const d=s.get(o).get("comments"),f=i;this._withRemoteTransaction(()=>{d.delete(f)})}u.splice(i,1);break}}else i=r.indexOf(e),this.isCollaborative()&&s!==null&&this._withRemoteTransaction(()=>{s.delete(i)}),r.splice(i,1);return this._comments=r,da(this),e.type==="comment"?{index:i,markedComment:Mx(e)}:null}registerOnChange(e){const n=this._changeListeners;return n.add(e),()=>{n.delete(e)}}_withRemoteTransaction(e){const n=this._collabProvider;n!==null&&n.doc.transact(e,this)}_withLocalTransaction(e){const n=this._collabProvider;try{this._collabProvider=null,e()}finally{this._collabProvider=n}}_getCollabComments(){const e=this._collabProvider;return e!==null?e.doc.get("comments",jn):null}_createCollabSharedMap(e){const n=new cr,r=e.type,s=e.id;if(n.set("type",r),n.set("id",s),r==="comment")n.set("author",e.author),n.set("content",e.content),n.set("deleted",e.deleted),n.set("timeStamp",e.timeStamp);else{n.set("quote",e.quote);const i=new jn;e.comments.forEach((o,a)=>{const l=this._createCollabSharedMap(o);i.insert(a,[l])}),n.set("comments",i)}return n}registerCollaboration(e){this._collabProvider=e;const n=this._getCollabComments(),r=()=>{e.connect()},s=()=>{try{e.disconnect()}catch{}},i=this._editor.registerCommand(Jb,a=>{var l,u;return r!==void 0&&s!==void 0&&(a?((l=this.logger)==null||l.info("Comments connected!"),r()):((u=this.logger)==null||u.info("Comments disconnected!"),s())),!1},yr),o=(a,l)=>{if(l.origin!==this){for(const u of a)if(u instanceof jh){const d=u.target,f=u.delta;let h=0;for(const p of f){const y=p.insert,b=p.retain,C=p.delete,A=d.parent,v=d===n?void 0:A instanceof cr&&this._comments.find(E=>E.id===A.get("id"));if(Array.isArray(y)){const E=h;y.slice().reverse().forEach(j=>{const $=j.get("id"),q=j.get("type")==="thread"?Uf(j.get("quote"),j.get("comments").toArray().map(B=>Wi(B.get("content"),B.get("author"),B.get("id"),B.get("timeStamp"),B.get("deleted"))),$):Wi(j.get("content"),j.get("author"),$,j.get("timeStamp"),j.get("deleted"));this._withLocalTransaction(()=>{this.addComment(q,v,E)})})}else if(typeof b=="number")h+=b;else if(typeof C=="number")for(let E=0;E<C;E++){const j=v===void 0||v===!1?this._comments[h]:v.comments[h];this._withLocalTransaction(()=>{this.deleteCommentOrThread(j,v)}),h++}}}}};return n===null?()=>null:(n.observeDeep(o),r(),()=>{n.unobserveDeep(o),i(),this._collabProvider=null})}}function jx(t){const[e,n]=_.useState(t.getComments());return _.useEffect(()=>t.registerOnChange(()=>{n(t.getComments())}),[t]),e}function Nx({onClose:t,children:e,title:n,closeOnClickOutside:r}){const s=_.useRef(null);return _.useEffect(()=>{s.current!==null&&s.current.focus()},[]),_.useEffect(()=>{let i=null;const o=u=>{u.key==="Escape"&&t()},a=u=>{const d=u.target;s.current!==null&&!s.current.contains(d)&&r&&t()},l=s.current;return l!==null&&(i=l.parentElement,i!==null&&i.addEventListener("click",a)),window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o),i!==null&&(i==null||i.removeEventListener("click",a))}},[r,t]),m.jsx("div",{className:"Modal__overlay",role:"dialog",children:m.jsxs("div",{className:"Modal__modal",tabIndex:-1,ref:s,children:[m.jsx("h2",{className:"Modal__title",children:n}),m.jsx("button",{className:"Modal__closeButton","aria-label":"Close modal",type:"button",onClick:t,children:"X"}),m.jsx("div",{className:"Modal__content",children:e})]})})}function Ix({onClose:t,children:e,title:n,closeOnClickOutside:r=!1}){return yt.createPortal(m.jsx(Nx,{onClose:t,title:n,closeOnClickOutside:r,children:e}),document.body)}function Bf(){const[t,e]=_.useState(null),n=_.useCallback(()=>{e(null)},[]),r=_.useMemo(()=>{if(t===null)return null;const{title:i,content:o,closeOnClickOutside:a}=t;return m.jsx(Ix,{onClose:n,title:i,closeOnClickOutside:a,children:o})},[t,n]),s=_.useCallback((i,o,a=!1)=>{e({closeOnClickOutside:a,content:o(n),title:i})},[n]);return[r,s]}const Rx={...qf,paragraph:"CommentEditorTheme__paragraph"};function Px(...t){return t.filter(Boolean).join(" ")}function fn({"data-test-id":t,children:e,className:n,onClick:r,disabled:s,small:i,title:o}){return m.jsx("button",{disabled:s,className:Px("Button__root",s&&"Button__disabled",i&&"Button__small",n),onClick:r,title:o,"aria-label":o,...t&&{"data-test-id":t},children:e})}function $x({className:t}){return m.jsx(Od,{className:t||"ContentEditable__root"})}function qx({children:t,className:e}){return m.jsx("div",{className:e||"Placeholder__root",children:t})}const Eu=Va("INSERT_INLINE_COMMAND");function Dx({anchorKey:t,editor:e,showComments:n,onAddComment:r}){const s=_.useRef(null),i=_.useCallback(()=>{const o=s.current,a=e.getRootElement(),l=e.getElementByKey(t);if(o!==null&&a!==null&&l!==null){const{right:u}=a.getBoundingClientRect(),{top:d}=l.getBoundingClientRect();o.style.left=`${u-20}px`,o.style.top=`${d-30}px`}},[t,e]);return _.useEffect(()=>(window.addEventListener("resize",i),()=>{window.removeEventListener("resize",i)}),[e,i]),_.useLayoutEffect(()=>{i()},[t,e,n,i]),m.jsx("div",{className:"CommentPlugin_AddCommentBox",ref:s,children:m.jsx("button",{className:"CommentPlugin_AddCommentBox_button",onClick:r,children:m.jsx("i",{className:"icon add-comment"})})})}function Lx({onEscape:t}){const[e]=ce();return _.useEffect(()=>e.registerCommand(wd,n=>t(n),vi),[e,t]),null}function Hf({className:t,autoFocus:e,onEscape:n,onChange:r,editorRef:s,placeholder:i="Type a comment..."}){return m.jsx(Td,{initialConfig:{namespace:"Commenting",nodes:[],onError:o=>{throw o},theme:Rx},children:m.jsxs("div",{className:"CommentPlugin_CommentInputBox_EditorContainer",children:[m.jsx(ny,{contentEditable:m.jsx($x,{className:t}),placeholder:m.jsx(qx,{children:i}),ErrorBoundary:Ed}),m.jsx(Up,{onChange:r}),m.jsx(Yd,{}),e!==!1&&m.jsx(Bp,{}),m.jsx(Lx,{onEscape:n}),m.jsx(Hp,{}),s!==void 0&&m.jsx(Gd,{editorRef:s})]})})}function Wf(t,e){return _.useCallback((n,r)=>{n.read(()=>{t(Lp()),e(!Fp(r.isComposing(),!0))})},[e,t])}function Fx({editor:t,cancelAddComment:e,submitAddComment:n}){const[r,s]=_.useState(""),[i,o]=_.useState(!1),a=_.useRef(null),l=_.useMemo(()=>({container:document.createElement("div"),elements:[]}),[]),u=_.useRef(null),d=Kf(),f=_.useCallback(()=>{t.getEditorState().read(()=>{const b=re();if(X(b)){u.current=b.clone();const C=b.anchor,A=b.focus,v=qp(t,C.getNode(),C.offset,A.getNode(),A.offset),E=a.current;if(v!==null&&E!==null){const{left:j,bottom:$,width:q}=v.getBoundingClientRect(),B=Dp(t,v);let U=B.length===1?j+q/2-125:j-125;U<10&&(U=10),E.style.left=`${U}px`,E.style.top=`${$+20+(window.pageYOffset||document.documentElement.scrollTop)}px`;const H=B.length,{container:W}=l,k=l.elements,I=k.length;for(let x=0;x<H;x++){const P=B[x];let O=k[x];O===void 0&&(O=document.createElement("span"),k[x]=O,W.appendChild(O));const M=`position:absolute;top:${P.top+(window.pageYOffset||document.documentElement.scrollTop)}px;left:${P.left}px;height:${P.height}px;width:${P.width}px;background-color:rgba(255, 212, 0, 0.3);pointer-events:none;z-index:5;`;O.style.cssText=M}for(let x=I-1;x>=H;x--){const P=k[x];W.removeChild(P),k.pop()}}}})},[t,l]);_.useLayoutEffect(()=>{f();const b=l.container,C=document.body;return C!==null?(C.appendChild(b),()=>{C.removeChild(b)}):()=>{}},[l.container,f]),_.useEffect(()=>(window.addEventListener("resize",f),()=>{window.removeEventListener("resize",f)}),[f]);const h=b=>(b.preventDefault(),e(),!0),p=()=>{if(i){let b=t.getEditorState().read(()=>{const C=u.current;return C?C.getTextContent():""});b.length>100&&(b=b.slice(0,99)+""),n(Uf(b,[Wi(r,d)]),!0,void 0,u.current),u.current=null}},y=Wf(s,o);return m.jsxs("div",{className:"CommentPlugin_CommentInputBox",ref:a,children:[m.jsx(Hf,{className:"CommentPlugin_CommentInputBox_Editor",onEscape:h,onChange:y}),m.jsxs("div",{className:"CommentPlugin_CommentInputBox_Buttons",children:[m.jsx(fn,{onClick:e,className:"CommentPlugin_CommentInputBox_Button",children:"Cancel"}),m.jsx(fn,{onClick:p,disabled:!i,className:"CommentPlugin_CommentInputBox_Button primary",children:"Comment"})]})]})}function Ux({submitAddComment:t,thread:e,placeholder:n}){const[r,s]=_.useState(""),[i,o]=_.useState(!1),a=_.useRef(null),l=Kf(),u=Wf(s,o);return m.jsxs(m.Fragment,{children:[m.jsx(Hf,{className:"CommentPlugin_CommentsPanel_Editor",autoFocus:!1,onEscape:()=>!0,onChange:u,editorRef:a,placeholder:n}),m.jsx(fn,{className:"CommentPlugin_CommentsPanel_SendButton",onClick:()=>{if(i){t(Wi(r,l),!1,e);const d=a.current;d!==null&&d.dispatchCommand(_d,void 0)}},disabled:!i,children:m.jsx("i",{className:"send"})})]})}function zf({commentOrThread:t,deleteCommentOrThread:e,onClose:n,thread:r=void 0}){return m.jsxs(m.Fragment,{children:["Are you sure you want to delete this ",t.type,"?",m.jsxs("div",{className:"Modal__content",children:[m.jsx(fn,{onClick:()=>{e(t,r),n()},children:"Delete"})," ",m.jsx(fn,{onClick:()=>{n()},children:"Cancel"})]})]})}function Ou({comment:t,deleteComment:e,thread:n,rtf:r}){const s=Math.round((t.timeStamp-(performance.timeOrigin+performance.now()))/1e3),i=Math.round(s/60),[o,a]=Bf();return m.jsxs("li",{className:"CommentPlugin_CommentsPanel_List_Comment",children:[m.jsxs("div",{className:"CommentPlugin_CommentsPanel_List_Details",children:[m.jsx("span",{className:"CommentPlugin_CommentsPanel_List_Comment_Author",children:t.author}),m.jsxs("span",{className:"CommentPlugin_CommentsPanel_List_Comment_Time",children:[" ",s>-10?"Just now":r.format(i,"minute")]})]}),m.jsx("p",{className:t.deleted?"CommentPlugin_CommentsPanel_DeletedComment":"",children:t.content}),!t.deleted&&m.jsxs(m.Fragment,{children:[m.jsx(fn,{onClick:()=>{a("Delete Comment",l=>m.jsx(zf,{commentOrThread:t,deleteCommentOrThread:e,thread:n,onClose:l}))},className:"CommentPlugin_CommentsPanel_List_DeleteButton",children:m.jsx("i",{className:"delete"})}),o]})]})}function Bx({activeIDs:t,comments:e,deleteCommentOrThread:n,listRef:r,submitAddComment:s,markNodeMap:i}){const[o]=ce(),[a,l]=_.useState(0),[u,d]=Bf(),f=_.useMemo(()=>new Intl.RelativeTimeFormat("en",{localeMatcher:"best fit",numeric:"auto",style:"short"}),[]);return _.useEffect(()=>{const h=setTimeout(()=>{l(a+1)},1e4);return()=>{clearTimeout(h)}},[a]),m.jsx("ul",{className:"CommentPlugin_CommentsPanel_List",ref:r,children:e.map(h=>{const p=h.id;return h.type==="thread"?m.jsxs("li",{onClick:()=>{const y=i.get(p);if(y!==void 0&&(t===null||t.indexOf(p)===-1)){const b=document.activeElement;o.update(()=>{const C=Array.from(y)[0],A=Te(C);Ee(A)&&A.selectStart()},{onUpdate(){b!==null&&b.focus()}})}},className:`CommentPlugin_CommentsPanel_List_Thread ${i.has(p)?"interactive":""} ${t.indexOf(p)===-1?"":"active"}`,children:[m.jsxs("div",{className:"CommentPlugin_CommentsPanel_List_Thread_QuoteBox",children:[m.jsxs("blockquote",{className:"CommentPlugin_CommentsPanel_List_Thread_Quote",children:["> ",m.jsx("span",{children:h.quote})]}),m.jsx(fn,{onClick:()=>{d("Delete Thread",y=>m.jsx(zf,{commentOrThread:h,deleteCommentOrThread:n,onClose:y}))},className:"CommentPlugin_CommentsPanel_List_DeleteButton",children:m.jsx("i",{className:"delete"})}),u]}),m.jsx("ul",{className:"CommentPlugin_CommentsPanel_List_Thread_Comments",children:h.comments.map(y=>m.jsx(Ou,{comment:y,deleteComment:n,thread:h,rtf:f},y.id))}),m.jsx("div",{className:"CommentPlugin_CommentsPanel_List_Thread_Editor",children:m.jsx(Ux,{submitAddComment:s,thread:h,placeholder:"Reply to comment..."})})]},p):m.jsx(Ou,{comment:h,deleteComment:n,rtf:f},p)})})}function Hx({activeIDs:t,deleteCommentOrThread:e,comments:n,submitAddComment:r,markNodeMap:s}){const i=_.useRef(null),o=n.length===0;return m.jsxs("div",{className:"CommentPlugin_CommentsPanel",children:[m.jsx("h2",{className:"CommentPlugin_CommentsPanel_Heading",children:"Comments"}),o?m.jsx("div",{className:"CommentPlugin_CommentsPanel_Empty",children:"No Comments"}):m.jsx(Bx,{activeIDs:t,comments:n,deleteCommentOrThread:e,listRef:i,submitAddComment:r,markNodeMap:s})]})}function Kf(){const t=Xd(),{yjsDocMap:e,name:n}=t;return e.has("comments")?n:"Scripture User"}function Wx({providerFactory:t,setCommentStore:e,onChange:n,showCommentsContainerRef:r,commentContainerRef:s,logger:i}){const o=Xd(),[a]=ce(),l=_.useMemo(()=>{const U=new Ax(a,i);return n&&U.registerOnChange(n),e==null||e(U),U},[a,i,n,e]),u=jx(l),d=_.useMemo(()=>new Map,[]),[f,h]=_.useState(),[p,y]=_.useState([]),[b,C]=_.useState(!1),[A,v]=_.useState(!1),{yjsDocMap:E}=o;_.useEffect(()=>{if(t){const U=t("comments",E);return l.registerCollaboration(U)}return()=>{}},[l,t,E]);const j=_.useCallback(()=>{a.update(()=>{const U=re();U!==null&&(U.dirty=!0)}),C(!1)},[a]),$=_.useCallback((U,H)=>{if(U.type==="comment"){const W=l.deleteCommentOrThread(U,H);if(!W)return;const{markedComment:k,index:I}=W;l.addComment(k,H,I)}else{l.deleteCommentOrThread(U);const W=H!==void 0?H.id:U.id,k=d.get(W);k!==void 0&&setTimeout(()=>{a.update(()=>{for(const I of k){const x=Te(I);Ee(x)&&(x.deleteID(cn,W),x.hasNoIDsForEveryType()&&Di(x))}})})}},[l,a,d]),q=_.useCallback((U,H,W,k)=>{l.addComment(U,W),H&&(a.update(()=>{X(k)&&hf(k,cn,U.id)}),C(!1))},[l,a]);_.useEffect(()=>{const U=[];for(const H of p){const W=d.get(H);if(W!==void 0)for(const k of W){const I=a.getElementByKey(k);I!==null&&(I.classList.add("selected"),U.push(I),v(!0))}}return()=>{for(const H of U)H.classList.remove("selected")}},[p,a,d]),_.useEffect(()=>{if(!a.hasNodes([Le]))throw new Error("CommentPlugin: TypedMarkNode not registered on editor!");const U=new Map;return Xe(jd(a,Le,H=>gs(H.getTypedIDs()),(H,W)=>{for(const[k,I]of Object.entries(H.getTypedIDs()))I.forEach(x=>{W.addID(k,x)})}),a.registerMutationListener(Le,H=>{a.getEditorState().read(()=>{for(const[W,k]of H){const I=Te(W);let x=[];k==="destroyed"?x=U.get(W)??[]:Ee(I)&&(x=I.getTypedIDs()[cn]??[]);for(const P of x){let O=d.get(P);U.set(W,x),k==="destroyed"?O!==void 0&&(O.delete(W),O.size===0&&d.delete(P)):(O===void 0&&(O=new Set,d.set(P,O)),O.has(W)||O.add(W))}}})},{skipInitialization:!1}),a.registerUpdateListener(({editorState:H,tags:W})=>{H.read(()=>{const k=re();let I=!1,x=!1;if(X(k)){const P=k.anchor.getNode();if(ee(P)){const O=B_(P,cn,k.anchor.offset)??[];O!==null&&(y(O),I=!0),k.isCollapsed()||(h(P.getKey()),x=!0)}}I||y(P=>P.length===0?P:[]),x||h(null),!W.has("collaboration")&&X(k)&&C(!1)})}),a.registerCommand(Eu,()=>{const H=window.getSelection();return H!==null&&H.removeAllRanges(),C(!0),!0},xe))},[a,d]);const B=()=>{a.dispatchCommand(Eu,void 0)};return m.jsxs(m.Fragment,{children:[b&&yt.createPortal(m.jsx(Fx,{editor:a,cancelAddComment:j,submitAddComment:q}),document.body),f!=null&&!b&&yt.createPortal(m.jsx(Dx,{anchorKey:f,editor:a,showComments:A,onAddComment:B}),document.body),r!==null&&yt.createPortal(m.jsx(fn,{className:`CommentPlugin_ShowCommentsButton ${A?"active":""}`,onClick:()=>v(!A),title:A?"Hide Comments":"Show Comments",children:m.jsx("i",{className:"comments"})}),(r==null?void 0:r.current)??document.body),A&&yt.createPortal(m.jsx(Hx,{comments:u,submitAddComment:q,deleteCommentOrThread:$,activeIDs:p,markNodeMap:d}),(s==null?void 0:s.current)??document.body)]})}function zx(){const t=_.useRef(void 0),e=_.useCallback(n=>{t.current=n},[]);return[t,e]}function Kx(t,e){var n,r;const s=((n=e.current)==null?void 0:n.getComments())??[],i=s==null?void 0:s.map(a=>a.id),o=t.map(a=>{const l=i.findIndex(u=>u===a);return l!==void 0&&l>=0?s[l]:{comments:[{author:"unknown",content:"Comment not found",deleted:!1,id:"",timeStamp:0,type:"comment"}],id:a,quote:"",type:"thread"}});s.forEach(a=>{t.includes(a.id)||o.push(a)}),o&&((r=e.current)==null||r.setComments(o))}function Jx(t,e){_.useEffect(()=>{var n;t.options??(t.options={}),(n=t.options).nodes??(n.nodes={}),t.options.nodes.addMissingComments=r=>{Kx(r,e)}},[e,t])}_.forwardRef(function(t,e){const n=_.useRef(null),r=_.useRef(!0),s=_.useRef(null),[i,o]=_.useState(null),{children:a,onCommentChange:l,onUsjChange:u,showCommentsContainerRef:d,...f}=t,{logger:h,options:{isReadonly:p}={}}=t,[y,b]=zx();Jx(f,y),_.useEffect(()=>{},[h]),_.useImperativeHandle(e,()=>({focus(){var v;(v=n.current)==null||v.focus()},undo(){var v;(v=n.current)==null||v.undo()},redo(){var v;(v=n.current)==null||v.redo()},cut(){var v;(v=n.current)==null||v.cut()},copy(){var v;(v=n.current)==null||v.copy()},paste(){var v;(v=n.current)==null||v.paste()},pastePlainText(){var v;(v=n.current)==null||v.pastePlainText()},getUsj(){var v;return(v=n.current)==null?void 0:v.getUsj()},setUsj(v){var E;(E=n.current)==null||E.setUsj(v)},applyUpdate(v,E){var j;(j=n.current)==null||j.applyUpdate(v,E)},replaceEmbedUpdate(v,E){var j;return(j=n.current)==null?void 0:j.replaceEmbedUpdate(v,E)},getSelection(){var v;return(v=n.current)==null?void 0:v.getSelection()},setSelection(v){var E;(E=n.current)==null||E.setSelection(v)},setAnnotation(v,E,j,$,q){var B;(B=n.current)==null||B.setAnnotation(v,E,j,$,q)},removeAnnotation(v,E){var j;(j=n.current)==null||j.removeAnnotation(v,E)},formatPara(v){var E;(E=n.current)==null||E.formatPara(v)},getElementByKey(v){var E;return(E=n.current)==null?void 0:E.getElementByKey(v)},insertNote(v,E,j){var $;($=n.current)==null||$.insertNote(v,E,j)},selectNote(v){var E;(E=n.current)==null||E.selectNote(v)},getNoteOps(v){var E;return(E=n.current)==null?void 0:E.getNoteOps(v)},setComments(v){var E;(E=y.current)==null||E.setComments(v),r.current=!0},get toolbarEndRef(){return i}}));const C=_.useCallback((v,E,j,$)=>{var q;if(!u)return;const B=(q=y.current)==null?void 0:q.getComments();u(v,B,E,j,$)},[y,u]),A=_.useCallback(()=>{var v;if(!l||r.current){r.current=!1;return}const E=(v=y.current)==null?void 0:v.getComments();l(E)},[y,r,l]);return _.useEffect(()=>{var v;return o(((v=n.current)==null?void 0:v.toolbarEndRef)??null),()=>o(null)},[]),m.jsxs(Lf,{ref:n,onUsjChange:C,...f,children:[m.jsx(Wx,{setCommentStore:b,onChange:A,showCommentsContainerRef:p?null:d??i,commentContainerRef:s,logger:f.logger}),m.jsx("div",{ref:s,className:"comment-container"})]})});const Rl=_.memo(function({viewMode:e,description:n,children:r}){const s=e==="story",i=_.useMemo(()=>!s||typeof n!="string"||!n.trim()?null:m.jsxs(Gp,{className:"tw-w-full",children:[m.jsx(Yp,{className:"tw-pb-2",children:m.jsx(Xp,{className:"tw-text-sm tw-font-medium tw-text-muted-foreground",children:"Story Description"})}),m.jsx(Zp,{className:"tw-pt-2",children:m.jsx(Vp,{className:"tw-prose-sm tw-max-w-none tw-text-muted-foreground",markdown:n})})]}),[n,s]);return m.jsxs("div",{style:{display:"grid",gap:8},children:[r,i]})});Rl.__docgenInfo={description:"",methods:[],displayName:"CanvasWithDescription",props:{viewMode:{required:!1,tsType:{name:"string"},description:""},description:{required:!1,tsType:{name:"string"},description:""},children:{required:!0,tsType:{name:"ReactNode"},description:""}}};const Wa={m:"m - Paragraph - Margin - No First Line Indent",ms:"ms - Heading - Major Section Level 1",nb:"nb - Paragraph - No Break with Previous Paragraph",p:"p - Paragraph - Normal - First Line Indent",pi:"pi - Paragraph - Indented - Level 1 - First Line Indent",q1:"q1 - Poetry - Indent Level 1",q2:"q2 - Poetry - Indent Level 2",r:"r - Heading - Parallel References",s:"s - Heading - Section Level 1"},Mu={...Wa,ide:"ide - File - Encoding",h:"h - File - Header",h1:"h1 - File - Header",h2:"h2 - File - Left Header",h3:"h3 - File - Right Header",toc1:"toc1 - File - Long Table of Contents Text",toc2:"toc2 - File - Short Table of Contents Text",toc3:"toc3 - File - Book Abbreviation",cl:"cl - Chapter - Publishing Label",mt:"mt - Title - Major Title Level 1",mt1:"mt1 - Title - Major Title Level 1",mt2:"mt2 - Title - Major Title Level 2",mt3:"mt3 - Title - Major Title Level 3",mt4:"mt4 - Title - Major Title Level 4",ms1:"ms1 - Heading - Major Section Level 1",ms2:"ms2 - Heading - Major Section Level 2",ms3:"ms3 - Heading - Major Section Level 3",b:"b - Poetry - Stanza Break (Blank Line)"},Au={m:Vs,ms:tr,nb:Vs,p:Vs,pi:Vs,q1:Ko,q2:Ko,r:tr,s:tr,ide:Bt,h:Bt,h1:Bt,h2:Bt,h3:Bt,toc1:Bt,toc2:Bt,toc3:Bt,cl:Bt,mt:tr,mt1:tr,mt2:Hl,mt3:zo,mt4:zo,ms1:tr,ms2:Hl,ms3:zo,b:Ko};function ju({blockMarker:t,className:e}){const n=t&&t in Au?Au[t]:pg;return m.jsx(n,{className:e,size:16})}function Jf({editorRef:t,blockMarker:e}){return m.jsxs(Ya,{children:[m.jsx(Xa,{asChild:!0,children:m.jsxs(mt,{variant:"outline",className:"","aria-label":"Formatting options for block type",children:[m.jsx(ju,{blockMarker:e,className:"tw-me-2"}),Vx(e),m.jsx(ng,{className:"tw-ms-2"})]})}),m.jsx(Za,{children:Object.keys(Wa).map(n=>m.jsxs(tg,{className:`item block-marker ${Gx(e===n)}`,onClick:()=>{var r;return(r=t.current)==null?void 0:r.formatPara(n)},children:[m.jsx(ju,{blockMarker:n,className:"tw-me-2"}),m.jsx("span",{className:`text usfm_${n}`,children:Wa[n]})]},n))})]})}function Vx(t){return t&&t in Mu?Mu[t]:"No Style"}function Gx(t){return t?"active dropdown-item-active":""}Jf.__docgenInfo={description:"",methods:[],displayName:"BlockFormatDropDown",props:{editorRef:{required:!0,tsType:{name:"MutableRefObject",elements:[{name:"union",raw:"EditorRef | null",elements:[{name:"EditorRef"},{name:"null"}]}],raw:"MutableRefObject<EditorRef | null>"},description:""},blockMarker:{required:!0,tsType:{name:"union",raw:"string | undefined",elements:[{name:"string"},{name:"undefined"}]},description:""}}};const Yx={columns:{"platformScriptureEditor.edit":{label:"Edit",order:1},"platformScriptureEditor.insert":{label:"Insert",order:2}},groups:{"platformScriptureEditor.clipboard":{column:"platformScriptureEditor.edit",order:1},"platformScriptureEditor.insertNote":{column:"platformScriptureEditor.insert",order:1}},items:[{label:"Insert footnote",group:"platformScriptureEditor.insertNote",order:1,command:"platformScriptureEditor.insertFootnoteAtSelection",localizeNotes:""},{label:"Insert cross-reference",group:"platformScriptureEditor.insertNote",order:2,command:"platformScriptureEditor.insertCrossReferenceAtSelection",localizeNotes:""},{label:"Insert endnote",group:"platformScriptureEditor.insertNote",order:3,command:"platformScriptureEditor.insertEndnoteAtSelection",localizeNotes:""},{label:"Cut",group:"platformScriptureEditor.clipboard",order:1,command:"platformScriptureEditor.cut",localizeNotes:""},{label:"Copy",group:"platformScriptureEditor.clipboard",order:2,command:"platformScriptureEditor.copy",localizeNotes:""},{label:"Paste",group:"platformScriptureEditor.clipboard",order:3,command:"platformScriptureEditor.paste",localizeNotes:""},{label:"Paste as plain text",group:"platformScriptureEditor.clipboard",order:4,command:"platformScriptureEditor.pastePlainText",localizeNotes:""}]};function Vf({editorRef:t,scrRef:e,onScrRefChange:n,isReadonly:r=!1,canUndo:s=!1,canRedo:i=!1,blockMarker:o}){const a=()=>{var h;(h=t.current)==null||h.insertNote("f")},l=()=>{var h;(h=t.current)==null||h.insertNote("x")},u=()=>{var h;(h=t.current)==null||h.insertNote("fe")},d=h=>{var p,y,b,C;switch(h.command){case"platformScriptureEditor.insertFootnoteAtSelection":a();break;case"platformScriptureEditor.insertCrossReferenceAtSelection":l();break;case"platformScriptureEditor.insertEndnoteAtSelection":u();break;case"platformScriptureEditor.cut":(p=t.current)==null||p.cut();break;case"platformScriptureEditor.copy":(y=t.current)==null||y.copy();break;case"platformScriptureEditor.paste":(b=t.current)==null||b.paste();break;case"platformScriptureEditor.pastePlainText":(C=t.current)==null||C.pastePlainText();break;default:throw new Error(`Unknown onSelectProjectMenuItem command: ${h.command}`)}},f=()=>{};return m.jsx(eg,{onSelectProjectMenuItem:d,onSelectViewInfoMenuItem:f,projectMenuData:Yx,className:"toolbar",startAreaChildren:m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"tw-flex tw-h-full tw-items-center",children:m.jsx(Qp,{scrRef:e,handleSubmit:n})}),!r&&m.jsxs(m.Fragment,{children:[m.jsx(mt,{"aria-label":"Undo",title:"Undo",variant:"ghost",size:"icon",onClick:()=>{var h;return(h=t.current)==null?void 0:h.undo()},disabled:!s,children:m.jsx(Ng,{})}),m.jsx(mt,{"aria-label":"Redo",title:"Redo",variant:"ghost",size:"icon",onClick:()=>{var h;return(h=t.current)==null?void 0:h.redo()},disabled:!i,children:m.jsx(vg,{})}),m.jsx(Jf,{editorRef:t,blockMarker:o}),m.jsx(mt,{"aria-label":"Insert footnote",title:"Insert footnote",variant:"ghost",size:"icon",onClick:a,children:m.jsx(Mg,{})}),m.jsx(mt,{"aria-label":"Insert cross-reference",title:"Insert cross-reference",variant:"ghost",size:"icon",onClick:l,children:m.jsx(xg,{})}),m.jsx(mt,{"aria-label":"Insert endnote",title:"Insert endnote",variant:"ghost",size:"icon",onClick:u,children:m.jsx(_g,{})})]})]})})}Vf.__docgenInfo={description:"",methods:[],displayName:"PlatformToolbar",props:{editorRef:{required:!0,tsType:{name:"RefObject",elements:[{name:"union",raw:"EditorRef | null",elements:[{name:"EditorRef"},{name:"null"}]}],raw:"RefObject<EditorRef | null>"},description:""},scrRef:{required:!0,tsType:{name:"SerializedVerseRef"},description:""},onScrRefChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(scrRef: SerializedVerseRef) => void",signature:{arguments:[{type:{name:"SerializedVerseRef"},name:"scrRef"}],return:{name:"void"}}},description:""},isReadonly:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},canUndo:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},canRedo:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},blockMarker:{required:!1,tsType:{name:"string"},description:""}}};function Hn(t,e,n){var h,p,y,b;const r=_.useRef(null),[s,i]=_.useState(n),[o,a]=_.useState(!1),[l,u]=_.useState(!1),[d,f]=_.useState();return m.jsxs(Rl,{viewMode:e.viewMode,description:((y=(p=(h=e.parameters)==null?void 0:h.docs)==null?void 0:p.description)==null?void 0:y.story)??((b=e.parameters)==null?void 0:b.description),children:[m.jsx(Vf,{editorRef:r,scrRef:s,onScrRefChange:i,isReadonly:!1,canUndo:o,canRedo:l,blockMarker:d}),m.jsx(Tr,{...t,ref:r,scrRef:s,onScrRefChange:i,onStateChange:({canUndo:C,canRedo:A,blockMarker:v})=>{a(C),u(A),f(v)}})]})}Hn.__docgenInfo={description:`Render function that combines the Editorial component with a PlatformToolbar. This provides a
complete editing experience with undo/redo, navigation, and other toolbar features.

Use this as a render function in a Storybook story, not as a component.`,methods:[],displayName:"renderEditorialWithToolbar"};const Xx='<usx version="3.1" />',Zx=za(Xx),Qx=`<?xml version="1.0" encoding="utf-8"?>
<usx version="3.1">
  <book code="PSA" style="id">World English Bible (WEB)</book>
  <para style="mt1">The Psalms</para>
  <chapter number="1" style="c" sid="PSA 1" />
  <para style="q1">
    <verse number="1" style="v" sid="PSA 1:1" />Blessed is the man who doesnt walk in the counsel of the wicked<note caller="+" style="f"><char style="fr">1:1 </char><char style="ft">Or "sinful"</char></note>,</para>
  <para style="q2" vid="PSA 1:1">nor stand on the path<note caller="+" style="f"><char style="fr">1:1 </char><char style="ft">Hebrew: "way"</char></note> of sinners,</para>
  <para style="q2" vid="PSA 1:1">nor sit in the seat of scoffers;<verse eid="PSA 1:1" /></para>
  <para style="q1">
    <verse number="2" style="v" sid="PSA 1:2" /><note caller="+" style="f"><char style="fr" closed="false">1:2 </char><char style="ft" closed="false">After verse</char></note> but his delight is in Yahwehs<note caller="+" style="f"><char style="fr" closed="false">1:2 </char><char style="ft" closed="false">Yahweh is Gods proper Name, sometimes rendered LORD (all caps) in other translations.</char></note> law.<note caller="+" style="f"><char style="fr" closed="false">1:2 </char><char style="ft" closed="false">End of Para</char></note></para>
  <para style="q2" vid="PSA 1:2">On his law he meditates day and night.<note caller="+" style="f"><char style="fr" closed="false">1:2 </char><char style="ft" closed="false">End of Doc</char></note><verse eid="PSA 1:2" /></para>
</usx>
`,qt=za(Qx),eC={start:{jsonPath:"$.content[3].content[1]",offset:15},end:{jsonPath:"$.content[3].content[1]",offset:18}},tC={start:{jsonPath:"$.content[3].content[1]",offset:15},end:{jsonPath:"$.content[3].content[1]",offset:22}},nC=`<?xml version="1.0" encoding="utf-8"?>
<usx version="3.1">
  <book code="PSA" style="id"></book>
  <para style="mt1"></para>
  <chapter number="1" style="c" sid="PSA 1" />
  <para style="q1">
    <verse number="1" style="v" sid="PSA 1:1" />      ,</para>
  <para style="q2" vid="PSA 1:1">   ,</para>
  <para style="q2" vid="PSA 1:1">   .<verse eid="PSA 1:1" /></para>
  <para style="q1">
    <verse number="2" style="v" sid="PSA 1:2" />    ,</para>
  <para style="q2" vid="PSA 1:2">   .<verse eid="PSA 1:2" /></para>
</usx>
`,rC=za(nC),sC=(t,e,n)=>t==="generated"?m.jsxs(m.Fragment,{children:[m.jsx("p",{children:"+"})," ",e["%footnoteEditor_callerDropdown_item_generated%"]]}):t==="hidden"?m.jsxs(m.Fragment,{children:[m.jsx("p",{children:"-"})," ",e["%footnoteEditor_callerDropdown_item_hidden%"]]}):m.jsxs(m.Fragment,{children:[m.jsx("p",{children:n})," ",e["%footnoteEditor_callerDropdown_item_custom%"]]});function Gf({callerType:t,updateCallerType:e,customCaller:n,updateCustomCaller:r,localizedStrings:s}){const[i,o]=_.useState(t),[a,l]=_.useState(n);_.useEffect(()=>{o(t)},[t]),_.useEffect(()=>{a!==n&&l(n)},[n]);const u=d=>{d||(i!=="custom"||a?(e(i),r(a)):(o(t),l(n)))};return m.jsxs(Ya,{onOpenChange:u,children:[m.jsx(Qr,{children:m.jsxs(es,{children:[m.jsx(wi,{asChild:!0,children:m.jsx(Xa,{asChild:!0,children:m.jsx(mt,{variant:"outline",className:"tw-h-6",children:sC(t,s,n)})})}),m.jsx(ts,{children:s["%footnoteEditor_callerDropdown_tooltip%"]})]})}),m.jsxs(Za,{className:"tw-z-[300]",children:[m.jsx(Id,{children:s["%footnoteEditor_callerDropdown_label%"]}),m.jsx(Rd,{}),m.jsx(Zr,{checked:i==="generated",onCheckedChange:()=>o("generated"),children:m.jsxs("div",{className:"tw-flex tw-w-full tw-justify-between",children:[m.jsx("span",{children:s["%footnoteEditor_callerDropdown_item_generated%"]}),m.jsx("span",{className:"tw-w-10 tw-text-center",children:Rt})]})}),m.jsx(Zr,{checked:i==="hidden",onCheckedChange:()=>o("hidden"),children:m.jsxs("div",{className:"tw-flex tw-w-full tw-justify-between",children:[m.jsx("span",{children:s["%footnoteEditor_callerDropdown_item_hidden%"]}),m.jsx("span",{className:"tw-w-10 tw-text-center",children:hr})]})}),m.jsx(Zr,{checked:i==="custom",onCheckedChange:()=>o("custom"),onSelect:d=>d.preventDefault(),children:m.jsxs("div",{className:"tw-flex tw-w-full tw-justify-between",children:[m.jsx("span",{children:s["%footnoteEditor_callerDropdown_item_custom%"]}),m.jsx(sg,{className:"tw-h-auto tw-w-10 tw-p-0 tw-text-center",value:a,maxLength:1,onChange:d=>l(d.target.value)})]})})]})]})}Gf.__docgenInfo={description:"",methods:[],displayName:"FootnoteCallerDropdown",props:{callerType:{required:!0,tsType:{name:"union",raw:"'generated' | 'hidden' | 'custom'",elements:[{name:"literal",value:"'generated'"},{name:"literal",value:"'hidden'"},{name:"literal",value:"'custom'"}]},description:"The caller type value to pass to the dropdown"},updateCallerType:{required:!0,tsType:{name:"signature",type:"function",raw:"(newCallerType: FootnoteCallerType) => void",signature:{arguments:[{type:{name:"union",raw:"'generated' | 'hidden' | 'custom'",elements:[{name:"literal",value:"'generated'"},{name:"literal",value:"'hidden'"},{name:"literal",value:"'custom'"}]},name:"newCallerType"}],return:{name:"void"}}},description:"Function to update the caller type"},customCaller:{required:!0,tsType:{name:"string"},description:"The custom caller to pass to the custom caller input field"},updateCustomCaller:{required:!0,tsType:{name:"signature",type:"function",raw:"(newCustomCaller: string) => void",signature:{arguments:[{type:{name:"string"},name:"newCustomCaller"}],return:{name:"void"}}},description:"FUnction to update the custom caller"},localizedStrings:{required:!0,tsType:{name:"signature",type:"object",raw:`{
  [localizedKey in (typeof FOOTNOTE_EDITOR_STRING_KEYS)[number]]?: string;
}`,signature:{properties:[{key:{name:"unknown[number]",raw:"(typeof FOOTNOTE_EDITOR_STRING_KEYS)[number]",required:!1},value:{name:"string"}}]}},description:"Localized strings from the parent component"}}};const iC=(t,e)=>t==="f"?m.jsxs(m.Fragment,{children:[m.jsx(Pd,{})," ",e["%footnoteEditor_noteType_footnote_label%"]]}):t==="fe"?m.jsxs(m.Fragment,{children:[m.jsx($d,{})," ",e["%footnoteEditor_noteType_endNote_label%"]]}):m.jsxs(m.Fragment,{children:[m.jsx(Eg,{})," ",e["%footnoteEditor_noteType_crossReference_label%"]]}),oC=(t,e)=>{if(t==="x")return e["%footnoteEditor_noteType_crossReference_label%"];let n=e["%footnoteEditor_noteType_endNote_label%"];return t==="f"&&(n=e["%footnoteEditor_noteType_footnote_label%"]),ig(e["%footnoteEditor_noteType_tooltip%"]??"",{noteType:n})};function Yf({noteType:t,handleNoteTypeChange:e,localizedStrings:n}){return m.jsxs(Ya,{children:[m.jsx(Qr,{children:m.jsxs(es,{children:[m.jsx(rg,{asChild:!0,children:m.jsx(Xa,{asChild:!0,children:m.jsx(mt,{variant:"outline",className:"tw-h-6 disabled:tw-pointer-events-auto",disabled:t==="x",children:iC(t,n)})})}),m.jsx(ts,{children:m.jsx("p",{children:oC(t,n)})})]})}),t!=="x"&&m.jsxs(Za,{className:"tw-z-[300]",children:[m.jsx(Id,{children:n["%footnoteEditor_noteTypeDropdown_label%"]}),m.jsx(Rd,{}),m.jsxs(Zr,{checked:t==="f",onCheckedChange:()=>e("f"),className:"tw-gap-2",children:[m.jsx(Pd,{}),m.jsx("span",{children:n["%footnoteEditor_noteType_footnote_label%"]})]}),m.jsxs(Zr,{checked:t==="fe",onCheckedChange:()=>e("fe"),className:"tw-gap-2",children:[m.jsx($d,{}),m.jsx("span",{children:n["%footnoteEditor_noteType_endNote_label%"]})]})]})]})}Yf.__docgenInfo={description:"",methods:[],displayName:"FootnoteTypeDropdown",props:{noteType:{required:!0,tsType:{name:"string"},description:""},handleNoteTypeChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(newNoteType: string) => void",signature:{arguments:[{type:{name:"string"},name:"newNoteType"}],return:{name:"void"}}},description:""},localizedStrings:{required:!0,tsType:{name:"signature",type:"object",raw:`{
  [localizedKey in (typeof FOOTNOTE_EDITOR_STRING_KEYS)[number]]?: string;
}`,signature:{properties:[{key:{name:"unknown[number]",raw:"(typeof FOOTNOTE_EDITOR_STRING_KEYS)[number]",required:!1},value:{name:"string"}}]}},description:""}}};function Xf({noteOps:t,onSave:e,onClose:n,scrRef:r,noteKey:s,editorOptions:i,localizedStrings:o}){const a=_.useRef(null),l=_.createRef(),[u,d]=_.useState("generated"),[f,h]=_.useState("*"),[p,y]=_.useState("f"),b=_.useMemo(()=>({...i,markerMenuTrigger:i.markerMenuTrigger??"\\",hasExternalUI:!0,view:{...i.view??Sr(),noteMode:"expanded"}}),[i]);_.useEffect(()=>{var E;(E=a.current)==null||E.focus()}),_.useEffect(()=>{var $,q;let E;const j=t==null?void 0:t.at(0);if(j&&Kt("note",j)){const B=($=j.insert.note)==null?void 0:$.caller;let U="custom";B===Rt?U="generated":B===hr?U="hidden":B&&h(B),d(U),y(((q=j.insert.note)==null?void 0:q.style)??"f"),j.insert.note&&(j.insert.note.caller=""),E=setTimeout(()=>{var H;(H=a.current)==null||H.applyUpdate([{delete:1},j])},0)}return()=>{E&&clearTimeout(E)}},[t,s]);const C=_.useCallback(()=>{var j,$;const E=($=(j=a.current)==null?void 0:j.getNoteOps(0))==null?void 0:$.at(0);E&&Kt("note",E)&&(E.insert.note&&(u==="custom"?E.insert.note.caller=f:E.insert.note.caller=u==="generated"?Rt:hr),e([E]))},[u,f,e]),A=()=>{var j;const E=(j=l.current)==null?void 0:j.getElementsByClassName("editor-input")[0];E!=null&&E.textContent&&navigator.clipboard.writeText(E.textContent)},v=E=>{var $,q,B;y(E);const j=(q=($=a.current)==null?void 0:$.getNoteOps(0))==null?void 0:q.at(0);j&&Kt("note",j)&&(j.insert.note&&(j.insert.note.style=E),(B=a.current)==null||B.applyUpdate([{delete:1},j]))};return m.jsxs("div",{className:"footnote-editor tw-grid tw-gap-[12px]",children:[m.jsxs("div",{className:"tw-flex",children:[m.jsxs("div",{className:"tw-flex tw-gap-4",children:[m.jsx(Yf,{noteType:p,handleNoteTypeChange:v,localizedStrings:o}),m.jsx(Gf,{callerType:u,updateCallerType:d,customCaller:f,updateCustomCaller:h,localizedStrings:o})]}),m.jsxs("div",{className:"tw-flex tw-w-full tw-justify-end tw-gap-4",children:[m.jsx(Qr,{children:m.jsxs(es,{children:[m.jsx(wi,{asChild:!0,children:m.jsx(mt,{onClick:n,className:"tw-h-6 tw-w-6",size:"icon",variant:"secondary",children:m.jsx(og,{})})}),m.jsx(ts,{children:m.jsx("p",{children:o["%footnoteEditor_cancelButton_tooltip%"]})})]})}),m.jsx(Qr,{children:m.jsxs(es,{children:[m.jsx(wi,{asChild:!0,children:m.jsx(mt,{onClick:C,className:"tw-h-6 tw-w-6",size:"icon",variant:"default",children:m.jsx(ag,{})})}),m.jsx(ts,{children:o["%footnoteEditor_saveButton_tooltip%"]})]})})]})]}),m.jsxs("div",{ref:l,className:"tw-relative tw-rounded-[6px] tw-border-2 tw-border-ring",children:[m.jsx(Tr,{options:b,onScrRefChange:()=>{},scrRef:r,ref:a}),m.jsx("div",{className:"tw-absolute tw-bottom-0 tw-right-0",children:m.jsx(Qr,{children:m.jsxs(es,{children:[m.jsx(wi,{asChild:!0,children:m.jsx(mt,{onClick:A,className:"tw-h-6 tw-w-6",variant:"ghost",size:"icon",children:m.jsx(lg,{})})}),m.jsx(ts,{children:m.jsx("p",{children:o["%footnoteEditor_copyButton_tooltip%"]})})]})})})]})]})}Xf.__docgenInfo={description:`Component to edit footnotes from within the editor component

@param usj The raw usj of the footnote to edit
@param parentRef The ref of the parent editor component
@returns`,methods:[],displayName:"FootnoteEditor",props:{noteOps:{required:!0,tsType:{name:"union",raw:"DeltaOpInsertNoteEmbed[] | undefined",elements:[{name:"Array",elements:[{name:"DeltaOpInsertNoteEmbed"}],raw:"DeltaOpInsertNoteEmbed[]"},{name:"undefined"}]},description:"Delta ops for the current note being edited that are applied to the note editorial"},onSave:{required:!0,tsType:{name:"signature",type:"function",raw:"(noteOps: DeltaOpInsertNoteEmbed[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"DeltaOpInsertNoteEmbed"}],raw:"DeltaOpInsertNoteEmbed[]"},name:"noteOps"}],return:{name:"void"}}},description:"External function to handle saving changes to the footnote"},onClose:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:`External function to handle closing the footnote editor. Gets called when the editor is closed
without saving changes`},scrRef:{required:!0,tsType:{name:"SerializedVerseRef"},description:"The scripture reference for the parent editor"},noteKey:{required:!0,tsType:{name:"union",raw:"string | undefined",elements:[{name:"string"},{name:"undefined"}]},description:"The unique note key to identify the note being edited used to apply changes to the note"},editorOptions:{required:!0,tsType:{name:"EditorOptions"},description:"View options of the parent editor"},localizedStrings:{required:!0,tsType:{name:"signature",type:"object",raw:`{
  [localizedKey in (typeof FOOTNOTE_EDITOR_STRING_KEYS)[number]]?: string;
}`,signature:{properties:[{key:{name:"unknown[number]",raw:"(typeof FOOTNOTE_EDITOR_STRING_KEYS)[number]",required:!1},value:{name:"string"}}]}},description:"Localized strings to be passed to the footnote editor component"}}};const nt={book:"PSA",chapterNum:1,verseNum:1},k0={title:"Demo/Editorial",component:Tr,tags:["autodocs"],parameters:{docs:{description:{component:`
**Demo Only:** This component is provided for demonstration purposes only. For production applications, developers should import the Scripture Editor component directly from:
- npm [@eten-tech-foundation/platform-editor](https://www.npmjs.com/package/@eten-tech-foundation/platform-editor)
- github [eten-tech-foundation/platform-editor](https://github.com/eten-tech-foundation/scripture-editors/tree/main/packages/platform)

This demo version is included in Storybook to showcase the component's functionality and usage patterns.

**Known Limitation:** In the Docs view, all story examples may show the same note caller style due to global state management in the editor component. To see the correct note caller behavior for each story (default lowercase letters vs custom symbols), please view the individual stories in the Canvas view instead of the Docs view.
        `}}},argTypes:{ref:{control:"object",description:"Reference to the editor instance",defaultValue:null},defaultUsj:{control:"object",description:"Default USJ object to initialize the editor with",defaultValue:{type:ss,version:is,content:[""]}},scrRef:{control:"object",description:"Scripture reference",defaultValue:nt},options:{control:"object",description:"Options to configure the editor (EditorOptions)",defaultValue:{},table:{type:{summary:"EditorOptions",detail:'{ isReadonly?: boolean; hasSpellCheck?: boolean; textDirection?: "ltr" | "rtl" | "auto"; markerMenuTrigger?: string; nodes?: UsjNodeOptions; }'}}}}},li={args:{defaultUsj:qt,scrRef:nt}},ci={args:{defaultUsj:Zx,scrRef:nt}},ui={args:{defaultUsj:qt,scrRef:nt,options:{isReadonly:!0}}},di={render:(t,e)=>Hn(t,e,nt),parameters:{docs:{description:{story:'Right-to-left example using a Hebrew snippet (Psalm 1:1). The editor is set to RTL via _options.textDirection = "rtl"_. If you want the UI (tab toolbar) to be RTL click **Switch direction** in the Storybook toolbar.'}}},args:{defaultUsj:rC,options:{hasExternalUI:!0,textDirection:"rtl"}}};function Nu(t,e,n,r){console.log("handleAnnotationOnClick",{event:t,type:e,id:n,textContent:r})}function Iu(t,e,n,r){console.log("handleAnnotationOnRemove",{type:t,id:e,cause:n,textContent:r})}const hi={render:t=>{const e=_.useRef(null);return _.useEffect(()=>{const n=setTimeout(()=>{e.current&&(e.current.setAnnotation(eC,"spelling","annotationId",Nu,Iu),e.current.setAnnotation(tC,"grammar","abc123",Nu,Iu))},0);return()=>clearTimeout(n)},[]),m.jsx(Tr,{...t,ref:e})},args:{defaultUsj:qt,scrRef:nt}},aC={hasExternalUI:!0,view:{...Sr(),noteMode:"expandInline"},nodes:{noteCallerOnClick:(t,e,n,r,s)=>{n||(r()===Rt?s(hr):s(Rt))}}},fi={render:(t,e)=>Hn(t,e,nt),parameters:{docs:{description:{story:"This story demonstrates editing notes inline. Move your cursor to a note caller and the note will expand and can be edited. Move the cursor out of the note and it will collapse. Click the expanded note caller to toggle between the auto-generated caller and the hidden caller."}}},args:{defaultUsj:qt,options:aC}},lC={hasExternalUI:!0,view:{...Sr(),noteMode:"expandInline"}},pi={render:(t,e)=>Hn(t,e,nt),parameters:{docs:{description:{story:'This story demonstrates inserting notes. Use the Project menu (hamburger) or the toolbar buttons above the editor to insert footnotes, cross-references, and endnotes at the current cursor position. Selecting text before inserting a footnote will use that text as the footnote quote. You can also insert by typing "\\f", "\\x", or "\\fe".'}}},args:{defaultUsj:qt,options:lC}},cC={hasExternalUI:!0,nodes:{noteCallers:["","","","","","","","","",""],noteCallerOnClick:(t,e,n,r,s,i)=>{console.log("Note caller clicked:",t,e,n,r,s,i),alert("Note caller clicked! Check console for details.")}}},gi={render:(t,e)=>Hn(t,e,nt),parameters:{docs:{description:{story:"This story demonstrates custom note callers and click handling. **Try clicking on the circled number footnote markers ( ) in the text to see the click handler in action!** The click event will show an alert and log details to the browser console."}}},args:{defaultUsj:qt,options:cC}},mi={render:(t,e)=>Hn(t,e,nt),parameters:{docs:{description:{story:'This story demonstrates using a custom marker menu trigger key. **Try typing "?" (question mark) anywhere in the editor text to open the marker menu!** The default trigger is "\\\\" (backslash), but this story changes it to "?" for demonstration. The marker menu allows you to insert USFM markers into the text.'}}},args:{defaultUsj:qt,options:{hasExternalUI:!0,markerMenuTrigger:"?"}}},uC={"%footnoteEditor_callerDropdown_label%":"Footnote caller","%footnoteEditor_callerDropdown_item_generated%":"Auto-generated","%footnoteEditor_callerDropdown_item_hidden%":"Hidden","%footnoteEditor_callerDropdown_item_custom%":"Custom","%footnoteEditor_callerDropdown_tooltip%":"Footnote caller","%footnoteEditor_cancelButton_tooltip%":"Cancel","%footnoteEditor_copyButton_tooltip%":"Copy footnote","%footnoteEditor_noteType_crossReference_label%":"Cross reference","%footnoteEditor_noteType_endNote_label%":"Endnote","%footnoteEditor_noteType_footnote_label%":"Footnote","%footnoteEditor_noteType_tooltip%":"Change type: Footnote","%footnoteEditor_noteTypeDropdown_label%":"Type","%footnoteEditor_saveButton_tooltip%":"Save"},yi={render:t=>{const e=_.useRef(null),n=_.useRef(),r=_.useRef(),[s,i]=_.useState(),[o,a]=_.useState(),[l,u]=_.useState(),[d,f]=_.useState(),h=_.useMemo(()=>({markerMode:"hidden",noteMode:"collapsed",hasSpacing:!0,isFormattedFont:!0}),[]),p=_.useMemo(()=>({...t.options??{},nodes:{noteCallerOnClick:(A,v,E,j,$,q)=>{var U;const B=A.currentTarget.getBoundingClientRect();if(i(B.left),a(B.top),u(B.height),E){if(n.current)return;const H=(U=q())==null?void 0:U.at(0);if(!H||!Kt("note",H))return;n.current=v,r.current=[H],f(!0)}}},view:h}),[t.options,h,n]),y=()=>{n.current=void 0,r.current=void 0,f(!1)},b=C=>{var A;n.current&&((A=e.current)==null||A.replaceEmbedUpdate(n.current,C)),y()};return m.jsxs("div",{children:[m.jsx(Tr,{...t,options:p,ref:e,onScrRefChange:()=>{}}),m.jsxs(cg,{open:d,children:[m.jsx(ug,{className:"tw-absolute",style:{top:o??0,left:s??0,height:l,width:0}}),m.jsx(dg,{className:"tw-w-[500px] tw-p-[10px]",children:m.jsx(Xf,{noteKey:n.current,noteOps:r.current,onSave:b,onClose:y,scrRef:t.scrRef??nt,editorOptions:p,localizedStrings:uC})})]})]})},parameters:{docs:{description:{story:"This story demonstrates the use of the new footnote editor on the side of the  editorial component"}}},args:{defaultUsj:qt,scrRef:nt,options:{hasExternalUI:!1,markerMenuTrigger:"\\"}}},bi={render:(t,e)=>{var u,d,f,h;const n=_.useRef(null),[r,s]=_.useState(null),[i,o]=_.useState(!1),a=_.useMemo(()=>({...t.options??{},view:{markerMode:i?"visible":"hidden",hasSpacing:!0,isFormattedFont:!0}}),[t.options,i]);_.useEffect(()=>{var y,b;const p=(b=(y=n.current)==null?void 0:y.toolbarEndRef)==null?void 0:b.current;if(p)s(p);else{const C=window.setTimeout(()=>{var v,E;const A=(E=(v=n.current)==null?void 0:v.toolbarEndRef)==null?void 0:E.current;A&&s(A)},0);return()=>window.clearTimeout(C)}},[a]);const l=_.useCallback(()=>o(p=>!p),[]);return m.jsxs(Rl,{viewMode:e.viewMode,description:((f=(d=(u=e.parameters)==null?void 0:u.docs)==null?void 0:d.description)==null?void 0:f.story)??((h=e.parameters)==null?void 0:h.description),children:[m.jsx(Tr,{...t,options:a,ref:n}),r&&yt.createPortal(m.jsx("button",{type:"button",title:"Show/hide markers","aria-label":"Show/hide markers","aria-pressed":i,className:`toolbar-item ${i?"active":""}`,onClick:l,children:m.jsx("span",{className:"icon pilcrow-icon","aria-hidden":"true",children:""})}),r)]})},parameters:{docs:{description:{story:"This story demonstrates the Markers view, which shows USFM markers inline with the text. Click the **Show/hide markers** () button in the editor toolbar to toggle the Markers view on and off. "}}},args:{defaultUsj:qt,scrRef:nt}},_i={name:"View Options",render:(t,e)=>Hn(t,e,nt),parameters:{docs:{description:{story:'Demonstrates the editor view options (marker visibility, spacing, and formatted font) using USX input. Below in the **Controls** tab, try changing the **options.view** values to see how they affect the editor display. Valid values for **markerMode** are _"hidden"_, _"visible"_, and _"editable"_. Valid values for **noteMode** are _"collapsed"_, _"expandInline"_, and _"expanded"_.'}}},args:{defaultUsj:qt,options:{hasExternalUI:!0,view:{markerMode:"hidden",noteMode:"collapsed",hasSpacing:!0,isFormattedFont:!0}}}};var Ru,Pu,$u;li.parameters={...li.parameters,docs:{...(Ru=li.parameters)==null?void 0:Ru.docs,source:{originalSource:`{
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef
  }
}`,...($u=(Pu=li.parameters)==null?void 0:Pu.docs)==null?void 0:$u.source}}};var qu,Du,Lu;ci.parameters={...ci.parameters,docs:{...(qu=ci.parameters)==null?void 0:qu.docs,source:{originalSource:`{
  args: {
    defaultUsj: usjEmpty,
    scrRef: defaultScrRef
  }
}`,...(Lu=(Du=ci.parameters)==null?void 0:Du.docs)==null?void 0:Lu.source}}};var Fu,Uu,Bu;ui.parameters={...ui.parameters,docs:{...(Fu=ui.parameters)==null?void 0:Fu.docs,source:{originalSource:`{
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef,
    options: {
      isReadonly: true
    }
  }
}`,...(Bu=(Uu=ui.parameters)==null?void 0:Uu.docs)==null?void 0:Bu.source}}};var Hu,Wu,zu;di.parameters={...di.parameters,docs:{...(Hu=di.parameters)==null?void 0:Hu.docs,source:{originalSource:`{
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'Right-to-left example using a Hebrew snippet (Psalm 1:1). ' + 'The editor is set to RTL via _options.textDirection = "rtl"_. If you want the UI ' + '(tab toolbar) to be RTL click **Switch direction** in the Storybook toolbar.'
      }
    }
  },
  args: {
    defaultUsj: usjHebrew,
    options: {
      hasExternalUI: true,
      textDirection: 'rtl'
    }
  }
}`,...(zu=(Wu=di.parameters)==null?void 0:Wu.docs)==null?void 0:zu.source}}};var Ku,Ju,Vu;hi.parameters={...hi.parameters,docs:{...(Ku=hi.parameters)==null?void 0:Ku.docs,source:{originalSource:`{
  render: args => {
    // eslint-disable-next-line no-null/no-null
    const editorRef = useRef<EditorRef | null>(null);
    useEffect(() => {
      const timeoutId = setTimeout(() => {
        if (editorRef.current) {
          editorRef.current.setAnnotation(annotationRangeWeb1, 'spelling', 'annotationId', handleAnnotationOnClick, handleAnnotationOnRemove);
          editorRef.current.setAnnotation(annotationRangeWeb2, 'grammar', 'abc123', handleAnnotationOnClick, handleAnnotationOnRemove);
        }
      }, 0);
      return () => clearTimeout(timeoutId);
    }, []);
    return <Editorial {...args} ref={editorRef} />;
  },
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef
  }
}`,...(Vu=(Ju=hi.parameters)==null?void 0:Ju.docs)==null?void 0:Vu.source}}};var Gu,Yu,Xu;fi.parameters={...fi.parameters,docs:{...(Gu=fi.parameters)==null?void 0:Gu.docs,source:{originalSource:`{
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates editing notes inline. Move your cursor to a note caller and ' + 'the note will expand and can be edited. Move the cursor out of the note and it will ' + 'collapse. Click the expanded note caller to toggle between the auto-generated caller ' + 'and the hidden caller.'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    options: inlineNoteOptions
  }
}`,...(Xu=(Yu=fi.parameters)==null?void 0:Yu.docs)==null?void 0:Xu.source}}};var Zu,Qu,ed;pi.parameters={...pi.parameters,docs:{...(Zu=pi.parameters)==null?void 0:Zu.docs,source:{originalSource:`{
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates inserting notes. Use the Project menu (hamburger) or the ' + 'toolbar buttons above the editor to insert footnotes, cross-references, and endnotes ' + 'at the current cursor position. Selecting text before inserting a footnote will use ' + 'that text as the footnote quote. You can also insert by typing "\\\\f", "\\\\x", or "\\\\fe".'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    options: insertNoteOptions
  }
}`,...(ed=(Qu=pi.parameters)==null?void 0:Qu.docs)==null?void 0:ed.source}}};var td,nd,rd;gi.parameters={...gi.parameters,docs:{...(td=gi.parameters)==null?void 0:td.docs,source:{originalSource:`{
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates custom note callers and click handling. **Try clicking on the ' + 'circled number footnote markers ( ) in the text to see the click handler in ' + 'action!** The click event will show an alert and log details to the browser console.'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    options: customNodeOptions
  }
}`,...(rd=(nd=gi.parameters)==null?void 0:nd.docs)==null?void 0:rd.source}}};var sd,id,od;mi.parameters={...mi.parameters,docs:{...(sd=mi.parameters)==null?void 0:sd.docs,source:{originalSource:`{
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates using a custom marker menu trigger key. **Try typing "?" ' + '(question mark) anywhere in the editor text to open the marker menu!** The default ' + 'trigger is "\\\\\\\\" (backslash), but this story changes it to "?" for demonstration. ' + 'The marker menu allows you to insert USFM markers into the text.'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    options: {
      hasExternalUI: true,
      markerMenuTrigger: '?'
    }
  }
}`,...(od=(id=mi.parameters)==null?void 0:id.docs)==null?void 0:od.source}}};var ad,ld,cd;yi.parameters={...yi.parameters,docs:{...(ad=yi.parameters)==null?void 0:ad.docs,source:{originalSource:`{
  render: args => {
    // eslint-disable-next-line no-null/no-null
    const editorRef = useRef<EditorRef | null>(null);
    const noteKey = useRef<string>();
    const noteOps = useRef<DeltaOpInsertNoteEmbed[]>();
    const [popoverX, setPopoverX] = useState<number>();
    const [popoverY, setPopoverY] = useState<number>();
    const [popoverHeight, setPopoverHeight] = useState<number>();
    const [showFootnoteEditor, setShowFootnoteEditor] = useState<boolean>();
    const viewOptions = useMemo<ViewOptions>(() => ({
      markerMode: 'hidden',
      noteMode: 'collapsed',
      hasSpacing: true,
      isFormattedFont: true
    }), []);
    const mergedOptions = useMemo<EditorOptions>(() => {
      const base = args.options ?? {};
      return {
        ...base,
        nodes: {
          noteCallerOnClick: (event, noteNodeKey, isCollapsed, _getCaller, _setCaller, getNoteOps) => {
            const targetRect = event.currentTarget.getBoundingClientRect();
            setPopoverX(targetRect.left);
            setPopoverY(targetRect.top);
            setPopoverHeight(targetRect.height);
            if (isCollapsed) {
              // (event as SyntheticEvent<)
              if (noteKey.current) return;

              // Makes sure the note op is the correct type and is defined
              const noteOp = getNoteOps()?.at(0);
              if (!noteOp || !isInsertEmbedOpOfType('note', noteOp)) return;
              noteKey.current = noteNodeKey;
              noteOps.current = [noteOp];
              setShowFootnoteEditor(true);
            }
          }
        },
        view: viewOptions
      };
    }, [args.options, viewOptions, noteKey]);
    const onEditorClose = () => {
      noteKey.current = undefined;
      noteOps.current = undefined;
      setShowFootnoteEditor(false);
    };
    const onEditorSave = (newNoteOps: DeltaOp[]) => {
      if (noteKey.current) {
        editorRef.current?.replaceEmbedUpdate(noteKey.current, newNoteOps);
      }
      onEditorClose();
    };
    return <div>
        <Editorial {...args} options={mergedOptions} ref={editorRef} onScrRefChange={() => undefined} />
        <Popover open={showFootnoteEditor}>
          <PopoverAnchor className="tw-absolute" style={{
          top: popoverY ?? 0,
          left: popoverX ?? 0,
          height: popoverHeight,
          width: 0
        }} />
          <PopoverContent className="tw-w-[500px] tw-p-[10px]">
            <FootnoteEditor noteKey={noteKey.current} noteOps={noteOps.current} onSave={onEditorSave} onClose={onEditorClose} scrRef={args.scrRef ?? defaultScrRef} editorOptions={mergedOptions} localizedStrings={sampleFootnoteEditorLocalizedStrings} />
          </PopoverContent>
        </Popover>
      </div>;
  },
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates the use of the new footnote editor on the side of the ' + ' editorial component'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef,
    options: {
      hasExternalUI: false,
      markerMenuTrigger: '\\\\'
    }
  }
}`,...(cd=(ld=yi.parameters)==null?void 0:ld.docs)==null?void 0:cd.source}}};var ud,dd,hd;bi.parameters={...bi.parameters,docs:{...(ud=bi.parameters)==null?void 0:ud.docs,source:{originalSource:`{
  render: (args, context) => {
    // eslint-disable-next-line no-null/no-null
    const editorRef = useRef<EditorRef | null>(null);
    // eslint-disable-next-line no-null/no-null
    const [toolbarEndEl, setToolbarEndEl] = useState<HTMLElement | null>(null);
    const [showMarkers, setShowMarkers] = useState(false);
    const mergedOptions = useMemo(() => {
      const base = args.options ?? {};
      const view: ViewOptions = {
        markerMode: showMarkers ? 'visible' : 'hidden',
        hasSpacing: true,
        isFormattedFont: true
      };
      return {
        ...base,
        view
      };
    }, [args.options, showMarkers]);
    useEffect(() => {
      const el = editorRef.current?.toolbarEndRef?.current;
      if (el) setToolbarEndEl(el);else {
        // Retry once on next tick in case the toolbar mounts after the ref effect
        const id = window.setTimeout(() => {
          const el2 = editorRef.current?.toolbarEndRef?.current;
          if (el2) setToolbarEndEl(el2);
        }, 0);
        return () => window.clearTimeout(id);
      }
      return undefined;
    }, [mergedOptions]);
    const handleShowMarkerToggle = useCallback(() => setShowMarkers(v => !v), []);
    return <CanvasWithDescription viewMode={context.viewMode} description={context.parameters?.docs?.description?.story ?? context.parameters?.description}>
        <Editorial {...args} options={mergedOptions} ref={editorRef} />
        {toolbarEndEl && createPortal(<button type="button" title="Show/hide markers" aria-label="Show/hide markers" aria-pressed={showMarkers} className={\`toolbar-item \${showMarkers ? 'active' : ''}\`} onClick={handleShowMarkerToggle}>
              <span className="icon pilcrow-icon" aria-hidden="true">
                
              </span>
            </button>, toolbarEndEl)}
      </CanvasWithDescription>;
  },
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates the Markers view, which shows USFM markers inline with the ' + 'text. Click the **Show/hide markers** () button in the editor toolbar to toggle the ' + 'Markers view on and off. '
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef
  }
}`,...(hd=(dd=bi.parameters)==null?void 0:dd.docs)==null?void 0:hd.source}}};var fd,pd,gd;_i.parameters={..._i.parameters,docs:{...(fd=_i.parameters)==null?void 0:fd.docs,source:{originalSource:`{
  name: 'View Options',
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'Demonstrates the editor view options (marker visibility, spacing, and formatted font) ' + 'using USX input. Below in the **Controls** tab, try changing the **options.view** ' + 'values to see how they affect the editor display. Valid values for **markerMode** are ' + '_"hidden"_, _"visible"_, and _"editable"_. Valid values for **noteMode** are ' + '_"collapsed"_, _"expandInline"_, and _"expanded"_.'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    options: {
      hasExternalUI: true,
      view: {
        markerMode: 'hidden',
        noteMode: 'collapsed',
        hasSpacing: true,
        isFormattedFont: true
      }
    }
  }
}`,...(gd=(pd=_i.parameters)==null?void 0:pd.docs)==null?void 0:gd.source}}};const v0=["Default","Empty","ReadOnly","RTL","Annotated","InlineNoteEditing","InsertNote","CustomNoteOptions","CustomMarkerTrigger","FootnoteEditorView","MarkersView","ViewOptionsStory"];export{hi as Annotated,mi as CustomMarkerTrigger,gi as CustomNoteOptions,li as Default,ci as Empty,yi as FootnoteEditorView,fi as InlineNoteEditing,pi as InsertNote,bi as MarkersView,di as RTL,ui as ReadOnly,_i as ViewOptionsStory,v0 as __namedExportsOrder,k0 as default};
