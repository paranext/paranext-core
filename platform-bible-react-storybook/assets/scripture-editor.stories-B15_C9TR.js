var gv=Object.defineProperty;var pv=(n,e,t)=>e in n?gv(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var Pt=(n,e,t)=>pv(n,typeof e!="symbol"?e+"":e,t);import{j as S}from"./jsx-runtime-BJsVUjqB.js";import{r as x,c as Vn,g as mv}from"./iframe-DG98d1TG.js";import{J as Si,v as Ti,H as yv,V as _v,_ as bv,B as vv,I as ed}from"./index-C3mJiya3.js";import{r as Nt}from"./index-DofTjC7g.js";import{d as kv,c as wv,s as xv,f as Cv}from"./floating-ui.dom-DCpBEVSC.js";import{M as Sv}from"./markdown-renderer.component-bqTIbRMT.js";import{C as Tv,a as Ev,b as Nv,d as Mv}from"./card-BWk_AYkm.js";import"./index-BxOOARmk.js";import"./shadcn-ui.util-DMJ19wEV.js";var Av=Object.getOwnPropertyNames,Ov=Object.getOwnPropertySymbols,$v=Object.prototype.hasOwnProperty;function Cf(n,e){return function(r,i,s){return n(r,i,s)&&e(r,i,s)}}function Do(n){return function(t,r,i){if(!t||!r||typeof t!="object"||typeof r!="object")return n(t,r,i);var s=i.cache,o=s.get(t),a=s.get(r);if(o&&a)return o===r&&a===t;s.set(t,r),s.set(r,t);var l=n(t,r,i);return s.delete(t),s.delete(r),l}}function Sf(n){return Av(n).concat(Ov(n))}var Pv=Object.hasOwn||function(n,e){return $v.call(n,e)};function Gr(n,e){return n===e||!n&&!e&&n!==n&&e!==e}var Iv="__v",Rv="__o",Dv="_owner",Tf=Object.getOwnPropertyDescriptor,Ef=Object.keys;function Lv(n,e,t){var r=n.length;if(e.length!==r)return!1;for(;r-- >0;)if(!t.equals(n[r],e[r],r,r,n,e,t))return!1;return!0}function jv(n,e){return Gr(n.getTime(),e.getTime())}function Fv(n,e){return n.name===e.name&&n.message===e.message&&n.cause===e.cause&&n.stack===e.stack}function qv(n,e){return n===e}function Nf(n,e,t){var r=n.size;if(r!==e.size)return!1;if(!r)return!0;for(var i=new Array(r),s=n.entries(),o,a,l=0;(o=s.next())&&!o.done;){for(var c=e.entries(),u=!1,f=0;(a=c.next())&&!a.done;){if(i[f]){f++;continue}var d=o.value,g=a.value;if(t.equals(d[0],g[0],l,f,n,e,t)&&t.equals(d[1],g[1],d[0],g[0],n,e,t)){u=i[f]=!0;break}f++}if(!u)return!1;l++}return!0}var Bv=Gr;function Wv(n,e,t){var r=Ef(n),i=r.length;if(Ef(e).length!==i)return!1;for(;i-- >0;)if(!tm(n,e,t,r[i]))return!1;return!0}function bs(n,e,t){var r=Sf(n),i=r.length;if(Sf(e).length!==i)return!1;for(var s,o,a;i-- >0;)if(s=r[i],!tm(n,e,t,s)||(o=Tf(n,s),a=Tf(e,s),(o||a)&&(!o||!a||o.configurable!==a.configurable||o.enumerable!==a.enumerable||o.writable!==a.writable)))return!1;return!0}function Uv(n,e){return Gr(n.valueOf(),e.valueOf())}function zv(n,e){return n.source===e.source&&n.flags===e.flags}function Mf(n,e,t){var r=n.size;if(r!==e.size)return!1;if(!r)return!0;for(var i=new Array(r),s=n.values(),o,a;(o=s.next())&&!o.done;){for(var l=e.values(),c=!1,u=0;(a=l.next())&&!a.done;){if(!i[u]&&t.equals(o.value,a.value,o.value,a.value,n,e,t)){c=i[u]=!0;break}u++}if(!c)return!1}return!0}function Kv(n,e){var t=n.length;if(e.length!==t)return!1;for(;t-- >0;)if(n[t]!==e[t])return!1;return!0}function Hv(n,e){return n.hostname===e.hostname&&n.pathname===e.pathname&&n.protocol===e.protocol&&n.port===e.port&&n.hash===e.hash&&n.username===e.username&&n.password===e.password}function tm(n,e,t,r){return(r===Dv||r===Rv||r===Iv)&&(n.$$typeof||e.$$typeof)?!0:Pv(e,r)&&t.equals(n[r],e[r],r,r,n,e,t)}var Jv="[object Arguments]",Vv="[object Boolean]",Gv="[object Date]",Yv="[object Error]",Xv="[object Map]",Zv="[object Number]",Qv="[object Object]",ek="[object RegExp]",tk="[object Set]",nk="[object String]",rk="[object URL]",ik=Array.isArray,Af=typeof ArrayBuffer=="function"&&ArrayBuffer.isView?ArrayBuffer.isView:null,Of=Object.assign,sk=Object.prototype.toString.call.bind(Object.prototype.toString);function ok(n){var e=n.areArraysEqual,t=n.areDatesEqual,r=n.areErrorsEqual,i=n.areFunctionsEqual,s=n.areMapsEqual,o=n.areNumbersEqual,a=n.areObjectsEqual,l=n.arePrimitiveWrappersEqual,c=n.areRegExpsEqual,u=n.areSetsEqual,f=n.areTypedArraysEqual,d=n.areUrlsEqual;return function(p,m,y){if(p===m)return!0;if(p==null||m==null)return!1;var v=typeof p;if(v!==typeof m)return!1;if(v!=="object")return v==="number"?o(p,m,y):v==="function"?i(p,m,y):!1;var _=p.constructor;if(_!==m.constructor)return!1;if(_===Object)return a(p,m,y);if(ik(p))return e(p,m,y);if(Af!=null&&Af(p))return f(p,m,y);if(_===Date)return t(p,m,y);if(_===RegExp)return c(p,m,y);if(_===Map)return s(p,m,y);if(_===Set)return u(p,m,y);var w=sk(p);return w===Gv?t(p,m,y):w===ek?c(p,m,y):w===Xv?s(p,m,y):w===tk?u(p,m,y):w===Qv?typeof p.then!="function"&&typeof m.then!="function"&&a(p,m,y):w===rk?d(p,m,y):w===Yv?r(p,m,y):w===Jv?a(p,m,y):w===Vv||w===Zv||w===nk?l(p,m,y):!1}}function ak(n){var e=n.circular,t=n.createCustomConfig,r=n.strict,i={areArraysEqual:r?bs:Lv,areDatesEqual:jv,areErrorsEqual:Fv,areFunctionsEqual:qv,areMapsEqual:r?Cf(Nf,bs):Nf,areNumbersEqual:Bv,areObjectsEqual:r?bs:Wv,arePrimitiveWrappersEqual:Uv,areRegExpsEqual:zv,areSetsEqual:r?Cf(Mf,bs):Mf,areTypedArraysEqual:r?bs:Kv,areUrlsEqual:Hv};if(t&&(i=Of({},i,t(i))),e){var s=Do(i.areArraysEqual),o=Do(i.areMapsEqual),a=Do(i.areObjectsEqual),l=Do(i.areSetsEqual);i=Of({},i,{areArraysEqual:s,areMapsEqual:o,areObjectsEqual:a,areSetsEqual:l})}return i}function lk(n){return function(e,t,r,i,s,o,a){return n(e,t,a)}}function ck(n){var e=n.circular,t=n.comparator,r=n.createState,i=n.equals,s=n.strict;if(r)return function(l,c){var u=r(),f=u.cache,d=f===void 0?e?new WeakMap:void 0:f,g=u.meta;return t(l,c,{cache:d,equals:i,meta:g,strict:s})};if(e)return function(l,c){return t(l,c,{cache:new WeakMap,equals:i,meta:void 0,strict:s})};var o={cache:void 0,equals:i,meta:void 0,strict:s};return function(l,c){return t(l,c,o)}}var Hn=dr();dr({strict:!0});dr({circular:!0});dr({circular:!0,strict:!0});dr({createInternalComparator:function(){return Gr}});dr({strict:!0,createInternalComparator:function(){return Gr}});dr({circular:!0,createInternalComparator:function(){return Gr}});dr({circular:!0,createInternalComparator:function(){return Gr},strict:!0});function dr(n){n===void 0&&(n={});var e=n.circular,t=e===void 0?!1:e,r=n.createInternalComparator,i=n.createState,s=n.strict,o=s===void 0?!1:s,a=ak(n),l=ok(a),c=r?r(l):lk(l);return ck({circular:t,comparator:l,createState:i,equals:c,strict:o})}const nm=x.createContext(null);function uk(n,e){return{getTheme:function(){return e??null}}}function ge(){const n=x.useContext(nm);return n==null&&function(e,...t){const r=new URL("https://lexical.dev/docs/error"),i=new URLSearchParams;i.append("code",e);for(const s of t)i.append("v",s);throw r.search=i.toString(),Error(`Minified Lexical error #${e}; visit ${r.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}(8),n}function H(n,...e){const t=new URL("https://lexical.dev/docs/error"),r=new URLSearchParams;r.append("code",n);for(const i of e)r.append("v",i);throw t.search=r.toString(),Error(`Minified Lexical error #${n}; visit ${t.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}const Zt=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,dk=Zt&&"documentMode"in document?document.documentMode:null,ln=Zt&&/Mac|iPod|iPhone|iPad/.test(navigator.platform),Lr=Zt&&/^(?!.*Seamonkey)(?=.*Firefox).*/i.test(navigator.userAgent),Ta=!(!Zt||!("InputEvent"in window)||dk)&&"getTargetRanges"in new window.InputEvent("input"),Ls=Zt&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent),Ei=Zt&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,fk=Zt&&/Android/.test(navigator.userAgent),rm=Zt&&/^(?=.*Chrome).*/i.test(navigator.userAgent),$f=Zt&&fk&&rm,Ea=Zt&&/AppleWebKit\/[\d.]+/.test(navigator.userAgent)&&!rm;function Na(...n){const e=[];for(const t of n)if(t&&typeof t=="string")for(const[r]of t.matchAll(/\S+/g))e.push(r);return e}const hk=1,gk=3,pk=9,mk=11,jr=0,im=1,Ni=2,yk=0,_k=1,bk=2,Ma=4,Aa=8,td=128,vk=1792|(112|(3|Ma|Aa)|td),nd=1,rd=2,id=3,sd=4,od=5,ad=6,ol=Ls||Ei||Ea?" ":"​",Pn=`

`,kk=Lr?" ":ol,sm="֑-߿יִ-﷽ﹰ-ﻼ",om="A-Za-zÀ-ÖØ-öø-ʸ̀-֐ࠀ-῿‎Ⰰ-﬜︀-﹯﻽-￿",wk=new RegExp("^[^"+om+"]*["+sm+"]"),xk=new RegExp("^[^"+sm+"]*["+om+"]"),nr={bold:1,capitalize:1024,code:16,highlight:td,italic:2,lowercase:256,strikethrough:Ma,subscript:32,superscript:64,underline:Aa,uppercase:512},Ck={directionless:1,unmergeable:2},Pf={center:rd,end:ad,justify:sd,left:nd,right:id,start:od},Sk={[rd]:"center",[ad]:"end",[sd]:"justify",[nd]:"left",[id]:"right",[od]:"start"},Tk={normal:0,segmented:2,token:1},Ek={[yk]:"normal",[bk]:"segmented",[_k]:"token"},If="$config";function am(n,e,t,r,i,s){let o=n.getFirstChild();for(;o!==null;){const a=o.__key;o.__parent===e&&(L(o)&&am(o,a,t,r,i,s),t.has(a)||s.delete(a),i.push(a)),o=o.getNextSibling()}}const Nk=100;let Gc=!1,ld=0;function Mk(n){ld=n.timeStamp}function yc(n,e,t){const r=n.nodeName==="BR",i=e.__lexicalLineBreak;return i&&(n===i||r&&n.previousSibling===i)||r&&ml(n,t)!==void 0}function Ak(n,e,t){const r=Gt(jt(t));let i=null,s=null;r!==null&&r.anchorNode===n&&(i=r.anchorOffset,s=r.focusOffset);const o=n.nodeValue;o!==null&&$d(e,o,i,s,!1)}function Ok(n,e,t){if(B(n)){const r=n.anchor.getNode();if(r.is(t)&&n.format!==r.getFormat())return!1}return jn(e)&&t.isAttached()}function $k(n,e,t,r){for(let i=n;i&&!Aw(i);i=so(i)){const s=ml(i,e);if(s!==void 0){const o=he(s,t);if(o)return be(o)||!Te(i)?void 0:[i,o]}else if(i===r)return[r,ly(t)]}}function lm(n,e,t){Gc=!0;const r=performance.now()-ld>Nk;try{Et(n,()=>{const i=K()||function(d){return d.getEditorState().read(()=>{const g=K();return g!==null?g.clone():null})}(n),s=new Map,o=n.getRootElement(),a=n._editorState,l=n._blockCursorElement;let c=!1,u="";for(let d=0;d<e.length;d++){const g=e[d],p=g.type,m=g.target,y=$k(m,n,a,o);if(!y)continue;const[v,_]=y;if(p==="characterData")r&&U(_)&&jn(m)&&Ok(i,m,_)&&Ak(m,_,n);else if(p==="childList"){c=!0;const w=g.addedNodes;for(let P=0;P<w.length;P++){const R=w[P],N=oy(R),M=R.parentNode;if(M!=null&&R!==l&&N===null&&!yc(R,M,n)){if(Lr){const j=(Te(R)?R.innerText:null)||R.nodeValue;j&&(u+=j)}M.removeChild(R)}}const E=g.removedNodes,$=E.length;if($>0){let P=0;for(let R=0;R<$;R++){const N=E[R];(yc(N,m,n)||l===N)&&(m.appendChild(N),P++)}$!==P&&s.set(v,_)}}}if(s.size>0)for(const[d,g]of s)g.reconcileObservedMutation(d,n);const f=t.takeRecords();if(f.length>0){for(let d=0;d<f.length;d++){const g=f[d],p=g.addedNodes,m=g.target;for(let y=0;y<p.length;y++){const v=p[y],_=v.parentNode;_==null||v.nodeName!=="BR"||yc(v,m,n)||_.removeChild(v)}}t.takeRecords()}i!==null&&(c&&rt(i),Lr&&hy(n)&&i.insertRawText(u))})}finally{Gc=!1}}function cm(n){const e=n._observer;e!==null&&lm(n,e.takeRecords(),e)}function um(n){(function(e){ld===0&&jt(e).addEventListener("textInput",Mk,!0)})(n),n._observer=new MutationObserver((e,t)=>{lm(n,e,t)})}let Pk=class{constructor(e,t){this.key=e,this.parse=t.parse.bind(t),this.unparse=(t.unparse||Dk).bind(t),this.isEqual=(t.isEqual||Object.is).bind(t),this.defaultValue=this.parse(void 0)}};function dm(n,e){return new Pk(n,e)}function Mi(n,e,t="latest"){const r=(t==="latest"?n.getLatest():n).__state;return r?r.getValue(e):e.defaultValue}function An(n,e,t){let r;if(Xe(),typeof t=="function"){const s=n.getLatest(),o=Mi(s,e);if(r=t(o),e.isEqual(o,r))return s}else r=t;const i=n.getWritable();return hm(i).updateFromKnown(e,r),i}function Ik(n){const e=new Map,t=new Set;for(let r=typeof n=="function"?n:n.replace;r.prototype&&r.prototype.getType!==void 0;r=Object.getPrototypeOf(r)){const{ownNodeConfig:i}=Dd(r);if(i&&i.stateConfigs)for(const s of i.stateConfigs){let o;"stateConfig"in s?(o=s.stateConfig,s.flat&&t.add(o.key)):o=s,e.set(o.key,o)}}return{flatKeys:t,sharedConfigMap:e}}let Rk=class fm{constructor(e,t,r=void 0,i=new Map,s=void 0){this.node=e,this.sharedNodeState=t,this.unknownState=r,this.knownState=i;const{sharedConfigMap:o}=this.sharedNodeState,a=s!==void 0?s:function(l,c,u){let f=u.size;if(c)for(const d in c){const g=l.get(d);g&&u.has(g)||f++}return f}(o,r,i);this.size=a}getValue(e){const t=this.knownState.get(e);if(t!==void 0)return t;this.sharedNodeState.sharedConfigMap.set(e.key,e);let r=e.defaultValue;if(this.unknownState&&e.key in this.unknownState){const i=this.unknownState[e.key];i!==void 0&&(r=e.parse(i)),this.updateFromKnown(e,r)}return r}getInternalState(){return[this.unknownState,this.knownState]}toJSON(){const e={...this.unknownState},t={};for(const[r,i]of this.knownState)r.isEqual(i,r.defaultValue)?delete e[r.key]:e[r.key]=r.unparse(i);for(const r of this.sharedNodeState.flatKeys)r in e&&(t[r]=e[r],delete e[r]);return Rf(e)&&(t.$=e),t}getWritable(e){if(this.node===e)return this;const{sharedNodeState:t,unknownState:r}=this,i=new Map(this.knownState);return new fm(e,t,function(s,o,a){let l;if(a)for(const[c,u]of Object.entries(a)){const f=s.get(c);f?o.has(f)||o.set(f,f.parse(u)):(l=l||{},l[c]=u)}return l}(t.sharedConfigMap,i,r),i,this.size)}updateFromKnown(e,t){const r=e.key;this.sharedNodeState.sharedConfigMap.set(r,e);const{knownState:i,unknownState:s}=this;i.has(e)||s&&r in s||(s&&(delete s[r],this.unknownState=Rf(s)),this.size++),i.set(e,t)}updateFromUnknown(e,t){const r=this.sharedNodeState.sharedConfigMap.get(e);r?this.updateFromKnown(r,r.parse(t)):(this.unknownState=this.unknownState||{},e in this.unknownState||this.size++,this.unknownState[e]=t)}updateFromJSON(e){const{knownState:t}=this;for(const r of t.keys())t.set(r,r.defaultValue);if(this.size=t.size,this.unknownState=void 0,e)for(const[r,i]of Object.entries(e))this.updateFromUnknown(r,i)}};function hm(n){const e=n.getWritable(),t=e.__state?e.__state.getWritable(e):new Rk(e,gm(e));return e.__state=t,t}function gm(n){return n.__state?n.__state.sharedNodeState:iy(_l(),n.getType()).sharedNodeState}function Rf(n){if(n)for(const e in n)return n}function Dk(n){return n}function Df(n,e,t){for(const[r,i]of e.knownState){if(n.has(r.key))continue;n.add(r.key);const s=t?t.getValue(r):r.defaultValue;if(s!==i&&!r.isEqual(s,i))return!0}return!1}function Lf(n,e,t){const{unknownState:r}=e,i=t?t.unknownState:void 0;if(r){for(const[s,o]of Object.entries(r))if(!n.has(s)&&(n.add(s),o!==(i?i[s]:void 0)))return!0}return!1}function jf(n,e){const t=n.__state;return t&&t.node===n?t.getWritable(e):t}function Ff(n,e){const t=n.__mode,r=n.__format,i=n.__style,s=e.__mode,o=e.__format,a=e.__style,l=n.__state,c=e.__state;return(t===null||t===s)&&(r===null||r===o)&&(i===null||i===a)&&(n.__state===null||l===c||function(u,f){if(u===f)return!0;if(u&&f&&u.size!==f.size)return!1;const d=new Set;return!(u&&Df(d,u,f)||f&&Df(d,f,u)||u&&Lf(d,u,f)||f&&Lf(d,f,u))}(l,c))}function qf(n,e){const t=n.mergeWithSibling(e),r=$e()._normalizedNodes;return r.add(n.__key),r.add(e.__key),t}function Bf(n){let e,t,r=n;if(r.__text!==""||!r.isSimpleText()||r.isUnmergeable()){for(;(e=r.getPreviousSibling())!==null&&U(e)&&e.isSimpleText()&&!e.isUnmergeable();){if(e.__text!==""){if(Ff(e,r)){r=qf(e,r);break}break}e.remove()}for(;(t=r.getNextSibling())!==null&&U(t)&&t.isSimpleText()&&!t.isUnmergeable();){if(t.__text!==""){if(Ff(r,t)){r=qf(r,t);break}break}t.remove()}}else r.remove()}function js(n){return Wf(n.anchor),Wf(n.focus),n}function Wf(n){for(;n.type==="element";){const e=n.getNode(),t=n.offset;let r,i;if(t===e.getChildrenSize()?(r=e.getChildAtIndex(t-1),i=!0):(r=e.getChildAtIndex(t),i=!1),U(r)){n.set(r.__key,i?r.getTextContentSize():0,"text",!0);break}if(!L(r))break;n.set(r.__key,i?r.getChildrenSize():0,"element",!0)}}let rr,yt,Fs,al,Yc,Xc,Fr,Kt,Zc,qs,Fe="",mt="",on=null,an="",En="",pm=!1,Bs=!1,fa=null;function Oa(n,e){const t=Fr.get(n);if(e!==null){const r=tu(n);r.parentNode===e&&e.removeChild(r)}if(Kt.has(n)||yt._keyToDOMMap.delete(n),L(t)){const r=Pa(t,Fr);Qc(r,0,r.length-1,null)}t!==void 0&&Pd(qs,Fs,al,t,"destroyed")}function Qc(n,e,t,r){let i=e;for(;i<=t;++i){const s=n[i];s!==void 0&&Oa(s,r)}}function Er(n,e){n.setProperty("text-align",e)}const Lk="40px";function mm(n,e){const t=rr.theme.indent;if(typeof t=="string"){const i=n.classList.contains(t);e>0&&!i?n.classList.add(t):e<1&&i&&n.classList.remove(t)}const r=getComputedStyle(n).getPropertyValue("--lexical-indent-base-value")||Lk;n.style.setProperty("padding-inline-start",e===0?"":`calc(${e} * ${r})`)}function ym(n,e){const t=n.style;e===0?Er(t,""):e===nd?Er(t,"left"):e===rd?Er(t,"center"):e===id?Er(t,"right"):e===sd?Er(t,"justify"):e===od?Er(t,"start"):e===ad&&Er(t,"end")}function $a(n,e){const t=Kt.get(n);t===void 0&&H(60);const r=t.createDOM(rr,yt);if(function(i,s,o){const a=o._keyToDOMMap;(function(l,c,u){const f=`__lexicalKey_${c._key}`;l[f]=u})(s,o,i),a.set(i,s)}(n,r,yt),U(t)?r.setAttribute("data-lexical-text","true"):be(t)&&r.setAttribute("data-lexical-decorator","true"),L(t)){const i=t.__indent,s=t.__size;if(i!==0&&mm(r,i),s!==0){const a=s-1;(function(l,c,u,f){const d=mt;mt="",eu(l,u,0,c,u.getDOMSlot(f)),bm(u,f),mt=d})(Pa(t,Kt),a,t,r)}const o=t.__format;o!==0&&ym(r,o),t.isInline()||_m(null,t,r),yl(t)&&(Fe+=Pn,En+=Pn)}else{const i=t.getTextContent();if(be(t)){const s=t.decorate(yt,rr);s!==null&&vm(n,s),r.contentEditable="false"}else U(t)&&(t.isDirectionless()||(mt+=i));Fe+=i,En+=i}return e!==null&&e.insertChild(r),Pd(qs,Fs,al,t,"created"),r}function eu(n,e,t,r,i){const s=Fe;Fe="";let o=t;for(;o<=r;++o){$a(n[o],i);const a=Kt.get(n[o]);a!==null&&U(a)&&(on===null&&(on=a.getFormat()),an===""&&(an=a.getStyle()))}yl(e)&&(Fe+=Pn),i.element.__lexicalTextContent=Fe,Fe=s+Fe}function Uf(n,e){if(n){const t=n.__last;if(t){const r=e.get(t);if(r)return Or(r)?"line-break":be(r)&&r.isInline()?"decorator":null}return"empty"}return null}function _m(n,e,t){const r=Uf(n,Fr),i=Uf(e,Kt);r!==i&&e.getDOMSlot(t).setManagedLineBreak(i)}function bm(n,e){const t=e.__lexicalDirTextContent||"",r=e.__lexicalDir||"";if(t!==mt||r!==fa){const i=mt==="",s=i?fa:function(o){return wk.test(o)?"rtl":xk.test(o)?"ltr":null}(mt);if(s!==r){const o=e.classList,a=rr.theme;let l=r!==null?a[r]:void 0,c=s!==null?a[s]:void 0;if(l!==void 0){if(typeof l=="string"){const u=Na(l);l=a[r]=u}o.remove(...l)}if(s===null||i&&s==="ltr")e.removeAttribute("dir");else{if(c!==void 0){if(typeof c=="string"){const u=Na(c);c=a[s]=u}c!==void 0&&o.add(...c)}e.dir=s}Bs||(n.getWritable().__dir=s)}fa=s,e.__lexicalDirTextContent=mt,e.__lexicalDir=s}}function jk(n,e,t){const r=mt;var i;mt="",on=null,an="",function(s,o,a){const l=Fe,c=s.__size,u=o.__size;Fe="";const f=a.element;if(c===1&&u===1){const d=s.__first,g=o.__first;if(d===g)Cs(d,f);else{const m=tu(d),y=$a(g,null);try{f.replaceChild(y,m)}catch(v){if(typeof v=="object"&&v!=null){const _=`${v.toString()} Parent: ${f.tagName}, new child: {tag: ${y.tagName} key: ${g}}, old child: {tag: ${m.tagName}, key: ${d}}.`;throw new Error(_)}throw v}Oa(d,null)}const p=Kt.get(g);U(p)&&(on===null&&(on=p.getFormat()),an===""&&(an=p.getStyle()))}else{const d=Pa(s,Fr),g=Pa(o,Kt);if(d.length!==c&&H(227),g.length!==u&&H(228),c===0)u!==0&&eu(g,o,0,u-1,a);else if(u===0){if(c!==0){const p=a.after==null&&a.before==null&&a.element.__lexicalLineBreak==null;Qc(d,0,c-1,p?null:f),p&&(f.textContent="")}}else(function(p,m,y,v,_,w){const E=v-1,$=_-1;let P,R,N=w.getFirstChild(),M=0,j=0;for(;M<=E&&j<=$;){const C=m[M],D=y[j];if(C===D)N=_c(Cs(D,w.element)),M++,j++;else{P===void 0&&(P=new Set(m)),R===void 0&&(R=new Set(y));const F=R.has(C),z=P.has(D);if(F)if(z){const J=Ii(yt,D);J===N?N=_c(Cs(D,w.element)):(w.withBefore(N).insertChild(J),Cs(D,w.element)),M++,j++}else $a(D,w.withBefore(N)),j++;else N=_c(tu(C)),Oa(C,w.element),M++}const q=Kt.get(D);q!==null&&U(q)&&(on===null&&(on=q.getFormat()),an===""&&(an=q.getStyle()))}const k=M>E,I=j>$;if(k&&!I){const C=y[$+1],D=C===void 0?null:yt.getElementByKey(C);eu(y,p,j,$,w.withBefore(D))}else I&&!k&&Qc(m,M,E,w.element)})(o,d,g,c,u,a)}yl(o)&&(Fe+=Pn),f.__lexicalTextContent=Fe,Fe=l+Fe}(n,e,e.getDOMSlot(t)),bm(e,t),i=e,on==null||on===i.__textFormat||Bs||i.setTextFormat(on),function(s){an===""||an===s.__textStyle||Bs||s.setTextStyle(an)}(e),mt=r}function Pa(n,e){const t=[];let r=n.__first;for(;r!==null;){const i=e.get(r);i===void 0&&H(101),t.push(r),r=i.__next}return t}function Cs(n,e){const t=Fr.get(n);let r=Kt.get(n);t!==void 0&&r!==void 0||H(61);const i=pm||Xc.has(n)||Yc.has(n),s=Ii(yt,n);if(t===r&&!i){if(L(t)){const o=s.__lexicalTextContent;o!==void 0&&(Fe+=o,En+=o);const a=s.__lexicalDirTextContent;a!==void 0&&(mt+=a)}else{const o=t.getTextContent();U(t)&&!t.isDirectionless()&&(mt+=o),En+=o,Fe+=o}return s}if(t!==r&&i&&Pd(qs,Fs,al,r,"updated"),r.updateDOM(t,s,rr)){const o=$a(n,null);return e===null&&H(62),e.replaceChild(o,s),Oa(n,null),o}if(L(t)&&L(r)){const o=r.__indent;o!==t.__indent&&mm(s,o);const a=r.__format;a!==t.__format&&ym(s,a),i&&(jk(t,r,s),Qe(r)||r.isInline()||_m(t,r,s)),yl(r)&&(Fe+=Pn,En+=Pn)}else{const o=r.getTextContent();if(be(r)){const a=r.decorate(yt,rr);a!==null&&vm(n,a)}else U(r)&&!r.isDirectionless()&&(mt+=o);Fe+=o,En+=o}if(!Bs&&Qe(r)&&r.__cachedText!==En){const o=r.getWritable();o.__cachedText=En,r=o}return s}function vm(n,e){let t=yt._pendingDecorators;const r=yt._decorators;if(t===null){if(r[n]===e)return;t=ay(yt)}t[n]=e}function _c(n){let e=n.nextSibling;return e!==null&&e===yt._blockCursorElement&&(e=e.nextSibling),e}function Fk(n,e,t,r,i,s){Fe="",En="",mt="",pm=r===Ni,fa=null,yt=t,rr=t._config,Fs=t._nodes,al=yt._listeners.mutation,Yc=i,Xc=s,Fr=n._nodeMap,Kt=e._nodeMap,Bs=e._readOnly,Zc=new Map(t._keyToDOMMap);const o=new Map;return qs=o,Cs("root",null),yt=void 0,Fs=void 0,Yc=void 0,Xc=void 0,Fr=void 0,Kt=void 0,rr=void 0,Zc=void 0,qs=void 0,o}function tu(n){const e=Zc.get(n);return e===void 0&&H(75,n),e}function ie(n){return{type:n}}const Yr=ie("SELECTION_CHANGE_COMMAND"),qk=ie("SELECTION_INSERT_CLIPBOARD_NODES_COMMAND"),km=ie("CLICK_COMMAND"),dn=ie("DELETE_CHARACTER_COMMAND"),Qn=ie("INSERT_LINE_BREAK_COMMAND"),Ws=ie("INSERT_PARAGRAPH_COMMAND"),Ar=ie("CONTROLLED_TEXT_INSERTION_COMMAND"),Xr=ie("PASTE_COMMAND"),Ia=ie("REMOVE_TEXT_COMMAND"),Ai=ie("DELETE_WORD_COMMAND"),Oi=ie("DELETE_LINE_COMMAND"),Gn=ie("FORMAT_TEXT_COMMAND"),ll=ie("UNDO_COMMAND"),cl=ie("REDO_COMMAND"),zi=ie("KEYDOWN_COMMAND"),cd=ie("KEY_ARROW_RIGHT_COMMAND"),Bk=ie("MOVE_TO_END"),ud=ie("KEY_ARROW_LEFT_COMMAND"),Wk=ie("MOVE_TO_START"),dd=ie("KEY_ARROW_UP_COMMAND"),fd=ie("KEY_ARROW_DOWN_COMMAND"),$i=ie("KEY_ENTER_COMMAND"),wm=ie("KEY_SPACE_COMMAND"),hd=ie("KEY_BACKSPACE_COMMAND"),ul=ie("KEY_ESCAPE_COMMAND"),gd=ie("KEY_DELETE_COMMAND"),pd=ie("KEY_TAB_COMMAND"),Uk=ie("INSERT_TAB_COMMAND"),zk=ie("INDENT_CONTENT_COMMAND"),zf=ie("OUTDENT_CONTENT_COMMAND"),dl=ie("DROP_COMMAND"),Kk=ie("FORMAT_ELEMENT_COMMAND"),md=ie("DRAGSTART_COMMAND"),xm=ie("DRAGOVER_COMMAND"),Hk=ie("DRAGEND_COMMAND"),Zr=ie("COPY_COMMAND"),Ki=ie("CUT_COMMAND"),Ra=ie("SELECT_ALL_COMMAND"),yd=ie("CLEAR_EDITOR_COMMAND"),Cm=ie("CLEAR_HISTORY_COMMAND"),Ss=ie("CAN_REDO_COMMAND"),Ts=ie("CAN_UNDO_COMMAND"),Jk=ie("FOCUS_COMMAND"),Vk=ie("BLUR_COMMAND"),Gk=ie("KEY_MODIFIER_COMMAND"),wn=Object.freeze({}),nu=30,ru=[["keydown",function(n,e){if(Os=n.timeStamp,Sm=n.key,!e.isComposing()&&!Y(e,zi,n)&&n.key!=null){if(bc&&_h(n))return Et(e,()=>{Lo(e,vc)}),bc=!1,void(vc="");if(function(t){return Ce(t,"ArrowRight",{shiftKey:"any"})}(n))Y(e,cd,n);else if(function(t){return Ce(t,"ArrowRight",Sn)}(n))Y(e,Bk,n);else if(function(t){return Ce(t,"ArrowLeft",{shiftKey:"any"})}(n))Y(e,ud,n);else if(function(t){return Ce(t,"ArrowLeft",Sn)}(n))Y(e,Wk,n);else if(function(t){return Ce(t,"ArrowUp",{altKey:"any",shiftKey:"any"})}(n))Y(e,dd,n);else if(function(t){return Ce(t,"ArrowDown",{altKey:"any",shiftKey:"any"})}(n))Y(e,fd,n);else if(function(t){return Ce(t,"Enter",{altKey:"any",ctrlKey:"any",metaKey:"any",shiftKey:!0})}(n))$s=!0,Y(e,$i,n);else if(function(t){return t.key===" "}(n))Y(e,wm,n);else if(function(t){return ln&&Ce(t,"o",{ctrlKey:!0})}(n))n.preventDefault(),$s=!0,Y(e,Qn,!0);else if(function(t){return Ce(t,"Enter",{altKey:"any",ctrlKey:"any",metaKey:"any"})}(n))$s=!1,Y(e,$i,n);else if(function(t){return Ce(t,"Backspace",{shiftKey:"any"})||ln&&Ce(t,"h",{ctrlKey:!0})}(n))_h(n)?Y(e,hd,n):(n.preventDefault(),Y(e,dn,!0));else if(function(t){return t.key==="Escape"}(n))Y(e,ul,n);else if(function(t){return Ce(t,"Delete",{})||ln&&Ce(t,"d",{ctrlKey:!0})}(n))(function(t){return t.key==="Delete"})(n)?Y(e,gd,n):(n.preventDefault(),Y(e,dn,!1));else if(function(t){return Ce(t,"Backspace",yh)}(n))n.preventDefault(),Y(e,Ai,!0);else if(function(t){return Ce(t,"Delete",yh)}(n))n.preventDefault(),Y(e,Ai,!1);else if(function(t){return ln&&Ce(t,"Backspace",{metaKey:!0})}(n))n.preventDefault(),Y(e,Oi,!0);else if(function(t){return ln&&(Ce(t,"Delete",{metaKey:!0})||Ce(t,"k",{ctrlKey:!0}))}(n))n.preventDefault(),Y(e,Oi,!1);else if(function(t){return Ce(t,"b",Sn)}(n))n.preventDefault(),Y(e,Gn,"bold");else if(function(t){return Ce(t,"u",Sn)}(n))n.preventDefault(),Y(e,Gn,"underline");else if(function(t){return Ce(t,"i",Sn)}(n))n.preventDefault(),Y(e,Gn,"italic");else if(function(t){return Ce(t,"Tab",{shiftKey:"any"})}(n))Y(e,pd,n);else if(function(t){return Ce(t,"z",Sn)}(n))n.preventDefault(),Y(e,ll,void 0);else if(function(t){return ln?Ce(t,"z",{metaKey:!0,shiftKey:!0}):Ce(t,"y",{ctrlKey:!0})||Ce(t,"z",{ctrlKey:!0,shiftKey:!0})}(n))n.preventDefault(),Y(e,cl,void 0);else{const t=e._editorState._selection;t===null||B(t)?bh(n)&&(n.preventDefault(),Y(e,Ra,n)):function(r){return Ce(r,"c",Sn)}(n)?(n.preventDefault(),Y(e,Zr,n)):function(r){return Ce(r,"x",Sn)}(n)?(n.preventDefault(),Y(e,Ki,n)):bh(n)&&(n.preventDefault(),Y(e,Ra,n))}(function(t){return t.ctrlKey||t.shiftKey||t.altKey||t.metaKey})(n)&&Y(e,Gk,n)}}],["pointerdown",function(n,e){const t=n.target,r=n.pointerType;ti(t)&&r!=="touch"&&r!=="pen"&&n.button===0&&Et(e,()=>{gh(t)||(su=!0)})}],["compositionstart",function(n,e){Et(e,()=>{const t=K();if(B(t)&&!e.isComposing()){const r=t.anchor,i=t.anchor.getNode();Ze(r.key),(n.timeStamp<Os+nu||r.type==="element"||!t.isCollapsed()||i.getFormat()!==t.format||U(i)&&i.getStyle()!==t.style)&&Y(e,Ar,kk)}})}],["compositionend",function(n,e){Lr?vs=!0:Ei||!Ls&&!Ea?Et(e,()=>{Lo(e,n.data)}):(bc=!0,vc=n.data)}],["input",function(n,e){n.stopPropagation(),Et(e,()=>{if(Te(n.target)&&gh(n.target))return;const t=K(),r=n.data,i=Am(n);if(r!=null&&B(t)&&Nm(t,i,r,n.timeStamp,!1)){vs&&(Lo(e,r),vs=!1);const s=t.anchor.getNode(),o=Gt(jt(e));if(o===null)return;const a=t.isBackward(),l=a?t.anchor.offset:t.focus.offset,c=a?t.focus.offset:t.anchor.offset;Ta&&!t.isCollapsed()&&U(s)&&o.anchorNode!==null&&s.getTextContent().slice(0,l)+r+s.getTextContent().slice(l+c)===dy(o.anchorNode)||Y(e,Ar,r);const u=r.length;Lr&&u>1&&n.inputType==="insertCompositionText"&&!e.isComposing()&&(t.anchor.offset-=u),Ls||Ei||Ea||!e.isComposing()||(Os=0,Ze(null))}else Od(!1,e,r!==null?r:void 0),vs&&(Lo(e,r||void 0),vs=!1);(function(){Xe();const s=$e();cm(s)})()},{event:n}),mi=null}],["click",function(n,e){Et(e,()=>{const t=K(),r=Gt(jt(e)),i=Ji();if(r){if(B(t)){const s=t.anchor,o=s.getNode();if(s.type==="element"&&s.offset===0&&t.isCollapsed()&&!Qe(o)&&pe().getChildrenSize()===1&&o.getTopLevelElementOrThrow().isEmpty()&&i!==null&&t.is(i))r.removeAllRanges(),t.dirty=!0;else if(n.detail===3&&!t.isCollapsed()&&o!==t.focus.getNode()){const a=function(l,c){let u=l;for(;u!==pe()&&u!=null;){if(c(u))return u;u=u.getParent()}return null}(o,l=>L(l)&&!l.isInline());L(a)&&a.select(0)}}else if(n.pointerType==="touch"||n.pointerType==="pen"){const s=r.anchorNode;(Te(s)||jn(s))&&rt(vd(i,r,e,n))}}Y(e,km,n)})}],["cut",wn],["copy",wn],["dragstart",wn],["dragover",wn],["dragend",wn],["paste",wn],["focus",wn],["blur",wn],["drop",wn]];Ta&&ru.push(["beforeinput",(n,e)=>function(t,r){const i=t.inputType,s=Am(t);i==="deleteCompositionText"||Lr&&hy(r)||i!=="insertCompositionText"&&Et(r,()=>{const o=K();if(i==="deleteContentBackward"){if(o===null){const g=Ji();if(!B(g))return;rt(g.clone())}if(B(o)){const g=o.anchor.key===o.focus.key;if(a=t.timeStamp,Sm==="MediaLast"&&a<Os+nu&&r.isComposing()&&g){if(Ze(null),Os=0,setTimeout(()=>{Et(r,()=>{Ze(null)})},nu),B(o)){const p=o.anchor.getNode();p.markDirty(),U(p)||H(142),Mm(o,p)}}else{Ze(null),t.preventDefault();const p=o.anchor.getNode(),m=p.getTextContent(),y=p.canInsertTextAfter(),v=o.anchor.offset===0&&o.focus.offset===m.length;let _=$f&&g&&!v&&y;if(_&&o.isCollapsed()&&(_=!be(du(o.anchor,!0))),!_){Y(r,dn,!0);const w=K();$f&&B(w)&&w.isCollapsed()&&(Mr=w,setTimeout(()=>Mr=null))}}return}}var a;if(!B(o))return;const l=t.data;mi!==null&&Od(!1,r,mi),o.dirty&&mi===null||!o.isCollapsed()||Qe(o.anchor.getNode())||s===null||o.applyDOMRange(s),mi=null;const c=o.anchor,u=o.focus,f=c.getNode(),d=u.getNode();if(i!=="insertText"&&i!=="insertTranspose")switch(t.preventDefault(),i){case"insertFromYank":case"insertFromDrop":case"insertReplacementText":Y(r,Ar,t);break;case"insertFromComposition":Ze(null),Y(r,Ar,t);break;case"insertLineBreak":Ze(null),Y(r,Qn,!1);break;case"insertParagraph":Ze(null),$s&&!Ei?($s=!1,Y(r,Qn,!1)):Y(r,Ws,void 0);break;case"insertFromPaste":case"insertFromPasteAsQuotation":Y(r,Xr,t);break;case"deleteByComposition":(function(g,p){return g!==p||L(g)||L(p)||!Pr(g)||!Pr(p)})(f,d)&&Y(r,Ia,t);break;case"deleteByDrag":case"deleteByCut":Y(r,Ia,t);break;case"deleteContent":Y(r,dn,!1);break;case"deleteWordBackward":Y(r,Ai,!0);break;case"deleteWordForward":Y(r,Ai,!1);break;case"deleteHardLineBackward":case"deleteSoftLineBackward":Y(r,Oi,!0);break;case"deleteContentForward":case"deleteHardLineForward":case"deleteSoftLineForward":Y(r,Oi,!1);break;case"formatStrikeThrough":Y(r,Gn,"strikethrough");break;case"formatBold":Y(r,Gn,"bold");break;case"formatItalic":Y(r,Gn,"italic");break;case"formatUnderline":Y(r,Gn,"underline");break;case"historyUndo":Y(r,ll,void 0);break;case"historyRedo":Y(r,cl,void 0)}else{if(l===`
`)t.preventDefault(),Y(r,Qn,!1);else if(l===Pn)t.preventDefault(),Y(r,Ws,void 0);else if(l==null&&t.dataTransfer){const g=t.dataTransfer.getData("text/plain");t.preventDefault(),o.insertRawText(g)}else l!=null&&Nm(o,s,l,t.timeStamp,!0)?(t.preventDefault(),Y(r,Ar,l)):mi=l;Tm=t.timeStamp}})}(n,e)]);let Os=0,Sm=null,Tm=0,mi=null;const Da=new WeakMap;let iu=!1,su=!1,$s=!1,vs=!1,bc=!1,vc="",Mr=null,Em=[0,"",0,"root",0];function Nm(n,e,t,r,i){const s=n.anchor,o=n.focus,a=s.getNode(),l=$e(),c=Gt(jt(l)),u=c!==null?c.anchorNode:null,f=s.key,d=l.getElementByKey(f),g=t.length;return f!==o.key||!U(a)||(!i&&(!Ta||Tm<r+50)||a.isDirty()&&g<2||cy(t))&&s.offset!==o.offset&&!a.isComposing()||Tn(a)||a.isDirty()&&g>1||(i||!Ta)&&d!==null&&!a.isComposing()&&u!==Pi(d)||c!==null&&e!==null&&(!e.collapsed||e.startContainer!==c.anchorNode||e.startOffset!==c.anchorOffset)||a.getFormat()!==n.format||a.getStyle()!==n.style||function(p,m){if(m.isSegmented())return!0;if(!p.isCollapsed())return!1;const y=p.anchor.offset,v=m.getParentOrThrow(),_=Pr(m);return y===0?!m.canInsertTextBefore()||!v.canInsertTextBefore()&&!m.isComposing()||_||function(w){const E=w.getPreviousSibling();return(U(E)||L(E)&&E.isInline())&&!E.canInsertTextAfter()}(m):y===m.getTextContentSize()&&(!m.canInsertTextAfter()||!v.canInsertTextAfter()&&!m.isComposing()||_)}(n,a)}function Kf(n,e){return jn(n)&&n.nodeValue!==null&&e!==0&&e!==n.nodeValue.length}function Hf(n,e,t){const{anchorNode:r,anchorOffset:i,focusNode:s,focusOffset:o}=n;iu&&(iu=!1,Kf(r,i)&&Kf(s,o)&&!Mr)||Et(e,()=>{if(!t)return void rt(null);if(!io(e,r,s))return;let a=K();if(Mr&&B(a)&&a.isCollapsed()){const l=a.anchor,c=Mr.anchor;(l.key===c.key&&l.offset===c.offset+1||l.offset===1&&c.getNode().is(l.getNode().getPreviousSibling()))&&(a=Mr.clone(),rt(a))}if(Mr=null,B(a)){const l=a.anchor,c=l.getNode();if(a.isCollapsed()){n.type==="Range"&&n.anchorNode===n.focusNode&&(a.dirty=!0);const u=jt(e).event,f=u?u.timeStamp:performance.now(),[d,g,p,m,y]=Em,v=pe(),_=e.isComposing()===!1&&v.getTextContent()==="";if(f<y+200&&l.offset===p&&l.key===m)ha(a,d,g);else if(l.type==="text")U(c)||H(141),Mm(a,c);else if(l.type==="element"&&!_){L(c)||H(259);const w=l.getNode();w.isEmpty()?function(E,$){const P=$.getTextFormat(),R=$.getTextStyle();ha(E,P,R)}(a,w):ha(a,0,"")}}else{const u=l.key,f=a.focus.key,d=a.getNodes(),g=d.length,p=a.isBackward(),m=p?o:i,y=p?i:o,v=p?f:u,_=p?u:f;let w=vk,E=!1;for(let $=0;$<g;$++){const P=d[$],R=P.getTextContentSize();if(U(P)&&R!==0&&!($===0&&P.__key===v&&m===R||$===g-1&&P.__key===_&&y===0)&&(E=!0,w&=P.getFormat(),w===0))break}a.format=E?w:0}}Y(e,Yr,void 0)})}function ha(n,e,t){n.format===e&&n.style===t||(n.format=e,n.style=t,n.dirty=!0)}function Mm(n,e){ha(n,e.getFormat(),e.getStyle())}function Am(n){if(!n.getTargetRanges)return null;const e=n.getTargetRanges();return e.length===0?null:e[0]}function Lo(n,e){const t=n._compositionKey;if(Ze(null),t!==null&&e!=null){if(e===""){const r=he(t),i=Pi(n.getElementByKey(t));return void(i!==null&&i.nodeValue!==null&&U(r)&&$d(r,i.nodeValue,null,null,!0))}if(e[e.length-1]===`
`){const r=K();if(B(r)){const i=r.focus;return r.anchor.set(i.key,i.offset,i.type),void Y(n,$i,null)}}}Od(!0,n,e)}function Om(n){let e=n.__lexicalEventHandles;return e===void 0&&(e=[],n.__lexicalEventHandles=e),e}const vi=new Map;function $m(n){const e=Tw(n.target);if(e===null)return;const t=sy(e.anchorNode);if(t===null)return;su&&(su=!1,Et(t,()=>{const l=Ji(),c=e.anchorNode;(Te(c)||jn(c))&&rt(vd(l,e,t,n))}));const r=Ad(t),i=r[r.length-1],s=i._key,o=vi.get(s),a=o||i;a!==t&&Hf(e,a,!1),Hf(e,t,!0),t!==i?vi.set(s,t):o&&vi.delete(s)}function Jf(n){n._lexicalHandled=!0}function Vf(n){return n._lexicalHandled===!0}function Yk(n){const e=n.ownerDocument,t=Da.get(e);if(t===void 0)return;const r=t-1;r>=0||H(164),Da.set(e,r),r===0&&e.removeEventListener("selectionchange",$m);const i=pl(n);Md(i)?(function(o){if(o._parentEditor!==null){const a=Ad(o),l=a[a.length-1]._key;vi.get(l)===o&&vi.delete(l)}else vi.delete(o._key)}(i),n.__lexicalEditor=null):i&&H(198);const s=Om(n);for(let o=0;o<s.length;o++)s[o]();n.__lexicalEventHandles=[]}function ou(n,e,t){Xe();const r=n.__key,i=n.getParent();if(i===null)return;const s=function(a){const l=K();if(!B(l)||!L(a))return l;const{anchor:c,focus:u}=l,f=c.getNode(),d=u.getNode();return fu(f,a)&&c.set(a.__key,0,"element"),fu(d,a)&&u.set(a.__key,0,"element"),l}(n);let o=!1;if(B(s)&&e){const a=s.anchor,l=s.focus;a.key===r&&(ja(a,n,i,n.getPreviousSibling(),n.getNextSibling()),o=!0),l.key===r&&(ja(l,n,i,n.getPreviousSibling(),n.getNextSibling()),o=!0)}else pt(s)&&e&&n.isSelected()&&n.selectPrevious();if(B(s)&&e&&!o){const a=n.getIndexWithinParent();Ir(n),La(s,i,a,-1)}else Ir(n);t||yn(i)||i.canBeEmpty()||!i.isEmpty()||ou(i,e),e&&s&&Qe(i)&&i.isEmpty()&&i.selectEnd()}class Hi{static getType(){const{ownNodeType:e}=Dd(this);return e===void 0&&H(64,this.name),e}static clone(e){H(65,this.name)}$config(){return{}}config(e,t){const r=t.extends||Object.getPrototypeOf(this.constructor);return Object.assign(t,{extends:r,type:e}),{[e]:t}}afterCloneFrom(e){this.__key===e.__key?(this.__parent=e.__parent,this.__next=e.__next,this.__prev=e.__prev,this.__state=e.__state):e.__state&&(this.__state=e.__state.getWritable(this))}constructor(e){this.__type=this.constructor.getType(),this.__parent=null,this.__prev=null,this.__next=null,Object.defineProperty(this,"__state",{configurable:!0,enumerable:!1,value:void 0,writable:!0}),bw(this,e)}getType(){return this.__type}isInline(){H(137,this.constructor.name)}isAttached(){let e=this.__key;for(;e!==null;){if(e==="root")return!0;const t=he(e);if(t===null)break;e=t.__parent}return!1}isSelected(e){const t=e||K();if(t==null)return!1;const r=t.getNodes().some(i=>i.__key===this.__key);if(U(this))return r;if(B(t)&&t.anchor.type==="element"&&t.focus.type==="element"){if(t.isCollapsed())return!1;const i=this.getParent();if(be(this)&&this.isInline()&&i){const s=t.isBackward()?t.focus:t.anchor;if(i.is(s.getNode())&&s.offset===i.getChildrenSize()&&this.is(i.getLastChild()))return!1}}return r}getKey(){return this.__key}getIndexWithinParent(){const e=this.getParent();if(e===null)return-1;let t=e.getFirstChild(),r=0;for(;t!==null;){if(this.is(t))return r;r++,t=t.getNextSibling()}return-1}getParent(){const e=this.getLatest().__parent;return e===null?null:he(e)}getParentOrThrow(){const e=this.getParent();return e===null&&H(66,this.__key),e}getTopLevelElement(){let e=this;for(;e!==null;){const t=e.getParent();if(yn(t))return L(e)||e===this&&be(e)||H(194),e;e=t}return null}getTopLevelElementOrThrow(){const e=this.getTopLevelElement();return e===null&&H(67,this.__key),e}getParents(){const e=[];let t=this.getParent();for(;t!==null;)e.push(t),t=t.getParent();return e}getParentKeys(){const e=[];let t=this.getParent();for(;t!==null;)e.push(t.__key),t=t.getParent();return e}getPreviousSibling(){const e=this.getLatest().__prev;return e===null?null:he(e)}getPreviousSiblings(){const e=[],t=this.getParent();if(t===null)return e;let r=t.getFirstChild();for(;r!==null&&!r.is(this);)e.push(r),r=r.getNextSibling();return e}getNextSibling(){const e=this.getLatest().__next;return e===null?null:he(e)}getNextSiblings(){const e=[];let t=this.getNextSibling();for(;t!==null;)e.push(t),t=t.getNextSibling();return e}getCommonAncestor(e){const t=L(this)?this:this.getParent(),r=L(e)?e:e.getParent(),i=t&&r?Rs(t,r):null;return i?i.commonAncestor:null}is(e){return e!=null&&this.__key===e.__key}isBefore(e){const t=Rs(this,e);return t!==null&&(t.type==="descendant"||(t.type==="branch"?vy(t)===-1:(t.type!=="same"&&t.type!=="ancestor"&&H(279),!1)))}isParentOf(e){const t=Rs(this,e);return t!==null&&t.type==="ancestor"}getNodesBetween(e){const t=this.isBefore(e),r=[],i=new Set;let s=this;for(;s!==null;){const o=s.__key;if(i.has(o)||(i.add(o),r.push(s)),s===e)break;const a=L(s)?t?s.getFirstChild():s.getLastChild():null;if(a!==null){s=a;continue}const l=t?s.getNextSibling():s.getPreviousSibling();if(l!==null){s=l;continue}const c=s.getParentOrThrow();if(i.has(c.__key)||r.push(c),c===e)break;let u=null,f=c;do{if(f===null&&H(68),u=t?f.getNextSibling():f.getPreviousSibling(),f=f.getParent(),f===null)break;u!==null||i.has(f.__key)||r.push(f)}while(u===null);s=u}return t||r.reverse(),r}isDirty(){const e=$e()._dirtyLeaves;return e!==null&&e.has(this.__key)}getLatest(){const e=he(this.__key);return e===null&&H(113),e}getWritable(){Xe();const e=fr(),t=$e(),r=e._nodeMap,i=this.__key,s=this.getLatest(),o=t._cloneNotNeeded,a=K();if(a!==null&&a.setCachedNodes(null),o.has(i))return qa(s),s;const l=Rd(s);return o.add(i),qa(l),r.set(i,l),l}getTextContent(){return""}getTextContentSize(){return this.getTextContent().length}createDOM(e,t){H(70)}updateDOM(e,t,r){H(71)}exportDOM(e){return{element:this.createDOM(e._config,e)}}exportJSON(){const e=this.__state?this.__state.toJSON():void 0;return{type:this.__type,version:1,...e}}static importJSON(e){H(18,this.name)}updateFromJSON(e){return function(t,r){const i=t.getWritable(),s=r.$;let o=s;for(const a of gm(i).flatKeys)a in r&&(o!==void 0&&o!==s||(o={...s}),o[a]=r[a]);return(i.__state||o)&&hm(t).updateFromJSON(o),i}(this,e)}static transform(){return null}remove(e){ou(this,!0,e)}replace(e,t){Xe();let r=K();r!==null&&(r=r.clone()),Tc(this,e);const i=this.getLatest(),s=this.__key,o=e.__key,a=e.getWritable(),l=this.getParentOrThrow().getWritable(),c=l.__size;Ir(a);const u=i.getPreviousSibling(),f=i.getNextSibling(),d=i.__prev,g=i.__next,p=i.__parent;if(ou(i,!1,!0),u===null?l.__first=o:u.getWritable().__next=o,a.__prev=d,f===null?l.__last=o:f.getWritable().__prev=o,a.__next=g,a.__parent=p,l.__size=c,t&&(L(this)&&L(a)||H(139),this.getChildren().forEach(m=>{a.append(m)})),B(r)){rt(r);const m=r.anchor,y=r.focus;m.key===s&&Zf(m,a),y.key===s&&Zf(y,a)}return Yn()===s&&Ze(o),a}insertAfter(e,t=!0){Xe(),Tc(this,e);const r=this.getWritable(),i=e.getWritable(),s=i.getParent(),o=K();let a=!1,l=!1;if(s!==null){const g=e.getIndexWithinParent();if(Ir(i),B(o)){const p=s.__key,m=o.anchor,y=o.focus;a=m.type==="element"&&m.key===p&&m.offset===g+1,l=y.type==="element"&&y.key===p&&y.offset===g+1}}const c=this.getNextSibling(),u=this.getParentOrThrow().getWritable(),f=i.__key,d=r.__next;if(c===null?u.__last=f:c.getWritable().__prev=f,u.__size++,r.__next=f,i.__next=d,i.__prev=r.__key,i.__parent=r.__parent,t&&B(o)){const g=this.getIndexWithinParent();La(o,u,g+1);const p=u.__key;a&&o.anchor.set(p,g+2,"element"),l&&o.focus.set(p,g+2,"element")}return e}insertBefore(e,t=!0){Xe(),Tc(this,e);const r=this.getWritable(),i=e.getWritable(),s=i.__key;Ir(i);const o=this.getPreviousSibling(),a=this.getParentOrThrow().getWritable(),l=r.__prev,c=this.getIndexWithinParent();o===null?a.__first=s:o.getWritable().__next=s,a.__size++,r.__prev=s,i.__prev=l,i.__next=r.__key,i.__parent=r.__parent;const u=K();return t&&B(u)&&La(u,this.getParentOrThrow(),c),e}isParentRequired(){return!1}createParentElementNode(){return Ot()}selectStart(){return this.selectPrevious()}selectEnd(){return this.selectNext(0,0)}selectPrevious(e,t){Xe();const r=this.getPreviousSibling(),i=this.getParentOrThrow();if(r===null)return i.select(0,0);if(L(r))return r.select();if(!U(r)){const s=r.getIndexWithinParent()+1;return i.select(s,s)}return r.select(e,t)}selectNext(e,t){Xe();const r=this.getNextSibling(),i=this.getParentOrThrow();if(r===null)return i.select();if(L(r))return r.select(0,0);if(!U(r)){const s=r.getIndexWithinParent();return i.select(s,s)}return r.select(e,t)}markDirty(){this.getWritable()}reconcileObservedMutation(e,t){this.markDirty()}}class Qr extends Hi{static getType(){return"linebreak"}static clone(e){return new Qr(e.__key)}constructor(e){super(e)}getTextContent(){return`
`}createDOM(){return document.createElement("br")}updateDOM(){return!1}isInline(){return!0}static importDOM(){return{br:e=>function(t){const r=t.parentElement;if(r!==null&&Ba(r)){const i=r.firstChild;if(i===t||i.nextSibling===t&&jo(i)){const s=r.lastChild;if(s===t||s.previousSibling===t&&jo(s))return!0}}return!1}(e)||function(t){const r=t.parentElement;if(r!==null&&Ba(r)){const i=r.firstChild;if(i===t||i.nextSibling===t&&jo(i))return!1;const s=r.lastChild;if(s===t||s.previousSibling===t&&jo(s))return!0}return!1}(e)?null:{conversion:Xk,priority:0}}}static importJSON(e){return qr().updateFromJSON(e)}}function Xk(n){return{node:qr()}}function qr(){return Ne(new Qr)}function Or(n){return n instanceof Qr}function jo(n){return jn(n)&&/^( |\t|\r?\n)+$/.test(n.textContent||"")}function kc(n,e){return 16&e?"code":e&td?"mark":32&e?"sub":64&e?"sup":null}function wc(n,e){return 1&e?"strong":2&e?"em":"span"}function Pm(n,e,t,r,i){const s=r.classList;let o=ki(i,"base");o!==void 0&&s.add(...o),o=ki(i,"underlineStrikethrough");let a=!1;const l=e&Aa&&e&Ma;o!==void 0&&(t&Aa&&t&Ma?(a=!0,l||s.add(...o)):l&&s.remove(...o));for(const c in nr){const u=nr[c];if(o=ki(i,c),o!==void 0)if(t&u){if(a&&(c==="underline"||c==="strikethrough")){e&u&&s.remove(...o);continue}e&u&&(!l||c!=="underline")&&c!=="strikethrough"||s.add(...o)}else e&u&&s.remove(...o)}}function Im(n,e,t){const r=e.firstChild,i=t.isComposing(),s=n+(i?ol:"");if(r==null)e.textContent=s;else{const o=r.nodeValue;if(o!==s)if(i||Lr){const[a,l,c]=function(u,f){const d=u.length,g=f.length;let p=0,m=0;for(;p<d&&p<g&&u[p]===f[p];)p++;for(;m+p<d&&m+p<g&&u[d-m-1]===f[g-m-1];)m++;return[p,d-p-m,f.slice(p,g-m)]}(o,s);l!==0&&r.deleteData(a,l),r.insertData(a,c)}else r.nodeValue=s}}function Gf(n,e,t,r,i,s){Im(i,n,e);const o=s.theme.text;o!==void 0&&Pm(0,0,r,n,o)}function Fo(n,e){const t=document.createElement(e);return t.appendChild(n),t}let At=class Rm extends Hi{static getType(){return"text"}static clone(e){return new Rm(e.__text,e.__key)}afterCloneFrom(e){super.afterCloneFrom(e),this.__text=e.__text,this.__format=e.__format,this.__style=e.__style,this.__mode=e.__mode,this.__detail=e.__detail}constructor(e="",t){super(t),this.__text=e,this.__format=0,this.__style="",this.__mode=0,this.__detail=0}getFormat(){return this.getLatest().__format}getDetail(){return this.getLatest().__detail}getMode(){const e=this.getLatest();return Ek[e.__mode]}getStyle(){return this.getLatest().__style}isToken(){return this.getLatest().__mode===1}isComposing(){return this.__key===Yn()}isSegmented(){return this.getLatest().__mode===2}isDirectionless(){return!!(1&this.getLatest().__detail)}isUnmergeable(){return!!(2&this.getLatest().__detail)}hasFormat(e){const t=nr[e];return!!(this.getFormat()&t)}isSimpleText(){return this.__type==="text"&&this.__mode===0}getTextContent(){return this.getLatest().__text}getFormatFlags(e,t){return Fa(this.getLatest().__format,e,t)}canHaveFormat(){return!0}isInline(){return!0}createDOM(e,t){const r=this.__format,i=kc(0,r),s=wc(0,r),o=i===null?s:i,a=document.createElement(o);let l=a;this.hasFormat("code")&&a.setAttribute("spellcheck","false"),i!==null&&(l=document.createElement(s),a.appendChild(l)),Gf(l,this,0,r,this.__text,e);const c=this.__style;return c!==""&&(a.style.cssText=c),a}updateDOM(e,t,r){const i=this.__text,s=e.__format,o=this.__format,a=kc(0,s),l=kc(0,o),c=wc(0,s),u=wc(0,o);if((a===null?c:a)!==(l===null?u:l))return!0;if(a===l&&c!==u){const m=t.firstChild;m==null&&H(48);const y=document.createElement(u);return Gf(y,this,0,o,i,r),t.replaceChild(y,m),!1}let f=t;l!==null&&a!==null&&(f=t.firstChild,f==null&&H(49)),Im(i,f,this);const d=r.theme.text;d!==void 0&&s!==o&&Pm(0,s,o,f,d);const g=e.__style,p=this.__style;return g!==p&&(t.style.cssText=p),!1}static importDOM(){return{"#text":()=>({conversion:tw,priority:0}),b:()=>({conversion:Qk,priority:0}),code:()=>({conversion:xn,priority:0}),em:()=>({conversion:xn,priority:0}),i:()=>({conversion:xn,priority:0}),mark:()=>({conversion:xn,priority:0}),s:()=>({conversion:xn,priority:0}),span:()=>({conversion:Zk,priority:0}),strong:()=>({conversion:xn,priority:0}),sub:()=>({conversion:xn,priority:0}),sup:()=>({conversion:xn,priority:0}),u:()=>({conversion:xn,priority:0})}}static importJSON(e){return ue().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setTextContent(e.text).setFormat(e.format).setDetail(e.detail).setMode(e.mode).setStyle(e.style)}exportDOM(e){let{element:t}=super.exportDOM(e);return Te(t)||H(132),t.style.whiteSpace="pre-wrap",this.hasFormat("lowercase")?t.style.textTransform="lowercase":this.hasFormat("uppercase")?t.style.textTransform="uppercase":this.hasFormat("capitalize")&&(t.style.textTransform="capitalize"),this.hasFormat("bold")&&(t=Fo(t,"b")),this.hasFormat("italic")&&(t=Fo(t,"i")),this.hasFormat("strikethrough")&&(t=Fo(t,"s")),this.hasFormat("underline")&&(t=Fo(t,"u")),{element:t}}exportJSON(){return{detail:this.getDetail(),format:this.getFormat(),mode:this.getMode(),style:this.getStyle(),text:this.getTextContent(),...super.exportJSON()}}selectionTransform(e,t){}setFormat(e){const t=this.getWritable();return t.__format=typeof e=="string"?nr[e]:e,t}setDetail(e){const t=this.getWritable();return t.__detail=typeof e=="string"?Ck[e]:e,t}setStyle(e){const t=this.getWritable();return t.__style=e,t}toggleFormat(e){const t=Fa(this.getFormat(),e,null);return this.setFormat(t)}toggleDirectionless(){const e=this.getWritable();return e.__detail^=1,e}toggleUnmergeable(){const e=this.getWritable();return e.__detail^=2,e}setMode(e){const t=Tk[e];if(this.__mode===t)return this;const r=this.getWritable();return r.__mode=t,r}setTextContent(e){if(this.__text===e)return this;const t=this.getWritable();return t.__text=e,t}select(e,t){Xe();let r=e,i=t;const s=K(),o=this.getTextContent(),a=this.__key;if(typeof o=="string"){const l=o.length;r===void 0&&(r=l),i===void 0&&(i=l)}else r=0,i=0;if(!B(s))return Um(a,r,a,i,"text","text");{const l=Yn();l!==s.anchor.key&&l!==s.focus.key||Ze(a),s.setTextNodeRange(this,r,this,i)}return s}selectStart(){return this.select(0,0)}selectEnd(){const e=this.getTextContentSize();return this.select(e,e)}spliceText(e,t,r,i){const s=this.getWritable(),o=s.__text,a=r.length;let l=e;l<0&&(l=a+l,l<0&&(l=0));const c=K();if(i&&B(c)){const f=e+a;c.setTextNodeRange(s,f,s,f)}const u=o.slice(0,l)+r+o.slice(l+t);return s.__text=u,s}canInsertTextBefore(){return!0}canInsertTextAfter(){return!0}splitText(...e){Xe();const t=this.getLatest(),r=t.getTextContent();if(r==="")return[];const i=t.__key,s=Yn(),o=r.length;e.sort((N,M)=>N-M),e.push(o);const a=[],l=e.length;for(let N=0,M=0;N<o&&M<=l;M++){const j=e[M];j>N&&(a.push(r.slice(N,j)),N=j)}const c=a.length;if(c===1)return[t];const u=a[0],f=t.getParent();let d;const g=t.getFormat(),p=t.getStyle(),m=t.__detail;let y=!1,v=null,_=null;const w=K();if(B(w)){const[N,M]=w.isBackward()?[w.focus,w.anchor]:[w.anchor,w.focus];N.type==="text"&&N.key===i&&(v=N),M.type==="text"&&M.key===i&&(_=M)}t.isSegmented()?(d=ue(u),d.__format=g,d.__style=p,d.__detail=m,d.__state=jf(t,d),y=!0):d=t.setTextContent(u);const E=[d];for(let N=1;N<c;N++){const M=ue(a[N]);M.__format=g,M.__style=p,M.__detail=m,M.__state=jf(t,M);const j=M.__key;s===i&&Ze(j),E.push(M)}const $=v?v.offset:null,P=_?_.offset:null;let R=0;for(const N of E){if(!v&&!_)break;const M=R+N.getTextContentSize();if(v!==null&&$!==null&&$<=M&&$>=R&&(v.set(N.getKey(),$-R,"text"),$<M&&(v=null)),_!==null&&P!==null&&P<=M&&P>=R){_.set(N.getKey(),P-R,"text");break}R=M}if(f!==null){(function(j){const k=j.getPreviousSibling(),I=j.getNextSibling();k!==null&&qa(k),I!==null&&qa(I)})(this);const N=f.getWritable(),M=this.getIndexWithinParent();y?(N.splice(M,0,E),this.remove()):N.splice(M,1,E),B(w)&&La(w,f,M,c-1)}return E}mergeWithSibling(e){const t=e===this.getPreviousSibling();t||e===this.getNextSibling()||H(50);const r=this.__key,i=e.__key,s=this.__text,o=s.length;Yn()===i&&Ze(r);const a=K();if(B(a)){const f=a.anchor,d=a.focus;f!==null&&f.key===i&&sh(f,t,r,e,o),d!==null&&d.key===i&&sh(d,t,r,e,o)}const l=e.__text,c=t?l+s:s+l;this.setTextContent(c);const u=this.getWritable();return e.remove(),u}isTextEntity(){return!1}};function Zk(n){return{forChild:_d(n.style),node:null}}function Qk(n){const e=n,t=e.style.fontWeight==="normal";return{forChild:_d(e.style,t?void 0:"bold"),node:null}}const Yf=new WeakMap;function ew(n){if(!Te(n))return!1;if(n.nodeName==="PRE")return!0;const e=n.style.whiteSpace;return typeof e=="string"&&e.startsWith("pre")}function tw(n){const e=n;n.parentElement===null&&H(129);let t=e.textContent||"";if(function(r){let i,s=r.parentNode;const o=[r];for(;s!==null&&(i=Yf.get(s))===void 0&&!ew(s);)o.push(s),s=s.parentNode;const a=i===void 0?s:i;for(let l=0;l<o.length;l++)Yf.set(o[l],a);return a}(e)!==null){const r=t.split(/(\r?\n|\t)/),i=[],s=r.length;for(let o=0;o<s;o++){const a=r[o];a===`
`||a===`\r
`?i.push(qr()):a==="	"?i.push(to()):a!==""&&i.push(ue(a))}return{node:i}}if(t=t.replace(/\r/g,"").replace(/[ \t\n]+/g," "),t==="")return{node:null};if(t[0]===" "){let r=e,i=!0;for(;r!==null&&(r=Xf(r,!1))!==null;){const s=r.textContent||"";if(s.length>0){/[ \t\n]$/.test(s)&&(t=t.slice(1)),i=!1;break}}i&&(t=t.slice(1))}if(t[t.length-1]===" "){let r=e,i=!0;for(;r!==null&&(r=Xf(r,!0))!==null;)if((r.textContent||"").replace(/^( |\t|\r?\n)+/,"").length>0){i=!1;break}i&&(t=t.slice(0,t.length-1))}return t===""?{node:null}:{node:ue(t)}}function Xf(n,e){let t=n;for(;;){let r;for(;(r=e?t.nextSibling:t.previousSibling)===null;){const s=t.parentElement;if(s===null)return null;t=s}if(t=r,Te(t)){const s=t.style.display;if(s===""&&!pu(t)||s!==""&&!s.startsWith("inline"))return null}let i=t;for(;(i=e?t.firstChild:t.lastChild)!==null;)t=i;if(jn(t))return t;if(t.nodeName==="BR")return null}}const nw={code:"code",em:"italic",i:"italic",mark:"highlight",s:"strikethrough",strong:"bold",sub:"subscript",sup:"superscript",u:"underline"};function xn(n){const e=nw[n.nodeName.toLowerCase()];return e===void 0?{node:null}:{forChild:_d(n.style,e),node:null}}function ue(n=""){return Ne(new At(n))}function U(n){return n instanceof At}function _d(n,e){const t=n.fontWeight,r=n.textDecoration.split(" "),i=t==="700"||t==="bold",s=r.includes("line-through"),o=n.fontStyle==="italic",a=r.includes("underline"),l=n.verticalAlign;return c=>(U(c)&&(i&&!c.hasFormat("bold")&&c.toggleFormat("bold"),s&&!c.hasFormat("strikethrough")&&c.toggleFormat("strikethrough"),o&&!c.hasFormat("italic")&&c.toggleFormat("italic"),a&&!c.hasFormat("underline")&&c.toggleFormat("underline"),l!=="sub"||c.hasFormat("subscript")||c.toggleFormat("subscript"),l!=="super"||c.hasFormat("superscript")||c.toggleFormat("superscript"),e&&!c.hasFormat(e)&&c.toggleFormat(e)),c)}let bd=class Dm extends At{static getType(){return"tab"}static clone(e){return new Dm(e.__key)}constructor(e){super("	",e),this.__detail=2}static importDOM(){return null}createDOM(e){const t=super.createDOM(e),r=ki(e.theme,"tab");return r!==void 0&&t.classList.add(...r),t}static importJSON(e){return to().updateFromJSON(e)}setTextContent(e){return e!=="	"&&e!==""&&H(126),super.setTextContent("	")}spliceText(e,t,r,i){return r===""&&t===0||r==="	"&&t===1||H(286),this}setDetail(e){return e!==2&&H(127),this}setMode(e){return e!=="normal"&&H(128),this}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}};function to(){return Ne(new bd)}function Lm(n){return n instanceof bd}let rw=class{constructor(e,t,r){this._selection=null,this.key=e,this.offset=t,this.type=r}is(e){return this.key===e.key&&this.offset===e.offset&&this.type===e.type}isBefore(e){return this.key===e.key?this.offset<e.offset:by(un(In(this,"next")),un(In(e,"next")))<0}getNode(){const e=he(this.key);return e===null&&H(20),e}set(e,t,r,i){const s=this._selection,o=this.key;i&&this.key===e&&this.offset===t&&this.type===r||(this.key=e,this.offset=t,this.type=r,Vi()||(Yn()===o&&Ze(e),s!==null&&(s.setCachedNodes(null),s.dirty=!0)))}};function Ct(n,e,t){return new rw(n,e,t)}function xc(n,e){let t=e.__key,r=n.offset,i="element";if(U(e)){i="text";const s=e.getTextContentSize();r>s&&(r=s)}else if(!L(e)){const s=e.getNextSibling();if(U(s))t=s.__key,r=0,i="text";else{const o=e.getParent();o&&(t=o.__key,r=e.getIndexWithinParent()+1)}}n.set(t,r,i)}function Zf(n,e){if(L(e)){const t=e.getLastDescendant();L(t)||U(t)?xc(n,t):xc(n,e)}else xc(n,e)}let jm=class Fm{constructor(e){this._cachedNodes=null,this._nodes=e,this.dirty=!1}getCachedNodes(){return this._cachedNodes}setCachedNodes(e){this._cachedNodes=e}is(e){if(!pt(e))return!1;const t=this._nodes,r=e._nodes;return t.size===r.size&&Array.from(t).every(i=>r.has(i))}isCollapsed(){return!1}isBackward(){return!1}getStartEndPoints(){return null}add(e){this.dirty=!0,this._nodes.add(e),this._cachedNodes=null}delete(e){this.dirty=!0,this._nodes.delete(e),this._cachedNodes=null}clear(){this.dirty=!0,this._nodes.clear(),this._cachedNodes=null}has(e){return this._nodes.has(e)}clone(){return new Fm(new Set(this._nodes))}extract(){return this.getNodes()}insertRawText(e){}insertText(){}insertNodes(e){const t=this.getNodes(),r=t.length,i=t[r-1];let s;if(U(i))s=i.select();else{const o=i.getIndexWithinParent()+1;s=i.getParentOrThrow().select(o,o)}s.insertNodes(e);for(let o=0;o<r;o++)t[o].remove()}getNodes(){const e=this._cachedNodes;if(e!==null)return e;const t=this._nodes,r=[];for(const i of t){const s=he(i);s!==null&&r.push(s)}return Vi()||(this._cachedNodes=r),r}getTextContent(){const e=this.getNodes();let t="";for(let r=0;r<e.length;r++)t+=e[r].getTextContent();return t}deleteNodes(){const e=this.getNodes();if((K()||Ji())===this&&e[0]){const t=Be(e[0],"next");qw(sr(t,t))}for(const t of e)t.remove()}};function B(n){return n instanceof no}let no=class qm{constructor(e,t,r,i){this.anchor=e,this.focus=t,e._selection=this,t._selection=this,this._cachedNodes=null,this.format=r,this.style=i,this.dirty=!1}getCachedNodes(){return this._cachedNodes}setCachedNodes(e){this._cachedNodes=e}is(e){return!!B(e)&&this.anchor.is(e.anchor)&&this.focus.is(e.focus)&&this.format===e.format&&this.style===e.style}isCollapsed(){return this.anchor.is(this.focus)}getNodes(){const e=this._cachedNodes;if(e!==null)return e;const t=function(r){const i=[],[s,o]=r.getTextSlices();s&&i.push(s.caret.origin);const a=new Set,l=new Set;for(const c of r)if(Ht(c)){const{origin:u}=c;i.length===0?a.add(u):(l.add(u),i.push(u))}else{const{origin:u}=c;L(u)&&l.has(u)||i.push(u)}if(o&&i.push(o.caret.origin),Br(r.focus)&&L(r.focus.origin)&&r.focus.getNodeAtCaret()===null)for(let c=Yt(r.focus.origin,"previous");Ht(c)&&a.has(c.origin)&&!c.origin.isEmpty()&&c.origin.is(i[i.length-1]);c=Us(c))a.delete(c.origin),i.pop();for(;i.length>1;){const c=i[i.length-1];if(!L(c)||l.has(c)||c.isEmpty()||a.has(c))break;i.pop()}if(i.length===0&&r.isCollapsed()){const c=un(r.anchor),u=un(r.anchor.getFlipped()),f=g=>er(g)?g.origin:g.getNodeAtCaret(),d=f(c)||f(u)||(r.anchor.getNodeAtCaret()?c.origin:u.origin);i.push(d)}return i}(wy(Sh(this),"next"));return Vi()||(this._cachedNodes=t),t}setTextNodeRange(e,t,r,i){this.anchor.set(e.__key,t,"text"),this.focus.set(r.__key,i,"text")}getTextContent(){const e=this.getNodes();if(e.length===0)return"";const t=e[0],r=e[e.length-1],i=this.anchor,s=this.focus,o=i.isBefore(s),[a,l]=au(this);let c="",u=!0;for(let f=0;f<e.length;f++){const d=e[f];if(L(d)&&!d.isInline())u||(c+=`
`),u=!d.isEmpty();else if(u=!1,U(d)){let g=d.getTextContent();d===t?d===r?i.type==="element"&&s.type==="element"&&s.offset!==i.offset||(g=a<l?g.slice(a,l):g.slice(l,a)):g=o?g.slice(a):g.slice(l):d===r&&(g=o?g.slice(0,l):g.slice(0,a)),c+=g}else!be(d)&&!Or(d)||d===r&&this.isCollapsed()||(c+=d.getTextContent())}return c}applyDOMRange(e){const t=$e(),r=t.getEditorState()._selection,i=Wm(e.startContainer,e.startOffset,e.endContainer,e.endOffset,t,r);if(i===null)return;const[s,o]=i;this.anchor.set(s.key,s.offset,s.type,!0),this.focus.set(o.key,o.offset,o.type,!0),js(this)}clone(){const e=this.anchor,t=this.focus;return new qm(Ct(e.key,e.offset,e.type),Ct(t.key,t.offset,t.type),this.format,this.style)}toggleFormat(e){this.format=Fa(this.format,e,null),this.dirty=!0}setFormat(e){this.format=e,this.dirty=!0}setStyle(e){this.style=e,this.dirty=!0}hasFormat(e){const t=nr[e];return!!(this.format&t)}insertRawText(e){const t=e.split(/(\r?\n|\t)/),r=[],i=t.length;for(let s=0;s<i;s++){const o=t[s];o===`
`||o===`\r
`?r.push(qr()):o==="	"?r.push(to()):r.push(ue(o))}this.insertNodes(r)}insertText(e){const t=this.anchor,r=this.focus,i=this.format,s=this.style;let o=t,a=r;!this.isCollapsed()&&r.isBefore(t)&&(o=r,a=t),o.type==="element"&&function(y,v,_,w){const E=y.getNode(),$=E.getChildAtIndex(y.offset),P=ue(),R=Qe(E)?Ot().append(P):P;P.setFormat(_),P.setStyle(w),$===null?E.append(R):$.insertBefore(R),y.is(v)&&v.set(P.__key,0,"text"),y.set(P.__key,0,"text")}(o,a,i,s),a.type==="element"&&zs(a,un(In(a,"next")));const l=o.offset;let c=a.offset;const u=this.getNodes(),f=u.length;let d=u[0];U(d)||H(26);const g=d.getTextContent().length,p=d.getParentOrThrow();let m=u[f-1];if(f===1&&a.type==="element"&&(c=g,a.set(o.key,c,"text")),this.isCollapsed()&&l===g&&(Tn(d)||!d.canInsertTextAfter()||!p.canInsertTextAfter()&&d.getNextSibling()===null)){let y=d.getNextSibling();if(U(y)&&y.canInsertTextBefore()&&!Tn(y)||(y=ue(),y.setFormat(i),y.setStyle(s),p.canInsertTextAfter()?d.insertAfter(y):p.insertAfter(y)),y.select(0,0),d=y,e!=="")return void this.insertText(e)}else if(this.isCollapsed()&&l===0&&(Tn(d)||!d.canInsertTextBefore()||!p.canInsertTextBefore()&&d.getPreviousSibling()===null)){let y=d.getPreviousSibling();if(U(y)&&!Tn(y)||(y=ue(),y.setFormat(i),p.canInsertTextBefore()?d.insertBefore(y):p.insertBefore(y)),y.select(),d=y,e!=="")return void this.insertText(e)}else if(d.isSegmented()&&l!==g){const y=ue(d.getTextContent());y.setFormat(i),d.replace(y),d=y}else if(!this.isCollapsed()&&e!==""){const y=m.getParent();if(!p.canInsertTextBefore()||!p.canInsertTextAfter()||L(y)&&(!y.canInsertTextBefore()||!y.canInsertTextAfter()))return this.insertText(""),Bm(this.anchor,this.focus,null),void this.insertText(e)}if(f===1){if(Pr(d)){const w=ue(e);return w.select(),void d.replace(w)}const y=d.getFormat(),v=d.getStyle();if(l!==c||y===i&&v===s){if(Lm(d)){const w=ue(e);return w.setFormat(i),w.setStyle(s),w.select(),void d.replace(w)}}else{if(d.getTextContent()!==""){const w=ue(e);if(w.setFormat(i),w.setStyle(s),w.select(),l===0)d.insertBefore(w,!1);else{const[E]=d.splitText(l);E.insertAfter(w,!1)}return void(w.isComposing()&&this.anchor.type==="text"&&(this.anchor.offset-=e.length))}d.setFormat(i),d.setStyle(s)}const _=c-l;d=d.spliceText(l,_,e,!0),d.getTextContent()===""?d.remove():this.anchor.type==="text"&&(d.isComposing()?this.anchor.offset-=e.length:(this.format=y,this.style=v))}else{const y=new Set([...d.getParentKeys(),...m.getParentKeys()]),v=L(d)?d:d.getParentOrThrow();let _=L(m)?m:m.getParentOrThrow(),w=m;if(!v.is(_)&&_.isInline())do w=_,_=_.getParentOrThrow();while(_.isInline());if(a.type==="text"&&(c!==0||m.getTextContent()==="")||a.type==="element"&&m.getIndexWithinParent()<c)if(U(m)&&!Pr(m)&&c!==m.getTextContentSize()){if(m.isSegmented()){const N=ue(m.getTextContent());m.replace(N),m=N}Qe(a.getNode())||a.type!=="text"||(m=m.spliceText(0,c,"")),y.add(m.__key)}else{const N=m.getParentOrThrow();N.canBeEmpty()||N.getChildrenSize()!==1?m.remove():N.remove()}else y.add(m.__key);const E=_.getChildren(),$=new Set(u),P=v.is(_),R=v.isInline()&&d.getNextSibling()===null?v:d;for(let N=E.length-1;N>=0;N--){const M=E[N];if(M.is(d)||L(M)&&M.isParentOf(d))break;M.isAttached()&&(!$.has(M)||M.is(w)?P||R.insertAfter(M,!1):M.remove())}if(!P){let N=_,M=null;for(;N!==null;){const j=N.getChildren(),k=j.length;(k===0||j[k-1].is(M))&&(y.delete(N.__key),M=N),N=N.getParent()}}if(Pr(d))if(l===g)d.select();else{const N=ue(e);N.select(),d.replace(N)}else d=d.spliceText(l,g-l,e,!0),d.getTextContent()===""?d.remove():d.isComposing()&&this.anchor.type==="text"&&(this.anchor.offset-=e.length);for(let N=1;N<f;N++){const M=u[N],j=M.__key;y.has(j)||M.remove()}}}removeText(){const e=K()===this;ya(this,Bw(Sh(this))),e&&K()!==this&&rt(this)}formatText(e,t=null){if(this.isCollapsed())return this.toggleFormat(e),void Ze(null);const r=this.getNodes(),i=[];for(const E of r)U(E)&&i.push(E);const s=E=>{r.forEach($=>{if(L($)){const P=$.getFormatFlags(e,E);$.setTextFormat(P)}})},o=i.length;if(o===0)return this.toggleFormat(e),Ze(null),void s(t);const a=this.anchor,l=this.focus,c=this.isBackward(),u=c?l:a,f=c?a:l;let d=0,g=i[0],p=u.type==="element"?0:u.offset;if(u.type==="text"&&p===g.getTextContentSize()&&(d=1,g=i[1],p=0),g==null)return;const m=g.getFormatFlags(e,t);s(m);const y=o-1;let v=i[y];const _=f.type==="text"?f.offset:v.getTextContentSize();if(g.is(v)){if(p===_)return;if(Tn(g)||p===0&&_===g.getTextContentSize())g.setFormat(m);else{const E=g.splitText(p,_),$=p===0?E[0]:E[1];$.setFormat(m),u.type==="text"&&u.set($.__key,0,"text"),f.type==="text"&&f.set($.__key,_-p,"text")}return void(this.format=m)}p===0||Tn(g)||([,g]=g.splitText(p),p=0),g.setFormat(m);const w=v.getFormatFlags(e,m);_>0&&(_===v.getTextContentSize()||Tn(v)||([v]=v.splitText(_)),v.setFormat(w));for(let E=d+1;E<y;E++){const $=i[E],P=$.getFormatFlags(e,w);$.setFormat(P)}u.type==="text"&&u.set(g.__key,p,"text"),f.type==="text"&&f.set(v.__key,_,"text"),this.format=m|w}insertNodes(e){if(e.length===0)return;if(this.isCollapsed()||this.removeText(),this.anchor.key==="root"){this.insertParagraph();const p=K();return B(p)||H(134),p.insertNodes(e)}const t=(this.isBackward()?this.focus:this.anchor).getNode(),r=Nc(t,Rt),i=e[e.length-1];if(L(r)&&"__language"in r){if("__language"in e[0])this.insertText(e[0].getTextContent());else{const p=Cc(this);r.splice(p,0,e),i.selectEnd()}return}if(!e.some(p=>(L(p)||be(p))&&!p.isInline())){L(r)||H(211,t.constructor.name,t.getType());const p=Cc(this);return r.splice(p,0,e),void i.selectEnd()}const s=function(p){const m=Ot();let y=null;for(let v=0;v<p.length;v++){const _=p[v],w=Or(_);if(w||be(_)&&_.isInline()||L(_)&&_.isInline()||U(_)||_.isParentRequired()){if(y===null&&(y=_.createParentElementNode(),m.append(y),w))continue;y!==null&&y.append(_)}else m.append(_),y=null}return m}(e),o=s.getLastDescendant(),a=s.getChildren(),l=!L(r)||!r.isEmpty()?this.insertParagraph():null,c=a[a.length-1];let u=a[0];var f;L(f=u)&&Rt(f)&&!f.isEmpty()&&L(r)&&(!r.isEmpty()||r.canMergeWhenEmpty())&&(L(r)||H(211,t.constructor.name,t.getType()),r.append(...u.getChildren()),u=a[1]),u&&(r===null&&H(212,t.constructor.name,t.getType()),function(p,m,y){const v=m.getParentOrThrow().getLastChild();let _=m;const w=[m];for(;_!==v;)_.getNextSibling()||H(140),_=_.getNextSibling(),w.push(_);let E=p;for(const $ of w)E=E.insertAfter($)}(r,u));const d=Nc(o,Rt);l&&L(d)&&(l.canMergeWhenEmpty()||Rt(c))&&(d.append(...l.getChildren()),l.remove()),L(r)&&r.isEmpty()&&r.remove(),o.selectEnd();const g=L(r)?r.getLastChild():null;Or(g)&&d!==r&&g.remove()}insertParagraph(){if(this.anchor.key==="root"){const o=Ot();return pe().splice(this.anchor.offset,0,[o]),o.select(),o}const e=Cc(this),t=Nc(this.anchor.getNode(),Rt);L(t)||H(213);const r=t.getChildAtIndex(e),i=r?[r,...r.getNextSiblings()]:[],s=t.insertNewAfter(this,!1);return s?(s.append(...i),s.selectStart(),s):null}insertLineBreak(e){const t=qr();if(this.insertNodes([t]),e){const r=t.getParentOrThrow(),i=t.getIndexWithinParent();r.select(i,i)}}extract(){const e=this.getNodes(),t=e.length,r=t-1,i=this.anchor,s=this.focus;let o=e[0],a=e[r];const[l,c]=au(this);if(t===0)return[];if(t===1){if(U(o)&&!this.isCollapsed()){const f=l>c?c:l,d=l>c?l:c,g=o.splitText(f,d),p=f===0?g[0]:g[1];return p!=null?[p]:[]}return[o]}const u=i.isBefore(s);if(U(o)){const f=u?l:c;f===o.getTextContentSize()?e.shift():f!==0&&([,o]=o.splitText(f),e[0]=o)}if(U(a)){const f=a.getTextContent().length,d=u?c:l;d===0?e.pop():d!==f&&([a]=a.splitText(d),e[r]=a)}return e}modify(e,t,r){if(oh(this,e,t,r))return;const i=e==="move",s=$e(),o=Gt(jt(s));if(!o)return;const a=s._blockCursorElement,l=s._rootElement,c=this.focus.getNode();if(l===null||a===null||!L(c)||c.isInline()||c.canBeEmpty()||hu(a,s,l),this.dirty){let u=Ii(s,this.anchor.key),f=Ii(s,this.focus.key);this.anchor.type==="text"&&(u=Pi(u)),this.focus.type==="text"&&(f=Pi(f)),u&&f&&Km(o,u,this.anchor.offset,f,this.focus.offset)}if(function(u,f,d,g){u.modify(f,d,g)}(o,e,t?"backward":"forward",r),o.rangeCount>0){const u=o.getRangeAt(0),f=this.anchor.getNode(),d=Qe(f)?f:Cw(f);if(this.applyDOMRange(u),this.dirty=!0,!i){const g=this.getNodes(),p=[];let m=!1;for(let y=0;y<g.length;y++){const v=g[y];fu(v,d)?p.push(v):m=!0}if(m&&p.length>0)if(t){const y=p[0];L(y)?y.selectStart():y.getParentOrThrow().selectStart()}else{const y=p[p.length-1];L(y)?y.selectEnd():y.getParentOrThrow().selectEnd()}o.anchorNode===u.startContainer&&o.anchorOffset===u.startOffset||function(y){const v=y.focus,_=y.anchor,w=_.key,E=_.offset,$=_.type;_.set(v.key,v.offset,v.type,!0),v.set(w,E,$,!0)}(this)}}r==="lineboundary"&&oh(this,e,t,r,"decorators")}forwardDeletion(e,t,r){if(!r&&(e.type==="element"&&L(t)&&e.offset===t.getChildrenSize()||e.type==="text"&&e.offset===t.getTextContentSize())){const i=t.getParent(),s=t.getNextSibling()||(i===null?null:i.getNextSibling());if(L(s)&&s.isShadowRoot())return!0}return!1}deleteCharacter(e){const t=this.isCollapsed();if(this.isCollapsed()){const r=this.anchor;let i=r.getNode();if(this.forwardDeletion(r,i,e))return;const s=Fd(In(r,e?"previous":"next"));if(s.getTextSlices().every(a=>a===null||a.distance===0)){let a={type:"initial"};for(const l of s.iterNodeCarets("shadowRoot"))if(Ht(l)){if(!l.origin.isInline()){if(l.origin.isShadowRoot()){if(a.type==="merge-block")break;if(L(s.anchor.origin)&&s.anchor.origin.isEmpty()){const c=un(l);ya(this,sr(c,c)),s.anchor.origin.remove()}return}a.type!=="merge-next-block"&&a.type!=="merge-block"||(a={block:a.block,caret:l,type:"merge-block"})}}else{if(a.type==="merge-block")break;if(Br(l)){if(L(l.origin)){if(l.origin.isInline()){if(!l.origin.isParentOf(s.anchor.origin))break}else a={block:l.origin,type:"merge-next-block"};continue}if(be(l.origin)){if(!l.origin.isIsolated())if(a.type==="merge-next-block"&&(l.origin.isKeyboardSelectable()||!l.origin.isInline())&&L(s.anchor.origin)&&s.anchor.origin.isEmpty()){s.anchor.origin.remove();const c=zm();c.add(l.origin.getKey()),rt(c)}else l.origin.remove();return}break}}if(a.type==="merge-block"){const{caret:l,block:c}=a;return ya(this,sr(!l.origin.isEmpty()&&c.isEmpty()?vl(Be(c,l.direction)):s.anchor,l)),this.removeText()}}const o=this.focus;if(this.modify("extend",e,"character"),this.isCollapsed()){if(e&&r.offset===0&&eh(this,r.getNode()))return}else{const a=o.type==="text"?o.getNode():null;if(i=r.type==="text"?r.getNode():null,a!==null&&a.isSegmented()){const l=o.offset,c=a.getTextContentSize();if(a.is(i)||e&&l!==c||!e&&l!==0)return void th(a,e,l)}else if(i!==null&&i.isSegmented()){const l=r.offset,c=i.getTextContentSize();if(i.is(a)||e&&l!==0||!e&&l!==c)return void th(i,e,l)}(function(l,c){const u=l.anchor,f=l.focus,d=u.getNode(),g=f.getNode();if(d===g&&u.type==="text"&&f.type==="text"){const p=u.offset,m=f.offset,y=p<m,v=y?p:m,_=y?m:p,w=_-1;v!==w&&function(E){return!(cy(E)||iw(E))}(d.getTextContent().slice(v,_))&&(c?f.set(f.key,w,f.type):u.set(u.key,w,u.type))}})(this,e)}}if(this.removeText(),e&&!t&&this.isCollapsed()&&this.anchor.type==="element"&&this.anchor.offset===0){const r=this.anchor.getNode();r.isEmpty()&&Qe(r.getParent())&&r.getPreviousSibling()===null&&eh(this,r)}}deleteLine(e){this.isCollapsed()&&this.modify("extend",e,"lineboundary"),this.isCollapsed()?this.deleteCharacter(e):this.removeText()}deleteWord(e){if(this.isCollapsed()){const t=this.anchor,r=t.getNode();if(this.forwardDeletion(t,r,e))return;this.modify("extend",e,"word")}this.removeText()}isBackward(){return this.focus.isBefore(this.anchor)}getStartEndPoints(){return[this.anchor,this.focus]}};function pt(n){return n instanceof jm}function Qf(n){const e=n.offset;if(n.type==="text")return e;const t=n.getNode();return e===t.getChildrenSize()?t.getTextContent().length:0}function au(n){const e=n.getStartEndPoints();if(e===null)return[0,0];const[t,r]=e;return t.type==="element"&&r.type==="element"&&t.key===r.key&&t.offset===r.offset?[0,0]:[Qf(t),Qf(r)]}function eh(n,e){for(let t=e;t;t=t.getParent()){if(L(t)){if(t.collapseAtStart(n))return!0;if(yn(t))break}if(t.getPreviousSibling())break}return!1}const iw=(()=>{try{const n=new RegExp("\\p{Emoji}","u"),e=n.test.bind(n);if(e("❤️")&&e("#️⃣")&&e("👍"))return e}catch{}return()=>!1})();function th(n,e,t){const r=n,i=r.getTextContent().split(/(?=\s)/g),s=i.length;let o=0,a=0;for(let c=0;c<s;c++){const u=c===s-1;if(a=o,o+=i[c].length,e&&o===t||o>t||u){i.splice(c,1),u&&(a=void 0);break}}const l=i.join("").trim();l===""?r.remove():(r.setTextContent(l),r.select(a,a))}function nh(n,e,t,r){let i,s=e;if(Te(n)){let o=!1;const a=n.childNodes,l=a.length,c=r._blockCursorElement;s===l&&(o=!0,s=l-1);let u=a[s],f=!1;if(u===c)u=a[s+1],f=!0;else if(c!==null){const d=c.parentNode;n===d&&e>Array.prototype.indexOf.call(d.children,c)&&s--}if(i=bi(u),U(i))s=tr(i,o?"next":"previous");else{let d=bi(n);if(d===null)return null;if(L(d)){const g=r.getElementByKey(d.getKey());g===null&&H(214),[d,s]=d.getDOMSlot(g).resolveChildIndex(d,g,n,e),L(d)||H(215),o&&s>=d.getChildrenSize()&&(s=Math.max(0,d.getChildrenSize()-1));let m=d.getChildAtIndex(s);if(L(m)&&function(y,v,_){const w=y.getParent();return _===null||w===null||!w.canBeEmpty()||w!==_.getNode()}(m,0,t)){const y=o?m.getLastDescendant():m.getFirstDescendant();y===null?d=m:(m=y,d=L(m)?m:m.getParentOrThrow()),s=0}U(m)?(i=m,d=null,s=tr(m,o?"next":"previous")):m!==d&&o&&!f&&(L(d)||H(216),s=Math.min(d.getChildrenSize(),s+1))}else{const g=d.getIndexWithinParent();s=e===0&&be(d)&&bi(n)===d?g:g+1,d=d.getParentOrThrow()}if(L(d))return Ct(d.__key,s,"element")}}else i=bi(n);return U(i)?Ct(i.__key,tr(i,s,"clamp"),"text"):null}function rh(n,e,t){const r=n.offset,i=n.getNode();if(r===0){const s=i.getPreviousSibling(),o=i.getParent();if(e){if((t||!e)&&s===null&&L(o)&&o.isInline()){const a=o.getPreviousSibling();U(a)&&n.set(a.__key,a.getTextContent().length,"text")}}else L(s)&&!t&&s.isInline()?n.set(s.__key,s.getChildrenSize(),"element"):U(s)&&n.set(s.__key,s.getTextContent().length,"text")}else if(r===i.getTextContent().length){const s=i.getNextSibling(),o=i.getParent();if(e&&L(s)&&s.isInline())n.set(s.__key,0,"element");else if((t||e)&&s===null&&L(o)&&o.isInline()&&!o.canInsertTextAfter()){const a=o.getNextSibling();U(a)&&n.set(a.__key,0,"text")}}}function Bm(n,e,t){if(n.type==="text"&&e.type==="text"){const r=n.isBefore(e),i=n.is(e);rh(n,r,i),rh(e,!r,i),i&&e.set(n.key,n.offset,n.type);const s=$e();if(s.isComposing()&&s._compositionKey!==n.key&&B(t)){const o=t.anchor,a=t.focus;n.set(o.key,o.offset,o.type,!0),e.set(a.key,a.offset,a.type,!0)}}}function Wm(n,e,t,r,i,s){if(n===null||t===null||!io(i,n,t))return null;const o=nh(n,e,B(s)?s.anchor:null,i);if(o===null)return null;const a=nh(t,r,B(s)?s.focus:null,i);if(a===null)return null;if(o.type==="element"&&a.type==="element"){const l=bi(n),c=bi(t);if(be(l)&&be(c))return null}return Bm(o,a,s),[o,a]}function lu(n){return L(n)&&!n.isInline()}function Um(n,e,t,r,i,s){const o=fr(),a=new no(Ct(n,e,i),Ct(t,r,s),0,"");return a.dirty=!0,o._selection=a,a}function ro(){const n=Ct("root",0,"element"),e=Ct("root",0,"element");return new no(n,e,0,"")}function zm(){return new jm(new Set)}function vd(n,e,t,r){const i=t._window;if(i===null)return null;const s=r||i.event,o=s?s.type:void 0,a=o==="selectionchange",l=!Gc&&(a||o==="beforeinput"||o==="compositionstart"||o==="compositionend"||o==="click"&&s&&s.detail===3||o==="drop"||o===void 0);let c,u,f,d;if(B(n)&&!l)return n.clone();if(e===null)return null;if(c=e.anchorNode,u=e.focusNode,f=e.anchorOffset,d=e.focusOffset,a&&B(n)&&!io(t,c,u))return n.clone();const g=Wm(c,f,u,d,t,n);if(g===null)return null;const[p,m]=g;return new no(p,m,B(n)?n.format:0,B(n)?n.style:"")}function K(){return fr()._selection}function Ji(){return $e()._editorState._selection}function La(n,e,t,r=1){const i=n.anchor,s=n.focus,o=i.getNode(),a=s.getNode();if(!e.is(o)&&!e.is(a))return;const l=e.__key;if(n.isCollapsed()){const c=i.offset;if(t<=c&&r>0||t<c&&r<0){const u=Math.max(0,c+r);i.set(l,u,"element"),s.set(l,u,"element"),ih(n)}}else{const c=n.isBackward(),u=c?s:i,f=u.getNode(),d=c?i:s,g=d.getNode();if(e.is(f)){const p=u.offset;(t<=p&&r>0||t<p&&r<0)&&u.set(l,Math.max(0,p+r),"element")}if(e.is(g)){const p=d.offset;(t<=p&&r>0||t<p&&r<0)&&d.set(l,Math.max(0,p+r),"element")}}ih(n)}function ih(n){const e=n.anchor,t=e.offset,r=n.focus,i=r.offset,s=e.getNode(),o=r.getNode();if(n.isCollapsed()){if(!L(s))return;const a=s.getChildrenSize(),l=t>=a,c=l?s.getChildAtIndex(a-1):s.getChildAtIndex(t);if(U(c)){let u=0;l&&(u=c.getTextContentSize()),e.set(c.__key,u,"text"),r.set(c.__key,u,"text")}}else{if(L(s)){const a=s.getChildrenSize(),l=t>=a,c=l?s.getChildAtIndex(a-1):s.getChildAtIndex(t);if(U(c)){let u=0;l&&(u=c.getTextContentSize()),e.set(c.__key,u,"text")}}if(L(o)){const a=o.getChildrenSize(),l=i>=a,c=l?o.getChildAtIndex(a-1):o.getChildAtIndex(i);if(U(c)){let u=0;l&&(u=c.getTextContentSize()),r.set(c.__key,u,"text")}}}}function ja(n,e,t,r,i){let s=null,o=0,a=null;r!==null?(s=r.__key,U(r)?(o=r.getTextContentSize(),a="text"):L(r)&&(o=r.getChildrenSize(),a="element")):i!==null&&(s=i.__key,U(i)?a="text":L(i)&&(a="element")),s!==null&&a!==null?n.set(s,o,a):(o=e.getIndexWithinParent(),o===-1&&(o=t.getChildrenSize()),n.set(t.__key,o,"element"))}function sh(n,e,t,r,i){n.type==="text"?n.set(t,n.offset+(e?0:i),"text"):n.offset>r.getIndexWithinParent()&&n.set(n.key,n.offset-1,"element")}function Km(n,e,t,r,i){try{n.setBaseAndExtent(e,t,r,i)}catch{}}function sw(n,e,t,r,i,s,o){const a=r.anchorNode,l=r.focusNode,c=r.anchorOffset,u=r.focusOffset,f=document.activeElement;if(i.has(dw)&&f!==s||f!==null&&Nd(f))return;if(!B(e))return void(n!==null&&io(t,a,l)&&r.removeAllRanges());const d=e.anchor,g=e.focus,p=d.key,m=g.key,y=Ii(t,p),v=Ii(t,m),_=d.offset,w=g.offset,E=e.format,$=e.style,P=e.isCollapsed();let R=y,N=v,M=!1;if(d.type==="text"){R=Pi(y);const q=d.getNode();M=q.getFormat()!==E||q.getStyle()!==$}else B(n)&&n.anchor.type==="text"&&(M=!0);var j,k,I,C,D;if(g.type==="text"&&(N=Pi(v)),R!==null&&N!==null&&(P&&(n===null||M||B(n)&&(n.format!==E||n.style!==$))&&(j=E,k=$,I=_,C=p,D=performance.now(),Em=[j,k,I,C,D]),c!==_||u!==w||a!==R||l!==N||r.type==="Range"&&P||(f!==null&&s.contains(f)||s.focus({preventScroll:!0}),d.type==="element"))){if(Km(r,R,_,N,w),!i.has(fw)&&e.isCollapsed()&&s!==null&&s===document.activeElement){const q=B(e)&&e.anchor.type==="element"?R.childNodes[_]||null:r.rangeCount>0?r.getRangeAt(0):null;if(q!==null){let F;if(q instanceof Text){const z=document.createRange();z.selectNode(q),F=z.getBoundingClientRect()}else F=q.getBoundingClientRect();(function(z,J,V){const G=gy(V),ee=Id(G);if(G===null||ee===null)return;let{top:Z,bottom:re}=J,oe=0,X=0,de=V;for(;de!==null;){const _e=de===G.body;if(_e)oe=0,X=jt(z).innerHeight;else{const ce=de.getBoundingClientRect();oe=ce.top,X=ce.bottom}let se=0;if(Z<oe?se=-(oe-Z):re>X&&(se=re-X),se!==0)if(_e)ee.scrollBy(0,se);else{const ce=de.scrollTop;de.scrollTop+=se;const fe=de.scrollTop-ce;Z-=fe,re-=fe}if(_e)break;de=so(de)}})(t,F,s)}}iu=!0}}function ow(n){let e=K()||Ji();e===null&&(e=pe().selectEnd()),e.insertNodes(n)}function Cc(n){let e=n;n.isCollapsed()||e.removeText();const t=K();B(t)&&(e=t),B(e)||H(161);const r=e.anchor;let i=r.getNode(),s=r.offset;for(;!Rt(i);){const o=i;if([i,s]=aw(i,s),o.is(i))break}return s}function aw(n,e){const t=n.getParent();if(!t){const i=Ot();return pe().append(i),i.select(),[pe(),0]}if(U(n)){const i=n.splitText(e);if(i.length===0)return[t,n.getIndexWithinParent()];const s=e===0?0:1;return[t,i[0].getIndexWithinParent()+s]}if(!L(n)||e===0)return[t,n.getIndexWithinParent()];const r=n.getChildAtIndex(e);if(r){const i=new no(Ct(n.__key,e,"element"),Ct(n.__key,e,"element"),0,""),s=n.insertNewAfter(i);s&&s.append(r,...r.getNextSiblings())}return[t,n.getIndexWithinParent()+1]}function oh(n,e,t,r,i="decorators-and-blocks"){if(e==="move"&&r==="character"&&!n.isCollapsed()){const[u,f]=t===n.isBackward()?[n.focus,n.anchor]:[n.anchor,n.focus];return f.set(u.key,u.offset,u.type),!0}const s=In(n.focus,t?"previous":"next"),o=r==="lineboundary",a=e==="move";let l=s,c=i==="decorators-and-blocks";if(!ky(l)){for(const u of l){c=!1;const{origin:f}=u;if(!be(f)||f.isIsolated()||(l=u,!o||!f.isInline()))break}if(c)for(const u of Fd(s).iterNodeCarets(e==="extend"?"shadowRoot":"root")){if(Ht(u))u.origin.isInline()||(l=u);else{if(L(u.origin))continue;be(u.origin)&&!u.origin.isInline()&&(l=u)}break}}if(l===s)return!1;if(a&&!o&&be(l.origin)&&l.origin.isKeyboardSelectable()){const u=zm();return u.add(l.origin.getKey()),rt(u),!0}return l=un(l),a&&zs(n.anchor,l),zs(n.focus,l),c||!o}let ze=null,Ke=null,xt=!1,Sc=!1,ga=0;const ah={characterData:!0,childList:!0,subtree:!0};function Vi(){return xt||ze!==null&&ze._readOnly}function Xe(){xt&&H(13)}function Hm(){ga>99&&H(14)}function fr(){return ze===null&&H(195,Jm()),ze}function $e(){return Ke===null&&H(196,Jm()),Ke}function Jm(){let n=0;const e=new Set,t=gl.version;if(typeof window<"u")for(const i of document.querySelectorAll("[contenteditable]")){const s=pl(i);if(Md(s))n++;else if(s){let o=String(s.constructor.version||"<0.17.1");o===t&&(o+=" (separately built, likely a bundler configuration issue)"),e.add(o)}}let r=` Detected on the page: ${n} compatible editor(s) with version ${t}`;return e.size&&(r+=` and incompatible editors with versions ${Array.from(e).join(", ")}`),r}function lw(){return Ke}function lh(n,e,t){const r=e.__type,i=iy(n,r);let s=t.get(r);s===void 0&&(s=Array.from(i.transforms),t.set(r,s));const o=s.length;for(let a=0;a<o&&(s[a](e),e.isAttached());a++);}function ch(n,e){return n!==void 0&&n.__key!==e&&n.isAttached()}function Vm(n,e){if(!e)return;const t=n._updateTags;let r=e;Array.isArray(e)||(r=[e]);for(const i of r)t.add(i)}function Gm(n){return kd(n,$e()._nodes)}function kd(n,e){const t=n.type,r=e.get(t);r===void 0&&H(17,t);const i=r.klass;n.type!==i.getType()&&H(18,i.name);const s=i.importJSON(n),o=n.children;if(L(s)&&Array.isArray(o))for(let a=0;a<o.length;a++){const l=kd(o[a],e);s.append(l)}return s}function uh(n,e,t){const r=ze,i=xt,s=Ke;ze=e,xt=!0,Ke=n;try{return t()}finally{ze=r,xt=i,Ke=s}}function Nn(n,e){const t=n._pendingEditorState,r=n._rootElement,i=n._headless||r===null;if(t===null)return;const s=n._editorState,o=s._selection,a=t._selection,l=n._dirtyType!==jr,c=ze,u=xt,f=Ke,d=n._updating,g=n._observer;let p=null;if(n._pendingEditorState=null,n._editorState=t,!i&&l&&g!==null){Ke=n,ze=t,xt=!1,n._updating=!0;try{const P=n._dirtyType,R=n._dirtyElements,N=n._dirtyLeaves;g.disconnect(),p=Fk(s,t,n,P,R,N)}catch(P){if(P instanceof Error&&n._onError(P),Sc)throw P;return ry(n,null,r,t),um(n),n._dirtyType=Ni,Sc=!0,Nn(n,s),void(Sc=!1)}finally{g.observe(r,ah),n._updating=d,ze=c,xt=u,Ke=f}}t._readOnly||(t._readOnly=!0);const m=n._dirtyLeaves,y=n._dirtyElements,v=n._normalizedNodes,_=n._updateTags,w=n._deferred;l&&(n._dirtyType=jr,n._cloneNotNeeded.clear(),n._dirtyLeaves=new Set,n._dirtyElements=new Map,n._normalizedNodes=new Set,n._updateTags=new Set),function(P,R){const N=P._decorators;let M=P._pendingDecorators||N;const j=R._nodeMap;let k;for(k in M)j.has(k)||(M===N&&(M=ay(P)),delete M[k])}(n,t);const E=i?null:Gt(jt(n));if(n._editable&&E!==null&&(l||a===null||a.dirty)&&r!==null&&!_.has(hw)){Ke=n,ze=t;try{if(g!==null&&g.disconnect(),l||a===null||a.dirty){const P=n._blockCursorElement;P!==null&&hu(P,n,r),sw(o,a,n,E,_,r)}(function(P,R,N){let M=P._blockCursorElement;if(B(N)&&N.isCollapsed()&&N.anchor.type==="element"&&R.contains(document.activeElement)){const j=N.anchor,k=j.getNode(),I=j.offset;let C=!1,D=null;if(I===k.getChildrenSize())Ec(k.getChildAtIndex(I-1))&&(C=!0);else{const q=k.getChildAtIndex(I);if(q!==null&&Ec(q)){const F=q.getPreviousSibling();(F===null||Ec(F))&&(C=!0,D=P.getElementByKey(q.__key))}}if(C){const q=P.getElementByKey(k.__key);return M===null&&(P._blockCursorElement=M=function(F){const z=F.theme,J=document.createElement("div");J.contentEditable="false",J.setAttribute("data-lexical-cursor","true");let V=z.blockCursor;if(V!==void 0){if(typeof V=="string"){const G=Na(V);V=z.blockCursor=G}V!==void 0&&J.classList.add(...V)}return J}(P._config)),R.style.caretColor="transparent",void(D===null?q.appendChild(M):q.insertBefore(M,D))}}M!==null&&hu(M,P,R)})(n,r,a)}finally{g!==null&&g.observe(r,ah),Ke=f,ze=c}}p!==null&&function(P,R,N,M,j){const k=Array.from(P._listeners.mutation),I=k.length;for(let C=0;C<I;C++){const[D,q]=k[C];for(const F of q){const z=R.get(F);z!==void 0&&D(z,{dirtyLeaves:M,prevEditorState:j,updateTags:N})}}}(n,p,_,m,s),B(a)||a===null||o!==null&&o.is(a)||n.dispatchCommand(Yr,void 0);const $=n._pendingDecorators;$!==null&&(n._decorators=$,n._pendingDecorators=null,Ps("decorator",n,!0,$)),function(P,R,N){const M=ph(R),j=ph(N);M!==j&&Ps("textcontent",P,!0,j)}(n,e||s,t),Ps("update",n,!0,{dirtyElements:y,dirtyLeaves:m,editorState:t,mutatedNodes:p,normalizedNodes:v,prevEditorState:e||s,tags:_}),function(P,R){if(P._deferred=[],R.length!==0){const N=P._updating;P._updating=!0;try{for(let M=0;M<R.length;M++)R[M]()}finally{P._updating=N}}}(n,w),function(P){const R=P._updates;if(R.length!==0){const N=R.shift();if(N){const[M,j]=N;fl(P,M,j)}}}(n)}function Ps(n,e,t,...r){const i=e._updating;e._updating=t;try{const s=Array.from(e._listeners[n]);for(let o=0;o<s.length;o++)s[o].apply(null,r)}finally{e._updating=i}}function dh(n,e){const t=n._updates;let r=e||!1;for(;t.length!==0;){const i=t.shift();if(i){const[s,o]=i,a=n._pendingEditorState;let l;o!==void 0&&(l=o.onUpdate,o.skipTransforms&&(r=!0),o.discrete&&(a===null&&H(191),a._flushSync=!0),l&&n._deferred.push(l),Vm(n,o.tag)),a==null?fl(n,s,o):s()}}return r}function fl(n,e,t){const r=n._updateTags;let i,s=!1,o=!1;t!==void 0&&(i=t.onUpdate,Vm(n,t.tag),s=t.skipTransforms||!1,o=t.discrete||!1),i&&n._deferred.push(i);const a=n._editorState;let l=n._pendingEditorState,c=!1;(l===null||l._readOnly)&&(l=n._pendingEditorState=Xm(l||a),c=!0),l._flushSync=o;const u=ze,f=xt,d=Ke,g=n._updating;ze=l,xt=!1,n._updating=!0,Ke=n;const p=n._headless||n.getRootElement()===null;Td(null);try{c&&(p?a._selection!==null&&(l._selection=a._selection.clone()):l._selection=function(_,w){const E=_.getEditorState()._selection,$=Gt(jt(_));return B(E)||E==null?vd(E,$,_,w):E.clone()}(n,t&&t.event||null));const y=n._compositionKey;e(),s=dh(n,s),function(_,w){const E=w.getEditorState()._selection,$=_._selection;if(B($)){const P=$.anchor,R=$.focus;let N;if(P.type==="text"&&(N=P.getNode(),N.selectionTransform(E,$)),R.type==="text"){const M=R.getNode();N!==M&&M.selectionTransform(E,$)}}}(l,n),n._dirtyType!==jr&&(s?function(_,w){const E=w._dirtyLeaves,$=_._nodeMap;for(const P of E){const R=$.get(P);U(R)&&R.isAttached()&&R.isSimpleText()&&!R.isUnmergeable()&&Bf(R)}}(l,n):function(_,w){const E=w._dirtyLeaves,$=w._dirtyElements,P=_._nodeMap,R=Yn(),N=new Map;let M=E,j=M.size,k=$,I=k.size;for(;j>0||I>0;){if(j>0){w._dirtyLeaves=new Set;for(const C of M){const D=P.get(C);U(D)&&D.isAttached()&&D.isSimpleText()&&!D.isUnmergeable()&&Bf(D),D!==void 0&&ch(D,R)&&lh(w,D,N),E.add(C)}if(M=w._dirtyLeaves,j=M.size,j>0){ga++;continue}}w._dirtyLeaves=new Set,w._dirtyElements=new Map,k.delete("root")&&k.set("root",!0);for(const C of k){const D=C[0],q=C[1];if($.set(D,q),!q)continue;const F=P.get(D);F!==void 0&&ch(F,R)&&lh(w,F,N)}M=w._dirtyLeaves,j=M.size,k=w._dirtyElements,I=k.size,ga++}w._dirtyLeaves=E,w._dirtyElements=$}(l,n),dh(n),function(_,w,E,$){const P=_._nodeMap,R=w._nodeMap,N=[];for(const[M]of $){const j=R.get(M);j!==void 0&&(j.isAttached()||(L(j)&&am(j,M,P,R,N,$),P.has(M)||$.delete(M),N.push(M)))}for(const M of N)R.delete(M);for(const M of E){const j=R.get(M);j===void 0||j.isAttached()||(P.has(M)||E.delete(M),R.delete(M))}}(a,l,n._dirtyLeaves,n._dirtyElements)),y!==n._compositionKey&&(l._flushSync=!0);const v=l._selection;if(B(v)){const _=l._nodeMap,w=v.anchor.key,E=v.focus.key;_.get(w)!==void 0&&_.get(E)!==void 0||H(19)}else pt(v)&&v._nodes.size===0&&(l._selection=null)}catch(y){return y instanceof Error&&n._onError(y),n._pendingEditorState=a,n._dirtyType=Ni,n._cloneNotNeeded.clear(),n._dirtyLeaves=new Set,n._dirtyElements.clear(),void Nn(n)}finally{ze=u,xt=f,Ke=d,n._updating=g,ga=0}n._dirtyType!==jr||n._deferred.length>0||function(y,v){const _=v.getEditorState()._selection,w=y._selection;if(w!==null){if(w.dirty||!w.is(_))return!0}else if(_!==null)return!0;return!1}(l,n)?l._flushSync?(l._flushSync=!1,Nn(n)):c&&yw(()=>{Nn(n)}):(l._flushSync=!1,c&&(r.clear(),n._deferred=[],n._pendingEditorState=null))}function Et(n,e,t){Ke===n&&t===void 0?e():fl(n,e,t)}let cw=class pa{constructor(e,t,r){this.element=e,this.before=t||null,this.after=r||null}withBefore(e){return new pa(this.element,e,this.after)}withAfter(e){return new pa(this.element,this.before,e)}withElement(e){return this.element===e?this:new pa(e,this.before,this.after)}insertChild(e){const t=this.before||this.getManagedLineBreak();return t!==null&&t.parentElement!==this.element&&H(222),this.element.insertBefore(e,t),this}removeChild(e){return e.parentElement!==this.element&&H(223),this.element.removeChild(e),this}replaceChild(e,t){return t.parentElement!==this.element&&H(224),this.element.replaceChild(e,t),this}getFirstChild(){const e=this.after?this.after.nextSibling:this.element.firstChild;return e===this.before||e===this.getManagedLineBreak()?null:e}getManagedLineBreak(){return this.element.__lexicalLineBreak||null}setManagedLineBreak(e){if(e===null)this.removeManagedLineBreak();else{const t=e==="decorator"&&(Ei||Ls);this.insertManagedLineBreak(t)}}removeManagedLineBreak(){const e=this.getManagedLineBreak();if(e){const t=this.element,r=e.nodeName==="IMG"?e.nextSibling:null;r&&t.removeChild(r),t.removeChild(e),t.__lexicalLineBreak=void 0}}insertManagedLineBreak(e){const t=this.getManagedLineBreak();if(t){if(e===(t.nodeName==="IMG"))return;this.removeManagedLineBreak()}const r=this.element,i=this.before,s=document.createElement("br");if(r.insertBefore(s,i),e){const o=document.createElement("img");o.setAttribute("data-lexical-linebreak","true"),o.style.cssText="display: inline !important; border: 0px !important; margin: 0px !important;",o.alt="",r.insertBefore(o,s),r.__lexicalLineBreak=o}else r.__lexicalLineBreak=s}getFirstChildOffset(){let e=0;for(let t=this.after;t!==null;t=t.previousSibling)e++;return e}resolveChildIndex(e,t,r,i){if(r===this.element){const l=this.getFirstChildOffset();return[e,Math.min(l+e.getChildrenSize(),Math.max(l,i))]}const s=fh(t,r);s.push(i);const o=fh(t,this.element);let a=e.getIndexWithinParent();for(let l=0;l<o.length;l++){const c=s[l],u=o[l];if(c===void 0||c<u)break;if(c>u){a+=1;break}}return[e.getParentOrThrow(),a]}};function fh(n,e){const t=[];let r=e;for(;r!==n&&r!==null;r=r.parentNode){let i=0;for(let s=r.previousSibling;s!==null;s=s.previousSibling)i++;t.push(i)}return r!==n&&H(225),t.reverse()}let ht=class extends Hi{constructor(e){super(e),this.__first=null,this.__last=null,this.__size=0,this.__format=0,this.__style="",this.__indent=0,this.__dir=null,this.__textFormat=0,this.__textStyle=""}afterCloneFrom(e){super.afterCloneFrom(e),this.__key===e.__key&&(this.__first=e.__first,this.__last=e.__last,this.__size=e.__size),this.__indent=e.__indent,this.__format=e.__format,this.__style=e.__style,this.__dir=e.__dir,this.__textFormat=e.__textFormat,this.__textStyle=e.__textStyle}getFormat(){return this.getLatest().__format}getFormatType(){const e=this.getFormat();return Sk[e]||""}getStyle(){return this.getLatest().__style}getIndent(){return this.getLatest().__indent}getChildren(){const e=[];let t=this.getFirstChild();for(;t!==null;)e.push(t),t=t.getNextSibling();return e}getChildrenKeys(){const e=[];let t=this.getFirstChild();for(;t!==null;)e.push(t.__key),t=t.getNextSibling();return e}getChildrenSize(){return this.getLatest().__size}isEmpty(){return this.getChildrenSize()===0}isDirty(){const e=$e()._dirtyElements;return e!==null&&e.has(this.__key)}isLastChild(){const e=this.getLatest(),t=this.getParentOrThrow().getLastChild();return t!==null&&t.is(e)}getAllTextNodes(){const e=[];let t=this.getFirstChild();for(;t!==null;){if(U(t)&&e.push(t),L(t)){const r=t.getAllTextNodes();e.push(...r)}t=t.getNextSibling()}return e}getFirstDescendant(){let e=this.getFirstChild();for(;L(e);){const t=e.getFirstChild();if(t===null)break;e=t}return e}getLastDescendant(){let e=this.getLastChild();for(;L(e);){const t=e.getLastChild();if(t===null)break;e=t}return e}getDescendantByIndex(e){const t=this.getChildren(),r=t.length;if(e>=r){const s=t[r-1];return L(s)&&s.getLastDescendant()||s||null}const i=t[e];return L(i)&&i.getFirstDescendant()||i||null}getFirstChild(){const e=this.getLatest().__first;return e===null?null:he(e)}getFirstChildOrThrow(){const e=this.getFirstChild();return e===null&&H(45,this.__key),e}getLastChild(){const e=this.getLatest().__last;return e===null?null:he(e)}getLastChildOrThrow(){const e=this.getLastChild();return e===null&&H(96,this.__key),e}getChildAtIndex(e){const t=this.getChildrenSize();let r,i;if(e<t/2){for(r=this.getFirstChild(),i=0;r!==null&&i<=e;){if(i===e)return r;r=r.getNextSibling(),i++}return null}for(r=this.getLastChild(),i=t-1;r!==null&&i>=e;){if(i===e)return r;r=r.getPreviousSibling(),i--}return null}getTextContent(){let e="";const t=this.getChildren(),r=t.length;for(let i=0;i<r;i++){const s=t[i];e+=s.getTextContent(),L(s)&&i!==r-1&&!s.isInline()&&(e+=Pn)}return e}getTextContentSize(){let e=0;const t=this.getChildren(),r=t.length;for(let i=0;i<r;i++){const s=t[i];e+=s.getTextContentSize(),L(s)&&i!==r-1&&!s.isInline()&&(e+=Pn.length)}return e}getDirection(){return this.getLatest().__dir}getTextFormat(){return this.getLatest().__textFormat}hasFormat(e){if(e!==""){const t=Pf[e];return!!(this.getFormat()&t)}return!1}hasTextFormat(e){const t=nr[e];return!!(this.getTextFormat()&t)}getFormatFlags(e,t){return Fa(this.getLatest().__textFormat,e,t)}getTextStyle(){return this.getLatest().__textStyle}select(e,t){Xe();const r=K();let i=e,s=t;const o=this.getChildrenSize();if(!this.canBeEmpty()){if(e===0&&t===0){const l=this.getFirstChild();if(U(l)||L(l))return l.select(0,0)}else if(!(e!==void 0&&e!==o||t!==void 0&&t!==o)){const l=this.getLastChild();if(U(l)||L(l))return l.select()}}i===void 0&&(i=o),s===void 0&&(s=o);const a=this.__key;return B(r)?(r.anchor.set(a,i,"element"),r.focus.set(a,s,"element"),r.dirty=!0,r):Um(a,i,a,s,"element","element")}selectStart(){const e=this.getFirstDescendant();return e?e.selectStart():this.select()}selectEnd(){const e=this.getLastDescendant();return e?e.selectEnd():this.select()}clear(){const e=this.getWritable();return this.getChildren().forEach(t=>t.remove()),e}append(...e){return this.splice(this.getChildrenSize(),0,e)}setDirection(e){const t=this.getWritable();return t.__dir=e,t}setFormat(e){return this.getWritable().__format=e!==""?Pf[e]:0,this}setStyle(e){return this.getWritable().__style=e||"",this}setTextFormat(e){const t=this.getWritable();return t.__textFormat=e,t}setTextStyle(e){const t=this.getWritable();return t.__textStyle=e,t}setIndent(e){return this.getWritable().__indent=e,this}splice(e,t,r){const i=r.length,s=this.getChildrenSize(),o=this.getWritable();e+t<=s||H(226,String(e),String(t),String(s));const a=o.__key,l=[],c=[],u=this.getChildAtIndex(e+t);let f=null,d=s-t+i;if(e!==0)if(e===s)f=this.getLastChild();else{const p=this.getChildAtIndex(e);p!==null&&(f=p.getPreviousSibling())}if(t>0){let p=f===null?this.getFirstChild():f.getNextSibling();for(let m=0;m<t;m++){p===null&&H(100);const y=p.getNextSibling(),v=p.__key;Ir(p.getWritable()),c.push(v),p=y}}let g=f;for(let p=0;p<i;p++){const m=r[p];g!==null&&m.is(g)&&(f=g=g.getPreviousSibling());const y=m.getWritable();y.__parent===a&&d--,Ir(y);const v=m.__key;if(g===null)o.__first=v,y.__prev=null;else{const _=g.getWritable();_.__next=v,y.__prev=_.__key}m.__key===a&&H(76),y.__parent=a,l.push(v),g=m}if(e+t===s)g!==null&&(g.getWritable().__next=null,o.__last=g.__key);else if(u!==null){const p=u.getWritable();if(g!==null){const m=g.getWritable();p.__prev=g.__key,m.__next=u.__key}else p.__prev=null}if(o.__size=d,c.length){const p=K();if(B(p)){const m=new Set(c),y=new Set(l),{anchor:v,focus:_}=p;hh(v,m,y)&&ja(v,v.getNode(),this,f,u),hh(_,m,y)&&ja(_,_.getNode(),this,f,u),d!==0||this.canBeEmpty()||yn(this)||this.remove()}}return o}getDOMSlot(e){return new cw(e)}exportDOM(e){const{element:t}=super.exportDOM(e);if(Te(t)){const r=this.getIndent();r>0&&(t.style.paddingInlineStart=40*r+"px");const i=this.getDirection();i&&(t.dir=i)}return{element:t}}exportJSON(){const e={children:[],direction:this.getDirection(),format:this.getFormatType(),indent:this.getIndent(),...super.exportJSON()},t=this.getTextFormat(),r=this.getTextStyle();return t!==0&&(e.textFormat=t),r!==""&&(e.textStyle=r),e}updateFromJSON(e){return super.updateFromJSON(e).setFormat(e.format).setIndent(e.indent).setDirection(e.direction).setTextFormat(e.textFormat||0).setTextStyle(e.textStyle||"")}insertNewAfter(e,t){return null}canIndent(){return!0}collapseAtStart(e){return!1}excludeFromCopy(e){return!1}canReplaceWith(e){return!0}canInsertAfter(e){return!0}canBeEmpty(){return!0}canInsertTextBefore(){return!0}canInsertTextAfter(){return!0}isInline(){return!1}isShadowRoot(){return!1}canMergeWith(e){return!1}extractWithChild(e,t,r){return!1}canMergeWhenEmpty(){return!1}reconcileObservedMutation(e,t){const r=this.getDOMSlot(e);let i=r.getFirstChild();for(let s=this.getFirstChild();s;s=s.getNextSibling()){const o=t.getElementByKey(s.getKey());o!==null&&(i==null?(r.insertChild(o),i=o):i!==o&&r.replaceChild(o,i),i=i.nextSibling)}}};function L(n){return n instanceof ht}function hh(n,e,t){let r=n.getNode();for(;r;){const i=r.__key;if(e.has(i)&&!t.has(i))return!0;r=r.getParent()}return!1}let hr=class extends Hi{decorate(e,t){H(47)}isIsolated(){return!1}isInline(){return!0}isKeyboardSelectable(){return!0}};function be(n){return n instanceof hr}let wd=class Ym extends ht{static getType(){return"root"}static clone(){return new Ym}constructor(){super("root"),this.__cachedText=null}getTopLevelElementOrThrow(){H(51)}getTextContent(){const e=this.__cachedText;return!Vi()&&$e()._dirtyType!==jr||e===null?super.getTextContent():e}remove(){H(52)}replace(e){H(53)}insertBefore(e){H(54)}insertAfter(e){H(55)}updateDOM(e,t){return!1}splice(e,t,r){for(const i of r)L(i)||be(i)||H(282);return super.splice(e,t,r)}static importJSON(e){return pe().updateFromJSON(e)}collapseAtStart(){return!0}};function Qe(n){return n instanceof wd}function Xm(n){return new Qm(new Map(n._nodeMap))}function xd(){return new Qm(new Map([["root",new wd]]))}function Zm(n){const e=n.exportJSON(),t=n.constructor;if(e.type!==t.getType()&&H(130,t.name),L(n)){const r=e.children;Array.isArray(r)||H(59,t.name);const i=n.getChildren();for(let s=0;s<i.length;s++){const o=Zm(i[s]);r.push(o)}}return e}let Qm=class ey{constructor(e,t){this._nodeMap=e,this._selection=t||null,this._flushSync=!1,this._readOnly=!1}isEmpty(){return this._nodeMap.size===1&&this._selection===null}read(e,t){return uh(t&&t.editor||null,this,e)}clone(e){const t=new ey(this._nodeMap,e===void 0?this._selection:e);return t._readOnly=!0,t}toJSON(){return uh(null,this,()=>({root:Zm(pe())}))}};const cu="historic",uw="history-push",$r="history-merge",ty="paste",dw="collaboration",fw="skip-scroll-into-view",hw="skip-dom-selection";let Cd=class extends ht{static getType(){return"artificial"}createDOM(e){return document.createElement("div")}},Gi=class ny extends ht{static getType(){return"paragraph"}static clone(e){return new ny(e.__key)}createDOM(e){const t=document.createElement("p"),r=ki(e.theme,"paragraph");return r!==void 0&&t.classList.add(...r),t}updateDOM(e,t,r){return!1}static importDOM(){return{p:e=>({conversion:gw,priority:0})}}exportDOM(e){const{element:t}=super.exportDOM(e);if(Te(t)){this.isEmpty()&&t.append(document.createElement("br"));const r=this.getFormatType();r&&(t.style.textAlign=r)}return{element:t}}static importJSON(e){return Ot().updateFromJSON(e)}exportJSON(){return{...super.exportJSON(),textFormat:this.getTextFormat(),textStyle:this.getTextStyle()}}insertNewAfter(e,t){const r=Ot();r.setTextFormat(e.format),r.setTextStyle(e.style);const i=this.getDirection();return r.setDirection(i),r.setFormat(this.getFormatType()),r.setStyle(this.getStyle()),this.insertAfter(r,t),r}collapseAtStart(){const e=this.getChildren();if(e.length===0||U(e[0])&&e[0].getTextContent().trim()===""){if(this.getNextSibling()!==null)return this.selectNext(),this.remove(),!0;if(this.getPreviousSibling()!==null)return this.selectPrevious(),this.remove(),!0}return!1}};function gw(n){const e=Ot();return n.style&&(e.setFormat(n.style.textAlign),Nw(n,e)),{node:e}}function Ot(){return Ne(new Gi)}function Sd(n){return n instanceof Gi}const ne=0,ei=1,ma=2,hl=3,Is=4;function ry(n,e,t,r){const i=n._keyToDOMMap;i.clear(),n._editorState=xd(),n._pendingEditorState=r,n._compositionKey=null,n._dirtyType=jr,n._cloneNotNeeded.clear(),n._dirtyLeaves=new Set,n._dirtyElements.clear(),n._normalizedNodes=new Set,n._updateTags=new Set,n._updates=[],n._blockCursorElement=null;const s=n._observer;s!==null&&(s.disconnect(),n._observer=null),e!==null&&(e.textContent=""),t!==null&&(t.textContent="",i.set("root",t))}function pw(n){const e=n||{},t=lw(),r=e.theme||{},i=n===void 0?t:e.parentEditor||null,s=e.disableEvents||!1,o=xd(),a=e.namespace||(i!==null?i._config.namespace:uy()),l=e.editorState,c=[wd,At,Qr,bd,Gi,Cd,...e.nodes||[]],{onError:u,html:f}=e,d=e.editable===void 0||e.editable;let g;if(n===void 0&&t!==null)g=t._nodes;else{g=new Map;for(let m=0;m<c.length;m++){let y=c[m],v=null,_=null;if(typeof y!="function"){const R=y;y=R.replace,v=R.with,_=R.withKlass||null}const{ownNodeConfig:w}=Dd(y),E=y.getType(),$=y.transform(),P=new Set;w&&w.$transform&&P.add(w.$transform),$!==null&&P.add($),g.set(E,{exportDOM:f&&f.export?f.export.get(y):void 0,klass:y,replace:v,replaceWithKlass:_,sharedNodeState:Ik(c[m]),transforms:P})}}const p=new gl(o,i,g,{disableEvents:s,namespace:a,theme:r},u||console.error,function(m,y){const v=new Map,_=new Set,w=E=>{Object.keys(E).forEach($=>{let P=v.get($);P===void 0&&(P=[],v.set($,P)),P.push(E[$])})};return m.forEach(E=>{const $=E.klass.importDOM;if($==null||_.has($))return;_.add($);const P=$.call(E.klass);P!==null&&w(P)}),y&&w(y),v}(g,f?f.import:void 0),d,n);return l!==void 0&&(p._pendingEditorState=l,p._dirtyType=Ni),p}let gl=class{constructor(e,t,r,i,s,o,a,l){this._createEditorArgs=l,this._parentEditor=t,this._rootElement=null,this._editorState=e,this._pendingEditorState=null,this._compositionKey=null,this._deferred=[],this._keyToDOMMap=new Map,this._updates=[],this._updating=!1,this._listeners={decorator:new Set,editable:new Set,mutation:new Map,root:new Set,textcontent:new Set,update:new Set},this._commands=new Map,this._config=i,this._nodes=r,this._decorators={},this._pendingDecorators=null,this._dirtyType=jr,this._cloneNotNeeded=new Set,this._dirtyLeaves=new Set,this._dirtyElements=new Map,this._normalizedNodes=new Set,this._updateTags=new Set,this._observer=null,this._key=uy(),this._onError=s,this._htmlConversions=o,this._editable=a,this._headless=t!==null&&t._headless,this._window=null,this._blockCursorElement=null}isComposing(){return this._compositionKey!=null}registerUpdateListener(e){const t=this._listeners.update;return t.add(e),()=>{t.delete(e)}}registerEditableListener(e){const t=this._listeners.editable;return t.add(e),()=>{t.delete(e)}}registerDecoratorListener(e){const t=this._listeners.decorator;return t.add(e),()=>{t.delete(e)}}registerTextContentListener(e){const t=this._listeners.textcontent;return t.add(e),()=>{t.delete(e)}}registerRootListener(e){const t=this._listeners.root;return e(this._rootElement,null),t.add(e),()=>{e(null,this._rootElement),t.delete(e)}}registerCommand(e,t,r){r===void 0&&H(35);const i=this._commands;i.has(e)||i.set(e,[new Set,new Set,new Set,new Set,new Set]);const s=i.get(e);s===void 0&&H(36,String(e));const o=s[r];return o.add(t),()=>{o.delete(t),s.every(a=>a.size===0)&&i.delete(e)}}registerMutationListener(e,t,r){const i=this.resolveRegisteredNodeAfterReplacements(this.getRegisteredNode(e)).klass,s=this._listeners.mutation;let o=s.get(t);o===void 0&&(o=new Set,s.set(t,o)),o.add(i);const a=r&&r.skipInitialization;return a!==void 0&&a||this.initializeMutationListener(t,i),()=>{o.delete(i),o.size===0&&s.delete(t)}}getRegisteredNode(e){const t=this._nodes.get(e.getType());return t===void 0&&H(37,e.name),t}resolveRegisteredNodeAfterReplacements(e){for(;e.replaceWithKlass;)e=this.getRegisteredNode(e.replaceWithKlass);return e}initializeMutationListener(e,t){const r=this._editorState,i=wh(r).get(t.getType());if(!i)return;const s=new Map;for(const o of i.keys())s.set(o,"created");s.size>0&&e(s,{dirtyLeaves:new Set,prevEditorState:r,updateTags:new Set(["registerMutationListener"])})}registerNodeTransformToKlass(e,t){const r=this.getRegisteredNode(e);return r.transforms.add(t),r}registerNodeTransform(e,t){const r=this.registerNodeTransformToKlass(e,t),i=[r],s=r.replaceWithKlass;if(s!=null){const o=this.registerNodeTransformToKlass(s,t);i.push(o)}return function(o,a){const l=wh(o.getEditorState()),c=[];for(const u of a){const f=l.get(u);f&&c.push(f)}c.length!==0&&o.update(()=>{for(const u of c)for(const f of u.keys()){const d=he(f);d&&d.markDirty()}},o._pendingEditorState===null?{tag:$r}:void 0)}(this,i.map(o=>o.klass.getType())),()=>{i.forEach(o=>o.transforms.delete(t))}}hasNode(e){return this._nodes.has(e.getType())}hasNodes(e){return e.every(this.hasNode.bind(this))}dispatchCommand(e,t){return Y(this,e,t)}getDecorators(){return this._decorators}getRootElement(){return this._rootElement}getKey(){return this._key}setRootElement(e){const t=this._rootElement;if(e!==t){const r=ki(this._config.theme,"root"),i=this._pendingEditorState||this._editorState;if(this._rootElement=e,ry(this,t,e,i),t!==null&&(this._config.disableEvents||Yk(t),r!=null&&t.classList.remove(...r)),e!==null){const s=Id(e),o=e.style;o.userSelect="text",o.whiteSpace="pre-wrap",o.wordBreak="break-word",e.setAttribute("data-lexical-editor","true"),this._window=s,this._dirtyType=Ni,um(this),this._updateTags.add($r),Nn(this),this._config.disableEvents||function(a,l){const c=a.ownerDocument,u=Da.get(c);(u===void 0||u<1)&&c.addEventListener("selectionchange",$m),Da.set(c,(u||0)+1),a.__lexicalEditor=l;const f=Om(a);for(let d=0;d<ru.length;d++){const[g,p]=ru[d],m=typeof p=="function"?y=>{Vf(y)||(Jf(y),(l.isEditable()||g==="click")&&p(y,l))}:y=>{if(Vf(y))return;Jf(y);const v=l.isEditable();switch(g){case"cut":return v&&Y(l,Ki,y);case"copy":return Y(l,Zr,y);case"paste":return v&&Y(l,Xr,y);case"dragstart":return v&&Y(l,md,y);case"dragover":return v&&Y(l,xm,y);case"dragend":return v&&Y(l,Hk,y);case"focus":return v&&Y(l,Jk,y);case"blur":return v&&Y(l,Vk,y);case"drop":return v&&Y(l,dl,y)}};a.addEventListener(g,m),f.push(()=>{a.removeEventListener(g,m)})}}(e,this),r!=null&&e.classList.add(...r)}else this._window=null,this._updateTags.add($r),Nn(this);Ps("root",this,!1,e,t)}}getElementByKey(e){return this._keyToDOMMap.get(e)||null}getEditorState(){return this._editorState}setEditorState(e,t){e.isEmpty()&&H(38);let r=e;r._readOnly&&(r=Xm(e),r._selection=e._selection?e._selection.clone():null),cm(this);const i=this._pendingEditorState,s=this._updateTags,o=t!==void 0?t.tag:null;i===null||i.isEmpty()||(o!=null&&s.add(o),Nn(this)),this._pendingEditorState=r,this._dirtyType=Ni,this._dirtyElements.set("root",!1),this._compositionKey=null,o!=null&&s.add(o),this._updating||Nn(this)}parseEditorState(e,t){return function(r,i,s){const o=xd(),a=ze,l=xt,c=Ke,u=i._dirtyElements,f=i._dirtyLeaves,d=i._cloneNotNeeded,g=i._dirtyType;i._dirtyElements=new Map,i._dirtyLeaves=new Set,i._cloneNotNeeded=new Set,i._dirtyType=0,ze=o,xt=!1,Ke=i,Td(null);try{const p=i._nodes;kd(r.root,p),s&&s(),o._readOnly=!0}catch(p){p instanceof Error&&i._onError(p)}finally{i._dirtyElements=u,i._dirtyLeaves=f,i._cloneNotNeeded=d,i._dirtyType=g,ze=a,xt=l,Ke=c}return o}(typeof e=="string"?JSON.parse(e):e,this,t)}read(e){return Nn(this),this.getEditorState().read(e,{editor:this})}update(e,t){(function(r,i,s){r._updating?r._updates.push([i,s]):fl(r,i,s)})(this,e,t)}focus(e,t={}){const r=this._rootElement;r!==null&&(r.setAttribute("autocapitalize","off"),Et(this,()=>{const i=K(),s=pe();i!==null?i.dirty||rt(i.clone()):s.getChildrenSize()!==0&&(t.defaultSelection==="rootStart"?s.selectStart():s.selectEnd()),py("focus"),ww(()=>{r.removeAttribute("autocapitalize"),e&&e()})}),this._pendingEditorState===null&&r.removeAttribute("autocapitalize"))}blur(){const e=this._rootElement;e!==null&&e.blur();const t=Gt(this._window);t!==null&&t.removeAllRanges()}isEditable(){return this._editable}setEditable(e){this._editable!==e&&(this._editable=e,Ps("editable",this,!0,e))}toJSON(){return{editorState:this._editorState.toJSON()}}};gl.version="0.34.0+prod.esm";let uu=null;function Td(n){uu=n}let mw=1;function iy(n,e){const t=Ed(n,e);return t===void 0&&H(30,e),t}function Ed(n,e){return n._nodes.get(e)}const yw=typeof queueMicrotask=="function"?queueMicrotask:n=>{Promise.resolve().then(n)};function gh(n){return be(ir(n))}function Nd(n){const e=document.activeElement;if(!Te(e))return!1;const t=e.nodeName;return be(ir(n))&&(t==="INPUT"||t==="TEXTAREA"||e.contentEditable==="true"&&pl(e)==null)}function io(n,e,t){const r=n.getRootElement();try{return r!==null&&r.contains(e)&&r.contains(t)&&e!==null&&!Nd(e)&&sy(e)===n}catch{return!1}}function Md(n){return n instanceof gl}function sy(n){let e=n;for(;e!=null;){const t=pl(e);if(Md(t))return t;e=so(e)}return null}function pl(n){return n?n.__lexicalEditor:null}function Pr(n){return Lm(n)||n.isToken()}function Tn(n){return Pr(n)||n.isSegmented()}function jn(n){return ti(n)&&n.nodeType===gk}function _w(n){return ti(n)&&n.nodeType===pk}function Pi(n){let e=n;for(;e!=null;){if(jn(e))return e;e=e.firstChild}return null}function Fa(n,e,t){const r=nr[e];if(t!==null&&(n&r)==(t&r))return n;let i=n^r;return e==="subscript"?i&=-65:e==="superscript"?i&=-33:e==="lowercase"?(i&=-513,i&=-1025):e==="uppercase"?(i&=-257,i&=-1025):e==="capitalize"&&(i&=-257,i&=-513),i}function bw(n,e){const t=function(){const o=uu;return uu=null,o}();if((e=e||t&&t.__key)!=null)return void(n.__key=e);Xe(),Hm();const r=$e(),i=fr(),s=""+mw++;i._nodeMap.set(s,n),L(n)?r._dirtyElements.set(s,!0):r._dirtyLeaves.add(s),r._cloneNotNeeded.add(s),r._dirtyType=im,n.__key=s}function Ir(n){const e=n.getParent();if(e!==null){const t=n.getWritable(),r=e.getWritable(),i=n.getPreviousSibling(),s=n.getNextSibling(),o=s!==null?s.__key:null,a=i!==null?i.__key:null,l=i!==null?i.getWritable():null,c=s!==null?s.getWritable():null;i===null&&(r.__first=o),s===null&&(r.__last=a),l!==null&&(l.__next=o),c!==null&&(c.__prev=a),t.__prev=null,t.__next=null,t.__parent=null,r.__size--}}function qa(n){Hm();const e=n.getLatest(),t=e.__parent,r=fr(),i=$e(),s=r._nodeMap,o=i._dirtyElements;t!==null&&function(l,c,u){let f=l;for(;f!==null;){if(u.has(f))return;const d=c.get(f);if(d===void 0)break;u.set(f,!1),f=d.__parent}}(t,s,o);const a=e.__key;i._dirtyType=im,L(n)?o.set(a,!0):i._dirtyLeaves.add(a)}function Ze(n){Xe();const e=$e(),t=e._compositionKey;if(n!==t){if(e._compositionKey=n,t!==null){const r=he(t);r!==null&&r.getWritable()}if(n!==null){const r=he(n);r!==null&&r.getWritable()}}}function Yn(){return Vi()?null:$e()._compositionKey}function he(n,e){const t=(e||fr())._nodeMap.get(n);return t===void 0?null:t}function oy(n,e){const t=ml(n,$e());return t!==void 0?he(t,e):null}function ml(n,e){return n[`__lexicalKey_${e._key}`]}function ir(n,e){let t=n;for(;t!=null;){const r=oy(t,e);if(r!==null)return r;t=so(t)}return null}function ay(n){const e=n._decorators,t=Object.assign({},e);return n._pendingDecorators=t,t}function ph(n){return n.read(()=>pe().getTextContent())}function pe(){return ly(fr())}function ly(n){return n._nodeMap.get("root")}function rt(n){Xe();const e=fr();n!==null&&(n.dirty=!0,n.setCachedNodes(null)),e._selection=n}function bi(n){const e=$e(),t=function(r,i){let s=r;for(;s!=null;){const o=ml(s,i);if(o!==void 0)return o;s=so(s)}return null}(n,e);return t===null?n===e.getRootElement()?he("root"):null:he(t)}function cy(n){return/[\uD800-\uDBFF][\uDC00-\uDFFF]/g.test(n)}function Ad(n){const e=[];let t=n;for(;t!==null;)e.push(t),t=t._parentEditor;return e}function uy(){return Math.random().toString(36).replace(/[^a-z]+/g,"").substring(0,5)}function dy(n){return jn(n)?n.nodeValue:null}function Od(n,e,t){const r=Gt(jt(e));if(r===null)return;const i=r.anchorNode;let{anchorOffset:s,focusOffset:o}=r;if(i!==null){let a=dy(i);const l=ir(i);if(a!==null&&U(l)){if(a===ol&&t){const c=t.length;a=t,s=c,o=c}a!==null&&$d(l,a,s,o,n)}}}function $d(n,e,t,r,i){let s=n;if(s.isAttached()&&(i||!s.isDirty())){const o=s.isComposing();let a=e;(o||i)&&e[e.length-1]===ol&&(a=e.slice(0,-1));const l=s.getTextContent();if(i||a!==l){if(a===""){if(Ze(null),Ls||Ei||Ea)s.remove();else{const m=$e();setTimeout(()=>{m.update(()=>{s.isAttached()&&s.remove()})},20)}return}const c=s.getParent(),u=Ji(),f=s.getTextContentSize(),d=Yn(),g=s.getKey();if(s.isToken()||d!==null&&g===d&&!o||B(u)&&(c!==null&&!c.canInsertTextBefore()&&u.anchor.offset===0||u.anchor.key===n.__key&&u.anchor.offset===0&&!s.canInsertTextBefore()&&!o||u.focus.key===n.__key&&u.focus.offset===f&&!s.canInsertTextAfter()&&!o))return void s.markDirty();const p=K();if(!B(p)||t===null||r===null)return void mh(s,a,p);if(p.setTextNodeRange(s,t,s,r),s.isSegmented()){const m=ue(s.getTextContent());s.replace(m),s=m}mh(s,a,p)}}}function mh(n,e,t){if(n.setTextContent(e),B(t)){const r=n.getKey();for(const i of["anchor","focus"]){const s=t[i];s.type==="text"&&s.key===r&&(s.offset=tr(n,s.offset,"clamp"))}}}function qo(n,e,t){const r=e[t]||!1;return r==="any"||r===n[t]}function vw(n,e){return qo(n,e,"altKey")&&qo(n,e,"ctrlKey")&&qo(n,e,"shiftKey")&&qo(n,e,"metaKey")}function Ce(n,e,t){return vw(n,t)&&n.key.toLowerCase()===e.toLowerCase()}const Sn={ctrlKey:!ln,metaKey:ln},yh={altKey:ln,ctrlKey:!ln};function _h(n){return n.key==="Backspace"}function bh(n){return Ce(n,"a",Sn)}function fy(n){const e=pe();if(B(n)){const t=n.anchor,r=n.focus,i=t.getNode().getTopLevelElementOrThrow().getParentOrThrow();return t.set(i.getKey(),0,"element"),r.set(i.getKey(),i.getChildrenSize(),"element"),js(n),n}{const t=e.select(0,e.getChildrenSize());return rt(js(t)),t}}function ki(n,e){n.__lexicalClassNameCache===void 0&&(n.__lexicalClassNameCache={});const t=n.__lexicalClassNameCache,r=t[e];if(r!==void 0)return r;const i=n[e];if(typeof i=="string"){const s=Na(i);return t[e]=s,s}return i}function Pd(n,e,t,r,i){if(t.size===0)return;const s=r.__type,o=r.__key,a=e.get(s);a===void 0&&H(33,s);const l=a.klass;let c=n.get(l);c===void 0&&(c=new Map,n.set(l,c));const u=c.get(o),f=u==="destroyed"&&i==="created";(u===void 0||f)&&c.set(o,f?"updated":i)}function vh(n,e,t){const r=n.getParent();let i=t,s=n;return r!==null&&(e&&t===0?(i=s.getIndexWithinParent(),s=r):e||t!==s.getChildrenSize()||(i=s.getIndexWithinParent()+1,s=r)),s.getChildAtIndex(e?i-1:i)}function du(n,e){const t=n.offset;if(n.type==="element")return vh(n.getNode(),e,t);{const r=n.getNode();if(e&&t===0||!e&&t===r.getTextContentSize()){const i=e?r.getPreviousSibling():r.getNextSibling();return i===null?vh(r.getParentOrThrow(),e,r.getIndexWithinParent()+(e?0:1)):i}}return null}function hy(n){const e=jt(n).event,t=e&&e.inputType;return t==="insertFromPaste"||t==="insertFromPasteAsQuotation"}function Y(n,e,t){return function(r,i,s){const o=Ad(r);for(let a=4;a>=0;a--)for(let l=0;l<o.length;l++){const c=o[l],u=c._commands.get(i);if(u!==void 0){const f=u[a];if(f!==void 0){const d=Array.from(f),g=d.length;let p=!1;if(Et(c,()=>{for(let m=0;m<g;m++)if(d[m](s,r))return void(p=!0)}),p)return p}}}return!1}(n,e,t)}function yl(n){return!Qe(n)&&!n.isLastChild()&&!n.isInline()}function Ii(n,e){const t=n._keyToDOMMap.get(e);return t===void 0&&H(75,e),t}function so(n){const e=n.assignedSlot||n.parentElement;return gu(e)?e.host:e}function gy(n){return _w(n)?n:Te(n)?n.ownerDocument:null}function kw(n){return $e()._updateTags.has(n)}function py(n){Xe(),$e()._updateTags.add(n)}function ww(n){Xe(),$e()._deferred.push(n)}function fu(n,e){let t=n.getParent();for(;t!==null;){if(t.is(e))return!0;t=t.getParent()}return!1}function Id(n){const e=gy(n);return e?e.defaultView:null}function jt(n){const e=n._window;return e===null&&H(78),e}function xw(n){return L(n)&&n.isInline()||be(n)&&n.isInline()}function Cw(n){let e=n.getParentOrThrow();for(;e!==null;){if(yn(e))return e;e=e.getParentOrThrow()}return e}function yn(n){return Qe(n)||L(n)&&n.isShadowRoot()}function Ne(n){const e=$e(),t=n.getType(),r=Ed(e,t);r===void 0&&H(200,n.constructor.name,t);const{replace:i,replaceWithKlass:s}=r;if(i!==null){const o=i(n),a=o.constructor;return s!==null?o instanceof s||H(201,s.name,s.getType(),a.name,a.getType(),n.constructor.name,t):o instanceof n.constructor&&a!==n.constructor||H(202,a.name,a.getType(),n.constructor.name,t),o.__key===n.__key&&H(203,n.constructor.name,t,a.name,a.getType()),o}return n}function Tc(n,e){!Qe(n.getParent())||L(e)||be(e)||H(99)}function Sw(n){const e=he(n);return e===null&&H(63,n),e}function Ec(n){return(be(n)||L(n)&&!n.canBeEmpty())&&!n.isInline()}function hu(n,e,t){t.style.removeProperty("caret-color"),e._blockCursorElement=null;const r=n.parentElement;r!==null&&r.removeChild(n)}function Gt(n){return Zt?(n||window).getSelection():null}function Tw(n){const e=Id(n);return e?e.getSelection():null}function my(n){return Te(n)&&n.tagName==="A"}function Te(n){return ti(n)&&n.nodeType===hk}function ti(n){return typeof n=="object"&&n!==null&&"nodeType"in n&&typeof n.nodeType=="number"}function gu(n){return ti(n)&&n.nodeType===mk}function pu(n){const e=new RegExp(/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|mark|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var|#text)$/,"i");return n.nodeName.match(e)!==null}function Ba(n){const e=new RegExp(/^(address|article|aside|blockquote|canvas|dd|div|dl|dt|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hr|li|main|nav|noscript|ol|p|pre|section|table|td|tfoot|ul|video)$/,"i");return n.nodeName.match(e)!==null}function Rt(n){if(be(n)&&!n.isInline())return!0;if(!L(n)||yn(n))return!1;const e=n.getFirstChild(),t=e===null||Or(e)||U(e)||e.isInline();return!n.isInline()&&n.canBeEmpty()!==!1&&t}function Nc(n,e){let t=n;for(;t!==null&&t.getParent()!==null&&!e(t);)t=t.getParentOrThrow();return e(t)?t:null}function _l(){return $e()}const kh=new WeakMap,Ew=new Map;function wh(n){if(!n._readOnly&&n.isEmpty())return Ew;n._readOnly||H(192);let e=kh.get(n);return e||(e=function(t){const r=new Map;for(const[i,s]of t._nodeMap){const o=s.__type;let a=r.get(o);a||(a=new Map,r.set(o,a)),a.set(i,s)}return r}(n),kh.set(n,e)),e}function Rd(n){const e=n.constructor.clone(n);return e.afterCloneFrom(n),e}function Nw(n,e){const t=parseInt(n.style.paddingInlineStart,10)||0,r=Math.round(t/40);e.setIndent(r)}function Mw(n){n.__lexicalUnmanaged=!0}function Aw(n){return n.__lexicalUnmanaged===!0}function ks(n,e){return function(t,r){return Object.prototype.hasOwnProperty.call(t,r)}(n,e)&&n[e]!==Hi[e]}function Dd(n){const e=If in n.prototype?n.prototype[If]():void 0,t=function(o){return o===hr||o===ht||o===Hi}(n),r=!t&&ks(n,"getType")?n.getType():void 0;let i,s=r;if(e)if(r)i=e[r];else for(const[o,a]of Object.entries(e))s=o,i=a;if(!t&&s&&(ks(n,"getType")||(n.getType=()=>s),ks(n,"clone")||(n.clone=o=>(Td(o),new n)),ks(n,"importJSON")||(n.importJSON=i&&i.$importJSON||(o=>new n().updateFromJSON(o))),!ks(n,"importDOM")&&i)){const{importDOM:o}=i;o&&(n.importDOM=()=>o)}return{ownNodeConfig:i,ownNodeType:s}}const Ow={next:"previous",previous:"next"};let Ld=class{constructor(e){this.origin=e}[Symbol.iterator](){return bl({hasNext:Br,initial:this.getAdjacentCaret(),map:e=>e,step:e=>e.getAdjacentCaret()})}getAdjacentCaret(){return Be(this.getNodeAtCaret(),this.direction)}getSiblingCaret(){return Be(this.origin,this.direction)}remove(){const e=this.getNodeAtCaret();return e&&e.remove(),this}replaceOrInsert(e,t){const r=this.getNodeAtCaret();return e.is(this.origin)||e.is(r)||(r===null?this.insert(e):r.replace(e,t)),this}splice(e,t,r="next"){const i=r===this.direction?t:Array.from(t).reverse();let s=this;const o=this.getParentAtCaret(),a=new Map;for(let l=s.getAdjacentCaret();l!==null&&a.size<e;l=l.getAdjacentCaret()){const c=l.origin.getWritable();a.set(c.getKey(),c)}for(const l of i){if(a.size>0){const c=s.getNodeAtCaret();if(c){if(a.delete(c.getKey()),a.delete(l.getKey()),!(c.is(l)||s.origin.is(l))){const u=l.getParent();u&&u.is(o)&&l.remove(),c.replace(l)}}else c===null&&H(263,Array.from(a).join(" "))}else s.insert(l);s=Be(l,this.direction)}for(const l of a.values())l.remove();return this}},mu=class yy extends Ld{constructor(){super(...arguments);Pt(this,"type","child")}getLatest(){const t=this.origin.getLatest();return t===this.origin?this:Yt(t,this.direction)}getParentCaret(t="root"){return Be(jd(this.getParentAtCaret(),t),this.direction)}getFlipped(){const t=Yi(this.direction);return Be(this.getNodeAtCaret(),t)||Yt(this.origin,t)}getParentAtCaret(){return this.origin}getChildCaret(){return this}isSameNodeCaret(t){return t instanceof yy&&this.direction===t.direction&&this.origin.is(t.origin)}isSamePointCaret(t){return this.isSameNodeCaret(t)}};const $w={root:Qe,shadowRoot:yn};function Yi(n){return Ow[n]}function jd(n,e="root"){return $w[e](n)?null:n}let Wa=class yu extends Ld{constructor(){super(...arguments);Pt(this,"type","sibling")}getLatest(){const t=this.origin.getLatest();return t===this.origin?this:Be(t,this.direction)}getSiblingCaret(){return this}getParentAtCaret(){return this.origin.getParent()}getChildCaret(){return L(this.origin)?Yt(this.origin,this.direction):null}getParentCaret(t="root"){return Be(jd(this.getParentAtCaret(),t),this.direction)}getFlipped(){const t=Yi(this.direction);return Be(this.getNodeAtCaret(),t)||Yt(this.origin.getParentOrThrow(),t)}isSamePointCaret(t){return t instanceof yu&&this.direction===t.direction&&this.origin.is(t.origin)}isSameNodeCaret(t){return(t instanceof yu||t instanceof Ua)&&this.direction===t.direction&&this.origin.is(t.origin)}},Ua=class _u extends Ld{constructor(t,r){super(t);Pt(this,"type","text");this.offset=r}getLatest(){const t=this.origin.getLatest();return t===this.origin?this:Wr(t,this.direction,this.offset)}getParentAtCaret(){return this.origin.getParent()}getChildCaret(){return null}getParentCaret(t="root"){return Be(jd(this.getParentAtCaret(),t),this.direction)}getFlipped(){return Wr(this.origin,Yi(this.direction),this.offset)}isSamePointCaret(t){return t instanceof _u&&this.direction===t.direction&&this.origin.is(t.origin)&&this.offset===t.offset}isSameNodeCaret(t){return(t instanceof Wa||t instanceof _u)&&this.direction===t.direction&&this.origin.is(t.origin)}getSiblingCaret(){return Be(this.origin,this.direction)}};function er(n){return n instanceof Ua}function Br(n){return n instanceof Wa}function Ht(n){return n instanceof mu}const Pw={next:class extends Ua{constructor(){super(...arguments);Pt(this,"direction","next")}getNodeAtCaret(){return this.origin.getNextSibling()}insert(e){return this.origin.insertAfter(e),this}},previous:class extends Ua{constructor(){super(...arguments);Pt(this,"direction","previous")}getNodeAtCaret(){return this.origin.getPreviousSibling()}insert(e){return this.origin.insertBefore(e),this}}},Iw={next:class extends Wa{constructor(){super(...arguments);Pt(this,"direction","next")}getNodeAtCaret(){return this.origin.getNextSibling()}insert(e){return this.origin.insertAfter(e),this}},previous:class extends Wa{constructor(){super(...arguments);Pt(this,"direction","previous")}getNodeAtCaret(){return this.origin.getPreviousSibling()}insert(e){return this.origin.insertBefore(e),this}}},Rw={next:class extends mu{constructor(){super(...arguments);Pt(this,"direction","next")}getNodeAtCaret(){return this.origin.getFirstChild()}insert(e){return this.origin.splice(0,0,[e]),this}},previous:class extends mu{constructor(){super(...arguments);Pt(this,"direction","previous")}getNodeAtCaret(){return this.origin.getLastChild()}insert(e){return this.origin.splice(this.origin.getChildrenSize(),0,[e]),this}}};function Be(n,e){return n?new Iw[e](n):null}function Wr(n,e,t){return n?new Pw[e](n,tr(n,t)):null}function tr(n,e,t="error"){const r=n.getTextContentSize();let i=e==="next"?r:e==="previous"?0:e;return(i<0||i>r)&&(t!=="clamp"&&function(s,...o){const a=new URL("https://lexical.dev/docs/error"),l=new URLSearchParams;l.append("code",s);for(const c of o)l.append("v",c);a.search=l.toString(),console.warn(`Minified Lexical warning #${s}; visit ${a.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}(284,String(e),String(r),n.getKey()),i=i<0?0:r),i}function xh(n,e){return new jw(n,e)}function Yt(n,e){return L(n)?new Rw[e](n):null}function Dw(n){return n&&n.getChildCaret()||n}function Us(n){return n&&Dw(n.getAdjacentCaret())}let Lw=class _y{constructor(e,t,r){Pt(this,"type","node-caret-range");this.anchor=e,this.focus=t,this.direction=r}getLatest(){const e=this.anchor.getLatest(),t=this.focus.getLatest();return e===this.anchor&&t===this.focus?this:new _y(e,t,this.direction)}isCollapsed(){return this.anchor.isSamePointCaret(this.focus)}getTextSlices(){const e=i=>{const s=this[i].getLatest();return er(s)?function(o,a){const{direction:l,origin:c}=o,u=tr(c,a==="focus"?Yi(l):l);return xh(o,u-o.offset)}(s,i):null},t=e("anchor"),r=e("focus");if(t&&r){const{caret:i}=t,{caret:s}=r;if(i.isSameNodeCaret(s))return[xh(i,s.offset-i.offset),null]}return[t,r]}iterNodeCarets(e="root"){const t=er(this.anchor)?this.anchor.getSiblingCaret():this.anchor.getLatest(),r=this.focus.getLatest(),i=er(r),s=o=>o.isSameNodeCaret(r)?null:Us(o)||o.getParentCaret(e);return bl({hasNext:o=>o!==null&&!(i&&r.isSameNodeCaret(o)),initial:t.isSameNodeCaret(r)?null:s(t),map:o=>o,step:s})}[Symbol.iterator](){return this.iterNodeCarets("root")}},jw=class{constructor(e,t){Pt(this,"type","slice");this.caret=e,this.distance=t}getSliceIndices(){const{distance:e,caret:{offset:t}}=this,r=t+e;return r<t?[r,t]:[t,r]}getTextContent(){const[e,t]=this.getSliceIndices();return this.caret.origin.getTextContent().slice(e,t)}getTextContentSize(){return Math.abs(this.distance)}removeTextSlice(){const{caret:{origin:e,direction:t}}=this,[r,i]=this.getSliceIndices(),s=e.getTextContent();return Wr(e.setTextContent(s.slice(0,r)+s.slice(i)),t,r)}};function Fd(n){return sr(n,Be(pe(),n.direction))}function Fw(n){return sr(n,n)}function sr(n,e){return n.direction!==e.direction&&H(265),new Lw(n,e,n.direction)}function bl(n){const{initial:e,hasNext:t,step:r,map:i}=n;let s=e;return{[Symbol.iterator](){return this},next(){if(!t(s))return{done:!0,value:void 0};const o={done:!1,value:i(s)};return s=r(s),o}}}function by(n,e){const t=Rs(n.origin,e.origin);switch(t===null&&H(275,n.origin.getKey(),e.origin.getKey()),t.type){case"same":{const r=n.type==="text",i=e.type==="text";return r&&i?function(s,o){return Math.sign(s-o)}(n.offset,e.offset):n.type===e.type?0:r?-1:i?1:n.type==="child"?-1:1}case"ancestor":return n.type==="child"?-1:1;case"descendant":return e.type==="child"?1:-1;case"branch":return vy(t)}}function vy(n){const{a:e,b:t}=n,r=e.__key,i=t.__key;let s=e,o=t;for(;s&&o;s=s.getNextSibling(),o=o.getNextSibling()){if(s.__key===i)return-1;if(o.__key===r)return 1}return s===null?1:-1}function Bo(n,e){return e.is(n)}function Ch(n){return L(n)?[n.getLatest(),null]:[n.getParent(),n.getLatest()]}function Rs(n,e){if(n.is(e))return{commonAncestor:n,type:"same"};const t=new Map;for(let[r,i]=Ch(n);r;i=r,r=r.getParent())t.set(r,i);for(let[r,i]=Ch(e);r;i=r,r=r.getParent()){const s=t.get(r);if(s!==void 0)return s===null?(Bo(n,r)||H(276),{commonAncestor:r,type:"ancestor"}):i===null?(Bo(e,r)||H(277),{commonAncestor:r,type:"descendant"}):((L(s)||Bo(n,s))&&(L(i)||Bo(e,i))&&r.is(s.getParent())&&r.is(i.getParent())||H(278),{a:s,b:i,commonAncestor:r,type:"branch"})}return null}function In(n,e){const{type:t,key:r,offset:i}=n,s=Sw(n.key);return t==="text"?(U(s)||H(266,s.getType(),r),Wr(s,e,i)):(L(s)||H(267,s.getType(),r),Ww(s,n.offset,e))}function zs(n,e){const{origin:t,direction:r}=e,i=r==="next";er(e)?n.set(t.getKey(),e.offset,"text"):Br(e)?U(t)?n.set(t.getKey(),tr(t,r),"text"):n.set(t.getParentOrThrow().getKey(),t.getIndexWithinParent()+(i?1:0),"element"):(Ht(e)&&L(t)||H(268),n.set(t.getKey(),i?0:t.getChildrenSize(),"element"))}function qw(n){const e=K(),t=B(e)?e:ro();return ya(t,n),rt(t),t}function ya(n,e){zs(n.anchor,e.anchor),zs(n.focus,e.focus)}function Sh(n){const{anchor:e,focus:t}=n,r=In(e,"next"),i=In(t,"next"),s=by(r,i)<=0?"next":"previous";return sr(Ri(r,s),Ri(i,s))}function vl(n){const{direction:e,origin:t}=n,r=Be(t,Yi(e)).getNodeAtCaret();return r?Be(r,e):Yt(t.getParentOrThrow(),e)}function Th(n,e="root"){const t=[n];for(let r=Ht(n)?n.getParentCaret(e):n.getSiblingCaret();r!==null;r=r.getParentCaret(e))t.push(vl(r));return t}function Mc(n){return!!n&&n.origin.isAttached()}function Bw(n,e="removeEmptySlices"){if(n.isCollapsed())return n;const t="root",r="next";let i=e;const s=wy(n,r),o=Th(s.anchor,t),a=Th(s.focus.getFlipped(),t),l=new Set,c=[];for(const p of s.iterNodeCarets(t))if(Ht(p))l.add(p.origin.getKey());else if(Br(p)){const{origin:m}=p;L(m)&&!l.has(m.getKey())||c.push(m)}for(const p of c)p.remove();for(const p of s.getTextSlices()){if(!p)continue;const{origin:m}=p.caret,y=m.getTextContentSize(),v=vl(Be(m,r)),_=m.getMode();if(Math.abs(p.distance)===y&&i==="removeEmptySlices"||_==="token"&&p.distance!==0)v.remove();else if(p.distance!==0){i="removeEmptySlices";let w=p.removeTextSlice();const E=p.caret.origin;if(_==="segmented"){const $=w.origin,P=ue($.getTextContent()).setStyle($.getStyle()).setFormat($.getFormat());v.replaceOrInsert(P),w=Wr(P,r,w.offset)}E.is(o[0].origin)&&(o[0]=w),E.is(a[0].origin)&&(a[0]=w.getFlipped())}}let u,f;for(const p of o)if(Mc(p)){u=un(p);break}for(const p of a)if(Mc(p)){f=un(p);break}const d=function(p,m,y){if(!p||!m)return null;const v=p.getParentAtCaret(),_=m.getParentAtCaret();if(!v||!_)return null;const w=v.getParents().reverse();w.push(v);const E=_.getParents().reverse();E.push(_);const $=Math.min(w.length,E.length);let P;for(P=0;P<$&&w[P]===E[P];P++);const R=(j,k)=>{let I;for(let C=P;C<j.length;C++){const D=j[C];if(yn(D))return;!I&&k(D)&&(I=D)}return I},N=R(w,Rt),M=N&&R(E,j=>y.has(j.getKey())&&Rt(j));return N&&M?[N,M]:null}(u,f,l);if(d){const[p,m]=d;Yt(p,"previous").splice(0,m.getChildren()),m.remove()}const g=[u,f,...o,...a].find(Mc);if(g)return Fw(Ri(un(g),n.direction));H(269,JSON.stringify(o.map(p=>p.origin.__key)))}function un(n){const e=function(i){let s=i;for(;Ht(s);){const o=Us(s);if(!Ht(o))break;s=o}return s}(n.getLatest()),{direction:t}=e;if(U(e.origin))return er(e)?e:Wr(e.origin,t,t);const r=e.getAdjacentCaret();return Br(r)&&U(r.origin)?Wr(r.origin,t,Yi(t)):e}function ky(n){return er(n)&&n.offset!==tr(n.origin,n.direction)}function Ri(n,e){return n.direction===e?n:n.getFlipped()}function wy(n,e){return n.direction===e?n:sr(Ri(n.focus,e),Ri(n.anchor,e))}function Ww(n,e,t){let r=Yt(n,"next");for(let i=0;i<e;i++){const s=r.getAdjacentCaret();if(s===null)break;r=s}return Ri(r,t)}const Uw=new Map;function Eh(n){let e=n;for(;e!=null;){if(e.nodeType===Node.TEXT_NODE)return e;e=e.firstChild}return null}function Nh(n){const e=n.parentNode;if(e==null)throw new Error("Should never happen");return[e,Array.from(e.childNodes).indexOf(n)]}function zw(n,e,t,r,i){const s=e.getKey(),o=r.getKey(),a=document.createRange();let l=n.getElementByKey(s),c=n.getElementByKey(o),u=t,f=i;if(U(e)&&(l=Eh(l)),U(r)&&(c=Eh(c)),e===void 0||r===void 0||l===null||c===null)return null;l.nodeName==="BR"&&([l,u]=Nh(l)),c.nodeName==="BR"&&([c,f]=Nh(c));const d=l.firstChild;l===c&&d!=null&&d.nodeName==="BR"&&u===0&&f===0&&(f=1);try{a.setStart(l,u),a.setEnd(c,f)}catch{return null}return!a.collapsed||u===f&&s===o||(a.setStart(c,f),a.setEnd(l,u)),a}function Kw(n,e){const t=n.getRootElement();if(t===null)return[];const r=t.getBoundingClientRect(),i=getComputedStyle(t),s=parseFloat(i.paddingLeft)+parseFloat(i.paddingRight),o=Array.from(e.getClientRects());let a,l=o.length;o.sort((c,u)=>{const f=c.top-u.top;return Math.abs(f)<=3?c.left-u.left:f});for(let c=0;c<l;c++){const u=o[c],f=a&&a.top<=u.top&&a.top+a.height>u.top&&a.left+a.width>u.left,d=u.width+s===r.width;f||d?(o.splice(c--,1),l--):a=u}return o}function Hw(n){const e={};if(!n)return e;const t=n.split(";");for(const r of t)if(r!==""){const[i,s]=r.split(/:([^]+)/);i&&s&&(e[i.trim()]=s.trim())}return e}function xy(n,e){const t=n.getStartEndPoints();if(e.isSelected(n)&&!Tn(e)&&t!==null){const[r,i]=t,s=n.isBackward(),o=r.getNode(),a=i.getNode(),l=e.is(o),c=e.is(a);if(l||c){const[u,f]=au(n),d=o.is(a),g=e.is(s?a:o),p=e.is(s?o:a);let m,y=0;d?(y=u>f?f:u,m=u>f?u:f):g?(y=s?f:u,m=void 0):p&&(y=0,m=s?u:f),e.__text=e.__text.slice(y,m)}}return e}function Jw(n){const e=n.getStyle(),t=Hw(e);Uw.set(e,t)}function Vw(n,e){const t=n.getFormatType(),r=n.getIndent();t!==e.getFormatType()&&e.setFormat(t),r!==e.getIndent()&&e.setIndent(r)}function Gw(n,e,t=Vw){if(n===null)return;const r=n.getStartEndPoints(),i=new Map;let s=null;if(r){const[o,a]=r;s=ro(),s.anchor.set(o.key,o.offset,o.type),s.focus.set(a.key,a.offset,a.type);const l=Ac(o.getNode(),Rt),c=Ac(a.getNode(),Rt);L(l)&&i.set(l.getKey(),l),L(c)&&i.set(c.getKey(),c)}for(const o of n.getNodes())if(L(o)&&Rt(o))i.set(o.getKey(),o);else if(r===null){const a=Ac(o,Rt);L(a)&&i.set(a.getKey(),a)}for(const[o,a]of i){const l=e();t(a,l),a.replace(l,!0),s&&(o===s.anchor.key&&s.anchor.set(l.getKey(),s.anchor.offset,s.anchor.type),o===s.focus.key&&s.focus.set(l.getKey(),s.focus.offset,s.focus.type))}s&&n.is(K())&&rt(s)}function Cy(n){const e=n.anchor.getNode(),t=Qe(e)?e:e.getParentOrThrow(),r=_l().getElementByKey(t.getKey());if(r===null)return!1;const i=r.ownerDocument.defaultView;return i===null?!1:i.getComputedStyle(r).writingMode==="vertical-rl"}function za(n,e){let t=Cy(n)?!e:e;Sy(n)&&(t=!t);const r=In(n.focus,t?"previous":"next");if(ky(r))return!1;for(const i of Fd(r)){if(Ht(i))return!i.origin.isInline();if(!L(i.origin)){if(be(i.origin))return!0;break}}return!1}function Yw(n,e,t,r){n.modify(e?"extend":"move",t,r)}function Sy(n){const e=n.anchor.getNode();return(Qe(e)?e:e.getParentOrThrow()).getDirection()==="rtl"}function Ka(n,e,t){const r=Sy(n);let i;i=Cy(n)||r?!t:t,Yw(n,e,i,"character")}function Ac(n,e){let t=n;for(;t!==null&&t.getParent()!==null&&!e(t);)t=t.getParentOrThrow();return e(t)?t:null}function Xw(n,...e){const t=new URL("https://lexical.dev/docs/error"),r=new URLSearchParams;r.append("code",n);for(const i of e)r.append("v",i);throw t.search=r.toString(),Error(`Minified Lexical error #${n}; visit ${t.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}const oo=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,Zw=oo&&"documentMode"in document?document.documentMode:null,Qw=oo&&/Mac|iPod|iPhone|iPad/.test(navigator.platform),ex=oo&&/^(?!.*Seamonkey)(?=.*Firefox).*/i.test(navigator.userAgent);!(!oo||!("InputEvent"in window)||Zw)&&"getTargetRanges"in new window.InputEvent("input");function Ty(...n){const e=[];for(const t of n)if(t&&typeof t=="string")for(const[r]of t.matchAll(/\S+/g))e.push(r);return e}function He(...n){return()=>{for(let e=n.length-1;e>=0;e--)n[e]();n.length=0}}const tx=oo,bu=Qw,nx=ex;function lt(n,...e){const t=Ty(...e);t.length>0&&n.classList.add(...t)}function Rr(n,...e){const t=Ty(...e);t.length>0&&n.classList.remove(...t)}function qd(n,e){return Array.from(rx(n))}function rx(n,e){return ix("next",n)}function ix(n,e,t){const r=pe(),i=e||r,s=L(i)?Yt(i,n):Be(i,n),o=sx(i),a=function(c,u){const f=Ah(Be(c,u));return f&&f[0]}(i,n);let l=o;return bl({hasNext:c=>c!==null,initial:s,map:c=>({depth:l,node:c.origin}),step:c=>{if(c.isSameNodeCaret(a))return null;Ht(c)&&l++;const u=Ah(c);return!u||u[0].isSameNodeCaret(a)?null:(l+=u[1],u[0])}})}function sx(n){let e=-1;for(let t=n;t!==null;t=t.getParent())e++;return e}function ox(n){const e=Xt(n,t=>L(t)&&!t.isInline());return L(e)||Xw(4,n.__key),e}const Xt=(n,e)=>{let t=n;for(;t!==pe()&&t!=null;){if(e(t))return t;t=t.getParent()}return null};function Ey(n,e,t,r){const i=s=>s instanceof e;return n.registerNodeTransform(e,s=>{const o=(a=>{const l=a.getChildren();for(let f=0;f<l.length;f++){const d=l[f];if(i(d))return null}let c=a,u=a;for(;c!==null;)if(u=c,c=c.getParent(),i(c))return{child:u,parent:c};return null})(s);if(o!==null){const{child:a,parent:l}=o;if(a.is(s)){r(l,s);const c=a.getNextSiblings(),u=c.length;if(l.insertAfter(a),u!==0){const f=t(l);a.insertAfter(f);for(let d=0;d<u;d++)f.append(c[d])}l.canBeEmpty()||l.getChildrenSize()!==0||l.remove()}}})}function On(n,e){return n!==null&&Object.getPrototypeOf(n).constructor.name===e.name}let Oc=!(nx||!tx)&&void 0;function ax(n){let e=1;if(function(){if(Oc===void 0){const t=document.createElement("div");t.style.cssText="position: absolute; opacity: 0; width: 100px; left: -1000px;",document.body.appendChild(t);const r=t.getBoundingClientRect();t.style.setProperty("zoom","2"),Oc=t.getBoundingClientRect().width===r.width,document.body.removeChild(t)}return Oc}())for(;n;)e*=Number(window.getComputedStyle(n).getPropertyValue("zoom")),n=n.parentElement;return e}function Ny(n,e){const t=[],r=Array.from(n).reverse();for(let i=r.pop();i!==void 0;i=r.pop())if(e(i))t.push(i);else if(L(i))for(const s of lx(i))r.push(s);return t}function lx(n){return cx(Yt(n,"previous"))}function cx(n){return bl({hasNext:Br,initial:n.getAdjacentCaret(),map:e=>e.origin.getLatest(),step:e=>e.getAdjacentCaret()})}function Mh(n){vl(Be(n,"next")).splice(1,n.getChildren())}function Ah(n,e="root"){let t=0,r=n,i=Us(r);for(;i===null;){if(t--,i=r.getParentCaret(e),!i)return null;r=i,i=Us(r)}return i&&[i,t]}function ux(n,e){const t=e.body?e.body.childNodes:[];let r=[];const i=[];for(let s=0;s<t.length;s++){const o=t[s];if(!Oy.has(o.nodeName)){const a=$y(o,n,i,!1);a!==null&&(r=r.concat(a))}}return function(s){for(const o of s)o.getNextSibling()instanceof Cd&&o.insertAfter(qr());for(const o of s){const a=o.getChildren();for(const l of a)o.insertBefore(l);o.remove()}}(i),r}function My(n,e){if(typeof document>"u"||typeof window>"u"&&global.window===void 0)throw new Error("To use $generateHtmlFromNodes in headless mode please initialize a headless browser implementation such as JSDom before calling this function.");const t=document.createElement("div"),r=pe().getChildren();for(let i=0;i<r.length;i++)Ay(n,r[i],t,e);return t.innerHTML}function Ay(n,e,t,r=null){let i=r===null||e.isSelected(r);const s=L(e)&&e.excludeFromCopy("html");let o=e;if(r!==null){let g=Rd(e);g=U(g)&&r!==null?xy(r,g):g,o=g}const a=L(o)?o.getChildren():[],l=Ed(n,o.getType());let c;c=l&&l.exportDOM!==void 0?l.exportDOM(n,o):o.exportDOM(n);const{element:u,after:f}=c;if(!u)return!1;const d=document.createDocumentFragment();for(let g=0;g<a.length;g++){const p=a[g],m=Ay(n,p,d,r);!i&&L(e)&&m&&e.extractWithChild(p,r,"html")&&(i=!0)}if(i&&!s){if((Te(u)||gu(u))&&u.append(d),t.append(u),f){const g=f.call(o,u);g&&(gu(u)?u.replaceChildren(g):u.replaceWith(g))}}else t.append(d);return i}const Oy=new Set(["STYLE","SCRIPT"]);function $y(n,e,t,r,i=new Map,s){let o=[];if(Oy.has(n.nodeName))return o;let a=null;const l=function(p,m){const{nodeName:y}=p,v=m._htmlConversions.get(y.toLowerCase());let _=null;if(v!==void 0)for(const w of v){const E=w(p);E!==null&&(_===null||(_.priority||0)<=(E.priority||0))&&(_=E)}return _!==null?_.conversion:null}(n,e),c=l?l(n):null;let u=null;if(c!==null){u=c.after;const p=c.node;if(a=Array.isArray(p)?p[p.length-1]:p,a!==null){for(const[,m]of i)if(a=m(a,s),!a)break;a&&o.push(...Array.isArray(p)?p:[a])}c.forChild!=null&&i.set(n.nodeName,c.forChild)}const f=n.childNodes;let d=[];const g=(a==null||!yn(a))&&(a!=null&&lu(a)||r);for(let p=0;p<f.length;p++)d.push(...$y(f[p],e,t,g,new Map(i),a));return u!=null&&(d=u(d)),Ba(n)&&(d=dx(n,d,g?()=>{const p=new Cd;return t.push(p),p}:Ot)),a==null?d.length>0?o=o.concat(d):Ba(n)&&function(p){return p.nextSibling==null||p.previousSibling==null?!1:pu(p.nextSibling)&&pu(p.previousSibling)}(n)&&(o=o.concat(qr())):L(a)&&a.append(...d),o}function dx(n,e,t){const r=n.style.textAlign,i=[];let s=[];for(let o=0;o<e.length;o++){const a=e[o];if(lu(a))r&&!a.getFormat()&&a.setFormat(r),i.push(a);else if(s.push(a),o===e.length-1||o<e.length-1&&lu(e[o+1])){const l=t();l.setFormat(r),l.append(...s),i.push(l),s=[]}}return i}const fx=new Set(["http:","https:","mailto:","sms:","tel:"]);let Py=class Iy extends ht{static getType(){return"link"}static clone(e){return new Iy(e.__url,{rel:e.__rel,target:e.__target,title:e.__title},e.__key)}constructor(e="",t={},r){super(r);const{target:i=null,rel:s=null,title:o=null}=t;this.__url=e,this.__target=i,this.__rel=s,this.__title=o}createDOM(e){const t=document.createElement("a");return this.updateLinkDOM(null,t,e),lt(t,e.theme.link),t}updateLinkDOM(e,t,r){if(my(t)){e&&e.__url===this.__url||(t.href=this.sanitizeUrl(this.__url));for(const i of["target","rel","title"]){const s=`__${i}`,o=this[s];e&&e[s]===o||(o?t[i]=o:t.removeAttribute(i))}}}updateDOM(e,t,r){return this.updateLinkDOM(e,t,r),!1}static importDOM(){return{a:e=>({conversion:hx,priority:1})}}static importJSON(e){return vu().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setURL(e.url).setRel(e.rel||null).setTarget(e.target||null).setTitle(e.title||null)}sanitizeUrl(e){e=Oh(e);try{const t=new URL(Oh(e));if(!fx.has(t.protocol))return"about:blank"}catch{return e}return e}exportJSON(){return{...super.exportJSON(),rel:this.getRel(),target:this.getTarget(),title:this.getTitle(),url:this.getURL()}}getURL(){return this.getLatest().__url}setURL(e){const t=this.getWritable();return t.__url=e,t}getTarget(){return this.getLatest().__target}setTarget(e){const t=this.getWritable();return t.__target=e,t}getRel(){return this.getLatest().__rel}setRel(e){const t=this.getWritable();return t.__rel=e,t}getTitle(){return this.getLatest().__title}setTitle(e){const t=this.getWritable();return t.__title=e,t}insertNewAfter(e,t=!0){const r=vu(this.__url,{rel:this.__rel,target:this.__target,title:this.__title});return this.insertAfter(r,t),r}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}canBeEmpty(){return!1}isInline(){return!0}extractWithChild(e,t,r){if(!B(t))return!1;const i=t.anchor.getNode(),s=t.focus.getNode();return this.isParentOf(i)&&this.isParentOf(s)&&t.getTextContent().length>0}isEmailURI(){return this.__url.startsWith("mailto:")}isWebSiteURI(){return this.__url.startsWith("https://")||this.__url.startsWith("http://")}};function hx(n){let e=null;if(my(n)){const t=n.textContent;(t!==null&&t!==""||n.children.length>0)&&(e=vu(n.getAttribute("href")||"",{rel:n.getAttribute("rel"),target:n.getAttribute("target"),title:n.getAttribute("title")}))}return{node:e}}function vu(n="",e){return Ne(new Py(n,e))}function gx(n){return n instanceof Py}const px=/^\+?[0-9\s()-]{5,}$/;function Oh(n){return n.match(/^[a-z][a-z0-9+.-]*:/i)||n.match(/^[/#.]/)?n:n.includes("@")?`mailto:${n}`:px.test(n)?`tel:${n}`:`https://${n}`}const Ry=[];let Dy=class Ly extends ht{static getType(){return"mark"}static clone(e){return new Ly(e.__ids,e.__key)}static importDOM(){return null}static importJSON(e){return $h().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setIDs(e.ids)}exportJSON(){return{...super.exportJSON(),ids:this.getIDs()}}constructor(e=Ry,t){super(t),this.__ids=e}createDOM(e){const t=document.createElement("mark");return lt(t,e.theme.mark),this.__ids.length>1&&lt(t,e.theme.markOverlap),t}updateDOM(e,t,r){const i=e.__ids,s=this.__ids,o=i.length,a=s.length,l=r.theme.markOverlap;return o!==a&&(o===1?a===2&&lt(t,l):a===1&&Rr(t,l)),!1}hasID(e){return this.getIDs().includes(e)}getIDs(){return Array.from(this.getLatest().__ids)}setIDs(e){const t=this.getWritable();return t.__ids=e,t}addID(e){const t=this.getWritable();return t.__ids.includes(e)?t:t.setIDs([...t.__ids,e])}deleteID(e){const t=this.getWritable(),r=t.__ids.indexOf(e);if(r===-1)return t;const i=Array.from(t.__ids);return i.splice(r,1),t.setIDs(i)}insertNewAfter(e,t=!0){const r=$h(this.__ids);return this.insertAfter(r,t),r}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}canBeEmpty(){return!1}isInline(){return!0}extractWithChild(e,t,r){if(!B(t)||r==="html")return!1;const i=t.anchor,s=t.focus,o=i.getNode(),a=s.getNode(),l=t.isBackward()?i.offset-s.offset:s.offset-i.offset;return this.isParentOf(o)&&this.isParentOf(a)&&this.getTextContent().length===l}excludeFromCopy(e){return e!=="clone"}};function $h(n=Ry){return Ne(new Dy(n))}function mx(n){return n instanceof Dy}function Ha(n,...e){const t=new URL("https://lexical.dev/docs/error"),r=new URLSearchParams;r.append("code",n);for(const i of e)r.append("v",i);throw t.search=r.toString(),Error(`Minified Lexical error #${n}; visit ${t.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}function jy(n,e=K()){return e==null&&Ha(166),B(e)&&e.isCollapsed()||e.getNodes().length===0?"":My(n,e)}function yx(n,e=K()){return e==null&&Ha(166),B(e)&&e.isCollapsed()||e.getNodes().length===0?null:JSON.stringify(_x(n,e))}function Ph(n,e){const t=n.getData("text/plain")||n.getData("text/uri-list");t!=null&&e.insertRawText(t)}function Ih(n,e,t){const r=n.getData("application/x-lexical-editor");if(r)try{const a=JSON.parse(r);if(a.namespace===t._config.namespace&&Array.isArray(a.nodes))return Rh(t,bx(a.nodes),e)}catch{}const i=n.getData("text/html"),s=n.getData("text/plain");if(i&&s!==i)try{const a=new DOMParser().parseFromString(function(l){return window.trustedTypes&&window.trustedTypes.createPolicy?window.trustedTypes.createPolicy("lexical",{createHTML:c=>c}).createHTML(l):l}(i),"text/html");return Rh(t,ux(t,a),e)}catch{}const o=s||n.getData("text/uri-list");if(o!=null)if(B(e)){const a=o.split(/(\r?\n|\t)/);a[a.length-1]===""&&a.pop();for(let l=0;l<a.length;l++){const c=K();if(B(c)){const u=a[l];u===`
`||u===`\r
`?c.insertParagraph():u==="	"?c.insertNodes([to()]):c.insertText(u)}}}else e.insertRawText(o)}function Rh(n,e,t){n.dispatchCommand(qk,{nodes:e,selection:t})||(t.insertNodes(e),function(r){if(B(r)&&r.isCollapsed()){const i=r.anchor;let s=null;const o=In(i,"previous");if(o)if(er(o))s=o.origin;else{const a=sr(o,Yt(pe(),"next").getFlipped());for(const l of a){if(U(l.origin)){s=l.origin;break}if(L(l.origin)&&!l.origin.isInline())break}}if(s&&U(s)){const a=s.getFormat(),l=s.getStyle();r.format===a&&r.style===l||(r.format=a,r.style=l,r.dirty=!0)}}}(t))}function Fy(n,e,t,r=[]){let i=e===null||t.isSelected(e);const s=L(t)&&t.excludeFromCopy("html");let o=t;if(e!==null){let c=Rd(t);c=U(c)&&e!==null?xy(e,c):c,o=c}const a=L(o)?o.getChildren():[],l=function(c){const u=c.exportJSON(),f=c.constructor;if(u.type!==f.getType()&&Ha(58,f.name),L(c)){const d=u.children;Array.isArray(d)||Ha(59,f.name)}return u}(o);if(U(o)){const c=o.__text;c.length>0?l.text=c:i=!1}for(let c=0;c<a.length;c++){const u=a[c],f=Fy(n,e,u,l.children);!i&&L(t)&&f&&t.extractWithChild(u,e,"clone")&&(i=!0)}if(i&&!s)r.push(l);else if(Array.isArray(l.children))for(let c=0;c<l.children.length;c++){const u=l.children[c];r.push(u)}return i}function _x(n,e){const t=[],r=pe().getChildren();for(let i=0;i<r.length;i++)Fy(n,e,r[i],t);return{namespace:n._config.namespace,nodes:t}}function bx(n){const e=[];for(let t=0;t<n.length;t++){const r=n[t],i=Gm(r);U(i)&&Jw(i),e.push(i)}return e}let pi=null;async function Dh(n,e,t){if(pi!==null)return!1;if(e!==null)return new Promise((c,u)=>{n.update(()=>{c(Lh(n,e,t))})});const r=n.getRootElement(),i=n._window||window,s=window.document,o=Gt(i);if(r===null||o===null)return!1;const a=s.createElement("span");a.style.cssText="position: fixed; top: -1000px;",a.append(s.createTextNode("#")),r.append(a);const l=new Range;return l.setStart(a,0),l.setEnd(a,1),o.removeAllRanges(),o.addRange(l),new Promise((c,u)=>{const f=n.registerCommand(Zr,d=>(On(d,ClipboardEvent)&&(f(),pi!==null&&(window.clearTimeout(pi),pi=null),c(Lh(n,d,t))),!0),Is);pi=window.setTimeout(()=>{f(),pi=null,c(!1)},50),s.execCommand("copy"),a.remove()})}function Lh(n,e,t){if(t===void 0){const i=Gt(n._window);if(!i)return!1;const s=i.anchorNode,o=i.focusNode;if(s!==null&&o!==null&&!io(n,s,o))return!1;const a=K();if(a===null)return!1;t=kx(a)}e.preventDefault();const r=e.clipboardData;return r!==null&&(wx(r,t),!0)}const vx=[["text/html",jy],["application/x-lexical-editor",yx]];function kx(n=K()){const e={"text/plain":n?n.getTextContent():""};if(n){const t=_l();for(const[r,i]of vx){const s=i(t,n);s!==null&&(e[r]=s)}}return e}function wx(n,e){for(const t in e){const r=e[t];r!==void 0&&n.setData(t,r)}}const Bd=/^(\d+(?:\.\d+)?)px$/,wi={BOTH:3,NO_STATUS:0,ROW:1};let Wd=class qy extends ht{static getType(){return"tablecell"}static clone(e){return new qy(e.__headerState,e.__colSpan,e.__width,e.__key)}afterCloneFrom(e){super.afterCloneFrom(e),this.__rowSpan=e.__rowSpan,this.__backgroundColor=e.__backgroundColor,this.__verticalAlign=e.__verticalAlign}static importDOM(){return{td:e=>({conversion:jh,priority:0}),th:e=>({conversion:jh,priority:0})}}static importJSON(e){return By().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setHeaderStyles(e.headerState).setColSpan(e.colSpan||1).setRowSpan(e.rowSpan||1).setWidth(e.width||void 0).setBackgroundColor(e.backgroundColor||null).setVerticalAlign(e.verticalAlign||void 0)}constructor(e=wi.NO_STATUS,t=1,r,i){super(i),this.__colSpan=t,this.__rowSpan=1,this.__headerState=e,this.__width=r,this.__backgroundColor=null,this.__verticalAlign=void 0}createDOM(e){const t=document.createElement(this.getTag());return this.__width&&(t.style.width=`${this.__width}px`),this.__colSpan>1&&(t.colSpan=this.__colSpan),this.__rowSpan>1&&(t.rowSpan=this.__rowSpan),this.__backgroundColor!==null&&(t.style.backgroundColor=this.__backgroundColor),ku(this.__verticalAlign)&&(t.style.verticalAlign=this.__verticalAlign),lt(t,e.theme.tableCell,this.hasHeader()&&e.theme.tableCellHeader),t}exportDOM(e){const t=super.exportDOM(e);if(Te(t.element)){const r=t.element;r.setAttribute("data-temporary-table-cell-lexical-key",this.getKey()),r.style.border="1px solid black",this.__colSpan>1&&(r.colSpan=this.__colSpan),this.__rowSpan>1&&(r.rowSpan=this.__rowSpan),r.style.width=`${this.getWidth()||75}px`,r.style.verticalAlign=this.getVerticalAlign()||"top",r.style.textAlign="start",this.__backgroundColor===null&&this.hasHeader()&&(r.style.backgroundColor="#f2f3f5")}return t}exportJSON(){return{...super.exportJSON(),...ku(this.__verticalAlign)&&{verticalAlign:this.__verticalAlign},backgroundColor:this.getBackgroundColor(),colSpan:this.__colSpan,headerState:this.__headerState,rowSpan:this.__rowSpan,width:this.getWidth()}}getColSpan(){return this.getLatest().__colSpan}setColSpan(e){const t=this.getWritable();return t.__colSpan=e,t}getRowSpan(){return this.getLatest().__rowSpan}setRowSpan(e){const t=this.getWritable();return t.__rowSpan=e,t}getTag(){return this.hasHeader()?"th":"td"}setHeaderStyles(e,t=wi.BOTH){const r=this.getWritable();return r.__headerState=e&t|r.__headerState&~t,r}getHeaderStyles(){return this.getLatest().__headerState}setWidth(e){const t=this.getWritable();return t.__width=e,t}getWidth(){return this.getLatest().__width}getBackgroundColor(){return this.getLatest().__backgroundColor}setBackgroundColor(e){const t=this.getWritable();return t.__backgroundColor=e,t}getVerticalAlign(){return this.getLatest().__verticalAlign}setVerticalAlign(e){const t=this.getWritable();return t.__verticalAlign=e||void 0,t}toggleHeaderStyle(e){const t=this.getWritable();return(t.__headerState&e)===e?t.__headerState-=e:t.__headerState+=e,t}hasHeaderState(e){return(this.getHeaderStyles()&e)===e}hasHeader(){return this.getLatest().__headerState!==wi.NO_STATUS}updateDOM(e){return e.__headerState!==this.__headerState||e.__width!==this.__width||e.__colSpan!==this.__colSpan||e.__rowSpan!==this.__rowSpan||e.__backgroundColor!==this.__backgroundColor||e.__verticalAlign!==this.__verticalAlign}isShadowRoot(){return!0}collapseAtStart(){return!0}canBeEmpty(){return!1}canIndent(){return!1}};function ku(n){return n==="middle"||n==="bottom"}function jh(n){const e=n,t=n.nodeName.toLowerCase();let r;Bd.test(e.style.width)&&(r=parseFloat(e.style.width));const i=By(t==="th"?wi.ROW:wi.NO_STATUS,e.colSpan,r);i.__rowSpan=e.rowSpan;const s=e.style.backgroundColor;s!==""&&(i.__backgroundColor=s);const o=e.style.verticalAlign;ku(o)&&(i.__verticalAlign=o);const a=e.style,l=(a&&a.textDecoration||"").split(" "),c=a.fontWeight==="700"||a.fontWeight==="bold",u=l.includes("line-through"),f=a.fontStyle==="italic",d=l.includes("underline");return{after:g=>{const p=[];let m=null;const y=()=>{if(m){const v=m.getFirstChild();Or(v)&&m.getChildrenSize()===1&&v.remove()}};for(const v of g)xw(v)||U(v)||Or(v)?(U(v)&&(c&&v.toggleFormat("bold"),u&&v.toggleFormat("strikethrough"),f&&v.toggleFormat("italic"),d&&v.toggleFormat("underline")),m?m.append(v):(m=Ot().append(v),p.push(m))):(p.push(v),y(),m=null);return y(),p.length===0&&p.push(Ot()),p},node:i}}function By(n=wi.NO_STATUS,e=1,t){return Ne(new Wd(n,e,t))}function Mt(n){return n instanceof Wd}function qe(n,...e){const t=new URL("https://lexical.dev/docs/error"),r=new URLSearchParams;r.append("code",n);for(const i of e)r.append("v",i);throw t.search=r.toString(),Error(`Minified Lexical error #${n}; visit ${t.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}let Wy=class Uy extends ht{static getType(){return"tablerow"}static clone(e){return new Uy(e.__height,e.__key)}static importDOM(){return{tr:e=>({conversion:xx,priority:0})}}static importJSON(e){return zy().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setHeight(e.height)}constructor(e,t){super(t),this.__height=e}exportJSON(){const e=this.getHeight();return{...super.exportJSON(),...e===void 0?void 0:{height:e}}}createDOM(e){const t=document.createElement("tr");return this.__height&&(t.style.height=`${this.__height}px`),lt(t,e.theme.tableRow),t}extractWithChild(e,t,r){return r==="html"}isShadowRoot(){return!0}setHeight(e){const t=this.getWritable();return t.__height=e,t}getHeight(){return this.getLatest().__height}updateDOM(e){return e.__height!==this.__height}canBeEmpty(){return!1}canIndent(){return!1}};function xx(n){const e=n;let t;return Bd.test(e.style.height)&&(t=parseFloat(e.style.height)),{after:r=>Ny(r,Mt),node:zy(t)}}function zy(n){return Ne(new Wy(n))}function ao(n){return n instanceof Wy}const Ky=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,Cx=Ky&&"documentMode"in document?document.documentMode:null;Ky&&"InputEvent"in window&&!Cx&&new window.InputEvent("input");function Sx(n,e,t){const[r,i,s]=Hy(n,e,t);return i===null&&qe(207),s===null&&qe(208),[r,i,s]}function Hy(n,e,t){const r=[];let i=null,s=null;function o(l){let c=r[l];return c===void 0&&(r[l]=c=[]),c}const a=n.getChildren();for(let l=0;l<a.length;l++){const c=a[l];ao(c)||qe(209);const u=o(l);for(let f=c.getFirstChild(),d=0;f!=null;f=f.getNextSibling()){for(Mt(f)||qe(147);u[d]!==void 0;)d++;const g={cell:f,startColumn:d,startRow:l},{__rowSpan:p,__colSpan:m}=f;for(let y=0;y<p&&!(l+y>=a.length);y++){const v=o(l+y);for(let _=0;_<m;_++)v[d+_]=g}e!==null&&i===null&&e.is(f)&&(i=g),t!==null&&s===null&&t.is(f)&&(s=g)}}return[r,i,s]}function Tx(n){let e;if(n instanceof Wd)e=n;else if("__type"in n){const i=Xt(n,Mt);Mt(i)||qe(148),e=i}else{const i=Xt(n.getNode(),Mt);Mt(i)||qe(148),e=i}const t=e.getParent();ao(t)||qe(149);const r=t.getParent();return Zy(r)||qe(210),[e,t,r]}function Ex(n,e,t){let r,i=Math.min(e.startColumn,t.startColumn),s=Math.min(e.startRow,t.startRow),o=Math.max(e.startColumn+e.cell.__colSpan-1,t.startColumn+t.cell.__colSpan-1),a=Math.max(e.startRow+e.cell.__rowSpan-1,t.startRow+t.cell.__rowSpan-1);do{r=!1;for(let l=0;l<n.length;l++)for(let c=0;c<n[0].length;c++){const u=n[l][c];if(!u)continue;const f=u.startColumn+u.cell.__colSpan-1,d=u.startRow+u.cell.__rowSpan-1,g=u.startColumn<=o&&f>=i,p=u.startRow<=a&&d>=s;if(g&&p){const m=Math.min(i,u.startColumn),y=Math.max(o,f),v=Math.min(s,u.startRow),_=Math.max(a,d);m===i&&y===o&&v===s&&_===a||(i=m,o=y,s=v,a=_,r=!0)}}}while(r);return{maxColumn:o,maxRow:a,minColumn:i,minRow:s}}function Fh(n){const[e,,t]=Tx(n),r=t.getChildren(),i=r.length,s=r[0].getChildren().length,o=new Array(i);for(let a=0;a<i;a++)o[a]=new Array(s);for(let a=0;a<i;a++){const l=r[a].getChildren();let c=0;for(let u=0;u<l.length;u++){for(;o[a][c];)c++;const f=l[u],d=f.__rowSpan||1,g=f.__colSpan||1;for(let p=0;p<d;p++)for(let m=0;m<g;m++)o[a+p][c+m]=f;if(e===f)return{colSpan:g,columnIndex:c,rowIndex:a,rowSpan:d};c+=g}}return null}function qh(n){const[[e,t,r,i],[s,o,a,l]]=["anchor","focus"].map(c=>{const u=n[c].getNode(),f=Xt(u,Mt);Mt(f)||qe(238,c,u.getKey(),u.getType());const d=f.getParent();ao(d)||qe(239,c);const g=d.getParent();return Zy(g)||qe(240,c),[u,f,d,g]});return i.is(l)||qe(241),{anchorCell:t,anchorNode:e,anchorRow:r,anchorTable:i,focusCell:o,focusNode:s,focusRow:a,focusTable:l}}let Nx=class Jy{constructor(e,t,r){this.anchor=t,this.focus=r,t._selection=this,r._selection=this,this._cachedNodes=null,this.dirty=!1,this.tableKey=e}getStartEndPoints(){return[this.anchor,this.focus]}isValid(){return this.tableKey!=="root"&&this.anchor.key!=="root"&&this.anchor.type==="element"&&this.focus.key!=="root"&&this.focus.type==="element"}isBackward(){return this.focus.isBefore(this.anchor)}getCachedNodes(){return this._cachedNodes}setCachedNodes(e){this._cachedNodes=e}is(e){return Vy(e)&&this.tableKey===e.tableKey&&this.anchor.is(e.anchor)&&this.focus.is(e.focus)}set(e,t,r){this.dirty=this.dirty||e!==this.tableKey||t!==this.anchor.key||r!==this.focus.key,this.tableKey=e,this.anchor.key=t,this.focus.key=r,this._cachedNodes=null}clone(){return new Jy(this.tableKey,Ct(this.anchor.key,this.anchor.offset,this.anchor.type),Ct(this.focus.key,this.focus.offset,this.focus.type))}isCollapsed(){return!1}extract(){return this.getNodes()}insertRawText(e){}insertText(){}hasFormat(e){let t=0;this.getNodes().filter(Mt).forEach(i=>{const s=i.getFirstChild();Sd(s)&&(t|=s.getTextFormat())});const r=nr[e];return!!(t&r)}insertNodes(e){const t=this.focus.getNode();L(t)||qe(151),js(t.select(0,t.getChildrenSize())).insertNodes(e)}getShape(){const{anchorCell:e,focusCell:t}=qh(this),r=Fh(e);r===null&&qe(153);const i=Fh(t);i===null&&qe(155);const s=Math.min(r.columnIndex,i.columnIndex),o=Math.max(r.columnIndex+r.colSpan-1,i.columnIndex+i.colSpan-1),a=Math.min(r.rowIndex,i.rowIndex),l=Math.max(r.rowIndex+r.rowSpan-1,i.rowIndex+i.rowSpan-1);return{fromX:Math.min(s,o),fromY:Math.min(a,l),toX:Math.max(s,o),toY:Math.max(a,l)}}getNodes(){if(!this.isValid())return[];const e=this._cachedNodes;if(e!==null)return e;const{anchorTable:t,anchorCell:r,focusCell:i}=qh(this),s=i.getParents()[1];if(s!==t){if(t.isParentOf(i)){const y=s.getParent();y==null&&qe(159),this.set(this.tableKey,i.getKey(),y.getKey())}else{const y=t.getParent();y==null&&qe(158),this.set(this.tableKey,y.getKey(),i.getKey())}return this.getNodes()}const[o,a,l]=Sx(t,r,i),{minColumn:c,maxColumn:u,minRow:f,maxRow:d}=Ex(o,a,l),g=new Map([[t.getKey(),t]]);let p=null;for(let y=f;y<=d;y++)for(let v=c;v<=u;v++){const{cell:_}=o[y][v],w=_.getParent();ao(w)||qe(160),w!==p&&(g.set(w.getKey(),w),p=w),g.has(_.getKey())||Mx(_,E=>{g.set(E.getKey(),E)})}const m=Array.from(g.values());return Vi()||(this._cachedNodes=m),m}getTextContent(){const e=this.getNodes().filter(r=>Mt(r));let t="";for(let r=0;r<e.length;r++){const i=e[r],s=i.__parent,o=(e[r+1]||{}).__parent;t+=i.getTextContent()+(o!==s?`
`:"	")}return t}};function Vy(n){return n instanceof Nx}function Mx(n,e){const t=[[n]];for(let r=t.at(-1);r!==void 0&&t.length>0;r=t.at(-1)){const i=r.pop();i===void 0?t.pop():e(i)!==!1&&L(i)&&t.push(i.getChildren())}}function ws(n){return Te(n)&&n.nodeName==="TABLE"}function Ax(n,e){for(let t=e,r=null;t!==null;t=t.getParent()){if(n.is(t))return r;Mt(t)&&(r=t)}return null}function Ox(n,e,t){return Ax(n,ir(e,t))}function Bh(n,e,t){if(!e.theme.tableAlignment)return;const r=[],i=[];for(const s of["center","right"]){const o=e.theme.tableAlignment[s];o&&(s===t?i:r).push(o)}Rr(n,...r),lt(n,...i)}const $x=new WeakSet;function Wh(n=_l()){return $x.has(n)}let Gy=class Yy extends ht{static getType(){return"table"}getColWidths(){return this.getLatest().__colWidths}setColWidths(e){const t=this.getWritable();return t.__colWidths=e,t}static clone(e){return new Yy(e.__key)}afterCloneFrom(e){super.afterCloneFrom(e),this.__colWidths=e.__colWidths,this.__rowStriping=e.__rowStriping,this.__frozenColumnCount=e.__frozenColumnCount,this.__frozenRowCount=e.__frozenRowCount}static importDOM(){return{table:e=>({conversion:Px,priority:1})}}static importJSON(e){return Xy().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setRowStriping(e.rowStriping||!1).setFrozenColumns(e.frozenColumnCount||0).setFrozenRows(e.frozenRowCount||0).setColWidths(e.colWidths)}constructor(e){super(e),this.__rowStriping=!1,this.__frozenColumnCount=0,this.__frozenRowCount=0}exportJSON(){return{...super.exportJSON(),colWidths:this.getColWidths(),frozenColumnCount:this.__frozenColumnCount?this.__frozenColumnCount:void 0,frozenRowCount:this.__frozenRowCount?this.__frozenRowCount:void 0,rowStriping:this.__rowStriping?this.__rowStriping:void 0}}extractWithChild(e,t,r){return r==="html"}getDOMSlot(e){const t=ws(e)?e:e.querySelector("table");return ws(t)||qe(229),super.getDOMSlot(e).withElement(t).withAfter(t.querySelector("colgroup"))}createDOM(e,t){const r=document.createElement("table");this.__style&&(r.style.cssText=this.__style);const i=document.createElement("colgroup");if(r.appendChild(i),Mw(i),lt(r,e.theme.table),this.updateTableElement(null,r,e),Wh(t)){const s=document.createElement("div"),o=e.theme.tableScrollableWrapper;return o?lt(s,o):s.style.cssText="overflow-x: auto;",s.appendChild(r),this.updateTableWrapper(null,s,r,e),s}return r}updateTableWrapper(e,t,r,i){this.__frozenColumnCount!==(e?e.__frozenColumnCount:0)&&function(s,o,a,l){l>0?(lt(s,a.theme.tableFrozenColumn),o.setAttribute("data-lexical-frozen-column","true")):(Rr(s,a.theme.tableFrozenColumn),o.removeAttribute("data-lexical-frozen-column"))}(t,r,i,this.__frozenColumnCount),this.__frozenRowCount!==(e?e.__frozenRowCount:0)&&function(s,o,a,l){l>0?(lt(s,a.theme.tableFrozenRow),o.setAttribute("data-lexical-frozen-row","true")):(Rr(s,a.theme.tableFrozenRow),o.removeAttribute("data-lexical-frozen-row"))}(t,r,i,this.__frozenRowCount)}updateTableElement(e,t,r){this.__style!==(e?e.__style:"")&&(t.style.cssText=this.__style),this.__rowStriping!==(!!e&&e.__rowStriping)&&function(i,s,o){o?(lt(i,s.theme.tableRowStriping),i.setAttribute("data-lexical-row-striping","true")):(Rr(i,s.theme.tableRowStriping),i.removeAttribute("data-lexical-row-striping"))}(t,r,this.__rowStriping),function(i,s,o,a){const l=i.querySelector("colgroup");if(!l)return;const c=[];for(let u=0;u<o;u++){const f=document.createElement("col"),d=a&&a[u];d&&(f.style.width=`${d}px`),c.push(f)}l.replaceChildren(...c)}(t,0,this.getColumnCount(),this.getColWidths()),Bh(t,r,this.getFormatType())}updateDOM(e,t,r){const i=this.getDOMSlot(t).element;return t===i===Wh()||(Te(s=t)&&s.nodeName==="DIV"&&this.updateTableWrapper(e,t,i,r),this.updateTableElement(e,i,r),!1);var s}exportDOM(e){const t=super.exportDOM(e),{element:r}=t;return{after:i=>{if(t.after&&(i=t.after(i)),!ws(i)&&Te(i)&&(i=i.querySelector("table")),!ws(i))return null;Bh(i,e._config,this.getFormatType());const[s]=Hy(this,null,null),o=new Map;for(const u of s)for(const f of u){const d=f.cell.getKey();o.has(d)||o.set(d,{colSpan:f.cell.getColSpan(),startColumn:f.startColumn})}const a=new Set;for(const u of i.querySelectorAll(":scope > tr > [data-temporary-table-cell-lexical-key]")){const f=u.getAttribute("data-temporary-table-cell-lexical-key");if(f){const d=o.get(f);if(u.removeAttribute("data-temporary-table-cell-lexical-key"),d){o.delete(f);for(let g=0;g<d.colSpan;g++)a.add(g+d.startColumn)}}}const l=i.querySelector(":scope > colgroup");if(l){const u=Array.from(i.querySelectorAll(":scope > colgroup > col")).filter((f,d)=>a.has(d));l.replaceChildren(...u)}const c=i.querySelectorAll(":scope > tr");if(c.length>0){const u=document.createElement("tbody");for(const f of c)u.appendChild(f);i.append(u)}return i},element:!ws(r)&&Te(r)?r.querySelector("table"):r}}canBeEmpty(){return!1}isShadowRoot(){return!0}getCordsFromCellNode(e,t){const{rows:r,domRows:i}=t;for(let s=0;s<r;s++){const o=i[s];if(o!=null)for(let a=0;a<o.length;a++){const l=o[a];if(l==null)continue;const{elem:c}=l,u=Ox(this,c);if(u!==null&&e.is(u))return{x:a,y:s}}}throw new Error("Cell not found in table.")}getDOMCellFromCords(e,t,r){const{domRows:i}=r,s=i[t];if(s==null)return null;const o=s[e<s.length?e:s.length-1];return o??null}getDOMCellFromCordsOrThrow(e,t,r){const i=this.getDOMCellFromCords(e,t,r);if(!i)throw new Error("Cell not found at cords.");return i}getCellNodeFromCords(e,t,r){const i=this.getDOMCellFromCords(e,t,r);if(i==null)return null;const s=ir(i.elem);return Mt(s)?s:null}getCellNodeFromCordsOrThrow(e,t,r){const i=this.getCellNodeFromCords(e,t,r);if(!i)throw new Error("Node at cords not TableCellNode.");return i}getRowStriping(){return!!this.getLatest().__rowStriping}setRowStriping(e){const t=this.getWritable();return t.__rowStriping=e,t}setFrozenColumns(e){const t=this.getWritable();return t.__frozenColumnCount=e,t}getFrozenColumns(){return this.getLatest().__frozenColumnCount}setFrozenRows(e){const t=this.getWritable();return t.__frozenRowCount=e,t}getFrozenRows(){return this.getLatest().__frozenRowCount}canSelectBefore(){return!0}canIndent(){return!1}getColumnCount(){const e=this.getFirstChild();if(!e)return 0;let t=0;return e.getChildren().forEach(r=>{Mt(r)&&(t+=r.getColSpan())}),t}};function Px(n){const e=Xy();n.hasAttribute("data-lexical-row-striping")&&e.setRowStriping(!0),n.hasAttribute("data-lexical-frozen-column")&&e.setFrozenColumns(1),n.hasAttribute("data-lexical-frozen-row")&&e.setFrozenRows(1);const t=n.querySelector(":scope > colgroup");if(t){let r=[];for(const i of t.querySelectorAll(":scope > col")){let s=i.style.width||"";if(!Bd.test(s)&&(s=i.getAttribute("width")||"",!/^\d+$/.test(s))){r=void 0;break}r.push(parseFloat(s))}r&&e.setColWidths(r)}return{after:r=>Ny(r,ao),node:e}}function Xy(){return Ne(new Gy)}function Zy(n){return n instanceof Gy}const Qy=Object.freeze({"	":"\\t","\n":"\\n"}),Uh=new RegExp(Object.keys(Qy).join("|"),"g"),cn=Object.freeze({ancestorHasNextSibling:"|",ancestorIsLastChild:" ",hasNextSibling:"├",isLastChild:"└",selectedChar:"^",selectedLine:">"}),Ix=[n=>n.hasFormat("bold")&&"Bold",n=>n.hasFormat("code")&&"Code",n=>n.hasFormat("italic")&&"Italic",n=>n.hasFormat("strikethrough")&&"Strikethrough",n=>n.hasFormat("subscript")&&"Subscript",n=>n.hasFormat("superscript")&&"Superscript",n=>n.hasFormat("underline")&&"Underline",n=>n.hasFormat("highlight")&&"Highlight"],Rx=[n=>n.hasTextFormat("bold")&&"Bold",n=>n.hasTextFormat("code")&&"Code",n=>n.hasTextFormat("italic")&&"Italic",n=>n.hasTextFormat("strikethrough")&&"Strikethrough",n=>n.hasTextFormat("subscript")&&"Subscript",n=>n.hasTextFormat("superscript")&&"Superscript",n=>n.hasTextFormat("underline")&&"Underline",n=>n.hasTextFormat("highlight")&&"Highlight"],Dx=[n=>n.isDirectionless()&&"Directionless",n=>n.isUnmergeable()&&"Unmergeable"],Lx=[n=>n.isToken()&&"Token",n=>n.isSegmented()&&"Segmented"];function jx(n,e,t,r,i=!1){const s=n.getEditorState(),o=n._config,a=n._compositionKey,l=n._editable;if(t){let d="";return s.read(()=>{d=function(g){const p=document.createElement("div");return p.innerHTML=g.trim(),t_(p,0).innerHTML}(My(n))}),d}let c=` root
`;const u=s.read(()=>{const d=K();return e_(pe(),(g,p)=>{const m=`(${g.getKey()})`,y=g.getType()||"",v=g.isSelected();c+=`${v?cn.selectedLine:" "} ${p.join(" ")} ${m} ${y} ${function(_,w,E=!1){const $=w?w(_,E):void 0;if($!==void 0&&$.length>0)return $;if(U(_)){const P=_.getTextContent(),R=P.length===0?"(empty)":`"${zh(P,E)}"`,N=function(M){return[Kh(M),Fx(M),qx(M),Hh(M)].filter(Boolean).join(", ")}(_);return[R,N.length!==0?`{ ${N} }`:null].filter(Boolean).join(" ").trim()}if(gx(_)){const P=_.getURL(),R=P.length===0?"(empty)":`"${zh(P,E)}"`,N=function(M){return[Bx(M),Wx(M),Ux(M),Hh(M)].filter(Boolean).join(", ")}(_);return[R,N.length!==0?`{ ${N} }`:null].filter(Boolean).join(" ").trim()}if(mx(_))return`ids: [ ${_.getIDs().join(", ")} ]`;if(Sd(_)){const P=function(N){let M=Rx.map(j=>j(N)).filter(Boolean).join(", ").toLocaleLowerCase();return M!==""&&(M="format: "+M),M}(_);let R=P!==""?`{ ${P} }`:"";return R+=_.__style?`(${_.__style})`:"",R}return""}(g,r,i)}
`,c+=function({indent:_,isSelected:w,node:E,nodeKeyDisplay:$,selection:P,typeDisplay:R}){if(!U(E)||!B(P)||!w||L(E))return"";const N=P.anchor,M=P.focus;if(E.getTextContent()===""||N.getNode()===P.focus.getNode()&&N.offset===M.offset)return"";const[j,k]=function(J,V){const G=V.getStartEndPoints();if(pt(V)||G===null)return[-1,-1];const[ee,Z]=G,re=J.getTextContent(),oe=re.length;let X=-1,de=-1;if(ee.type==="text"&&Z.type==="text"){const ce=ee.getNode(),fe=Z.getNode();ce===fe&&J===ce&&ee.offset!==Z.offset?[X,de]=ee.offset<Z.offset?[ee.offset,Z.offset]:[Z.offset,ee.offset]:[X,de]=J===ce?ce.isBefore(fe)?[ee.offset,oe]:[0,ee.offset]:J===fe?fe.isBefore(ce)?[Z.offset,oe]:[0,Z.offset]:[0,oe]}const _e=(re.slice(0,X).match(Uh)||[]).length,se=(re.slice(X,de).match(Uh)||[]).length;return[X+_e,de+_e+se]}(E,P);if(j===k)return"";const I=_[_.length-1]===cn.hasNextSibling?cn.ancestorHasNextSibling:cn.ancestorIsLastChild,C=[..._.slice(0,_.length-1),I],D=Array(j+1).fill(" "),q=Array(k-j).fill(cn.selectedChar),F=R.length+2,z=Array($.length+F).fill(" ");return[cn.selectedLine,C.join(" "),[...z,...D,...q].join("")].join(" ")+`
`}({indent:p,isSelected:v,node:g,nodeKeyDisplay:m,selection:d,typeDisplay:y})}),d===null?": null":B(d)?function(g){let p="";const m=Kh(g);p+=`: range ${m!==""?`{ ${m} }`:""} ${g.style!==""?`{ style: ${g.style} } `:""}`;const y=g.anchor,v=g.focus,_=y.offset,w=v.offset;return p+=`
  ├ anchor { key: ${y.key}, offset: ${_===null?"null":_}, type: ${y.type} }`,p+=`
  └ focus { key: ${v.key}, offset: ${w===null?"null":w}, type: ${v.type} }`,p}(d):Vy(d)?function(g){return`: table
  └ { table: ${g.tableKey}, anchorCell: ${g.anchor.key}, focusCell: ${g.focus.key} }`}(d):function(g){return pt(g)?`: node
  └ [${Array.from(g._nodes).join(", ")}]`:""}(d)});if(c+=`
 selection`+u,c+=`

 commands:`,e.length)for(const{index:d,type:g,payload:p}of e)c+=`
  └ ${d}. { type: ${g}, payload: ${p instanceof Event?p.constructor.name:p} }`;else c+=`
  └ None dispatched.`;const{version:f}=n.constructor;return c+=`

 editor${f?` (v${f})`:""}:`,c+=`
  └ namespace ${o.namespace}`,a!==null&&(c+=`
  └ compositionKey ${a}`),c+=`
  └ editable ${String(l)}`,c}function e_(n,e,t=[]){const r=n.getChildren(),i=r.length;r.forEach((s,o)=>{e(s,t.concat(o===i-1?cn.isLastChild:cn.hasNextSibling)),L(s)&&e_(s,e,t.concat(o===i-1?cn.ancestorIsLastChild:cn.ancestorHasNextSibling))})}function zh(n,e=!1){const t=Object.entries(Qy).reduce((r,[i,s])=>r.replace(new RegExp(i,"g"),String(s)),n);return e?t.replace(/[^\s]/g,"*"):t}function Fx(n){let e=Dx.map(t=>t(n)).filter(Boolean).join(", ").toLocaleLowerCase();return e!==""&&(e="detail: "+e),e}function qx(n){let e=Lx.map(t=>t(n)).filter(Boolean).join(", ").toLocaleLowerCase();return e!==""&&(e="mode: "+e),e}function Kh(n){let e=Ix.map(t=>t(n)).filter(Boolean).join(", ").toLocaleLowerCase();return e!==""&&(e="format: "+e),e}function Bx(n){let e=n.getTarget();return e!=null&&(e="target: "+e),e}function Wx(n){let e=n.getRel();return e!=null&&(e="rel: "+e),e}function Ux(n){let e=n.getTitle();return e!=null&&(e="title: "+e),e}function Hh(n){if(!n.__state)return!1;const e=[];for(const[r,i]of n.__state.knownState.entries()){if(r.isEqual(i,r.defaultValue))continue;const s=JSON.stringify(r.unparse(i));e.push(`[${r.key}: ${s}]`)}let t=e.join(",");return t!==""&&(t="state: "+t),t}function t_(n,e){const t=new Array(1+e++).join("  "),r=new Array(e-1).join("  ");let i;for(let s=0;s<n.children.length;s++)i=document.createTextNode(`
`+t),n.insertBefore(i,n.children[s]),t_(n.children[s],e),n.lastElementChild===n.children[s]&&(i=document.createTextNode(`
`+r),n.appendChild(i));return n}const zx=x.forwardRef(function({treeTypeButtonClassName:n,timeTravelButtonClassName:e,timeTravelPanelSliderClassName:t,timeTravelPanelButtonClassName:r,viewClassName:i,timeTravelPanelClassName:s,editorState:o,setEditorState:a,setEditorReadOnly:l,generateContent:c,commandsLog:u=[]},f){const[d,g]=x.useState([]),[p,m]=x.useState(""),[y,v]=x.useState(!1),[_,w]=x.useState(!1),E=x.useRef(0),$=x.useRef(null),[P,R]=x.useState(!1),[N,M]=x.useState(!1),[j,k]=x.useState(!1),I=x.useRef(),C=x.useRef([]),D=x.useRef(0),q=x.useCallback(z=>{const J=++D.current;c(z).then(V=>{J===D.current&&m(V)}).catch(V=>{J===D.current&&m(`Error rendering tree: ${V.message}

Stack:
${V.stack}`)})},[c]);x.useEffect(()=>{if(!(!j&&o._nodeMap.size>1e3&&(M(!0),!j))&&(I.current!==o||C.current!==u)){const z=I.current!==o;I.current=o,C.current=u,q(_),!y&&z&&g(J=>[...J,[Date.now(),o]])}},[o,q,_,j,y,u]);const F=d.length;return x.useEffect(()=>{if(P){let z;const J=()=>{const V=E.current;if(V===F-1)return void R(!1);const G=d[V][0],ee=d[V+1][0];z=setTimeout(()=>{E.current++;const Z=E.current,re=$.current;re!==null&&(re.value=String(Z)),a(d[Z][1]),J()},ee-G)};return J(),()=>{clearTimeout(z)}}},[d,P,F,a]),S.jsxs("div",{className:i,children:[!j&&N?S.jsxs("div",{style:{padding:20},children:[S.jsx("span",{style:{marginRight:20},children:"Detected large EditorState, this can impact debugging performance."}),S.jsx("button",{onClick:()=>{k(!0)},style:{background:"transparent",border:"1px solid white",color:"white",cursor:"pointer",padding:5},children:"Show full tree"})]}):null,j?null:S.jsx("button",{onClick:()=>(q(!_),void w(!_)),className:n,type:"button",children:_?"Tree":"Export DOM"}),!y&&(j||!N)&&F>2&&S.jsx("button",{onClick:()=>{l(!0),E.current=F-1,v(!0)},className:e,type:"button",children:"Time Travel"}),(j||!N)&&S.jsx("pre",{ref:f,children:p}),y&&(j||!N)&&S.jsxs("div",{className:s,children:[S.jsx("button",{className:r,onClick:()=>{E.current===F-1&&(E.current=1),R(!P)},type:"button",children:P?"Pause":"Play"}),S.jsx("input",{className:t,ref:$,onChange:z=>{const J=Number(z.target.value),V=d[J];V&&(E.current=J,a(V[1]))},type:"range",min:"1",max:F-1}),S.jsx("button",{className:r,onClick:()=>{l(!1);const z=d.length-1,J=d[z];a(J[1]);const V=$.current;V!==null&&(V.value=String(z)),v(!1),R(!1)},type:"button",children:"Exit"})]})]})});function Kx(n,e){const t=new Set;let r=0;for(const[i]of n._commands)t.add(n.registerCommand(i,s=>(e(o=>{r+=1;const a=[...o];return a.push({index:r,payload:s,type:i.type?i.type:"UNKNOWN"}),a.length>10&&a.shift(),a}),!1),Is));return()=>t.forEach(i=>i())}function Hx(n){const[e,t]=x.useState([]);return x.useEffect(()=>Kx(n,t),[n]),x.useMemo(()=>e,[e])}function Jx({treeTypeButtonClassName:n,timeTravelButtonClassName:e,timeTravelPanelSliderClassName:t,timeTravelPanelButtonClassName:r,timeTravelPanelClassName:i,viewClassName:s,editor:o,customPrintNode:a}){const l=x.createRef(),[c,u]=x.useState(o.getEditorState()),f=Hx(o);return x.useEffect(()=>He(o.registerUpdateListener(({editorState:d})=>{u(d)}),o.registerEditableListener(()=>{u(o.getEditorState())})),[o]),x.useEffect(()=>{const d=l.current;if(d!==null)return d.__lexicalEditor=o,()=>{d.__lexicalEditor=null}},[o,l]),S.jsx(zx,{treeTypeButtonClassName:n,timeTravelButtonClassName:e,timeTravelPanelSliderClassName:t,timeTravelPanelButtonClassName:r,viewClassName:s,timeTravelPanelClassName:i,setEditorReadOnly:d=>{const g=o.getRootElement();g!=null&&(g.contentEditable=d?"false":"true")},editorState:c,setEditorState:d=>o.setEditorState(d),generateContent:async function(d){return jx(o,f,d,a)},ref:l,commandsLog:f})}const n_=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,Vx=n_?x.useLayoutEffect:x.useEffect,Wo={tag:$r};function r_({initialConfig:n,children:e}){const t=x.useMemo(()=>{const{theme:r,namespace:i,nodes:s,onError:o,editorState:a,html:l}=n,c=uk(null,r),u=pw({editable:n.editable,html:l,namespace:i,nodes:s,onError:f=>o(f,u),theme:r});return function(f,d){if(d!==null){if(d===void 0)f.update(()=>{const g=pe();if(g.isEmpty()){const p=Ot();g.append(p);const m=n_?document.activeElement:null;(K()!==null||m!==null&&m===f.getRootElement())&&p.select()}},Wo);else if(d!==null)switch(typeof d){case"string":{const g=f.parseEditorState(d);f.setEditorState(g,Wo);break}case"object":f.setEditorState(d,Wo);break;case"function":f.update(()=>{pe().isEmpty()&&d(f)},Wo)}}}(u,a),[u,c]},[]);return Vx(()=>{const r=n.editable,[i]=t;i.setEditable(r===void 0||r)},[]),S.jsx(nm.Provider,{value:t,children:e})}function i_(){return pe().getTextContent()}function s_(n,e=!0){if(n)return!1;let t=i_();return e&&(t=t.trim()),t===""}function Gx(n){if(!s_(n,!1))return!1;const e=pe().getChildren(),t=e.length;if(t>1)return!1;for(let r=0;r<t;r++){const i=e[r];if(be(i))return!1;if(L(i)){if(!Sd(i)||i.__indent!==0)return!1;const s=i.getChildren(),o=s.length;for(let a=0;a<o;a++){const l=s[r];if(!U(l))return!1}}}return!0}function Ud(n){return()=>Gx(n)}const o_=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0?x.useLayoutEffect:x.useEffect;function Yx({editor:n,ariaActiveDescendant:e,ariaAutoComplete:t,ariaControls:r,ariaDescribedBy:i,ariaErrorMessage:s,ariaExpanded:o,ariaInvalid:a,ariaLabel:l,ariaLabelledBy:c,ariaMultiline:u,ariaOwns:f,ariaRequired:d,autoCapitalize:g,className:p,id:m,role:y="textbox",spellCheck:v=!0,style:_,tabIndex:w,"data-testid":E,...$},P){const[R,N]=x.useState(n.isEditable()),M=x.useCallback(k=>{k&&k.ownerDocument&&k.ownerDocument.defaultView?n.setRootElement(k):n.setRootElement(null)},[n]),j=x.useMemo(()=>function(...k){return I=>{k.forEach(C=>{typeof C=="function"?C(I):C!=null&&(C.current=I)})}}(P,M),[M,P]);return o_(()=>(N(n.isEditable()),n.registerEditableListener(k=>{N(k)})),[n]),S.jsx("div",{"aria-activedescendant":R?e:void 0,"aria-autocomplete":R?t:"none","aria-controls":R?r:void 0,"aria-describedby":i,...s!=null?{"aria-errormessage":s}:{},"aria-expanded":R&&y==="combobox"?!!o:void 0,...a!=null?{"aria-invalid":a}:{},"aria-label":l,"aria-labelledby":c,"aria-multiline":u,"aria-owns":R?f:void 0,"aria-readonly":!R||void 0,"aria-required":d,autoCapitalize:g,className:p,contentEditable:R,"data-testid":E,id:m,ref:j,role:y,spellCheck:v,style:_,tabIndex:w,...$})}const Xx=x.forwardRef(Yx);function Jh(n){return n.getEditorState().read(Ud(n.isComposing()))}const a_=x.forwardRef(Zx);function Zx(n,e){const{placeholder:t,...r}=n,[i]=ge();return S.jsxs(S.Fragment,{children:[S.jsx(Xx,{editor:i,...r,ref:e}),t!=null&&S.jsx(Qx,{editor:i,content:t})]})}function Qx({content:n,editor:e}){const t=function(o){const[a,l]=x.useState(()=>Jh(o));return o_(()=>{function c(){const u=Jh(o);l(u)}return c(),He(o.registerUpdateListener(()=>{c()}),o.registerEditableListener(()=>{c()}))},[o]),a}(e),[r,i]=x.useState(e.isEditable());if(x.useLayoutEffect(()=>(i(e.isEditable()),e.registerEditableListener(o=>{i(o)})),[e]),!t)return null;let s=null;return typeof n=="function"?s=n(r):n!==null&&(s=n),s===null?null:S.jsx("div",{"aria-hidden":!0,children:s})}function l_({editorRef:n}){const[e]=ge();return x.useEffect(()=>{typeof n=="function"?n(e):typeof n=="object"&&(n.current=e)},[e]),null}function wu(n,e){return wu=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},wu(n,e)}var Vh={error:null},eC=function(n){var e,t;function r(){for(var s,o=arguments.length,a=new Array(o),l=0;l<o;l++)a[l]=arguments[l];return(s=n.call.apply(n,[this].concat(a))||this).state=Vh,s.resetErrorBoundary=function(){for(var c,u=arguments.length,f=new Array(u),d=0;d<u;d++)f[d]=arguments[d];s.props.onReset==null||(c=s.props).onReset.apply(c,f),s.reset()},s}t=n,(e=r).prototype=Object.create(t.prototype),e.prototype.constructor=e,wu(e,t),r.getDerivedStateFromError=function(s){return{error:s}};var i=r.prototype;return i.reset=function(){this.setState(Vh)},i.componentDidCatch=function(s,o){var a,l;(a=(l=this.props).onError)==null||a.call(l,s,o)},i.componentDidUpdate=function(s,o){var a,l,c,u,f=this.state.error,d=this.props.resetKeys;f!==null&&o.error!==null&&((c=s.resetKeys)===void 0&&(c=[]),(u=d)===void 0&&(u=[]),c.length!==u.length||c.some(function(g,p){return!Object.is(g,u[p])}))&&((a=(l=this.props).onResetKeysChange)==null||a.call(l,s.resetKeys,d),this.reset())},i.render=function(){var s=this.state.error,o=this.props,a=o.fallbackRender,l=o.FallbackComponent,c=o.fallback;if(s!==null){var u={error:s,resetErrorBoundary:this.resetErrorBoundary};if(x.isValidElement(c))return c;if(typeof a=="function")return a(u);if(l)return x.createElement(l,u);throw new Error("react-error-boundary requires either a fallback, fallbackRender, or FallbackComponent prop")}return this.props.children},r}(x.Component);function c_({children:n,onError:e}){return S.jsx(eC,{fallback:S.jsx("div",{style:{border:"1px solid #f00",color:"#f00",padding:"8px"},children:"An error was thrown."}),onError:e,children:n})}const Uo=0,xu=1,Cu=2,Ut=0,tC=1,Gh=2,nC=3,rC=4;function iC(n,e,t,r,i){if(n===null||t.size===0&&r.size===0&&!i)return Ut;const s=e._selection,o=n._selection;if(i)return tC;if(!(B(s)&&B(o)&&o.isCollapsed()&&s.isCollapsed()))return Ut;const a=function(v,_,w){const E=v._nodeMap,$=[];for(const P of _){const R=E.get(P);R!==void 0&&$.push(R)}for(const[P,R]of w){if(!R)continue;const N=E.get(P);N===void 0||Qe(N)||$.push(N)}return $}(e,t,r);if(a.length===0)return Ut;if(a.length>1){const v=e._nodeMap,_=v.get(s.anchor.key),w=v.get(o.anchor.key);return _&&w&&!n._nodeMap.has(_.__key)&&U(_)&&_.__text.length===1&&s.anchor.offset===1?Gh:Ut}const l=a[0],c=n._nodeMap.get(l.__key);if(!U(c)||!U(l)||c.__mode!==l.__mode)return Ut;const u=c.__text,f=l.__text;if(u===f)return Ut;const d=s.anchor,g=o.anchor;if(d.key!==g.key||d.type!=="text")return Ut;const p=d.offset,m=g.offset,y=f.length-u.length;return y===1&&m===p-1?Gh:y===-1&&m===p+1?nC:y===-1&&m===p?rC:Ut}function sC(n,e){let t=Date.now(),r=Ut;return(i,s,o,a,l,c)=>{const u=Date.now();if(c.has(cu))return r=Ut,t=u,Cu;const f=iC(i,s,a,l,n.isComposing()),d=(()=>{const g=o===null||o.editor===n,p=c.has(uw);if(!p&&g&&c.has($r))return Uo;if(i===null)return xu;const m=s._selection;return a.size>0||l.size>0?p===!1&&f!==Ut&&f===r&&u<t+e&&g||a.size===1&&function(y,v,_){const w=v._nodeMap.get(y),E=_._nodeMap.get(y),$=v._selection,P=_._selection;return!(B($)&&B(P)&&$.anchor.type==="element"&&$.focus.type==="element"&&P.anchor.type==="text"&&P.focus.type==="text"||!U(w)||!U(E)||w.__parent!==E.__parent)&&JSON.stringify(v.read(()=>w.exportJSON()))===JSON.stringify(_.read(()=>E.exportJSON()))}(Array.from(a)[0],i,s)?Uo:xu:m!==null?Uo:Cu})();return t=u,r=f,d}}function Yh(n){n.undoStack=[],n.redoStack=[],n.current=null}function oC(n,e,t){const r=sC(n,t);return He(n.registerCommand(ll,()=>(function(s,o){const a=o.redoStack,l=o.undoStack;if(l.length!==0){const c=o.current,u=l.pop();c!==null&&(a.push(c),s.dispatchCommand(Ss,!0)),l.length===0&&s.dispatchCommand(Ts,!1),o.current=u||null,u&&u.editor.setEditorState(u.editorState,{tag:cu})}}(n,e),!0),ne),n.registerCommand(cl,()=>(function(s,o){const a=o.redoStack,l=o.undoStack;if(a.length!==0){const c=o.current;c!==null&&(l.push(c),s.dispatchCommand(Ts,!0));const u=a.pop();a.length===0&&s.dispatchCommand(Ss,!1),o.current=u||null,u&&u.editor.setEditorState(u.editorState,{tag:cu})}}(n,e),!0),ne),n.registerCommand(yd,()=>(Yh(e),!1),ne),n.registerCommand(Cm,()=>(Yh(e),n.dispatchCommand(Ss,!1),n.dispatchCommand(Ts,!1),!0),ne),n.registerUpdateListener(({editorState:s,prevEditorState:o,dirtyLeaves:a,dirtyElements:l,tags:c})=>{const u=e.current,f=e.redoStack,d=e.undoStack,g=u===null?null:u.editorState;if(u!==null&&s===g)return;const p=r(o,s,u,a,l,c);if(p===xu)f.length!==0&&(e.redoStack=[],n.dispatchCommand(Ss,!1)),u!==null&&(d.push({...u}),n.dispatchCommand(Ts,!0));else if(p===Cu)return;e.current={editor:n,editorState:s}}))}function aC(){return{current:null,redoStack:[],undoStack:[]}}function u_({delay:n,externalHistoryState:e}){const[t]=ge();return function(r,i,s=1e3){const o=x.useMemo(()=>i||aC(),[i]);x.useEffect(()=>oC(r,o,s),[s,r,o])}(t,e,n),null}const lC=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0?x.useLayoutEffect:x.useEffect;function cC(n){return{initialValueFn:()=>n.isEditable(),subscribe:e=>n.registerEditableListener(e)}}function d_(){return function(n){const[e]=ge(),t=x.useMemo(()=>n(e),[e,n]),[r,i]=x.useState(()=>t.initialValueFn()),s=x.useRef(r);return lC(()=>{const{initialValueFn:o,subscribe:a}=t,l=o();return s.current!==l&&(s.current=l,i(l)),a(c=>{s.current=c,i(c)})},[t,n]),r}(cC)}function f_(n){const e=window.location.origin,t=r=>{if(r.origin!==e)return;const i=n.getRootElement();if(document.activeElement!==i)return;const s=r.data;if(typeof s=="string"){let o;try{o=JSON.parse(s)}catch{return}if(o&&o.protocol==="nuanria_messaging"&&o.type==="request"){const a=o.payload;if(a&&a.functionId==="makeChanges"){const l=a.args;if(l){const[c,u,f,d,g,p]=l;n.update(()=>{const m=K();if(B(m)){const y=m.anchor;let v=y.getNode(),_=0,w=0;if(U(v)&&c>=0&&u>=0&&(_=c,w=c+u,m.setTextNodeRange(v,_,v,w)),_===w&&f===""||(m.insertRawText(f),v=y.getNode()),U(v)){_=d,w=d+g;const E=v.getTextContentSize();_=_>E?E:_,w=w>E?E:w,m.setTextNodeRange(v,_,v,w)}r.stopImmediatePropagation()}})}}}}};return window.addEventListener("message",t,!0),()=>{window.removeEventListener("message",t,!0)}}function Xh(n,e){if(document.caretRangeFromPoint!==void 0){const t=document.caretRangeFromPoint(n,e);return t===null?null:{node:t.startContainer,offset:t.startOffset}}if(document.caretPositionFromPoint!=="undefined"){const t=document.caretPositionFromPoint(n,e);return t===null?null:{node:t.offsetNode,offset:t.offset}}return null}const Xi=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,uC=Xi&&"documentMode"in document?document.documentMode:null,dC=!(!Xi||!("InputEvent"in window)||uC)&&"getTargetRanges"in new window.InputEvent("input"),fC=Xi&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent),Zh=Xi&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,hC=Xi&&/^(?=.*Chrome).*/i.test(navigator.userAgent),gC=Xi&&/AppleWebKit\/[\d.]+/.test(navigator.userAgent)&&!hC,Qh=ie("DRAG_DROP_PASTE_FILE");function zo(n){let e=null;if(On(n,DragEvent)?e=n.dataTransfer:On(n,ClipboardEvent)&&(e=n.clipboardData),e===null)return[!1,[],!1];const t=e.types,r=t.includes("Files"),i=t.includes("text/html")||t.includes("text/plain");return[r,Array.from(e.files),i]}function eg(n){const e=K();if(!B(e))return!1;const t=new Set,r=e.getNodes();for(let i=0;i<r.length;i++){const s=r[i],o=s.getKey();if(t.has(o))continue;const a=Xt(s,c=>L(c)&&!c.isInline());if(a===null)continue;const l=a.getKey();a.canIndent()&&!t.has(l)&&(t.add(l),n(a))}return t.size>0}function tg(n){const e=ir(n);return be(e)}function $c(n){for(const e of["lowercase","uppercase","capitalize"])n.hasFormat(e)&&n.toggleFormat(e)}function pC(n){return He(n.registerCommand(km,e=>{const t=K();return!!pt(t)&&(t.clear(),!0)},ne),n.registerCommand(dn,e=>{const t=K();return B(t)?(t.deleteCharacter(e),!0):!!pt(t)&&(t.deleteNodes(),!0)},ne),n.registerCommand(Ai,e=>{const t=K();return!!B(t)&&(t.deleteWord(e),!0)},ne),n.registerCommand(Oi,e=>{const t=K();return!!B(t)&&(t.deleteLine(e),!0)},ne),n.registerCommand(Ar,e=>{const t=K();if(typeof e=="string")t!==null&&t.insertText(e);else{if(t===null)return!1;const r=e.dataTransfer;if(r!=null)Ih(r,t,n);else if(B(t)){const i=e.data;return i&&t.insertText(i),!0}}return!0},ne),n.registerCommand(Ia,()=>{const e=K();return!!B(e)&&(e.removeText(),!0)},ne),n.registerCommand(Gn,e=>{const t=K();return!!B(t)&&(t.formatText(e),!0)},ne),n.registerCommand(Kk,e=>{const t=K();if(!B(t)&&!pt(t))return!1;const r=t.getNodes();for(const i of r){const s=Xt(i,o=>L(o)&&!o.isInline());s!==null&&s.setFormat(e)}return!0},ne),n.registerCommand(Qn,e=>{const t=K();return!!B(t)&&(t.insertLineBreak(e),!0)},ne),n.registerCommand(Ws,()=>{const e=K();return!!B(e)&&(e.insertParagraph(),!0)},ne),n.registerCommand(Uk,()=>(ow([to()]),!0),ne),n.registerCommand(zk,()=>eg(e=>{const t=e.getIndent();e.setIndent(t+1)}),ne),n.registerCommand(zf,()=>eg(e=>{const t=e.getIndent();t>0&&e.setIndent(Math.max(0,t-1))}),ne),n.registerCommand(dd,e=>{const t=K();if(pt(t)){const r=t.getNodes();if(r.length>0)return r[0].selectPrevious(),!0}else if(B(t)){const r=du(t.focus,!0);if(!e.shiftKey&&be(r)&&!r.isIsolated()&&!r.isInline())return r.selectPrevious(),e.preventDefault(),!0}return!1},ne),n.registerCommand(fd,e=>{const t=K();if(pt(t)){const r=t.getNodes();if(r.length>0)return r[0].selectNext(0,0),!0}else if(B(t)){if(function(i){const s=i.focus;return s.key==="root"&&s.offset===pe().getChildrenSize()}(t))return e.preventDefault(),!0;const r=du(t.focus,!1);if(!e.shiftKey&&be(r)&&!r.isIsolated()&&!r.isInline())return r.selectNext(),e.preventDefault(),!0}return!1},ne),n.registerCommand(ud,e=>{const t=K();if(pt(t)){const r=t.getNodes();if(r.length>0)return e.preventDefault(),r[0].selectPrevious(),!0}if(!B(t))return!1;if(za(t,!0)){const r=e.shiftKey;return e.preventDefault(),Ka(t,r,!0),!0}return!1},ne),n.registerCommand(cd,e=>{const t=K();if(pt(t)){const i=t.getNodes();if(i.length>0)return e.preventDefault(),i[0].selectNext(0,0),!0}if(!B(t))return!1;const r=e.shiftKey;return!!za(t,!1)&&(e.preventDefault(),Ka(t,r,!1),!0)},ne),n.registerCommand(hd,e=>{if(tg(e.target))return!1;const t=K();if(B(t)){if(function(r){if(!r.isCollapsed())return!1;const{anchor:i}=r;if(i.offset!==0)return!1;const s=i.getNode();if(Qe(s))return!1;const o=ox(s);return o.getIndent()>0&&(o.is(s)||s.is(o.getFirstDescendant()))}(t))return e.preventDefault(),n.dispatchCommand(zf,void 0);if(Zh&&navigator.language==="ko-KR")return!1}else if(!pt(t))return!1;return e.preventDefault(),n.dispatchCommand(dn,!0)},ne),n.registerCommand(gd,e=>{if(tg(e.target))return!1;const t=K();return!(!B(t)&&!pt(t))&&(e.preventDefault(),n.dispatchCommand(dn,!1))},ne),n.registerCommand($i,e=>{const t=K();if(!B(t))return!1;if($c(t),e!==null){if((Zh||fC||gC)&&dC)return!1;if(e.preventDefault(),e.shiftKey)return n.dispatchCommand(Qn,!1)}return n.dispatchCommand(Ws,void 0)},ne),n.registerCommand(ul,()=>{const e=K();return!!B(e)&&(n.blur(),!0)},ne),n.registerCommand(dl,e=>{const[,t]=zo(e);if(t.length>0){const i=Xh(e.clientX,e.clientY);if(i!==null){const{offset:s,node:o}=i,a=ir(o);if(a!==null){const l=ro();if(U(a))l.anchor.set(a.getKey(),s,"text"),l.focus.set(a.getKey(),s,"text");else{const u=a.getParentOrThrow().getKey(),f=a.getIndexWithinParent()+1;l.anchor.set(u,f,"element"),l.focus.set(u,f,"element")}const c=js(l);rt(c)}n.dispatchCommand(Qh,t)}return e.preventDefault(),!0}const r=K();return!!B(r)},ne),n.registerCommand(md,e=>{const[t]=zo(e),r=K();return!(t&&!B(r))},ne),n.registerCommand(xm,e=>{const[t]=zo(e),r=K();if(t&&!B(r))return!1;const i=Xh(e.clientX,e.clientY);if(i!==null){const s=ir(i.node);be(s)&&e.preventDefault()}return!0},ne),n.registerCommand(Ra,()=>(fy(),!0),ne),n.registerCommand(Zr,e=>(Dh(n,On(e,ClipboardEvent)?e:null),!0),ne),n.registerCommand(Ki,e=>(async function(t,r){await Dh(r,On(t,ClipboardEvent)?t:null),r.update(()=>{const i=K();B(i)?i.removeText():pt(i)&&i.getNodes().forEach(s=>s.remove())})}(e,n),!0),ne),n.registerCommand(Xr,e=>{const[,t,r]=zo(e);return t.length>0&&!r?(n.dispatchCommand(Qh,t),!0):ti(e.target)&&Nd(e.target)?!1:K()!==null&&(function(i,s){i.preventDefault(),s.update(()=>{const o=K(),a=On(i,InputEvent)||On(i,KeyboardEvent)?null:i.clipboardData;a!=null&&o!==null&&Ih(a,o,s)},{tag:ty})}(e,n),!0)},ne),n.registerCommand(wm,e=>{const t=K();return B(t)&&$c(t),!1},ne),n.registerCommand(pd,e=>{const t=K();return B(t)&&$c(t),!1},ne))}const Su=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0?x.useLayoutEffect:x.useEffect;function ng(n){return n.getEditorState().read(Ud(n.isComposing()))}function mC({contentEditable:n,placeholder:e=null,ErrorBoundary:t}){const[r]=ge(),i=function(s,o){const[a,l]=x.useState(()=>s.getDecorators());return Su(()=>s.registerDecoratorListener(c=>{Nt.flushSync(()=>{l(c)})}),[s]),x.useEffect(()=>{l(s.getDecorators())},[s]),x.useMemo(()=>{const c=[],u=Object.keys(a);for(let f=0;f<u.length;f++){const d=u[f],g=S.jsx(o,{onError:m=>s._onError(m),children:S.jsx(x.Suspense,{fallback:null,children:a[d]})}),p=s.getElementByKey(d);p!==null&&c.push(Nt.createPortal(g,p,d))}return c},[o,a,s])}(r,t);return function(s){Su(()=>He(pC(s),f_(s)),[s])}(r),S.jsxs(S.Fragment,{children:[n,S.jsx(yC,{content:e}),i]})}function yC({content:n}){const[e]=ge(),t=function(i){const[s,o]=x.useState(()=>ng(i));return Su(()=>{function a(){const l=ng(i);o(l)}return a(),He(i.registerUpdateListener(()=>{a()}),i.registerEditableListener(()=>{a()}))},[i]),s}(e),r=d_();return t?typeof n=="function"?n(r):n:null}var Ko={exports:{}},Pc,rg;function _C(){if(rg)return Pc;rg=1;var n=-1,e=1,t=0;function r(k,I,C,D,q){if(k===I)return k?[[t,k]]:[];if(C!=null){var F=M(k,I,C);if(F)return F}var z=a(k,I),J=k.substring(0,z);k=k.substring(z),I=I.substring(z),z=c(k,I);var V=k.substring(k.length-z);k=k.substring(0,k.length-z),I=I.substring(0,I.length-z);var G=i(k,I);return J&&G.unshift([t,J]),V&&G.push([t,V]),_(G,q),D&&f(G),G}function i(k,I){var C;if(!k)return[[e,I]];if(!I)return[[n,k]];var D=k.length>I.length?k:I,q=k.length>I.length?I:k,F=D.indexOf(q);if(F!==-1)return C=[[e,D.substring(0,F)],[t,q],[e,D.substring(F+q.length)]],k.length>I.length&&(C[0][0]=C[2][0]=n),C;if(q.length===1)return[[n,k],[e,I]];var z=u(k,I);if(z){var J=z[0],V=z[1],G=z[2],ee=z[3],Z=z[4],re=r(J,G),oe=r(V,ee);return re.concat([[t,Z]],oe)}return s(k,I)}function s(k,I){for(var C=k.length,D=I.length,q=Math.ceil((C+D)/2),F=q,z=2*q,J=new Array(z),V=new Array(z),G=0;G<z;G++)J[G]=-1,V[G]=-1;J[F+1]=0,V[F+1]=0;for(var ee=C-D,Z=ee%2!==0,re=0,oe=0,X=0,de=0,_e=0;_e<q;_e++){for(var se=-_e+re;se<=_e-oe;se+=2){var ce=F+se,fe;se===-_e||se!==_e&&J[ce-1]<J[ce+1]?fe=J[ce+1]:fe=J[ce-1]+1;for(var ve=fe-se;fe<C&&ve<D&&k.charAt(fe)===I.charAt(ve);)fe++,ve++;if(J[ce]=fe,fe>C)oe+=2;else if(ve>D)re+=2;else if(Z){var xe=F+ee-se;if(xe>=0&&xe<z&&V[xe]!==-1){var Se=C-V[xe];if(fe>=Se)return o(k,I,fe,ve)}}}for(var Re=-_e+X;Re<=_e-de;Re+=2){var xe=F+Re,Se;Re===-_e||Re!==_e&&V[xe-1]<V[xe+1]?Se=V[xe+1]:Se=V[xe-1]+1;for(var it=Se-Re;Se<C&&it<D&&k.charAt(C-Se-1)===I.charAt(D-it-1);)Se++,it++;if(V[xe]=Se,Se>C)de+=2;else if(it>D)X+=2;else if(!Z){var ce=F+ee-Re;if(ce>=0&&ce<z&&J[ce]!==-1){var fe=J[ce],ve=F+fe-ce;if(Se=C-Se,fe>=Se)return o(k,I,fe,ve)}}}}return[[n,k],[e,I]]}function o(k,I,C,D){var q=k.substring(0,C),F=I.substring(0,D),z=k.substring(C),J=I.substring(D),V=r(q,F),G=r(z,J);return V.concat(G)}function a(k,I){if(!k||!I||k.charAt(0)!==I.charAt(0))return 0;for(var C=0,D=Math.min(k.length,I.length),q=D,F=0;C<q;)k.substring(F,q)==I.substring(F,q)?(C=q,F=C):D=q,q=Math.floor((D-C)/2+C);return w(k.charCodeAt(q-1))&&q--,q}function l(k,I){var C=k.length,D=I.length;if(C==0||D==0)return 0;C>D?k=k.substring(C-D):C<D&&(I=I.substring(0,C));var q=Math.min(C,D);if(k==I)return q;for(var F=0,z=1;;){var J=k.substring(q-z),V=I.indexOf(J);if(V==-1)return F;z+=V,(V==0||k.substring(q-z)==I.substring(0,z))&&(F=z,z++)}}function c(k,I){if(!k||!I||k.slice(-1)!==I.slice(-1))return 0;for(var C=0,D=Math.min(k.length,I.length),q=D,F=0;C<q;)k.substring(k.length-q,k.length-F)==I.substring(I.length-q,I.length-F)?(C=q,F=C):D=q,q=Math.floor((D-C)/2+C);return E(k.charCodeAt(k.length-q))&&q--,q}function u(k,I){var C=k.length>I.length?k:I,D=k.length>I.length?I:k;if(C.length<4||D.length*2<C.length)return null;function q(oe,X,de){for(var _e=oe.substring(de,de+Math.floor(oe.length/4)),se=-1,ce="",fe,ve,xe,Se;(se=X.indexOf(_e,se+1))!==-1;){var Re=a(oe.substring(de),X.substring(se)),it=c(oe.substring(0,de),X.substring(0,se));ce.length<it+Re&&(ce=X.substring(se-it,se)+X.substring(se,se+Re),fe=oe.substring(0,de-it),ve=oe.substring(de+Re),xe=X.substring(0,se-it),Se=X.substring(se+Re))}return ce.length*2>=oe.length?[fe,ve,xe,Se,ce]:null}var F=q(C,D,Math.ceil(C.length/4)),z=q(C,D,Math.ceil(C.length/2)),J;if(!F&&!z)return null;z?F?J=F[4].length>z[4].length?F:z:J=z:J=F;var V,G,ee,Z;k.length>I.length?(V=J[0],G=J[1],ee=J[2],Z=J[3]):(ee=J[0],Z=J[1],V=J[2],G=J[3]);var re=J[4];return[V,G,ee,Z,re]}function f(k){for(var I=!1,C=[],D=0,q=null,F=0,z=0,J=0,V=0,G=0;F<k.length;)k[F][0]==t?(C[D++]=F,z=V,J=G,V=0,G=0,q=k[F][1]):(k[F][0]==e?V+=k[F][1].length:G+=k[F][1].length,q&&q.length<=Math.max(z,J)&&q.length<=Math.max(V,G)&&(k.splice(C[D-1],0,[n,q]),k[C[D-1]+1][0]=e,D--,D--,F=D>0?C[D-1]:-1,z=0,J=0,V=0,G=0,q=null,I=!0)),F++;for(I&&_(k),v(k),F=1;F<k.length;){if(k[F-1][0]==n&&k[F][0]==e){var ee=k[F-1][1],Z=k[F][1],re=l(ee,Z),oe=l(Z,ee);re>=oe?(re>=ee.length/2||re>=Z.length/2)&&(k.splice(F,0,[t,Z.substring(0,re)]),k[F-1][1]=ee.substring(0,ee.length-re),k[F+1][1]=Z.substring(re),F++):(oe>=ee.length/2||oe>=Z.length/2)&&(k.splice(F,0,[t,ee.substring(0,oe)]),k[F-1][0]=e,k[F-1][1]=Z.substring(0,Z.length-oe),k[F+1][0]=n,k[F+1][1]=ee.substring(oe),F++),F++}F++}}var d=/[^a-zA-Z0-9]/,g=/\s/,p=/[\r\n]/,m=/\n\r?\n$/,y=/^\r?\n\r?\n/;function v(k){function I(oe,X){if(!oe||!X)return 6;var de=oe.charAt(oe.length-1),_e=X.charAt(0),se=de.match(d),ce=_e.match(d),fe=se&&de.match(g),ve=ce&&_e.match(g),xe=fe&&de.match(p),Se=ve&&_e.match(p),Re=xe&&oe.match(m),it=Se&&X.match(y);return Re||it?5:xe||Se?4:se&&!fe&&ve?3:fe||ve?2:se||ce?1:0}for(var C=1;C<k.length-1;){if(k[C-1][0]==t&&k[C+1][0]==t){var D=k[C-1][1],q=k[C][1],F=k[C+1][1],z=c(D,q);if(z){var J=q.substring(q.length-z);D=D.substring(0,D.length-z),q=J+q.substring(0,q.length-z),F=J+F}for(var V=D,G=q,ee=F,Z=I(D,q)+I(q,F);q.charAt(0)===F.charAt(0);){D+=q.charAt(0),q=q.substring(1)+F.charAt(0),F=F.substring(1);var re=I(D,q)+I(q,F);re>=Z&&(Z=re,V=D,G=q,ee=F)}k[C-1][1]!=V&&(V?k[C-1][1]=V:(k.splice(C-1,1),C--),k[C][1]=G,ee?k[C+1][1]=ee:(k.splice(C+1,1),C--))}C++}}function _(k,I){k.push([t,""]);for(var C=0,D=0,q=0,F="",z="",J;C<k.length;){if(C<k.length-1&&!k[C][1]){k.splice(C,1);continue}switch(k[C][0]){case e:q++,z+=k[C][1],C++;break;case n:D++,F+=k[C][1],C++;break;case t:var V=C-q-D-1;if(I){if(V>=0&&P(k[V][1])){var G=k[V][1].slice(-1);if(k[V][1]=k[V][1].slice(0,-1),F=G+F,z=G+z,!k[V][1]){k.splice(V,1),C--;var ee=V-1;k[ee]&&k[ee][0]===e&&(q++,z=k[ee][1]+z,ee--),k[ee]&&k[ee][0]===n&&(D++,F=k[ee][1]+F,ee--),V=ee}}if($(k[C][1])){var G=k[C][1].charAt(0);k[C][1]=k[C][1].slice(1),F+=G,z+=G}}if(C<k.length-1&&!k[C][1]){k.splice(C,1);break}if(F.length>0||z.length>0){F.length>0&&z.length>0&&(J=a(z,F),J!==0&&(V>=0?k[V][1]+=z.substring(0,J):(k.splice(0,0,[t,z.substring(0,J)]),C++),z=z.substring(J),F=F.substring(J)),J=c(z,F),J!==0&&(k[C][1]=z.substring(z.length-J)+k[C][1],z=z.substring(0,z.length-J),F=F.substring(0,F.length-J)));var Z=q+D;F.length===0&&z.length===0?(k.splice(C-Z,Z),C=C-Z):F.length===0?(k.splice(C-Z,Z,[e,z]),C=C-Z+1):z.length===0?(k.splice(C-Z,Z,[n,F]),C=C-Z+1):(k.splice(C-Z,Z,[n,F],[e,z]),C=C-Z+2)}C!==0&&k[C-1][0]===t?(k[C-1][1]+=k[C][1],k.splice(C,1)):C++,q=0,D=0,F="",z="";break}}k[k.length-1][1]===""&&k.pop();var re=!1;for(C=1;C<k.length-1;)k[C-1][0]===t&&k[C+1][0]===t&&(k[C][1].substring(k[C][1].length-k[C-1][1].length)===k[C-1][1]?(k[C][1]=k[C-1][1]+k[C][1].substring(0,k[C][1].length-k[C-1][1].length),k[C+1][1]=k[C-1][1]+k[C+1][1],k.splice(C-1,1),re=!0):k[C][1].substring(0,k[C+1][1].length)==k[C+1][1]&&(k[C-1][1]+=k[C+1][1],k[C][1]=k[C][1].substring(k[C+1][1].length)+k[C+1][1],k.splice(C+1,1),re=!0)),C++;re&&_(k,I)}function w(k){return k>=55296&&k<=56319}function E(k){return k>=56320&&k<=57343}function $(k){return E(k.charCodeAt(0))}function P(k){return w(k.charCodeAt(k.length-1))}function R(k){for(var I=[],C=0;C<k.length;C++)k[C][1].length>0&&I.push(k[C]);return I}function N(k,I,C,D){return P(k)||$(D)?null:R([[t,k],[n,I],[e,C],[t,D]])}function M(k,I,C){var D=typeof C=="number"?{index:C,length:0}:C.oldRange,q=typeof C=="number"?null:C.newRange,F=k.length,z=I.length;if(D.length===0&&(q===null||q.length===0)){var J=D.index,V=k.slice(0,J),G=k.slice(J),ee=q?q.index:null;e:{var Z=J+z-F;if(ee!==null&&ee!==Z||Z<0||Z>z)break e;var re=I.slice(0,Z),oe=I.slice(Z);if(oe!==G)break e;var X=Math.min(J,Z),de=V.slice(0,X),_e=re.slice(0,X);if(de!==_e)break e;var se=V.slice(X),ce=re.slice(X);return N(de,se,ce,G)}e:{if(ee!==null&&ee!==J)break e;var fe=J,re=I.slice(0,fe),oe=I.slice(fe);if(re!==V)break e;var ve=Math.min(F-fe,z-fe),xe=G.slice(G.length-ve),Se=oe.slice(oe.length-ve);if(xe!==Se)break e;var se=G.slice(0,G.length-ve),ce=oe.slice(0,oe.length-ve);return N(V,se,ce,xe)}}if(D.length>0&&q&&q.length===0)e:{var de=k.slice(0,D.index),xe=k.slice(D.index+D.length),X=de.length,ve=xe.length;if(z<X+ve)break e;var _e=I.slice(0,X),Se=I.slice(z-ve);if(de!==_e||xe!==Se)break e;var se=k.slice(X,F-ve),ce=I.slice(X,z-ve);return N(de,se,ce,xe)}return null}function j(k,I,C,D){return r(k,I,C,D,!0)}return j.INSERT=e,j.DELETE=n,j.EQUAL=t,Pc=j,Pc}var Es={exports:{}};Es.exports;var ig;function h_(){return ig||(ig=1,function(n,e){var t=200,r="__lodash_hash_undefined__",i=9007199254740991,s="[object Arguments]",o="[object Array]",a="[object Boolean]",l="[object Date]",c="[object Error]",u="[object Function]",f="[object GeneratorFunction]",d="[object Map]",g="[object Number]",p="[object Object]",m="[object Promise]",y="[object RegExp]",v="[object Set]",_="[object String]",w="[object Symbol]",E="[object WeakMap]",$="[object ArrayBuffer]",P="[object DataView]",R="[object Float32Array]",N="[object Float64Array]",M="[object Int8Array]",j="[object Int16Array]",k="[object Int32Array]",I="[object Uint8Array]",C="[object Uint8ClampedArray]",D="[object Uint16Array]",q="[object Uint32Array]",F=/[\\^$.*+?()[\]{}|]/g,z=/\w*$/,J=/^\[object .+?Constructor\]$/,V=/^(?:0|[1-9]\d*)$/,G={};G[s]=G[o]=G[$]=G[P]=G[a]=G[l]=G[R]=G[N]=G[M]=G[j]=G[k]=G[d]=G[g]=G[p]=G[y]=G[v]=G[_]=G[w]=G[I]=G[C]=G[D]=G[q]=!0,G[c]=G[u]=G[E]=!1;var ee=typeof Vn=="object"&&Vn&&Vn.Object===Object&&Vn,Z=typeof self=="object"&&self&&self.Object===Object&&self,re=ee||Z||Function("return this")(),oe=e&&!e.nodeType&&e,X=oe&&!0&&n&&!n.nodeType&&n,de=X&&X.exports===oe;function _e(h,b){return h.set(b[0],b[1]),h}function se(h,b){return h.add(b),h}function ce(h,b){for(var T=-1,W=h?h.length:0;++T<W&&b(h[T],T,h)!==!1;);return h}function fe(h,b){for(var T=-1,W=b.length,le=h.length;++T<W;)h[le+T]=b[T];return h}function ve(h,b,T,W){for(var le=-1,te=h?h.length:0;++le<te;)T=b(T,h[le],le,h);return T}function xe(h,b){for(var T=-1,W=Array(h);++T<h;)W[T]=b(T);return W}function Se(h,b){return h==null?void 0:h[b]}function Re(h){var b=!1;if(h!=null&&typeof h.toString!="function")try{b=!!(h+"")}catch{}return b}function it(h){var b=-1,T=Array(h.size);return h.forEach(function(W,le){T[++b]=[le,W]}),T}function rs(h,b){return function(T){return h(b(T))}}function yo(h){var b=-1,T=Array(h.size);return h.forEach(function(W){T[++b]=W}),T}var Al=Array.prototype,Ol=Function.prototype,ii=Object.prototype,is=re["__core-js_shared__"],_o=function(){var h=/[^.]+$/.exec(is&&is.keys&&is.keys.IE_PROTO||"");return h?"Symbol(src)_1."+h:""}(),bo=Ol.toString,en=ii.hasOwnProperty,si=ii.toString,$l=RegExp("^"+bo.call(en).replace(F,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),vr=de?re.Buffer:void 0,oi=re.Symbol,ss=re.Uint8Array,$t=rs(Object.getPrototypeOf,Object),vo=Object.create,ko=ii.propertyIsEnumerable,Pl=Al.splice,os=Object.getOwnPropertySymbols,ai=vr?vr.isBuffer:void 0,wo=rs(Object.keys,Object),li=Wt(re,"DataView"),kr=Wt(re,"Map"),Bt=Wt(re,"Promise"),ci=Wt(re,"Set"),as=Wt(re,"WeakMap"),wr=Wt(Object,"create"),ls=gt(li),xr=gt(kr),cs=gt(Bt),us=gt(ci),ds=gt(as),Un=oi?oi.prototype:void 0,xo=Un?Un.valueOf:void 0;function _n(h){var b=-1,T=h?h.length:0;for(this.clear();++b<T;){var W=h[b];this.set(W[0],W[1])}}function Il(){this.__data__=wr?wr(null):{}}function Rl(h){return this.has(h)&&delete this.__data__[h]}function Dl(h){var b=this.__data__;if(wr){var T=b[h];return T===r?void 0:T}return en.call(b,h)?b[h]:void 0}function Co(h){var b=this.__data__;return wr?b[h]!==void 0:en.call(b,h)}function fs(h,b){var T=this.__data__;return T[h]=wr&&b===void 0?r:b,this}_n.prototype.clear=Il,_n.prototype.delete=Rl,_n.prototype.get=Dl,_n.prototype.has=Co,_n.prototype.set=fs;function Ge(h){var b=-1,T=h?h.length:0;for(this.clear();++b<T;){var W=h[b];this.set(W[0],W[1])}}function Ll(){this.__data__=[]}function jl(h){var b=this.__data__,T=di(b,h);if(T<0)return!1;var W=b.length-1;return T==W?b.pop():Pl.call(b,T,1),!0}function Fl(h){var b=this.__data__,T=di(b,h);return T<0?void 0:b[T][1]}function ql(h){return di(this.__data__,h)>-1}function Bl(h,b){var T=this.__data__,W=di(T,h);return W<0?T.push([h,b]):T[W][1]=b,this}Ge.prototype.clear=Ll,Ge.prototype.delete=jl,Ge.prototype.get=Fl,Ge.prototype.has=ql,Ge.prototype.set=Bl;function st(h){var b=-1,T=h?h.length:0;for(this.clear();++b<T;){var W=h[b];this.set(W[0],W[1])}}function Wl(){this.__data__={hash:new _n,map:new(kr||Ge),string:new _n}}function Ul(h){return Sr(this,h).delete(h)}function zl(h){return Sr(this,h).get(h)}function Kl(h){return Sr(this,h).has(h)}function Hl(h,b){return Sr(this,h).set(h,b),this}st.prototype.clear=Wl,st.prototype.delete=Ul,st.prototype.get=zl,st.prototype.has=Kl,st.prototype.set=Hl;function vt(h){this.__data__=new Ge(h)}function Jl(){this.__data__=new Ge}function Vl(h){return this.__data__.delete(h)}function Gl(h){return this.__data__.get(h)}function Yl(h){return this.__data__.has(h)}function Xl(h,b){var T=this.__data__;if(T instanceof Ge){var W=T.__data__;if(!kr||W.length<t-1)return W.push([h,b]),this;T=this.__data__=new st(W)}return T.set(h,b),this}vt.prototype.clear=Jl,vt.prototype.delete=Vl,vt.prototype.get=Gl,vt.prototype.has=Yl,vt.prototype.set=Xl;function ui(h,b){var T=ms(h)||hi(h)?xe(h.length,String):[],W=T.length,le=!!W;for(var te in h)en.call(h,te)&&!(le&&(te=="length"||dc(te,W)))&&T.push(te);return T}function So(h,b,T){var W=h[b];(!(en.call(h,b)&&Ao(W,T))||T===void 0&&!(b in h))&&(h[b]=T)}function di(h,b){for(var T=h.length;T--;)if(Ao(h[T][0],b))return T;return-1}function tn(h,b){return h&&ps(b,_s(b),h)}function hs(h,b,T,W,le,te,ye){var me;if(W&&(me=te?W(h,le,te,ye):W(h)),me!==void 0)return me;if(!rn(h))return h;var De=ms(h);if(De){if(me=cc(h),!b)return oc(h,me)}else{var ke=vn(h),ot=ke==u||ke==f;if(Oo(h))return fi(h,b);if(ke==p||ke==s||ot&&!te){if(Re(h))return te?h:{};if(me=nn(ot?{}:h),!b)return ac(h,tn(me,h))}else{if(!G[ke])return te?h:{};me=uc(h,ke,hs,b)}}ye||(ye=new vt);var kt=ye.get(h);if(kt)return kt;if(ye.set(h,me),!De)var je=T?lc(h):_s(h);return ce(je||h,function(at,Ye){je&&(Ye=at,at=h[Ye]),So(me,Ye,hs(at,b,T,W,Ye,h,ye))}),me}function Zl(h){return rn(h)?vo(h):{}}function Ql(h,b,T){var W=b(h);return ms(h)?W:fe(W,T(h))}function ec(h){return si.call(h)}function tc(h){if(!rn(h)||hc(h))return!1;var b=ys(h)||Re(h)?$l:J;return b.test(gt(h))}function nc(h){if(!No(h))return wo(h);var b=[];for(var T in Object(h))en.call(h,T)&&T!="constructor"&&b.push(T);return b}function fi(h,b){if(b)return h.slice();var T=new h.constructor(h.length);return h.copy(T),T}function gs(h){var b=new h.constructor(h.byteLength);return new ss(b).set(new ss(h)),b}function Cr(h,b){var T=b?gs(h.buffer):h.buffer;return new h.constructor(T,h.byteOffset,h.byteLength)}function To(h,b,T){var W=b?T(it(h),!0):it(h);return ve(W,_e,new h.constructor)}function Eo(h){var b=new h.constructor(h.source,z.exec(h));return b.lastIndex=h.lastIndex,b}function rc(h,b,T){var W=b?T(yo(h),!0):yo(h);return ve(W,se,new h.constructor)}function ic(h){return xo?Object(xo.call(h)):{}}function sc(h,b){var T=b?gs(h.buffer):h.buffer;return new h.constructor(T,h.byteOffset,h.length)}function oc(h,b){var T=-1,W=h.length;for(b||(b=Array(W));++T<W;)b[T]=h[T];return b}function ps(h,b,T,W){T||(T={});for(var le=-1,te=b.length;++le<te;){var ye=b[le],me=void 0;So(T,ye,me===void 0?h[ye]:me)}return T}function ac(h,b){return ps(h,bn(h),b)}function lc(h){return Ql(h,_s,bn)}function Sr(h,b){var T=h.__data__;return fc(b)?T[typeof b=="string"?"string":"hash"]:T.map}function Wt(h,b){var T=Se(h,b);return tc(T)?T:void 0}var bn=os?rs(os,Object):pc,vn=ec;(li&&vn(new li(new ArrayBuffer(1)))!=P||kr&&vn(new kr)!=d||Bt&&vn(Bt.resolve())!=m||ci&&vn(new ci)!=v||as&&vn(new as)!=E)&&(vn=function(h){var b=si.call(h),T=b==p?h.constructor:void 0,W=T?gt(T):void 0;if(W)switch(W){case ls:return P;case xr:return d;case cs:return m;case us:return v;case ds:return E}return b});function cc(h){var b=h.length,T=h.constructor(b);return b&&typeof h[0]=="string"&&en.call(h,"index")&&(T.index=h.index,T.input=h.input),T}function nn(h){return typeof h.constructor=="function"&&!No(h)?Zl($t(h)):{}}function uc(h,b,T,W){var le=h.constructor;switch(b){case $:return gs(h);case a:case l:return new le(+h);case P:return Cr(h,W);case R:case N:case M:case j:case k:case I:case C:case D:case q:return sc(h,W);case d:return To(h,W,T);case g:case _:return new le(h);case y:return Eo(h);case v:return rc(h,W,T);case w:return ic(h)}}function dc(h,b){return b=b??i,!!b&&(typeof h=="number"||V.test(h))&&h>-1&&h%1==0&&h<b}function fc(h){var b=typeof h;return b=="string"||b=="number"||b=="symbol"||b=="boolean"?h!=="__proto__":h===null}function hc(h){return!!_o&&_o in h}function No(h){var b=h&&h.constructor,T=typeof b=="function"&&b.prototype||ii;return h===T}function gt(h){if(h!=null){try{return bo.call(h)}catch{}try{return h+""}catch{}}return""}function Mo(h){return hs(h,!0,!0)}function Ao(h,b){return h===b||h!==h&&b!==b}function hi(h){return gc(h)&&en.call(h,"callee")&&(!ko.call(h,"callee")||si.call(h)==s)}var ms=Array.isArray;function gi(h){return h!=null&&$o(h.length)&&!ys(h)}function gc(h){return Po(h)&&gi(h)}var Oo=ai||mc;function ys(h){var b=rn(h)?si.call(h):"";return b==u||b==f}function $o(h){return typeof h=="number"&&h>-1&&h%1==0&&h<=i}function rn(h){var b=typeof h;return!!h&&(b=="object"||b=="function")}function Po(h){return!!h&&typeof h=="object"}function _s(h){return gi(h)?ui(h):nc(h)}function pc(){return[]}function mc(){return!1}n.exports=Mo}(Es,Es.exports)),Es.exports}var Ns={exports:{}};Ns.exports;var sg;function g_(){return sg||(sg=1,function(n,e){var t=200,r="__lodash_hash_undefined__",i=1,s=2,o=9007199254740991,a="[object Arguments]",l="[object Array]",c="[object AsyncFunction]",u="[object Boolean]",f="[object Date]",d="[object Error]",g="[object Function]",p="[object GeneratorFunction]",m="[object Map]",y="[object Number]",v="[object Null]",_="[object Object]",w="[object Promise]",E="[object Proxy]",$="[object RegExp]",P="[object Set]",R="[object String]",N="[object Symbol]",M="[object Undefined]",j="[object WeakMap]",k="[object ArrayBuffer]",I="[object DataView]",C="[object Float32Array]",D="[object Float64Array]",q="[object Int8Array]",F="[object Int16Array]",z="[object Int32Array]",J="[object Uint8Array]",V="[object Uint8ClampedArray]",G="[object Uint16Array]",ee="[object Uint32Array]",Z=/[\\^$.*+?()[\]{}|]/g,re=/^\[object .+?Constructor\]$/,oe=/^(?:0|[1-9]\d*)$/,X={};X[C]=X[D]=X[q]=X[F]=X[z]=X[J]=X[V]=X[G]=X[ee]=!0,X[a]=X[l]=X[k]=X[u]=X[I]=X[f]=X[d]=X[g]=X[m]=X[y]=X[_]=X[$]=X[P]=X[R]=X[j]=!1;var de=typeof Vn=="object"&&Vn&&Vn.Object===Object&&Vn,_e=typeof self=="object"&&self&&self.Object===Object&&self,se=de||_e||Function("return this")(),ce=e&&!e.nodeType&&e,fe=ce&&!0&&n&&!n.nodeType&&n,ve=fe&&fe.exports===ce,xe=ve&&de.process,Se=function(){try{return xe&&xe.binding&&xe.binding("util")}catch{}}(),Re=Se&&Se.isTypedArray;function it(h,b){for(var T=-1,W=h==null?0:h.length,le=0,te=[];++T<W;){var ye=h[T];b(ye,T,h)&&(te[le++]=ye)}return te}function rs(h,b){for(var T=-1,W=b.length,le=h.length;++T<W;)h[le+T]=b[T];return h}function yo(h,b){for(var T=-1,W=h==null?0:h.length;++T<W;)if(b(h[T],T,h))return!0;return!1}function Al(h,b){for(var T=-1,W=Array(h);++T<h;)W[T]=b(T);return W}function Ol(h){return function(b){return h(b)}}function ii(h,b){return h.has(b)}function is(h,b){return h==null?void 0:h[b]}function _o(h){var b=-1,T=Array(h.size);return h.forEach(function(W,le){T[++b]=[le,W]}),T}function bo(h,b){return function(T){return h(b(T))}}function en(h){var b=-1,T=Array(h.size);return h.forEach(function(W){T[++b]=W}),T}var si=Array.prototype,$l=Function.prototype,vr=Object.prototype,oi=se["__core-js_shared__"],ss=$l.toString,$t=vr.hasOwnProperty,vo=function(){var h=/[^.]+$/.exec(oi&&oi.keys&&oi.keys.IE_PROTO||"");return h?"Symbol(src)_1."+h:""}(),ko=vr.toString,Pl=RegExp("^"+ss.call($t).replace(Z,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),os=ve?se.Buffer:void 0,ai=se.Symbol,wo=se.Uint8Array,li=vr.propertyIsEnumerable,kr=si.splice,Bt=ai?ai.toStringTag:void 0,ci=Object.getOwnPropertySymbols,as=os?os.isBuffer:void 0,wr=bo(Object.keys,Object),ls=bn(se,"DataView"),xr=bn(se,"Map"),cs=bn(se,"Promise"),us=bn(se,"Set"),ds=bn(se,"WeakMap"),Un=bn(Object,"create"),xo=gt(ls),_n=gt(xr),Il=gt(cs),Rl=gt(us),Dl=gt(ds),Co=ai?ai.prototype:void 0,fs=Co?Co.valueOf:void 0;function Ge(h){var b=-1,T=h==null?0:h.length;for(this.clear();++b<T;){var W=h[b];this.set(W[0],W[1])}}function Ll(){this.__data__=Un?Un(null):{},this.size=0}function jl(h){var b=this.has(h)&&delete this.__data__[h];return this.size-=b?1:0,b}function Fl(h){var b=this.__data__;if(Un){var T=b[h];return T===r?void 0:T}return $t.call(b,h)?b[h]:void 0}function ql(h){var b=this.__data__;return Un?b[h]!==void 0:$t.call(b,h)}function Bl(h,b){var T=this.__data__;return this.size+=this.has(h)?0:1,T[h]=Un&&b===void 0?r:b,this}Ge.prototype.clear=Ll,Ge.prototype.delete=jl,Ge.prototype.get=Fl,Ge.prototype.has=ql,Ge.prototype.set=Bl;function st(h){var b=-1,T=h==null?0:h.length;for(this.clear();++b<T;){var W=h[b];this.set(W[0],W[1])}}function Wl(){this.__data__=[],this.size=0}function Ul(h){var b=this.__data__,T=fi(b,h);if(T<0)return!1;var W=b.length-1;return T==W?b.pop():kr.call(b,T,1),--this.size,!0}function zl(h){var b=this.__data__,T=fi(b,h);return T<0?void 0:b[T][1]}function Kl(h){return fi(this.__data__,h)>-1}function Hl(h,b){var T=this.__data__,W=fi(T,h);return W<0?(++this.size,T.push([h,b])):T[W][1]=b,this}st.prototype.clear=Wl,st.prototype.delete=Ul,st.prototype.get=zl,st.prototype.has=Kl,st.prototype.set=Hl;function vt(h){var b=-1,T=h==null?0:h.length;for(this.clear();++b<T;){var W=h[b];this.set(W[0],W[1])}}function Jl(){this.size=0,this.__data__={hash:new Ge,map:new(xr||st),string:new Ge}}function Vl(h){var b=Wt(this,h).delete(h);return this.size-=b?1:0,b}function Gl(h){return Wt(this,h).get(h)}function Yl(h){return Wt(this,h).has(h)}function Xl(h,b){var T=Wt(this,h),W=T.size;return T.set(h,b),this.size+=T.size==W?0:1,this}vt.prototype.clear=Jl,vt.prototype.delete=Vl,vt.prototype.get=Gl,vt.prototype.has=Yl,vt.prototype.set=Xl;function ui(h){var b=-1,T=h==null?0:h.length;for(this.__data__=new vt;++b<T;)this.add(h[b])}function So(h){return this.__data__.set(h,r),this}function di(h){return this.__data__.has(h)}ui.prototype.add=ui.prototype.push=So,ui.prototype.has=di;function tn(h){var b=this.__data__=new st(h);this.size=b.size}function hs(){this.__data__=new st,this.size=0}function Zl(h){var b=this.__data__,T=b.delete(h);return this.size=b.size,T}function Ql(h){return this.__data__.get(h)}function ec(h){return this.__data__.has(h)}function tc(h,b){var T=this.__data__;if(T instanceof st){var W=T.__data__;if(!xr||W.length<t-1)return W.push([h,b]),this.size=++T.size,this;T=this.__data__=new vt(W)}return T.set(h,b),this.size=T.size,this}tn.prototype.clear=hs,tn.prototype.delete=Zl,tn.prototype.get=Ql,tn.prototype.has=ec,tn.prototype.set=tc;function nc(h,b){var T=hi(h),W=!T&&Ao(h),le=!T&&!W&&gi(h),te=!T&&!W&&!le&&Po(h),ye=T||W||le||te,me=ye?Al(h.length,String):[],De=me.length;for(var ke in h)$t.call(h,ke)&&!(ye&&(ke=="length"||le&&(ke=="offset"||ke=="parent")||te&&(ke=="buffer"||ke=="byteLength"||ke=="byteOffset")||uc(ke,De)))&&me.push(ke);return me}function fi(h,b){for(var T=h.length;T--;)if(Mo(h[T][0],b))return T;return-1}function gs(h,b,T){var W=b(h);return hi(h)?W:rs(W,T(h))}function Cr(h){return h==null?h===void 0?M:v:Bt&&Bt in Object(h)?vn(h):No(h)}function To(h){return rn(h)&&Cr(h)==a}function Eo(h,b,T,W,le){return h===b?!0:h==null||b==null||!rn(h)&&!rn(b)?h!==h&&b!==b:rc(h,b,T,W,Eo,le)}function rc(h,b,T,W,le,te){var ye=hi(h),me=hi(b),De=ye?l:nn(h),ke=me?l:nn(b);De=De==a?_:De,ke=ke==a?_:ke;var ot=De==_,kt=ke==_,je=De==ke;if(je&&gi(h)){if(!gi(b))return!1;ye=!0,ot=!1}if(je&&!ot)return te||(te=new tn),ye||Po(h)?ps(h,b,T,W,le,te):ac(h,b,De,T,W,le,te);if(!(T&i)){var at=ot&&$t.call(h,"__wrapped__"),Ye=kt&&$t.call(b,"__wrapped__");if(at||Ye){var zn=at?h.value():h,kn=Ye?b.value():b;return te||(te=new tn),le(zn,kn,T,W,te)}}return je?(te||(te=new tn),lc(h,b,T,W,le,te)):!1}function ic(h){if(!$o(h)||fc(h))return!1;var b=Oo(h)?Pl:re;return b.test(gt(h))}function sc(h){return rn(h)&&ys(h.length)&&!!X[Cr(h)]}function oc(h){if(!hc(h))return wr(h);var b=[];for(var T in Object(h))$t.call(h,T)&&T!="constructor"&&b.push(T);return b}function ps(h,b,T,W,le,te){var ye=T&i,me=h.length,De=b.length;if(me!=De&&!(ye&&De>me))return!1;var ke=te.get(h);if(ke&&te.get(b))return ke==b;var ot=-1,kt=!0,je=T&s?new ui:void 0;for(te.set(h,b),te.set(b,h);++ot<me;){var at=h[ot],Ye=b[ot];if(W)var zn=ye?W(Ye,at,ot,b,h,te):W(at,Ye,ot,h,b,te);if(zn!==void 0){if(zn)continue;kt=!1;break}if(je){if(!yo(b,function(kn,Tr){if(!ii(je,Tr)&&(at===kn||le(at,kn,T,W,te)))return je.push(Tr)})){kt=!1;break}}else if(!(at===Ye||le(at,Ye,T,W,te))){kt=!1;break}}return te.delete(h),te.delete(b),kt}function ac(h,b,T,W,le,te,ye){switch(T){case I:if(h.byteLength!=b.byteLength||h.byteOffset!=b.byteOffset)return!1;h=h.buffer,b=b.buffer;case k:return!(h.byteLength!=b.byteLength||!te(new wo(h),new wo(b)));case u:case f:case y:return Mo(+h,+b);case d:return h.name==b.name&&h.message==b.message;case $:case R:return h==b+"";case m:var me=_o;case P:var De=W&i;if(me||(me=en),h.size!=b.size&&!De)return!1;var ke=ye.get(h);if(ke)return ke==b;W|=s,ye.set(h,b);var ot=ps(me(h),me(b),W,le,te,ye);return ye.delete(h),ot;case N:if(fs)return fs.call(h)==fs.call(b)}return!1}function lc(h,b,T,W,le,te){var ye=T&i,me=Sr(h),De=me.length,ke=Sr(b),ot=ke.length;if(De!=ot&&!ye)return!1;for(var kt=De;kt--;){var je=me[kt];if(!(ye?je in b:$t.call(b,je)))return!1}var at=te.get(h);if(at&&te.get(b))return at==b;var Ye=!0;te.set(h,b),te.set(b,h);for(var zn=ye;++kt<De;){je=me[kt];var kn=h[je],Tr=b[je];if(W)var xf=ye?W(Tr,kn,je,b,h,te):W(kn,Tr,je,h,b,te);if(!(xf===void 0?kn===Tr||le(kn,Tr,T,W,te):xf)){Ye=!1;break}zn||(zn=je=="constructor")}if(Ye&&!zn){var Io=h.constructor,Ro=b.constructor;Io!=Ro&&"constructor"in h&&"constructor"in b&&!(typeof Io=="function"&&Io instanceof Io&&typeof Ro=="function"&&Ro instanceof Ro)&&(Ye=!1)}return te.delete(h),te.delete(b),Ye}function Sr(h){return gs(h,_s,cc)}function Wt(h,b){var T=h.__data__;return dc(b)?T[typeof b=="string"?"string":"hash"]:T.map}function bn(h,b){var T=is(h,b);return ic(T)?T:void 0}function vn(h){var b=$t.call(h,Bt),T=h[Bt];try{h[Bt]=void 0;var W=!0}catch{}var le=ko.call(h);return W&&(b?h[Bt]=T:delete h[Bt]),le}var cc=ci?function(h){return h==null?[]:(h=Object(h),it(ci(h),function(b){return li.call(h,b)}))}:pc,nn=Cr;(ls&&nn(new ls(new ArrayBuffer(1)))!=I||xr&&nn(new xr)!=m||cs&&nn(cs.resolve())!=w||us&&nn(new us)!=P||ds&&nn(new ds)!=j)&&(nn=function(h){var b=Cr(h),T=b==_?h.constructor:void 0,W=T?gt(T):"";if(W)switch(W){case xo:return I;case _n:return m;case Il:return w;case Rl:return P;case Dl:return j}return b});function uc(h,b){return b=b??o,!!b&&(typeof h=="number"||oe.test(h))&&h>-1&&h%1==0&&h<b}function dc(h){var b=typeof h;return b=="string"||b=="number"||b=="symbol"||b=="boolean"?h!=="__proto__":h===null}function fc(h){return!!vo&&vo in h}function hc(h){var b=h&&h.constructor,T=typeof b=="function"&&b.prototype||vr;return h===T}function No(h){return ko.call(h)}function gt(h){if(h!=null){try{return ss.call(h)}catch{}try{return h+""}catch{}}return""}function Mo(h,b){return h===b||h!==h&&b!==b}var Ao=To(function(){return arguments}())?To:function(h){return rn(h)&&$t.call(h,"callee")&&!li.call(h,"callee")},hi=Array.isArray;function ms(h){return h!=null&&ys(h.length)&&!Oo(h)}var gi=as||mc;function gc(h,b){return Eo(h,b)}function Oo(h){if(!$o(h))return!1;var b=Cr(h);return b==g||b==p||b==c||b==E}function ys(h){return typeof h=="number"&&h>-1&&h%1==0&&h<=o}function $o(h){var b=typeof h;return h!=null&&(b=="object"||b=="function")}function rn(h){return h!=null&&typeof h=="object"}var Po=Re?Ol(Re):sc;function _s(h){return ms(h)?nc(h):oc(h)}function pc(){return[]}function mc(){return!1}n.exports=gc}(Ns,Ns.exports)),Ns.exports}var Ho={},og;function bC(){if(og)return Ho;og=1,Object.defineProperty(Ho,"__esModule",{value:!0});const n=h_(),e=g_();var t;return function(r){function i(l={},c={},u=!1){typeof l!="object"&&(l={}),typeof c!="object"&&(c={});let f=n(c);u||(f=Object.keys(f).reduce((d,g)=>(f[g]!=null&&(d[g]=f[g]),d),{}));for(const d in l)l[d]!==void 0&&c[d]===void 0&&(f[d]=l[d]);return Object.keys(f).length>0?f:void 0}r.compose=i;function s(l={},c={}){typeof l!="object"&&(l={}),typeof c!="object"&&(c={});const u=Object.keys(l).concat(Object.keys(c)).reduce((f,d)=>(e(l[d],c[d])||(f[d]=c[d]===void 0?null:c[d]),f),{});return Object.keys(u).length>0?u:void 0}r.diff=s;function o(l={},c={}){l=l||{};const u=Object.keys(c).reduce((f,d)=>(c[d]!==l[d]&&l[d]!==void 0&&(f[d]=c[d]),f),{});return Object.keys(l).reduce((f,d)=>(l[d]!==c[d]&&c[d]===void 0&&(f[d]=null),f),u)}r.invert=o;function a(l,c,u=!1){if(typeof l!="object")return c;if(typeof c!="object")return;if(!u)return c;const f=Object.keys(c).reduce((d,g)=>(l[g]===void 0&&(d[g]=c[g]),d),{});return Object.keys(f).length>0?f:void 0}r.transform=a}(t||(t={})),Ho.default=t,Ho}var Jo={},ag;function p_(){if(ag)return Jo;ag=1,Object.defineProperty(Jo,"__esModule",{value:!0});var n;return function(e){function t(r){return typeof r.delete=="number"?r.delete:typeof r.retain=="number"?r.retain:typeof r.retain=="object"&&r.retain!==null?1:typeof r.insert=="string"?r.insert.length:1}e.length=t}(n||(n={})),Jo.default=n,Jo}var Vo={},lg;function vC(){if(lg)return Vo;lg=1,Object.defineProperty(Vo,"__esModule",{value:!0});const n=p_();class e{constructor(r){this.ops=r,this.index=0,this.offset=0}hasNext(){return this.peekLength()<1/0}next(r){r||(r=1/0);const i=this.ops[this.index];if(i){const s=this.offset,o=n.default.length(i);if(r>=o-s?(r=o-s,this.index+=1,this.offset=0):this.offset+=r,typeof i.delete=="number")return{delete:r};{const a={};return i.attributes&&(a.attributes=i.attributes),typeof i.retain=="number"?a.retain=r:typeof i.retain=="object"&&i.retain!==null?a.retain=i.retain:typeof i.insert=="string"?a.insert=i.insert.substr(s,r):a.insert=i.insert,a}}else return{retain:1/0}}peek(){return this.ops[this.index]}peekLength(){return this.ops[this.index]?n.default.length(this.ops[this.index])-this.offset:1/0}peekType(){const r=this.ops[this.index];return r?typeof r.delete=="number"?"delete":typeof r.retain=="number"||typeof r.retain=="object"&&r.retain!==null?"retain":"insert":"retain"}rest(){if(this.hasNext()){if(this.offset===0)return this.ops.slice(this.index);{const r=this.offset,i=this.index,s=this.next(),o=this.ops.slice(this.index);return this.offset=r,this.index=i,[s].concat(o)}}else return[]}}return Vo.default=e,Vo}var cg;function kC(){return cg||(cg=1,function(n,e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeMap=e.OpIterator=e.Op=void 0;const t=_C(),r=h_(),i=g_(),s=bC();e.AttributeMap=s.default;const o=p_();e.Op=o.default;const a=vC();e.OpIterator=a.default;const l="\0",c=(f,d)=>{if(typeof f!="object"||f===null)throw new Error(`cannot retain a ${typeof f}`);if(typeof d!="object"||d===null)throw new Error(`cannot retain a ${typeof d}`);const g=Object.keys(f)[0];if(!g||g!==Object.keys(d)[0])throw new Error(`embed types not matched: ${g} != ${Object.keys(d)[0]}`);return[g,f[g],d[g]]};class u{constructor(d){Array.isArray(d)?this.ops=d:d!=null&&Array.isArray(d.ops)?this.ops=d.ops:this.ops=[]}static registerEmbed(d,g){this.handlers[d]=g}static unregisterEmbed(d){delete this.handlers[d]}static getHandler(d){const g=this.handlers[d];if(!g)throw new Error(`no handlers for embed type "${d}"`);return g}insert(d,g){const p={};return typeof d=="string"&&d.length===0?this:(p.insert=d,g!=null&&typeof g=="object"&&Object.keys(g).length>0&&(p.attributes=g),this.push(p))}delete(d){return d<=0?this:this.push({delete:d})}retain(d,g){if(typeof d=="number"&&d<=0)return this;const p={retain:d};return g!=null&&typeof g=="object"&&Object.keys(g).length>0&&(p.attributes=g),this.push(p)}push(d){let g=this.ops.length,p=this.ops[g-1];if(d=r(d),typeof p=="object"){if(typeof d.delete=="number"&&typeof p.delete=="number")return this.ops[g-1]={delete:p.delete+d.delete},this;if(typeof p.delete=="number"&&d.insert!=null&&(g-=1,p=this.ops[g-1],typeof p!="object"))return this.ops.unshift(d),this;if(i(d.attributes,p.attributes)){if(typeof d.insert=="string"&&typeof p.insert=="string")return this.ops[g-1]={insert:p.insert+d.insert},typeof d.attributes=="object"&&(this.ops[g-1].attributes=d.attributes),this;if(typeof d.retain=="number"&&typeof p.retain=="number")return this.ops[g-1]={retain:p.retain+d.retain},typeof d.attributes=="object"&&(this.ops[g-1].attributes=d.attributes),this}}return g===this.ops.length?this.ops.push(d):this.ops.splice(g,0,d),this}chop(){const d=this.ops[this.ops.length-1];return d&&typeof d.retain=="number"&&!d.attributes&&this.ops.pop(),this}filter(d){return this.ops.filter(d)}forEach(d){this.ops.forEach(d)}map(d){return this.ops.map(d)}partition(d){const g=[],p=[];return this.forEach(m=>{(d(m)?g:p).push(m)}),[g,p]}reduce(d,g){return this.ops.reduce(d,g)}changeLength(){return this.reduce((d,g)=>g.insert?d+o.default.length(g):g.delete?d-g.delete:d,0)}length(){return this.reduce((d,g)=>d+o.default.length(g),0)}slice(d=0,g=1/0){const p=[],m=new a.default(this.ops);let y=0;for(;y<g&&m.hasNext();){let v;y<d?v=m.next(d-y):(v=m.next(g-y),p.push(v)),y+=o.default.length(v)}return new u(p)}compose(d){const g=new a.default(this.ops),p=new a.default(d.ops),m=[],y=p.peek();if(y!=null&&typeof y.retain=="number"&&y.attributes==null){let _=y.retain;for(;g.peekType()==="insert"&&g.peekLength()<=_;)_-=g.peekLength(),m.push(g.next());y.retain-_>0&&p.next(y.retain-_)}const v=new u(m);for(;g.hasNext()||p.hasNext();)if(p.peekType()==="insert")v.push(p.next());else if(g.peekType()==="delete")v.push(g.next());else{const _=Math.min(g.peekLength(),p.peekLength()),w=g.next(_),E=p.next(_);if(E.retain){const $={};if(typeof w.retain=="number")$.retain=typeof E.retain=="number"?_:E.retain;else if(typeof E.retain=="number")w.retain==null?$.insert=w.insert:$.retain=w.retain;else{const R=w.retain==null?"insert":"retain",[N,M,j]=c(w[R],E.retain),k=u.getHandler(N);$[R]={[N]:k.compose(M,j,R==="retain")}}const P=s.default.compose(w.attributes,E.attributes,typeof w.retain=="number");if(P&&($.attributes=P),v.push($),!p.hasNext()&&i(v.ops[v.ops.length-1],$)){const R=new u(g.rest());return v.concat(R).chop()}}else typeof E.delete=="number"&&(typeof w.retain=="number"||typeof w.retain=="object"&&w.retain!==null)&&v.push(E)}return v.chop()}concat(d){const g=new u(this.ops.slice());return d.ops.length>0&&(g.push(d.ops[0]),g.ops=g.ops.concat(d.ops.slice(1))),g}diff(d,g){if(this.ops===d.ops)return new u;const p=[this,d].map(w=>w.map(E=>{if(E.insert!=null)return typeof E.insert=="string"?E.insert:l;const $=w===d?"on":"with";throw new Error("diff() called "+$+" non-document")}).join("")),m=new u,y=t(p[0],p[1],g,!0),v=new a.default(this.ops),_=new a.default(d.ops);return y.forEach(w=>{let E=w[1].length;for(;E>0;){let $=0;switch(w[0]){case t.INSERT:$=Math.min(_.peekLength(),E),m.push(_.next($));break;case t.DELETE:$=Math.min(E,v.peekLength()),v.next($),m.delete($);break;case t.EQUAL:$=Math.min(v.peekLength(),_.peekLength(),E);const P=v.next($),R=_.next($);i(P.insert,R.insert)?m.retain($,s.default.diff(P.attributes,R.attributes)):m.push(R).delete($);break}E-=$}}),m.chop()}eachLine(d,g=`
`){const p=new a.default(this.ops);let m=new u,y=0;for(;p.hasNext();){if(p.peekType()!=="insert")return;const v=p.peek(),_=o.default.length(v)-p.peekLength(),w=typeof v.insert=="string"?v.insert.indexOf(g,_)-_:-1;if(w<0)m.push(p.next());else if(w>0)m.push(p.next(w));else{if(d(m,p.next(1).attributes||{},y)===!1)return;y+=1,m=new u}}m.length()>0&&d(m,{},y)}invert(d){const g=new u;return this.reduce((p,m)=>{if(m.insert)g.delete(o.default.length(m));else{if(typeof m.retain=="number"&&m.attributes==null)return g.retain(m.retain),p+m.retain;if(m.delete||typeof m.retain=="number"){const y=m.delete||m.retain;return d.slice(p,p+y).forEach(_=>{m.delete?g.push(_):m.retain&&m.attributes&&g.retain(o.default.length(_),s.default.invert(m.attributes,_.attributes))}),p+y}else if(typeof m.retain=="object"&&m.retain!==null){const y=d.slice(p,p+1),v=new a.default(y.ops).next(),[_,w,E]=c(m.retain,v.insert),$=u.getHandler(_);return g.retain({[_]:$.invert(w,E)},s.default.invert(m.attributes,v.attributes)),p+1}}return p},0),g.chop()}transform(d,g=!1){if(g=!!g,typeof d=="number")return this.transformPosition(d,g);const p=d,m=new a.default(this.ops),y=new a.default(p.ops),v=new u;for(;m.hasNext()||y.hasNext();)if(m.peekType()==="insert"&&(g||y.peekType()!=="insert"))v.retain(o.default.length(m.next()));else if(y.peekType()==="insert")v.push(y.next());else{const _=Math.min(m.peekLength(),y.peekLength()),w=m.next(_),E=y.next(_);if(w.delete)continue;if(E.delete)v.push(E);else{const $=w.retain,P=E.retain;let R=typeof P=="object"&&P!==null?P:_;if(typeof $=="object"&&$!==null&&typeof P=="object"&&P!==null){const N=Object.keys($)[0];if(N===Object.keys(P)[0]){const M=u.getHandler(N);M&&(R={[N]:M.transform($[N],P[N],g)})}}v.retain(R,s.default.transform(w.attributes,E.attributes,g))}}return v.chop()}transformPosition(d,g=!1){g=!!g;const p=new a.default(this.ops);let m=0;for(;p.hasNext()&&m<=d;){const y=p.peekLength(),v=p.peekType();if(p.next(),v==="delete"){d-=Math.min(y,d-m);continue}else v==="insert"&&(m<d||!g)&&(d+=y);m+=y}return d}}u.Op=o.default,u.OpIterator=a.default,u.AttributeMap=s.default,u.handlers={},e.default=u,n.exports=u,n.exports.default=u}(Ko,Ko.exports)),Ko.exports}var wC=kC();const Ms=mv(wC),Tu=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,xC=Tu?x.useLayoutEffect:x.useEffect;let CC=class{constructor(e){this.key=e,this.ref={current:null},this.setRefElement=this.setRefElement.bind(this)}setRefElement(e){this.ref={current:e}}};const ug=n=>{const e=document.getElementById("typeahead-menu");if(!e)return;const t=e.getBoundingClientRect();t.top+t.height>window.innerHeight&&e.scrollIntoView({block:"center"}),t.top<0&&e.scrollIntoView({block:"center"}),n.scrollIntoView({block:"nearest"})};function dg(n,e){const t=n.getBoundingClientRect(),r=e.getBoundingClientRect();return t.top>r.top&&t.top<r.bottom}function SC(n,e,t,r){const[i]=ge();x.useEffect(()=>{if(e!=null&&n!=null){const s=i.getRootElement(),o=s!=null?function(f,d){let g=getComputedStyle(f);const p=g.position==="absolute",m=/(auto|scroll)/;if(g.position==="fixed")return document.body;for(let y=f;y=y.parentElement;)if(g=getComputedStyle(y),(!p||g.position!=="static")&&m.test(g.overflow+g.overflowY+g.overflowX))return y;return document.body}(s):document.body;let a=!1,l=dg(e,o);const c=function(){a||(window.requestAnimationFrame(function(){t(),a=!1}),a=!0);const f=dg(e,o);f!==l&&(l=f,r!=null&&r(f))},u=new ResizeObserver(t);return window.addEventListener("resize",t),document.addEventListener("scroll",c,{capture:!0,passive:!0}),u.observe(e),()=>{u.unobserve(e),window.removeEventListener("resize",t),document.removeEventListener("scroll",c,!0)}}},[e,i,r,t,n])}const fg=ie("SCROLL_TYPEAHEAD_OPTION_INTO_VIEW_COMMAND");function TC({close:n,editor:e,anchorElementRef:t,resolution:r,options:i,menuRenderFn:s,onSelectOption:o,shouldSplitNodeWithQuery:a=!1,commandPriority:l=ei,preselectFirstItem:c=!0}){const[u,f]=x.useState(null),d=r.match&&r.match.matchingString;x.useEffect(()=>{c&&f(0)},[d,c]);const g=x.useCallback(m=>{e.update(()=>{const y=r.match!=null&&a?function(v){const _=K();if(!B(_)||!_.isCollapsed())return null;const w=_.anchor;if(w.type!=="text")return null;const E=w.getNode();if(!E.isSimpleText())return null;const $=w.offset,P=E.getTextContent().slice(0,$),R=v.replaceableString.length,N=$-function(j,k,I){let C=I;for(let D=C;D<=k.length;D++)j.slice(-D)===k.substring(0,D)&&(C=D);return C}(P,v.matchingString,R);if(N<0)return null;let M;return N===0?[M]=E.splitText($):[,M]=E.splitText(N,$),M}(r.match):null;o(m,y,n,r.match?r.match.matchingString:"")})},[e,a,r.match,o,n]),p=x.useCallback(m=>{const y=e.getRootElement();y!==null&&(y.setAttribute("aria-activedescendant","typeahead-item-"+m),f(m))},[e]);return x.useEffect(()=>()=>{const m=e.getRootElement();m!==null&&m.removeAttribute("aria-activedescendant")},[e]),xC(()=>{i===null?f(null):u===null&&c&&p(0)},[i,u,p,c]),x.useEffect(()=>He(e.registerCommand(fg,({option:m})=>!(!m.ref||m.ref.current==null)&&(ug(m.ref.current),!0),l)),[e,p,l]),x.useEffect(()=>He(e.registerCommand(fd,m=>{const y=m;if(i!==null&&i.length){const v=u===null?0:u!==i.length-1?u+1:0;p(v);const _=i[v];_.ref!=null&&_.ref.current&&e.dispatchCommand(fg,{index:v,option:_}),y.preventDefault(),y.stopImmediatePropagation()}return!0},l),e.registerCommand(dd,m=>{const y=m;if(i!==null&&i.length){const v=u===null?i.length-1:u!==0?u-1:i.length-1;p(v);const _=i[v];_.ref!=null&&_.ref.current&&ug(_.ref.current),y.preventDefault(),y.stopImmediatePropagation()}return!0},l),e.registerCommand(ul,m=>{const y=m;return y.preventDefault(),y.stopImmediatePropagation(),n(),!0},l),e.registerCommand(pd,m=>{const y=m;return i!==null&&u!==null&&i[u]!=null&&(y.preventDefault(),y.stopImmediatePropagation(),g(i[u]),!0)},l),e.registerCommand($i,m=>i!==null&&u!==null&&i[u]!=null&&(m!==null&&(m.preventDefault(),m.stopImmediatePropagation()),g(i[u]),!0),l)),[g,n,e,i,u,p,l]),s(t,x.useMemo(()=>({options:i,selectOptionAndCleanUp:g,selectedIndex:u,setHighlightedIndex:f}),[g,u,i]),r.match?r.match.matchingString:"")}function hg(n,e){e!=null&&(n.className=e),n.setAttribute("aria-label","Typeahead menu"),n.setAttribute("role","listbox"),n.style.display="block",n.style.position="absolute"}function EC({options:n,onWillOpen:e,onClose:t,onOpen:r,onSelectOption:i,menuRenderFn:s,anchorClassName:o,commandPriority:a=ei,parent:l}){const[c]=ge(),[u,f]=x.useState(null),d=x.useRef(null),g=function(_,w,E,$=Tu?document.body:void 0,P=!0){const[R]=ge(),N=Tu?document.createElement("div"):null,M=x.useRef(N),j=x.useCallback(()=>{if(M.current===null||$===void 0)return;M.current.style.top=M.current.style.bottom;const I=R.getRootElement(),C=M.current,D=C.firstChild;if(I!==null&&_!==null){const{left:q,top:F,width:z,height:J}=_.getRect(),V=M.current.offsetHeight;if(C.style.top=`${F+V+3+(P?window.pageYOffset:0)}px`,C.style.left=`${q+window.pageXOffset}px`,C.style.height=`${J}px`,C.style.width=`${z}px`,D!==null){D.style.top=`${F}`;const G=D.getBoundingClientRect(),ee=G.height,Z=G.width,re=I.getBoundingClientRect();q+Z>re.right&&(C.style.left=`${re.right-Z+window.pageXOffset}px`),(F+ee>window.innerHeight||F+ee>re.bottom)&&F-re.top>ee+J&&(C.style.top=`${F-ee-J+(P?window.pageYOffset:0)}px`)}C.isConnected||(hg(C,E),$.append(C)),C.setAttribute("id","typeahead-menu"),I.setAttribute("aria-controls","typeahead-menu")}},[R,_,P,E,$]);x.useEffect(()=>{const I=R.getRootElement();return _!==null&&j(),()=>{I!==null&&I.removeAttribute("aria-controls");const C=M.current;C!==null&&C.isConnected&&(C.remove(),C.removeAttribute("id"))}},[R,j,_]);const k=x.useCallback(I=>{_!==null&&(I||w(null))},[_,w]);return SC(_,M.current,j,k),N!=null&&N===M.current&&(hg(N,E),$!=null&&$.append(N)),M}(u,f,o,l),p=x.useCallback(()=>{f(null),t!=null&&u!==null&&t()},[t,u]),m=x.useCallback(_=>{f(_),r!=null&&u===null&&r(_)},[r,u]),y=x.useCallback(_=>{_.preventDefault(),e!=null&&e(_);const w=ax(_.target);m({getRect:()=>new DOMRect(_.clientX/w,_.clientY/w,1,1)})},[m,e]),v=x.useCallback(_=>{u!==null&&d.current!=null&&_.target!=null&&ti(_.target)&&!d.current.contains(_.target)&&p()},[p,u]);return x.useEffect(()=>{const _=c.getRootElement();if(_)return _.addEventListener("contextmenu",y),()=>_.removeEventListener("contextmenu",y)},[c,y]),x.useEffect(()=>(document.addEventListener("click",v),()=>document.removeEventListener("click",v)),[c,v]),g.current===null||u===null||c===null?null:S.jsx(TC,{close:p,resolution:u,editor:c,anchorElementRef:g,options:n,menuRenderFn:(_,w)=>s(_,w,{setMenuRef:E=>{d.current=E}}),onSelectOption:i,commandPriority:a})}function NC({defaultSelection:n}){const[e]=ge();return x.useEffect(()=>{e.focus(()=>{const t=document.activeElement,r=e.getRootElement();r===null||t!==null&&r.contains(t)||r.focus({preventScroll:!0})},{defaultSelection:n})},[n,e]),null}const MC=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0?x.useLayoutEffect:x.useEffect;function AC({onClear:n}){const[e]=ge();return MC(()=>e.registerCommand(yd,t=>(e.update(()=>{if(n==null){const r=pe(),i=K(),s=Ot();r.clear(),r.append(s),i!==null&&s.select(),B(i)&&(i.format=0)}else n()}),!0),ne),[e,n]),null}const gg=[["Cat","rgb(125, 50, 0)"],["Dog","rgb(100, 0, 0)"],["Rabbit","rgb(150, 0, 0)"],["Frog","rgb(200, 0, 0)"],["Fox","rgb(200, 75, 0)"],["Hedgehog","rgb(0, 75, 0)"],["Pigeon","rgb(0, 125, 0)"],["Squirrel","rgb(75, 100, 0)"],["Bear","rgb(125, 100, 0)"],["Tiger","rgb(0, 0, 150)"],["Leopard","rgb(0, 0, 200)"],["Zebra","rgb(0, 0, 250)"],["Wolf","rgb(0, 100, 150)"],["Owl","rgb(0, 100, 100)"],["Gull","rgb(100, 0, 100)"],["Squid","rgb(150, 0, 150)"]],pg=gg[Math.floor(Math.random()*gg.length)],OC=x.createContext({clientID:0,color:pg[1],isCollabActive:!1,name:pg[0],yjsDocMap:new Map});function m_(n,e){return x.useContext(OC)}const $C=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0?x.useLayoutEffect:x.useEffect;function PC({ignoreHistoryMergeTagChange:n=!0,ignoreSelectionChange:e=!1,onChange:t}){const[r]=ge();return $C(()=>{if(t)return r.registerUpdateListener(({editorState:i,dirtyElements:s,dirtyLeaves:o,prevEditorState:a,tags:l})=>{e&&s.size===0&&o.size===0||n&&l.has($r)||a.isEmpty()||t(i,r,l)})},[r,n,e,t]),null}const Zi=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,IC=Zi&&"documentMode"in document?document.documentMode:null,RC=!(!Zi||!("InputEvent"in window)||IC)&&"getTargetRanges"in new window.InputEvent("input"),DC=Zi&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent),mg=Zi&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,LC=Zi&&/^(?=.*Chrome).*/i.test(navigator.userAgent),jC=Zi&&/AppleWebKit\/[\d.]+/.test(navigator.userAgent)&&!LC;function yg(n,e){e.update(()=>{if(n!==null){const t=On(n,KeyboardEvent)?null:n.clipboardData,r=K();if(r!==null&&t!=null){n.preventDefault();const i=jy(e);i!==null&&t.setData("text/html",i),t.setData("text/plain",r.getTextContent())}}})}function FC(n){return He(n.registerCommand(dn,e=>{const t=K();return!!B(t)&&(t.deleteCharacter(e),!0)},ne),n.registerCommand(Ai,e=>{const t=K();return!!B(t)&&(t.deleteWord(e),!0)},ne),n.registerCommand(Oi,e=>{const t=K();return!!B(t)&&(t.deleteLine(e),!0)},ne),n.registerCommand(Ar,e=>{const t=K();if(!B(t))return!1;if(typeof e=="string")t.insertText(e);else{const r=e.dataTransfer;if(r!=null)Ph(r,t);else{const i=e.data;i&&t.insertText(i)}}return!0},ne),n.registerCommand(Ia,()=>{const e=K();return!!B(e)&&(e.removeText(),!0)},ne),n.registerCommand(Qn,e=>{const t=K();return!!B(t)&&(t.insertLineBreak(e),!0)},ne),n.registerCommand(Ws,()=>{const e=K();return!!B(e)&&(e.insertLineBreak(),!0)},ne),n.registerCommand(ud,e=>{const t=K();if(!B(t))return!1;const r=e,i=r.shiftKey;return!!za(t,!0)&&(r.preventDefault(),Ka(t,i,!0),!0)},ne),n.registerCommand(cd,e=>{const t=K();if(!B(t))return!1;const r=e,i=r.shiftKey;return!!za(t,!1)&&(r.preventDefault(),Ka(t,i,!1),!0)},ne),n.registerCommand(hd,e=>{const t=K();return!!B(t)&&(!mg||navigator.language!=="ko-KR")&&(e.preventDefault(),n.dispatchCommand(dn,!0))},ne),n.registerCommand(gd,e=>{const t=K();return!!B(t)&&(e.preventDefault(),n.dispatchCommand(dn,!1))},ne),n.registerCommand($i,e=>{const t=K();if(!B(t))return!1;if(e!==null){if((mg||DC||jC)&&RC)return!1;e.preventDefault()}return n.dispatchCommand(Qn,!1)},ne),n.registerCommand(Ra,()=>(fy(),!0),ne),n.registerCommand(Zr,e=>{const t=K();return!!B(t)&&(yg(e,n),!0)},ne),n.registerCommand(Ki,e=>{const t=K();return!!B(t)&&(function(r,i){yg(r,i),i.update(()=>{const s=K();B(s)&&s.removeText()})}(e,n),!0)},ne),n.registerCommand(Xr,e=>{const t=K();return!!B(t)&&(function(r,i){r.preventDefault(),i.update(()=>{const s=K(),o=On(r,ClipboardEvent)?r.clipboardData:null;o!=null&&B(s)&&Ph(o,s)},{tag:ty})}(e,n),!0)},ne),n.registerCommand(dl,e=>{const t=K();return!!B(t)&&(e.preventDefault(),!0)},ne),n.registerCommand(md,e=>{const t=K();return!!B(t)&&(e.preventDefault(),!0)},ne))}const Eu=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0?x.useLayoutEffect:x.useEffect;function _g(n){return n.getEditorState().read(Ud(n.isComposing()))}function qC({contentEditable:n,placeholder:e=null,ErrorBoundary:t}){const[r]=ge(),i=function(s,o){const[a,l]=x.useState(()=>s.getDecorators());return Eu(()=>s.registerDecoratorListener(c=>{Nt.flushSync(()=>{l(c)})}),[s]),x.useEffect(()=>{l(s.getDecorators())},[s]),x.useMemo(()=>{const c=[],u=Object.keys(a);for(let f=0;f<u.length;f++){const d=u[f],g=S.jsx(o,{onError:m=>s._onError(m),children:S.jsx(x.Suspense,{fallback:null,children:a[d]})}),p=s.getElementByKey(d);p!==null&&c.push(Nt.createPortal(g,p,d))}return c},[o,a,s])}(r,t);return function(s){Eu(()=>He(FC(s),f_(s)),[s])}(r),S.jsxs(S.Fragment,{children:[n,S.jsx(BC,{content:e}),i]})}function BC({content:n}){const[e]=ge(),t=function(i){const[s,o]=x.useState(()=>_g(i));return Eu(()=>{function a(){const l=_g(i);o(l)}return a(),He(i.registerUpdateListener(()=>{a()}),i.registerEditableListener(()=>{a()}))},[i]),s}(e),r=d_();return t?typeof n=="function"?n(r):n:null}const fn=()=>new Map,Nu=n=>{const e=fn();return n.forEach((t,r)=>{e.set(r,t)}),e},Qi=(n,e,t)=>{let r=n.get(e);return r===void 0&&n.set(e,r=t()),r},WC=(n,e)=>{const t=[];for(const[r,i]of n)t.push(e(i,r));return t},UC=(n,e)=>{for(const[t,r]of n)if(e(r,t))return!0;return!1},Di=()=>new Set,Ic=n=>n[n.length-1],Li=Array.from,zC=Array.isArray;class KC{constructor(){this._observers=fn()}on(e,t){return Qi(this._observers,e,Di).add(t),t}once(e,t){const r=(...i)=>{this.off(e,r),t(...i)};this.on(e,r)}off(e,t){const r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return Li((this._observers.get(e)||fn()).values()).forEach(r=>r(...t))}destroy(){this._observers=fn()}}const Ur=Math.floor,_a=Math.abs,y_=(n,e)=>n<e?n:e,es=(n,e)=>n>e?n:e,HC=n=>n!==0?n<0:1/n<0,bg=1,vg=2,Rc=4,Dc=8,JC=32,__=64,Ja=128,VC=31,kg=63,Ds=127,GC=2147483647,YC=Number.isInteger||(n=>typeof n=="number"&&isFinite(n)&&Ur(n)===n),XC=n=>n.toLowerCase(),ZC=/^\s*/g,QC=n=>n.replace(ZC,""),e0=/([A-Z])/g,wg=(n,e)=>QC(n.replace(e0,t=>`${e}${XC(t)}`)),t0=n=>{const e=unescape(encodeURIComponent(n)),t=e.length,r=new Uint8Array(t);for(let i=0;i<t;i++)r[i]=e.codePointAt(i);return r},Ks=typeof TextEncoder<"u"?new TextEncoder:null,n0=n=>Ks.encode(n),r0=Ks?n0:t0;let Lc=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Lc&&Lc.decode(new Uint8Array).length===1&&(Lc=null);class lo{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const zd=()=>new lo,i0=n=>{let e=n.cpos;for(let t=0;t<n.bufs.length;t++)e+=n.bufs[t].length;return e},$n=n=>{const e=new Uint8Array(i0(n));let t=0;for(let r=0;r<n.bufs.length;r++){const i=n.bufs[r];e.set(i,t),t+=i.length}return e.set(new Uint8Array(n.cbuf.buffer,0,n.cpos),t),e},s0=(n,e)=>{const t=n.cbuf.length;t-n.cpos<e&&(n.bufs.push(new Uint8Array(n.cbuf.buffer,0,n.cpos)),n.cbuf=new Uint8Array(es(t,e)*2),n.cpos=0)},Ue=(n,e)=>{const t=n.cbuf.length;n.cpos===t&&(n.bufs.push(n.cbuf),n.cbuf=new Uint8Array(t*2),n.cpos=0),n.cbuf[n.cpos++]=e},Mu=Ue,Ee=(n,e)=>{for(;e>Ds;)Ue(n,Ja|Ds&e),e=Ur(e/128);Ue(n,Ds&e)},Kd=(n,e)=>{const t=HC(e);for(t&&(e=-e),Ue(n,(e>kg?Ja:0)|(t?__:0)|kg&e),e=Ur(e/64);e>0;)Ue(n,(e>Ds?Ja:0)|Ds&e),e=Ur(e/128)},Au=new Uint8Array(3e4),o0=Au.length/3,a0=(n,e)=>{if(e.length<o0){const t=Ks.encodeInto(e,Au).written||0;Ee(n,t);for(let r=0;r<t;r++)Ue(n,Au[r])}else Tt(n,r0(e))},l0=(n,e)=>{const t=unescape(encodeURIComponent(e)),r=t.length;Ee(n,r);for(let i=0;i<r;i++)Ue(n,t.codePointAt(i))},xi=Ks&&Ks.encodeInto?a0:l0,Hd=(n,e)=>{const t=n.cbuf.length,r=n.cpos,i=y_(t-r,e.length),s=e.length-i;n.cbuf.set(e.subarray(0,i),r),n.cpos+=i,s>0&&(n.bufs.push(n.cbuf),n.cbuf=new Uint8Array(es(t*2,s)),n.cbuf.set(e.subarray(i)),n.cpos=s)},Tt=(n,e)=>{Ee(n,e.byteLength),Hd(n,e)},Jd=(n,e)=>{s0(n,e);const t=new DataView(n.cbuf.buffer,n.cpos,e);return n.cpos+=e,t},c0=(n,e)=>Jd(n,4).setFloat32(0,e,!1),u0=(n,e)=>Jd(n,8).setFloat64(0,e,!1),d0=(n,e)=>Jd(n,8).setBigInt64(0,e,!1),xg=new DataView(new ArrayBuffer(4)),f0=n=>(xg.setFloat32(0,n),xg.getFloat32(0)===n),Hs=(n,e)=>{switch(typeof e){case"string":Ue(n,119),xi(n,e);break;case"number":YC(e)&&_a(e)<=GC?(Ue(n,125),Kd(n,e)):f0(e)?(Ue(n,124),c0(n,e)):(Ue(n,123),u0(n,e));break;case"bigint":Ue(n,122),d0(n,e);break;case"object":if(e===null)Ue(n,126);else if(zC(e)){Ue(n,117),Ee(n,e.length);for(let t=0;t<e.length;t++)Hs(n,e[t])}else if(e instanceof Uint8Array)Ue(n,116),Tt(n,e);else{Ue(n,118);const t=Object.keys(e);Ee(n,t.length);for(let r=0;r<t.length;r++){const i=t[r];xi(n,i),Hs(n,e[i])}}break;case"boolean":Ue(n,e?120:121);break;default:Ue(n,127)}};class Cg extends lo{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&Ee(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const Sg=n=>{n.count>0&&(Kd(n.encoder,n.count===1?n.s:-n.s),n.count>1&&Ee(n.encoder,n.count-2))};class ba{constructor(){this.encoder=new lo,this.s=0,this.count=0}write(e){this.s===e?this.count++:(Sg(this),this.count=1,this.s=e)}toUint8Array(){return Sg(this),$n(this.encoder)}}const Tg=n=>{if(n.count>0){const e=n.diff*2+(n.count===1?0:1);Kd(n.encoder,e),n.count>1&&Ee(n.encoder,n.count-2)}};class jc{constructor(){this.encoder=new lo,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(Tg(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return Tg(this),$n(this.encoder)}}class h0{constructor(){this.sarr=[],this.s="",this.lensE=new ba}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new lo;return this.sarr.push(this.s),this.s="",xi(e,this.sarr.join("")),Hd(e,this.lensE.toUint8Array()),$n(e)}}const ji=n=>new Error(n),hn=()=>{throw ji("Method unimplemented")},zr=()=>{throw ji("Unexpected case")},g0=crypto.getRandomValues.bind(crypto),b_=()=>g0(new Uint32Array(1))[0],p0="10000000-1000-4000-8000"+-1e11,m0=()=>p0.replace(/[018]/g,n=>(n^b_()&15>>n/4).toString(16)),Eg=n=>new Promise(n);Promise.all.bind(Promise);const Ng=n=>n===void 0?null:n;class y0{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}}let v_=new y0,_0=!0;try{typeof localStorage<"u"&&localStorage&&(v_=localStorage,_0=!1)}catch{}const b0=v_,v0=Object.assign,k0=Object.keys,w0=(n,e)=>{for(const t in n)e(n[t],t)},Mg=n=>k0(n).length,x0=n=>{for(const e in n)return!1;return!0},C0=(n,e)=>{for(const t in n)if(!e(n[t],t))return!1;return!0},S0=(n,e)=>Object.prototype.hasOwnProperty.call(n,e),T0=(n,e)=>n===e||Mg(n)===Mg(e)&&C0(n,(t,r)=>(t!==void 0||S0(e,r))&&e[r]===t),E0=Object.freeze,k_=n=>{for(const e in n){const t=n[e];(typeof t=="object"||typeof t=="function")&&k_(n[e])}return E0(n)},Vd=(n,e,t=0)=>{try{for(;t<n.length;t++)n[t](...e)}finally{t<n.length&&Vd(n,e,t+1)}},N0=(n,e)=>e.includes(n);var w_={};const Js=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";let sn;const M0=()=>{if(sn===void 0)if(Js){sn=fn();const n=process.argv;let e=null;for(let t=0;t<n.length;t++){const r=n[t];r[0]==="-"?(e!==null&&sn.set(e,""),e=r):e!==null&&(sn.set(e,r),e=null)}e!==null&&sn.set(e,"")}else typeof location=="object"?(sn=fn(),(location.search||"?").slice(1).split("&").forEach(n=>{if(n.length!==0){const[e,t]=n.split("=");sn.set(`--${wg(e,"-")}`,t),sn.set(`-${wg(e,"-")}`,t)}})):sn=fn();return sn},Ou=n=>M0().has(n),Va=n=>Ng(Js?w_[n.toUpperCase().replaceAll("-","_")]:b0.getItem(n)),x_=n=>Ou("--"+n)||Va(n)!==null;x_("production");const A0=Js&&N0(w_.FORCE_COLOR,["true","1","2"]),O0=A0||!Ou("--no-colors")&&!x_("no-color")&&(!Js||process.stdout.isTTY)&&(!Js||Ou("--color")||Va("COLORTERM")!==null||(Va("TERM")||"").includes("color"));class $0{constructor(e,t){this.left=e,this.right=t}}const Cn=(n,e)=>new $0(n,e);typeof DOMParser<"u"&&new DOMParser;const P0=n=>WC(n,(e,t)=>`${t}:${e};`).join(""),Fn=Symbol,C_=Fn(),S_=Fn(),I0=Fn(),R0=Fn(),D0=Fn(),T_=Fn(),L0=Fn(),Gd=Fn(),j0=Fn(),F0=n=>{var i;n.length===1&&((i=n[0])==null?void 0:i.constructor)===Function&&(n=n[0]());const e=[],t=[];let r=0;for(;r<n.length;r++){const s=n[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)e.push(s);else if(s.constructor===Object)break}for(r>0&&t.push(e.join(""));r<n.length;r++){const s=n[r];s instanceof Symbol||t.push(s)}return t},q0={[C_]:Cn("font-weight","bold"),[S_]:Cn("font-weight","normal"),[I0]:Cn("color","blue"),[D0]:Cn("color","green"),[R0]:Cn("color","grey"),[T_]:Cn("color","red"),[L0]:Cn("color","purple"),[Gd]:Cn("color","orange"),[j0]:Cn("color","black")},B0=n=>{var o;n.length===1&&((o=n[0])==null?void 0:o.constructor)===Function&&(n=n[0]());const e=[],t=[],r=fn();let i=[],s=0;for(;s<n.length;s++){const a=n[s],l=q0[a];if(l!==void 0)r.set(l.left,l.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const c=P0(r);s>0||c.length>0?(e.push("%c"+a),t.push(c)):e.push(a)}else break}}for(s>0&&(i=t,i.unshift(e.join("")));s<n.length;s++){const a=n[s];a instanceof Symbol||i.push(a)}return i},E_=O0?B0:F0,W0=(...n)=>{console.log(...E_(n)),N_.forEach(e=>e.print(n))},U0=(...n)=>{console.warn(...E_(n)),n.unshift(Gd),N_.forEach(e=>e.print(n))},N_=Di(),M_=n=>({[Symbol.iterator](){return this},next:n}),z0=(n,e)=>M_(()=>{let t;do t=n.next();while(!t.done&&!e(t.value));return t}),Fc=(n,e)=>M_(()=>{const{done:t,value:r}=n.next();return{done:t,value:t?void 0:e(r)}});class K0{constructor(e,t){this.clock=e,this.len=t}}class H0{constructor(){this.clients=new Map}}const A_=(n,e,t)=>e.clients.forEach((r,i)=>{const s=n.doc.store.clients.get(i);if(s!=null){const o=s[s.length-1],a=o.id.clock+o.length;for(let l=0,c=r[l];l<r.length&&c.clock<a;c=r[++l])L_(n,s,c.clock,c.len,t)}}),J0=(n,e)=>{let t=0,r=n.length-1;for(;t<=r;){const i=Ur((t+r)/2),s=n[i],o=s.clock;if(o<=e){if(e<o+s.len)return i;t=i+1}else r=i-1}return null},O_=(n,e)=>{const t=n.clients.get(e.client);return t!==void 0&&J0(t,e.clock)!==null},$_=n=>{n.clients.forEach(e=>{e.sort((i,s)=>i.clock-s.clock);let t,r;for(t=1,r=1;t<e.length;t++){const i=e[r-1],s=e[t];i.clock+i.len>=s.clock?i.len=es(i.len,s.clock+s.len-i.clock):(r<t&&(e[r]=s),r++)}e.length=r})},P_=(n,e,t,r)=>{Qi(n.clients,e,()=>[]).push(new K0(t,r))},V0=(n,e)=>{Ee(n.restEncoder,e.clients.size),Li(e.clients.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{n.resetDsCurVal(),Ee(n.restEncoder,t);const i=r.length;Ee(n.restEncoder,i);for(let s=0;s<i;s++){const o=r[s];n.writeDsClock(o.clock),n.writeDsLen(o.len)}})},I_=b_;class co extends KC{constructor({guid:e=m0(),collectionid:t=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=I_(),this.guid=e,this.collectionid=t,this.share=new Map,this.store=new iS,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=Eg(c=>{this.on("load",()=>{this.isLoaded=!0,c(this)})});const l=()=>Eg(c=>{const u=f=>{(f===void 0||f===!0)&&(this.off("sync",u),c())};this.on("sync",u)});this.on("sync",c=>{c===!1&&this.isSynced&&(this.whenSynced=l()),this.isSynced=c===void 0||c===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=l()}load(){const e=this._item;e!==null&&!this.shouldLoad&&Me(e.parent.doc,t=>{t.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Li(this.subdocs).map(e=>e.guid))}transact(e,t=null){return Me(this,e,t)}get(e,t=tt){const r=Qi(this.share,e,()=>{const s=new t;return s._integrate(this,null),s}),i=r.constructor;if(t!==tt&&i!==t)if(i===tt){const s=new t;s._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=r._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=r._length,this.share.set(e,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,Dr)}getText(e=""){return this.get(e,Xa)}getMap(e=""){return this.get(e,Fi)}getXmlElement(e=""){return this.get(e,Ys)}getXmlFragment(e=""){return this.get(e,qi)}toJSON(){const e={};return this.share.forEach((t,r)=>{e[r]=t.toJSON()}),e}destroy(){this.isDestroyed=!0,Li(this.subdocs).forEach(t=>t.destroy());const e=this._item;if(e!==null){this._item=null;const t=e.content;t.doc=new co({guid:this.guid,...t.opts,shouldLoad:!1}),t.doc._item=e,Me(e.parent.doc,r=>{const i=t.doc;e.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class G0{constructor(){this.restEncoder=zd()}toUint8Array(){return $n(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){Ee(this.restEncoder,e)}writeDsLen(e){Ee(this.restEncoder,e)}}class Y0 extends G0{writeLeftID(e){Ee(this.restEncoder,e.client),Ee(this.restEncoder,e.clock)}writeRightID(e){Ee(this.restEncoder,e.client),Ee(this.restEncoder,e.clock)}writeClient(e){Ee(this.restEncoder,e)}writeInfo(e){Mu(this.restEncoder,e)}writeString(e){xi(this.restEncoder,e)}writeParentInfo(e){Ee(this.restEncoder,e?1:0)}writeTypeRef(e){Ee(this.restEncoder,e)}writeLen(e){Ee(this.restEncoder,e)}writeAny(e){Hs(this.restEncoder,e)}writeBuf(e){Tt(this.restEncoder,e)}writeJSON(e){xi(this.restEncoder,JSON.stringify(e))}writeKey(e){xi(this.restEncoder,e)}}class X0{constructor(){this.restEncoder=zd(),this.dsCurrVal=0}toUint8Array(){return $n(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const t=e-this.dsCurrVal;this.dsCurrVal=e,Ee(this.restEncoder,t)}writeDsLen(e){e===0&&zr(),Ee(this.restEncoder,e-1),this.dsCurrVal+=e}}class Z0 extends X0{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new jc,this.clientEncoder=new ba,this.leftClockEncoder=new jc,this.rightClockEncoder=new jc,this.infoEncoder=new Cg(Mu),this.stringEncoder=new h0,this.parentInfoEncoder=new Cg(Mu),this.typeRefEncoder=new ba,this.lenEncoder=new ba}toUint8Array(){const e=zd();return Ee(e,0),Tt(e,this.keyClockEncoder.toUint8Array()),Tt(e,this.clientEncoder.toUint8Array()),Tt(e,this.leftClockEncoder.toUint8Array()),Tt(e,this.rightClockEncoder.toUint8Array()),Tt(e,$n(this.infoEncoder)),Tt(e,this.stringEncoder.toUint8Array()),Tt(e,$n(this.parentInfoEncoder)),Tt(e,this.typeRefEncoder.toUint8Array()),Tt(e,this.lenEncoder.toUint8Array()),Hd(e,$n(this.restEncoder)),$n(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){Hs(this.restEncoder,e)}writeBuf(e){Tt(this.restEncoder,e)}writeJSON(e){Hs(this.restEncoder,e)}writeKey(e){const t=this.keyMap.get(e);t===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(t)}}const Q0=(n,e,t,r)=>{r=es(r,e[0].id.clock);const i=Rn(e,r);Ee(n.restEncoder,e.length-i),n.writeClient(t),Ee(n.restEncoder,r);const s=e[i];s.write(n,r-s.id.clock);for(let o=i+1;o<e.length;o++)e[o].write(n,0)},eS=(n,e,t)=>{const r=new Map;t.forEach((i,s)=>{wt(e,s)>i&&r.set(s,i)}),Yd(e).forEach((i,s)=>{t.has(s)||r.set(s,0)}),Ee(n.restEncoder,r.size),Li(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{Q0(n,e.clients.get(i),i,s)})},tS=(n,e)=>eS(n,e.doc.store,e.beforeState);class nS{constructor(){this.l=[]}}const Ag=()=>new nS,Og=(n,e)=>n.l.push(e),$g=(n,e)=>{const t=n.l,r=t.length;n.l=t.filter(i=>e!==i),r===n.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},R_=(n,e,t)=>Vd(n.l,[e,t]);class va{constructor(e,t){this.client=e,this.clock=t}}const Go=(n,e)=>n===e||n!==null&&e!==null&&n.client===e.client&&n.clock===e.clock,Pe=(n,e)=>new va(n,e),rS=n=>{for(const[e,t]of n.doc.share.entries())if(t===n)return e;throw zr()},yi=(n,e)=>e===void 0?!n.deleted:e.sv.has(n.id.client)&&(e.sv.get(n.id.client)||0)>n.id.clock&&!O_(e.ds,n.id),$u=(n,e)=>{const t=Qi(n.meta,$u,Di),r=n.doc.store;t.has(e)||(e.sv.forEach((i,s)=>{i<wt(r,s)&&or(n,Pe(s,i))}),A_(n,e.ds,i=>{}),t.add(e))};class iS{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Yd=n=>{const e=new Map;return n.clients.forEach((t,r)=>{const i=t[t.length-1];e.set(r,i.id.clock+i.length)}),e},wt=(n,e)=>{const t=n.clients.get(e);if(t===void 0)return 0;const r=t[t.length-1];return r.id.clock+r.length},D_=(n,e)=>{let t=n.clients.get(e.id.client);if(t===void 0)t=[],n.clients.set(e.id.client,t);else{const r=t[t.length-1];if(r.id.clock+r.length!==e.id.clock)throw zr()}t.push(e)},Rn=(n,e)=>{let t=0,r=n.length-1,i=n[r],s=i.id.clock;if(s===e)return r;let o=Ur(e/(s+i.length-1)*r);for(;t<=r;){if(i=n[o],s=i.id.clock,s<=e){if(e<s+i.length)return o;t=o+1}else r=o-1;o=Ur((t+r)/2)}throw zr()},sS=(n,e)=>{const t=n.clients.get(e.client);return t[Rn(t,e.clock)]},qc=sS,Pu=(n,e,t)=>{const r=Rn(e,t),i=e[r];return i.id.clock<t&&i instanceof ct?(e.splice(r+1,0,nb(n,i,t-i.id.clock)),r+1):r},or=(n,e)=>{const t=n.doc.store.clients.get(e.client);return t[Pu(n,t,e.clock)]},Pg=(n,e,t)=>{const r=e.clients.get(t.client),i=Rn(r,t.clock),s=r[i];return t.clock!==s.id.clock+s.length-1&&s.constructor!==Jn&&r.splice(i+1,0,nb(n,s,t.clock-s.id.clock+1)),s},oS=(n,e,t)=>{const r=n.clients.get(e.id.client);r[Rn(r,e.id.clock)]=t},L_=(n,e,t,r,i)=>{if(r===0)return;const s=t+r;let o=Pu(n,e,t),a;do a=e[o++],s<a.id.clock+a.length&&Pu(n,e,s),i(a);while(o<e.length&&e[o].id.clock<s)};class aS{constructor(e,t,r){this.doc=e,this.deleteSet=new H0,this.beforeState=Yd(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=t,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const Ig=(n,e)=>e.deleteSet.clients.size===0&&!UC(e.afterState,(t,r)=>e.beforeState.get(r)!==t)?!1:($_(e.deleteSet),tS(n,e),V0(n,e.deleteSet),!0),Rg=(n,e,t)=>{const r=e._item;(r===null||r.id.clock<(n.beforeState.get(r.id.client)||0)&&!r.deleted)&&Qi(n.changed,e,Di).add(t)},ka=(n,e)=>{let t=n[e],r=n[e-1],i=e;for(;i>0;t=r,r=n[--i-1]){if(r.deleted===t.deleted&&r.constructor===t.constructor&&r.mergeWith(t)){t instanceof ct&&t.parentSub!==null&&t.parent._map.get(t.parentSub)===t&&t.parent._map.set(t.parentSub,r);continue}break}const s=e-i;return s&&n.splice(e+1-s,s),s},lS=(n,e,t)=>{for(const[r,i]of n.clients.entries()){const s=e.clients.get(r);for(let o=i.length-1;o>=0;o--){const a=i[o],l=a.clock+a.len;for(let c=Rn(s,a.clock),u=s[c];c<s.length&&u.id.clock<l;u=s[++c]){const f=s[c];if(a.clock+a.len<=f.id.clock)break;f instanceof ct&&f.deleted&&!f.keep&&t(f)&&f.gc(e,!1)}}}},cS=(n,e)=>{n.clients.forEach((t,r)=>{const i=e.clients.get(r);for(let s=t.length-1;s>=0;s--){const o=t[s],a=y_(i.length-1,1+Rn(i,o.clock+o.len-1));for(let l=a,c=i[l];l>0&&c.id.clock>=o.clock;c=i[l])l-=1+ka(i,l)}})},j_=(n,e)=>{if(e<n.length){const t=n[e],r=t.doc,i=r.store,s=t.deleteSet,o=t._mergeStructs;try{$_(s),t.afterState=Yd(t.doc.store),r.emit("beforeObserverCalls",[t,r]);const a=[];t.changed.forEach((l,c)=>a.push(()=>{(c._item===null||!c._item.deleted)&&c._callObserver(t,l)})),a.push(()=>{t.changedParentTypes.forEach((l,c)=>{c._dEH.l.length>0&&(c._item===null||!c._item.deleted)&&(l=l.filter(u=>u.target._item===null||!u.target._item.deleted),l.forEach(u=>{u.currentTarget=c,u._path=null}),l.sort((u,f)=>u.path.length-f.path.length),R_(c._dEH,l,t))})}),a.push(()=>r.emit("afterTransaction",[t,r])),Vd(a,[]),t._needFormattingCleanup&&vS(t)}finally{r.gc&&lS(s,i,r.gcFilter),cS(s,i),t.afterState.forEach((u,f)=>{const d=t.beforeState.get(f)||0;if(d!==u){const g=i.clients.get(f),p=es(Rn(g,d),1);for(let m=g.length-1;m>=p;)m-=1+ka(g,m)}});for(let u=o.length-1;u>=0;u--){const{client:f,clock:d}=o[u].id,g=i.clients.get(f),p=Rn(g,d);p+1<g.length&&ka(g,p+1)>1||p>0&&ka(g,p)}if(!t.local&&t.afterState.get(r.clientID)!==t.beforeState.get(r.clientID)&&(W0(Gd,C_,"[yjs] ",S_,T_,"Changed the client-id because another client seems to be using it."),r.clientID=I_()),r.emit("afterTransactionCleanup",[t,r]),r._observers.has("update")){const u=new Y0;Ig(u,t)&&r.emit("update",[u.toUint8Array(),t.origin,r,t])}if(r._observers.has("updateV2")){const u=new Z0;Ig(u,t)&&r.emit("updateV2",[u.toUint8Array(),t.origin,r,t])}const{subdocsAdded:a,subdocsLoaded:l,subdocsRemoved:c}=t;(a.size>0||c.size>0||l.size>0)&&(a.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),c.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:l,added:a,removed:c},r,t]),c.forEach(u=>u.destroy())),n.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,n])):j_(n,e+1)}}},Me=(n,e,t=null,r=!0)=>{const i=n._transactionCleanups;let s=!1,o=null;n._transaction===null&&(s=!0,n._transaction=new aS(n,t,r),i.push(n._transaction),i.length===1&&n.emit("beforeAllTransactions",[n]),n.emit("beforeTransaction",[n._transaction,n]));try{o=e(n._transaction)}finally{if(s){const a=n._transaction===i[0];n._transaction=null,a&&j_(i,0)}}return o},Dg="You must not compute changes after the event-handler fired.";class kl{constructor(e,t){this.target=e,this.currentTarget=e,this.transaction=t,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=uS(this.currentTarget,this.target))}deletes(e){return O_(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw ji(Dg);const e=new Map,t=this.target;this.transaction.changed.get(t).forEach(i=>{if(i!==null){const s=t._map.get(i);let o,a;if(this.adds(s)){let l=s.left;for(;l!==null&&this.adds(l);)l=l.left;if(this.deletes(s))if(l!==null&&this.deletes(l))o="delete",a=Ic(l.content.getContent());else return;else l!==null&&this.deletes(l)?(o="update",a=Ic(l.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=Ic(s.content.getContent());else return;e.set(i,{action:o,oldValue:a})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw ji(Dg);const t=this.target,r=Di(),i=Di(),s=[];if(e={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(t).has(null)){let a=null;const l=()=>{a&&s.push(a)};for(let c=t._start;c!==null;c=c.right)c.deleted?this.deletes(c)&&!this.adds(c)&&((a===null||a.delete===void 0)&&(l(),a={delete:0}),a.delete+=c.length,i.add(c)):this.adds(c)?((a===null||a.insert===void 0)&&(l(),a={insert:[]}),a.insert=a.insert.concat(c.content.getContent()),r.add(c)):((a===null||a.retain===void 0)&&(l(),a={retain:0}),a.retain+=c.length);a!==null&&a.retain===void 0&&l()}this._changes=e}return e}}const uS=(n,e)=>{const t=[];for(;e._item!==null&&e!==n;){if(e._item.parentSub!==null)t.unshift(e._item.parentSub);else{let r=0,i=e._item.parent._start;for(;i!==e._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;t.unshift(r)}e=e._item.parent}return t},dt=()=>{U0("Invalid access: Add Yjs type to a document before reading data.")},F_=80;let Xd=0;class dS{constructor(e,t){e.marker=!0,this.p=e,this.index=t,this.timestamp=Xd++}}const fS=n=>{n.timestamp=Xd++},q_=(n,e,t)=>{n.p.marker=!1,n.p=e,e.marker=!0,n.index=t,n.timestamp=Xd++},hS=(n,e,t)=>{if(n.length>=F_){const r=n.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return q_(r,e,t),r}else{const r=new dS(e,t);return n.push(r),r}},wl=(n,e)=>{if(n._start===null||e===0||n._searchMarker===null)return null;const t=n._searchMarker.length===0?null:n._searchMarker.reduce((s,o)=>_a(e-s.index)<_a(e-o.index)?s:o);let r=n._start,i=0;for(t!==null&&(r=t.p,i=t.index,fS(t));r.right!==null&&i<e;){if(!r.deleted&&r.countable){if(e<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>e;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return t!==null&&_a(t.index-i)<r.parent.length/F_?(q_(t,r,i),t):hS(n._searchMarker,r,i)},Vs=(n,e,t)=>{for(let r=n.length-1;r>=0;r--){const i=n[r];if(t>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){n.splice(r,1);continue}i.p=s,s.marker=!0}(e<i.index||t>0&&e===i.index)&&(i.index=es(e,i.index+t))}},xl=(n,e,t)=>{const r=n,i=e.changedParentTypes;for(;Qi(i,n,()=>[]).push(t),n._item!==null;)n=n._item.parent;R_(r._eH,t,e)};class tt{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Ag(),this._dEH=Ag(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,t){this.doc=e,this._item=t}_copy(){throw hn()}clone(){throw hn()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,t){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){Og(this._eH,e)}observeDeep(e){Og(this._dEH,e)}unobserve(e){$g(this._eH,e)}unobserveDeep(e){$g(this._dEH,e)}toJSON(){}}const B_=(n,e,t)=>{n.doc??dt(),e<0&&(e=n._length+e),t<0&&(t=n._length+t);let r=t-e;const i=[];let s=n._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=e)e-=o.length;else{for(let a=e;a<o.length&&r>0;a++)i.push(o[a]),r--;e=0}}s=s.right}return i},W_=n=>{n.doc??dt();const e=[];let t=n._start;for(;t!==null;){if(t.countable&&!t.deleted){const r=t.content.getContent();for(let i=0;i<r.length;i++)e.push(r[i])}t=t.right}return e},Gs=(n,e)=>{let t=0,r=n._start;for(n.doc??dt();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)e(i[s],t++,n)}r=r.right}},U_=(n,e)=>{const t=[];return Gs(n,(r,i)=>{t.push(e(r,i,n))}),t},gS=n=>{let e=n._start,t=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(t===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};t=e.content.getContent(),r=0,e=e.right}const i=t[r++];return t.length<=r&&(t=null),{done:!1,value:i}}}},z_=(n,e)=>{n.doc??dt();const t=wl(n,e);let r=n._start;for(t!==null&&(r=t.p,e-=t.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},Ga=(n,e,t,r)=>{let i=t;const s=n.doc,o=s.clientID,a=s.store,l=t===null?e._start:t.right;let c=[];const u=()=>{c.length>0&&(i=new ct(Pe(o,wt(a,o)),i,i&&i.lastId,l,l&&l.id,e,null,new Bi(c)),i.integrate(n,0),c=[])};r.forEach(f=>{if(f===null)c.push(f);else switch(f.constructor){case Number:case Object:case Boolean:case Array:case String:c.push(f);break;default:switch(u(),f.constructor){case Uint8Array:case ArrayBuffer:i=new ct(Pe(o,wt(a,o)),i,i&&i.lastId,l,l&&l.id,e,null,new Cl(new Uint8Array(f))),i.integrate(n,0);break;case co:i=new ct(Pe(o,wt(a,o)),i,i&&i.lastId,l,l&&l.id,e,null,new Sl(f)),i.integrate(n,0);break;default:if(f instanceof tt)i=new ct(Pe(o,wt(a,o)),i,i&&i.lastId,l,l&&l.id,e,null,new gr(f)),i.integrate(n,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},K_=()=>ji("Length exceeded!"),H_=(n,e,t,r)=>{if(t>e._length)throw K_();if(t===0)return e._searchMarker&&Vs(e._searchMarker,t,r.length),Ga(n,e,null,r);const i=t,s=wl(e,t);let o=e._start;for(s!==null&&(o=s.p,t-=s.index,t===0&&(o=o.prev,t+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(t<=o.length){t<o.length&&or(n,Pe(o.id.client,o.id.clock+t));break}t-=o.length}return e._searchMarker&&Vs(e._searchMarker,i,r.length),Ga(n,e,o,r)},pS=(n,e,t)=>{let i=(e._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:e._start}).p;if(i)for(;i.right;)i=i.right;return Ga(n,e,i,t)},J_=(n,e,t,r)=>{if(r===0)return;const i=t,s=r,o=wl(e,t);let a=e._start;for(o!==null&&(a=o.p,t-=o.index);a!==null&&t>0;a=a.right)!a.deleted&&a.countable&&(t<a.length&&or(n,Pe(a.id.client,a.id.clock+t)),t-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&or(n,Pe(a.id.client,a.id.clock+r)),a.delete(n),r-=a.length),a=a.right;if(r>0)throw K_();e._searchMarker&&Vs(e._searchMarker,i,-s+r)},Ya=(n,e,t)=>{const r=e._map.get(t);r!==void 0&&r.delete(n)},Zd=(n,e,t,r)=>{const i=e._map.get(t)||null,s=n.doc,o=s.clientID;let a;if(r==null)a=new Bi([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:a=new Bi([r]);break;case Uint8Array:a=new Cl(r);break;case co:a=new Sl(r);break;default:if(r instanceof tt)a=new gr(r);else throw new Error("Unexpected content type")}new ct(Pe(o,wt(s.store,o)),i,i&&i.lastId,null,null,e,t,a).integrate(n,0)},Qd=(n,e)=>{n.doc??dt();const t=n._map.get(e);return t!==void 0&&!t.deleted?t.content.getContent()[t.length-1]:void 0},V_=n=>{const e={};return n.doc??dt(),n._map.forEach((t,r)=>{t.deleted||(e[r]=t.content.getContent()[t.length-1])}),e},G_=(n,e)=>{n.doc??dt();const t=n._map.get(e);return t!==void 0&&!t.deleted},mS=(n,e)=>{const t={};return n._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!e.sv.has(s.id.client)||s.id.clock>=(e.sv.get(s.id.client)||0));)s=s.left;s!==null&&yi(s,e)&&(t[i]=s.content.getContent()[s.length-1])}),t},Yo=n=>(n.doc??dt(),z0(n._map.entries(),e=>!e[1].deleted));class Y_ extends kl{}class Dr extends tt{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const t=new Dr;return t.push(e),t}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Dr}clone(){const e=new Dr;return e.insert(0,this.toArray().map(t=>t instanceof tt?t.clone():t)),e}get length(){return this.doc??dt(),this._length}_callObserver(e,t){super._callObserver(e,t),xl(this,e,new Y_(this,e))}insert(e,t){this.doc!==null?Me(this.doc,r=>{H_(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}push(e){this.doc!==null?Me(this.doc,t=>{pS(t,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,t=1){this.doc!==null?Me(this.doc,r=>{J_(r,this,e,t)}):this._prelimContent.splice(e,t)}get(e){return z_(this,e)}toArray(){return W_(this)}slice(e=0,t=this.length){return B_(this,e,t)}toJSON(){return this.map(e=>e instanceof tt?e.toJSON():e)}map(e){return U_(this,e)}forEach(e){Gs(this,e)}[Symbol.iterator](){return gS(this)}_write(e){e.writeTypeRef(TS)}}class yS extends kl{constructor(e,t,r){super(e,t),this.keysChanged=r}}class Fi extends tt{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,t){super._integrate(e,t),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new Fi}clone(){const e=new Fi;return this.forEach((t,r)=>{e.set(r,t instanceof tt?t.clone():t)}),e}_callObserver(e,t){xl(this,e,new yS(this,e,t))}toJSON(){this.doc??dt();const e={};return this._map.forEach((t,r)=>{if(!t.deleted){const i=t.content.getContent()[t.length-1];e[r]=i instanceof tt?i.toJSON():i}}),e}get size(){return[...Yo(this)].length}keys(){return Fc(Yo(this),e=>e[0])}values(){return Fc(Yo(this),e=>e[1].content.getContent()[e[1].length-1])}entries(){return Fc(Yo(this),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this.doc??dt(),this._map.forEach((t,r)=>{t.deleted||e(t.content.getContent()[t.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?Me(this.doc,t=>{Ya(t,this,e)}):this._prelimContent.delete(e)}set(e,t){return this.doc!==null?Me(this.doc,r=>{Zd(r,this,e,t)}):this._prelimContent.set(e,t),t}get(e){return Qd(this,e)}has(e){return G_(this,e)}clear(){this.doc!==null?Me(this.doc,e=>{this.forEach(function(t,r,i){Ya(e,i,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(ES)}}const Xn=(n,e)=>n===e||typeof n=="object"&&typeof e=="object"&&n&&e&&T0(n,e);class Iu{constructor(e,t,r,i){this.left=e,this.right=t,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&zr(),this.right.content.constructor){case Je:this.right.deleted||ts(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Lg=(n,e,t)=>{for(;e.right!==null&&t>0;){switch(e.right.content.constructor){case Je:e.right.deleted||ts(e.currentAttributes,e.right.content);break;default:e.right.deleted||(t<e.right.length&&or(n,Pe(e.right.id.client,e.right.id.clock+t)),e.index+=e.right.length,t-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},Xo=(n,e,t,r)=>{const i=new Map,s=r?wl(e,t):null;if(s){const o=new Iu(s.p.left,s.p,s.index,i);return Lg(n,o,t-s.index)}else{const o=new Iu(null,e._start,0,i);return Lg(n,o,t)}},X_=(n,e,t,r)=>{for(;t.right!==null&&(t.right.deleted===!0||t.right.content.constructor===Je&&Xn(r.get(t.right.content.key),t.right.content.value));)t.right.deleted||r.delete(t.right.content.key),t.forward();const i=n.doc,s=i.clientID;r.forEach((o,a)=>{const l=t.left,c=t.right,u=new ct(Pe(s,wt(i.store,s)),l,l&&l.lastId,c,c&&c.id,e,null,new Je(a,o));u.integrate(n,0),t.right=u,t.forward()})},ts=(n,e)=>{const{key:t,value:r}=e;r===null?n.delete(t):n.set(t,r)},Z_=(n,e)=>{for(;n.right!==null;){if(!(n.right.deleted||n.right.content.constructor===Je&&Xn(e[n.right.content.key]??null,n.right.content.value)))break;n.forward()}},Q_=(n,e,t,r)=>{const i=n.doc,s=i.clientID,o=new Map;for(const a in r){const l=r[a],c=t.currentAttributes.get(a)??null;if(!Xn(c,l)){o.set(a,c);const{left:u,right:f}=t;t.right=new ct(Pe(s,wt(i.store,s)),u,u&&u.lastId,f,f&&f.id,e,null,new Je(a,l)),t.right.integrate(n,0),t.forward()}}return o},Bc=(n,e,t,r,i)=>{t.currentAttributes.forEach((d,g)=>{i[g]===void 0&&(i[g]=null)});const s=n.doc,o=s.clientID;Z_(t,i);const a=Q_(n,e,t,i),l=r.constructor===String?new Dn(r):r instanceof tt?new gr(r):new ns(r);let{left:c,right:u,index:f}=t;e._searchMarker&&Vs(e._searchMarker,t.index,l.getLength()),u=new ct(Pe(o,wt(s.store,o)),c,c&&c.lastId,u,u&&u.id,e,null,l),u.integrate(n,0),t.right=u,t.index=f,t.forward(),X_(n,e,t,a)},jg=(n,e,t,r,i)=>{const s=n.doc,o=s.clientID;Z_(t,i);const a=Q_(n,e,t,i);e:for(;t.right!==null&&(r>0||a.size>0&&(t.right.deleted||t.right.content.constructor===Je));){if(!t.right.deleted)switch(t.right.content.constructor){case Je:{const{key:l,value:c}=t.right.content,u=i[l];if(u!==void 0){if(Xn(u,c))a.delete(l);else{if(r===0)break e;a.set(l,c)}t.right.delete(n)}else t.currentAttributes.set(l,c);break}default:r<t.right.length&&or(n,Pe(t.right.id.client,t.right.id.clock+r)),r-=t.right.length;break}t.forward()}if(r>0){let l="";for(;r>0;r--)l+=`
`;t.right=new ct(Pe(o,wt(s.store,o)),t.left,t.left&&t.left.lastId,t.right,t.right&&t.right.id,e,null,new Dn(l)),t.right.integrate(n,0),t.forward()}X_(n,e,t,a)},eb=(n,e,t,r,i)=>{let s=e;const o=fn();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===Je){const c=s.content;o.set(c.key,c)}s=s.right}let a=0,l=!1;for(;e!==s;){if(t===e&&(l=!0),!e.deleted){const c=e.content;switch(c.constructor){case Je:{const{key:u,value:f}=c,d=r.get(u)??null;(o.get(u)!==c||d===f)&&(e.delete(n),a++,!l&&(i.get(u)??null)===f&&d!==f&&(d===null?i.delete(u):i.set(u,d))),!l&&!e.deleted&&ts(i,c);break}}}e=e.right}return a},_S=(n,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const t=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===Je){const r=e.content.key;t.has(r)?e.delete(n):t.add(r)}e=e.left}},bS=n=>{let e=0;return Me(n.doc,t=>{let r=n._start,i=n._start,s=fn();const o=Nu(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case Je:ts(o,i.content);break;default:e+=eb(t,r,i,s,o),s=Nu(o),r=i;break}i=i.right}}),e},vS=n=>{const e=new Set,t=n.doc;for(const[r,i]of n.afterState.entries()){const s=n.beforeState.get(r)||0;i!==s&&L_(n,t.store.clients.get(r),s,i,o=>{!o.deleted&&o.content.constructor===Je&&o.constructor!==Jn&&e.add(o.parent)})}Me(t,r=>{A_(n,n.deleteSet,i=>{if(i instanceof Jn||!i.parent._hasFormatting||e.has(i.parent))return;const s=i.parent;i.content.constructor===Je?e.add(s):_S(r,i)});for(const i of e)bS(i)})},Fg=(n,e,t)=>{const r=t,i=Nu(e.currentAttributes),s=e.right;for(;t>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case gr:case ns:case Dn:t<e.right.length&&or(n,Pe(e.right.id.client,e.right.id.clock+t)),t-=e.right.length,e.right.delete(n);break}e.forward()}s&&eb(n,s,e.right,i,e.currentAttributes);const o=(e.left||e.right).parent;return o._searchMarker&&Vs(o._searchMarker,e.index,-r+t),e};class kS extends kl{constructor(e,t,r){super(e,t),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,t=[];Me(e,r=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const l={};let c="",u=0,f=0;const d=()=>{if(a!==null){let g=null;switch(a){case"delete":f>0&&(g={delete:f}),f=0;break;case"insert":(typeof c=="object"||c.length>0)&&(g={insert:c},i.size>0&&(g.attributes={},i.forEach((p,m)=>{p!==null&&(g.attributes[m]=p)}))),c="";break;case"retain":u>0&&(g={retain:u},x0(l)||(g.attributes=v0({},l))),u=0;break}g&&t.push(g),a=null}};for(;o!==null;){switch(o.content.constructor){case gr:case ns:this.adds(o)?this.deletes(o)||(d(),a="insert",c=o.content.getContent()[0],d()):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),f+=1):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=1);break;case Dn:this.adds(o)?this.deletes(o)||(a!=="insert"&&(d(),a="insert"),c+=o.content.str):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),f+=o.length):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=o.length);break;case Je:{const{key:g,value:p}=o.content;if(this.adds(o)){if(!this.deletes(o)){const m=i.get(g)??null;Xn(m,p)?p!==null&&o.delete(r):(a==="retain"&&d(),Xn(p,s.get(g)??null)?delete l[g]:l[g]=p)}}else if(this.deletes(o)){s.set(g,p);const m=i.get(g)??null;Xn(m,p)||(a==="retain"&&d(),l[g]=m)}else if(!o.deleted){s.set(g,p);const m=l[g];m!==void 0&&(Xn(m,p)?m!==null&&o.delete(r):(a==="retain"&&d(),p===null?delete l[g]:l[g]=p))}o.deleted||(a==="insert"&&d(),ts(i,o.content));break}}o=o.right}for(d();t.length>0;){const g=t[t.length-1];if(g.retain!==void 0&&g.attributes===void 0)t.pop();else break}}),this._delta=t}return this._delta}}class Xa extends tt{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??dt(),this._length}_integrate(e,t){super._integrate(e,t);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new Xa}clone(){const e=new Xa;return e.applyDelta(this.toDelta()),e}_callObserver(e,t){super._callObserver(e,t);const r=new kS(this,e,t);xl(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){this.doc??dt();let e="",t=this._start;for(;t!==null;)!t.deleted&&t.countable&&t.content.constructor===Dn&&(e+=t.content.str),t=t.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:t=!0}={}){this.doc!==null?Me(this.doc,r=>{const i=new Iu(null,this._start,0,new Map);for(let s=0;s<e.length;s++){const o=e[s];if(o.insert!==void 0){const a=!t&&typeof o.insert=="string"&&s===e.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&Bc(r,this,i,a,o.attributes||{})}else o.retain!==void 0?jg(r,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&Fg(r,i,o.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,t,r){this.doc??dt();const i=[],s=new Map,o=this.doc;let a="",l=this._start;function c(){if(a.length>0){const f={};let d=!1;s.forEach((p,m)=>{d=!0,f[m]=p});const g={insert:a};d&&(g.attributes=f),i.push(g),a=""}}const u=()=>{for(;l!==null;){if(yi(l,e)||t!==void 0&&yi(l,t))switch(l.content.constructor){case Dn:{const f=s.get("ychange");e!==void 0&&!yi(l,e)?(f===void 0||f.user!==l.id.client||f.type!=="removed")&&(c(),s.set("ychange",r?r("removed",l.id):{type:"removed"})):t!==void 0&&!yi(l,t)?(f===void 0||f.user!==l.id.client||f.type!=="added")&&(c(),s.set("ychange",r?r("added",l.id):{type:"added"})):f!==void 0&&(c(),s.delete("ychange")),a+=l.content.str;break}case gr:case ns:{c();const f={insert:l.content.getContent()[0]};if(s.size>0){const d={};f.attributes=d,s.forEach((g,p)=>{d[p]=g})}i.push(f);break}case Je:yi(l,e)&&(c(),ts(s,l.content));break}l=l.right}c()};return e||t?Me(o,f=>{e&&$u(f,e),t&&$u(f,t),u()},"cleanup"):u(),i}insert(e,t,r){if(t.length<=0)return;const i=this.doc;i!==null?Me(i,s=>{const o=Xo(s,this,e,!r);r||(r={},o.currentAttributes.forEach((a,l)=>{r[l]=a})),Bc(s,this,o,t,r)}):this._pending.push(()=>this.insert(e,t,r))}insertEmbed(e,t,r){const i=this.doc;i!==null?Me(i,s=>{const o=Xo(s,this,e,!r);Bc(s,this,o,t,r||{})}):this._pending.push(()=>this.insertEmbed(e,t,r||{}))}delete(e,t){if(t===0)return;const r=this.doc;r!==null?Me(r,i=>{Fg(i,Xo(i,this,e,!0),t)}):this._pending.push(()=>this.delete(e,t))}format(e,t,r){if(t===0)return;const i=this.doc;i!==null?Me(i,s=>{const o=Xo(s,this,e,!1);o.right!==null&&jg(s,this,o,t,r)}):this._pending.push(()=>this.format(e,t,r))}removeAttribute(e){this.doc!==null?Me(this.doc,t=>{Ya(t,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,t){this.doc!==null?Me(this.doc,r=>{Zd(r,this,e,t)}):this._pending.push(()=>this.setAttribute(e,t))}getAttribute(e){return Qd(this,e)}getAttributes(){return V_(this)}_write(e){e.writeTypeRef(NS)}}class Wc{constructor(e,t=()=>!0){this._filter=t,this._root=e,this._currentNode=e._start,this._firstCall=!0,e.doc??dt()}[Symbol.iterator](){return this}next(){let e=this._currentNode,t=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(t)))do if(t=e.content.type,!e.deleted&&(t.constructor===Ys||t.constructor===qi)&&t._start!==null)e=t._start;else for(;e!==null;){const r=e.next;if(r!==null){e=r;break}else e.parent===this._root?e=null:e=e.parent._item}while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class qi extends tt{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new qi}clone(){const e=new qi;return e.insert(0,this.toArray().map(t=>t instanceof tt?t.clone():t)),e}get length(){return this.doc??dt(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new Wc(this,e)}querySelector(e){e=e.toUpperCase();const r=new Wc(this,i=>i.nodeName&&i.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),Li(new Wc(this,t=>t.nodeName&&t.nodeName.toUpperCase()===e))}_callObserver(e,t){xl(this,e,new wS(this,t,e))}toString(){return U_(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,t={},r){const i=e.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),Gs(this,s=>{i.insertBefore(s.toDOM(e,t,r),null)}),i}insert(e,t){this.doc!==null?Me(this.doc,r=>{H_(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}insertAfter(e,t){if(this.doc!==null)Me(this.doc,r=>{const i=e&&e instanceof tt?e._item:e;Ga(r,this,i,t)});else{const r=this._prelimContent,i=e===null?0:r.findIndex(s=>s===e)+1;if(i===0&&e!==null)throw ji("Reference item not found");r.splice(i,0,...t)}}delete(e,t=1){this.doc!==null?Me(this.doc,r=>{J_(r,this,e,t)}):this._prelimContent.splice(e,t)}toArray(){return W_(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return z_(this,e)}slice(e=0,t=this.length){return B_(this,e,t)}forEach(e){Gs(this,e)}_write(e){e.writeTypeRef(AS)}}class Ys extends qi{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,t){super._integrate(e,t),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new Ys(this.nodeName)}clone(){const e=new Ys(this.nodeName),t=this.getAttributes();return w0(t,(r,i)=>{typeof r=="string"&&e.setAttribute(i,r)}),e.insert(0,this.toArray().map(r=>r instanceof tt?r.clone():r)),e}toString(){const e=this.getAttributes(),t=[],r=[];for(const a in e)r.push(a);r.sort();const i=r.length;for(let a=0;a<i;a++){const l=r[a];t.push(l+'="'+e[l]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=t.length>0?" "+t.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(e){this.doc!==null?Me(this.doc,t=>{Ya(t,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,t){this.doc!==null?Me(this.doc,r=>{Zd(r,this,e,t)}):this._prelimAttrs.set(e,t)}getAttribute(e){return Qd(this,e)}hasAttribute(e){return G_(this,e)}getAttributes(e){return e?mS(this,e):V_(this)}toDOM(e=document,t={},r){const i=e.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return Gs(this,o=>{i.appendChild(o.toDOM(e,t,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(e){e.writeTypeRef(MS),e.writeKey(this.nodeName)}}class wS extends kl{constructor(e,t,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,t.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class tb{constructor(e,t){this.id=e,this.length=t}get deleted(){throw hn()}mergeWith(e){return!1}write(e,t,r){throw hn()}integrate(e,t){throw hn()}}const xS=0;class Jn extends tb{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){t>0&&(this.id.clock+=t,this.length-=t),D_(e.doc.store,this)}write(e,t){e.writeInfo(xS),e.writeLen(this.length-t)}getMissing(e,t){return null}}class Cl{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Cl(this.content)}splice(e){throw hn()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeBuf(this.content)}getRef(){return 3}}class Za{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Za(this.len)}splice(e){const t=new Za(this.len-e);return this.len=e,t}mergeWith(e){return this.len+=e.len,!0}integrate(e,t){P_(e.deleteSet,t.id.client,t.id.clock,this.len),t.markDeleted()}delete(e){}gc(e){}write(e,t){e.writeLen(this.len-t)}getRef(){return 1}}const CS=(n,e)=>new co({guid:n,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class Sl{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const t={};this.opts=t,e.gc||(t.gc=!1),e.autoLoad&&(t.autoLoad=!0),e.meta!==null&&(t.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Sl(CS(this.doc.guid,this.opts))}splice(e){throw hn()}mergeWith(e){return!1}integrate(e,t){this.doc._item=t,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,t){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}class ns{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new ns(this.embed)}splice(e){throw hn()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeJSON(this.embed)}getRef(){return 5}}class Je{constructor(e,t){this.key=e,this.value=t}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Je(this.key,this.value)}splice(e){throw hn()}mergeWith(e){return!1}integrate(e,t){const r=t.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,t){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const SS=Va("node_env")==="development";class Bi{constructor(e){this.arr=e,SS&&k_(e)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Bi(this.arr)}splice(e){const t=new Bi(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){const r=this.arr.length;e.writeLen(r-t);for(let i=t;i<r;i++){const s=this.arr[i];e.writeAny(s)}}getRef(){return 8}}class Dn{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Dn(this.str)}splice(e){const t=new Dn(this.str.slice(e));this.str=this.str.slice(0,e);const r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"�",t.str="�"+t.str.slice(1)),t}mergeWith(e){return this.str+=e.str,!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeString(t===0?this.str:this.str.slice(t))}getRef(){return 4}}const TS=0,ES=1,NS=2,MS=3,AS=4;class gr{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new gr(this.type._copy())}splice(e){throw hn()}mergeWith(e){return!1}integrate(e,t){this.type._integrate(e.doc,t)}delete(e){let t=this.type._start;for(;t!==null;)t.deleted?t.id.clock<(e.beforeState.get(t.id.client)||0)&&e._mergeStructs.push(t):t.delete(e),t=t.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let t=this.type._start;for(;t!==null;)t.gc(e,!0),t=t.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,t){this.type._write(e)}getRef(){return 7}}const nb=(n,e,t)=>{const{client:r,clock:i}=e.id,s=new ct(Pe(r,i+t),e,Pe(r,i+t-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(t));return e.deleted&&s.markDeleted(),e.keep&&(s.keep=!0),e.redone!==null&&(s.redone=Pe(e.redone.client,e.redone.clock+t)),e.right=s,s.right!==null&&(s.right.left=s),n._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),e.length=t,s};class ct extends tb{constructor(e,t,r,i,s,o,a,l){super(e,l.getLength()),this.origin=r,this.left=t,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=l,this.info=this.content.isCountable()?vg:0}set marker(e){(this.info&Dc)>0!==e&&(this.info^=Dc)}get marker(){return(this.info&Dc)>0}get keep(){return(this.info&bg)>0}set keep(e){this.keep!==e&&(this.info^=bg)}get countable(){return(this.info&vg)>0}get deleted(){return(this.info&Rc)>0}set deleted(e){this.deleted!==e&&(this.info^=Rc)}markDeleted(){this.info|=Rc}getMissing(e,t){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=wt(t,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=wt(t,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===va&&this.id.client!==this.parent.client&&this.parent.clock>=wt(t,this.parent.client))return this.parent.client;if(this.origin&&(this.left=Pg(e,t,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=or(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===Jn||this.right&&this.right.constructor===Jn)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===ct?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===ct&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===va){const r=qc(t,this.parent);r.constructor===Jn?this.parent=null:this.parent=r.content.type}return null}integrate(e,t){if(t>0&&(this.id.clock+=t,this.left=Pg(e,e.doc.store,Pe(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(t),this.length-=t),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),Go(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(Go(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(qc(e.doc.store,i.origin)))s.has(qc(e.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),D_(e.doc.store,this),this.content.integrate(e,this),Rg(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new Jn(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:Pe(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&Go(e.origin,this.lastId)&&this.right===e&&Go(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const t=this.parent._searchMarker;return t&&t.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const t=this.parent;this.countable&&this.parentSub===null&&(t._length-=this.length),this.markDeleted(),P_(e.deleteSet,this.id.client,this.id.clock,this.length),Rg(e,t,this.parentSub),this.content.delete(e)}}gc(e,t){if(!this.deleted)throw zr();this.content.gc(e),t?oS(e,this,new Jn(this.id,this.length)):this.content=new Za(this.length)}write(e,t){const r=t>0?Pe(this.id.client,this.id.clock+t-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&VC|(r===null?0:Ja)|(i===null?0:__)|(s===null?0:JC);if(e.writeInfo(o),r!==null&&e.writeLeftID(r),i!==null&&e.writeRightID(i),r===null&&i===null){const a=this.parent;if(a._item!==void 0){const l=a._item;if(l===null){const c=rS(a);e.writeParentInfo(!0),e.writeString(c)}else e.writeParentInfo(!1),e.writeLeftID(l.id)}else a.constructor===String?(e.writeParentInfo(!0),e.writeString(a)):a.constructor===va?(e.writeParentInfo(!1),e.writeLeftID(a)):zr();s!==null&&e.writeString(s)}this.content.write(e,t)}}const rb=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},ib="__ $YJS$ __";rb[ib]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");rb[ib]=!0;const OS=ie("TOGGLE_CONNECT_COMMAND");var $S=Object.defineProperty,PS=(n,e,t)=>e in n?$S(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Q=(n,e,t)=>PS(n,typeof e!="symbol"?e+"":e,t);function IS({options:n,editedUsjRef:e,usj:t,setUsj:r}){const{view:i,nodes:s}=n||{},{hasSpacing:o,isFormattedFont:a,markerMode:l}=i||{};return x.useEffect(()=>{e.current&&!Hn(e.current,t)&&r(e.current)},[e,o,a,l,s,r,t]),null}const Uc=n=>Ne(Gm(n)),ar=dm("cid",{parse:n=>typeof n=="string"?n:void 0}),Wi=dm("segment",{parse:n=>typeof n=="string"?n:void 0}),Ru="unknown",sb=1;class ni extends ht{constructor(e="",t="",r,i){super(i),Q(this,"__tag"),Q(this,"__marker"),Q(this,"__unknownAttributes"),this.__tag=e,this.__marker=t,this.__unknownAttributes=r}static getType(){return"unknown"}static clone(e){const{__tag:t,__marker:r,__unknownAttributes:i,__key:s}=e;return new ni(t,r,i,s)}static importDOM(){return{[Ru]:e=>DS(e)?{conversion:RS,priority:1}:null}}static importJSON(e){return ob().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setTag(e.tag).setMarker(e.marker).setUnknownAttributes(e.unknownAttributes)}setTag(e){if(this.__tag===e)return this;const t=this.getWritable();return t.__tag=e,t}getTag(){return this.getLatest().__tag}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement(Ru);return e.style.display="none",e}updateDOM(){return!1}exportDOM(){return{element:null}}exportJSON(){return{...super.exportJSON(),type:this.getType(),tag:this.getTag(),marker:this.getMarker(),unknownAttributes:this.getUnknownAttributes(),version:sb}}canBeEmpty(){return!0}isInline(){return!0}extractWithChild(){return!1}excludeFromCopy(e){return e!=="clone"}}function RS(n){const e=n.getAttribute("data-tag")??"",t=n.getAttribute("data-marker")??"";return{node:ob(e,t)}}function ob(n,e,t){return Ne(new ni(n,e,t))}function DS(n){return(n==null?void 0:n.tagName)===Ru}function uo(n){return n instanceof ni}const Tl="id",ab=1;class Ft extends ht{constructor(e="",t,r){super(r),Q(this,"__marker",Tl),Q(this,"__code"),Q(this,"__unknownAttributes"),this.__code=e,this.__unknownAttributes=t}static getType(){return"book"}static clone(e){const{__code:t,__unknownAttributes:r,__key:i}=e;return new Ft(t,r,i)}static importJSON(e){const{code:t}=e;return lb(t).updateFromJSON(e)}static isValidBookCode(e){return yv(e)}updateFromJSON(e){return super.updateFromJSON(e).setCode(e.code).setUnknownAttributes(e.unknownAttributes)}getMarker(){return this.getLatest().__marker}setCode(e){if(this.__code===e)return this;const t=this.getWritable();return t.__code=e,t}getCode(){return this.getLatest().__code}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("p");return e.setAttribute("data-marker",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`),e.setAttribute("data-code",this.__code),e}updateDOM(){return!1}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),code:this.getCode(),unknownAttributes:this.getUnknownAttributes(),version:ab}}}function lb(n,e){return Ne(new Ft(n,e))}function gn(n){return n instanceof Ft}function LS(n){return(n==null?void 0:n.type)===Ft.getType()}const Oe=" ",Du="​",cb=`${Oe}|`,ef="p",Kr="+",tf="-",Qa="chapter",Lu="verse",qg="invalid",jS="text-spacing",FS="formatted-font",qS="marker-",nf="external-usj-mutation",ub="selection-change",ju="cursor-change",Fu="annotation-change",qu="delta-change",BS=[nf,ub,ju,Fu,qu],rf="c",db=1;class Qt extends ht{constructor(e="",t,r,i,s,o){super(o),Q(this,"__marker"),Q(this,"__number"),Q(this,"__sid"),Q(this,"__altnumber"),Q(this,"__pubnumber"),Q(this,"__unknownAttributes"),this.__marker=rf,this.__number=e,this.__sid=t,this.__altnumber=r,this.__pubnumber=i,this.__unknownAttributes=s}static getType(){return"chapter"}static clone(e){const{__number:t,__sid:r,__altnumber:i,__pubnumber:s,__unknownAttributes:o,__key:a}=e;return new Qt(t,r,i,s,o,a)}static importJSON(e){return fb().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setNumber(e.number).setSid(e.sid).setAltnumber(e.altnumber).setPubnumber(e.pubnumber).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}setNumber(e){if(this.__number===e)return this;const t=this.getWritable();return t.__number=e,t}getNumber(){return this.getLatest().__number}setSid(e){if(this.__sid===e)return this;const t=this.getWritable();return t.__sid=e,t}getSid(){return this.getLatest().__sid}setAltnumber(e){if(this.__altnumber===e)return this;const t=this.getWritable();return t.__altnumber=e,t}getAltnumber(){return this.getLatest().__altnumber}setPubnumber(e){if(this.__pubnumber===e)return this;const t=this.getWritable();return t.__pubnumber=e,t}getPubnumber(){return this.getLatest().__pubnumber}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("p");return e.setAttribute("data-marker",this.__marker),e.classList.add(Qa,`usfm_${this.__marker}`),e.setAttribute("data-number",this.__number),e}updateDOM(){return!1}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),number:this.getNumber(),sid:this.getSid(),altnumber:this.getAltnumber(),pubnumber:this.getPubnumber(),unknownAttributes:this.getUnknownAttributes(),version:db}}}function fb(n,e,t,r,i){return Ne(new Qt(n,e,t,r,i))}function sf(n){return n instanceof Qt}function WS(n){return(n==null?void 0:n.type)===Qt.getType()}const hb=["fr","fq","fqa","fk","ft","fl","fw","fp","fv","fdc","fm"],gb=["xo","xop","xk","xq","xt","xta","xot","xnt","xdc"],US=["ca","cp","va","vp","add","bk","dc","em","jmp","k","nd","ord","pn","png","qt","rb","rq","sig","sls","tl","w","wa","wg","wh","wj","bd","it","bdit","no","sc","sup","ior","iqt","qac","qs","litl","lik","liv","liv1","liv2","liv3","liv4","liv5",...hb,...gb],pb=1;class Ie extends ht{constructor(e="",t,r){super(r),Q(this,"__marker"),Q(this,"__unknownAttributes"),this.__marker=e,this.__unknownAttributes=t}static getType(){return"char"}static clone(e){const{__marker:t,__unknownAttributes:r,__key:i}=e;return new Ie(t,r,i)}static importDOM(){return{span:e=>KS(e)?{conversion:zS,priority:1}:null}}static importJSON(e){return Mn().updateFromJSON(e)}static isValidMarker(e){return e!==void 0&&US.includes(e)}static isValidFootnoteMarker(e){return e!==void 0&&hb.includes(e)}static isValidCrossReferenceMarker(e){return e!==void 0&&gb.includes(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("span");return e.setAttribute("data-marker",this.__marker),e.setAttribute("title",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`),e}updateDOM(){return!1}exportDOM(e){const{element:t}=super.exportDOM(e);return t&&Te(t)&&(t.setAttribute("data-marker",this.getMarker()),t.classList.add(this.getType(),`usfm_${this.getMarker()}`)),{element:t}}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),unknownAttributes:this.getUnknownAttributes(),version:pb}}canBeEmpty(){return!1}isInline(){return!0}}function zS(n){const e=n.getAttribute("data-marker")??"f";return{node:Mn(e)}}function Mn(n,e){return Ne(new Ie(n,e))}function KS(n){if(!n)return!1;const e=n.getAttribute("data-marker")??"";return Ie.isValidMarker(e)&&n.classList.contains(Ie.getType())}function Le(n){return n instanceof Ie}function HS(n){return(n==null?void 0:n.type)===Ie.getType()}const mb=1,JS="c",yb="span";class qn extends hr{constructor(e="",t=!1,r,i,s,o,a){super(a),Q(this,"__marker"),Q(this,"__number"),Q(this,"__showMarker"),Q(this,"__sid"),Q(this,"__altnumber"),Q(this,"__pubnumber"),Q(this,"__unknownAttributes"),this.__marker=JS,this.__number=e,this.__showMarker=t,this.__sid=r,this.__altnumber=i,this.__pubnumber=s,this.__unknownAttributes=o}static getType(){return"immutable-chapter"}static clone(e){const{__number:t,__showMarker:r,__sid:i,__altnumber:s,__pubnumber:o,__unknownAttributes:a,__key:l}=e;return new qn(t,r,i,s,o,a,l)}static importDOM(){return{span:e=>_b(e)?{conversion:VS,priority:1}:null}}static importJSON(e){return of().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setNumber(e.number).setShowMarker(e.showMarker).setSid(e.sid).setAltnumber(e.altnumber).setPubnumber(e.pubnumber).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}setNumber(e){if(this.__number===e)return this;const t=this.getWritable();return t.__number=e,t}getNumber(){return this.getLatest().__number}setShowMarker(e=!1){if(this.__showMarker===e)return this;const t=this.getWritable();return t.__showMarker=e,t}getShowMarker(){return this.getLatest().__showMarker}setSid(e){if(this.__sid===e)return this;const t=this.getWritable();return t.__sid=e,t}getSid(){return this.getLatest().__sid}setAltnumber(e){if(this.__altnumber===e)return this;const t=this.getWritable();return t.__altnumber=e,t}getAltnumber(){return this.getLatest().__altnumber}setPubnumber(e){if(this.__pubnumber===e)return this;const t=this.getWritable();return t.__pubnumber=e,t}getPubnumber(){return this.getLatest().__pubnumber}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement(yb);return e.setAttribute("data-marker",this.__marker),e.classList.add(Qa,`usfm_${this.__marker}`),this.__showMarker&&e.classList.add("marker"),e.setAttribute("data-number",this.__number),e}updateDOM(){return!1}exportDOM(e){const{element:t}=super.exportDOM(e);return t&&Te(t)&&(t.setAttribute("data-marker",this.getMarker()),t.classList.add(Qa,`usfm_${this.getMarker()}`),t.setAttribute("data-number",this.getNumber())),{element:t}}decorate(){return this.getShowMarker()?ho(this.getMarker(),this.getNumber()):this.getNumber()}exportJSON(){return{type:this.getType(),marker:this.getMarker(),number:this.getNumber(),showMarker:this.getShowMarker(),sid:this.getSid(),altnumber:this.getAltnumber(),pubnumber:this.getPubnumber(),unknownAttributes:this.getUnknownAttributes(),version:mb}}isInline(){return!1}isKeyboardSelectable(){return!1}}function VS(n){const e=n.getAttribute("data-number")??"0";return{node:of(e)}}function of(n,e,t,r,i,s){return Ne(new qn(n,e,t,r,i,s))}function _b(n){return n?n.classList.contains(Qa)&&n.tagName.toLowerCase()===yb:!1}function fo(n){return n instanceof qn}function GS(n){return(n==null?void 0:n.type)===qn.getType()}const bb=1;class lr extends Gi{static getType(){return"implied-para"}static clone(e){return new lr(e.__key)}static importJSON(e){return Jt().updateFromJSON(e)}getMarker(){return ef}exportJSON(){return{...super.exportJSON(),type:this.getType(),version:bb}}insertNewAfter(e,t){const r=Jt();return r.setTextFormat(e.format),r.setTextStyle(e.style),r.setDirection(this.getDirection()),r.setFormat(this.getFormatType()),r.setStyle(this.getTextStyle()),r.setIndent(this.getIndent()),this.insertAfter(r,t),r}}function Jt(){return Ne(new lr)}function Ln(n){return n instanceof lr}function af(n){return(n==null?void 0:n.type)===lr.getType()}const Hr="zmsc-s",Ci="zmsc-e",YS=[Hr,Ci],XS=["ts-s","ts-e","t-s","t-e","ts","qt1-s","qt1-e","qt2-s","qt2-e","qt3-s","qt3-e","qt4-s","qt4-e","qt5-s","qt5-e","qt-s","qt-e",Hr,Ci],vb=1;class pn extends hr{constructor(e="",t,r,i,s){super(s),Q(this,"__marker"),Q(this,"__sid"),Q(this,"__eid"),Q(this,"__unknownAttributes"),this.__marker=e,this.__sid=t,this.__eid=r,this.__unknownAttributes=i}static getType(){return"ms"}static clone(e){const{__marker:t,__sid:r,__eid:i,__unknownAttributes:s,__key:o}=e;return new pn(t,r,i,s,o)}static importJSON(e){return kb().updateFromJSON(e)}static isValidMarker(e){return e!==void 0&&(XS.includes(e)||e.startsWith("z"))}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setSid(e.sid).setEid(e.eid).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}setSid(e){if(this.__sid===e)return this;const t=this.getWritable();return t.__sid=e,t}getSid(){return this.getLatest().__sid}setEid(e){if(this.__eid===e)return this;const t=this.getWritable();return t.__eid=e,t}getEid(){return this.getLatest().__eid}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("span");return e.setAttribute("data-marker",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`),e}updateDOM(){return!1}decorate(){return""}exportJSON(){return{type:this.getType(),marker:this.getMarker(),sid:this.getSid(),eid:this.getEid(),unknownAttributes:this.getUnknownAttributes(),version:vb}}isKeyboardSelectable(){return!1}}function ZS(n){return YS.includes(n)}function kb(n,e,t,r){return Ne(new pn(n,e,t,r))}function El(n){return n instanceof pn}const wb="f",QS=[wb,"fe","ef","x","ex"],xb=1;class ft extends ht{constructor(e=wb,t,r=!0,i,s,o){super(o),Q(this,"__marker"),Q(this,"__caller"),Q(this,"__isCollapsed"),Q(this,"__category"),Q(this,"__unknownAttributes"),this.__marker=e,this.__caller=t??(e==="x"||e==="ex"?tf:Kr),this.__isCollapsed=r,this.__category=i,this.__unknownAttributes=s}static getType(){return"note"}static clone(e){const{__marker:t,__caller:r,__isCollapsed:i,__category:s,__unknownAttributes:o,__key:a}=e;return new ft(t,r,i,s,o,a)}static importDOM(){return{span:e=>t1(e)?{conversion:e1,priority:1}:null}}static importJSON(e){return lf().updateFromJSON(e)}static isValidMarker(e){return e!==void 0&&QS.includes(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setCaller(e.caller).setIsCollapsed(e.isCollapsed).setCategory(e.category).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}setCaller(e){if(this.__caller===e)return this;const t=this.getWritable();return t.__caller=e,t}getCaller(){return this.getLatest().__caller}setIsCollapsed(e){if(this.__isCollapsed===e)return this;const t=this.getWritable();return t.__isCollapsed=e,t}toggleIsCollapsed(){const e=this.getWritable();return e.__isCollapsed=!e.__isCollapsed,e}getIsCollapsed(){return this.getLatest().__isCollapsed}setCategory(e){if(this.__category===e)return this;const t=this.getWritable();return t.__category=e,t}getCategory(){return this.getLatest().__category}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("span");return e.setAttribute("data-marker",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`,this.__isCollapsed?"collapsed":"expanded"),e.setAttribute("data-caller",this.__caller),e}updateDOM(e){return e.__isCollapsed!==this.__isCollapsed}exportDOM(e){const{element:t}=super.exportDOM(e);return t&&Te(t)&&(t.setAttribute("data-marker",this.getMarker()),t.classList.add(this.getType(),`usfm_${this.getMarker()}`,this.getIsCollapsed()?"collapsed":"expanded"),t.setAttribute("data-caller",this.getCaller())),{element:t}}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),caller:this.getCaller(),isCollapsed:this.getIsCollapsed(),category:this.getCategory(),unknownAttributes:this.getUnknownAttributes(),version:xb}}canBeEmpty(){return!1}isInline(){return!0}}function e1(n){const e=n.getAttribute("data-marker")??"f",t=n.getAttribute("data-caller")??"",r=n.classList.contains("collapsed");return{node:lf(e,t,r)}}function lf(n,e,t,r,i){return Ne(new ft(n,e,t,r,i))}function t1(n){if(!n)return!1;const e=n.getAttribute("data-marker")??"";return ft.isValidMarker(e)&&n.classList.contains(ft.getType())}function we(n){return n instanceof ft}const n1=["ide","sts","rem","h","toc1","toc2","toc3","toca1","toca2","toca3","imt","imt1","imt2","imt3","imt4","is","is1","is2","ip","ipi","im","imi","ipq","imq","ipr","iq","iq1","iq2","iq3","ili","ili1","ili2","ib","iot","io","io1","io2","io3","io4","iex","imte","imte1","imte2","ie","mt","mt1","mt2","mt3","mt4","mte","mte1","mte2","cl","cd","ms","ms1","ms2","ms3","mr","s","s1","s2","s3","s4","sr","r","d","sp","sd","sd1","sd2","sd3","sd4",ef,"m","po","cls","pr","pc","pm","pmo","pmc","pmr","pi","pi1","pi2","pi3","mi","lit","nb","q","q1","q2","q3","q4","qr","qc","qa","qm","qm1","qm2","qm3","qd","b","lh","li","li1","li2","li3","li4","lf","lim","lim1","lim2","lim3","lim4","pb"],Cb=1;class St extends Gi{constructor(e=ef,t,r){super(r),Q(this,"__marker"),Q(this,"__unknownAttributes"),this.__marker=e,this.__unknownAttributes=t}static getType(){return"para"}static clone(e){const{__marker:t,__unknownAttributes:r,__key:i}=e;return new St(t,r,i)}static importDOM(){return{p:()=>({conversion:r1,priority:1})}}static importJSON(e){return Xs().updateFromJSON(e)}static isValidMarker(e){return e!==void 0&&n1.includes(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("p");return e.setAttribute("data-marker",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`),e}exportDOM(e){const{element:t}=super.exportDOM(e);return t&&Te(t)&&(t.setAttribute("data-marker",this.getMarker()),t.classList.add(this.getType(),`usfm_${this.getMarker()}`)),{element:t}}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),unknownAttributes:this.getUnknownAttributes(),version:Cb}}insertNewAfter(e,t){const r=Xs(this.getMarker());return r.setTextFormat(e.format),r.setTextStyle(e.style),r.setDirection(this.getDirection()),r.setFormat(this.getFormatType()),r.setStyle(this.getTextStyle()),r.setIndent(this.getIndent()),this.insertAfter(r,t),r}}function r1(n){const e=n.getAttribute("data-marker")??void 0,t=Xs(e);if(n.style){t.setFormat(n.style.textAlign);const r=parseInt(n.style.textIndent,10)/20;r>0&&t.setIndent(r)}return{node:t}}function Xs(n,e){return Ne(new St(n,e))}function ut(n){return n instanceof St}function i1(n){return(n==null?void 0:n.type)===St.getType()}const cf="v",Sb=1;class _t extends At{constructor(e="",t,r,i,s,o,a){super(t??e,a),Q(this,"__marker"),Q(this,"__number"),Q(this,"__sid"),Q(this,"__altnumber"),Q(this,"__pubnumber"),Q(this,"__unknownAttributes"),this.__marker=cf,this.__number=e,this.__sid=r,this.__altnumber=i,this.__pubnumber=s,this.__unknownAttributes=o}static getType(){return"verse"}static clone(e){const{__number:t,__text:r,__sid:i,__altnumber:s,__pubnumber:o,__unknownAttributes:a,__key:l}=e;return new _t(t,r,i,s,o,a,l)}static importJSON(e){return Tb().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setNumber(e.number).setSid(e.sid).setAltnumber(e.altnumber).setPubnumber(e.pubnumber).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}setNumber(e){if(this.__number===e)return this;const t=this.getWritable();return t.__number=e,t}getNumber(){return this.getLatest().__number}setSid(e){if(this.__sid===e)return this;const t=this.getWritable();return t.__sid=e,t}getSid(){return this.getLatest().__sid}setAltnumber(e){if(this.__altnumber===e)return this;const t=this.getWritable();return t.__altnumber=e,t}getAltnumber(){return this.getLatest().__altnumber}setPubnumber(e){if(this.__pubnumber===e)return this;const t=this.getWritable();return t.__pubnumber=e,t}getPubnumber(){return this.getLatest().__pubnumber}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(e){const t=super.createDOM(e);return t.setAttribute("data-marker",this.__marker),t.classList.add(Lu,`usfm_${this.__marker}`),t.setAttribute("data-number",this.__number),t}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),number:this.getNumber(),sid:this.getSid(),altnumber:this.getAltnumber(),pubnumber:this.getPubnumber(),unknownAttributes:this.getUnknownAttributes(),version:Sb}}}function Tb(n,e,t,r,i,s){return Ne(new _t(n,e,t,r,i,s))}function uf(n){return n instanceof _t}function s1(n){return(n==null?void 0:n.type)===_t.getType()}function o1(n){return WS(n)||GS(n)}function Dt(n){return sf(n)||fo(n)}function a1(n,e){return n.find(t=>Dt(t)&&t.getNumber()===e.toString())}function l1(n,e=!1){return n.find((t,r)=>(!e||r>0)&&Dt(t))}function df(n){var e;if(!n)return;if(Dt(n))return n;let t=(e=n.getTopLevelElement())==null?void 0:e.getPreviousSibling();for(;t&&!Dt(t);)t=t.getPreviousSibling();if(t&&Dt(t))return t}function Eb(n){let e=n;for(;e!==null;){if(we(e))return e;e=e.getParent()}}function c1(n){return gn(n)||sf(n)||Le(n)||fo(n)||Ln(n)||El(n)||ut(n)||we(n)||uf(n)||uo(n)}function u1(n){var e;if(n.anchor.type==="element"){const r=n.anchor.getNode(),i=n.anchor.offset;if(i<r.getChildrenSize())return r.getChildAtIndex(i)}const t=n.anchor.getNode();return t.getNextSibling()??((e=t.getParent())==null?void 0:e.getNextSibling())??null}function d1(n){var e;const t=n.anchor.offset;if(n.anchor.type==="element"&&t>0)return n.anchor.getNode().getChildAtIndex(t-1);const r=n.anchor.getNode();return r.getPreviousSibling()??((e=r.getParent())==null?void 0:e.getPreviousSibling())??null}function zt(n){return ut(n)||Ln(n)}function Bu(n,e){const t=Mi(e,ar),r=!!(n.cid&&t),i=!n.cid&&!t;return n.style===e.getMarker()&&(i||r&&n.cid===t)}function f1(n,e){const t=L(n)?n:n.getParent(),r=L(e)?e:e.getParent(),i=t&&r?Rs(t,r):void 0;return i?i.commonAncestor:void 0}function h1(n){const e=n.getStartEndPoints();if(!e)return;const[t,r]=e,i=n.isBackward()?t:r;n.focus.set(i.key,i.offset,i.type),n.anchor.set(i.key,i.offset,i.type)}function ff(n){return(n==null?void 0:n.type)===At.getType()}function g1(n,e){if(!e)return;const t=n.findIndex(r=>r===e);t&&(n.length=t)}function p1(n,e){if(!e)return n;const t=e.getIndexWithinParent();return n.splice(t+1,n.length-t-1)}function pr(n){return`\\${n}`}function Zs(n){return`\\${n}*`}function Nb(n,e,t){const r=pr(n);if(e!=null&&e.startsWith(r)){const i=parseInt(e.slice(r.length),10);isNaN(i)||(t=i.toString())}return t}function ho(n,e){let t=pr(n);return e&&(t+=`${Oe}${e}`),t+=" ",t}function Mb(n){return ff(n)?n.text:HS(n)?n.children.map(e=>Mb(e)).join(""):""}function m1(n){return n.map(e=>Mb(e)).join(" ").trim()}function hf(n){return Oe+n+" "}function gf(n){return n.reduce((e,t)=>e+(Le(t)?` ${t.getTextContent()}`:""),"").trim()}function Ve(n,e=vv){const t={...n};return e.forEach(r=>{Reflect.deleteProperty(t,r)}),Object.keys(t).length===0?void 0:t}function y1(n,e){const t=e.getElementByKey(n.getKey());return t?t.tagName.toLowerCase():void 0}function We(n){return Object.fromEntries(Object.entries(n).filter(([,e])=>e!==void 0))}function Ab(n){if(!n)return;const e=n.getNodes();if(e.length>0)return n.isBackward()?e[e.length-1]:e[0]}function Wu(n,e){if(!e)return(n+1).toString();const t=e.split("-");if(t.length===2)return parseInt(t[1])?`${parseInt(t[1])+1}`:`${parseInt(t[0])+1}`;const r=RegExp(/^(\d+)([a-yA-Y]{1,3})$/).exec(e);if(!r)return(parseInt(e)+1).toString();const i=String.fromCharCode(r[2].charCodeAt(0)+1);return`${r[1]}${i}`}function pf(n,e){if(!e)return!1;const t=e.split("-").map(r=>parseInt(r));if(t.length<1||t.length>2||t[0]>t[1])throw new Error("isVerseInRange: invalid range");return t.length===1?n===t[0]:t.length===2&&isNaN(t[1])?n>=t[0]:(t.length===2&&isNaN(t[0])||n>=t[0])&&n<=t[1]}function _1(n){return!!n&&n.includes("-")}const b1=1;class ri extends At{constructor(e="",t="opening",r){super(zc(e,t),r),Q(this,"__marker"),Q(this,"__markerSyntax"),this.__marker=e,this.__markerSyntax=t}static getType(){return"marker"}static clone(e){return new ri(e.__marker,e.__markerSyntax,e.__key)}static importJSON(e){return Uu().updateFromJSON(e)}updateFromJSON(e){const{marker:t,markerSyntax:r="opening"}=e;return super.updateFromJSON(e).setMarker(t).setMarkerSyntax(r)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t.__text=zc(e,t.__markerSyntax),t}getMarker(){return this.getLatest().__marker}setMarkerSyntax(e){if(this.__markerSyntax===e)return this;const t=this.getWritable();return t.__markerSyntax=e,t.__text=zc(t.__marker,e),t}getMarkerSyntax(){return this.getLatest().__markerSyntax}createDOM(e){const t=super.createDOM(e);return t.setAttribute("data-marker",this.__marker),t.classList.add(this.__markerSyntax),t}exportJSON(){return{...super.exportJSON(),type:this.getType(),text:this.getTextContent(),marker:this.getMarker(),markerSyntax:this.getMarkerSyntax(),version:b1}}}function Uu(n,e){return Ne(new ri(n,e))}function go(n){return n instanceof ri}function zc(n,e){return e==="closing"?Zs(n):e==="selfClosing"?Zs(""):pr(n)}const Zn="internal-comment",v1=[Zn],k1={},w1=1;class et extends ht{constructor(e=k1,t){super(t),Q(this,"__typedIDs"),this.__typedIDs=e}static getType(){return"typed-mark"}static clone(e){const t=JSON.parse(JSON.stringify(e.__typedIDs));return new et(t,e.__key)}static isReservedType(e){return v1.includes(e)}static importDOM(){return null}static importJSON(e){return Qs().updateFromJSON(e)}exportJSON(){return{...super.exportJSON(),type:this.getType(),typedIDs:this.getTypedIDs(),version:w1}}createDOM(e){const t=document.createElement("mark");for(const[r,i]of Object.entries(this.__typedIDs))lt(t,Zo(e.theme.typedMark,r)),i.length>1&&lt(t,Zo(e.theme.typedMarkOverlap,r));return t}updateDOM(e,t,r){for(const[i,s]of Object.entries(this.__typedIDs)){const o=e.__typedIDs[i].length,a=s.length,l=Zo(r.theme.typedMark,i),c=Zo(r.theme.typedMarkOverlap,i);o!==a&&(o===0?a===1&&lt(t,l):a===0&&Rr(t,l),o===1?a===2&&lt(t,c):a===1&&Rr(t,c))}return!1}updateFromJSON(e){return super.updateFromJSON(e).setTypedIDs(e.typedIDs)}hasID(e,t){const r=this.getTypedIDs()[e];if(!r)return!1;for(const i of r)if(t===i)return!0;return!1}getTypedIDs(){const e=this.getLatest();return nt(e)?e.__typedIDs:{}}setTypedIDs(e){const t=this.getWritable();return t.__typedIDs=e,t}addID(e,t){const r=this.getWritable();if(!nt(r))return;const i=r.__typedIDs[e]??[];r.__typedIDs[e]=i;for(const s of i)if(t===s)return;i.push(t)}deleteID(e,t){const r=this.getWritable();if(!nt(r))return;const i=r.__typedIDs[e];for(let s=0;s<i.length;s++)if(t===i[s]){i.splice(s,1);return}}hasNoIDsForEveryType(){return Object.values(this.getTypedIDs()).every(e=>e===void 0||e.length===0)}insertNewAfter(e,t=!0){const r=Qs(this.__typedIDs);return this.insertAfter(r,t),r}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}canBeEmpty(){return!1}isInline(){return!0}extractWithChild(e,t,r){if(!B(t)||r==="html")return!1;const i=t.anchor,s=t.focus,o=i.getNode(),a=s.getNode(),l=t.isBackward()?i.offset-s.offset:s.offset-i.offset;return this.isParentOf(o)&&this.isParentOf(a)&&this.getTextContent().length===l}excludeFromCopy(e){return e!=="clone"}}function Zo(n,e){return`${n}-${e}`}function Qs(n){return Ne(new et(n))}function nt(n){return n instanceof et}function x1(n){return(n==null?void 0:n.type)===et.getType()}function Ob(n){const e=n.getChildren();let t=null;for(const r of e)t===null?n.insertBefore(r):t.insertAfter(r),t=r;n.remove()}function $b(n,e,t,r){const i=n.getNodes(),s=n.anchor.offset,o=n.focus.offset,a=i.length,l=n.isBackward(),c=l?o:s,u=l?s:o;let f,d;for(let g=0;g<a;g++){const p=i[g];if(L(d)&&d.isParentOf(p))continue;const m=g===0,y=g===a-1;let v=null;if(U(p)){const _=p.getTextContentSize(),w=m?c:0,E=y?u:_;if(w===0&&E===0)continue;const $=p.splitText(w,E);v=$.length>1&&($.length===3||m&&!y||E===_)?$[1]:$[0]}else{if(nt(p))continue;L(p)&&p.isInline()&&(v=p)}if(v!==null){if(v&&v.is(f))continue;const _=v.getParent();(_==null||!_.is(f))&&(d=void 0),f=_,d===void 0&&(d=Qs({[e]:[t]}),v.insertBefore(d)),d.append(v)}else f=void 0,d=void 0}e===Zn&&L(d)&&(l?d.selectStart():d.selectEnd())}function C1(n,e,t){let r=n;for(;r!==null;){if(nt(r))return r.getTypedIDs()[e];if(U(r)&&t===r.getTextContentSize()){const i=r.getNextSibling();if(nt(i))return i.getTypedIDs()[e]}r=r.getParent()}}function Bg(n){return`external-${n}`}const Pb=1;class mr extends hr{constructor(e="",t="",r){super(r),Q(this,"__textType"),Q(this,"__text"),this.__textType=e,this.__text=t}static getType(){return"immutable-typed-text"}static clone(e){const{__textType:t,__text:r,__key:i}=e;return new mr(t,r,i)}static importDOM(){return{span:e=>T1(e)?{conversion:S1,priority:1}:null}}static importJSON(e){return el().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setTextType(e.textType).setTextContent(e.text)}setTextType(e){if(this.__textType===e)return this;const t=this.getWritable();return t.__textType=e,t}getTextType(){return this.getLatest().__textType}setTextContent(e){if(this.__text===e)return this;const t=this.getWritable();return t.__text=e,t}getTextContent(){return this.getLatest().__text}createDOM(){const e=document.createElement("span");return e.setAttribute("data-text-type",this.__textType),e.classList.add(this.__textType),e}updateDOM(){return!1}exportDOM(e){const{element:t}=super.exportDOM(e);return t&&Te(t)&&t.setAttribute("data-text-type",this.getTextType()),{element:t}}decorate(){return this.getTextContent()}exportJSON(){return{type:this.getType(),textType:this.getTextType(),text:this.getTextContent(),version:Pb}}isKeyboardSelectable(){return!1}}function S1(n){const e=n.getAttribute("data-text-type")??"",t=n.textContent??"";return{node:el(e,t)}}function el(n,e){return Ne(new mr(n,e))}function T1(n){return(n==null?void 0:n.tagName)==="span"}function tl(n){return n instanceof mr}function E1(n){return(n==null?void 0:n.type)===mr.getType()}const nl="unmatched",Ib=1;class yr extends hr{constructor(e="",t){super(t),Q(this,"__marker"),this.__marker=e}static getType(){return"unmatched"}static clone(e){const{__marker:t,__key:r}=e;return new yr(t,r)}static importDOM(){return{[nl]:e=>M1(e)?{conversion:N1,priority:1}:null}}static importJSON(e){return Rb().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}createDOM(){const e=document.createElement(nl);e.setAttribute("data-marker",this.__marker),e.classList.add(qg);const t=this.__marker.endsWith("*");return e.title=t?"This closing marker has no matching opening marker!":"This opening marker has no matching closing marker!",e}updateDOM(){return!1}exportDOM(e){const{element:t}=super.exportDOM(e);return t&&Te(t)&&(t.setAttribute("data-marker",this.getMarker()),t.classList.add(qg)),{element:t}}decorate(){return`\\${this.getMarker()}${Du}`}exportJSON(){return{type:this.getType(),marker:this.getMarker(),version:Ib}}isKeyboardSelectable(){return!1}}function N1(n){const e=n.getAttribute("data-marker")??"";return{node:Rb(e)}}function Rb(n){return Ne(new yr(n))}function M1(n){return(n==null?void 0:n.tagName)===nl}function A1(n){return n instanceof yr}const O1=[Ft,qn,Qt,_t,Ie,ft,pn,ri,ni,mr,yr,St,lr,{replace:Gi,with:()=>Jt(),withKlass:lr}];var O;(function(n){n.FileIdentification="FileIdentification",n.Headers="Headers",n.Remarks="Remarks",n.Introduction="Introduction",n.DivisionMarks="DivisionMarks",n.Paragraphs="Paragraphs",n.Poetry="Poetry",n.TitlesHeadings="TitlesHeadings",n.Tables="Tables",n.CenterTables="CenterTables",n.RightTables="RightTables",n.Lists="Lists",n.Footnotes="Footnotes",n.CrossReferences="CrossReferences",n.SpecialText="SpecialText",n.CharacterStyling="CharacterStyling",n.Breaks="Breaks",n.SpecialFeatures="SpecialFeatures",n.PeripheralReferences="PeripheralReferences",n.PeripheralMaterials="PeripheralMaterials",n.Uncategorized="Uncategorized"})(O||(O={}));var A;(function(n){n.Paragraph="Paragraph",n.Character="Character",n.Note="Note",n.Unknown="Unknown"})(A||(A={}));const $1={id:{category:O.FileIdentification,type:A.Paragraph,description:"File identification information (BOOKID, FILENAME, EDITOR, MODIFICATION DATE)",hasEndMarker:!1,children:{FileIdentification:["usfm","ide"],Headers:["h","h1","h2","h3","toc1","toc2","toc3"],Remarks:["rem","sts","restore"],Introduction:["imt","imt1","imt2","imt3","imt4","imte","imte1","imte2","is","is1","is2","iot","io","io1","io2","io3","io4","ior","ip","im","ipi","imi","ili","ili1","ili2","ipq","imq","ipr","ib","iq","iq1","iq2","iq3","iex","ie"],DivisionMarks:["c","cl"],TitlesHeadings:["mt","mt1","mt2","mt3","mt4"]}},usfm:{category:O.FileIdentification,type:A.Paragraph,description:"File markup version information",hasEndMarker:!1,children:void 0},ide:{category:O.FileIdentification,type:A.Paragraph,description:"File encoding information",hasEndMarker:!1,children:{Remarks:["rem","sts"]}},h:{category:O.Headers,type:A.Paragraph,description:"Running header text for a book (basic)",hasEndMarker:!1,children:{Headers:["toc1","toc2","toc3","toca1","toca2","toca3"]}},h1:{category:O.Headers,type:A.Paragraph,description:"Running header text",hasEndMarker:!1,children:{Headers:["toc1","toc2","toc3","toca1","toca2","toca3"]}},h2:{category:O.Headers,type:A.Paragraph,description:"Running header text, left side of page",hasEndMarker:!1,children:{Headers:["toc1","toc2","toc3","toca1","toca2","toca3"]}},h3:{category:O.Headers,type:A.Paragraph,description:"Running header text, right side of page",hasEndMarker:!1,children:{Headers:["toc1","toc2","toc3","toca1","toca2","toca3"]}},toc1:{category:O.Headers,type:A.Paragraph,description:"Long table of contents text",hasEndMarker:!1,children:void 0},toc2:{category:O.Headers,type:A.Paragraph,description:"Short table of contents text",hasEndMarker:!1,children:void 0},toc3:{category:O.Headers,type:A.Paragraph,description:"Book Abbreviation",hasEndMarker:!1,children:void 0},toca1:{category:O.Headers,type:A.Paragraph,description:"Alternative language long table of contents text",hasEndMarker:!1,children:void 0},toca2:{category:O.Headers,type:A.Paragraph,description:"Alternative language short table of contents text",hasEndMarker:!1,children:void 0},toca3:{category:O.Headers,type:A.Paragraph,description:"Alternative language book Abbreviation",hasEndMarker:!1,children:void 0},rem:{category:O.Remarks,type:A.Paragraph,description:"Comments and remarks",hasEndMarker:!1,children:void 0},sts:{category:O.Remarks,type:A.Paragraph,description:"Status of this file",hasEndMarker:!1,children:void 0},restore:{category:O.Remarks,type:A.Paragraph,description:"Project restore information",hasEndMarker:!1,children:void 0},imt:{category:O.Introduction,type:A.Paragraph,description:"Introduction major title, level 1 (if single level) (basic)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imt1:{category:O.Introduction,type:A.Paragraph,description:"Introduction major title, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imt2:{category:O.Introduction,type:A.Paragraph,description:"Introduction major title, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imt3:{category:O.Introduction,type:A.Paragraph,description:"Introduction major title, level 3",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imt4:{category:O.Introduction,type:A.Paragraph,description:"Introduction major title, level 4 (usually within parenthesis)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imte:{category:O.Introduction,type:A.Paragraph,description:"Introduction major title at introduction end, level 1 (if single level)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imte1:{category:O.Introduction,type:A.Paragraph,description:"Introduction major title at introduction end, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imte2:{category:O.Introduction,type:A.Paragraph,description:"Introduction major title at introduction end, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},is:{category:O.Introduction,type:A.Paragraph,description:"Introduction section heading, level 1 (if single level) (basic)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"],CharacterStyling:["no"]}},is1:{category:O.Introduction,type:A.Paragraph,description:"Introduction section heading, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},is2:{category:O.Introduction,type:A.Paragraph,description:"Introduction section heading, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},iot:{category:O.Introduction,type:A.Paragraph,description:"Introduction outline title (basic)",hasEndMarker:!1,children:{Introduction:["iqt"],CharacterStyling:["no"]}},io:{category:O.Introduction,type:A.Paragraph,description:"Introduction outline text, level 1 (if single level)",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},io1:{category:O.Introduction,type:A.Paragraph,description:"Introduction outline text, level 1 (if multiple levels) (basic)",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},io2:{category:O.Introduction,type:A.Paragraph,description:"Introduction outline text, level 2",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},io3:{category:O.Introduction,type:A.Paragraph,description:"Introduction outline text, level 3",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},io4:{category:O.Introduction,type:A.Paragraph,description:"Introduction outline text, level 4",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ior:{category:O.Introduction,type:A.Character,description:"Introduction references range for outline entry; for marking references separately",hasEndMarker:!0,children:void 0},ip:{category:O.Introduction,type:A.Paragraph,description:"Introduction prose paragraph (basic)",hasEndMarker:!1,children:{Introduction:["iqt"],Footnotes:["f","fe","fm"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},im:{category:O.Introduction,type:A.Paragraph,description:"Introduction prose paragraph, with no first line indent (may occur after poetry)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ipi:{category:O.Introduction,type:A.Paragraph,description:"Introduction prose paragraph, indented, with first line indent",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},imi:{category:O.Introduction,type:A.Paragraph,description:"Introduction prose paragraph text, indented, with no first line indent",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ili:{category:O.Introduction,type:A.Paragraph,description:"A list entry, level 1 (if single level)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ili1:{category:O.Introduction,type:A.Paragraph,description:"A list entry, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ili2:{category:O.Introduction,type:A.Paragraph,description:"A list entry, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ipq:{category:O.Introduction,type:A.Paragraph,description:"Introduction prose paragraph, quote from the body text",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},imq:{category:O.Introduction,type:A.Paragraph,description:"Introduction prose paragraph, quote from the body text, with no first line indent",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ipr:{category:O.Introduction,type:A.Paragraph,description:"Introduction prose paragraph, right aligned",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},ib:{category:O.Introduction,type:A.Paragraph,description:"Introduction blank line",hasEndMarker:!1,children:{Introduction:["iqt"]}},iq:{category:O.Introduction,type:A.Paragraph,description:"Introduction poetry text, level 1 (if single level)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},iq1:{category:O.Introduction,type:A.Paragraph,description:"Introduction poetry text, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},iq2:{category:O.Introduction,type:A.Paragraph,description:"Introduction poetry text, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},iq3:{category:O.Introduction,type:A.Paragraph,description:"Introduction poetry text, level 3",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},iex:{category:O.Introduction,type:A.Paragraph,description:"Introduction explanatory or bridge text (e.g. explanation of missing book in Short Old Testament)",hasEndMarker:!1,children:{Introduction:["iqt"],CharacterStyling:["no"]}},iqt:{category:O.Introduction,type:A.Character,description:"For quoted scripture text appearing in the introduction",hasEndMarker:!0,children:void 0},ie:{category:O.Introduction,type:A.Paragraph,description:"Introduction ending marker",hasEndMarker:!1,children:void 0},c:{category:O.DivisionMarks,type:A.Paragraph,description:"Chapter number",hasEndMarker:!1,children:{DivisionMarks:["ca","cp","cl","cd"],Paragraphs:["p","m","po","pr","cls","pi","pi1","pi2","pi3","pc","mi","nb"],Poetry:["q","q1","q2","q3","q4","qc","qr","qa","qd","b"],TitlesHeadings:["mte","ms","ms1","ms2","ms3","s","s1","s2","s3","s4","r","sp","d","sd","sd1","sd2","sd3","sd4"],Lists:["lh","li","li1","li2","li3","li4","lf","lim","lim1","lim2","lim3","lim4"],Footnotes:["f","fe"],SpecialText:["lit"],Breaks:["pb"]}},ca:{category:O.DivisionMarks,type:A.Character,description:"Second (alternate) chapter number (for coding dual versification; useful for places where different traditions of chapter breaks need to be supported in the same translation)",hasEndMarker:!0,children:void 0},cp:{category:O.DivisionMarks,type:A.Paragraph,description:"Published chapter number (chapter string that should appear in the published text)",hasEndMarker:!1,children:{Footnotes:["f"]}},cl:{category:O.DivisionMarks,type:A.Paragraph,description:"Chapter label used for translations that add a word such as 'Chapter' before chapter numbers (e.g. Psalms). The subsequent text is the chapter label.",hasEndMarker:!1,children:void 0},cd:{category:O.DivisionMarks,type:A.Paragraph,description:"Chapter Description (Publishing option D, e.g. in Russian Bibles)",hasEndMarker:!1,children:{DivisionMarks:["vp"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},v:{category:O.DivisionMarks,type:A.Character,description:"A verse number",hasEndMarker:!1,children:void 0},va:{category:O.DivisionMarks,type:A.Character,description:"Second (alternate) verse number (for coding dual numeration in Psalms; see also NRSV Exo 22.1-4)",hasEndMarker:!0,children:void 0},vp:{category:O.DivisionMarks,type:A.Character,description:"Published verse marker (verse string that should appear in the published text)",hasEndMarker:!0,children:void 0},p:{category:O.Paragraphs,type:A.Paragraph,description:"Paragraph text, with first line indent (basic)",hasEndMarker:!1,children:{Paragraphs:["pmo","pm","pmc","pmr"],Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},m:{category:O.Paragraphs,type:A.Paragraph,description:"Paragraph text, with no first line indent (may occur after poetry) (basic)",hasEndMarker:!1,children:{Paragraphs:["pmo","pm","pmc","pmr"],Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},po:{category:O.Paragraphs,type:A.Paragraph,description:"Letter opening",hasEndMarker:!1,children:{Paragraphs:["pmo","pm","pmc","pmr"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pr:{category:O.Paragraphs,type:A.Paragraph,description:"Text refrain (paragraph text, right aligned)",hasEndMarker:!1,children:{Paragraphs:["pmo","pm","pmc","pmr"],Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},cls:{category:O.Paragraphs,type:A.Paragraph,description:"Letter Closing",hasEndMarker:!1,children:{SpecialText:["tl","sig","pn","png","addpn","add"]}},pmo:{category:O.Paragraphs,type:A.Paragraph,description:"Embedded text opening",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pm:{category:O.Paragraphs,type:A.Paragraph,description:"Embedded text paragraph",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pmc:{category:O.Paragraphs,type:A.Paragraph,description:"Embedded text closing",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pmr:{category:O.Paragraphs,type:A.Paragraph,description:"Embedded text refrain (e.g. Then all the people shall say, 'Amen!')",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pi:{category:O.Paragraphs,type:A.Paragraph,description:"Paragraph text, level 1 indent (if single level), with first line indent; often used for discourse (basic)",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pi1:{category:O.Paragraphs,type:A.Paragraph,description:"Paragraph text, level 1 indent (if multiple levels), with first line indent; often used for discourse",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pi2:{category:O.Paragraphs,type:A.Paragraph,description:"Paragraph text, level 2 indent, with first line indent; often used for discourse",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pi3:{category:O.Paragraphs,type:A.Paragraph,description:"Paragraph text, level 3 indent, with first line indent; often used for discourse",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pc:{category:O.Paragraphs,type:A.Paragraph,description:"Paragraph text, centered (for Inscription)",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},mi:{category:O.Paragraphs,type:A.Paragraph,description:"Paragraph text, indented, with no first line indent; often used for discourse",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},nb:{category:O.Paragraphs,type:A.Paragraph,description:"Paragraph text, with no break from previous paragraph text (at chapter boundary) (basic)",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q:{category:O.Poetry,type:A.Paragraph,description:"Poetry text, level 1 indent (if single level)",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q1:{category:O.Poetry,type:A.Paragraph,description:"Poetry text, level 1 indent (if multiple levels) (basic)",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q2:{category:O.Poetry,type:A.Paragraph,description:"Poetry text, level 2 indent (basic)",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q3:{category:O.Poetry,type:A.Paragraph,description:"Poetry text, level 3 indent",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q4:{category:O.Poetry,type:A.Paragraph,description:"Poetry text, level 4 indent",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qc:{category:O.Poetry,type:A.Paragraph,description:"Poetry text, centered",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qr:{category:O.Poetry,type:A.Paragraph,description:"Poetry text, Right Aligned",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qs:{category:O.Poetry,type:A.Character,description:"Poetry text, Selah",hasEndMarker:!0,children:{Footnotes:["f"],CrossReferences:["x"]}},qa:{category:O.Poetry,type:A.Paragraph,description:"Poetry text, Acrostic marker/heading",hasEndMarker:!1,children:void 0},qac:{category:O.Poetry,type:A.Character,description:"Poetry text, Acrostic markup of the first character of a line of acrostic poetry",hasEndMarker:!0,children:void 0},qm:{category:O.Poetry,type:A.Paragraph,description:"Poetry text, embedded, level 1 indent (if single level)",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qm1:{category:O.Poetry,type:A.Paragraph,description:"Poetry text, embedded, level 1 indent (if multiple levels)",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qm2:{category:O.Poetry,type:A.Paragraph,description:"Poetry text, embedded, level 2 indent",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qm3:{category:O.Poetry,type:A.Paragraph,description:"Poetry text, embedded, level 3 indent",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qd:{category:O.Poetry,type:A.Paragraph,description:"A Hebrew musical performance annotation, similar in content to Hebrew descriptive title.",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},b:{category:O.Poetry,type:A.Paragraph,description:"Poetry text stanza break (e.g. stanza break) (basic)",hasEndMarker:!1,children:void 0},mt:{category:O.TitlesHeadings,type:A.Paragraph,description:"The main title of the book (if single level)",hasEndMarker:!1,children:{Footnotes:["f"],CrossReferences:["x"]}},mt1:{category:O.TitlesHeadings,type:A.Paragraph,description:"The main title of the book (if multiple levels) (basic)",hasEndMarker:!1,children:{Footnotes:["f"],CrossReferences:["x"]}},mt2:{category:O.TitlesHeadings,type:A.Paragraph,description:"A secondary title usually occurring before the main title (basic)",hasEndMarker:!1,children:{Footnotes:["f"],CrossReferences:["x"]}},mt3:{category:O.TitlesHeadings,type:A.Paragraph,description:"A secondary title occurring after the main title",hasEndMarker:!1,children:{Footnotes:["f"],CrossReferences:["x"]}},mt4:{category:O.TitlesHeadings,type:A.Paragraph,description:"A small secondary title sometimes occurring within parentheses",hasEndMarker:!1,children:void 0},mte:{category:O.TitlesHeadings,type:A.Paragraph,description:"The main title of the book repeated at the end of the book, level 1 (if single level)",hasEndMarker:!1,children:void 0},mte1:{category:O.TitlesHeadings,type:A.Paragraph,description:"The main title of the book repeated at the end of the book, level 1 (if multiple levels)",hasEndMarker:!1,children:{TitlesHeadings:["mte2"]}},mte2:{category:O.TitlesHeadings,type:A.Paragraph,description:"A secondary title occurring before or after the 'ending' main title",hasEndMarker:!1,children:void 0},ms:{category:O.TitlesHeadings,type:A.Paragraph,description:"A major section division heading, level 1 (if single level) (basic)",hasEndMarker:!1,children:{TitlesHeadings:["mr"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},ms1:{category:O.TitlesHeadings,type:A.Paragraph,description:"A major section division heading, level 1 (if multiple levels)",hasEndMarker:!1,children:{TitlesHeadings:["mr"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},ms2:{category:O.TitlesHeadings,type:A.Paragraph,description:"A major section division heading, level 2",hasEndMarker:!1,children:{TitlesHeadings:["mr"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},ms3:{category:O.TitlesHeadings,type:A.Paragraph,description:"A major section division heading, level 3",hasEndMarker:!1,children:{TitlesHeadings:["mr"],Footnotes:["f","fe"]}},mr:{category:O.TitlesHeadings,type:A.Paragraph,description:"A major section division references range heading (basic)",hasEndMarker:!1,children:void 0},s:{category:O.TitlesHeadings,type:A.Paragraph,description:"A section heading, level 1 (if single level) (basic)",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},s1:{category:O.TitlesHeadings,type:A.Paragraph,description:"A section heading, level 1 (if multiple levels)",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},s2:{category:O.TitlesHeadings,type:A.Paragraph,description:"A section heading, level 2 (e.g. Proverbs 22-24)",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},s3:{category:O.TitlesHeadings,type:A.Paragraph,description:"A section heading, level 3 (e.g. Genesis 'The First Day')",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},s4:{category:O.TitlesHeadings,type:A.Paragraph,description:"A section heading, level 4",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},sr:{category:O.TitlesHeadings,type:A.Paragraph,description:"A section division references range heading",hasEndMarker:!1,children:void 0},r:{category:O.TitlesHeadings,type:A.Paragraph,description:"Parallel reference(s) (basic)",hasEndMarker:!1,children:void 0},sp:{category:O.TitlesHeadings,type:A.Paragraph,description:"A heading, to identify the speaker (e.g. Job)",hasEndMarker:!1,children:{Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},d:{category:O.TitlesHeadings,type:A.Paragraph,description:"A Hebrew text heading, to provide description (e.g. Psalms)",hasEndMarker:!1,children:{Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},sd:{category:O.TitlesHeadings,type:A.Paragraph,description:"Vertical space used to divide the text into sections, level 1 (if single level)",hasEndMarker:!1,children:void 0},sd1:{category:O.TitlesHeadings,type:A.Paragraph,description:"Vertical space used to divide the text into sections, level 1 (if multiple levels)",hasEndMarker:!1,children:void 0},sd2:{category:O.TitlesHeadings,type:A.Paragraph,description:"Vertical space used to divide the text into sections, level 2",hasEndMarker:!1,children:void 0},sd3:{category:O.TitlesHeadings,type:A.Paragraph,description:"Vertical space used to divide the text into sections, level 3",hasEndMarker:!1,children:void 0},sd4:{category:O.TitlesHeadings,type:A.Paragraph,description:"Vertical space used to divide the text into sections, level 4",hasEndMarker:!1,children:void 0},lh:{category:O.Lists,type:A.Paragraph,description:"List header (introductory remark)",hasEndMarker:!1,children:{Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li:{category:O.Lists,type:A.Paragraph,description:"A list entry, level 1 (if single level)",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li1:{category:O.Lists,type:A.Paragraph,description:"A list entry, level 1 (if multiple levels)",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li2:{category:O.Lists,type:A.Paragraph,description:"A list entry, level 2",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li3:{category:O.Lists,type:A.Paragraph,description:"A list entry, level 3",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li4:{category:O.Lists,type:A.Paragraph,description:"A list entry, level 4",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lf:{category:O.Lists,type:A.Paragraph,description:"List footer (concluding remark)",hasEndMarker:!1,children:{Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim:{category:O.Lists,type:A.Paragraph,description:"An embedded list entry, level 1 (if single level)",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim1:{category:O.Lists,type:A.Paragraph,description:"An embedded list entry, level 1 (if multiple levels)",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim2:{category:O.Lists,type:A.Paragraph,description:"An embedded list entry, level 2",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim3:{category:O.Lists,type:A.Paragraph,description:"An embedded list item, level 3",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim4:{category:O.Lists,type:A.Paragraph,description:"An embedded list entry, level 4",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},litl:{category:O.Lists,type:A.Character,description:"List entry total text",hasEndMarker:!0,children:void 0},lik:{category:O.Lists,type:A.Character,description:"Structured list entry key text",hasEndMarker:!0,children:void 0},liv:{category:O.Lists,type:A.Character,description:"Structured list entry value 1 content (if single value)",hasEndMarker:!0,children:void 0},liv1:{category:O.Lists,type:A.Character,description:"Structured list entry value 1 content (if multiple values)",hasEndMarker:!0,children:void 0},liv2:{category:O.Lists,type:A.Character,description:"Structured list entry value 2 content",hasEndMarker:!0,children:void 0},liv3:{category:O.Lists,type:A.Character,description:"Structured list entry value 3 content",hasEndMarker:!0,children:void 0},liv4:{category:O.Lists,type:A.Character,description:"Structured list entry value 4 content",hasEndMarker:!0,children:void 0},liv5:{category:O.Lists,type:A.Character,description:"Structured list entry value 5 content",hasEndMarker:!0,children:void 0},f:{category:O.Footnotes,type:A.Note,description:"A Footnote text item (basic)",hasEndMarker:!0,children:{Footnotes:["fr","ft","fk","fq","fqa","fl","fw","fp","fv","fdc"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},fe:{category:O.Footnotes,type:A.Note,description:"An Endnote text item",hasEndMarker:!0,children:{Footnotes:["fr","ft","fk","fq","fqa","fl","fw","fp","fv","fdc"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},fr:{category:O.Footnotes,type:A.Character,description:"The origin reference for the footnote (basic)",hasEndMarker:!0,children:void 0},ft:{category:O.Footnotes,type:A.Character,description:"Footnote text, Protocanon (basic)",hasEndMarker:!0,children:void 0},fk:{category:O.Footnotes,type:A.Character,description:"A footnote keyword (basic)",hasEndMarker:!0,children:void 0},fq:{category:O.Footnotes,type:A.Character,description:"A footnote scripture quote or alternate rendering (basic)",hasEndMarker:!0,children:void 0},fqa:{category:O.Footnotes,type:A.Character,description:"A footnote alternate rendering for a portion of scripture text",hasEndMarker:!0,children:void 0},fl:{category:O.Footnotes,type:A.Character,description:"A footnote label text item, for marking or 'labelling' the type or alternate translation being provided in the note.",hasEndMarker:!0,children:void 0},fw:{category:O.Footnotes,type:A.Character,description:"A footnote witness list, for distinguishing a list of sigla representing witnesses in critical editions.",hasEndMarker:!0,children:void 0},fp:{category:O.Footnotes,type:A.Character,description:"A Footnote additional paragraph marker",hasEndMarker:!0,children:void 0},fv:{category:O.Footnotes,type:A.Character,description:"A verse number within the footnote text",hasEndMarker:!0,children:void 0},fdc:{category:O.Footnotes,type:A.Character,description:"Footnote text, applies to Deuterocanon only",hasEndMarker:!0,children:void 0},fm:{category:O.Footnotes,type:A.Character,description:"An additional footnote marker location for a previous footnote",hasEndMarker:!0,children:void 0},x:{category:O.CrossReferences,type:A.Note,description:"A list of cross references (basic)",hasEndMarker:!0,children:{CrossReferences:["xo","xop","xt","xta","xk","xq","xot","xnt","xdc"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},xo:{category:O.CrossReferences,type:A.Character,description:"The cross reference origin reference (basic)",hasEndMarker:!0,children:void 0},xop:{category:O.CrossReferences,type:A.Character,description:"Published cross reference origin reference (origin reference that should appear in the published text)",hasEndMarker:!0,children:void 0},xt:{category:O.CrossReferences,type:A.Character,description:"The cross reference target reference(s), protocanon only (basic)",hasEndMarker:!0,children:void 0},xta:{category:O.CrossReferences,type:A.Character,description:"Cross reference target references added text",hasEndMarker:!0,children:void 0},xk:{category:O.CrossReferences,type:A.Character,description:"A cross reference keyword",hasEndMarker:!0,children:void 0},xq:{category:O.CrossReferences,type:A.Character,description:"A cross-reference quotation from the scripture text",hasEndMarker:!0,children:void 0},xot:{category:O.CrossReferences,type:A.Character,description:"Cross-reference target reference(s), Old Testament only",hasEndMarker:!0,children:void 0},xnt:{category:O.CrossReferences,type:A.Character,description:"Cross-reference target reference(s), New Testament only",hasEndMarker:!0,children:void 0},xdc:{category:O.CrossReferences,type:A.Character,description:"Cross-reference target reference(s), Deuterocanon only",hasEndMarker:!0,children:void 0},rq:{category:O.CrossReferences,type:A.Character,description:"A cross-reference indicating the source text for the preceding quotation.",hasEndMarker:!0,children:void 0},qt:{category:O.SpecialText,type:A.Character,description:"For Old Testament quoted text appearing in the New Testament (basic)",hasEndMarker:!0,children:void 0},nd:{category:O.SpecialText,type:A.Character,description:"For name of deity (basic)",hasEndMarker:!0,children:void 0},tl:{category:O.SpecialText,type:A.Character,description:"For transliterated words",hasEndMarker:!0,children:void 0},dc:{category:O.SpecialText,type:A.Character,description:"Deuterocanonical/LXX additions or insertions in the Protocanonical text",hasEndMarker:!0,children:void 0},bk:{category:O.SpecialText,type:A.Character,description:"For the quoted name of a book",hasEndMarker:!0,children:void 0},sig:{category:O.SpecialText,type:A.Character,description:"For the signature of the author of an Epistle",hasEndMarker:!0,children:void 0},pn:{category:O.SpecialText,type:A.Character,description:"For a proper name",hasEndMarker:!0,children:void 0},png:{category:O.SpecialText,type:A.Character,description:"For a geographic proper name",hasEndMarker:!0,children:void 0},addpn:{category:O.SpecialText,type:A.Character,description:"For chinese words to be dot underline & underline",hasEndMarker:!0,children:void 0},wj:{category:O.SpecialText,type:A.Character,description:"For marking the words of Jesus",hasEndMarker:!0,children:void 0},k:{category:O.SpecialText,type:A.Character,description:"For a keyword",hasEndMarker:!0,children:void 0},sls:{category:O.SpecialText,type:A.Character,description:"To represent where the original text is in a secondary language or from an alternate text source",hasEndMarker:!0,children:void 0},ord:{category:O.SpecialText,type:A.Character,description:"For the text portion of an ordinal number",hasEndMarker:!0,children:void 0},add:{category:O.SpecialText,type:A.Character,description:"For a translational addition to the text",hasEndMarker:!0,children:void 0},lit:{category:O.SpecialText,type:A.Paragraph,description:"For a comment or note inserted for liturgical use",hasEndMarker:!1,children:void 0},no:{category:O.CharacterStyling,type:A.Character,description:"A character style, use normal text",hasEndMarker:!0,children:void 0},it:{category:O.CharacterStyling,type:A.Character,description:"A character style, use italic text",hasEndMarker:!0,children:void 0},bd:{category:O.CharacterStyling,type:A.Character,description:"A character style, use bold text",hasEndMarker:!0,children:void 0},bdit:{category:O.CharacterStyling,type:A.Character,description:"A character style, use bold + italic text",hasEndMarker:!0,children:void 0},em:{category:O.CharacterStyling,type:A.Character,description:"A character style, use emphasized text style",hasEndMarker:!0,children:void 0},sc:{category:O.CharacterStyling,type:A.Character,description:"A character style, for small capitalization text",hasEndMarker:!0,children:void 0},sup:{category:O.CharacterStyling,type:A.Character,description:"A character style, for superscript text. Typically for use in critical edition footnotes.",hasEndMarker:!0,children:void 0},pb:{category:O.Breaks,type:A.Paragraph,description:"Page Break used for new reader portions and children's bibles where content is controlled by the page",hasEndMarker:!1,children:void 0}},Nr={DivisionMarks:{add:["v","c"],remove:[]},Paragraphs:{add:["p"],remove:[]},Poetry:{add:["q","q1","q2","q3","q4","b"],remove:[]},TitlesHeadings:{add:["mte","ms","ms1","ms2","ms3","s","s1","s2","s3","s4","r","sp","d","sd","sd1","sd2","sd3","sd4"],remove:[]}},P1={p:{children:Nr},q:{children:Nr},q1:{children:Nr},q2:{children:Nr},q3:{children:Nr},q4:{children:Nr},b:{children:Nr},qm:{children:{Paragraphs:{add:["p"],remove:[]}}},c:{type:A.Paragraph,children:null},v:{children:null}};function Wg(n){const e=$1[n],t=P1[n];if(!e)return;if(!t)return e;let r=e.children?{...e.children}:void 0;if(t.children===null&&(r=void 0),t.children){r=r||{};for(const[i,s]of Object.entries(t.children)){const o=i;if(s===null)Reflect.deleteProperty(r,o);else{let a=r[o]||[];s.remove&&(a=a.filter(l=>!s.remove.includes(l))),s.add&&(a=[...new Set([...a,...s.add])]),a.length>0?r[o]=a:Reflect.deleteProperty(r,o)}}Object.keys(r).length===0&&(r=void 0)}return{...e,...t,children:r}}function Ug(n,e,t){const r={type:Ti,version:Si,content:n},i=e.serializeEditorState(r,t);return af(i.root.children[0])?i.root.children[0].children[0]:i.root.children[0]}const Db=1;class Vt extends hr{constructor(e=Kr,t="",r,i){super(i),Q(this,"__caller"),Q(this,"__previewText"),Q(this,"__onClick"),this.__caller=e,this.__previewText=t,this.__onClick=r??(()=>{})}static getType(){return"immutable-note-caller"}static clone(e){const{__caller:t,__previewText:r,__onClick:i,__key:s}=e;return new Vt(t,r,i,s)}static importDOM(){return{span:e=>R1(e)?{conversion:I1,priority:1}:null}}static importJSON(e){return mf().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setCaller(e.caller).setPreviewText(e.previewText).setOnClick(e.onClick)}setCaller(e){if(this.__caller===e)return this;const t=this.getWritable();return t.__caller=e,t}getCaller(){return this.getLatest().__caller}setPreviewText(e){if(this.__previewText===e)return this;const t=this.getWritable();return t.__previewText=e,t}getPreviewText(){return this.getLatest().__previewText}setOnClick(e){if(this.__onClick===e)return this;const t=this.getWritable();return t.__onClick=e,t}getOnClick(){return this.getLatest().__onClick}createDOM(){const e=document.createElement("span");return e.classList.add(this.__type),e.setAttribute("data-caller",this.__caller),e.setAttribute("data-preview-text",this.__previewText),e}updateDOM(e){return e.__caller!==this.__caller}exportDOM(e){const{element:t}=super.exportDOM(e);return t&&Te(t)&&(t.classList.add(this.getType()),t.setAttribute("data-caller",this.getCaller()),t.setAttribute("data-preview-text",this.getPreviewText())),{element:t}}decorate(e){const t=this.getParent();if(!t)return null;const r=t.getKey(),i=t.getIsCollapsed(),s=this.__key,o=l=>{var c;return(c=this.__onClick)==null?void 0:c.call(this,l,r,i,()=>D1(e,r),u=>L1(e,r,s,u))},a=`${this.__caller}_${this.__previewText}}`.replace(/\s+/g,"").substring(0,25);return S.jsx("button",{onClick:o,title:this.__previewText,"data-caller-id":a,children:this.__caller===Kr&&i?"":this.__caller})}exportJSON(){return{type:this.getType(),caller:this.getCaller(),previewText:this.getPreviewText(),onClick:this.getOnClick(),version:Db}}isKeyboardSelectable(){return!1}}function I1(n){const e=n.getAttribute("data-caller")??"",t=n.getAttribute("data-preview-text")??"";return{node:mf(e,t)}}function mf(n,e,t){return Ne(new Vt(n,e,t))}function R1(n){return n?n.classList.contains(Vt.getType()):!1}function _r(n){return n instanceof Vt}function D1(n,e){return n.read(()=>{const t=he(e);if(!we(t))throw new Error(`getCaller: Note node not found: ${e}`);return t.getCaller()})}function L1(n,e,t,r){n.update(()=>{const i=he(e);if(!we(i))throw new Error(`setCaller: Note node not found: ${e}`);i.setCaller(r);const s=he(t);if(!_r(s))throw new Error(`setCaller: Caller node not found: ${t}`);s.setCaller(r)})}const j1=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],Lb="v",jb=1;class bt extends hr{constructor(e="",t=!1,r,i,s,o,a){super(a),Q(this,"__marker"),Q(this,"__number"),Q(this,"__showMarker"),Q(this,"__sid"),Q(this,"__altnumber"),Q(this,"__pubnumber"),Q(this,"__unknownAttributes"),this.__marker=Lb,this.__number=e,this.__showMarker=t,this.__sid=r,this.__altnumber=i,this.__pubnumber=s,this.__unknownAttributes=o}static getType(){return"immutable-verse"}static clone(e){const{__number:t,__showMarker:r,__sid:i,__altnumber:s,__pubnumber:o,__unknownAttributes:a,__key:l}=e;return new bt(t,r,i,s,o,a,l)}static importDOM(){return{span:e=>q1(e)?{conversion:F1,priority:1}:null}}static importJSON(e){return yf().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setNumber(e.number).setShowMarker(e.showMarker).setSid(e.sid).setAltnumber(e.altnumber).setPubnumber(e.pubnumber).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}setNumber(e){if(this.__number===e)return this;const t=this.getWritable();return t.__number=e,t}getNumber(){return this.getLatest().__number}setShowMarker(e=!1){if(this.__showMarker===e)return this;const t=this.getWritable();return t.__showMarker=e,t}getShowMarker(){return this.getLatest().__showMarker}setSid(e){if(this.__sid===e)return this;const t=this.getWritable();return t.__sid=e,t}getSid(){return this.getLatest().__sid}setAltnumber(e){if(this.__altnumber===e)return this;const t=this.getWritable();return t.__altnumber=e,t}getAltnumber(){return this.getLatest().__altnumber}setPubnumber(e){if(this.__pubnumber===e)return this;const t=this.getWritable();return t.__pubnumber=e,t}getPubnumber(){return this.getLatest().__pubnumber}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("span");return e.setAttribute("data-marker",this.__marker),e.classList.add(Lu,`usfm_${this.__marker}`),this.__showMarker&&e.classList.add("marker"),e.setAttribute("data-number",this.__number),e}updateDOM(){return!1}exportDOM(e){const{element:t}=super.exportDOM(e);return t&&Te(t)&&(t.setAttribute("data-marker",this.getMarker()),t.classList.add(Lu,`usfm_${this.getMarker()}`),t.setAttribute("data-number",this.getNumber())),{element:t}}decorate(){return S.jsx("span",{children:this.getShowMarker()?ho(this.getMarker(),this.getNumber()):Du+this.getNumber()+Du})}exportJSON(){return{type:this.getType(),marker:this.getMarker(),number:this.getNumber(),showMarker:this.getShowMarker(),sid:this.getSid(),altnumber:this.getAltnumber(),pubnumber:this.getPubnumber(),unknownAttributes:this.getUnknownAttributes(),version:jb}}isKeyboardSelectable(){return!1}}function F1(n){const e=n.getAttribute("data-number")??"0";return{node:yf(e)}}function yf(n,e,t,r,i,s){return Ne(new bt(n,e,t,r,i,s))}function q1(n){return((n==null?void 0:n.getAttribute("data-marker"))??void 0)===Lb}function po(n){return n instanceof bt}function B1(n){return(n==null?void 0:n.type)===bt.getType()}function zu(n,e){if(!n||!U(n))return[void 0,void 0];const t=n.getTextContent();if(e>=0&&e<t.length)return[n,e];let r=n.getNextSibling();if(!r){const s=n.getParent();nt(s)&&(r=s.getNextSibling())}if(!r||!nt(r)&&!U(r))return[void 0,void 0];const i=e-t.length;return r&&U(r)?zu(r,i):zu(r.getFirstChild()??void 0,i)}function zg(n){const e=_v(n.jsonPath);let t=pe();for(const r of e){if(!t||!L(t))return[void 0,void 0];t=t.getChildAtIndex(r)??void 0}return zu(t,n.offset)}function Kg(n){return L(n)?"element":"text"}function _f(n){const{start:e}=n;let{end:t}=n;t===void 0&&(t=e);const[r,i]=zg(e),[s,o]=zg(t);if(!r||!s||i===void 0||o===void 0)return;const a=ro();return a.anchor=Ct(r.getKey(),i,Kg(r)),a.focus=Ct(s.getKey(),o,Kg(s)),a}function Hg(n,e){const t=[];let r=n;for(;r!=null&&r.getParent();){const i=r.getParent();if(i){const s=i==null?void 0:i.getChildren().indexOf(r);s>=0&&t.unshift(s)}r=i}return{jsonPath:bv(t),offset:e}}function Fb(){const n=K();if(!n||!B(n))return;const e=n.isBackward()?n.focus.getNode():n.anchor.getNode(),t=n.isBackward()?n.focus.offset:n.anchor.offset,r=Hg(e,t);if(n.isCollapsed())return{start:r};const i=n.isBackward()?n.anchor.getNode():n.focus.getNode(),s=n.isBackward()?n.anchor.offset:n.focus.offset,o=Hg(i,s);return{start:r,end:o}}function Lt(n){return uf(n)||po(n)}function W1(n){return s1(n)||B1(n)}function U1(n,e,t,r,i,s){if(!ft.isValidMarker(n))throw new Error(`$insertNote: Invalid note marker '${n}'`);const o=t?_f(t):K();if(!B(o))return;const a=z1(o,n,r),l=Bb(n,e,a,i,s);return qb(l,o,i),l}function qb(n,e,t){const r=(t==null?void 0:t.noteMode)==="collapsed";if(n.setIsCollapsed(r),e.isCollapsed()||h1(e),e.insertNodes([n]),!r){const i=n.getChildren().reverse().find(Le);i==null||i.selectEnd()}}function z1(n,e,t){const r=[],{chapterNum:i,verseNum:s}=t??{};switch(e){case"f":case"fe":case"ef":if(i!==void 0&&s!==void 0&&r.push(Mn("fr").append(ue(`${i}:${s}`))),!n.isCollapsed()){const o=n.getTextContent().trim();if(o.length>0){const a=Mn("fq");a.append(ue(o)),r.push(a)}}r.push(Mn("ft").append(ue("-")));break;case"x":case"ex":i!==void 0&&s!==void 0&&r.push(Mn("xo").append(ue(`${i}:${s}`))),r.push(Mn("xt").append(ue("-")));break}return r}function Bb(n,e,t,r,i,s){const o=(r==null?void 0:r.noteMode)!=="expanded",a=lf(n,e,o);s&&An(a,Wi,()=>s);let l,c;(r==null?void 0:r.markerMode)==="editable"?(l=Uu(n),c=Uu(n,"closing")):(r==null?void 0:r.markerMode)==="visible"&&(l=el("marker",pr(n)+Oe),c=el("marker",Zs(n)+Oe));let u;if(l&&a.append(l),(r==null?void 0:r.markerMode)==="editable")u=ue(hf(a.__caller)),a.append(u,...t);else{const f=()=>ue(Oe),d=gf(t);let g=()=>{};i!=null&&i.noteCallerOnClick&&(g=i.noteCallerOnClick),u=mf(a.__caller,d,g);const p=t.flatMap(K1(f));a.append(u,f(),...p)}return c&&a.append(c),a}function K1(n){return e=>tl(e)?[e]:[e,n()]}function H1(n){return n.find(e=>ut(e))}function J1(n,e){return L(n)?n.getChildren().find(t=>Lt(t)&&pf(e,t.getNumber())):void 0}function V1(n,e){return e===0?H1(n):n.map(t=>J1(t,e)).filter(t=>t)[0]}function Jg(n){return!n||!L(n)?void 0:n.getChildren().findLast(e=>Lt(e))}function Wb(n){var e,t;if(!n||Dt(n))return;if(Lt(n))return n;let r=nt(n.getParent())?(e=n.getParent())==null?void 0:e.getPreviousSibling():n.getPreviousSibling();for(;r&&!Lt(r)&&!Dt(r);)r=r.getPreviousSibling();if(r&&Lt(r))return r;let i=(t=n.getTopLevelElement())==null?void 0:t.getPreviousSibling(),s=Jg(i),o=s;for(;i&&!s&&!Dt(i);)s=o,i=i.getPreviousSibling(),o=Jg(i);if(!(!s&&Dt(i)))return s}function G1(n){return c1(n)||po(n)}function bf(n){if(U(n)){const e=n.getTextContent();!e.endsWith(" ")&&!e.endsWith(Oe)&&n.setTextContent(`${e} `)}}function Ub(n){if(U(n)){const e=n.getTextContent();e.startsWith(" ")&&n.setTextContent(e.trimStart())}}function vf(n,e){return n.getEditorState().read(()=>!he(e))}const Y1=[Vt,bt,...O1],X1=x.forwardRef((n,e)=>{const{coords:t,children:r,style:i,...s}=n,o=t!==void 0;return S.jsx("div",{ref:e,className:"floating-box","aria-hidden":!o,style:{...i,position:"absolute",zIndex:1e3,top:t==null?void 0:t.y,left:t==null?void 0:t.x,visibility:o?"visible":"hidden",opacity:o?1:0},...s,children:r})});function Z1(){const[n,e]=x.useState(void 0),[t,r]=x.useState(),i=x.useRef(null),s=x.useCallback((a,l)=>{i.current&&i.current();const c=a.commonAncestorContainer.nodeType===a.commonAncestorContainer.TEXT_NODE?a:a.commonAncestorContainer;i.current=kv(c,l,()=>{wv(c,l,{placement:"bottom-start",middleware:[xv(),Cv()]}).then(u=>{r(u.placement),e(f=>(f==null?void 0:f.x)===u.x&&(f==null?void 0:f.y)===u.y?f:{x:u.x,y:u.y})}).catch(()=>{e(void 0)})})},[]),o=x.useCallback(()=>{i.current&&(e(void 0),i.current(),i.current=null)},[]);return x.useEffect(()=>o,[o]),{coords:n,placement:t,updatePosition:s,cleanup:o}}function Q1({isOpen:n,floatingBoxRef:e}){const{coords:t,updatePosition:r,cleanup:i,placement:s}=Z1();return x.useEffect(()=>{var o;if(!n||!e.current){i();return}const a=(o=window.getSelection())==null?void 0:o.getRangeAt(0);if(!a){i();return}return r(a,e.current),i},[i,n,e,r]),{coords:t,placement:s}}const eT=document.body,tT=x.memo(X1);function nT({isOpen:n=!1,children:e}){const t=x.useRef(null),{coords:r,placement:i}=Q1({isOpen:n,floatingBoxRef:t}),s=x.useMemo(()=>r?typeof e=="function"?e:()=>e:()=>null,[e,r]);return Nt.createPortal(S.jsx(tT,{ref:t,coords:r,style:r?void 0:{display:"none"},children:s({isOpen:n,placement:i})}),eT)}const zb=x.createContext(void 0);function kf(){const n=x.useContext(zb);if(!n)throw new Error("useMenuContext must be used within a MenuProvider");return n}function rT(n,e){const[t,r]=x.useState(0),[i,s]=x.useState(-1),o=x.useMemo(()=>n??[],[n]),a={menuItems:o,activeIndex:t,selectedIndex:i,onSelectOption:e??(()=>{})},l=x.useCallback(()=>{r(f=>{const d=o.length;return d?(f-1+d)%d:0})},[o.length]),c=x.useCallback(()=>{r(f=>{const d=o.length;return d?(f+1)%d:0})},[o.length]),u=x.useCallback(()=>{const f=o.length;if(t>=0&&t<f){const d=o[t];e==null||e(d),s(t)}},[t,o,e]);return{state:a,moveUp:l,moveDown:c,select:u,setActiveIndex:r,setSelectedIndex:s}}function iT({children:n,menuItems:e,onSelectOption:t,...r}){const i=rT(e,t);return S.jsx(zb.Provider,{value:i,children:S.jsx("div",{...r,children:n})})}const Kb=x.forwardRef(({index:n,children:e,onMouseEnter:t,onClick:r,...i},s)=>{const{state:{activeIndex:o},setActiveIndex:a,setSelectedIndex:l,select:c}=kf(),u=x.useCallback(d=>{c(),l(-1),r==null||r(d)},[r,c,l]),f=x.useCallback(d=>{a(n),t==null||t(d)},[n,a,t]);return S.jsx("button",{ref:s,role:"menuitem",...i,onClick:u,onMouseEnter:f,"aria-selected":n!==void 0&&o===n?"true":void 0,tabIndex:-1,children:e})});function sT({children:n,autoIndex:e=!0,...t}){const r=x.useRef(null),{state:{activeIndex:i,menuItems:s}}=kf(),o=x.useMemo(()=>s?typeof n=="function"?n:()=>n:()=>null,[n,s]),a=x.useMemo(()=>{const l=o(s);return e?x.Children.map(l,(c,u)=>x.isValidElement(c)&&c.type===Kb&&c.props.index===void 0?x.cloneElement(c,{index:u}):c):l},[o,e,s]);return x.useEffect(()=>{if(r.current){const l=r.current,c=l.children[i];if(c){const u=l.getBoundingClientRect(),f=c.getBoundingClientRect();f.bottom>u.bottom?l.scrollTop+=f.bottom-u.bottom:f.top<u.top&&(l.scrollTop-=u.top-f.top)}}},[i]),S.jsx("div",{ref:r,role:"menu",...t,children:a})}const Kc={Root:iT,Options:sT,Option:Kb},oT=(n,e,t)=>wa(n,t).toLowerCase().includes(e.toLowerCase()),Vg=n=>Object.keys(n).find(e=>typeof n[e]=="string")||"",wa=(n,e)=>{const t=n[e];return typeof t=="string"?t:String(t)};function aT(n){const{query:e,items:t,filterBy:r,filter:i,sortBy:s,sortingOptions:o}=n,{caseSensitive:a=!1,priorityOrder:l=["exact","startsWith","contains"]}=o||{},c=a?e:e.toLowerCase();let u,f;i?(f=i,u=t.length>0?Vg(t[0]):""):(u=r||(t.length>0?Vg(t[0]):""),f=(p,m)=>oT(p,m,u));const d=s||u,g=new Map;return t.filter(p=>{try{return f(p,e)}catch(m){return console.warn("Error filtering item:",p,m),!1}}).sort((p,m)=>{const y=w=>(g.has(w)||g.set(w,wa(w,d).toLowerCase()),g.get(w)??""),v=a?wa(p,d):y(p),_=a?wa(m,d):y(m);for(const w of l)switch(w){case"exact":if(v===c&&_!==c)return-1;if(_===c&&v!==c)return 1;break;case"startsWith":if(v.startsWith(c)&&!_.startsWith(c))return-1;if(_.startsWith(c)&&!v.startsWith(c))return 1;break;case"contains":{const E=v.indexOf(c),$=_.indexOf(c);if(E!==-1&&$===-1)return-1;if($!==-1&&E===-1)return 1;if(E!==-1&&$!==-1)return E-$;break}}return v.localeCompare(_)})}function lT(n){const{query:e,items:t,filterBy:r,filter:i,sortBy:s,sortingOptions:o}=n;return x.useMemo(()=>aT({query:e,items:t,filterBy:r,filter:i,sortBy:s,sortingOptions:o}),[e,t,r,i,s,o])}function cT(){const{moveUp:n,moveDown:e,select:t}=kf();return x.useMemo(()=>({moveUp:n,moveDown:e,select:t}),[n,e,t])}const uT=()=>{const n=cT(),[e]=ge();x.useEffect(()=>{const t=r=>{const i={ArrowDown:()=>n==null?void 0:n.moveDown(),ArrowUp:()=>n==null?void 0:n.moveUp(),Enter:()=>n==null?void 0:n.select(),Tab:()=>n==null?void 0:n.select()}[r.key];return i?(i(),r.preventDefault(),r.stopPropagation(),!0):!1};return e.registerCommand(zi,t,hl)},[e,n])};function dT(){return uT(),null}function fT(n){const{options:e,onSelectOption:t,onClose:r,inverse:i,query:s,menuOpenKey:o}=n,[a]=ge(),l=s!==void 0,[c,u]=x.useState(""),f=l?s??"":c,d=lT({query:f,items:e,filterBy:"name"}),g=p=>{r==null||r(),t?t(p):p.action(a)};return x.useEffect(()=>a.registerCommand(zi,p=>{if(l)return!1;const m={Escape:()=>r==null?void 0:r(),Backspace:()=>{f.length===0?r==null||r():u(y=>y.slice(0,-1))}}[p.key];return m?(p.stopPropagation(),p.preventDefault(),m(),!0):p.key.length===1?(p.stopPropagation(),p.preventDefault(),p.key!==o&&u(y=>y+p.key),!0):!1},hl),[a,l,f,o,r]),S.jsxs(Kc.Root,{className:`autocomplete-menu-container ${i?"inverse":""}`,menuItems:d,onSelectOption:p=>g(p),children:[!l&&S.jsx("input",{value:f,type:"text",disabled:!0}),S.jsx(dT,{}),S.jsx(Kc.Options,{className:"autocomplete-menu-options",autoIndex:!1,children:p=>p.map((m,y)=>S.jsxs(Kc.Option,{index:y,children:[S.jsx("span",{className:"label",children:m.label??m.name}),S.jsx("span",{className:"description",children:m.description})]},m.name))})]})}function hT({trigger:n,items:e}){const[t]=ge(),[r,i]=x.useState(!1),s=x.useCallback(o=>{o.key==="Escape"&&r?(i(!1),t.focus()):o.key===n&&!r&&(o.preventDefault(),i(!0))},[t,n,r]);return x.useEffect(()=>t.registerRootListener(o=>{if(o)return o.addEventListener("keydown",s),()=>{o.removeEventListener("keydown",s)}}),[t,s]),x.useEffect(()=>t.registerUpdateListener(({prevEditorState:o,editorState:a})=>{const l=o.read(()=>{const c=K();if(B(c))return c});a.read(()=>{const c=K();!B(c)||l!=null&&l.is(c)||i(!1)})}),[t]),e&&S.jsx(nT,{isOpen:r,children:({placement:o})=>S.jsx(fT,{options:e,onClose:()=>i(!1),inverse:o==="top-start",menuOpenKey:n})})}function gT({scriptureReference:n,contextMarker:e,getMarkerAction:t}){return{markersMenuItems:x.useMemo(()=>{if(!e||!n)return;const r=Wg(e);if(r!=null&&r.children)return Object.values(r.children).flatMap(i=>i.map(s=>{const o=Wg(s),{action:a}=t(s,o);return{name:s,label:s,description:(o==null?void 0:o.description)??"",action:l=>{a({editor:l,reference:n})}}}))},[e,t,n])}}function xa(n,e){return`${n}:${e}`}function pT(n,e){x.useEffect(()=>{if(!n.hasNodes([et]))throw new Error("AnnotationPlugin: TypedMarkNode not registered on editor!");const t=new Map;return He(Ey(n,et,r=>Qs(r.getTypedIDs()),(r,i)=>{for(const[s,o]of Object.entries(r.getTypedIDs()))o.forEach(a=>{i.addID(s,a)})}),n.registerMutationListener(et,r=>{n.getEditorState().read(()=>{for(const[i,s]of r){const o=he(i);let a={};s==="destroyed"?a=t.get(i)??{}:nt(o)&&(a=o.getTypedIDs());for(const[l,c]of Object.entries(a))if(!et.isReservedType(l))for(const u of c){let f=e.get(xa(l,u));a[l]=c,t.set(i,a),s==="destroyed"?f!==void 0&&(f.delete(i),f.size===0&&e.delete(xa(l,u))):(f===void 0&&(f=new Set,e.set(xa(l,u),f)),f.has(i)||f.add(i))}}})},{skipInitialization:!0}))},[n,e])}const mT=x.forwardRef(function({logger:n},e){const[t]=ge(),r=x.useMemo(()=>new Map,[]);return pT(t,r),x.useImperativeHandle(e,()=>({addAnnotation(i,s,o){if(et.isReservedType(s))throw new Error(`addAnnotation: Can't directly add this reserved annotation type '${s}'. Use the appropriate plugin instead.`);t.update(()=>{const a=_f(i);if(a===void 0){n==null||n.error("Failed to find start or end node of the annotation.");return}$b(a,s,o)},{tag:Fu})},removeAnnotation(i,s){if(et.isReservedType(i))throw new Error(`removeAnnotation: Can't directly remove this reserved annotation type '${i}'. Use the appropriate plugin instead.`);const o=r.get(xa(i,s));o!==void 0&&setTimeout(()=>{t.update(()=>{for(const a of o){const l=he(a);nt(l)&&(l.deleteID(i,s),l.hasNoIDsForEveryType()&&Ob(l))}},{tag:Fu})})}})),null}),Nl=`
`;function cr(n){return Dt(n)||Lt(n)||El(n)||we(n)||A1(n)}function mn(n){return zt(n)||gn(n)}function Hb(n,e){if(!n)return!1;if(!e)return!0;let t=e.node.getParent();for(;t;){if(t===n)return!1;t=t.getParent()}return!0}function Ku(n,e){const t={insert:n.__text},r=Mi(n,Wi);if(r&&(t.attributes={segment:r}),e&&e.length>0){let i=e.map(s=>{const o={style:s.__marker},a=Mi(s,ar);return a&&(o.cid=a),o});i.length===1&&(i=i[0]),t.attributes={...t.attributes,char:i}}return t}function Gg(n){const e=new Ms;return n.isEmpty()||n.read(()=>{const t=pe();if(!t||t.isEmpty())return;const r=t.getChildren();if(r.length===1&&Ln(r[0])&&(!r[0].getChildren()||r[0].getChildrenSize()===0))return;const i=yT();for(const s of i)e.push(s)}),e}function yT(){const n=[],e=qd(),t=[],r=[],i={children:[],contentsOps:[]};for(let s=0;s<e.length;s++){const o=e[s].node;n.push(...Yg(o,s,e,t,r,i))}for(const s of t)n.push(...Yg(s,e.length,e,t,r,i));return n}function Yg(n,e,t,r,i,s){if(!n)return[];const o=[];return _T(n,o,r),bT(n,o,i,s),vT(n,e,t,i),Dt(n)&&o.push(xT(n)),Lt(n)&&o.push(ST(n)),El(n)&&o.push(TT(n)),kT(n,o,s),o}function _T(n,e,t){if(!n.isInline()){const r=t.pop();gn(r)?e.push(wT(r)):ut(r)?e.push(CT(r)):Ln(r)&&e.push({insert:Nl})}mn(n)&&(t.includes(n)||t.push(n))}function bT(n,e,t,r){var i;if(!U(n))return;const s=n.getParent();if(we(s)&&s.getFirstChild()===n)return;const o=Ku(n,t);r.children.includes(n)?(i=r.contentsOps)==null||i.push(o):e.push(o)}function vT(n,e,t,r){Le(n)&&!r.includes(n)&&r.push(n);const i=t[e+1];for(const s of r.toReversed())Hb(s,i)&&r.pop()}function kT(n,e,t){var r;if(!we(n))return;qd(n).forEach(s=>t.children.push(s.node));const i=ET(n);t.contentsOps=(r=i.insert.note.contents)==null?void 0:r.ops,e.push(i)}function wT(n){const e={style:Tl,code:n.__code};return{insert:Nl,attributes:{book:e}}}function xT(n){const e={style:rf,number:n.__number};return n.__sid&&(e.sid=n.__sid),n.__altnumber&&(e.altnumber=n.__altnumber),n.__pubnumber&&(e.pubnumber=n.__pubnumber),{insert:{chapter:e}}}function CT(n){const e={style:n.__marker};return{insert:Nl,attributes:{para:e}}}function ST(n){const e={style:cf,number:n.__number};return n.__sid&&(e.sid=n.__sid),n.__altnumber&&(e.altnumber=n.__altnumber),n.__pubnumber&&(e.pubnumber=n.__pubnumber),{insert:{verse:e}}}function TT(n){const e={style:n.__marker};return n.__sid&&(e.sid=n.__sid),n.__eid&&(e.eid=n.__eid),{insert:{milestone:e}}}function ET(n){const e={style:n.__marker,caller:n.__caller};return n.__category&&(e.category=n.__category),n.getChildrenSize()>1&&(e.contents={ops:[]}),{insert:{note:e}}}function NT({ignoreHistoryMergeTagChange:n=!0,ignoreSelectionChange:e=!1,onChange:t}){const[r]=ge();return x.useLayoutEffect(()=>{if(t)return r.registerUpdateListener(i=>{const{editorState:s,dirtyElements:o,dirtyLeaves:a,prevEditorState:l,tags:c}=i;if(e&&o.size===0&&a.size===0||n&&c.has($r)||l.isEmpty())return;const u=MT(r,i);u.length!==0&&t(s,r,c,u)})},[r,n,e,t]),null}function MT(n,{dirtyLeaves:e,prevEditorState:t}){let r=new Ms;return n.getEditorState().read(()=>{const i=e.values().next().value??"";if(e.size===1&&U(he(i))){const s=he(i),o=AT(s);if(U(s)){const a=t.read(()=>{const u=he(i);return new Ms([U(u)?Ku(u):{insert:""}])}),l=new Ms([Ku(s)]),c=new Ms(o>0?[{retain:o}]:[]);r=r.concat(c).concat(a.diff(l))}}else{const s=Gg(t),o=Gg(n.getEditorState());r=s.diff(o)}}),r.ops}function AT(n){if(!n)return 0;const e=qd(),t=[];let r=0;for(let i=0;i<e.length;i++){const s=e[i].node;if(s===n)return r;r+=OT(s,i,e,t)}return r}function OT(n,e,t,r){return U(n)?n.getTextContent().length:cr(n)?1:mn(n)?$T(n,e,t,r):0}function $T(n,e,t,r){if(r.includes(n)||r.push(n),Hb(n,t[e+1])){const i=r.indexOf(n);return i>-1&&r.splice(i,1),1}return 0}const PT=["style"],IT=["style","code"],rl=["style","cid"],RT=["style","number","sid","altnumber","pubnumber"],DT=["style","number","sid","altnumber","pubnumber"],LT=["style","sid","eid"],jT=["style","caller","category","contents"];function FT(n,e,t,r){let i=0;n.forEach(s=>{if("retain"in s)i+=qT(s,i,r);else if("delete"in s){if(typeof s.delete!="number"||s.delete<=0){r==null||r.error(`Invalid delete operation: ${JSON.stringify(s)}`);return}r==null||r.debug(`Delete: ${s.delete}`),WT(i,s.delete,r)}else"insert"in s?typeof s.insert=="string"?(r==null||r.debug(`Insert: '${s.insert}'`),i+=UT(i,s.insert,s.attributes,r)):typeof s.insert=="object"&&s.insert!==null?(r==null||r.debug(`Insert embed: ${JSON.stringify(s.insert)}`),KT(i,s,e,t,r)?i+=1:r==null||r.error(`Failed to process insert embed operation: ${JSON.stringify(s.insert)} at index ${i}. Document may be inconsistent.`)):r==null||r.error(`Insert of unknown type: ${JSON.stringify(s.insert)}`):r==null||r.error(`Unknown operation: ${JSON.stringify(s)}`)})}function qT(n,e,t){return typeof n.retain!="number"||n.retain<0?(t==null||t.error(`Invalid retain operation: ${JSON.stringify(n)}`),0):(t==null||t.debug(`Retain: ${n.retain}`),n.attributes&&(t==null||t.debug(`Retain attributes: ${JSON.stringify(n.attributes)}`),BT(e,n.retain,n.attributes,t)),n.retain)}function BT(n,e,t,r){r==null||r.debug(`Applying attributes for range [${n}, ${n+e-1}] with attributes: ${JSON.stringify(t)}`);let i=e,s=0,o=-1;const a=pe();function l(c){if(i<=0)return!0;if(U(c)){const u=c.getTextContentSize();if(n<s+u&&s<n+e){const f=Math.max(0,n-s),d=u-f,g=Math.min(i,d);if(g>0){let p=c;const m=f>0,y=g<u-f;if(m&&y){const[,v]=c.splitText(f);[p]=v.splitText(g)}else m?[,p]=c.splitText(f):y&&([p]=c.splitText(g));if(eo(t)){const v=p.getParent();if(Le(v)){const _=t.char;let w;Array.isArray(_)?o>=0&&o<=_.length-1&&(w=_[o]):o===0&&(w=_);const E=w?Bu(w,v):!1;if(E&&Array.isArray(_)&&_.length>1){const $=ue("");p.replace($);const P=typeof t.segment=="string"?t.segment:void 0,R=Ml(_.slice(1),p,P);$.replace(R),It(t,p)}else if(E)It(t,p);else{const $=ue("");p.replace($);const P=Xg(p,t,r);P?v.insertAfter(P):$.replace(p)}}else{const _=ue("");p.replace(_);const w=Xg(p,t,r);w?_.replace(w):_.replace(p)}}else It(t,p);i-=g}}s+=u}else if(cr(c))n<=s&&s<n+e&&i>0&&(Zg(c,t),i-=1),s+=1;else if(Le(c)){o+=1;let u=!1;if(n<=s&&s<n+e&&i>0)if(eo(t)){const f=t.char;let d;if(Array.isArray(f)?o>=0&&o<=f.length-1&&(d=f[o]):o===0&&(d=f),d){c.setMarker(d.style),typeof d.cid=="string"&&An(c,ar,()=>d.cid);const g=Ve(d,rl);g&&Object.keys(g).length>0?c.setUnknownAttributes({...c.getUnknownAttributes()??{},...g}):c.setUnknownAttributes(void 0)}}else(t.char===!1||t.char===null||QT(t.char))&&(u=!0);if(i>0){const f=c.getChildren();for(const d of f){if(i<=0)break;if(l(d)&&i<=0)return u&&Mh(c),!0}}u&&Mh(c),o-=1}else if(mn(c)){const u=c.getChildren();for(const d of u){if(i<=0)break;if(l(d)&&i<=0)return!0}const f=1;if(n<=s&&s<n+i&&i>0){if(!Ln(c))Zg(c,t);else if(Gb(t)){const d=Vb(t.para);d&&c.replace(d,!0)}i-=f}s+=f}else if(L(c)){const u=c.getChildren();for(const f of u){if(i<=0)break;if(l(f)&&i<=0)return!0}}return i<=0}l(a),i>0&&(r==null||r.warn(`$applyAttributes: Not all characters in the retain operation (length ${e}) could be processed. Remaining: ${i}. targetIndex: ${n}, final currentIndex: ${s}`))}function Xg(n,e,t){var r;const i=typeof e.segment=="string"?e.segment:void 0,s=Ml(e.char,n,i);if(!Le(s)){t==null||t.error(`Failed to create CharNode for text transformation. Style: ${Array.isArray(e.char)?e.char[0].style:(r=e.char)==null?void 0:r.style}. Falling back to standard text attributes.`),It(e,n);return}const o={};Yb.forEach(c=>{n.hasFormat(c)&&(o[c]="true")});const a={};Object.entries(e).forEach(([c,u])=>{c==="segment"||c==="char"||(typeof u=="string"?a[c]=u:u===!0?a[c]="true":u===!1&&(a[c]="false"))});const l={...s.getUnknownAttributes()??{},...o,...a};return Object.keys(l).length>0&&s.setUnknownAttributes(l),It(e,n),s}function Zg(n,e){for(const t of Object.keys(e)){const r=e[t];if(t==="char"&&Le(n)&&eo(e)){const i=r;if(n.setMarker(i.style),typeof i.cid=="string"){const o=i.cid;An(n,ar,()=>o)}const s=Ve(i,rl);s&&Object.keys(s).length>0&&n.setUnknownAttributes({...n.getUnknownAttributes()??{},...s});continue}typeof r=="string"&&(Dt(n)||Lt(n)||El(n)||we(n)||uo(n)?n.setUnknownAttributes({...n.getUnknownAttributes()??{},[t]:r}):(gn(n)||ut(n)||Le(n))&&(t==="style"&&!gn(n)?n.setMarker(r):t==="code"&&gn(n)?n.setCode(r):n.setUnknownAttributes({...n.getUnknownAttributes()??{},[t]:r})),t==="segment"&&An(n,Wi,()=>r))}}function WT(n,e,t){if(e<=0)return;const r=pe();let i=0,s=e;function o(a){if(s<=0)return!0;if(U(a)){let l=a.getTextContentSize();if(n<i+l&&i<n+s){const c=Math.max(0,n-i),u=l-c,f=Math.min(s,u);f>0&&(a.spliceText(c,f,""),a.getTextContentSize()===0&&a.remove(),t==null||t.debug(`Deleted ${f} length from TextNode (key: ${a.getKey()}) at nodeOffset ${c}. Original targetIndex: ${n}, current currentIndex: ${i}.`),s-=f,l-=f)}i+=l}else if(cr(a))n<=i&&i<n+s?(a.remove(),t==null||t.debug(`Deleted embed node (key: ${a.getKey()}) at currentIndex: ${i}. Original targetIndex: ${n}, remainingToDelete: ${s}.`),s-=1):i+=1;else if(mn(a)){const l=a.getChildren().slice(),c=a.getChildren();for(const u of c){if(s<=0)break;if(o(u)&&s<=0)return!0}if(n<=i&&i<n+s&&mn(a)){s-=1;const u=a.getChildren().length;if(l.length>0&&u===0){const f=a.getParent();((f==null?void 0:f.getChildren())??[]).length>1?(a.remove(),t==null||t.debug(`Removed entire ParaNode that had all its content deleted at currentIndex: ${i}. Original targetIndex: ${n}, remainingToDelete: ${s}.`)):(a.replace(Jt(),!0),t==null||t.debug(`Replaced last ParaNode with ImpliedParaNode at currentIndex: ${i}. Original targetIndex: ${n}, remainingToDelete: ${s}.`))}else if(s>0){const f=a.getNextSibling();if(f&&zt(f)){let d=i+1;const g=f.getChildren();for(const m of g){if(s<=0)break;const y=i;if(i=d,o(m)){i=y;break}U(m)?d+=m.getTextContentSize():cr(m)&&(d+=1),i=y}const p=f.getChildren();for(const m of p)m.remove(),a.append(m);f.remove(),t==null||t.debug(`Merged next paragraph into current one after deleting symbolic close at currentIndex: ${i}. Original targetIndex: ${n}, remainingToDelete: ${s}.`)}else a.replace(Jt(),!0)}else ut(a)?a.replace(Jt(),!0):a.remove()}i+=1}else if(L(a)){const l=a.getChildren();for(const c of l){if(s<=0)break;if(o(c)&&s<=0)return!0}}return s<=0}o(r),s>0&&(t==null||t.warn(`Delete operation could not remove all requested characters. Remaining to delete: ${s}. Original targetIndex: ${n}, OT length: ${e}. Final currentIndex: ${i}`))}function UT(n,e,t,r){return e===Nl?HT(n,t,r):eo(t)?zT(n,e,t,r):(r==null||r.debug(`Attempting to insert text "${e}" with attributes ${JSON.stringify(t)} at index ${n}`),Hu(n,e,t,r))}function zT(n,e,t,r){r==null||r.debug(`Attempting to insert CharNode with text "${e}" and attributes ${JSON.stringify(t.char)} at index ${n}`);const i=ue(e);It(t,i);let s;{let u=function(g){if(U(g)){const p=g.getTextContentSize();if(n>=d&&n<=d+p){const m=g.getParent();return Le(m)&&(s=m),!0}d+=p}else if(cr(g))d+=1;else if(Le(g)){const p=g.getChildren();for(const m of p)if(u(m))return!0}else if(L(g)){const p=g.getChildren();for(const m of p)if(u(m))return!0;mn(g)&&(d+=1)}return!1};const f=pe();let d=0;u(f)}let o=t.char;if(Array.isArray(o)&&s){const u=s.getMarker(),f=Mi(s,ar),d=o[0];d&&d.style===u&&d.cid===f&&(o=o.slice(1),o.length===1&&(o=o[0]))}const a=typeof t.segment=="string"?t.segment:void 0,l=Ml(o,i,a);if(!Le(l))return r==null||r.error(`CharNode style is missing for text "${e}". Attributes: ${JSON.stringify(t.char)}. Falling back to rich text insertion.`),Hu(n,e,void 0,r);const c={};for(const[u,f]of Object.entries(t))u!=="char"&&u!=="segment"&&typeof f=="string"&&(c[u]=f);return Object.keys(c).length>0&&l.setUnknownAttributes(c),Jb(n,l,r)?e.length:(r==null||r.error(`Failed to insert CharNode with text "${e}" at index ${n}. Falling back to rich text.`),Hu(n,e,void 0,r))}function Hu(n,e,t,r){if(e.length<=0)return r==null||r.debug("Attempted to insert empty string. No action taken."),0;const i=pe();let s=0,o=!1;function a(l){if(o)return!0;if(U(l)){const c=l.getTextContentSize();if(n>=s&&n<=s+c){const u=n-s,f=ue(e);if(It(t,f),u===0)l.insertBefore(f);else if(u===c)l.insertAfter(f);else{const[,d]=l.splitText(u);d.insertBefore(f)}return r==null||r.debug(`Inserted text "${e}" in/around TextNode (key: ${l.getKey()}) at nodeOffset ${u}. Original targetIndex: ${n}, currentIndex at node start: ${s}.`),o=!0,!0}s+=c}else if(cr(l))s+=1;else if(Le(l)){if(!o&&n===s){const u=ue(e);It(t,u);const f=l.getFirstChild();return f?f.insertBefore(u):l.append(u),r==null||r.debug(`Inserted text "${e}" at beginning of CharNode ${l.getType()} (key: ${l.getKey()}).`),o=!0,!0}const c=l.getChildren();for(const u of c){if(a(u))return!0;if(o)break}if(!o&&n===s){const u=ue(e);return It(t,u),l.append(u),r==null||r.debug(`Appended text "${e}" to end of CharNode ${l.getType()} (key: ${l.getKey()}).`),o=!0,!0}}else if(mn(l)){if(!o&&n===s){const u=ue(e);It(t,u);const f=l.getFirstChild();return f?f.insertBefore(u):l.append(u),r==null||r.debug(`Inserted text "${e}" at beginning of container ${l.getType()} (key: ${l.getKey()}).`),o=!0,!0}const c=l.getChildren();for(const u of c){if(a(u))return!0;if(o)break}if(!o&&n===s){const u=ue(e);return It(t,u),l.append(u),r==null||r.debug(`Appended text "${e}" to end of container ${l.getType()} (key: ${l.getKey()}).`),o=!0,!0}s+=1}else if(L(l)){const c=l.getChildren();for(const u of c){if(a(u))return!0;if(o)break}}return o}if(a(i),!o&&n===s){r==null||r.debug(`Insertion point matches end of document (targetIndex: ${n}, final currentIndex: ${s}). Appending text to new ParaNode.`);const l=ue(e);It(t,l);const c=Jt().append(l);i.append(c),o=!0}return o?e.length:(r==null||r.warn(`$insertRichText: Could not find insertion point for text "${e}" at targetIndex ${n}. Final currentIndex: ${s}. Text not inserted.`),0)}function Jb(n,e,t){const r=pe();let i=0,s=!1;function o(a){if(s)return!0;if(a===r&&n===0&&!r.getFirstChild())return e.isInline()?(t==null||t.debug(`$insertNodeAtCharacterOffset: Inserting inline node ${e.getType()} into empty root, wrapped in ImpliedParaNode. targetIndex: ${n}`),r.append(Jt().append(e))):(t==null||t.debug(`$insertNodeAtCharacterOffset: Inserting block node ${e.getType()} directly into empty root. targetIndex: ${n}`),r.append(e)),s=!0,!0;if(!L(a))return!1;const l=a.getChildren();for(const c of l){if(n===i&&!s){if(a===r&&e.isInline())if(zt(c)){t==null||t.debug(`$insertNodeAtCharacterOffset: Inserting inline node ${e.getType()} into existing ${c.getType()} at beginning. targetIndex: ${n}`);const u=c.getFirstChild();u?u.insertBefore(e):c.append(e)}else t==null||t.debug(`$insertNodeAtCharacterOffset: Inserting inline node ${e.getType()} into root before ${c.getType()}, wrapping in ImpliedParaNode. targetIndex: ${n}`),c.insertBefore(Jt().append(e));else c.insertBefore(e),t==null||t.debug(`$insertNodeAtCharacterOffset: Inserted node ${e.getType()} (key: ${e.getKey()}) before child ${c.getType()} (key: ${c.getKey()}) in ${a.getType()} (key: ${a.getKey()}). targetIndex: ${n}, currentIndex: ${i}`);return s=!0,!0}if(U(c)){const u=c.getTextContentSize();if(!s&&n>i&&n<i+u){const f=n-i,[d]=c.splitText(f);return d.insertAfter(e),t==null||t.debug(`$insertNodeAtCharacterOffset: Inserted node ${e.getType()} (key: ${e.getKey()}) by splitting TextNode (key: ${c.getKey()}) at offset ${f}. targetIndex: ${n}, currentIndex at node start: ${i}`),s=!0,!0}i+=u}else if(cr(c))i+=1;else if(Le(c)){if(o(c))return!0}else if(mn(c)){const u=c;if(o(u))return!0;const f=i;if(Ln(u)&&mn(e)&&n===f&&!s)return t==null||t.debug(`$insertNodeAtCharacterOffset: Replacing ImpliedParaNode (key: ${u.getKey()}) with block node '${e.getType()}' (key: ${e.getKey()}) at OT index ${n}.`),c.replace(e,!0),i=f+1,s=!0,!0;i+=1}else if(L(c)&&o(c))return!0;if(s)return!0}return L(a)&&!s&&(n===i||a===r&&n>i)?a===r?(e.isInline()?(t==null||t.debug(`$insertNodeAtCharacterOffset: Appending inline node ${e.getType()} to root. Wrapping in new ImpliedParaNode. targetIndex: ${n}, current document OT length: ${i}.`),r.append(Jt().append(e))):(t==null||t.debug(`$insertNodeAtCharacterOffset: Appending block node ${e.getType()} to root. targetIndex: ${n}, current document OT length: ${i}.`),r.append(e)),s=!0,!0):zt(a)?Ln(a)&&ut(e)&&n===i?(t==null||t.debug(`$insertNodeAtCharacterOffset: Replacing ImpliedParaNode container (key: ${a.getKey()}) with ParaNode ${e.getType()} (key: ${e.getKey()}) via append logic. targetIndex: ${n}`),a.replace(e,!0),s=!0,!0):e.isInline()||!zt(e)?(t==null||t.debug(`$insertNodeAtCharacterOffset: Appending node ${e.getType()} to existing container ${a.getType()} (key: ${a.getKey()}). targetIndex: ${n}, container end OT index: ${i}.`),a.append(e),s=!0,!0):(t==null||t.debug(`$insertNodeAtCharacterOffset: Inserting block node ${e.getType()} after container ${a.getType()} (key: ${a.getKey()}). targetIndex: ${n}, container end OT index: ${i}.`),a.insertAfter(e),s=!0,!0):(e.isInline()||!zt(e)?(t==null||t.debug(`$insertNodeAtCharacterOffset: Appending node ${e.getType()} to generic element ${a.getType()} (key: ${a.getKey()}). targetIndex: ${n}, element end OT index: ${i}.`),a.append(e)):(t==null||t.debug(`$insertNodeAtCharacterOffset: Inserting block node ${e.getType()} after generic element ${a.getType()} (key: ${a.getKey()}). targetIndex: ${n}, element end OT index: ${i}.`),a.insertAfter(e)),s=!0,!0):s}return o(r),s||t==null||t.warn(`$insertNodeAtCharacterOffset: Could not find insertion point for node ${e.getType()} (key: ${e.getKey()}) at targetIndex ${n}. Final currentIndex: ${i}. Node not inserted.`),s}function KT(n,e,t,r,i){const s=e.insert;let o;return Qo("chapter",s)?o=JT(s.chapter,t):Qo("verse",s)?o=VT(s.verse,t):Qo("ms",s)?o=GT(s.ms):Qo("note",s)&&(o=YT(e,t,r)),o?Jb(n,o,i):(i==null||i.error(`$insertEmbedAtCurrentIndex: Cannot create LexicalNode for embed object: ${JSON.stringify(s)}`),!1)}function HT(n,e,t){let r;Gb(e)?r=Vb(e.para):ZT(e)&&(r=XT(e.book)),r??(r=Jt());const i=r,s=ut(i),o=Ln(i);let a=0,l=!1;function c(u){if(l)return!0;if(U(u)){const f=u.getTextContentSize();if(n>=a&&n<=a+f){const d=u.getParent();if(ut(d)&&(s||o)){t==null||t.debug(`Splitting ParaNode (marker: ${d.getMarker()}) with LF attributes at targetIndex ${n}`);const g=n-a,[p]=g>0?u.splitText(g):[void 0];let m=p==null?void 0:p.getPreviousSibling();for(;m;){const y=m;m=m.getPreviousSibling();const v=i.getFirstChild();v?v.insertBefore(y):i.append(y)}return p&&i.append(p),d.insertBefore(i),l=!0,!0}}a+=f}else if(cr(u))a+=1;else if(mn(u)){const f=u.getChildren();for(const d of f){if(c(d))return!0;if(l)break}if(n===a){if(Ln(u)&&i)return t==null||t.debug(`Replacing ImpliedParaNode (key: ${u.getKey()}) with ParaNode at targetIndex ${n}`),u.replace(i,!0),l=!0,!0;if(ut(u)&&i){const d=u;return t==null||t.debug(`Creating new block node with LF attributes after existing ParaNode (marker: ${d.getMarker()}) at targetIndex ${n}`),d.insertAfter(i),l=!0,!0}}if(a+=1,n===a&&ut(u)&&i)return t==null||t.debug(`Creating new block node after existing ParaNode (marker: ${u.getMarker()}) at targetIndex ${n}`),u.insertAfter(i),l=!0,!0}else if(L(u)){const f=u.getChildren();for(const d of f){if(c(d))return!0;if(l)break}}return l}return c(pe()),l||t==null||t.warn(`Could not find location to handle newline with para attributes at targetIndex ${n}. Final currentIndex: ${a}.`),1}function JT(n,e){const{number:t,sid:r,altnumber:i,pubnumber:s}=n;if(!t)return;const o=Ve(n,RT);let a;if(e.markerMode==="editable")a=fb(t,r,i,s,o);else{const l=e.markerMode==="visible";a=of(t,l,r,i,s,o)}return a}function VT(n,e){const{style:t,number:r,sid:i,altnumber:s,pubnumber:o}=n;if(!r)return;const a=Ve(n,DT);let l;if(e.markerMode==="editable"){if(!t)return;const c=ho(t,r);l=Tb(r,c,i,s,o,a)}else{const c=e.markerMode==="visible";l=yf(r,c,i,s,o,a)}return l}function GT(n){const{style:e,sid:t,eid:r}=n;if(!e)return;const i=Ve(n,LT);return kb(e,t,r,i)}function YT(n,e,t){var r;const i=n.insert,{style:s,caller:o,category:a,contents:l}=i.note;if(!s||!o)return;const c=Ve(i.note,jT),u=(r=n.attributes)==null?void 0:r.segment;let f;u&&typeof u=="string"&&(f=u);const d=[];for(const g of(l==null?void 0:l.ops)??[])typeof g.insert=="string"&&(eo(g.attributes)?d.push(Ml(g.attributes.char,ue(g.insert))):d.push(ue(g.insert)));return Bb(s,o,d,e,t,f).setCategory(a).setUnknownAttributes(c)}function XT(n){const{style:e,code:t}=n;if(!e||e!==Tl||!t||!Ft.isValidBookCode(t))return;const r=Ve(n,IT);return lb(t,r)}function Vb(n){const{style:e}=n;if(!e)return;const t=Ve(n,PT);return Xs(e,t)}function Ml(n,e,t){if(Array.isArray(n)){if(n.length===0)throw new Error("Empty charAttr array");return n.reduceRight((r,i,s)=>{const o=Mn(i.style,Ve(i,rl));return typeof i.cid=="string"&&An(o,ar,()=>i.cid),t&&s===n.length-1&&An(o,Wi,()=>t),r&&o.append(r),o},e)}else{const r=Mn(n.style,Ve(n,rl));return typeof n.cid=="string"&&An(r,ar,()=>n.cid),t&&An(r,Wi,()=>t),e&&r.append(e),r}}function Qo(n,e){if(!(n in e))return!1;const t=e[n];return typeof t=="object"&&t!==null}function ZT(n){return!!n&&!!n.book&&typeof n.book=="object"&&n.book!==null&&"style"in n.book&&typeof n.book.style=="string"&&"code"in n.book&&typeof n.book.code=="string"}function Gb(n){return!!n&&!!n.para&&typeof n.para=="object"&&n.para!==null&&"style"in n.para&&typeof n.para.style=="string"}function eo(n){return!!n&&!!n.char&&typeof n.char=="object"&&n.char!==null&&(!Array.isArray(n.char)&&"style"in n.char&&typeof n.char.style=="string"||Array.isArray(n.char)&&n.char.length>0&&"style"in n.char[0]&&typeof n.char[0].style=="string")}function QT(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&Object.keys(n).length===0}function It(n,e){if(n)for(const t of Object.keys(n)){if(t==="segment"&&typeof n[t]=="string"){const r=n[t];An(e,Wi,()=>r);continue}if(eE(t)){const r=!!n[t],i=t,s=e.hasFormat(i);(r&&!s||!r&&s)&&e.toggleFormat(i)}}}const Yb=["bold","underline","strikethrough","italic","highlight","code","subscript","superscript","lowercase","uppercase","capitalize"];function eE(n){return Yb.includes(n)}function tE({viewOptions:n}){const[e]=ge();return nE(e,n),null}function nE(n,e){x.useEffect(()=>{if(!n.hasNodes([qn,bt,ft]))throw new Error("ArrowNavigationPlugin: ImmutableChapterNode, ImmutableVerseNode or NoteNode not registered on editor!");const t=r=>{if(r.key!=="ArrowLeft"&&r.key!=="ArrowRight")return!1;const i=K();if(!B(i)||!i.isCollapsed())return!1;const s=n.getRootElement();if(!s)return!1;const o=s.dir||"ltr";let a=!1;return rE(o,r.key)?a=sE(i):iE(o,r.key)&&(a=oE(i,e)),a&&r.preventDefault(),a};return n.registerCommand(zi,t,hl)},[n,e])}function rE(n,e){return n==="ltr"&&e==="ArrowRight"||n==="rtl"&&e==="ArrowLeft"}function iE(n,e){return n==="ltr"&&e==="ArrowLeft"||n==="rtl"&&e==="ArrowRight"}function sE(n){var e,t,r;const i=n.anchor.getNode(),s=u1(n);if(we(s)&&!go(s.getFirstChild())){if(zt(i)){if(n.anchor.offset===i.getChildrenSize())return!1}else if(n.anchor.offset!==i.getTextContentSize())return!1;if(s.getIsCollapsed()){if(s.is((e=s.getParent())==null?void 0:e.getLastChild()))return(r=(t=s.getParent())==null?void 0:t.getNextSibling())==null||r.selectStart(),!0}else return tl(s.getFirstChild())?s.select(2,2):s.select(1,1),!0}if(zt(i)&&we(s)&&s.getIsCollapsed()){const a=s.getNextSibling();return a?a.selectStart():s.selectEnd(),!0}const o=s==null?void 0:s.getParent();if(tl(s)&&we(o)&&s.is(o==null?void 0:o.getLastChild())){const a=o.getNextSibling();return a?a.selectStart():o.selectEnd(),!0}return!1}function oE(n,e){const t=d1(n);if(fo(t)&&!t.getPreviousSibling())return!0;if(n.anchor.offset!==0)return!1;const r=n.anchor.getNode();if(gn(r.getParent()))return!0;if(we(t)&&t.getIsCollapsed()){const s=t.getPreviousSibling();if(!po(s))return!1;const o=t.getParent();if(!o)return!1;const a=t.getIndexWithinParent();return o.select(a,a),!0}if(zt(t)&&(e==null?void 0:e.noteMode)==="collapsed"){const s=t.getLastChild();if(!s)return!1;const o=Xt(s,a=>we(a));if(we(o)&&o.getIsCollapsed()){const a=o.getParent();if(!a)return!1;const l=o.getIndexWithinParent();return a.select(l,l),!0}}const i=Eb(r);if(!i||i.getIsCollapsed())return!1;if(_r(t)){const s=i.getParent();if(!s)return!1;const o=i.getIndexWithinParent();return s.select(o,o),!0}return!1}function aE(){const[n]=ge();return lE(n),null}function lE(n){x.useEffect(()=>{if(!n.hasNodes([Ie]))throw new Error("CharNodePlugin: CharNode not registered on editor!");return n.registerNodeTransform(Ie,cE)},[n])}function cE(n){if(!Le(n))return;if(n.isEmpty()){n.remove();return}const e=n.getMarker(),t=Mi(n,ar),r=n.getUnknownAttributes(),i=n.getNextSibling();Le(i)&&Bu({style:e,cid:t},i)&&Hn(r,i.getUnknownAttributes())&&(n.append(...i.getChildren()),i.remove());const s=n.getPreviousSibling();Le(s)&&Bu({style:e,cid:t},s)&&Hn(r,s.getUnknownAttributes())&&(s.append(...n.getChildren()),n.remove())}function Xb(n){return n.replaceAll("	"," ")}const Zb=n=>{navigator.clipboard.read().then(async e=>{if((await navigator.permissions.query({name:"clipboard-read"})).state==="denied"){alert("Not allowed to paste from clipboard.");return}const t=new DataTransfer,r=e[0];for(const s of r.types){const o=await(await r.getType(s)).text();t.setData(s,Xb(o))}const i=new ClipboardEvent("paste",{clipboardData:t});n.dispatchCommand(Xr,i)})},Qb=n=>{navigator.clipboard.read().then(async()=>{if((await navigator.permissions.query({name:"clipboard-read"})).state==="denied"){alert("Not allowed to paste from clipboard.");return}const e=new DataTransfer,t=await navigator.clipboard.readText();e.setData("text/plain",Xb(t));const r=new ClipboardEvent("paste",{clipboardData:e});n.dispatchCommand(Xr,r)})};function uE(){const[n]=ge();return x.useEffect(()=>{const e=t=>{const{key:r,shiftKey:i,metaKey:s,ctrlKey:o,altKey:a}=t;!(bu?s:o)||a||(!i&&r.toLowerCase()==="c"?(t.preventDefault(),n.dispatchCommand(Zr,null)):!i&&r.toLowerCase()==="x"?(t.preventDefault(),n.dispatchCommand(Ki,null)):r.toLowerCase()==="v"&&(t.preventDefault(),i?Qb(n):Zb(n)))};return n.registerRootListener((t,r)=>{r!==null&&r.removeEventListener("keydown",e),t!==null&&t.addEventListener("keydown",e)})},[n]),null}function dE({logger:n}){const[e]=ge();return x.useEffect(()=>He(e.registerCommand(zi,t=>t.key!=="\\"&&t.key!=="/"?!1:(t.preventDefault(),!0),ma),e.registerCommand(Xr,t=>{var r;const i=(r=t.clipboardData)==null?void 0:r.getData("text/plain");return!i||!i.includes("\\")&&!i.includes("/")?!1:(n==null||n.info("CommandMenuPlugin: paste containing backslash or forward slash ignored."),t.preventDefault(),!0)},ma),e.registerCommand(dl,t=>{var r;const i=(r=t.dataTransfer)==null?void 0:r.getData("text/plain");return!i||!i.includes("\\")&&!i.includes("/")?!1:(n==null||n.info("CommandMenuPlugin: drag containing backslash or forward slash ignored."),t.preventDefault(),!0)},ma)),[e,n]),null}function fE({index:n,isSelected:e,onClick:t,onMouseEnter:r,option:i}){let s="item";return e&&(s+=" selected"),i.isDisabled&&(s+=" disabled"),S.jsx("li",{tabIndex:-1,className:s,ref:i.setRefElement,role:"option","aria-selected":e,"aria-disabled":i.isDisabled,id:"typeahead-item-"+n,onMouseEnter:r,onClick:i.isDisabled?void 0:t,children:S.jsx("span",{className:"text",children:i.title})},i.key)}function hE({options:n,selectedItemIndex:e,onOptionClick:t,onOptionMouseEnter:r}){return S.jsx("div",{className:"typeahead-popover",children:S.jsx("ul",{children:n.map((i,s)=>S.jsx(fE,{index:s,isSelected:e===s,onClick:()=>t(i,s),onMouseEnter:()=>r(s),option:i},i.key))})})}class ea extends CC{constructor(e,t){super(e),Q(this,"title"),Q(this,"onSelect"),Q(this,"isDisabled"),this.title=e,this.onSelect=t.onSelect.bind(this),this.isDisabled=t.isDisabled||!1}}function gE(n,e="editor-input"){return n?n.classList.contains(e):!1}function pE(){const[n]=ge(),[e,t]=x.useState(()=>!n.isEditable()),r=x.useRef(void 0),i=x.useRef(void 0),s=x.useRef(void 0),o=x.useMemo(()=>[new ea("Cut",{onSelect:()=>{n.dispatchCommand(Ki,null)},isDisabled:e}),new ea("Copy",{onSelect:()=>{n.dispatchCommand(Zr,null)}}),new ea("Paste",{onSelect:()=>{Zb(n)},isDisabled:e}),new ea("Paste as Plain Text",{onSelect:()=>{Qb(n)},isDisabled:e})],[n,e]),a=x.useCallback((l,c,u)=>{n.update(()=>{l==null||l.onSelect(c),u()})},[n]);return x.useEffect(()=>{var l;i.current=((l=n.getRootElement())==null?void 0:l.className)??""},[n]),x.useEffect(()=>{const l=()=>{var c;(c=s.current)==null||c.call(s)};return window.addEventListener("scroll",l,!0),()=>{window.removeEventListener("scroll",l,!0)}},[]),x.useEffect(()=>n.registerEditableListener(l=>{t(!l)}),[n]),S.jsx(EC,{options:o,onSelectOption:a,onWillOpen:l=>{r.current=l.target},menuRenderFn:(l,{selectedIndex:c,options:u,selectOptionAndCleanUp:f,setHighlightedIndex:d},{setMenuRef:g})=>(s.current=()=>f(void 0),l.current&&!gE(r.current,i.current)&&!_b(r.current)?Nt.createPortal(S.jsx("div",{className:"typeahead-popover auto-embed-menu",style:{marginLeft:l.current.style.width,userSelect:"none",width:200},ref:g,children:S.jsx(hE,{options:o,selectedItemIndex:c,onOptionClick:(p,m)=>{p.isDisabled||(d(m),f(p))},onOptionMouseEnter:p=>{d(p)}})}),l.current):null)})}function mE({isEditable:n}){const[e]=ge();return x.useLayoutEffect(()=>{e.setEditable(n)},[e,n]),null}function yE({scripture:n,nodeOptions:e,editorAdaptor:t,viewOptions:r,logger:i}){const[s]=ge();return x.useEffect(()=>{var o;(o=t.initialize)==null||o.call(t,e,i)},[t,i,e]),x.useEffect(()=>{var o;(o=t.reset)==null||o.call(t);const a=t.serializeEditorState(n,r);if(a==null){i==null||i.warn("LoadStatePlugin: serializedEditorState was null or undefined. Skipping editor update.");return}try{const l=s.parseEditorState(a);s.update(()=>{s.setEditorState(l),s.dispatchCommand(Cm,void 0)},{tag:nf})}catch{i==null||i.error("LoadStatePlugin: error parsing or setting editor state.")}},[s,t,i,n,r]),null}function _E({expandedNoteKeyRef:n,nodeOptions:e,viewOptions:t,logger:r}){const[i]=ge();return bE(e,r),vE(i,n,t,r),null}function bE(n,e){const t=x.useRef(void 0),r=n.noteCallers;x.useEffect(()=>{let i=r;(!i||i.length<=0)&&(i=j1),t.current!==i&&(t.current=i,NE("note-callers",i,e))},[e,r])}function vE(n,e,t,r){x.useEffect(()=>{if(!n.hasNodes([Ie,ft,Vt]))throw new Error("NoteNodePlugin: CharNode, NoteNode or ImmutableNoteCallerNode not registered on editor!");const i=s=>n.update(()=>EE(s));return He(n.registerNodeTransform(ft,s=>kE(s,t)),n.registerNodeTransform(Ie,wE),n.registerNodeTransform(At,xE),n.registerNodeTransform(Vt,CE),n.registerMutationListener(Vt,(s,{prevEditorState:o})=>SE(s,o)),n.registerCommand(Yr,()=>TE(n,e,t,r),ei),n.registerRootListener((s,o)=>{o!==null&&o.removeEventListener("dblclick",i),s!==null&&s.addEventListener("dblclick",i)}))},[n,e,r,t])}function kE(n,e){const t=n.getChildren();if(!t.some(r=>_r(r))&&(e==null?void 0:e.markerMode)!=="editable"&&n.remove(),t.length>0){const r=t[0];U(r)&&!go(r)&&n.insertBefore(r)}}function wE(n){const e=n.getParentOrThrow(),t=e.getChildren(),r=t.find(o=>_r(o));if(!Le(n)||!we(e)||!r)return;const i=gf(t);r.getPreviewText()!==i&&r.setPreviewText(i);const s=n.getNextSibling();U(s)?s.getTextContent()!==Oe&&s.setTextContent(Oe):n.insertAfter(ue(Oe))}function xE(n){const e=Eb(n),t=e==null?void 0:e.getChildren(),r=t==null?void 0:t.find(s=>_r(s));if(!U(n)||!we(e)||!r||!t)return;const i=gf(t);r.getPreviewText()!==i&&r.setPreviewText(i),!(go(n)||!we(n.getParent()))&&n.getTextContent()!==Oe&&(n.setTextContent(Oe),n.selectEnd())}function CE(n){if(!_r(n))return;const e=n.getNextSibling();!U(e)||go(e)?n.insertAfter(ue(Oe)):e.getTextContent()!==Oe&&e.setTextContent(Oe)}function SE(n,e){for(const[t,r]of n){if(r!=="destroyed")continue;const i=e.read(()=>{const o=he(t),a=o==null?void 0:o.getParent();return _r(o)&&we(a)&&a.getCaller()===Kr}),s=document.querySelector(".editor-input");!i||!s||(s.classList.add("reset-counters"),s.offsetHeight,s.classList.remove("reset-counters"))}}function TE(n,e,t,r){var i;if((t==null?void 0:t.noteMode)!=="expandInline")return!1;const s=K();if(!B(s)||!s.isCollapsed())return!1;const o=s.anchor,a=o.getNode();if(e.current){const l=Xt(a,c=>we(c));if(l)e.current!==l.getKey()&&(e.current=l.getKey());else{const c=he(e.current);c&&!c.getIsCollapsed()&&(r==null||r.debug("Cursor moved away from NoteNode, collapsing it"),xs(n,e.current,r)),e.current=void 0}}if(o.offset===0){const l=a.getPreviousSibling();if(we(l)){r==null||r.debug("Cursor is just after a NoteNode");const c=l.getKey();l.getIsCollapsed()?e.current=c:e.current=void 0,xs(n,c,r)}}if(o.offset===a.getTextContentSize()){const l=a.getNextSibling();if(we(l)){r==null||r.debug("Cursor is just before a NoteNode");const c=l.getKey();l.getIsCollapsed()?e.current=c:e.current=void 0,xs(n,c,r)}else if(!l){const c=Xt(a,u=>we(u));if(c&&c.getIsCollapsed()&&zt(c.getParent())&&c.is((i=c.getParent())==null?void 0:i.getLastChild())){r==null||r.debug("Cursor is at end of note at end of para");const u=c.getKey();e.current=u,xs(n,u,r)}}}if(zt(a)){const l=a.getChildAtIndex(o.offset),c=l==null?void 0:l.getPreviousSibling();if(po(c)&&we(l)){r==null||r.debug("Cursor is between verse and NoteNode");const u=l.getKey();l.getIsCollapsed()?e.current=u:e.current=void 0,xs(n,u,r)}}return!1}function xs(n,e,t){const r=he(e);try{r==null||r.toggleIsCollapsed()}catch(i){if(i instanceof Error&&i.message.includes("read only"))t==null||t.warn("Fallback triggered after stabilization - edge case"),setTimeout(()=>{n.update(()=>{r==null||r.toggleIsCollapsed()})},0);else throw i}}function EE(n){const e=K();if(!B(e))return;const t=e.anchor,r=e.focus,i=t.getNode(),s=r.getNode();if(we(i)&&U(s)){n.preventDefault();const o=ro();o.anchor.set(s.getKey(),0,"text"),o.focus.set(s.getKey(),r.offset,"text"),rt(o)}}function NE(n,e,t){for(const r of document.styleSheets)try{const i=r.cssRules||r.rules;for(const s of i)if(ME(s,n)){const o=e.map(a=>`"${a}"`).join(" ");s.symbols=o;return}}catch{continue}t==null||t.warn(`Editor: counter style "${n}" not found.`)}function ME(n,e){return typeof n=="object"&&n!==null&&"name"in n&&n.name===e&&"symbols"in n&&typeof n.symbols=="string"}function AE({onChange:n}){const[e]=ge();return x.useEffect(()=>e.registerCommand(Yr,()=>{const t=e.read(()=>Fb());return n==null||n(t),!1},ei),[e,n]),null}function OE(){const[n]=ge();return $E(n),null}function $E(n){x.useEffect(()=>{if(!n.hasNodes([St]))throw new Error("ParaNodePlugin: ParaNode not registered on editor!");return n.registerNodeTransform(St,e=>PE(e,n))},[n])}function PE(n,e){vf(e,n.getKey())&&Ub(n.getFirstChild()),!(!ut(n)||n.getMarker()!=="b"||n.isEmpty()||!e.getEditorState().read(()=>{const t=he(n.getKey());return ut(t)&&((t==null?void 0:t.isEmpty())??!1)}))&&n.clear()}function IE({textDirection:n}){const[e]=ge();return RE(e,n),DE(e),null}function RE(n,e){x.useEffect(()=>{function t(){const r=n.getRootElement();if(!r||e==="auto")return;r.dir=e;const i=n._config.theme.placeholder,s=document.getElementsByClassName(i)[0];s&&(s.dir=e)}return t(),n.registerUpdateListener(({dirtyElements:r})=>{r.size>0&&t()})},[n,e])}function DE(n){x.useEffect(()=>{const e=t=>{if(t.key!=="ArrowLeft"&&t.key!=="ArrowRight")return!1;const r=K();if(!B(r))return!1;const i=r.anchor.getNode(),s=Xt(i,f=>y1(f,n)==="p");if(!s)return!1;const o=n.getElementByKey(s.getKey());if(!o)return!1;const a=o.parentElement,l=o.dir||"ltr",c=((a==null?void 0:a.dir)??"")||"ltr";if(!a||l===c)return!1;const u=a.dir==="rtl"&&t.key==="ArrowLeft"||a.dir==="ltr"&&t.key==="ArrowRight";return r.modify("move",u,"character"),t.preventDefault(),!0};return n.registerCommand(zi,e,hl)},[n])}function LE(){const[n]=ge();return jE(n),null}function jE(n){x.useEffect(()=>{if(!n.hasNodes([Ie,bt,ft,At,_t]))throw new Error("TextSpacingPlugin: CharNode, ImmutableVerseNode, NoteNode, TextNode or VerseNode not registered on editor!");return He(n.registerNodeTransform(At,FE),n.registerNodeTransform(At,e=>qE(e,n)),n.registerNodeTransform(_t,Qg),n.registerNodeTransform(bt,Qg))},[n])}function FE(n){if(!n.isAttached())return;const e=n.getTextContent(),t=n.getNextSibling(),r=n.getParent();n.getMode()!=="normal"||e.endsWith(" ")&&e.length>1||we(t)||Le(r)||nt(r)||uo(r)||(e===" "&&!Lt(t)?n.setTextContent(""):bf(n))}function qE(n,e){const t=n.getParent();!uo(t)||!n.isAttached()||vf(e,n.getKey())&&t.insertAfter(n)}function Qg(n){if(!n.isAttached())return;const e=n.getPreviousSibling();e&&!Lt(e)&&!U(e)&&!uo(e)&&n.insertBefore(ue(" "))}function BE({trigger:n,scriptureReference:e,contextMarker:t,getMarkerAction:r}){const{markersMenuItems:i}=gT({scriptureReference:e,contextMarker:t,getMarkerAction:r});return S.jsx(hT,{trigger:n,items:i})}function WE({trigger:n,scrRef:e,getMarkerAction:t}){const{book:r,chapterNum:i,verseNum:s,verse:o}=e,a=x.useMemo(()=>e,[r,i,s,o]),[l]=ge(),[c]=UE(l);return zE(l),S.jsx(BE,{trigger:n,scriptureReference:a,contextMarker:c,getMarkerAction:t})}function UE(n){const[e,t]=x.useState();return x.useEffect(()=>n.registerCommand(Yr,()=>(n.read(()=>{const r=K();if(!B(r)){e&&t(void 0);return}const i=he(r.anchor.key),s=he(r.focus.key);if(!i||!s){e&&t(void 0);return}const o=f1(i,s);if(!o||!G1(o)){e&&t(void 0);return}const a=o.getMarker();e!==a&&t(a)}),!1),ei),[e,n]),[e]}function zE(n){x.useEffect(()=>{if(!n.hasNodes([_t,bt]))throw new Error("UsjNodesMenuPlugin: VerseNode or ImmutableVerseNode not registered on editor!");const e={},t={};return He(n.registerNodeTransform(bt,r=>ep(r,n,e)),n.registerNodeTransform(_t,r=>ep(r,n,e)),n.registerMutationListener(bt,r=>ip(r,n,e,t)),n.registerMutationListener(_t,r=>ip(r,n,e,t)))},[n])}function ep(n,e,t){kw(nf)||vf(e,n.getKey())&&JE(n,t)}function tp(n){return RegExp(/(\d+)([a-zA-Z]+)?(-(\d+)([a-zA-Z]+)?)?/).exec(n)}const np=2,KE=3,rp=4,HE=5;function JE(n,e){var t;const r=df(n),i=r==null?void 0:r.getNumber();if(!i)return;const s=e[i];if(!s)return;let o=parseInt(n.getNumber()),a=((t=tp(n.getNumber()))==null?void 0:t[np])??"";s.forEach(l=>{const c=he(l);if(!c)return;const u=c.getNumber(),f=parseInt(u),d=tp(u),g=!!(d!=null&&d[KE]),p=g?parseInt(d[rp]):f;if(p<o||f>o||p===o&&a)return;const m=(d==null?void 0:d[np])??"",y=(d==null?void 0:d[HE])??"",v=g?Wu(parseInt(d[rp]),void 0):"";let _=`${m}`;_+=g?`-${v}${y}`:"";const w=Wu(f,void 0);c.setNumber(`${w}${_}`),o=parseInt(g?v:w),a=g?y:m})}function ip(n,e,t,r){e.getEditorState().read(()=>{for(const[i,s]of n){const o=he(i);if(Lt(o)){if(s==="created"){const a=df(o);if(!a)continue;const l=a.getNumber();t[l]||(t[l]=[]),t[l].push(i),r[i]=l}else if(s==="destroyed"){const a=r[i],l=t[a];if(!l)continue;const c=l.findIndex(u=>u===i);if(c===-1)continue;l.splice(c,1),Reflect.deleteProperty(r,i)}}}})}const ev="formatted",VE="unformatted";let wf;function GE(n){const e=YE(n);if(!e)throw new Error(`Invalid view mode: ${n}`);wf=e}GE(ev);const mo=()=>wf;function YE(n){let e;switch(n){case ev:e={markerMode:"hidden",noteMode:"collapsed",hasSpacing:!0,isFormattedFont:!0};break;case VE:e={markerMode:"editable",noteMode:"expanded",hasSpacing:!1,isFormattedFont:!1};break}return e}function XE(n){if(n)return n.markerMode==="editable"?_t:bt}function ZE(n){const e=[],t=n??wf;return t&&(e.push(`${qS}${t.markerMode}`),t.hasSpacing&&e.push(jS),t.isFormattedFont&&e.push(FS)),e}function QE({scrRef:n,onScrRefChange:e}){const[t]=ge(),r=x.useRef(!1),i=x.useRef(!1),{book:s,chapterNum:o,verseNum:a}=n;return x.useEffect(()=>t.registerMutationListener(Ft,l=>{t.update(()=>{for(const[c,u]of l){const f=he(c);f&&gn(f)&&u==="created"&&sp(o,a,i)}},{tag:ju})},{skipInitialization:!0}),[t,o,a]),x.useEffect(()=>{r.current?r.current=!1:t.update(()=>sp(o,a,i),{tag:ju})},[t,o,a]),x.useEffect(()=>t.registerCommand(Yr,()=>(i.current?i.current=!1:eN(s,o,a,e,r),!1),ei),[t,s,o,a,e]),null}function sp(n,e,t){var r;const i=Ab(K()),s=(r=Wb(i))==null?void 0:r.getNumber();if(_1(s)&&pf(e,s))return;const o=pe().getChildren(),a=a1(o,n),l=p1(o,a),c=l1(l,!!a);if(c&&!a||!a)return;g1(l,c);const u=V1(l,e);if(u){if(ut(u)){const f=u.getFirstChild();U(f)?f.select(0,0):u.select(0,0)}else u.selectNext(0,0);t.current=!0}}function eN(n,e,t,r,i){const s=Ab(K());if(!s)return;const o=df(s),a=parseInt((o==null?void 0:o.getNumber())??"1",10),l=Wb(s),c=l==null?void 0:l.getNumber(),u=parseInt(c??"0",10),f=c?pf(t,c):t===u;if(i.current=!!(o&&a!==e||!f),i.current){const d={book:n,chapterNum:a,verseNum:u};c!=null&&u.toString()!==c&&(d.verse=c),r(d)}}function tN(n){return gn(n)?`${n.__code}`:sf(n)?`${n.__marker} "${n.__number}"`:Le(n)?`${n.__marker}`:fo(n)?`${n.__marker} "${n.__number}"`:_r(n)?`${n.__caller}`:po(n)?`${n.__marker} "${n.__number}"`:we(n)?`${n.__marker} "${n.__caller}"`+(n.__isCollapsed?" (collapsed)":" (expanded)"):ut(n)?`${n.__marker}`:nt(n)?`ids: [ ${JSON.stringify(n.getTypedIDs())} ]`:uf(n)?`${n.__marker} "${n.__number}"`:""}function nN(){const[n]=ge();return S.jsx(Jx,{viewClassName:"tree-view-output",treeTypeButtonClassName:"debug-treetype-button",timeTravelPanelClassName:"debug-timetravel-panel",timeTravelButtonClassName:"debug-timetravel-button",timeTravelPanelSliderClassName:"debug-timetravel-panel-slider",timeTravelPanelButtonClassName:"debug-timetravel-panel-button",customPrintNode:tN,editor:n})}const op={type:Ti,version:Si,content:[]};let Ju;function rN(n){n&&(Ju=n)}function iN(n){if(n.isEmpty())return op;const e=n.toJSON();if(!e.root||!e.root.children)return;const t=e.root.children;if(t.length===1&&af(t[0])&&(!t[0].children||t[0].children.length===0))return op;const r=tv(t),i=Kn(r);return i?{type:Ti,version:Si,content:i}:void 0}function sN(n,e){const{type:t,marker:r,unknownAttributes:i}=n;let s;return n.code!==""&&(s=n.code),We({type:t,marker:r,code:s,...i,content:e})}function oN(n){const{marker:e,number:t,sid:r,altnumber:i,pubnumber:s,unknownAttributes:o}=n;return We({type:Qt.getType(),marker:e,number:t,sid:r,altnumber:i,pubnumber:s,...o})}function aN(n,e){const{marker:t,sid:r,altnumber:i,pubnumber:s,unknownAttributes:o}=n,a=e&&typeof e[0]=="string"?e[0]:void 0;let{number:l}=n;return l=Nb(t,a,l),We({type:Qt.getType(),marker:t,number:l,sid:r,altnumber:i,pubnumber:s,...o})}function lN(n){const{marker:e,sid:t,altnumber:r,pubnumber:i,unknownAttributes:s}=n,{text:o}=n;let{number:a}=n;return a=Nb(e,o,a),We({type:_t.getType(),marker:e,number:a,sid:t,altnumber:r,pubnumber:i,...s})}function cN(n,e){const{type:t,marker:r,unknownAttributes:i}=n;return e==null||e.forEach((s,o)=>{typeof s=="string"&&s.startsWith(Oe)&&(e[o]=s.slice(1))}),We({type:t,marker:r,...i,content:e})}function uN(n,e){const{type:t,marker:r,unknownAttributes:i}=n;return We({type:t,marker:r,...i,content:e})}function dN(n,e){const{type:t,marker:r,caller:i,category:s,unknownAttributes:o}=n;return We({type:t,marker:r,caller:i,category:s,...o,content:e})}function _i(n){const{type:e,marker:t,sid:r,eid:i,unknownAttributes:s}=n;return We({type:e,marker:t,sid:r,eid:i,...s})}function fN(n){return n.text}function hN(n,e){const{tag:t,marker:r,unknownAttributes:i}=n;return We({type:t,marker:r,...i,content:e})}function gN(n){const{marker:e}=n;return{type:nl,marker:e}}function ap(n,e){const t=n[n.length-1];t&&typeof t=="string"?n[n.length-1]=t+e:n.push(e)}function pN(n,e,t,r,i){const s=pn.getType(),o=e.filter(a=>!t.includes(a));if(t.filter(a=>!e.includes(a)).forEach(a=>{const l=_i({type:s,marker:Ci,eid:a});i.push(l)}),o.forEach(a=>{const l=_i({type:s,marker:Hr,sid:a});i.push(l)}),e.length===0){const a=_i({type:s,marker:Hr});i.push(a)}if(i.push(...n),e.length===0){const a=_i({type:s,marker:Ci});i.push(a)}(!r||!x1(r))&&e.forEach(a=>{const l=_i({type:s,marker:Ci,eid:a});i.push(l)})}function Kn(n,e){const t=[];let r,i=[];return n.forEach((s,o)=>{const a=s,l=s,c=s,u=s,f=s,d=s,g=s,p=s;switch(s.type){case Ft.getType():t.push(sN(a,Kn(a.children)));break;case qn.getType():t.push(oN(s));break;case Qt.getType():t.push(aN(l,Kn(l.children)));break;case bt.getType():case _t.getType():t.push(lN(s));break;case Ie.getType():t.push(cN(c,Kn(c.children)));break;case St.getType():t.push(uN(u,Kn(u.children)));break;case ft.getType():t.push(dN(f,Kn(f.children,f.caller)));break;case mr.getType():case Vt.getType():case Qr.getType():case ri.getType():break;case et.getType():if(r=Kn(g.children),r){const m=g.typedIDs[Zn];if(m)pN(r,m,i,n[o+1],t),i=m;else{const y=r.shift();y&&(typeof y=="string"?ap(t,y):t.push(y)),r.length>0&&t.push(...r)}}break;case pn.getType():t.push(_i(s));break;case At.getType():d.text&&d.text!==Oe&&!d.text.startsWith(cb)&&(!e||d.text!==hf(e))&&ap(t,fN(d));break;case ni.getType():t.push(hN(p,Kn(p.children)));break;case yr.getType():t.push(gN(s));break;default:Ju==null||Ju.error(`Unexpected node type '${s.type}'!`)}}),t&&t.length>0?t:void 0}function tv(n){const e=n.findIndex(t=>af(t));if(e>=0){const t=n.slice(0,e),r=n[e].children,i=tv(n.slice(e+1));n=[...t,...r,...i]}return n}const Hc={initialize:rN,deserializeEditorState:iN},lp=nv([]),mN={type:Qr.getType(),version:1};let il=[],ae,Ca,Vu,Ae;function yN(n,e){il=[],vN(n),kN(e)}function _N(n=0){}function bN(n,e){ae=e??mo();let t;return n?(n.type!==Ti&&(Ae==null||Ae.warn(`This USJ type '${n.type}' didn't match the expected type '${Ti}'.`)),n.version!==Si&&(Ae==null||Ae.warn(`This USJ version '${n.version}' didn't match the expected version '${Si}'.`)),n.content.length>0?t=Yu(As(n.content)):t=[lp]):t=[lp],Vu==null||Vu(il),{root:{children:t,direction:null,format:"",indent:0,type:"root",version:1}}}function vN(n){n&&(Ca=n),n!=null&&n.addMissingComments&&(Vu=n.addMissingComments)}function kN(n){n&&(Ae=n)}function wN(n){return!n||n.length!==1||typeof n[0]!="string"?"":n[0]}function xN(n){const{marker:e,code:t}=n;e!==Tl&&(Ae==null||Ae.warn(`Unexpected book marker '${e}'!`)),(!t||!Ft.isValidBookCode(t))&&(Ae==null||Ae.warn(`Unexpected book code '${t}'!`));const r=[];((ae==null?void 0:ae.markerMode)==="editable"||(ae==null?void 0:ae.markerMode)==="visible")&&r.push(Vr("marker",pr(e)+" "+t+Oe)),r.push(Jr(wN(n.content)));const i=Ve(n);return We({type:Ft.getType(),marker:e,code:t??"",unknownAttributes:i,children:r,direction:null,format:"",indent:0,version:ab})}function CN(n){const{marker:e,number:t,sid:r,altnumber:i,pubnumber:s}=n;e!==rf&&(Ae==null||Ae.warn(`Unexpected chapter marker '${e}'!`));const o=Ve(n);let a;return(ae==null?void 0:ae.markerMode)==="visible"&&(a=!0),(ae==null?void 0:ae.markerMode)==="editable"?We({type:Qt.getType(),marker:e,number:t??"",sid:r,altnumber:i,pubnumber:s,unknownAttributes:o,children:[Jr(ho(e,t)??"")],direction:null,format:"",indent:0,version:db}):We({type:qn.getType(),marker:e,number:t??"",showMarker:a,sid:r,altnumber:i,pubnumber:s,unknownAttributes:o,version:mb})}function SN(n){const{marker:e,number:t,sid:r,altnumber:i,pubnumber:s}=n;e!==cf&&(Ae==null||Ae.warn(`Unexpected verse marker '${e}'!`));const o=(XE(ae)??bt).getType(),a=(ae==null?void 0:ae.markerMode)==="editable"?Sb:jb;let l,c;(ae==null?void 0:ae.markerMode)==="editable"?l=ho(e,t):(ae==null?void 0:ae.markerMode)==="visible"&&(c=!0);const u=Ve(n);return We({type:o,text:l,marker:e,number:t??"",sid:r,altnumber:i,pubnumber:s,showMarker:c,unknownAttributes:u,version:a})}function TN(n,e=[]){const{marker:t}=n;Ie.isValidMarker(t)||Ae==null||Ae.warn(`Unexpected char marker '${t}'!`),(ae==null?void 0:ae.markerMode)==="editable"&&e.forEach(i=>{ff(i)&&(i.text=Oe+i.text)});const r=Ve(n);return We({type:Ie.getType(),marker:t,unknownAttributes:r,children:[...e],direction:null,format:"",indent:0,textFormat:0,textStyle:"",version:pb})}function nv(n){return{type:lr.getType(),children:n,direction:null,format:"",indent:0,textFormat:0,textStyle:"",version:bb}}function EN(n,e=[]){const{marker:t}=n;St.isValidMarker(t)||Ae==null||Ae.warn(`Unexpected para marker '${t}'!`);const r=[];(ae==null?void 0:ae.markerMode)==="editable"?r.push(Ui(t),Jr(Oe)):(ae==null?void 0:ae.markerMode)==="visible"&&r.push(Vr("marker",pr(t)+Oe)),r.push(...e);const i=Ve(n);return We({type:St.getType(),marker:t,unknownAttributes:i,children:r,direction:null,format:"",indent:0,textFormat:0,textStyle:"",version:Cb})}function NN(n,e){const t=m1(e);let r=()=>{};return Ca!=null&&Ca.noteCallerOnClick&&(r=Ca.noteCallerOnClick),We({type:Vt.getType(),caller:n,previewText:t,onClick:r,version:Db})}function MN(n,e){const{marker:t,category:r}=n;ft.isValidMarker(t)||Ae==null||Ae.warn(`Unexpected note marker '${t}'!`);const i=n.caller??"*",s=(ae==null?void 0:ae.noteMode)!=="expanded",o=Ve(n);let a,l;(ae==null?void 0:ae.markerMode)==="editable"?(a=Ui(t),l=Ui(t,"closing")):(ae==null?void 0:ae.markerMode)==="visible"&&(a=Vr("marker",pr(t)+Oe),l=Vr("marker",Zs(t)+Oe));const c=[];let u;if(a&&c.push(a),(ae==null?void 0:ae.markerMode)==="editable")u=Jr(hf(i)),c.push(u,...e);else{const f=Jr(Oe);u=NN(i,e),c.push(u,f,...e.flatMap(AN(f)))}return l&&c.push(l),We({type:ft.getType(),marker:t,caller:i,isCollapsed:s,category:r,unknownAttributes:o,children:c,direction:null,format:"",indent:0,version:xb})}function AN(n){return e=>E1(e)?[e]:[e,n]}function ON(n){const{marker:e,sid:t,eid:r}=n;(!e||!pn.isValidMarker(e))&&(Ae==null||Ae.warn(`Unexpected milestone marker '${e}'!`));const i=Ve(n);return We({type:pn.getType(),marker:e,sid:t,eid:r,unknownAttributes:i,version:vb})}function cp(n,e=[]){return{type:et.getType(),typedIDs:{[Zn]:e},children:n,direction:null,format:"",indent:0,version:1}}function $N(n,e){const{marker:t}=n,r=n.type,i=Ve(n),s=[...e];return s.forEach(o=>{ff(o)&&(o.mode="token")}),We({type:ni.getType(),tag:r,marker:t,unknownAttributes:i,children:s,direction:null,format:"",indent:0,version:sb})}function PN(n){return{type:yr.getType(),marker:n,version:Ib}}function Ui(n,e="opening"){return{type:ri.getType(),marker:n,markerSyntax:e,text:"",detail:0,format:0,mode:"normal",style:"",version:1}}function Jr(n,e="normal"){return{type:At.getType(),text:n,detail:0,format:0,mode:e,style:"",version:1}}function Vr(n,e){return{type:mr.getType(),text:e,textType:n,version:Pb}}function up(n,e){(ae==null?void 0:ae.markerMode)==="editable"?e.push(Ui(n)):(ae==null?void 0:ae.markerMode)==="visible"&&e.push(Vr("marker",pr(n)))}function dp(n,e,t=!1){Ie.isValidFootnoteMarker(n)||Ie.isValidCrossReferenceMarker(n)||((ae==null?void 0:ae.markerMode)==="editable"?t?e.push(Ui("","selfClosing")):e.push(Ui(n,"closing")):(ae==null?void 0:ae.markerMode)==="visible"&&e.push(Vr("marker",Zs(t?"":n))))}function IN(n,e){if(n.type!=="ms")return;const t=[];if(n.sid&&t.push(`sid="${n.sid}"`),n.eid&&t.push(`eid="${n.eid}"`),t.length<=0)return;const r=cb+t.join(" ");(ae==null?void 0:ae.markerMode)==="editable"?e.push(Jr(r)):(ae==null?void 0:ae.markerMode)==="visible"&&e.push(Vr("attribute",r))}function fp(n,e){return n.length<=0||e===0?n:n.map(t=>t-e)}function RN(n,e){const t=n.indexOf(e,0);t>-1&&n.splice(t,1)}function hp(n,e){e.marker===Hr&&e.sid!==void 0&&n.push(e.sid),e.marker===Ci&&e.eid!==void 0&&RN(n,e.eid)}function Gu(n,e,t=!1,r=[]){if(e.length<=0||e[0]>=n.length)return n;const i=e.shift(),s=e.length>0?e.shift():n.length-1;if(i===void 0||s===void 0||s>=n.length||n.length<=0)return n;const o=n.slice(0,i),a=t?[cp(o,[...r])]:o,l=n[i];hp(r,l);const c=Gu(n.slice(i+1,s),fp(e,i+1),l.marker===Hr,r),u=cp(c,[...r]),f=n[s];hp(r,f);const d=Gu(n.slice(s+1),fp(e,s+1),f.marker===Hr,r);return[...a,u,...d]}function As(n){const e=[],t=[];return n==null||n.forEach(r=>{if(typeof r=="string")t.push(Jr(r));else if(!r.type)Ae==null||Ae.error("Marker type is missing!");else switch(r.type){case Ft.getType():t.push(xN(r));break;case Qt.getType():t.push(CN(r));break;case _t.getType():ae!=null&&ae.hasSpacing||t.push(mN),t.push(SN(r));break;case Ie.getType():up(r.marker,t),t.push(TN(r,As(r.content))),dp(r.marker,t);break;case St.getType():t.push(EN(r,As(r.content)));break;case ft.getType():t.push(MN(r,As(r.content)));break;case pn.getType():ZS(r.marker)&&(e.push(t.length),r.sid!==void 0&&(il==null||il.push(r.sid))),t.push(ON(r)),up(r.marker,t),IN(r,t),dp(r.marker,t,!0);break;case yr.getType():t.push(PN(r.marker));break;default:Ae==null||Ae.warn(`Unknown type-marker '${r.type}-${r.marker}'!`),t.push($N(r,As(r.content)))}}),Gu(t,e)}function Yu(n){const e=n.findIndex(t=>LS(t)||o1(t)||i1(t));if(e>=0){const t=Yu(n.slice(0,e)),r=n[e],i=Yu(n.slice(e+1));return[...t,r,...i]}else if(n.some(t=>"text"in t&&"mode"in t||W1(t)))return[nv(n)];return n}const Xu={initialize:yN,reset:_N,serializeEditorState:bN},Jc={action:n=>{const{chapterNum:e,verseNum:t}=n.reference,r=[];return e!==void 0&&t!==void 0&&r.push({type:"char",marker:"fr",content:[`${e}:${t}`]}),n.noteText&&r.push({type:"char",marker:"fq",content:[n.noteText]}),r.push({type:"char",marker:"ft",content:["-"]}),[{type:"note",marker:"f",caller:Kr,content:r}]}},gp={action:n=>{const{chapterNum:e,verseNum:t}=n.reference,r=[];return e!==void 0&&t!==void 0&&r.push({type:"char",marker:"xo",content:[`${e}:${t}`]}),r.push({type:"char",marker:"xt",content:["-"]}),[{type:"note",marker:"x",caller:tf,content:r}]}},DN={c:{action:n=>{const{chapterNum:e}=n.reference;return[{type:"chapter",marker:"c",number:`${e+1}`}]}},v:{action:n=>{const{verseNum:e,verse:t}=n.reference;return[{type:"verse",marker:"v",number:`${Wu(e,t)}`}]}},f:Jc,fe:Jc,ef:Jc,x:gp,xe:gp};function LN(n,e,t,r,i){const s=jN(n);return{action:o=>{o.editor.update(()=>{var a;const l=K();B(l)&&(o.noteText=l.getTextContent());const c=(a=s==null?void 0:s.action)==null?void 0:a.call(s,o);if(!c)return;const u=Ug(c,Xu,r),f=Uc(u);if(B(l)){const d=l.anchor.getNode();if(we(f))qb(f,l,r),f.getIsCollapsed()||(e.current=f.getKey());else if(l.getTextContent().length>0)FN(l,()=>Uc(u));else if(L(f)&&!f.isInline()){const g=l.insertParagraph();if(g){const p=g.getChildren();f.append(...p),g.replace(f),f.selectStart()}}else if(U(d)&&!go(d)&&we(d.getParent())&&l.isCollapsed()){let g=d.insertAfter(f);if(tl(f)){const p={...r||mo(),markerMode:"hidden"},m=Ug(c,Xu,p),y=Uc(m);g=g.insertAfter(y)}g.insertAfter(ue(Oe))}else{l.insertNodes([f]),zN(f);const g=f.getNextSibling();g?g.selectStart():f.selectStart()}}else l==null||l.insertNodes([f])},i)},label:s==null?void 0:s.label}}function jN(n){let e=DN[n];return e||(St.isValidMarker(n)?e={action:()=>[{type:St.getType(),marker:n,content:[]}]}:Ie.isValidMarker(n)&&(e={action:()=>[{type:Ie.getType(),marker:n,content:["-"]}]})),e}function FN(n,e){const t=n.getNodes(),[r,i]=qN(n);let s;t.forEach((o,a)=>{if(L(s)&&s.isParentOf(o))return;const l=BN(o,a===0,a===t.length-1,r,i);if(!l){s=void 0;return}s||(s=e(),l.insertBefore(s)),UN(l,s)}),(U(s)||L(s))&&s.selectEnd()}function qN(n){const e=n.anchor.offset,t=n.focus.offset;return n.isBackward()?[t,e]:[e,t]}function BN(n,e,t,r,i){if(!(nt(n)||we(n)||we(n.getParent()))){if(U(n))return WN(n,e,t,r,i);if(L(n)&&n.isInline())return n}}function WN(n,e,t,r,i){const s=n.getTextContentSize(),o=e?r:0,a=t?i:s;if(o===0&&a===0)return;const l=n.splitText(o,a);return l.length===1?l[0]:l.length===3||a===s?l[1]:l[0]}function UN(n,e){var t;if(U(e)){const r=pp(n,e);e.setTextContent(r),n.remove()}else if(L(e)){const r=e.getChildrenSize();e.append(n);for(let i=0;i<r;i++)(t=e.getFirstChild())==null||t.remove();pp(n,e)}}function pp(n,e){let t=n.getTextContent();if(U(n)&&e.isInline()&&t.startsWith(" ")){t=t.trimStart(),n.setTextContent(t);const r=e.getPreviousSibling();bf(r),U(r)||e.insertBefore(ue(" "))}return t}function zN(n){Lt(n)&&(bf(n.getPreviousSibling()),Ub(n.getNextSibling()))}const rv={chapter:"chapter",verse:"verse",char:"char",para:"para",typedMark:"editor-typed-mark",typedMarkOverlap:"editor-typed-markOverlap",mark:"editor-mark",markOverlap:"editor-markOverlap",placeholder:"editor-placeholder",paragraph:"editor-paragraph",quote:"editor-quote",heading:{h1:"editor-heading-h1",h2:"editor-heading-h2",h3:"editor-heading-h3",h4:"editor-heading-h4",h5:"editor-heading-h5"},list:{nested:{listitem:"editor-nested-listitem"},ol:"editor-list-ol",ul:"editor-list-ul",listitem:"editor-listitem"},image:"editor-image",link:"editor-link",text:{bold:"editor-text-bold",italic:"editor-text-italic",overflowed:"editor-text-overflowed",hashtag:"editor-text-hashtag",underline:"editor-text-underline",strikethrough:"editor-text-strikethrough",underlineStrikethrough:"editor-text-underlineStrikethrough"}},iv=x.createContext(null),mp=4;function KN({children:n,className:e,onClick:t,title:r}){const i=x.useRef(null),s=x.useContext(iv);if(s===null)throw new Error("DropDownItem must be used within a DropDown");const{registerItem:o}=s;return x.useEffect(()=>{i&&i.current&&o(i)},[i,o]),S.jsx("button",{className:e,onClick:t,ref:i,title:r,type:"button",children:n})}function HN({children:n,dropDownRef:e,onClose:t}){const[r,i]=x.useState(),[s,o]=x.useState(),a=x.useCallback(u=>{i(f=>f?[...f,u]:[u])},[i]),l=u=>{if(!r)return;const f=u.key;["Escape","ArrowUp","ArrowDown","Tab"].includes(f)&&u.preventDefault(),f==="Escape"||f==="Tab"?t():f==="ArrowUp"?o(d=>{if(!d)return r[0];const g=r.indexOf(d)-1;return r[g===-1?r.length-1:g]}):f==="ArrowDown"&&o(d=>d?r[r.indexOf(d)+1]:r[0])},c=x.useMemo(()=>({registerItem:a}),[a]);return x.useEffect(()=>{r&&!s&&o(r[0]),s&&s.current&&s.current.focus()},[r,s]),S.jsx(iv.Provider,{value:c,children:S.jsx("div",{className:"dropdown",ref:e,onKeyDown:l,children:n})})}function JN({disabled:n=!1,buttonLabel:e,buttonAriaLabel:t,buttonClassName:r,buttonIconClassName:i,children:s,stopCloseOnClickSelf:o}){const a=x.useRef(null),l=x.useRef(null),[c,u]=x.useState(!1),f=()=>{u(!1),l&&l.current&&l.current.focus()};return x.useEffect(()=>{const d=l.current,g=a.current;if(c&&d!==null&&g!==null){const{top:p,left:m}=d.getBoundingClientRect();g.style.top=`${p+d.offsetHeight+mp}px`,g.style.left=`${Math.min(m,window.innerWidth-g.offsetWidth-20)}px`}},[a,l,c]),x.useEffect(()=>{const d=l.current;if(d!==null&&c){const g=p=>{const m=p.target;o&&a.current&&a.current.contains(m)||d.contains(m)||u(!1)};return document.addEventListener("click",g),()=>{document.removeEventListener("click",g)}}return()=>{}},[a,l,c,o]),x.useEffect(()=>{const d=()=>{if(c){const g=l.current,p=a.current;if(g!==null&&p!==null){const{top:m}=g.getBoundingClientRect(),y=m+g.offsetHeight+mp;y!==p.getBoundingClientRect().top&&(p.style.top=`${y}px`)}}};return document.addEventListener("scroll",d),()=>{document.removeEventListener("scroll",d)}},[l,a,c]),S.jsxs(S.Fragment,{children:[S.jsxs("button",{type:"button",disabled:n,"aria-label":t||e,className:r,onClick:()=>u(!c),ref:l,children:[i&&S.jsx("span",{className:i}),e&&S.jsx("span",{className:"text dropdown-button-text",children:e}),S.jsx("i",{className:"chevron-down"})]}),c&&Nt.createPortal(S.jsx(HN,{dropDownRef:a,onClose:f,children:s}),document.body)]})}const Zu={m:"m - Paragraph - Margin - No First Line Indent",ms:"ms - Heading - Major Section Level 1",nb:"nb - Paragraph - No Break with Previous Paragraph",p:"p - Paragraph - Normal - First Line Indent",pi:"pi - Paragraph - Indented - Level 1 - First Line Indent",q1:"q1 - Poetry - Indent Level 1",q2:"q2 - Poetry - Indent Level 2",r:"r - Heading - Parallel References",s:"s - Heading - Section Level 1"},Qu={...Zu,ide:"ide - File - Encoding",h:"h - File - Header",h1:"h1 - File - Header",h2:"h2 - File - Left Header",h3:"h3 - File - Right Header",toc1:"toc1 - File - Long Table of Contents Text",toc2:"toc2 - File - Short Table of Contents Text",toc3:"toc3 - File - Book Abbreviation",cl:"cl - Chapter - Publishing Label",mt:"mt - Title - Major Title Level 1",mt1:"mt1 - Title - Major Title Level 1",mt2:"mt2 - Title - Major Title Level 2",mt3:"mt3 - Title - Major Title Level 3",mt4:"mt4 - Title - Major Title Level 4",ms1:"ms1 - Heading - Major Section Level 1",ms2:"ms2 - Heading - Major Section Level 2",ms3:"ms3 - Heading - Major Section Level 3",b:"b - Poetry - Stanza Break (Blank Line)"};function VN(n){return n in Qu?n:"ban"}function GN(n){return n in Qu?Qu[n]:"No Style"}function YN(n){return n?"active dropdown-item-active":""}function XN({editor:n,blockMarker:e,disabled:t=!1}){const r=i=>{n.update(()=>{const s=K();B(s)&&Gw(s,()=>Xs(i))})};return S.jsx(JN,{disabled:t,buttonClassName:"toolbar-item block-controls",buttonIconClassName:"icon block-marker "+VN(e),buttonLabel:GN(e),buttonAriaLabel:"Formatting options for block type",children:Object.keys(Zu).map(i=>S.jsxs(KN,{className:"item block-marker "+YN(e===i),onClick:()=>r(i),children:[S.jsx("i",{className:"icon block-marker "+i}),S.jsx("span",{className:"text usfm_"+i,children:Zu[i]})]},i))})}function yp(){return S.jsx("div",{className:"divider"})}const ZN=x.forwardRef(function(n,e){const[t]=ge(),[r,i]=x.useState(t),[s,o]=x.useState(""),[a,l]=x.useState(!1),[c,u]=x.useState(!1),[f,d]=x.useState(()=>t.isEditable()),g=x.useCallback(()=>{const p=K();if(B(p)){const m=p.anchor.getNode();let y=m.getKey()==="root"?m:Xt(m,_=>{const w=_.getParent();return w!==null&&yn(w)});y===null&&(y=m.getTopLevelElementOrThrow());const v=y.getKey();r.getElementByKey(v)!==null&&(ut(y)||gn(y)||fo(y))&&o(y.getMarker())}},[r]);return x.useEffect(()=>t.registerCommand(Yr,(p,m)=>(g(),i(m),!1),Is),[t,g]),x.useEffect(()=>He(t.registerEditableListener(p=>{d(p)}),r.registerUpdateListener(({editorState:p})=>{p.read(()=>{g()})}),r.registerCommand(Ts,p=>(l(p),!1),Is),r.registerCommand(Ss,p=>(u(p),!1),Is)),[g,r,t]),S.jsxs("div",{className:"toolbar",children:[S.jsx("button",{disabled:!a||!f,onClick:()=>{r.dispatchCommand(ll,void 0)},title:bu?"Undo (⌘Z)":"Undo (Ctrl+Z)",type:"button",className:"toolbar-item spaced","aria-label":"Undo",children:S.jsx("i",{className:"format undo"})}),S.jsx("button",{disabled:!c||!f,onClick:()=>{r.dispatchCommand(cl,void 0)},title:bu?"Redo (⌘Y)":"Redo (Ctrl+Y)",type:"button",className:"toolbar-item","aria-label":"Redo",children:S.jsx("i",{className:"format redo"})}),S.jsx(yp,{}),r===t&&S.jsxs(S.Fragment,{children:[S.jsx(XN,{disabled:!f,blockMarker:s,editor:t}),S.jsx(yp,{})]}),S.jsx("div",{ref:e,className:"end-container"})]})}),_p={namespace:"platformEditor",theme:rv,editable:!0,editorState:void 0,onError(n){throw n},nodes:[et,...Y1]},QN=mo(),eM={},tM={};function nM(){return S.jsx("div",{className:"editor-placeholder",children:"Enter some Scripture..."})}const sv=x.forwardRef(function({defaultUsj:n,scrRef:e,onScrRefChange:t,onSelectionChange:r,onUsjChange:i,options:s,logger:o,children:a},l){const c=x.useRef(null),u=x.useRef(null),f=x.useRef(null),d=x.useRef(n),g=x.useRef(),[p,m]=x.useState(n),{isReadonly:y=!1,hasSpellCheck:v=!1,textDirection:_="ltr",markerMenuTrigger:w="\\",view:E=QN,nodes:$=eM,debug:P=!1}=s??tM;_p.editable=!y,Hc.initialize(o),x.useImperativeHandle(l,()=>({focus(){var N;(N=c.current)==null||N.focus()},getUsj(){return d.current},setUsj(N){Hn(d.current,N)||(d.current=N,m(N))},applyUpdate(N,M="remote"){var j,k;(j=c.current)==null||j.update(()=>{M==="remote"&&py(qu),FT(N,E,$,o)},{discrete:!0});const I=(k=c.current)==null?void 0:k.getEditorState();if(!I)return;const C=Hc.deserializeEditorState(I);if(C){const D=!Hn(d.current,C);D&&(d.current=C),(D||!Hn(p,C))&&(i==null||i(C,N,M))}},getSelection(){var N;return(N=c.current)==null?void 0:N.read(Fb)},setSelection(N){var M;(M=c.current)==null||M.update(()=>{const j=_f(N);j!==void 0&&rt(j)},{tag:ub})},addAnnotation(N,M,j){var k;(k=u.current)==null||k.addAnnotation(N,Bg(M),j)},removeAnnotation(N,M){var j;(j=u.current)==null||j.removeAnnotation(Bg(N),M)},insertNote(N,M,j){var k;(k=c.current)==null||k.update(()=>{const I=U1(N,M,j,e,E,$);I&&!I.getIsCollapsed()&&(g.current=I.getKey())})},get toolbarEndRef(){return f}}));const R=x.useCallback((N,M,j,k)=>{if(BS.some(C=>j.has(C)))return;const I=Hc.deserializeEditorState(N);if(I){const C=!Hn(d.current,I);C&&(d.current=I);const D=j.has(qu)?"remote":"local";(C||!Hn(p,I))&&(i==null||i(I,k,D))}},[p,i]);return S.jsxs(r_,{initialConfig:_p,children:[S.jsx(mE,{isEditable:!y}),S.jsxs("div",{className:"editor-container",children:[S.jsx("div",{className:"editor-toolbar-container"+(y?"-readonly":"-editable"),children:S.jsx(ZN,{ref:f})}),S.jsxs("div",{className:"editor-inner",children:[S.jsx(l_,{editorRef:c}),S.jsx(mC,{contentEditable:S.jsx(a_,{className:`editor-input ${ZE(E).join(" ")}`,spellCheck:v}),placeholder:S.jsx(nM,{}),ErrorBoundary:c_}),S.jsx(u_,{}),e&&t&&S.jsx(QE,{scrRef:e,onScrRefChange:t}),e&&S.jsx(WE,{trigger:w,scrRef:e,getMarkerAction:(N,M)=>LN(N,g,M,E)}),S.jsx(IS,{options:{view:E,nodes:$},editedUsjRef:d,usj:p,setUsj:m}),S.jsx(yE,{scripture:p,nodeOptions:$,editorAdaptor:Xu,viewOptions:E,logger:o}),S.jsx(AE,{onChange:r}),S.jsx(NT,{onChange:R,ignoreSelectionChange:!0,ignoreHistoryMergeTagChange:!0}),S.jsx(mT,{ref:u,logger:o}),S.jsx(tE,{viewOptions:E}),S.jsx(aE,{}),S.jsx(uE,{}),S.jsx(dE,{logger:o}),S.jsx(pE,{}),S.jsx(_E,{expandedNoteKeyRef:g,nodeOptions:$,viewOptions:E,logger:o}),S.jsx(OE,{}),S.jsx(IE,{textDirection:_}),S.jsx(LE,{}),a]}),P&&S.jsx(nN,{})]})]})}),Bn=x.forwardRef(function(n,e){const{children:t,...r}=n;return S.jsx(sv,{ref:e,...r})});function ov(){return Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5)}function sl(n,e,t,r,i){return{author:e,content:n,deleted:i===void 0?!1:i,id:t===void 0?ov():t,timeStamp:r===void 0?performance.timeOrigin+performance.now():r,type:"comment"}}function av(n,e,t){return{comments:e,id:t===void 0?ov():t,quote:n,type:"thread"}}function bp(n){return{comments:Array.from(n.comments),id:n.id,quote:n.quote,type:"thread"}}function rM(n){return{author:n.author,content:"[Deleted Comment]",deleted:!0,id:n.id,timeStamp:n.timeStamp,type:"comment"}}function Vc(n){const e=n._changeListeners;for(const t of e)t()}class iM{constructor(e,t){Q(this,"_editor"),Q(this,"_comments"),Q(this,"_changeListeners"),Q(this,"_collabProvider"),Q(this,"logger"),this._comments=[],this._editor=e,this.logger=t,this._collabProvider=null,this._changeListeners=new Set}isCollaborative(){return this._collabProvider!==null}getComments(){return this._comments}setComments(e){this._comments=e,Vc(this)}addComment(e,t,r){const i=Array.from(this._comments),s=this._getCollabComments();if(t!==void 0&&e.type==="comment")for(let o=0;o<i.length;o++){const a=i[o];if(a.type==="thread"&&a.id===t.id){const l=bp(a);i.splice(o,1,l);const c=r!==void 0?r:l.comments.length;if(this.isCollaborative()&&s!==null){const u=s.get(o).get("comments");this._withRemoteTransaction(()=>{const f=this._createCollabSharedMap(e);u.insert(c,[f])})}l.comments.splice(c,0,e);break}}else{const o=r!==void 0?r:i.length;this.isCollaborative()&&s!==null&&this._withRemoteTransaction(()=>{const a=this._createCollabSharedMap(e);s.insert(o,[a])}),i.splice(o,0,e)}this._comments=i,Vc(this)}deleteCommentOrThread(e,t){const r=Array.from(this._comments),i=this._getCollabComments();let s=null;if(t!==void 0)for(let o=0;o<r.length;o++){const a=r[o];if(a.type==="thread"&&a.id===t.id){const l=bp(a);r.splice(o,1,l);const c=l.comments;if(s=c.indexOf(e),this.isCollaborative()&&i!==null){const u=i.get(o).get("comments"),f=s;this._withRemoteTransaction(()=>{u.delete(f)})}c.splice(s,1);break}}else s=r.indexOf(e),this.isCollaborative()&&i!==null&&this._withRemoteTransaction(()=>{i.delete(s)}),r.splice(s,1);return this._comments=r,Vc(this),e.type==="comment"?{index:s,markedComment:rM(e)}:null}registerOnChange(e){const t=this._changeListeners;return t.add(e),()=>{t.delete(e)}}_withRemoteTransaction(e){const t=this._collabProvider;t!==null&&t.doc.transact(e,this)}_withLocalTransaction(e){const t=this._collabProvider;try{this._collabProvider=null,e()}finally{this._collabProvider=t}}_getCollabComments(){const e=this._collabProvider;return e!==null?e.doc.get("comments",Dr):null}_createCollabSharedMap(e){const t=new Fi,r=e.type,i=e.id;if(t.set("type",r),t.set("id",i),r==="comment")t.set("author",e.author),t.set("content",e.content),t.set("deleted",e.deleted),t.set("timeStamp",e.timeStamp);else{t.set("quote",e.quote);const s=new Dr;e.comments.forEach((o,a)=>{const l=this._createCollabSharedMap(o);s.insert(a,[l])}),t.set("comments",s)}return t}registerCollaboration(e){this._collabProvider=e;const t=this._getCollabComments(),r=()=>{e.connect()},i=()=>{try{e.disconnect()}catch{}},s=this._editor.registerCommand(OS,a=>{var l,c;return r!==void 0&&i!==void 0&&(a?((l=this.logger)==null||l.info("Comments connected!"),r()):((c=this.logger)==null||c.info("Comments disconnected!"),i())),!1},ei),o=(a,l)=>{if(l.origin!==this){for(const c of a)if(c instanceof Y_){const u=c.target,f=c.delta;let d=0;for(const g of f){const p=g.insert,m=g.retain,y=g.delete,v=u.parent,_=u===t?void 0:v instanceof Fi&&this._comments.find(w=>w.id===v.get("id"));if(Array.isArray(p)){const w=d;p.slice().reverse().forEach(E=>{const $=E.get("id"),P=E.get("type")==="thread"?av(E.get("quote"),E.get("comments").toArray().map(R=>sl(R.get("content"),R.get("author"),R.get("id"),R.get("timeStamp"),R.get("deleted"))),$):sl(E.get("content"),E.get("author"),$,E.get("timeStamp"),E.get("deleted"));this._withLocalTransaction(()=>{this.addComment(P,_,w)})})}else if(typeof m=="number")d+=m;else if(typeof y=="number")for(let w=0;w<y;w++){const E=_===void 0||_===!1?this._comments[d]:_.comments[d];this._withLocalTransaction(()=>{this.deleteCommentOrThread(E,_)}),d++}}}}};return t===null?()=>null:(t.observeDeep(o),r(),()=>{t.unobserveDeep(o),s(),this._collabProvider=null})}}function sM(n){const[e,t]=x.useState(n.getComments());return x.useEffect(()=>n.registerOnChange(()=>{t(n.getComments())}),[n]),e}function oM({onClose:n,children:e,title:t,closeOnClickOutside:r}){const i=x.useRef(null);return x.useEffect(()=>{i.current!==null&&i.current.focus()},[]),x.useEffect(()=>{let s=null;const o=c=>{c.key==="Escape"&&n()},a=c=>{const u=c.target;i.current!==null&&!i.current.contains(u)&&r&&n()},l=i.current;return l!==null&&(s=l.parentElement,s!==null&&s.addEventListener("click",a)),window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o),s!==null&&(s==null||s.removeEventListener("click",a))}},[r,n]),S.jsx("div",{className:"Modal__overlay",role:"dialog",children:S.jsxs("div",{className:"Modal__modal",tabIndex:-1,ref:i,children:[S.jsx("h2",{className:"Modal__title",children:t}),S.jsx("button",{className:"Modal__closeButton","aria-label":"Close modal",type:"button",onClick:n,children:"X"}),S.jsx("div",{className:"Modal__content",children:e})]})})}function aM({onClose:n,children:e,title:t,closeOnClickOutside:r=!1}){return Nt.createPortal(S.jsx(oM,{onClose:n,title:t,closeOnClickOutside:r,children:e}),document.body)}function lv(){const[n,e]=x.useState(null),t=x.useCallback(()=>{e(null)},[]),r=x.useMemo(()=>{if(n===null)return null;const{title:s,content:o,closeOnClickOutside:a}=n;return S.jsx(aM,{onClose:t,title:s,closeOnClickOutside:a,children:o})},[n,t]),i=x.useCallback((s,o,a=!1)=>{e({closeOnClickOutside:a,content:o(t),title:s})},[t]);return[r,i]}const lM={...rv,paragraph:"CommentEditorTheme__paragraph"};function cM(...n){return n.filter(Boolean).join(" ")}function ur({"data-test-id":n,children:e,className:t,onClick:r,disabled:i,small:s,title:o}){return S.jsx("button",{disabled:i,className:cM("Button__root",i&&"Button__disabled",s&&"Button__small",t),onClick:r,title:o,"aria-label":o,...n&&{"data-test-id":n},children:e})}function uM({className:n}){return S.jsx(a_,{className:n||"ContentEditable__root"})}function dM({children:n,className:e}){return S.jsx("div",{className:e||"Placeholder__root",children:n})}const vp=ie("INSERT_INLINE_COMMAND");function fM({anchorKey:n,editor:e,showComments:t,onAddComment:r}){const i=x.useRef(null),s=x.useCallback(()=>{const o=i.current,a=e.getRootElement(),l=e.getElementByKey(n);if(o!==null&&a!==null&&l!==null){const{right:c}=a.getBoundingClientRect(),{top:u}=l.getBoundingClientRect();o.style.left=`${c-20}px`,o.style.top=`${u-30}px`}},[n,e]);return x.useEffect(()=>(window.addEventListener("resize",s),()=>{window.removeEventListener("resize",s)}),[e,s]),x.useLayoutEffect(()=>{s()},[n,e,t,s]),S.jsx("div",{className:"CommentPlugin_AddCommentBox",ref:i,children:S.jsx("button",{className:"CommentPlugin_AddCommentBox_button",onClick:r,children:S.jsx("i",{className:"icon add-comment"})})})}function hM({onEscape:n}){const[e]=ge();return x.useEffect(()=>e.registerCommand(ul,t=>n(t),ma),[e,n]),null}function cv({className:n,autoFocus:e,onEscape:t,onChange:r,editorRef:i,placeholder:s="Type a comment..."}){return S.jsx(r_,{initialConfig:{namespace:"Commenting",nodes:[],onError:o=>{throw o},theme:lM},children:S.jsxs("div",{className:"CommentPlugin_CommentInputBox_EditorContainer",children:[S.jsx(qC,{contentEditable:S.jsx(uM,{className:n}),placeholder:S.jsx(dM,{children:s}),ErrorBoundary:c_}),S.jsx(PC,{onChange:r}),S.jsx(u_,{}),e!==!1&&S.jsx(NC,{}),S.jsx(hM,{onEscape:t}),S.jsx(AC,{}),i!==void 0&&S.jsx(l_,{editorRef:i})]})})}function uv(n,e){return x.useCallback((t,r)=>{t.read(()=>{n(i_()),e(!s_(r.isComposing(),!0))})},[e,n])}function gM({editor:n,cancelAddComment:e,submitAddComment:t}){const[r,i]=x.useState(""),[s,o]=x.useState(!1),a=x.useRef(null),l=x.useMemo(()=>({container:document.createElement("div"),elements:[]}),[]),c=x.useRef(null),u=fv(),f=x.useCallback(()=>{n.getEditorState().read(()=>{const m=K();if(B(m)){c.current=m.clone();const y=m.anchor,v=m.focus,_=zw(n,y.getNode(),y.offset,v.getNode(),v.offset),w=a.current;if(_!==null&&w!==null){const{left:E,bottom:$,width:P}=_.getBoundingClientRect(),R=Kw(n,_);let N=R.length===1?E+P/2-125:E-125;N<10&&(N=10),w.style.left=`${N}px`,w.style.top=`${$+20+(window.pageYOffset||document.documentElement.scrollTop)}px`;const M=R.length,{container:j}=l,k=l.elements,I=k.length;for(let C=0;C<M;C++){const D=R[C];let q=k[C];q===void 0&&(q=document.createElement("span"),k[C]=q,j.appendChild(q));const F=`position:absolute;top:${D.top+(window.pageYOffset||document.documentElement.scrollTop)}px;left:${D.left}px;height:${D.height}px;width:${D.width}px;background-color:rgba(255, 212, 0, 0.3);pointer-events:none;z-index:5;`;q.style.cssText=F}for(let C=I-1;C>=M;C--){const D=k[C];j.removeChild(D),k.pop()}}}})},[n,l]);x.useLayoutEffect(()=>{f();const m=l.container,y=document.body;return y!==null?(y.appendChild(m),()=>{y.removeChild(m)}):()=>{}},[l.container,f]),x.useEffect(()=>(window.addEventListener("resize",f),()=>{window.removeEventListener("resize",f)}),[f]);const d=m=>(m.preventDefault(),e(),!0),g=()=>{if(s){let m=n.getEditorState().read(()=>{const y=c.current;return y?y.getTextContent():""});m.length>100&&(m=m.slice(0,99)+"…"),t(av(m,[sl(r,u)]),!0,void 0,c.current),c.current=null}},p=uv(i,o);return S.jsxs("div",{className:"CommentPlugin_CommentInputBox",ref:a,children:[S.jsx(cv,{className:"CommentPlugin_CommentInputBox_Editor",onEscape:d,onChange:p}),S.jsxs("div",{className:"CommentPlugin_CommentInputBox_Buttons",children:[S.jsx(ur,{onClick:e,className:"CommentPlugin_CommentInputBox_Button",children:"Cancel"}),S.jsx(ur,{onClick:g,disabled:!s,className:"CommentPlugin_CommentInputBox_Button primary",children:"Comment"})]})]})}function pM({submitAddComment:n,thread:e,placeholder:t}){const[r,i]=x.useState(""),[s,o]=x.useState(!1),a=x.useRef(null),l=fv(),c=uv(i,o);return S.jsxs(S.Fragment,{children:[S.jsx(cv,{className:"CommentPlugin_CommentsPanel_Editor",autoFocus:!1,onEscape:()=>!0,onChange:c,editorRef:a,placeholder:t}),S.jsx(ur,{className:"CommentPlugin_CommentsPanel_SendButton",onClick:()=>{if(s){n(sl(r,l),!1,e);const u=a.current;u!==null&&u.dispatchCommand(yd,void 0)}},disabled:!s,children:S.jsx("i",{className:"send"})})]})}function dv({commentOrThread:n,deleteCommentOrThread:e,onClose:t,thread:r=void 0}){return S.jsxs(S.Fragment,{children:["Are you sure you want to delete this ",n.type,"?",S.jsxs("div",{className:"Modal__content",children:[S.jsx(ur,{onClick:()=>{e(n,r),t()},children:"Delete"})," ",S.jsx(ur,{onClick:()=>{t()},children:"Cancel"})]})]})}function kp({comment:n,deleteComment:e,thread:t,rtf:r}){const i=Math.round((n.timeStamp-(performance.timeOrigin+performance.now()))/1e3),s=Math.round(i/60),[o,a]=lv();return S.jsxs("li",{className:"CommentPlugin_CommentsPanel_List_Comment",children:[S.jsxs("div",{className:"CommentPlugin_CommentsPanel_List_Details",children:[S.jsx("span",{className:"CommentPlugin_CommentsPanel_List_Comment_Author",children:n.author}),S.jsxs("span",{className:"CommentPlugin_CommentsPanel_List_Comment_Time",children:["· ",i>-10?"Just now":r.format(s,"minute")]})]}),S.jsx("p",{className:n.deleted?"CommentPlugin_CommentsPanel_DeletedComment":"",children:n.content}),!n.deleted&&S.jsxs(S.Fragment,{children:[S.jsx(ur,{onClick:()=>{a("Delete Comment",l=>S.jsx(dv,{commentOrThread:n,deleteCommentOrThread:e,thread:t,onClose:l}))},className:"CommentPlugin_CommentsPanel_List_DeleteButton",children:S.jsx("i",{className:"delete"})}),o]})]})}function mM({activeIDs:n,comments:e,deleteCommentOrThread:t,listRef:r,submitAddComment:i,markNodeMap:s}){const[o]=ge(),[a,l]=x.useState(0),[c,u]=lv(),f=x.useMemo(()=>new Intl.RelativeTimeFormat("en",{localeMatcher:"best fit",numeric:"auto",style:"short"}),[]);return x.useEffect(()=>{const d=setTimeout(()=>{l(a+1)},1e4);return()=>{clearTimeout(d)}},[a]),S.jsx("ul",{className:"CommentPlugin_CommentsPanel_List",ref:r,children:e.map(d=>{const g=d.id;return d.type==="thread"?S.jsxs("li",{onClick:()=>{const p=s.get(g);if(p!==void 0&&(n===null||n.indexOf(g)===-1)){const m=document.activeElement;o.update(()=>{const y=Array.from(p)[0],v=he(y);nt(v)&&v.selectStart()},{onUpdate(){m!==null&&m.focus()}})}},className:`CommentPlugin_CommentsPanel_List_Thread ${s.has(g)?"interactive":""} ${n.indexOf(g)===-1?"":"active"}`,children:[S.jsxs("div",{className:"CommentPlugin_CommentsPanel_List_Thread_QuoteBox",children:[S.jsxs("blockquote",{className:"CommentPlugin_CommentsPanel_List_Thread_Quote",children:["> ",S.jsx("span",{children:d.quote})]}),S.jsx(ur,{onClick:()=>{u("Delete Thread",p=>S.jsx(dv,{commentOrThread:d,deleteCommentOrThread:t,onClose:p}))},className:"CommentPlugin_CommentsPanel_List_DeleteButton",children:S.jsx("i",{className:"delete"})}),c]}),S.jsx("ul",{className:"CommentPlugin_CommentsPanel_List_Thread_Comments",children:d.comments.map(p=>S.jsx(kp,{comment:p,deleteComment:t,thread:d,rtf:f},p.id))}),S.jsx("div",{className:"CommentPlugin_CommentsPanel_List_Thread_Editor",children:S.jsx(pM,{submitAddComment:i,thread:d,placeholder:"Reply to comment..."})})]},g):S.jsx(kp,{comment:d,deleteComment:t,rtf:f},g)})})}function yM({activeIDs:n,deleteCommentOrThread:e,comments:t,submitAddComment:r,markNodeMap:i}){const s=x.useRef(null),o=t.length===0;return S.jsxs("div",{className:"CommentPlugin_CommentsPanel",children:[S.jsx("h2",{className:"CommentPlugin_CommentsPanel_Heading",children:"Comments"}),o?S.jsx("div",{className:"CommentPlugin_CommentsPanel_Empty",children:"No Comments"}):S.jsx(mM,{activeIDs:n,comments:t,deleteCommentOrThread:e,listRef:s,submitAddComment:r,markNodeMap:i})]})}function fv(){const n=m_(),{yjsDocMap:e,name:t}=n;return e.has("comments")?t:"Scripture User"}function _M({providerFactory:n,setCommentStore:e,onChange:t,showCommentsContainerRef:r,commentContainerRef:i,logger:s}){const o=m_(),[a]=ge(),l=x.useMemo(()=>{const N=new iM(a,s);return t&&N.registerOnChange(t),e==null||e(N),N},[a,s,t,e]),c=sM(l),u=x.useMemo(()=>new Map,[]),[f,d]=x.useState(),[g,p]=x.useState([]),[m,y]=x.useState(!1),[v,_]=x.useState(!1),{yjsDocMap:w}=o;x.useEffect(()=>{if(n){const N=n("comments",w);return l.registerCollaboration(N)}return()=>{}},[l,n,w]);const E=x.useCallback(()=>{a.update(()=>{const N=K();N!==null&&(N.dirty=!0)}),y(!1)},[a]),$=x.useCallback((N,M)=>{if(N.type==="comment"){const j=l.deleteCommentOrThread(N,M);if(!j)return;const{markedComment:k,index:I}=j;l.addComment(k,M,I)}else{l.deleteCommentOrThread(N);const j=M!==void 0?M.id:N.id,k=u.get(j);k!==void 0&&setTimeout(()=>{a.update(()=>{for(const I of k){const C=he(I);nt(C)&&(C.deleteID(Zn,j),C.hasNoIDsForEveryType()&&Ob(C))}})})}},[l,a,u]),P=x.useCallback((N,M,j,k)=>{l.addComment(N,j),M&&(a.update(()=>{B(k)&&$b(k,Zn,N.id)}),y(!1))},[l,a]);x.useEffect(()=>{const N=[];for(const M of g){const j=u.get(M);if(j!==void 0)for(const k of j){const I=a.getElementByKey(k);I!==null&&(I.classList.add("selected"),N.push(I),_(!0))}}return()=>{for(const M of N)M.classList.remove("selected")}},[g,a,u]),x.useEffect(()=>{if(!a.hasNodes([et]))throw new Error("CommentPlugin: TypedMarkNode not registered on editor!");const N=new Map;return He(Ey(a,et,M=>Qs(M.getTypedIDs()),(M,j)=>{for(const[k,I]of Object.entries(M.getTypedIDs()))I.forEach(C=>{j.addID(k,C)})}),a.registerMutationListener(et,M=>{a.getEditorState().read(()=>{for(const[j,k]of M){const I=he(j);let C=[];k==="destroyed"?C=N.get(j)??[]:nt(I)&&(C=I.getTypedIDs()[Zn]??[]);for(const D of C){let q=u.get(D);N.set(j,C),k==="destroyed"?q!==void 0&&(q.delete(j),q.size===0&&u.delete(D)):(q===void 0&&(q=new Set,u.set(D,q)),q.has(j)||q.add(j))}}})},{skipInitialization:!1}),a.registerUpdateListener(({editorState:M,tags:j})=>{M.read(()=>{const k=K();let I=!1,C=!1;if(B(k)){const D=k.anchor.getNode();if(U(D)){const q=C1(D,Zn,k.anchor.offset)??[];q!==null&&(p(q),I=!0),k.isCollapsed()||(d(D.getKey()),C=!0)}}I||p(D=>D.length===0?D:[]),C||d(null),!j.has("collaboration")&&B(k)&&y(!1)})}),a.registerCommand(vp,()=>{const M=window.getSelection();return M!==null&&M.removeAllRanges(),y(!0),!0},ne))},[a,u]);const R=()=>{a.dispatchCommand(vp,void 0)};return S.jsxs(S.Fragment,{children:[m&&Nt.createPortal(S.jsx(gM,{editor:a,cancelAddComment:E,submitAddComment:P}),document.body),f!=null&&!m&&Nt.createPortal(S.jsx(fM,{anchorKey:f,editor:a,showComments:v,onAddComment:R}),document.body),r!==null&&Nt.createPortal(S.jsx(ur,{className:`CommentPlugin_ShowCommentsButton ${v?"active":""}`,onClick:()=>_(!v),title:v?"Hide Comments":"Show Comments",children:S.jsx("i",{className:"comments"})}),(r==null?void 0:r.current)??document.body),v&&Nt.createPortal(S.jsx(yM,{comments:c,submitAddComment:P,deleteCommentOrThread:$,activeIDs:g,markNodeMap:u}),(i==null?void 0:i.current)??document.body)]})}function bM(){const n=x.useRef(void 0),e=x.useCallback(t=>{n.current=t},[]);return[n,e]}function vM(n,e){var t,r;const i=((t=e.current)==null?void 0:t.getComments())??[],s=i==null?void 0:i.map(a=>a.id),o=n.map(a=>{const l=s.findIndex(c=>c===a);return l!==void 0&&l>=0?i[l]:{comments:[{author:"unknown",content:"Comment not found",deleted:!1,id:"",timeStamp:0,type:"comment"}],id:a,quote:"",type:"thread"}});i.forEach(a=>{n.includes(a.id)||o.push(a)}),o&&((r=e.current)==null||r.setComments(o))}function kM(n,e){x.useEffect(()=>{var t;n.options??(n.options={}),(t=n.options).nodes??(t.nodes={}),n.options.nodes.addMissingComments=r=>{vM(r,e)}},[e,n])}x.forwardRef(function(n,e){const t=x.useRef(null),r=x.useRef(!0),i=x.useRef(null),[s,o]=x.useState(null),{children:a,onCommentChange:l,onUsjChange:c,...u}=n,{options:{isReadonly:f}={}}=n,[d,g]=bM();kM(u,d),x.useImperativeHandle(e,()=>({focus(){var y;(y=t.current)==null||y.focus()},getUsj(){var y;return(y=t.current)==null?void 0:y.getUsj()},setUsj(y){var v;(v=t.current)==null||v.setUsj(y)},applyUpdate(y,v){var _;(_=t.current)==null||_.applyUpdate(y,v)},getSelection(){var y;return(y=t.current)==null?void 0:y.getSelection()},setSelection(y){var v;(v=t.current)==null||v.setSelection(y)},addAnnotation(y,v,_){var w;(w=t.current)==null||w.addAnnotation(y,v,_)},removeAnnotation(y,v){var _;(_=t.current)==null||_.removeAnnotation(y,v)},insertNote(y,v,_){var w;(w=t.current)==null||w.insertNote(y,v,_)},setComments(y){var v;(v=d.current)==null||v.setComments(y),r.current=!0},get toolbarEndRef(){return s}}));const p=x.useCallback((y,v,_)=>{var w;if(!c)return;const E=(w=d.current)==null?void 0:w.getComments();c(y,E,v,_)},[d,c]),m=x.useCallback(()=>{var y;if(!l||r.current){r.current=!1;return}const v=(y=d.current)==null?void 0:y.getComments();l(v)},[d,r,l]);return x.useEffect(()=>{var y;return o(((y=t.current)==null?void 0:y.toolbarEndRef)??null),()=>o(null)},[]),S.jsxs(sv,{ref:t,onUsjChange:p,...u,children:[S.jsx(_M,{setCommentStore:g,onChange:m,showCommentsContainerRef:f?null:s,commentContainerRef:i,logger:u.logger}),S.jsx("div",{ref:i,className:"comment-container"})]})});const br=x.memo(function({viewMode:e,description:t,children:r}){const i=e==="story",s=x.useMemo(()=>!i||typeof t!="string"||!t.trim()?null:S.jsxs(Tv,{className:"tw-w-full",children:[S.jsx(Ev,{className:"tw-pb-2",children:S.jsx(Nv,{className:"tw-text-sm tw-font-medium tw-text-muted-foreground",children:"Story Description"})}),S.jsx(Mv,{className:"tw-pt-2",children:S.jsx(Sv,{className:"tw-prose-sm tw-max-w-none tw-text-muted-foreground",markdown:t})})]}),[t,i]);return S.jsxs("div",{style:{display:"grid",gap:8},children:[r,s]})});br.__docgenInfo={description:"",methods:[],displayName:"CanvasWithDescription",props:{viewMode:{required:!1,tsType:{name:"string"},description:""},description:{required:!1,tsType:{name:"string"},description:""},children:{required:!0,tsType:{name:"ReactNode"},description:""}}};function Sa({onClick:n,title:e,ariaLabel:t,children:r}){return S.jsx("button",{type:"button",onClick:n,title:e,"aria-label":t,style:{padding:"8px",backgroundColor:"#007acc",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",width:"36px",height:"36px"},onMouseOver:i=>{i.currentTarget.style.backgroundColor="#005a9e"},onMouseOut:i=>{i.currentTarget.style.backgroundColor="#007acc"},onFocus:i=>{i.currentTarget.style.backgroundColor="#005a9e"},onBlur:i=>{i.currentTarget.style.backgroundColor="#007acc"},children:r})}Sa.__docgenInfo={description:"",methods:[],displayName:"ToolbarButton",props:{onClick:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},title:{required:!0,tsType:{name:"string"},description:""},ariaLabel:{required:!0,tsType:{name:"string"},description:""},children:{required:!0,tsType:{name:"ReactNode"},description:""}}};function hv({editorRef:n}){const e=()=>{var i;(i=n.current)==null||i.insertNote("f")},t=()=>{var i;(i=n.current)==null||i.insertNote("x")},r=()=>{var i;(i=n.current)==null||i.insertNote("fe")};return S.jsxs("div",{title:"External Toolbar",style:{padding:"8px 12px",backgroundColor:"#f5f5f5",borderBottom:"1px solid #ddd",display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"},children:[S.jsx(Sa,{onClick:e,title:"Insert Footnote",ariaLabel:"Insert Footnote",children:S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-superscript",viewBox:"0 0 16 16",children:S.jsx("path",{d:"m4.266 12.496.96-2.853H8.76l.96 2.853H11L7.62 3H6.38L3 12.496zm2.748-8.063 1.419 4.23h-2.88l1.426-4.23zm5.132-1.797v-.075c0-.332.234-.618.619-.618.354 0 .618.256.618.58 0 .362-.271.649-.52.898l-1.788 1.832V6h3.59v-.958h-1.923v-.045l.973-1.04c.415-.438.867-.845.867-1.547 0-.8-.701-1.41-1.787-1.41C11.565 1 11 1.8 11 2.576v.06z"})})}),S.jsx(Sa,{onClick:t,title:"Insert Cross Reference",ariaLabel:"Insert Cross Reference",children:S.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-shuffle",viewBox:"0 0 16 16",children:[S.jsx("path",{fillRule:"evenodd",d:"M0 3.5A.5.5 0 0 1 .5 3H1c2.202 0 3.827 1.24 4.874 2.418.49.552.865 1.102 1.126 1.532.26-.43.636-.98 1.126-1.532C9.173 4.24 10.798 3 13 3v1c-1.798 0-3.173 1.01-4.126 2.082A9.6 9.6 0 0 0 7.556 8a9.6 9.6 0 0 0 1.317 1.918C9.828 10.99 11.204 12 13 12v1c-2.202 0-3.827-1.24-4.874-2.418A10.6 10.6 0 0 1 7 9.05c-.26.43-.636.98-1.126 1.532C4.827 11.76 3.202 13 1 13H.5a.5.5 0 0 1 0-1H1c1.798 0 3.173-1.01 4.126-2.082A9.6 9.6 0 0 0 6.444 8a9.6 9.6 0 0 0-1.317-1.918C4.172 5.01 2.796 4 1 4H.5a.5.5 0 0 1-.5-.5"}),S.jsx("path",{d:"M13 5.466V1.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192m0 9v-3.932a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192"})]})}),S.jsx(Sa,{onClick:r,title:"Insert Endnote",ariaLabel:"Insert Endnote",children:S.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-window-fullscreen",viewBox:"0 0 16 16",style:{transform:"scaleY(-1)"},children:[S.jsx("path",{d:"M3 3.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0m1.5 0a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0m1 .5a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1"}),S.jsx("path",{d:"M.5 1a.5.5 0 0 0-.5.5v13a.5.5 0 0 0 .5.5h15a.5.5 0 0 0 .5-.5v-13a.5.5 0 0 0-.5-.5zM1 5V2h14v3zm0 1h14v8H1z"})]})})]})}hv.__docgenInfo={description:"",methods:[],displayName:"ExternalToolbar",props:{editorRef:{required:!0,tsType:{name:"RefObject",elements:[{name:"union",raw:"EditorRef | null",elements:[{name:"EditorRef"},{name:"null"}]}],raw:"RefObject<EditorRef | null>"},description:""}}};const wM='<usx version="3.1" />',xM=ed(wM),CM=`<?xml version="1.0" encoding="utf-8"?>
<usx version="3.1">
  <book code="PSA" style="id">World English Bible (WEB)</book>
  <para style="mt1">The Psalms</para>
  <chapter number="1" style="c" sid="PSA 1" />
  <para style="q1">
    <verse number="1" style="v" sid="PSA 1:1" />Blessed is the man who doesn’t walk in the counsel of the wicked<note caller="+" style="f"><char style="fr">1:1 </char><char style="ft">Or "sinful"</char></note>,</para>
  <para style="q2" vid="PSA 1:1">nor stand on the path<note caller="+" style="f"><char style="fr">1:1 </char><char style="ft">Hebrew: "way"</char></note> of sinners,</para>
  <para style="q2" vid="PSA 1:1">nor sit in the seat of scoffers;<verse eid="PSA 1:1" /></para>
  <para style="q1">
    <verse number="2" style="v" sid="PSA 1:2" /><note caller="+" style="f"><char style="fr" closed="false">1:2 </char><char style="ft" closed="false">After verse</char></note> but his delight is in Yahweh’s<note caller="+" style="f"><char style="fr" closed="false">1:2 </char><char style="ft" closed="false">“Yahweh” is God’s proper Name, sometimes rendered “LORD” (all caps) in other translations.</char></note> law.<note caller="+" style="f"><char style="fr" closed="false">1:2 </char><char style="ft" closed="false">End of Para</char></note></para>
  <para style="q2" vid="PSA 1:2">On his law he meditates day and night.<note caller="+" style="f"><char style="fr" closed="false">1:2 </char><char style="ft" closed="false">End of Doc</char></note><verse eid="PSA 1:2" /></para>
</usx>
`,Wn=ed(CM),SM={start:{jsonPath:"$.content[3].content[1]",offset:15},end:{jsonPath:"$.content[3].content[1]",offset:18}},TM={start:{jsonPath:"$.content[3].content[1]",offset:15},end:{jsonPath:"$.content[3].content[1]",offset:22}},EM=`<?xml version="1.0" encoding="utf-8"?>
<usx version="3.1">
  <book code="PSA" style="id">תהילים</book>
  <para style="mt1">תהילים</para>
  <chapter number="1" style="c" sid="PSA 1" />
  <para style="q1">
    <verse number="1" style="v" sid="PSA 1:1" />אשרי האיש אשר לא הלך בעצת רשעים,</para>
  <para style="q2" vid="PSA 1:1">ובדרך חטאים לא עמד,</para>
  <para style="q2" vid="PSA 1:1">ובמושב לצים לא ישב.<verse eid="PSA 1:1" /></para>
  <para style="q1">
    <verse number="2" style="v" sid="PSA 1:2" />כי אם בתורת יהוה חפצו,</para>
  <para style="q2" vid="PSA 1:2">ובתורתו יהגה יומם ולילה.<verse eid="PSA 1:2" /></para>
</usx>
`,NM=ed(EM),qt={book:"PSA",chapterNum:1,verseNum:1},XM={title:"Demo/Editorial",component:Bn,tags:["autodocs"],parameters:{docs:{description:{component:`
**Demo Only:** This component is provided for demonstration purposes only. For production applications, developers should import the Scripture Editor component directly from:
- npm [@eten-tech-foundation/platform-editor](https://www.npmjs.com/package/@eten-tech-foundation/platform-editor)
- github [@eten-tech-foundation/platform-editor](https://github.com/eten-tech-foundation/scripture-editors/tree/main/packages/platform)

This demo version is included in Storybook to showcase the component's functionality and usage patterns.

**Known Limitation:** In the Docs view, all story examples may show the same note caller style due to global state management in the editor component. To see the correct note caller behavior for each story (default lowercase letters vs custom symbols), please view the individual stories in the Canvas view instead of the Docs view.
        `}}},argTypes:{ref:{control:"object",description:"Reference to the editor instance",defaultValue:null},defaultUsj:{control:"object",description:"Default USJ object to initialize the editor with",defaultValue:{type:Ti,version:Si,content:[""]}},scrRef:{control:"object",description:"Scripture reference",defaultValue:qt},options:{control:"object",description:"Options to configure the editor (EditorOptions)",defaultValue:{},table:{type:{summary:"EditorOptions",detail:'{ isReadonly?: boolean; hasSpellCheck?: boolean; textDirection?: "ltr" | "rtl" | "auto"; markerMenuTrigger?: string; nodes?: UsjNodeOptions; }'}}}}},ta={args:{defaultUsj:Wn,scrRef:qt}},na={args:{defaultUsj:xM,scrRef:qt}},ra={args:{defaultUsj:Wn,scrRef:qt,options:{isReadonly:!0}}},ia={render:(n,e)=>{var t,r,i,s;return S.jsx(br,{viewMode:e.viewMode,description:((i=(r=(t=e.parameters)==null?void 0:t.docs)==null?void 0:r.description)==null?void 0:i.story)??((s=e.parameters)==null?void 0:s.description),children:S.jsx(Bn,{...n})})},parameters:{docs:{description:{story:'Right-to-left example using a Hebrew snippet (Psalm 1:1). The editor is set to RTL via _options.textDirection = "rtl"_. If you want the UI (editor toolbar) to be RTL click **Switch direction** in the Storybook toolbar.'}}},args:{defaultUsj:NM,scrRef:qt,options:{textDirection:"rtl"}}},sa={render:n=>{const e=x.useRef(null);return x.useEffect(()=>{e.current&&(e.current.addAnnotation(SM,"spelling","annotationId"),e.current.addAnnotation(TM,"grammar","abc123"))},[]),S.jsx(Bn,{...n,ref:e})},args:{defaultUsj:Wn,scrRef:qt}},MM={view:{...mo(),noteMode:"expandInline"},nodes:{noteCallerOnClick:(n,e,t,r,i)=>{t||(r()===Kr?i(tf):i(Kr))}}},oa={render:(n,e)=>{var t,r,i,s;return S.jsx(br,{viewMode:e.viewMode,description:((i=(r=(t=e.parameters)==null?void 0:t.docs)==null?void 0:r.description)==null?void 0:i.story)??((s=e.parameters)==null?void 0:s.description),children:S.jsx(Bn,{...n})})},parameters:{docs:{description:{story:"This story demonstrates editing notes inline. Move your cursor to a note caller and the note will expand and can be edited. Move the cursor out of the note and it will collapse. Click the expanded note caller to toggle between the auto-generated caller and the hidden caller."}}},args:{defaultUsj:Wn,scrRef:qt,options:MM}},AM={view:{...mo(),noteMode:"expandInline"}},aa={render:(n,e)=>{var r,i,s,o;const t=x.useRef(null);return S.jsxs(br,{viewMode:e.viewMode,description:((s=(i=(r=e.parameters)==null?void 0:r.docs)==null?void 0:i.description)==null?void 0:s.story)??((o=e.parameters)==null?void 0:o.description),children:[S.jsx(hv,{editorRef:t}),S.jsx(Bn,{...n,ref:t})]})},parameters:{docs:{description:{story:"This story demonstrates inserting notes. Use the buttons above the editor to insert footnotes, cross-references, and endnotes at the current cursor position. Selecting text before inserting a footnote will use that text as the footnote quote."}}},args:{defaultUsj:Wn,scrRef:qt,options:AM}},OM={nodes:{noteCallers:["①","②","③","④","⑤","⑥","⑦","⑧","⑨","⑩"],noteCallerOnClick:n=>{console.log("Note caller clicked:",n),alert("Note caller clicked! Check console for details.")}}},la={render:(n,e)=>{var t,r,i,s;return S.jsx(br,{viewMode:e.viewMode,description:((i=(r=(t=e.parameters)==null?void 0:t.docs)==null?void 0:r.description)==null?void 0:i.story)??((s=e.parameters)==null?void 0:s.description),children:S.jsx(Bn,{...n})})},parameters:{docs:{description:{story:"This story demonstrates custom note callers and click handling. **Try clicking on the circled number footnote markers (① ②) in the text to see the click handler in action!** The click event will show an alert and log details to the browser console."}}},args:{defaultUsj:Wn,scrRef:qt,options:OM}},ca={render:(n,e)=>{var t,r,i,s;return S.jsx(br,{viewMode:e.viewMode,description:((i=(r=(t=e.parameters)==null?void 0:t.docs)==null?void 0:r.description)==null?void 0:i.story)??((s=e.parameters)==null?void 0:s.description),children:S.jsx(Bn,{...n})})},parameters:{docs:{description:{story:'This story demonstrates using a custom marker menu trigger key. **Try typing "?" (question mark) anywhere in the editor text to open the marker menu!** The default trigger is "\\\\" (backslash), but this story changes it to "?" for demonstration. The marker menu allows you to insert USFM markers into the text.'}}},args:{defaultUsj:Wn,scrRef:qt,options:{markerMenuTrigger:"?"}}},ua={render:(n,e)=>{var c,u,f,d;const t=x.useRef(null),[r,i]=x.useState(null),[s,o]=x.useState(!1),a=x.useMemo(()=>({...n.options??{},view:{markerMode:s?"visible":"hidden",hasSpacing:!0,isFormattedFont:!0}}),[n.options,s]);x.useEffect(()=>{var p,m;const g=(m=(p=t.current)==null?void 0:p.toolbarEndRef)==null?void 0:m.current;if(g)i(g);else{const y=window.setTimeout(()=>{var _,w;const v=(w=(_=t.current)==null?void 0:_.toolbarEndRef)==null?void 0:w.current;v&&i(v)},0);return()=>window.clearTimeout(y)}},[a]);const l=x.useCallback(()=>o(g=>!g),[]);return S.jsxs(br,{viewMode:e.viewMode,description:((f=(u=(c=e.parameters)==null?void 0:c.docs)==null?void 0:u.description)==null?void 0:f.story)??((d=e.parameters)==null?void 0:d.description),children:[S.jsx(Bn,{...n,options:a,ref:t}),r&&Nt.createPortal(S.jsx("button",{type:"button",title:"Show/hide markers","aria-label":"Show/hide markers","aria-pressed":s,className:`toolbar-item ${s?"active":""}`,onClick:l,children:S.jsx("span",{className:"icon pilcrow-icon","aria-hidden":"true",children:"¶"})}),r)]})},parameters:{docs:{description:{story:"This story demonstrates the Markers view, which shows USFM markers inline with the text. Click the **Show/hide markers** (¶) button in the editor toolbar to toggle the Markers view on and off. "}}},args:{defaultUsj:Wn,scrRef:qt}},da={name:"View Options",render:(n,e)=>{var t,r,i,s;return S.jsx(br,{viewMode:e.viewMode,description:((i=(r=(t=e.parameters)==null?void 0:t.docs)==null?void 0:r.description)==null?void 0:i.story)??((s=e.parameters)==null?void 0:s.description),children:S.jsx(Bn,{...n})})},parameters:{docs:{description:{story:'Demonstrates the editor view options (marker visibility, spacing, and formatted font) using USX input. Below in the **Controls** tab, try changing the **options.view** values to see how they affect the editor display. Valid values for **markerMode** are _"hidden"_, _"visible"_, and _"editable"_.'}}},args:{defaultUsj:Wn,scrRef:qt,options:{view:{markerMode:"hidden",hasSpacing:!0,isFormattedFont:!0}}}};var wp,xp,Cp;ta.parameters={...ta.parameters,docs:{...(wp=ta.parameters)==null?void 0:wp.docs,source:{originalSource:`{
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef
  }
}`,...(Cp=(xp=ta.parameters)==null?void 0:xp.docs)==null?void 0:Cp.source}}};var Sp,Tp,Ep;na.parameters={...na.parameters,docs:{...(Sp=na.parameters)==null?void 0:Sp.docs,source:{originalSource:`{
  args: {
    defaultUsj: usjEmpty,
    scrRef: defaultScrRef
  }
}`,...(Ep=(Tp=na.parameters)==null?void 0:Tp.docs)==null?void 0:Ep.source}}};var Np,Mp,Ap;ra.parameters={...ra.parameters,docs:{...(Np=ra.parameters)==null?void 0:Np.docs,source:{originalSource:`{
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef,
    options: {
      isReadonly: true
    }
  }
}`,...(Ap=(Mp=ra.parameters)==null?void 0:Mp.docs)==null?void 0:Ap.source}}};var Op,$p,Pp;ia.parameters={...ia.parameters,docs:{...(Op=ia.parameters)==null?void 0:Op.docs,source:{originalSource:`{
  render: (args, context) => <CanvasWithDescription viewMode={context.viewMode} description={context.parameters?.docs?.description?.story ?? context.parameters?.description}>
      <Editorial {...args} />
    </CanvasWithDescription>,
  parameters: {
    docs: {
      description: {
        story: 'Right-to-left example using a Hebrew snippet (Psalm 1:1). ' + 'The editor is set to RTL via _options.textDirection = "rtl"_. If you want the UI ' + '(editor toolbar) to be RTL click **Switch direction** in the Storybook toolbar.'
      }
    }
  },
  args: {
    defaultUsj: usjHebrew,
    scrRef: defaultScrRef,
    options: {
      textDirection: 'rtl'
    }
  }
}`,...(Pp=($p=ia.parameters)==null?void 0:$p.docs)==null?void 0:Pp.source}}};var Ip,Rp,Dp;sa.parameters={...sa.parameters,docs:{...(Ip=sa.parameters)==null?void 0:Ip.docs,source:{originalSource:`{
  render: args => {
    // eslint-disable-next-line no-null/no-null
    const editorRef = useRef<EditorRef | null>(null);
    useEffect(() => {
      if (editorRef.current) {
        editorRef.current.addAnnotation(annotationRangeWeb1, 'spelling', 'annotationId');
        editorRef.current.addAnnotation(annotationRangeWeb2, 'grammar', 'abc123');
      }
    }, []);
    return <Editorial {...args} ref={editorRef} />;
  },
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef
  }
}`,...(Dp=(Rp=sa.parameters)==null?void 0:Rp.docs)==null?void 0:Dp.source}}};var Lp,jp,Fp;oa.parameters={...oa.parameters,docs:{...(Lp=oa.parameters)==null?void 0:Lp.docs,source:{originalSource:`{
  render: (args, context) => <CanvasWithDescription viewMode={context.viewMode} description={context.parameters?.docs?.description?.story ?? context.parameters?.description}>
      <Editorial {...args} />
    </CanvasWithDescription>,
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates editing notes inline. Move your cursor to a note caller and ' + 'the note will expand and can be edited. Move the cursor out of the note and it will ' + 'collapse. Click the expanded note caller to toggle between the auto-generated caller ' + 'and the hidden caller.'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef,
    options: inlineNoteOptions
  }
}`,...(Fp=(jp=oa.parameters)==null?void 0:jp.docs)==null?void 0:Fp.source}}};var qp,Bp,Wp;aa.parameters={...aa.parameters,docs:{...(qp=aa.parameters)==null?void 0:qp.docs,source:{originalSource:`{
  render: (args, context) => {
    // eslint-disable-next-line no-null/no-null
    const editorRef = useRef<EditorRef | null>(null);
    return <CanvasWithDescription viewMode={context.viewMode} description={context.parameters?.docs?.description?.story ?? context.parameters?.description}>
        <ExternalToolbar editorRef={editorRef} />
        <Editorial {...args} ref={editorRef} />
      </CanvasWithDescription>;
  },
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates inserting notes. Use the buttons above the editor to insert ' + 'footnotes, cross-references, and endnotes at the current cursor position. Selecting ' + 'text before inserting a footnote will use that text as the footnote quote.'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef,
    options: insertNoteOptions
  }
}`,...(Wp=(Bp=aa.parameters)==null?void 0:Bp.docs)==null?void 0:Wp.source}}};var Up,zp,Kp;la.parameters={...la.parameters,docs:{...(Up=la.parameters)==null?void 0:Up.docs,source:{originalSource:`{
  render: (args, context) => <CanvasWithDescription viewMode={context.viewMode} description={context.parameters?.docs?.description?.story ?? context.parameters?.description}>
      <Editorial {...args} />
    </CanvasWithDescription>,
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates custom note callers and click handling. **Try clicking on the ' + 'circled number footnote markers (① ②) in the text to see the click handler in ' + 'action!** The click event will show an alert and log details to the browser console.'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef,
    options: customNodeOptions
  }
}`,...(Kp=(zp=la.parameters)==null?void 0:zp.docs)==null?void 0:Kp.source}}};var Hp,Jp,Vp;ca.parameters={...ca.parameters,docs:{...(Hp=ca.parameters)==null?void 0:Hp.docs,source:{originalSource:`{
  render: (args, context) => <CanvasWithDescription viewMode={context.viewMode} description={context.parameters?.docs?.description?.story ?? context.parameters?.description}>
      <Editorial {...args} />
    </CanvasWithDescription>,
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates using a custom marker menu trigger key. **Try typing "?" ' + '(question mark) anywhere in the editor text to open the marker menu!** The default ' + 'trigger is "\\\\\\\\" (backslash), but this story changes it to "?" for demonstration. ' + 'The marker menu allows you to insert USFM markers into the text.'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef,
    options: {
      markerMenuTrigger: '?'
    }
  }
}`,...(Vp=(Jp=ca.parameters)==null?void 0:Jp.docs)==null?void 0:Vp.source}}};var Gp,Yp,Xp;ua.parameters={...ua.parameters,docs:{...(Gp=ua.parameters)==null?void 0:Gp.docs,source:{originalSource:`{
  render: (args, context) => {
    // eslint-disable-next-line no-null/no-null
    const editorRef = useRef<EditorRef | null>(null);
    // eslint-disable-next-line no-null/no-null
    const [toolbarEndEl, setToolbarEndEl] = useState<HTMLElement | null>(null);
    const [showMarkers, setShowMarkers] = useState(false);
    const mergedOptions = useMemo(() => {
      const base = args.options ?? {};
      const view: ViewOptions = {
        markerMode: showMarkers ? 'visible' : 'hidden',
        hasSpacing: true,
        isFormattedFont: true
      };
      return {
        ...base,
        view
      };
    }, [args.options, showMarkers]);
    useEffect(() => {
      const el = editorRef.current?.toolbarEndRef?.current;
      if (el) setToolbarEndEl(el);else {
        // Retry once on next tick in case the toolbar mounts after the ref effect
        const id = window.setTimeout(() => {
          const el2 = editorRef.current?.toolbarEndRef?.current;
          if (el2) setToolbarEndEl(el2);
        }, 0);
        return () => window.clearTimeout(id);
      }
      return undefined;
    }, [mergedOptions]);
    const handleShowMarkerToggle = useCallback(() => setShowMarkers(v => !v), []);
    return <CanvasWithDescription viewMode={context.viewMode} description={context.parameters?.docs?.description?.story ?? context.parameters?.description}>
        <Editorial {...args} options={mergedOptions} ref={editorRef} />
        {toolbarEndEl && createPortal(<button type="button" title="Show/hide markers" aria-label="Show/hide markers" aria-pressed={showMarkers} className={\`toolbar-item \${showMarkers ? 'active' : ''}\`} onClick={handleShowMarkerToggle}>
              <span className="icon pilcrow-icon" aria-hidden="true">
                ¶
              </span>
            </button>, toolbarEndEl)}
      </CanvasWithDescription>;
  },
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates the Markers view, which shows USFM markers inline with the ' + 'text. Click the **Show/hide markers** (¶) button in the editor toolbar to toggle the ' + 'Markers view on and off. '
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef
  }
}`,...(Xp=(Yp=ua.parameters)==null?void 0:Yp.docs)==null?void 0:Xp.source}}};var Zp,Qp,em;da.parameters={...da.parameters,docs:{...(Zp=da.parameters)==null?void 0:Zp.docs,source:{originalSource:`{
  name: 'View Options',
  render: (args, context) => <CanvasWithDescription viewMode={context.viewMode} description={context.parameters?.docs?.description?.story ?? context.parameters?.description}>
      <Editorial {...args} />
    </CanvasWithDescription>,
  parameters: {
    docs: {
      description: {
        story: 'Demonstrates the editor view options (marker visibility, spacing, and formatted font) ' + 'using USX input. Below in the **Controls** tab, try changing the **options.view** ' + 'values to see how they affect the editor display. Valid values for **markerMode** are ' + '_"hidden"_, _"visible"_, and _"editable"_.'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef,
    options: {
      view: {
        markerMode: 'hidden',
        hasSpacing: true,
        isFormattedFont: true
      }
    }
  }
}`,...(em=(Qp=da.parameters)==null?void 0:Qp.docs)==null?void 0:em.source}}};const ZM=["Default","Empty","ReadOnly","RTL","Annotated","InlineNoteEditing","InsertNote","CustomNoteOptions","CustomMarkerTrigger","MarkersView","ViewOptionsStory"];export{sa as Annotated,ca as CustomMarkerTrigger,la as CustomNoteOptions,ta as Default,na as Empty,oa as InlineNoteEditing,aa as InsertNote,ua as MarkersView,ia as RTL,ra as ReadOnly,da as ViewOptionsStory,ZM as __namedExportsOrder,XM as default};
