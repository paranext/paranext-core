var Fv=Object.defineProperty;var qv=(n,e,t)=>e in n?Fv(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var It=(n,e,t)=>qv(n,typeof e!="symbol"?e+"":e,t);import{j as S}from"./jsx-runtime-CvGToidP.js";import{c as Zn,g as Bv,r as k}from"./iframe-FHgAwj54.js";import{_ as _d,H as Uv,p as Hs,O as Js,D as zv,U as Wv,B as Kv,V as bd}from"./index-ZThHfTg3.js";import{r as At}from"./index-CgTHgj0j.js";import{c as Hv,d as Jv,e as Vv,g as Gv}from"./floating-ui.react-dom-DDxLfT8M.js";import{M as Yv}from"./markdown-renderer.component-CeKtV2qi.js";import{C as Xv,a as Qv,b as Zv,d as ek}from"./card-DnIm6lle.js";import{B as tk}from"./book-chapter-control.component-D0cz-R5D.js";import{T as nk}from"./tab-toolbar.component-QGCbtrJq.js";import{B as In}from"./button-cud2eTA2.js";import{D as rk,a as ik,b as sk,c as ok}from"./dropdown-menu-CmJD305T.js";import{C as ak}from"./chevron-down-i-XYDP49.js";import{c as en}from"./createLucideIcon-B4WsWZHQ.js";import{F as Tn}from"./file-text-Cj5D4s7Q.js";import{X as lk}from"./x-CFBWqveS.js";import{C as ck}from"./check-Ce2iVscw.js";import{C as uk}from"./copy-Bb-SS_US.js";import{P as dk,c as fk,b as hk}from"./popover-CevumqeB.js";import"./index-BJ-VzaQi.js";import"./shadcn-ui.util-DMJ19wEV.js";import"./book-item.utils-C-lDUZz1.js";import"./command-D3tc6HP1.js";import"./index-DGcOpdI4.js";import"./index-Cb3YhHOz.js";import"./index-DMIDenWg.js";import"./index-D-wbo5Oc.js";import"./index-DvVrmaIy.js";import"./index-gPdjwkel.js";import"./index-DmQmB0x9.js";import"./index-desAK0Z_.js";import"./index-DLzBYexm.js";import"./Combination-CMZlQmZK.js";import"./index-8o_pfAlr.js";import"./index-C6LUVuya.js";import"./index-np2ZhOVR.js";import"./dialog-C1cDbYMW.js";import"./search-DYGW0Xl3.js";import"./index.es-D4jfZzAn.js";import"./index-Bf4Kv1PK.js";import"./chevron-left-bdRDGp6P.js";import"./chevron-right-Cncp9OTI.js";import"./arrow-right-DKiik7w5.js";import"./tab-dropdown-menu.component-CTo1EthS.js";import"./tooltip-Cs5ADqQk.js";import"./index-CBoFXSy3.js";import"./index-BXuT3Sj2.js";import"./index-q5xUhQdo.js";import"./menu.util-Dxh7JGT4.js";import"./menu-icon.component-CLDThtQX.js";import"./tab-toolbar-container.component-Dc8OvG-w.js";import"./index-BPbCuWFR.js";import"./menu.context-BrEJJXIC.js";import"./index-CnlM3g2y.js";import"./index-lUSupRFo.js";import"./index-DYbRprcN.js";import"./index--W5ZaJkm.js";import"./circle-EX5G5xxd.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gk=[["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 18h18",key:"1h113x"}],["path",{d:"M3 6h18",key:"d0wm0j"}]],Qo=en("AlignJustify",gk);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pk=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]],mk=en("Ban",pk);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yk=[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"m17 12 3-2v8",key:"1hhhft"}]],wi=en("Heading1",yk);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _k=[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M21 18h-4c0-4 4-3 4-6 0-1.5-2-2.5-4-1",key:"9jr5yi"}]],Kf=en("Heading2",_k);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bk=[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M17.5 10.5c1.7-1 3.5 0 3.5 1.5a2 2 0 0 1-2 2",key:"68ncm8"}],["path",{d:"M17 17.5c2 1.5 4 .3 4-1.5a2 2 0 0 0-2-2",key:"1ejuhz"}]],Ic=en("Heading3",bk);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vk=[["path",{d:"M16 12H3",key:"1a2rj7"}],["path",{d:"M16 6H3",key:"1wxfjs"}],["path",{d:"M10 18H3",key:"13769t"}],["path",{d:"M21 6v10a2 2 0 0 1-2 2h-5",key:"ilrcs8"}],["path",{d:"m16 16-2 2 2 2",key:"kkc6pm"}]],kk=en("ListEnd",vk);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wk=[["path",{d:"M21 7v6h-6",key:"3ptur4"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7",key:"1kgawr"}]],xk=en("Redo",wk);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ck=[["path",{d:"m18 14 4 4-4 4",key:"10pe0f"}],["path",{d:"m18 2 4 4-4 4",key:"pucp1d"}],["path",{d:"M2 18h1.973a4 4 0 0 0 3.3-1.7l5.454-8.6a4 4 0 0 1 3.3-1.7H22",key:"1ailkh"}],["path",{d:"M2 6h1.972a4 4 0 0 1 3.6 2.2",key:"km57vx"}],["path",{d:"M22 18h-6.041a4 4 0 0 1-3.3-1.8l-.359-.45",key:"os18l9"}]],Sk=en("Shuffle",Ck);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tk=[["path",{d:"m4 19 8-8",key:"hr47gm"}],["path",{d:"m12 19-8-8",key:"1dhhmo"}],["path",{d:"M20 12h-4c0-1.5.442-2 1.5-2.5S20 8.334 20 7.002c0-.472-.17-.93-.484-1.29a2.105 2.105 0 0 0-2.617-.436c-.42.239-.738.614-.899 1.06",key:"1dfcux"}]],Ek=en("Superscript",Tk);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nk=[["path",{d:"M17 6H3",key:"16j9eg"}],["path",{d:"M21 12H8",key:"scolzb"}],["path",{d:"M21 18H8",key:"1wfozv"}],["path",{d:"M3 12v6",key:"fv4c87"}]],Rc=en("TextQuote",Nk);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mk=[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]],Ak=en("Undo",Mk);function J(n,...e){const t=new URL("https://lexical.dev/docs/error"),r=new URLSearchParams;r.append("code",n);for(const i of e)r.append("v",i);throw t.search=r.toString(),Error(`Minified Lexical error #${n}; visit ${t.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}const tn=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,Ok=tn&&"documentMode"in document?document.documentMode:null,dn=tn&&/Mac|iPod|iPhone|iPad/.test(navigator.platform),Ur=tn&&/^(?!.*Seamonkey)(?=.*Firefox).*/i.test(navigator.userAgent),za=!(!tn||!("InputEvent"in window)||Ok)&&"getTargetRanges"in new window.InputEvent("input"),Vs=tn&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent),Ii=tn&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,$k=tn&&/Android/.test(navigator.userAgent),Om=tn&&/^(?=.*Chrome).*/i.test(navigator.userAgent),Hf=tn&&$k&&Om,Wa=tn&&/AppleWebKit\/[\d.]+/.test(navigator.userAgent)&&!Om;function Ka(...n){const e=[];for(const t of n)if(t&&typeof t=="string")for(const[r]of t.matchAll(/\S+/g))e.push(r);return e}const Pk=1,Ik=3,Rk=9,Dk=11,zr=0,$m=1,Ri=2,Lk=0,jk=1,Fk=2,Ha=4,Ja=8,vd=128,qk=1792|(112|(3|Ha|Ja)|vd),kd=1,wd=2,xd=3,Cd=4,Sd=5,Td=6,Sl=Vs||Ii||Wa?" ":"​",Fn=`

`,Bk=Ur?" ":Sl,Pm="֑-߿יִ-﷽ﹰ-ﻼ",Im="A-Za-zÀ-ÖØ-öø-ʸ̀-֐ࠀ-῿‎Ⰰ-﬜︀-﹯﻽-￿",Uk=new RegExp("^[^"+Im+"]*["+Pm+"]"),zk=new RegExp("^[^"+Pm+"]*["+Im+"]"),ar={bold:1,capitalize:1024,code:16,highlight:vd,italic:2,lowercase:256,strikethrough:Ha,subscript:32,superscript:64,underline:Ja,uppercase:512},Wk={directionless:1,unmergeable:2},Jf={center:wd,end:Td,justify:Cd,left:kd,right:xd,start:Sd},Kk={[wd]:"center",[Td]:"end",[Cd]:"justify",[kd]:"left",[xd]:"right",[Sd]:"start"},Hk={normal:0,segmented:2,token:1},Jk={[Lk]:"normal",[Fk]:"segmented",[jk]:"token"},Vf="$config";function Rm(n,e,t,r,i,s){let o=n.getFirstChild();for(;o!==null;){const a=o.__key;o.__parent===e&&(F(o)&&Rm(o,a,t,r,i,s),t.has(a)||s.delete(a),i.push(a)),o=o.getNextSibling()}}const Vk=100;let pu=!1,Ed=0;function Gk(n){Ed=n.timeStamp}function Dc(n,e,t){const r=n.nodeName==="BR",i=e.__lexicalLineBreak;return i&&(n===i||r&&n.previousSibling===i)||r&&Il(n,t)!==void 0}function Yk(n,e,t){const r=Yt(Ft(t));let i=null,s=null;r!==null&&r.anchorNode===n&&(i=r.anchorOffset,s=r.focusOffset);const o=n.nodeValue;o!==null&&Yd(e,o,i,s,!1)}function Xk(n,e,t){if(q(n)){const r=n.anchor.getNode();if(r.is(t)&&n.format!==r.getFormat())return!1}return Kn(e)&&t.isAttached()}function Qk(n,e,t,r){for(let i=n;i&&!Yw(i);i=ko(i)){const s=Il(i,e);if(s!==void 0){const o=ce(s,t);if(o)return ke(o)||!Ne(i)?void 0:[i,o]}else if(i===r)return[r,Oy(t)]}}function Dm(n,e,t){pu=!0;const r=performance.now()-Ed>Vk;try{Mt(n,()=>{const i=K()||function(d){return d.getEditorState().read(()=>{const h=K();return h!==null?h.clone():null})}(n),s=new Map,o=n.getRootElement(),a=n._editorState,l=n._blockCursorElement;let c=!1,u="";for(let d=0;d<e.length;d++){const h=e[d],p=h.type,m=h.target,y=Qk(m,n,a,o);if(!y)continue;const[b,_]=y;if(p==="characterData")r&&W(_)&&Kn(m)&&Xk(i,m,_)&&Yk(m,_,n);else if(p==="childList"){c=!0;const w=h.addedNodes;for(let M=0;M<w.length;M++){const D=w[M],A=My(D),O=D.parentNode;if(O!=null&&D!==l&&A===null&&!Dc(D,O,n)){if(Ur){const B=(Ne(D)?D.innerText:null)||D.nodeValue;B&&(u+=B)}O.removeChild(D)}}const T=h.removedNodes,I=T.length;if(I>0){let M=0;for(let D=0;D<I;D++){const A=T[D];(Dc(A,m,n)||l===A)&&(m.appendChild(A),M++)}I!==M&&s.set(b,_)}}}if(s.size>0)for(const[d,h]of s)h.reconcileObservedMutation(d,n);const f=t.takeRecords();if(f.length>0){for(let d=0;d<f.length;d++){const h=f[d],p=h.addedNodes,m=h.target;for(let y=0;y<p.length;y++){const b=p[y],_=b.parentNode;_==null||b.nodeName!=="BR"||Dc(b,m,n)||_.removeChild(b)}}t.takeRecords()}i!==null&&(c&&it(i),Ur&&Dy(n)&&i.insertRawText(u))})}finally{pu=!1}}function Lm(n){const e=n._observer;e!==null&&Dm(n,e.takeRecords(),e)}function jm(n){(function(e){Ed===0&&Ft(e).addEventListener("textInput",Gk,!0)})(n),n._observer=new MutationObserver((e,t)=>{Dm(n,e,t)})}let Zk=class{constructor(e,t){this.key=e,this.parse=t.parse.bind(t),this.unparse=(t.unparse||nw).bind(t),this.isEqual=(t.isEqual||Object.is).bind(t),this.defaultValue=this.parse(void 0)}};function Fm(n,e){return new Zk(n,e)}function Qi(n,e,t="latest"){const r=(t==="latest"?n.getLatest():n).__state;return r?r.getValue(e):e.defaultValue}function Dn(n,e,t){let r;if(Qe(),typeof t=="function"){const s=n.getLatest(),o=Qi(s,e);if(r=t(o),e.isEqual(o,r))return s}else r=t;const i=n.getWritable();return Bm(i).updateFromKnown(e,r),i}function ew(n){const e=new Map,t=new Set;for(let r=typeof n=="function"?n:n.replace;r.prototype&&r.prototype.getType!==void 0;r=Object.getPrototypeOf(r)){const{ownNodeConfig:i}=ef(r);if(i&&i.stateConfigs)for(const s of i.stateConfigs){let o;"stateConfig"in s?(o=s.stateConfig,s.flat&&t.add(o.key)):o=s,e.set(o.key,o)}}return{flatKeys:t,sharedConfigMap:e}}let tw=class qm{constructor(e,t,r=void 0,i=new Map,s=void 0){this.node=e,this.sharedNodeState=t,this.unknownState=r,this.knownState=i;const{sharedConfigMap:o}=this.sharedNodeState,a=s!==void 0?s:function(l,c,u){let f=u.size;if(c)for(const d in c){const h=l.get(d);h&&u.has(h)||f++}return f}(o,r,i);this.size=a}getValue(e){const t=this.knownState.get(e);if(t!==void 0)return t;this.sharedNodeState.sharedConfigMap.set(e.key,e);let r=e.defaultValue;if(this.unknownState&&e.key in this.unknownState){const i=this.unknownState[e.key];i!==void 0&&(r=e.parse(i)),this.updateFromKnown(e,r)}return r}getInternalState(){return[this.unknownState,this.knownState]}toJSON(){const e={...this.unknownState},t={};for(const[r,i]of this.knownState)r.isEqual(i,r.defaultValue)?delete e[r.key]:e[r.key]=r.unparse(i);for(const r of this.sharedNodeState.flatKeys)r in e&&(t[r]=e[r],delete e[r]);return Gf(e)&&(t.$=e),t}getWritable(e){if(this.node===e)return this;const{sharedNodeState:t,unknownState:r}=this,i=new Map(this.knownState);return new qm(e,t,function(s,o,a){let l;if(a)for(const[c,u]of Object.entries(a)){const f=s.get(c);f?o.has(f)||o.set(f,f.parse(u)):(l=l||{},l[c]=u)}return l}(t.sharedConfigMap,i,r),i,this.size)}updateFromKnown(e,t){const r=e.key;this.sharedNodeState.sharedConfigMap.set(r,e);const{knownState:i,unknownState:s}=this;i.has(e)||s&&r in s||(s&&(delete s[r],this.unknownState=Gf(s)),this.size++),i.set(e,t)}updateFromUnknown(e,t){const r=this.sharedNodeState.sharedConfigMap.get(e);r?this.updateFromKnown(r,r.parse(t)):(this.unknownState=this.unknownState||{},e in this.unknownState||this.size++,this.unknownState[e]=t)}updateFromJSON(e){const{knownState:t}=this;for(const r of t.keys())t.set(r,r.defaultValue);if(this.size=t.size,this.unknownState=void 0,e)for(const[r,i]of Object.entries(e))this.updateFromUnknown(r,i)}};function Bm(n){const e=n.getWritable(),t=e.__state?e.__state.getWritable(e):new tw(e,Um(e));return e.__state=t,t}function Um(n){return n.__state?n.__state.sharedNodeState:Ey(Dl(),n.getType()).sharedNodeState}function Gf(n){if(n)for(const e in n)return n}function nw(n){return n}function Yf(n,e,t){for(const[r,i]of e.knownState){if(n.has(r.key))continue;n.add(r.key);const s=t?t.getValue(r):r.defaultValue;if(s!==i&&!r.isEqual(s,i))return!0}return!1}function Xf(n,e,t){const{unknownState:r}=e,i=t?t.unknownState:void 0;if(r){for(const[s,o]of Object.entries(r))if(!n.has(s)&&(n.add(s),o!==(i?i[s]:void 0)))return!0}return!1}function Qf(n,e){const t=n.__state;return t&&t.node===n?t.getWritable(e):t}function Zf(n,e){const t=n.__mode,r=n.__format,i=n.__style,s=e.__mode,o=e.__format,a=e.__style,l=n.__state,c=e.__state;return(t===null||t===s)&&(r===null||r===o)&&(i===null||i===a)&&(n.__state===null||l===c||function(u,f){if(u===f)return!0;if(u&&f&&u.size!==f.size)return!1;const d=new Set;return!(u&&Yf(d,u,f)||f&&Yf(d,f,u)||u&&Xf(d,u,f)||f&&Xf(d,f,u))}(l,c))}function eh(n,e){const t=n.mergeWithSibling(e),r=Pe()._normalizedNodes;return r.add(n.__key),r.add(e.__key),t}function th(n){let e,t,r=n;if(r.__text!==""||!r.isSimpleText()||r.isUnmergeable()){for(;(e=r.getPreviousSibling())!==null&&W(e)&&e.isSimpleText()&&!e.isUnmergeable();){if(e.__text!==""){if(Zf(e,r)){r=eh(e,r);break}break}e.remove()}for(;(t=r.getNextSibling())!==null&&W(t)&&t.isSimpleText()&&!t.isUnmergeable();){if(t.__text!==""){if(Zf(r,t)){r=eh(r,t);break}break}t.remove()}}else r.remove()}function Gs(n){return nh(n.anchor),nh(n.focus),n}function nh(n){for(;n.type==="element";){const e=n.getNode(),t=n.offset;let r,i;if(t===e.getChildrenSize()?(r=e.getChildAtIndex(t-1),i=!0):(r=e.getChildAtIndex(t),i=!1),W(r)){n.set(r.__key,i?r.getTextContentSize():0,"text",!0);break}if(!F(r))break;n.set(r.__key,i?r.getChildrenSize():0,"element",!0)}}let lr,_t,Ys,Tl,mu,yu,Wr,Ht,_u,Xs,Fe="",yt="",cn=null,un="",$n="",zm=!1,Qs=!1,Aa=null;function Va(n,e){const t=Wr.get(n);if(e!==null){const r=ku(n);r.parentNode===e&&e.removeChild(r)}if(Ht.has(n)||_t._keyToDOMMap.delete(n),F(t)){const r=Ya(t,Wr);bu(r,0,r.length-1,null)}t!==void 0&&Xd(Xs,Ys,Tl,t,"destroyed")}function bu(n,e,t,r){let i=e;for(;i<=t;++i){const s=n[i];s!==void 0&&Va(s,r)}}function $r(n,e){n.setProperty("text-align",e)}const rw="40px";function Wm(n,e){const t=lr.theme.indent;if(typeof t=="string"){const i=n.classList.contains(t);e>0&&!i?n.classList.add(t):e<1&&i&&n.classList.remove(t)}const r=getComputedStyle(n).getPropertyValue("--lexical-indent-base-value")||rw;n.style.setProperty("padding-inline-start",e===0?"":`calc(${e} * ${r})`)}function Km(n,e){const t=n.style;e===0?$r(t,""):e===kd?$r(t,"left"):e===wd?$r(t,"center"):e===xd?$r(t,"right"):e===Cd?$r(t,"justify"):e===Sd?$r(t,"start"):e===Td&&$r(t,"end")}function Ga(n,e){const t=Ht.get(n);t===void 0&&J(60);const r=t.createDOM(lr,_t);if(function(i,s,o){const a=o._keyToDOMMap;(function(l,c,u){const f=`__lexicalKey_${c._key}`;l[f]=u})(s,o,i),a.set(i,s)}(n,r,_t),W(t)?r.setAttribute("data-lexical-text","true"):ke(t)&&r.setAttribute("data-lexical-decorator","true"),F(t)){const i=t.__indent,s=t.__size;if(i!==0&&Wm(r,i),s!==0){const a=s-1;(function(l,c,u,f){const d=yt;yt="",vu(l,u,0,c,u.getDOMSlot(f)),Jm(u,f),yt=d})(Ya(t,Ht),a,t,r)}const o=t.__format;o!==0&&Km(r,o),t.isInline()||Hm(null,t,r),Rl(t)&&(Fe+=Fn,$n+=Fn)}else{const i=t.getTextContent();if(ke(t)){const s=t.decorate(_t,lr);s!==null&&Vm(n,s),r.contentEditable="false"}else W(t)&&(t.isDirectionless()||(yt+=i));Fe+=i,$n+=i}return e!==null&&e.insertChild(r),Xd(Xs,Ys,Tl,t,"created"),r}function vu(n,e,t,r,i){const s=Fe;Fe="";let o=t;for(;o<=r;++o){Ga(n[o],i);const a=Ht.get(n[o]);a!==null&&W(a)&&(cn===null&&(cn=a.getFormat()),un===""&&(un=a.getStyle()))}Rl(e)&&(Fe+=Fn),i.element.__lexicalTextContent=Fe,Fe=s+Fe}function rh(n,e){if(n){const t=n.__last;if(t){const r=e.get(t);if(r)return Dr(r)?"line-break":ke(r)&&r.isInline()?"decorator":null}return"empty"}return null}function Hm(n,e,t){const r=rh(n,Wr),i=rh(e,Ht);r!==i&&e.getDOMSlot(t).setManagedLineBreak(i)}function Jm(n,e){const t=e.__lexicalDirTextContent||"",r=e.__lexicalDir||"";if(t!==yt||r!==Aa){const i=yt==="",s=i?Aa:function(o){return Uk.test(o)?"rtl":zk.test(o)?"ltr":null}(yt);if(s!==r){const o=e.classList,a=lr.theme;let l=r!==null?a[r]:void 0,c=s!==null?a[s]:void 0;if(l!==void 0){if(typeof l=="string"){const u=Ka(l);l=a[r]=u}o.remove(...l)}if(s===null||i&&s==="ltr")e.removeAttribute("dir");else{if(c!==void 0){if(typeof c=="string"){const u=Ka(c);c=a[s]=u}c!==void 0&&o.add(...c)}e.dir=s}Qs||(n.getWritable().__dir=s)}Aa=s,e.__lexicalDirTextContent=yt,e.__lexicalDir=s}}function iw(n,e,t){const r=yt;var i;yt="",cn=null,un="",function(s,o,a){const l=Fe,c=s.__size,u=o.__size;Fe="";const f=a.element;if(c===1&&u===1){const d=s.__first,h=o.__first;if(d===h)Is(d,f);else{const m=ku(d),y=Ga(h,null);try{f.replaceChild(y,m)}catch(b){if(typeof b=="object"&&b!=null){const _=`${b.toString()} Parent: ${f.tagName}, new child: {tag: ${y.tagName} key: ${h}}, old child: {tag: ${m.tagName}, key: ${d}}.`;throw new Error(_)}throw b}Va(d,null)}const p=Ht.get(h);W(p)&&(cn===null&&(cn=p.getFormat()),un===""&&(un=p.getStyle()))}else{const d=Ya(s,Wr),h=Ya(o,Ht);if(d.length!==c&&J(227),h.length!==u&&J(228),c===0)u!==0&&vu(h,o,0,u-1,a);else if(u===0){if(c!==0){const p=a.after==null&&a.before==null&&a.element.__lexicalLineBreak==null;bu(d,0,c-1,p?null:f),p&&(f.textContent="")}}else(function(p,m,y,b,_,w){const T=b-1,I=_-1;let M,D,A=w.getFirstChild(),O=0,B=0;for(;O<=T&&B<=I;){const C=m[O],R=y[B];if(C===R)A=Lc(Is(R,w.element)),O++,B++;else{M===void 0&&(M=new Set(m)),D===void 0&&(D=new Set(y));const L=D.has(C),z=M.has(R);if(L)if(z){const H=qi(_t,R);H===A?A=Lc(Is(R,w.element)):(w.withBefore(A).insertChild(H),Is(R,w.element)),O++,B++}else Ga(R,w.withBefore(A)),B++;else A=Lc(ku(C)),Va(C,w.element),O++}const j=Ht.get(R);j!==null&&W(j)&&(cn===null&&(cn=j.getFormat()),un===""&&(un=j.getStyle()))}const x=O>T,N=B>I;if(x&&!N){const C=y[I+1],R=C===void 0?null:_t.getElementByKey(C);vu(y,p,B,I,w.withBefore(R))}else N&&!x&&bu(m,O,T,w.element)})(o,d,h,c,u,a)}Rl(o)&&(Fe+=Fn),f.__lexicalTextContent=Fe,Fe=l+Fe}(n,e,e.getDOMSlot(t)),Jm(e,t),i=e,cn==null||cn===i.__textFormat||Qs||i.setTextFormat(cn),function(s){un===""||un===s.__textStyle||Qs||s.setTextStyle(un)}(e),yt=r}function Ya(n,e){const t=[];let r=n.__first;for(;r!==null;){const i=e.get(r);i===void 0&&J(101),t.push(r),r=i.__next}return t}function Is(n,e){const t=Wr.get(n);let r=Ht.get(n);t!==void 0&&r!==void 0||J(61);const i=zm||yu.has(n)||mu.has(n),s=qi(_t,n);if(t===r&&!i){if(F(t)){const o=s.__lexicalTextContent;o!==void 0&&(Fe+=o,$n+=o);const a=s.__lexicalDirTextContent;a!==void 0&&(yt+=a)}else{const o=t.getTextContent();W(t)&&!t.isDirectionless()&&(yt+=o),$n+=o,Fe+=o}return s}if(t!==r&&i&&Xd(Xs,Ys,Tl,r,"updated"),r.updateDOM(t,s,lr)){const o=Ga(n,null);return e===null&&J(62),e.replaceChild(o,s),Va(n,null),o}if(F(t)&&F(r)){const o=r.__indent;o!==t.__indent&&Wm(s,o);const a=r.__format;a!==t.__format&&Km(s,a),i&&(iw(t,r,s),et(r)||r.isInline()||Hm(t,r,s)),Rl(r)&&(Fe+=Fn,$n+=Fn)}else{const o=r.getTextContent();if(ke(r)){const a=r.decorate(_t,lr);a!==null&&Vm(n,a)}else W(r)&&!r.isDirectionless()&&(yt+=o);Fe+=o,$n+=o}if(!Qs&&et(r)&&r.__cachedText!==$n){const o=r.getWritable();o.__cachedText=$n,r=o}return s}function Vm(n,e){let t=_t._pendingDecorators;const r=_t._decorators;if(t===null){if(r[n]===e)return;t=Ay(_t)}t[n]=e}function Lc(n){let e=n.nextSibling;return e!==null&&e===_t._blockCursorElement&&(e=e.nextSibling),e}function sw(n,e,t,r,i,s){Fe="",$n="",yt="",zm=r===Ri,Aa=null,_t=t,lr=t._config,Ys=t._nodes,Tl=_t._listeners.mutation,mu=i,yu=s,Wr=n._nodeMap,Ht=e._nodeMap,Qs=e._readOnly,_u=new Map(t._keyToDOMMap);const o=new Map;return Xs=o,Is("root",null),_t=void 0,Ys=void 0,mu=void 0,yu=void 0,Wr=void 0,Ht=void 0,lr=void 0,_u=void 0,Xs=void 0,o}function ku(n){const e=_u.get(n);return e===void 0&&J(75,n),e}function ie(n){return{type:n}}const pr=ie("SELECTION_CHANGE_COMMAND"),ow=ie("SELECTION_INSERT_CLIPBOARD_NODES_COMMAND"),Gm=ie("CLICK_COMMAND"),pn=ie("DELETE_CHARACTER_COMMAND"),ir=ie("INSERT_LINE_BREAK_COMMAND"),Zs=ie("INSERT_PARAGRAPH_COMMAND"),Rr=ie("CONTROLLED_TEXT_INSERTION_COMMAND"),ni=ie("PASTE_COMMAND"),Xa=ie("REMOVE_TEXT_COMMAND"),Di=ie("DELETE_WORD_COMMAND"),Li=ie("DELETE_LINE_COMMAND"),er=ie("FORMAT_TEXT_COMMAND"),go=ie("UNDO_COMMAND"),po=ie("REDO_COMMAND"),Zi=ie("KEYDOWN_COMMAND"),Nd=ie("KEY_ARROW_RIGHT_COMMAND"),aw=ie("MOVE_TO_END"),Md=ie("KEY_ARROW_LEFT_COMMAND"),lw=ie("MOVE_TO_START"),Ad=ie("KEY_ARROW_UP_COMMAND"),Od=ie("KEY_ARROW_DOWN_COMMAND"),ji=ie("KEY_ENTER_COMMAND"),Ym=ie("KEY_SPACE_COMMAND"),$d=ie("KEY_BACKSPACE_COMMAND"),El=ie("KEY_ESCAPE_COMMAND"),Pd=ie("KEY_DELETE_COMMAND"),Id=ie("KEY_TAB_COMMAND"),cw=ie("INSERT_TAB_COMMAND"),uw=ie("INDENT_CONTENT_COMMAND"),ih=ie("OUTDENT_CONTENT_COMMAND"),Nl=ie("DROP_COMMAND"),dw=ie("FORMAT_ELEMENT_COMMAND"),Rd=ie("DRAGSTART_COMMAND"),Xm=ie("DRAGOVER_COMMAND"),fw=ie("DRAGEND_COMMAND"),mr=ie("COPY_COMMAND"),ri=ie("CUT_COMMAND"),Qa=ie("SELECT_ALL_COMMAND"),Dd=ie("CLEAR_EDITOR_COMMAND"),Qm=ie("CLEAR_HISTORY_COMMAND"),Rs=ie("CAN_REDO_COMMAND"),Ds=ie("CAN_UNDO_COMMAND"),hw=ie("FOCUS_COMMAND"),gw=ie("BLUR_COMMAND"),pw=ie("KEY_MODIFIER_COMMAND"),En=Object.freeze({}),wu=30,xu=[["keydown",function(n,e){if(Bs=n.timeStamp,Zm=n.key,!e.isComposing()&&!Y(e,Zi,n)&&n.key!=null){if(jc&&$h(n))return Mt(e,()=>{Zo(e,Fc)}),jc=!1,void(Fc="");if(function(t){return Se(t,"ArrowRight",{shiftKey:"any"})}(n))Y(e,Nd,n);else if(function(t){return Se(t,"ArrowRight",An)}(n))Y(e,aw,n);else if(function(t){return Se(t,"ArrowLeft",{shiftKey:"any"})}(n))Y(e,Md,n);else if(function(t){return Se(t,"ArrowLeft",An)}(n))Y(e,lw,n);else if(function(t){return Se(t,"ArrowUp",{altKey:"any",shiftKey:"any"})}(n))Y(e,Ad,n);else if(function(t){return Se(t,"ArrowDown",{altKey:"any",shiftKey:"any"})}(n))Y(e,Od,n);else if(function(t){return Se(t,"Enter",{altKey:"any",ctrlKey:"any",metaKey:"any",shiftKey:!0})}(n))Us=!0,Y(e,ji,n);else if(function(t){return t.key===" "}(n))Y(e,Ym,n);else if(function(t){return dn&&Se(t,"o",{ctrlKey:!0})}(n))n.preventDefault(),Us=!0,Y(e,ir,!0);else if(function(t){return Se(t,"Enter",{altKey:"any",ctrlKey:"any",metaKey:"any"})}(n))Us=!1,Y(e,ji,n);else if(function(t){return Se(t,"Backspace",{shiftKey:"any"})||dn&&Se(t,"h",{ctrlKey:!0})}(n))$h(n)?Y(e,$d,n):(n.preventDefault(),Y(e,pn,!0));else if(function(t){return t.key==="Escape"}(n))Y(e,El,n);else if(function(t){return Se(t,"Delete",{})||dn&&Se(t,"d",{ctrlKey:!0})}(n))(function(t){return t.key==="Delete"})(n)?Y(e,Pd,n):(n.preventDefault(),Y(e,pn,!1));else if(function(t){return Se(t,"Backspace",Oh)}(n))n.preventDefault(),Y(e,Di,!0);else if(function(t){return Se(t,"Delete",Oh)}(n))n.preventDefault(),Y(e,Di,!1);else if(function(t){return dn&&Se(t,"Backspace",{metaKey:!0})}(n))n.preventDefault(),Y(e,Li,!0);else if(function(t){return dn&&(Se(t,"Delete",{metaKey:!0})||Se(t,"k",{ctrlKey:!0}))}(n))n.preventDefault(),Y(e,Li,!1);else if(function(t){return Se(t,"b",An)}(n))n.preventDefault(),Y(e,er,"bold");else if(function(t){return Se(t,"u",An)}(n))n.preventDefault(),Y(e,er,"underline");else if(function(t){return Se(t,"i",An)}(n))n.preventDefault(),Y(e,er,"italic");else if(function(t){return Se(t,"Tab",{shiftKey:"any"})}(n))Y(e,Id,n);else if(function(t){return Se(t,"z",An)}(n))n.preventDefault(),Y(e,go,void 0);else if(function(t){return dn?Se(t,"z",{metaKey:!0,shiftKey:!0}):Se(t,"y",{ctrlKey:!0})||Se(t,"z",{ctrlKey:!0,shiftKey:!0})}(n))n.preventDefault(),Y(e,po,void 0);else{const t=e._editorState._selection;t===null||q(t)?Ph(n)&&(n.preventDefault(),Y(e,Qa,n)):function(r){return Se(r,"c",An)}(n)?(n.preventDefault(),Y(e,mr,n)):function(r){return Se(r,"x",An)}(n)?(n.preventDefault(),Y(e,ri,n)):Ph(n)&&(n.preventDefault(),Y(e,Qa,n))}(function(t){return t.ctrlKey||t.shiftKey||t.altKey||t.metaKey})(n)&&Y(e,pw,n)}}],["pointerdown",function(n,e){const t=n.target,r=n.pointerType;oi(t)&&r!=="touch"&&r!=="pen"&&n.button===0&&Mt(e,()=>{Nh(t)||(Su=!0)})}],["compositionstart",function(n,e){Mt(e,()=>{const t=K();if(q(t)&&!e.isComposing()){const r=t.anchor,i=t.anchor.getNode();Ze(r.key),(n.timeStamp<Bs+wu||r.type==="element"||!t.isCollapsed()||i.getFormat()!==t.format||W(i)&&i.getStyle()!==t.style)&&Y(e,Rr,Bk)}})}],["compositionend",function(n,e){Ur?Ns=!0:Ii||!Vs&&!Wa?Mt(e,()=>{Zo(e,n.data)}):(jc=!0,Fc=n.data)}],["input",function(n,e){n.stopPropagation(),Mt(e,()=>{if(Ne(n.target)&&Nh(n.target))return;const t=K(),r=n.data,i=iy(n);if(r!=null&&q(t)&&ny(t,i,r,n.timeStamp,!1)){Ns&&(Zo(e,r),Ns=!1);const s=t.anchor.getNode(),o=Yt(Ft(e));if(o===null)return;const a=t.isBackward(),l=a?t.anchor.offset:t.focus.offset,c=a?t.focus.offset:t.anchor.offset;za&&!t.isCollapsed()&&W(s)&&o.anchorNode!==null&&s.getTextContent().slice(0,l)+r+s.getTextContent().slice(l+c)===Iy(o.anchorNode)||Y(e,Rr,r);const u=r.length;Ur&&u>1&&n.inputType==="insertCompositionText"&&!e.isComposing()&&(t.anchor.offset-=u),Vs||Ii||Wa||!e.isComposing()||(Bs=0,Ze(null))}else Gd(!1,e,r!==null?r:void 0),Ns&&(Zo(e,r||void 0),Ns=!1);(function(){Qe();const s=Pe();Lm(s)})()},{event:n}),Ci=null}],["click",function(n,e){Mt(e,()=>{const t=K(),r=Yt(Ft(e)),i=ts();if(r){if(q(t)){const s=t.anchor,o=s.getNode();if(s.type==="element"&&s.offset===0&&t.isCollapsed()&&!et(o)&&ye().getChildrenSize()===1&&o.getTopLevelElementOrThrow().isEmpty()&&i!==null&&t.is(i))r.removeAllRanges(),t.dirty=!0;else if(n.detail===3&&!t.isCollapsed()&&o!==t.focus.getNode()){const a=function(l,c){let u=l;for(;u!==ye()&&u!=null;){if(c(u))return u;u=u.getParent()}return null}(o,l=>F(l)&&!l.isInline());F(a)&&a.select(0)}}else if(n.pointerType==="touch"||n.pointerType==="pen"){const s=r.anchorNode;(Ne(s)||Kn(s))&&it(jd(i,r,e,n))}}Y(e,Gm,n)})}],["cut",En],["copy",En],["dragstart",En],["dragover",En],["dragend",En],["paste",En],["focus",En],["blur",En],["drop",En]];za&&xu.push(["beforeinput",(n,e)=>function(t,r){const i=t.inputType,s=iy(t);i==="deleteCompositionText"||Ur&&Dy(r)||i!=="insertCompositionText"&&Mt(r,()=>{const o=K();if(i==="deleteContentBackward"){if(o===null){const h=ts();if(!q(h))return;it(h.clone())}if(q(o)){const h=o.anchor.key===o.focus.key;if(a=t.timeStamp,Zm==="MediaLast"&&a<Bs+wu&&r.isComposing()&&h){if(Ze(null),Bs=0,setTimeout(()=>{Mt(r,()=>{Ze(null)})},wu),q(o)){const p=o.anchor.getNode();p.markDirty(),W(p)||J(142),ry(o,p)}}else{Ze(null),t.preventDefault();const p=o.anchor.getNode(),m=p.getTextContent(),y=p.canInsertTextAfter(),b=o.anchor.offset===0&&o.focus.offset===m.length;let _=Hf&&h&&!b&&y;if(_&&o.isCollapsed()&&(_=!ke(Ou(o.anchor,!0))),!_){Y(r,pn,!0);const w=K();Hf&&q(w)&&w.isCollapsed()&&(Ir=w,setTimeout(()=>Ir=null))}}return}}var a;if(!q(o))return;const l=t.data;Ci!==null&&Gd(!1,r,Ci),o.dirty&&Ci===null||!o.isCollapsed()||et(o.anchor.getNode())||s===null||o.applyDOMRange(s),Ci=null;const c=o.anchor,u=o.focus,f=c.getNode(),d=u.getNode();if(i!=="insertText"&&i!=="insertTranspose")switch(t.preventDefault(),i){case"insertFromYank":case"insertFromDrop":case"insertReplacementText":Y(r,Rr,t);break;case"insertFromComposition":Ze(null),Y(r,Rr,t);break;case"insertLineBreak":Ze(null),Y(r,ir,!1);break;case"insertParagraph":Ze(null),Us&&!Ii?(Us=!1,Y(r,ir,!1)):Y(r,Zs,void 0);break;case"insertFromPaste":case"insertFromPasteAsQuotation":Y(r,ni,t);break;case"deleteByComposition":(function(h,p){return h!==p||F(h)||F(p)||!jr(h)||!jr(p)})(f,d)&&Y(r,Xa,t);break;case"deleteByDrag":case"deleteByCut":Y(r,Xa,t);break;case"deleteContent":Y(r,pn,!1);break;case"deleteWordBackward":Y(r,Di,!0);break;case"deleteWordForward":Y(r,Di,!1);break;case"deleteHardLineBackward":case"deleteSoftLineBackward":Y(r,Li,!0);break;case"deleteContentForward":case"deleteHardLineForward":case"deleteSoftLineForward":Y(r,Li,!1);break;case"formatStrikeThrough":Y(r,er,"strikethrough");break;case"formatBold":Y(r,er,"bold");break;case"formatItalic":Y(r,er,"italic");break;case"formatUnderline":Y(r,er,"underline");break;case"historyUndo":Y(r,go,void 0);break;case"historyRedo":Y(r,po,void 0)}else{if(l===`
`)t.preventDefault(),Y(r,ir,!1);else if(l===Fn)t.preventDefault(),Y(r,Zs,void 0);else if(l==null&&t.dataTransfer){const h=t.dataTransfer.getData("text/plain");t.preventDefault(),o.insertRawText(h)}else l!=null&&ny(o,s,l,t.timeStamp,!0)?(t.preventDefault(),Y(r,Rr,l)):Ci=l;ey=t.timeStamp}})}(n,e)]);let Bs=0,Zm=null,ey=0,Ci=null;const Za=new WeakMap;let Cu=!1,Su=!1,Us=!1,Ns=!1,jc=!1,Fc="",Ir=null,ty=[0,"",0,"root",0];function ny(n,e,t,r,i){const s=n.anchor,o=n.focus,a=s.getNode(),l=Pe(),c=Yt(Ft(l)),u=c!==null?c.anchorNode:null,f=s.key,d=l.getElementByKey(f),h=t.length;return f!==o.key||!W(a)||(!i&&(!za||ey<r+50)||a.isDirty()&&h<2||$y(t))&&s.offset!==o.offset&&!a.isComposing()||On(a)||a.isDirty()&&h>1||(i||!za)&&d!==null&&!a.isComposing()&&u!==Fi(d)||c!==null&&e!==null&&(!e.collapsed||e.startContainer!==c.anchorNode||e.startOffset!==c.anchorOffset)||a.getFormat()!==n.format||a.getStyle()!==n.style||function(p,m){if(m.isSegmented())return!0;if(!p.isCollapsed())return!1;const y=p.anchor.offset,b=m.getParentOrThrow(),_=jr(m);return y===0?!m.canInsertTextBefore()||!b.canInsertTextBefore()&&!m.isComposing()||_||function(w){const T=w.getPreviousSibling();return(W(T)||F(T)&&T.isInline())&&!T.canInsertTextAfter()}(m):y===m.getTextContentSize()&&(!m.canInsertTextAfter()||!b.canInsertTextAfter()&&!m.isComposing()||_)}(n,a)}function sh(n,e){return Kn(n)&&n.nodeValue!==null&&e!==0&&e!==n.nodeValue.length}function oh(n,e,t){const{anchorNode:r,anchorOffset:i,focusNode:s,focusOffset:o}=n;Cu&&(Cu=!1,sh(r,i)&&sh(s,o)&&!Ir)||Mt(e,()=>{if(!t)return void it(null);if(!vo(e,r,s))return;let a=K();if(Ir&&q(a)&&a.isCollapsed()){const l=a.anchor,c=Ir.anchor;(l.key===c.key&&l.offset===c.offset+1||l.offset===1&&c.getNode().is(l.getNode().getPreviousSibling()))&&(a=Ir.clone(),it(a))}if(Ir=null,q(a)){const l=a.anchor,c=l.getNode();if(a.isCollapsed()){n.type==="Range"&&n.anchorNode===n.focusNode&&(a.dirty=!0);const u=Ft(e).event,f=u?u.timeStamp:performance.now(),[d,h,p,m,y]=ty,b=ye(),_=e.isComposing()===!1&&b.getTextContent()==="";if(f<y+200&&l.offset===p&&l.key===m)Oa(a,d,h);else if(l.type==="text")W(c)||J(141),ry(a,c);else if(l.type==="element"&&!_){F(c)||J(259);const w=l.getNode();w.isEmpty()?function(T,I){const M=I.getTextFormat(),D=I.getTextStyle();Oa(T,M,D)}(a,w):Oa(a,0,"")}}else{const u=l.key,f=a.focus.key,d=a.getNodes(),h=d.length,p=a.isBackward(),m=p?o:i,y=p?i:o,b=p?f:u,_=p?u:f;let w=qk,T=!1;for(let I=0;I<h;I++){const M=d[I],D=M.getTextContentSize();if(W(M)&&D!==0&&!(I===0&&M.__key===b&&m===D||I===h-1&&M.__key===_&&y===0)&&(T=!0,w&=M.getFormat(),w===0))break}a.format=T?w:0}}Y(e,pr,void 0)})}function Oa(n,e,t){n.format===e&&n.style===t||(n.format=e,n.style=t,n.dirty=!0)}function ry(n,e){Oa(n,e.getFormat(),e.getStyle())}function iy(n){if(!n.getTargetRanges)return null;const e=n.getTargetRanges();return e.length===0?null:e[0]}function Zo(n,e){const t=n._compositionKey;if(Ze(null),t!==null&&e!=null){if(e===""){const r=ce(t),i=Fi(n.getElementByKey(t));return void(i!==null&&i.nodeValue!==null&&W(r)&&Yd(r,i.nodeValue,null,null,!0))}if(e[e.length-1]===`
`){const r=K();if(q(r)){const i=r.focus;return r.anchor.set(i.key,i.offset,i.type),void Y(n,ji,null)}}}Gd(!0,n,e)}function sy(n){let e=n.__lexicalEventHandles;return e===void 0&&(e=[],n.__lexicalEventHandles=e),e}const Ni=new Map;function oy(n){const e=Hw(n.target);if(e===null)return;const t=Ny(e.anchorNode);if(t===null)return;Su&&(Su=!1,Mt(t,()=>{const l=ts(),c=e.anchorNode;(Ne(c)||Kn(c))&&it(jd(l,e,t,n))}));const r=Vd(t),i=r[r.length-1],s=i._key,o=Ni.get(s),a=o||i;a!==t&&oh(e,a,!1),oh(e,t,!0),t!==i?Ni.set(s,t):o&&Ni.delete(s)}function ah(n){n._lexicalHandled=!0}function lh(n){return n._lexicalHandled===!0}function mw(n){const e=n.ownerDocument,t=Za.get(e);if(t===void 0)return;const r=t-1;r>=0||J(164),Za.set(e,r),r===0&&e.removeEventListener("selectionchange",oy);const i=Pl(n);Jd(i)?(function(o){if(o._parentEditor!==null){const a=Vd(o),l=a[a.length-1]._key;Ni.get(l)===o&&Ni.delete(l)}else Ni.delete(o._key)}(i),n.__lexicalEditor=null):i&&J(198);const s=sy(n);for(let o=0;o<s.length;o++)s[o]();n.__lexicalEventHandles=[]}function Tu(n,e,t){Qe();const r=n.__key,i=n.getParent();if(i===null)return;const s=function(a){const l=K();if(!q(l)||!F(a))return l;const{anchor:c,focus:u}=l,f=c.getNode(),d=u.getNode();return $u(f,a)&&c.set(a.__key,0,"element"),$u(d,a)&&u.set(a.__key,0,"element"),l}(n);let o=!1;if(q(s)&&e){const a=s.anchor,l=s.focus;a.key===r&&(tl(a,n,i,n.getPreviousSibling(),n.getNextSibling()),o=!0),l.key===r&&(tl(l,n,i,n.getPreviousSibling(),n.getNextSibling()),o=!0)}else mt(s)&&e&&n.isSelected()&&n.selectPrevious();if(q(s)&&e&&!o){const a=n.getIndexWithinParent();Fr(n),el(s,i,a,-1)}else Fr(n);t||vn(i)||i.canBeEmpty()||!i.isEmpty()||Tu(i,e),e&&s&&et(i)&&i.isEmpty()&&i.selectEnd()}let es=class{static getType(){const{ownNodeType:e}=ef(this);return e===void 0&&J(64,this.name),e}static clone(e){J(65,this.name)}$config(){return{}}config(e,t){const r=t.extends||Object.getPrototypeOf(this.constructor);return Object.assign(t,{extends:r,type:e}),{[e]:t}}afterCloneFrom(e){this.__key===e.__key?(this.__parent=e.__parent,this.__next=e.__next,this.__prev=e.__prev,this.__state=e.__state):e.__state&&(this.__state=e.__state.getWritable(this))}constructor(e){this.__type=this.constructor.getType(),this.__parent=null,this.__prev=null,this.__next=null,Object.defineProperty(this,"__state",{configurable:!0,enumerable:!1,value:void 0,writable:!0}),Fw(this,e)}getType(){return this.__type}isInline(){J(137,this.constructor.name)}isAttached(){let e=this.__key;for(;e!==null;){if(e==="root")return!0;const t=ce(e);if(t===null)break;e=t.__parent}return!1}isSelected(e){const t=e||K();if(t==null)return!1;const r=t.getNodes().some(i=>i.__key===this.__key);if(W(this))return r;if(q(t)&&t.anchor.type==="element"&&t.focus.type==="element"){if(t.isCollapsed())return!1;const i=this.getParent();if(ke(this)&&this.isInline()&&i){const s=t.isBackward()?t.focus:t.anchor;if(i.is(s.getNode())&&s.offset===i.getChildrenSize()&&this.is(i.getLastChild()))return!1}}return r}getKey(){return this.__key}getIndexWithinParent(){const e=this.getParent();if(e===null)return-1;let t=e.getFirstChild(),r=0;for(;t!==null;){if(this.is(t))return r;r++,t=t.getNextSibling()}return-1}getParent(){const e=this.getLatest().__parent;return e===null?null:ce(e)}getParentOrThrow(){const e=this.getParent();return e===null&&J(66,this.__key),e}getTopLevelElement(){let e=this;for(;e!==null;){const t=e.getParent();if(vn(t))return F(e)||e===this&&ke(e)||J(194),e;e=t}return null}getTopLevelElementOrThrow(){const e=this.getTopLevelElement();return e===null&&J(67,this.__key),e}getParents(){const e=[];let t=this.getParent();for(;t!==null;)e.push(t),t=t.getParent();return e}getParentKeys(){const e=[];let t=this.getParent();for(;t!==null;)e.push(t.__key),t=t.getParent();return e}getPreviousSibling(){const e=this.getLatest().__prev;return e===null?null:ce(e)}getPreviousSiblings(){const e=[],t=this.getParent();if(t===null)return e;let r=t.getFirstChild();for(;r!==null&&!r.is(this);)e.push(r),r=r.getNextSibling();return e}getNextSibling(){const e=this.getLatest().__next;return e===null?null:ce(e)}getNextSiblings(){const e=[];let t=this.getNextSibling();for(;t!==null;)e.push(t),t=t.getNextSibling();return e}getCommonAncestor(e){const t=F(this)?this:this.getParent(),r=F(e)?e:e.getParent(),i=t&&r?Ws(t,r):null;return i?i.commonAncestor:null}is(e){return e!=null&&this.__key===e.__key}isBefore(e){const t=Ws(this,e);return t!==null&&(t.type==="descendant"||(t.type==="branch"?zy(t)===-1:(t.type!=="same"&&t.type!=="ancestor"&&J(279),!1)))}isParentOf(e){const t=Ws(this,e);return t!==null&&t.type==="ancestor"}getNodesBetween(e){const t=this.isBefore(e),r=[],i=new Set;let s=this;for(;s!==null;){const o=s.__key;if(i.has(o)||(i.add(o),r.push(s)),s===e)break;const a=F(s)?t?s.getFirstChild():s.getLastChild():null;if(a!==null){s=a;continue}const l=t?s.getNextSibling():s.getPreviousSibling();if(l!==null){s=l;continue}const c=s.getParentOrThrow();if(i.has(c.__key)||r.push(c),c===e)break;let u=null,f=c;do{if(f===null&&J(68),u=t?f.getNextSibling():f.getPreviousSibling(),f=f.getParent(),f===null)break;u!==null||i.has(f.__key)||r.push(f)}while(u===null);s=u}return t||r.reverse(),r}isDirty(){const e=Pe()._dirtyLeaves;return e!==null&&e.has(this.__key)}getLatest(){const e=ce(this.__key);return e===null&&J(113),e}getWritable(){Qe();const e=yr(),t=Pe(),r=e._nodeMap,i=this.__key,s=this.getLatest(),o=t._cloneNotNeeded,a=K();if(a!==null&&a.setCachedNodes(null),o.has(i))return rl(s),s;const l=Zd(s);return o.add(i),rl(l),r.set(i,l),l}getTextContent(){return""}getTextContentSize(){return this.getTextContent().length}createDOM(e,t){J(70)}updateDOM(e,t,r){J(71)}exportDOM(e){return{element:this.createDOM(e._config,e)}}exportJSON(){const e=this.__state?this.__state.toJSON():void 0;return{type:this.__type,version:1,...e}}static importJSON(e){J(18,this.name)}updateFromJSON(e){return function(t,r){const i=t.getWritable(),s=r.$;let o=s;for(const a of Um(i).flatKeys)a in r&&(o!==void 0&&o!==s||(o={...s}),o[a]=r[a]);return(i.__state||o)&&Bm(t).updateFromJSON(o),i}(this,e)}static transform(){return null}remove(e){Tu(this,!0,e)}replace(e,t){Qe();let r=K();r!==null&&(r=r.clone()),Kc(this,e);const i=this.getLatest(),s=this.__key,o=e.__key,a=e.getWritable(),l=this.getParentOrThrow().getWritable(),c=l.__size;Fr(a);const u=i.getPreviousSibling(),f=i.getNextSibling(),d=i.__prev,h=i.__next,p=i.__parent;if(Tu(i,!1,!0),u===null?l.__first=o:u.getWritable().__next=o,a.__prev=d,f===null?l.__last=o:f.getWritable().__prev=o,a.__next=h,a.__parent=p,l.__size=c,t&&(F(this)&&F(a)||J(139),this.getChildren().forEach(m=>{a.append(m)})),q(r)){it(r);const m=r.anchor,y=r.focus;m.key===s&&fh(m,a),y.key===s&&fh(y,a)}return tr()===s&&Ze(o),a}insertAfter(e,t=!0){Qe(),Kc(this,e);const r=this.getWritable(),i=e.getWritable(),s=i.getParent(),o=K();let a=!1,l=!1;if(s!==null){const h=e.getIndexWithinParent();if(Fr(i),q(o)){const p=s.__key,m=o.anchor,y=o.focus;a=m.type==="element"&&m.key===p&&m.offset===h+1,l=y.type==="element"&&y.key===p&&y.offset===h+1}}const c=this.getNextSibling(),u=this.getParentOrThrow().getWritable(),f=i.__key,d=r.__next;if(c===null?u.__last=f:c.getWritable().__prev=f,u.__size++,r.__next=f,i.__next=d,i.__prev=r.__key,i.__parent=r.__parent,t&&q(o)){const h=this.getIndexWithinParent();el(o,u,h+1);const p=u.__key;a&&o.anchor.set(p,h+2,"element"),l&&o.focus.set(p,h+2,"element")}return e}insertBefore(e,t=!0){Qe(),Kc(this,e);const r=this.getWritable(),i=e.getWritable(),s=i.__key;Fr(i);const o=this.getPreviousSibling(),a=this.getParentOrThrow().getWritable(),l=r.__prev,c=this.getIndexWithinParent();o===null?a.__first=s:o.getWritable().__next=s,a.__size++,r.__prev=s,i.__prev=l,i.__next=r.__key,i.__parent=r.__parent;const u=K();return t&&q(u)&&el(u,this.getParentOrThrow(),c),e}isParentRequired(){return!1}createParentElementNode(){return $t()}selectStart(){return this.selectPrevious()}selectEnd(){return this.selectNext(0,0)}selectPrevious(e,t){Qe();const r=this.getPreviousSibling(),i=this.getParentOrThrow();if(r===null)return i.select(0,0);if(F(r))return r.select();if(!W(r)){const s=r.getIndexWithinParent()+1;return i.select(s,s)}return r.select(e,t)}selectNext(e,t){Qe();const r=this.getNextSibling(),i=this.getParentOrThrow();if(r===null)return i.select();if(F(r))return r.select(0,0);if(!W(r)){const s=r.getIndexWithinParent();return i.select(s,s)}return r.select(e,t)}markDirty(){this.getWritable()}reconcileObservedMutation(e,t){this.markDirty()}},mo=class ay extends es{static getType(){return"linebreak"}static clone(e){return new ay(e.__key)}constructor(e){super(e)}getTextContent(){return`
`}createDOM(){return document.createElement("br")}updateDOM(){return!1}isInline(){return!0}static importDOM(){return{br:e=>function(t){const r=t.parentElement;if(r!==null&&il(r)){const i=r.firstChild;if(i===t||i.nextSibling===t&&ea(i)){const s=r.lastChild;if(s===t||s.previousSibling===t&&ea(s))return!0}}return!1}(e)||function(t){const r=t.parentElement;if(r!==null&&il(r)){const i=r.firstChild;if(i===t||i.nextSibling===t&&ea(i))return!1;const s=r.lastChild;if(s===t||s.previousSibling===t&&ea(s))return!0}return!1}(e)?null:{conversion:yw,priority:0}}}static importJSON(e){return Kr().updateFromJSON(e)}};function yw(n){return{node:Kr()}}function Kr(){return Ae(new mo)}function Dr(n){return n instanceof mo}function ea(n){return Kn(n)&&/^( |\t|\r?\n)+$/.test(n.textContent||"")}function qc(n,e){return 16&e?"code":e&vd?"mark":32&e?"sub":64&e?"sup":null}function Bc(n,e){return 1&e?"strong":2&e?"em":"span"}function ly(n,e,t,r,i){const s=r.classList;let o=Ai(i,"base");o!==void 0&&s.add(...o),o=Ai(i,"underlineStrikethrough");let a=!1;const l=e&Ja&&e&Ha;o!==void 0&&(t&Ja&&t&Ha?(a=!0,l||s.add(...o)):l&&s.remove(...o));for(const c in ar){const u=ar[c];if(o=Ai(i,c),o!==void 0)if(t&u){if(a&&(c==="underline"||c==="strikethrough")){e&u&&s.remove(...o);continue}e&u&&(!l||c!=="underline")&&c!=="strikethrough"||s.add(...o)}else e&u&&s.remove(...o)}}function cy(n,e,t){const r=e.firstChild,i=t.isComposing(),s=n+(i?Sl:"");if(r==null)e.textContent=s;else{const o=r.nodeValue;if(o!==s)if(i||Ur){const[a,l,c]=function(u,f){const d=u.length,h=f.length;let p=0,m=0;for(;p<d&&p<h&&u[p]===f[p];)p++;for(;m+p<d&&m+p<h&&u[d-m-1]===f[h-m-1];)m++;return[p,d-p-m,f.slice(p,h-m)]}(o,s);l!==0&&r.deleteData(a,l),r.insertData(a,c)}else r.nodeValue=s}}function ch(n,e,t,r,i,s){cy(i,n,e);const o=s.theme.text;o!==void 0&&ly(0,0,r,n,o)}function ta(n,e){const t=document.createElement(e);return t.appendChild(n),t}class ft extends es{static getType(){return"text"}static clone(e){return new ft(e.__text,e.__key)}afterCloneFrom(e){super.afterCloneFrom(e),this.__text=e.__text,this.__format=e.__format,this.__style=e.__style,this.__mode=e.__mode,this.__detail=e.__detail}constructor(e="",t){super(t),this.__text=e,this.__format=0,this.__style="",this.__mode=0,this.__detail=0}getFormat(){return this.getLatest().__format}getDetail(){return this.getLatest().__detail}getMode(){const e=this.getLatest();return Jk[e.__mode]}getStyle(){return this.getLatest().__style}isToken(){return this.getLatest().__mode===1}isComposing(){return this.__key===tr()}isSegmented(){return this.getLatest().__mode===2}isDirectionless(){return!!(1&this.getLatest().__detail)}isUnmergeable(){return!!(2&this.getLatest().__detail)}hasFormat(e){const t=ar[e];return!!(this.getFormat()&t)}isSimpleText(){return this.__type==="text"&&this.__mode===0}getTextContent(){return this.getLatest().__text}getFormatFlags(e,t){return nl(this.getLatest().__format,e,t)}canHaveFormat(){return!0}isInline(){return!0}createDOM(e,t){const r=this.__format,i=qc(0,r),s=Bc(0,r),o=i===null?s:i,a=document.createElement(o);let l=a;this.hasFormat("code")&&a.setAttribute("spellcheck","false"),i!==null&&(l=document.createElement(s),a.appendChild(l)),ch(l,this,0,r,this.__text,e);const c=this.__style;return c!==""&&(a.style.cssText=c),a}updateDOM(e,t,r){const i=this.__text,s=e.__format,o=this.__format,a=qc(0,s),l=qc(0,o),c=Bc(0,s),u=Bc(0,o);if((a===null?c:a)!==(l===null?u:l))return!0;if(a===l&&c!==u){const m=t.firstChild;m==null&&J(48);const y=document.createElement(u);return ch(y,this,0,o,i,r),t.replaceChild(y,m),!1}let f=t;l!==null&&a!==null&&(f=t.firstChild,f==null&&J(49)),cy(i,f,this);const d=r.theme.text;d!==void 0&&s!==o&&ly(0,s,o,f,d);const h=e.__style,p=this.__style;return h!==p&&(t.style.cssText=p),!1}static importDOM(){return{"#text":()=>({conversion:kw,priority:0}),b:()=>({conversion:bw,priority:0}),code:()=>({conversion:Nn,priority:0}),em:()=>({conversion:Nn,priority:0}),i:()=>({conversion:Nn,priority:0}),mark:()=>({conversion:Nn,priority:0}),s:()=>({conversion:Nn,priority:0}),span:()=>({conversion:_w,priority:0}),strong:()=>({conversion:Nn,priority:0}),sub:()=>({conversion:Nn,priority:0}),sup:()=>({conversion:Nn,priority:0}),u:()=>({conversion:Nn,priority:0})}}static importJSON(e){return de().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setTextContent(e.text).setFormat(e.format).setDetail(e.detail).setMode(e.mode).setStyle(e.style)}exportDOM(e){let{element:t}=super.exportDOM(e);return Ne(t)||J(132),t.style.whiteSpace="pre-wrap",this.hasFormat("lowercase")?t.style.textTransform="lowercase":this.hasFormat("uppercase")?t.style.textTransform="uppercase":this.hasFormat("capitalize")&&(t.style.textTransform="capitalize"),this.hasFormat("bold")&&(t=ta(t,"b")),this.hasFormat("italic")&&(t=ta(t,"i")),this.hasFormat("strikethrough")&&(t=ta(t,"s")),this.hasFormat("underline")&&(t=ta(t,"u")),{element:t}}exportJSON(){return{detail:this.getDetail(),format:this.getFormat(),mode:this.getMode(),style:this.getStyle(),text:this.getTextContent(),...super.exportJSON()}}selectionTransform(e,t){}setFormat(e){const t=this.getWritable();return t.__format=typeof e=="string"?ar[e]:e,t}setDetail(e){const t=this.getWritable();return t.__detail=typeof e=="string"?Wk[e]:e,t}setStyle(e){const t=this.getWritable();return t.__style=e,t}toggleFormat(e){const t=nl(this.getFormat(),e,null);return this.setFormat(t)}toggleDirectionless(){const e=this.getWritable();return e.__detail^=1,e}toggleUnmergeable(){const e=this.getWritable();return e.__detail^=2,e}setMode(e){const t=Hk[e];if(this.__mode===t)return this;const r=this.getWritable();return r.__mode=t,r}setTextContent(e){if(this.__text===e)return this;const t=this.getWritable();return t.__text=e,t}select(e,t){Qe();let r=e,i=t;const s=K(),o=this.getTextContent(),a=this.__key;if(typeof o=="string"){const l=o.length;r===void 0&&(r=l),i===void 0&&(i=l)}else r=0,i=0;if(!q(s))return py(a,r,a,i,"text","text");{const l=tr();l!==s.anchor.key&&l!==s.focus.key||Ze(a),s.setTextNodeRange(this,r,this,i)}return s}selectStart(){return this.select(0,0)}selectEnd(){const e=this.getTextContentSize();return this.select(e,e)}spliceText(e,t,r,i){const s=this.getWritable(),o=s.__text,a=r.length;let l=e;l<0&&(l=a+l,l<0&&(l=0));const c=K();if(i&&q(c)){const f=e+a;c.setTextNodeRange(s,f,s,f)}const u=o.slice(0,l)+r+o.slice(l+t);return s.__text=u,s}canInsertTextBefore(){return!0}canInsertTextAfter(){return!0}splitText(...e){Qe();const t=this.getLatest(),r=t.getTextContent();if(r==="")return[];const i=t.__key,s=tr(),o=r.length;e.sort((A,O)=>A-O),e.push(o);const a=[],l=e.length;for(let A=0,O=0;A<o&&O<=l;O++){const B=e[O];B>A&&(a.push(r.slice(A,B)),A=B)}const c=a.length;if(c===1)return[t];const u=a[0],f=t.getParent();let d;const h=t.getFormat(),p=t.getStyle(),m=t.__detail;let y=!1,b=null,_=null;const w=K();if(q(w)){const[A,O]=w.isBackward()?[w.focus,w.anchor]:[w.anchor,w.focus];A.type==="text"&&A.key===i&&(b=A),O.type==="text"&&O.key===i&&(_=O)}t.isSegmented()?(d=de(u),d.__format=h,d.__style=p,d.__detail=m,d.__state=Qf(t,d),y=!0):d=t.setTextContent(u);const T=[d];for(let A=1;A<c;A++){const O=de(a[A]);O.__format=h,O.__style=p,O.__detail=m,O.__state=Qf(t,O);const B=O.__key;s===i&&Ze(B),T.push(O)}const I=b?b.offset:null,M=_?_.offset:null;let D=0;for(const A of T){if(!b&&!_)break;const O=D+A.getTextContentSize();if(b!==null&&I!==null&&I<=O&&I>=D&&(b.set(A.getKey(),I-D,"text"),I<O&&(b=null)),_!==null&&M!==null&&M<=O&&M>=D){_.set(A.getKey(),M-D,"text");break}D=O}if(f!==null){(function(B){const x=B.getPreviousSibling(),N=B.getNextSibling();x!==null&&rl(x),N!==null&&rl(N)})(this);const A=f.getWritable(),O=this.getIndexWithinParent();y?(A.splice(O,0,T),this.remove()):A.splice(O,1,T),q(w)&&el(w,f,O,c-1)}return T}mergeWithSibling(e){const t=e===this.getPreviousSibling();t||e===this.getNextSibling()||J(50);const r=this.__key,i=e.__key,s=this.__text,o=s.length;tr()===i&&Ze(r);const a=K();if(q(a)){const f=a.anchor,d=a.focus;f!==null&&f.key===i&&bh(f,t,r,e,o),d!==null&&d.key===i&&bh(d,t,r,e,o)}const l=e.__text,c=t?l+s:s+l;this.setTextContent(c);const u=this.getWritable();return e.remove(),u}isTextEntity(){return!1}}function _w(n){return{forChild:Ld(n.style),node:null}}function bw(n){const e=n,t=e.style.fontWeight==="normal";return{forChild:Ld(e.style,t?void 0:"bold"),node:null}}const uh=new WeakMap;function vw(n){if(!Ne(n))return!1;if(n.nodeName==="PRE")return!0;const e=n.style.whiteSpace;return typeof e=="string"&&e.startsWith("pre")}function kw(n){const e=n;n.parentElement===null&&J(129);let t=e.textContent||"";if(function(r){let i,s=r.parentNode;const o=[r];for(;s!==null&&(i=uh.get(s))===void 0&&!vw(s);)o.push(s),s=s.parentNode;const a=i===void 0?s:i;for(let l=0;l<o.length;l++)uh.set(o[l],a);return a}(e)!==null){const r=t.split(/(\r?\n|\t)/),i=[],s=r.length;for(let o=0;o<s;o++){const a=r[o];a===`
`||a===`\r
`?i.push(Kr()):a==="	"?i.push(_o()):a!==""&&i.push(de(a))}return{node:i}}if(t=t.replace(/\r/g,"").replace(/[ \t\n]+/g," "),t==="")return{node:null};if(t[0]===" "){let r=e,i=!0;for(;r!==null&&(r=dh(r,!1))!==null;){const s=r.textContent||"";if(s.length>0){/[ \t\n]$/.test(s)&&(t=t.slice(1)),i=!1;break}}i&&(t=t.slice(1))}if(t[t.length-1]===" "){let r=e,i=!0;for(;r!==null&&(r=dh(r,!0))!==null;)if((r.textContent||"").replace(/^( |\t|\r?\n)+/,"").length>0){i=!1;break}i&&(t=t.slice(0,t.length-1))}return t===""?{node:null}:{node:de(t)}}function dh(n,e){let t=n;for(;;){let r;for(;(r=e?t.nextSibling:t.previousSibling)===null;){const s=t.parentElement;if(s===null)return null;t=s}if(t=r,Ne(t)){const s=t.style.display;if(s===""&&!Ru(t)||s!==""&&!s.startsWith("inline"))return null}let i=t;for(;(i=e?t.firstChild:t.lastChild)!==null;)t=i;if(Kn(t))return t;if(t.nodeName==="BR")return null}}const ww={code:"code",em:"italic",i:"italic",mark:"highlight",s:"strikethrough",strong:"bold",sub:"subscript",sup:"superscript",u:"underline"};function Nn(n){const e=ww[n.nodeName.toLowerCase()];return e===void 0?{node:null}:{forChild:Ld(n.style,e),node:null}}function de(n=""){return Ae(new ft(n))}function W(n){return n instanceof ft}function Ld(n,e){const t=n.fontWeight,r=n.textDecoration.split(" "),i=t==="700"||t==="bold",s=r.includes("line-through"),o=n.fontStyle==="italic",a=r.includes("underline"),l=n.verticalAlign;return c=>(W(c)&&(i&&!c.hasFormat("bold")&&c.toggleFormat("bold"),s&&!c.hasFormat("strikethrough")&&c.toggleFormat("strikethrough"),o&&!c.hasFormat("italic")&&c.toggleFormat("italic"),a&&!c.hasFormat("underline")&&c.toggleFormat("underline"),l!=="sub"||c.hasFormat("subscript")||c.toggleFormat("subscript"),l!=="super"||c.hasFormat("superscript")||c.toggleFormat("superscript"),e&&!c.hasFormat(e)&&c.toggleFormat(e)),c)}class yo extends ft{static getType(){return"tab"}static clone(e){return new yo(e.__key)}constructor(e){super("	",e),this.__detail=2}static importDOM(){return null}createDOM(e){const t=super.createDOM(e),r=Ai(e.theme,"tab");return r!==void 0&&t.classList.add(...r),t}static importJSON(e){return _o().updateFromJSON(e)}setTextContent(e){return e!=="	"&&e!==""&&J(126),super.setTextContent("	")}spliceText(e,t,r,i){return r===""&&t===0||r==="	"&&t===1||J(286),this}setDetail(e){return e!==2&&J(127),this}setMode(e){return e!=="normal"&&J(128),this}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}}function _o(){return Ae(new yo)}function uy(n){return n instanceof yo}class xw{constructor(e,t,r){this._selection=null,this.key=e,this.offset=t,this.type=r}is(e){return this.key===e.key&&this.offset===e.offset&&this.type===e.type}isBefore(e){return this.key===e.key?this.offset<e.offset:Uy(gn(qn(this,"next")),gn(qn(e,"next")))<0}getNode(){const e=ce(this.key);return e===null&&J(20),e}set(e,t,r,i){const s=this._selection,o=this.key;i&&this.key===e&&this.offset===t&&this.type===r||(this.key=e,this.offset=t,this.type=r,ns()||(tr()===o&&Ze(e),s!==null&&(s.setCachedNodes(null),s.dirty=!0)))}}function St(n,e,t){return new xw(n,e,t)}function Uc(n,e){let t=e.__key,r=n.offset,i="element";if(W(e)){i="text";const s=e.getTextContentSize();r>s&&(r=s)}else if(!F(e)){const s=e.getNextSibling();if(W(s))t=s.__key,r=0,i="text";else{const o=e.getParent();o&&(t=o.__key,r=e.getIndexWithinParent()+1)}}n.set(t,r,i)}function fh(n,e){if(F(e)){const t=e.getLastDescendant();F(t)||W(t)?Uc(n,t):Uc(n,e)}else Uc(n,e)}let dy=class fy{constructor(e){this._cachedNodes=null,this._nodes=e,this.dirty=!1}getCachedNodes(){return this._cachedNodes}setCachedNodes(e){this._cachedNodes=e}is(e){if(!mt(e))return!1;const t=this._nodes,r=e._nodes;return t.size===r.size&&Array.from(t).every(i=>r.has(i))}isCollapsed(){return!1}isBackward(){return!1}getStartEndPoints(){return null}add(e){this.dirty=!0,this._nodes.add(e),this._cachedNodes=null}delete(e){this.dirty=!0,this._nodes.delete(e),this._cachedNodes=null}clear(){this.dirty=!0,this._nodes.clear(),this._cachedNodes=null}has(e){return this._nodes.has(e)}clone(){return new fy(new Set(this._nodes))}extract(){return this.getNodes()}insertRawText(e){}insertText(){}insertNodes(e){const t=this.getNodes(),r=t.length,i=t[r-1];let s;if(W(i))s=i.select();else{const o=i.getIndexWithinParent()+1;s=i.getParentOrThrow().select(o,o)}s.insertNodes(e);for(let o=0;o<r;o++)t[o].remove()}getNodes(){const e=this._cachedNodes;if(e!==null)return e;const t=this._nodes,r=[];for(const i of t){const s=ce(i);s!==null&&r.push(s)}return ns()||(this._cachedNodes=r),r}getTextContent(){const e=this.getNodes();let t="";for(let r=0;r<e.length;r++)t+=e[r].getTextContent();return t}deleteNodes(){const e=this.getNodes();if((K()||ts())===this&&e[0]){const t=Be(e[0],"next");ox(ur(t,t))}for(const t of e)t.remove()}};function q(n){return n instanceof ii}class ii{constructor(e,t,r,i){this.anchor=e,this.focus=t,e._selection=this,t._selection=this,this._cachedNodes=null,this.format=r,this.style=i,this.dirty=!1}getCachedNodes(){return this._cachedNodes}setCachedNodes(e){this._cachedNodes=e}is(e){return!!q(e)&&this.anchor.is(e.anchor)&&this.focus.is(e.focus)&&this.format===e.format&&this.style===e.style}isCollapsed(){return this.anchor.is(this.focus)}getNodes(){const e=this._cachedNodes;if(e!==null)return e;const t=function(r){const i=[],[s,o]=r.getTextSlices();s&&i.push(s.caret.origin);const a=new Set,l=new Set;for(const c of r)if(Jt(c)){const{origin:u}=c;i.length===0?a.add(u):(l.add(u),i.push(u))}else{const{origin:u}=c;F(u)&&l.has(u)||i.push(u)}if(o&&i.push(o.caret.origin),Hr(r.focus)&&F(r.focus.origin)&&r.focus.getNodeAtCaret()===null)for(let c=Xt(r.focus.origin,"previous");Jt(c)&&a.has(c.origin)&&!c.origin.isEmpty()&&c.origin.is(i[i.length-1]);c=eo(c))a.delete(c.origin),i.pop();for(;i.length>1;){const c=i[i.length-1];if(!F(c)||l.has(c)||c.isEmpty()||a.has(c))break;i.pop()}if(i.length===0&&r.isCollapsed()){const c=gn(r.anchor),u=gn(r.anchor.getFlipped()),f=h=>sr(h)?h.origin:h.getNodeAtCaret(),d=f(c)||f(u)||(r.anchor.getNodeAtCaret()?c.origin:u.origin);i.push(d)}return i}(Ky(Fh(this),"next"));return ns()||(this._cachedNodes=t),t}setTextNodeRange(e,t,r,i){this.anchor.set(e.__key,t,"text"),this.focus.set(r.__key,i,"text")}getTextContent(){const e=this.getNodes();if(e.length===0)return"";const t=e[0],r=e[e.length-1],i=this.anchor,s=this.focus,o=i.isBefore(s),[a,l]=Eu(this);let c="",u=!0;for(let f=0;f<e.length;f++){const d=e[f];if(F(d)&&!d.isInline())u||(c+=`
`),u=!d.isEmpty();else if(u=!1,W(d)){let h=d.getTextContent();d===t?d===r?i.type==="element"&&s.type==="element"&&s.offset!==i.offset||(h=a<l?h.slice(a,l):h.slice(l,a)):h=o?h.slice(a):h.slice(l):d===r&&(h=o?h.slice(0,l):h.slice(0,a)),c+=h}else!ke(d)&&!Dr(d)||d===r&&this.isCollapsed()||(c+=d.getTextContent())}return c}applyDOMRange(e){const t=Pe(),r=t.getEditorState()._selection,i=gy(e.startContainer,e.startOffset,e.endContainer,e.endOffset,t,r);if(i===null)return;const[s,o]=i;this.anchor.set(s.key,s.offset,s.type,!0),this.focus.set(o.key,o.offset,o.type,!0),Gs(this)}clone(){const e=this.anchor,t=this.focus;return new ii(St(e.key,e.offset,e.type),St(t.key,t.offset,t.type),this.format,this.style)}toggleFormat(e){this.format=nl(this.format,e,null),this.dirty=!0}setFormat(e){this.format=e,this.dirty=!0}setStyle(e){this.style=e,this.dirty=!0}hasFormat(e){const t=ar[e];return!!(this.format&t)}insertRawText(e){const t=e.split(/(\r?\n|\t)/),r=[],i=t.length;for(let s=0;s<i;s++){const o=t[s];o===`
`||o===`\r
`?r.push(Kr()):o==="	"?r.push(_o()):r.push(de(o))}this.insertNodes(r)}insertText(e){const t=this.anchor,r=this.focus,i=this.format,s=this.style;let o=t,a=r;!this.isCollapsed()&&r.isBefore(t)&&(o=r,a=t),o.type==="element"&&function(y,b,_,w){const T=y.getNode(),I=T.getChildAtIndex(y.offset),M=de(),D=et(T)?$t().append(M):M;M.setFormat(_),M.setStyle(w),I===null?T.append(D):I.insertBefore(D),y.is(b)&&b.set(M.__key,0,"text"),y.set(M.__key,0,"text")}(o,a,i,s),a.type==="element"&&to(a,gn(qn(a,"next")));const l=o.offset;let c=a.offset;const u=this.getNodes(),f=u.length;let d=u[0];W(d)||J(26);const h=d.getTextContent().length,p=d.getParentOrThrow();let m=u[f-1];if(f===1&&a.type==="element"&&(c=h,a.set(o.key,c,"text")),this.isCollapsed()&&l===h&&(On(d)||!d.canInsertTextAfter()||!p.canInsertTextAfter()&&d.getNextSibling()===null)){let y=d.getNextSibling();if(W(y)&&y.canInsertTextBefore()&&!On(y)||(y=de(),y.setFormat(i),y.setStyle(s),p.canInsertTextAfter()?d.insertAfter(y):p.insertAfter(y)),y.select(0,0),d=y,e!=="")return void this.insertText(e)}else if(this.isCollapsed()&&l===0&&(On(d)||!d.canInsertTextBefore()||!p.canInsertTextBefore()&&d.getPreviousSibling()===null)){let y=d.getPreviousSibling();if(W(y)&&!On(y)||(y=de(),y.setFormat(i),p.canInsertTextBefore()?d.insertBefore(y):p.insertBefore(y)),y.select(),d=y,e!=="")return void this.insertText(e)}else if(d.isSegmented()&&l!==h){const y=de(d.getTextContent());y.setFormat(i),d.replace(y),d=y}else if(!this.isCollapsed()&&e!==""){const y=m.getParent();if(!p.canInsertTextBefore()||!p.canInsertTextAfter()||F(y)&&(!y.canInsertTextBefore()||!y.canInsertTextAfter()))return this.insertText(""),hy(this.anchor,this.focus,null),void this.insertText(e)}if(f===1){if(jr(d)){const w=de(e);return w.select(),void d.replace(w)}const y=d.getFormat(),b=d.getStyle();if(l!==c||y===i&&b===s){if(uy(d)){const w=de(e);return w.setFormat(i),w.setStyle(s),w.select(),void d.replace(w)}}else{if(d.getTextContent()!==""){const w=de(e);if(w.setFormat(i),w.setStyle(s),w.select(),l===0)d.insertBefore(w,!1);else{const[T]=d.splitText(l);T.insertAfter(w,!1)}return void(w.isComposing()&&this.anchor.type==="text"&&(this.anchor.offset-=e.length))}d.setFormat(i),d.setStyle(s)}const _=c-l;d=d.spliceText(l,_,e,!0),d.getTextContent()===""?d.remove():this.anchor.type==="text"&&(d.isComposing()?this.anchor.offset-=e.length:(this.format=y,this.style=b))}else{const y=new Set([...d.getParentKeys(),...m.getParentKeys()]),b=F(d)?d:d.getParentOrThrow();let _=F(m)?m:m.getParentOrThrow(),w=m;if(!b.is(_)&&_.isInline())do w=_,_=_.getParentOrThrow();while(_.isInline());if(a.type==="text"&&(c!==0||m.getTextContent()==="")||a.type==="element"&&m.getIndexWithinParent()<c)if(W(m)&&!jr(m)&&c!==m.getTextContentSize()){if(m.isSegmented()){const A=de(m.getTextContent());m.replace(A),m=A}et(a.getNode())||a.type!=="text"||(m=m.spliceText(0,c,"")),y.add(m.__key)}else{const A=m.getParentOrThrow();A.canBeEmpty()||A.getChildrenSize()!==1?m.remove():A.remove()}else y.add(m.__key);const T=_.getChildren(),I=new Set(u),M=b.is(_),D=b.isInline()&&d.getNextSibling()===null?b:d;for(let A=T.length-1;A>=0;A--){const O=T[A];if(O.is(d)||F(O)&&O.isParentOf(d))break;O.isAttached()&&(!I.has(O)||O.is(w)?M||D.insertAfter(O,!1):O.remove())}if(!M){let A=_,O=null;for(;A!==null;){const B=A.getChildren(),x=B.length;(x===0||B[x-1].is(O))&&(y.delete(A.__key),O=A),A=A.getParent()}}if(jr(d))if(l===h)d.select();else{const A=de(e);A.select(),d.replace(A)}else d=d.spliceText(l,h-l,e,!0),d.getTextContent()===""?d.remove():d.isComposing()&&this.anchor.type==="text"&&(this.anchor.offset-=e.length);for(let A=1;A<f;A++){const O=u[A],B=O.__key;y.has(B)||O.remove()}}}removeText(){const e=K()===this;Ra(this,ax(Fh(this))),e&&K()!==this&&it(this)}formatText(e,t=null){if(this.isCollapsed())return this.toggleFormat(e),void Ze(null);const r=this.getNodes(),i=[];for(const T of r)W(T)&&i.push(T);const s=T=>{r.forEach(I=>{if(F(I)){const M=I.getFormatFlags(e,T);I.setTextFormat(M)}})},o=i.length;if(o===0)return this.toggleFormat(e),Ze(null),void s(t);const a=this.anchor,l=this.focus,c=this.isBackward(),u=c?l:a,f=c?a:l;let d=0,h=i[0],p=u.type==="element"?0:u.offset;if(u.type==="text"&&p===h.getTextContentSize()&&(d=1,h=i[1],p=0),h==null)return;const m=h.getFormatFlags(e,t);s(m);const y=o-1;let b=i[y];const _=f.type==="text"?f.offset:b.getTextContentSize();if(h.is(b)){if(p===_)return;if(On(h)||p===0&&_===h.getTextContentSize())h.setFormat(m);else{const T=h.splitText(p,_),I=p===0?T[0]:T[1];I.setFormat(m),u.type==="text"&&u.set(I.__key,0,"text"),f.type==="text"&&f.set(I.__key,_-p,"text")}return void(this.format=m)}p===0||On(h)||([,h]=h.splitText(p),p=0),h.setFormat(m);const w=b.getFormatFlags(e,m);_>0&&(_===b.getTextContentSize()||On(b)||([b]=b.splitText(_)),b.setFormat(w));for(let T=d+1;T<y;T++){const I=i[T],M=I.getFormatFlags(e,w);I.setFormat(M)}u.type==="text"&&u.set(h.__key,p,"text"),f.type==="text"&&f.set(b.__key,_,"text"),this.format=m|w}insertNodes(e){if(e.length===0)return;if(this.isCollapsed()||this.removeText(),this.anchor.key==="root"){this.insertParagraph();const p=K();return q(p)||J(134),p.insertNodes(e)}const t=(this.isBackward()?this.focus:this.anchor).getNode(),r=Jc(t,Dt),i=e[e.length-1];if(F(r)&&"__language"in r){if("__language"in e[0])this.insertText(e[0].getTextContent());else{const p=zc(this);r.splice(p,0,e),i.selectEnd()}return}if(!e.some(p=>(F(p)||ke(p))&&!p.isInline())){F(r)||J(211,t.constructor.name,t.getType());const p=zc(this);return r.splice(p,0,e),void i.selectEnd()}const s=function(p){const m=$t();let y=null;for(let b=0;b<p.length;b++){const _=p[b],w=Dr(_);if(w||ke(_)&&_.isInline()||F(_)&&_.isInline()||W(_)||_.isParentRequired()){if(y===null&&(y=_.createParentElementNode(),m.append(y),w))continue;y!==null&&y.append(_)}else m.append(_),y=null}return m}(e),o=s.getLastDescendant(),a=s.getChildren(),l=!F(r)||!r.isEmpty()?this.insertParagraph():null,c=a[a.length-1];let u=a[0];var f;F(f=u)&&Dt(f)&&!f.isEmpty()&&F(r)&&(!r.isEmpty()||r.canMergeWhenEmpty())&&(F(r)||J(211,t.constructor.name,t.getType()),r.append(...u.getChildren()),u=a[1]),u&&(r===null&&J(212,t.constructor.name,t.getType()),function(p,m,y){const b=m.getParentOrThrow().getLastChild();let _=m;const w=[m];for(;_!==b;)_.getNextSibling()||J(140),_=_.getNextSibling(),w.push(_);let T=p;for(const I of w)T=T.insertAfter(I)}(r,u));const d=Jc(o,Dt);l&&F(d)&&(l.canMergeWhenEmpty()||Dt(c))&&(d.append(...l.getChildren()),l.remove()),F(r)&&r.isEmpty()&&r.remove(),o.selectEnd();const h=F(r)?r.getLastChild():null;Dr(h)&&d!==r&&h.remove()}insertParagraph(){if(this.anchor.key==="root"){const o=$t();return ye().splice(this.anchor.offset,0,[o]),o.select(),o}const e=zc(this),t=Jc(this.anchor.getNode(),Dt);F(t)||J(213);const r=t.getChildAtIndex(e),i=r?[r,...r.getNextSiblings()]:[],s=t.insertNewAfter(this,!1);return s?(s.append(...i),s.selectStart(),s):null}insertLineBreak(e){const t=Kr();if(this.insertNodes([t]),e){const r=t.getParentOrThrow(),i=t.getIndexWithinParent();r.select(i,i)}}extract(){const e=this.getNodes(),t=e.length,r=t-1,i=this.anchor,s=this.focus;let o=e[0],a=e[r];const[l,c]=Eu(this);if(t===0)return[];if(t===1){if(W(o)&&!this.isCollapsed()){const f=l>c?c:l,d=l>c?l:c,h=o.splitText(f,d),p=f===0?h[0]:h[1];return p!=null?[p]:[]}return[o]}const u=i.isBefore(s);if(W(o)){const f=u?l:c;f===o.getTextContentSize()?e.shift():f!==0&&([,o]=o.splitText(f),e[0]=o)}if(W(a)){const f=a.getTextContent().length,d=u?c:l;d===0?e.pop():d!==f&&([a]=a.splitText(d),e[r]=a)}return e}modify(e,t,r){if(vh(this,e,t,r))return;const i=e==="move",s=Pe(),o=Yt(Ft(s));if(!o)return;const a=s._blockCursorElement,l=s._rootElement,c=this.focus.getNode();if(l===null||a===null||!F(c)||c.isInline()||c.canBeEmpty()||Pu(a,s,l),this.dirty){let u=qi(s,this.anchor.key),f=qi(s,this.focus.key);this.anchor.type==="text"&&(u=Fi(u)),this.focus.type==="text"&&(f=Fi(f)),u&&f&&yy(o,u,this.anchor.offset,f,this.focus.offset)}if(function(u,f,d,h){u.modify(f,d,h)}(o,e,t?"backward":"forward",r),o.rangeCount>0){const u=o.getRangeAt(0),f=this.anchor.getNode(),d=et(f)?f:Ww(f);if(this.applyDOMRange(u),this.dirty=!0,!i){const h=this.getNodes(),p=[];let m=!1;for(let y=0;y<h.length;y++){const b=h[y];$u(b,d)?p.push(b):m=!0}if(m&&p.length>0)if(t){const y=p[0];F(y)?y.selectStart():y.getParentOrThrow().selectStart()}else{const y=p[p.length-1];F(y)?y.selectEnd():y.getParentOrThrow().selectEnd()}o.anchorNode===u.startContainer&&o.anchorOffset===u.startOffset||function(y){const b=y.focus,_=y.anchor,w=_.key,T=_.offset,I=_.type;_.set(b.key,b.offset,b.type,!0),b.set(w,T,I,!0)}(this)}}r==="lineboundary"&&vh(this,e,t,r,"decorators")}forwardDeletion(e,t,r){if(!r&&(e.type==="element"&&F(t)&&e.offset===t.getChildrenSize()||e.type==="text"&&e.offset===t.getTextContentSize())){const i=t.getParent(),s=t.getNextSibling()||(i===null?null:i.getNextSibling());if(F(s)&&s.isShadowRoot())return!0}return!1}deleteCharacter(e){const t=this.isCollapsed();if(this.isCollapsed()){const r=this.anchor;let i=r.getNode();if(this.forwardDeletion(r,i,e))return;const s=rf(qn(r,e?"previous":"next"));if(s.getTextSlices().every(a=>a===null||a.distance===0)){let a={type:"initial"};for(const l of s.iterNodeCarets("shadowRoot"))if(Jt(l)){if(!l.origin.isInline()){if(l.origin.isShadowRoot()){if(a.type==="merge-block")break;if(F(s.anchor.origin)&&s.anchor.origin.isEmpty()){const c=gn(l);Ra(this,ur(c,c)),s.anchor.origin.remove()}return}a.type!=="merge-next-block"&&a.type!=="merge-block"||(a={block:a.block,caret:l,type:"merge-block"})}}else{if(a.type==="merge-block")break;if(Hr(l)){if(F(l.origin)){if(l.origin.isInline()){if(!l.origin.isParentOf(s.anchor.origin))break}else a={block:l.origin,type:"merge-next-block"};continue}if(ke(l.origin)){if(!l.origin.isIsolated())if(a.type==="merge-next-block"&&(l.origin.isKeyboardSelectable()||!l.origin.isInline())&&F(s.anchor.origin)&&s.anchor.origin.isEmpty()){s.anchor.origin.remove();const c=my();c.add(l.origin.getKey()),it(c)}else l.origin.remove();return}break}}if(a.type==="merge-block"){const{caret:l,block:c}=a;return Ra(this,ur(!l.origin.isEmpty()&&c.isEmpty()?jl(Be(c,l.direction)):s.anchor,l)),this.removeText()}}const o=this.focus;if(this.modify("extend",e,"character"),this.isCollapsed()){if(e&&r.offset===0&&gh(this,r.getNode()))return}else{const a=o.type==="text"?o.getNode():null;if(i=r.type==="text"?r.getNode():null,a!==null&&a.isSegmented()){const l=o.offset,c=a.getTextContentSize();if(a.is(i)||e&&l!==c||!e&&l!==0)return void ph(a,e,l)}else if(i!==null&&i.isSegmented()){const l=r.offset,c=i.getTextContentSize();if(i.is(a)||e&&l!==0||!e&&l!==c)return void ph(i,e,l)}(function(l,c){const u=l.anchor,f=l.focus,d=u.getNode(),h=f.getNode();if(d===h&&u.type==="text"&&f.type==="text"){const p=u.offset,m=f.offset,y=p<m,b=y?p:m,_=y?m:p,w=_-1;b!==w&&function(T){return!($y(T)||Cw(T))}(d.getTextContent().slice(b,_))&&(c?f.set(f.key,w,f.type):u.set(u.key,w,u.type))}})(this,e)}}if(this.removeText(),e&&!t&&this.isCollapsed()&&this.anchor.type==="element"&&this.anchor.offset===0){const r=this.anchor.getNode();r.isEmpty()&&et(r.getParent())&&r.getPreviousSibling()===null&&gh(this,r)}}deleteLine(e){this.isCollapsed()&&this.modify("extend",e,"lineboundary"),this.isCollapsed()?this.deleteCharacter(e):this.removeText()}deleteWord(e){if(this.isCollapsed()){const t=this.anchor,r=t.getNode();if(this.forwardDeletion(t,r,e))return;this.modify("extend",e,"word")}this.removeText()}isBackward(){return this.focus.isBefore(this.anchor)}getStartEndPoints(){return[this.anchor,this.focus]}}function mt(n){return n instanceof dy}function hh(n){const e=n.offset;if(n.type==="text")return e;const t=n.getNode();return e===t.getChildrenSize()?t.getTextContent().length:0}function Eu(n){const e=n.getStartEndPoints();if(e===null)return[0,0];const[t,r]=e;return t.type==="element"&&r.type==="element"&&t.key===r.key&&t.offset===r.offset?[0,0]:[hh(t),hh(r)]}function gh(n,e){for(let t=e;t;t=t.getParent()){if(F(t)){if(t.collapseAtStart(n))return!0;if(vn(t))break}if(t.getPreviousSibling())break}return!1}const Cw=(()=>{try{const n=new RegExp("\\p{Emoji}","u"),e=n.test.bind(n);if(e("❤️")&&e("#️⃣")&&e("👍"))return e}catch{}return()=>!1})();function ph(n,e,t){const r=n,i=r.getTextContent().split(/(?=\s)/g),s=i.length;let o=0,a=0;for(let c=0;c<s;c++){const u=c===s-1;if(a=o,o+=i[c].length,e&&o===t||o>t||u){i.splice(c,1),u&&(a=void 0);break}}const l=i.join("").trim();l===""?r.remove():(r.setTextContent(l),r.select(a,a))}function mh(n,e,t,r){let i,s=e;if(Ne(n)){let o=!1;const a=n.childNodes,l=a.length,c=r._blockCursorElement;s===l&&(o=!0,s=l-1);let u=a[s],f=!1;if(u===c)u=a[s+1],f=!0;else if(c!==null){const d=c.parentNode;n===d&&e>Array.prototype.indexOf.call(d.children,c)&&s--}if(i=Ei(u),W(i))s=or(i,o?"next":"previous");else{let d=Ei(n);if(d===null)return null;if(F(d)){const h=r.getElementByKey(d.getKey());h===null&&J(214),[d,s]=d.getDOMSlot(h).resolveChildIndex(d,h,n,e),F(d)||J(215),o&&s>=d.getChildrenSize()&&(s=Math.max(0,d.getChildrenSize()-1));let m=d.getChildAtIndex(s);if(F(m)&&function(y,b,_){const w=y.getParent();return _===null||w===null||!w.canBeEmpty()||w!==_.getNode()}(m,0,t)){const y=o?m.getLastDescendant():m.getFirstDescendant();y===null?d=m:(m=y,d=F(m)?m:m.getParentOrThrow()),s=0}W(m)?(i=m,d=null,s=or(m,o?"next":"previous")):m!==d&&o&&!f&&(F(d)||J(216),s=Math.min(d.getChildrenSize(),s+1))}else{const h=d.getIndexWithinParent();s=e===0&&ke(d)&&Ei(n)===d?h:h+1,d=d.getParentOrThrow()}if(F(d))return St(d.__key,s,"element")}}else i=Ei(n);return W(i)?St(i.__key,or(i,s,"clamp"),"text"):null}function yh(n,e,t){const r=n.offset,i=n.getNode();if(r===0){const s=i.getPreviousSibling(),o=i.getParent();if(e){if((t||!e)&&s===null&&F(o)&&o.isInline()){const a=o.getPreviousSibling();W(a)&&n.set(a.__key,a.getTextContent().length,"text")}}else F(s)&&!t&&s.isInline()?n.set(s.__key,s.getChildrenSize(),"element"):W(s)&&n.set(s.__key,s.getTextContent().length,"text")}else if(r===i.getTextContent().length){const s=i.getNextSibling(),o=i.getParent();if(e&&F(s)&&s.isInline())n.set(s.__key,0,"element");else if((t||e)&&s===null&&F(o)&&o.isInline()&&!o.canInsertTextAfter()){const a=o.getNextSibling();W(a)&&n.set(a.__key,0,"text")}}}function hy(n,e,t){if(n.type==="text"&&e.type==="text"){const r=n.isBefore(e),i=n.is(e);yh(n,r,i),yh(e,!r,i),i&&e.set(n.key,n.offset,n.type);const s=Pe();if(s.isComposing()&&s._compositionKey!==n.key&&q(t)){const o=t.anchor,a=t.focus;n.set(o.key,o.offset,o.type,!0),e.set(a.key,a.offset,a.type,!0)}}}function gy(n,e,t,r,i,s){if(n===null||t===null||!vo(i,n,t))return null;const o=mh(n,e,q(s)?s.anchor:null,i);if(o===null)return null;const a=mh(t,r,q(s)?s.focus:null,i);if(a===null)return null;if(o.type==="element"&&a.type==="element"){const l=Ei(n),c=Ei(t);if(ke(l)&&ke(c))return null}return hy(o,a,s),[o,a]}function Nu(n){return F(n)&&!n.isInline()}function py(n,e,t,r,i,s){const o=yr(),a=new ii(St(n,e,i),St(t,r,s),0,"");return a.dirty=!0,o._selection=a,a}function bo(){const n=St("root",0,"element"),e=St("root",0,"element");return new ii(n,e,0,"")}function my(){return new dy(new Set)}function jd(n,e,t,r){const i=t._window;if(i===null)return null;const s=r||i.event,o=s?s.type:void 0,a=o==="selectionchange",l=!pu&&(a||o==="beforeinput"||o==="compositionstart"||o==="compositionend"||o==="click"&&s&&s.detail===3||o==="drop"||o===void 0);let c,u,f,d;if(q(n)&&!l)return n.clone();if(e===null)return null;if(c=e.anchorNode,u=e.focusNode,f=e.anchorOffset,d=e.focusOffset,a&&q(n)&&!vo(t,c,u))return n.clone();const h=gy(c,f,u,d,t,n);if(h===null)return null;const[p,m]=h;return new ii(p,m,q(n)?n.format:0,q(n)?n.style:"")}function K(){return yr()._selection}function ts(){return Pe()._editorState._selection}function el(n,e,t,r=1){const i=n.anchor,s=n.focus,o=i.getNode(),a=s.getNode();if(!e.is(o)&&!e.is(a))return;const l=e.__key;if(n.isCollapsed()){const c=i.offset;if(t<=c&&r>0||t<c&&r<0){const u=Math.max(0,c+r);i.set(l,u,"element"),s.set(l,u,"element"),_h(n)}}else{const c=n.isBackward(),u=c?s:i,f=u.getNode(),d=c?i:s,h=d.getNode();if(e.is(f)){const p=u.offset;(t<=p&&r>0||t<p&&r<0)&&u.set(l,Math.max(0,p+r),"element")}if(e.is(h)){const p=d.offset;(t<=p&&r>0||t<p&&r<0)&&d.set(l,Math.max(0,p+r),"element")}}_h(n)}function _h(n){const e=n.anchor,t=e.offset,r=n.focus,i=r.offset,s=e.getNode(),o=r.getNode();if(n.isCollapsed()){if(!F(s))return;const a=s.getChildrenSize(),l=t>=a,c=l?s.getChildAtIndex(a-1):s.getChildAtIndex(t);if(W(c)){let u=0;l&&(u=c.getTextContentSize()),e.set(c.__key,u,"text"),r.set(c.__key,u,"text")}}else{if(F(s)){const a=s.getChildrenSize(),l=t>=a,c=l?s.getChildAtIndex(a-1):s.getChildAtIndex(t);if(W(c)){let u=0;l&&(u=c.getTextContentSize()),e.set(c.__key,u,"text")}}if(F(o)){const a=o.getChildrenSize(),l=i>=a,c=l?o.getChildAtIndex(a-1):o.getChildAtIndex(i);if(W(c)){let u=0;l&&(u=c.getTextContentSize()),r.set(c.__key,u,"text")}}}}function tl(n,e,t,r,i){let s=null,o=0,a=null;r!==null?(s=r.__key,W(r)?(o=r.getTextContentSize(),a="text"):F(r)&&(o=r.getChildrenSize(),a="element")):i!==null&&(s=i.__key,W(i)?a="text":F(i)&&(a="element")),s!==null&&a!==null?n.set(s,o,a):(o=e.getIndexWithinParent(),o===-1&&(o=t.getChildrenSize()),n.set(t.__key,o,"element"))}function bh(n,e,t,r,i){n.type==="text"?n.set(t,n.offset+(e?0:i),"text"):n.offset>r.getIndexWithinParent()&&n.set(n.key,n.offset-1,"element")}function yy(n,e,t,r,i){try{n.setBaseAndExtent(e,t,r,i)}catch{}}function Sw(n,e,t,r,i,s,o){const a=r.anchorNode,l=r.focusNode,c=r.anchorOffset,u=r.focusOffset,f=document.activeElement;if(i.has(Ow)&&f!==s||f!==null&&Hd(f))return;if(!q(e))return void(n!==null&&vo(t,a,l)&&r.removeAllRanges());const d=e.anchor,h=e.focus,p=d.key,m=h.key,y=qi(t,p),b=qi(t,m),_=d.offset,w=h.offset,T=e.format,I=e.style,M=e.isCollapsed();let D=y,A=b,O=!1;if(d.type==="text"){D=Fi(y);const j=d.getNode();O=j.getFormat()!==T||j.getStyle()!==I}else q(n)&&n.anchor.type==="text"&&(O=!0);var B,x,N,C,R;if(h.type==="text"&&(A=Fi(b)),D!==null&&A!==null&&(M&&(n===null||O||q(n)&&(n.format!==T||n.style!==I))&&(B=T,x=I,N=_,C=p,R=performance.now(),ty=[B,x,N,C,R]),c!==_||u!==w||a!==D||l!==A||r.type==="Range"&&M||(f!==null&&s.contains(f)||s.focus({preventScroll:!0}),d.type==="element"))){if(yy(r,D,_,A,w),!i.has($w)&&e.isCollapsed()&&s!==null&&s===document.activeElement){const j=q(e)&&e.anchor.type==="element"?D.childNodes[_]||null:r.rangeCount>0?r.getRangeAt(0):null;if(j!==null){let L;if(j instanceof Text){const z=document.createRange();z.selectNode(j),L=z.getBoundingClientRect()}else L=j.getBoundingClientRect();(function(z,H,V){const G=Ly(V),ee=Qd(G);if(G===null||ee===null)return;let{top:Q,bottom:re}=H,oe=0,X=0,fe=V;for(;fe!==null;){const ve=fe===G.body;if(ve)oe=0,X=Ft(z).innerHeight;else{const ue=fe.getBoundingClientRect();oe=ue.top,X=ue.bottom}let se=0;if(Q<oe?se=-(oe-Q):re>X&&(se=re-X),se!==0)if(ve)ee.scrollBy(0,se);else{const ue=fe.scrollTop;fe.scrollTop+=se;const he=fe.scrollTop-ue;Q-=he,re-=he}if(ve)break;fe=ko(fe)}})(t,L,s)}}Cu=!0}}function Tw(n){let e=K()||ts();e===null&&(e=ye().selectEnd()),e.insertNodes(n)}function zc(n){let e=n;n.isCollapsed()||e.removeText();const t=K();q(t)&&(e=t),q(e)||J(161);const r=e.anchor;let i=r.getNode(),s=r.offset;for(;!Dt(i);){const o=i;if([i,s]=Ew(i,s),o.is(i))break}return s}function Ew(n,e){const t=n.getParent();if(!t){const i=$t();return ye().append(i),i.select(),[ye(),0]}if(W(n)){const i=n.splitText(e);if(i.length===0)return[t,n.getIndexWithinParent()];const s=e===0?0:1;return[t,i[0].getIndexWithinParent()+s]}if(!F(n)||e===0)return[t,n.getIndexWithinParent()];const r=n.getChildAtIndex(e);if(r){const i=new ii(St(n.__key,e,"element"),St(n.__key,e,"element"),0,""),s=n.insertNewAfter(i);s&&s.append(r,...r.getNextSiblings())}return[t,n.getIndexWithinParent()+1]}function vh(n,e,t,r,i="decorators-and-blocks"){if(e==="move"&&r==="character"&&!n.isCollapsed()){const[u,f]=t===n.isBackward()?[n.focus,n.anchor]:[n.anchor,n.focus];return f.set(u.key,u.offset,u.type),!0}const s=qn(n.focus,t?"previous":"next"),o=r==="lineboundary",a=e==="move";let l=s,c=i==="decorators-and-blocks";if(!Wy(l)){for(const u of l){c=!1;const{origin:f}=u;if(!ke(f)||f.isIsolated()||(l=u,!o||!f.isInline()))break}if(c)for(const u of rf(s).iterNodeCarets(e==="extend"?"shadowRoot":"root")){if(Jt(u))u.origin.isInline()||(l=u);else{if(F(u.origin))continue;ke(u.origin)&&!u.origin.isInline()&&(l=u)}break}}if(l===s)return!1;if(a&&!o&&ke(l.origin)&&l.origin.isKeyboardSelectable()){const u=my();return u.add(l.origin.getKey()),it(u),!0}return l=gn(l),a&&to(n.anchor,l),to(n.focus,l),c||!o}let Ke=null,He=null,Ct=!1,Wc=!1,$a=0;const kh={characterData:!0,childList:!0,subtree:!0};function ns(){return Ct||Ke!==null&&Ke._readOnly}function Qe(){Ct&&J(13)}function _y(){$a>99&&J(14)}function yr(){return Ke===null&&J(195,by()),Ke}function Pe(){return He===null&&J(196,by()),He}function by(){let n=0;const e=new Set,t=$l.version;if(typeof window<"u")for(const i of document.querySelectorAll("[contenteditable]")){const s=Pl(i);if(Jd(s))n++;else if(s){let o=String(s.constructor.version||"<0.17.1");o===t&&(o+=" (separately built, likely a bundler configuration issue)"),e.add(o)}}let r=` Detected on the page: ${n} compatible editor(s) with version ${t}`;return e.size&&(r+=` and incompatible editors with versions ${Array.from(e).join(", ")}`),r}function Nw(){return He}function wh(n,e,t){const r=e.__type,i=Ey(n,r);let s=t.get(r);s===void 0&&(s=Array.from(i.transforms),t.set(r,s));const o=s.length;for(let a=0;a<o&&(s[a](e),e.isAttached());a++);}function xh(n,e){return n!==void 0&&n.__key!==e&&n.isAttached()}function vy(n,e){if(!e)return;const t=n._updateTags;let r=e;Array.isArray(e)||(r=[e]);for(const i of r)t.add(i)}function ky(n){return Fd(n,Pe()._nodes)}function Fd(n,e){const t=n.type,r=e.get(t);r===void 0&&J(17,t);const i=r.klass;n.type!==i.getType()&&J(18,i.name);const s=i.importJSON(n),o=n.children;if(F(s)&&Array.isArray(o))for(let a=0;a<o.length;a++){const l=Fd(o[a],e);s.append(l)}return s}function Ch(n,e,t){const r=Ke,i=Ct,s=He;Ke=e,Ct=!0,He=n;try{return t()}finally{Ke=r,Ct=i,He=s}}function Rn(n,e){const t=n._pendingEditorState,r=n._rootElement,i=n._headless||r===null;if(t===null)return;const s=n._editorState,o=s._selection,a=t._selection,l=n._dirtyType!==zr,c=Ke,u=Ct,f=He,d=n._updating,h=n._observer;let p=null;if(n._pendingEditorState=null,n._editorState=t,!i&&l&&h!==null){He=n,Ke=t,Ct=!1,n._updating=!0;try{const M=n._dirtyType,D=n._dirtyElements,A=n._dirtyLeaves;h.disconnect(),p=sw(s,t,n,M,D,A)}catch(M){if(M instanceof Error&&n._onError(M),Wc)throw M;return Ty(n,null,r,t),jm(n),n._dirtyType=Ri,Wc=!0,Rn(n,s),void(Wc=!1)}finally{h.observe(r,kh),n._updating=d,Ke=c,Ct=u,He=f}}t._readOnly||(t._readOnly=!0);const m=n._dirtyLeaves,y=n._dirtyElements,b=n._normalizedNodes,_=n._updateTags,w=n._deferred;l&&(n._dirtyType=zr,n._cloneNotNeeded.clear(),n._dirtyLeaves=new Set,n._dirtyElements=new Map,n._normalizedNodes=new Set,n._updateTags=new Set),function(M,D){const A=M._decorators;let O=M._pendingDecorators||A;const B=D._nodeMap;let x;for(x in O)B.has(x)||(O===A&&(O=Ay(M)),delete O[x])}(n,t);const T=i?null:Yt(Ft(n));if(n._editable&&T!==null&&(l||a===null||a.dirty)&&r!==null&&!_.has(Pw)){He=n,Ke=t;try{if(h!==null&&h.disconnect(),l||a===null||a.dirty){const M=n._blockCursorElement;M!==null&&Pu(M,n,r),Sw(o,a,n,T,_,r)}(function(M,D,A){let O=M._blockCursorElement;if(q(A)&&A.isCollapsed()&&A.anchor.type==="element"&&D.contains(document.activeElement)){const B=A.anchor,x=B.getNode(),N=B.offset;let C=!1,R=null;if(N===x.getChildrenSize())Hc(x.getChildAtIndex(N-1))&&(C=!0);else{const j=x.getChildAtIndex(N);if(j!==null&&Hc(j)){const L=j.getPreviousSibling();(L===null||Hc(L))&&(C=!0,R=M.getElementByKey(j.__key))}}if(C){const j=M.getElementByKey(x.__key);return O===null&&(M._blockCursorElement=O=function(L){const z=L.theme,H=document.createElement("div");H.contentEditable="false",H.setAttribute("data-lexical-cursor","true");let V=z.blockCursor;if(V!==void 0){if(typeof V=="string"){const G=Ka(V);V=z.blockCursor=G}V!==void 0&&H.classList.add(...V)}return H}(M._config)),D.style.caretColor="transparent",void(R===null?j.appendChild(O):j.insertBefore(O,R))}}O!==null&&Pu(O,M,D)})(n,r,a)}finally{h!==null&&h.observe(r,kh),He=f,Ke=c}}p!==null&&function(M,D,A,O,B){const x=Array.from(M._listeners.mutation),N=x.length;for(let C=0;C<N;C++){const[R,j]=x[C];for(const L of j){const z=D.get(L);z!==void 0&&R(z,{dirtyLeaves:O,prevEditorState:B,updateTags:A})}}}(n,p,_,m,s),q(a)||a===null||o!==null&&o.is(a)||n.dispatchCommand(pr,void 0);const I=n._pendingDecorators;I!==null&&(n._decorators=I,n._pendingDecorators=null,zs("decorator",n,!0,I)),function(M,D,A){const O=Mh(D),B=Mh(A);O!==B&&zs("textcontent",M,!0,B)}(n,e||s,t),zs("update",n,!0,{dirtyElements:y,dirtyLeaves:m,editorState:t,mutatedNodes:p,normalizedNodes:b,prevEditorState:e||s,tags:_}),function(M,D){if(M._deferred=[],D.length!==0){const A=M._updating;M._updating=!0;try{for(let O=0;O<D.length;O++)D[O]()}finally{M._updating=A}}}(n,w),function(M){const D=M._updates;if(D.length!==0){const A=D.shift();if(A){const[O,B]=A;Ml(M,O,B)}}}(n)}function zs(n,e,t,...r){const i=e._updating;e._updating=t;try{const s=Array.from(e._listeners[n]);for(let o=0;o<s.length;o++)s[o].apply(null,r)}finally{e._updating=i}}function Sh(n,e){const t=n._updates;let r=e||!1;for(;t.length!==0;){const i=t.shift();if(i){const[s,o]=i,a=n._pendingEditorState;let l;o!==void 0&&(l=o.onUpdate,o.skipTransforms&&(r=!0),o.discrete&&(a===null&&J(191),a._flushSync=!0),l&&n._deferred.push(l),vy(n,o.tag)),a==null?Ml(n,s,o):s()}}return r}function Ml(n,e,t){const r=n._updateTags;let i,s=!1,o=!1;t!==void 0&&(i=t.onUpdate,vy(n,t.tag),s=t.skipTransforms||!1,o=t.discrete||!1),i&&n._deferred.push(i);const a=n._editorState;let l=n._pendingEditorState,c=!1;(l===null||l._readOnly)&&(l=n._pendingEditorState=xy(l||a),c=!0),l._flushSync=o;const u=Ke,f=Ct,d=He,h=n._updating;Ke=l,Ct=!1,n._updating=!0,He=n;const p=n._headless||n.getRootElement()===null;Wd(null);try{c&&(p?a._selection!==null&&(l._selection=a._selection.clone()):l._selection=function(_,w){const T=_.getEditorState()._selection,I=Yt(Ft(_));return q(T)||T==null?jd(T,I,_,w):T.clone()}(n,t&&t.event||null));const y=n._compositionKey;e(),s=Sh(n,s),function(_,w){const T=w.getEditorState()._selection,I=_._selection;if(q(I)){const M=I.anchor,D=I.focus;let A;if(M.type==="text"&&(A=M.getNode(),A.selectionTransform(T,I)),D.type==="text"){const O=D.getNode();A!==O&&O.selectionTransform(T,I)}}}(l,n),n._dirtyType!==zr&&(s?function(_,w){const T=w._dirtyLeaves,I=_._nodeMap;for(const M of T){const D=I.get(M);W(D)&&D.isAttached()&&D.isSimpleText()&&!D.isUnmergeable()&&th(D)}}(l,n):function(_,w){const T=w._dirtyLeaves,I=w._dirtyElements,M=_._nodeMap,D=tr(),A=new Map;let O=T,B=O.size,x=I,N=x.size;for(;B>0||N>0;){if(B>0){w._dirtyLeaves=new Set;for(const C of O){const R=M.get(C);W(R)&&R.isAttached()&&R.isSimpleText()&&!R.isUnmergeable()&&th(R),R!==void 0&&xh(R,D)&&wh(w,R,A),T.add(C)}if(O=w._dirtyLeaves,B=O.size,B>0){$a++;continue}}w._dirtyLeaves=new Set,w._dirtyElements=new Map,x.delete("root")&&x.set("root",!0);for(const C of x){const R=C[0],j=C[1];if(I.set(R,j),!j)continue;const L=M.get(R);L!==void 0&&xh(L,D)&&wh(w,L,A)}O=w._dirtyLeaves,B=O.size,x=w._dirtyElements,N=x.size,$a++}w._dirtyLeaves=T,w._dirtyElements=I}(l,n),Sh(n),function(_,w,T,I){const M=_._nodeMap,D=w._nodeMap,A=[];for(const[O]of I){const B=D.get(O);B!==void 0&&(B.isAttached()||(F(B)&&Rm(B,O,M,D,A,I),M.has(O)||I.delete(O),A.push(O)))}for(const O of A)D.delete(O);for(const O of T){const B=D.get(O);B===void 0||B.isAttached()||(M.has(O)||T.delete(O),D.delete(O))}}(a,l,n._dirtyLeaves,n._dirtyElements)),y!==n._compositionKey&&(l._flushSync=!0);const b=l._selection;if(q(b)){const _=l._nodeMap,w=b.anchor.key,T=b.focus.key;_.get(w)!==void 0&&_.get(T)!==void 0||J(19)}else mt(b)&&b._nodes.size===0&&(l._selection=null)}catch(y){return y instanceof Error&&n._onError(y),n._pendingEditorState=a,n._dirtyType=Ri,n._cloneNotNeeded.clear(),n._dirtyLeaves=new Set,n._dirtyElements.clear(),void Rn(n)}finally{Ke=u,Ct=f,He=d,n._updating=h,$a=0}n._dirtyType!==zr||n._deferred.length>0||function(y,b){const _=b.getEditorState()._selection,w=y._selection;if(w!==null){if(w.dirty||!w.is(_))return!0}else if(_!==null)return!0;return!1}(l,n)?l._flushSync?(l._flushSync=!1,Rn(n)):c&&Lw(()=>{Rn(n)}):(l._flushSync=!1,c&&(r.clear(),n._deferred=[],n._pendingEditorState=null))}function Mt(n,e,t){He===n&&t===void 0?e():Ml(n,e,t)}let Mw=class Pa{constructor(e,t,r){this.element=e,this.before=t||null,this.after=r||null}withBefore(e){return new Pa(this.element,e,this.after)}withAfter(e){return new Pa(this.element,this.before,e)}withElement(e){return this.element===e?this:new Pa(e,this.before,this.after)}insertChild(e){const t=this.before||this.getManagedLineBreak();return t!==null&&t.parentElement!==this.element&&J(222),this.element.insertBefore(e,t),this}removeChild(e){return e.parentElement!==this.element&&J(223),this.element.removeChild(e),this}replaceChild(e,t){return t.parentElement!==this.element&&J(224),this.element.replaceChild(e,t),this}getFirstChild(){const e=this.after?this.after.nextSibling:this.element.firstChild;return e===this.before||e===this.getManagedLineBreak()?null:e}getManagedLineBreak(){return this.element.__lexicalLineBreak||null}setManagedLineBreak(e){if(e===null)this.removeManagedLineBreak();else{const t=e==="decorator"&&(Ii||Vs);this.insertManagedLineBreak(t)}}removeManagedLineBreak(){const e=this.getManagedLineBreak();if(e){const t=this.element,r=e.nodeName==="IMG"?e.nextSibling:null;r&&t.removeChild(r),t.removeChild(e),t.__lexicalLineBreak=void 0}}insertManagedLineBreak(e){const t=this.getManagedLineBreak();if(t){if(e===(t.nodeName==="IMG"))return;this.removeManagedLineBreak()}const r=this.element,i=this.before,s=document.createElement("br");if(r.insertBefore(s,i),e){const o=document.createElement("img");o.setAttribute("data-lexical-linebreak","true"),o.style.cssText="display: inline !important; border: 0px !important; margin: 0px !important;",o.alt="",r.insertBefore(o,s),r.__lexicalLineBreak=o}else r.__lexicalLineBreak=s}getFirstChildOffset(){let e=0;for(let t=this.after;t!==null;t=t.previousSibling)e++;return e}resolveChildIndex(e,t,r,i){if(r===this.element){const l=this.getFirstChildOffset();return[e,Math.min(l+e.getChildrenSize(),Math.max(l,i))]}const s=Th(t,r);s.push(i);const o=Th(t,this.element);let a=e.getIndexWithinParent();for(let l=0;l<o.length;l++){const c=s[l],u=o[l];if(c===void 0||c<u)break;if(c>u){a+=1;break}}return[e.getParentOrThrow(),a]}};function Th(n,e){const t=[];let r=e;for(;r!==n&&r!==null;r=r.parentNode){let i=0;for(let s=r.previousSibling;s!==null;s=s.previousSibling)i++;t.push(i)}return r!==n&&J(225),t.reverse()}let gt=class extends es{constructor(e){super(e),this.__first=null,this.__last=null,this.__size=0,this.__format=0,this.__style="",this.__indent=0,this.__dir=null,this.__textFormat=0,this.__textStyle=""}afterCloneFrom(e){super.afterCloneFrom(e),this.__key===e.__key&&(this.__first=e.__first,this.__last=e.__last,this.__size=e.__size),this.__indent=e.__indent,this.__format=e.__format,this.__style=e.__style,this.__dir=e.__dir,this.__textFormat=e.__textFormat,this.__textStyle=e.__textStyle}getFormat(){return this.getLatest().__format}getFormatType(){const e=this.getFormat();return Kk[e]||""}getStyle(){return this.getLatest().__style}getIndent(){return this.getLatest().__indent}getChildren(){const e=[];let t=this.getFirstChild();for(;t!==null;)e.push(t),t=t.getNextSibling();return e}getChildrenKeys(){const e=[];let t=this.getFirstChild();for(;t!==null;)e.push(t.__key),t=t.getNextSibling();return e}getChildrenSize(){return this.getLatest().__size}isEmpty(){return this.getChildrenSize()===0}isDirty(){const e=Pe()._dirtyElements;return e!==null&&e.has(this.__key)}isLastChild(){const e=this.getLatest(),t=this.getParentOrThrow().getLastChild();return t!==null&&t.is(e)}getAllTextNodes(){const e=[];let t=this.getFirstChild();for(;t!==null;){if(W(t)&&e.push(t),F(t)){const r=t.getAllTextNodes();e.push(...r)}t=t.getNextSibling()}return e}getFirstDescendant(){let e=this.getFirstChild();for(;F(e);){const t=e.getFirstChild();if(t===null)break;e=t}return e}getLastDescendant(){let e=this.getLastChild();for(;F(e);){const t=e.getLastChild();if(t===null)break;e=t}return e}getDescendantByIndex(e){const t=this.getChildren(),r=t.length;if(e>=r){const s=t[r-1];return F(s)&&s.getLastDescendant()||s||null}const i=t[e];return F(i)&&i.getFirstDescendant()||i||null}getFirstChild(){const e=this.getLatest().__first;return e===null?null:ce(e)}getFirstChildOrThrow(){const e=this.getFirstChild();return e===null&&J(45,this.__key),e}getLastChild(){const e=this.getLatest().__last;return e===null?null:ce(e)}getLastChildOrThrow(){const e=this.getLastChild();return e===null&&J(96,this.__key),e}getChildAtIndex(e){const t=this.getChildrenSize();let r,i;if(e<t/2){for(r=this.getFirstChild(),i=0;r!==null&&i<=e;){if(i===e)return r;r=r.getNextSibling(),i++}return null}for(r=this.getLastChild(),i=t-1;r!==null&&i>=e;){if(i===e)return r;r=r.getPreviousSibling(),i--}return null}getTextContent(){let e="";const t=this.getChildren(),r=t.length;for(let i=0;i<r;i++){const s=t[i];e+=s.getTextContent(),F(s)&&i!==r-1&&!s.isInline()&&(e+=Fn)}return e}getTextContentSize(){let e=0;const t=this.getChildren(),r=t.length;for(let i=0;i<r;i++){const s=t[i];e+=s.getTextContentSize(),F(s)&&i!==r-1&&!s.isInline()&&(e+=Fn.length)}return e}getDirection(){return this.getLatest().__dir}getTextFormat(){return this.getLatest().__textFormat}hasFormat(e){if(e!==""){const t=Jf[e];return!!(this.getFormat()&t)}return!1}hasTextFormat(e){const t=ar[e];return!!(this.getTextFormat()&t)}getFormatFlags(e,t){return nl(this.getLatest().__textFormat,e,t)}getTextStyle(){return this.getLatest().__textStyle}select(e,t){Qe();const r=K();let i=e,s=t;const o=this.getChildrenSize();if(!this.canBeEmpty()){if(e===0&&t===0){const l=this.getFirstChild();if(W(l)||F(l))return l.select(0,0)}else if(!(e!==void 0&&e!==o||t!==void 0&&t!==o)){const l=this.getLastChild();if(W(l)||F(l))return l.select()}}i===void 0&&(i=o),s===void 0&&(s=o);const a=this.__key;return q(r)?(r.anchor.set(a,i,"element"),r.focus.set(a,s,"element"),r.dirty=!0,r):py(a,i,a,s,"element","element")}selectStart(){const e=this.getFirstDescendant();return e?e.selectStart():this.select()}selectEnd(){const e=this.getLastDescendant();return e?e.selectEnd():this.select()}clear(){const e=this.getWritable();return this.getChildren().forEach(t=>t.remove()),e}append(...e){return this.splice(this.getChildrenSize(),0,e)}setDirection(e){const t=this.getWritable();return t.__dir=e,t}setFormat(e){return this.getWritable().__format=e!==""?Jf[e]:0,this}setStyle(e){return this.getWritable().__style=e||"",this}setTextFormat(e){const t=this.getWritable();return t.__textFormat=e,t}setTextStyle(e){const t=this.getWritable();return t.__textStyle=e,t}setIndent(e){return this.getWritable().__indent=e,this}splice(e,t,r){const i=r.length,s=this.getChildrenSize(),o=this.getWritable();e+t<=s||J(226,String(e),String(t),String(s));const a=o.__key,l=[],c=[],u=this.getChildAtIndex(e+t);let f=null,d=s-t+i;if(e!==0)if(e===s)f=this.getLastChild();else{const p=this.getChildAtIndex(e);p!==null&&(f=p.getPreviousSibling())}if(t>0){let p=f===null?this.getFirstChild():f.getNextSibling();for(let m=0;m<t;m++){p===null&&J(100);const y=p.getNextSibling(),b=p.__key;Fr(p.getWritable()),c.push(b),p=y}}let h=f;for(let p=0;p<i;p++){const m=r[p];h!==null&&m.is(h)&&(f=h=h.getPreviousSibling());const y=m.getWritable();y.__parent===a&&d--,Fr(y);const b=m.__key;if(h===null)o.__first=b,y.__prev=null;else{const _=h.getWritable();_.__next=b,y.__prev=_.__key}m.__key===a&&J(76),y.__parent=a,l.push(b),h=m}if(e+t===s)h!==null&&(h.getWritable().__next=null,o.__last=h.__key);else if(u!==null){const p=u.getWritable();if(h!==null){const m=h.getWritable();p.__prev=h.__key,m.__next=u.__key}else p.__prev=null}if(o.__size=d,c.length){const p=K();if(q(p)){const m=new Set(c),y=new Set(l),{anchor:b,focus:_}=p;Eh(b,m,y)&&tl(b,b.getNode(),this,f,u),Eh(_,m,y)&&tl(_,_.getNode(),this,f,u),d!==0||this.canBeEmpty()||vn(this)||this.remove()}}return o}getDOMSlot(e){return new Mw(e)}exportDOM(e){const{element:t}=super.exportDOM(e);if(Ne(t)){const r=this.getIndent();r>0&&(t.style.paddingInlineStart=40*r+"px");const i=this.getDirection();i&&(t.dir=i)}return{element:t}}exportJSON(){const e={children:[],direction:this.getDirection(),format:this.getFormatType(),indent:this.getIndent(),...super.exportJSON()},t=this.getTextFormat(),r=this.getTextStyle();return t!==0&&(e.textFormat=t),r!==""&&(e.textStyle=r),e}updateFromJSON(e){return super.updateFromJSON(e).setFormat(e.format).setIndent(e.indent).setDirection(e.direction).setTextFormat(e.textFormat||0).setTextStyle(e.textStyle||"")}insertNewAfter(e,t){return null}canIndent(){return!0}collapseAtStart(e){return!1}excludeFromCopy(e){return!1}canReplaceWith(e){return!0}canInsertAfter(e){return!0}canBeEmpty(){return!0}canInsertTextBefore(){return!0}canInsertTextAfter(){return!0}isInline(){return!1}isShadowRoot(){return!1}canMergeWith(e){return!1}extractWithChild(e,t,r){return!1}canMergeWhenEmpty(){return!1}reconcileObservedMutation(e,t){const r=this.getDOMSlot(e);let i=r.getFirstChild();for(let s=this.getFirstChild();s;s=s.getNextSibling()){const o=t.getElementByKey(s.getKey());o!==null&&(i==null?(r.insertChild(o),i=o):i!==o&&r.replaceChild(o,i),i=i.nextSibling)}}};function F(n){return n instanceof gt}function Eh(n,e,t){let r=n.getNode();for(;r;){const i=r.__key;if(e.has(i)&&!t.has(i))return!0;r=r.getParent()}return!1}class _r extends es{decorate(e,t){J(47)}isIsolated(){return!1}isInline(){return!0}isKeyboardSelectable(){return!0}}function ke(n){return n instanceof _r}let qd=class wy extends gt{static getType(){return"root"}static clone(){return new wy}constructor(){super("root"),this.__cachedText=null}getTopLevelElementOrThrow(){J(51)}getTextContent(){const e=this.__cachedText;return!ns()&&Pe()._dirtyType!==zr||e===null?super.getTextContent():e}remove(){J(52)}replace(e){J(53)}insertBefore(e){J(54)}insertAfter(e){J(55)}updateDOM(e,t){return!1}splice(e,t,r){for(const i of r)F(i)||ke(i)||J(282);return super.splice(e,t,r)}static importJSON(e){return ye().updateFromJSON(e)}collapseAtStart(){return!0}};function et(n){return n instanceof qd}function xy(n){return new Al(new Map(n._nodeMap))}function Bd(){return new Al(new Map([["root",new qd]]))}function Cy(n){const e=n.exportJSON(),t=n.constructor;if(e.type!==t.getType()&&J(130,t.name),F(n)){const r=e.children;Array.isArray(r)||J(59,t.name);const i=n.getChildren();for(let s=0;s<i.length;s++){const o=Cy(i[s]);r.push(o)}}return e}class Al{constructor(e,t){this._nodeMap=e,this._selection=t||null,this._flushSync=!1,this._readOnly=!1}isEmpty(){return this._nodeMap.size===1&&this._selection===null}read(e,t){return Ch(t&&t.editor||null,this,e)}clone(e){const t=new Al(this._nodeMap,e===void 0?this._selection:e);return t._readOnly=!0,t}toJSON(){return Ch(null,this,()=>({root:Cy(ye())}))}}const Mu="historic",Aw="history-push",Lr="history-merge",Sy="paste",Ow="collaboration",$w="skip-scroll-into-view",Pw="skip-dom-selection";class Ud extends gt{static getType(){return"artificial"}createDOM(e){return document.createElement("div")}}class br extends gt{static getType(){return"paragraph"}static clone(e){return new br(e.__key)}createDOM(e){const t=document.createElement("p"),r=Ai(e.theme,"paragraph");return r!==void 0&&t.classList.add(...r),t}updateDOM(e,t,r){return!1}static importDOM(){return{p:e=>({conversion:Iw,priority:0})}}exportDOM(e){const{element:t}=super.exportDOM(e);if(Ne(t)){this.isEmpty()&&t.append(document.createElement("br"));const r=this.getFormatType();r&&(t.style.textAlign=r)}return{element:t}}static importJSON(e){return $t().updateFromJSON(e)}exportJSON(){return{...super.exportJSON(),textFormat:this.getTextFormat(),textStyle:this.getTextStyle()}}insertNewAfter(e,t){const r=$t();r.setTextFormat(e.format),r.setTextStyle(e.style);const i=this.getDirection();return r.setDirection(i),r.setFormat(this.getFormatType()),r.setStyle(this.getStyle()),this.insertAfter(r,t),r}collapseAtStart(){const e=this.getChildren();if(e.length===0||W(e[0])&&e[0].getTextContent().trim()===""){if(this.getNextSibling()!==null)return this.selectNext(),this.remove(),!0;if(this.getPreviousSibling()!==null)return this.selectPrevious(),this.remove(),!0}return!1}}function Iw(n){const e=$t();return n.style&&(e.setFormat(n.style.textAlign),Vw(n,e)),{node:e}}function $t(){return Ae(new br)}function zd(n){return n instanceof br}const ne=0,si=1,Ia=2,Ol=3,Mi=4;function Ty(n,e,t,r){const i=n._keyToDOMMap;i.clear(),n._editorState=Bd(),n._pendingEditorState=r,n._compositionKey=null,n._dirtyType=zr,n._cloneNotNeeded.clear(),n._dirtyLeaves=new Set,n._dirtyElements.clear(),n._normalizedNodes=new Set,n._updateTags=new Set,n._updates=[],n._blockCursorElement=null;const s=n._observer;s!==null&&(s.disconnect(),n._observer=null),e!==null&&(e.textContent=""),t!==null&&(t.textContent="",i.set("root",t))}function Rw(n){const e=n||{},t=Nw(),r=e.theme||{},i=n===void 0?t:e.parentEditor||null,s=e.disableEvents||!1,o=Bd(),a=e.namespace||(i!==null?i._config.namespace:Py()),l=e.editorState,c=[qd,ft,mo,yo,br,Ud,...e.nodes||[]],{onError:u,html:f}=e,d=e.editable===void 0||e.editable;let h;if(n===void 0&&t!==null)h=t._nodes;else{h=new Map;for(let m=0;m<c.length;m++){let y=c[m],b=null,_=null;if(typeof y!="function"){const D=y;y=D.replace,b=D.with,_=D.withKlass||null}const{ownNodeConfig:w}=ef(y),T=y.getType(),I=y.transform(),M=new Set;w&&w.$transform&&M.add(w.$transform),I!==null&&M.add(I),h.set(T,{exportDOM:f&&f.export?f.export.get(y):void 0,klass:y,replace:b,replaceWithKlass:_,sharedNodeState:ew(c[m]),transforms:M})}}const p=new $l(o,i,h,{disableEvents:s,namespace:a,theme:r},u||console.error,function(m,y){const b=new Map,_=new Set,w=T=>{Object.keys(T).forEach(I=>{let M=b.get(I);M===void 0&&(M=[],b.set(I,M)),M.push(T[I])})};return m.forEach(T=>{const I=T.klass.importDOM;if(I==null||_.has(I))return;_.add(I);const M=I.call(T.klass);M!==null&&w(M)}),y&&w(y),b}(h,f?f.import:void 0),d,n);return l!==void 0&&(p._pendingEditorState=l,p._dirtyType=Ri),p}class $l{constructor(e,t,r,i,s,o,a,l){this._createEditorArgs=l,this._parentEditor=t,this._rootElement=null,this._editorState=e,this._pendingEditorState=null,this._compositionKey=null,this._deferred=[],this._keyToDOMMap=new Map,this._updates=[],this._updating=!1,this._listeners={decorator:new Set,editable:new Set,mutation:new Map,root:new Set,textcontent:new Set,update:new Set},this._commands=new Map,this._config=i,this._nodes=r,this._decorators={},this._pendingDecorators=null,this._dirtyType=zr,this._cloneNotNeeded=new Set,this._dirtyLeaves=new Set,this._dirtyElements=new Map,this._normalizedNodes=new Set,this._updateTags=new Set,this._observer=null,this._key=Py(),this._onError=s,this._htmlConversions=o,this._editable=a,this._headless=t!==null&&t._headless,this._window=null,this._blockCursorElement=null}isComposing(){return this._compositionKey!=null}registerUpdateListener(e){const t=this._listeners.update;return t.add(e),()=>{t.delete(e)}}registerEditableListener(e){const t=this._listeners.editable;return t.add(e),()=>{t.delete(e)}}registerDecoratorListener(e){const t=this._listeners.decorator;return t.add(e),()=>{t.delete(e)}}registerTextContentListener(e){const t=this._listeners.textcontent;return t.add(e),()=>{t.delete(e)}}registerRootListener(e){const t=this._listeners.root;return e(this._rootElement,null),t.add(e),()=>{e(null,this._rootElement),t.delete(e)}}registerCommand(e,t,r){r===void 0&&J(35);const i=this._commands;i.has(e)||i.set(e,[new Set,new Set,new Set,new Set,new Set]);const s=i.get(e);s===void 0&&J(36,String(e));const o=s[r];return o.add(t),()=>{o.delete(t),s.every(a=>a.size===0)&&i.delete(e)}}registerMutationListener(e,t,r){const i=this.resolveRegisteredNodeAfterReplacements(this.getRegisteredNode(e)).klass,s=this._listeners.mutation;let o=s.get(t);o===void 0&&(o=new Set,s.set(t,o)),o.add(i);const a=r&&r.skipInitialization;return a!==void 0&&a||this.initializeMutationListener(t,i),()=>{o.delete(i),o.size===0&&s.delete(t)}}getRegisteredNode(e){const t=this._nodes.get(e.getType());return t===void 0&&J(37,e.name),t}resolveRegisteredNodeAfterReplacements(e){for(;e.replaceWithKlass;)e=this.getRegisteredNode(e.replaceWithKlass);return e}initializeMutationListener(e,t){const r=this._editorState,i=Dh(r).get(t.getType());if(!i)return;const s=new Map;for(const o of i.keys())s.set(o,"created");s.size>0&&e(s,{dirtyLeaves:new Set,prevEditorState:r,updateTags:new Set(["registerMutationListener"])})}registerNodeTransformToKlass(e,t){const r=this.getRegisteredNode(e);return r.transforms.add(t),r}registerNodeTransform(e,t){const r=this.registerNodeTransformToKlass(e,t),i=[r],s=r.replaceWithKlass;if(s!=null){const o=this.registerNodeTransformToKlass(s,t);i.push(o)}return function(o,a){const l=Dh(o.getEditorState()),c=[];for(const u of a){const f=l.get(u);f&&c.push(f)}c.length!==0&&o.update(()=>{for(const u of c)for(const f of u.keys()){const d=ce(f);d&&d.markDirty()}},o._pendingEditorState===null?{tag:Lr}:void 0)}(this,i.map(o=>o.klass.getType())),()=>{i.forEach(o=>o.transforms.delete(t))}}hasNode(e){return this._nodes.has(e.getType())}hasNodes(e){return e.every(this.hasNode.bind(this))}dispatchCommand(e,t){return Y(this,e,t)}getDecorators(){return this._decorators}getRootElement(){return this._rootElement}getKey(){return this._key}setRootElement(e){const t=this._rootElement;if(e!==t){const r=Ai(this._config.theme,"root"),i=this._pendingEditorState||this._editorState;if(this._rootElement=e,Ty(this,t,e,i),t!==null&&(this._config.disableEvents||mw(t),r!=null&&t.classList.remove(...r)),e!==null){const s=Qd(e),o=e.style;o.userSelect="text",o.whiteSpace="pre-wrap",o.wordBreak="break-word",e.setAttribute("data-lexical-editor","true"),this._window=s,this._dirtyType=Ri,jm(this),this._updateTags.add(Lr),Rn(this),this._config.disableEvents||function(a,l){const c=a.ownerDocument,u=Za.get(c);(u===void 0||u<1)&&c.addEventListener("selectionchange",oy),Za.set(c,(u||0)+1),a.__lexicalEditor=l;const f=sy(a);for(let d=0;d<xu.length;d++){const[h,p]=xu[d],m=typeof p=="function"?y=>{lh(y)||(ah(y),(l.isEditable()||h==="click")&&p(y,l))}:y=>{if(lh(y))return;ah(y);const b=l.isEditable();switch(h){case"cut":return b&&Y(l,ri,y);case"copy":return Y(l,mr,y);case"paste":return b&&Y(l,ni,y);case"dragstart":return b&&Y(l,Rd,y);case"dragover":return b&&Y(l,Xm,y);case"dragend":return b&&Y(l,fw,y);case"focus":return b&&Y(l,hw,y);case"blur":return b&&Y(l,gw,y);case"drop":return b&&Y(l,Nl,y)}};a.addEventListener(h,m),f.push(()=>{a.removeEventListener(h,m)})}}(e,this),r!=null&&e.classList.add(...r)}else this._window=null,this._updateTags.add(Lr),Rn(this);zs("root",this,!1,e,t)}}getElementByKey(e){return this._keyToDOMMap.get(e)||null}getEditorState(){return this._editorState}setEditorState(e,t){e.isEmpty()&&J(38);let r=e;r._readOnly&&(r=xy(e),r._selection=e._selection?e._selection.clone():null),Lm(this);const i=this._pendingEditorState,s=this._updateTags,o=t!==void 0?t.tag:null;i===null||i.isEmpty()||(o!=null&&s.add(o),Rn(this)),this._pendingEditorState=r,this._dirtyType=Ri,this._dirtyElements.set("root",!1),this._compositionKey=null,o!=null&&s.add(o),this._updating||Rn(this)}parseEditorState(e,t){return function(r,i,s){const o=Bd(),a=Ke,l=Ct,c=He,u=i._dirtyElements,f=i._dirtyLeaves,d=i._cloneNotNeeded,h=i._dirtyType;i._dirtyElements=new Map,i._dirtyLeaves=new Set,i._cloneNotNeeded=new Set,i._dirtyType=0,Ke=o,Ct=!1,He=i,Wd(null);try{const p=i._nodes;Fd(r.root,p),s&&s(),o._readOnly=!0}catch(p){p instanceof Error&&i._onError(p)}finally{i._dirtyElements=u,i._dirtyLeaves=f,i._cloneNotNeeded=d,i._dirtyType=h,Ke=a,Ct=l,He=c}return o}(typeof e=="string"?JSON.parse(e):e,this,t)}read(e){return Rn(this),this.getEditorState().read(e,{editor:this})}update(e,t){(function(r,i,s){r._updating?r._updates.push([i,s]):Ml(r,i,s)})(this,e,t)}focus(e,t={}){const r=this._rootElement;r!==null&&(r.setAttribute("autocapitalize","off"),Mt(this,()=>{const i=K(),s=ye();i!==null?i.dirty||it(i.clone()):s.getChildrenSize()!==0&&(t.defaultSelection==="rootStart"?s.selectStart():s.selectEnd()),jy("focus"),Uw(()=>{r.removeAttribute("autocapitalize"),e&&e()})}),this._pendingEditorState===null&&r.removeAttribute("autocapitalize"))}blur(){const e=this._rootElement;e!==null&&e.blur();const t=Yt(this._window);t!==null&&t.removeAllRanges()}isEditable(){return this._editable}setEditable(e){this._editable!==e&&(this._editable=e,zs("editable",this,!0,e))}toJSON(){return{editorState:this._editorState.toJSON()}}}$l.version="0.34.0+prod.esm";let Au=null;function Wd(n){Au=n}let Dw=1;function Ey(n,e){const t=Kd(n,e);return t===void 0&&J(30,e),t}function Kd(n,e){return n._nodes.get(e)}const Lw=typeof queueMicrotask=="function"?queueMicrotask:n=>{Promise.resolve().then(n)};function Nh(n){return ke(cr(n))}function Hd(n){const e=document.activeElement;if(!Ne(e))return!1;const t=e.nodeName;return ke(cr(n))&&(t==="INPUT"||t==="TEXTAREA"||e.contentEditable==="true"&&Pl(e)==null)}function vo(n,e,t){const r=n.getRootElement();try{return r!==null&&r.contains(e)&&r.contains(t)&&e!==null&&!Hd(e)&&Ny(e)===n}catch{return!1}}function Jd(n){return n instanceof $l}function Ny(n){let e=n;for(;e!=null;){const t=Pl(e);if(Jd(t))return t;e=ko(e)}return null}function Pl(n){return n?n.__lexicalEditor:null}function jr(n){return uy(n)||n.isToken()}function On(n){return jr(n)||n.isSegmented()}function Kn(n){return oi(n)&&n.nodeType===Ik}function jw(n){return oi(n)&&n.nodeType===Rk}function Fi(n){let e=n;for(;e!=null;){if(Kn(e))return e;e=e.firstChild}return null}function nl(n,e,t){const r=ar[e];if(t!==null&&(n&r)==(t&r))return n;let i=n^r;return e==="subscript"?i&=-65:e==="superscript"?i&=-33:e==="lowercase"?(i&=-513,i&=-1025):e==="uppercase"?(i&=-257,i&=-1025):e==="capitalize"&&(i&=-257,i&=-513),i}function Fw(n,e){const t=function(){const o=Au;return Au=null,o}();if((e=e||t&&t.__key)!=null)return void(n.__key=e);Qe(),_y();const r=Pe(),i=yr(),s=""+Dw++;i._nodeMap.set(s,n),F(n)?r._dirtyElements.set(s,!0):r._dirtyLeaves.add(s),r._cloneNotNeeded.add(s),r._dirtyType=$m,n.__key=s}function Fr(n){const e=n.getParent();if(e!==null){const t=n.getWritable(),r=e.getWritable(),i=n.getPreviousSibling(),s=n.getNextSibling(),o=s!==null?s.__key:null,a=i!==null?i.__key:null,l=i!==null?i.getWritable():null,c=s!==null?s.getWritable():null;i===null&&(r.__first=o),s===null&&(r.__last=a),l!==null&&(l.__next=o),c!==null&&(c.__prev=a),t.__prev=null,t.__next=null,t.__parent=null,r.__size--}}function rl(n){_y();const e=n.getLatest(),t=e.__parent,r=yr(),i=Pe(),s=r._nodeMap,o=i._dirtyElements;t!==null&&function(l,c,u){let f=l;for(;f!==null;){if(u.has(f))return;const d=c.get(f);if(d===void 0)break;u.set(f,!1),f=d.__parent}}(t,s,o);const a=e.__key;i._dirtyType=$m,F(n)?o.set(a,!0):i._dirtyLeaves.add(a)}function Ze(n){Qe();const e=Pe(),t=e._compositionKey;if(n!==t){if(e._compositionKey=n,t!==null){const r=ce(t);r!==null&&r.getWritable()}if(n!==null){const r=ce(n);r!==null&&r.getWritable()}}}function tr(){return ns()?null:Pe()._compositionKey}function ce(n,e){const t=(e||yr())._nodeMap.get(n);return t===void 0?null:t}function My(n,e){const t=Il(n,Pe());return t!==void 0?ce(t,e):null}function Il(n,e){return n[`__lexicalKey_${e._key}`]}function cr(n,e){let t=n;for(;t!=null;){const r=My(t,e);if(r!==null)return r;t=ko(t)}return null}function Ay(n){const e=n._decorators,t=Object.assign({},e);return n._pendingDecorators=t,t}function Mh(n){return n.read(()=>ye().getTextContent())}function ye(){return Oy(yr())}function Oy(n){return n._nodeMap.get("root")}function it(n){Qe();const e=yr();n!==null&&(n.dirty=!0,n.setCachedNodes(null)),e._selection=n}function Ei(n){const e=Pe(),t=function(r,i){let s=r;for(;s!=null;){const o=Il(s,i);if(o!==void 0)return o;s=ko(s)}return null}(n,e);return t===null?n===e.getRootElement()?ce("root"):null:ce(t)}function $y(n){return/[\uD800-\uDBFF][\uDC00-\uDFFF]/g.test(n)}function Vd(n){const e=[];let t=n;for(;t!==null;)e.push(t),t=t._parentEditor;return e}function Py(){return Math.random().toString(36).replace(/[^a-z]+/g,"").substring(0,5)}function Iy(n){return Kn(n)?n.nodeValue:null}function Gd(n,e,t){const r=Yt(Ft(e));if(r===null)return;const i=r.anchorNode;let{anchorOffset:s,focusOffset:o}=r;if(i!==null){let a=Iy(i);const l=cr(i);if(a!==null&&W(l)){if(a===Sl&&t){const c=t.length;a=t,s=c,o=c}a!==null&&Yd(l,a,s,o,n)}}}function Yd(n,e,t,r,i){let s=n;if(s.isAttached()&&(i||!s.isDirty())){const o=s.isComposing();let a=e;(o||i)&&e[e.length-1]===Sl&&(a=e.slice(0,-1));const l=s.getTextContent();if(i||a!==l){if(a===""){if(Ze(null),Vs||Ii||Wa)s.remove();else{const m=Pe();setTimeout(()=>{m.update(()=>{s.isAttached()&&s.remove()})},20)}return}const c=s.getParent(),u=ts(),f=s.getTextContentSize(),d=tr(),h=s.getKey();if(s.isToken()||d!==null&&h===d&&!o||q(u)&&(c!==null&&!c.canInsertTextBefore()&&u.anchor.offset===0||u.anchor.key===n.__key&&u.anchor.offset===0&&!s.canInsertTextBefore()&&!o||u.focus.key===n.__key&&u.focus.offset===f&&!s.canInsertTextAfter()&&!o))return void s.markDirty();const p=K();if(!q(p)||t===null||r===null)return void Ah(s,a,p);if(p.setTextNodeRange(s,t,s,r),s.isSegmented()){const m=de(s.getTextContent());s.replace(m),s=m}Ah(s,a,p)}}}function Ah(n,e,t){if(n.setTextContent(e),q(t)){const r=n.getKey();for(const i of["anchor","focus"]){const s=t[i];s.type==="text"&&s.key===r&&(s.offset=or(n,s.offset,"clamp"))}}}function na(n,e,t){const r=e[t]||!1;return r==="any"||r===n[t]}function qw(n,e){return na(n,e,"altKey")&&na(n,e,"ctrlKey")&&na(n,e,"shiftKey")&&na(n,e,"metaKey")}function Se(n,e,t){return qw(n,t)&&n.key.toLowerCase()===e.toLowerCase()}const An={ctrlKey:!dn,metaKey:dn},Oh={altKey:dn,ctrlKey:!dn};function $h(n){return n.key==="Backspace"}function Ph(n){return Se(n,"a",An)}function Ry(n){const e=ye();if(q(n)){const t=n.anchor,r=n.focus,i=t.getNode().getTopLevelElementOrThrow().getParentOrThrow();return t.set(i.getKey(),0,"element"),r.set(i.getKey(),i.getChildrenSize(),"element"),Gs(n),n}{const t=e.select(0,e.getChildrenSize());return it(Gs(t)),t}}function Ai(n,e){n.__lexicalClassNameCache===void 0&&(n.__lexicalClassNameCache={});const t=n.__lexicalClassNameCache,r=t[e];if(r!==void 0)return r;const i=n[e];if(typeof i=="string"){const s=Ka(i);return t[e]=s,s}return i}function Xd(n,e,t,r,i){if(t.size===0)return;const s=r.__type,o=r.__key,a=e.get(s);a===void 0&&J(33,s);const l=a.klass;let c=n.get(l);c===void 0&&(c=new Map,n.set(l,c));const u=c.get(o),f=u==="destroyed"&&i==="created";(u===void 0||f)&&c.set(o,f?"updated":i)}function Ih(n,e,t){const r=n.getParent();let i=t,s=n;return r!==null&&(e&&t===0?(i=s.getIndexWithinParent(),s=r):e||t!==s.getChildrenSize()||(i=s.getIndexWithinParent()+1,s=r)),s.getChildAtIndex(e?i-1:i)}function Ou(n,e){const t=n.offset;if(n.type==="element")return Ih(n.getNode(),e,t);{const r=n.getNode();if(e&&t===0||!e&&t===r.getTextContentSize()){const i=e?r.getPreviousSibling():r.getNextSibling();return i===null?Ih(r.getParentOrThrow(),e,r.getIndexWithinParent()+(e?0:1)):i}}return null}function Dy(n){const e=Ft(n).event,t=e&&e.inputType;return t==="insertFromPaste"||t==="insertFromPasteAsQuotation"}function Y(n,e,t){return function(r,i,s){const o=Vd(r);for(let a=4;a>=0;a--)for(let l=0;l<o.length;l++){const c=o[l],u=c._commands.get(i);if(u!==void 0){const f=u[a];if(f!==void 0){const d=Array.from(f),h=d.length;let p=!1;if(Mt(c,()=>{for(let m=0;m<h;m++)if(d[m](s,r))return void(p=!0)}),p)return p}}}return!1}(n,e,t)}function Rl(n){return!et(n)&&!n.isLastChild()&&!n.isInline()}function qi(n,e){const t=n._keyToDOMMap.get(e);return t===void 0&&J(75,e),t}function ko(n){const e=n.assignedSlot||n.parentElement;return Iu(e)?e.host:e}function Ly(n){return jw(n)?n:Ne(n)?n.ownerDocument:null}function Bw(n){return Pe()._updateTags.has(n)}function jy(n){Qe(),Pe()._updateTags.add(n)}function Uw(n){Qe(),Pe()._deferred.push(n)}function $u(n,e){let t=n.getParent();for(;t!==null;){if(t.is(e))return!0;t=t.getParent()}return!1}function Qd(n){const e=Ly(n);return e?e.defaultView:null}function Ft(n){const e=n._window;return e===null&&J(78),e}function zw(n){return F(n)&&n.isInline()||ke(n)&&n.isInline()}function Ww(n){let e=n.getParentOrThrow();for(;e!==null;){if(vn(e))return e;e=e.getParentOrThrow()}return e}function vn(n){return et(n)||F(n)&&n.isShadowRoot()}function Ae(n){const e=Pe(),t=n.getType(),r=Kd(e,t);r===void 0&&J(200,n.constructor.name,t);const{replace:i,replaceWithKlass:s}=r;if(i!==null){const o=i(n),a=o.constructor;return s!==null?o instanceof s||J(201,s.name,s.getType(),a.name,a.getType(),n.constructor.name,t):o instanceof n.constructor&&a!==n.constructor||J(202,a.name,a.getType(),n.constructor.name,t),o.__key===n.__key&&J(203,n.constructor.name,t,a.name,a.getType()),o}return n}function Kc(n,e){!et(n.getParent())||F(e)||ke(e)||J(99)}function Kw(n){const e=ce(n);return e===null&&J(63,n),e}function Hc(n){return(ke(n)||F(n)&&!n.canBeEmpty())&&!n.isInline()}function Pu(n,e,t){t.style.removeProperty("caret-color"),e._blockCursorElement=null;const r=n.parentElement;r!==null&&r.removeChild(n)}function Yt(n){return tn?(n||window).getSelection():null}function Hw(n){const e=Qd(n);return e?e.getSelection():null}function Fy(n){return Ne(n)&&n.tagName==="A"}function Ne(n){return oi(n)&&n.nodeType===Pk}function oi(n){return typeof n=="object"&&n!==null&&"nodeType"in n&&typeof n.nodeType=="number"}function Iu(n){return oi(n)&&n.nodeType===Dk}function Ru(n){const e=new RegExp(/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|mark|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var|#text)$/,"i");return n.nodeName.match(e)!==null}function il(n){const e=new RegExp(/^(address|article|aside|blockquote|canvas|dd|div|dl|dt|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hr|li|main|nav|noscript|ol|p|pre|section|table|td|tfoot|ul|video)$/,"i");return n.nodeName.match(e)!==null}function Dt(n){if(ke(n)&&!n.isInline())return!0;if(!F(n)||vn(n))return!1;const e=n.getFirstChild(),t=e===null||Dr(e)||W(e)||e.isInline();return!n.isInline()&&n.canBeEmpty()!==!1&&t}function Jc(n,e){let t=n;for(;t!==null&&t.getParent()!==null&&!e(t);)t=t.getParentOrThrow();return e(t)?t:null}function Dl(){return Pe()}const Rh=new WeakMap,Jw=new Map;function Dh(n){if(!n._readOnly&&n.isEmpty())return Jw;n._readOnly||J(192);let e=Rh.get(n);return e||(e=function(t){const r=new Map;for(const[i,s]of t._nodeMap){const o=s.__type;let a=r.get(o);a||(a=new Map,r.set(o,a)),a.set(i,s)}return r}(n),Rh.set(n,e)),e}function Zd(n){const e=n.constructor.clone(n);return e.afterCloneFrom(n),e}function Vw(n,e){const t=parseInt(n.style.paddingInlineStart,10)||0,r=Math.round(t/40);e.setIndent(r)}function Gw(n){n.__lexicalUnmanaged=!0}function Yw(n){return n.__lexicalUnmanaged===!0}function Ms(n,e){return function(t,r){return Object.prototype.hasOwnProperty.call(t,r)}(n,e)&&n[e]!==es[e]}function ef(n){const e=Vf in n.prototype?n.prototype[Vf]():void 0,t=function(o){return o===_r||o===gt||o===es}(n),r=!t&&Ms(n,"getType")?n.getType():void 0;let i,s=r;if(e)if(r)i=e[r];else for(const[o,a]of Object.entries(e))s=o,i=a;if(!t&&s&&(Ms(n,"getType")||(n.getType=()=>s),Ms(n,"clone")||(n.clone=o=>(Wd(o),new n)),Ms(n,"importJSON")||(n.importJSON=i&&i.$importJSON||(o=>new n().updateFromJSON(o))),!Ms(n,"importDOM")&&i)){const{importDOM:o}=i;o&&(n.importDOM=()=>o)}return{ownNodeConfig:i,ownNodeType:s}}const Xw={next:"previous",previous:"next"};let tf=class{constructor(e){this.origin=e}[Symbol.iterator](){return Ll({hasNext:Hr,initial:this.getAdjacentCaret(),map:e=>e,step:e=>e.getAdjacentCaret()})}getAdjacentCaret(){return Be(this.getNodeAtCaret(),this.direction)}getSiblingCaret(){return Be(this.origin,this.direction)}remove(){const e=this.getNodeAtCaret();return e&&e.remove(),this}replaceOrInsert(e,t){const r=this.getNodeAtCaret();return e.is(this.origin)||e.is(r)||(r===null?this.insert(e):r.replace(e,t)),this}splice(e,t,r="next"){const i=r===this.direction?t:Array.from(t).reverse();let s=this;const o=this.getParentAtCaret(),a=new Map;for(let l=s.getAdjacentCaret();l!==null&&a.size<e;l=l.getAdjacentCaret()){const c=l.origin.getWritable();a.set(c.getKey(),c)}for(const l of i){if(a.size>0){const c=s.getNodeAtCaret();if(c){if(a.delete(c.getKey()),a.delete(l.getKey()),!(c.is(l)||s.origin.is(l))){const u=l.getParent();u&&u.is(o)&&l.remove(),c.replace(l)}}else c===null&&J(263,Array.from(a).join(" "))}else s.insert(l);s=Be(l,this.direction)}for(const l of a.values())l.remove();return this}},Du=class qy extends tf{constructor(){super(...arguments);It(this,"type","child")}getLatest(){const t=this.origin.getLatest();return t===this.origin?this:Xt(t,this.direction)}getParentCaret(t="root"){return Be(nf(this.getParentAtCaret(),t),this.direction)}getFlipped(){const t=rs(this.direction);return Be(this.getNodeAtCaret(),t)||Xt(this.origin,t)}getParentAtCaret(){return this.origin}getChildCaret(){return this}isSameNodeCaret(t){return t instanceof qy&&this.direction===t.direction&&this.origin.is(t.origin)}isSamePointCaret(t){return this.isSameNodeCaret(t)}};const Qw={root:et,shadowRoot:vn};function rs(n){return Xw[n]}function nf(n,e="root"){return Qw[e](n)?null:n}let sl=class Lu extends tf{constructor(){super(...arguments);It(this,"type","sibling")}getLatest(){const t=this.origin.getLatest();return t===this.origin?this:Be(t,this.direction)}getSiblingCaret(){return this}getParentAtCaret(){return this.origin.getParent()}getChildCaret(){return F(this.origin)?Xt(this.origin,this.direction):null}getParentCaret(t="root"){return Be(nf(this.getParentAtCaret(),t),this.direction)}getFlipped(){const t=rs(this.direction);return Be(this.getNodeAtCaret(),t)||Xt(this.origin.getParentOrThrow(),t)}isSamePointCaret(t){return t instanceof Lu&&this.direction===t.direction&&this.origin.is(t.origin)}isSameNodeCaret(t){return(t instanceof Lu||t instanceof ol)&&this.direction===t.direction&&this.origin.is(t.origin)}},ol=class ju extends tf{constructor(t,r){super(t);It(this,"type","text");this.offset=r}getLatest(){const t=this.origin.getLatest();return t===this.origin?this:Jr(t,this.direction,this.offset)}getParentAtCaret(){return this.origin.getParent()}getChildCaret(){return null}getParentCaret(t="root"){return Be(nf(this.getParentAtCaret(),t),this.direction)}getFlipped(){return Jr(this.origin,rs(this.direction),this.offset)}isSamePointCaret(t){return t instanceof ju&&this.direction===t.direction&&this.origin.is(t.origin)&&this.offset===t.offset}isSameNodeCaret(t){return(t instanceof sl||t instanceof ju)&&this.direction===t.direction&&this.origin.is(t.origin)}getSiblingCaret(){return Be(this.origin,this.direction)}};function sr(n){return n instanceof ol}function Hr(n){return n instanceof sl}function Jt(n){return n instanceof Du}const Zw={next:class extends ol{constructor(){super(...arguments);It(this,"direction","next")}getNodeAtCaret(){return this.origin.getNextSibling()}insert(e){return this.origin.insertAfter(e),this}},previous:class extends ol{constructor(){super(...arguments);It(this,"direction","previous")}getNodeAtCaret(){return this.origin.getPreviousSibling()}insert(e){return this.origin.insertBefore(e),this}}},ex={next:class extends sl{constructor(){super(...arguments);It(this,"direction","next")}getNodeAtCaret(){return this.origin.getNextSibling()}insert(e){return this.origin.insertAfter(e),this}},previous:class extends sl{constructor(){super(...arguments);It(this,"direction","previous")}getNodeAtCaret(){return this.origin.getPreviousSibling()}insert(e){return this.origin.insertBefore(e),this}}},tx={next:class extends Du{constructor(){super(...arguments);It(this,"direction","next")}getNodeAtCaret(){return this.origin.getFirstChild()}insert(e){return this.origin.splice(0,0,[e]),this}},previous:class extends Du{constructor(){super(...arguments);It(this,"direction","previous")}getNodeAtCaret(){return this.origin.getLastChild()}insert(e){return this.origin.splice(this.origin.getChildrenSize(),0,[e]),this}}};function Be(n,e){return n?new ex[e](n):null}function Jr(n,e,t){return n?new Zw[e](n,or(n,t)):null}function or(n,e,t="error"){const r=n.getTextContentSize();let i=e==="next"?r:e==="previous"?0:e;return(i<0||i>r)&&(t!=="clamp"&&function(s,...o){const a=new URL("https://lexical.dev/docs/error"),l=new URLSearchParams;l.append("code",s);for(const c of o)l.append("v",c);a.search=l.toString(),console.warn(`Minified Lexical warning #${s}; visit ${a.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}(284,String(e),String(r),n.getKey()),i=i<0?0:r),i}function Lh(n,e){return new ix(n,e)}function Xt(n,e){return F(n)?new tx[e](n):null}function nx(n){return n&&n.getChildCaret()||n}function eo(n){return n&&nx(n.getAdjacentCaret())}let rx=class By{constructor(e,t,r){It(this,"type","node-caret-range");this.anchor=e,this.focus=t,this.direction=r}getLatest(){const e=this.anchor.getLatest(),t=this.focus.getLatest();return e===this.anchor&&t===this.focus?this:new By(e,t,this.direction)}isCollapsed(){return this.anchor.isSamePointCaret(this.focus)}getTextSlices(){const e=i=>{const s=this[i].getLatest();return sr(s)?function(o,a){const{direction:l,origin:c}=o,u=or(c,a==="focus"?rs(l):l);return Lh(o,u-o.offset)}(s,i):null},t=e("anchor"),r=e("focus");if(t&&r){const{caret:i}=t,{caret:s}=r;if(i.isSameNodeCaret(s))return[Lh(i,s.offset-i.offset),null]}return[t,r]}iterNodeCarets(e="root"){const t=sr(this.anchor)?this.anchor.getSiblingCaret():this.anchor.getLatest(),r=this.focus.getLatest(),i=sr(r),s=o=>o.isSameNodeCaret(r)?null:eo(o)||o.getParentCaret(e);return Ll({hasNext:o=>o!==null&&!(i&&r.isSameNodeCaret(o)),initial:t.isSameNodeCaret(r)?null:s(t),map:o=>o,step:s})}[Symbol.iterator](){return this.iterNodeCarets("root")}},ix=class{constructor(e,t){It(this,"type","slice");this.caret=e,this.distance=t}getSliceIndices(){const{distance:e,caret:{offset:t}}=this,r=t+e;return r<t?[r,t]:[t,r]}getTextContent(){const[e,t]=this.getSliceIndices();return this.caret.origin.getTextContent().slice(e,t)}getTextContentSize(){return Math.abs(this.distance)}removeTextSlice(){const{caret:{origin:e,direction:t}}=this,[r,i]=this.getSliceIndices(),s=e.getTextContent();return Jr(e.setTextContent(s.slice(0,r)+s.slice(i)),t,r)}};function rf(n){return ur(n,Be(ye(),n.direction))}function sx(n){return ur(n,n)}function ur(n,e){return n.direction!==e.direction&&J(265),new rx(n,e,n.direction)}function Ll(n){const{initial:e,hasNext:t,step:r,map:i}=n;let s=e;return{[Symbol.iterator](){return this},next(){if(!t(s))return{done:!0,value:void 0};const o={done:!1,value:i(s)};return s=r(s),o}}}function Uy(n,e){const t=Ws(n.origin,e.origin);switch(t===null&&J(275,n.origin.getKey(),e.origin.getKey()),t.type){case"same":{const r=n.type==="text",i=e.type==="text";return r&&i?function(s,o){return Math.sign(s-o)}(n.offset,e.offset):n.type===e.type?0:r?-1:i?1:n.type==="child"?-1:1}case"ancestor":return n.type==="child"?-1:1;case"descendant":return e.type==="child"?1:-1;case"branch":return zy(t)}}function zy(n){const{a:e,b:t}=n,r=e.__key,i=t.__key;let s=e,o=t;for(;s&&o;s=s.getNextSibling(),o=o.getNextSibling()){if(s.__key===i)return-1;if(o.__key===r)return 1}return s===null?1:-1}function ra(n,e){return e.is(n)}function jh(n){return F(n)?[n.getLatest(),null]:[n.getParent(),n.getLatest()]}function Ws(n,e){if(n.is(e))return{commonAncestor:n,type:"same"};const t=new Map;for(let[r,i]=jh(n);r;i=r,r=r.getParent())t.set(r,i);for(let[r,i]=jh(e);r;i=r,r=r.getParent()){const s=t.get(r);if(s!==void 0)return s===null?(ra(n,r)||J(276),{commonAncestor:r,type:"ancestor"}):i===null?(ra(e,r)||J(277),{commonAncestor:r,type:"descendant"}):((F(s)||ra(n,s))&&(F(i)||ra(e,i))&&r.is(s.getParent())&&r.is(i.getParent())||J(278),{a:s,b:i,commonAncestor:r,type:"branch"})}return null}function qn(n,e){const{type:t,key:r,offset:i}=n,s=Kw(n.key);return t==="text"?(W(s)||J(266,s.getType(),r),Jr(s,e,i)):(F(s)||J(267,s.getType(),r),lx(s,n.offset,e))}function to(n,e){const{origin:t,direction:r}=e,i=r==="next";sr(e)?n.set(t.getKey(),e.offset,"text"):Hr(e)?W(t)?n.set(t.getKey(),or(t,r),"text"):n.set(t.getParentOrThrow().getKey(),t.getIndexWithinParent()+(i?1:0),"element"):(Jt(e)&&F(t)||J(268),n.set(t.getKey(),i?0:t.getChildrenSize(),"element"))}function ox(n){const e=K(),t=q(e)?e:bo();return Ra(t,n),it(t),t}function Ra(n,e){to(n.anchor,e.anchor),to(n.focus,e.focus)}function Fh(n){const{anchor:e,focus:t}=n,r=qn(e,"next"),i=qn(t,"next"),s=Uy(r,i)<=0?"next":"previous";return ur(Bi(r,s),Bi(i,s))}function jl(n){const{direction:e,origin:t}=n,r=Be(t,rs(e)).getNodeAtCaret();return r?Be(r,e):Xt(t.getParentOrThrow(),e)}function qh(n,e="root"){const t=[n];for(let r=Jt(n)?n.getParentCaret(e):n.getSiblingCaret();r!==null;r=r.getParentCaret(e))t.push(jl(r));return t}function Vc(n){return!!n&&n.origin.isAttached()}function ax(n,e="removeEmptySlices"){if(n.isCollapsed())return n;const t="root",r="next";let i=e;const s=Ky(n,r),o=qh(s.anchor,t),a=qh(s.focus.getFlipped(),t),l=new Set,c=[];for(const p of s.iterNodeCarets(t))if(Jt(p))l.add(p.origin.getKey());else if(Hr(p)){const{origin:m}=p;F(m)&&!l.has(m.getKey())||c.push(m)}for(const p of c)p.remove();for(const p of s.getTextSlices()){if(!p)continue;const{origin:m}=p.caret,y=m.getTextContentSize(),b=jl(Be(m,r)),_=m.getMode();if(Math.abs(p.distance)===y&&i==="removeEmptySlices"||_==="token"&&p.distance!==0)b.remove();else if(p.distance!==0){i="removeEmptySlices";let w=p.removeTextSlice();const T=p.caret.origin;if(_==="segmented"){const I=w.origin,M=de(I.getTextContent()).setStyle(I.getStyle()).setFormat(I.getFormat());b.replaceOrInsert(M),w=Jr(M,r,w.offset)}T.is(o[0].origin)&&(o[0]=w),T.is(a[0].origin)&&(a[0]=w.getFlipped())}}let u,f;for(const p of o)if(Vc(p)){u=gn(p);break}for(const p of a)if(Vc(p)){f=gn(p);break}const d=function(p,m,y){if(!p||!m)return null;const b=p.getParentAtCaret(),_=m.getParentAtCaret();if(!b||!_)return null;const w=b.getParents().reverse();w.push(b);const T=_.getParents().reverse();T.push(_);const I=Math.min(w.length,T.length);let M;for(M=0;M<I&&w[M]===T[M];M++);const D=(B,x)=>{let N;for(let C=M;C<B.length;C++){const R=B[C];if(vn(R))return;!N&&x(R)&&(N=R)}return N},A=D(w,Dt),O=A&&D(T,B=>y.has(B.getKey())&&Dt(B));return A&&O?[A,O]:null}(u,f,l);if(d){const[p,m]=d;Xt(p,"previous").splice(0,m.getChildren()),m.remove()}const h=[u,f,...o,...a].find(Vc);if(h)return sx(Bi(gn(h),n.direction));J(269,JSON.stringify(o.map(p=>p.origin.__key)))}function gn(n){const e=function(i){let s=i;for(;Jt(s);){const o=eo(s);if(!Jt(o))break;s=o}return s}(n.getLatest()),{direction:t}=e;if(W(e.origin))return sr(e)?e:Jr(e.origin,t,t);const r=e.getAdjacentCaret();return Hr(r)&&W(r.origin)?Jr(r.origin,t,rs(t)):e}function Wy(n){return sr(n)&&n.offset!==or(n.origin,n.direction)}function Bi(n,e){return n.direction===e?n:n.getFlipped()}function Ky(n,e){return n.direction===e?n:ur(Bi(n.focus,e),Bi(n.anchor,e))}function lx(n,e,t){let r=Xt(n,"next");for(let i=0;i<e;i++){const s=r.getAdjacentCaret();if(s===null)break;r=s}return Bi(r,t)}const cx=new Map;function Bh(n){let e=n;for(;e!=null;){if(e.nodeType===Node.TEXT_NODE)return e;e=e.firstChild}return null}function Uh(n){const e=n.parentNode;if(e==null)throw new Error("Should never happen");return[e,Array.from(e.childNodes).indexOf(n)]}function ux(n,e,t,r,i){const s=e.getKey(),o=r.getKey(),a=document.createRange();let l=n.getElementByKey(s),c=n.getElementByKey(o),u=t,f=i;if(W(e)&&(l=Bh(l)),W(r)&&(c=Bh(c)),e===void 0||r===void 0||l===null||c===null)return null;l.nodeName==="BR"&&([l,u]=Uh(l)),c.nodeName==="BR"&&([c,f]=Uh(c));const d=l.firstChild;l===c&&d!=null&&d.nodeName==="BR"&&u===0&&f===0&&(f=1);try{a.setStart(l,u),a.setEnd(c,f)}catch{return null}return!a.collapsed||u===f&&s===o||(a.setStart(c,f),a.setEnd(l,u)),a}function dx(n,e){const t=n.getRootElement();if(t===null)return[];const r=t.getBoundingClientRect(),i=getComputedStyle(t),s=parseFloat(i.paddingLeft)+parseFloat(i.paddingRight),o=Array.from(e.getClientRects());let a,l=o.length;o.sort((c,u)=>{const f=c.top-u.top;return Math.abs(f)<=3?c.left-u.left:f});for(let c=0;c<l;c++){const u=o[c],f=a&&a.top<=u.top&&a.top+a.height>u.top&&a.left+a.width>u.left,d=u.width+s===r.width;f||d?(o.splice(c--,1),l--):a=u}return o}function fx(n){const e={};if(!n)return e;const t=n.split(";");for(const r of t)if(r!==""){const[i,s]=r.split(/:([^]+)/);i&&s&&(e[i.trim()]=s.trim())}return e}function Hy(n,e){const t=n.getStartEndPoints();if(e.isSelected(n)&&!On(e)&&t!==null){const[r,i]=t,s=n.isBackward(),o=r.getNode(),a=i.getNode(),l=e.is(o),c=e.is(a);if(l||c){const[u,f]=Eu(n),d=o.is(a),h=e.is(s?a:o),p=e.is(s?o:a);let m,y=0;d?(y=u>f?f:u,m=u>f?u:f):h?(y=s?f:u,m=void 0):p&&(y=0,m=s?u:f),e.__text=e.__text.slice(y,m)}}return e}function hx(n){const e=n.getStyle(),t=fx(e);cx.set(e,t)}function gx(n,e){const t=n.getFormatType(),r=n.getIndent();t!==e.getFormatType()&&e.setFormat(t),r!==e.getIndent()&&e.setIndent(r)}function px(n,e,t=gx){if(n===null)return;const r=n.getStartEndPoints(),i=new Map;let s=null;if(r){const[o,a]=r;s=bo(),s.anchor.set(o.key,o.offset,o.type),s.focus.set(a.key,a.offset,a.type);const l=Gc(o.getNode(),Dt),c=Gc(a.getNode(),Dt);F(l)&&i.set(l.getKey(),l),F(c)&&i.set(c.getKey(),c)}for(const o of n.getNodes())if(F(o)&&Dt(o))i.set(o.getKey(),o);else if(r===null){const a=Gc(o,Dt);F(a)&&i.set(a.getKey(),a)}for(const[o,a]of i){const l=e();t(a,l),a.replace(l,!0),s&&(o===s.anchor.key&&s.anchor.set(l.getKey(),s.anchor.offset,s.anchor.type),o===s.focus.key&&s.focus.set(l.getKey(),s.focus.offset,s.focus.type))}s&&n.is(K())&&it(s)}function Jy(n){const e=n.anchor.getNode(),t=et(e)?e:e.getParentOrThrow(),r=Dl().getElementByKey(t.getKey());if(r===null)return!1;const i=r.ownerDocument.defaultView;return i===null?!1:i.getComputedStyle(r).writingMode==="vertical-rl"}function al(n,e){let t=Jy(n)?!e:e;Vy(n)&&(t=!t);const r=qn(n.focus,t?"previous":"next");if(Wy(r))return!1;for(const i of rf(r)){if(Jt(i))return!i.origin.isInline();if(!F(i.origin)){if(ke(i.origin))return!0;break}}return!1}function mx(n,e,t,r){n.modify(e?"extend":"move",t,r)}function Vy(n){const e=n.anchor.getNode();return(et(e)?e:e.getParentOrThrow()).getDirection()==="rtl"}function ll(n,e,t){const r=Vy(n);let i;i=Jy(n)||r?!t:t,mx(n,e,i,"character")}function Gc(n,e){let t=n;for(;t!==null&&t.getParent()!==null&&!e(t);)t=t.getParentOrThrow();return e(t)?t:null}function yx(n,...e){const t=new URL("https://lexical.dev/docs/error"),r=new URLSearchParams;r.append("code",n);for(const i of e)r.append("v",i);throw t.search=r.toString(),Error(`Minified Lexical error #${n}; visit ${t.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}const wo=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,_x=wo&&"documentMode"in document?document.documentMode:null,bx=wo&&/Mac|iPod|iPhone|iPad/.test(navigator.platform),vx=wo&&/^(?!.*Seamonkey)(?=.*Firefox).*/i.test(navigator.userAgent);!(!wo||!("InputEvent"in window)||_x)&&"getTargetRanges"in new window.InputEvent("input");function Gy(...n){const e=[];for(const t of n)if(t&&typeof t=="string")for(const[r]of t.matchAll(/\S+/g))e.push(r);return e}function Ue(...n){return()=>{for(let e=n.length-1;e>=0;e--)n[e]();n.length=0}}const kx=wo,Fu=bx,wx=vx;function ct(n,...e){const t=Gy(...e);t.length>0&&n.classList.add(...t)}function qr(n,...e){const t=Gy(...e);t.length>0&&n.classList.remove(...t)}function xo(n,e){return Array.from(xx(n))}function xx(n,e){return Cx("next",n)}function Cx(n,e,t){const r=ye(),i=e||r,s=F(i)?Xt(i,n):Be(i,n),o=Sx(i),a=function(c,u){const f=Wh(Be(c,u));return f&&f[0]}(i,n);let l=o;return Ll({hasNext:c=>c!==null,initial:s,map:c=>({depth:l,node:c.origin}),step:c=>{if(c.isSameNodeCaret(a))return null;Jt(c)&&l++;const u=Wh(c);return!u||u[0].isSameNodeCaret(a)?null:(l+=u[1],u[0])}})}function Sx(n){let e=-1;for(let t=n;t!==null;t=t.getParent())e++;return e}function Tx(n){const e=Qt(n,t=>F(t)&&!t.isInline());return F(e)||yx(4,n.__key),e}const Qt=(n,e)=>{let t=n;for(;t!==ye()&&t!=null;){if(e(t))return t;t=t.getParent()}return null};function Yy(n,e,t,r){const i=s=>s instanceof e;return n.registerNodeTransform(e,s=>{const o=(a=>{const l=a.getChildren();for(let f=0;f<l.length;f++){const d=l[f];if(i(d))return null}let c=a,u=a;for(;c!==null;)if(u=c,c=c.getParent(),i(c))return{child:u,parent:c};return null})(s);if(o!==null){const{child:a,parent:l}=o;if(a.is(s)){r(l,s);const c=a.getNextSiblings(),u=c.length;if(l.insertAfter(a),u!==0){const f=t(l);a.insertAfter(f);for(let d=0;d<u;d++)f.append(c[d])}l.canBeEmpty()||l.getChildrenSize()!==0||l.remove()}}})}function Ln(n,e){return n!==null&&Object.getPrototypeOf(n).constructor.name===e.name}let Yc=!(wx||!kx)&&void 0;function Ex(n){let e=1;if(function(){if(Yc===void 0){const t=document.createElement("div");t.style.cssText="position: absolute; opacity: 0; width: 100px; left: -1000px;",document.body.appendChild(t);const r=t.getBoundingClientRect();t.style.setProperty("zoom","2"),Yc=t.getBoundingClientRect().width===r.width,document.body.removeChild(t)}return Yc}())for(;n;)e*=Number(window.getComputedStyle(n).getPropertyValue("zoom")),n=n.parentElement;return e}function Xy(n,e){const t=[],r=Array.from(n).reverse();for(let i=r.pop();i!==void 0;i=r.pop())if(e(i))t.push(i);else if(F(i))for(const s of Nx(i))r.push(s);return t}function Nx(n){return Mx(Xt(n,"previous"))}function Mx(n){return Ll({hasNext:Hr,initial:n.getAdjacentCaret(),map:e=>e.origin.getLatest(),step:e=>e.getAdjacentCaret()})}function zh(n){jl(Be(n,"next")).splice(1,n.getChildren())}function Wh(n,e="root"){let t=0,r=n,i=eo(r);for(;i===null;){if(t--,i=r.getParentCaret(e),!i)return null;r=i,i=eo(r)}return i&&[i,t]}var ia={exports:{}},Xc,Kh;function Ax(){if(Kh)return Xc;Kh=1;var n=-1,e=1,t=0;function r(x,N,C,R,j){if(x===N)return x?[[t,x]]:[];if(C!=null){var L=O(x,N,C);if(L)return L}var z=a(x,N),H=x.substring(0,z);x=x.substring(z),N=N.substring(z),z=c(x,N);var V=x.substring(x.length-z);x=x.substring(0,x.length-z),N=N.substring(0,N.length-z);var G=i(x,N);return H&&G.unshift([t,H]),V&&G.push([t,V]),_(G,j),R&&f(G),G}function i(x,N){var C;if(!x)return[[e,N]];if(!N)return[[n,x]];var R=x.length>N.length?x:N,j=x.length>N.length?N:x,L=R.indexOf(j);if(L!==-1)return C=[[e,R.substring(0,L)],[t,j],[e,R.substring(L+j.length)]],x.length>N.length&&(C[0][0]=C[2][0]=n),C;if(j.length===1)return[[n,x],[e,N]];var z=u(x,N);if(z){var H=z[0],V=z[1],G=z[2],ee=z[3],Q=z[4],re=r(H,G),oe=r(V,ee);return re.concat([[t,Q]],oe)}return s(x,N)}function s(x,N){for(var C=x.length,R=N.length,j=Math.ceil((C+R)/2),L=j,z=2*j,H=new Array(z),V=new Array(z),G=0;G<z;G++)H[G]=-1,V[G]=-1;H[L+1]=0,V[L+1]=0;for(var ee=C-R,Q=ee%2!==0,re=0,oe=0,X=0,fe=0,ve=0;ve<j;ve++){for(var se=-ve+re;se<=ve-oe;se+=2){var ue=L+se,he;se===-ve||se!==ve&&H[ue-1]<H[ue+1]?he=H[ue+1]:he=H[ue-1]+1;for(var we=he-se;he<C&&we<R&&x.charAt(he)===N.charAt(we);)he++,we++;if(H[ue]=he,he>C)oe+=2;else if(we>R)re+=2;else if(Q){var Ce=L+ee-se;if(Ce>=0&&Ce<z&&V[Ce]!==-1){var Ee=C-V[Ce];if(he>=Ee)return o(x,N,he,we)}}}for(var De=-ve+X;De<=ve-fe;De+=2){var Ce=L+De,Ee;De===-ve||De!==ve&&V[Ce-1]<V[Ce+1]?Ee=V[Ce+1]:Ee=V[Ce-1]+1;for(var st=Ee-De;Ee<C&&st<R&&x.charAt(C-Ee-1)===N.charAt(R-st-1);)Ee++,st++;if(V[Ce]=Ee,Ee>C)fe+=2;else if(st>R)X+=2;else if(!Q){var ue=L+ee-De;if(ue>=0&&ue<z&&H[ue]!==-1){var he=H[ue],we=L+he-ue;if(Ee=C-Ee,he>=Ee)return o(x,N,he,we)}}}}return[[n,x],[e,N]]}function o(x,N,C,R){var j=x.substring(0,C),L=N.substring(0,R),z=x.substring(C),H=N.substring(R),V=r(j,L),G=r(z,H);return V.concat(G)}function a(x,N){if(!x||!N||x.charAt(0)!==N.charAt(0))return 0;for(var C=0,R=Math.min(x.length,N.length),j=R,L=0;C<j;)x.substring(L,j)==N.substring(L,j)?(C=j,L=C):R=j,j=Math.floor((R-C)/2+C);return w(x.charCodeAt(j-1))&&j--,j}function l(x,N){var C=x.length,R=N.length;if(C==0||R==0)return 0;C>R?x=x.substring(C-R):C<R&&(N=N.substring(0,C));var j=Math.min(C,R);if(x==N)return j;for(var L=0,z=1;;){var H=x.substring(j-z),V=N.indexOf(H);if(V==-1)return L;z+=V,(V==0||x.substring(j-z)==N.substring(0,z))&&(L=z,z++)}}function c(x,N){if(!x||!N||x.slice(-1)!==N.slice(-1))return 0;for(var C=0,R=Math.min(x.length,N.length),j=R,L=0;C<j;)x.substring(x.length-j,x.length-L)==N.substring(N.length-j,N.length-L)?(C=j,L=C):R=j,j=Math.floor((R-C)/2+C);return T(x.charCodeAt(x.length-j))&&j--,j}function u(x,N){var C=x.length>N.length?x:N,R=x.length>N.length?N:x;if(C.length<4||R.length*2<C.length)return null;function j(oe,X,fe){for(var ve=oe.substring(fe,fe+Math.floor(oe.length/4)),se=-1,ue="",he,we,Ce,Ee;(se=X.indexOf(ve,se+1))!==-1;){var De=a(oe.substring(fe),X.substring(se)),st=c(oe.substring(0,fe),X.substring(0,se));ue.length<st+De&&(ue=X.substring(se-st,se)+X.substring(se,se+De),he=oe.substring(0,fe-st),we=oe.substring(fe+De),Ce=X.substring(0,se-st),Ee=X.substring(se+De))}return ue.length*2>=oe.length?[he,we,Ce,Ee,ue]:null}var L=j(C,R,Math.ceil(C.length/4)),z=j(C,R,Math.ceil(C.length/2)),H;if(!L&&!z)return null;z?L?H=L[4].length>z[4].length?L:z:H=z:H=L;var V,G,ee,Q;x.length>N.length?(V=H[0],G=H[1],ee=H[2],Q=H[3]):(ee=H[0],Q=H[1],V=H[2],G=H[3]);var re=H[4];return[V,G,ee,Q,re]}function f(x){for(var N=!1,C=[],R=0,j=null,L=0,z=0,H=0,V=0,G=0;L<x.length;)x[L][0]==t?(C[R++]=L,z=V,H=G,V=0,G=0,j=x[L][1]):(x[L][0]==e?V+=x[L][1].length:G+=x[L][1].length,j&&j.length<=Math.max(z,H)&&j.length<=Math.max(V,G)&&(x.splice(C[R-1],0,[n,j]),x[C[R-1]+1][0]=e,R--,R--,L=R>0?C[R-1]:-1,z=0,H=0,V=0,G=0,j=null,N=!0)),L++;for(N&&_(x),b(x),L=1;L<x.length;){if(x[L-1][0]==n&&x[L][0]==e){var ee=x[L-1][1],Q=x[L][1],re=l(ee,Q),oe=l(Q,ee);re>=oe?(re>=ee.length/2||re>=Q.length/2)&&(x.splice(L,0,[t,Q.substring(0,re)]),x[L-1][1]=ee.substring(0,ee.length-re),x[L+1][1]=Q.substring(re),L++):(oe>=ee.length/2||oe>=Q.length/2)&&(x.splice(L,0,[t,ee.substring(0,oe)]),x[L-1][0]=e,x[L-1][1]=Q.substring(0,Q.length-oe),x[L+1][0]=n,x[L+1][1]=ee.substring(oe),L++),L++}L++}}var d=/[^a-zA-Z0-9]/,h=/\s/,p=/[\r\n]/,m=/\n\r?\n$/,y=/^\r?\n\r?\n/;function b(x){function N(oe,X){if(!oe||!X)return 6;var fe=oe.charAt(oe.length-1),ve=X.charAt(0),se=fe.match(d),ue=ve.match(d),he=se&&fe.match(h),we=ue&&ve.match(h),Ce=he&&fe.match(p),Ee=we&&ve.match(p),De=Ce&&oe.match(m),st=Ee&&X.match(y);return De||st?5:Ce||Ee?4:se&&!he&&we?3:he||we?2:se||ue?1:0}for(var C=1;C<x.length-1;){if(x[C-1][0]==t&&x[C+1][0]==t){var R=x[C-1][1],j=x[C][1],L=x[C+1][1],z=c(R,j);if(z){var H=j.substring(j.length-z);R=R.substring(0,R.length-z),j=H+j.substring(0,j.length-z),L=H+L}for(var V=R,G=j,ee=L,Q=N(R,j)+N(j,L);j.charAt(0)===L.charAt(0);){R+=j.charAt(0),j=j.substring(1)+L.charAt(0),L=L.substring(1);var re=N(R,j)+N(j,L);re>=Q&&(Q=re,V=R,G=j,ee=L)}x[C-1][1]!=V&&(V?x[C-1][1]=V:(x.splice(C-1,1),C--),x[C][1]=G,ee?x[C+1][1]=ee:(x.splice(C+1,1),C--))}C++}}function _(x,N){x.push([t,""]);for(var C=0,R=0,j=0,L="",z="",H;C<x.length;){if(C<x.length-1&&!x[C][1]){x.splice(C,1);continue}switch(x[C][0]){case e:j++,z+=x[C][1],C++;break;case n:R++,L+=x[C][1],C++;break;case t:var V=C-j-R-1;if(N){if(V>=0&&M(x[V][1])){var G=x[V][1].slice(-1);if(x[V][1]=x[V][1].slice(0,-1),L=G+L,z=G+z,!x[V][1]){x.splice(V,1),C--;var ee=V-1;x[ee]&&x[ee][0]===e&&(j++,z=x[ee][1]+z,ee--),x[ee]&&x[ee][0]===n&&(R++,L=x[ee][1]+L,ee--),V=ee}}if(I(x[C][1])){var G=x[C][1].charAt(0);x[C][1]=x[C][1].slice(1),L+=G,z+=G}}if(C<x.length-1&&!x[C][1]){x.splice(C,1);break}if(L.length>0||z.length>0){L.length>0&&z.length>0&&(H=a(z,L),H!==0&&(V>=0?x[V][1]+=z.substring(0,H):(x.splice(0,0,[t,z.substring(0,H)]),C++),z=z.substring(H),L=L.substring(H)),H=c(z,L),H!==0&&(x[C][1]=z.substring(z.length-H)+x[C][1],z=z.substring(0,z.length-H),L=L.substring(0,L.length-H)));var Q=j+R;L.length===0&&z.length===0?(x.splice(C-Q,Q),C=C-Q):L.length===0?(x.splice(C-Q,Q,[e,z]),C=C-Q+1):z.length===0?(x.splice(C-Q,Q,[n,L]),C=C-Q+1):(x.splice(C-Q,Q,[n,L],[e,z]),C=C-Q+2)}C!==0&&x[C-1][0]===t?(x[C-1][1]+=x[C][1],x.splice(C,1)):C++,j=0,R=0,L="",z="";break}}x[x.length-1][1]===""&&x.pop();var re=!1;for(C=1;C<x.length-1;)x[C-1][0]===t&&x[C+1][0]===t&&(x[C][1].substring(x[C][1].length-x[C-1][1].length)===x[C-1][1]?(x[C][1]=x[C-1][1]+x[C][1].substring(0,x[C][1].length-x[C-1][1].length),x[C+1][1]=x[C-1][1]+x[C+1][1],x.splice(C-1,1),re=!0):x[C][1].substring(0,x[C+1][1].length)==x[C+1][1]&&(x[C-1][1]+=x[C+1][1],x[C][1]=x[C][1].substring(x[C+1][1].length)+x[C+1][1],x.splice(C+1,1),re=!0)),C++;re&&_(x,N)}function w(x){return x>=55296&&x<=56319}function T(x){return x>=56320&&x<=57343}function I(x){return T(x.charCodeAt(0))}function M(x){return w(x.charCodeAt(x.length-1))}function D(x){for(var N=[],C=0;C<x.length;C++)x[C][1].length>0&&N.push(x[C]);return N}function A(x,N,C,R){return M(x)||I(R)?null:D([[t,x],[n,N],[e,C],[t,R]])}function O(x,N,C){var R=typeof C=="number"?{index:C,length:0}:C.oldRange,j=typeof C=="number"?null:C.newRange,L=x.length,z=N.length;if(R.length===0&&(j===null||j.length===0)){var H=R.index,V=x.slice(0,H),G=x.slice(H),ee=j?j.index:null;e:{var Q=H+z-L;if(ee!==null&&ee!==Q||Q<0||Q>z)break e;var re=N.slice(0,Q),oe=N.slice(Q);if(oe!==G)break e;var X=Math.min(H,Q),fe=V.slice(0,X),ve=re.slice(0,X);if(fe!==ve)break e;var se=V.slice(X),ue=re.slice(X);return A(fe,se,ue,G)}e:{if(ee!==null&&ee!==H)break e;var he=H,re=N.slice(0,he),oe=N.slice(he);if(re!==V)break e;var we=Math.min(L-he,z-he),Ce=G.slice(G.length-we),Ee=oe.slice(oe.length-we);if(Ce!==Ee)break e;var se=G.slice(0,G.length-we),ue=oe.slice(0,oe.length-we);return A(V,se,ue,Ce)}}if(R.length>0&&j&&j.length===0)e:{var fe=x.slice(0,R.index),Ce=x.slice(R.index+R.length),X=fe.length,we=Ce.length;if(z<X+we)break e;var ve=N.slice(0,X),Ee=N.slice(z-we);if(fe!==ve||Ce!==Ee)break e;var se=x.slice(X,L-we),ue=N.slice(X,z-we);return A(fe,se,ue,Ce)}return null}function B(x,N,C,R){return r(x,N,C,R,!0)}return B.INSERT=e,B.DELETE=n,B.EQUAL=t,Xc=B,Xc}var Ls={exports:{}};Ls.exports;var Hh;function Qy(){return Hh||(Hh=1,function(n,e){var t=200,r="__lodash_hash_undefined__",i=9007199254740991,s="[object Arguments]",o="[object Array]",a="[object Boolean]",l="[object Date]",c="[object Error]",u="[object Function]",f="[object GeneratorFunction]",d="[object Map]",h="[object Number]",p="[object Object]",m="[object Promise]",y="[object RegExp]",b="[object Set]",_="[object String]",w="[object Symbol]",T="[object WeakMap]",I="[object ArrayBuffer]",M="[object DataView]",D="[object Float32Array]",A="[object Float64Array]",O="[object Int8Array]",B="[object Int16Array]",x="[object Int32Array]",N="[object Uint8Array]",C="[object Uint8ClampedArray]",R="[object Uint16Array]",j="[object Uint32Array]",L=/[\\^$.*+?()[\]{}|]/g,z=/\w*$/,H=/^\[object .+?Constructor\]$/,V=/^(?:0|[1-9]\d*)$/,G={};G[s]=G[o]=G[I]=G[M]=G[a]=G[l]=G[D]=G[A]=G[O]=G[B]=G[x]=G[d]=G[h]=G[p]=G[y]=G[b]=G[_]=G[w]=G[N]=G[C]=G[R]=G[j]=!0,G[c]=G[u]=G[T]=!1;var ee=typeof Zn=="object"&&Zn&&Zn.Object===Object&&Zn,Q=typeof self=="object"&&self&&self.Object===Object&&self,re=ee||Q||Function("return this")(),oe=e&&!e.nodeType&&e,X=oe&&!0&&n&&!n.nodeType&&n,fe=X&&X.exports===oe;function ve(g,v){return g.set(v[0],v[1]),g}function se(g,v){return g.add(v),g}function ue(g,v){for(var E=-1,U=g?g.length:0;++E<U&&v(g[E],E,g)!==!1;);return g}function he(g,v){for(var E=-1,U=v.length,le=g.length;++E<U;)g[le+E]=v[E];return g}function we(g,v,E,U){for(var le=-1,te=g?g.length:0;++le<te;)E=v(E,g[le],le,g);return E}function Ce(g,v){for(var E=-1,U=Array(g);++E<g;)U[E]=v(E);return U}function Ee(g,v){return g==null?void 0:g[v]}function De(g){var v=!1;if(g!=null&&typeof g.toString!="function")try{v=!!(g+"")}catch{}return v}function st(g){var v=-1,E=Array(g.size);return g.forEach(function(U,le){E[++v]=[le,U]}),E}function fs(g,v){return function(E){return g(v(E))}}function Po(g){var v=-1,E=Array(g.size);return g.forEach(function(U){E[++v]=U}),E}var Jl=Array.prototype,Vl=Function.prototype,di=Object.prototype,hs=re["__core-js_shared__"],Io=function(){var g=/[^.]+$/.exec(hs&&hs.keys&&hs.keys.IE_PROTO||"");return g?"Symbol(src)_1."+g:""}(),Ro=Vl.toString,rn=di.hasOwnProperty,fi=di.toString,Gl=RegExp("^"+Ro.call(rn).replace(L,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Sr=fe?re.Buffer:void 0,hi=re.Symbol,gs=re.Uint8Array,Pt=fs(Object.getPrototypeOf,Object),Do=Object.create,Lo=di.propertyIsEnumerable,Yl=Jl.splice,ps=Object.getOwnPropertySymbols,gi=Sr?Sr.isBuffer:void 0,jo=fs(Object.keys,Object),pi=zt(re,"DataView"),Tr=zt(re,"Map"),Ut=zt(re,"Promise"),mi=zt(re,"Set"),ms=zt(re,"WeakMap"),Er=zt(Object,"create"),ys=pt(pi),Nr=pt(Tr),_s=pt(Ut),bs=pt(mi),vs=pt(ms),Gn=hi?hi.prototype:void 0,Fo=Gn?Gn.valueOf:void 0;function wn(g){var v=-1,E=g?g.length:0;for(this.clear();++v<E;){var U=g[v];this.set(U[0],U[1])}}function Xl(){this.__data__=Er?Er(null):{}}function Ql(g){return this.has(g)&&delete this.__data__[g]}function Zl(g){var v=this.__data__;if(Er){var E=v[g];return E===r?void 0:E}return rn.call(v,g)?v[g]:void 0}function qo(g){var v=this.__data__;return Er?v[g]!==void 0:rn.call(v,g)}function ks(g,v){var E=this.__data__;return E[g]=Er&&v===void 0?r:v,this}wn.prototype.clear=Xl,wn.prototype.delete=Ql,wn.prototype.get=Zl,wn.prototype.has=qo,wn.prototype.set=ks;function Ye(g){var v=-1,E=g?g.length:0;for(this.clear();++v<E;){var U=g[v];this.set(U[0],U[1])}}function ec(){this.__data__=[]}function tc(g){var v=this.__data__,E=_i(v,g);if(E<0)return!1;var U=v.length-1;return E==U?v.pop():Yl.call(v,E,1),!0}function nc(g){var v=this.__data__,E=_i(v,g);return E<0?void 0:v[E][1]}function rc(g){return _i(this.__data__,g)>-1}function ic(g,v){var E=this.__data__,U=_i(E,g);return U<0?E.push([g,v]):E[U][1]=v,this}Ye.prototype.clear=ec,Ye.prototype.delete=tc,Ye.prototype.get=nc,Ye.prototype.has=rc,Ye.prototype.set=ic;function ot(g){var v=-1,E=g?g.length:0;for(this.clear();++v<E;){var U=g[v];this.set(U[0],U[1])}}function sc(){this.__data__={hash:new wn,map:new(Tr||Ye),string:new wn}}function oc(g){return Ar(this,g).delete(g)}function ac(g){return Ar(this,g).get(g)}function lc(g){return Ar(this,g).has(g)}function cc(g,v){return Ar(this,g).set(g,v),this}ot.prototype.clear=sc,ot.prototype.delete=oc,ot.prototype.get=ac,ot.prototype.has=lc,ot.prototype.set=cc;function kt(g){this.__data__=new Ye(g)}function uc(){this.__data__=new Ye}function dc(g){return this.__data__.delete(g)}function fc(g){return this.__data__.get(g)}function hc(g){return this.__data__.has(g)}function gc(g,v){var E=this.__data__;if(E instanceof Ye){var U=E.__data__;if(!Tr||U.length<t-1)return U.push([g,v]),this;E=this.__data__=new ot(U)}return E.set(g,v),this}kt.prototype.clear=uc,kt.prototype.delete=dc,kt.prototype.get=fc,kt.prototype.has=hc,kt.prototype.set=gc;function yi(g,v){var E=Ss(g)||vi(g)?Ce(g.length,String):[],U=E.length,le=!!U;for(var te in g)rn.call(g,te)&&!(le&&(te=="length"||Nc(te,U)))&&E.push(te);return E}function Bo(g,v,E){var U=g[v];(!(rn.call(g,v)&&Ho(U,E))||E===void 0&&!(v in g))&&(g[v]=E)}function _i(g,v){for(var E=g.length;E--;)if(Ho(g[E][0],v))return E;return-1}function sn(g,v){return g&&Cs(v,Es(v),g)}function ws(g,v,E,U,le,te,be){var _e;if(U&&(_e=te?U(g,le,te,be):U(g)),_e!==void 0)return _e;if(!an(g))return g;var Le=Ss(g);if(Le){if(_e=Tc(g),!v)return xc(g,_e)}else{var xe=Cn(g),at=xe==u||xe==f;if(Jo(g))return bi(g,v);if(xe==p||xe==s||at&&!te){if(De(g))return te?g:{};if(_e=on(at?{}:g),!v)return Cc(g,sn(_e,g))}else{if(!G[xe])return te?g:{};_e=Ec(g,xe,ws,v)}}be||(be=new kt);var wt=be.get(g);if(wt)return wt;if(be.set(g,_e),!Le)var je=E?Sc(g):Es(g);return ue(je||g,function(lt,Xe){je&&(Xe=lt,lt=g[Xe]),Bo(_e,Xe,ws(lt,v,E,U,Xe,g,be))}),_e}function pc(g){return an(g)?Do(g):{}}function mc(g,v,E){var U=v(g);return Ss(g)?U:he(U,E(g))}function yc(g){return fi.call(g)}function _c(g){if(!an(g)||Ac(g))return!1;var v=Ts(g)||De(g)?Gl:H;return v.test(pt(g))}function bc(g){if(!Wo(g))return jo(g);var v=[];for(var E in Object(g))rn.call(g,E)&&E!="constructor"&&v.push(E);return v}function bi(g,v){if(v)return g.slice();var E=new g.constructor(g.length);return g.copy(E),E}function xs(g){var v=new g.constructor(g.byteLength);return new gs(v).set(new gs(g)),v}function Mr(g,v){var E=v?xs(g.buffer):g.buffer;return new g.constructor(E,g.byteOffset,g.byteLength)}function Uo(g,v,E){var U=v?E(st(g),!0):st(g);return we(U,ve,new g.constructor)}function zo(g){var v=new g.constructor(g.source,z.exec(g));return v.lastIndex=g.lastIndex,v}function vc(g,v,E){var U=v?E(Po(g),!0):Po(g);return we(U,se,new g.constructor)}function kc(g){return Fo?Object(Fo.call(g)):{}}function wc(g,v){var E=v?xs(g.buffer):g.buffer;return new g.constructor(E,g.byteOffset,g.length)}function xc(g,v){var E=-1,U=g.length;for(v||(v=Array(U));++E<U;)v[E]=g[E];return v}function Cs(g,v,E,U){E||(E={});for(var le=-1,te=v.length;++le<te;){var be=v[le],_e=void 0;Bo(E,be,_e===void 0?g[be]:_e)}return E}function Cc(g,v){return Cs(g,xn(g),v)}function Sc(g){return mc(g,Es,xn)}function Ar(g,v){var E=g.__data__;return Mc(v)?E[typeof v=="string"?"string":"hash"]:E.map}function zt(g,v){var E=Ee(g,v);return _c(E)?E:void 0}var xn=ps?fs(ps,Object):$c,Cn=yc;(pi&&Cn(new pi(new ArrayBuffer(1)))!=M||Tr&&Cn(new Tr)!=d||Ut&&Cn(Ut.resolve())!=m||mi&&Cn(new mi)!=b||ms&&Cn(new ms)!=T)&&(Cn=function(g){var v=fi.call(g),E=v==p?g.constructor:void 0,U=E?pt(E):void 0;if(U)switch(U){case ys:return M;case Nr:return d;case _s:return m;case bs:return b;case vs:return T}return v});function Tc(g){var v=g.length,E=g.constructor(v);return v&&typeof g[0]=="string"&&rn.call(g,"index")&&(E.index=g.index,E.input=g.input),E}function on(g){return typeof g.constructor=="function"&&!Wo(g)?pc(Pt(g)):{}}function Ec(g,v,E,U){var le=g.constructor;switch(v){case I:return xs(g);case a:case l:return new le(+g);case M:return Mr(g,U);case D:case A:case O:case B:case x:case N:case C:case R:case j:return wc(g,U);case d:return Uo(g,U,E);case h:case _:return new le(g);case y:return zo(g);case b:return vc(g,U,E);case w:return kc(g)}}function Nc(g,v){return v=v??i,!!v&&(typeof g=="number"||V.test(g))&&g>-1&&g%1==0&&g<v}function Mc(g){var v=typeof g;return v=="string"||v=="number"||v=="symbol"||v=="boolean"?g!=="__proto__":g===null}function Ac(g){return!!Io&&Io in g}function Wo(g){var v=g&&g.constructor,E=typeof v=="function"&&v.prototype||di;return g===E}function pt(g){if(g!=null){try{return Ro.call(g)}catch{}try{return g+""}catch{}}return""}function Ko(g){return ws(g,!0,!0)}function Ho(g,v){return g===v||g!==g&&v!==v}function vi(g){return Oc(g)&&rn.call(g,"callee")&&(!Lo.call(g,"callee")||fi.call(g)==s)}var Ss=Array.isArray;function ki(g){return g!=null&&Vo(g.length)&&!Ts(g)}function Oc(g){return Go(g)&&ki(g)}var Jo=gi||Pc;function Ts(g){var v=an(g)?fi.call(g):"";return v==u||v==f}function Vo(g){return typeof g=="number"&&g>-1&&g%1==0&&g<=i}function an(g){var v=typeof g;return!!g&&(v=="object"||v=="function")}function Go(g){return!!g&&typeof g=="object"}function Es(g){return ki(g)?yi(g):bc(g)}function $c(){return[]}function Pc(){return!1}n.exports=Ko}(Ls,Ls.exports)),Ls.exports}var js={exports:{}};js.exports;var Jh;function Zy(){return Jh||(Jh=1,function(n,e){var t=200,r="__lodash_hash_undefined__",i=1,s=2,o=9007199254740991,a="[object Arguments]",l="[object Array]",c="[object AsyncFunction]",u="[object Boolean]",f="[object Date]",d="[object Error]",h="[object Function]",p="[object GeneratorFunction]",m="[object Map]",y="[object Number]",b="[object Null]",_="[object Object]",w="[object Promise]",T="[object Proxy]",I="[object RegExp]",M="[object Set]",D="[object String]",A="[object Symbol]",O="[object Undefined]",B="[object WeakMap]",x="[object ArrayBuffer]",N="[object DataView]",C="[object Float32Array]",R="[object Float64Array]",j="[object Int8Array]",L="[object Int16Array]",z="[object Int32Array]",H="[object Uint8Array]",V="[object Uint8ClampedArray]",G="[object Uint16Array]",ee="[object Uint32Array]",Q=/[\\^$.*+?()[\]{}|]/g,re=/^\[object .+?Constructor\]$/,oe=/^(?:0|[1-9]\d*)$/,X={};X[C]=X[R]=X[j]=X[L]=X[z]=X[H]=X[V]=X[G]=X[ee]=!0,X[a]=X[l]=X[x]=X[u]=X[N]=X[f]=X[d]=X[h]=X[m]=X[y]=X[_]=X[I]=X[M]=X[D]=X[B]=!1;var fe=typeof Zn=="object"&&Zn&&Zn.Object===Object&&Zn,ve=typeof self=="object"&&self&&self.Object===Object&&self,se=fe||ve||Function("return this")(),ue=e&&!e.nodeType&&e,he=ue&&!0&&n&&!n.nodeType&&n,we=he&&he.exports===ue,Ce=we&&fe.process,Ee=function(){try{return Ce&&Ce.binding&&Ce.binding("util")}catch{}}(),De=Ee&&Ee.isTypedArray;function st(g,v){for(var E=-1,U=g==null?0:g.length,le=0,te=[];++E<U;){var be=g[E];v(be,E,g)&&(te[le++]=be)}return te}function fs(g,v){for(var E=-1,U=v.length,le=g.length;++E<U;)g[le+E]=v[E];return g}function Po(g,v){for(var E=-1,U=g==null?0:g.length;++E<U;)if(v(g[E],E,g))return!0;return!1}function Jl(g,v){for(var E=-1,U=Array(g);++E<g;)U[E]=v(E);return U}function Vl(g){return function(v){return g(v)}}function di(g,v){return g.has(v)}function hs(g,v){return g==null?void 0:g[v]}function Io(g){var v=-1,E=Array(g.size);return g.forEach(function(U,le){E[++v]=[le,U]}),E}function Ro(g,v){return function(E){return g(v(E))}}function rn(g){var v=-1,E=Array(g.size);return g.forEach(function(U){E[++v]=U}),E}var fi=Array.prototype,Gl=Function.prototype,Sr=Object.prototype,hi=se["__core-js_shared__"],gs=Gl.toString,Pt=Sr.hasOwnProperty,Do=function(){var g=/[^.]+$/.exec(hi&&hi.keys&&hi.keys.IE_PROTO||"");return g?"Symbol(src)_1."+g:""}(),Lo=Sr.toString,Yl=RegExp("^"+gs.call(Pt).replace(Q,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ps=we?se.Buffer:void 0,gi=se.Symbol,jo=se.Uint8Array,pi=Sr.propertyIsEnumerable,Tr=fi.splice,Ut=gi?gi.toStringTag:void 0,mi=Object.getOwnPropertySymbols,ms=ps?ps.isBuffer:void 0,Er=Ro(Object.keys,Object),ys=xn(se,"DataView"),Nr=xn(se,"Map"),_s=xn(se,"Promise"),bs=xn(se,"Set"),vs=xn(se,"WeakMap"),Gn=xn(Object,"create"),Fo=pt(ys),wn=pt(Nr),Xl=pt(_s),Ql=pt(bs),Zl=pt(vs),qo=gi?gi.prototype:void 0,ks=qo?qo.valueOf:void 0;function Ye(g){var v=-1,E=g==null?0:g.length;for(this.clear();++v<E;){var U=g[v];this.set(U[0],U[1])}}function ec(){this.__data__=Gn?Gn(null):{},this.size=0}function tc(g){var v=this.has(g)&&delete this.__data__[g];return this.size-=v?1:0,v}function nc(g){var v=this.__data__;if(Gn){var E=v[g];return E===r?void 0:E}return Pt.call(v,g)?v[g]:void 0}function rc(g){var v=this.__data__;return Gn?v[g]!==void 0:Pt.call(v,g)}function ic(g,v){var E=this.__data__;return this.size+=this.has(g)?0:1,E[g]=Gn&&v===void 0?r:v,this}Ye.prototype.clear=ec,Ye.prototype.delete=tc,Ye.prototype.get=nc,Ye.prototype.has=rc,Ye.prototype.set=ic;function ot(g){var v=-1,E=g==null?0:g.length;for(this.clear();++v<E;){var U=g[v];this.set(U[0],U[1])}}function sc(){this.__data__=[],this.size=0}function oc(g){var v=this.__data__,E=bi(v,g);if(E<0)return!1;var U=v.length-1;return E==U?v.pop():Tr.call(v,E,1),--this.size,!0}function ac(g){var v=this.__data__,E=bi(v,g);return E<0?void 0:v[E][1]}function lc(g){return bi(this.__data__,g)>-1}function cc(g,v){var E=this.__data__,U=bi(E,g);return U<0?(++this.size,E.push([g,v])):E[U][1]=v,this}ot.prototype.clear=sc,ot.prototype.delete=oc,ot.prototype.get=ac,ot.prototype.has=lc,ot.prototype.set=cc;function kt(g){var v=-1,E=g==null?0:g.length;for(this.clear();++v<E;){var U=g[v];this.set(U[0],U[1])}}function uc(){this.size=0,this.__data__={hash:new Ye,map:new(Nr||ot),string:new Ye}}function dc(g){var v=zt(this,g).delete(g);return this.size-=v?1:0,v}function fc(g){return zt(this,g).get(g)}function hc(g){return zt(this,g).has(g)}function gc(g,v){var E=zt(this,g),U=E.size;return E.set(g,v),this.size+=E.size==U?0:1,this}kt.prototype.clear=uc,kt.prototype.delete=dc,kt.prototype.get=fc,kt.prototype.has=hc,kt.prototype.set=gc;function yi(g){var v=-1,E=g==null?0:g.length;for(this.__data__=new kt;++v<E;)this.add(g[v])}function Bo(g){return this.__data__.set(g,r),this}function _i(g){return this.__data__.has(g)}yi.prototype.add=yi.prototype.push=Bo,yi.prototype.has=_i;function sn(g){var v=this.__data__=new ot(g);this.size=v.size}function ws(){this.__data__=new ot,this.size=0}function pc(g){var v=this.__data__,E=v.delete(g);return this.size=v.size,E}function mc(g){return this.__data__.get(g)}function yc(g){return this.__data__.has(g)}function _c(g,v){var E=this.__data__;if(E instanceof ot){var U=E.__data__;if(!Nr||U.length<t-1)return U.push([g,v]),this.size=++E.size,this;E=this.__data__=new kt(U)}return E.set(g,v),this.size=E.size,this}sn.prototype.clear=ws,sn.prototype.delete=pc,sn.prototype.get=mc,sn.prototype.has=yc,sn.prototype.set=_c;function bc(g,v){var E=vi(g),U=!E&&Ho(g),le=!E&&!U&&ki(g),te=!E&&!U&&!le&&Go(g),be=E||U||le||te,_e=be?Jl(g.length,String):[],Le=_e.length;for(var xe in g)Pt.call(g,xe)&&!(be&&(xe=="length"||le&&(xe=="offset"||xe=="parent")||te&&(xe=="buffer"||xe=="byteLength"||xe=="byteOffset")||Ec(xe,Le)))&&_e.push(xe);return _e}function bi(g,v){for(var E=g.length;E--;)if(Ko(g[E][0],v))return E;return-1}function xs(g,v,E){var U=v(g);return vi(g)?U:fs(U,E(g))}function Mr(g){return g==null?g===void 0?O:b:Ut&&Ut in Object(g)?Cn(g):Wo(g)}function Uo(g){return an(g)&&Mr(g)==a}function zo(g,v,E,U,le){return g===v?!0:g==null||v==null||!an(g)&&!an(v)?g!==g&&v!==v:vc(g,v,E,U,zo,le)}function vc(g,v,E,U,le,te){var be=vi(g),_e=vi(v),Le=be?l:on(g),xe=_e?l:on(v);Le=Le==a?_:Le,xe=xe==a?_:xe;var at=Le==_,wt=xe==_,je=Le==xe;if(je&&ki(g)){if(!ki(v))return!1;be=!0,at=!1}if(je&&!at)return te||(te=new sn),be||Go(g)?Cs(g,v,E,U,le,te):Cc(g,v,Le,E,U,le,te);if(!(E&i)){var lt=at&&Pt.call(g,"__wrapped__"),Xe=wt&&Pt.call(v,"__wrapped__");if(lt||Xe){var Yn=lt?g.value():g,Sn=Xe?v.value():v;return te||(te=new sn),le(Yn,Sn,E,U,te)}}return je?(te||(te=new sn),Sc(g,v,E,U,le,te)):!1}function kc(g){if(!Vo(g)||Mc(g))return!1;var v=Jo(g)?Yl:re;return v.test(pt(g))}function wc(g){return an(g)&&Ts(g.length)&&!!X[Mr(g)]}function xc(g){if(!Ac(g))return Er(g);var v=[];for(var E in Object(g))Pt.call(g,E)&&E!="constructor"&&v.push(E);return v}function Cs(g,v,E,U,le,te){var be=E&i,_e=g.length,Le=v.length;if(_e!=Le&&!(be&&Le>_e))return!1;var xe=te.get(g);if(xe&&te.get(v))return xe==v;var at=-1,wt=!0,je=E&s?new yi:void 0;for(te.set(g,v),te.set(v,g);++at<_e;){var lt=g[at],Xe=v[at];if(U)var Yn=be?U(Xe,lt,at,v,g,te):U(lt,Xe,at,g,v,te);if(Yn!==void 0){if(Yn)continue;wt=!1;break}if(je){if(!Po(v,function(Sn,Or){if(!di(je,Or)&&(lt===Sn||le(lt,Sn,E,U,te)))return je.push(Or)})){wt=!1;break}}else if(!(lt===Xe||le(lt,Xe,E,U,te))){wt=!1;break}}return te.delete(g),te.delete(v),wt}function Cc(g,v,E,U,le,te,be){switch(E){case N:if(g.byteLength!=v.byteLength||g.byteOffset!=v.byteOffset)return!1;g=g.buffer,v=v.buffer;case x:return!(g.byteLength!=v.byteLength||!te(new jo(g),new jo(v)));case u:case f:case y:return Ko(+g,+v);case d:return g.name==v.name&&g.message==v.message;case I:case D:return g==v+"";case m:var _e=Io;case M:var Le=U&i;if(_e||(_e=rn),g.size!=v.size&&!Le)return!1;var xe=be.get(g);if(xe)return xe==v;U|=s,be.set(g,v);var at=Cs(_e(g),_e(v),U,le,te,be);return be.delete(g),at;case A:if(ks)return ks.call(g)==ks.call(v)}return!1}function Sc(g,v,E,U,le,te){var be=E&i,_e=Ar(g),Le=_e.length,xe=Ar(v),at=xe.length;if(Le!=at&&!be)return!1;for(var wt=Le;wt--;){var je=_e[wt];if(!(be?je in v:Pt.call(v,je)))return!1}var lt=te.get(g);if(lt&&te.get(v))return lt==v;var Xe=!0;te.set(g,v),te.set(v,g);for(var Yn=be;++wt<Le;){je=_e[wt];var Sn=g[je],Or=v[je];if(U)var Wf=be?U(Or,Sn,je,v,g,te):U(Sn,Or,je,g,v,te);if(!(Wf===void 0?Sn===Or||le(Sn,Or,E,U,te):Wf)){Xe=!1;break}Yn||(Yn=je=="constructor")}if(Xe&&!Yn){var Yo=g.constructor,Xo=v.constructor;Yo!=Xo&&"constructor"in g&&"constructor"in v&&!(typeof Yo=="function"&&Yo instanceof Yo&&typeof Xo=="function"&&Xo instanceof Xo)&&(Xe=!1)}return te.delete(g),te.delete(v),Xe}function Ar(g){return xs(g,Es,Tc)}function zt(g,v){var E=g.__data__;return Nc(v)?E[typeof v=="string"?"string":"hash"]:E.map}function xn(g,v){var E=hs(g,v);return kc(E)?E:void 0}function Cn(g){var v=Pt.call(g,Ut),E=g[Ut];try{g[Ut]=void 0;var U=!0}catch{}var le=Lo.call(g);return U&&(v?g[Ut]=E:delete g[Ut]),le}var Tc=mi?function(g){return g==null?[]:(g=Object(g),st(mi(g),function(v){return pi.call(g,v)}))}:$c,on=Mr;(ys&&on(new ys(new ArrayBuffer(1)))!=N||Nr&&on(new Nr)!=m||_s&&on(_s.resolve())!=w||bs&&on(new bs)!=M||vs&&on(new vs)!=B)&&(on=function(g){var v=Mr(g),E=v==_?g.constructor:void 0,U=E?pt(E):"";if(U)switch(U){case Fo:return N;case wn:return m;case Xl:return w;case Ql:return M;case Zl:return B}return v});function Ec(g,v){return v=v??o,!!v&&(typeof g=="number"||oe.test(g))&&g>-1&&g%1==0&&g<v}function Nc(g){var v=typeof g;return v=="string"||v=="number"||v=="symbol"||v=="boolean"?g!=="__proto__":g===null}function Mc(g){return!!Do&&Do in g}function Ac(g){var v=g&&g.constructor,E=typeof v=="function"&&v.prototype||Sr;return g===E}function Wo(g){return Lo.call(g)}function pt(g){if(g!=null){try{return gs.call(g)}catch{}try{return g+""}catch{}}return""}function Ko(g,v){return g===v||g!==g&&v!==v}var Ho=Uo(function(){return arguments}())?Uo:function(g){return an(g)&&Pt.call(g,"callee")&&!pi.call(g,"callee")},vi=Array.isArray;function Ss(g){return g!=null&&Ts(g.length)&&!Jo(g)}var ki=ms||Pc;function Oc(g,v){return zo(g,v)}function Jo(g){if(!Vo(g))return!1;var v=Mr(g);return v==h||v==p||v==c||v==T}function Ts(g){return typeof g=="number"&&g>-1&&g%1==0&&g<=o}function Vo(g){var v=typeof g;return g!=null&&(v=="object"||v=="function")}function an(g){return g!=null&&typeof g=="object"}var Go=De?Vl(De):wc;function Es(g){return Ss(g)?bc(g):xc(g)}function $c(){return[]}function Pc(){return!1}n.exports=Oc}(js,js.exports)),js.exports}var sa={},Vh;function Ox(){if(Vh)return sa;Vh=1,Object.defineProperty(sa,"__esModule",{value:!0});const n=Qy(),e=Zy();var t;return function(r){function i(l={},c={},u=!1){typeof l!="object"&&(l={}),typeof c!="object"&&(c={});let f=n(c);u||(f=Object.keys(f).reduce((d,h)=>(f[h]!=null&&(d[h]=f[h]),d),{}));for(const d in l)l[d]!==void 0&&c[d]===void 0&&(f[d]=l[d]);return Object.keys(f).length>0?f:void 0}r.compose=i;function s(l={},c={}){typeof l!="object"&&(l={}),typeof c!="object"&&(c={});const u=Object.keys(l).concat(Object.keys(c)).reduce((f,d)=>(e(l[d],c[d])||(f[d]=c[d]===void 0?null:c[d]),f),{});return Object.keys(u).length>0?u:void 0}r.diff=s;function o(l={},c={}){l=l||{};const u=Object.keys(c).reduce((f,d)=>(c[d]!==l[d]&&l[d]!==void 0&&(f[d]=c[d]),f),{});return Object.keys(l).reduce((f,d)=>(l[d]!==c[d]&&c[d]===void 0&&(f[d]=null),f),u)}r.invert=o;function a(l,c,u=!1){if(typeof l!="object")return c;if(typeof c!="object")return;if(!u)return c;const f=Object.keys(c).reduce((d,h)=>(l[h]===void 0&&(d[h]=c[h]),d),{});return Object.keys(f).length>0?f:void 0}r.transform=a}(t||(t={})),sa.default=t,sa}var oa={},Gh;function e_(){if(Gh)return oa;Gh=1,Object.defineProperty(oa,"__esModule",{value:!0});var n;return function(e){function t(r){return typeof r.delete=="number"?r.delete:typeof r.retain=="number"?r.retain:typeof r.retain=="object"&&r.retain!==null?1:typeof r.insert=="string"?r.insert.length:1}e.length=t}(n||(n={})),oa.default=n,oa}var aa={},Yh;function $x(){if(Yh)return aa;Yh=1,Object.defineProperty(aa,"__esModule",{value:!0});const n=e_();class e{constructor(r){this.ops=r,this.index=0,this.offset=0}hasNext(){return this.peekLength()<1/0}next(r){r||(r=1/0);const i=this.ops[this.index];if(i){const s=this.offset,o=n.default.length(i);if(r>=o-s?(r=o-s,this.index+=1,this.offset=0):this.offset+=r,typeof i.delete=="number")return{delete:r};{const a={};return i.attributes&&(a.attributes=i.attributes),typeof i.retain=="number"?a.retain=r:typeof i.retain=="object"&&i.retain!==null?a.retain=i.retain:typeof i.insert=="string"?a.insert=i.insert.substr(s,r):a.insert=i.insert,a}}else return{retain:1/0}}peek(){return this.ops[this.index]}peekLength(){return this.ops[this.index]?n.default.length(this.ops[this.index])-this.offset:1/0}peekType(){const r=this.ops[this.index];return r?typeof r.delete=="number"?"delete":typeof r.retain=="number"||typeof r.retain=="object"&&r.retain!==null?"retain":"insert":"retain"}rest(){if(this.hasNext()){if(this.offset===0)return this.ops.slice(this.index);{const r=this.offset,i=this.index,s=this.next(),o=this.ops.slice(this.index);return this.offset=r,this.index=i,[s].concat(o)}}else return[]}}return aa.default=e,aa}var Xh;function Px(){return Xh||(Xh=1,function(n,e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeMap=e.OpIterator=e.Op=void 0;const t=Ax(),r=Qy(),i=Zy(),s=Ox();e.AttributeMap=s.default;const o=e_();e.Op=o.default;const a=$x();e.OpIterator=a.default;const l="\0",c=(f,d)=>{if(typeof f!="object"||f===null)throw new Error(`cannot retain a ${typeof f}`);if(typeof d!="object"||d===null)throw new Error(`cannot retain a ${typeof d}`);const h=Object.keys(f)[0];if(!h||h!==Object.keys(d)[0])throw new Error(`embed types not matched: ${h} != ${Object.keys(d)[0]}`);return[h,f[h],d[h]]};class u{constructor(d){Array.isArray(d)?this.ops=d:d!=null&&Array.isArray(d.ops)?this.ops=d.ops:this.ops=[]}static registerEmbed(d,h){this.handlers[d]=h}static unregisterEmbed(d){delete this.handlers[d]}static getHandler(d){const h=this.handlers[d];if(!h)throw new Error(`no handlers for embed type "${d}"`);return h}insert(d,h){const p={};return typeof d=="string"&&d.length===0?this:(p.insert=d,h!=null&&typeof h=="object"&&Object.keys(h).length>0&&(p.attributes=h),this.push(p))}delete(d){return d<=0?this:this.push({delete:d})}retain(d,h){if(typeof d=="number"&&d<=0)return this;const p={retain:d};return h!=null&&typeof h=="object"&&Object.keys(h).length>0&&(p.attributes=h),this.push(p)}push(d){let h=this.ops.length,p=this.ops[h-1];if(d=r(d),typeof p=="object"){if(typeof d.delete=="number"&&typeof p.delete=="number")return this.ops[h-1]={delete:p.delete+d.delete},this;if(typeof p.delete=="number"&&d.insert!=null&&(h-=1,p=this.ops[h-1],typeof p!="object"))return this.ops.unshift(d),this;if(i(d.attributes,p.attributes)){if(typeof d.insert=="string"&&typeof p.insert=="string")return this.ops[h-1]={insert:p.insert+d.insert},typeof d.attributes=="object"&&(this.ops[h-1].attributes=d.attributes),this;if(typeof d.retain=="number"&&typeof p.retain=="number")return this.ops[h-1]={retain:p.retain+d.retain},typeof d.attributes=="object"&&(this.ops[h-1].attributes=d.attributes),this}}return h===this.ops.length?this.ops.push(d):this.ops.splice(h,0,d),this}chop(){const d=this.ops[this.ops.length-1];return d&&typeof d.retain=="number"&&!d.attributes&&this.ops.pop(),this}filter(d){return this.ops.filter(d)}forEach(d){this.ops.forEach(d)}map(d){return this.ops.map(d)}partition(d){const h=[],p=[];return this.forEach(m=>{(d(m)?h:p).push(m)}),[h,p]}reduce(d,h){return this.ops.reduce(d,h)}changeLength(){return this.reduce((d,h)=>h.insert?d+o.default.length(h):h.delete?d-h.delete:d,0)}length(){return this.reduce((d,h)=>d+o.default.length(h),0)}slice(d=0,h=1/0){const p=[],m=new a.default(this.ops);let y=0;for(;y<h&&m.hasNext();){let b;y<d?b=m.next(d-y):(b=m.next(h-y),p.push(b)),y+=o.default.length(b)}return new u(p)}compose(d){const h=new a.default(this.ops),p=new a.default(d.ops),m=[],y=p.peek();if(y!=null&&typeof y.retain=="number"&&y.attributes==null){let _=y.retain;for(;h.peekType()==="insert"&&h.peekLength()<=_;)_-=h.peekLength(),m.push(h.next());y.retain-_>0&&p.next(y.retain-_)}const b=new u(m);for(;h.hasNext()||p.hasNext();)if(p.peekType()==="insert")b.push(p.next());else if(h.peekType()==="delete")b.push(h.next());else{const _=Math.min(h.peekLength(),p.peekLength()),w=h.next(_),T=p.next(_);if(T.retain){const I={};if(typeof w.retain=="number")I.retain=typeof T.retain=="number"?_:T.retain;else if(typeof T.retain=="number")w.retain==null?I.insert=w.insert:I.retain=w.retain;else{const D=w.retain==null?"insert":"retain",[A,O,B]=c(w[D],T.retain),x=u.getHandler(A);I[D]={[A]:x.compose(O,B,D==="retain")}}const M=s.default.compose(w.attributes,T.attributes,typeof w.retain=="number");if(M&&(I.attributes=M),b.push(I),!p.hasNext()&&i(b.ops[b.ops.length-1],I)){const D=new u(h.rest());return b.concat(D).chop()}}else typeof T.delete=="number"&&(typeof w.retain=="number"||typeof w.retain=="object"&&w.retain!==null)&&b.push(T)}return b.chop()}concat(d){const h=new u(this.ops.slice());return d.ops.length>0&&(h.push(d.ops[0]),h.ops=h.ops.concat(d.ops.slice(1))),h}diff(d,h){if(this.ops===d.ops)return new u;const p=[this,d].map(w=>w.map(T=>{if(T.insert!=null)return typeof T.insert=="string"?T.insert:l;const I=w===d?"on":"with";throw new Error("diff() called "+I+" non-document")}).join("")),m=new u,y=t(p[0],p[1],h,!0),b=new a.default(this.ops),_=new a.default(d.ops);return y.forEach(w=>{let T=w[1].length;for(;T>0;){let I=0;switch(w[0]){case t.INSERT:I=Math.min(_.peekLength(),T),m.push(_.next(I));break;case t.DELETE:I=Math.min(T,b.peekLength()),b.next(I),m.delete(I);break;case t.EQUAL:I=Math.min(b.peekLength(),_.peekLength(),T);const M=b.next(I),D=_.next(I);i(M.insert,D.insert)?m.retain(I,s.default.diff(M.attributes,D.attributes)):m.push(D).delete(I);break}T-=I}}),m.chop()}eachLine(d,h=`
`){const p=new a.default(this.ops);let m=new u,y=0;for(;p.hasNext();){if(p.peekType()!=="insert")return;const b=p.peek(),_=o.default.length(b)-p.peekLength(),w=typeof b.insert=="string"?b.insert.indexOf(h,_)-_:-1;if(w<0)m.push(p.next());else if(w>0)m.push(p.next(w));else{if(d(m,p.next(1).attributes||{},y)===!1)return;y+=1,m=new u}}m.length()>0&&d(m,{},y)}invert(d){const h=new u;return this.reduce((p,m)=>{if(m.insert)h.delete(o.default.length(m));else{if(typeof m.retain=="number"&&m.attributes==null)return h.retain(m.retain),p+m.retain;if(m.delete||typeof m.retain=="number"){const y=m.delete||m.retain;return d.slice(p,p+y).forEach(_=>{m.delete?h.push(_):m.retain&&m.attributes&&h.retain(o.default.length(_),s.default.invert(m.attributes,_.attributes))}),p+y}else if(typeof m.retain=="object"&&m.retain!==null){const y=d.slice(p,p+1),b=new a.default(y.ops).next(),[_,w,T]=c(m.retain,b.insert),I=u.getHandler(_);return h.retain({[_]:I.invert(w,T)},s.default.invert(m.attributes,b.attributes)),p+1}}return p},0),h.chop()}transform(d,h=!1){if(h=!!h,typeof d=="number")return this.transformPosition(d,h);const p=d,m=new a.default(this.ops),y=new a.default(p.ops),b=new u;for(;m.hasNext()||y.hasNext();)if(m.peekType()==="insert"&&(h||y.peekType()!=="insert"))b.retain(o.default.length(m.next()));else if(y.peekType()==="insert")b.push(y.next());else{const _=Math.min(m.peekLength(),y.peekLength()),w=m.next(_),T=y.next(_);if(w.delete)continue;if(T.delete)b.push(T);else{const I=w.retain,M=T.retain;let D=typeof M=="object"&&M!==null?M:_;if(typeof I=="object"&&I!==null&&typeof M=="object"&&M!==null){const A=Object.keys(I)[0];if(A===Object.keys(M)[0]){const O=u.getHandler(A);O&&(D={[A]:O.transform(I[A],M[A],h)})}}b.retain(D,s.default.transform(w.attributes,T.attributes,h))}}return b.chop()}transformPosition(d,h=!1){h=!!h;const p=new a.default(this.ops);let m=0;for(;p.hasNext()&&m<=d;){const y=p.peekLength(),b=p.peekType();if(p.next(),b==="delete"){d-=Math.min(y,d-m);continue}else b==="insert"&&(m<d||!h)&&(d+=y);m+=y}return d}}u.Op=o.default,u.OpIterator=a.default,u.AttributeMap=s.default,u.handlers={},e.default=u,n.exports=u,n.exports.default=u}(ia,ia.exports)),ia.exports}var Ix=Px();const Fs=Bv(Ix);var Rx=Object.getOwnPropertyNames,Dx=Object.getOwnPropertySymbols,Lx=Object.prototype.hasOwnProperty;function Qh(n,e){return function(r,i,s){return n(r,i,s)&&e(r,i,s)}}function la(n){return function(t,r,i){if(!t||!r||typeof t!="object"||typeof r!="object")return n(t,r,i);var s=i.cache,o=s.get(t),a=s.get(r);if(o&&a)return o===r&&a===t;s.set(t,r),s.set(r,t);var l=n(t,r,i);return s.delete(t),s.delete(r),l}}function Zh(n){return Rx(n).concat(Dx(n))}var jx=Object.hasOwn||function(n,e){return Lx.call(n,e)};function ai(n,e){return n===e||!n&&!e&&n!==n&&e!==e}var Fx="__v",qx="__o",Bx="_owner",eg=Object.getOwnPropertyDescriptor,tg=Object.keys;function Ux(n,e,t){var r=n.length;if(e.length!==r)return!1;for(;r-- >0;)if(!t.equals(n[r],e[r],r,r,n,e,t))return!1;return!0}function zx(n,e){return ai(n.getTime(),e.getTime())}function Wx(n,e){return n.name===e.name&&n.message===e.message&&n.cause===e.cause&&n.stack===e.stack}function Kx(n,e){return n===e}function ng(n,e,t){var r=n.size;if(r!==e.size)return!1;if(!r)return!0;for(var i=new Array(r),s=n.entries(),o,a,l=0;(o=s.next())&&!o.done;){for(var c=e.entries(),u=!1,f=0;(a=c.next())&&!a.done;){if(i[f]){f++;continue}var d=o.value,h=a.value;if(t.equals(d[0],h[0],l,f,n,e,t)&&t.equals(d[1],h[1],d[0],h[0],n,e,t)){u=i[f]=!0;break}f++}if(!u)return!1;l++}return!0}var Hx=ai;function Jx(n,e,t){var r=tg(n),i=r.length;if(tg(e).length!==i)return!1;for(;i-- >0;)if(!t_(n,e,t,r[i]))return!1;return!0}function As(n,e,t){var r=Zh(n),i=r.length;if(Zh(e).length!==i)return!1;for(var s,o,a;i-- >0;)if(s=r[i],!t_(n,e,t,s)||(o=eg(n,s),a=eg(e,s),(o||a)&&(!o||!a||o.configurable!==a.configurable||o.enumerable!==a.enumerable||o.writable!==a.writable)))return!1;return!0}function Vx(n,e){return ai(n.valueOf(),e.valueOf())}function Gx(n,e){return n.source===e.source&&n.flags===e.flags}function rg(n,e,t){var r=n.size;if(r!==e.size)return!1;if(!r)return!0;for(var i=new Array(r),s=n.values(),o,a;(o=s.next())&&!o.done;){for(var l=e.values(),c=!1,u=0;(a=l.next())&&!a.done;){if(!i[u]&&t.equals(o.value,a.value,o.value,a.value,n,e,t)){c=i[u]=!0;break}u++}if(!c)return!1}return!0}function Yx(n,e){var t=n.length;if(e.length!==t)return!1;for(;t-- >0;)if(n[t]!==e[t])return!1;return!0}function Xx(n,e){return n.hostname===e.hostname&&n.pathname===e.pathname&&n.protocol===e.protocol&&n.port===e.port&&n.hash===e.hash&&n.username===e.username&&n.password===e.password}function t_(n,e,t,r){return(r===Bx||r===qx||r===Fx)&&(n.$$typeof||e.$$typeof)?!0:jx(e,r)&&t.equals(n[r],e[r],r,r,n,e,t)}var Qx="[object Arguments]",Zx="[object Boolean]",eC="[object Date]",tC="[object Error]",nC="[object Map]",rC="[object Number]",iC="[object Object]",sC="[object RegExp]",oC="[object Set]",aC="[object String]",lC="[object URL]",cC=Array.isArray,ig=typeof ArrayBuffer=="function"&&ArrayBuffer.isView?ArrayBuffer.isView:null,sg=Object.assign,uC=Object.prototype.toString.call.bind(Object.prototype.toString);function dC(n){var e=n.areArraysEqual,t=n.areDatesEqual,r=n.areErrorsEqual,i=n.areFunctionsEqual,s=n.areMapsEqual,o=n.areNumbersEqual,a=n.areObjectsEqual,l=n.arePrimitiveWrappersEqual,c=n.areRegExpsEqual,u=n.areSetsEqual,f=n.areTypedArraysEqual,d=n.areUrlsEqual;return function(p,m,y){if(p===m)return!0;if(p==null||m==null)return!1;var b=typeof p;if(b!==typeof m)return!1;if(b!=="object")return b==="number"?o(p,m,y):b==="function"?i(p,m,y):!1;var _=p.constructor;if(_!==m.constructor)return!1;if(_===Object)return a(p,m,y);if(cC(p))return e(p,m,y);if(ig!=null&&ig(p))return f(p,m,y);if(_===Date)return t(p,m,y);if(_===RegExp)return c(p,m,y);if(_===Map)return s(p,m,y);if(_===Set)return u(p,m,y);var w=uC(p);return w===eC?t(p,m,y):w===sC?c(p,m,y):w===nC?s(p,m,y):w===oC?u(p,m,y):w===iC?typeof p.then!="function"&&typeof m.then!="function"&&a(p,m,y):w===lC?d(p,m,y):w===tC?r(p,m,y):w===Qx?a(p,m,y):w===Zx||w===rC||w===aC?l(p,m,y):!1}}function fC(n){var e=n.circular,t=n.createCustomConfig,r=n.strict,i={areArraysEqual:r?As:Ux,areDatesEqual:zx,areErrorsEqual:Wx,areFunctionsEqual:Kx,areMapsEqual:r?Qh(ng,As):ng,areNumbersEqual:Hx,areObjectsEqual:r?As:Jx,arePrimitiveWrappersEqual:Vx,areRegExpsEqual:Gx,areSetsEqual:r?Qh(rg,As):rg,areTypedArraysEqual:r?As:Yx,areUrlsEqual:Xx};if(t&&(i=sg({},i,t(i))),e){var s=la(i.areArraysEqual),o=la(i.areMapsEqual),a=la(i.areObjectsEqual),l=la(i.areSetsEqual);i=sg({},i,{areArraysEqual:s,areMapsEqual:o,areObjectsEqual:a,areSetsEqual:l})}return i}function hC(n){return function(e,t,r,i,s,o,a){return n(e,t,a)}}function gC(n){var e=n.circular,t=n.comparator,r=n.createState,i=n.equals,s=n.strict;if(r)return function(l,c){var u=r(),f=u.cache,d=f===void 0?e?new WeakMap:void 0:f,h=u.meta;return t(l,c,{cache:d,equals:i,meta:h,strict:s})};if(e)return function(l,c){return t(l,c,{cache:new WeakMap,equals:i,meta:void 0,strict:s})};var o={cache:void 0,equals:i,meta:void 0,strict:s};return function(l,c){return t(l,c,o)}}var Pn=vr();vr({strict:!0});vr({circular:!0});vr({circular:!0,strict:!0});vr({createInternalComparator:function(){return ai}});vr({strict:!0,createInternalComparator:function(){return ai}});vr({circular:!0,createInternalComparator:function(){return ai}});vr({circular:!0,createInternalComparator:function(){return ai},strict:!0});function vr(n){n===void 0&&(n={});var e=n.circular,t=e===void 0?!1:e,r=n.createInternalComparator,i=n.createState,s=n.strict,o=s===void 0?!1:s,a=fC(n),l=dC(a),c=r?r(l):hC(l);return gC({circular:t,comparator:l,createState:i,equals:c,strict:o})}const n_=k.createContext(null);function pC(n,e){return{getTheme:function(){return e??null}}}function ge(){const n=k.useContext(n_);return n==null&&function(e,...t){const r=new URL("https://lexical.dev/docs/error"),i=new URLSearchParams;i.append("code",e);for(const s of t)i.append("v",s);throw r.search=i.toString(),Error(`Minified Lexical error #${e}; visit ${r.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}(8),n}function mC(n,e){const t=e.body?e.body.childNodes:[];let r=[];const i=[];for(let s=0;s<t.length;s++){const o=t[s];if(!s_.has(o.nodeName)){const a=o_(o,n,i,!1);a!==null&&(r=r.concat(a))}}return function(s){for(const o of s)o.getNextSibling()instanceof Ud&&o.insertAfter(Kr());for(const o of s){const a=o.getChildren();for(const l of a)o.insertBefore(l);o.remove()}}(i),r}function r_(n,e){if(typeof document>"u"||typeof window>"u"&&global.window===void 0)throw new Error("To use $generateHtmlFromNodes in headless mode please initialize a headless browser implementation such as JSDom before calling this function.");const t=document.createElement("div"),r=ye().getChildren();for(let i=0;i<r.length;i++)i_(n,r[i],t,e);return t.innerHTML}function i_(n,e,t,r=null){let i=r===null||e.isSelected(r);const s=F(e)&&e.excludeFromCopy("html");let o=e;if(r!==null){let h=Zd(e);h=W(h)&&r!==null?Hy(r,h):h,o=h}const a=F(o)?o.getChildren():[],l=Kd(n,o.getType());let c;c=l&&l.exportDOM!==void 0?l.exportDOM(n,o):o.exportDOM(n);const{element:u,after:f}=c;if(!u)return!1;const d=document.createDocumentFragment();for(let h=0;h<a.length;h++){const p=a[h],m=i_(n,p,d,r);!i&&F(e)&&m&&e.extractWithChild(p,r,"html")&&(i=!0)}if(i&&!s){if((Ne(u)||Iu(u))&&u.append(d),t.append(u),f){const h=f.call(o,u);h&&(Iu(u)?u.replaceChildren(h):u.replaceWith(h))}}else t.append(d);return i}const s_=new Set(["STYLE","SCRIPT"]);function o_(n,e,t,r,i=new Map,s){let o=[];if(s_.has(n.nodeName))return o;let a=null;const l=function(p,m){const{nodeName:y}=p,b=m._htmlConversions.get(y.toLowerCase());let _=null;if(b!==void 0)for(const w of b){const T=w(p);T!==null&&(_===null||(_.priority||0)<=(T.priority||0))&&(_=T)}return _!==null?_.conversion:null}(n,e),c=l?l(n):null;let u=null;if(c!==null){u=c.after;const p=c.node;if(a=Array.isArray(p)?p[p.length-1]:p,a!==null){for(const[,m]of i)if(a=m(a,s),!a)break;a&&o.push(...Array.isArray(p)?p:[a])}c.forChild!=null&&i.set(n.nodeName,c.forChild)}const f=n.childNodes;let d=[];const h=(a==null||!vn(a))&&(a!=null&&Nu(a)||r);for(let p=0;p<f.length;p++)d.push(...o_(f[p],e,t,h,new Map(i),a));return u!=null&&(d=u(d)),il(n)&&(d=yC(n,d,h?()=>{const p=new Ud;return t.push(p),p}:$t)),a==null?d.length>0?o=o.concat(d):il(n)&&function(p){return p.nextSibling==null||p.previousSibling==null?!1:Ru(p.nextSibling)&&Ru(p.previousSibling)}(n)&&(o=o.concat(Kr())):F(a)&&a.append(...d),o}function yC(n,e,t){const r=n.style.textAlign,i=[];let s=[];for(let o=0;o<e.length;o++){const a=e[o];if(Nu(a))r&&!a.getFormat()&&a.setFormat(r),i.push(a);else if(s.push(a),o===e.length-1||o<e.length-1&&Nu(e[o+1])){const l=t();l.setFormat(r),l.append(...s),i.push(l),s=[]}}return i}const _C=new Set(["http:","https:","mailto:","sms:","tel:"]);let a_=class l_ extends gt{static getType(){return"link"}static clone(e){return new l_(e.__url,{rel:e.__rel,target:e.__target,title:e.__title},e.__key)}constructor(e="",t={},r){super(r);const{target:i=null,rel:s=null,title:o=null}=t;this.__url=e,this.__target=i,this.__rel=s,this.__title=o}createDOM(e){const t=document.createElement("a");return this.updateLinkDOM(null,t,e),ct(t,e.theme.link),t}updateLinkDOM(e,t,r){if(Fy(t)){e&&e.__url===this.__url||(t.href=this.sanitizeUrl(this.__url));for(const i of["target","rel","title"]){const s=`__${i}`,o=this[s];e&&e[s]===o||(o?t[i]=o:t.removeAttribute(i))}}}updateDOM(e,t,r){return this.updateLinkDOM(e,t,r),!1}static importDOM(){return{a:e=>({conversion:bC,priority:1})}}static importJSON(e){return qu().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setURL(e.url).setRel(e.rel||null).setTarget(e.target||null).setTitle(e.title||null)}sanitizeUrl(e){e=og(e);try{const t=new URL(og(e));if(!_C.has(t.protocol))return"about:blank"}catch{return e}return e}exportJSON(){return{...super.exportJSON(),rel:this.getRel(),target:this.getTarget(),title:this.getTitle(),url:this.getURL()}}getURL(){return this.getLatest().__url}setURL(e){const t=this.getWritable();return t.__url=e,t}getTarget(){return this.getLatest().__target}setTarget(e){const t=this.getWritable();return t.__target=e,t}getRel(){return this.getLatest().__rel}setRel(e){const t=this.getWritable();return t.__rel=e,t}getTitle(){return this.getLatest().__title}setTitle(e){const t=this.getWritable();return t.__title=e,t}insertNewAfter(e,t=!0){const r=qu(this.__url,{rel:this.__rel,target:this.__target,title:this.__title});return this.insertAfter(r,t),r}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}canBeEmpty(){return!1}isInline(){return!0}extractWithChild(e,t,r){if(!q(t))return!1;const i=t.anchor.getNode(),s=t.focus.getNode();return this.isParentOf(i)&&this.isParentOf(s)&&t.getTextContent().length>0}isEmailURI(){return this.__url.startsWith("mailto:")}isWebSiteURI(){return this.__url.startsWith("https://")||this.__url.startsWith("http://")}};function bC(n){let e=null;if(Fy(n)){const t=n.textContent;(t!==null&&t!==""||n.children.length>0)&&(e=qu(n.getAttribute("href")||"",{rel:n.getAttribute("rel"),target:n.getAttribute("target"),title:n.getAttribute("title")}))}return{node:e}}function qu(n="",e){return Ae(new a_(n,e))}function vC(n){return n instanceof a_}const kC=/^\+?[0-9\s()-]{5,}$/;function og(n){return n.match(/^[a-z][a-z0-9+.-]*:/i)||n.match(/^[/#.]/)?n:n.includes("@")?`mailto:${n}`:kC.test(n)?`tel:${n}`:`https://${n}`}const c_=[];let u_=class d_ extends gt{static getType(){return"mark"}static clone(e){return new d_(e.__ids,e.__key)}static importDOM(){return null}static importJSON(e){return ag().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setIDs(e.ids)}exportJSON(){return{...super.exportJSON(),ids:this.getIDs()}}constructor(e=c_,t){super(t),this.__ids=e}createDOM(e){const t=document.createElement("mark");return ct(t,e.theme.mark),this.__ids.length>1&&ct(t,e.theme.markOverlap),t}updateDOM(e,t,r){const i=e.__ids,s=this.__ids,o=i.length,a=s.length,l=r.theme.markOverlap;return o!==a&&(o===1?a===2&&ct(t,l):a===1&&qr(t,l)),!1}hasID(e){return this.getIDs().includes(e)}getIDs(){return Array.from(this.getLatest().__ids)}setIDs(e){const t=this.getWritable();return t.__ids=e,t}addID(e){const t=this.getWritable();return t.__ids.includes(e)?t:t.setIDs([...t.__ids,e])}deleteID(e){const t=this.getWritable(),r=t.__ids.indexOf(e);if(r===-1)return t;const i=Array.from(t.__ids);return i.splice(r,1),t.setIDs(i)}insertNewAfter(e,t=!0){const r=ag(this.__ids);return this.insertAfter(r,t),r}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}canBeEmpty(){return!1}isInline(){return!0}extractWithChild(e,t,r){if(!q(t)||r==="html")return!1;const i=t.anchor,s=t.focus,o=i.getNode(),a=s.getNode(),l=t.isBackward()?i.offset-s.offset:s.offset-i.offset;return this.isParentOf(o)&&this.isParentOf(a)&&this.getTextContent().length===l}excludeFromCopy(e){return e!=="clone"}};function ag(n=c_){return Ae(new u_(n))}function wC(n){return n instanceof u_}function cl(n,...e){const t=new URL("https://lexical.dev/docs/error"),r=new URLSearchParams;r.append("code",n);for(const i of e)r.append("v",i);throw t.search=r.toString(),Error(`Minified Lexical error #${n}; visit ${t.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}function f_(n,e=K()){return e==null&&cl(166),q(e)&&e.isCollapsed()||e.getNodes().length===0?"":r_(n,e)}function xC(n,e=K()){return e==null&&cl(166),q(e)&&e.isCollapsed()||e.getNodes().length===0?null:JSON.stringify(CC(n,e))}function lg(n,e){const t=n.getData("text/plain")||n.getData("text/uri-list");t!=null&&e.insertRawText(t)}function cg(n,e,t){const r=n.getData("application/x-lexical-editor");if(r)try{const a=JSON.parse(r);if(a.namespace===t._config.namespace&&Array.isArray(a.nodes))return ug(t,SC(a.nodes),e)}catch{}const i=n.getData("text/html"),s=n.getData("text/plain");if(i&&s!==i)try{const a=new DOMParser().parseFromString(function(l){return window.trustedTypes&&window.trustedTypes.createPolicy?window.trustedTypes.createPolicy("lexical",{createHTML:c=>c}).createHTML(l):l}(i),"text/html");return ug(t,mC(t,a),e)}catch{}const o=s||n.getData("text/uri-list");if(o!=null)if(q(e)){const a=o.split(/(\r?\n|\t)/);a[a.length-1]===""&&a.pop();for(let l=0;l<a.length;l++){const c=K();if(q(c)){const u=a[l];u===`
`||u===`\r
`?c.insertParagraph():u==="	"?c.insertNodes([_o()]):c.insertText(u)}}}else e.insertRawText(o)}function ug(n,e,t){n.dispatchCommand(ow,{nodes:e,selection:t})||(t.insertNodes(e),function(r){if(q(r)&&r.isCollapsed()){const i=r.anchor;let s=null;const o=qn(i,"previous");if(o)if(sr(o))s=o.origin;else{const a=ur(o,Xt(ye(),"next").getFlipped());for(const l of a){if(W(l.origin)){s=l.origin;break}if(F(l.origin)&&!l.origin.isInline())break}}if(s&&W(s)){const a=s.getFormat(),l=s.getStyle();r.format===a&&r.style===l||(r.format=a,r.style=l,r.dirty=!0)}}}(t))}function h_(n,e,t,r=[]){let i=e===null||t.isSelected(e);const s=F(t)&&t.excludeFromCopy("html");let o=t;if(e!==null){let c=Zd(t);c=W(c)&&e!==null?Hy(e,c):c,o=c}const a=F(o)?o.getChildren():[],l=function(c){const u=c.exportJSON(),f=c.constructor;if(u.type!==f.getType()&&cl(58,f.name),F(c)){const d=u.children;Array.isArray(d)||cl(59,f.name)}return u}(o);if(W(o)){const c=o.__text;c.length>0?l.text=c:i=!1}for(let c=0;c<a.length;c++){const u=a[c],f=h_(n,e,u,l.children);!i&&F(t)&&f&&t.extractWithChild(u,e,"clone")&&(i=!0)}if(i&&!s)r.push(l);else if(Array.isArray(l.children))for(let c=0;c<l.children.length;c++){const u=l.children[c];r.push(u)}return i}function CC(n,e){const t=[],r=ye().getChildren();for(let i=0;i<r.length;i++)h_(n,e,r[i],t);return{namespace:n._config.namespace,nodes:t}}function SC(n){const e=[];for(let t=0;t<n.length;t++){const r=n[t],i=ky(r);W(i)&&hx(i),e.push(i)}return e}let xi=null;async function dg(n,e,t){if(xi!==null)return!1;if(e!==null)return new Promise((c,u)=>{n.update(()=>{c(fg(n,e,t))})});const r=n.getRootElement(),i=n._window||window,s=window.document,o=Yt(i);if(r===null||o===null)return!1;const a=s.createElement("span");a.style.cssText="position: fixed; top: -1000px;",a.append(s.createTextNode("#")),r.append(a);const l=new Range;return l.setStart(a,0),l.setEnd(a,1),o.removeAllRanges(),o.addRange(l),new Promise((c,u)=>{const f=n.registerCommand(mr,d=>(Ln(d,ClipboardEvent)&&(f(),xi!==null&&(window.clearTimeout(xi),xi=null),c(fg(n,d,t))),!0),Mi);xi=window.setTimeout(()=>{f(),xi=null,c(!1)},50),s.execCommand("copy"),a.remove()})}function fg(n,e,t){if(t===void 0){const i=Yt(n._window);if(!i)return!1;const s=i.anchorNode,o=i.focusNode;if(s!==null&&o!==null&&!vo(n,s,o))return!1;const a=K();if(a===null)return!1;t=EC(a)}e.preventDefault();const r=e.clipboardData;return r!==null&&(NC(r,t),!0)}const TC=[["text/html",f_],["application/x-lexical-editor",xC]];function EC(n=K()){const e={"text/plain":n?n.getTextContent():""};if(n){const t=Dl();for(const[r,i]of TC){const s=i(t,n);s!==null&&(e[r]=s)}}return e}function NC(n,e){for(const t in e){const r=e[t];r!==void 0&&n.setData(t,r)}}const sf=/^(\d+(?:\.\d+)?)px$/,Oi={BOTH:3,NO_STATUS:0,ROW:1};let of=class g_ extends gt{static getType(){return"tablecell"}static clone(e){return new g_(e.__headerState,e.__colSpan,e.__width,e.__key)}afterCloneFrom(e){super.afterCloneFrom(e),this.__rowSpan=e.__rowSpan,this.__backgroundColor=e.__backgroundColor,this.__verticalAlign=e.__verticalAlign}static importDOM(){return{td:e=>({conversion:hg,priority:0}),th:e=>({conversion:hg,priority:0})}}static importJSON(e){return p_().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setHeaderStyles(e.headerState).setColSpan(e.colSpan||1).setRowSpan(e.rowSpan||1).setWidth(e.width||void 0).setBackgroundColor(e.backgroundColor||null).setVerticalAlign(e.verticalAlign||void 0)}constructor(e=Oi.NO_STATUS,t=1,r,i){super(i),this.__colSpan=t,this.__rowSpan=1,this.__headerState=e,this.__width=r,this.__backgroundColor=null,this.__verticalAlign=void 0}createDOM(e){const t=document.createElement(this.getTag());return this.__width&&(t.style.width=`${this.__width}px`),this.__colSpan>1&&(t.colSpan=this.__colSpan),this.__rowSpan>1&&(t.rowSpan=this.__rowSpan),this.__backgroundColor!==null&&(t.style.backgroundColor=this.__backgroundColor),Bu(this.__verticalAlign)&&(t.style.verticalAlign=this.__verticalAlign),ct(t,e.theme.tableCell,this.hasHeader()&&e.theme.tableCellHeader),t}exportDOM(e){const t=super.exportDOM(e);if(Ne(t.element)){const r=t.element;r.setAttribute("data-temporary-table-cell-lexical-key",this.getKey()),r.style.border="1px solid black",this.__colSpan>1&&(r.colSpan=this.__colSpan),this.__rowSpan>1&&(r.rowSpan=this.__rowSpan),r.style.width=`${this.getWidth()||75}px`,r.style.verticalAlign=this.getVerticalAlign()||"top",r.style.textAlign="start",this.__backgroundColor===null&&this.hasHeader()&&(r.style.backgroundColor="#f2f3f5")}return t}exportJSON(){return{...super.exportJSON(),...Bu(this.__verticalAlign)&&{verticalAlign:this.__verticalAlign},backgroundColor:this.getBackgroundColor(),colSpan:this.__colSpan,headerState:this.__headerState,rowSpan:this.__rowSpan,width:this.getWidth()}}getColSpan(){return this.getLatest().__colSpan}setColSpan(e){const t=this.getWritable();return t.__colSpan=e,t}getRowSpan(){return this.getLatest().__rowSpan}setRowSpan(e){const t=this.getWritable();return t.__rowSpan=e,t}getTag(){return this.hasHeader()?"th":"td"}setHeaderStyles(e,t=Oi.BOTH){const r=this.getWritable();return r.__headerState=e&t|r.__headerState&~t,r}getHeaderStyles(){return this.getLatest().__headerState}setWidth(e){const t=this.getWritable();return t.__width=e,t}getWidth(){return this.getLatest().__width}getBackgroundColor(){return this.getLatest().__backgroundColor}setBackgroundColor(e){const t=this.getWritable();return t.__backgroundColor=e,t}getVerticalAlign(){return this.getLatest().__verticalAlign}setVerticalAlign(e){const t=this.getWritable();return t.__verticalAlign=e||void 0,t}toggleHeaderStyle(e){const t=this.getWritable();return(t.__headerState&e)===e?t.__headerState-=e:t.__headerState+=e,t}hasHeaderState(e){return(this.getHeaderStyles()&e)===e}hasHeader(){return this.getLatest().__headerState!==Oi.NO_STATUS}updateDOM(e){return e.__headerState!==this.__headerState||e.__width!==this.__width||e.__colSpan!==this.__colSpan||e.__rowSpan!==this.__rowSpan||e.__backgroundColor!==this.__backgroundColor||e.__verticalAlign!==this.__verticalAlign}isShadowRoot(){return!0}collapseAtStart(){return!0}canBeEmpty(){return!1}canIndent(){return!1}};function Bu(n){return n==="middle"||n==="bottom"}function hg(n){const e=n,t=n.nodeName.toLowerCase();let r;sf.test(e.style.width)&&(r=parseFloat(e.style.width));const i=p_(t==="th"?Oi.ROW:Oi.NO_STATUS,e.colSpan,r);i.__rowSpan=e.rowSpan;const s=e.style.backgroundColor;s!==""&&(i.__backgroundColor=s);const o=e.style.verticalAlign;Bu(o)&&(i.__verticalAlign=o);const a=e.style,l=(a&&a.textDecoration||"").split(" "),c=a.fontWeight==="700"||a.fontWeight==="bold",u=l.includes("line-through"),f=a.fontStyle==="italic",d=l.includes("underline");return{after:h=>{const p=[];let m=null;const y=()=>{if(m){const b=m.getFirstChild();Dr(b)&&m.getChildrenSize()===1&&b.remove()}};for(const b of h)zw(b)||W(b)||Dr(b)?(W(b)&&(c&&b.toggleFormat("bold"),u&&b.toggleFormat("strikethrough"),f&&b.toggleFormat("italic"),d&&b.toggleFormat("underline")),m?m.append(b):(m=$t().append(b),p.push(m))):(p.push(b),y(),m=null);return y(),p.length===0&&p.push($t()),p},node:i}}function p_(n=Oi.NO_STATUS,e=1,t){return Ae(new of(n,e,t))}function Ot(n){return n instanceof of}function qe(n,...e){const t=new URL("https://lexical.dev/docs/error"),r=new URLSearchParams;r.append("code",n);for(const i of e)r.append("v",i);throw t.search=r.toString(),Error(`Minified Lexical error #${n}; visit ${t.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}let m_=class y_ extends gt{static getType(){return"tablerow"}static clone(e){return new y_(e.__height,e.__key)}static importDOM(){return{tr:e=>({conversion:MC,priority:0})}}static importJSON(e){return __().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setHeight(e.height)}constructor(e,t){super(t),this.__height=e}exportJSON(){const e=this.getHeight();return{...super.exportJSON(),...e===void 0?void 0:{height:e}}}createDOM(e){const t=document.createElement("tr");return this.__height&&(t.style.height=`${this.__height}px`),ct(t,e.theme.tableRow),t}extractWithChild(e,t,r){return r==="html"}isShadowRoot(){return!0}setHeight(e){const t=this.getWritable();return t.__height=e,t}getHeight(){return this.getLatest().__height}updateDOM(e){return e.__height!==this.__height}canBeEmpty(){return!1}canIndent(){return!1}};function MC(n){const e=n;let t;return sf.test(e.style.height)&&(t=parseFloat(e.style.height)),{after:r=>Xy(r,Ot),node:__(t)}}function __(n){return Ae(new m_(n))}function Co(n){return n instanceof m_}const b_=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,AC=b_&&"documentMode"in document?document.documentMode:null;b_&&"InputEvent"in window&&!AC&&new window.InputEvent("input");function OC(n,e,t){const[r,i,s]=v_(n,e,t);return i===null&&qe(207),s===null&&qe(208),[r,i,s]}function v_(n,e,t){const r=[];let i=null,s=null;function o(l){let c=r[l];return c===void 0&&(r[l]=c=[]),c}const a=n.getChildren();for(let l=0;l<a.length;l++){const c=a[l];Co(c)||qe(209);const u=o(l);for(let f=c.getFirstChild(),d=0;f!=null;f=f.getNextSibling()){for(Ot(f)||qe(147);u[d]!==void 0;)d++;const h={cell:f,startColumn:d,startRow:l},{__rowSpan:p,__colSpan:m}=f;for(let y=0;y<p&&!(l+y>=a.length);y++){const b=o(l+y);for(let _=0;_<m;_++)b[d+_]=h}e!==null&&i===null&&e.is(f)&&(i=h),t!==null&&s===null&&t.is(f)&&(s=h)}}return[r,i,s]}function $C(n){let e;if(n instanceof of)e=n;else if("__type"in n){const i=Qt(n,Ot);Ot(i)||qe(148),e=i}else{const i=Qt(n.getNode(),Ot);Ot(i)||qe(148),e=i}const t=e.getParent();Co(t)||qe(149);const r=t.getParent();return T_(r)||qe(210),[e,t,r]}function PC(n,e,t){let r,i=Math.min(e.startColumn,t.startColumn),s=Math.min(e.startRow,t.startRow),o=Math.max(e.startColumn+e.cell.__colSpan-1,t.startColumn+t.cell.__colSpan-1),a=Math.max(e.startRow+e.cell.__rowSpan-1,t.startRow+t.cell.__rowSpan-1);do{r=!1;for(let l=0;l<n.length;l++)for(let c=0;c<n[0].length;c++){const u=n[l][c];if(!u)continue;const f=u.startColumn+u.cell.__colSpan-1,d=u.startRow+u.cell.__rowSpan-1,h=u.startColumn<=o&&f>=i,p=u.startRow<=a&&d>=s;if(h&&p){const m=Math.min(i,u.startColumn),y=Math.max(o,f),b=Math.min(s,u.startRow),_=Math.max(a,d);m===i&&y===o&&b===s&&_===a||(i=m,o=y,s=b,a=_,r=!0)}}}while(r);return{maxColumn:o,maxRow:a,minColumn:i,minRow:s}}function gg(n){const[e,,t]=$C(n),r=t.getChildren(),i=r.length,s=r[0].getChildren().length,o=new Array(i);for(let a=0;a<i;a++)o[a]=new Array(s);for(let a=0;a<i;a++){const l=r[a].getChildren();let c=0;for(let u=0;u<l.length;u++){for(;o[a][c];)c++;const f=l[u],d=f.__rowSpan||1,h=f.__colSpan||1;for(let p=0;p<d;p++)for(let m=0;m<h;m++)o[a+p][c+m]=f;if(e===f)return{colSpan:h,columnIndex:c,rowIndex:a,rowSpan:d};c+=h}}return null}function pg(n){const[[e,t,r,i],[s,o,a,l]]=["anchor","focus"].map(c=>{const u=n[c].getNode(),f=Qt(u,Ot);Ot(f)||qe(238,c,u.getKey(),u.getType());const d=f.getParent();Co(d)||qe(239,c);const h=d.getParent();return T_(h)||qe(240,c),[u,f,d,h]});return i.is(l)||qe(241),{anchorCell:t,anchorNode:e,anchorRow:r,anchorTable:i,focusCell:o,focusNode:s,focusRow:a,focusTable:l}}let IC=class k_{constructor(e,t,r){this.anchor=t,this.focus=r,t._selection=this,r._selection=this,this._cachedNodes=null,this.dirty=!1,this.tableKey=e}getStartEndPoints(){return[this.anchor,this.focus]}isValid(){return this.tableKey!=="root"&&this.anchor.key!=="root"&&this.anchor.type==="element"&&this.focus.key!=="root"&&this.focus.type==="element"}isBackward(){return this.focus.isBefore(this.anchor)}getCachedNodes(){return this._cachedNodes}setCachedNodes(e){this._cachedNodes=e}is(e){return w_(e)&&this.tableKey===e.tableKey&&this.anchor.is(e.anchor)&&this.focus.is(e.focus)}set(e,t,r){this.dirty=this.dirty||e!==this.tableKey||t!==this.anchor.key||r!==this.focus.key,this.tableKey=e,this.anchor.key=t,this.focus.key=r,this._cachedNodes=null}clone(){return new k_(this.tableKey,St(this.anchor.key,this.anchor.offset,this.anchor.type),St(this.focus.key,this.focus.offset,this.focus.type))}isCollapsed(){return!1}extract(){return this.getNodes()}insertRawText(e){}insertText(){}hasFormat(e){let t=0;this.getNodes().filter(Ot).forEach(i=>{const s=i.getFirstChild();zd(s)&&(t|=s.getTextFormat())});const r=ar[e];return!!(t&r)}insertNodes(e){const t=this.focus.getNode();F(t)||qe(151),Gs(t.select(0,t.getChildrenSize())).insertNodes(e)}getShape(){const{anchorCell:e,focusCell:t}=pg(this),r=gg(e);r===null&&qe(153);const i=gg(t);i===null&&qe(155);const s=Math.min(r.columnIndex,i.columnIndex),o=Math.max(r.columnIndex+r.colSpan-1,i.columnIndex+i.colSpan-1),a=Math.min(r.rowIndex,i.rowIndex),l=Math.max(r.rowIndex+r.rowSpan-1,i.rowIndex+i.rowSpan-1);return{fromX:Math.min(s,o),fromY:Math.min(a,l),toX:Math.max(s,o),toY:Math.max(a,l)}}getNodes(){if(!this.isValid())return[];const e=this._cachedNodes;if(e!==null)return e;const{anchorTable:t,anchorCell:r,focusCell:i}=pg(this),s=i.getParents()[1];if(s!==t){if(t.isParentOf(i)){const y=s.getParent();y==null&&qe(159),this.set(this.tableKey,i.getKey(),y.getKey())}else{const y=t.getParent();y==null&&qe(158),this.set(this.tableKey,y.getKey(),i.getKey())}return this.getNodes()}const[o,a,l]=OC(t,r,i),{minColumn:c,maxColumn:u,minRow:f,maxRow:d}=PC(o,a,l),h=new Map([[t.getKey(),t]]);let p=null;for(let y=f;y<=d;y++)for(let b=c;b<=u;b++){const{cell:_}=o[y][b],w=_.getParent();Co(w)||qe(160),w!==p&&(h.set(w.getKey(),w),p=w),h.has(_.getKey())||RC(_,T=>{h.set(T.getKey(),T)})}const m=Array.from(h.values());return ns()||(this._cachedNodes=m),m}getTextContent(){const e=this.getNodes().filter(r=>Ot(r));let t="";for(let r=0;r<e.length;r++){const i=e[r],s=i.__parent,o=(e[r+1]||{}).__parent;t+=i.getTextContent()+(o!==s?`
`:"	")}return t}};function w_(n){return n instanceof IC}function RC(n,e){const t=[[n]];for(let r=t.at(-1);r!==void 0&&t.length>0;r=t.at(-1)){const i=r.pop();i===void 0?t.pop():e(i)!==!1&&F(i)&&t.push(i.getChildren())}}function Os(n){return Ne(n)&&n.nodeName==="TABLE"}function DC(n,e){for(let t=e,r=null;t!==null;t=t.getParent()){if(n.is(t))return r;Ot(t)&&(r=t)}return null}function LC(n,e,t){return DC(n,cr(e,t))}function mg(n,e,t){if(!e.theme.tableAlignment)return;const r=[],i=[];for(const s of["center","right"]){const o=e.theme.tableAlignment[s];o&&(s===t?i:r).push(o)}qr(n,...r),ct(n,...i)}const jC=new WeakSet;function yg(n=Dl()){return jC.has(n)}let x_=class C_ extends gt{static getType(){return"table"}getColWidths(){return this.getLatest().__colWidths}setColWidths(e){const t=this.getWritable();return t.__colWidths=e,t}static clone(e){return new C_(e.__key)}afterCloneFrom(e){super.afterCloneFrom(e),this.__colWidths=e.__colWidths,this.__rowStriping=e.__rowStriping,this.__frozenColumnCount=e.__frozenColumnCount,this.__frozenRowCount=e.__frozenRowCount}static importDOM(){return{table:e=>({conversion:FC,priority:1})}}static importJSON(e){return S_().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setRowStriping(e.rowStriping||!1).setFrozenColumns(e.frozenColumnCount||0).setFrozenRows(e.frozenRowCount||0).setColWidths(e.colWidths)}constructor(e){super(e),this.__rowStriping=!1,this.__frozenColumnCount=0,this.__frozenRowCount=0}exportJSON(){return{...super.exportJSON(),colWidths:this.getColWidths(),frozenColumnCount:this.__frozenColumnCount?this.__frozenColumnCount:void 0,frozenRowCount:this.__frozenRowCount?this.__frozenRowCount:void 0,rowStriping:this.__rowStriping?this.__rowStriping:void 0}}extractWithChild(e,t,r){return r==="html"}getDOMSlot(e){const t=Os(e)?e:e.querySelector("table");return Os(t)||qe(229),super.getDOMSlot(e).withElement(t).withAfter(t.querySelector("colgroup"))}createDOM(e,t){const r=document.createElement("table");this.__style&&(r.style.cssText=this.__style);const i=document.createElement("colgroup");if(r.appendChild(i),Gw(i),ct(r,e.theme.table),this.updateTableElement(null,r,e),yg(t)){const s=document.createElement("div"),o=e.theme.tableScrollableWrapper;return o?ct(s,o):s.style.cssText="overflow-x: auto;",s.appendChild(r),this.updateTableWrapper(null,s,r,e),s}return r}updateTableWrapper(e,t,r,i){this.__frozenColumnCount!==(e?e.__frozenColumnCount:0)&&function(s,o,a,l){l>0?(ct(s,a.theme.tableFrozenColumn),o.setAttribute("data-lexical-frozen-column","true")):(qr(s,a.theme.tableFrozenColumn),o.removeAttribute("data-lexical-frozen-column"))}(t,r,i,this.__frozenColumnCount),this.__frozenRowCount!==(e?e.__frozenRowCount:0)&&function(s,o,a,l){l>0?(ct(s,a.theme.tableFrozenRow),o.setAttribute("data-lexical-frozen-row","true")):(qr(s,a.theme.tableFrozenRow),o.removeAttribute("data-lexical-frozen-row"))}(t,r,i,this.__frozenRowCount)}updateTableElement(e,t,r){this.__style!==(e?e.__style:"")&&(t.style.cssText=this.__style),this.__rowStriping!==(!!e&&e.__rowStriping)&&function(i,s,o){o?(ct(i,s.theme.tableRowStriping),i.setAttribute("data-lexical-row-striping","true")):(qr(i,s.theme.tableRowStriping),i.removeAttribute("data-lexical-row-striping"))}(t,r,this.__rowStriping),function(i,s,o,a){const l=i.querySelector("colgroup");if(!l)return;const c=[];for(let u=0;u<o;u++){const f=document.createElement("col"),d=a&&a[u];d&&(f.style.width=`${d}px`),c.push(f)}l.replaceChildren(...c)}(t,0,this.getColumnCount(),this.getColWidths()),mg(t,r,this.getFormatType())}updateDOM(e,t,r){const i=this.getDOMSlot(t).element;return t===i===yg()||(Ne(s=t)&&s.nodeName==="DIV"&&this.updateTableWrapper(e,t,i,r),this.updateTableElement(e,i,r),!1);var s}exportDOM(e){const t=super.exportDOM(e),{element:r}=t;return{after:i=>{if(t.after&&(i=t.after(i)),!Os(i)&&Ne(i)&&(i=i.querySelector("table")),!Os(i))return null;mg(i,e._config,this.getFormatType());const[s]=v_(this,null,null),o=new Map;for(const u of s)for(const f of u){const d=f.cell.getKey();o.has(d)||o.set(d,{colSpan:f.cell.getColSpan(),startColumn:f.startColumn})}const a=new Set;for(const u of i.querySelectorAll(":scope > tr > [data-temporary-table-cell-lexical-key]")){const f=u.getAttribute("data-temporary-table-cell-lexical-key");if(f){const d=o.get(f);if(u.removeAttribute("data-temporary-table-cell-lexical-key"),d){o.delete(f);for(let h=0;h<d.colSpan;h++)a.add(h+d.startColumn)}}}const l=i.querySelector(":scope > colgroup");if(l){const u=Array.from(i.querySelectorAll(":scope > colgroup > col")).filter((f,d)=>a.has(d));l.replaceChildren(...u)}const c=i.querySelectorAll(":scope > tr");if(c.length>0){const u=document.createElement("tbody");for(const f of c)u.appendChild(f);i.append(u)}return i},element:!Os(r)&&Ne(r)?r.querySelector("table"):r}}canBeEmpty(){return!1}isShadowRoot(){return!0}getCordsFromCellNode(e,t){const{rows:r,domRows:i}=t;for(let s=0;s<r;s++){const o=i[s];if(o!=null)for(let a=0;a<o.length;a++){const l=o[a];if(l==null)continue;const{elem:c}=l,u=LC(this,c);if(u!==null&&e.is(u))return{x:a,y:s}}}throw new Error("Cell not found in table.")}getDOMCellFromCords(e,t,r){const{domRows:i}=r,s=i[t];if(s==null)return null;const o=s[e<s.length?e:s.length-1];return o??null}getDOMCellFromCordsOrThrow(e,t,r){const i=this.getDOMCellFromCords(e,t,r);if(!i)throw new Error("Cell not found at cords.");return i}getCellNodeFromCords(e,t,r){const i=this.getDOMCellFromCords(e,t,r);if(i==null)return null;const s=cr(i.elem);return Ot(s)?s:null}getCellNodeFromCordsOrThrow(e,t,r){const i=this.getCellNodeFromCords(e,t,r);if(!i)throw new Error("Node at cords not TableCellNode.");return i}getRowStriping(){return!!this.getLatest().__rowStriping}setRowStriping(e){const t=this.getWritable();return t.__rowStriping=e,t}setFrozenColumns(e){const t=this.getWritable();return t.__frozenColumnCount=e,t}getFrozenColumns(){return this.getLatest().__frozenColumnCount}setFrozenRows(e){const t=this.getWritable();return t.__frozenRowCount=e,t}getFrozenRows(){return this.getLatest().__frozenRowCount}canSelectBefore(){return!0}canIndent(){return!1}getColumnCount(){const e=this.getFirstChild();if(!e)return 0;let t=0;return e.getChildren().forEach(r=>{Ot(r)&&(t+=r.getColSpan())}),t}};function FC(n){const e=S_();n.hasAttribute("data-lexical-row-striping")&&e.setRowStriping(!0),n.hasAttribute("data-lexical-frozen-column")&&e.setFrozenColumns(1),n.hasAttribute("data-lexical-frozen-row")&&e.setFrozenRows(1);const t=n.querySelector(":scope > colgroup");if(t){let r=[];for(const i of t.querySelectorAll(":scope > col")){let s=i.style.width||"";if(!sf.test(s)&&(s=i.getAttribute("width")||"",!/^\d+$/.test(s))){r=void 0;break}r.push(parseFloat(s))}r&&e.setColWidths(r)}return{after:r=>Xy(r,Co),node:e}}function S_(){return Ae(new x_)}function T_(n){return n instanceof x_}const E_=Object.freeze({"	":"\\t","\n":"\\n"}),_g=new RegExp(Object.keys(E_).join("|"),"g"),fn=Object.freeze({ancestorHasNextSibling:"|",ancestorIsLastChild:" ",hasNextSibling:"├",isLastChild:"└",selectedChar:"^",selectedLine:">"}),qC=[n=>n.hasFormat("bold")&&"Bold",n=>n.hasFormat("code")&&"Code",n=>n.hasFormat("italic")&&"Italic",n=>n.hasFormat("strikethrough")&&"Strikethrough",n=>n.hasFormat("subscript")&&"Subscript",n=>n.hasFormat("superscript")&&"Superscript",n=>n.hasFormat("underline")&&"Underline",n=>n.hasFormat("highlight")&&"Highlight"],BC=[n=>n.hasTextFormat("bold")&&"Bold",n=>n.hasTextFormat("code")&&"Code",n=>n.hasTextFormat("italic")&&"Italic",n=>n.hasTextFormat("strikethrough")&&"Strikethrough",n=>n.hasTextFormat("subscript")&&"Subscript",n=>n.hasTextFormat("superscript")&&"Superscript",n=>n.hasTextFormat("underline")&&"Underline",n=>n.hasTextFormat("highlight")&&"Highlight"],UC=[n=>n.isDirectionless()&&"Directionless",n=>n.isUnmergeable()&&"Unmergeable"],zC=[n=>n.isToken()&&"Token",n=>n.isSegmented()&&"Segmented"];function WC(n,e,t,r,i=!1){const s=n.getEditorState(),o=n._config,a=n._compositionKey,l=n._editable;if(t){let d="";return s.read(()=>{d=function(h){const p=document.createElement("div");return p.innerHTML=h.trim(),M_(p,0).innerHTML}(r_(n))}),d}let c=` root
`;const u=s.read(()=>{const d=K();return N_(ye(),(h,p)=>{const m=`(${h.getKey()})`,y=h.getType()||"",b=h.isSelected();c+=`${b?fn.selectedLine:" "} ${p.join(" ")} ${m} ${y} ${function(_,w,T=!1){const I=w?w(_,T):void 0;if(I!==void 0&&I.length>0)return I;if(W(_)){const M=_.getTextContent(),D=M.length===0?"(empty)":`"${bg(M,T)}"`,A=function(O){return[vg(O),KC(O),HC(O),kg(O)].filter(Boolean).join(", ")}(_);return[D,A.length!==0?`{ ${A} }`:null].filter(Boolean).join(" ").trim()}if(vC(_)){const M=_.getURL(),D=M.length===0?"(empty)":`"${bg(M,T)}"`,A=function(O){return[JC(O),VC(O),GC(O),kg(O)].filter(Boolean).join(", ")}(_);return[D,A.length!==0?`{ ${A} }`:null].filter(Boolean).join(" ").trim()}if(wC(_))return`ids: [ ${_.getIDs().join(", ")} ]`;if(zd(_)){const M=function(A){let O=BC.map(B=>B(A)).filter(Boolean).join(", ").toLocaleLowerCase();return O!==""&&(O="format: "+O),O}(_);let D=M!==""?`{ ${M} }`:"";return D+=_.__style?`(${_.__style})`:"",D}return""}(h,r,i)}
`,c+=function({indent:_,isSelected:w,node:T,nodeKeyDisplay:I,selection:M,typeDisplay:D}){if(!W(T)||!q(M)||!w||F(T))return"";const A=M.anchor,O=M.focus;if(T.getTextContent()===""||A.getNode()===M.focus.getNode()&&A.offset===O.offset)return"";const[B,x]=function(H,V){const G=V.getStartEndPoints();if(mt(V)||G===null)return[-1,-1];const[ee,Q]=G,re=H.getTextContent(),oe=re.length;let X=-1,fe=-1;if(ee.type==="text"&&Q.type==="text"){const ue=ee.getNode(),he=Q.getNode();ue===he&&H===ue&&ee.offset!==Q.offset?[X,fe]=ee.offset<Q.offset?[ee.offset,Q.offset]:[Q.offset,ee.offset]:[X,fe]=H===ue?ue.isBefore(he)?[ee.offset,oe]:[0,ee.offset]:H===he?he.isBefore(ue)?[Q.offset,oe]:[0,Q.offset]:[0,oe]}const ve=(re.slice(0,X).match(_g)||[]).length,se=(re.slice(X,fe).match(_g)||[]).length;return[X+ve,fe+ve+se]}(T,M);if(B===x)return"";const N=_[_.length-1]===fn.hasNextSibling?fn.ancestorHasNextSibling:fn.ancestorIsLastChild,C=[..._.slice(0,_.length-1),N],R=Array(B+1).fill(" "),j=Array(x-B).fill(fn.selectedChar),L=D.length+2,z=Array(I.length+L).fill(" ");return[fn.selectedLine,C.join(" "),[...z,...R,...j].join("")].join(" ")+`
`}({indent:p,isSelected:b,node:h,nodeKeyDisplay:m,selection:d,typeDisplay:y})}),d===null?": null":q(d)?function(h){let p="";const m=vg(h);p+=`: range ${m!==""?`{ ${m} }`:""} ${h.style!==""?`{ style: ${h.style} } `:""}`;const y=h.anchor,b=h.focus,_=y.offset,w=b.offset;return p+=`
  ├ anchor { key: ${y.key}, offset: ${_===null?"null":_}, type: ${y.type} }`,p+=`
  └ focus { key: ${b.key}, offset: ${w===null?"null":w}, type: ${b.type} }`,p}(d):w_(d)?function(h){return`: table
  └ { table: ${h.tableKey}, anchorCell: ${h.anchor.key}, focusCell: ${h.focus.key} }`}(d):function(h){return mt(h)?`: node
  └ [${Array.from(h._nodes).join(", ")}]`:""}(d)});if(c+=`
 selection`+u,c+=`

 commands:`,e.length)for(const{index:d,type:h,payload:p}of e)c+=`
  └ ${d}. { type: ${h}, payload: ${p instanceof Event?p.constructor.name:p} }`;else c+=`
  └ None dispatched.`;const{version:f}=n.constructor;return c+=`

 editor${f?` (v${f})`:""}:`,c+=`
  └ namespace ${o.namespace}`,a!==null&&(c+=`
  └ compositionKey ${a}`),c+=`
  └ editable ${String(l)}`,c}function N_(n,e,t=[]){const r=n.getChildren(),i=r.length;r.forEach((s,o)=>{e(s,t.concat(o===i-1?fn.isLastChild:fn.hasNextSibling)),F(s)&&N_(s,e,t.concat(o===i-1?fn.ancestorIsLastChild:fn.ancestorHasNextSibling))})}function bg(n,e=!1){const t=Object.entries(E_).reduce((r,[i,s])=>r.replace(new RegExp(i,"g"),String(s)),n);return e?t.replace(/[^\s]/g,"*"):t}function KC(n){let e=UC.map(t=>t(n)).filter(Boolean).join(", ").toLocaleLowerCase();return e!==""&&(e="detail: "+e),e}function HC(n){let e=zC.map(t=>t(n)).filter(Boolean).join(", ").toLocaleLowerCase();return e!==""&&(e="mode: "+e),e}function vg(n){let e=qC.map(t=>t(n)).filter(Boolean).join(", ").toLocaleLowerCase();return e!==""&&(e="format: "+e),e}function JC(n){let e=n.getTarget();return e!=null&&(e="target: "+e),e}function VC(n){let e=n.getRel();return e!=null&&(e="rel: "+e),e}function GC(n){let e=n.getTitle();return e!=null&&(e="title: "+e),e}function kg(n){if(!n.__state)return!1;const e=[];for(const[r,i]of n.__state.knownState.entries()){if(r.isEqual(i,r.defaultValue))continue;const s=JSON.stringify(r.unparse(i));e.push(`[${r.key}: ${s}]`)}let t=e.join(",");return t!==""&&(t="state: "+t),t}function M_(n,e){const t=new Array(1+e++).join("  "),r=new Array(e-1).join("  ");let i;for(let s=0;s<n.children.length;s++)i=document.createTextNode(`
`+t),n.insertBefore(i,n.children[s]),M_(n.children[s],e),n.lastElementChild===n.children[s]&&(i=document.createTextNode(`
`+r),n.appendChild(i));return n}const YC=k.forwardRef(function({treeTypeButtonClassName:n,timeTravelButtonClassName:e,timeTravelPanelSliderClassName:t,timeTravelPanelButtonClassName:r,viewClassName:i,timeTravelPanelClassName:s,editorState:o,setEditorState:a,setEditorReadOnly:l,generateContent:c,commandsLog:u=[]},f){const[d,h]=k.useState([]),[p,m]=k.useState(""),[y,b]=k.useState(!1),[_,w]=k.useState(!1),T=k.useRef(0),I=k.useRef(null),[M,D]=k.useState(!1),[A,O]=k.useState(!1),[B,x]=k.useState(!1),N=k.useRef(),C=k.useRef([]),R=k.useRef(0),j=k.useCallback(z=>{const H=++R.current;c(z).then(V=>{H===R.current&&m(V)}).catch(V=>{H===R.current&&m(`Error rendering tree: ${V.message}

Stack:
${V.stack}`)})},[c]);k.useEffect(()=>{if(!(!B&&o._nodeMap.size>1e3&&(O(!0),!B))&&(N.current!==o||C.current!==u)){const z=N.current!==o;N.current=o,C.current=u,j(_),!y&&z&&h(H=>[...H,[Date.now(),o]])}},[o,j,_,B,y,u]);const L=d.length;return k.useEffect(()=>{if(M){let z;const H=()=>{const V=T.current;if(V===L-1)return void D(!1);const G=d[V][0],ee=d[V+1][0];z=setTimeout(()=>{T.current++;const Q=T.current,re=I.current;re!==null&&(re.value=String(Q)),a(d[Q][1]),H()},ee-G)};return H(),()=>{clearTimeout(z)}}},[d,M,L,a]),S.jsxs("div",{className:i,children:[!B&&A?S.jsxs("div",{style:{padding:20},children:[S.jsx("span",{style:{marginRight:20},children:"Detected large EditorState, this can impact debugging performance."}),S.jsx("button",{onClick:()=>{x(!0)},style:{background:"transparent",border:"1px solid white",color:"white",cursor:"pointer",padding:5},children:"Show full tree"})]}):null,B?null:S.jsx("button",{onClick:()=>(j(!_),void w(!_)),className:n,type:"button",children:_?"Tree":"Export DOM"}),!y&&(B||!A)&&L>2&&S.jsx("button",{onClick:()=>{l(!0),T.current=L-1,b(!0)},className:e,type:"button",children:"Time Travel"}),(B||!A)&&S.jsx("pre",{ref:f,children:p}),y&&(B||!A)&&S.jsxs("div",{className:s,children:[S.jsx("button",{className:r,onClick:()=>{T.current===L-1&&(T.current=1),D(!M)},type:"button",children:M?"Pause":"Play"}),S.jsx("input",{className:t,ref:I,onChange:z=>{const H=Number(z.target.value),V=d[H];V&&(T.current=H,a(V[1]))},type:"range",min:"1",max:L-1}),S.jsx("button",{className:r,onClick:()=>{l(!1);const z=d.length-1,H=d[z];a(H[1]);const V=I.current;V!==null&&(V.value=String(z)),b(!1),D(!1)},type:"button",children:"Exit"})]})]})});function XC(n,e){const t=new Set;let r=0;for(const[i]of n._commands)t.add(n.registerCommand(i,s=>(e(o=>{r+=1;const a=[...o];return a.push({index:r,payload:s,type:i.type?i.type:"UNKNOWN"}),a.length>10&&a.shift(),a}),!1),Mi));return()=>t.forEach(i=>i())}function QC(n){const[e,t]=k.useState([]);return k.useEffect(()=>XC(n,t),[n]),k.useMemo(()=>e,[e])}function ZC({treeTypeButtonClassName:n,timeTravelButtonClassName:e,timeTravelPanelSliderClassName:t,timeTravelPanelButtonClassName:r,timeTravelPanelClassName:i,viewClassName:s,editor:o,customPrintNode:a}){const l=k.createRef(),[c,u]=k.useState(o.getEditorState()),f=QC(o);return k.useEffect(()=>Ue(o.registerUpdateListener(({editorState:d})=>{u(d)}),o.registerEditableListener(()=>{u(o.getEditorState())})),[o]),k.useEffect(()=>{const d=l.current;if(d!==null)return d.__lexicalEditor=o,()=>{d.__lexicalEditor=null}},[o,l]),S.jsx(YC,{treeTypeButtonClassName:n,timeTravelButtonClassName:e,timeTravelPanelSliderClassName:t,timeTravelPanelButtonClassName:r,viewClassName:s,timeTravelPanelClassName:i,setEditorReadOnly:d=>{const h=o.getRootElement();h!=null&&(h.contentEditable=d?"false":"true")},editorState:c,setEditorState:d=>o.setEditorState(d),generateContent:async function(d){return WC(o,f,d,a)},ref:l,commandsLog:f})}const A_=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,e0=A_?k.useLayoutEffect:k.useEffect,ca={tag:Lr};function O_({initialConfig:n,children:e}){const t=k.useMemo(()=>{const{theme:r,namespace:i,nodes:s,onError:o,editorState:a,html:l}=n,c=pC(null,r),u=Rw({editable:n.editable,html:l,namespace:i,nodes:s,onError:f=>o(f,u),theme:r});return function(f,d){if(d!==null){if(d===void 0)f.update(()=>{const h=ye();if(h.isEmpty()){const p=$t();h.append(p);const m=A_?document.activeElement:null;(K()!==null||m!==null&&m===f.getRootElement())&&p.select()}},ca);else if(d!==null)switch(typeof d){case"string":{const h=f.parseEditorState(d);f.setEditorState(h,ca);break}case"object":f.setEditorState(d,ca);break;case"function":f.update(()=>{ye().isEmpty()&&d(f)},ca)}}}(u,a),[u,c]},[]);return e0(()=>{const r=n.editable,[i]=t;i.setEditable(r===void 0||r)},[]),S.jsx(n_.Provider,{value:t,children:e})}function $_(){return ye().getTextContent()}function P_(n,e=!0){if(n)return!1;let t=$_();return e&&(t=t.trim()),t===""}function t0(n){if(!P_(n,!1))return!1;const e=ye().getChildren(),t=e.length;if(t>1)return!1;for(let r=0;r<t;r++){const i=e[r];if(ke(i))return!1;if(F(i)){if(!zd(i)||i.__indent!==0)return!1;const s=i.getChildren(),o=s.length;for(let a=0;a<o;a++){const l=s[r];if(!W(l))return!1}}}return!0}function af(n){return()=>t0(n)}const I_=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0?k.useLayoutEffect:k.useEffect;function n0({editor:n,ariaActiveDescendant:e,ariaAutoComplete:t,ariaControls:r,ariaDescribedBy:i,ariaErrorMessage:s,ariaExpanded:o,ariaInvalid:a,ariaLabel:l,ariaLabelledBy:c,ariaMultiline:u,ariaOwns:f,ariaRequired:d,autoCapitalize:h,className:p,id:m,role:y="textbox",spellCheck:b=!0,style:_,tabIndex:w,"data-testid":T,...I},M){const[D,A]=k.useState(n.isEditable()),O=k.useCallback(x=>{x&&x.ownerDocument&&x.ownerDocument.defaultView?n.setRootElement(x):n.setRootElement(null)},[n]),B=k.useMemo(()=>function(...x){return N=>{x.forEach(C=>{typeof C=="function"?C(N):C!=null&&(C.current=N)})}}(M,O),[O,M]);return I_(()=>(A(n.isEditable()),n.registerEditableListener(x=>{A(x)})),[n]),S.jsx("div",{"aria-activedescendant":D?e:void 0,"aria-autocomplete":D?t:"none","aria-controls":D?r:void 0,"aria-describedby":i,...s!=null?{"aria-errormessage":s}:{},"aria-expanded":D&&y==="combobox"?!!o:void 0,...a!=null?{"aria-invalid":a}:{},"aria-label":l,"aria-labelledby":c,"aria-multiline":u,"aria-owns":D?f:void 0,"aria-readonly":!D||void 0,"aria-required":d,autoCapitalize:h,className:p,contentEditable:D,"data-testid":T,id:m,ref:B,role:y,spellCheck:b,style:_,tabIndex:w,...I})}const r0=k.forwardRef(n0);function wg(n){return n.getEditorState().read(af(n.isComposing()))}const R_=k.forwardRef(i0);function i0(n,e){const{placeholder:t,...r}=n,[i]=ge();return S.jsxs(S.Fragment,{children:[S.jsx(r0,{editor:i,...r,ref:e}),t!=null&&S.jsx(s0,{editor:i,content:t})]})}function s0({content:n,editor:e}){const t=function(o){const[a,l]=k.useState(()=>wg(o));return I_(()=>{function c(){const u=wg(o);l(u)}return c(),Ue(o.registerUpdateListener(()=>{c()}),o.registerEditableListener(()=>{c()}))},[o]),a}(e),[r,i]=k.useState(e.isEditable());if(k.useLayoutEffect(()=>(i(e.isEditable()),e.registerEditableListener(o=>{i(o)})),[e]),!t)return null;let s=null;return typeof n=="function"?s=n(r):n!==null&&(s=n),s===null?null:S.jsx("div",{"aria-hidden":!0,children:s})}function D_({editorRef:n}){const[e]=ge();return k.useEffect(()=>{typeof n=="function"?n(e):typeof n=="object"&&(n.current=e)},[e]),null}function Uu(n,e){return Uu=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},Uu(n,e)}var xg={error:null},o0=function(n){var e,t;function r(){for(var s,o=arguments.length,a=new Array(o),l=0;l<o;l++)a[l]=arguments[l];return(s=n.call.apply(n,[this].concat(a))||this).state=xg,s.resetErrorBoundary=function(){for(var c,u=arguments.length,f=new Array(u),d=0;d<u;d++)f[d]=arguments[d];s.props.onReset==null||(c=s.props).onReset.apply(c,f),s.reset()},s}t=n,(e=r).prototype=Object.create(t.prototype),e.prototype.constructor=e,Uu(e,t),r.getDerivedStateFromError=function(s){return{error:s}};var i=r.prototype;return i.reset=function(){this.setState(xg)},i.componentDidCatch=function(s,o){var a,l;(a=(l=this.props).onError)==null||a.call(l,s,o)},i.componentDidUpdate=function(s,o){var a,l,c,u,f=this.state.error,d=this.props.resetKeys;f!==null&&o.error!==null&&((c=s.resetKeys)===void 0&&(c=[]),(u=d)===void 0&&(u=[]),c.length!==u.length||c.some(function(h,p){return!Object.is(h,u[p])}))&&((a=(l=this.props).onResetKeysChange)==null||a.call(l,s.resetKeys,d),this.reset())},i.render=function(){var s=this.state.error,o=this.props,a=o.fallbackRender,l=o.FallbackComponent,c=o.fallback;if(s!==null){var u={error:s,resetErrorBoundary:this.resetErrorBoundary};if(k.isValidElement(c))return c;if(typeof a=="function")return a(u);if(l)return k.createElement(l,u);throw new Error("react-error-boundary requires either a fallback, fallbackRender, or FallbackComponent prop")}return this.props.children},r}(k.Component);function L_({children:n,onError:e}){return S.jsx(o0,{fallback:S.jsx("div",{style:{border:"1px solid #f00",color:"#f00",padding:"8px"},children:"An error was thrown."}),onError:e,children:n})}const ua=0,zu=1,Wu=2,Wt=0,a0=1,Cg=2,l0=3,c0=4;function u0(n,e,t,r,i){if(n===null||t.size===0&&r.size===0&&!i)return Wt;const s=e._selection,o=n._selection;if(i)return a0;if(!(q(s)&&q(o)&&o.isCollapsed()&&s.isCollapsed()))return Wt;const a=function(b,_,w){const T=b._nodeMap,I=[];for(const M of _){const D=T.get(M);D!==void 0&&I.push(D)}for(const[M,D]of w){if(!D)continue;const A=T.get(M);A===void 0||et(A)||I.push(A)}return I}(e,t,r);if(a.length===0)return Wt;if(a.length>1){const b=e._nodeMap,_=b.get(s.anchor.key),w=b.get(o.anchor.key);return _&&w&&!n._nodeMap.has(_.__key)&&W(_)&&_.__text.length===1&&s.anchor.offset===1?Cg:Wt}const l=a[0],c=n._nodeMap.get(l.__key);if(!W(c)||!W(l)||c.__mode!==l.__mode)return Wt;const u=c.__text,f=l.__text;if(u===f)return Wt;const d=s.anchor,h=o.anchor;if(d.key!==h.key||d.type!=="text")return Wt;const p=d.offset,m=h.offset,y=f.length-u.length;return y===1&&m===p-1?Cg:y===-1&&m===p+1?l0:y===-1&&m===p?c0:Wt}function d0(n,e){let t=Date.now(),r=Wt;return(i,s,o,a,l,c)=>{const u=Date.now();if(c.has(Mu))return r=Wt,t=u,Wu;const f=u0(i,s,a,l,n.isComposing()),d=(()=>{const h=o===null||o.editor===n,p=c.has(Aw);if(!p&&h&&c.has(Lr))return ua;if(i===null)return zu;const m=s._selection;return a.size>0||l.size>0?p===!1&&f!==Wt&&f===r&&u<t+e&&h||a.size===1&&function(y,b,_){const w=b._nodeMap.get(y),T=_._nodeMap.get(y),I=b._selection,M=_._selection;return!(q(I)&&q(M)&&I.anchor.type==="element"&&I.focus.type==="element"&&M.anchor.type==="text"&&M.focus.type==="text"||!W(w)||!W(T)||w.__parent!==T.__parent)&&JSON.stringify(b.read(()=>w.exportJSON()))===JSON.stringify(_.read(()=>T.exportJSON()))}(Array.from(a)[0],i,s)?ua:zu:m!==null?ua:Wu})();return t=u,r=f,d}}function Sg(n){n.undoStack=[],n.redoStack=[],n.current=null}function f0(n,e,t){const r=d0(n,t);return Ue(n.registerCommand(go,()=>(function(s,o){const a=o.redoStack,l=o.undoStack;if(l.length!==0){const c=o.current,u=l.pop();c!==null&&(a.push(c),s.dispatchCommand(Rs,!0)),l.length===0&&s.dispatchCommand(Ds,!1),o.current=u||null,u&&u.editor.setEditorState(u.editorState,{tag:Mu})}}(n,e),!0),ne),n.registerCommand(po,()=>(function(s,o){const a=o.redoStack,l=o.undoStack;if(a.length!==0){const c=o.current;c!==null&&(l.push(c),s.dispatchCommand(Ds,!0));const u=a.pop();a.length===0&&s.dispatchCommand(Rs,!1),o.current=u||null,u&&u.editor.setEditorState(u.editorState,{tag:Mu})}}(n,e),!0),ne),n.registerCommand(Dd,()=>(Sg(e),!1),ne),n.registerCommand(Qm,()=>(Sg(e),n.dispatchCommand(Rs,!1),n.dispatchCommand(Ds,!1),!0),ne),n.registerUpdateListener(({editorState:s,prevEditorState:o,dirtyLeaves:a,dirtyElements:l,tags:c})=>{const u=e.current,f=e.redoStack,d=e.undoStack,h=u===null?null:u.editorState;if(u!==null&&s===h)return;const p=r(o,s,u,a,l,c);if(p===zu)f.length!==0&&(e.redoStack=[],n.dispatchCommand(Rs,!1)),u!==null&&(d.push({...u}),n.dispatchCommand(Ds,!0));else if(p===Wu)return;e.current={editor:n,editorState:s}}))}function h0(){return{current:null,redoStack:[],undoStack:[]}}function j_({delay:n,externalHistoryState:e}){const[t]=ge();return function(r,i,s=1e3){const o=k.useMemo(()=>i||h0(),[i]);k.useEffect(()=>f0(r,o,s),[s,r,o])}(t,e,n),null}const g0=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0?k.useLayoutEffect:k.useEffect;function p0(n){return{initialValueFn:()=>n.isEditable(),subscribe:e=>n.registerEditableListener(e)}}function F_(){return function(n){const[e]=ge(),t=k.useMemo(()=>n(e),[e,n]),[r,i]=k.useState(()=>t.initialValueFn()),s=k.useRef(r);return g0(()=>{const{initialValueFn:o,subscribe:a}=t,l=o();return s.current!==l&&(s.current=l,i(l)),a(c=>{s.current=c,i(c)})},[t,n]),r}(p0)}function q_(n){const e=window.location.origin,t=r=>{if(r.origin!==e)return;const i=n.getRootElement();if(document.activeElement!==i)return;const s=r.data;if(typeof s=="string"){let o;try{o=JSON.parse(s)}catch{return}if(o&&o.protocol==="nuanria_messaging"&&o.type==="request"){const a=o.payload;if(a&&a.functionId==="makeChanges"){const l=a.args;if(l){const[c,u,f,d,h,p]=l;n.update(()=>{const m=K();if(q(m)){const y=m.anchor;let b=y.getNode(),_=0,w=0;if(W(b)&&c>=0&&u>=0&&(_=c,w=c+u,m.setTextNodeRange(b,_,b,w)),_===w&&f===""||(m.insertRawText(f),b=y.getNode()),W(b)){_=d,w=d+h;const T=b.getTextContentSize();_=_>T?T:_,w=w>T?T:w,m.setTextNodeRange(b,_,b,w)}r.stopImmediatePropagation()}})}}}}};return window.addEventListener("message",t,!0),()=>{window.removeEventListener("message",t,!0)}}function Tg(n,e){if(document.caretRangeFromPoint!==void 0){const t=document.caretRangeFromPoint(n,e);return t===null?null:{node:t.startContainer,offset:t.startOffset}}if(document.caretPositionFromPoint!=="undefined"){const t=document.caretPositionFromPoint(n,e);return t===null?null:{node:t.offsetNode,offset:t.offset}}return null}const is=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,m0=is&&"documentMode"in document?document.documentMode:null,y0=!(!is||!("InputEvent"in window)||m0)&&"getTargetRanges"in new window.InputEvent("input"),_0=is&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent),Eg=is&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,b0=is&&/^(?=.*Chrome).*/i.test(navigator.userAgent),v0=is&&/AppleWebKit\/[\d.]+/.test(navigator.userAgent)&&!b0,Ng=ie("DRAG_DROP_PASTE_FILE");function da(n){let e=null;if(Ln(n,DragEvent)?e=n.dataTransfer:Ln(n,ClipboardEvent)&&(e=n.clipboardData),e===null)return[!1,[],!1];const t=e.types,r=t.includes("Files"),i=t.includes("text/html")||t.includes("text/plain");return[r,Array.from(e.files),i]}function Mg(n){const e=K();if(!q(e))return!1;const t=new Set,r=e.getNodes();for(let i=0;i<r.length;i++){const s=r[i],o=s.getKey();if(t.has(o))continue;const a=Qt(s,c=>F(c)&&!c.isInline());if(a===null)continue;const l=a.getKey();a.canIndent()&&!t.has(l)&&(t.add(l),n(a))}return t.size>0}function Ag(n){const e=cr(n);return ke(e)}function Qc(n){for(const e of["lowercase","uppercase","capitalize"])n.hasFormat(e)&&n.toggleFormat(e)}function k0(n){return Ue(n.registerCommand(Gm,e=>{const t=K();return!!mt(t)&&(t.clear(),!0)},ne),n.registerCommand(pn,e=>{const t=K();return q(t)?(t.deleteCharacter(e),!0):!!mt(t)&&(t.deleteNodes(),!0)},ne),n.registerCommand(Di,e=>{const t=K();return!!q(t)&&(t.deleteWord(e),!0)},ne),n.registerCommand(Li,e=>{const t=K();return!!q(t)&&(t.deleteLine(e),!0)},ne),n.registerCommand(Rr,e=>{const t=K();if(typeof e=="string")t!==null&&t.insertText(e);else{if(t===null)return!1;const r=e.dataTransfer;if(r!=null)cg(r,t,n);else if(q(t)){const i=e.data;return i&&t.insertText(i),!0}}return!0},ne),n.registerCommand(Xa,()=>{const e=K();return!!q(e)&&(e.removeText(),!0)},ne),n.registerCommand(er,e=>{const t=K();return!!q(t)&&(t.formatText(e),!0)},ne),n.registerCommand(dw,e=>{const t=K();if(!q(t)&&!mt(t))return!1;const r=t.getNodes();for(const i of r){const s=Qt(i,o=>F(o)&&!o.isInline());s!==null&&s.setFormat(e)}return!0},ne),n.registerCommand(ir,e=>{const t=K();return!!q(t)&&(t.insertLineBreak(e),!0)},ne),n.registerCommand(Zs,()=>{const e=K();return!!q(e)&&(e.insertParagraph(),!0)},ne),n.registerCommand(cw,()=>(Tw([_o()]),!0),ne),n.registerCommand(uw,()=>Mg(e=>{const t=e.getIndent();e.setIndent(t+1)}),ne),n.registerCommand(ih,()=>Mg(e=>{const t=e.getIndent();t>0&&e.setIndent(Math.max(0,t-1))}),ne),n.registerCommand(Ad,e=>{const t=K();if(mt(t)){const r=t.getNodes();if(r.length>0)return r[0].selectPrevious(),!0}else if(q(t)){const r=Ou(t.focus,!0);if(!e.shiftKey&&ke(r)&&!r.isIsolated()&&!r.isInline())return r.selectPrevious(),e.preventDefault(),!0}return!1},ne),n.registerCommand(Od,e=>{const t=K();if(mt(t)){const r=t.getNodes();if(r.length>0)return r[0].selectNext(0,0),!0}else if(q(t)){if(function(i){const s=i.focus;return s.key==="root"&&s.offset===ye().getChildrenSize()}(t))return e.preventDefault(),!0;const r=Ou(t.focus,!1);if(!e.shiftKey&&ke(r)&&!r.isIsolated()&&!r.isInline())return r.selectNext(),e.preventDefault(),!0}return!1},ne),n.registerCommand(Md,e=>{const t=K();if(mt(t)){const r=t.getNodes();if(r.length>0)return e.preventDefault(),r[0].selectPrevious(),!0}if(!q(t))return!1;if(al(t,!0)){const r=e.shiftKey;return e.preventDefault(),ll(t,r,!0),!0}return!1},ne),n.registerCommand(Nd,e=>{const t=K();if(mt(t)){const i=t.getNodes();if(i.length>0)return e.preventDefault(),i[0].selectNext(0,0),!0}if(!q(t))return!1;const r=e.shiftKey;return!!al(t,!1)&&(e.preventDefault(),ll(t,r,!1),!0)},ne),n.registerCommand($d,e=>{if(Ag(e.target))return!1;const t=K();if(q(t)){if(function(r){if(!r.isCollapsed())return!1;const{anchor:i}=r;if(i.offset!==0)return!1;const s=i.getNode();if(et(s))return!1;const o=Tx(s);return o.getIndent()>0&&(o.is(s)||s.is(o.getFirstDescendant()))}(t))return e.preventDefault(),n.dispatchCommand(ih,void 0);if(Eg&&navigator.language==="ko-KR")return!1}else if(!mt(t))return!1;return e.preventDefault(),n.dispatchCommand(pn,!0)},ne),n.registerCommand(Pd,e=>{if(Ag(e.target))return!1;const t=K();return!(!q(t)&&!mt(t))&&(e.preventDefault(),n.dispatchCommand(pn,!1))},ne),n.registerCommand(ji,e=>{const t=K();if(!q(t))return!1;if(Qc(t),e!==null){if((Eg||_0||v0)&&y0)return!1;if(e.preventDefault(),e.shiftKey)return n.dispatchCommand(ir,!1)}return n.dispatchCommand(Zs,void 0)},ne),n.registerCommand(El,()=>{const e=K();return!!q(e)&&(n.blur(),!0)},ne),n.registerCommand(Nl,e=>{const[,t]=da(e);if(t.length>0){const i=Tg(e.clientX,e.clientY);if(i!==null){const{offset:s,node:o}=i,a=cr(o);if(a!==null){const l=bo();if(W(a))l.anchor.set(a.getKey(),s,"text"),l.focus.set(a.getKey(),s,"text");else{const u=a.getParentOrThrow().getKey(),f=a.getIndexWithinParent()+1;l.anchor.set(u,f,"element"),l.focus.set(u,f,"element")}const c=Gs(l);it(c)}n.dispatchCommand(Ng,t)}return e.preventDefault(),!0}const r=K();return!!q(r)},ne),n.registerCommand(Rd,e=>{const[t]=da(e),r=K();return!(t&&!q(r))},ne),n.registerCommand(Xm,e=>{const[t]=da(e),r=K();if(t&&!q(r))return!1;const i=Tg(e.clientX,e.clientY);if(i!==null){const s=cr(i.node);ke(s)&&e.preventDefault()}return!0},ne),n.registerCommand(Qa,()=>(Ry(),!0),ne),n.registerCommand(mr,e=>(dg(n,Ln(e,ClipboardEvent)?e:null),!0),ne),n.registerCommand(ri,e=>(async function(t,r){await dg(r,Ln(t,ClipboardEvent)?t:null),r.update(()=>{const i=K();q(i)?i.removeText():mt(i)&&i.getNodes().forEach(s=>s.remove())})}(e,n),!0),ne),n.registerCommand(ni,e=>{const[,t,r]=da(e);return t.length>0&&!r?(n.dispatchCommand(Ng,t),!0):oi(e.target)&&Hd(e.target)?!1:K()!==null&&(function(i,s){i.preventDefault(),s.update(()=>{const o=K(),a=Ln(i,InputEvent)||Ln(i,KeyboardEvent)?null:i.clipboardData;a!=null&&o!==null&&cg(a,o,s)},{tag:Sy})}(e,n),!0)},ne),n.registerCommand(Ym,e=>{const t=K();return q(t)&&Qc(t),!1},ne),n.registerCommand(Id,e=>{const t=K();return q(t)&&Qc(t),!1},ne))}const Ku=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0?k.useLayoutEffect:k.useEffect;function Og(n){return n.getEditorState().read(af(n.isComposing()))}function w0({contentEditable:n,placeholder:e=null,ErrorBoundary:t}){const[r]=ge(),i=function(s,o){const[a,l]=k.useState(()=>s.getDecorators());return Ku(()=>s.registerDecoratorListener(c=>{At.flushSync(()=>{l(c)})}),[s]),k.useEffect(()=>{l(s.getDecorators())},[s]),k.useMemo(()=>{const c=[],u=Object.keys(a);for(let f=0;f<u.length;f++){const d=u[f],h=S.jsx(o,{onError:m=>s._onError(m),children:S.jsx(k.Suspense,{fallback:null,children:a[d]})}),p=s.getElementByKey(d);p!==null&&c.push(At.createPortal(h,p,d))}return c},[o,a,s])}(r,t);return function(s){Ku(()=>Ue(k0(s),q_(s)),[s])}(r),S.jsxs(S.Fragment,{children:[n,S.jsx(x0,{content:e}),i]})}function x0({content:n}){const[e]=ge(),t=function(i){const[s,o]=k.useState(()=>Og(i));return Ku(()=>{function a(){const l=Og(i);o(l)}return a(),Ue(i.registerUpdateListener(()=>{a()}),i.registerEditableListener(()=>{a()}))},[i]),s}(e),r=F_();return t?typeof n=="function"?n(r):n:null}const Hu=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,C0=Hu?k.useLayoutEffect:k.useEffect;let S0=class{constructor(e){this.key=e,this.ref={current:null},this.setRefElement=this.setRefElement.bind(this)}setRefElement(e){this.ref={current:e}}};const $g=n=>{const e=document.getElementById("typeahead-menu");if(!e)return;const t=e.getBoundingClientRect();t.top+t.height>window.innerHeight&&e.scrollIntoView({block:"center"}),t.top<0&&e.scrollIntoView({block:"center"}),n.scrollIntoView({block:"nearest"})};function Pg(n,e){const t=n.getBoundingClientRect(),r=e.getBoundingClientRect();return t.top>r.top&&t.top<r.bottom}function T0(n,e,t,r){const[i]=ge();k.useEffect(()=>{if(e!=null&&n!=null){const s=i.getRootElement(),o=s!=null?function(f,d){let h=getComputedStyle(f);const p=h.position==="absolute",m=/(auto|scroll)/;if(h.position==="fixed")return document.body;for(let y=f;y=y.parentElement;)if(h=getComputedStyle(y),(!p||h.position!=="static")&&m.test(h.overflow+h.overflowY+h.overflowX))return y;return document.body}(s):document.body;let a=!1,l=Pg(e,o);const c=function(){a||(window.requestAnimationFrame(function(){t(),a=!1}),a=!0);const f=Pg(e,o);f!==l&&(l=f,r!=null&&r(f))},u=new ResizeObserver(t);return window.addEventListener("resize",t),document.addEventListener("scroll",c,{capture:!0,passive:!0}),u.observe(e),()=>{u.unobserve(e),window.removeEventListener("resize",t),document.removeEventListener("scroll",c,!0)}}},[e,i,r,t,n])}const Ig=ie("SCROLL_TYPEAHEAD_OPTION_INTO_VIEW_COMMAND");function E0({close:n,editor:e,anchorElementRef:t,resolution:r,options:i,menuRenderFn:s,onSelectOption:o,shouldSplitNodeWithQuery:a=!1,commandPriority:l=si,preselectFirstItem:c=!0}){const[u,f]=k.useState(null),d=r.match&&r.match.matchingString;k.useEffect(()=>{c&&f(0)},[d,c]);const h=k.useCallback(m=>{e.update(()=>{const y=r.match!=null&&a?function(b){const _=K();if(!q(_)||!_.isCollapsed())return null;const w=_.anchor;if(w.type!=="text")return null;const T=w.getNode();if(!T.isSimpleText())return null;const I=w.offset,M=T.getTextContent().slice(0,I),D=b.replaceableString.length,A=I-function(B,x,N){let C=N;for(let R=C;R<=x.length;R++)B.slice(-R)===x.substring(0,R)&&(C=R);return C}(M,b.matchingString,D);if(A<0)return null;let O;return A===0?[O]=T.splitText(I):[,O]=T.splitText(A,I),O}(r.match):null;o(m,y,n,r.match?r.match.matchingString:"")})},[e,a,r.match,o,n]),p=k.useCallback(m=>{const y=e.getRootElement();y!==null&&(y.setAttribute("aria-activedescendant","typeahead-item-"+m),f(m))},[e]);return k.useEffect(()=>()=>{const m=e.getRootElement();m!==null&&m.removeAttribute("aria-activedescendant")},[e]),C0(()=>{i===null?f(null):u===null&&c&&p(0)},[i,u,p,c]),k.useEffect(()=>Ue(e.registerCommand(Ig,({option:m})=>!(!m.ref||m.ref.current==null)&&($g(m.ref.current),!0),l)),[e,p,l]),k.useEffect(()=>Ue(e.registerCommand(Od,m=>{const y=m;if(i!==null&&i.length){const b=u===null?0:u!==i.length-1?u+1:0;p(b);const _=i[b];_.ref!=null&&_.ref.current&&e.dispatchCommand(Ig,{index:b,option:_}),y.preventDefault(),y.stopImmediatePropagation()}return!0},l),e.registerCommand(Ad,m=>{const y=m;if(i!==null&&i.length){const b=u===null?i.length-1:u!==0?u-1:i.length-1;p(b);const _=i[b];_.ref!=null&&_.ref.current&&$g(_.ref.current),y.preventDefault(),y.stopImmediatePropagation()}return!0},l),e.registerCommand(El,m=>{const y=m;return y.preventDefault(),y.stopImmediatePropagation(),n(),!0},l),e.registerCommand(Id,m=>{const y=m;return i!==null&&u!==null&&i[u]!=null&&(y.preventDefault(),y.stopImmediatePropagation(),h(i[u]),!0)},l),e.registerCommand(ji,m=>i!==null&&u!==null&&i[u]!=null&&(m!==null&&(m.preventDefault(),m.stopImmediatePropagation()),h(i[u]),!0),l)),[h,n,e,i,u,p,l]),s(t,k.useMemo(()=>({options:i,selectOptionAndCleanUp:h,selectedIndex:u,setHighlightedIndex:f}),[h,u,i]),r.match?r.match.matchingString:"")}function Rg(n,e){e!=null&&(n.className=e),n.setAttribute("aria-label","Typeahead menu"),n.setAttribute("role","listbox"),n.style.display="block",n.style.position="absolute"}function N0({options:n,onWillOpen:e,onClose:t,onOpen:r,onSelectOption:i,menuRenderFn:s,anchorClassName:o,commandPriority:a=si,parent:l}){const[c]=ge(),[u,f]=k.useState(null),d=k.useRef(null),h=function(_,w,T,I=Hu?document.body:void 0,M=!0){const[D]=ge(),A=Hu?document.createElement("div"):null,O=k.useRef(A),B=k.useCallback(()=>{if(O.current===null||I===void 0)return;O.current.style.top=O.current.style.bottom;const N=D.getRootElement(),C=O.current,R=C.firstChild;if(N!==null&&_!==null){const{left:j,top:L,width:z,height:H}=_.getRect(),V=O.current.offsetHeight;if(C.style.top=`${L+V+3+(M?window.pageYOffset:0)}px`,C.style.left=`${j+window.pageXOffset}px`,C.style.height=`${H}px`,C.style.width=`${z}px`,R!==null){R.style.top=`${L}`;const G=R.getBoundingClientRect(),ee=G.height,Q=G.width,re=N.getBoundingClientRect();j+Q>re.right&&(C.style.left=`${re.right-Q+window.pageXOffset}px`),(L+ee>window.innerHeight||L+ee>re.bottom)&&L-re.top>ee+H&&(C.style.top=`${L-ee-H+(M?window.pageYOffset:0)}px`)}C.isConnected||(Rg(C,T),I.append(C)),C.setAttribute("id","typeahead-menu"),N.setAttribute("aria-controls","typeahead-menu")}},[D,_,M,T,I]);k.useEffect(()=>{const N=D.getRootElement();return _!==null&&B(),()=>{N!==null&&N.removeAttribute("aria-controls");const C=O.current;C!==null&&C.isConnected&&(C.remove(),C.removeAttribute("id"))}},[D,B,_]);const x=k.useCallback(N=>{_!==null&&(N||w(null))},[_,w]);return T0(_,O.current,B,x),A!=null&&A===O.current&&(Rg(A,T),I!=null&&I.append(A)),O}(u,f,o,l),p=k.useCallback(()=>{f(null),t!=null&&u!==null&&t()},[t,u]),m=k.useCallback(_=>{f(_),r!=null&&u===null&&r(_)},[r,u]),y=k.useCallback(_=>{_.preventDefault(),e!=null&&e(_);const w=Ex(_.target);m({getRect:()=>new DOMRect(_.clientX/w,_.clientY/w,1,1)})},[m,e]),b=k.useCallback(_=>{u!==null&&d.current!=null&&_.target!=null&&oi(_.target)&&!d.current.contains(_.target)&&p()},[p,u]);return k.useEffect(()=>{const _=c.getRootElement();if(_)return _.addEventListener("contextmenu",y),()=>_.removeEventListener("contextmenu",y)},[c,y]),k.useEffect(()=>(document.addEventListener("click",b),()=>document.removeEventListener("click",b)),[c,b]),h.current===null||u===null||c===null?null:S.jsx(E0,{close:p,resolution:u,editor:c,anchorElementRef:h,options:n,menuRenderFn:(_,w)=>s(_,w,{setMenuRef:T=>{d.current=T}}),onSelectOption:i,commandPriority:a})}function M0({defaultSelection:n}){const[e]=ge();return k.useEffect(()=>{e.focus(()=>{const t=document.activeElement,r=e.getRootElement();r===null||t!==null&&r.contains(t)||r.focus({preventScroll:!0})},{defaultSelection:n})},[n,e]),null}const A0=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0?k.useLayoutEffect:k.useEffect;function O0({onClear:n}){const[e]=ge();return A0(()=>e.registerCommand(Dd,t=>(e.update(()=>{if(n==null){const r=ye(),i=K(),s=$t();r.clear(),r.append(s),i!==null&&s.select(),q(i)&&(i.format=0)}else n()}),!0),ne),[e,n]),null}const Dg=[["Cat","rgb(125, 50, 0)"],["Dog","rgb(100, 0, 0)"],["Rabbit","rgb(150, 0, 0)"],["Frog","rgb(200, 0, 0)"],["Fox","rgb(200, 75, 0)"],["Hedgehog","rgb(0, 75, 0)"],["Pigeon","rgb(0, 125, 0)"],["Squirrel","rgb(75, 100, 0)"],["Bear","rgb(125, 100, 0)"],["Tiger","rgb(0, 0, 150)"],["Leopard","rgb(0, 0, 200)"],["Zebra","rgb(0, 0, 250)"],["Wolf","rgb(0, 100, 150)"],["Owl","rgb(0, 100, 100)"],["Gull","rgb(100, 0, 100)"],["Squid","rgb(150, 0, 150)"]],Lg=Dg[Math.floor(Math.random()*Dg.length)],$0=k.createContext({clientID:0,color:Lg[1],isCollabActive:!1,name:Lg[0],yjsDocMap:new Map});function B_(n,e){return k.useContext($0)}const P0=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0?k.useLayoutEffect:k.useEffect;function I0({ignoreHistoryMergeTagChange:n=!0,ignoreSelectionChange:e=!1,onChange:t}){const[r]=ge();return P0(()=>{if(t)return r.registerUpdateListener(({editorState:i,dirtyElements:s,dirtyLeaves:o,prevEditorState:a,tags:l})=>{e&&s.size===0&&o.size===0||n&&l.has(Lr)||a.isEmpty()||t(i,r,l)})},[r,n,e,t]),null}const ss=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,R0=ss&&"documentMode"in document?document.documentMode:null,D0=!(!ss||!("InputEvent"in window)||R0)&&"getTargetRanges"in new window.InputEvent("input"),L0=ss&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent),jg=ss&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,j0=ss&&/^(?=.*Chrome).*/i.test(navigator.userAgent),F0=ss&&/AppleWebKit\/[\d.]+/.test(navigator.userAgent)&&!j0;function Fg(n,e){e.update(()=>{if(n!==null){const t=Ln(n,KeyboardEvent)?null:n.clipboardData,r=K();if(r!==null&&t!=null){n.preventDefault();const i=f_(e);i!==null&&t.setData("text/html",i),t.setData("text/plain",r.getTextContent())}}})}function q0(n){return Ue(n.registerCommand(pn,e=>{const t=K();return!!q(t)&&(t.deleteCharacter(e),!0)},ne),n.registerCommand(Di,e=>{const t=K();return!!q(t)&&(t.deleteWord(e),!0)},ne),n.registerCommand(Li,e=>{const t=K();return!!q(t)&&(t.deleteLine(e),!0)},ne),n.registerCommand(Rr,e=>{const t=K();if(!q(t))return!1;if(typeof e=="string")t.insertText(e);else{const r=e.dataTransfer;if(r!=null)lg(r,t);else{const i=e.data;i&&t.insertText(i)}}return!0},ne),n.registerCommand(Xa,()=>{const e=K();return!!q(e)&&(e.removeText(),!0)},ne),n.registerCommand(ir,e=>{const t=K();return!!q(t)&&(t.insertLineBreak(e),!0)},ne),n.registerCommand(Zs,()=>{const e=K();return!!q(e)&&(e.insertLineBreak(),!0)},ne),n.registerCommand(Md,e=>{const t=K();if(!q(t))return!1;const r=e,i=r.shiftKey;return!!al(t,!0)&&(r.preventDefault(),ll(t,i,!0),!0)},ne),n.registerCommand(Nd,e=>{const t=K();if(!q(t))return!1;const r=e,i=r.shiftKey;return!!al(t,!1)&&(r.preventDefault(),ll(t,i,!1),!0)},ne),n.registerCommand($d,e=>{const t=K();return!!q(t)&&(!jg||navigator.language!=="ko-KR")&&(e.preventDefault(),n.dispatchCommand(pn,!0))},ne),n.registerCommand(Pd,e=>{const t=K();return!!q(t)&&(e.preventDefault(),n.dispatchCommand(pn,!1))},ne),n.registerCommand(ji,e=>{const t=K();if(!q(t))return!1;if(e!==null){if((jg||L0||F0)&&D0)return!1;e.preventDefault()}return n.dispatchCommand(ir,!1)},ne),n.registerCommand(Qa,()=>(Ry(),!0),ne),n.registerCommand(mr,e=>{const t=K();return!!q(t)&&(Fg(e,n),!0)},ne),n.registerCommand(ri,e=>{const t=K();return!!q(t)&&(function(r,i){Fg(r,i),i.update(()=>{const s=K();q(s)&&s.removeText()})}(e,n),!0)},ne),n.registerCommand(ni,e=>{const t=K();return!!q(t)&&(function(r,i){r.preventDefault(),i.update(()=>{const s=K(),o=Ln(r,ClipboardEvent)?r.clipboardData:null;o!=null&&q(s)&&lg(o,s)},{tag:Sy})}(e,n),!0)},ne),n.registerCommand(Nl,e=>{const t=K();return!!q(t)&&(e.preventDefault(),!0)},ne),n.registerCommand(Rd,e=>{const t=K();return!!q(t)&&(e.preventDefault(),!0)},ne))}const Ju=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0?k.useLayoutEffect:k.useEffect;function qg(n){return n.getEditorState().read(af(n.isComposing()))}function B0({contentEditable:n,placeholder:e=null,ErrorBoundary:t}){const[r]=ge(),i=function(s,o){const[a,l]=k.useState(()=>s.getDecorators());return Ju(()=>s.registerDecoratorListener(c=>{At.flushSync(()=>{l(c)})}),[s]),k.useEffect(()=>{l(s.getDecorators())},[s]),k.useMemo(()=>{const c=[],u=Object.keys(a);for(let f=0;f<u.length;f++){const d=u[f],h=S.jsx(o,{onError:m=>s._onError(m),children:S.jsx(k.Suspense,{fallback:null,children:a[d]})}),p=s.getElementByKey(d);p!==null&&c.push(At.createPortal(h,p,d))}return c},[o,a,s])}(r,t);return function(s){Ju(()=>Ue(q0(s),q_(s)),[s])}(r),S.jsxs(S.Fragment,{children:[n,S.jsx(U0,{content:e}),i]})}function U0({content:n}){const[e]=ge(),t=function(i){const[s,o]=k.useState(()=>qg(i));return Ju(()=>{function a(){const l=qg(i);o(l)}return a(),Ue(i.registerUpdateListener(()=>{a()}),i.registerEditableListener(()=>{a()}))},[i]),s}(e),r=F_();return t?typeof n=="function"?n(r):n:null}const mn=()=>new Map,Vu=n=>{const e=mn();return n.forEach((t,r)=>{e.set(r,t)}),e},os=(n,e,t)=>{let r=n.get(e);return r===void 0&&n.set(e,r=t()),r},z0=(n,e)=>{const t=[];for(const[r,i]of n)t.push(e(i,r));return t},W0=(n,e)=>{for(const[t,r]of n)if(e(r,t))return!0;return!1},Ui=()=>new Set,Zc=n=>n[n.length-1],zi=Array.from,K0=Array.isArray;class H0{constructor(){this._observers=mn()}on(e,t){return os(this._observers,e,Ui).add(t),t}once(e,t){const r=(...i)=>{this.off(e,r),t(...i)};this.on(e,r)}off(e,t){const r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return zi((this._observers.get(e)||mn()).values()).forEach(r=>r(...t))}destroy(){this._observers=mn()}}const Vr=Math.floor,Da=Math.abs,U_=(n,e)=>n<e?n:e,as=(n,e)=>n>e?n:e,J0=n=>n!==0?n<0:1/n<0,Bg=1,Ug=2,eu=4,tu=8,V0=32,z_=64,ul=128,G0=31,zg=63,Ks=127,Y0=2147483647,X0=Number.isInteger||(n=>typeof n=="number"&&isFinite(n)&&Vr(n)===n),Q0=n=>n.toLowerCase(),Z0=/^\s*/g,eS=n=>n.replace(Z0,""),tS=/([A-Z])/g,Wg=(n,e)=>eS(n.replace(tS,t=>`${e}${Q0(t)}`)),nS=n=>{const e=unescape(encodeURIComponent(n)),t=e.length,r=new Uint8Array(t);for(let i=0;i<t;i++)r[i]=e.codePointAt(i);return r},no=typeof TextEncoder<"u"?new TextEncoder:null,rS=n=>no.encode(n),iS=no?rS:nS;let nu=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});nu&&nu.decode(new Uint8Array).length===1&&(nu=null);class So{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const lf=()=>new So,sS=n=>{let e=n.cpos;for(let t=0;t<n.bufs.length;t++)e+=n.bufs[t].length;return e},jn=n=>{const e=new Uint8Array(sS(n));let t=0;for(let r=0;r<n.bufs.length;r++){const i=n.bufs[r];e.set(i,t),t+=i.length}return e.set(new Uint8Array(n.cbuf.buffer,0,n.cpos),t),e},oS=(n,e)=>{const t=n.cbuf.length;t-n.cpos<e&&(n.bufs.push(new Uint8Array(n.cbuf.buffer,0,n.cpos)),n.cbuf=new Uint8Array(as(t,e)*2),n.cpos=0)},We=(n,e)=>{const t=n.cbuf.length;n.cpos===t&&(n.bufs.push(n.cbuf),n.cbuf=new Uint8Array(t*2),n.cpos=0),n.cbuf[n.cpos++]=e},Gu=We,Me=(n,e)=>{for(;e>Ks;)We(n,ul|Ks&e),e=Vr(e/128);We(n,Ks&e)},cf=(n,e)=>{const t=J0(e);for(t&&(e=-e),We(n,(e>zg?ul:0)|(t?z_:0)|zg&e),e=Vr(e/64);e>0;)We(n,(e>Ks?ul:0)|Ks&e),e=Vr(e/128)},Yu=new Uint8Array(3e4),aS=Yu.length/3,lS=(n,e)=>{if(e.length<aS){const t=no.encodeInto(e,Yu).written||0;Me(n,t);for(let r=0;r<t;r++)We(n,Yu[r])}else Nt(n,iS(e))},cS=(n,e)=>{const t=unescape(encodeURIComponent(e)),r=t.length;Me(n,r);for(let i=0;i<r;i++)We(n,t.codePointAt(i))},$i=no&&no.encodeInto?lS:cS,uf=(n,e)=>{const t=n.cbuf.length,r=n.cpos,i=U_(t-r,e.length),s=e.length-i;n.cbuf.set(e.subarray(0,i),r),n.cpos+=i,s>0&&(n.bufs.push(n.cbuf),n.cbuf=new Uint8Array(as(t*2,s)),n.cbuf.set(e.subarray(i)),n.cpos=s)},Nt=(n,e)=>{Me(n,e.byteLength),uf(n,e)},df=(n,e)=>{oS(n,e);const t=new DataView(n.cbuf.buffer,n.cpos,e);return n.cpos+=e,t},uS=(n,e)=>df(n,4).setFloat32(0,e,!1),dS=(n,e)=>df(n,8).setFloat64(0,e,!1),fS=(n,e)=>df(n,8).setBigInt64(0,e,!1),Kg=new DataView(new ArrayBuffer(4)),hS=n=>(Kg.setFloat32(0,n),Kg.getFloat32(0)===n),ro=(n,e)=>{switch(typeof e){case"string":We(n,119),$i(n,e);break;case"number":X0(e)&&Da(e)<=Y0?(We(n,125),cf(n,e)):hS(e)?(We(n,124),uS(n,e)):(We(n,123),dS(n,e));break;case"bigint":We(n,122),fS(n,e);break;case"object":if(e===null)We(n,126);else if(K0(e)){We(n,117),Me(n,e.length);for(let t=0;t<e.length;t++)ro(n,e[t])}else if(e instanceof Uint8Array)We(n,116),Nt(n,e);else{We(n,118);const t=Object.keys(e);Me(n,t.length);for(let r=0;r<t.length;r++){const i=t[r];$i(n,i),ro(n,e[i])}}break;case"boolean":We(n,e?120:121);break;default:We(n,127)}};class Hg extends So{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&Me(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const Jg=n=>{n.count>0&&(cf(n.encoder,n.count===1?n.s:-n.s),n.count>1&&Me(n.encoder,n.count-2))};class La{constructor(){this.encoder=new So,this.s=0,this.count=0}write(e){this.s===e?this.count++:(Jg(this),this.count=1,this.s=e)}toUint8Array(){return Jg(this),jn(this.encoder)}}const Vg=n=>{if(n.count>0){const e=n.diff*2+(n.count===1?0:1);cf(n.encoder,e),n.count>1&&Me(n.encoder,n.count-2)}};class ru{constructor(){this.encoder=new So,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(Vg(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return Vg(this),jn(this.encoder)}}class gS{constructor(){this.sarr=[],this.s="",this.lensE=new La}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new So;return this.sarr.push(this.s),this.s="",$i(e,this.sarr.join("")),uf(e,this.lensE.toUint8Array()),jn(e)}}const Wi=n=>new Error(n),yn=()=>{throw Wi("Method unimplemented")},Gr=()=>{throw Wi("Unexpected case")},pS=crypto.getRandomValues.bind(crypto),W_=()=>pS(new Uint32Array(1))[0],mS="10000000-1000-4000-8000"+-1e11,yS=()=>mS.replace(/[018]/g,n=>(n^W_()&15>>n/4).toString(16)),Gg=n=>new Promise(n);Promise.all.bind(Promise);const Yg=n=>n===void 0?null:n;class _S{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}}let K_=new _S,bS=!0;try{typeof localStorage<"u"&&localStorage&&(K_=localStorage,bS=!1)}catch{}const vS=K_,kS=Object.assign,wS=Object.keys,xS=(n,e)=>{for(const t in n)e(n[t],t)},Xg=n=>wS(n).length,CS=n=>{for(const e in n)return!1;return!0},SS=(n,e)=>{for(const t in n)if(!e(n[t],t))return!1;return!0},TS=(n,e)=>Object.prototype.hasOwnProperty.call(n,e),ES=(n,e)=>n===e||Xg(n)===Xg(e)&&SS(n,(t,r)=>(t!==void 0||TS(e,r))&&e[r]===t),NS=Object.freeze,H_=n=>{for(const e in n){const t=n[e];(typeof t=="object"||typeof t=="function")&&H_(n[e])}return NS(n)},ff=(n,e,t=0)=>{try{for(;t<n.length;t++)n[t](...e)}finally{t<n.length&&ff(n,e,t+1)}},MS=(n,e)=>e.includes(n);var J_={};const io=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";let ln;const AS=()=>{if(ln===void 0)if(io){ln=mn();const n=process.argv;let e=null;for(let t=0;t<n.length;t++){const r=n[t];r[0]==="-"?(e!==null&&ln.set(e,""),e=r):e!==null&&(ln.set(e,r),e=null)}e!==null&&ln.set(e,"")}else typeof location=="object"?(ln=mn(),(location.search||"?").slice(1).split("&").forEach(n=>{if(n.length!==0){const[e,t]=n.split("=");ln.set(`--${Wg(e,"-")}`,t),ln.set(`-${Wg(e,"-")}`,t)}})):ln=mn();return ln},Xu=n=>AS().has(n),dl=n=>Yg(io?J_[n.toUpperCase().replaceAll("-","_")]:vS.getItem(n)),V_=n=>Xu("--"+n)||dl(n)!==null;V_("production");const OS=io&&MS(J_.FORCE_COLOR,["true","1","2"]),$S=OS||!Xu("--no-colors")&&!V_("no-color")&&(!io||process.stdout.isTTY)&&(!io||Xu("--color")||dl("COLORTERM")!==null||(dl("TERM")||"").includes("color"));class PS{constructor(e,t){this.left=e,this.right=t}}const Mn=(n,e)=>new PS(n,e);typeof DOMParser<"u"&&new DOMParser;const IS=n=>z0(n,(e,t)=>`${t}:${e};`).join(""),Hn=Symbol,G_=Hn(),Y_=Hn(),RS=Hn(),DS=Hn(),LS=Hn(),X_=Hn(),jS=Hn(),hf=Hn(),FS=Hn(),qS=n=>{var i;n.length===1&&((i=n[0])==null?void 0:i.constructor)===Function&&(n=n[0]());const e=[],t=[];let r=0;for(;r<n.length;r++){const s=n[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)e.push(s);else if(s.constructor===Object)break}for(r>0&&t.push(e.join(""));r<n.length;r++){const s=n[r];s instanceof Symbol||t.push(s)}return t},BS={[G_]:Mn("font-weight","bold"),[Y_]:Mn("font-weight","normal"),[RS]:Mn("color","blue"),[LS]:Mn("color","green"),[DS]:Mn("color","grey"),[X_]:Mn("color","red"),[jS]:Mn("color","purple"),[hf]:Mn("color","orange"),[FS]:Mn("color","black")},US=n=>{var o;n.length===1&&((o=n[0])==null?void 0:o.constructor)===Function&&(n=n[0]());const e=[],t=[],r=mn();let i=[],s=0;for(;s<n.length;s++){const a=n[s],l=BS[a];if(l!==void 0)r.set(l.left,l.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const c=IS(r);s>0||c.length>0?(e.push("%c"+a),t.push(c)):e.push(a)}else break}}for(s>0&&(i=t,i.unshift(e.join("")));s<n.length;s++){const a=n[s];a instanceof Symbol||i.push(a)}return i},Q_=$S?US:qS,zS=(...n)=>{console.log(...Q_(n)),Z_.forEach(e=>e.print(n))},WS=(...n)=>{console.warn(...Q_(n)),n.unshift(hf),Z_.forEach(e=>e.print(n))},Z_=Ui(),eb=n=>({[Symbol.iterator](){return this},next:n}),KS=(n,e)=>eb(()=>{let t;do t=n.next();while(!t.done&&!e(t.value));return t}),iu=(n,e)=>eb(()=>{const{done:t,value:r}=n.next();return{done:t,value:t?void 0:e(r)}});class HS{constructor(e,t){this.clock=e,this.len=t}}class JS{constructor(){this.clients=new Map}}const tb=(n,e,t)=>e.clients.forEach((r,i)=>{const s=n.doc.store.clients.get(i);if(s!=null){const o=s[s.length-1],a=o.id.clock+o.length;for(let l=0,c=r[l];l<r.length&&c.clock<a;c=r[++l])lb(n,s,c.clock,c.len,t)}}),VS=(n,e)=>{let t=0,r=n.length-1;for(;t<=r;){const i=Vr((t+r)/2),s=n[i],o=s.clock;if(o<=e){if(e<o+s.len)return i;t=i+1}else r=i-1}return null},nb=(n,e)=>{const t=n.clients.get(e.client);return t!==void 0&&VS(t,e.clock)!==null},rb=n=>{n.clients.forEach(e=>{e.sort((i,s)=>i.clock-s.clock);let t,r;for(t=1,r=1;t<e.length;t++){const i=e[r-1],s=e[t];i.clock+i.len>=s.clock?i.len=as(i.len,s.clock+s.len-i.clock):(r<t&&(e[r]=s),r++)}e.length=r})},ib=(n,e,t,r)=>{os(n.clients,e,()=>[]).push(new HS(t,r))},GS=(n,e)=>{Me(n.restEncoder,e.clients.size),zi(e.clients.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{n.resetDsCurVal(),Me(n.restEncoder,t);const i=r.length;Me(n.restEncoder,i);for(let s=0;s<i;s++){const o=r[s];n.writeDsClock(o.clock),n.writeDsLen(o.len)}})},sb=W_;class To extends H0{constructor({guid:e=yS(),collectionid:t=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=sb(),this.guid=e,this.collectionid=t,this.share=new Map,this.store=new s1,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=Gg(c=>{this.on("load",()=>{this.isLoaded=!0,c(this)})});const l=()=>Gg(c=>{const u=f=>{(f===void 0||f===!0)&&(this.off("sync",u),c())};this.on("sync",u)});this.on("sync",c=>{c===!1&&this.isSynced&&(this.whenSynced=l()),this.isSynced=c===void 0||c===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=l()}load(){const e=this._item;e!==null&&!this.shouldLoad&&Oe(e.parent.doc,t=>{t.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(zi(this.subdocs).map(e=>e.guid))}transact(e,t=null){return Oe(this,e,t)}get(e,t=nt){const r=os(this.share,e,()=>{const s=new t;return s._integrate(this,null),s}),i=r.constructor;if(t!==nt&&i!==t)if(i===nt){const s=new t;s._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=r._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=r._length,this.share.set(e,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,Br)}getText(e=""){return this.get(e,gl)}getMap(e=""){return this.get(e,Ki)}getXmlElement(e=""){return this.get(e,ao)}getXmlFragment(e=""){return this.get(e,Hi)}toJSON(){const e={};return this.share.forEach((t,r)=>{e[r]=t.toJSON()}),e}destroy(){this.isDestroyed=!0,zi(this.subdocs).forEach(t=>t.destroy());const e=this._item;if(e!==null){this._item=null;const t=e.content;t.doc=new To({guid:this.guid,...t.opts,shouldLoad:!1}),t.doc._item=e,Oe(e.parent.doc,r=>{const i=t.doc;e.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class YS{constructor(){this.restEncoder=lf()}toUint8Array(){return jn(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){Me(this.restEncoder,e)}writeDsLen(e){Me(this.restEncoder,e)}}class XS extends YS{writeLeftID(e){Me(this.restEncoder,e.client),Me(this.restEncoder,e.clock)}writeRightID(e){Me(this.restEncoder,e.client),Me(this.restEncoder,e.clock)}writeClient(e){Me(this.restEncoder,e)}writeInfo(e){Gu(this.restEncoder,e)}writeString(e){$i(this.restEncoder,e)}writeParentInfo(e){Me(this.restEncoder,e?1:0)}writeTypeRef(e){Me(this.restEncoder,e)}writeLen(e){Me(this.restEncoder,e)}writeAny(e){ro(this.restEncoder,e)}writeBuf(e){Nt(this.restEncoder,e)}writeJSON(e){$i(this.restEncoder,JSON.stringify(e))}writeKey(e){$i(this.restEncoder,e)}}class QS{constructor(){this.restEncoder=lf(),this.dsCurrVal=0}toUint8Array(){return jn(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const t=e-this.dsCurrVal;this.dsCurrVal=e,Me(this.restEncoder,t)}writeDsLen(e){e===0&&Gr(),Me(this.restEncoder,e-1),this.dsCurrVal+=e}}class ZS extends QS{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new ru,this.clientEncoder=new La,this.leftClockEncoder=new ru,this.rightClockEncoder=new ru,this.infoEncoder=new Hg(Gu),this.stringEncoder=new gS,this.parentInfoEncoder=new Hg(Gu),this.typeRefEncoder=new La,this.lenEncoder=new La}toUint8Array(){const e=lf();return Me(e,0),Nt(e,this.keyClockEncoder.toUint8Array()),Nt(e,this.clientEncoder.toUint8Array()),Nt(e,this.leftClockEncoder.toUint8Array()),Nt(e,this.rightClockEncoder.toUint8Array()),Nt(e,jn(this.infoEncoder)),Nt(e,this.stringEncoder.toUint8Array()),Nt(e,jn(this.parentInfoEncoder)),Nt(e,this.typeRefEncoder.toUint8Array()),Nt(e,this.lenEncoder.toUint8Array()),uf(e,jn(this.restEncoder)),jn(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){ro(this.restEncoder,e)}writeBuf(e){Nt(this.restEncoder,e)}writeJSON(e){ro(this.restEncoder,e)}writeKey(e){const t=this.keyMap.get(e);t===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(t)}}const e1=(n,e,t,r)=>{r=as(r,e[0].id.clock);const i=Bn(e,r);Me(n.restEncoder,e.length-i),n.writeClient(t),Me(n.restEncoder,r);const s=e[i];s.write(n,r-s.id.clock);for(let o=i+1;o<e.length;o++)e[o].write(n,0)},t1=(n,e,t)=>{const r=new Map;t.forEach((i,s)=>{xt(e,s)>i&&r.set(s,i)}),gf(e).forEach((i,s)=>{t.has(s)||r.set(s,0)}),Me(n.restEncoder,r.size),zi(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{e1(n,e.clients.get(i),i,s)})},n1=(n,e)=>t1(n,e.doc.store,e.beforeState);class r1{constructor(){this.l=[]}}const Qg=()=>new r1,Zg=(n,e)=>n.l.push(e),ep=(n,e)=>{const t=n.l,r=t.length;n.l=t.filter(i=>e!==i),r===n.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},ob=(n,e,t)=>ff(n.l,[e,t]);class ja{constructor(e,t){this.client=e,this.clock=t}}const fa=(n,e)=>n===e||n!==null&&e!==null&&n.client===e.client&&n.clock===e.clock,Re=(n,e)=>new ja(n,e),i1=n=>{for(const[e,t]of n.doc.share.entries())if(t===n)return e;throw Gr()},Si=(n,e)=>e===void 0?!n.deleted:e.sv.has(n.id.client)&&(e.sv.get(n.id.client)||0)>n.id.clock&&!nb(e.ds,n.id),Qu=(n,e)=>{const t=os(n.meta,Qu,Ui),r=n.doc.store;t.has(e)||(e.sv.forEach((i,s)=>{i<xt(r,s)&&dr(n,Re(s,i))}),tb(n,e.ds,i=>{}),t.add(e))};class s1{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const gf=n=>{const e=new Map;return n.clients.forEach((t,r)=>{const i=t[t.length-1];e.set(r,i.id.clock+i.length)}),e},xt=(n,e)=>{const t=n.clients.get(e);if(t===void 0)return 0;const r=t[t.length-1];return r.id.clock+r.length},ab=(n,e)=>{let t=n.clients.get(e.id.client);if(t===void 0)t=[],n.clients.set(e.id.client,t);else{const r=t[t.length-1];if(r.id.clock+r.length!==e.id.clock)throw Gr()}t.push(e)},Bn=(n,e)=>{let t=0,r=n.length-1,i=n[r],s=i.id.clock;if(s===e)return r;let o=Vr(e/(s+i.length-1)*r);for(;t<=r;){if(i=n[o],s=i.id.clock,s<=e){if(e<s+i.length)return o;t=o+1}else r=o-1;o=Vr((t+r)/2)}throw Gr()},o1=(n,e)=>{const t=n.clients.get(e.client);return t[Bn(t,e.clock)]},su=o1,Zu=(n,e,t)=>{const r=Bn(e,t),i=e[r];return i.id.clock<t&&i instanceof ut?(e.splice(r+1,0,Eb(n,i,t-i.id.clock)),r+1):r},dr=(n,e)=>{const t=n.doc.store.clients.get(e.client);return t[Zu(n,t,e.clock)]},tp=(n,e,t)=>{const r=e.clients.get(t.client),i=Bn(r,t.clock),s=r[i];return t.clock!==s.id.clock+s.length-1&&s.constructor!==Qn&&r.splice(i+1,0,Eb(n,s,t.clock-s.id.clock+1)),s},a1=(n,e,t)=>{const r=n.clients.get(e.id.client);r[Bn(r,e.id.clock)]=t},lb=(n,e,t,r,i)=>{if(r===0)return;const s=t+r;let o=Zu(n,e,t),a;do a=e[o++],s<a.id.clock+a.length&&Zu(n,e,s),i(a);while(o<e.length&&e[o].id.clock<s)};class l1{constructor(e,t,r){this.doc=e,this.deleteSet=new JS,this.beforeState=gf(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=t,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const np=(n,e)=>e.deleteSet.clients.size===0&&!W0(e.afterState,(t,r)=>e.beforeState.get(r)!==t)?!1:(rb(e.deleteSet),n1(n,e),GS(n,e.deleteSet),!0),rp=(n,e,t)=>{const r=e._item;(r===null||r.id.clock<(n.beforeState.get(r.id.client)||0)&&!r.deleted)&&os(n.changed,e,Ui).add(t)},Fa=(n,e)=>{let t=n[e],r=n[e-1],i=e;for(;i>0;t=r,r=n[--i-1]){if(r.deleted===t.deleted&&r.constructor===t.constructor&&r.mergeWith(t)){t instanceof ut&&t.parentSub!==null&&t.parent._map.get(t.parentSub)===t&&t.parent._map.set(t.parentSub,r);continue}break}const s=e-i;return s&&n.splice(e+1-s,s),s},c1=(n,e,t)=>{for(const[r,i]of n.clients.entries()){const s=e.clients.get(r);for(let o=i.length-1;o>=0;o--){const a=i[o],l=a.clock+a.len;for(let c=Bn(s,a.clock),u=s[c];c<s.length&&u.id.clock<l;u=s[++c]){const f=s[c];if(a.clock+a.len<=f.id.clock)break;f instanceof ut&&f.deleted&&!f.keep&&t(f)&&f.gc(e,!1)}}}},u1=(n,e)=>{n.clients.forEach((t,r)=>{const i=e.clients.get(r);for(let s=t.length-1;s>=0;s--){const o=t[s],a=U_(i.length-1,1+Bn(i,o.clock+o.len-1));for(let l=a,c=i[l];l>0&&c.id.clock>=o.clock;c=i[l])l-=1+Fa(i,l)}})},cb=(n,e)=>{if(e<n.length){const t=n[e],r=t.doc,i=r.store,s=t.deleteSet,o=t._mergeStructs;try{rb(s),t.afterState=gf(t.doc.store),r.emit("beforeObserverCalls",[t,r]);const a=[];t.changed.forEach((l,c)=>a.push(()=>{(c._item===null||!c._item.deleted)&&c._callObserver(t,l)})),a.push(()=>{t.changedParentTypes.forEach((l,c)=>{c._dEH.l.length>0&&(c._item===null||!c._item.deleted)&&(l=l.filter(u=>u.target._item===null||!u.target._item.deleted),l.forEach(u=>{u.currentTarget=c,u._path=null}),l.sort((u,f)=>u.path.length-f.path.length),ob(c._dEH,l,t))})}),a.push(()=>r.emit("afterTransaction",[t,r])),ff(a,[]),t._needFormattingCleanup&&k1(t)}finally{r.gc&&c1(s,i,r.gcFilter),u1(s,i),t.afterState.forEach((u,f)=>{const d=t.beforeState.get(f)||0;if(d!==u){const h=i.clients.get(f),p=as(Bn(h,d),1);for(let m=h.length-1;m>=p;)m-=1+Fa(h,m)}});for(let u=o.length-1;u>=0;u--){const{client:f,clock:d}=o[u].id,h=i.clients.get(f),p=Bn(h,d);p+1<h.length&&Fa(h,p+1)>1||p>0&&Fa(h,p)}if(!t.local&&t.afterState.get(r.clientID)!==t.beforeState.get(r.clientID)&&(zS(hf,G_,"[yjs] ",Y_,X_,"Changed the client-id because another client seems to be using it."),r.clientID=sb()),r.emit("afterTransactionCleanup",[t,r]),r._observers.has("update")){const u=new XS;np(u,t)&&r.emit("update",[u.toUint8Array(),t.origin,r,t])}if(r._observers.has("updateV2")){const u=new ZS;np(u,t)&&r.emit("updateV2",[u.toUint8Array(),t.origin,r,t])}const{subdocsAdded:a,subdocsLoaded:l,subdocsRemoved:c}=t;(a.size>0||c.size>0||l.size>0)&&(a.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),c.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:l,added:a,removed:c},r,t]),c.forEach(u=>u.destroy())),n.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,n])):cb(n,e+1)}}},Oe=(n,e,t=null,r=!0)=>{const i=n._transactionCleanups;let s=!1,o=null;n._transaction===null&&(s=!0,n._transaction=new l1(n,t,r),i.push(n._transaction),i.length===1&&n.emit("beforeAllTransactions",[n]),n.emit("beforeTransaction",[n._transaction,n]));try{o=e(n._transaction)}finally{if(s){const a=n._transaction===i[0];n._transaction=null,a&&cb(i,0)}}return o},ip="You must not compute changes after the event-handler fired.";class Fl{constructor(e,t){this.target=e,this.currentTarget=e,this.transaction=t,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=d1(this.currentTarget,this.target))}deletes(e){return nb(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Wi(ip);const e=new Map,t=this.target;this.transaction.changed.get(t).forEach(i=>{if(i!==null){const s=t._map.get(i);let o,a;if(this.adds(s)){let l=s.left;for(;l!==null&&this.adds(l);)l=l.left;if(this.deletes(s))if(l!==null&&this.deletes(l))o="delete",a=Zc(l.content.getContent());else return;else l!==null&&this.deletes(l)?(o="update",a=Zc(l.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=Zc(s.content.getContent());else return;e.set(i,{action:o,oldValue:a})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw Wi(ip);const t=this.target,r=Ui(),i=Ui(),s=[];if(e={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(t).has(null)){let a=null;const l=()=>{a&&s.push(a)};for(let c=t._start;c!==null;c=c.right)c.deleted?this.deletes(c)&&!this.adds(c)&&((a===null||a.delete===void 0)&&(l(),a={delete:0}),a.delete+=c.length,i.add(c)):this.adds(c)?((a===null||a.insert===void 0)&&(l(),a={insert:[]}),a.insert=a.insert.concat(c.content.getContent()),r.add(c)):((a===null||a.retain===void 0)&&(l(),a={retain:0}),a.retain+=c.length);a!==null&&a.retain===void 0&&l()}this._changes=e}return e}}const d1=(n,e)=>{const t=[];for(;e._item!==null&&e!==n;){if(e._item.parentSub!==null)t.unshift(e._item.parentSub);else{let r=0,i=e._item.parent._start;for(;i!==e._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;t.unshift(r)}e=e._item.parent}return t},ht=()=>{WS("Invalid access: Add Yjs type to a document before reading data.")},ub=80;let pf=0;class f1{constructor(e,t){e.marker=!0,this.p=e,this.index=t,this.timestamp=pf++}}const h1=n=>{n.timestamp=pf++},db=(n,e,t)=>{n.p.marker=!1,n.p=e,e.marker=!0,n.index=t,n.timestamp=pf++},g1=(n,e,t)=>{if(n.length>=ub){const r=n.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return db(r,e,t),r}else{const r=new f1(e,t);return n.push(r),r}},ql=(n,e)=>{if(n._start===null||e===0||n._searchMarker===null)return null;const t=n._searchMarker.length===0?null:n._searchMarker.reduce((s,o)=>Da(e-s.index)<Da(e-o.index)?s:o);let r=n._start,i=0;for(t!==null&&(r=t.p,i=t.index,h1(t));r.right!==null&&i<e;){if(!r.deleted&&r.countable){if(e<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>e;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return t!==null&&Da(t.index-i)<r.parent.length/ub?(db(t,r,i),t):g1(n._searchMarker,r,i)},so=(n,e,t)=>{for(let r=n.length-1;r>=0;r--){const i=n[r];if(t>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){n.splice(r,1);continue}i.p=s,s.marker=!0}(e<i.index||t>0&&e===i.index)&&(i.index=as(e,i.index+t))}},Bl=(n,e,t)=>{const r=n,i=e.changedParentTypes;for(;os(i,n,()=>[]).push(t),n._item!==null;)n=n._item.parent;ob(r._eH,t,e)};class nt{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Qg(),this._dEH=Qg(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,t){this.doc=e,this._item=t}_copy(){throw yn()}clone(){throw yn()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,t){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){Zg(this._eH,e)}observeDeep(e){Zg(this._dEH,e)}unobserve(e){ep(this._eH,e)}unobserveDeep(e){ep(this._dEH,e)}toJSON(){}}const fb=(n,e,t)=>{n.doc??ht(),e<0&&(e=n._length+e),t<0&&(t=n._length+t);let r=t-e;const i=[];let s=n._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=e)e-=o.length;else{for(let a=e;a<o.length&&r>0;a++)i.push(o[a]),r--;e=0}}s=s.right}return i},hb=n=>{n.doc??ht();const e=[];let t=n._start;for(;t!==null;){if(t.countable&&!t.deleted){const r=t.content.getContent();for(let i=0;i<r.length;i++)e.push(r[i])}t=t.right}return e},oo=(n,e)=>{let t=0,r=n._start;for(n.doc??ht();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)e(i[s],t++,n)}r=r.right}},gb=(n,e)=>{const t=[];return oo(n,(r,i)=>{t.push(e(r,i,n))}),t},p1=n=>{let e=n._start,t=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(t===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};t=e.content.getContent(),r=0,e=e.right}const i=t[r++];return t.length<=r&&(t=null),{done:!1,value:i}}}},pb=(n,e)=>{n.doc??ht();const t=ql(n,e);let r=n._start;for(t!==null&&(r=t.p,e-=t.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},fl=(n,e,t,r)=>{let i=t;const s=n.doc,o=s.clientID,a=s.store,l=t===null?e._start:t.right;let c=[];const u=()=>{c.length>0&&(i=new ut(Re(o,xt(a,o)),i,i&&i.lastId,l,l&&l.id,e,null,new Ji(c)),i.integrate(n,0),c=[])};r.forEach(f=>{if(f===null)c.push(f);else switch(f.constructor){case Number:case Object:case Boolean:case Array:case String:c.push(f);break;default:switch(u(),f.constructor){case Uint8Array:case ArrayBuffer:i=new ut(Re(o,xt(a,o)),i,i&&i.lastId,l,l&&l.id,e,null,new Ul(new Uint8Array(f))),i.integrate(n,0);break;case To:i=new ut(Re(o,xt(a,o)),i,i&&i.lastId,l,l&&l.id,e,null,new zl(f)),i.integrate(n,0);break;default:if(f instanceof nt)i=new ut(Re(o,xt(a,o)),i,i&&i.lastId,l,l&&l.id,e,null,new kr(f)),i.integrate(n,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},mb=()=>Wi("Length exceeded!"),yb=(n,e,t,r)=>{if(t>e._length)throw mb();if(t===0)return e._searchMarker&&so(e._searchMarker,t,r.length),fl(n,e,null,r);const i=t,s=ql(e,t);let o=e._start;for(s!==null&&(o=s.p,t-=s.index,t===0&&(o=o.prev,t+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(t<=o.length){t<o.length&&dr(n,Re(o.id.client,o.id.clock+t));break}t-=o.length}return e._searchMarker&&so(e._searchMarker,i,r.length),fl(n,e,o,r)},m1=(n,e,t)=>{let i=(e._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:e._start}).p;if(i)for(;i.right;)i=i.right;return fl(n,e,i,t)},_b=(n,e,t,r)=>{if(r===0)return;const i=t,s=r,o=ql(e,t);let a=e._start;for(o!==null&&(a=o.p,t-=o.index);a!==null&&t>0;a=a.right)!a.deleted&&a.countable&&(t<a.length&&dr(n,Re(a.id.client,a.id.clock+t)),t-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&dr(n,Re(a.id.client,a.id.clock+r)),a.delete(n),r-=a.length),a=a.right;if(r>0)throw mb();e._searchMarker&&so(e._searchMarker,i,-s+r)},hl=(n,e,t)=>{const r=e._map.get(t);r!==void 0&&r.delete(n)},mf=(n,e,t,r)=>{const i=e._map.get(t)||null,s=n.doc,o=s.clientID;let a;if(r==null)a=new Ji([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:a=new Ji([r]);break;case Uint8Array:a=new Ul(r);break;case To:a=new zl(r);break;default:if(r instanceof nt)a=new kr(r);else throw new Error("Unexpected content type")}new ut(Re(o,xt(s.store,o)),i,i&&i.lastId,null,null,e,t,a).integrate(n,0)},yf=(n,e)=>{n.doc??ht();const t=n._map.get(e);return t!==void 0&&!t.deleted?t.content.getContent()[t.length-1]:void 0},bb=n=>{const e={};return n.doc??ht(),n._map.forEach((t,r)=>{t.deleted||(e[r]=t.content.getContent()[t.length-1])}),e},vb=(n,e)=>{n.doc??ht();const t=n._map.get(e);return t!==void 0&&!t.deleted},y1=(n,e)=>{const t={};return n._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!e.sv.has(s.id.client)||s.id.clock>=(e.sv.get(s.id.client)||0));)s=s.left;s!==null&&Si(s,e)&&(t[i]=s.content.getContent()[s.length-1])}),t},ha=n=>(n.doc??ht(),KS(n._map.entries(),e=>!e[1].deleted));class kb extends Fl{}class Br extends nt{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const t=new Br;return t.push(e),t}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Br}clone(){const e=new Br;return e.insert(0,this.toArray().map(t=>t instanceof nt?t.clone():t)),e}get length(){return this.doc??ht(),this._length}_callObserver(e,t){super._callObserver(e,t),Bl(this,e,new kb(this,e))}insert(e,t){this.doc!==null?Oe(this.doc,r=>{yb(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}push(e){this.doc!==null?Oe(this.doc,t=>{m1(t,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,t=1){this.doc!==null?Oe(this.doc,r=>{_b(r,this,e,t)}):this._prelimContent.splice(e,t)}get(e){return pb(this,e)}toArray(){return hb(this)}slice(e=0,t=this.length){return fb(this,e,t)}toJSON(){return this.map(e=>e instanceof nt?e.toJSON():e)}map(e){return gb(this,e)}forEach(e){oo(this,e)}[Symbol.iterator](){return p1(this)}_write(e){e.writeTypeRef(E1)}}class _1 extends Fl{constructor(e,t,r){super(e,t),this.keysChanged=r}}class Ki extends nt{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,t){super._integrate(e,t),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new Ki}clone(){const e=new Ki;return this.forEach((t,r)=>{e.set(r,t instanceof nt?t.clone():t)}),e}_callObserver(e,t){Bl(this,e,new _1(this,e,t))}toJSON(){this.doc??ht();const e={};return this._map.forEach((t,r)=>{if(!t.deleted){const i=t.content.getContent()[t.length-1];e[r]=i instanceof nt?i.toJSON():i}}),e}get size(){return[...ha(this)].length}keys(){return iu(ha(this),e=>e[0])}values(){return iu(ha(this),e=>e[1].content.getContent()[e[1].length-1])}entries(){return iu(ha(this),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this.doc??ht(),this._map.forEach((t,r)=>{t.deleted||e(t.content.getContent()[t.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?Oe(this.doc,t=>{hl(t,this,e)}):this._prelimContent.delete(e)}set(e,t){return this.doc!==null?Oe(this.doc,r=>{mf(r,this,e,t)}):this._prelimContent.set(e,t),t}get(e){return yf(this,e)}has(e){return vb(this,e)}clear(){this.doc!==null?Oe(this.doc,e=>{this.forEach(function(t,r,i){hl(e,i,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(N1)}}const nr=(n,e)=>n===e||typeof n=="object"&&typeof e=="object"&&n&&e&&ES(n,e);class ed{constructor(e,t,r,i){this.left=e,this.right=t,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&Gr(),this.right.content.constructor){case Je:this.right.deleted||ls(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const sp=(n,e,t)=>{for(;e.right!==null&&t>0;){switch(e.right.content.constructor){case Je:e.right.deleted||ls(e.currentAttributes,e.right.content);break;default:e.right.deleted||(t<e.right.length&&dr(n,Re(e.right.id.client,e.right.id.clock+t)),e.index+=e.right.length,t-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},ga=(n,e,t,r)=>{const i=new Map,s=r?ql(e,t):null;if(s){const o=new ed(s.p.left,s.p,s.index,i);return sp(n,o,t-s.index)}else{const o=new ed(null,e._start,0,i);return sp(n,o,t)}},wb=(n,e,t,r)=>{for(;t.right!==null&&(t.right.deleted===!0||t.right.content.constructor===Je&&nr(r.get(t.right.content.key),t.right.content.value));)t.right.deleted||r.delete(t.right.content.key),t.forward();const i=n.doc,s=i.clientID;r.forEach((o,a)=>{const l=t.left,c=t.right,u=new ut(Re(s,xt(i.store,s)),l,l&&l.lastId,c,c&&c.id,e,null,new Je(a,o));u.integrate(n,0),t.right=u,t.forward()})},ls=(n,e)=>{const{key:t,value:r}=e;r===null?n.delete(t):n.set(t,r)},xb=(n,e)=>{for(;n.right!==null;){if(!(n.right.deleted||n.right.content.constructor===Je&&nr(e[n.right.content.key]??null,n.right.content.value)))break;n.forward()}},Cb=(n,e,t,r)=>{const i=n.doc,s=i.clientID,o=new Map;for(const a in r){const l=r[a],c=t.currentAttributes.get(a)??null;if(!nr(c,l)){o.set(a,c);const{left:u,right:f}=t;t.right=new ut(Re(s,xt(i.store,s)),u,u&&u.lastId,f,f&&f.id,e,null,new Je(a,l)),t.right.integrate(n,0),t.forward()}}return o},ou=(n,e,t,r,i)=>{t.currentAttributes.forEach((d,h)=>{i[h]===void 0&&(i[h]=null)});const s=n.doc,o=s.clientID;xb(t,i);const a=Cb(n,e,t,i),l=r.constructor===String?new Un(r):r instanceof nt?new kr(r):new cs(r);let{left:c,right:u,index:f}=t;e._searchMarker&&so(e._searchMarker,t.index,l.getLength()),u=new ut(Re(o,xt(s.store,o)),c,c&&c.lastId,u,u&&u.id,e,null,l),u.integrate(n,0),t.right=u,t.index=f,t.forward(),wb(n,e,t,a)},op=(n,e,t,r,i)=>{const s=n.doc,o=s.clientID;xb(t,i);const a=Cb(n,e,t,i);e:for(;t.right!==null&&(r>0||a.size>0&&(t.right.deleted||t.right.content.constructor===Je));){if(!t.right.deleted)switch(t.right.content.constructor){case Je:{const{key:l,value:c}=t.right.content,u=i[l];if(u!==void 0){if(nr(u,c))a.delete(l);else{if(r===0)break e;a.set(l,c)}t.right.delete(n)}else t.currentAttributes.set(l,c);break}default:r<t.right.length&&dr(n,Re(t.right.id.client,t.right.id.clock+r)),r-=t.right.length;break}t.forward()}if(r>0){let l="";for(;r>0;r--)l+=`
`;t.right=new ut(Re(o,xt(s.store,o)),t.left,t.left&&t.left.lastId,t.right,t.right&&t.right.id,e,null,new Un(l)),t.right.integrate(n,0),t.forward()}wb(n,e,t,a)},Sb=(n,e,t,r,i)=>{let s=e;const o=mn();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===Je){const c=s.content;o.set(c.key,c)}s=s.right}let a=0,l=!1;for(;e!==s;){if(t===e&&(l=!0),!e.deleted){const c=e.content;switch(c.constructor){case Je:{const{key:u,value:f}=c,d=r.get(u)??null;(o.get(u)!==c||d===f)&&(e.delete(n),a++,!l&&(i.get(u)??null)===f&&d!==f&&(d===null?i.delete(u):i.set(u,d))),!l&&!e.deleted&&ls(i,c);break}}}e=e.right}return a},b1=(n,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const t=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===Je){const r=e.content.key;t.has(r)?e.delete(n):t.add(r)}e=e.left}},v1=n=>{let e=0;return Oe(n.doc,t=>{let r=n._start,i=n._start,s=mn();const o=Vu(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case Je:ls(o,i.content);break;default:e+=Sb(t,r,i,s,o),s=Vu(o),r=i;break}i=i.right}}),e},k1=n=>{const e=new Set,t=n.doc;for(const[r,i]of n.afterState.entries()){const s=n.beforeState.get(r)||0;i!==s&&lb(n,t.store.clients.get(r),s,i,o=>{!o.deleted&&o.content.constructor===Je&&o.constructor!==Qn&&e.add(o.parent)})}Oe(t,r=>{tb(n,n.deleteSet,i=>{if(i instanceof Qn||!i.parent._hasFormatting||e.has(i.parent))return;const s=i.parent;i.content.constructor===Je?e.add(s):b1(r,i)});for(const i of e)v1(i)})},ap=(n,e,t)=>{const r=t,i=Vu(e.currentAttributes),s=e.right;for(;t>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case kr:case cs:case Un:t<e.right.length&&dr(n,Re(e.right.id.client,e.right.id.clock+t)),t-=e.right.length,e.right.delete(n);break}e.forward()}s&&Sb(n,s,e.right,i,e.currentAttributes);const o=(e.left||e.right).parent;return o._searchMarker&&so(o._searchMarker,e.index,-r+t),e};class w1 extends Fl{constructor(e,t,r){super(e,t),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,t=[];Oe(e,r=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const l={};let c="",u=0,f=0;const d=()=>{if(a!==null){let h=null;switch(a){case"delete":f>0&&(h={delete:f}),f=0;break;case"insert":(typeof c=="object"||c.length>0)&&(h={insert:c},i.size>0&&(h.attributes={},i.forEach((p,m)=>{p!==null&&(h.attributes[m]=p)}))),c="";break;case"retain":u>0&&(h={retain:u},CS(l)||(h.attributes=kS({},l))),u=0;break}h&&t.push(h),a=null}};for(;o!==null;){switch(o.content.constructor){case kr:case cs:this.adds(o)?this.deletes(o)||(d(),a="insert",c=o.content.getContent()[0],d()):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),f+=1):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=1);break;case Un:this.adds(o)?this.deletes(o)||(a!=="insert"&&(d(),a="insert"),c+=o.content.str):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),f+=o.length):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=o.length);break;case Je:{const{key:h,value:p}=o.content;if(this.adds(o)){if(!this.deletes(o)){const m=i.get(h)??null;nr(m,p)?p!==null&&o.delete(r):(a==="retain"&&d(),nr(p,s.get(h)??null)?delete l[h]:l[h]=p)}}else if(this.deletes(o)){s.set(h,p);const m=i.get(h)??null;nr(m,p)||(a==="retain"&&d(),l[h]=m)}else if(!o.deleted){s.set(h,p);const m=l[h];m!==void 0&&(nr(m,p)?m!==null&&o.delete(r):(a==="retain"&&d(),p===null?delete l[h]:l[h]=p))}o.deleted||(a==="insert"&&d(),ls(i,o.content));break}}o=o.right}for(d();t.length>0;){const h=t[t.length-1];if(h.retain!==void 0&&h.attributes===void 0)t.pop();else break}}),this._delta=t}return this._delta}}class gl extends nt{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??ht(),this._length}_integrate(e,t){super._integrate(e,t);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new gl}clone(){const e=new gl;return e.applyDelta(this.toDelta()),e}_callObserver(e,t){super._callObserver(e,t);const r=new w1(this,e,t);Bl(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){this.doc??ht();let e="",t=this._start;for(;t!==null;)!t.deleted&&t.countable&&t.content.constructor===Un&&(e+=t.content.str),t=t.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:t=!0}={}){this.doc!==null?Oe(this.doc,r=>{const i=new ed(null,this._start,0,new Map);for(let s=0;s<e.length;s++){const o=e[s];if(o.insert!==void 0){const a=!t&&typeof o.insert=="string"&&s===e.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&ou(r,this,i,a,o.attributes||{})}else o.retain!==void 0?op(r,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&ap(r,i,o.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,t,r){this.doc??ht();const i=[],s=new Map,o=this.doc;let a="",l=this._start;function c(){if(a.length>0){const f={};let d=!1;s.forEach((p,m)=>{d=!0,f[m]=p});const h={insert:a};d&&(h.attributes=f),i.push(h),a=""}}const u=()=>{for(;l!==null;){if(Si(l,e)||t!==void 0&&Si(l,t))switch(l.content.constructor){case Un:{const f=s.get("ychange");e!==void 0&&!Si(l,e)?(f===void 0||f.user!==l.id.client||f.type!=="removed")&&(c(),s.set("ychange",r?r("removed",l.id):{type:"removed"})):t!==void 0&&!Si(l,t)?(f===void 0||f.user!==l.id.client||f.type!=="added")&&(c(),s.set("ychange",r?r("added",l.id):{type:"added"})):f!==void 0&&(c(),s.delete("ychange")),a+=l.content.str;break}case kr:case cs:{c();const f={insert:l.content.getContent()[0]};if(s.size>0){const d={};f.attributes=d,s.forEach((h,p)=>{d[p]=h})}i.push(f);break}case Je:Si(l,e)&&(c(),ls(s,l.content));break}l=l.right}c()};return e||t?Oe(o,f=>{e&&Qu(f,e),t&&Qu(f,t),u()},"cleanup"):u(),i}insert(e,t,r){if(t.length<=0)return;const i=this.doc;i!==null?Oe(i,s=>{const o=ga(s,this,e,!r);r||(r={},o.currentAttributes.forEach((a,l)=>{r[l]=a})),ou(s,this,o,t,r)}):this._pending.push(()=>this.insert(e,t,r))}insertEmbed(e,t,r){const i=this.doc;i!==null?Oe(i,s=>{const o=ga(s,this,e,!r);ou(s,this,o,t,r||{})}):this._pending.push(()=>this.insertEmbed(e,t,r||{}))}delete(e,t){if(t===0)return;const r=this.doc;r!==null?Oe(r,i=>{ap(i,ga(i,this,e,!0),t)}):this._pending.push(()=>this.delete(e,t))}format(e,t,r){if(t===0)return;const i=this.doc;i!==null?Oe(i,s=>{const o=ga(s,this,e,!1);o.right!==null&&op(s,this,o,t,r)}):this._pending.push(()=>this.format(e,t,r))}removeAttribute(e){this.doc!==null?Oe(this.doc,t=>{hl(t,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,t){this.doc!==null?Oe(this.doc,r=>{mf(r,this,e,t)}):this._pending.push(()=>this.setAttribute(e,t))}getAttribute(e){return yf(this,e)}getAttributes(){return bb(this)}_write(e){e.writeTypeRef(M1)}}class au{constructor(e,t=()=>!0){this._filter=t,this._root=e,this._currentNode=e._start,this._firstCall=!0,e.doc??ht()}[Symbol.iterator](){return this}next(){let e=this._currentNode,t=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(t)))do if(t=e.content.type,!e.deleted&&(t.constructor===ao||t.constructor===Hi)&&t._start!==null)e=t._start;else for(;e!==null;){const r=e.next;if(r!==null){e=r;break}else e.parent===this._root?e=null:e=e.parent._item}while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class Hi extends nt{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Hi}clone(){const e=new Hi;return e.insert(0,this.toArray().map(t=>t instanceof nt?t.clone():t)),e}get length(){return this.doc??ht(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new au(this,e)}querySelector(e){e=e.toUpperCase();const r=new au(this,i=>i.nodeName&&i.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),zi(new au(this,t=>t.nodeName&&t.nodeName.toUpperCase()===e))}_callObserver(e,t){Bl(this,e,new x1(this,t,e))}toString(){return gb(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,t={},r){const i=e.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),oo(this,s=>{i.insertBefore(s.toDOM(e,t,r),null)}),i}insert(e,t){this.doc!==null?Oe(this.doc,r=>{yb(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}insertAfter(e,t){if(this.doc!==null)Oe(this.doc,r=>{const i=e&&e instanceof nt?e._item:e;fl(r,this,i,t)});else{const r=this._prelimContent,i=e===null?0:r.findIndex(s=>s===e)+1;if(i===0&&e!==null)throw Wi("Reference item not found");r.splice(i,0,...t)}}delete(e,t=1){this.doc!==null?Oe(this.doc,r=>{_b(r,this,e,t)}):this._prelimContent.splice(e,t)}toArray(){return hb(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return pb(this,e)}slice(e=0,t=this.length){return fb(this,e,t)}forEach(e){oo(this,e)}_write(e){e.writeTypeRef(O1)}}class ao extends Hi{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,t){super._integrate(e,t),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new ao(this.nodeName)}clone(){const e=new ao(this.nodeName),t=this.getAttributes();return xS(t,(r,i)=>{typeof r=="string"&&e.setAttribute(i,r)}),e.insert(0,this.toArray().map(r=>r instanceof nt?r.clone():r)),e}toString(){const e=this.getAttributes(),t=[],r=[];for(const a in e)r.push(a);r.sort();const i=r.length;for(let a=0;a<i;a++){const l=r[a];t.push(l+'="'+e[l]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=t.length>0?" "+t.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(e){this.doc!==null?Oe(this.doc,t=>{hl(t,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,t){this.doc!==null?Oe(this.doc,r=>{mf(r,this,e,t)}):this._prelimAttrs.set(e,t)}getAttribute(e){return yf(this,e)}hasAttribute(e){return vb(this,e)}getAttributes(e){return e?y1(this,e):bb(this)}toDOM(e=document,t={},r){const i=e.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return oo(this,o=>{i.appendChild(o.toDOM(e,t,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(e){e.writeTypeRef(A1),e.writeKey(this.nodeName)}}class x1 extends Fl{constructor(e,t,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,t.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class Tb{constructor(e,t){this.id=e,this.length=t}get deleted(){throw yn()}mergeWith(e){return!1}write(e,t,r){throw yn()}integrate(e,t){throw yn()}}const C1=0;class Qn extends Tb{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){t>0&&(this.id.clock+=t,this.length-=t),ab(e.doc.store,this)}write(e,t){e.writeInfo(C1),e.writeLen(this.length-t)}getMissing(e,t){return null}}class Ul{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Ul(this.content)}splice(e){throw yn()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeBuf(this.content)}getRef(){return 3}}class pl{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new pl(this.len)}splice(e){const t=new pl(this.len-e);return this.len=e,t}mergeWith(e){return this.len+=e.len,!0}integrate(e,t){ib(e.deleteSet,t.id.client,t.id.clock,this.len),t.markDeleted()}delete(e){}gc(e){}write(e,t){e.writeLen(this.len-t)}getRef(){return 1}}const S1=(n,e)=>new To({guid:n,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class zl{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const t={};this.opts=t,e.gc||(t.gc=!1),e.autoLoad&&(t.autoLoad=!0),e.meta!==null&&(t.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new zl(S1(this.doc.guid,this.opts))}splice(e){throw yn()}mergeWith(e){return!1}integrate(e,t){this.doc._item=t,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,t){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}class cs{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new cs(this.embed)}splice(e){throw yn()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeJSON(this.embed)}getRef(){return 5}}class Je{constructor(e,t){this.key=e,this.value=t}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Je(this.key,this.value)}splice(e){throw yn()}mergeWith(e){return!1}integrate(e,t){const r=t.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,t){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const T1=dl("node_env")==="development";class Ji{constructor(e){this.arr=e,T1&&H_(e)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Ji(this.arr)}splice(e){const t=new Ji(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){const r=this.arr.length;e.writeLen(r-t);for(let i=t;i<r;i++){const s=this.arr[i];e.writeAny(s)}}getRef(){return 8}}class Un{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Un(this.str)}splice(e){const t=new Un(this.str.slice(e));this.str=this.str.slice(0,e);const r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"�",t.str="�"+t.str.slice(1)),t}mergeWith(e){return this.str+=e.str,!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeString(t===0?this.str:this.str.slice(t))}getRef(){return 4}}const E1=0,N1=1,M1=2,A1=3,O1=4;class kr{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new kr(this.type._copy())}splice(e){throw yn()}mergeWith(e){return!1}integrate(e,t){this.type._integrate(e.doc,t)}delete(e){let t=this.type._start;for(;t!==null;)t.deleted?t.id.clock<(e.beforeState.get(t.id.client)||0)&&e._mergeStructs.push(t):t.delete(e),t=t.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let t=this.type._start;for(;t!==null;)t.gc(e,!0),t=t.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,t){this.type._write(e)}getRef(){return 7}}const Eb=(n,e,t)=>{const{client:r,clock:i}=e.id,s=new ut(Re(r,i+t),e,Re(r,i+t-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(t));return e.deleted&&s.markDeleted(),e.keep&&(s.keep=!0),e.redone!==null&&(s.redone=Re(e.redone.client,e.redone.clock+t)),e.right=s,s.right!==null&&(s.right.left=s),n._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),e.length=t,s};class ut extends Tb{constructor(e,t,r,i,s,o,a,l){super(e,l.getLength()),this.origin=r,this.left=t,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=l,this.info=this.content.isCountable()?Ug:0}set marker(e){(this.info&tu)>0!==e&&(this.info^=tu)}get marker(){return(this.info&tu)>0}get keep(){return(this.info&Bg)>0}set keep(e){this.keep!==e&&(this.info^=Bg)}get countable(){return(this.info&Ug)>0}get deleted(){return(this.info&eu)>0}set deleted(e){this.deleted!==e&&(this.info^=eu)}markDeleted(){this.info|=eu}getMissing(e,t){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=xt(t,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=xt(t,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===ja&&this.id.client!==this.parent.client&&this.parent.clock>=xt(t,this.parent.client))return this.parent.client;if(this.origin&&(this.left=tp(e,t,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=dr(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===Qn||this.right&&this.right.constructor===Qn)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===ut?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===ut&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===ja){const r=su(t,this.parent);r.constructor===Qn?this.parent=null:this.parent=r.content.type}return null}integrate(e,t){if(t>0&&(this.id.clock+=t,this.left=tp(e,e.doc.store,Re(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(t),this.length-=t),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),fa(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(fa(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(su(e.doc.store,i.origin)))s.has(su(e.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),ab(e.doc.store,this),this.content.integrate(e,this),rp(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new Qn(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:Re(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&fa(e.origin,this.lastId)&&this.right===e&&fa(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const t=this.parent._searchMarker;return t&&t.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const t=this.parent;this.countable&&this.parentSub===null&&(t._length-=this.length),this.markDeleted(),ib(e.deleteSet,this.id.client,this.id.clock,this.length),rp(e,t,this.parentSub),this.content.delete(e)}}gc(e,t){if(!this.deleted)throw Gr();this.content.gc(e),t?a1(e,this,new Qn(this.id,this.length)):this.content=new pl(this.length)}write(e,t){const r=t>0?Re(this.id.client,this.id.clock+t-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&G0|(r===null?0:ul)|(i===null?0:z_)|(s===null?0:V0);if(e.writeInfo(o),r!==null&&e.writeLeftID(r),i!==null&&e.writeRightID(i),r===null&&i===null){const a=this.parent;if(a._item!==void 0){const l=a._item;if(l===null){const c=i1(a);e.writeParentInfo(!0),e.writeString(c)}else e.writeParentInfo(!1),e.writeLeftID(l.id)}else a.constructor===String?(e.writeParentInfo(!0),e.writeString(a)):a.constructor===ja?(e.writeParentInfo(!1),e.writeLeftID(a)):Gr();s!==null&&e.writeString(s)}this.content.write(e,t)}}const Nb=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},Mb="__ $YJS$ __";Nb[Mb]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");Nb[Mb]=!0;const $1=ie("TOGGLE_CONNECT_COMMAND");var P1=Object.defineProperty,I1=(n,e,t)=>e in n?P1(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Z=(n,e,t)=>I1(n,typeof e!="symbol"?e+"":e,t);const lu=n=>Ae(ky(n)),Yr=Fm("cid",{parse:n=>typeof n=="string"?n:void 0}),Xr=Fm("segment",{parse:n=>typeof n=="string"?n:void 0}),td="unknown",Ab=1;class li extends gt{constructor(e="",t,r,i){super(i),Z(this,"__tag"),Z(this,"__marker"),Z(this,"__unknownAttributes"),this.__tag=e,this.__marker=t,this.__unknownAttributes=r}static getType(){return"unknown"}static clone(e){const{__tag:t,__marker:r,__unknownAttributes:i,__key:s}=e;return new li(t,r,i,s)}static importDOM(){return{[td]:e=>D1(e)?{conversion:R1,priority:1}:null}}static importJSON(e){return Ob().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setTag(e.tag).setMarker(e.marker).setUnknownAttributes(e.unknownAttributes)}setTag(e){if(this.__tag===e)return this;const t=this.getWritable();return t.__tag=e,t}getTag(){return this.getLatest().__tag}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement(td);return e.style.display="none",e}updateDOM(){return!1}exportDOM(){return{element:null}}exportJSON(){return{...super.exportJSON(),type:this.getType(),tag:this.getTag(),marker:this.getMarker(),unknownAttributes:this.getUnknownAttributes(),version:Ab}}canBeEmpty(){return!0}isInline(){return!0}extractWithChild(){return!1}excludeFromCopy(e){return e!=="clone"}}function R1(n){const e=n.getAttribute("data-tag")??"",t=n.getAttribute("data-marker")??"";return{node:Ob(e,t)}}function Ob(n,e,t){return Ae(new li(n,e,t))}function D1(n){return(n==null?void 0:n.tagName)===td}function Eo(n){return n instanceof li}const lo="id",$b=1;class qt extends gt{constructor(e="",t,r){super(r),Z(this,"__marker",lo),Z(this,"__code"),Z(this,"__unknownAttributes"),this.__code=e,this.__unknownAttributes=t}static getType(){return"book"}static clone(e){const{__code:t,__unknownAttributes:r,__key:i}=e;return new qt(t,r,i)}static importJSON(e){const{code:t}=e;return Pb(t).updateFromJSON(e)}static isValidBookCode(e){return Uv(e)}updateFromJSON(e){return super.updateFromJSON(e).setCode(e.code).setUnknownAttributes(e.unknownAttributes)}getMarker(){return this.getLatest().__marker}setCode(e){if(this.__code===e)return this;const t=this.getWritable();return t.__code=e,t}getCode(){return this.getLatest().__code}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("p");return e.setAttribute("data-marker",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`),e.setAttribute("data-code",this.__code),e}updateDOM(){return!1}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),code:this.getCode(),unknownAttributes:this.getUnknownAttributes(),version:$b}}}function Pb(n,e){return Ae(new qt(n,e))}function _n(n){return n instanceof qt}function L1(n){return(n==null?void 0:n.type)===qt.getType()}const me=" ",nd="​",_f=`${me}|`,Wl="p",zn="+",Kl="-",ml="chapter",rd="verse",lp="invalid",j1="text-spacing",F1="formatted-font",q1="marker-",bf="external-usj-mutation",Ib="selection-change",id="cursor-change",sd="annotation-change",od="delta-change",B1=[bf,Ib,id,sd,od],yl="c",Rb=1;class nn extends gt{constructor(e="",t,r,i,s,o){super(o),Z(this,"__marker"),Z(this,"__number"),Z(this,"__sid"),Z(this,"__altnumber"),Z(this,"__pubnumber"),Z(this,"__unknownAttributes"),this.__marker=yl,this.__number=e,this.__sid=t,this.__altnumber=r,this.__pubnumber=i,this.__unknownAttributes=s}static getType(){return"chapter"}static clone(e){const{__number:t,__sid:r,__altnumber:i,__pubnumber:s,__unknownAttributes:o,__key:a}=e;return new nn(t,r,i,s,o,a)}static importJSON(e){return Db().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setNumber(e.number).setSid(e.sid).setAltnumber(e.altnumber).setPubnumber(e.pubnumber).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}setNumber(e){if(this.__number===e)return this;const t=this.getWritable();return t.__number=e,t}getNumber(){return this.getLatest().__number}setSid(e){if(this.__sid===e)return this;const t=this.getWritable();return t.__sid=e,t}getSid(){return this.getLatest().__sid}setAltnumber(e){if(this.__altnumber===e)return this;const t=this.getWritable();return t.__altnumber=e,t}getAltnumber(){return this.getLatest().__altnumber}setPubnumber(e){if(this.__pubnumber===e)return this;const t=this.getWritable();return t.__pubnumber=e,t}getPubnumber(){return this.getLatest().__pubnumber}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("p");return e.setAttribute("data-marker",this.__marker),e.classList.add(ml,`usfm_${this.__marker}`),e.setAttribute("data-number",this.__number),e}updateDOM(){return!1}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),number:this.getNumber(),sid:this.getSid(),altnumber:this.getAltnumber(),pubnumber:this.getPubnumber(),unknownAttributes:this.getUnknownAttributes(),version:Rb}}}function Db(n,e,t,r,i){return Ae(new nn(n,e,t,r,i))}function vf(n){return n instanceof nn}function U1(n){return(n==null?void 0:n.type)===nn.getType()}const Lb=["fr","fq","fqa","fk","ft","fl","fw","fp","fv","fdc","fm"],jb=["xo","xop","xk","xq","xt","xta","xot","xnt","xdc"],z1=["ca","cp","va","vp","add","bk","dc","em","jmp","k","nd","ord","pn","png","qt","rb","rq","sig","sls","tl","w","wa","wg","wh","wj","bd","it","bdit","no","sc","sup","ior","iqt","qac","qs","litl","lik","liv","liv1","liv2","liv3","liv4","liv5",...Lb,...jb],Fb=1;class Ie extends gt{constructor(e="",t,r){super(r),Z(this,"__marker"),Z(this,"__unknownAttributes"),this.__marker=e,this.__unknownAttributes=t}static getType(){return"char"}static clone(e){const{__marker:t,__unknownAttributes:r,__key:i}=e;return new Ie(t,r,i)}static isValidMarker(e){return e!==void 0&&z1.includes(e)}static isValidFootnoteMarker(e){return e!==void 0&&Lb.includes(e)}static isValidCrossReferenceMarker(e){return e!==void 0&&jb.includes(e)}static importDOM(){return{span:e=>K1(e)?{conversion:W1,priority:1}:null}}static importJSON(e){return hn().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("span");return e.setAttribute("data-marker",this.__marker),e.setAttribute("title",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`),e}updateDOM(){return!1}exportDOM(e){const{element:t}=super.exportDOM(e);return t&&Ne(t)&&(t.setAttribute("data-marker",this.getMarker()),t.classList.add(this.getType(),`usfm_${this.getMarker()}`)),{element:t}}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),unknownAttributes:this.getUnknownAttributes(),version:Fb}}insertNewAfter(e,t){const r=hn(this.getMarker());return r.setTextFormat(e.format),r.setTextStyle(e.style),r.setDirection(this.getDirection()),r.setFormat(this.getFormatType()),r.setStyle(this.getTextStyle()),this.insertAfter(r,t),r}canBeEmpty(){return!1}isInline(){return!0}}function W1(n){const e=n.getAttribute("data-marker")??"f";return{node:hn(e)}}function hn(n,e){return Ae(new Ie(n,e))}function K1(n){if(!n)return!1;const e=n.getAttribute("data-marker")??"";return Ie.isValidMarker(e)&&n.classList.contains(Ie.getType())}function Te(n){return n instanceof Ie}function H1(n){return(n==null?void 0:n.type)===Ie.getType()}const qb=1,J1="c",Bb="span";class Jn extends _r{constructor(e="",t=!1,r,i,s,o,a){super(a),Z(this,"__marker"),Z(this,"__number"),Z(this,"__showMarker"),Z(this,"__sid"),Z(this,"__altnumber"),Z(this,"__pubnumber"),Z(this,"__unknownAttributes"),this.__marker=J1,this.__number=e,this.__showMarker=t,this.__sid=r,this.__altnumber=i,this.__pubnumber=s,this.__unknownAttributes=o}static getType(){return"immutable-chapter"}static clone(e){const{__number:t,__showMarker:r,__sid:i,__altnumber:s,__pubnumber:o,__unknownAttributes:a,__key:l}=e;return new Jn(t,r,i,s,o,a,l)}static importDOM(){return{span:e=>Ub(e)?{conversion:V1,priority:1}:null}}static importJSON(e){return kf().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setNumber(e.number).setShowMarker(e.showMarker).setSid(e.sid).setAltnumber(e.altnumber).setPubnumber(e.pubnumber).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}setNumber(e){if(this.__number===e)return this;const t=this.getWritable();return t.__number=e,t}getNumber(){return this.getLatest().__number}setShowMarker(e=!1){if(this.__showMarker===e)return this;const t=this.getWritable();return t.__showMarker=e,t}getShowMarker(){return this.getLatest().__showMarker}setSid(e){if(this.__sid===e)return this;const t=this.getWritable();return t.__sid=e,t}getSid(){return this.getLatest().__sid}setAltnumber(e){if(this.__altnumber===e)return this;const t=this.getWritable();return t.__altnumber=e,t}getAltnumber(){return this.getLatest().__altnumber}setPubnumber(e){if(this.__pubnumber===e)return this;const t=this.getWritable();return t.__pubnumber=e,t}getPubnumber(){return this.getLatest().__pubnumber}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement(Bb);return e.setAttribute("data-marker",this.__marker),e.classList.add(ml,`usfm_${this.__marker}`),this.__showMarker&&e.classList.add("marker"),e.setAttribute("data-number",this.__number),e}updateDOM(){return!1}exportDOM(e){const{element:t}=super.exportDOM(e);return t&&Ne(t)&&(t.setAttribute("data-marker",this.getMarker()),t.classList.add(ml,`usfm_${this.getMarker()}`),t.setAttribute("data-number",this.getNumber())),{element:t}}decorate(){return this.getShowMarker()?Mo(this.getMarker(),this.getNumber()):this.getNumber()}exportJSON(){return{type:this.getType(),marker:this.getMarker(),number:this.getNumber(),showMarker:this.getShowMarker(),sid:this.getSid(),altnumber:this.getAltnumber(),pubnumber:this.getPubnumber(),unknownAttributes:this.getUnknownAttributes(),version:qb}}isInline(){return!1}isKeyboardSelectable(){return!1}}function V1(n){const e=n.getAttribute("data-number")??"0";return{node:kf(e)}}function kf(n,e,t,r,i,s){return Ae(new Jn(n,e,t,r,i,s))}function Ub(n){return n?n.classList.contains(ml)&&n.tagName.toLowerCase()===Bb:!1}function No(n){return n instanceof Jn}function G1(n){return(n==null?void 0:n.type)===Jn.getType()}const zb=1;class fr extends br{static getType(){return"implied-para"}static clone(e){return new fr(e.__key)}static importJSON(e){return Vt().updateFromJSON(e)}getMarker(){return Wl}exportJSON(){return{...super.exportJSON(),type:this.getType(),version:zb}}insertNewAfter(e,t){const r=Vt();return r.setTextFormat(e.format),r.setTextStyle(e.style),r.setDirection(this.getDirection()),r.setFormat(this.getFormatType()),r.setStyle(this.getTextStyle()),this.insertAfter(r,t),r}}function Vt(){return Ae(new fr)}function Wn(n){return n instanceof fr}function wf(n){return(n==null?void 0:n.type)===fr.getType()}const Qr="zmsc-s",Pi="zmsc-e",Y1=[Qr,Pi],X1=["ts-s","ts-e","t-s","t-e","ts","qt1-s","qt1-e","qt2-s","qt2-e","qt3-s","qt3-e","qt4-s","qt4-e","qt5-s","qt5-e","qt-s","qt-e",Qr,Pi],Wb=1;class bn extends _r{constructor(e="",t,r,i,s){super(s),Z(this,"__marker"),Z(this,"__sid"),Z(this,"__eid"),Z(this,"__unknownAttributes"),this.__marker=e,this.__sid=t,this.__eid=r,this.__unknownAttributes=i}static getType(){return"ms"}static clone(e){const{__marker:t,__sid:r,__eid:i,__unknownAttributes:s,__key:o}=e;return new bn(t,r,i,s,o)}static importJSON(e){return Kb().updateFromJSON(e)}static isValidMarker(e){return e!==void 0&&(X1.includes(e)||e.startsWith("z"))}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setSid(e.sid).setEid(e.eid).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}setSid(e){if(this.__sid===e)return this;const t=this.getWritable();return t.__sid=e,t}getSid(){return this.getLatest().__sid}setEid(e){if(this.__eid===e)return this;const t=this.getWritable();return t.__eid=e,t}getEid(){return this.getLatest().__eid}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("span");return e.setAttribute("data-marker",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`),e}updateDOM(){return!1}decorate(){return""}exportJSON(){return{type:this.getType(),marker:this.getMarker(),sid:this.getSid(),eid:this.getEid(),unknownAttributes:this.getUnknownAttributes(),version:Wb}}isKeyboardSelectable(){return!1}}function Q1(n){return Y1.includes(n)}function Kb(n,e,t,r){return Ae(new bn(n,e,t,r))}function Hl(n){return n instanceof bn}const xf="f",Z1=[xf,"fe","ef","efe","x","ex"],Hb=1;class Ve extends gt{constructor(e=xf,t,r=!0,i,s,o){super(o),Z(this,"__marker"),Z(this,"__caller"),Z(this,"__isCollapsed"),Z(this,"__category"),Z(this,"__unknownAttributes"),this.__marker=e,this.__caller=t??(e==="x"||e==="ex"?Kl:zn),this.__isCollapsed=r,this.__category=i,this.__unknownAttributes=s}static getType(){return"note"}static clone(e){const{__marker:t,__caller:r,__isCollapsed:i,__category:s,__unknownAttributes:o,__key:a}=e;return new Ve(t,r,i,s,o,a)}static importDOM(){return{span:e=>tT(e)?{conversion:eT,priority:1}:null}}static importJSON(e){return Cf().updateFromJSON(e)}static isValidMarker(e){return e!==void 0&&Z1.includes(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setCaller(e.caller).setIsCollapsed(e.isCollapsed).setCategory(e.category).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}setCaller(e){if(this.__caller===e)return this;const t=this.getWritable();return t.__caller=e,t}getCaller(){return this.getLatest().__caller}setIsCollapsed(e){if(this.__isCollapsed===e)return this;const t=this.getWritable();return t.__isCollapsed=e,t}toggleIsCollapsed(){const e=this.getWritable();return e.__isCollapsed=!e.__isCollapsed,e}getIsCollapsed(){return this.getLatest().__isCollapsed}setCategory(e){if(this.__category===e)return this;const t=this.getWritable();return t.__category=e,t}getCategory(){return this.getLatest().__category}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("span");return e.setAttribute("data-marker",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`,this.__isCollapsed?"collapsed":"expanded"),e.setAttribute("data-caller",this.__caller),e}updateDOM(e){return e.__isCollapsed!==this.__isCollapsed}exportDOM(e){const{element:t}=super.exportDOM(e);return t&&Ne(t)&&(t.setAttribute("data-marker",this.getMarker()),t.classList.add(this.getType(),`usfm_${this.getMarker()}`,this.getIsCollapsed()?"collapsed":"expanded"),t.setAttribute("data-caller",this.getCaller())),{element:t}}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),caller:this.getCaller(),isCollapsed:this.getIsCollapsed(),category:this.getCategory(),unknownAttributes:this.getUnknownAttributes(),version:Hb}}canBeEmpty(){return!1}isInline(){return!0}}function eT(n){const e=n.getAttribute("data-marker")??"f",t=n.getAttribute("data-caller")??"",r=n.classList.contains("collapsed");return{node:Cf(e,t,r)}}function Cf(n,e,t,r,i){return Ae(new Ve(n,e,t,r,i))}function tT(n){if(!n)return!1;const e=n.getAttribute("data-marker")??"";return Ve.isValidMarker(e)&&n.classList.contains(Ve.getType())}function pe(n){return n instanceof Ve}const nT=["ide","sts","rem","h","toc1","toc2","toc3","toca1","toca2","toca3","imt","imt1","imt2","imt3","imt4","is","is1","is2","ip","ipi","im","imi","ipq","imq","ipr","iq","iq1","iq2","iq3","ili","ili1","ili2","ib","iot","io","io1","io2","io3","io4","iex","imte","imte1","imte2","ie","mt","mt1","mt2","mt3","mt4","mte","mte1","mte2","cl","cd","ms","ms1","ms2","ms3","mr","s","s1","s2","s3","s4","sr","r","d","sp","sd","sd1","sd2","sd3","sd4",Wl,"m","po","cls","pr","pc","pm","pmo","pmc","pmr","pi","pi1","pi2","pi3","mi","lit","nb","q","q1","q2","q3","q4","qr","qc","qa","qm","qm1","qm2","qm3","qd","b","lh","li","li1","li2","li3","li4","lf","lim","lim1","lim2","lim3","lim4","pb"],Jb=1;class Tt extends br{constructor(e=Wl,t,r){super(r),Z(this,"__marker"),Z(this,"__unknownAttributes"),this.__marker=e,this.__unknownAttributes=t}static getType(){return"para"}static clone(e){const{__marker:t,__unknownAttributes:r,__key:i}=e;return new Tt(t,r,i)}static isValidMarker(e){return e!==void 0&&nT.includes(e)}static importDOM(){return{p:()=>({conversion:rT,priority:1})}}static importJSON(e){return co().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("p");return e.setAttribute("data-marker",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`),e}exportDOM(e){const{element:t}=super.exportDOM(e);return t&&Ne(t)&&(t.setAttribute("data-marker",this.getMarker()),t.classList.add(this.getType(),`usfm_${this.getMarker()}`)),{element:t}}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),unknownAttributes:this.getUnknownAttributes(),version:Jb}}insertNewAfter(e,t){const r=co(this.getMarker());return r.setTextFormat(e.format),r.setTextStyle(e.style),r.setDirection(this.getDirection()),r.setFormat(this.getFormatType()),r.setStyle(this.getTextStyle()),this.insertAfter(r,t),r}}function rT(n){const e=n.getAttribute("data-marker")??void 0,t=co(e);if(n.style){t.setFormat(n.style.textAlign);const r=parseInt(n.style.textIndent,10)/20;r>0&&t.setIndent(r)}return{node:t}}function co(n,e){return Ae(new Tt(n,e))}function dt(n){return n instanceof Tt}function iT(n){return(n==null?void 0:n.type)===Tt.getType()}const _l="v",Vb=1;class bt extends ft{constructor(e="",t,r,i,s,o,a){super(t??e,a),Z(this,"__marker"),Z(this,"__number"),Z(this,"__sid"),Z(this,"__altnumber"),Z(this,"__pubnumber"),Z(this,"__unknownAttributes"),this.__marker=_l,this.__number=e,this.__sid=r,this.__altnumber=i,this.__pubnumber=s,this.__unknownAttributes=o}static getType(){return"verse"}static clone(e){const{__number:t,__text:r,__sid:i,__altnumber:s,__pubnumber:o,__unknownAttributes:a,__key:l}=e;return new bt(t,r,i,s,o,a,l)}static importJSON(e){return Gb().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setNumber(e.number).setSid(e.sid).setAltnumber(e.altnumber).setPubnumber(e.pubnumber).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}setNumber(e){if(this.__number===e)return this;const t=this.getWritable();return t.__number=e,t}getNumber(){return this.getLatest().__number}setSid(e){if(this.__sid===e)return this;const t=this.getWritable();return t.__sid=e,t}getSid(){return this.getLatest().__sid}setAltnumber(e){if(this.__altnumber===e)return this;const t=this.getWritable();return t.__altnumber=e,t}getAltnumber(){return this.getLatest().__altnumber}setPubnumber(e){if(this.__pubnumber===e)return this;const t=this.getWritable();return t.__pubnumber=e,t}getPubnumber(){return this.getLatest().__pubnumber}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(e){const t=super.createDOM(e);return t.setAttribute("data-marker",this.__marker),t.classList.add(rd,`usfm_${this.__marker}`),t.setAttribute("data-number",this.__number),t}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),number:this.getNumber(),sid:this.getSid(),altnumber:this.getAltnumber(),pubnumber:this.getPubnumber(),unknownAttributes:this.getUnknownAttributes(),version:Vb}}}function Gb(n,e,t,r,i,s){return Ae(new bt(n,e,t,r,i,s))}function Sf(n){return n instanceof bt}function sT(n){return(n==null?void 0:n.type)===bt.getType()}function oT(n){return U1(n)||G1(n)}function Lt(n){return vf(n)||No(n)}function aT(n,e){return n.find(t=>Lt(t)&&t.getNumber()===e.toString())}function lT(n,e=!1){return n.find((t,r)=>(!e||r>0)&&Lt(t))}function Tf(n){var e;if(!n)return;if(Lt(n))return n;let t=(e=n.getTopLevelElement())==null?void 0:e.getPreviousSibling();for(;t&&!Lt(t);)t=t.getPreviousSibling();if(t&&Lt(t))return t}function Yb(n){let e=n;for(;e!==null;){if(pe(e))return e;e=e.getParent()}}function cT(n){return _n(n)||vf(n)||Te(n)||No(n)||Wn(n)||Hl(n)||dt(n)||pe(n)||Sf(n)||Eo(n)}function uT(n){var e;if(n.anchor.type==="element"){const r=n.anchor.getNode(),i=n.anchor.offset;if(i<r.getChildrenSize())return r.getChildAtIndex(i)}const t=n.anchor.getNode();return t.getNextSibling()??((e=t.getParent())==null?void 0:e.getNextSibling())??null}function dT(n){var e;const t=n.anchor.offset;if(n.anchor.type==="element"&&t>0)return n.anchor.getNode().getChildAtIndex(t-1);const r=n.anchor.getNode();return r.getPreviousSibling()??((e=r.getParent())==null?void 0:e.getPreviousSibling())??null}function Kt(n){return dt(n)||Wn(n)}function fT(n,e){let t=n.getParent();for(;t;){if(t.getKey()===e)return!0;t=t.getParent()}return!1}function Zr(n,e){const t=Qi(e,Yr),r=!!(n.cid&&t),i=!n.cid&&!t;return n.style===e.getMarker()&&(i||r&&n.cid===t)}function hT(n,e){const t=F(n)?n:n.getParent(),r=F(e)?e:e.getParent(),i=t&&r?Ws(t,r):void 0;return i?i.commonAncestor:void 0}function gT(n){const e=n.getStartEndPoints();if(!e)return;const[t,r]=e,i=n.isBackward()?t:r;n.focus.set(i.key,i.offset,i.type),n.anchor.set(i.key,i.offset,i.type)}function Ef(n){return(n==null?void 0:n.type)===ft.getType()}function pT(n,e){if(!e)return;const t=n.findIndex(r=>r===e);t&&(n.length=t)}function mT(n,e){if(!e)return n;const t=e.getIndexWithinParent();return n.splice(t+1,n.length-t-1)}function Vn(n){return`\\${n}`}function Vi(n){return`\\${n}*`}function Xb(n,e,t){const r=Vn(n);if(e!=null&&e.startsWith(r)){const i=parseInt(e.slice(r.length),10);isNaN(i)||(t=i.toString())}return t}function Mo(n,e){let t=Vn(n);return e&&(t+=`${me}${e}`),t+=" ",t}function Qb(n){return Ef(n)&&n.text!==me?n.text:H1(n)?n.children.map(e=>Qb(e)).join(""):""}function yT(n){return n.map(e=>Qb(e)).filter(e=>e.length>0).join(" ").trim()}function Nf(n){return me+n+" "}function Mf(n){const e=[];for(const t of n){if(!Te(t))continue;const r=t.getTextContent();r!==me&&r.length>0&&e.push(r)}return e.join(" ").trim()}function Ge(n,e=Kv){const t={...n};return e.forEach(r=>{Reflect.deleteProperty(t,r)}),Object.keys(t).length===0?void 0:t}function _T(n,e){const t=e.getElementByKey(n.getKey());return t?t.tagName.toLowerCase():void 0}function ze(n){return Object.fromEntries(Object.entries(n).filter(([,e])=>e!==void 0))}function Zb(n){if(!n)return;const e=n.getNodes();if(e.length>0)return n.isBackward()?e[e.length-1]:e[0]}function ad(n,e){if(!e)return(n+1).toString();const t=e.split("-");if(t.length===2)return parseInt(t[1])?`${parseInt(t[1])+1}`:`${parseInt(t[0])+1}`;const r=RegExp(/^(\d+)([a-yA-Y]{1,3})$/).exec(e);if(!r)return(parseInt(e)+1).toString();const i=String.fromCharCode(r[2].charCodeAt(0)+1);return`${r[1]}${i}`}function Af(n,e){if(!e)return!1;const t=e.split("-").map(r=>parseInt(r));if(t.length<1||t.length>2||t[0]>t[1])throw new Error("isVerseInRange: invalid range");return t.length===1?n===t[0]:t.length===2&&isNaN(t[1])?n>=t[0]:(t.length===2&&isNaN(t[0])||n>=t[0])&&n<=t[1]}function bT(n){return!!n&&n.includes("-")}const vT=1;class ci extends ft{constructor(e="",t="opening",r){super(cu(e,t),r),Z(this,"__marker"),Z(this,"__markerSyntax"),this.__marker=e,this.__markerSyntax=t}static getType(){return"marker"}static clone(e){return new ci(e.__marker,e.__markerSyntax,e.__key)}static importJSON(e){return Gi().updateFromJSON(e)}updateFromJSON(e){const{marker:t,markerSyntax:r="opening"}=e;return super.updateFromJSON(e).setMarker(t).setMarkerSyntax(r)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t.__text=cu(e,t.__markerSyntax),t}getMarker(){return this.getLatest().__marker}setMarkerSyntax(e){if(this.__markerSyntax===e)return this;const t=this.getWritable();return t.__markerSyntax=e,t.__text=cu(t.__marker,e),t}getMarkerSyntax(){return this.getLatest().__markerSyntax}createDOM(e){const t=super.createDOM(e);return t.setAttribute("data-marker",this.__marker),t.classList.add(this.__markerSyntax),t}exportJSON(){return{...super.exportJSON(),type:this.getType(),text:this.getTextContent(),marker:this.getMarker(),markerSyntax:this.getMarkerSyntax(),version:vT}}}function Gi(n,e){return Ae(new ci(n,e))}function Ao(n){return n instanceof ci}function cu(n,e){return e==="closing"?Vi(n):e==="selfClosing"?Vi(""):Vn(n)}const rr="internal-comment",kT=[rr],wT={},xT=1;class tt extends gt{constructor(e=wT,t){super(t),Z(this,"__typedIDs"),this.__typedIDs=e}static getType(){return"typed-mark"}static clone(e){const t=JSON.parse(JSON.stringify(e.__typedIDs));return new tt(t,e.__key)}static isReservedType(e){return kT.includes(e)}static importDOM(){return null}static importJSON(e){return uo().updateFromJSON(e)}exportJSON(){return{...super.exportJSON(),type:this.getType(),typedIDs:this.getTypedIDs(),version:xT}}createDOM(e){const t=document.createElement("mark");for(const[r,i]of Object.entries(this.__typedIDs))ct(t,pa(e.theme.typedMark,r)),i.length>1&&ct(t,pa(e.theme.typedMarkOverlap,r));return t}updateDOM(e,t,r){for(const[i,s]of Object.entries(this.__typedIDs)){const o=e.__typedIDs[i].length,a=s.length,l=pa(r.theme.typedMark,i),c=pa(r.theme.typedMarkOverlap,i);o!==a&&(o===0?a===1&&ct(t,l):a===0&&qr(t,l),o===1?a===2&&ct(t,c):a===1&&qr(t,c))}return!1}updateFromJSON(e){return super.updateFromJSON(e).setTypedIDs(e.typedIDs)}hasID(e,t){const r=this.getTypedIDs()[e];if(!r)return!1;for(const i of r)if(t===i)return!0;return!1}getTypedIDs(){const e=this.getLatest();return rt(e)?e.__typedIDs:{}}setTypedIDs(e){const t=this.getWritable();return t.__typedIDs=e,t}addID(e,t){const r=this.getWritable();if(!rt(r))return;const i=r.__typedIDs[e]??[];r.__typedIDs[e]=i;for(const s of i)if(t===s)return;i.push(t)}deleteID(e,t){const r=this.getWritable();if(!rt(r))return;const i=r.__typedIDs[e];for(let s=0;s<i.length;s++)if(t===i[s]){i.splice(s,1);return}}hasNoIDsForEveryType(){return Object.values(this.getTypedIDs()).every(e=>e===void 0||e.length===0)}insertNewAfter(e,t=!0){const r=uo(this.__typedIDs);return this.insertAfter(r,t),r}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}canBeEmpty(){return!1}isInline(){return!0}extractWithChild(e,t,r){if(!q(t)||r==="html")return!1;const i=t.anchor,s=t.focus,o=i.getNode(),a=s.getNode(),l=t.isBackward()?i.offset-s.offset:s.offset-i.offset;return this.isParentOf(o)&&this.isParentOf(a)&&this.getTextContent().length===l}excludeFromCopy(e){return e!=="clone"}}function pa(n,e){return`${n}-${e}`}function uo(n){return Ae(new tt(n))}function rt(n){return n instanceof tt}function CT(n){return(n==null?void 0:n.type)===tt.getType()}function ev(n){const e=n.getChildren();let t=null;for(const r of e)t===null?n.insertBefore(r):t.insertAfter(r),t=r;n.remove()}function tv(n,e,t,r){const i=n.getNodes(),s=n.anchor.offset,o=n.focus.offset,a=i.length,l=n.isBackward(),c=l?o:s,u=l?s:o;let f,d;for(let h=0;h<a;h++){const p=i[h];if(F(d)&&d.isParentOf(p))continue;const m=h===0,y=h===a-1;let b=null;if(W(p)){const _=p.getTextContentSize(),w=m?c:0,T=y?u:_;if(w===0&&T===0)continue;const I=p.splitText(w,T);b=I.length>1&&(I.length===3||m&&!y||T===_)?I[1]:I[0]}else{if(rt(p))continue;F(p)&&p.isInline()&&(b=p)}if(b!==null){if(b&&b.is(f))continue;const _=b.getParent();(_==null||!_.is(f))&&(d=void 0),f=_,d===void 0&&(d=uo({[e]:[t]}),b.insertBefore(d)),d.append(b)}else f=void 0,d=void 0}e===rr&&F(d)&&(l?d.selectStart():d.selectEnd())}function ST(n,e,t){let r=n;for(;r!==null;){if(rt(r))return r.getTypedIDs()[e];if(W(r)&&t===r.getTextContentSize()){const i=r.getNextSibling();if(rt(i))return i.getTypedIDs()[e]}r=r.getParent()}}function cp(n){return`external-${n}`}const nv=1;class wr extends _r{constructor(e="",t="",r){super(r),Z(this,"__textType"),Z(this,"__text"),this.__textType=e,this.__text=t}static getType(){return"immutable-typed-text"}static clone(e){const{__textType:t,__text:r,__key:i}=e;return new wr(t,r,i)}static importDOM(){return{span:e=>ET(e)?{conversion:TT,priority:1}:null}}static importJSON(e){return Yi().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setTextType(e.textType).setTextContent(e.text)}setTextType(e){if(this.__textType===e)return this;const t=this.getWritable();return t.__textType=e,t}getTextType(){return this.getLatest().__textType}setTextContent(e){if(this.__text===e)return this;const t=this.getWritable();return t.__text=e,t}getTextContent(){return this.getLatest().__text}createDOM(){const e=document.createElement("span");return e.setAttribute("data-text-type",this.__textType),e.classList.add(this.__textType),e}updateDOM(){return!1}exportDOM(e){const{element:t}=super.exportDOM(e);return t&&Ne(t)&&t.setAttribute("data-text-type",this.getTextType()),{element:t}}decorate(){return this.getTextContent()}exportJSON(){return{type:this.getType(),textType:this.getTextType(),text:this.getTextContent(),version:nv}}isKeyboardSelectable(){return!1}}function TT(n){const e=n.getAttribute("data-text-type")??"",t=n.textContent??"";return{node:Yi(e,t)}}function Yi(n,e){return Ae(new wr(n,e))}function ET(n){return(n==null?void 0:n.tagName)==="span"}function bl(n){return n instanceof wr}function NT(n){return(n==null?void 0:n.type)===wr.getType()}const vl="unmatched",rv=1;class xr extends _r{constructor(e="",t){super(t),Z(this,"__marker"),this.__marker=e}static getType(){return"unmatched"}static clone(e){const{__marker:t,__key:r}=e;return new xr(t,r)}static importDOM(){return{[vl]:e=>AT(e)?{conversion:MT,priority:1}:null}}static importJSON(e){return Of().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}createDOM(){const e=document.createElement(vl);e.setAttribute("data-marker",this.__marker),e.classList.add(lp);const t=this.__marker.endsWith("*");return e.title=t?"This closing marker has no matching opening marker!":"This opening marker has no matching closing marker!",e}updateDOM(){return!1}exportDOM(e){const{element:t}=super.exportDOM(e);return t&&Ne(t)&&(t.setAttribute("data-marker",this.getMarker()),t.classList.add(lp)),{element:t}}decorate(){return`\\${this.getMarker()}${nd}`}exportJSON(){return{type:this.getType(),marker:this.getMarker(),version:rv}}isKeyboardSelectable(){return!1}}function MT(n){const e=n.getAttribute("data-marker")??"";return{node:Of(e)}}function Of(n){return Ae(new xr(n))}function AT(n){return(n==null?void 0:n.tagName)===vl}function iv(n){return n instanceof xr}const OT=[qt,Jn,nn,bt,Ie,Ve,bn,ci,li,wr,xr,Tt,fr,{replace:br,with:()=>Vt(),withKlass:fr}];var P;(function(n){n.FileIdentification="FileIdentification",n.Headers="Headers",n.Remarks="Remarks",n.Introduction="Introduction",n.DivisionMarks="DivisionMarks",n.Paragraphs="Paragraphs",n.Poetry="Poetry",n.TitlesHeadings="TitlesHeadings",n.Tables="Tables",n.CenterTables="CenterTables",n.RightTables="RightTables",n.Lists="Lists",n.Footnotes="Footnotes",n.CrossReferences="CrossReferences",n.SpecialText="SpecialText",n.CharacterStyling="CharacterStyling",n.Breaks="Breaks",n.SpecialFeatures="SpecialFeatures",n.PeripheralReferences="PeripheralReferences",n.PeripheralMaterials="PeripheralMaterials",n.Uncategorized="Uncategorized"})(P||(P={}));var $;(function(n){n.Paragraph="Paragraph",n.Character="Character",n.Note="Note",n.Unknown="Unknown"})($||($={}));const $T={id:{category:P.FileIdentification,type:$.Paragraph,description:"File identification information (BOOKID, FILENAME, EDITOR, MODIFICATION DATE)",hasEndMarker:!1,children:{FileIdentification:["usfm","ide"],Headers:["h","h1","h2","h3","toc1","toc2","toc3"],Remarks:["rem","sts","restore"],Introduction:["imt","imt1","imt2","imt3","imt4","imte","imte1","imte2","is","is1","is2","iot","io","io1","io2","io3","io4","ior","ip","im","ipi","imi","ili","ili1","ili2","ipq","imq","ipr","ib","iq","iq1","iq2","iq3","iex","ie"],DivisionMarks:["c","cl"],TitlesHeadings:["mt","mt1","mt2","mt3","mt4"]}},usfm:{category:P.FileIdentification,type:$.Paragraph,description:"File markup version information",hasEndMarker:!1,children:void 0},ide:{category:P.FileIdentification,type:$.Paragraph,description:"File encoding information",hasEndMarker:!1,children:{Remarks:["rem","sts"]}},h:{category:P.Headers,type:$.Paragraph,description:"Running header text for a book (basic)",hasEndMarker:!1,children:{Headers:["toc1","toc2","toc3","toca1","toca2","toca3"]}},h1:{category:P.Headers,type:$.Paragraph,description:"Running header text",hasEndMarker:!1,children:{Headers:["toc1","toc2","toc3","toca1","toca2","toca3"]}},h2:{category:P.Headers,type:$.Paragraph,description:"Running header text, left side of page",hasEndMarker:!1,children:{Headers:["toc1","toc2","toc3","toca1","toca2","toca3"]}},h3:{category:P.Headers,type:$.Paragraph,description:"Running header text, right side of page",hasEndMarker:!1,children:{Headers:["toc1","toc2","toc3","toca1","toca2","toca3"]}},toc1:{category:P.Headers,type:$.Paragraph,description:"Long table of contents text",hasEndMarker:!1,children:void 0},toc2:{category:P.Headers,type:$.Paragraph,description:"Short table of contents text",hasEndMarker:!1,children:void 0},toc3:{category:P.Headers,type:$.Paragraph,description:"Book Abbreviation",hasEndMarker:!1,children:void 0},toca1:{category:P.Headers,type:$.Paragraph,description:"Alternative language long table of contents text",hasEndMarker:!1,children:void 0},toca2:{category:P.Headers,type:$.Paragraph,description:"Alternative language short table of contents text",hasEndMarker:!1,children:void 0},toca3:{category:P.Headers,type:$.Paragraph,description:"Alternative language book Abbreviation",hasEndMarker:!1,children:void 0},rem:{category:P.Remarks,type:$.Paragraph,description:"Comments and remarks",hasEndMarker:!1,children:void 0},sts:{category:P.Remarks,type:$.Paragraph,description:"Status of this file",hasEndMarker:!1,children:void 0},restore:{category:P.Remarks,type:$.Paragraph,description:"Project restore information",hasEndMarker:!1,children:void 0},imt:{category:P.Introduction,type:$.Paragraph,description:"Introduction major title, level 1 (if single level) (basic)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imt1:{category:P.Introduction,type:$.Paragraph,description:"Introduction major title, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imt2:{category:P.Introduction,type:$.Paragraph,description:"Introduction major title, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imt3:{category:P.Introduction,type:$.Paragraph,description:"Introduction major title, level 3",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imt4:{category:P.Introduction,type:$.Paragraph,description:"Introduction major title, level 4 (usually within parenthesis)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imte:{category:P.Introduction,type:$.Paragraph,description:"Introduction major title at introduction end, level 1 (if single level)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imte1:{category:P.Introduction,type:$.Paragraph,description:"Introduction major title at introduction end, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imte2:{category:P.Introduction,type:$.Paragraph,description:"Introduction major title at introduction end, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},is:{category:P.Introduction,type:$.Paragraph,description:"Introduction section heading, level 1 (if single level) (basic)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"],CharacterStyling:["no"]}},is1:{category:P.Introduction,type:$.Paragraph,description:"Introduction section heading, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},is2:{category:P.Introduction,type:$.Paragraph,description:"Introduction section heading, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},iot:{category:P.Introduction,type:$.Paragraph,description:"Introduction outline title (basic)",hasEndMarker:!1,children:{Introduction:["iqt"],CharacterStyling:["no"]}},io:{category:P.Introduction,type:$.Paragraph,description:"Introduction outline text, level 1 (if single level)",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},io1:{category:P.Introduction,type:$.Paragraph,description:"Introduction outline text, level 1 (if multiple levels) (basic)",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},io2:{category:P.Introduction,type:$.Paragraph,description:"Introduction outline text, level 2",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},io3:{category:P.Introduction,type:$.Paragraph,description:"Introduction outline text, level 3",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},io4:{category:P.Introduction,type:$.Paragraph,description:"Introduction outline text, level 4",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ior:{category:P.Introduction,type:$.Character,description:"Introduction references range for outline entry; for marking references separately",hasEndMarker:!0,children:void 0},ip:{category:P.Introduction,type:$.Paragraph,description:"Introduction prose paragraph (basic)",hasEndMarker:!1,children:{Introduction:["iqt"],Footnotes:["f","fe","fm"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},im:{category:P.Introduction,type:$.Paragraph,description:"Introduction prose paragraph, with no first line indent (may occur after poetry)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ipi:{category:P.Introduction,type:$.Paragraph,description:"Introduction prose paragraph, indented, with first line indent",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},imi:{category:P.Introduction,type:$.Paragraph,description:"Introduction prose paragraph text, indented, with no first line indent",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ili:{category:P.Introduction,type:$.Paragraph,description:"A list entry, level 1 (if single level)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ili1:{category:P.Introduction,type:$.Paragraph,description:"A list entry, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ili2:{category:P.Introduction,type:$.Paragraph,description:"A list entry, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ipq:{category:P.Introduction,type:$.Paragraph,description:"Introduction prose paragraph, quote from the body text",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},imq:{category:P.Introduction,type:$.Paragraph,description:"Introduction prose paragraph, quote from the body text, with no first line indent",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ipr:{category:P.Introduction,type:$.Paragraph,description:"Introduction prose paragraph, right aligned",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},ib:{category:P.Introduction,type:$.Paragraph,description:"Introduction blank line",hasEndMarker:!1,children:{Introduction:["iqt"]}},iq:{category:P.Introduction,type:$.Paragraph,description:"Introduction poetry text, level 1 (if single level)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},iq1:{category:P.Introduction,type:$.Paragraph,description:"Introduction poetry text, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},iq2:{category:P.Introduction,type:$.Paragraph,description:"Introduction poetry text, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},iq3:{category:P.Introduction,type:$.Paragraph,description:"Introduction poetry text, level 3",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},iex:{category:P.Introduction,type:$.Paragraph,description:"Introduction explanatory or bridge text (e.g. explanation of missing book in Short Old Testament)",hasEndMarker:!1,children:{Introduction:["iqt"],CharacterStyling:["no"]}},iqt:{category:P.Introduction,type:$.Character,description:"For quoted scripture text appearing in the introduction",hasEndMarker:!0,children:void 0},ie:{category:P.Introduction,type:$.Paragraph,description:"Introduction ending marker",hasEndMarker:!1,children:void 0},c:{category:P.DivisionMarks,type:$.Paragraph,description:"Chapter number",hasEndMarker:!1,children:{DivisionMarks:["ca","cp","cl","cd"],Paragraphs:["p","m","po","pr","cls","pi","pi1","pi2","pi3","pc","mi","nb"],Poetry:["q","q1","q2","q3","q4","qc","qr","qa","qd","b"],TitlesHeadings:["mte","ms","ms1","ms2","ms3","s","s1","s2","s3","s4","r","sp","d","sd","sd1","sd2","sd3","sd4"],Lists:["lh","li","li1","li2","li3","li4","lf","lim","lim1","lim2","lim3","lim4"],Footnotes:["f","fe"],SpecialText:["lit"],Breaks:["pb"]}},ca:{category:P.DivisionMarks,type:$.Character,description:"Second (alternate) chapter number (for coding dual versification; useful for places where different traditions of chapter breaks need to be supported in the same translation)",hasEndMarker:!0,children:void 0},cp:{category:P.DivisionMarks,type:$.Paragraph,description:"Published chapter number (chapter string that should appear in the published text)",hasEndMarker:!1,children:{Footnotes:["f"]}},cl:{category:P.DivisionMarks,type:$.Paragraph,description:"Chapter label used for translations that add a word such as 'Chapter' before chapter numbers (e.g. Psalms). The subsequent text is the chapter label.",hasEndMarker:!1,children:void 0},cd:{category:P.DivisionMarks,type:$.Paragraph,description:"Chapter Description (Publishing option D, e.g. in Russian Bibles)",hasEndMarker:!1,children:{DivisionMarks:["vp"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},v:{category:P.DivisionMarks,type:$.Character,description:"A verse number",hasEndMarker:!1,children:void 0},va:{category:P.DivisionMarks,type:$.Character,description:"Second (alternate) verse number (for coding dual numeration in Psalms; see also NRSV Exo 22.1-4)",hasEndMarker:!0,children:void 0},vp:{category:P.DivisionMarks,type:$.Character,description:"Published verse marker (verse string that should appear in the published text)",hasEndMarker:!0,children:void 0},p:{category:P.Paragraphs,type:$.Paragraph,description:"Paragraph text, with first line indent (basic)",hasEndMarker:!1,children:{Paragraphs:["pmo","pm","pmc","pmr"],Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},m:{category:P.Paragraphs,type:$.Paragraph,description:"Paragraph text, with no first line indent (may occur after poetry) (basic)",hasEndMarker:!1,children:{Paragraphs:["pmo","pm","pmc","pmr"],Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},po:{category:P.Paragraphs,type:$.Paragraph,description:"Letter opening",hasEndMarker:!1,children:{Paragraphs:["pmo","pm","pmc","pmr"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pr:{category:P.Paragraphs,type:$.Paragraph,description:"Text refrain (paragraph text, right aligned)",hasEndMarker:!1,children:{Paragraphs:["pmo","pm","pmc","pmr"],Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},cls:{category:P.Paragraphs,type:$.Paragraph,description:"Letter Closing",hasEndMarker:!1,children:{SpecialText:["tl","sig","pn","png","addpn","add"]}},pmo:{category:P.Paragraphs,type:$.Paragraph,description:"Embedded text opening",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pm:{category:P.Paragraphs,type:$.Paragraph,description:"Embedded text paragraph",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pmc:{category:P.Paragraphs,type:$.Paragraph,description:"Embedded text closing",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pmr:{category:P.Paragraphs,type:$.Paragraph,description:"Embedded text refrain (e.g. Then all the people shall say, 'Amen!')",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pi:{category:P.Paragraphs,type:$.Paragraph,description:"Paragraph text, level 1 indent (if single level), with first line indent; often used for discourse (basic)",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pi1:{category:P.Paragraphs,type:$.Paragraph,description:"Paragraph text, level 1 indent (if multiple levels), with first line indent; often used for discourse",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pi2:{category:P.Paragraphs,type:$.Paragraph,description:"Paragraph text, level 2 indent, with first line indent; often used for discourse",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pi3:{category:P.Paragraphs,type:$.Paragraph,description:"Paragraph text, level 3 indent, with first line indent; often used for discourse",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pc:{category:P.Paragraphs,type:$.Paragraph,description:"Paragraph text, centered (for Inscription)",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},mi:{category:P.Paragraphs,type:$.Paragraph,description:"Paragraph text, indented, with no first line indent; often used for discourse",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},nb:{category:P.Paragraphs,type:$.Paragraph,description:"Paragraph text, with no break from previous paragraph text (at chapter boundary) (basic)",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q:{category:P.Poetry,type:$.Paragraph,description:"Poetry text, level 1 indent (if single level)",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q1:{category:P.Poetry,type:$.Paragraph,description:"Poetry text, level 1 indent (if multiple levels) (basic)",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q2:{category:P.Poetry,type:$.Paragraph,description:"Poetry text, level 2 indent (basic)",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q3:{category:P.Poetry,type:$.Paragraph,description:"Poetry text, level 3 indent",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q4:{category:P.Poetry,type:$.Paragraph,description:"Poetry text, level 4 indent",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qc:{category:P.Poetry,type:$.Paragraph,description:"Poetry text, centered",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qr:{category:P.Poetry,type:$.Paragraph,description:"Poetry text, Right Aligned",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qs:{category:P.Poetry,type:$.Character,description:"Poetry text, Selah",hasEndMarker:!0,children:{Footnotes:["f"],CrossReferences:["x"]}},qa:{category:P.Poetry,type:$.Paragraph,description:"Poetry text, Acrostic marker/heading",hasEndMarker:!1,children:void 0},qac:{category:P.Poetry,type:$.Character,description:"Poetry text, Acrostic markup of the first character of a line of acrostic poetry",hasEndMarker:!0,children:void 0},qm:{category:P.Poetry,type:$.Paragraph,description:"Poetry text, embedded, level 1 indent (if single level)",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qm1:{category:P.Poetry,type:$.Paragraph,description:"Poetry text, embedded, level 1 indent (if multiple levels)",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qm2:{category:P.Poetry,type:$.Paragraph,description:"Poetry text, embedded, level 2 indent",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qm3:{category:P.Poetry,type:$.Paragraph,description:"Poetry text, embedded, level 3 indent",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qd:{category:P.Poetry,type:$.Paragraph,description:"A Hebrew musical performance annotation, similar in content to Hebrew descriptive title.",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},b:{category:P.Poetry,type:$.Paragraph,description:"Poetry text stanza break (e.g. stanza break) (basic)",hasEndMarker:!1,children:void 0},mt:{category:P.TitlesHeadings,type:$.Paragraph,description:"The main title of the book (if single level)",hasEndMarker:!1,children:{Footnotes:["f"],CrossReferences:["x"]}},mt1:{category:P.TitlesHeadings,type:$.Paragraph,description:"The main title of the book (if multiple levels) (basic)",hasEndMarker:!1,children:{Footnotes:["f"],CrossReferences:["x"]}},mt2:{category:P.TitlesHeadings,type:$.Paragraph,description:"A secondary title usually occurring before the main title (basic)",hasEndMarker:!1,children:{Footnotes:["f"],CrossReferences:["x"]}},mt3:{category:P.TitlesHeadings,type:$.Paragraph,description:"A secondary title occurring after the main title",hasEndMarker:!1,children:{Footnotes:["f"],CrossReferences:["x"]}},mt4:{category:P.TitlesHeadings,type:$.Paragraph,description:"A small secondary title sometimes occurring within parentheses",hasEndMarker:!1,children:void 0},mte:{category:P.TitlesHeadings,type:$.Paragraph,description:"The main title of the book repeated at the end of the book, level 1 (if single level)",hasEndMarker:!1,children:void 0},mte1:{category:P.TitlesHeadings,type:$.Paragraph,description:"The main title of the book repeated at the end of the book, level 1 (if multiple levels)",hasEndMarker:!1,children:{TitlesHeadings:["mte2"]}},mte2:{category:P.TitlesHeadings,type:$.Paragraph,description:"A secondary title occurring before or after the 'ending' main title",hasEndMarker:!1,children:void 0},ms:{category:P.TitlesHeadings,type:$.Paragraph,description:"A major section division heading, level 1 (if single level) (basic)",hasEndMarker:!1,children:{TitlesHeadings:["mr"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},ms1:{category:P.TitlesHeadings,type:$.Paragraph,description:"A major section division heading, level 1 (if multiple levels)",hasEndMarker:!1,children:{TitlesHeadings:["mr"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},ms2:{category:P.TitlesHeadings,type:$.Paragraph,description:"A major section division heading, level 2",hasEndMarker:!1,children:{TitlesHeadings:["mr"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},ms3:{category:P.TitlesHeadings,type:$.Paragraph,description:"A major section division heading, level 3",hasEndMarker:!1,children:{TitlesHeadings:["mr"],Footnotes:["f","fe"]}},mr:{category:P.TitlesHeadings,type:$.Paragraph,description:"A major section division references range heading (basic)",hasEndMarker:!1,children:void 0},s:{category:P.TitlesHeadings,type:$.Paragraph,description:"A section heading, level 1 (if single level) (basic)",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},s1:{category:P.TitlesHeadings,type:$.Paragraph,description:"A section heading, level 1 (if multiple levels)",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},s2:{category:P.TitlesHeadings,type:$.Paragraph,description:"A section heading, level 2 (e.g. Proverbs 22-24)",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},s3:{category:P.TitlesHeadings,type:$.Paragraph,description:"A section heading, level 3 (e.g. Genesis 'The First Day')",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},s4:{category:P.TitlesHeadings,type:$.Paragraph,description:"A section heading, level 4",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},sr:{category:P.TitlesHeadings,type:$.Paragraph,description:"A section division references range heading",hasEndMarker:!1,children:void 0},r:{category:P.TitlesHeadings,type:$.Paragraph,description:"Parallel reference(s) (basic)",hasEndMarker:!1,children:void 0},sp:{category:P.TitlesHeadings,type:$.Paragraph,description:"A heading, to identify the speaker (e.g. Job)",hasEndMarker:!1,children:{Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},d:{category:P.TitlesHeadings,type:$.Paragraph,description:"A Hebrew text heading, to provide description (e.g. Psalms)",hasEndMarker:!1,children:{Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},sd:{category:P.TitlesHeadings,type:$.Paragraph,description:"Vertical space used to divide the text into sections, level 1 (if single level)",hasEndMarker:!1,children:void 0},sd1:{category:P.TitlesHeadings,type:$.Paragraph,description:"Vertical space used to divide the text into sections, level 1 (if multiple levels)",hasEndMarker:!1,children:void 0},sd2:{category:P.TitlesHeadings,type:$.Paragraph,description:"Vertical space used to divide the text into sections, level 2",hasEndMarker:!1,children:void 0},sd3:{category:P.TitlesHeadings,type:$.Paragraph,description:"Vertical space used to divide the text into sections, level 3",hasEndMarker:!1,children:void 0},sd4:{category:P.TitlesHeadings,type:$.Paragraph,description:"Vertical space used to divide the text into sections, level 4",hasEndMarker:!1,children:void 0},lh:{category:P.Lists,type:$.Paragraph,description:"List header (introductory remark)",hasEndMarker:!1,children:{Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li:{category:P.Lists,type:$.Paragraph,description:"A list entry, level 1 (if single level)",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li1:{category:P.Lists,type:$.Paragraph,description:"A list entry, level 1 (if multiple levels)",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li2:{category:P.Lists,type:$.Paragraph,description:"A list entry, level 2",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li3:{category:P.Lists,type:$.Paragraph,description:"A list entry, level 3",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li4:{category:P.Lists,type:$.Paragraph,description:"A list entry, level 4",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lf:{category:P.Lists,type:$.Paragraph,description:"List footer (concluding remark)",hasEndMarker:!1,children:{Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim:{category:P.Lists,type:$.Paragraph,description:"An embedded list entry, level 1 (if single level)",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim1:{category:P.Lists,type:$.Paragraph,description:"An embedded list entry, level 1 (if multiple levels)",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim2:{category:P.Lists,type:$.Paragraph,description:"An embedded list entry, level 2",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim3:{category:P.Lists,type:$.Paragraph,description:"An embedded list item, level 3",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim4:{category:P.Lists,type:$.Paragraph,description:"An embedded list entry, level 4",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},litl:{category:P.Lists,type:$.Character,description:"List entry total text",hasEndMarker:!0,children:void 0},lik:{category:P.Lists,type:$.Character,description:"Structured list entry key text",hasEndMarker:!0,children:void 0},liv:{category:P.Lists,type:$.Character,description:"Structured list entry value 1 content (if single value)",hasEndMarker:!0,children:void 0},liv1:{category:P.Lists,type:$.Character,description:"Structured list entry value 1 content (if multiple values)",hasEndMarker:!0,children:void 0},liv2:{category:P.Lists,type:$.Character,description:"Structured list entry value 2 content",hasEndMarker:!0,children:void 0},liv3:{category:P.Lists,type:$.Character,description:"Structured list entry value 3 content",hasEndMarker:!0,children:void 0},liv4:{category:P.Lists,type:$.Character,description:"Structured list entry value 4 content",hasEndMarker:!0,children:void 0},liv5:{category:P.Lists,type:$.Character,description:"Structured list entry value 5 content",hasEndMarker:!0,children:void 0},f:{category:P.Footnotes,type:$.Note,description:"A Footnote text item (basic)",hasEndMarker:!0,children:{Footnotes:["fr","ft","fk","fq","fqa","fl","fw","fp","fv","fdc"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},fe:{category:P.Footnotes,type:$.Note,description:"An Endnote text item",hasEndMarker:!0,children:{Footnotes:["fr","ft","fk","fq","fqa","fl","fw","fp","fv","fdc"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},fr:{category:P.Footnotes,type:$.Character,description:"The origin reference for the footnote (basic)",hasEndMarker:!0,children:void 0},ft:{category:P.Footnotes,type:$.Character,description:"Footnote text, Protocanon (basic)",hasEndMarker:!0,children:void 0},fk:{category:P.Footnotes,type:$.Character,description:"A footnote keyword (basic)",hasEndMarker:!0,children:void 0},fq:{category:P.Footnotes,type:$.Character,description:"A footnote scripture quote or alternate rendering (basic)",hasEndMarker:!0,children:void 0},fqa:{category:P.Footnotes,type:$.Character,description:"A footnote alternate rendering for a portion of scripture text",hasEndMarker:!0,children:void 0},fl:{category:P.Footnotes,type:$.Character,description:"A footnote label text item, for marking or 'labelling' the type or alternate translation being provided in the note.",hasEndMarker:!0,children:void 0},fw:{category:P.Footnotes,type:$.Character,description:"A footnote witness list, for distinguishing a list of sigla representing witnesses in critical editions.",hasEndMarker:!0,children:void 0},fp:{category:P.Footnotes,type:$.Character,description:"A Footnote additional paragraph marker",hasEndMarker:!0,children:void 0},fv:{category:P.Footnotes,type:$.Character,description:"A verse number within the footnote text",hasEndMarker:!0,children:void 0},fdc:{category:P.Footnotes,type:$.Character,description:"Footnote text, applies to Deuterocanon only",hasEndMarker:!0,children:void 0},fm:{category:P.Footnotes,type:$.Character,description:"An additional footnote marker location for a previous footnote",hasEndMarker:!0,children:void 0},x:{category:P.CrossReferences,type:$.Note,description:"A list of cross references (basic)",hasEndMarker:!0,children:{CrossReferences:["xo","xop","xt","xta","xk","xq","xot","xnt","xdc"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},xo:{category:P.CrossReferences,type:$.Character,description:"The cross reference origin reference (basic)",hasEndMarker:!0,children:void 0},xop:{category:P.CrossReferences,type:$.Character,description:"Published cross reference origin reference (origin reference that should appear in the published text)",hasEndMarker:!0,children:void 0},xt:{category:P.CrossReferences,type:$.Character,description:"The cross reference target reference(s), protocanon only (basic)",hasEndMarker:!0,children:void 0},xta:{category:P.CrossReferences,type:$.Character,description:"Cross reference target references added text",hasEndMarker:!0,children:void 0},xk:{category:P.CrossReferences,type:$.Character,description:"A cross reference keyword",hasEndMarker:!0,children:void 0},xq:{category:P.CrossReferences,type:$.Character,description:"A cross-reference quotation from the scripture text",hasEndMarker:!0,children:void 0},xot:{category:P.CrossReferences,type:$.Character,description:"Cross-reference target reference(s), Old Testament only",hasEndMarker:!0,children:void 0},xnt:{category:P.CrossReferences,type:$.Character,description:"Cross-reference target reference(s), New Testament only",hasEndMarker:!0,children:void 0},xdc:{category:P.CrossReferences,type:$.Character,description:"Cross-reference target reference(s), Deuterocanon only",hasEndMarker:!0,children:void 0},rq:{category:P.CrossReferences,type:$.Character,description:"A cross-reference indicating the source text for the preceding quotation.",hasEndMarker:!0,children:void 0},qt:{category:P.SpecialText,type:$.Character,description:"For Old Testament quoted text appearing in the New Testament (basic)",hasEndMarker:!0,children:void 0},nd:{category:P.SpecialText,type:$.Character,description:"For name of deity (basic)",hasEndMarker:!0,children:void 0},tl:{category:P.SpecialText,type:$.Character,description:"For transliterated words",hasEndMarker:!0,children:void 0},dc:{category:P.SpecialText,type:$.Character,description:"Deuterocanonical/LXX additions or insertions in the Protocanonical text",hasEndMarker:!0,children:void 0},bk:{category:P.SpecialText,type:$.Character,description:"For the quoted name of a book",hasEndMarker:!0,children:void 0},sig:{category:P.SpecialText,type:$.Character,description:"For the signature of the author of an Epistle",hasEndMarker:!0,children:void 0},pn:{category:P.SpecialText,type:$.Character,description:"For a proper name",hasEndMarker:!0,children:void 0},png:{category:P.SpecialText,type:$.Character,description:"For a geographic proper name",hasEndMarker:!0,children:void 0},addpn:{category:P.SpecialText,type:$.Character,description:"For chinese words to be dot underline & underline",hasEndMarker:!0,children:void 0},wj:{category:P.SpecialText,type:$.Character,description:"For marking the words of Jesus",hasEndMarker:!0,children:void 0},k:{category:P.SpecialText,type:$.Character,description:"For a keyword",hasEndMarker:!0,children:void 0},sls:{category:P.SpecialText,type:$.Character,description:"To represent where the original text is in a secondary language or from an alternate text source",hasEndMarker:!0,children:void 0},ord:{category:P.SpecialText,type:$.Character,description:"For the text portion of an ordinal number",hasEndMarker:!0,children:void 0},add:{category:P.SpecialText,type:$.Character,description:"For a translational addition to the text",hasEndMarker:!0,children:void 0},lit:{category:P.SpecialText,type:$.Paragraph,description:"For a comment or note inserted for liturgical use",hasEndMarker:!1,children:void 0},no:{category:P.CharacterStyling,type:$.Character,description:"A character style, use normal text",hasEndMarker:!0,children:void 0},it:{category:P.CharacterStyling,type:$.Character,description:"A character style, use italic text",hasEndMarker:!0,children:void 0},bd:{category:P.CharacterStyling,type:$.Character,description:"A character style, use bold text",hasEndMarker:!0,children:void 0},bdit:{category:P.CharacterStyling,type:$.Character,description:"A character style, use bold + italic text",hasEndMarker:!0,children:void 0},em:{category:P.CharacterStyling,type:$.Character,description:"A character style, use emphasized text style",hasEndMarker:!0,children:void 0},sc:{category:P.CharacterStyling,type:$.Character,description:"A character style, for small capitalization text",hasEndMarker:!0,children:void 0},sup:{category:P.CharacterStyling,type:$.Character,description:"A character style, for superscript text. Typically for use in critical edition footnotes.",hasEndMarker:!0,children:void 0},pb:{category:P.Breaks,type:$.Paragraph,description:"Page Break used for new reader portions and children's bibles where content is controlled by the page",hasEndMarker:!1,children:void 0}},Pr={DivisionMarks:{add:["v","c"],remove:[]},Paragraphs:{add:["p"],remove:[]},Poetry:{add:["q","q1","q2","q3","q4","b"],remove:[]},TitlesHeadings:{add:["mte","ms","ms1","ms2","ms3","s","s1","s2","s3","s4","r","sp","d","sd","sd1","sd2","sd3","sd4"],remove:[]}},PT={p:{children:Pr},q:{children:Pr},q1:{children:Pr},q2:{children:Pr},q3:{children:Pr},q4:{children:Pr},b:{children:Pr},qm:{children:{Paragraphs:{add:["p"],remove:[]}}},c:{type:$.Paragraph,children:null},v:{children:null}};function up(n){const e=$T[n],t=PT[n];if(!e)return;if(!t)return e;let r=e.children?{...e.children}:void 0;if(t.children===null&&(r=void 0),t.children){r=r||{};for(const[i,s]of Object.entries(t.children)){const o=i;if(s===null)Reflect.deleteProperty(r,o);else{let a=r[o]||[];s.remove&&(a=a.filter(l=>!s.remove.includes(l))),s.add&&(a=[...new Set([...a,...s.add])]),a.length>0?r[o]=a:Reflect.deleteProperty(r,o)}}Object.keys(r).length===0&&(r=void 0)}return{...e,...t,children:r}}function dp(n,e,t){const r={type:Hs,version:Js,content:n},i=e.serializeEditorState(r,t);return wf(i.root.children[0])?i.root.children[0].children[0]:i.root.children[0]}function ld(n,e){if(!n||!W(n))return[void 0,void 0];const t=n.getTextContent();if(e>=0&&e<t.length)return[n,e];let r=n.getNextSibling();if(!r){const s=n.getParent();rt(s)&&(r=s.getNextSibling())}if(!r||!rt(r)&&!W(r))return[void 0,void 0];const i=e-t.length;return r&&W(r)?ld(r,i):ld(r.getFirstChild()??void 0,i)}function fp(n){const e=zv(n.jsonPath);let t=ye();for(const r of e){if(!t||!F(t))return[void 0,void 0];t=t.getChildAtIndex(r)??void 0}return ld(t,n.offset)}function hp(n){return F(n)?"element":"text"}function $f(n){const{start:e}=n;let{end:t}=n;t===void 0&&(t=e);const[r,i]=fp(e),[s,o]=fp(t);if(!r||!s||i===void 0||o===void 0)return;const a=bo();return a.anchor=St(r.getKey(),i,hp(r)),a.focus=St(s.getKey(),o,hp(s)),a}function gp(n,e){const t=[];let r=n;for(;r!=null&&r.getParent();){const i=r.getParent();if(i){const s=i==null?void 0:i.getChildren().indexOf(r);s>=0&&t.unshift(s)}r=i}return{jsonPath:Wv(t),offset:e}}function sv(){const n=K();if(!n||!q(n))return;const e=n.isBackward()?n.focus.getNode():n.anchor.getNode(),t=n.isBackward()?n.focus.offset:n.anchor.offset,r=gp(e,t);if(n.isCollapsed())return{start:r};const i=n.isBackward()?n.anchor.getNode():n.focus.getNode(),s=n.isBackward()?n.anchor.offset:n.focus.offset,o=gp(i,s);return{start:r,end:o}}const ov="v",av=1;class vt extends _r{constructor(e="",t=!1,r,i,s,o,a){super(a),Z(this,"__marker"),Z(this,"__number"),Z(this,"__showMarker"),Z(this,"__sid"),Z(this,"__altnumber"),Z(this,"__pubnumber"),Z(this,"__unknownAttributes"),this.__marker=ov,this.__number=e,this.__showMarker=t,this.__sid=r,this.__altnumber=i,this.__pubnumber=s,this.__unknownAttributes=o}static getType(){return"immutable-verse"}static clone(e){const{__number:t,__showMarker:r,__sid:i,__altnumber:s,__pubnumber:o,__unknownAttributes:a,__key:l}=e;return new vt(t,r,i,s,o,a,l)}static importDOM(){return{span:e=>RT(e)?{conversion:IT,priority:1}:null}}static importJSON(e){return Pf().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setNumber(e.number).setShowMarker(e.showMarker).setSid(e.sid).setAltnumber(e.altnumber).setPubnumber(e.pubnumber).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}setNumber(e){if(this.__number===e)return this;const t=this.getWritable();return t.__number=e,t}getNumber(){return this.getLatest().__number}setShowMarker(e=!1){if(this.__showMarker===e)return this;const t=this.getWritable();return t.__showMarker=e,t}getShowMarker(){return this.getLatest().__showMarker}setSid(e){if(this.__sid===e)return this;const t=this.getWritable();return t.__sid=e,t}getSid(){return this.getLatest().__sid}setAltnumber(e){if(this.__altnumber===e)return this;const t=this.getWritable();return t.__altnumber=e,t}getAltnumber(){return this.getLatest().__altnumber}setPubnumber(e){if(this.__pubnumber===e)return this;const t=this.getWritable();return t.__pubnumber=e,t}getPubnumber(){return this.getLatest().__pubnumber}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("span");return e.setAttribute("data-marker",this.__marker),e.classList.add(rd,`usfm_${this.__marker}`),this.__showMarker&&e.classList.add("marker"),e.setAttribute("data-number",this.__number),e}updateDOM(){return!1}exportDOM(e){const{element:t}=super.exportDOM(e);return t&&Ne(t)&&(t.setAttribute("data-marker",this.getMarker()),t.classList.add(rd,`usfm_${this.getMarker()}`),t.setAttribute("data-number",this.getNumber())),{element:t}}decorate(){return S.jsx("span",{children:this.getShowMarker()?Mo(this.getMarker(),this.getNumber()):nd+this.getNumber()+nd})}exportJSON(){return{type:this.getType(),marker:this.getMarker(),number:this.getNumber(),showMarker:this.getShowMarker(),sid:this.getSid(),altnumber:this.getAltnumber(),pubnumber:this.getPubnumber(),unknownAttributes:this.getUnknownAttributes(),version:av}}isKeyboardSelectable(){return!1}}function IT(n){const e=n.getAttribute("data-number")??"0";return{node:Pf(e)}}function Pf(n,e,t,r,i,s){return Ae(new vt(n,e,t,r,i,s))}function RT(n){return((n==null?void 0:n.getAttribute("data-marker"))??void 0)===ov}function us(n){return n instanceof vt}function DT(n){return(n==null?void 0:n.type)===vt.getType()}function jt(n){return Sf(n)||us(n)}function LT(n){return sT(n)||DT(n)}function jT(n,e,t,r,i,s,o){if(!Ve.isValidMarker(n))throw new Error(`$insertNote: Invalid note marker '${n}'`);const a=t?$f(t):K();if(!q(a))return;const l=FT(a,n,r,o);if(l===void 0)return;const c=cv(n,e,l,i,s);return lv(c,a,i),c}function lv(n,e,t){const r=(t==null?void 0:t.noteMode)==="collapsed";if(n.setIsCollapsed(r),e.isCollapsed()||gT(e),e.insertNodes([n]),!r){const i=n.getChildren().reverse().find(Te);i==null||i.selectEnd()}}function FT(n,e,t,r){const i=[],{chapterNum:s,verseNum:o}=t??{};switch(e){case"f":case"fe":case"ef":case"efe":if(s!==void 0&&o!==void 0&&i.push(hn("fr").append(de(`${s}:${o}`))),!n.isCollapsed()){const a=n.getTextContent().trim();if(a.length>0){const l=hn("fq");l.append(de(a)),i.push(l)}}i.push(hn("ft").append(de(me)));break;case"x":case"ex":s!==void 0&&o!==void 0&&i.push(hn("xo").append(de(`${s}:${o}`))),i.push(hn("xt").append(de(me)));break;default:r==null||r.warn(`$createNoteChildren: Unsupported note marker '${e}'`);return}return i}function cv(n,e,t,r,i,s){const o=(r==null?void 0:r.noteMode)!=="expanded",a=Cf(n,e,o);s&&Dn(a,Xr,()=>s);let l,c;(r==null?void 0:r.markerMode)==="editable"?(l=Gi(n),c=Gi(n,"closing")):(r==null?void 0:r.markerMode)==="visible"&&(l=Yi("marker",Vn(n)+me),c=Yi("marker",Vi(n)+me));let u;if(l&&a.append(l),(r==null?void 0:r.markerMode)==="editable")e===""?a.append(...t):(u=de(Nf(a.__caller)),a.append(u,...t));else{const f=()=>de(me),d=t.flatMap(BT(f));if(e==="")a.append(...d);else{const h=Mf(t);let p=()=>{};i!=null&&i.noteCallerOnClick&&(p=i.noteCallerOnClick),u=Lf(a.__caller,h,p),a.append(u,f(),...d)}}return c&&a.append(c),a}function pp(n){var e;if(typeof n=="string"){const i=ce(n);return pe(i)?i:void 0}const t=xo();if(t.length<=0)return;const r=(e=t.filter(i=>pe(i.node))[n])==null?void 0:e.node;if(pe(r))return r}function qT(n,e){const t=(e==null?void 0:e.noteMode)==="collapsed";if(n.setIsCollapsed(t),t){const r=n.getPreviousSibling();if(us(r)||!r){const i=n.getParent();if(i){const s=n.getIndexWithinParent();i.select(s,s)}}else r.selectEnd()}else{const r=n.getChildren().reverse().find(Te);r==null||r.selectEnd()}}function BT(n){return e=>bl(e)?[e]:[e,n()]}function UT(n){return n.find(e=>dt(e))}function zT(n,e){return F(n)?n.getChildren().find(t=>jt(t)&&Af(e,t.getNumber())):void 0}function WT(n,e){return e===0?UT(n):n.map(t=>zT(t,e)).filter(t=>t)[0]}function mp(n){return!n||!F(n)?void 0:n.getChildren().findLast(e=>jt(e))}function uv(n){var e,t;if(!n||Lt(n))return;if(jt(n))return n;let r=rt(n.getParent())?(e=n.getParent())==null?void 0:e.getPreviousSibling():n.getPreviousSibling();for(;r&&!jt(r)&&!Lt(r);)r=r.getPreviousSibling();if(r&&jt(r))return r;let i=(t=n.getTopLevelElement())==null?void 0:t.getPreviousSibling(),s=mp(i),o=s;for(;i&&!s&&!Lt(i);)s=o,i=i.getPreviousSibling(),o=mp(i);if(!(!s&&Lt(i)))return s}function KT(n){return cT(n)||us(n)}function If(n){if(W(n)){const e=n.getTextContent();!e.endsWith(" ")&&!e.endsWith(me)&&n.setTextContent(`${e} `)}}function dv(n){if(W(n)){const e=n.getTextContent();e.startsWith(" ")&&n.setTextContent(e.trimStart())}}function Rf(n,e){return n.getEditorState().read(()=>!ce(e))}const HT=["style"],JT=["style","code"],kl=["style","cid"],VT=["style","number","sid","altnumber","pubnumber"],GT=["style","number","sid","altnumber","pubnumber"],YT=["style","sid","eid"],XT=["style","caller","category","contents"],QT=["chapter","immutable-chapter","verse","immutable-verse","ms","note","unmatched"],fo=`
`;function ZT(n,e){const t=ce(n);if(!Zt(t))return;const r=fv(t);return r===void 0?void 0:[{retain:r},...e,{delete:1}]}function fv(n){if(!n)return;const e=xo();let t=0;const r=[];let i,s;const o=n.getKey();let a;for(const l of e){const c=l.node;for(let u=r.length-1;u>=0;u--)if(ho(r[u],l)){const f=r[u];if(r.splice(u,1),t+=1,a&&f.getKey()===a.getKey())return t-1}if(i&&ho(i,l)&&(i=void 0,s=void 0),i){if(c.getKey()===o)return s;continue}if(c.getKey()===o){if(W(c)||Zt(c))return t;Bt(c)&&(a=c)}if(Bt(c)&&(r.includes(c)||r.push(c)),pe(c)){i=c,s=t,t+=1;continue}t+=hv(c)}if(a)return t}function yp(n,e){if(n.length<2||!nE(n[0])||!tE(n[1]))return;const t=n[0].retain;return e.read(()=>{const r=eE(t);return r==null?void 0:r.getKey()})}function eE(n){const e=xo();let t=0;const r=[];let i,s;for(const o of e){const a=o.node;for(let c=r.length-1;c>=0;c--)if(ho(r[c],o)){const u=r[c];if(r.splice(c,1),t===n)return u;t+=1}if(i&&ho(i,o)&&(i=void 0,s=void 0),i){if(s===n)return i;continue}if(Bt(a)&&(r.includes(a)||r.push(a)),pe(a)){if(i=a,s=t,t===n)return a;t+=1;continue}const l=hv(a);if(W(a)&&l>0&&n>=t&&n<t+l||Zt(a)&&t===n)return a;t+=l}for(const o of r){if(t===n)return o;t+=1}}function ho(n,e){return n?e?!fT(e.node,n.getKey()):!0:!1}function Zt(n){return Lt(n)||jt(n)||Hl(n)||pe(n)||iv(n)}function Bt(n){return Kt(n)||_n(n)}function $s(n,e){return e.insert!=null&&typeof e.insert=="object"&&n in e.insert}function tE(n){if(n.insert==null||typeof n.insert!="object")return!1;const e=Object.keys(n.insert)[0];return n.insert!=null&&typeof n.insert=="object"&&e in n.insert&&QT.includes(e)}function nE(n){return n.retain!=null&&typeof n.retain=="number"}function hv(n){return W(n)?n.getTextContentSize():Zt(n)?1:0}function cd(n,e){const t={insert:n.__text},r=Qi(n,Xr);if(r&&(t.attributes={segment:r}),e&&e.length>0){const i=gv(e);i&&(t.attributes={...t.attributes,char:i})}return t}function _p(n){const e=new Fs;return n.isEmpty()||n.read(()=>{const t=ye();if(!t||t.isEmpty())return;const r=t.getChildren();if(r.length===1&&Wn(r[0])&&(!r[0].getChildren()||r[0].getChildrenSize()===0))return;const i=rE();for(const s of i)e.push(s)}),e}function Df(n,e){const t=[],r=xo(n),i=[],s=[],o={children:[],contentsOps:[]},a=new Set;for(let l=0;l<r.length;l++){const c=r[l].node;t.push(...bp(c,l,r,i,s,o,a))}for(const l of i)t.push(...bp(l,r.length,r,i,s,o,a));return t}function rE(){return Df()}function bp(n,e,t,r,i,s,o){if(!n)return[];const a=[];return iE(n,a,r),sE(n,a,i,s,o),oE(n,e,t,i,o,s,a),Lt(n)&&a.push(cE(n)),jt(n)&&a.push(dE(n)),Hl(n)&&a.push(fE(n)),iv(n)&&a.push(hE(n)),aE(n,a,s),a}function iE(n,e,t){if(!n.isInline()){const r=t.pop();_n(r)?e.push(lE(r)):dt(r)?e.push(uE(r)):Wn(r)&&e.push({insert:fo})}Bt(n)&&(t.includes(n)||t.push(n))}function sE(n,e,t,r,i){var s;if(!W(n))return;const o=n.getParent();if(pe(o)&&o.getFirstChild()===n)return;const a=n.getTextContent(),l=a.startsWith(_f),c=Te(o)?o:void 0,u=!!c&&a===me&&c.getChildrenSize()===1,f=cd(n,t);if(r.children.includes(n)){if(!a||a===me||l)return;(s=r.contentsOps)==null||s.push(f)}else u||l&&c||e.push(f);const d=a!==""&&!u&&!(l&&c);if(t.length>0&&d)for(const h of t)i.add(h)}function oE(n,e,t,r,i,s,o){var a;Te(n)&&!r.includes(n)&&r.push(n);const l=t[e+1];for(const c of r.toReversed())if(ho(c,l)){if(r.pop(),!i.has(c)){const u=pE(c);s.children.includes(c)?(a=s.contentsOps)==null||a.push(u):o.push(u)}i.delete(c)}}function aE(n,e,t){var r,i;if(!pe(n))return;xo(n).forEach(o=>t.children.push(o.node));const s=gE(n);t.contentsOps=(i=(r=s.insert.note)==null?void 0:r.contents)==null?void 0:i.ops,e.push(s)}function lE(n){const e={style:lo,code:n.__code};return{insert:fo,attributes:{book:e}}}function cE(n){const e={style:yl,number:n.__number};return n.__sid&&(e.sid=n.__sid),n.__altnumber&&(e.altnumber=n.__altnumber),n.__pubnumber&&(e.pubnumber=n.__pubnumber),{insert:{chapter:e}}}function uE(n){const e={style:n.__marker};return{insert:fo,attributes:{para:e}}}function dE(n){const e={style:_l,number:n.__number};return n.__sid&&(e.sid=n.__sid),n.__altnumber&&(e.altnumber=n.__altnumber),n.__pubnumber&&(e.pubnumber=n.__pubnumber),{insert:{verse:e}}}function fE(n){const e={style:n.__marker};return n.__sid&&(e.sid=n.__sid),n.__eid&&(e.eid=n.__eid),{insert:{milestone:e}}}function hE(n){return{insert:{unmatched:{marker:n.__marker}}}}function gE(n){const e={style:n.__marker,caller:n.__caller};n.__category&&(e.category=n.__category),n.getChildrenSize()>1&&(e.contents={ops:[]});const t={insert:{note:e}},r=Qi(n,Xr);return r&&(t.attributes={segment:r}),t}function pE(n){const e={insert:""},t=gv([n]);return t&&(e.attributes={char:t}),e}function gv(n){if(n.length===0)return;const e=n.map(mE);return e.length===1?e[0]:e}function mE(n){const e={style:n.__marker},t=Qi(n,Yr);t&&(e.cid=t);const r=n.getUnknownAttributes();return r&&Object.keys(r).length>0&&Object.assign(e,r),e}const pv=1;class Gt extends _r{constructor(e=zn,t="",r,i){super(i),Z(this,"__caller"),Z(this,"__previewText"),Z(this,"__onClick"),this.__caller=e,this.__previewText=t,this.__onClick=r??(()=>{})}static getType(){return"immutable-note-caller"}static clone(e){const{__caller:t,__previewText:r,__onClick:i,__key:s}=e;return new Gt(t,r,i,s)}static importDOM(){return{span:e=>_E(e)?{conversion:yE,priority:1}:null}}static importJSON(e){return Lf().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setCaller(e.caller).setPreviewText(e.previewText).setOnClick(e.onClick)}setCaller(e){if(this.__caller===e)return this;const t=this.getWritable();return t.__caller=e,t}getCaller(){return this.getLatest().__caller}setPreviewText(e){if(this.__previewText===e)return this;const t=this.getWritable();return t.__previewText=e,t}getPreviewText(){return this.getLatest().__previewText}setOnClick(e){if(this.__onClick===e)return this;const t=this.getWritable();return t.__onClick=e,t}getOnClick(){return this.getLatest().__onClick}createDOM(){const e=document.createElement("span");return e.classList.add(this.__type),e.setAttribute("data-caller",this.__caller),e.setAttribute("data-preview-text",this.__previewText),e}updateDOM(e){return e.__caller!==this.__caller}exportDOM(e){const{element:t}=super.exportDOM(e);return t&&Ne(t)&&(t.classList.add(this.getType()),t.setAttribute("data-caller",this.getCaller()),t.setAttribute("data-preview-text",this.getPreviewText())),{element:t}}decorate(e){const t=this.getParent();if(!t)return null;const r=t.getKey(),i=t.getIsCollapsed(),s=this.__key,o=l=>{var c;return(c=this.__onClick)==null?void 0:c.call(this,l,r,i,()=>bE(e,r),u=>vE(e,r,s,u),()=>kE(e,r))},a=`${this.__caller}_${this.__previewText}}`.replace(/\s+/g,"").substring(0,25);return S.jsx("button",{onClick:o,title:this.__previewText,"data-caller-id":a,children:this.__caller===zn&&i?"":this.__caller})}exportJSON(){return{type:this.getType(),caller:this.getCaller(),previewText:this.getPreviewText(),onClick:this.getOnClick(),version:pv}}isKeyboardSelectable(){return!1}}function yE(n){const e=n.getAttribute("data-caller")??"",t=n.getAttribute("data-preview-text")??"";return{node:Lf(e,t)}}function Lf(n,e,t){return Ae(new Gt(n,e,t))}function _E(n){return n?n.classList.contains(Gt.getType()):!1}function Cr(n){return n instanceof Gt}function bE(n,e){return n.read(()=>{const t=ce(e);if(!pe(t))throw new Error(`getNoteCaller: Note node not found: ${e}`);return t.getCaller()})}function vE(n,e,t,r){n.update(()=>{const i=ce(e);if(!pe(i))throw new Error(`setNoteCaller: Note node not found: ${e}`);i.setCaller(r);const s=ce(t);if(!Cr(s))throw new Error(`setNoteCaller: Caller node not found: ${t}`);s.setCaller(r)})}function kE(n,e){return n.read(()=>{const t=ce(e);if(!pe(t))throw new Error(`getNoteOps: Note node not found: ${e}`);return Df(t)})}const wE=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],xE=[Gt,vt,...OT],CE=k.forwardRef((n,e)=>{const{coords:t,children:r,style:i,...s}=n,o=t!==void 0;return S.jsx("div",{ref:e,className:"floating-box","aria-hidden":!o,style:{...i,position:"absolute",zIndex:1e3,top:t==null?void 0:t.y,left:t==null?void 0:t.x,visibility:o?"visible":"hidden",opacity:o?1:0},...s,children:r})});function SE(){const[n,e]=k.useState(void 0),[t,r]=k.useState(),i=k.useRef(null),s=k.useCallback((a,l)=>{i.current&&i.current();const c=a.commonAncestorContainer.nodeType===a.commonAncestorContainer.TEXT_NODE?a:a.commonAncestorContainer;i.current=Hv(c,l,()=>{Jv(c,l,{placement:"bottom-start",middleware:[Vv(),Gv()]}).then(u=>{r(u.placement),e(f=>(f==null?void 0:f.x)===u.x&&(f==null?void 0:f.y)===u.y?f:{x:u.x,y:u.y})}).catch(()=>{e(void 0)})})},[]),o=k.useCallback(()=>{i.current&&(e(void 0),i.current(),i.current=null)},[]);return k.useEffect(()=>o,[o]),{coords:n,placement:t,updatePosition:s,cleanup:o}}function TE({isOpen:n,floatingBoxRef:e}){const{coords:t,updatePosition:r,cleanup:i,placement:s}=SE();return k.useEffect(()=>{var o;if(!n||!e.current){i();return}const a=(o=window.getSelection())==null?void 0:o.getRangeAt(0);if(!a){i();return}return r(a,e.current),i},[i,n,e,r]),{coords:t,placement:s}}const EE=document.body,NE=k.memo(CE);function ME({isOpen:n=!1,children:e}){const t=k.useRef(null),{coords:r,placement:i}=TE({isOpen:n,floatingBoxRef:t}),s=k.useMemo(()=>r?typeof e=="function"?e:()=>e:()=>null,[e,r]);return At.createPortal(S.jsx(NE,{ref:t,coords:r,style:r?void 0:{display:"none"},children:s({isOpen:n,placement:i})}),EE)}const mv=k.createContext(void 0);function jf(){const n=k.useContext(mv);if(!n)throw new Error("useMenuContext must be used within a MenuProvider");return n}function AE(n,e){const[t,r]=k.useState(0),[i,s]=k.useState(-1),o=k.useMemo(()=>n??[],[n]),a={menuItems:o,activeIndex:t,selectedIndex:i,onSelectOption:e??(()=>{})},l=k.useCallback(()=>{r(f=>{const d=o.length;return d?(f-1+d)%d:0})},[o.length]),c=k.useCallback(()=>{r(f=>{const d=o.length;return d?(f+1)%d:0})},[o.length]),u=k.useCallback(()=>{const f=o.length;if(t>=0&&t<f){const d=o[t];e==null||e(d),s(t)}},[t,o,e]);return{state:a,moveUp:l,moveDown:c,select:u,setActiveIndex:r,setSelectedIndex:s}}function OE({children:n,menuItems:e,onSelectOption:t,...r}){const i=AE(e,t);return S.jsx(mv.Provider,{value:i,children:S.jsx("div",{...r,children:n})})}const yv=k.forwardRef(({index:n,children:e,onMouseEnter:t,onClick:r,...i},s)=>{const{state:{activeIndex:o},setActiveIndex:a,setSelectedIndex:l,select:c}=jf(),u=k.useCallback(d=>{c(),l(-1),r==null||r(d)},[r,c,l]),f=k.useCallback(d=>{a(n),t==null||t(d)},[n,a,t]);return S.jsx("button",{ref:s,role:"menuitem",...i,onClick:u,onMouseEnter:f,"aria-selected":n!==void 0&&o===n?"true":void 0,tabIndex:-1,children:e})});function $E({children:n,autoIndex:e=!0,...t}){const r=k.useRef(null),{state:{activeIndex:i,menuItems:s}}=jf(),o=k.useMemo(()=>s?typeof n=="function"?n:()=>n:()=>null,[n,s]),a=k.useMemo(()=>{const l=o(s);return e?k.Children.map(l,(c,u)=>k.isValidElement(c)&&c.type===yv&&c.props.index===void 0?k.cloneElement(c,{index:u}):c):l},[o,e,s]);return k.useEffect(()=>{if(r.current){const l=r.current,c=l.children[i];if(c){const u=l.getBoundingClientRect(),f=c.getBoundingClientRect();f.bottom>u.bottom?l.scrollTop+=f.bottom-u.bottom:f.top<u.top&&(l.scrollTop-=u.top-f.top)}}},[i]),S.jsx("div",{ref:r,role:"menu",...t,children:a})}const uu={Root:OE,Options:$E,Option:yv},PE=(n,e,t)=>qa(n,t).toLowerCase().includes(e.toLowerCase()),vp=n=>Object.keys(n).find(e=>typeof n[e]=="string")||"",qa=(n,e)=>{const t=n[e];return typeof t=="string"?t:String(t)};function IE(n){const{query:e,items:t,filterBy:r,filter:i,sortBy:s,sortingOptions:o}=n,{caseSensitive:a=!1,priorityOrder:l=["exact","startsWith","contains"]}=o||{},c=a?e:e.toLowerCase();let u,f;i?(f=i,u=t.length>0?vp(t[0]):""):(u=r||(t.length>0?vp(t[0]):""),f=(p,m)=>PE(p,m,u));const d=s||u,h=new Map;return t.filter(p=>{try{return f(p,e)}catch(m){return console.warn("Error filtering item:",p,m),!1}}).sort((p,m)=>{const y=w=>(h.has(w)||h.set(w,qa(w,d).toLowerCase()),h.get(w)??""),b=a?qa(p,d):y(p),_=a?qa(m,d):y(m);for(const w of l)switch(w){case"exact":if(b===c&&_!==c)return-1;if(_===c&&b!==c)return 1;break;case"startsWith":if(b.startsWith(c)&&!_.startsWith(c))return-1;if(_.startsWith(c)&&!b.startsWith(c))return 1;break;case"contains":{const T=b.indexOf(c),I=_.indexOf(c);if(T!==-1&&I===-1)return-1;if(I!==-1&&T===-1)return 1;if(T!==-1&&I!==-1)return T-I;break}}return b.localeCompare(_)})}function RE(n){const{query:e,items:t,filterBy:r,filter:i,sortBy:s,sortingOptions:o}=n;return k.useMemo(()=>IE({query:e,items:t,filterBy:r,filter:i,sortBy:s,sortingOptions:o}),[e,t,r,i,s,o])}function DE(){const{moveUp:n,moveDown:e,select:t}=jf();return k.useMemo(()=>({moveUp:n,moveDown:e,select:t}),[n,e,t])}const LE=()=>{const n=DE(),[e]=ge();k.useEffect(()=>{const t=r=>{const i={ArrowDown:()=>n==null?void 0:n.moveDown(),ArrowUp:()=>n==null?void 0:n.moveUp(),Enter:()=>n==null?void 0:n.select(),Tab:()=>n==null?void 0:n.select()}[r.key];return i?(i(),r.preventDefault(),r.stopPropagation(),!0):!1};return e.registerCommand(Zi,t,Ol)},[e,n])};function jE(){return LE(),null}function FE(n){const{options:e,onSelectOption:t,onClose:r,inverse:i,query:s,menuOpenKey:o}=n,[a]=ge(),l=s!==void 0,[c,u]=k.useState(""),f=l?s??"":c,d=RE({query:f,items:e,filterBy:"name"}),h=p=>{r==null||r(),t?t(p):p.action(a)};return k.useEffect(()=>a.registerCommand(Zi,p=>{if(l)return!1;const m={Escape:()=>r==null?void 0:r(),Backspace:()=>{f.length===0?r==null||r():u(y=>y.slice(0,-1))}}[p.key];return m?(p.stopPropagation(),p.preventDefault(),m(),!0):p.key.length===1?(p.stopPropagation(),p.preventDefault(),p.key!==o&&u(y=>y+p.key),!0):!1},Ol),[a,l,f,o,r]),S.jsxs(uu.Root,{className:`autocomplete-menu-container ${i?"inverse":""}`,menuItems:d,onSelectOption:p=>h(p),children:[!l&&S.jsx("input",{value:f,type:"text",disabled:!0}),S.jsx(jE,{}),S.jsx(uu.Options,{className:"autocomplete-menu-options",autoIndex:!1,children:p=>p.map((m,y)=>S.jsxs(uu.Option,{index:y,children:[S.jsx("span",{className:"label",children:m.label??m.name}),S.jsx("span",{className:"description",children:m.description})]},m.name))})]})}function qE({trigger:n,items:e}){const[t]=ge(),[r,i]=k.useState(!1),s=k.useCallback(o=>{o.key==="Escape"&&r?(i(!1),t.focus()):o.key===n&&!r&&(o.preventDefault(),i(!0))},[t,n,r]);return k.useEffect(()=>t.registerRootListener(o=>{if(o)return o.addEventListener("keydown",s),()=>{o.removeEventListener("keydown",s)}}),[t,s]),k.useEffect(()=>t.registerUpdateListener(({prevEditorState:o,editorState:a})=>{const l=o.read(()=>{const c=K();if(q(c))return c});a.read(()=>{const c=K();!q(c)||l!=null&&l.is(c)||i(!1)})}),[t]),e&&S.jsx(ME,{isOpen:r,children:({placement:o})=>S.jsx(FE,{options:e,onClose:()=>i(!1),inverse:o==="top-start",menuOpenKey:n})})}function BE({scriptureReference:n,contextMarker:e,getMarkerAction:t}){return{markersMenuItems:k.useMemo(()=>{if(!e||!n)return;const r=up(e);if(r!=null&&r.children)return Object.values(r.children).flatMap(i=>i.map(s=>{const o=up(s),{action:a}=t(s,o);return{name:s,label:s,description:(o==null?void 0:o.description)??"",action:l=>{a({editor:l,reference:n})}}}))},[e,t,n])}}function Ba(n,e){return`${n}:${e}`}function UE(n,e){k.useEffect(()=>{if(!n.hasNodes([tt]))throw new Error("AnnotationPlugin: TypedMarkNode not registered on editor!");const t=new Map;return Ue(Yy(n,tt,r=>uo(r.getTypedIDs()),(r,i)=>{for(const[s,o]of Object.entries(r.getTypedIDs()))o.forEach(a=>{i.addID(s,a)})}),n.registerMutationListener(tt,r=>{n.getEditorState().read(()=>{for(const[i,s]of r){const o=ce(i);let a={};s==="destroyed"?a=t.get(i)??{}:rt(o)&&(a=o.getTypedIDs());for(const[l,c]of Object.entries(a))if(!tt.isReservedType(l))for(const u of c){let f=e.get(Ba(l,u));a[l]=c,t.set(i,a),s==="destroyed"?f!==void 0&&(f.delete(i),f.size===0&&e.delete(Ba(l,u))):(f===void 0&&(f=new Set,e.set(Ba(l,u),f)),f.has(i)||f.add(i))}}})},{skipInitialization:!0}))},[n,e])}const zE=k.forwardRef(function({logger:n},e){const[t]=ge(),r=k.useMemo(()=>new Map,[]);return UE(t,r),k.useImperativeHandle(e,()=>({addAnnotation(i,s,o){if(tt.isReservedType(s))throw new Error(`addAnnotation: Can't directly add this reserved annotation type '${s}'. Use the appropriate plugin instead.`);t.update(()=>{const a=$f(i);if(a===void 0){n==null||n.error("Failed to find start or end node of the annotation.");return}tv(a,s,o)},{tag:sd})},removeAnnotation(i,s){if(tt.isReservedType(i))throw new Error(`removeAnnotation: Can't directly remove this reserved annotation type '${i}'. Use the appropriate plugin instead.`);const o=r.get(Ba(i,s));o!==void 0&&setTimeout(()=>{t.update(()=>{for(const a of o){const l=ce(a);rt(l)&&(l.deleteID(i,s),l.hasNoIDsForEveryType()&&ev(l))}},{tag:sd})})}})),null});function WE({ignoreHistoryMergeTagChange:n=!0,ignoreSelectionChange:e=!1,onChange:t}){const[r]=ge();return k.useLayoutEffect(()=>{if(t)return r.registerUpdateListener(i=>{const{editorState:s,dirtyElements:o,dirtyLeaves:a,prevEditorState:l,tags:c}=i;if(e&&o.size===0&&a.size===0||n&&c.has(Lr)||l.isEmpty())return;const u=KE(r,i);u.length!==0&&t(s,r,c,u)})},[r,n,e,t]),null}function KE(n,{dirtyLeaves:e,prevEditorState:t}){let r=new Fs;return n.getEditorState().read(()=>{const i=e.values().next().value??"";if(e.size===1&&W(ce(i))){const s=ce(i),o=fv(s);if(W(s)&&o!==void 0){const a=t.read(()=>{const u=ce(i);return new Fs([W(u)?cd(u):{insert:""}])}),l=new Fs([cd(s)]),c=new Fs(o>0?[{retain:o}]:[]);r=r.concat(c).concat(a.diff(l))}}else{const s=_p(t),o=_p(n.getEditorState());r=s.diff(o)}}),r.ops}function HE(n,e,t,r){let i=0;n.forEach(s=>{if("retain"in s)i+=JE(s,i,e,r);else if("delete"in s){if(typeof s.delete!="number"||s.delete<=0){r==null||r.error(`Invalid delete operation: ${JSON.stringify(s)}`);return}r==null||r.debug(`Delete: ${s.delete}`),GE(i,s.delete,r)}else"insert"in s?typeof s.insert=="string"?(r==null||r.debug(`Insert: '${s.insert}'`),i+=YE(i,s.insert,s.attributes,e,r)):typeof s.insert=="object"&&s.insert!==null?(r==null||r.debug(`Insert embed: ${JSON.stringify(s.insert)}`),QE(i,s,e,t,r)?i+=1:r==null||r.error(`Failed to process insert embed operation: ${JSON.stringify(s.insert)} at index ${i}. Document may be inconsistent.`)):r==null||r.error(`Insert of unknown type: ${JSON.stringify(s.insert)}`):r==null||r.error(`Unknown operation: ${JSON.stringify(s)}`)})}function JE(n,e,t,r){return typeof n.retain!="number"||n.retain<0?(r==null||r.error(`Invalid retain operation: ${JSON.stringify(n)}`),0):(r==null||r.debug(`Retain: ${n.retain}`),n.attributes&&(r==null||r.debug(`Retain attributes: ${JSON.stringify(n.attributes)}`),VE(e,n.retain,n.attributes,t,r)),n.retain)}function VE(n,e,t,r,i){i==null||i.debug(`Applying attributes for range [${n}, ${n+e-1}] with attributes: ${JSON.stringify(t)}`);let s=e,o=0,a=-1;const l=ye();function c(u){if(s<=0)return!0;if(W(u)){const f=u.getTextContentSize();if(n<o+f&&o<n+e){const d=Math.max(0,n-o),h=f-d,p=Math.min(s,h);if(p>0){let m=u;const y=d>0,b=p<f-d;if(y&&b){const[,_]=u.splitText(d);[m]=_.splitText(p)}else y?[,m]=u.splitText(d):b&&([m]=u.splitText(p));if(ei(t)){const _=m.getParent();if(Te(_)){const w=t.char;let T;Array.isArray(w)?a>=0&&a<=w.length-1&&(T=w[a]):a===0&&(T=w);const I=T?Zr(T,_):!1;if(I&&Array.isArray(w)&&w.length>1){const M=de("");m.replace(M);const D=typeof t.segment=="string"?t.segment:void 0,A=Oo(w.slice(1),r,m,D);let O=M;for(const B of A)O.insertAfter(B),O=B;M.remove(),Rt(t,m)}else if(I)Rt(t,m);else{m.remove();const M=kp(m,t,r,i);if(M&&M.length>0){let D=_;for(const A of M)D.insertAfter(A),D=A}}}else{const w=de("");m.replace(w);const T=kp(m,t,r,i);if(T&&T.length>0){let I=w;for(const M of T)I.insertAfter(M),I=M;w.remove()}else w.replace(m)}}else Rt(t,m);s-=p}}o+=f}else if(Zt(u))n<=o&&o<n+e&&s>0&&(wp(u,t),s-=1),o+=1;else if(Te(u)){a+=1;let f=!1;if(n<=o&&o<n+e&&s>0)if(ei(t)){const d=t.char;let h;if(Array.isArray(d)?a>=0&&a<=d.length-1&&(h=d[a]):a===0&&(h=d),h){u.setMarker(h.style),typeof h.cid=="string"&&Dn(u,Yr,()=>h.cid);const p=Ge(h,kl);p&&Object.keys(p).length>0?u.setUnknownAttributes({...u.getUnknownAttributes()??{},...p}):u.setUnknownAttributes(void 0)}}else(t.char===!1||t.char===null||oN(t.char))&&(f=!0);if(s>0){const d=u.getChildren();for(const h of d){if(s<=0)break;if(c(h)&&s<=0)return f&&zh(u),!0}}f&&zh(u),a-=1}else if(Bt(u)){const f=u.getChildren();for(const h of f){if(s<=0)break;if(c(h)&&s<=0)return!0}const d=1;if(n<=o&&o<n+s&&s>0){if(!Wn(u))wp(u,t);else if(Ff(t)){const h=bv(t.para);h&&u.replace(h,!0)}s-=d}o+=d}else if(F(u)){const f=u.getChildren();for(const d of f){if(s<=0)break;if(c(d)&&s<=0)return!0}}return s<=0}c(l),s>0&&(i==null||i.warn(`$applyAttributes: Not all characters in the retain operation (length ${e}) could be processed. Remaining: ${s}. targetIndex: ${n}, final currentIndex: ${o}`))}function kp(n,e,t,r){var i;const s=typeof e.segment=="string"?e.segment:void 0,o=Oo(e.char,t,n,s),a=o.find(Te);if(!a){r==null||r.error(`Failed to create CharNode for text transformation. Style: ${Array.isArray(e.char)?e.char[0].style:(i=e.char)==null?void 0:i.style}. Falling back to standard text attributes.`),Rt(e,n);return}const l={};vv.forEach(f=>{n.hasFormat(f)&&(l[f]="true")});const c={};Object.entries(e).forEach(([f,d])=>{f==="segment"||f==="char"||(typeof d=="string"?c[f]=d:d===!0?c[f]="true":d===!1&&(c[f]="false"))});const u={...a.getUnknownAttributes()??{},...l,...c};return Object.keys(u).length>0&&a.setUnknownAttributes(u),Rt(e,n),o}function wp(n,e){for(const t of Object.keys(e)){const r=e[t];if(t==="char"&&Te(n)&&ei(e)){const i=r;if(n.setMarker(i.style),typeof i.cid=="string"){const o=i.cid;Dn(n,Yr,()=>o)}const s=Ge(i,kl);s&&Object.keys(s).length>0&&n.setUnknownAttributes({...n.getUnknownAttributes()??{},...s});continue}typeof r=="string"&&(Lt(n)||jt(n)||Hl(n)||pe(n)||Eo(n)?n.setUnknownAttributes({...n.getUnknownAttributes()??{},[t]:r}):(_n(n)||dt(n)||Te(n))&&(t==="style"&&!_n(n)?n.setMarker(r):t==="code"&&_n(n)?n.setCode(r):n.setUnknownAttributes({...n.getUnknownAttributes()??{},[t]:r})),t==="segment"&&Dn(n,Xr,()=>r))}}function GE(n,e,t){if(e<=0)return;const r=ye();let i=0,s=e;function o(a){if(s<=0)return!0;if(W(a)){let l=a.getTextContentSize();if(n<i+l&&i<n+s){const c=Math.max(0,n-i),u=l-c,f=Math.min(s,u);f>0&&(a.spliceText(c,f,""),a.getTextContentSize()===0&&a.remove(),t==null||t.debug(`Deleted ${f} length from TextNode (key: ${a.getKey()}) at nodeOffset ${c}. Original targetIndex: ${n}, current currentIndex: ${i}.`),s-=f,l-=f)}i+=l}else if(Zt(a))n<=i&&i<n+s?(a.remove(),t==null||t.debug(`Deleted embed node (key: ${a.getKey()}) at currentIndex: ${i}. Original targetIndex: ${n}, remainingToDelete: ${s}.`),s-=1):i+=1;else if(Bt(a)){const l=a.getChildren().slice(),c=a.getChildren();for(const u of c){if(s<=0)break;if(o(u)&&s<=0)return!0}if(n<=i&&i<n+s&&Bt(a)){s-=1;const u=a.getChildren().length;if(l.length>0&&u===0){const f=a.getParent();((f==null?void 0:f.getChildren())??[]).length>1?(a.remove(),t==null||t.debug(`Removed entire ParaNode that had all its content deleted at currentIndex: ${i}. Original targetIndex: ${n}, remainingToDelete: ${s}.`)):(a.replace(Vt(),!0),t==null||t.debug(`Replaced last ParaNode with ImpliedParaNode at currentIndex: ${i}. Original targetIndex: ${n}, remainingToDelete: ${s}.`))}else if(s>0){const f=a.getNextSibling();if(f&&Kt(f)){let d=i+1;const h=f.getChildren();for(const m of h){if(s<=0)break;const y=i;if(i=d,o(m)){i=y;break}W(m)?d+=m.getTextContentSize():Zt(m)&&(d+=1),i=y}const p=f.getChildren();for(const m of p)m.remove(),a.append(m);f.remove(),t==null||t.debug(`Merged next paragraph into current one after deleting symbolic close at currentIndex: ${i}. Original targetIndex: ${n}, remainingToDelete: ${s}.`)}else a.replace(Vt(),!0)}else dt(a)?a.replace(Vt(),!0):a.remove()}i+=1}else if(F(a)){const l=a.getChildren();for(const c of l){if(s<=0)break;if(o(c)&&s<=0)return!0}}return s<=0}o(r),s>0&&(t==null||t.warn(`Delete operation could not remove all requested characters. Remaining to delete: ${s}. Original targetIndex: ${n}, OT length: ${e}. Final currentIndex: ${i}`))}function YE(n,e,t,r,i){if(e===fo)return xp(n,t,i);if(e.endsWith(fo)&&!Ff(t)){const s=e.slice(0,-1);let o=0;if(s.length>0){if(ei(t))throw new Error("Text + LF should not have char attributes");o+=wl(n,s,t,i)}return o+=xp(n+o,t,i),o}else return ei(t)?XE(n,e,t,r,i):wl(n,e,t,i)}function XE(n,e,t,r,i){i==null||i.debug(`Attempting to insert CharNode with text "${e}" and attributes ${JSON.stringify(t.char)} at index ${n}`);const s=de(e===""?me:e);Rt(t,s);let o;{let h=function(y){if(W(y)){const b=y.getTextContentSize();if(n>=m&&n<m+b){const _=y.getParent();return Te(_)&&(o=_),!0}m+=b}else if(Zt(y))m+=1;else if(Te(y)){const b=y.getChildren();for(const _ of b)if(h(_))return!0}else if(F(y)){const b=y.getChildren();for(const _ of b)if(h(_))return!0;Bt(y)&&(m+=1)}return!1};const p=ye();let m=0;h(p)}let a=t.char;if(Array.isArray(a)){if(o){const h=a[0];h&&Zr(h,o)?(a=a.slice(1),a.length===1&&(a=a[0])):o=void 0}}else o&&(Zr(a,o)||(o=void 0));const l=typeof t.segment=="string"?t.segment:void 0,c=Oo(a,r,s,l,o?[o]:void 0);if(c.length===0)return e.length;const u=c.find(Te);if(!u)return i==null||i.error(`CharNode style is missing for text "${e}". Attributes: ${JSON.stringify(t.char)}. Falling back to rich text insertion.`),wl(n,e,void 0,i);const f={};for(const[h,p]of Object.entries(t))h!=="char"&&h!=="segment"&&typeof p=="string"&&(f[h]=p);Object.keys(f).length>0&&u.setUnknownAttributes(f);let d=!0;for(const h of c)if(!_v(n,h,i)){d=!1;break}return d?e.length:(i==null||i.error(`Failed to insert CharNode with text "${e}" at index ${n}. Falling back to rich text.`),wl(n,e,void 0,i))}function wl(n,e,t,r){if(e.length<=0)return r==null||r.debug("Attempted to insert empty string. No action taken."),0;const i=ye();let s=0,o=!1;function a(l){if(o)return!0;if(W(l)){const c=l.getTextContentSize();if(n>=s&&n<=s+c){const u=n-s,f=de(e);if(Rt(t,f),u===0)l.insertBefore(f);else if(u===c){const d=l.getParent();Te(d)&&!ei(t)?d.insertAfter(f):l.insertAfter(f)}else{const[,d]=l.splitText(u);d.insertBefore(f)}return r==null||r.debug(`Inserted text "${e}" in/around TextNode (key: ${l.getKey()}) at nodeOffset ${u}. Original targetIndex: ${n}, currentIndex at node start: ${s}.`),o=!0,!0}s+=c}else if(Zt(l))s+=1;else if(Te(l)){if(!o&&n===s){const u=de(e);Rt(t,u);const f=l.getFirstChild();return f?f.insertBefore(u):l.append(u),r==null||r.debug(`Inserted text "${e}" at beginning of CharNode ${l.getType()} (key: ${l.getKey()}).`),o=!0,!0}const c=l.getChildren();for(const u of c){if(a(u))return!0;if(o)break}if(!o&&n===s){const u=de(e);return Rt(t,u),l.append(u),r==null||r.debug(`Appended text "${e}" to end of CharNode ${l.getType()} (key: ${l.getKey()}).`),o=!0,!0}}else if(Bt(l)){if(!o&&n===s){const u=de(e);Rt(t,u);const f=l.getFirstChild();return f?f.insertBefore(u):l.append(u),r==null||r.debug(`Inserted text "${e}" at beginning of container ${l.getType()} (key: ${l.getKey()}).`),o=!0,!0}const c=l.getChildren();for(const u of c){if(a(u))return!0;if(o)break}if(!o&&n===s){const u=de(e);return Rt(t,u),l.append(u),r==null||r.debug(`Appended text "${e}" to end of container ${l.getType()} (key: ${l.getKey()}).`),o=!0,!0}s+=1}else if(F(l)){const c=l.getChildren();for(const u of c){if(a(u))return!0;if(o)break}}return o}if(a(i),!o&&n===s){r==null||r.debug(`Insertion point matches end of document (targetIndex: ${n}, final currentIndex: ${s}). Appending text to new ParaNode.`);const l=de(e);Rt(t,l);const c=Vt().append(l);i.append(c),o=!0}return o?e.length:(r==null||r.warn(`$insertRichText: Could not find insertion point for text "${e}" at targetIndex ${n}. Final currentIndex: ${s}. Text not inserted.`),0)}function _v(n,e,t){const r=ye();let i=0,s=!1;function o(a){if(s)return!0;if(a===r&&n===0&&!r.getFirstChild())return e.isInline()?(t==null||t.debug(`$insertNodeAtCharacterOffset: Inserting inline node ${e.getType()} into empty root, wrapped in ImpliedParaNode. targetIndex: ${n}`),r.append(Vt().append(e))):(t==null||t.debug(`$insertNodeAtCharacterOffset: Inserting block node ${e.getType()} directly into empty root. targetIndex: ${n}`),r.append(e)),s=!0,!0;if(!F(a))return!1;const l=a.getChildren();for(const c of l){if(n===i&&!s){if(a===r&&e.isInline())if(Kt(c)){t==null||t.debug(`$insertNodeAtCharacterOffset: Inserting inline node ${e.getType()} into existing ${c.getType()} at beginning. targetIndex: ${n}`);const u=c.getFirstChild();u?u.insertBefore(e):c.append(e)}else t==null||t.debug(`$insertNodeAtCharacterOffset: Inserting inline node ${e.getType()} into root before ${c.getType()}, wrapping in ImpliedParaNode. targetIndex: ${n}`),c.insertBefore(Vt().append(e));else c.insertBefore(e),t==null||t.debug(`$insertNodeAtCharacterOffset: Inserted node ${e.getType()} (key: ${e.getKey()}) before child ${c.getType()} (key: ${c.getKey()}) in ${a.getType()} (key: ${a.getKey()}). targetIndex: ${n}, currentIndex: ${i}`);return s=!0,!0}if(W(c)){const u=c.getTextContentSize();if(!s&&n>i&&n<i+u){const f=n-i,[d]=c.splitText(f);return d.insertAfter(e),t==null||t.debug(`$insertNodeAtCharacterOffset: Inserted node ${e.getType()} (key: ${e.getKey()}) by splitting TextNode (key: ${c.getKey()}) at offset ${f}. targetIndex: ${n}, currentIndex at node start: ${i}`),s=!0,!0}i+=u}else if(Zt(c))i+=1;else if(Te(c)){if(o(c))return!0}else if(Bt(c)){const u=c;if(o(u))return!0;const f=i;if(Wn(u)&&Bt(e)&&n===f&&!s)return t==null||t.debug(`$insertNodeAtCharacterOffset: Replacing ImpliedParaNode (key: ${u.getKey()}) with block node '${e.getType()}' (key: ${e.getKey()}) at OT index ${n}.`),c.replace(e,!0),i=f+1,s=!0,!0;i+=1}else if(F(c)&&o(c))return!0;if(s)return!0}return F(a)&&!s&&(n===i||a===r&&n>i)?a===r?(e.isInline()?(t==null||t.debug(`$insertNodeAtCharacterOffset: Appending inline node ${e.getType()} to root. Wrapping in new ImpliedParaNode. targetIndex: ${n}, current document OT length: ${i}.`),r.append(Vt().append(e))):(t==null||t.debug(`$insertNodeAtCharacterOffset: Appending block node ${e.getType()} to root. targetIndex: ${n}, current document OT length: ${i}.`),r.append(e)),s=!0,!0):Kt(a)?Wn(a)&&dt(e)&&n===i?(t==null||t.debug(`$insertNodeAtCharacterOffset: Replacing ImpliedParaNode container (key: ${a.getKey()}) with ParaNode ${e.getType()} (key: ${e.getKey()}) via append logic. targetIndex: ${n}`),a.replace(e,!0),s=!0,!0):e.isInline()||!Kt(e)?(t==null||t.debug(`$insertNodeAtCharacterOffset: Appending node ${e.getType()} to existing container ${a.getType()} (key: ${a.getKey()}). targetIndex: ${n}, container end OT index: ${i}.`),a.append(e),s=!0,!0):(t==null||t.debug(`$insertNodeAtCharacterOffset: Inserting block node ${e.getType()} after container ${a.getType()} (key: ${a.getKey()}). targetIndex: ${n}, container end OT index: ${i}.`),a.insertAfter(e),s=!0,!0):(Te(a)?(t==null||t.debug(`$insertNodeAtCharacterOffset: Inserting node ${e.getType()} after CharNode (key: ${a.getKey()}). targetIndex: ${n}, element end OT index: ${i}.`),a.insertAfter(e)):e.isInline()||!Kt(e)?(t==null||t.debug(`$insertNodeAtCharacterOffset: Appending node ${e.getType()} to generic element ${a.getType()} (key: ${a.getKey()}). targetIndex: ${n}, element end OT index: ${i}.`),a.append(e)):(t==null||t.debug(`$insertNodeAtCharacterOffset: Inserting block node ${e.getType()} after generic element ${a.getType()} (key: ${a.getKey()}). targetIndex: ${n}, element end OT index: ${i}.`),a.insertAfter(e)),s=!0,!0):s}return o(r),s||t==null||t.warn(`$insertNodeAtCharacterOffset: Could not find insertion point for node ${e.getType()} (key: ${e.getKey()}) at targetIndex ${n}. Final currentIndex: ${i}. Node not inserted.`),s}function QE(n,e,t,r,i){let s;return $s("chapter",e)?s=ZE(e.insert.chapter,t):$s("verse",e)?s=eN(e.insert.verse,t):$s("ms",e)?s=tN(e.insert.ms):$s("unmatched",e)?s=nN(e.insert.unmatched):$s("note",e)&&(s=rN(e,t,r,i)),s?_v(n,s,i):(i==null||i.error(`$insertEmbedAtCurrentIndex: Cannot create LexicalNode for embed object: ${JSON.stringify(e.insert)}`),!1)}function xp(n,e,t){let r;Ff(e)?r=bv(e.para):sN(e)&&(r=iN(e.book)),r??(r=Vt());const i=r,s=dt(i),o=Wn(i);let a=0,l=!1;function c(u){if(l)return!0;if(W(u)){const f=u.getTextContentSize();if(n>=a&&n<=a+f){const d=u.getParent();if(dt(d)&&(s||o)){t==null||t.debug(`Splitting ParaNode (marker: ${d.getMarker()}) with LF attributes at targetIndex ${n}`);const h=n-a,[p]=h>0?u.splitText(h):[void 0];let m=p==null?void 0:p.getPreviousSibling();for(;m;){const y=m;m=m.getPreviousSibling();const b=i.getFirstChild();b?b.insertBefore(y):i.append(y)}return p&&i.append(p),d.insertBefore(i),l=!0,!0}}a+=f}else if(Zt(u))a+=1;else if(Bt(u)){const f=u.getChildren();for(const d of f){if(c(d))return!0;if(l)break}if(n===a){if(Wn(u)&&i)return t==null||t.debug(`Replacing ImpliedParaNode (key: ${u.getKey()}) with ParaNode at targetIndex ${n}`),u.replace(i,!0),l=!0,!0;if(dt(u)&&i){const d=u;return t==null||t.debug(`Creating new block node with LF attributes after existing ParaNode (marker: ${d.getMarker()}) at targetIndex ${n}`),d.insertAfter(i),l=!0,!0}}if(a+=1,n===a&&dt(u)&&i)return t==null||t.debug(`Creating new block node after existing ParaNode (marker: ${u.getMarker()}) at targetIndex ${n}`),u.insertAfter(i),l=!0,!0}else if(F(u)){const f=u.getChildren();for(const d of f){if(c(d))return!0;if(l)break}}return l}return c(ye()),l||t==null||t.warn(`Could not find location to handle newline with para attributes at targetIndex ${n}. Final currentIndex: ${a}.`),1}function ZE(n,e){if(!n)return;const{number:t,sid:r,altnumber:i,pubnumber:s}=n;if(!t)return;const o=Ge(n,VT);let a;if(e.markerMode==="editable")a=Db(t,r,i,s,o);else{const l=e.markerMode==="visible";a=kf(t,l,r,i,s,o)}return a}function eN(n,e){if(!n)return;const{style:t,number:r,sid:i,altnumber:s,pubnumber:o}=n;if(!r)return;const a=Ge(n,GT);let l;if(e.markerMode==="editable"){if(!t)return;const c=Mo(t,r);l=Gb(r,c,i,s,o,a)}else{const c=e.markerMode==="visible";l=Pf(r,c,i,s,o,a)}return l}function tN(n){if(!n)return;const{style:e,sid:t,eid:r}=n;if(!e)return;const i=Ge(n,YT);return Kb(e,t,r,i)}function nN(n){if(!n)return;const{marker:e}=n;if(e)return Of(e)}function rN(n,e,t,r){var i;const s=n.insert;if(!s.note)return;const{style:o,caller:a,category:l,contents:c}=s.note;if(!o||a==null)return;a===""&&(r==null||r.warn("Note has empty caller. Only use for note editing."));const u=Ge(s.note,XT),f=(i=n.attributes)==null?void 0:i.segment;let d;f&&typeof f=="string"&&(d=f);const h=[];for(const p of(c==null?void 0:c.ops)??[])if(typeof p.insert=="string")if(ei(p.attributes)){const m=Oo(p.attributes.char,e,de(p.insert),void 0,h);h.push(...m)}else h.push(de(p.insert));return cv(o,a,h,e,t,d).setCategory(l).setUnknownAttributes(u)}function iN(n){const{style:e,code:t}=n;if(!e||e!==lo||!t||!qt.isValidBookCode(t))return;const r=Ge(n,JT);return Pb(t,r)}function bv(n){const{style:e}=n;if(!e)return;const t=Ge(n,HT);return co(e,t)}function Oo(n,e,t,r,i){if(W(t)&&t.getTextContentSize()===0&&t.setTextContent(me),Array.isArray(n)){if(n.length===0)throw new Error("Empty charAttr array");const s=n[0],o=i==null?void 0:i[i.length-1];if(Te(o)&&Zr(s,o))return n.length>1?Oo(n.slice(1),e,t).forEach(u=>o.append(u)):t&&o.append(t),[];const a=n.reduceRight((u,f,d)=>{const h=hn(f.style,Ge(f,kl));if(typeof f.cid=="string"&&Dn(h,Yr,()=>f.cid),r&&d===n.length-1&&Dn(h,Xr,()=>r),u)if(Te(u)){const p=u.getMarker(),m=[];du(p,m,e),m.forEach(b=>h.append(b)),h.append(u);const y=[];fu(p,y,e),y.forEach(b=>h.append(b))}else h.append(u);return h},t),l=[],c=n[0];return du(c.style,l,e),l.push(a),fu(c.style,l,e),l}else{const s=i==null?void 0:i[i.length-1];if(Te(s)&&Zr(n,s))return t&&s.append(t),[];const o=[];du(n.style,o,e);const a=hn(n.style,Ge(n,kl));return typeof n.cid=="string"&&Dn(a,Yr,()=>n.cid),r&&Dn(a,Xr,()=>r),t&&a.append(t),o.push(a),fu(n.style,o,e),o}}function du(n,e,t){(t==null?void 0:t.markerMode)==="editable"?e.push(Gi(n)):(t==null?void 0:t.markerMode)==="visible"&&e.push(Yi("marker",Vn(n)))}function fu(n,e,t,r=!1){Ie.isValidFootnoteMarker(n)||Ie.isValidCrossReferenceMarker(n)||((t==null?void 0:t.markerMode)==="editable"?r?e.push(Gi("","selfClosing")):e.push(Gi(n,"closing")):(t==null?void 0:t.markerMode)==="visible"&&e.push(Yi("marker",Vi(r?"":n))))}function sN(n){return!!n&&!!n.book&&typeof n.book=="object"&&n.book!==null&&"style"in n.book&&typeof n.book.style=="string"&&"code"in n.book&&typeof n.book.code=="string"}function Ff(n){return!!n&&!!n.para&&typeof n.para=="object"&&n.para!==null&&"style"in n.para&&typeof n.para.style=="string"}function ei(n){return!!n&&!!n.char&&typeof n.char=="object"&&n.char!==null&&(!Array.isArray(n.char)&&"style"in n.char&&typeof n.char.style=="string"||Array.isArray(n.char)&&n.char.length>0&&"style"in n.char[0]&&typeof n.char[0].style=="string")}function oN(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&Object.keys(n).length===0}function Rt(n,e){if(n)for(const t of Object.keys(n)){if(t==="segment"&&typeof n[t]=="string"){const r=n[t];Dn(e,Xr,()=>r);continue}if(aN(t)){const r=!!n[t],i=t,s=e.hasFormat(i);(r&&!s||!r&&s)&&e.toggleFormat(i)}}}const vv=["bold","underline","strikethrough","italic","highlight","code","subscript","superscript","lowercase","uppercase","capitalize"];function aN(n){return vv.includes(n)}function lN({viewOptions:n}){const[e]=ge();return cN(e,n),null}function cN(n,e){k.useEffect(()=>{if(!n.hasNodes([Jn,vt,Ve]))throw new Error("ArrowNavigationPlugin: ImmutableChapterNode, ImmutableVerseNode or NoteNode not registered on editor!");const t=r=>{if(r.key!=="ArrowLeft"&&r.key!=="ArrowRight")return!1;const i=K();if(!q(i)||!i.isCollapsed())return!1;const s=n.getRootElement();if(!s)return!1;const o=s.dir||"ltr";let a=!1;return uN(o,r.key)?a=fN(i):dN(o,r.key)&&(a=hN(i,e)),a&&r.preventDefault(),a};return n.registerCommand(Zi,t,Ol)},[n,e])}function uN(n,e){return n==="ltr"&&e==="ArrowRight"||n==="rtl"&&e==="ArrowLeft"}function dN(n,e){return n==="ltr"&&e==="ArrowLeft"||n==="rtl"&&e==="ArrowRight"}function fN(n){var e,t,r;const i=n.anchor.getNode(),s=uT(n);if(pe(s)&&!Ao(s.getFirstChild())){if(Kt(i)){if(n.anchor.offset===i.getChildrenSize())return!1}else if(n.anchor.offset!==i.getTextContentSize())return!1;if(s.getIsCollapsed()){if(s.is((e=s.getParent())==null?void 0:e.getLastChild()))return(r=(t=s.getParent())==null?void 0:t.getNextSibling())==null||r.selectStart(),!0}else return bl(s.getFirstChild())?s.select(2,2):s.select(1,1),!0}if(Kt(i)&&pe(s)&&s.getIsCollapsed()){const a=s.getNextSibling();return a?a.selectStart():s.selectEnd(),!0}const o=s==null?void 0:s.getParent();if(bl(s)&&pe(o)&&s.is(o==null?void 0:o.getLastChild())){const a=o.getNextSibling();return a?a.selectStart():o.selectEnd(),!0}return!1}function hN(n,e){const t=dT(n);if(No(t)&&!t.getPreviousSibling())return!0;if(n.anchor.offset!==0)return!1;const r=n.anchor.getNode();if(_n(r.getParent()))return!0;if(pe(t)&&t.getIsCollapsed()){const s=t.getPreviousSibling();if(!us(s))return!1;const o=t.getParent();if(!o)return!1;const a=t.getIndexWithinParent();return o.select(a,a),!0}if(Kt(t)&&(e==null?void 0:e.noteMode)==="collapsed"){const s=t.getLastChild();if(!s)return!1;const o=Qt(s,a=>pe(a));if(pe(o)&&o.getIsCollapsed()){const a=o.getParent();if(!a)return!1;const l=o.getIndexWithinParent();return a.select(l,l),!0}}const i=Yb(r);if(!i||i.getIsCollapsed())return!1;if(Cr(t)){const s=i.getParent();if(!s)return!1;const o=i.getIndexWithinParent();return s.select(o,o),!0}return!1}function gN(){const[n]=ge();return pN(n),null}function pN(n){k.useEffect(()=>{if(!n.hasNodes([Ie]))throw new Error("CharNodePlugin: CharNode not registered on editor!");return Ue(n.registerNodeTransform(Ie,mN),n.registerNodeTransform(ft,yN))},[n])}function mN(n){if(!Te(n))return;if(n.isEmpty()){n.remove();return}const e=n.getMarker(),t=Qi(n,Yr),r=n.getUnknownAttributes(),i=n.getNextSibling();Te(i)&&Zr({style:e,cid:t},i)&&Pn(r,i.getUnknownAttributes())&&(n.append(...i.getChildren()),i.remove());const s=n.getPreviousSibling();Te(s)&&Zr({style:e,cid:t},s)&&Pn(r,s.getUnknownAttributes())&&(s.append(...n.getChildren()),n.remove())}function yN(n){const e=n.getParent();if(!Te(e)||e.getChildrenSize()!==1)return;const t=n.getTextContent();t.length>1&&t.startsWith(me)&&(n.setTextContent(t.slice(1)),n.selectEnd())}function kv(n){return n.replaceAll("	"," ")}const qf=n=>{navigator.clipboard.read().then(async e=>{if((await navigator.permissions.query({name:"clipboard-read"})).state==="denied"){alert("Not allowed to paste from clipboard.");return}const t=new DataTransfer,r=e[0];for(const s of r.types){const o=await(await r.getType(s)).text();t.setData(s,kv(o))}const i=new ClipboardEvent("paste",{clipboardData:t});n.dispatchCommand(ni,i)})},Bf=n=>{navigator.clipboard.read().then(async()=>{if((await navigator.permissions.query({name:"clipboard-read"})).state==="denied"){alert("Not allowed to paste from clipboard.");return}const e=new DataTransfer,t=await navigator.clipboard.readText();e.setData("text/plain",kv(t));const r=new ClipboardEvent("paste",{clipboardData:e});n.dispatchCommand(ni,r)})};function _N(){const[n]=ge();return k.useEffect(()=>{const e=t=>{const{key:r,shiftKey:i,metaKey:s,ctrlKey:o,altKey:a}=t;!(Fu?s:o)||a||(!i&&r.toLowerCase()==="c"?(t.preventDefault(),n.dispatchCommand(mr,null)):!i&&r.toLowerCase()==="x"?(t.preventDefault(),n.dispatchCommand(ri,null)):r.toLowerCase()==="v"&&(t.preventDefault(),i?Bf(n):qf(n)))};return n.registerRootListener((t,r)=>{r!==null&&r.removeEventListener("keydown",e),t!==null&&t.addEventListener("keydown",e)})},[n]),null}function bN({logger:n}){const[e]=ge();return k.useEffect(()=>Ue(e.registerCommand(Zi,t=>t.key!=="\\"&&t.key!=="/"?!1:(t.preventDefault(),!0),Ia),e.registerCommand(ni,t=>{var r;const i=(r=t.clipboardData)==null?void 0:r.getData("text/plain");return!i||!i.includes("\\")&&!i.includes("/")?!1:(n==null||n.info("CommandMenuPlugin: paste containing backslash or forward slash ignored."),t.preventDefault(),!0)},Ia),e.registerCommand(Nl,t=>{var r;const i=(r=t.dataTransfer)==null?void 0:r.getData("text/plain");return!i||!i.includes("\\")&&!i.includes("/")?!1:(n==null||n.info("CommandMenuPlugin: drag containing backslash or forward slash ignored."),t.preventDefault(),!0)},Ia)),[e,n]),null}function vN({index:n,isSelected:e,onClick:t,onMouseEnter:r,option:i}){let s="item";return e&&(s+=" selected"),i.isDisabled&&(s+=" disabled"),S.jsx("li",{tabIndex:-1,className:s,ref:i.setRefElement,role:"option","aria-selected":e,"aria-disabled":i.isDisabled,id:"typeahead-item-"+n,onMouseEnter:r,onClick:i.isDisabled?void 0:t,children:S.jsx("span",{className:"text",children:i.title})},i.key)}function kN({options:n,selectedItemIndex:e,onOptionClick:t,onOptionMouseEnter:r}){return S.jsx("div",{className:"typeahead-popover",children:S.jsx("ul",{children:n.map((i,s)=>S.jsx(vN,{index:s,isSelected:e===s,onClick:()=>t(i,s),onMouseEnter:()=>r(s),option:i},i.key))})})}class ma extends S0{constructor(e,t){super(e),Z(this,"title"),Z(this,"onSelect"),Z(this,"isDisabled"),this.title=e,this.onSelect=t.onSelect.bind(this),this.isDisabled=t.isDisabled||!1}}function wN(n,e="editor-input"){return n?n.classList.contains(e):!1}function xN(){const[n]=ge(),[e,t]=k.useState(()=>!n.isEditable()),r=k.useRef(void 0),i=k.useRef(void 0),s=k.useRef(void 0),o=k.useMemo(()=>[new ma("Cut",{onSelect:()=>{n.dispatchCommand(ri,null)},isDisabled:e}),new ma("Copy",{onSelect:()=>{n.dispatchCommand(mr,null)}}),new ma("Paste",{onSelect:()=>{qf(n)},isDisabled:e}),new ma("Paste as Plain Text",{onSelect:()=>{Bf(n)},isDisabled:e})],[n,e]),a=k.useCallback((l,c,u)=>{n.update(()=>{l==null||l.onSelect(c),u()})},[n]);return k.useEffect(()=>{var l;i.current=((l=n.getRootElement())==null?void 0:l.className)??""},[n]),k.useEffect(()=>{const l=()=>{var c;(c=s.current)==null||c.call(s)};return window.addEventListener("scroll",l,!0),()=>{window.removeEventListener("scroll",l,!0)}},[]),k.useEffect(()=>n.registerEditableListener(l=>{t(!l)}),[n]),S.jsx(N0,{options:o,onSelectOption:a,onWillOpen:l=>{r.current=l.target},menuRenderFn:(l,{selectedIndex:c,options:u,selectOptionAndCleanUp:f,setHighlightedIndex:d},{setMenuRef:h})=>(s.current=()=>f(void 0),l.current&&!wN(r.current,i.current)&&!Ub(r.current)?At.createPortal(S.jsx("div",{className:"typeahead-popover auto-embed-menu",style:{marginLeft:l.current.style.width,userSelect:"none",width:200},ref:h,children:S.jsx(kN,{options:o,selectedItemIndex:c,onOptionClick:(p,m)=>{p.isDisabled||(d(m),f(p))},onOptionMouseEnter:p=>{d(p)}})}),l.current):null)})}function CN({isEditable:n}){const[e]=ge();return k.useLayoutEffect(()=>{e.setEditable(n)},[e,n]),null}function SN({scripture:n,nodeOptions:e,editorAdaptor:t,viewOptions:r,logger:i}){const[s]=ge();return k.useEffect(()=>{var o;(o=t.initialize)==null||o.call(t,e,i)},[t,i,e]),k.useEffect(()=>{var o;(o=t.reset)==null||o.call(t);const a=t.serializeEditorState(n,r);if(a==null){i==null||i.warn("LoadStatePlugin: serializedEditorState was null or undefined. Skipping editor update.");return}try{const l=s.parseEditorState(a);queueMicrotask(()=>{s.update(()=>{s.setEditorState(l),s.dispatchCommand(Qm,void 0)},{tag:bf})})}catch{i==null||i.error("LoadStatePlugin: error parsing or setting editor state.")}},[s,t,i,n,r]),null}function TN({expandedNoteKeyRef:n,nodeOptions:e,viewOptions:t,logger:r}){const[i]=ge();return EN(e,r),NN(i,n,t,r),null}function EN(n,e){const t=k.useRef(void 0),r=n.noteCallers;k.useEffect(()=>{let i=r;(!i||i.length<=0)&&(i=wE),t.current!==i&&(t.current=i,DN("note-callers",i,e))},[e,r])}function NN(n,e,t,r){k.useEffect(()=>{if(!n.hasNodes([Ie,Ve,Gt]))throw new Error("NoteNodePlugin: CharNode, NoteNode or ImmutableNoteCallerNode not registered on editor!");const i=s=>n.update(()=>RN(s));return Ue(n.registerNodeTransform(Ve,s=>MN(s,t)),n.registerNodeTransform(Ie,AN),n.registerNodeTransform(ft,ON),n.registerNodeTransform(Gt,$N),n.registerMutationListener(Gt,(s,{prevEditorState:o})=>PN(s,o)),n.registerCommand(pr,()=>IN(n,e,t,r),si),n.registerRootListener((s,o)=>{o!==null&&o.removeEventListener("dblclick",i),s!==null&&s.addEventListener("dblclick",i)}))},[n,e,r,t])}function MN(n,e){const t=n.getChildren();if(!t.some(r=>Cr(r))&&(e==null?void 0:e.markerMode)!=="editable"&&n.getCaller()!==""&&n.remove(),t.length>0){const r=t[0];W(r)&&!Ao(r)&&n.insertBefore(r)}}function AN(n){const e=n.getParentOrThrow(),t=e.getChildren(),r=t.find(o=>Cr(o));if(!Te(n)||!pe(e)||!r)return;const i=Mf(t);r.getPreviewText()!==i&&r.setPreviewText(i);const s=n.getNextSibling();W(s)?s.getTextContent()!==me&&s.setTextContent(me):n.insertAfter(de(me))}function ON(n){const e=Yb(n),t=e==null?void 0:e.getChildren(),r=t==null?void 0:t.find(o=>Cr(o));if(!W(n)||!pe(e)||!r||!t)return;const i=n.getParent();if(!Ao(n)&&pe(i)&&n.getTextContent()!==me&&(n.setTextContent(me),n.selectEnd()),Te(i)&&i.getChildrenSize()===1){const o=n.getTextContent();o.length>1&&o.startsWith(me)&&(n.setTextContent(o.slice(1)),n.selectEnd())}const s=Mf(t);r.getPreviewText()!==s&&r.setPreviewText(s)}function $N(n){if(!Cr(n))return;const e=n.getNextSibling();!W(e)||Ao(e)?n.insertAfter(de(me)):e.getTextContent()!==me&&e.setTextContent(me)}function PN(n,e){for(const[t,r]of n){if(r!=="destroyed")continue;const i=e.read(()=>{const o=ce(t),a=o==null?void 0:o.getParent();return Cr(o)&&pe(a)&&a.getCaller()===zn}),s=document.querySelector(".editor-input");!i||!s||(s.classList.add("reset-counters"),s.offsetHeight,s.classList.remove("reset-counters"))}}function IN(n,e,t,r){var i;if((t==null?void 0:t.noteMode)!=="expandInline")return!1;const s=K();if(!q(s)||!s.isCollapsed())return!1;const o=s.anchor,a=o.getNode();if(e.current){const l=Qt(a,c=>pe(c));if(l)e.current!==l.getKey()&&(e.current=l.getKey());else{const c=ce(e.current);c&&!c.getIsCollapsed()&&(r==null||r.debug("Cursor moved away from NoteNode, collapsing it"),Ps(n,e.current,r)),e.current=void 0}}if(o.offset===0){const l=a.getPreviousSibling();if(pe(l)){r==null||r.debug("Cursor is just after a NoteNode");const c=l.getKey();l.getIsCollapsed()?e.current=c:e.current=void 0,Ps(n,c,r)}}if(o.offset===a.getTextContentSize()){const l=a.getNextSibling();if(pe(l)){r==null||r.debug("Cursor is just before a NoteNode");const c=l.getKey();l.getIsCollapsed()?e.current=c:e.current=void 0,Ps(n,c,r)}else if(!l){const c=Qt(a,u=>pe(u));if(c&&c.getIsCollapsed()&&Kt(c.getParent())&&c.is((i=c.getParent())==null?void 0:i.getLastChild())){r==null||r.debug("Cursor is at end of note at end of para");const u=c.getKey();e.current=u,Ps(n,u,r)}}}if(Kt(a)){const l=a.getChildAtIndex(o.offset),c=l==null?void 0:l.getPreviousSibling();if(us(c)&&pe(l)){r==null||r.debug("Cursor is between verse and NoteNode");const u=l.getKey();l.getIsCollapsed()?e.current=u:e.current=void 0,Ps(n,u,r)}}return!1}function Ps(n,e,t){const r=ce(e);try{r==null||r.toggleIsCollapsed()}catch(i){if(i instanceof Error&&i.message.includes("read only"))t==null||t.warn("Fallback triggered after stabilization - edge case"),setTimeout(()=>{n.update(()=>{r==null||r.toggleIsCollapsed()})},0);else throw i}}function RN(n){const e=K();if(!q(e))return;const t=e.anchor,r=e.focus,i=t.getNode(),s=r.getNode();if(pe(i)&&W(s)){n.preventDefault();const o=bo();o.anchor.set(s.getKey(),0,"text"),o.focus.set(s.getKey(),r.offset,"text"),it(o)}}function DN(n,e,t){for(const r of document.styleSheets)try{const i=r.cssRules||r.rules;for(const s of i)if(LN(s,n)){const o=e.map(a=>`"${a}"`).join(" ");s.symbols=o;return}}catch{continue}t==null||t.warn(`Editor: counter style "${n}" not found.`)}function LN(n,e){return typeof n=="object"&&n!==null&&"name"in n&&n.name===e&&"symbols"in n&&typeof n.symbols=="string"}function jN({onChange:n}){const[e]=ge();return k.useEffect(()=>e.registerCommand(pr,()=>{const t=e.read(()=>sv());return n==null||n(t),!1},si),[e,n]),null}function FN(){const[n]=ge();return qN(n),null}function qN(n){k.useEffect(()=>{if(!n.hasNodes([Tt]))throw new Error("ParaNodePlugin: ParaNode not registered on editor!");return n.registerNodeTransform(Tt,e=>BN(e,n))},[n])}function BN(n,e){Rf(e,n.getKey())&&dv(n.getFirstChild()),!(!dt(n)||n.getMarker()!=="b"||n.isEmpty()||!e.getEditorState().read(()=>{const t=ce(n.getKey());return dt(t)&&((t==null?void 0:t.isEmpty())??!1)}))&&n.clear()}function wv({onStateChange:n}){const[e]=ge(),[t,r]=k.useState(e),i=k.useRef(!1),s=k.useRef(!1),o=k.useRef(),a=k.useCallback(()=>{const l=K();if(q(l)){const c=l.anchor.getNode();let u=c.getKey()==="root"?c:Qt(c,d=>{const h=d.getParent();return h!==null&&vn(h)});u===null&&(u=c.getTopLevelElementOrThrow());const f=u.getKey();t.getElementByKey(f)!==null&&(dt(u)||_n(u)||No(u))&&(o.current=u.getMarker(),n==null||n(i.current,s.current,o.current))}},[t,n]);return k.useEffect(()=>e.registerCommand(pr,(l,c)=>(a(),r(c),!1),Mi),[e,a]),k.useEffect(()=>Ue(t.registerUpdateListener(({editorState:l})=>{l.read(()=>{a()})}),t.registerCommand(Ds,l=>(i.current=l,n==null||n(i.current,s.current,o.current),!1),Mi),t.registerCommand(Rs,l=>(s.current=l,n==null||n(i.current,s.current,o.current),!1),Mi)),[a,t,n]),null}function UN({textDirection:n}){const[e]=ge();return zN(e,n),WN(e),null}function zN(n,e){k.useEffect(()=>{function t(){const r=n.getRootElement();if(!r||e==="auto")return;r.dir=e;const i=n._config.theme.placeholder,s=document.getElementsByClassName(i)[0];s&&(s.dir=e)}return t(),n.registerUpdateListener(({dirtyElements:r})=>{r.size>0&&t()})},[n,e])}function WN(n){k.useEffect(()=>{const e=t=>{if(t.key!=="ArrowLeft"&&t.key!=="ArrowRight")return!1;const r=K();if(!q(r))return!1;const i=r.anchor.getNode(),s=Qt(i,f=>_T(f,n)==="p");if(!s)return!1;const o=n.getElementByKey(s.getKey());if(!o)return!1;const a=o.parentElement,l=o.dir||"ltr",c=((a==null?void 0:a.dir)??"")||"ltr";if(!a||l===c)return!1;const u=a.dir==="rtl"&&t.key==="ArrowLeft"||a.dir==="ltr"&&t.key==="ArrowRight";return r.modify("move",u,"character"),t.preventDefault(),!0};return n.registerCommand(Zi,e,Ol)},[n])}function KN(){const[n]=ge();return HN(n),null}function HN(n){k.useEffect(()=>{if(!n.hasNodes([Ie,vt,Ve,ft,bt]))throw new Error("TextSpacingPlugin: CharNode, ImmutableVerseNode, NoteNode, TextNode or VerseNode not registered on editor!");return Ue(n.registerNodeTransform(ft,JN),n.registerNodeTransform(ft,e=>VN(e,n)),n.registerNodeTransform(bt,Cp),n.registerNodeTransform(vt,Cp))},[n])}function JN(n){if(!n.isAttached())return;const e=n.getTextContent(),t=n.getNextSibling(),r=n.getParent();n.getMode()!=="normal"||e.endsWith(" ")&&e.length>1||pe(t)||Te(r)||rt(r)||Eo(r)||(e===" "&&!jt(t)?n.setTextContent(""):If(n))}function VN(n,e){const t=n.getParent();!Eo(t)||!n.isAttached()||Rf(e,n.getKey())&&t.insertAfter(n)}function Cp(n){if(!n.isAttached())return;const e=n.getPreviousSibling();e&&!jt(e)&&!W(e)&&!Eo(e)&&n.insertBefore(de(" "))}function GN({trigger:n,scriptureReference:e,contextMarker:t,getMarkerAction:r}){const{markersMenuItems:i}=BE({scriptureReference:e,contextMarker:t,getMarkerAction:r});return S.jsx(qE,{trigger:n,items:i})}function YN({trigger:n,scrRef:e,getMarkerAction:t}){const{book:r,chapterNum:i,verseNum:s,verse:o}=e,a=k.useMemo(()=>e,[r,i,s,o]),[l]=ge(),[c]=XN(l);return QN(l),S.jsx(GN,{trigger:n,scriptureReference:a,contextMarker:c,getMarkerAction:t})}function XN(n){const[e,t]=k.useState();return k.useEffect(()=>n.registerCommand(pr,()=>(n.read(()=>{const r=K();if(!q(r)){e&&t(void 0);return}const i=ce(r.anchor.key),s=ce(r.focus.key);if(!i||!s){e&&t(void 0);return}const o=hT(i,s);if(!o||!KT(o)){e&&t(void 0);return}const a=o.getMarker();e!==a&&t(a)}),!1),si),[e,n]),[e]}function QN(n){k.useEffect(()=>{if(!n.hasNodes([bt,vt]))throw new Error("UsjNodesMenuPlugin: VerseNode or ImmutableVerseNode not registered on editor!");const e={},t={};return Ue(n.registerNodeTransform(vt,r=>Sp(r,n,e)),n.registerNodeTransform(bt,r=>Sp(r,n,e)),n.registerMutationListener(vt,r=>Mp(r,n,e,t)),n.registerMutationListener(bt,r=>Mp(r,n,e,t)))},[n])}function Sp(n,e,t){Bw(bf)||Rf(e,n.getKey())&&tM(n,t)}function Tp(n){return RegExp(/(\d+)([a-zA-Z]+)?(-(\d+)([a-zA-Z]+)?)?/).exec(n)}const Ep=2,ZN=3,Np=4,eM=5;function tM(n,e){var t;const r=Tf(n),i=r==null?void 0:r.getNumber();if(!i)return;const s=e[i];if(!s)return;let o=parseInt(n.getNumber()),a=((t=Tp(n.getNumber()))==null?void 0:t[Ep])??"";s.forEach(l=>{const c=ce(l);if(!c)return;const u=c.getNumber(),f=parseInt(u),d=Tp(u),h=!!(d!=null&&d[ZN]),p=h?parseInt(d[Np]):f;if(p<o||f>o||p===o&&a)return;const m=(d==null?void 0:d[Ep])??"",y=(d==null?void 0:d[eM])??"",b=h?ad(parseInt(d[Np]),void 0):"";let _=`${m}`;_+=h?`-${b}${y}`:"";const w=ad(f,void 0);c.setNumber(`${w}${_}`),o=parseInt(h?b:w),a=h?y:m})}function Mp(n,e,t,r){e.getEditorState().read(()=>{for(const[i,s]of n){const o=ce(i);if(jt(o)){if(s==="created"){const a=Tf(o);if(!a)continue;const l=a.getNumber();t[l]||(t[l]=[]),t[l].push(i),r[i]=l}else if(s==="destroyed"){const a=r[i],l=t[a];if(!l)continue;const c=l.findIndex(u=>u===i);if(c===-1)continue;l.splice(c,1),Reflect.deleteProperty(r,i)}}}})}const xv="formatted",nM="unformatted";let Uf;function rM(n){const e=iM(n);if(!e)throw new Error(`Invalid view mode: ${n}`);Uf=e}rM(xv);const $o=()=>Uf;function iM(n){let e;switch(n){case xv:e={markerMode:"hidden",noteMode:"collapsed",hasSpacing:!0,isFormattedFont:!0};break;case nM:e={markerMode:"editable",noteMode:"expanded",hasSpacing:!1,isFormattedFont:!1};break}return e}function sM(n){if(n)return n.markerMode==="editable"?bt:vt}function oM(n){const e=[],t=n??Uf;return t&&(e.push(`${q1}${t.markerMode}`),t.hasSpacing&&e.push(j1),t.isFormattedFont&&e.push(F1)),e}let ud;function aM(n){n&&(ud=n)}function lM(n){return n.isEmpty()?_d:cM(n.toJSON())}function cM(n){if(!n.root||!n.root.children)return;const e=n.root.children;if(e.length===1&&wf(e[0])&&(!e[0].children||e[0].children.length===0))return _d;const t=Cv(e),r=Xn(t);return r?{type:Hs,version:Js,content:r}:void 0}function uM(n,e){const{type:t,marker:r,unknownAttributes:i}=n;let s;return n.code!==""&&(s=n.code),ze({type:t,marker:r,code:s,...i,content:e})}function dM(n){const{marker:e,number:t,sid:r,altnumber:i,pubnumber:s,unknownAttributes:o}=n;return ze({type:nn.getType(),marker:e,number:t,sid:r,altnumber:i,pubnumber:s,...o})}function fM(n,e){const{marker:t,sid:r,altnumber:i,pubnumber:s,unknownAttributes:o}=n,a=e&&typeof e[0]=="string"?e[0]:void 0;let{number:l}=n;return l=Xb(t,a,l),ze({type:nn.getType(),marker:t,number:l,sid:r,altnumber:i,pubnumber:s,...o})}function hM(n){const{marker:e,sid:t,altnumber:r,pubnumber:i,unknownAttributes:s}=n,{text:o}=n;let{number:a}=n;return a=Xb(e,o,a),ze({type:bt.getType(),marker:e,number:a,sid:t,altnumber:r,pubnumber:i,...s})}function gM(n,e){const{type:t,marker:r,unknownAttributes:i}=n,s=r===""?void 0:r;return e==null||e.forEach((o,a)=>{typeof o=="string"&&o.startsWith(me)&&(e[a]=o.slice(1))}),ze({type:t,marker:s,...i,content:e})}function pM(n,e){const{type:t,marker:r,unknownAttributes:i}=n;return ze({type:t,marker:r,...i,content:e})}function mM(n,e){const{type:t,marker:r,caller:i,category:s,unknownAttributes:o}=n;return ze({type:t,marker:r,caller:i,category:s,...o,content:e})}function Ti(n){const{type:e,marker:t,sid:r,eid:i,unknownAttributes:s}=n;return ze({type:e,marker:t===""?void 0:t,sid:r,eid:i,...s})}function yM(n){return n.text}function _M(n,e){const{tag:t,marker:r,unknownAttributes:i}=n;return ze({type:t,marker:r,...i,content:e})}function bM(n){const{marker:e}=n;return{type:vl,marker:e===""?void 0:e}}function Ap(n,e){const t=n[n.length-1];t&&typeof t=="string"?n[n.length-1]=t+e:n.push(e)}function vM(n,e,t,r,i){const s=bn.getType(),o=e.filter(a=>!t.includes(a));if(t.filter(a=>!e.includes(a)).forEach(a=>{const l=Ti({type:s,marker:Pi,eid:a});i.push(l)}),o.forEach(a=>{const l=Ti({type:s,marker:Qr,sid:a});i.push(l)}),e.length===0){const a=Ti({type:s,marker:Qr});i.push(a)}if(i.push(...n),e.length===0){const a=Ti({type:s,marker:Pi});i.push(a)}(!r||!CT(r))&&e.forEach(a=>{const l=Ti({type:s,marker:Pi,eid:a});i.push(l)})}function Xn(n,e){const t=[];let r,i=[];return n.forEach((s,o)=>{const a=s,l=s,c=s,u=s,f=s,d=s,h=s,p=s;switch(s.type){case qt.getType():t.push(uM(a,Xn(a.children)));break;case Jn.getType():t.push(dM(s));break;case nn.getType():t.push(fM(l,Xn(l.children)));break;case vt.getType():case bt.getType():t.push(hM(s));break;case Ie.getType():t.push(gM(c,Xn(c.children)));break;case Tt.getType():t.push(pM(u,Xn(u.children)));break;case Ve.getType():t.push(mM(f,Xn(f.children,f.caller)));break;case wr.getType():case Gt.getType():case mo.getType():case ci.getType():break;case tt.getType():if(r=Xn(h.children),r){const m=h.typedIDs[rr];if(m)vM(r,m,i,n[o+1],t),i=m;else{const y=r.shift();y&&(typeof y=="string"?Ap(t,y):t.push(y)),r.length>0&&t.push(...r)}}break;case bn.getType():t.push(Ti(s));break;case ft.getType():d.text&&d.text!==me&&!d.text.startsWith(_f)&&(!e||d.text!==Nf(e))&&Ap(t,yM(d));break;case li.getType():t.push(_M(p,Xn(p.children)));break;case xr.getType():t.push(bM(s));break;default:ud==null||ud.error(`Unexpected node type '${s.type}'!`)}}),t&&t.length>0?t:void 0}function Cv(n){const e=n.findIndex(t=>wf(t));if(e>=0){const t=n.slice(0,e),r=n[e].children,i=Cv(n.slice(e+1));n=[...t,...r,...i]}return n}const hu={initialize:aM,deserializeEditorState:lM},Op=Sv([]),kM={type:mo.getType(),version:1};let xl=[],ae,Ua,dd,$e;function wM(n,e){xl=[],SM(n),TM(e)}function xM(n=0){}function CM(n,e){ae=e??$o();let t;return n?(n.type!==Hs&&($e==null||$e.warn(`This USJ type '${n.type}' didn't match the expected type '${Hs}'.`)),n.version!==Js&&($e==null||$e.warn(`This USJ version '${n.version}' didn't match the expected version '${Js}'.`)),n.content.length>0?t=hd(qs(n.content)):t=[Op]):t=[Op],dd==null||dd(xl),{root:{children:t,direction:null,format:"",indent:0,type:"root",version:1}}}function SM(n){n&&(Ua=n),n!=null&&n.addMissingComments&&(dd=n.addMissingComments)}function TM(n){n&&($e=n)}function EM(n){return!n||n.length!==1||typeof n[0]!="string"?"":n[0]}function NM(n){let{marker:e}=n;e!==lo&&($e==null||$e.warn(`Unexpected book marker '${e}'!`)),e=e??lo;const{code:t}=n;(!t||!qt.isValidBookCode(t))&&($e==null||$e.warn(`Unexpected book code '${t}'!`));const r=[];((ae==null?void 0:ae.markerMode)==="editable"||(ae==null?void 0:ae.markerMode)==="visible")&&r.push(ti("marker",Vn(e)+" "+t+me));const i=EM(n.content);i&&r.push(hr(i));const s=Ge(n);return ze({type:qt.getType(),marker:e,code:t??"",unknownAttributes:s,children:r,direction:null,format:"",indent:0,version:$b})}function MM(n){let{marker:e}=n;e!==yl&&($e==null||$e.warn(`Unexpected chapter marker '${e}'!`)),e=e??yl;const{number:t,sid:r,altnumber:i,pubnumber:s}=n,o=Ge(n);let a;return(ae==null?void 0:ae.markerMode)==="visible"&&(a=!0),(ae==null?void 0:ae.markerMode)==="editable"?ze({type:nn.getType(),marker:e,number:t??"",sid:r,altnumber:i,pubnumber:s,unknownAttributes:o,children:[hr(Mo(e,t)??"")],direction:null,format:"",indent:0,version:Rb}):ze({type:Jn.getType(),marker:e,number:t??"",showMarker:a,sid:r,altnumber:i,pubnumber:s,unknownAttributes:o,version:qb})}function AM(n){let{marker:e}=n;e!==_l&&($e==null||$e.warn(`Unexpected verse marker '${e}'!`)),e=e??_l;const{number:t,sid:r,altnumber:i,pubnumber:s}=n,o=(sM(ae)??vt).getType(),a=(ae==null?void 0:ae.markerMode)==="editable"?Vb:av;let l,c;(ae==null?void 0:ae.markerMode)==="editable"?l=Mo(e,t):(ae==null?void 0:ae.markerMode)==="visible"&&(c=!0);const u=Ge(n);return ze({type:o,text:l,marker:e,number:t??"",sid:r,altnumber:i,pubnumber:s,showMarker:c,unknownAttributes:u,version:a})}function OM(n,e=[]){let{marker:t}=n;Ie.isValidMarker(t)||$e==null||$e.warn(`Unexpected char marker '${t}'!`),t=t??"",(ae==null?void 0:ae.markerMode)==="editable"&&e.forEach(i=>{Ef(i)&&(i.text=me+i.text)}),e.length===0&&e.push(hr(me));const r=Ge(n);return ze({type:Ie.getType(),marker:t,unknownAttributes:r,children:[...e],direction:null,format:"",indent:0,textFormat:0,textStyle:"",version:Fb})}function Sv(n){return{type:fr.getType(),children:n,direction:null,format:"",indent:0,textFormat:0,textStyle:"",version:zb}}function $M(n,e=[]){let{marker:t}=n;Tt.isValidMarker(t)||$e==null||$e.warn(`Unexpected para marker '${t}'!`),t=t??Wl;const r=[];(ae==null?void 0:ae.markerMode)==="editable"?r.push(Xi(t),hr(me)):(ae==null?void 0:ae.markerMode)==="visible"&&r.push(ti("marker",Vn(t)+me)),r.push(...e);const i=Ge(n);return ze({type:Tt.getType(),marker:t,unknownAttributes:i,children:r,direction:null,format:"",indent:0,textFormat:0,textStyle:"",version:Jb})}function PM(n,e){const t=yT(e);let r=()=>{};return Ua!=null&&Ua.noteCallerOnClick&&(r=Ua.noteCallerOnClick),ze({type:Gt.getType(),caller:n,previewText:t,onClick:r,version:pv})}function IM(n,e){let{marker:t}=n;Ve.isValidMarker(t)||$e==null||$e.warn(`Unexpected note marker '${t}'!`),t=t??xf;const{category:r}=n,i=n.caller??"*",s=(ae==null?void 0:ae.noteMode)!=="expanded",o=Ge(n);let a,l;(ae==null?void 0:ae.markerMode)==="editable"?(a=Xi(t),l=Xi(t,"closing")):(ae==null?void 0:ae.markerMode)==="visible"&&(a=ti("marker",Vn(t)+me),l=ti("marker",Vi(t)+me));const c=[];let u;if(a&&c.push(a),(ae==null?void 0:ae.markerMode)==="editable")u=hr(Nf(i)),c.push(u,...e);else{const f=hr(me);u=PM(i,e),c.push(u,f,...e.flatMap(RM(f)))}return l&&c.push(l),ze({type:Ve.getType(),marker:t,caller:i,isCollapsed:s,category:r,unknownAttributes:o,children:c,direction:null,format:"",indent:0,version:Hb})}function RM(n){return e=>NT(e)?[e]:[e,n]}function DM(n){let{marker:e}=n;(!e||!bn.isValidMarker(e))&&($e==null||$e.warn(`Unexpected milestone marker '${e}'!`)),e=e??"";const{sid:t,eid:r}=n,i=Ge(n);return ze({type:bn.getType(),marker:e,sid:t,eid:r,unknownAttributes:i,version:Wb})}function $p(n,e=[]){return{type:tt.getType(),typedIDs:{[rr]:e},children:n,direction:null,format:"",indent:0,version:1}}function LM(n,e){const{marker:t}=n,r=n.type,i=Ge(n),s=[...e];return s.forEach(o=>{Ef(o)&&(o.mode="token")}),ze({type:li.getType(),tag:r,marker:t,unknownAttributes:i,children:s,direction:null,format:"",indent:0,version:Ab})}function jM(n){return{type:xr.getType(),marker:n,version:rv}}function Xi(n,e="opening"){return{type:ci.getType(),marker:n,markerSyntax:e,text:"",detail:0,format:0,mode:"normal",style:"",version:1}}function hr(n,e="normal"){return{type:ft.getType(),text:n,detail:0,format:0,mode:e,style:"",version:1}}function ti(n,e){return{type:wr.getType(),text:e,textType:n,version:nv}}function Pp(n,e){(ae==null?void 0:ae.markerMode)==="editable"?e.push(Xi(n)):(ae==null?void 0:ae.markerMode)==="visible"&&e.push(ti("marker",Vn(n)))}function Ip(n,e,t=!1){Ie.isValidFootnoteMarker(n)||Ie.isValidCrossReferenceMarker(n)||((ae==null?void 0:ae.markerMode)==="editable"?t?e.push(Xi("","selfClosing")):e.push(Xi(n,"closing")):(ae==null?void 0:ae.markerMode)==="visible"&&e.push(ti("marker",Vi(t?"":n))))}function FM(n,e){if(n.type!=="ms")return;const t=[];if(n.sid&&t.push(`sid="${n.sid}"`),n.eid&&t.push(`eid="${n.eid}"`),t.length<=0)return;const r=_f+t.join(" ");(ae==null?void 0:ae.markerMode)==="editable"?e.push(hr(r)):(ae==null?void 0:ae.markerMode)==="visible"&&e.push(ti("attribute",r))}function Rp(n,e){return n.length<=0||e===0?n:n.map(t=>t-e)}function qM(n,e){const t=n.indexOf(e,0);t>-1&&n.splice(t,1)}function Dp(n,e){e.marker===Qr&&e.sid!==void 0&&n.push(e.sid),e.marker===Pi&&e.eid!==void 0&&qM(n,e.eid)}function fd(n,e,t=!1,r=[]){if(e.length<=0||e[0]>=n.length)return n;const i=e.shift(),s=e.length>0?e.shift():n.length-1;if(i===void 0||s===void 0||s>=n.length||n.length<=0)return n;const o=n.slice(0,i),a=t?[$p(o,[...r])]:o,l=n[i];Dp(r,l);const c=fd(n.slice(i+1,s),Rp(e,i+1),l.marker===Qr,r),u=$p(c,[...r]),f=n[s];Dp(r,f);const d=fd(n.slice(s+1),Rp(e,s+1),f.marker===Qr,r);return[...a,u,...d]}function qs(n){const e=[],t=[];return n==null||n.forEach(r=>{if(typeof r=="string")r&&t.push(hr(r));else if(!r.type)$e==null||$e.error("Marker type is missing!");else switch(r.type){case qt.getType():t.push(NM(r));break;case nn.getType():t.push(MM(r));break;case bt.getType():ae!=null&&ae.hasSpacing||t.push(kM),t.push(AM(r));break;case Ie.getType():Pp(r.marker??"",t),t.push(OM(r,qs(r.content))),Ip(r.marker??"",t);break;case Tt.getType():t.push($M(r,qs(r.content)));break;case Ve.getType():t.push(IM(r,qs(r.content)));break;case bn.getType():Q1(r.marker??"")&&(e.push(t.length),r.sid!==void 0&&(xl==null||xl.push(r.sid))),t.push(DM(r)),Pp(r.marker??"",t),FM(r,t),Ip(r.marker??"",t,!0);break;case xr.getType():t.push(jM(r.marker??""));break;default:$e==null||$e.warn(`Unknown type-marker '${r.type}-${r.marker}'!`),t.push(LM(r,qs(r.content)))}}),fd(t,e)}function hd(n){const e=n.findIndex(t=>L1(t)||oT(t)||iT(t));if(e>=0){const t=hd(n.slice(0,e)),r=n[e],i=hd(n.slice(e+1));return[...t,r,...i]}else if(n.some(t=>"text"in t&&"mode"in t||LT(t)))return[Sv(n)];return n}const gd={initialize:wM,reset:xM,serializeEditorState:CM},ya=n=>{if(!Ve.isValidMarker(n)||!n.includes("f"))throw new Error(`Invalid footnote marker '${n}'`);return{action:e=>{const{chapterNum:t,verseNum:r}=e.reference,i=[];return t!==void 0&&r!==void 0&&i.push({type:"char",marker:"fr",content:[`${t}:${r}`]}),e.noteText&&i.push({type:"char",marker:"fq",content:[e.noteText]}),i.push({type:"char",marker:"ft"}),[{type:"note",marker:n,caller:zn,content:i}]}}},Lp=n=>{if(!Ve.isValidMarker(n)||!n.includes("x"))throw new Error(`Invalid cross-reference marker '${n}'`);return{action:e=>{const{chapterNum:t,verseNum:r}=e.reference,i=[];return t!==void 0&&r!==void 0&&i.push({type:"char",marker:"xo",content:[`${t}:${r}`]}),i.push({type:"char",marker:"xt"}),[{type:"note",marker:n,caller:Kl,content:i}]}}},BM={c:{action:n=>{const{chapterNum:e}=n.reference;return[{type:"chapter",marker:"c",number:`${e+1}`}]}},v:{action:n=>{const{verseNum:e,verse:t}=n.reference;return[{type:"verse",marker:"v",number:`${ad(e,t)}`}]}},f:ya("f"),fe:ya("fe"),ef:ya("ef"),efe:ya("efe"),x:Lp("x"),ex:Lp("ex")};function UM(n,e,t,r,i){const s=zM(n);return{action:o=>{o.editor.update(()=>{var a;const l=K();q(l)&&(o.noteText=l.getTextContent());const c=(a=s==null?void 0:s.action)==null?void 0:a.call(s,o);if(!c)return;const u=dp(c,gd,r),f=lu(u);if(q(l)){const d=l.anchor.getNode();if(pe(f))lv(f,l,r),f.getIsCollapsed()||(e.current=f.getKey());else if(l.getTextContent().length>0)WM(l,()=>lu(u));else if(F(f)&&!f.isInline()){const h=l.insertParagraph();if(h){const p=h.getChildren();f.append(...p),h.replace(f),f.selectStart()}}else if(W(d)&&!Ao(d)&&pe(d.getParent())&&l.isCollapsed()){let h=d.insertAfter(f);if(bl(f)){const p={...r||$o(),markerMode:"hidden"},m=dp(c,gd,p),y=lu(m);h=h.insertAfter(y)}h.insertAfter(de(me))}else{l.insertNodes([f]),GM(f);const h=f.getNextSibling();h?h.selectStart():f.selectStart()}}else l==null||l.insertNodes([f])},i)},label:s==null?void 0:s.label}}function zM(n){let e=BM[n];return e||(Tt.isValidMarker(n)?e={action:()=>[{type:Tt.getType(),marker:n,content:[]}]}:Ie.isValidMarker(n)&&(e={action:()=>[{type:Ie.getType(),marker:n}]})),e}function WM(n,e){const t=n.getNodes(),[r,i]=KM(n);let s;t.forEach((o,a)=>{if(F(s)&&s.isParentOf(o))return;const l=HM(o,a===0,a===t.length-1,r,i);if(!l){s=void 0;return}s||(s=e(),l.insertBefore(s)),VM(l,s)}),(W(s)||F(s))&&s.selectEnd()}function KM(n){const e=n.anchor.offset,t=n.focus.offset;return n.isBackward()?[t,e]:[e,t]}function HM(n,e,t,r,i){if(!(rt(n)||pe(n)||pe(n.getParent()))){if(W(n))return JM(n,e,t,r,i);if(F(n)&&n.isInline())return n}}function JM(n,e,t,r,i){const s=n.getTextContentSize(),o=e?r:0,a=t?i:s;if(o===0&&a===0)return;const l=n.splitText(o,a);return l.length===1?l[0]:l.length===3||a===s?l[1]:l[0]}function VM(n,e){var t;if(W(e)){const r=jp(n,e);e.setTextContent(r),n.remove()}else if(F(e)){const r=e.getChildrenSize();e.append(n);for(let i=0;i<r;i++)(t=e.getFirstChild())==null||t.remove();jp(n,e)}}function jp(n,e){let t=n.getTextContent();if(W(n)&&e.isInline()&&t.startsWith(" ")){t=t.trimStart(),n.setTextContent(t);const r=e.getPreviousSibling();If(r),W(r)||e.insertBefore(de(" "))}return t}function GM(n){jt(n)&&(If(n.getPreviousSibling()),dv(n.getNextSibling()))}const Tv={chapter:"chapter",verse:"verse",char:"char",para:"para",typedMark:"editor-typed-mark",typedMarkOverlap:"editor-typed-markOverlap",mark:"editor-mark",markOverlap:"editor-markOverlap",placeholder:"editor-placeholder",paragraph:"editor-paragraph",quote:"editor-quote",heading:{h1:"editor-heading-h1",h2:"editor-heading-h2",h3:"editor-heading-h3",h4:"editor-heading-h4",h5:"editor-heading-h5"},list:{nested:{listitem:"editor-nested-listitem"},ol:"editor-list-ol",ul:"editor-list-ul",listitem:"editor-listitem"},image:"editor-image",link:"editor-link",text:{bold:"editor-text-bold",italic:"editor-text-italic",overflowed:"editor-text-overflowed",hashtag:"editor-text-hashtag",underline:"editor-text-underline",strikethrough:"editor-text-strikethrough",underlineStrikethrough:"editor-text-underlineStrikethrough"}};function YM({options:n,editedUsjRef:e,usj:t,setUsj:r}){const{view:i,nodes:s}=n||{},{hasSpacing:o,isFormattedFont:a,markerMode:l}=i||{};return k.useEffect(()=>{e.current&&!Pn(e.current,t)&&r(e.current)},[e,o,a,l,s,r,t]),null}function XM({scrRef:n,onScrRefChange:e}){const[t]=ge(),r=k.useRef(!1),i=k.useRef(!1),{book:s,chapterNum:o,verseNum:a}=n;return k.useEffect(()=>t.registerMutationListener(qt,l=>{t.update(()=>{for(const[c,u]of l){const f=ce(c);f&&_n(f)&&u==="created"&&Fp(o,a,i)}},{tag:id})},{skipInitialization:!0}),[t,o,a]),k.useEffect(()=>{r.current?r.current=!1:t.update(()=>Fp(o,a,i),{tag:id})},[t,o,a]),k.useEffect(()=>t.registerCommand(pr,()=>(i.current?i.current=!1:QM(s,o,a,e,r),!1),si),[t,s,o,a,e]),null}function Fp(n,e,t){var r;const i=Zb(K()),s=(r=uv(i))==null?void 0:r.getNumber();if(bT(s)&&Af(e,s))return;const o=ye().getChildren(),a=aT(o,n),l=mT(o,a),c=lT(l,!!a);if(c&&!a||!a)return;pT(l,c);const u=WT(l,e);if(u){if(dt(u)){const f=u.getFirstChild();W(f)?f.select(0,0):u.select(0,0)}else u.selectNext(0,0);t.current=!0}}function QM(n,e,t,r,i){const s=Zb(K());if(!s)return;const o=Tf(s),a=parseInt((o==null?void 0:o.getNumber())??"1",10),l=uv(s),c=l==null?void 0:l.getNumber(),u=parseInt(c??"0",10),f=c?Af(t,c):t===u;if(i.current=!!(o&&a!==e||!f),i.current){const d={book:n,chapterNum:a,verseNum:u};c!=null&&u.toString()!==c&&(d.verse=c),r(d)}}function ZM(n){return _n(n)?`${n.__code}`:vf(n)?`${n.__marker} "${n.__number}"`:Te(n)?`${n.__marker}`:No(n)?`${n.__marker} "${n.__number}"`:Cr(n)?`${n.__caller}`:us(n)?`${n.__marker} "${n.__number}"`:pe(n)?`${n.__marker} "${n.__caller}"`+(n.__isCollapsed?" (collapsed)":" (expanded)"):dt(n)?`${n.__marker}`:rt(n)?`ids: [ ${JSON.stringify(n.getTypedIDs())} ]`:Sf(n)?`${n.__marker} "${n.__number}"`:""}function eA(){const[n]=ge();return S.jsx(ZC,{viewClassName:"tree-view-output",treeTypeButtonClassName:"debug-treetype-button",timeTravelPanelClassName:"debug-timetravel-panel",timeTravelButtonClassName:"debug-timetravel-button",timeTravelPanelSliderClassName:"debug-timetravel-panel-slider",timeTravelPanelButtonClassName:"debug-timetravel-panel-button",customPrintNode:ZM,editor:n})}const Ev=k.createContext(null),qp=4;function tA({children:n,className:e,onClick:t,title:r}){const i=k.useRef(null),s=k.useContext(Ev);if(s===null)throw new Error("DropDownItem must be used within a DropDown");const{registerItem:o}=s;return k.useEffect(()=>{i&&i.current&&o(i)},[i,o]),S.jsx("button",{className:e,onClick:t,ref:i,title:r,type:"button",children:n})}function nA({children:n,dropDownRef:e,onClose:t}){const[r,i]=k.useState(),[s,o]=k.useState(),a=k.useCallback(u=>{i(f=>f?[...f,u]:[u])},[i]),l=u=>{if(!r)return;const f=u.key;["Escape","ArrowUp","ArrowDown","Tab"].includes(f)&&u.preventDefault(),f==="Escape"||f==="Tab"?t():f==="ArrowUp"?o(d=>{if(!d)return r[0];const h=r.indexOf(d)-1;return r[h===-1?r.length-1:h]}):f==="ArrowDown"&&o(d=>d?r[r.indexOf(d)+1]:r[0])},c=k.useMemo(()=>({registerItem:a}),[a]);return k.useEffect(()=>{r&&!s&&o(r[0]),s&&s.current&&s.current.focus()},[r,s]),S.jsx(Ev.Provider,{value:c,children:S.jsx("div",{className:"dropdown",ref:e,onKeyDown:l,children:n})})}function rA({disabled:n=!1,buttonLabel:e,buttonAriaLabel:t,buttonClassName:r,buttonIconClassName:i,children:s,stopCloseOnClickSelf:o}){const a=k.useRef(null),l=k.useRef(null),[c,u]=k.useState(!1),f=()=>{u(!1),l&&l.current&&l.current.focus()};return k.useEffect(()=>{const d=l.current,h=a.current;if(c&&d!==null&&h!==null){const{top:p,left:m}=d.getBoundingClientRect();h.style.top=`${p+d.offsetHeight+qp}px`,h.style.left=`${Math.min(m,window.innerWidth-h.offsetWidth-20)}px`}},[a,l,c]),k.useEffect(()=>{const d=l.current;if(d!==null&&c){const h=p=>{const m=p.target;o&&a.current&&a.current.contains(m)||d.contains(m)||u(!1)};return document.addEventListener("click",h),()=>{document.removeEventListener("click",h)}}return()=>{}},[a,l,c,o]),k.useEffect(()=>{const d=()=>{if(c){const h=l.current,p=a.current;if(h!==null&&p!==null){const{top:m}=h.getBoundingClientRect(),y=m+h.offsetHeight+qp;y!==p.getBoundingClientRect().top&&(p.style.top=`${y}px`)}}};return document.addEventListener("scroll",d),()=>{document.removeEventListener("scroll",d)}},[l,a,c]),S.jsxs(S.Fragment,{children:[S.jsxs("button",{type:"button",disabled:n,"aria-label":t||e,className:r,onClick:()=>u(!c),ref:l,children:[i&&S.jsx("span",{className:i}),e&&S.jsx("span",{className:"text dropdown-button-text",children:e}),S.jsx("i",{className:"chevron-down"})]}),c&&At.createPortal(S.jsx(nA,{dropDownRef:a,onClose:f,children:s}),document.body)]})}const pd={m:"m - Paragraph - Margin - No First Line Indent",ms:"ms - Heading - Major Section Level 1",nb:"nb - Paragraph - No Break with Previous Paragraph",p:"p - Paragraph - Normal - First Line Indent",pi:"pi - Paragraph - Indented - Level 1 - First Line Indent",q1:"q1 - Poetry - Indent Level 1",q2:"q2 - Poetry - Indent Level 2",r:"r - Heading - Parallel References",s:"s - Heading - Section Level 1"},md={...pd,ide:"ide - File - Encoding",h:"h - File - Header",h1:"h1 - File - Header",h2:"h2 - File - Left Header",h3:"h3 - File - Right Header",toc1:"toc1 - File - Long Table of Contents Text",toc2:"toc2 - File - Short Table of Contents Text",toc3:"toc3 - File - Book Abbreviation",cl:"cl - Chapter - Publishing Label",mt:"mt - Title - Major Title Level 1",mt1:"mt1 - Title - Major Title Level 1",mt2:"mt2 - Title - Major Title Level 2",mt3:"mt3 - Title - Major Title Level 3",mt4:"mt4 - Title - Major Title Level 4",ms1:"ms1 - Heading - Major Section Level 1",ms2:"ms2 - Heading - Major Section Level 2",ms3:"ms3 - Heading - Major Section Level 3",b:"b - Poetry - Stanza Break (Blank Line)"};function iA({editorRef:n,blockMarker:e,disabled:t=!1}){return S.jsx(rA,{disabled:t,buttonClassName:"toolbar-item block-controls",buttonIconClassName:"icon block-marker "+sA(e),buttonLabel:oA(e),buttonAriaLabel:"Formatting options for block type",children:Object.keys(pd).map(r=>S.jsxs(tA,{className:"item block-marker "+aA(e===r),onClick:()=>{var i;return(i=n.current)==null?void 0:i.formatPara(r)},children:[S.jsx("i",{className:"icon block-marker "+r}),S.jsx("span",{className:"text usfm_"+r,children:pd[r]})]},r))})}function sA(n){return n&&n in md?n:"ban"}function oA(n){return n&&n in md?md[n]:"No Style"}function aA(n){return n?"active dropdown-item-active":""}function Bp(){return S.jsx("div",{className:"divider"})}const lA=k.forwardRef(function({editorRef:n,isReadonly:e=!1,onStateChange:t},r){const[i]=ge(),[s,o]=k.useState(i),[a,l]=k.useState(),[c,u]=k.useState(!1),[f,d]=k.useState(!1),h=k.useCallback((p,m,y)=>{u(p),d(m),l(y),t==null||t(p,m,y)},[t]);return k.useEffect(()=>i.registerCommand(pr,(p,m)=>(o(m),!1),Mi),[i]),S.jsxs(S.Fragment,{children:[S.jsx(wv,{onStateChange:h}),S.jsxs("div",{className:"toolbar",children:[S.jsx("button",{disabled:!c||e,onClick:()=>{s.dispatchCommand(go,void 0)},title:Fu?"Undo (⌘Z)":"Undo (Ctrl+Z)",type:"button",className:"toolbar-item spaced","aria-label":"Undo",children:S.jsx("i",{className:"format undo"})}),S.jsx("button",{disabled:!f||e,onClick:()=>{s.dispatchCommand(po,void 0)},title:Fu?"Redo (⌘Y)":"Redo (Ctrl+Y)",type:"button",className:"toolbar-item","aria-label":"Redo",children:S.jsx("i",{className:"format redo"})}),S.jsx(Bp,{}),s===i&&S.jsxs(S.Fragment,{children:[S.jsx(iA,{editorRef:n,blockMarker:a,disabled:e}),S.jsx(Bp,{})]}),S.jsx("div",{ref:r,className:"end-container"})]})]})}),Up={namespace:"platformEditor",theme:Tv,editable:!0,editorState:void 0,onError(n){throw n},nodes:[tt,...xE]},cA=$o(),uA={},dA={};function fA(){return S.jsx("div",{className:"editor-placeholder",children:"Enter some Scripture..."})}const Nv=k.forwardRef(function({defaultUsj:n,scrRef:e,onScrRefChange:t,onSelectionChange:r,onUsjChange:i,onStateChange:s,options:o,logger:a,children:l},c){const u=k.useRef(null),f=k.useRef(null),d=k.useRef(null),h=k.useRef(n),p=k.useRef(),[m,y]=k.useState(n),[b,_]=k.useState(0),{isReadonly:w=!1,hasExternalUI:T=!1,hasSpellCheck:I=!1,textDirection:M="ltr",markerMenuTrigger:D="\\",view:A=cA,nodes:O=uA,debug:B=!1}=o??dA;Up.editable=!w,hu.initialize(a),k.useImperativeHandle(c,()=>({focus(){var N;(N=u.current)==null||N.focus()},undo(){var N;(N=u.current)==null||N.dispatchCommand(go,void 0)},redo(){var N;(N=u.current)==null||N.dispatchCommand(po,void 0)},cut(){var N;(N=u.current)==null||N.dispatchCommand(ri,null)},copy(){var N;(N=u.current)==null||N.dispatchCommand(mr,null)},paste(){u.current&&qf(u.current)},pastePlainText(){u.current&&Bf(u.current)},getUsj(){return h.current},setUsj(N){if(!Pn(h.current,N)){h.current=N;const C=Pn(m,N);y(N),C&&_(R=>R+1)}},applyUpdate(N,C="remote"){var R,j;(R=u.current)==null||R.update(()=>{C==="remote"&&jy(od),HE(N,A,O,a)},{discrete:!0});const L=(j=u.current)==null?void 0:j.getEditorState();if(!L)return;const z=hu.deserializeEditorState(L);if(z){const H=!Pn(h.current,z);if(H&&(h.current=z),H||!Pn(m,z)){const V=yp(N,L);i==null||i(z,N,C,V)}}},replaceEmbedUpdate(N,C){var R;const j=(R=u.current)==null?void 0:R.read(()=>ZT(N,C));j&&this.applyUpdate(j)},getSelection(){var N;return(N=u.current)==null?void 0:N.read(sv)},setSelection(N){var C;(C=u.current)==null||C.update(()=>{const R=$f(N);R!==void 0&&it(R)},{tag:Ib})},addAnnotation(N,C,R){var j;(j=f.current)==null||j.addAnnotation(N,cp(C),R)},removeAnnotation(N,C){var R;(R=f.current)==null||R.removeAnnotation(cp(N),C)},formatPara(N){var C;(C=u.current)==null||C.update(()=>{const R=K();q(R)&&px(R,()=>co(N))})},getElementByKey(N){var C;return(C=u.current)==null?void 0:C.read(()=>{var R;return((R=u.current)==null?void 0:R.getElementByKey(N))??void 0})},insertNote(N,C,R){var j;(j=u.current)==null||j.update(()=>{const L=jT(N,C,R,e,A,O,a);L&&!L.getIsCollapsed()&&(p.current=L.getKey())})},selectNote(N){var C;(C=u.current)==null||C.update(()=>{const R=pp(N);R&&(qT(R,A),R.getIsCollapsed()||(p.current=R.getKey()))})},getNoteOps(N){var C;return(C=u.current)==null?void 0:C.read(()=>{const R=pp(N);if(R)return Df(R)})},get toolbarEndRef(){return d}}));const x=k.useCallback((N,C,R,j)=>{if(B1.some(z=>R.has(z)))return;const L=hu.deserializeEditorState(N);if(L){const z=!Pn(h.current,L);if(z&&(h.current=L),z||!Pn(m,L)){const H=R.has(od)?"remote":"local",V=yp(j,N);i==null||i(L,j,H,V)}}},[m,i]);return S.jsxs(O_,{initialConfig:Up,children:[S.jsx(CN,{isEditable:!w}),S.jsxs("div",{className:"editor-container",children:[T?S.jsx(wv,{onStateChange:s}):S.jsx("div",{className:"editor-toolbar-container"+(w?"-readonly":"-editable"),children:S.jsx(lA,{ref:d,editorRef:c,isReadonly:w,onStateChange:s})}),S.jsxs("div",{className:"editor-inner",children:[S.jsx(D_,{editorRef:u}),S.jsx(w0,{contentEditable:S.jsx(R_,{className:`editor-input usfm ${oM(A).join(" ")}`,spellCheck:I}),placeholder:S.jsx(fA,{}),ErrorBoundary:L_}),S.jsx(j_,{}),e&&t&&S.jsx(XM,{scrRef:e,onScrRefChange:t}),e&&S.jsx(YN,{trigger:D,scrRef:e,getMarkerAction:(N,C)=>UM(N,p,C,A)}),S.jsx(YM,{options:{view:A,nodes:O},editedUsjRef:h,usj:m,setUsj:y}),S.jsx(SN,{scripture:m,nodeOptions:O,editorAdaptor:gd,viewOptions:A,logger:a},b),S.jsx(jN,{onChange:r}),S.jsx(WE,{onChange:x,ignoreSelectionChange:!0,ignoreHistoryMergeTagChange:!0}),S.jsx(zE,{ref:f,logger:a}),S.jsx(lN,{viewOptions:A}),S.jsx(gN,{}),S.jsx(_N,{}),S.jsx(bN,{logger:a}),S.jsx(xN,{}),S.jsx(TN,{expandedNoteKeyRef:p,nodeOptions:O,viewOptions:A,logger:a}),S.jsx(FN,{}),S.jsx(UN,{textDirection:M}),S.jsx(KN,{}),l]}),B&&S.jsx(eA,{})]})]})}),ds=k.forwardRef(function(n,e){const{children:t,...r}=n;return S.jsx(Nv,{ref:e,...r})});function Mv(){return Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5)}function Cl(n,e,t,r,i){return{author:e,content:n,deleted:i===void 0?!1:i,id:t===void 0?Mv():t,timeStamp:r===void 0?performance.timeOrigin+performance.now():r,type:"comment"}}function Av(n,e,t){return{comments:e,id:t===void 0?Mv():t,quote:n,type:"thread"}}function zp(n){return{comments:Array.from(n.comments),id:n.id,quote:n.quote,type:"thread"}}function hA(n){return{author:n.author,content:"[Deleted Comment]",deleted:!0,id:n.id,timeStamp:n.timeStamp,type:"comment"}}function gu(n){const e=n._changeListeners;for(const t of e)t()}class gA{constructor(e,t){Z(this,"_editor"),Z(this,"_comments"),Z(this,"_changeListeners"),Z(this,"_collabProvider"),Z(this,"logger"),this._comments=[],this._editor=e,this.logger=t,this._collabProvider=null,this._changeListeners=new Set}isCollaborative(){return this._collabProvider!==null}getComments(){return this._comments}setComments(e){this._comments=e,gu(this)}addComment(e,t,r){const i=Array.from(this._comments),s=this._getCollabComments();if(t!==void 0&&e.type==="comment")for(let o=0;o<i.length;o++){const a=i[o];if(a.type==="thread"&&a.id===t.id){const l=zp(a);i.splice(o,1,l);const c=r!==void 0?r:l.comments.length;if(this.isCollaborative()&&s!==null){const u=s.get(o).get("comments");this._withRemoteTransaction(()=>{const f=this._createCollabSharedMap(e);u.insert(c,[f])})}l.comments.splice(c,0,e);break}}else{const o=r!==void 0?r:i.length;this.isCollaborative()&&s!==null&&this._withRemoteTransaction(()=>{const a=this._createCollabSharedMap(e);s.insert(o,[a])}),i.splice(o,0,e)}this._comments=i,gu(this)}deleteCommentOrThread(e,t){const r=Array.from(this._comments),i=this._getCollabComments();let s=null;if(t!==void 0)for(let o=0;o<r.length;o++){const a=r[o];if(a.type==="thread"&&a.id===t.id){const l=zp(a);r.splice(o,1,l);const c=l.comments;if(s=c.indexOf(e),this.isCollaborative()&&i!==null){const u=i.get(o).get("comments"),f=s;this._withRemoteTransaction(()=>{u.delete(f)})}c.splice(s,1);break}}else s=r.indexOf(e),this.isCollaborative()&&i!==null&&this._withRemoteTransaction(()=>{i.delete(s)}),r.splice(s,1);return this._comments=r,gu(this),e.type==="comment"?{index:s,markedComment:hA(e)}:null}registerOnChange(e){const t=this._changeListeners;return t.add(e),()=>{t.delete(e)}}_withRemoteTransaction(e){const t=this._collabProvider;t!==null&&t.doc.transact(e,this)}_withLocalTransaction(e){const t=this._collabProvider;try{this._collabProvider=null,e()}finally{this._collabProvider=t}}_getCollabComments(){const e=this._collabProvider;return e!==null?e.doc.get("comments",Br):null}_createCollabSharedMap(e){const t=new Ki,r=e.type,i=e.id;if(t.set("type",r),t.set("id",i),r==="comment")t.set("author",e.author),t.set("content",e.content),t.set("deleted",e.deleted),t.set("timeStamp",e.timeStamp);else{t.set("quote",e.quote);const s=new Br;e.comments.forEach((o,a)=>{const l=this._createCollabSharedMap(o);s.insert(a,[l])}),t.set("comments",s)}return t}registerCollaboration(e){this._collabProvider=e;const t=this._getCollabComments(),r=()=>{e.connect()},i=()=>{try{e.disconnect()}catch{}},s=this._editor.registerCommand($1,a=>{var l,c;return r!==void 0&&i!==void 0&&(a?((l=this.logger)==null||l.info("Comments connected!"),r()):((c=this.logger)==null||c.info("Comments disconnected!"),i())),!1},si),o=(a,l)=>{if(l.origin!==this){for(const c of a)if(c instanceof kb){const u=c.target,f=c.delta;let d=0;for(const h of f){const p=h.insert,m=h.retain,y=h.delete,b=u.parent,_=u===t?void 0:b instanceof Ki&&this._comments.find(w=>w.id===b.get("id"));if(Array.isArray(p)){const w=d;p.slice().reverse().forEach(T=>{const I=T.get("id"),M=T.get("type")==="thread"?Av(T.get("quote"),T.get("comments").toArray().map(D=>Cl(D.get("content"),D.get("author"),D.get("id"),D.get("timeStamp"),D.get("deleted"))),I):Cl(T.get("content"),T.get("author"),I,T.get("timeStamp"),T.get("deleted"));this._withLocalTransaction(()=>{this.addComment(M,_,w)})})}else if(typeof m=="number")d+=m;else if(typeof y=="number")for(let w=0;w<y;w++){const T=_===void 0||_===!1?this._comments[d]:_.comments[d];this._withLocalTransaction(()=>{this.deleteCommentOrThread(T,_)}),d++}}}}};return t===null?()=>null:(t.observeDeep(o),r(),()=>{t.unobserveDeep(o),s(),this._collabProvider=null})}}function pA(n){const[e,t]=k.useState(n.getComments());return k.useEffect(()=>n.registerOnChange(()=>{t(n.getComments())}),[n]),e}function mA({onClose:n,children:e,title:t,closeOnClickOutside:r}){const i=k.useRef(null);return k.useEffect(()=>{i.current!==null&&i.current.focus()},[]),k.useEffect(()=>{let s=null;const o=c=>{c.key==="Escape"&&n()},a=c=>{const u=c.target;i.current!==null&&!i.current.contains(u)&&r&&n()},l=i.current;return l!==null&&(s=l.parentElement,s!==null&&s.addEventListener("click",a)),window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o),s!==null&&(s==null||s.removeEventListener("click",a))}},[r,n]),S.jsx("div",{className:"Modal__overlay",role:"dialog",children:S.jsxs("div",{className:"Modal__modal",tabIndex:-1,ref:i,children:[S.jsx("h2",{className:"Modal__title",children:t}),S.jsx("button",{className:"Modal__closeButton","aria-label":"Close modal",type:"button",onClick:n,children:"X"}),S.jsx("div",{className:"Modal__content",children:e})]})})}function yA({onClose:n,children:e,title:t,closeOnClickOutside:r=!1}){return At.createPortal(S.jsx(mA,{onClose:n,title:t,closeOnClickOutside:r,children:e}),document.body)}function Ov(){const[n,e]=k.useState(null),t=k.useCallback(()=>{e(null)},[]),r=k.useMemo(()=>{if(n===null)return null;const{title:s,content:o,closeOnClickOutside:a}=n;return S.jsx(yA,{onClose:t,title:s,closeOnClickOutside:a,children:o})},[n,t]),i=k.useCallback((s,o,a=!1)=>{e({closeOnClickOutside:a,content:o(t),title:s})},[t]);return[r,i]}const _A={...Tv,paragraph:"CommentEditorTheme__paragraph"};function bA(...n){return n.filter(Boolean).join(" ")}function gr({"data-test-id":n,children:e,className:t,onClick:r,disabled:i,small:s,title:o}){return S.jsx("button",{disabled:i,className:bA("Button__root",i&&"Button__disabled",s&&"Button__small",t),onClick:r,title:o,"aria-label":o,...n&&{"data-test-id":n},children:e})}function vA({className:n}){return S.jsx(R_,{className:n||"ContentEditable__root"})}function kA({children:n,className:e}){return S.jsx("div",{className:e||"Placeholder__root",children:n})}const Wp=ie("INSERT_INLINE_COMMAND");function wA({anchorKey:n,editor:e,showComments:t,onAddComment:r}){const i=k.useRef(null),s=k.useCallback(()=>{const o=i.current,a=e.getRootElement(),l=e.getElementByKey(n);if(o!==null&&a!==null&&l!==null){const{right:c}=a.getBoundingClientRect(),{top:u}=l.getBoundingClientRect();o.style.left=`${c-20}px`,o.style.top=`${u-30}px`}},[n,e]);return k.useEffect(()=>(window.addEventListener("resize",s),()=>{window.removeEventListener("resize",s)}),[e,s]),k.useLayoutEffect(()=>{s()},[n,e,t,s]),S.jsx("div",{className:"CommentPlugin_AddCommentBox",ref:i,children:S.jsx("button",{className:"CommentPlugin_AddCommentBox_button",onClick:r,children:S.jsx("i",{className:"icon add-comment"})})})}function xA({onEscape:n}){const[e]=ge();return k.useEffect(()=>e.registerCommand(El,t=>n(t),Ia),[e,n]),null}function $v({className:n,autoFocus:e,onEscape:t,onChange:r,editorRef:i,placeholder:s="Type a comment..."}){return S.jsx(O_,{initialConfig:{namespace:"Commenting",nodes:[],onError:o=>{throw o},theme:_A},children:S.jsxs("div",{className:"CommentPlugin_CommentInputBox_EditorContainer",children:[S.jsx(B0,{contentEditable:S.jsx(vA,{className:n}),placeholder:S.jsx(kA,{children:s}),ErrorBoundary:L_}),S.jsx(I0,{onChange:r}),S.jsx(j_,{}),e!==!1&&S.jsx(M0,{}),S.jsx(xA,{onEscape:t}),S.jsx(O0,{}),i!==void 0&&S.jsx(D_,{editorRef:i})]})})}function Pv(n,e){return k.useCallback((t,r)=>{t.read(()=>{n($_()),e(!P_(r.isComposing(),!0))})},[e,n])}function CA({editor:n,cancelAddComment:e,submitAddComment:t}){const[r,i]=k.useState(""),[s,o]=k.useState(!1),a=k.useRef(null),l=k.useMemo(()=>({container:document.createElement("div"),elements:[]}),[]),c=k.useRef(null),u=Rv(),f=k.useCallback(()=>{n.getEditorState().read(()=>{const m=K();if(q(m)){c.current=m.clone();const y=m.anchor,b=m.focus,_=ux(n,y.getNode(),y.offset,b.getNode(),b.offset),w=a.current;if(_!==null&&w!==null){const{left:T,bottom:I,width:M}=_.getBoundingClientRect(),D=dx(n,_);let A=D.length===1?T+M/2-125:T-125;A<10&&(A=10),w.style.left=`${A}px`,w.style.top=`${I+20+(window.pageYOffset||document.documentElement.scrollTop)}px`;const O=D.length,{container:B}=l,x=l.elements,N=x.length;for(let C=0;C<O;C++){const R=D[C];let j=x[C];j===void 0&&(j=document.createElement("span"),x[C]=j,B.appendChild(j));const L=`position:absolute;top:${R.top+(window.pageYOffset||document.documentElement.scrollTop)}px;left:${R.left}px;height:${R.height}px;width:${R.width}px;background-color:rgba(255, 212, 0, 0.3);pointer-events:none;z-index:5;`;j.style.cssText=L}for(let C=N-1;C>=O;C--){const R=x[C];B.removeChild(R),x.pop()}}}})},[n,l]);k.useLayoutEffect(()=>{f();const m=l.container,y=document.body;return y!==null?(y.appendChild(m),()=>{y.removeChild(m)}):()=>{}},[l.container,f]),k.useEffect(()=>(window.addEventListener("resize",f),()=>{window.removeEventListener("resize",f)}),[f]);const d=m=>(m.preventDefault(),e(),!0),h=()=>{if(s){let m=n.getEditorState().read(()=>{const y=c.current;return y?y.getTextContent():""});m.length>100&&(m=m.slice(0,99)+"…"),t(Av(m,[Cl(r,u)]),!0,void 0,c.current),c.current=null}},p=Pv(i,o);return S.jsxs("div",{className:"CommentPlugin_CommentInputBox",ref:a,children:[S.jsx($v,{className:"CommentPlugin_CommentInputBox_Editor",onEscape:d,onChange:p}),S.jsxs("div",{className:"CommentPlugin_CommentInputBox_Buttons",children:[S.jsx(gr,{onClick:e,className:"CommentPlugin_CommentInputBox_Button",children:"Cancel"}),S.jsx(gr,{onClick:h,disabled:!s,className:"CommentPlugin_CommentInputBox_Button primary",children:"Comment"})]})]})}function SA({submitAddComment:n,thread:e,placeholder:t}){const[r,i]=k.useState(""),[s,o]=k.useState(!1),a=k.useRef(null),l=Rv(),c=Pv(i,o);return S.jsxs(S.Fragment,{children:[S.jsx($v,{className:"CommentPlugin_CommentsPanel_Editor",autoFocus:!1,onEscape:()=>!0,onChange:c,editorRef:a,placeholder:t}),S.jsx(gr,{className:"CommentPlugin_CommentsPanel_SendButton",onClick:()=>{if(s){n(Cl(r,l),!1,e);const u=a.current;u!==null&&u.dispatchCommand(Dd,void 0)}},disabled:!s,children:S.jsx("i",{className:"send"})})]})}function Iv({commentOrThread:n,deleteCommentOrThread:e,onClose:t,thread:r=void 0}){return S.jsxs(S.Fragment,{children:["Are you sure you want to delete this ",n.type,"?",S.jsxs("div",{className:"Modal__content",children:[S.jsx(gr,{onClick:()=>{e(n,r),t()},children:"Delete"})," ",S.jsx(gr,{onClick:()=>{t()},children:"Cancel"})]})]})}function Kp({comment:n,deleteComment:e,thread:t,rtf:r}){const i=Math.round((n.timeStamp-(performance.timeOrigin+performance.now()))/1e3),s=Math.round(i/60),[o,a]=Ov();return S.jsxs("li",{className:"CommentPlugin_CommentsPanel_List_Comment",children:[S.jsxs("div",{className:"CommentPlugin_CommentsPanel_List_Details",children:[S.jsx("span",{className:"CommentPlugin_CommentsPanel_List_Comment_Author",children:n.author}),S.jsxs("span",{className:"CommentPlugin_CommentsPanel_List_Comment_Time",children:["· ",i>-10?"Just now":r.format(s,"minute")]})]}),S.jsx("p",{className:n.deleted?"CommentPlugin_CommentsPanel_DeletedComment":"",children:n.content}),!n.deleted&&S.jsxs(S.Fragment,{children:[S.jsx(gr,{onClick:()=>{a("Delete Comment",l=>S.jsx(Iv,{commentOrThread:n,deleteCommentOrThread:e,thread:t,onClose:l}))},className:"CommentPlugin_CommentsPanel_List_DeleteButton",children:S.jsx("i",{className:"delete"})}),o]})]})}function TA({activeIDs:n,comments:e,deleteCommentOrThread:t,listRef:r,submitAddComment:i,markNodeMap:s}){const[o]=ge(),[a,l]=k.useState(0),[c,u]=Ov(),f=k.useMemo(()=>new Intl.RelativeTimeFormat("en",{localeMatcher:"best fit",numeric:"auto",style:"short"}),[]);return k.useEffect(()=>{const d=setTimeout(()=>{l(a+1)},1e4);return()=>{clearTimeout(d)}},[a]),S.jsx("ul",{className:"CommentPlugin_CommentsPanel_List",ref:r,children:e.map(d=>{const h=d.id;return d.type==="thread"?S.jsxs("li",{onClick:()=>{const p=s.get(h);if(p!==void 0&&(n===null||n.indexOf(h)===-1)){const m=document.activeElement;o.update(()=>{const y=Array.from(p)[0],b=ce(y);rt(b)&&b.selectStart()},{onUpdate(){m!==null&&m.focus()}})}},className:`CommentPlugin_CommentsPanel_List_Thread ${s.has(h)?"interactive":""} ${n.indexOf(h)===-1?"":"active"}`,children:[S.jsxs("div",{className:"CommentPlugin_CommentsPanel_List_Thread_QuoteBox",children:[S.jsxs("blockquote",{className:"CommentPlugin_CommentsPanel_List_Thread_Quote",children:["> ",S.jsx("span",{children:d.quote})]}),S.jsx(gr,{onClick:()=>{u("Delete Thread",p=>S.jsx(Iv,{commentOrThread:d,deleteCommentOrThread:t,onClose:p}))},className:"CommentPlugin_CommentsPanel_List_DeleteButton",children:S.jsx("i",{className:"delete"})}),c]}),S.jsx("ul",{className:"CommentPlugin_CommentsPanel_List_Thread_Comments",children:d.comments.map(p=>S.jsx(Kp,{comment:p,deleteComment:t,thread:d,rtf:f},p.id))}),S.jsx("div",{className:"CommentPlugin_CommentsPanel_List_Thread_Editor",children:S.jsx(SA,{submitAddComment:i,thread:d,placeholder:"Reply to comment..."})})]},h):S.jsx(Kp,{comment:d,deleteComment:t,rtf:f},h)})})}function EA({activeIDs:n,deleteCommentOrThread:e,comments:t,submitAddComment:r,markNodeMap:i}){const s=k.useRef(null),o=t.length===0;return S.jsxs("div",{className:"CommentPlugin_CommentsPanel",children:[S.jsx("h2",{className:"CommentPlugin_CommentsPanel_Heading",children:"Comments"}),o?S.jsx("div",{className:"CommentPlugin_CommentsPanel_Empty",children:"No Comments"}):S.jsx(TA,{activeIDs:n,comments:t,deleteCommentOrThread:e,listRef:s,submitAddComment:r,markNodeMap:i})]})}function Rv(){const n=B_(),{yjsDocMap:e,name:t}=n;return e.has("comments")?t:"Scripture User"}function NA({providerFactory:n,setCommentStore:e,onChange:t,showCommentsContainerRef:r,commentContainerRef:i,logger:s}){const o=B_(),[a]=ge(),l=k.useMemo(()=>{const A=new gA(a,s);return t&&A.registerOnChange(t),e==null||e(A),A},[a,s,t,e]),c=pA(l),u=k.useMemo(()=>new Map,[]),[f,d]=k.useState(),[h,p]=k.useState([]),[m,y]=k.useState(!1),[b,_]=k.useState(!1),{yjsDocMap:w}=o;k.useEffect(()=>{if(n){const A=n("comments",w);return l.registerCollaboration(A)}return()=>{}},[l,n,w]);const T=k.useCallback(()=>{a.update(()=>{const A=K();A!==null&&(A.dirty=!0)}),y(!1)},[a]),I=k.useCallback((A,O)=>{if(A.type==="comment"){const B=l.deleteCommentOrThread(A,O);if(!B)return;const{markedComment:x,index:N}=B;l.addComment(x,O,N)}else{l.deleteCommentOrThread(A);const B=O!==void 0?O.id:A.id,x=u.get(B);x!==void 0&&setTimeout(()=>{a.update(()=>{for(const N of x){const C=ce(N);rt(C)&&(C.deleteID(rr,B),C.hasNoIDsForEveryType()&&ev(C))}})})}},[l,a,u]),M=k.useCallback((A,O,B,x)=>{l.addComment(A,B),O&&(a.update(()=>{q(x)&&tv(x,rr,A.id)}),y(!1))},[l,a]);k.useEffect(()=>{const A=[];for(const O of h){const B=u.get(O);if(B!==void 0)for(const x of B){const N=a.getElementByKey(x);N!==null&&(N.classList.add("selected"),A.push(N),_(!0))}}return()=>{for(const O of A)O.classList.remove("selected")}},[h,a,u]),k.useEffect(()=>{if(!a.hasNodes([tt]))throw new Error("CommentPlugin: TypedMarkNode not registered on editor!");const A=new Map;return Ue(Yy(a,tt,O=>uo(O.getTypedIDs()),(O,B)=>{for(const[x,N]of Object.entries(O.getTypedIDs()))N.forEach(C=>{B.addID(x,C)})}),a.registerMutationListener(tt,O=>{a.getEditorState().read(()=>{for(const[B,x]of O){const N=ce(B);let C=[];x==="destroyed"?C=A.get(B)??[]:rt(N)&&(C=N.getTypedIDs()[rr]??[]);for(const R of C){let j=u.get(R);A.set(B,C),x==="destroyed"?j!==void 0&&(j.delete(B),j.size===0&&u.delete(R)):(j===void 0&&(j=new Set,u.set(R,j)),j.has(B)||j.add(B))}}})},{skipInitialization:!1}),a.registerUpdateListener(({editorState:O,tags:B})=>{O.read(()=>{const x=K();let N=!1,C=!1;if(q(x)){const R=x.anchor.getNode();if(W(R)){const j=ST(R,rr,x.anchor.offset)??[];j!==null&&(p(j),N=!0),x.isCollapsed()||(d(R.getKey()),C=!0)}}N||p(R=>R.length===0?R:[]),C||d(null),!B.has("collaboration")&&q(x)&&y(!1)})}),a.registerCommand(Wp,()=>{const O=window.getSelection();return O!==null&&O.removeAllRanges(),y(!0),!0},ne))},[a,u]);const D=()=>{a.dispatchCommand(Wp,void 0)};return S.jsxs(S.Fragment,{children:[m&&At.createPortal(S.jsx(CA,{editor:a,cancelAddComment:T,submitAddComment:M}),document.body),f!=null&&!m&&At.createPortal(S.jsx(wA,{anchorKey:f,editor:a,showComments:b,onAddComment:D}),document.body),r!==null&&At.createPortal(S.jsx(gr,{className:`CommentPlugin_ShowCommentsButton ${b?"active":""}`,onClick:()=>_(!b),title:b?"Hide Comments":"Show Comments",children:S.jsx("i",{className:"comments"})}),(r==null?void 0:r.current)??document.body),b&&At.createPortal(S.jsx(EA,{comments:c,submitAddComment:M,deleteCommentOrThread:I,activeIDs:h,markNodeMap:u}),(i==null?void 0:i.current)??document.body)]})}function MA(){const n=k.useRef(void 0),e=k.useCallback(t=>{n.current=t},[]);return[n,e]}function AA(n,e){var t,r;const i=((t=e.current)==null?void 0:t.getComments())??[],s=i==null?void 0:i.map(a=>a.id),o=n.map(a=>{const l=s.findIndex(c=>c===a);return l!==void 0&&l>=0?i[l]:{comments:[{author:"unknown",content:"Comment not found",deleted:!1,id:"",timeStamp:0,type:"comment"}],id:a,quote:"",type:"thread"}});i.forEach(a=>{n.includes(a.id)||o.push(a)}),o&&((r=e.current)==null||r.setComments(o))}function OA(n,e){k.useEffect(()=>{var t;n.options??(n.options={}),(t=n.options).nodes??(t.nodes={}),n.options.nodes.addMissingComments=r=>{AA(r,e)}},[e,n])}k.forwardRef(function(n,e){const t=k.useRef(null),r=k.useRef(!0),i=k.useRef(null),[s,o]=k.useState(null),{children:a,onCommentChange:l,onUsjChange:c,showCommentsContainerRef:u,...f}=n,{options:{isReadonly:d}={}}=n,[h,p]=MA();OA(f,h),k.useImperativeHandle(e,()=>({focus(){var b;(b=t.current)==null||b.focus()},undo(){var b;(b=t.current)==null||b.undo()},redo(){var b;(b=t.current)==null||b.redo()},cut(){var b;(b=t.current)==null||b.cut()},copy(){var b;(b=t.current)==null||b.copy()},paste(){var b;(b=t.current)==null||b.paste()},pastePlainText(){var b;(b=t.current)==null||b.pastePlainText()},getUsj(){var b;return(b=t.current)==null?void 0:b.getUsj()},setUsj(b){var _;(_=t.current)==null||_.setUsj(b)},applyUpdate(b,_){var w;(w=t.current)==null||w.applyUpdate(b,_)},replaceEmbedUpdate(b,_){var w;return(w=t.current)==null?void 0:w.replaceEmbedUpdate(b,_)},getSelection(){var b;return(b=t.current)==null?void 0:b.getSelection()},setSelection(b){var _;(_=t.current)==null||_.setSelection(b)},addAnnotation(b,_,w){var T;(T=t.current)==null||T.addAnnotation(b,_,w)},removeAnnotation(b,_){var w;(w=t.current)==null||w.removeAnnotation(b,_)},formatPara(b){var _;(_=t.current)==null||_.formatPara(b)},getElementByKey(b){var _;return(_=t.current)==null?void 0:_.getElementByKey(b)},insertNote(b,_,w){var T;(T=t.current)==null||T.insertNote(b,_,w)},selectNote(b){var _;(_=t.current)==null||_.selectNote(b)},getNoteOps(b){var _;return(_=t.current)==null?void 0:_.getNoteOps(b)},setComments(b){var _;(_=h.current)==null||_.setComments(b),r.current=!0},get toolbarEndRef(){return s}}));const m=k.useCallback((b,_,w,T)=>{var I;if(!c)return;const M=(I=h.current)==null?void 0:I.getComments();c(b,M,_,w,T)},[h,c]),y=k.useCallback(()=>{var b;if(!l||r.current){r.current=!1;return}const _=(b=h.current)==null?void 0:b.getComments();l(_)},[h,r,l]);return k.useEffect(()=>{var b;return o(((b=t.current)==null?void 0:b.toolbarEndRef)??null),()=>o(null)},[]),S.jsxs(Nv,{ref:t,onUsjChange:m,...f,children:[S.jsx(NA,{setCommentStore:p,onChange:y,showCommentsContainerRef:d?null:u??s,commentContainerRef:i,logger:f.logger}),S.jsx("div",{ref:i,className:"comment-container"})]})});const zf=k.memo(function({viewMode:e,description:t,children:r}){const i=e==="story",s=k.useMemo(()=>!i||typeof t!="string"||!t.trim()?null:S.jsxs(Xv,{className:"tw-w-full",children:[S.jsx(Qv,{className:"tw-pb-2",children:S.jsx(Zv,{className:"tw-text-sm tw-font-medium tw-text-muted-foreground",children:"Story Description"})}),S.jsx(ek,{className:"tw-pt-2",children:S.jsx(Yv,{className:"tw-prose-sm tw-max-w-none tw-text-muted-foreground",markdown:t})})]}),[t,i]);return S.jsxs("div",{style:{display:"grid",gap:8},children:[r,s]})});zf.__docgenInfo={description:"",methods:[],displayName:"CanvasWithDescription",props:{viewMode:{required:!1,tsType:{name:"string"},description:""},description:{required:!1,tsType:{name:"string"},description:""},children:{required:!0,tsType:{name:"ReactNode"},description:""}}};const yd={m:"m - Paragraph - Margin - No First Line Indent",ms:"ms - Heading - Major Section Level 1",nb:"nb - Paragraph - No Break with Previous Paragraph",p:"p - Paragraph - Normal - First Line Indent",pi:"pi - Paragraph - Indented - Level 1 - First Line Indent",q1:"q1 - Poetry - Indent Level 1",q2:"q2 - Poetry - Indent Level 2",r:"r - Heading - Parallel References",s:"s - Heading - Section Level 1"},Hp={...yd,ide:"ide - File - Encoding",h:"h - File - Header",h1:"h1 - File - Header",h2:"h2 - File - Left Header",h3:"h3 - File - Right Header",toc1:"toc1 - File - Long Table of Contents Text",toc2:"toc2 - File - Short Table of Contents Text",toc3:"toc3 - File - Book Abbreviation",cl:"cl - Chapter - Publishing Label",mt:"mt - Title - Major Title Level 1",mt1:"mt1 - Title - Major Title Level 1",mt2:"mt2 - Title - Major Title Level 2",mt3:"mt3 - Title - Major Title Level 3",mt4:"mt4 - Title - Major Title Level 4",ms1:"ms1 - Heading - Major Section Level 1",ms2:"ms2 - Heading - Major Section Level 2",ms3:"ms3 - Heading - Major Section Level 3",b:"b - Poetry - Stanza Break (Blank Line)"},Jp={m:Qo,ms:wi,nb:Qo,p:Qo,pi:Qo,q1:Rc,q2:Rc,r:wi,s:wi,ide:Tn,h:Tn,h1:Tn,h2:Tn,h3:Tn,toc1:Tn,toc2:Tn,toc3:Tn,cl:Tn,mt:wi,mt1:wi,mt2:Kf,mt3:Ic,mt4:Ic,ms1:wi,ms2:Kf,ms3:Ic,b:Rc};function Vp({blockMarker:n,className:e}){const t=n&&n in Jp?Jp[n]:mk;return S.jsx(t,{className:e,size:16})}function Dv({editorRef:n,blockMarker:e}){return S.jsxs(rk,{children:[S.jsx(ik,{asChild:!0,children:S.jsxs(In,{variant:"outline",className:"","aria-label":"Formatting options for block type",children:[S.jsx(Vp,{blockMarker:e,className:"tw-me-2"}),$A(e),S.jsx(ak,{className:"tw-ms-2"})]})}),S.jsx(sk,{children:Object.keys(yd).map(t=>S.jsxs(ok,{className:`item block-marker ${PA(e===t)}`,onClick:()=>{var r;return(r=n.current)==null?void 0:r.formatPara(t)},children:[S.jsx(Vp,{blockMarker:t,className:"tw-me-2"}),S.jsx("span",{className:`text usfm_${t}`,children:yd[t]})]},t))})]})}function $A(n){return n&&n in Hp?Hp[n]:"No Style"}function PA(n){return n?"active dropdown-item-active":""}Dv.__docgenInfo={description:"",methods:[],displayName:"BlockFormatDropDown",props:{editorRef:{required:!0,tsType:{name:"MutableRefObject",elements:[{name:"union",raw:"EditorRef | null",elements:[{name:"EditorRef"},{name:"null"}]}],raw:"MutableRefObject<EditorRef | null>"},description:""},blockMarker:{required:!0,tsType:{name:"union",raw:"string | undefined",elements:[{name:"string"},{name:"undefined"}]},description:""}}};const IA={columns:{"platformScriptureEditor.edit":{label:"Edit",order:1},"platformScriptureEditor.insert":{label:"Insert",order:2}},groups:{"platformScriptureEditor.clipboard":{column:"platformScriptureEditor.edit",order:1},"platformScriptureEditor.insertNote":{column:"platformScriptureEditor.insert",order:1}},items:[{label:"Insert footnote",group:"platformScriptureEditor.insertNote",order:1,command:"platformScriptureEditor.insertFootnoteAtSelection",localizeNotes:""},{label:"Insert cross-reference",group:"platformScriptureEditor.insertNote",order:2,command:"platformScriptureEditor.insertCrossReferenceAtSelection",localizeNotes:""},{label:"Insert endnote",group:"platformScriptureEditor.insertNote",order:3,command:"platformScriptureEditor.insertEndnoteAtSelection",localizeNotes:""},{label:"Cut",group:"platformScriptureEditor.clipboard",order:1,command:"platformScriptureEditor.cut",localizeNotes:""},{label:"Copy",group:"platformScriptureEditor.clipboard",order:2,command:"platformScriptureEditor.copy",localizeNotes:""},{label:"Paste",group:"platformScriptureEditor.clipboard",order:3,command:"platformScriptureEditor.paste",localizeNotes:""},{label:"Paste as plain text",group:"platformScriptureEditor.clipboard",order:4,command:"platformScriptureEditor.pastePlainText",localizeNotes:""}]};function Lv({editorRef:n,scrRef:e,onScrRefChange:t,isReadonly:r=!1,canUndo:i=!1,canRedo:s=!1,blockMarker:o}){const a=()=>{var d;(d=n.current)==null||d.insertNote("f")},l=()=>{var d;(d=n.current)==null||d.insertNote("x")},c=()=>{var d;(d=n.current)==null||d.insertNote("fe")},u=d=>{var h,p,m,y;switch(d.command){case"platformScriptureEditor.insertFootnoteAtSelection":a();break;case"platformScriptureEditor.insertCrossReferenceAtSelection":l();break;case"platformScriptureEditor.insertEndnoteAtSelection":c();break;case"platformScriptureEditor.cut":(h=n.current)==null||h.cut();break;case"platformScriptureEditor.copy":(p=n.current)==null||p.copy();break;case"platformScriptureEditor.paste":(m=n.current)==null||m.paste();break;case"platformScriptureEditor.pastePlainText":(y=n.current)==null||y.pastePlainText();break;default:throw new Error(`Unknown onSelectProjectMenuItem command: ${d.command}`)}},f=()=>{};return S.jsx(nk,{onSelectProjectMenuItem:u,onSelectViewInfoMenuItem:f,projectMenuData:IA,className:"toolbar",startAreaChildren:S.jsxs(S.Fragment,{children:[S.jsx("div",{className:"tw-flex tw-h-full tw-items-center",children:S.jsx(tk,{scrRef:e,handleSubmit:t})}),!r&&S.jsxs(S.Fragment,{children:[S.jsx(In,{"aria-label":"Undo",title:"Undo",variant:"ghost",size:"icon",onClick:()=>{var d;return(d=n.current)==null?void 0:d.undo()},disabled:!i,children:S.jsx(Ak,{})}),S.jsx(In,{"aria-label":"Redo",title:"Redo",variant:"ghost",size:"icon",onClick:()=>{var d;return(d=n.current)==null?void 0:d.redo()},disabled:!s,children:S.jsx(xk,{})}),S.jsx(Dv,{editorRef:n,blockMarker:o}),S.jsx(In,{"aria-label":"Insert footnote",title:"Insert footnote",variant:"ghost",size:"icon",onClick:a,children:S.jsx(Ek,{})}),S.jsx(In,{"aria-label":"Insert cross-reference",title:"Insert cross-reference",variant:"ghost",size:"icon",onClick:l,children:S.jsx(Sk,{})}),S.jsx(In,{"aria-label":"Insert endnote",title:"Insert endnote",variant:"ghost",size:"icon",onClick:c,children:S.jsx(kk,{})})]})]})})}Lv.__docgenInfo={description:"",methods:[],displayName:"PlatformToolbar",props:{editorRef:{required:!0,tsType:{name:"RefObject",elements:[{name:"union",raw:"MarginalRef | EditorRef | null",elements:[{name:"MarginalRef"},{name:"EditorRef"},{name:"null"}]}],raw:"RefObject<MarginalRef | EditorRef | null>"},description:""},scrRef:{required:!0,tsType:{name:"SerializedVerseRef"},description:""},onScrRefChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(scrRef: SerializedVerseRef) => void",signature:{arguments:[{type:{name:"SerializedVerseRef"},name:"scrRef"}],return:{name:"void"}}},description:""},isReadonly:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},canUndo:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},canRedo:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},blockMarker:{required:!1,tsType:{name:"string"},description:""}}};function ui(n,e,t){var d,h,p,m;const r=k.useRef(null),[i,s]=k.useState(t),[o,a]=k.useState(!1),[l,c]=k.useState(!1),[u,f]=k.useState();return S.jsxs(zf,{viewMode:e.viewMode,description:((p=(h=(d=e.parameters)==null?void 0:d.docs)==null?void 0:h.description)==null?void 0:p.story)??((m=e.parameters)==null?void 0:m.description),children:[S.jsx(Lv,{editorRef:r,scrRef:i,onScrRefChange:s,isReadonly:!1,canUndo:o,canRedo:l,blockMarker:u}),S.jsx(ds,{...n,ref:r,scrRef:i,onScrRefChange:s,onStateChange:(y,b,_)=>{a(y),c(b),f(_)}})]})}ui.__docgenInfo={description:`Render function that combines the Editorial component with a PlatformToolbar. This provides a
complete editing experience with undo/redo, navigation, and other toolbar features.

Use this as a render function in a Storybook story, not as a component.`,methods:[],displayName:"renderEditorialWithToolbar"};const RA='<usx version="3.1" />',DA=bd(RA),LA=`<?xml version="1.0" encoding="utf-8"?>
<usx version="3.1">
  <book code="PSA" style="id">World English Bible (WEB)</book>
  <para style="mt1">The Psalms</para>
  <chapter number="1" style="c" sid="PSA 1" />
  <para style="q1">
    <verse number="1" style="v" sid="PSA 1:1" />Blessed is the man who doesn’t walk in the counsel of the wicked<note caller="+" style="f"><char style="fr">1:1 </char><char style="ft">Or "sinful"</char></note>,</para>
  <para style="q2" vid="PSA 1:1">nor stand on the path<note caller="+" style="f"><char style="fr">1:1 </char><char style="ft">Hebrew: "way"</char></note> of sinners,</para>
  <para style="q2" vid="PSA 1:1">nor sit in the seat of scoffers;<verse eid="PSA 1:1" /></para>
  <para style="q1">
    <verse number="2" style="v" sid="PSA 1:2" /><note caller="+" style="f"><char style="fr" closed="false">1:2 </char><char style="ft" closed="false">After verse</char></note> but his delight is in Yahweh’s<note caller="+" style="f"><char style="fr" closed="false">1:2 </char><char style="ft" closed="false">“Yahweh” is God’s proper Name, sometimes rendered “LORD” (all caps) in other translations.</char></note> law.<note caller="+" style="f"><char style="fr" closed="false">1:2 </char><char style="ft" closed="false">End of Para</char></note></para>
  <para style="q2" vid="PSA 1:2">On his law he meditates day and night.<note caller="+" style="f"><char style="fr" closed="false">1:2 </char><char style="ft" closed="false">End of Doc</char></note><verse eid="PSA 1:2" /></para>
</usx>
`,kn=bd(LA),jA={start:{jsonPath:"$.content[3].content[1]",offset:15},end:{jsonPath:"$.content[3].content[1]",offset:18}},FA={start:{jsonPath:"$.content[3].content[1]",offset:15},end:{jsonPath:"$.content[3].content[1]",offset:22}},qA=`<?xml version="1.0" encoding="utf-8"?>
<usx version="3.1">
  <book code="PSA" style="id">תהילים</book>
  <para style="mt1">תהילים</para>
  <chapter number="1" style="c" sid="PSA 1" />
  <para style="q1">
    <verse number="1" style="v" sid="PSA 1:1" />אשרי האיש אשר לא הלך בעצת רשעים,</para>
  <para style="q2" vid="PSA 1:1">ובדרך חטאים לא עמד,</para>
  <para style="q2" vid="PSA 1:1">ובמושב לצים לא ישב.<verse eid="PSA 1:1" /></para>
  <para style="q1">
    <verse number="2" style="v" sid="PSA 1:2" />כי אם בתורת יהוה חפצו,</para>
  <para style="q2" vid="PSA 1:2">ובתורתו יהגה יומם ולילה.<verse eid="PSA 1:2" /></para>
</usx>
`,BA=bd(qA);function jv({noteOps:n,onSave:e,onClose:t,scrRef:r,noteKey:i,viewOptions:s}){const o=k.useRef(null),a=k.createRef(),l=k.useMemo(()=>({isReadonly:!1,hasSpellCheck:!1,hasExternalUI:!0,textDirection:"auto",nodes:{noteCallerOnClick:(f,d,h,p,m)=>{h||(p()===zn?m(Kl):m(zn))}},view:{...s,noteMode:"expanded"}}),[s]);k.useEffect(()=>{var d,h;let f;return n&&!((h=(d=o.current)==null?void 0:d.getUsj())!=null&&h.content)&&(f=setTimeout(()=>{var p,m;(p=o.current)==null||p.setUsj(_d),(m=o.current)==null||m.applyUpdate(n)},0)),()=>{f&&clearTimeout(f)}},[n,i]);const c=()=>{var d;const f=(d=o.current)==null?void 0:d.getNoteOps(0);f&&e(f)},u=()=>{var d;const f=(d=a.current)==null?void 0:d.getElementsByClassName("editor-input")[0];f!=null&&f.textContent&&navigator.clipboard.writeText(f.textContent)};return S.jsxs("div",{className:"footnote-editor tw-grid tw-gap-[12px]",children:[S.jsxs("div",{className:"tw-flex tw-w-full tw-justify-end tw-gap-4",children:[S.jsx(In,{onClick:t,className:"tw-h-6 tw-w-6",size:"icon",variant:"secondary",children:S.jsx(lk,{})}),S.jsx(In,{onClick:c,className:"tw-h-6 tw-w-6",size:"icon",variant:"default",children:S.jsx(ck,{})})]}),S.jsxs("div",{ref:a,className:"tw-relative tw-rounded-[6px] tw-border-2 tw-border-ring",children:[S.jsx(ds,{options:l,onScrRefChange:()=>{},scrRef:r,ref:o}),S.jsx("div",{className:"tw-absolute tw-bottom-0 tw-right-0",children:S.jsx(In,{onClick:u,className:"tw-h-6 tw-w-6",variant:"ghost",size:"icon",children:S.jsx(uk,{})})})]})]})}jv.__docgenInfo={description:`Component to edit footnotes from within the editor component

@param usj The raw usj of the footnote to edit
@param parentRef The ref of the parent editor component
@returns`,methods:[],displayName:"FootnoteEditor",props:{noteOps:{required:!0,tsType:{name:"union",raw:"DeltaOp[] | undefined",elements:[{name:"Array",elements:[{name:"DeltaOp"}],raw:"DeltaOp[]"},{name:"undefined"}]},description:"Delta ops for the current note being edited that are applied to the note editorial"},onSave:{required:!0,tsType:{name:"signature",type:"function",raw:"(noteOps: DeltaOp[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"DeltaOp"}],raw:"DeltaOp[]"},name:"noteOps"}],return:{name:"void"}}},description:"External function to handle saving changes to the footnote"},onClose:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:`External function to handle closing the footnote editor. Gets called when the editor is closed
without saving changes`},scrRef:{required:!0,tsType:{name:"SerializedVerseRef"},description:"The scripture reference for the parent editor"},noteKey:{required:!0,tsType:{name:"union",raw:"string | undefined",elements:[{name:"string"},{name:"undefined"}]},description:"The unique note key to identify the note being edited used to apply changes to the note"},viewOptions:{required:!0,tsType:{name:"ViewOptions"},description:"View options of the parent editor"}}};const Et={book:"PSA",chapterNum:1,verseNum:1},t$={title:"Demo/Editorial",component:ds,tags:["autodocs"],parameters:{docs:{description:{component:`
**Demo Only:** This component is provided for demonstration purposes only. For production applications, developers should import the Scripture Editor component directly from:
- npm [@eten-tech-foundation/platform-editor](https://www.npmjs.com/package/@eten-tech-foundation/platform-editor)
- github [eten-tech-foundation/platform-editor](https://github.com/eten-tech-foundation/scripture-editors/tree/main/packages/platform)

This demo version is included in Storybook to showcase the component's functionality and usage patterns.

**Known Limitation:** In the Docs view, all story examples may show the same note caller style due to global state management in the editor component. To see the correct note caller behavior for each story (default lowercase letters vs custom symbols), please view the individual stories in the Canvas view instead of the Docs view.
        `}}},argTypes:{ref:{control:"object",description:"Reference to the editor instance",defaultValue:null},defaultUsj:{control:"object",description:"Default USJ object to initialize the editor with",defaultValue:{type:Hs,version:Js,content:[""]}},scrRef:{control:"object",description:"Scripture reference",defaultValue:Et},options:{control:"object",description:"Options to configure the editor (EditorOptions)",defaultValue:{},table:{type:{summary:"EditorOptions",detail:'{ isReadonly?: boolean; hasSpellCheck?: boolean; textDirection?: "ltr" | "rtl" | "auto"; markerMenuTrigger?: string; nodes?: UsjNodeOptions; }'}}}}},_a={args:{defaultUsj:kn,scrRef:Et}},ba={args:{defaultUsj:DA,scrRef:Et}},va={args:{defaultUsj:kn,scrRef:Et,options:{isReadonly:!0}}},ka={render:(n,e)=>ui(n,e,Et),parameters:{docs:{description:{story:'Right-to-left example using a Hebrew snippet (Psalm 1:1). The editor is set to RTL via _options.textDirection = "rtl"_. If you want the UI (tab toolbar) to be RTL click **Switch direction** in the Storybook toolbar.'}}},args:{defaultUsj:BA,options:{hasExternalUI:!0,textDirection:"rtl"}}},wa={render:n=>{const e=k.useRef(null);return k.useEffect(()=>{const t=setTimeout(()=>{e.current&&(e.current.addAnnotation(jA,"spelling","annotationId"),e.current.addAnnotation(FA,"grammar","abc123"))},0);return()=>clearTimeout(t)},[]),S.jsx(ds,{...n,ref:e})},args:{defaultUsj:kn,scrRef:Et}},UA={hasExternalUI:!0,view:{...$o(),noteMode:"expandInline"},nodes:{noteCallerOnClick:(n,e,t,r,i)=>{t||(r()===zn?i(Kl):i(zn))}}},xa={render:(n,e)=>ui(n,e,Et),parameters:{docs:{description:{story:"This story demonstrates editing notes inline. Move your cursor to a note caller and the note will expand and can be edited. Move the cursor out of the note and it will collapse. Click the expanded note caller to toggle between the auto-generated caller and the hidden caller."}}},args:{defaultUsj:kn,options:UA}},zA={hasExternalUI:!0,view:{...$o(),noteMode:"expandInline"}},Ca={render:(n,e)=>ui(n,e,Et),parameters:{docs:{description:{story:'This story demonstrates inserting notes. Use the Project menu (hamburger) or the toolbar buttons above the editor to insert footnotes, cross-references, and endnotes at the current cursor position. Selecting text before inserting a footnote will use that text as the footnote quote. You can also insert by typing "\\f", "\\x", or "\\fe".'}}},args:{defaultUsj:kn,options:zA}},WA={hasExternalUI:!0,nodes:{noteCallers:["①","②","③","④","⑤","⑥","⑦","⑧","⑨","⑩"],noteCallerOnClick:(n,e,t,r,i,s)=>{console.log("Note caller clicked:",n,e,t,r,i,s),alert("Note caller clicked! Check console for details.")}}},Sa={render:(n,e)=>ui(n,e,Et),parameters:{docs:{description:{story:"This story demonstrates custom note callers and click handling. **Try clicking on the circled number footnote markers (① ②) in the text to see the click handler in action!** The click event will show an alert and log details to the browser console."}}},args:{defaultUsj:kn,options:WA}},Ta={render:(n,e)=>ui(n,e,Et),parameters:{docs:{description:{story:'This story demonstrates using a custom marker menu trigger key. **Try typing "?" (question mark) anywhere in the editor text to open the marker menu!** The default trigger is "\\\\" (backslash), but this story changes it to "?" for demonstration. The marker menu allows you to insert USFM markers into the text.'}}},args:{defaultUsj:kn,options:{hasExternalUI:!0,markerMenuTrigger:"?"}}},Ea={render:n=>{const e=k.useRef(null),[t,r]=k.useState(),[i,s]=k.useState(),[o,a]=k.useState(),[l,c]=k.useState(),[u,f]=k.useState(),[d,h]=k.useState(),p=k.useMemo(()=>({markerMode:"hidden",hasSpacing:!0,isFormattedFont:!0}),[]),m=k.useMemo(()=>({...n.options??{},nodes:{noteCallerOnClick:(w,T,I,M,D,A)=>{const O=w.currentTarget.getBoundingClientRect();if(a(O.left),c(O.top),f(O.height),I){if(t)return;r(T),s(A()),h(!0)}}},view:p}),[n.options,p,t]),y=()=>{r(void 0),s(void 0),h(!1)},b=_=>{var w;t&&((w=e.current)==null||w.replaceEmbedUpdate(t,_)),y()};return S.jsxs("div",{children:[S.jsx(ds,{...n,options:m,ref:e,onScrRefChange:()=>{}}),S.jsxs(dk,{open:d,children:[S.jsx(fk,{className:"tw-absolute",style:{top:l??0,left:o??0,height:u,width:0}}),S.jsx(hk,{className:"tw-w-96 tw-p-[10px]",children:S.jsx(jv,{noteKey:t,noteOps:i,onSave:b,onClose:y,scrRef:n.scrRef??Et,viewOptions:p})})]})]})},parameters:{docs:{description:{story:"This story demonstrates the use of the new footnote editor on the side of the  editorial component"}}},args:{defaultUsj:kn,scrRef:Et,options:{hasExternalUI:!1}}},Na={render:(n,e)=>{var c,u,f,d;const t=k.useRef(null),[r,i]=k.useState(null),[s,o]=k.useState(!1),a=k.useMemo(()=>({...n.options??{},view:{markerMode:s?"visible":"hidden",hasSpacing:!0,isFormattedFont:!0}}),[n.options,s]);k.useEffect(()=>{var p,m;const h=(m=(p=t.current)==null?void 0:p.toolbarEndRef)==null?void 0:m.current;if(h)i(h);else{const y=window.setTimeout(()=>{var _,w;const b=(w=(_=t.current)==null?void 0:_.toolbarEndRef)==null?void 0:w.current;b&&i(b)},0);return()=>window.clearTimeout(y)}},[a]);const l=k.useCallback(()=>o(h=>!h),[]);return S.jsxs(zf,{viewMode:e.viewMode,description:((f=(u=(c=e.parameters)==null?void 0:c.docs)==null?void 0:u.description)==null?void 0:f.story)??((d=e.parameters)==null?void 0:d.description),children:[S.jsx(ds,{...n,options:a,ref:t}),r&&At.createPortal(S.jsx("button",{type:"button",title:"Show/hide markers","aria-label":"Show/hide markers","aria-pressed":s,className:`toolbar-item ${s?"active":""}`,onClick:l,children:S.jsx("span",{className:"icon pilcrow-icon","aria-hidden":"true",children:"¶"})}),r)]})},parameters:{docs:{description:{story:"This story demonstrates the Markers view, which shows USFM markers inline with the text. Click the **Show/hide markers** (¶) button in the editor toolbar to toggle the Markers view on and off. "}}},args:{defaultUsj:kn,scrRef:Et}},Ma={name:"View Options",render:(n,e)=>ui(n,e,Et),parameters:{docs:{description:{story:'Demonstrates the editor view options (marker visibility, spacing, and formatted font) using USX input. Below in the **Controls** tab, try changing the **options.view** values to see how they affect the editor display. Valid values for **markerMode** are _"hidden"_, _"visible"_, and _"editable"_. Valid values for **noteMode** are _"collapsed"_, _"expandInline"_, and _"expanded"_.'}}},args:{defaultUsj:kn,options:{hasExternalUI:!0,view:{markerMode:"hidden",noteMode:"collapsed",hasSpacing:!0,isFormattedFont:!0}}}};var Gp,Yp,Xp;_a.parameters={..._a.parameters,docs:{...(Gp=_a.parameters)==null?void 0:Gp.docs,source:{originalSource:`{
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef
  }
}`,...(Xp=(Yp=_a.parameters)==null?void 0:Yp.docs)==null?void 0:Xp.source}}};var Qp,Zp,em;ba.parameters={...ba.parameters,docs:{...(Qp=ba.parameters)==null?void 0:Qp.docs,source:{originalSource:`{
  args: {
    defaultUsj: usjEmpty,
    scrRef: defaultScrRef
  }
}`,...(em=(Zp=ba.parameters)==null?void 0:Zp.docs)==null?void 0:em.source}}};var tm,nm,rm;va.parameters={...va.parameters,docs:{...(tm=va.parameters)==null?void 0:tm.docs,source:{originalSource:`{
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef,
    options: {
      isReadonly: true
    }
  }
}`,...(rm=(nm=va.parameters)==null?void 0:nm.docs)==null?void 0:rm.source}}};var im,sm,om;ka.parameters={...ka.parameters,docs:{...(im=ka.parameters)==null?void 0:im.docs,source:{originalSource:`{
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'Right-to-left example using a Hebrew snippet (Psalm 1:1). ' + 'The editor is set to RTL via _options.textDirection = "rtl"_. If you want the UI ' + '(tab toolbar) to be RTL click **Switch direction** in the Storybook toolbar.'
      }
    }
  },
  args: {
    defaultUsj: usjHebrew,
    options: {
      hasExternalUI: true,
      textDirection: 'rtl'
    }
  }
}`,...(om=(sm=ka.parameters)==null?void 0:sm.docs)==null?void 0:om.source}}};var am,lm,cm;wa.parameters={...wa.parameters,docs:{...(am=wa.parameters)==null?void 0:am.docs,source:{originalSource:`{
  render: args => {
    // eslint-disable-next-line no-null/no-null
    const editorRef = useRef<EditorRef | null>(null);
    useEffect(() => {
      const timeoutId = setTimeout(() => {
        if (editorRef.current) {
          editorRef.current.addAnnotation(annotationRangeWeb1, 'spelling', 'annotationId');
          editorRef.current.addAnnotation(annotationRangeWeb2, 'grammar', 'abc123');
        }
      }, 0);
      return () => clearTimeout(timeoutId);
    }, []);
    return <Editorial {...args} ref={editorRef} />;
  },
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef
  }
}`,...(cm=(lm=wa.parameters)==null?void 0:lm.docs)==null?void 0:cm.source}}};var um,dm,fm;xa.parameters={...xa.parameters,docs:{...(um=xa.parameters)==null?void 0:um.docs,source:{originalSource:`{
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates editing notes inline. Move your cursor to a note caller and ' + 'the note will expand and can be edited. Move the cursor out of the note and it will ' + 'collapse. Click the expanded note caller to toggle between the auto-generated caller ' + 'and the hidden caller.'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    options: inlineNoteOptions
  }
}`,...(fm=(dm=xa.parameters)==null?void 0:dm.docs)==null?void 0:fm.source}}};var hm,gm,pm;Ca.parameters={...Ca.parameters,docs:{...(hm=Ca.parameters)==null?void 0:hm.docs,source:{originalSource:`{
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates inserting notes. Use the Project menu (hamburger) or the ' + 'toolbar buttons above the editor to insert footnotes, cross-references, and endnotes ' + 'at the current cursor position. Selecting text before inserting a footnote will use ' + 'that text as the footnote quote. You can also insert by typing "\\\\f", "\\\\x", or "\\\\fe".'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    options: insertNoteOptions
  }
}`,...(pm=(gm=Ca.parameters)==null?void 0:gm.docs)==null?void 0:pm.source}}};var mm,ym,_m;Sa.parameters={...Sa.parameters,docs:{...(mm=Sa.parameters)==null?void 0:mm.docs,source:{originalSource:`{
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates custom note callers and click handling. **Try clicking on the ' + 'circled number footnote markers (① ②) in the text to see the click handler in ' + 'action!** The click event will show an alert and log details to the browser console.'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    options: customNodeOptions
  }
}`,...(_m=(ym=Sa.parameters)==null?void 0:ym.docs)==null?void 0:_m.source}}};var bm,vm,km;Ta.parameters={...Ta.parameters,docs:{...(bm=Ta.parameters)==null?void 0:bm.docs,source:{originalSource:`{
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates using a custom marker menu trigger key. **Try typing "?" ' + '(question mark) anywhere in the editor text to open the marker menu!** The default ' + 'trigger is "\\\\\\\\" (backslash), but this story changes it to "?" for demonstration. ' + 'The marker menu allows you to insert USFM markers into the text.'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    options: {
      hasExternalUI: true,
      markerMenuTrigger: '?'
    }
  }
}`,...(km=(vm=Ta.parameters)==null?void 0:vm.docs)==null?void 0:km.source}}};var wm,xm,Cm;Ea.parameters={...Ea.parameters,docs:{...(wm=Ea.parameters)==null?void 0:wm.docs,source:{originalSource:`{
  render: args => {
    // eslint-disable-next-line no-null/no-null
    const editorRef = useRef<EditorRef | null>(null);
    const [noteKey, setNoteKey] = useState<string>();
    const [noteOps, setNoteOps] = useState<DeltaOp[]>();
    const [popoverX, setPopoverX] = useState<number>();
    const [popoverY, setPopoverY] = useState<number>();
    const [popoverHeight, setPopoverHeight] = useState<number>();
    const [showFootnoteEditor, setShowFootnoteEditor] = useState<boolean>();
    const viewOptions = useMemo<ViewOptions>(() => ({
      markerMode: 'hidden',
      hasSpacing: true,
      isFormattedFont: true
    }), []);
    const mergedOptions = useMemo<EditorOptions>(() => {
      const base = args.options ?? {};
      return {
        ...base,
        nodes: {
          noteCallerOnClick: (event, noteNodeKey, isCollapsed, _getCaller, _setCaller, getNoteOps) => {
            const targetRect = event.currentTarget.getBoundingClientRect();
            setPopoverX(targetRect.left);
            setPopoverY(targetRect.top);
            setPopoverHeight(targetRect.height);
            if (isCollapsed) {
              // (event as SyntheticEvent<)
              if (noteKey) return;
              setNoteKey(noteNodeKey);
              setNoteOps(getNoteOps());
              setShowFootnoteEditor(true);
            }
          }
        },
        view: viewOptions
      };
    }, [args.options, viewOptions, noteKey]);
    const onEditorClose = () => {
      setNoteKey(undefined);
      setNoteOps(undefined);
      setShowFootnoteEditor(false);
    };
    const onEditorSave = (newNoteOps: DeltaOp[]) => {
      if (noteKey) {
        editorRef.current?.replaceEmbedUpdate(noteKey, newNoteOps);
      }
      onEditorClose();
    };
    return <div>
        <Editorial {...args} options={mergedOptions} ref={editorRef} onScrRefChange={() => undefined} />
        <Popover open={showFootnoteEditor}>
          <PopoverAnchor className="tw-absolute" style={{
          top: popoverY ?? 0,
          left: popoverX ?? 0,
          height: popoverHeight,
          width: 0
        }} />
          <PopoverContent className="tw-w-96 tw-p-[10px]">
            <FootnoteEditor noteKey={noteKey} noteOps={noteOps} onSave={onEditorSave} onClose={onEditorClose} scrRef={args.scrRef ?? defaultScrRef} viewOptions={viewOptions} />
          </PopoverContent>
        </Popover>
      </div>;
  },
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates the use of the new footnote editor on the side of the ' + ' editorial component'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef,
    options: {
      hasExternalUI: false
    }
  }
}`,...(Cm=(xm=Ea.parameters)==null?void 0:xm.docs)==null?void 0:Cm.source}}};var Sm,Tm,Em;Na.parameters={...Na.parameters,docs:{...(Sm=Na.parameters)==null?void 0:Sm.docs,source:{originalSource:`{
  render: (args, context) => {
    // eslint-disable-next-line no-null/no-null
    const editorRef = useRef<EditorRef | null>(null);
    // eslint-disable-next-line no-null/no-null
    const [toolbarEndEl, setToolbarEndEl] = useState<HTMLElement | null>(null);
    const [showMarkers, setShowMarkers] = useState(false);
    const mergedOptions = useMemo(() => {
      const base = args.options ?? {};
      const view: ViewOptions = {
        markerMode: showMarkers ? 'visible' : 'hidden',
        hasSpacing: true,
        isFormattedFont: true
      };
      return {
        ...base,
        view
      };
    }, [args.options, showMarkers]);
    useEffect(() => {
      const el = editorRef.current?.toolbarEndRef?.current;
      if (el) setToolbarEndEl(el);else {
        // Retry once on next tick in case the toolbar mounts after the ref effect
        const id = window.setTimeout(() => {
          const el2 = editorRef.current?.toolbarEndRef?.current;
          if (el2) setToolbarEndEl(el2);
        }, 0);
        return () => window.clearTimeout(id);
      }
      return undefined;
    }, [mergedOptions]);
    const handleShowMarkerToggle = useCallback(() => setShowMarkers(v => !v), []);
    return <CanvasWithDescription viewMode={context.viewMode} description={context.parameters?.docs?.description?.story ?? context.parameters?.description}>
        <Editorial {...args} options={mergedOptions} ref={editorRef} />
        {toolbarEndEl && createPortal(<button type="button" title="Show/hide markers" aria-label="Show/hide markers" aria-pressed={showMarkers} className={\`toolbar-item \${showMarkers ? 'active' : ''}\`} onClick={handleShowMarkerToggle}>
              <span className="icon pilcrow-icon" aria-hidden="true">
                ¶
              </span>
            </button>, toolbarEndEl)}
      </CanvasWithDescription>;
  },
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates the Markers view, which shows USFM markers inline with the ' + 'text. Click the **Show/hide markers** (¶) button in the editor toolbar to toggle the ' + 'Markers view on and off. '
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef
  }
}`,...(Em=(Tm=Na.parameters)==null?void 0:Tm.docs)==null?void 0:Em.source}}};var Nm,Mm,Am;Ma.parameters={...Ma.parameters,docs:{...(Nm=Ma.parameters)==null?void 0:Nm.docs,source:{originalSource:`{
  name: 'View Options',
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'Demonstrates the editor view options (marker visibility, spacing, and formatted font) ' + 'using USX input. Below in the **Controls** tab, try changing the **options.view** ' + 'values to see how they affect the editor display. Valid values for **markerMode** are ' + '_"hidden"_, _"visible"_, and _"editable"_. Valid values for **noteMode** are ' + '_"collapsed"_, _"expandInline"_, and _"expanded"_.'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    options: {
      hasExternalUI: true,
      view: {
        markerMode: 'hidden',
        noteMode: 'collapsed',
        hasSpacing: true,
        isFormattedFont: true
      }
    }
  }
}`,...(Am=(Mm=Ma.parameters)==null?void 0:Mm.docs)==null?void 0:Am.source}}};const n$=["Default","Empty","ReadOnly","RTL","Annotated","InlineNoteEditing","InsertNote","CustomNoteOptions","CustomMarkerTrigger","FootnoteEditorView","MarkersView","ViewOptionsStory"];export{wa as Annotated,Ta as CustomMarkerTrigger,Sa as CustomNoteOptions,_a as Default,ba as Empty,Ea as FootnoteEditorView,xa as InlineNoteEditing,Ca as InsertNote,Na as MarkersView,ka as RTL,va as ReadOnly,Ma as ViewOptionsStory,n$ as __namedExportsOrder,t$ as default};
