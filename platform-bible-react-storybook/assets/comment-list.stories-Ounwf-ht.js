import{j as e}from"./jsx-runtime-DYH7p4H-.js";import{T as ge}from"./theme-provider.component-BDbaddjF.js";import{r as s}from"./iframe-CbiqY5rW.js";import{c as U}from"./shadcn-ui.util-DMJ19wEV.js";import{f as we,e as V,h as xe,E as z,a as O,b as ie}from"./editor-utils-BKBBrVLi.js";import{B as ye}from"./badge-BBGQbs-B.js";import{B as M}from"./button-C2rkuAJh.js";import{C as ve,d as Te}from"./card-JoaihpEA.js";import{S as Q}from"./separator-54WXl8zG.js";import{Z as be,v as H,a as Se,b as ee,F as Ie}from"./index-DY9IrCTG.js";import{A as Ne,b as Ce}from"./avatar-BlHDLH7-.js";import{c as te,D as Pe,a as ke,b as Re}from"./dropdown-menu-DHyI65Ok.js";import{c as de}from"./createLucideIcon-B-ADoEmV.js";import{T as je}from"./trash-2-DObWDntZ.js";import{X as Ae}from"./x-CiiqOtnc.js";import{A as le}from"./arrow-up-QfRI0c-P.js";import{C as Ee}from"./check-Dm2RQABL.js";import{E as De}from"./ellipsis-BkhSUltQ.js";import{C as se}from"./chevron-up-Cu_6ki70.js";import{C as ne}from"./chevron-down-DK4PpAlj.js";import"./LexicalTable.prod-rnYbWk01.js";import"./index-CPleRUKj.js";import"./index-BK-JrMtU.js";import"./tooltip-BGQp5l3w.js";import"./index-DTAXz6r9.js";import"./index-DNmw49TY.js";import"./index-Dj6FJPdz.js";import"./index-DY0kwC2E.js";import"./index-6wg4jWbT.js";import"./index-DtsCDfR_.js";import"./index-BXXCYkUS.js";import"./floating-ui.react-dom-DnheErdj.js";import"./index-ZQgpkrue.js";import"./index-CqbdS-2m.js";import"./index-DCRGPiUG.js";import"./index-DgkjGXyq.js";import"./index-DizF63-q.js";import"./index-CQbuKnQA.js";import"./dialog-BaIhpAHt.js";import"./index-Czfav6j7.js";import"./index-B5JnW5zy.js";import"./toggle-group-0dzfGp5z.js";import"./index-BhlYrLLh.js";import"./index-BzuZXtl-.js";import"./index-j2SrRYGk.js";import"./index-BPbCuWFR.js";import"./underline-CBCq1ZEc.js";import"./index-D2w9gCAG.js";import"./index-5PMepb-4.js";import"./index-SYbHJGR0.js";import"./index-MibOODGh.js";import"./index-DSyjLlnY.js";import"./circle-C4w27o9h.js";import"./chevron-right-DqgQ5dL0.js";const _e=["input","select","textarea","button"],Oe=["button","textbox"],We=({options:r,onFocusChange:g,onOptionSelect:h,onCharacterPress:x})=>{const T=s.useRef(null),[b,R]=s.useState(void 0),[m,u]=s.useState(void 0),a=s.useCallback(t=>{R(t);const l=r.find(v=>v.id===t);l&&(g==null||g(l));const p=document.getElementById(t);p&&(p.scrollIntoView({block:"center"}),p.focus()),T.current&&T.current.setAttribute("aria-activedescendant",t)},[g,r]),f=s.useCallback(t=>{const l=r.find(p=>p.id===t);l&&(u(p=>p===t?void 0:t),h==null||h(l))},[h,r]),w=t=>{if(!t)return!1;const l=t.tagName.toLowerCase();if(t.isContentEditable||_e.includes(l))return!0;const p=t.getAttribute("role");if(p&&Oe.includes(p))return!0;const v=t.getAttribute("tabindex");return v!==void 0&&v!=="-1"},o=s.useCallback(t=>{var N;const l=t.target,p=d=>d?document.getElementById(d):void 0,v=p(m),W=p(b);if(!!(v&&l&&v.contains(l)&&l!==v)&&w(l)){if(t.key==="Escape"||t.key==="ArrowLeft"&&!l.isContentEditable){if(m){t.preventDefault(),t.stopPropagation();const d=r.find(C=>C.id===m);d&&a(d.id)}return}if(t.key==="ArrowDown"||t.key==="ArrowUp"){if(!v)return;const d=Array.from(v.querySelectorAll('button:not([disabled]), input:not([disabled]):not([type="hidden"]), textarea:not([disabled]), select:not([disabled]), [href], [tabindex]:not([tabindex="-1"])'));if(d.length===0)return;const C=d.findIndex(P=>P===l);if(C===-1)return;let I;t.key==="ArrowDown"?I=Math.min(C+1,d.length-1):I=Math.max(C-1,0),I!==C&&(t.preventDefault(),t.stopPropagation(),(N=d[I])==null||N.focus());return}return}const D=r.findIndex(d=>d.id===b);let A=D;switch(t.key){case"ArrowDown":A=Math.min(D+1,r.length-1),t.preventDefault();break;case"ArrowUp":A=Math.max(D-1,0),t.preventDefault();break;case"Home":A=0,t.preventDefault();break;case"End":A=r.length-1,t.preventDefault();break;case" ":case"Enter":b&&f(b),t.preventDefault(),t.stopPropagation();return;case"ArrowRight":{const d=W;if(d){const C=d.querySelector('input:not([disabled]):not([type="hidden"]), textarea:not([disabled]), select:not([disabled])'),I=d.querySelector('button:not([disabled]), [href], [tabindex]:not([tabindex="-1"]), [contenteditable="true"]'),P=C??I;if(P){t.preventDefault(),P.focus();return}}break}default:t.key.length===1&&!t.metaKey&&!t.ctrlKey&&!t.altKey&&(w(l)||(x==null||x(t.key),t.preventDefault()));return}const i=r[A];i&&a(i.id)},[r,a,b,m,f,x]);return{listboxRef:T,activeId:b,selectedId:m,handleKeyDown:o,focusOption:a}};/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-4 8",key:"7n84p3"}]],Me=de("AtSign",qe);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],Be=de("Pencil",Ue);function F({comment:r,isReply:g=!1,isEditable:h=!1,localizedStrings:x,isThreadExpanded:T=!1,threadStatus:b="Unspecified",handleResolveCommentThread:R,handleUpdateComment:m,handleDeleteComment:u,onEditingChange:a}){const[f,w]=s.useState(!1),[o,t]=s.useState(),l=s.useRef(null);s.useEffect(()=>{if(!f)return;let i=!0;const N=l.current;if(!N)return;const d=setTimeout(()=>{i&&we(N)},300);return()=>{i=!1,clearTimeout(d)}},[f]);const p=s.useCallback(()=>{w(!1),t(void 0),a==null||a(!1)},[a]),v=s.useCallback(async()=>{if(!o||!m)return;await m(r.id,V(o))&&(w(!1),t(void 0),a==null||a(!1))},[o,m,r.id,a]),W=s.useMemo(()=>{const i=new Date(r.date),N=be(i,x["%comment_date_today%"],x["%comment_date_yesterday%"]),d=i.toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit"});return H(x["%comment_dateAtTime%"],{date:N,time:d})},[r.date,x]),c=s.useMemo(()=>r.user,[r.user]),j=s.useMemo(()=>r.user.split(" ").map(i=>i[0]).join("").toUpperCase().slice(0,2),[r.user]),D=s.useMemo(()=>Se(ee(r.contents)),[r.contents]),A=s.useMemo(()=>{if(T&&h)return e.jsxs(e.Fragment,{children:[!Ie(r.contents)&&e.jsxs(te,{onClick:()=>{w(!0),t(xe(ee(r.contents))),a==null||a(!0)},children:[e.jsx(Be,{className:"tw-me-2 tw-h-4 tw-w-4"}),x["%comment_editComment%"]]}),e.jsxs(te,{onClick:async()=>{u&&await u(r.id)},children:[e.jsx(je,{className:"tw-me-2 tw-h-4 tw-w-4"}),x["%comment_deleteComment%"]]})]})},[h,T,x,r.contents,r.id,u,a]);return e.jsxs("div",{className:U("tw-flex tw-w-full tw-flex-row tw-items-baseline tw-gap-3 tw-space-y-3",{"tw-text-sm":g}),children:[e.jsx(Ne,{className:"tw-h-8 tw-w-8",children:e.jsx(Ce,{className:"tw-text-xs tw-font-medium",children:j})}),e.jsxs("div",{className:"tw-flex tw-flex-1 tw-flex-col tw-gap-2",children:[e.jsxs("div",{className:"tw-flex tw-flex-row tw-flex-wrap tw-items-baseline tw-gap-x-2",children:[e.jsx("p",{className:"tw-text-sm tw-font-medium",children:c}),e.jsx("p",{className:"tw-text-xs tw-font-normal tw-text-muted-foreground",children:W})]}),f&&e.jsxs("div",{role:"textbox",tabIndex:-1,className:"tw-flex tw-flex-col tw-gap-2",ref:l,onKeyDownCapture:i=>{i.key==="Escape"?(i.preventDefault(),i.stopPropagation(),p()):i.key==="Enter"&&i.shiftKey&&(i.preventDefault(),i.stopPropagation(),O(o)&&v())},onKeyDown:i=>{ie(i),(i.key==="Enter"||i.key===" ")&&i.stopPropagation()},children:[e.jsx(z,{editorSerializedState:o,onSerializedChange:i=>t(i)}),e.jsxs("div",{className:"tw-flex tw-flex-row tw-items-start tw-justify-end tw-gap-2",children:[e.jsx(M,{size:"icon",onClick:p,variant:"outline",className:"tw-flex tw-items-center tw-justify-center tw-rounded-md",children:e.jsx(Ae,{})}),e.jsx(M,{size:"icon",onClick:v,className:"tw-flex tw-items-center tw-justify-center tw-rounded-md",disabled:!O(o),children:e.jsx(le,{})})]})]}),!f&&e.jsxs(e.Fragment,{children:[r.status==="Resolved"&&e.jsx("div",{className:"tw-text-sm tw-italic",children:x["%comment_status_resolved%"]}),r.status==="Todo"&&e.jsx("div",{className:"tw-text-sm tw-italic",children:x["%comment_status_todo%"]}),e.jsx("div",{className:U("tw-prose tw-items-start tw-gap-2 tw-break-words tw-text-sm tw-font-normal tw-text-foreground","tw-max-w-none",{"tw-line-clamp-3":!T}),dangerouslySetInnerHTML:{__html:D}})]})]}),T&&!g&&b!=="Resolved"&&R&&e.jsx(M,{variant:"ghost",size:"icon",className:"tw-shrink-0",onClick:i=>{i.stopPropagation(),R(r.thread,!0)},children:e.jsx(Ee,{})}),A&&e.jsxs(Pe,{children:[e.jsx(ke,{asChild:!0,children:e.jsx(M,{variant:"ghost",size:"icon",children:e.jsx(De,{})})}),e.jsx(Re,{align:"end",children:A})]})]})}F.__docgenInfo={description:`A single comment item in the comment list.

@param CommentItemProps The properties for the CommentItem component`,methods:[],displayName:"CommentItem",props:{comment:{required:!0,tsType:{name:"LegacyComment"},description:"Comment to render"},isReply:{required:!1,tsType:{name:"boolean"},description:"Whether the comment is a reply or a top-level comment",defaultValue:{value:"false",computed:!1}},isEditable:{required:!1,tsType:{name:"boolean"},description:`Whether the comment is editable or not. Only the most recent comment on a thread can be edited
and it can only be edited by its author.`,defaultValue:{value:"false",computed:!1}},localizedStrings:{required:!0,tsType:{name:"LanguageStrings"},description:"Localized strings for the component"},isThreadExpanded:{required:!1,tsType:{name:"boolean"},description:"Whether the thread is expanded",defaultValue:{value:"false",computed:!1}},threadStatus:{required:!1,tsType:{name:"CommentStatus"},description:"Current status of the thread",defaultValue:{value:"'Unspecified'",computed:!1}},handleResolveCommentThread:{required:!1,tsType:{name:"signature",type:"function",raw:"(threadId: string, resolve: boolean) => Promise<boolean>",signature:{arguments:[{type:{name:"string"},name:"threadId"},{type:{name:"boolean"},name:"resolve"}],return:{name:"Promise",elements:[{name:"boolean"}],raw:"Promise<boolean>"}}},description:"Handler for setting the comment thread status (resolve/unresolve)"},handleUpdateComment:{required:!1,tsType:{name:"signature",type:"function",raw:"(commentId: string, contents: string) => Promise<boolean>",signature:{arguments:[{type:{name:"string"},name:"commentId"},{type:{name:"string"},name:"contents"}],return:{name:"Promise",elements:[{name:"boolean"}],raw:"Promise<boolean>"}}},description:"Handler for updating a comment's content"},handleDeleteComment:{required:!1,tsType:{name:"signature",type:"function",raw:"(commentId: string) => Promise<boolean>",signature:{arguments:[{type:{name:"string"},name:"commentId"}],return:{name:"Promise",elements:[{name:"boolean"}],raw:"Promise<boolean>"}}},description:"Handler for deleting a comment"},onEditingChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(isEditing: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"isEditing"}],return:{name:"void"}}},description:"Callback when editing state changes"}}};const K={root:{children:[{children:[{detail:0,format:0,mode:"normal",style:"",text:"",type:"text",version:1}],direction:"ltr",format:"",indent:0,type:"paragraph",version:1,textFormat:0,textStyle:""}],direction:"ltr",format:"",indent:0,type:"root",version:1}};function me({comments:r,localizedStrings:g,isSelected:h=!1,verseRef:x,assignedUser:T,currentUser:b,handleSelectThread:R,threadId:m,threadStatus:u,handleResolveCommentThread:a,handleAddComment:f,handleUpdateComment:w,handleDeleteComment:o}){const[t,l]=s.useState(K),[p,v]=s.useState(!1),[W,c]=s.useState(!1),[j,D]=s.useState(!1),[A,i]=s.useState(!1),N=s.useMemo(()=>r.filter(n=>!n.deleted),[r]),d=s.useMemo(()=>N[0],[N]),C=s.useRef(null),I=s.useRef(void 0);s.useEffect(()=>{const n=C.current;if(!n)return;const _=()=>{c(n.scrollWidth>n.clientWidth)};return _(),window.addEventListener("resize",_),()=>window.removeEventListener("resize",_)},[d==null?void 0:d.verse]),s.useEffect(()=>{D(!1)},[h]);const P=s.useMemo(()=>({singleReply:g["%comment_thread_single_reply%"],multipleReplies:g["%comment_thread_multiple_replies%"]}),[g]),J=s.useMemo(()=>T?H(g["%comment_assigned_to%"],{assignedUser:T}):void 0,[T,g]),q=s.useMemo(()=>N.slice(1),[N]),E=s.useMemo(()=>q.length??0,[q.length]),ue=s.useMemo(()=>E>0,[E]),ce=s.useMemo(()=>j||E<=2?q:q.slice(-2),[q,E,j]),B=s.useMemo(()=>j||E<=2?0:E-2,[E,j]),he=s.useMemo(()=>E===1?P.singleReply:H(P.multipleReplies,{count:E}),[E,P]),fe=s.useMemo(()=>B===1?P.singleReply:H(P.multipleReplies,{count:B}),[B,P]),Z=s.useCallback(async()=>{var _;await f(m,V(t))&&((_=I.current)==null||_.call(I),l(K))},[t,f,m]),pe=s.useCallback(async(n,_)=>{var Y;if(!a)return!1;const L=O(t)?V(t):void 0,X=await a(n,_,L);return X&&L&&((Y=I.current)==null||Y.call(I),l(K)),X},[t,a]);return e.jsx(ve,{role:"option","aria-selected":h,id:m,className:U("tw-w-full tw-rounded-none tw-border-none tw-p-4 tw-outline-none tw-transition-all tw-duration-200 focus:tw-ring-2 focus:tw-ring-ring focus:tw-ring-offset-1 focus:tw-ring-offset-background",{"tw-cursor-pointer hover:tw-shadow-md":!h},{"tw-bg-primary-foreground":!h&&u!=="Resolved","tw-bg-background":h&&u!=="Resolved","tw-bg-muted":u==="Resolved"}),onClick:()=>{R(m)},tabIndex:-1,children:e.jsxs(Te,{className:"tw-flex tw-flex-col tw-gap-2 tw-p-0",children:[e.jsxs("div",{className:"tw-flex tw-flex-col tw-content-center tw-items-start tw-gap-4",children:[J&&e.jsx(ye,{className:"tw-rounded-sm tw-bg-input tw-text-sm tw-font-normal tw-text-primary hover:tw-bg-input",children:J}),e.jsxs("div",{className:"tw-flex tw-max-w-full tw-flex-wrap tw-items-baseline tw-gap-2",children:[e.jsxs("p",{ref:C,className:U("tw-flex-1 tw-overflow-hidden tw-text-ellipsis tw-text-sm tw-font-normal tw-text-muted-foreground",{"tw-overflow-visible tw-text-clip tw-whitespace-normal tw-break-words":p},{"tw-whitespace-nowrap":!p}),children:[x," ",d.verse]}),W&&e.jsx(M,{variant:"ghost",size:"icon",onClick:n=>{n.stopPropagation(),v(!p)},className:"tw-text-muted-foreground tw-transition hover:tw-text-foreground","aria-label":p?"Collapse text":"Expand text",children:p?e.jsx(se,{}):e.jsx(ne,{})})]}),e.jsx(F,{comment:d,localizedStrings:g,isThreadExpanded:h,threadStatus:u,isEditable:N.length===1&&(d==null?void 0:d.user)===b,handleResolveCommentThread:pe,handleUpdateComment:w,handleDeleteComment:o,onEditingChange:i})]}),e.jsxs(e.Fragment,{children:[ue&&!h&&e.jsxs("div",{className:"tw-flex tw-items-center tw-gap-5",children:[e.jsx("div",{className:"tw-w-8",children:e.jsx(Q,{})}),e.jsx("p",{className:"tw-text-sm tw-text-muted-foreground",children:he})]}),!h&&O(t)&&e.jsx(z,{editorSerializedState:t,onSerializedChange:n=>l(n),placeholder:g["%comment_replyOrAssign%"]}),h&&e.jsxs(e.Fragment,{children:[B>0&&e.jsxs("div",{className:"tw-flex tw-cursor-pointer tw-items-center tw-gap-5 tw-py-2",onClick:n=>{n.stopPropagation(),D(!0)},role:"button",tabIndex:0,onKeyDown:n=>{(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),n.stopPropagation(),D(!0))},children:[e.jsx("div",{className:"tw-w-8",children:e.jsx(Q,{})}),e.jsxs("div",{className:"tw-flex tw-items-center tw-gap-2",children:[e.jsx("p",{className:"tw-text-sm tw-text-muted-foreground",children:fe}),j?e.jsx(se,{}):e.jsx(ne,{})]})]}),ce.map(n=>{const L=n.id===q[q.length-1].id&&n.user===b;return e.jsx("div",{children:e.jsx(F,{comment:n,localizedStrings:g,isReply:!0,isThreadExpanded:h,isEditable:L,handleUpdateComment:w,handleDeleteComment:o,onEditingChange:i})},n.id)}),(!A||O(t))&&e.jsxs("div",{role:"textbox",tabIndex:-1,className:"tw-w-full tw-space-y-2",onClick:n=>n.stopPropagation(),onKeyDownCapture:n=>{n.key==="Enter"&&n.shiftKey&&(n.preventDefault(),n.stopPropagation(),O(t)&&Z())},onKeyDown:n=>{ie(n),(n.key==="Enter"||n.key===" ")&&n.stopPropagation()},children:[e.jsx(z,{editorSerializedState:t,onSerializedChange:n=>l(n),placeholder:u==="Resolved"?g["%comment_reopenResolved%"]:g["%comment_replyOrAssign%"],autoFocus:!0,onClear:n=>{I.current=n}}),e.jsxs("div",{className:"tw-flex tw-flex-row tw-items-start tw-justify-end tw-gap-2",children:[e.jsx(M,{size:"icon",variant:"outline",className:"tw-flex tw-items-center tw-justify-center tw-rounded-md",disabled:!O(t),children:e.jsx(Me,{})}),e.jsx(M,{size:"icon",onClick:Z,className:"tw-flex tw-items-center tw-justify-center tw-rounded-md",disabled:!O(t),children:e.jsx(le,{})})]})]})]})]})]})})}me.__docgenInfo={description:`Represents a thread of comments

@props CommentThreadProps`,methods:[],displayName:"CommentThread",props:{comments:{required:!0,tsType:{name:"Array",elements:[{name:"LegacyComment"}],raw:"LegacyComment[]"},description:"Comments in the thread"},localizedStrings:{required:!0,tsType:{name:"LanguageStrings"},description:"Localized strings for the component"},isSelected:{required:!1,tsType:{name:"boolean"},description:"Whether the thread is selected",defaultValue:{value:"false",computed:!1}},verseRef:{required:!1,tsType:{name:"string"},description:"Verse reference for the thread"},currentUser:{required:!0,tsType:{name:"string"},description:"Name of the current user, retrieved from the current user's Paratext Registry user information"},assignedUser:{required:!1,tsType:{name:"string"},description:"User assigned to the thread"},handleSelectThread:{required:!0,tsType:{name:"signature",type:"function",raw:"(threadId: string) => void",signature:{arguments:[{type:{name:"string"},name:"threadId"}],return:{name:"void"}}},description:"Handler for selecting the thread"},threadId:{required:!0,tsType:{name:"string"},description:"ID of the thread"},threadStatus:{required:!1,tsType:{name:"CommentStatus"},description:"Status of the thread"},handleAddComment:{required:!0,tsType:{name:"signature",type:"function",raw:"(threadId: string, contents: string) => Promise<string | undefined>",signature:{arguments:[{type:{name:"string"},name:"threadId"},{type:{name:"string"},name:"contents"}],return:{name:"Promise",elements:[{name:"union",raw:"string | undefined",elements:[{name:"string"},{name:"undefined"}]}],raw:"Promise<string | undefined>"}}},description:`Handler for adding a comment to a thread. If successful, returns the auto-generated comment ID
(format: "threadId/userName/date"). Otherwise, returns undefined.`},handleResolveCommentThread:{required:!0,tsType:{name:"signature",type:"function",raw:`(
  threadId: string,
  resolve: boolean,
  contents?: string,
) => Promise<boolean>`,signature:{arguments:[{type:{name:"string"},name:"threadId"},{type:{name:"boolean"},name:"resolve"},{type:{name:"string"},name:"contents"}],return:{name:"Promise",elements:[{name:"boolean"}],raw:"Promise<boolean>"}}},description:"Handler for setting the comment thread status (resolve/unresolve)"},handleUpdateComment:{required:!0,tsType:{name:"signature",type:"function",raw:"(commentId: string, contents: string) => Promise<boolean>",signature:{arguments:[{type:{name:"string"},name:"commentId"},{type:{name:"string"},name:"contents"}],return:{name:"Promise",elements:[{name:"boolean"}],raw:"Promise<boolean>"}}},description:"Handler for updating a comment's content"},handleDeleteComment:{required:!0,tsType:{name:"signature",type:"function",raw:"(commentId: string) => Promise<boolean>",signature:{arguments:[{type:{name:"string"},name:"commentId"}],return:{name:"Promise",elements:[{name:"boolean"}],raw:"Promise<boolean>"}}},description:"Handler for deleting a comment"}}};function $({className:r="",threads:g,currentUser:h,localizedStrings:x,handleAddComment:T,handleResolveCommentThread:b,handleUpdateComment:R,handleDeleteComment:m}){const[u,a]=s.useState(),f=g.filter(c=>c.comments.some(j=>!j.deleted)),w=f.map(c=>({id:c.id})),o=s.useCallback(c=>{a(c.id)},[]),t=s.useCallback(c=>{a(c)},[]),{listboxRef:l,activeId:p,handleKeyDown:v}=We({options:w,onOptionSelect:o}),W=s.useCallback(c=>{c.key==="Escape"?(a(void 0),c.preventDefault(),c.stopPropagation()):v(c)},[v]);return e.jsx("div",{id:"comment-list",role:"listbox",tabIndex:0,ref:l,"aria-activedescendant":p??void 0,"aria-label":"Comments",className:U("tw-flex tw-w-full tw-flex-col tw-space-y-3 tw-outline-none focus:tw-ring-2 focus:tw-ring-ring focus:tw-ring-offset-1 focus:tw-ring-offset-background",r),onKeyDown:W,children:f.map(c=>e.jsx("div",{className:U({"tw-opacity-60":c.status==="Resolved"}),children:e.jsx(me,{comments:c.comments,localizedStrings:x,verseRef:c.verseRef,handleSelectThread:t,threadId:c.id,isSelected:u===c.id,currentUser:h,assignedUser:c.assignedUser,threadStatus:c.status,handleAddComment:T,handleResolveCommentThread:b,handleUpdateComment:R,handleDeleteComment:m})},c.id))})}$.__docgenInfo={description:`Component for rendering a list of comment threads

@param CommentListProps Props for the CommentList component`,methods:[],displayName:"CommentList",props:{className:{required:!1,tsType:{name:"string"},description:"Additional class name for the component",defaultValue:{value:"''",computed:!1}},threads:{required:!0,tsType:{name:"Array",elements:[{name:"LegacyCommentThread"}],raw:"LegacyCommentThread[]"},description:"Comment threads to render"},currentUser:{required:!0,tsType:{name:"string"},description:"Name of the current user, retrieved from the current user's Paratext Registry user information"},localizedStrings:{required:!0,tsType:{name:"LanguageStrings"},description:"Localized strings for the component"},handleAddComment:{required:!0,tsType:{name:"signature",type:"function",raw:"(threadId: string, contents: string) => Promise<string | undefined>",signature:{arguments:[{type:{name:"string"},name:"threadId"},{type:{name:"string"},name:"contents"}],return:{name:"Promise",elements:[{name:"union",raw:"string | undefined",elements:[{name:"string"},{name:"undefined"}]}],raw:"Promise<string | undefined>"}}},description:`Handler for adding a comment to a thread. If successful, returns the auto-generated comment ID
(format: "threadId/userName/date"). Otherwise, returns undefined.`},handleResolveCommentThread:{required:!0,tsType:{name:"signature",type:"function",raw:`(
  threadId: string,
  resolve: boolean,
  contents?: string,
) => Promise<boolean>`,signature:{arguments:[{type:{name:"string"},name:"threadId"},{type:{name:"boolean"},name:"resolve"},{type:{name:"string"},name:"contents"}],return:{name:"Promise",elements:[{name:"boolean"}],raw:"Promise<boolean>"}}},description:"Handler for setting the comment thread status (resolve/unresolve)"},handleUpdateComment:{required:!0,tsType:{name:"signature",type:"function",raw:"(commentId: string, contents: string) => Promise<boolean>",signature:{arguments:[{type:{name:"string"},name:"commentId"},{type:{name:"string"},name:"contents"}],return:{name:"Promise",elements:[{name:"boolean"}],raw:"Promise<boolean>"}}},description:"Handler for updating a comment's content"},handleDeleteComment:{required:!0,tsType:{name:"signature",type:"function",raw:"(commentId: string) => Promise<boolean>",signature:{arguments:[{type:{name:"string"},name:"commentId"}],return:{name:"Promise",elements:[{name:"boolean"}],raw:"Promise<boolean>"}}},description:"Handler for deleting a comment"}}};const y=new Date,k=new Date(y);k.setDate(k.getDate()-1);const S=new Date(y);S.setDate(S.getDate()-2);const Le=[{id:"thread-1",comments:[{id:"1",user:"Charlie Delta",contents:"<p>Consider revising this portion for clarity:</p><blockquote>God is our refuge</blockquote><p>Maybe we could expand on what &ldquo;refuge&rdquo; means in this context? Some target languages might need a more explicit description.</p>",date:k.toISOString(),deleted:!1,hideInTextWindow:!1,language:"en",startPosition:0,thread:"thread-1",verse:"God is our refuge and strength, an ever-present help in trouble.",verseRef:"PSA 46:1",selectedText:"God is our refuge"},{id:"2",user:"Beth Bee",contents:'<p>I agree with Charlie. In some languages, the word for "refuge" might not exist, so we may need to use a descriptive phrase like <strong>safe place</strong> or <em>shelter from danger</em>.</p>',date:y.toISOString(),deleted:!1,hideInTextWindow:!1,language:"en",startPosition:0,thread:"thread-1",verse:"God is our refuge and strength, an ever-present help in trouble.",verseRef:"PSA 46:1",selectedText:""},{id:"3",user:"David Echo",contents:'<p>Good points! Let&apos;s make sure to add a note for translators about this. Also, should we clarify what "trouble" means in this context?</p>',date:y.toISOString(),deleted:!1,hideInTextWindow:!1,language:"en",startPosition:0,thread:"thread-1",verse:"God is our refuge and strength, an ever-present help in trouble.",verseRef:"PSA 46:1",selectedText:""}],status:"Unspecified",type:"Normal",assignedUser:"",replyToUser:"",modifiedDate:k.toISOString(),verseRef:"PSA 46:1",contextScrTextName:"WEB",isSpellingNote:!1,isBTNote:!1,isConsultantNote:!1},{id:"thread-2",comments:[{id:"4",user:"Eve Fox",contents:'<h1>Translation Workshop Notes</h1><h2>1. Key terms identified:</h2><ul><li>refuge (<span dir="rtl">מַחֲסֶה</span>)</li><li>strength (<span dir="rtl">עֹז</span>)</li><li>trouble (<span dir="rtl">צָרָה</span>)</li></ul><h2>2. Alternative renderings to consider:</h2><ul><li>&ldquo;safe place&rdquo; for &ldquo;refuge&rdquo;</li><li>&ldquo;power&rdquo; for &ldquo;strength&rdquo;</li><li>&ldquo;difficult times&rdquo; for &ldquo;trouble&rdquo;</li></ul><h2>3. Cultural considerations:</h2><ul><li>Military imagery</li><li>Ancient city fortifications</li><li>Divine protection metaphors</li></ul>',date:S.toISOString(),deleted:!1,hideInTextWindow:!1,language:"en",startPosition:0,thread:"thread-2",verse:"God is our refuge and strength, an ever-present help in trouble.",verseRef:"PSA 46:1",selectedText:""},{id:"5",user:"Charlie Delta",contents:"<p>Thanks for the summary, Eve! I think the cultural notes are especially helpful for teams working in different regions.</p>",date:S.toISOString(),deleted:!1,hideInTextWindow:!1,language:"en",startPosition:0,thread:"thread-2",verse:"God is our refuge and strength, an ever-present help in trouble.",verseRef:"PSA 46:1",selectedText:""},{id:"6",user:"Beth Bee",contents:"<p>One more suggestion: should we add a note about the poetic structure of this Psalms? It might help translators preserve the literary feel.</p>",date:y.toISOString(),deleted:!1,hideInTextWindow:!1,language:"en",startPosition:0,thread:"thread-2",verse:"God is our refuge and strength, an ever-present help in trouble.",verseRef:"PSA 46:1",selectedText:""}],status:"Todo",type:"Normal",assignedUser:"Frank Graham",replyToUser:"",modifiedDate:y.toISOString(),verseRef:"PSA 46:1",contextScrTextName:"WEB",isSpellingNote:!1,isBTNote:!0,isConsultantNote:!1},{id:"thread-3",comments:[{id:"7",user:"Frank Graham",contents:"<p>This verse is a great encouragement. No changes needed from my side.</p>",date:y.toISOString(),deleted:!1,hideInTextWindow:!1,language:"en",startPosition:0,thread:"thread-3",verse:"God is our refuge and strength, an ever-present help in trouble.",verseRef:"PSA 46:1",selectedText:""}],status:"Todo",type:"Normal",assignedUser:"",replyToUser:"",modifiedDate:y.toISOString(),verseRef:"PSA 46:1",contextScrTextName:"WEB",isSpellingNote:!1,isBTNote:!1,isConsultantNote:!1},{id:"thread-4",comments:[{id:"8",user:"Allison Park",contents:"<p>Thanks for the summary, Eve! I think the cultural notes are especially helpful for teams working in different regions.</p>",date:S.toISOString(),deleted:!1,hideInTextWindow:!1,language:"en",startPosition:0,thread:"thread-4",verse:"God is our refuge and strength, an ever-present help in trouble.",verseRef:"PSA 46:1",selectedText:""}],status:"Todo",type:"Normal",assignedUser:"",replyToUser:"",modifiedDate:y.toISOString(),verseRef:"PSA 46:1",contextScrTextName:"WEB",isSpellingNote:!1,isBTNote:!1,isConsultantNote:!1},{id:"thread-5",comments:[{id:"9a",user:"Jane Doe",contents:"<p>This verse is a great encouragement. No changes needed from my side.</p>",date:S.toISOString(),deleted:!1,hideInTextWindow:!1,language:"en",startPosition:0,thread:"thread-5",verse:"God is our refuge and strength, an ever-present help in trouble.",verseRef:"PSA 46:1",selectedText:""},{id:"9b",user:"Checker One",contents:"Agreed, resolving this thread.",date:S.toISOString(),deleted:!1,hideInTextWindow:!1,language:"en",startPosition:0,thread:"thread-5",verse:"God is our refuge and strength, an ever-present help in trouble.",verseRef:"PSA 46:1",selectedText:"",status:"Resolved"},{id:"9c",user:"Checker Two",contents:"I believe we should reconsider",date:S.toISOString(),deleted:!1,hideInTextWindow:!1,language:"en",startPosition:0,thread:"thread-5",verse:"God is our refuge and strength, an ever-present help in trouble.",verseRef:"PSA 46:1",selectedText:"",status:"Todo"},{id:"9d",user:"Checker One",contents:"As discussed offline, we can resolve this thread",date:S.toISOString(),deleted:!1,hideInTextWindow:!1,language:"en",startPosition:0,thread:"thread-5",verse:"God is our refuge and strength, an ever-present help in trouble.",verseRef:"PSA 46:1",selectedText:"",status:"Resolved"},{id:"9e",user:"Checker Two",date:S.toISOString(),deleted:!1,hideInTextWindow:!1,language:"en",startPosition:0,thread:"thread-5",verse:"God is our refuge and strength, an ever-present help in trouble.",verseRef:"PSA 46:1",selectedText:"",status:"Todo",contents:""},{id:"9f",user:"Checker One",date:S.toISOString(),deleted:!1,hideInTextWindow:!1,language:"en",startPosition:0,thread:"thread-5",verse:"God is our refuge and strength, an ever-present help in trouble.",verseRef:"PSA 46:1",selectedText:"",status:"Resolved",contents:""}],status:"Resolved",type:"Normal",assignedUser:"",replyToUser:"",modifiedDate:y.toISOString(),verseRef:"PSA 46:1",contextScrTextName:"WEB",isSpellingNote:!1,isBTNote:!1,isConsultantNote:!1},{id:"thread-6",comments:[{id:"10",user:"Grace Hill",contents:`<p>This verse presents some interesting translation challenges. The phrase "will not fear" is an emphatic statement in Hebrew. How should we handle this in languages that don't have this kind of emphatic negation?</p>`,date:k.toISOString(),deleted:!1,hideInTextWindow:!1,language:"en",startPosition:0,thread:"thread-6",verse:"Therefore we will not fear, though the earth be removed, and though the mountains be carried into the midst of the sea;",verseRef:"PSA 46:2",selectedText:"will not fear"},{id:"11",user:"Allison Park",contents:`<p>Great question! I think we need to consider the emotional intensity here. The Hebrew (<span dir="rtl">לֹא נִירָא</span>) is more than just "we will not be afraid" - it's almost defiant in its confidence.</p>`,date:k.toISOString(),deleted:!1,hideInTextWindow:!1,language:"en",startPosition:0,thread:"thread-6",verse:"Therefore we will not fear, though the earth be removed, and though the mountains be carried into the midst of the sea;",verseRef:"PSA 46:2",selectedText:""},{id:"12",user:"David Echo",contents:'<p>The apocalyptic imagery here is also striking - "earth be removed" and "mountains carried into the sea." These are cosmic upheavals that represent the most extreme circumstances possible. Should we maintain this hyperbolic language or adapt it for cultures unfamiliar with such imagery?</p>',date:y.toISOString(),deleted:!1,hideInTextWindow:!1,language:"en",startPosition:0,thread:"thread-6",verse:"Therefore we will not fear, though the earth be removed, and though the mountains be carried into the midst of the sea;",verseRef:"PSA 46:2",selectedText:"earth be removed, and though the mountains be carried into the midst of the sea"}],status:"Todo",type:"Normal",assignedUser:"Grace Hill",replyToUser:"",modifiedDate:y.toISOString(),verseRef:"PSA 46:2",contextScrTextName:"WEB",isSpellingNote:!1,isBTNote:!1,isConsultantNote:!1},{id:"thread-7",comments:[{id:"13",user:"Henry Kim",contents:"<p>The river imagery in this verse is beautiful, but I'm wondering about the cultural context. In ancient Jerusalem, there wasn't a major river. This seems to be referring to something beyond the literal geography.</p>",date:S.toISOString(),deleted:!1,hideInTextWindow:!1,language:"en",startPosition:0,thread:"thread-7",verse:"There is a river, the streams of which make glad the city of God, the holy place of the tabernacles of the Most High.",verseRef:"PSA 46:4",selectedText:"There is a river, the streams of which"},{id:"14",user:"Beth Bee",contents:`<p>You're absolutely right, Henry. This is likely referencing the river of life or divine blessing - perhaps drawing on Eden imagery or eschatological themes. The Hebrew word for "streams" (<span dir="rtl">פְּלָגָיו</span>) suggests channels or divisions of water that bring life and prosperity.</p>`,date:k.toISOString(),deleted:!1,hideInTextWindow:!1,language:"en",startPosition:0,thread:"thread-7",verse:"There is a river, the streams of which make glad the city of God, the holy place of the tabernacles of the Most High.",verseRef:"PSA 46:4",selectedText:""},{id:"15",user:"Eve Fox",contents:`<p>This connects beautifully with the temple imagery - "the holy place of the tabernacles of the Most High." Should we add a note explaining that this isn't referring to temporary structures but to God's eternal dwelling place?</p>`,date:k.toISOString(),deleted:!1,hideInTextWindow:!1,language:"en",startPosition:0,thread:"thread-7",verse:"There is a river, the streams of which make glad the city of God, the holy place of the tabernacles of the Most High.",verseRef:"PSA 46:4",selectedText:"the holy place of the tabernacles of the Most High"},{id:"16",user:"Charlie Delta",contents:`<p>I think we should also consider how to translate "make glad" (<span dir="rtl">יְשַׂמְּחוּ</span>). It's more than just happiness - it's a deep joy and celebration. Some languages might need a stronger expression than just "make happy."</p>`,date:y.toISOString(),deleted:!1,hideInTextWindow:!1,language:"en",startPosition:0,thread:"thread-7",verse:"There is a river, the streams of which make glad the city of God, the holy place of the tabernacles of the Most High.",verseRef:"PSA 46:4",selectedText:"make glad"}],status:"Unspecified",type:"Normal",assignedUser:"Henry Kim",replyToUser:"",modifiedDate:y.toISOString(),verseRef:"PSA 46:4",contextScrTextName:"WEB",isSpellingNote:!1,isBTNote:!1,isConsultantNote:!0},{id:"thread-8",comments:[{id:"17",user:"Tim Steenwyk",contents:"This is a note with <b>bold text</b> and <i>italic text</i>.</p><p>It also has <u>underlined</u> and <s>strikethrough</s> text.",date:S.toISOString(),deleted:!1,hideInTextWindow:!1,language:"en",startPosition:0,thread:"thread-8",verse:"\\v 1 When people had spread all over the world...",verseRef:"GEN 6:1",selectedText:""},{id:"18",user:"Beth Bee",contents:"<p>This is a reply with <b>bold</b> and <i><b>bold italic</b></i> formatting.</p>",date:k.toISOString(),deleted:!1,hideInTextWindow:!1,language:"en",startPosition:0,thread:"thread-8",verse:"",verseRef:"GEN 6:1",selectedText:""},{id:"19",user:"Charlie Delta",contents:"<p>Another reply with <u>underline</u> and <s>strikethrough</s> combined: <u><s>both</s></u>.</p>",date:y.toISOString(),deleted:!1,hideInTextWindow:!1,language:"en",startPosition:0,thread:"thread-8",verse:"",verseRef:"GEN 6:1",selectedText:""},{id:"100",user:"Charlie Delta",contents:"<p>Another reply with <u>underline</u> and <s>strikethrough</s> combined: <u><s>both</s></u>.</p>",date:y.toISOString(),deleted:!1,hideInTextWindow:!1,language:"en",startPosition:0,thread:"thread-8",verse:"",verseRef:"GEN 6:1",selectedText:""},{id:"101",user:"Charlie Delta",contents:"<p>Another reply with <u>underline</u> and <s>strikethrough</s> combined: <u><s>both</s></u>.</p>",date:y.toISOString(),deleted:!1,hideInTextWindow:!1,language:"en",startPosition:0,thread:"thread-8",verse:"",verseRef:"GEN 6:1",selectedText:""},{id:"102",user:"Charlie Delta",contents:"<p>Another reply with <u>underline</u> and <s>strikethrough</s> combined: <u><s>both</s></u>.</p>",date:y.toISOString(),deleted:!1,hideInTextWindow:!1,language:"en",startPosition:0,thread:"thread-8",verse:"",verseRef:"GEN 6:1",selectedText:""},{id:"103",user:"Charlie Delta",contents:"<p>Another reply with <u>underline</u> and <s>strikethrough</s> combined: <u><s>both</s></u>.</p>",date:y.toISOString(),deleted:!1,hideInTextWindow:!1,language:"en",startPosition:0,thread:"thread-8",verse:"",verseRef:"GEN 6:1",selectedText:""}],status:"Todo",type:"Normal",assignedUser:"",replyToUser:"",modifiedDate:y.toISOString(),verseRef:"GEN 6:1",contextScrTextName:"WEB",isSpellingNote:!1,isBTNote:!1,isConsultantNote:!1},{id:"thread-9",comments:[{id:"20",user:"Tim Steenwyk",contents:`Two different people made conflicting changes in this verse.<p><language name="es-015-vaidika"><p>\\v 9 Moses said to the <s><color name="red">large group of </color></s>people, "While we were still at Mount Sinai, I told you, 'The responsibility for leading you is too much for me. I can't do it alone. </p></language></p>This <color name="green">is</color> <color name="blue">a</color> <strikethrough>new</strikethrough> paragraph</p>`,date:S.toISOString(),deleted:!1,hideInTextWindow:!1,language:"en",startPosition:0,thread:"thread-9",verse:'\\v 9 Moses said to the people, "While we were still at Mount Sinai..."',verseRef:"DEU 1:9",selectedText:""}],status:"Todo",type:"Normal",assignedUser:"",replyToUser:"",modifiedDate:S.toISOString(),verseRef:"DEU 1:9",contextScrTextName:"WEB",isSpellingNote:!1,isBTNote:!1,isConsultantNote:!1},{id:"thread-10",comments:[{id:"21",user:"Eve Fox",contents:'<p>This is my note with <language name="es-015-vaidika">Spanish text</language> embedded.</p>',date:k.toISOString(),deleted:!1,hideInTextWindow:!1,language:"en",startPosition:0,thread:"thread-10",verse:"\\v 18 and cried out as they saw the smoke from the flames...",verseRef:"REV 18:18",selectedText:""}],status:"Resolved",type:"Normal",assignedUser:"",replyToUser:"",modifiedDate:k.toISOString(),verseRef:"REV 18:18",contextScrTextName:"WEB",isSpellingNote:!1,isBTNote:!1,isConsultantNote:!1}],Ge={"%comment_assigned_to%":"Assigned to {assignedUser}","%comment_dateAtTime%":"{date} at {time}","%comment_date_today%":"today","%comment_date_yesterday%":"yesterday","%comment_deleteComment%":"Delete Comment","%comment_editComment%":"Edit Comment","%comment_reopenResolved%":"Adding a comment will re-open this discussion...","%comment_replyOrAssign%":"Reply or assign with @","%comment_status_resolved%":"Marked as resolved","%comment_status_todo%":"Re-opened","%comment_thread_multiple_replies%":"{count} replies","%comment_thread_single_reply%":"1 reply","%no_comments%":"No comments yet"};function He({initialThreads:r}){const[g,h]=s.useState(r),x=async(m,u,a)=>{console.log(`Adding comment to thread ${m}: ${u}`);let f;return h(w=>w.map(o=>{if(o.id===m){f=`${o.id}-${Date.now()}`;let t=a;!t&&o.status==="Resolved"&&(t="Todo");const l={id:f,user:"Current User",date:new Date().toISOString(),contents:u,deleted:!1,hideInTextWindow:!1,language:"en",startPosition:0,selectedText:"",contextBefore:"",contextAfter:"",thread:o.id,verseRef:o.verseRef,...t&&{status:t}};return{...o,comments:[...o.comments,l],...t&&{status:t}}}return o})),f},T=async(m,u,a)=>{console.log(`Setting thread ${m} status to ${u?"resolved":"unresolved"}`);let f=!1;return h(w=>w.map(o=>{if(o.id===m){const l={id:`${o.id}-status-${Date.now()}`,user:"Current User",date:new Date().toISOString(),contents:a||"",deleted:!1,hideInTextWindow:!1,language:"en",startPosition:0,selectedText:"",contextBefore:"",contextAfter:"",thread:o.id,verseRef:o.verseRef,status:u?"Resolved":"Todo"};return f=!0,{...o,comments:[...o.comments,l],status:u?"Resolved":"Todo"}}return o})),f},b=async(m,u)=>{console.log(`Updating comment id ${m} with contents: ${u}`);let a=!1;return h(f=>f.map(w=>({...w,comments:w.comments.map(o=>o.id===m?(a=!0,{...o,contents:u}):o)}))),a},R=async m=>{console.log(`Deleting comment id ${m}`);let u=!1;return h(a=>a.map(f=>({...f,comments:f.comments.map(w=>w.id===m?(u=!0,{...w,deleted:!0}):w)}))),u};return e.jsx($,{threads:g,localizedStrings:Ge,currentUser:"Current User",handleAddComment:x,handleResolveCommentThread:T,handleUpdateComment:b,handleDeleteComment:R})}const Kt={title:"Advanced/CommentList",component:$,tags:["autodocs"],decorators:[r=>e.jsx(ge,{children:e.jsx(r,{})})],argTypes:{threads:{control:"object"},className:{control:"text"}}},G={render:()=>e.jsx(He,{initialThreads:Le})};var re,ae,oe;G.parameters={...G.parameters,docs:{...(re=G.parameters)==null?void 0:re.docs,source:{originalSource:`{
  render: () => <CommentListStory initialThreads={sampleComments} />
}`,...(oe=(ae=G.parameters)==null?void 0:ae.docs)==null?void 0:oe.source}}};const Vt=["Default"];export{G as Default,Vt as __namedExportsOrder,Kt as default};
