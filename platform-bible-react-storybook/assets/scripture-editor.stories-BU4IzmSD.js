var Av=Object.defineProperty;var Ov=(n,e,t)=>e in n?Av(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var Pt=(n,e,t)=>Ov(n,typeof e!="symbol"?e+"":e,t);import{j as S}from"./jsx-runtime-CDjhsm_V.js";import{r as x,c as Gn,g as $v}from"./iframe-CRRMe9V3.js";import{J as Ai,v as Oi,H as Pv,V as Iv,_ as Rv,B as Lv,I as cd}from"./index-C3mJiya3.js";import{r as Nt}from"./index-DFPKyrsJ.js";import{c as Dv,d as jv,e as Fv,g as qv}from"./floating-ui.react-dom-BfTpH6HJ.js";import{M as Bv}from"./markdown-renderer.component-B1VBdeqw.js";import{C as Uv,a as zv,b as Wv,d as Kv}from"./card-Ctx3d81u.js";import{B as Hv}from"./book-chapter-control.component-Du-Qx8PT.js";import{T as Jv}from"./tab-toolbar.component-B_4tx6If.js";import{B as bi}from"./button-CMAhVRII.js";import{D as Vv,a as Gv,b as Yv,e as Xv}from"./dropdown-menu-DUiV6-Mg.js";import{C as Zv}from"./chevron-down-DSxAcO4w.js";import{c as Zt}from"./createLucideIcon-ye4D_cU6.js";import{F as wn}from"./file-text-f7WzEG4r.js";import"./index-D5MTIT-A.js";import"./shadcn-ui.util-DMJ19wEV.js";import"./book-item.utils--IqvZBZ6.js";import"./command-D_-Ka6kX.js";import"./index-Bnd4TGll.js";import"./index-DOqCPiE1.js";import"./index-Cno53nBy.js";import"./index-C370XeKz.js";import"./index-B6bXkcLz.js";import"./index-DGcQlfp4.js";import"./index-DkHSCYtG.js";import"./index-CCIkc6ox.js";import"./index-DMpZRwqt.js";import"./Combination-BS_UimCx.js";import"./index-BT5nI22M.js";import"./index-W2xvj7IK.js";import"./index-D5KPgISZ.js";import"./dialog-bWeCJmaA.js";import"./x-CjkM2Xty.js";import"./search-C2yt4Lom.js";import"./index.es-D4jfZzAn.js";import"./index-B_P4TyHR.js";import"./check-D9aOPwuX.js";import"./popover-CUGFFAlm.js";import"./index-umCBs8FJ.js";import"./index-0NTouMgK.js";import"./index-B3n2kpdI.js";import"./chevron-left-Bym1XAnB.js";import"./chevron-right-DkA1uTfR.js";import"./arrow-right-BFxvG1WU.js";import"./tab-dropdown-menu.component-BZG5WWlG.js";import"./tooltip-CoYlTTJs.js";import"./index-D1UbLtlN.js";import"./menu.util-Dxh7JGT4.js";import"./menu-icon.component-DRZ-ZlJL.js";import"./tab-toolbar-container.component-BdLFvqq6.js";import"./index-BPbCuWFR.js";import"./menu.context-ClnNKOV-.js";import"./index-DhylnRdV.js";import"./index-BfK7WNM8.js";import"./index-HKN90ug8.js";import"./circle-B2cm5wZE.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qv=[["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 18h18",key:"1h113x"}],["path",{d:"M3 6h18",key:"d0wm0j"}]],zo=Zt("AlignJustify",Qv);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ek=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]],tk=Zt("Ban",ek);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nk=[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"m17 12 3-2v8",key:"1hhhft"}]],yi=Zt("Heading1",nk);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rk=[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M21 18h-4c0-4 4-3 4-6 0-1.5-2-2.5-4-1",key:"9jr5yi"}]],jf=Zt("Heading2",rk);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ik=[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M17.5 10.5c1.7-1 3.5 0 3.5 1.5a2 2 0 0 1-2 2",key:"68ncm8"}],["path",{d:"M17 17.5c2 1.5 4 .3 4-1.5a2 2 0 0 0-2-2",key:"1ejuhz"}]],wc=Zt("Heading3",ik);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sk=[["path",{d:"M16 12H3",key:"1a2rj7"}],["path",{d:"M16 6H3",key:"1wxfjs"}],["path",{d:"M10 18H3",key:"13769t"}],["path",{d:"M21 6v10a2 2 0 0 1-2 2h-5",key:"ilrcs8"}],["path",{d:"m16 16-2 2 2 2",key:"kkc6pm"}]],ok=Zt("ListEnd",sk);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ak=[["path",{d:"M21 7v6h-6",key:"3ptur4"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7",key:"1kgawr"}]],lk=Zt("Redo",ak);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ck=[["path",{d:"m18 14 4 4-4 4",key:"10pe0f"}],["path",{d:"m18 2 4 4-4 4",key:"pucp1d"}],["path",{d:"M2 18h1.973a4 4 0 0 0 3.3-1.7l5.454-8.6a4 4 0 0 1 3.3-1.7H22",key:"1ailkh"}],["path",{d:"M2 6h1.972a4 4 0 0 1 3.6 2.2",key:"km57vx"}],["path",{d:"M22 18h-6.041a4 4 0 0 1-3.3-1.8l-.359-.45",key:"os18l9"}]],uk=Zt("Shuffle",ck);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dk=[["path",{d:"m4 19 8-8",key:"hr47gm"}],["path",{d:"m12 19-8-8",key:"1dhhmo"}],["path",{d:"M20 12h-4c0-1.5.442-2 1.5-2.5S20 8.334 20 7.002c0-.472-.17-.93-.484-1.29a2.105 2.105 0 0 0-2.617-.436c-.42.239-.738.614-.899 1.06",key:"1dfcux"}]],fk=Zt("Superscript",dk);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hk=[["path",{d:"M17 6H3",key:"16j9eg"}],["path",{d:"M21 12H8",key:"scolzb"}],["path",{d:"M21 18H8",key:"1wfozv"}],["path",{d:"M3 12v6",key:"fv4c87"}]],Sc=Zt("TextQuote",hk);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gk=[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]],pk=Zt("Undo",gk);function H(n,...e){const t=new URL("https://lexical.dev/docs/error"),r=new URLSearchParams;r.append("code",n);for(const i of e)r.append("v",i);throw t.search=r.toString(),Error(`Minified Lexical error #${n}; visit ${t.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}const Qt=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,mk=Qt&&"documentMode"in document?document.documentMode:null,cn=Qt&&/Mac|iPod|iPhone|iPad/.test(navigator.platform),Fr=Qt&&/^(?!.*Seamonkey)(?=.*Firefox).*/i.test(navigator.userAgent),$a=!(!Qt||!("InputEvent"in window)||mk)&&"getTargetRanges"in new window.InputEvent("input"),Us=Qt&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent),$i=Qt&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,yk=Qt&&/Android/.test(navigator.userAgent),vm=Qt&&/^(?=.*Chrome).*/i.test(navigator.userAgent),Ff=Qt&&yk&&vm,Pa=Qt&&/AppleWebKit\/[\d.]+/.test(navigator.userAgent)&&!vm;function Ia(...n){const e=[];for(const t of n)if(t&&typeof t=="string")for(const[r]of t.matchAll(/\S+/g))e.push(r);return e}const _k=1,bk=3,vk=9,kk=11,qr=0,km=1,Pi=2,xk=0,Ck=1,wk=2,Ra=4,La=8,ud=128,Sk=1792|(112|(3|Ra|La)|ud),dd=1,fd=2,hd=3,gd=4,pd=5,md=6,hl=Us||$i||Pa?" ":"​",Rn=`

`,Tk=Fr?" ":hl,xm="֑-߿יִ-﷽ﹰ-ﻼ",Cm="A-Za-zÀ-ÖØ-öø-ʸ̀-֐ࠀ-῿‎Ⰰ-﬜︀-﹯﻽-￿",Ek=new RegExp("^[^"+Cm+"]*["+xm+"]"),Nk=new RegExp("^[^"+xm+"]*["+Cm+"]"),rr={bold:1,capitalize:1024,code:16,highlight:ud,italic:2,lowercase:256,strikethrough:Ra,subscript:32,superscript:64,underline:La,uppercase:512},Mk={directionless:1,unmergeable:2},qf={center:fd,end:md,justify:gd,left:dd,right:hd,start:pd},Ak={[fd]:"center",[md]:"end",[gd]:"justify",[dd]:"left",[hd]:"right",[pd]:"start"},Ok={normal:0,segmented:2,token:1},$k={[xk]:"normal",[wk]:"segmented",[Ck]:"token"},Bf="$config";function wm(n,e,t,r,i,s){let o=n.getFirstChild();for(;o!==null;){const a=o.__key;o.__parent===e&&(j(o)&&wm(o,a,t,r,i,s),t.has(a)||s.delete(a),i.push(a)),o=o.getNextSibling()}}const Pk=100;let iu=!1,yd=0;function Ik(n){yd=n.timeStamp}function Tc(n,e,t){const r=n.nodeName==="BR",i=e.__lexicalLineBreak;return i&&(n===i||r&&n.previousSibling===i)||r&&kl(n,t)!==void 0}function Rk(n,e,t){const r=Gt(jt(t));let i=null,s=null;r!==null&&r.anchorNode===n&&(i=r.anchorOffset,s=r.focusOffset);const o=n.nodeValue;o!==null&&Bd(e,o,i,s,!1)}function Lk(n,e,t){if(B(n)){const r=n.anchor.getNode();if(r.is(t)&&n.format!==r.getFormat())return!1}return qn(e)&&t.isAttached()}function Dk(n,e,t,r){for(let i=n;i&&!Rx(i);i=go(i)){const s=kl(i,e);if(s!==void 0){const o=de(s,t);if(o)return ve(o)||!Te(i)?void 0:[i,o]}else if(i===r)return[r,Ty(t)]}}function Sm(n,e,t){iu=!0;const r=performance.now()-yd>Pk;try{Et(n,()=>{const i=K()||function(d){return d.getEditorState().read(()=>{const h=K();return h!==null?h.clone():null})}(n),s=new Map,o=n.getRootElement(),a=n._editorState,l=n._blockCursorElement;let c=!1,u="";for(let d=0;d<e.length;d++){const h=e[d],p=h.type,m=h.target,y=Dk(m,n,a,o);if(!y)continue;const[b,_]=y;if(p==="characterData")r&&z(_)&&qn(m)&&Lk(i,m,_)&&Rk(m,_,n);else if(p==="childList"){c=!0;const C=h.addedNodes;for(let N=0;N<C.length;N++){const D=C[N],P=wy(D),$=D.parentNode;if($!=null&&D!==l&&P===null&&!Tc(D,$,n)){if(Fr){const R=(Te(D)?D.innerText:null)||D.nodeValue;R&&(u+=R)}$.removeChild(D)}}const E=h.removedNodes,O=E.length;if(O>0){let N=0;for(let D=0;D<O;D++){const P=E[D];(Tc(P,m,n)||l===P)&&(m.appendChild(P),N++)}O!==N&&s.set(b,_)}}}if(s.size>0)for(const[d,h]of s)h.reconcileObservedMutation(d,n);const f=t.takeRecords();if(f.length>0){for(let d=0;d<f.length;d++){const h=f[d],p=h.addedNodes,m=h.target;for(let y=0;y<p.length;y++){const b=p[y],_=b.parentNode;_==null||b.nodeName!=="BR"||Tc(b,m,n)||_.removeChild(b)}}t.takeRecords()}i!==null&&(c&&it(i),Fr&&Oy(n)&&i.insertRawText(u))})}finally{iu=!1}}function Tm(n){const e=n._observer;e!==null&&Sm(n,e.takeRecords(),e)}function Em(n){(function(e){yd===0&&jt(e).addEventListener("textInput",Ik,!0)})(n),n._observer=new MutationObserver((e,t)=>{Sm(n,e,t)})}let jk=class{constructor(e,t){this.key=e,this.parse=t.parse.bind(t),this.unparse=(t.unparse||Bk).bind(t),this.isEqual=(t.isEqual||Object.is).bind(t),this.defaultValue=this.parse(void 0)}};function Nm(n,e){return new jk(n,e)}function Ii(n,e,t="latest"){const r=(t==="latest"?n.getLatest():n).__state;return r?r.getValue(e):e.defaultValue}function $n(n,e,t){let r;if(Ze(),typeof t=="function"){const s=n.getLatest(),o=Ii(s,e);if(r=t(o),e.isEqual(o,r))return s}else r=t;const i=n.getWritable();return Am(i).updateFromKnown(e,r),i}function Fk(n){const e=new Map,t=new Set;for(let r=typeof n=="function"?n:n.replace;r.prototype&&r.prototype.getType!==void 0;r=Object.getPrototypeOf(r)){const{ownNodeConfig:i}=Kd(r);if(i&&i.stateConfigs)for(const s of i.stateConfigs){let o;"stateConfig"in s?(o=s.stateConfig,s.flat&&t.add(o.key)):o=s,e.set(o.key,o)}}return{flatKeys:t,sharedConfigMap:e}}let qk=class Mm{constructor(e,t,r=void 0,i=new Map,s=void 0){this.node=e,this.sharedNodeState=t,this.unknownState=r,this.knownState=i;const{sharedConfigMap:o}=this.sharedNodeState,a=s!==void 0?s:function(l,c,u){let f=u.size;if(c)for(const d in c){const h=l.get(d);h&&u.has(h)||f++}return f}(o,r,i);this.size=a}getValue(e){const t=this.knownState.get(e);if(t!==void 0)return t;this.sharedNodeState.sharedConfigMap.set(e.key,e);let r=e.defaultValue;if(this.unknownState&&e.key in this.unknownState){const i=this.unknownState[e.key];i!==void 0&&(r=e.parse(i)),this.updateFromKnown(e,r)}return r}getInternalState(){return[this.unknownState,this.knownState]}toJSON(){const e={...this.unknownState},t={};for(const[r,i]of this.knownState)r.isEqual(i,r.defaultValue)?delete e[r.key]:e[r.key]=r.unparse(i);for(const r of this.sharedNodeState.flatKeys)r in e&&(t[r]=e[r],delete e[r]);return Uf(e)&&(t.$=e),t}getWritable(e){if(this.node===e)return this;const{sharedNodeState:t,unknownState:r}=this,i=new Map(this.knownState);return new Mm(e,t,function(s,o,a){let l;if(a)for(const[c,u]of Object.entries(a)){const f=s.get(c);f?o.has(f)||o.set(f,f.parse(u)):(l=l||{},l[c]=u)}return l}(t.sharedConfigMap,i,r),i,this.size)}updateFromKnown(e,t){const r=e.key;this.sharedNodeState.sharedConfigMap.set(r,e);const{knownState:i,unknownState:s}=this;i.has(e)||s&&r in s||(s&&(delete s[r],this.unknownState=Uf(s)),this.size++),i.set(e,t)}updateFromUnknown(e,t){const r=this.sharedNodeState.sharedConfigMap.get(e);r?this.updateFromKnown(r,r.parse(t)):(this.unknownState=this.unknownState||{},e in this.unknownState||this.size++,this.unknownState[e]=t)}updateFromJSON(e){const{knownState:t}=this;for(const r of t.keys())t.set(r,r.defaultValue);if(this.size=t.size,this.unknownState=void 0,e)for(const[r,i]of Object.entries(e))this.updateFromUnknown(r,i)}};function Am(n){const e=n.getWritable(),t=e.__state?e.__state.getWritable(e):new qk(e,Om(e));return e.__state=t,t}function Om(n){return n.__state?n.__state.sharedNodeState:xy(Cl(),n.getType()).sharedNodeState}function Uf(n){if(n)for(const e in n)return n}function Bk(n){return n}function zf(n,e,t){for(const[r,i]of e.knownState){if(n.has(r.key))continue;n.add(r.key);const s=t?t.getValue(r):r.defaultValue;if(s!==i&&!r.isEqual(s,i))return!0}return!1}function Wf(n,e,t){const{unknownState:r}=e,i=t?t.unknownState:void 0;if(r){for(const[s,o]of Object.entries(r))if(!n.has(s)&&(n.add(s),o!==(i?i[s]:void 0)))return!0}return!1}function Kf(n,e){const t=n.__state;return t&&t.node===n?t.getWritable(e):t}function Hf(n,e){const t=n.__mode,r=n.__format,i=n.__style,s=e.__mode,o=e.__format,a=e.__style,l=n.__state,c=e.__state;return(t===null||t===s)&&(r===null||r===o)&&(i===null||i===a)&&(n.__state===null||l===c||function(u,f){if(u===f)return!0;if(u&&f&&u.size!==f.size)return!1;const d=new Set;return!(u&&zf(d,u,f)||f&&zf(d,f,u)||u&&Wf(d,u,f)||f&&Wf(d,f,u))}(l,c))}function Jf(n,e){const t=n.mergeWithSibling(e),r=$e()._normalizedNodes;return r.add(n.__key),r.add(e.__key),t}function Vf(n){let e,t,r=n;if(r.__text!==""||!r.isSimpleText()||r.isUnmergeable()){for(;(e=r.getPreviousSibling())!==null&&z(e)&&e.isSimpleText()&&!e.isUnmergeable();){if(e.__text!==""){if(Hf(e,r)){r=Jf(e,r);break}break}e.remove()}for(;(t=r.getNextSibling())!==null&&z(t)&&t.isSimpleText()&&!t.isUnmergeable();){if(t.__text!==""){if(Hf(r,t)){r=Jf(r,t);break}break}t.remove()}}else r.remove()}function zs(n){return Gf(n.anchor),Gf(n.focus),n}function Gf(n){for(;n.type==="element";){const e=n.getNode(),t=n.offset;let r,i;if(t===e.getChildrenSize()?(r=e.getChildAtIndex(t-1),i=!0):(r=e.getChildAtIndex(t),i=!1),z(r)){n.set(r.__key,i?r.getTextContentSize():0,"text",!0);break}if(!j(r))break;n.set(r.__key,i?r.getChildrenSize():0,"element",!0)}}let ir,yt,Ws,gl,su,ou,Br,Kt,au,Ks,Fe="",mt="",an=null,ln="",An="",$m=!1,Hs=!1,ba=null;function Da(n,e){const t=Br.get(n);if(e!==null){const r=uu(n);r.parentNode===e&&e.removeChild(r)}if(Kt.has(n)||yt._keyToDOMMap.delete(n),j(t)){const r=Fa(t,Br);lu(r,0,r.length-1,null)}t!==void 0&&Ud(Ks,Ws,gl,t,"destroyed")}function lu(n,e,t,r){let i=e;for(;i<=t;++i){const s=n[i];s!==void 0&&Da(s,r)}}function Mr(n,e){n.setProperty("text-align",e)}const Uk="40px";function Pm(n,e){const t=ir.theme.indent;if(typeof t=="string"){const i=n.classList.contains(t);e>0&&!i?n.classList.add(t):e<1&&i&&n.classList.remove(t)}const r=getComputedStyle(n).getPropertyValue("--lexical-indent-base-value")||Uk;n.style.setProperty("padding-inline-start",e===0?"":`calc(${e} * ${r})`)}function Im(n,e){const t=n.style;e===0?Mr(t,""):e===dd?Mr(t,"left"):e===fd?Mr(t,"center"):e===hd?Mr(t,"right"):e===gd?Mr(t,"justify"):e===pd?Mr(t,"start"):e===md&&Mr(t,"end")}function ja(n,e){const t=Kt.get(n);t===void 0&&H(60);const r=t.createDOM(ir,yt);if(function(i,s,o){const a=o._keyToDOMMap;(function(l,c,u){const f=`__lexicalKey_${c._key}`;l[f]=u})(s,o,i),a.set(i,s)}(n,r,yt),z(t)?r.setAttribute("data-lexical-text","true"):ve(t)&&r.setAttribute("data-lexical-decorator","true"),j(t)){const i=t.__indent,s=t.__size;if(i!==0&&Pm(r,i),s!==0){const a=s-1;(function(l,c,u,f){const d=mt;mt="",cu(l,u,0,c,u.getDOMSlot(f)),Lm(u,f),mt=d})(Fa(t,Kt),a,t,r)}const o=t.__format;o!==0&&Im(r,o),t.isInline()||Rm(null,t,r),xl(t)&&(Fe+=Rn,An+=Rn)}else{const i=t.getTextContent();if(ve(t)){const s=t.decorate(yt,ir);s!==null&&Dm(n,s),r.contentEditable="false"}else z(t)&&(t.isDirectionless()||(mt+=i));Fe+=i,An+=i}return e!==null&&e.insertChild(r),Ud(Ks,Ws,gl,t,"created"),r}function cu(n,e,t,r,i){const s=Fe;Fe="";let o=t;for(;o<=r;++o){ja(n[o],i);const a=Kt.get(n[o]);a!==null&&z(a)&&(an===null&&(an=a.getFormat()),ln===""&&(ln=a.getStyle()))}xl(e)&&(Fe+=Rn),i.element.__lexicalTextContent=Fe,Fe=s+Fe}function Yf(n,e){if(n){const t=n.__last;if(t){const r=e.get(t);if(r)return Pr(r)?"line-break":ve(r)&&r.isInline()?"decorator":null}return"empty"}return null}function Rm(n,e,t){const r=Yf(n,Br),i=Yf(e,Kt);r!==i&&e.getDOMSlot(t).setManagedLineBreak(i)}function Lm(n,e){const t=e.__lexicalDirTextContent||"",r=e.__lexicalDir||"";if(t!==mt||r!==ba){const i=mt==="",s=i?ba:function(o){return Ek.test(o)?"rtl":Nk.test(o)?"ltr":null}(mt);if(s!==r){const o=e.classList,a=ir.theme;let l=r!==null?a[r]:void 0,c=s!==null?a[s]:void 0;if(l!==void 0){if(typeof l=="string"){const u=Ia(l);l=a[r]=u}o.remove(...l)}if(s===null||i&&s==="ltr")e.removeAttribute("dir");else{if(c!==void 0){if(typeof c=="string"){const u=Ia(c);c=a[s]=u}c!==void 0&&o.add(...c)}e.dir=s}Hs||(n.getWritable().__dir=s)}ba=s,e.__lexicalDirTextContent=mt,e.__lexicalDir=s}}function zk(n,e,t){const r=mt;var i;mt="",an=null,ln="",function(s,o,a){const l=Fe,c=s.__size,u=o.__size;Fe="";const f=a.element;if(c===1&&u===1){const d=s.__first,h=o.__first;if(d===h)As(d,f);else{const m=uu(d),y=ja(h,null);try{f.replaceChild(y,m)}catch(b){if(typeof b=="object"&&b!=null){const _=`${b.toString()} Parent: ${f.tagName}, new child: {tag: ${y.tagName} key: ${h}}, old child: {tag: ${m.tagName}, key: ${d}}.`;throw new Error(_)}throw b}Da(d,null)}const p=Kt.get(h);z(p)&&(an===null&&(an=p.getFormat()),ln===""&&(ln=p.getStyle()))}else{const d=Fa(s,Br),h=Fa(o,Kt);if(d.length!==c&&H(227),h.length!==u&&H(228),c===0)u!==0&&cu(h,o,0,u-1,a);else if(u===0){if(c!==0){const p=a.after==null&&a.before==null&&a.element.__lexicalLineBreak==null;lu(d,0,c-1,p?null:f),p&&(f.textContent="")}}else(function(p,m,y,b,_,C){const E=b-1,O=_-1;let N,D,P=C.getFirstChild(),$=0,R=0;for(;$<=E&&R<=O;){const w=m[$],L=y[R];if(w===L)P=Ec(As(L,C.element)),$++,R++;else{N===void 0&&(N=new Set(m)),D===void 0&&(D=new Set(y));const q=D.has(w),W=N.has(L);if(q)if(W){const J=Fi(yt,L);J===P?P=Ec(As(L,C.element)):(C.withBefore(P).insertChild(J),As(L,C.element)),$++,R++}else ja(L,C.withBefore(P)),R++;else P=Ec(uu(w)),Da(w,C.element),$++}const F=Kt.get(L);F!==null&&z(F)&&(an===null&&(an=F.getFormat()),ln===""&&(ln=F.getStyle()))}const k=$>E,I=R>O;if(k&&!I){const w=y[O+1],L=w===void 0?null:yt.getElementByKey(w);cu(y,p,R,O,C.withBefore(L))}else I&&!k&&lu(m,$,E,C.element)})(o,d,h,c,u,a)}xl(o)&&(Fe+=Rn),f.__lexicalTextContent=Fe,Fe=l+Fe}(n,e,e.getDOMSlot(t)),Lm(e,t),i=e,an==null||an===i.__textFormat||Hs||i.setTextFormat(an),function(s){ln===""||ln===s.__textStyle||Hs||s.setTextStyle(ln)}(e),mt=r}function Fa(n,e){const t=[];let r=n.__first;for(;r!==null;){const i=e.get(r);i===void 0&&H(101),t.push(r),r=i.__next}return t}function As(n,e){const t=Br.get(n);let r=Kt.get(n);t!==void 0&&r!==void 0||H(61);const i=$m||ou.has(n)||su.has(n),s=Fi(yt,n);if(t===r&&!i){if(j(t)){const o=s.__lexicalTextContent;o!==void 0&&(Fe+=o,An+=o);const a=s.__lexicalDirTextContent;a!==void 0&&(mt+=a)}else{const o=t.getTextContent();z(t)&&!t.isDirectionless()&&(mt+=o),An+=o,Fe+=o}return s}if(t!==r&&i&&Ud(Ks,Ws,gl,r,"updated"),r.updateDOM(t,s,ir)){const o=ja(n,null);return e===null&&H(62),e.replaceChild(o,s),Da(n,null),o}if(j(t)&&j(r)){const o=r.__indent;o!==t.__indent&&Pm(s,o);const a=r.__format;a!==t.__format&&Im(s,a),i&&(zk(t,r,s),et(r)||r.isInline()||Rm(t,r,s)),xl(r)&&(Fe+=Rn,An+=Rn)}else{const o=r.getTextContent();if(ve(r)){const a=r.decorate(yt,ir);a!==null&&Dm(n,a)}else z(r)&&!r.isDirectionless()&&(mt+=o);Fe+=o,An+=o}if(!Hs&&et(r)&&r.__cachedText!==An){const o=r.getWritable();o.__cachedText=An,r=o}return s}function Dm(n,e){let t=yt._pendingDecorators;const r=yt._decorators;if(t===null){if(r[n]===e)return;t=Sy(yt)}t[n]=e}function Ec(n){let e=n.nextSibling;return e!==null&&e===yt._blockCursorElement&&(e=e.nextSibling),e}function Wk(n,e,t,r,i,s){Fe="",An="",mt="",$m=r===Pi,ba=null,yt=t,ir=t._config,Ws=t._nodes,gl=yt._listeners.mutation,su=i,ou=s,Br=n._nodeMap,Kt=e._nodeMap,Hs=e._readOnly,au=new Map(t._keyToDOMMap);const o=new Map;return Ks=o,As("root",null),yt=void 0,Ws=void 0,su=void 0,ou=void 0,Br=void 0,Kt=void 0,ir=void 0,au=void 0,Ks=void 0,o}function uu(n){const e=au.get(n);return e===void 0&&H(75,n),e}function ie(n){return{type:n}}const fr=ie("SELECTION_CHANGE_COMMAND"),Kk=ie("SELECTION_INSERT_CLIPBOARD_NODES_COMMAND"),jm=ie("CLICK_COMMAND"),hn=ie("DELETE_CHARACTER_COMMAND"),er=ie("INSERT_LINE_BREAK_COMMAND"),Js=ie("INSERT_PARAGRAPH_COMMAND"),$r=ie("CONTROLLED_TEXT_INSERTION_COMMAND"),Zr=ie("PASTE_COMMAND"),qa=ie("REMOVE_TEXT_COMMAND"),Ri=ie("DELETE_WORD_COMMAND"),Li=ie("DELETE_LINE_COMMAND"),Yn=ie("FORMAT_TEXT_COMMAND"),oo=ie("UNDO_COMMAND"),ao=ie("REDO_COMMAND"),Gi=ie("KEYDOWN_COMMAND"),_d=ie("KEY_ARROW_RIGHT_COMMAND"),Hk=ie("MOVE_TO_END"),bd=ie("KEY_ARROW_LEFT_COMMAND"),Jk=ie("MOVE_TO_START"),vd=ie("KEY_ARROW_UP_COMMAND"),kd=ie("KEY_ARROW_DOWN_COMMAND"),Di=ie("KEY_ENTER_COMMAND"),Fm=ie("KEY_SPACE_COMMAND"),xd=ie("KEY_BACKSPACE_COMMAND"),pl=ie("KEY_ESCAPE_COMMAND"),Cd=ie("KEY_DELETE_COMMAND"),wd=ie("KEY_TAB_COMMAND"),Vk=ie("INSERT_TAB_COMMAND"),Gk=ie("INDENT_CONTENT_COMMAND"),Xf=ie("OUTDENT_CONTENT_COMMAND"),ml=ie("DROP_COMMAND"),Yk=ie("FORMAT_ELEMENT_COMMAND"),Sd=ie("DRAGSTART_COMMAND"),qm=ie("DRAGOVER_COMMAND"),Xk=ie("DRAGEND_COMMAND"),hr=ie("COPY_COMMAND"),Qr=ie("CUT_COMMAND"),Ba=ie("SELECT_ALL_COMMAND"),Td=ie("CLEAR_EDITOR_COMMAND"),Bm=ie("CLEAR_HISTORY_COMMAND"),Os=ie("CAN_REDO_COMMAND"),$s=ie("CAN_UNDO_COMMAND"),Zk=ie("FOCUS_COMMAND"),Qk=ie("BLUR_COMMAND"),ex=ie("KEY_MODIFIER_COMMAND"),Sn=Object.freeze({}),du=30,fu=[["keydown",function(n,e){if(Ds=n.timeStamp,Um=n.key,!e.isComposing()&&!Y(e,Gi,n)&&n.key!=null){if(Nc&&Sh(n))return Et(e,()=>{Wo(e,Mc)}),Nc=!1,void(Mc="");if(function(t){return we(t,"ArrowRight",{shiftKey:"any"})}(n))Y(e,_d,n);else if(function(t){return we(t,"ArrowRight",Nn)}(n))Y(e,Hk,n);else if(function(t){return we(t,"ArrowLeft",{shiftKey:"any"})}(n))Y(e,bd,n);else if(function(t){return we(t,"ArrowLeft",Nn)}(n))Y(e,Jk,n);else if(function(t){return we(t,"ArrowUp",{altKey:"any",shiftKey:"any"})}(n))Y(e,vd,n);else if(function(t){return we(t,"ArrowDown",{altKey:"any",shiftKey:"any"})}(n))Y(e,kd,n);else if(function(t){return we(t,"Enter",{altKey:"any",ctrlKey:"any",metaKey:"any",shiftKey:!0})}(n))js=!0,Y(e,Di,n);else if(function(t){return t.key===" "}(n))Y(e,Fm,n);else if(function(t){return cn&&we(t,"o",{ctrlKey:!0})}(n))n.preventDefault(),js=!0,Y(e,er,!0);else if(function(t){return we(t,"Enter",{altKey:"any",ctrlKey:"any",metaKey:"any"})}(n))js=!1,Y(e,Di,n);else if(function(t){return we(t,"Backspace",{shiftKey:"any"})||cn&&we(t,"h",{ctrlKey:!0})}(n))Sh(n)?Y(e,xd,n):(n.preventDefault(),Y(e,hn,!0));else if(function(t){return t.key==="Escape"}(n))Y(e,pl,n);else if(function(t){return we(t,"Delete",{})||cn&&we(t,"d",{ctrlKey:!0})}(n))(function(t){return t.key==="Delete"})(n)?Y(e,Cd,n):(n.preventDefault(),Y(e,hn,!1));else if(function(t){return we(t,"Backspace",wh)}(n))n.preventDefault(),Y(e,Ri,!0);else if(function(t){return we(t,"Delete",wh)}(n))n.preventDefault(),Y(e,Ri,!1);else if(function(t){return cn&&we(t,"Backspace",{metaKey:!0})}(n))n.preventDefault(),Y(e,Li,!0);else if(function(t){return cn&&(we(t,"Delete",{metaKey:!0})||we(t,"k",{ctrlKey:!0}))}(n))n.preventDefault(),Y(e,Li,!1);else if(function(t){return we(t,"b",Nn)}(n))n.preventDefault(),Y(e,Yn,"bold");else if(function(t){return we(t,"u",Nn)}(n))n.preventDefault(),Y(e,Yn,"underline");else if(function(t){return we(t,"i",Nn)}(n))n.preventDefault(),Y(e,Yn,"italic");else if(function(t){return we(t,"Tab",{shiftKey:"any"})}(n))Y(e,wd,n);else if(function(t){return we(t,"z",Nn)}(n))n.preventDefault(),Y(e,oo,void 0);else if(function(t){return cn?we(t,"z",{metaKey:!0,shiftKey:!0}):we(t,"y",{ctrlKey:!0})||we(t,"z",{ctrlKey:!0,shiftKey:!0})}(n))n.preventDefault(),Y(e,ao,void 0);else{const t=e._editorState._selection;t===null||B(t)?Th(n)&&(n.preventDefault(),Y(e,Ba,n)):function(r){return we(r,"c",Nn)}(n)?(n.preventDefault(),Y(e,hr,n)):function(r){return we(r,"x",Nn)}(n)?(n.preventDefault(),Y(e,Qr,n)):Th(n)&&(n.preventDefault(),Y(e,Ba,n))}(function(t){return t.ctrlKey||t.shiftKey||t.altKey||t.metaKey})(n)&&Y(e,ex,n)}}],["pointerdown",function(n,e){const t=n.target,r=n.pointerType;ti(t)&&r!=="touch"&&r!=="pen"&&n.button===0&&Et(e,()=>{kh(t)||(gu=!0)})}],["compositionstart",function(n,e){Et(e,()=>{const t=K();if(B(t)&&!e.isComposing()){const r=t.anchor,i=t.anchor.getNode();Qe(r.key),(n.timeStamp<Ds+du||r.type==="element"||!t.isCollapsed()||i.getFormat()!==t.format||z(i)&&i.getStyle()!==t.style)&&Y(e,$r,Tk)}})}],["compositionend",function(n,e){Fr?ws=!0:$i||!Us&&!Pa?Et(e,()=>{Wo(e,n.data)}):(Nc=!0,Mc=n.data)}],["input",function(n,e){n.stopPropagation(),Et(e,()=>{if(Te(n.target)&&kh(n.target))return;const t=K(),r=n.data,i=Jm(n);if(r!=null&&B(t)&&Km(t,i,r,n.timeStamp,!1)){ws&&(Wo(e,r),ws=!1);const s=t.anchor.getNode(),o=Gt(jt(e));if(o===null)return;const a=t.isBackward(),l=a?t.anchor.offset:t.focus.offset,c=a?t.focus.offset:t.anchor.offset;$a&&!t.isCollapsed()&&z(s)&&o.anchorNode!==null&&s.getTextContent().slice(0,l)+r+s.getTextContent().slice(l+c)===My(o.anchorNode)||Y(e,$r,r);const u=r.length;Fr&&u>1&&n.inputType==="insertCompositionText"&&!e.isComposing()&&(t.anchor.offset-=u),Us||$i||Pa||!e.isComposing()||(Ds=0,Qe(null))}else qd(!1,e,r!==null?r:void 0),ws&&(Wo(e,r||void 0),ws=!1);(function(){Ze();const s=$e();Tm(s)})()},{event:n}),vi=null}],["click",function(n,e){Et(e,()=>{const t=K(),r=Gt(jt(e)),i=Xi();if(r){if(B(t)){const s=t.anchor,o=s.getNode();if(s.type==="element"&&s.offset===0&&t.isCollapsed()&&!et(o)&&pe().getChildrenSize()===1&&o.getTopLevelElementOrThrow().isEmpty()&&i!==null&&t.is(i))r.removeAllRanges(),t.dirty=!0;else if(n.detail===3&&!t.isCollapsed()&&o!==t.focus.getNode()){const a=function(l,c){let u=l;for(;u!==pe()&&u!=null;){if(c(u))return u;u=u.getParent()}return null}(o,l=>j(l)&&!l.isInline());j(a)&&a.select(0)}}else if(n.pointerType==="touch"||n.pointerType==="pen"){const s=r.anchorNode;(Te(s)||qn(s))&&it(Md(i,r,e,n))}}Y(e,jm,n)})}],["cut",Sn],["copy",Sn],["dragstart",Sn],["dragover",Sn],["dragend",Sn],["paste",Sn],["focus",Sn],["blur",Sn],["drop",Sn]];$a&&fu.push(["beforeinput",(n,e)=>function(t,r){const i=t.inputType,s=Jm(t);i==="deleteCompositionText"||Fr&&Oy(r)||i!=="insertCompositionText"&&Et(r,()=>{const o=K();if(i==="deleteContentBackward"){if(o===null){const h=Xi();if(!B(h))return;it(h.clone())}if(B(o)){const h=o.anchor.key===o.focus.key;if(a=t.timeStamp,Um==="MediaLast"&&a<Ds+du&&r.isComposing()&&h){if(Qe(null),Ds=0,setTimeout(()=>{Et(r,()=>{Qe(null)})},du),B(o)){const p=o.anchor.getNode();p.markDirty(),z(p)||H(142),Hm(o,p)}}else{Qe(null),t.preventDefault();const p=o.anchor.getNode(),m=p.getTextContent(),y=p.canInsertTextAfter(),b=o.anchor.offset===0&&o.focus.offset===m.length;let _=Ff&&h&&!b&&y;if(_&&o.isCollapsed()&&(_=!ve(vu(o.anchor,!0))),!_){Y(r,hn,!0);const C=K();Ff&&B(C)&&C.isCollapsed()&&(Or=C,setTimeout(()=>Or=null))}}return}}var a;if(!B(o))return;const l=t.data;vi!==null&&qd(!1,r,vi),o.dirty&&vi===null||!o.isCollapsed()||et(o.anchor.getNode())||s===null||o.applyDOMRange(s),vi=null;const c=o.anchor,u=o.focus,f=c.getNode(),d=u.getNode();if(i!=="insertText"&&i!=="insertTranspose")switch(t.preventDefault(),i){case"insertFromYank":case"insertFromDrop":case"insertReplacementText":Y(r,$r,t);break;case"insertFromComposition":Qe(null),Y(r,$r,t);break;case"insertLineBreak":Qe(null),Y(r,er,!1);break;case"insertParagraph":Qe(null),js&&!$i?(js=!1,Y(r,er,!1)):Y(r,Js,void 0);break;case"insertFromPaste":case"insertFromPasteAsQuotation":Y(r,Zr,t);break;case"deleteByComposition":(function(h,p){return h!==p||j(h)||j(p)||!Rr(h)||!Rr(p)})(f,d)&&Y(r,qa,t);break;case"deleteByDrag":case"deleteByCut":Y(r,qa,t);break;case"deleteContent":Y(r,hn,!1);break;case"deleteWordBackward":Y(r,Ri,!0);break;case"deleteWordForward":Y(r,Ri,!1);break;case"deleteHardLineBackward":case"deleteSoftLineBackward":Y(r,Li,!0);break;case"deleteContentForward":case"deleteHardLineForward":case"deleteSoftLineForward":Y(r,Li,!1);break;case"formatStrikeThrough":Y(r,Yn,"strikethrough");break;case"formatBold":Y(r,Yn,"bold");break;case"formatItalic":Y(r,Yn,"italic");break;case"formatUnderline":Y(r,Yn,"underline");break;case"historyUndo":Y(r,oo,void 0);break;case"historyRedo":Y(r,ao,void 0)}else{if(l===`
`)t.preventDefault(),Y(r,er,!1);else if(l===Rn)t.preventDefault(),Y(r,Js,void 0);else if(l==null&&t.dataTransfer){const h=t.dataTransfer.getData("text/plain");t.preventDefault(),o.insertRawText(h)}else l!=null&&Km(o,s,l,t.timeStamp,!0)?(t.preventDefault(),Y(r,$r,l)):vi=l;zm=t.timeStamp}})}(n,e)]);let Ds=0,Um=null,zm=0,vi=null;const Ua=new WeakMap;let hu=!1,gu=!1,js=!1,ws=!1,Nc=!1,Mc="",Or=null,Wm=[0,"",0,"root",0];function Km(n,e,t,r,i){const s=n.anchor,o=n.focus,a=s.getNode(),l=$e(),c=Gt(jt(l)),u=c!==null?c.anchorNode:null,f=s.key,d=l.getElementByKey(f),h=t.length;return f!==o.key||!z(a)||(!i&&(!$a||zm<r+50)||a.isDirty()&&h<2||Ey(t))&&s.offset!==o.offset&&!a.isComposing()||Mn(a)||a.isDirty()&&h>1||(i||!$a)&&d!==null&&!a.isComposing()&&u!==ji(d)||c!==null&&e!==null&&(!e.collapsed||e.startContainer!==c.anchorNode||e.startOffset!==c.anchorOffset)||a.getFormat()!==n.format||a.getStyle()!==n.style||function(p,m){if(m.isSegmented())return!0;if(!p.isCollapsed())return!1;const y=p.anchor.offset,b=m.getParentOrThrow(),_=Rr(m);return y===0?!m.canInsertTextBefore()||!b.canInsertTextBefore()&&!m.isComposing()||_||function(C){const E=C.getPreviousSibling();return(z(E)||j(E)&&E.isInline())&&!E.canInsertTextAfter()}(m):y===m.getTextContentSize()&&(!m.canInsertTextAfter()||!b.canInsertTextAfter()&&!m.isComposing()||_)}(n,a)}function Zf(n,e){return qn(n)&&n.nodeValue!==null&&e!==0&&e!==n.nodeValue.length}function Qf(n,e,t){const{anchorNode:r,anchorOffset:i,focusNode:s,focusOffset:o}=n;hu&&(hu=!1,Zf(r,i)&&Zf(s,o)&&!Or)||Et(e,()=>{if(!t)return void it(null);if(!ho(e,r,s))return;let a=K();if(Or&&B(a)&&a.isCollapsed()){const l=a.anchor,c=Or.anchor;(l.key===c.key&&l.offset===c.offset+1||l.offset===1&&c.getNode().is(l.getNode().getPreviousSibling()))&&(a=Or.clone(),it(a))}if(Or=null,B(a)){const l=a.anchor,c=l.getNode();if(a.isCollapsed()){n.type==="Range"&&n.anchorNode===n.focusNode&&(a.dirty=!0);const u=jt(e).event,f=u?u.timeStamp:performance.now(),[d,h,p,m,y]=Wm,b=pe(),_=e.isComposing()===!1&&b.getTextContent()==="";if(f<y+200&&l.offset===p&&l.key===m)va(a,d,h);else if(l.type==="text")z(c)||H(141),Hm(a,c);else if(l.type==="element"&&!_){j(c)||H(259);const C=l.getNode();C.isEmpty()?function(E,O){const N=O.getTextFormat(),D=O.getTextStyle();va(E,N,D)}(a,C):va(a,0,"")}}else{const u=l.key,f=a.focus.key,d=a.getNodes(),h=d.length,p=a.isBackward(),m=p?o:i,y=p?i:o,b=p?f:u,_=p?u:f;let C=Sk,E=!1;for(let O=0;O<h;O++){const N=d[O],D=N.getTextContentSize();if(z(N)&&D!==0&&!(O===0&&N.__key===b&&m===D||O===h-1&&N.__key===_&&y===0)&&(E=!0,C&=N.getFormat(),C===0))break}a.format=E?C:0}}Y(e,fr,void 0)})}function va(n,e,t){n.format===e&&n.style===t||(n.format=e,n.style=t,n.dirty=!0)}function Hm(n,e){va(n,e.getFormat(),e.getStyle())}function Jm(n){if(!n.getTargetRanges)return null;const e=n.getTargetRanges();return e.length===0?null:e[0]}function Wo(n,e){const t=n._compositionKey;if(Qe(null),t!==null&&e!=null){if(e===""){const r=de(t),i=ji(n.getElementByKey(t));return void(i!==null&&i.nodeValue!==null&&z(r)&&Bd(r,i.nodeValue,null,null,!0))}if(e[e.length-1]===`
`){const r=K();if(B(r)){const i=r.focus;return r.anchor.set(i.key,i.offset,i.type),void Y(n,Di,null)}}}qd(!0,n,e)}function Vm(n){let e=n.__lexicalEventHandles;return e===void 0&&(e=[],n.__lexicalEventHandles=e),e}const wi=new Map;function Gm(n){const e=Ox(n.target);if(e===null)return;const t=Cy(e.anchorNode);if(t===null)return;gu&&(gu=!1,Et(t,()=>{const l=Xi(),c=e.anchorNode;(Te(c)||qn(c))&&it(Md(l,e,t,n))}));const r=Fd(t),i=r[r.length-1],s=i._key,o=wi.get(s),a=o||i;a!==t&&Qf(e,a,!1),Qf(e,t,!0),t!==i?wi.set(s,t):o&&wi.delete(s)}function eh(n){n._lexicalHandled=!0}function th(n){return n._lexicalHandled===!0}function tx(n){const e=n.ownerDocument,t=Ua.get(e);if(t===void 0)return;const r=t-1;r>=0||H(164),Ua.set(e,r),r===0&&e.removeEventListener("selectionchange",Gm);const i=vl(n);jd(i)?(function(o){if(o._parentEditor!==null){const a=Fd(o),l=a[a.length-1]._key;wi.get(l)===o&&wi.delete(l)}else wi.delete(o._key)}(i),n.__lexicalEditor=null):i&&H(198);const s=Vm(n);for(let o=0;o<s.length;o++)s[o]();n.__lexicalEventHandles=[]}function pu(n,e,t){Ze();const r=n.__key,i=n.getParent();if(i===null)return;const s=function(a){const l=K();if(!B(l)||!j(a))return l;const{anchor:c,focus:u}=l,f=c.getNode(),d=u.getNode();return ku(f,a)&&c.set(a.__key,0,"element"),ku(d,a)&&u.set(a.__key,0,"element"),l}(n);let o=!1;if(B(s)&&e){const a=s.anchor,l=s.focus;a.key===r&&(Wa(a,n,i,n.getPreviousSibling(),n.getNextSibling()),o=!0),l.key===r&&(Wa(l,n,i,n.getPreviousSibling(),n.getNextSibling()),o=!0)}else pt(s)&&e&&n.isSelected()&&n.selectPrevious();if(B(s)&&e&&!o){const a=n.getIndexWithinParent();Lr(n),za(s,i,a,-1)}else Lr(n);t||bn(i)||i.canBeEmpty()||!i.isEmpty()||pu(i,e),e&&s&&et(i)&&i.isEmpty()&&i.selectEnd()}let Yi=class{static getType(){const{ownNodeType:e}=Kd(this);return e===void 0&&H(64,this.name),e}static clone(e){H(65,this.name)}$config(){return{}}config(e,t){const r=t.extends||Object.getPrototypeOf(this.constructor);return Object.assign(t,{extends:r,type:e}),{[e]:t}}afterCloneFrom(e){this.__key===e.__key?(this.__parent=e.__parent,this.__next=e.__next,this.__prev=e.__prev,this.__state=e.__state):e.__state&&(this.__state=e.__state.getWritable(this))}constructor(e){this.__type=this.constructor.getType(),this.__parent=null,this.__prev=null,this.__next=null,Object.defineProperty(this,"__state",{configurable:!0,enumerable:!1,value:void 0,writable:!0}),wx(this,e)}getType(){return this.__type}isInline(){H(137,this.constructor.name)}isAttached(){let e=this.__key;for(;e!==null;){if(e==="root")return!0;const t=de(e);if(t===null)break;e=t.__parent}return!1}isSelected(e){const t=e||K();if(t==null)return!1;const r=t.getNodes().some(i=>i.__key===this.__key);if(z(this))return r;if(B(t)&&t.anchor.type==="element"&&t.focus.type==="element"){if(t.isCollapsed())return!1;const i=this.getParent();if(ve(this)&&this.isInline()&&i){const s=t.isBackward()?t.focus:t.anchor;if(i.is(s.getNode())&&s.offset===i.getChildrenSize()&&this.is(i.getLastChild()))return!1}}return r}getKey(){return this.__key}getIndexWithinParent(){const e=this.getParent();if(e===null)return-1;let t=e.getFirstChild(),r=0;for(;t!==null;){if(this.is(t))return r;r++,t=t.getNextSibling()}return-1}getParent(){const e=this.getLatest().__parent;return e===null?null:de(e)}getParentOrThrow(){const e=this.getParent();return e===null&&H(66,this.__key),e}getTopLevelElement(){let e=this;for(;e!==null;){const t=e.getParent();if(bn(t))return j(e)||e===this&&ve(e)||H(194),e;e=t}return null}getTopLevelElementOrThrow(){const e=this.getTopLevelElement();return e===null&&H(67,this.__key),e}getParents(){const e=[];let t=this.getParent();for(;t!==null;)e.push(t),t=t.getParent();return e}getParentKeys(){const e=[];let t=this.getParent();for(;t!==null;)e.push(t.__key),t=t.getParent();return e}getPreviousSibling(){const e=this.getLatest().__prev;return e===null?null:de(e)}getPreviousSiblings(){const e=[],t=this.getParent();if(t===null)return e;let r=t.getFirstChild();for(;r!==null&&!r.is(this);)e.push(r),r=r.getNextSibling();return e}getNextSibling(){const e=this.getLatest().__next;return e===null?null:de(e)}getNextSiblings(){const e=[];let t=this.getNextSibling();for(;t!==null;)e.push(t),t=t.getNextSibling();return e}getCommonAncestor(e){const t=j(this)?this:this.getParent(),r=j(e)?e:e.getParent(),i=t&&r?qs(t,r):null;return i?i.commonAncestor:null}is(e){return e!=null&&this.__key===e.__key}isBefore(e){const t=qs(this,e);return t!==null&&(t.type==="descendant"||(t.type==="branch"?jy(t)===-1:(t.type!=="same"&&t.type!=="ancestor"&&H(279),!1)))}isParentOf(e){const t=qs(this,e);return t!==null&&t.type==="ancestor"}getNodesBetween(e){const t=this.isBefore(e),r=[],i=new Set;let s=this;for(;s!==null;){const o=s.__key;if(i.has(o)||(i.add(o),r.push(s)),s===e)break;const a=j(s)?t?s.getFirstChild():s.getLastChild():null;if(a!==null){s=a;continue}const l=t?s.getNextSibling():s.getPreviousSibling();if(l!==null){s=l;continue}const c=s.getParentOrThrow();if(i.has(c.__key)||r.push(c),c===e)break;let u=null,f=c;do{if(f===null&&H(68),u=t?f.getNextSibling():f.getPreviousSibling(),f=f.getParent(),f===null)break;u!==null||i.has(f.__key)||r.push(f)}while(u===null);s=u}return t||r.reverse(),r}isDirty(){const e=$e()._dirtyLeaves;return e!==null&&e.has(this.__key)}getLatest(){const e=de(this.__key);return e===null&&H(113),e}getWritable(){Ze();const e=gr(),t=$e(),r=e._nodeMap,i=this.__key,s=this.getLatest(),o=t._cloneNotNeeded,a=K();if(a!==null&&a.setCachedNodes(null),o.has(i))return Ha(s),s;const l=Wd(s);return o.add(i),Ha(l),r.set(i,l),l}getTextContent(){return""}getTextContentSize(){return this.getTextContent().length}createDOM(e,t){H(70)}updateDOM(e,t,r){H(71)}exportDOM(e){return{element:this.createDOM(e._config,e)}}exportJSON(){const e=this.__state?this.__state.toJSON():void 0;return{type:this.__type,version:1,...e}}static importJSON(e){H(18,this.name)}updateFromJSON(e){return function(t,r){const i=t.getWritable(),s=r.$;let o=s;for(const a of Om(i).flatKeys)a in r&&(o!==void 0&&o!==s||(o={...s}),o[a]=r[a]);return(i.__state||o)&&Am(t).updateFromJSON(o),i}(this,e)}static transform(){return null}remove(e){pu(this,!0,e)}replace(e,t){Ze();let r=K();r!==null&&(r=r.clone()),Rc(this,e);const i=this.getLatest(),s=this.__key,o=e.__key,a=e.getWritable(),l=this.getParentOrThrow().getWritable(),c=l.__size;Lr(a);const u=i.getPreviousSibling(),f=i.getNextSibling(),d=i.__prev,h=i.__next,p=i.__parent;if(pu(i,!1,!0),u===null?l.__first=o:u.getWritable().__next=o,a.__prev=d,f===null?l.__last=o:f.getWritable().__prev=o,a.__next=h,a.__parent=p,l.__size=c,t&&(j(this)&&j(a)||H(139),this.getChildren().forEach(m=>{a.append(m)})),B(r)){it(r);const m=r.anchor,y=r.focus;m.key===s&&sh(m,a),y.key===s&&sh(y,a)}return Xn()===s&&Qe(o),a}insertAfter(e,t=!0){Ze(),Rc(this,e);const r=this.getWritable(),i=e.getWritable(),s=i.getParent(),o=K();let a=!1,l=!1;if(s!==null){const h=e.getIndexWithinParent();if(Lr(i),B(o)){const p=s.__key,m=o.anchor,y=o.focus;a=m.type==="element"&&m.key===p&&m.offset===h+1,l=y.type==="element"&&y.key===p&&y.offset===h+1}}const c=this.getNextSibling(),u=this.getParentOrThrow().getWritable(),f=i.__key,d=r.__next;if(c===null?u.__last=f:c.getWritable().__prev=f,u.__size++,r.__next=f,i.__next=d,i.__prev=r.__key,i.__parent=r.__parent,t&&B(o)){const h=this.getIndexWithinParent();za(o,u,h+1);const p=u.__key;a&&o.anchor.set(p,h+2,"element"),l&&o.focus.set(p,h+2,"element")}return e}insertBefore(e,t=!0){Ze(),Rc(this,e);const r=this.getWritable(),i=e.getWritable(),s=i.__key;Lr(i);const o=this.getPreviousSibling(),a=this.getParentOrThrow().getWritable(),l=r.__prev,c=this.getIndexWithinParent();o===null?a.__first=s:o.getWritable().__next=s,a.__size++,r.__prev=s,i.__prev=l,i.__next=r.__key,i.__parent=r.__parent;const u=K();return t&&B(u)&&za(u,this.getParentOrThrow(),c),e}isParentRequired(){return!1}createParentElementNode(){return Ot()}selectStart(){return this.selectPrevious()}selectEnd(){return this.selectNext(0,0)}selectPrevious(e,t){Ze();const r=this.getPreviousSibling(),i=this.getParentOrThrow();if(r===null)return i.select(0,0);if(j(r))return r.select();if(!z(r)){const s=r.getIndexWithinParent()+1;return i.select(s,s)}return r.select(e,t)}selectNext(e,t){Ze();const r=this.getNextSibling(),i=this.getParentOrThrow();if(r===null)return i.select();if(j(r))return r.select(0,0);if(!z(r)){const s=r.getIndexWithinParent();return i.select(s,s)}return r.select(e,t)}markDirty(){this.getWritable()}reconcileObservedMutation(e,t){this.markDirty()}},lo=class Ym extends Yi{static getType(){return"linebreak"}static clone(e){return new Ym(e.__key)}constructor(e){super(e)}getTextContent(){return`
`}createDOM(){return document.createElement("br")}updateDOM(){return!1}isInline(){return!0}static importDOM(){return{br:e=>function(t){const r=t.parentElement;if(r!==null&&Ja(r)){const i=r.firstChild;if(i===t||i.nextSibling===t&&Ko(i)){const s=r.lastChild;if(s===t||s.previousSibling===t&&Ko(s))return!0}}return!1}(e)||function(t){const r=t.parentElement;if(r!==null&&Ja(r)){const i=r.firstChild;if(i===t||i.nextSibling===t&&Ko(i))return!1;const s=r.lastChild;if(s===t||s.previousSibling===t&&Ko(s))return!0}return!1}(e)?null:{conversion:nx,priority:0}}}static importJSON(e){return Ur().updateFromJSON(e)}};function nx(n){return{node:Ur()}}function Ur(){return Me(new lo)}function Pr(n){return n instanceof lo}function Ko(n){return qn(n)&&/^( |\t|\r?\n)+$/.test(n.textContent||"")}function Ac(n,e){return 16&e?"code":e&ud?"mark":32&e?"sub":64&e?"sup":null}function Oc(n,e){return 1&e?"strong":2&e?"em":"span"}function Xm(n,e,t,r,i){const s=r.classList;let o=Ti(i,"base");o!==void 0&&s.add(...o),o=Ti(i,"underlineStrikethrough");let a=!1;const l=e&La&&e&Ra;o!==void 0&&(t&La&&t&Ra?(a=!0,l||s.add(...o)):l&&s.remove(...o));for(const c in rr){const u=rr[c];if(o=Ti(i,c),o!==void 0)if(t&u){if(a&&(c==="underline"||c==="strikethrough")){e&u&&s.remove(...o);continue}e&u&&(!l||c!=="underline")&&c!=="strikethrough"||s.add(...o)}else e&u&&s.remove(...o)}}function Zm(n,e,t){const r=e.firstChild,i=t.isComposing(),s=n+(i?hl:"");if(r==null)e.textContent=s;else{const o=r.nodeValue;if(o!==s)if(i||Fr){const[a,l,c]=function(u,f){const d=u.length,h=f.length;let p=0,m=0;for(;p<d&&p<h&&u[p]===f[p];)p++;for(;m+p<d&&m+p<h&&u[d-m-1]===f[h-m-1];)m++;return[p,d-p-m,f.slice(p,h-m)]}(o,s);l!==0&&r.deleteData(a,l),r.insertData(a,c)}else r.nodeValue=s}}function nh(n,e,t,r,i,s){Zm(i,n,e);const o=s.theme.text;o!==void 0&&Xm(0,0,r,n,o)}function Ho(n,e){const t=document.createElement(e);return t.appendChild(n),t}let At=class Qm extends Yi{static getType(){return"text"}static clone(e){return new Qm(e.__text,e.__key)}afterCloneFrom(e){super.afterCloneFrom(e),this.__text=e.__text,this.__format=e.__format,this.__style=e.__style,this.__mode=e.__mode,this.__detail=e.__detail}constructor(e="",t){super(t),this.__text=e,this.__format=0,this.__style="",this.__mode=0,this.__detail=0}getFormat(){return this.getLatest().__format}getDetail(){return this.getLatest().__detail}getMode(){const e=this.getLatest();return $k[e.__mode]}getStyle(){return this.getLatest().__style}isToken(){return this.getLatest().__mode===1}isComposing(){return this.__key===Xn()}isSegmented(){return this.getLatest().__mode===2}isDirectionless(){return!!(1&this.getLatest().__detail)}isUnmergeable(){return!!(2&this.getLatest().__detail)}hasFormat(e){const t=rr[e];return!!(this.getFormat()&t)}isSimpleText(){return this.__type==="text"&&this.__mode===0}getTextContent(){return this.getLatest().__text}getFormatFlags(e,t){return Ka(this.getLatest().__format,e,t)}canHaveFormat(){return!0}isInline(){return!0}createDOM(e,t){const r=this.__format,i=Ac(0,r),s=Oc(0,r),o=i===null?s:i,a=document.createElement(o);let l=a;this.hasFormat("code")&&a.setAttribute("spellcheck","false"),i!==null&&(l=document.createElement(s),a.appendChild(l)),nh(l,this,0,r,this.__text,e);const c=this.__style;return c!==""&&(a.style.cssText=c),a}updateDOM(e,t,r){const i=this.__text,s=e.__format,o=this.__format,a=Ac(0,s),l=Ac(0,o),c=Oc(0,s),u=Oc(0,o);if((a===null?c:a)!==(l===null?u:l))return!0;if(a===l&&c!==u){const m=t.firstChild;m==null&&H(48);const y=document.createElement(u);return nh(y,this,0,o,i,r),t.replaceChild(y,m),!1}let f=t;l!==null&&a!==null&&(f=t.firstChild,f==null&&H(49)),Zm(i,f,this);const d=r.theme.text;d!==void 0&&s!==o&&Xm(0,s,o,f,d);const h=e.__style,p=this.__style;return h!==p&&(t.style.cssText=p),!1}static importDOM(){return{"#text":()=>({conversion:ox,priority:0}),b:()=>({conversion:ix,priority:0}),code:()=>({conversion:Tn,priority:0}),em:()=>({conversion:Tn,priority:0}),i:()=>({conversion:Tn,priority:0}),mark:()=>({conversion:Tn,priority:0}),s:()=>({conversion:Tn,priority:0}),span:()=>({conversion:rx,priority:0}),strong:()=>({conversion:Tn,priority:0}),sub:()=>({conversion:Tn,priority:0}),sup:()=>({conversion:Tn,priority:0}),u:()=>({conversion:Tn,priority:0})}}static importJSON(e){return ue().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setTextContent(e.text).setFormat(e.format).setDetail(e.detail).setMode(e.mode).setStyle(e.style)}exportDOM(e){let{element:t}=super.exportDOM(e);return Te(t)||H(132),t.style.whiteSpace="pre-wrap",this.hasFormat("lowercase")?t.style.textTransform="lowercase":this.hasFormat("uppercase")?t.style.textTransform="uppercase":this.hasFormat("capitalize")&&(t.style.textTransform="capitalize"),this.hasFormat("bold")&&(t=Ho(t,"b")),this.hasFormat("italic")&&(t=Ho(t,"i")),this.hasFormat("strikethrough")&&(t=Ho(t,"s")),this.hasFormat("underline")&&(t=Ho(t,"u")),{element:t}}exportJSON(){return{detail:this.getDetail(),format:this.getFormat(),mode:this.getMode(),style:this.getStyle(),text:this.getTextContent(),...super.exportJSON()}}selectionTransform(e,t){}setFormat(e){const t=this.getWritable();return t.__format=typeof e=="string"?rr[e]:e,t}setDetail(e){const t=this.getWritable();return t.__detail=typeof e=="string"?Mk[e]:e,t}setStyle(e){const t=this.getWritable();return t.__style=e,t}toggleFormat(e){const t=Ka(this.getFormat(),e,null);return this.setFormat(t)}toggleDirectionless(){const e=this.getWritable();return e.__detail^=1,e}toggleUnmergeable(){const e=this.getWritable();return e.__detail^=2,e}setMode(e){const t=Ok[e];if(this.__mode===t)return this;const r=this.getWritable();return r.__mode=t,r}setTextContent(e){if(this.__text===e)return this;const t=this.getWritable();return t.__text=e,t}select(e,t){Ze();let r=e,i=t;const s=K(),o=this.getTextContent(),a=this.__key;if(typeof o=="string"){const l=o.length;r===void 0&&(r=l),i===void 0&&(i=l)}else r=0,i=0;if(!B(s))return ay(a,r,a,i,"text","text");{const l=Xn();l!==s.anchor.key&&l!==s.focus.key||Qe(a),s.setTextNodeRange(this,r,this,i)}return s}selectStart(){return this.select(0,0)}selectEnd(){const e=this.getTextContentSize();return this.select(e,e)}spliceText(e,t,r,i){const s=this.getWritable(),o=s.__text,a=r.length;let l=e;l<0&&(l=a+l,l<0&&(l=0));const c=K();if(i&&B(c)){const f=e+a;c.setTextNodeRange(s,f,s,f)}const u=o.slice(0,l)+r+o.slice(l+t);return s.__text=u,s}canInsertTextBefore(){return!0}canInsertTextAfter(){return!0}splitText(...e){Ze();const t=this.getLatest(),r=t.getTextContent();if(r==="")return[];const i=t.__key,s=Xn(),o=r.length;e.sort((P,$)=>P-$),e.push(o);const a=[],l=e.length;for(let P=0,$=0;P<o&&$<=l;$++){const R=e[$];R>P&&(a.push(r.slice(P,R)),P=R)}const c=a.length;if(c===1)return[t];const u=a[0],f=t.getParent();let d;const h=t.getFormat(),p=t.getStyle(),m=t.__detail;let y=!1,b=null,_=null;const C=K();if(B(C)){const[P,$]=C.isBackward()?[C.focus,C.anchor]:[C.anchor,C.focus];P.type==="text"&&P.key===i&&(b=P),$.type==="text"&&$.key===i&&(_=$)}t.isSegmented()?(d=ue(u),d.__format=h,d.__style=p,d.__detail=m,d.__state=Kf(t,d),y=!0):d=t.setTextContent(u);const E=[d];for(let P=1;P<c;P++){const $=ue(a[P]);$.__format=h,$.__style=p,$.__detail=m,$.__state=Kf(t,$);const R=$.__key;s===i&&Qe(R),E.push($)}const O=b?b.offset:null,N=_?_.offset:null;let D=0;for(const P of E){if(!b&&!_)break;const $=D+P.getTextContentSize();if(b!==null&&O!==null&&O<=$&&O>=D&&(b.set(P.getKey(),O-D,"text"),O<$&&(b=null)),_!==null&&N!==null&&N<=$&&N>=D){_.set(P.getKey(),N-D,"text");break}D=$}if(f!==null){(function(R){const k=R.getPreviousSibling(),I=R.getNextSibling();k!==null&&Ha(k),I!==null&&Ha(I)})(this);const P=f.getWritable(),$=this.getIndexWithinParent();y?(P.splice($,0,E),this.remove()):P.splice($,1,E),B(C)&&za(C,f,$,c-1)}return E}mergeWithSibling(e){const t=e===this.getPreviousSibling();t||e===this.getNextSibling()||H(50);const r=this.__key,i=e.__key,s=this.__text,o=s.length;Xn()===i&&Qe(r);const a=K();if(B(a)){const f=a.anchor,d=a.focus;f!==null&&f.key===i&&fh(f,t,r,e,o),d!==null&&d.key===i&&fh(d,t,r,e,o)}const l=e.__text,c=t?l+s:s+l;this.setTextContent(c);const u=this.getWritable();return e.remove(),u}isTextEntity(){return!1}};function rx(n){return{forChild:Ed(n.style),node:null}}function ix(n){const e=n,t=e.style.fontWeight==="normal";return{forChild:Ed(e.style,t?void 0:"bold"),node:null}}const rh=new WeakMap;function sx(n){if(!Te(n))return!1;if(n.nodeName==="PRE")return!0;const e=n.style.whiteSpace;return typeof e=="string"&&e.startsWith("pre")}function ox(n){const e=n;n.parentElement===null&&H(129);let t=e.textContent||"";if(function(r){let i,s=r.parentNode;const o=[r];for(;s!==null&&(i=rh.get(s))===void 0&&!sx(s);)o.push(s),s=s.parentNode;const a=i===void 0?s:i;for(let l=0;l<o.length;l++)rh.set(o[l],a);return a}(e)!==null){const r=t.split(/(\r?\n|\t)/),i=[],s=r.length;for(let o=0;o<s;o++){const a=r[o];a===`
`||a===`\r
`?i.push(Ur()):a==="	"?i.push(co()):a!==""&&i.push(ue(a))}return{node:i}}if(t=t.replace(/\r/g,"").replace(/[ \t\n]+/g," "),t==="")return{node:null};if(t[0]===" "){let r=e,i=!0;for(;r!==null&&(r=ih(r,!1))!==null;){const s=r.textContent||"";if(s.length>0){/[ \t\n]$/.test(s)&&(t=t.slice(1)),i=!1;break}}i&&(t=t.slice(1))}if(t[t.length-1]===" "){let r=e,i=!0;for(;r!==null&&(r=ih(r,!0))!==null;)if((r.textContent||"").replace(/^( |\t|\r?\n)+/,"").length>0){i=!1;break}i&&(t=t.slice(0,t.length-1))}return t===""?{node:null}:{node:ue(t)}}function ih(n,e){let t=n;for(;;){let r;for(;(r=e?t.nextSibling:t.previousSibling)===null;){const s=t.parentElement;if(s===null)return null;t=s}if(t=r,Te(t)){const s=t.style.display;if(s===""&&!wu(t)||s!==""&&!s.startsWith("inline"))return null}let i=t;for(;(i=e?t.firstChild:t.lastChild)!==null;)t=i;if(qn(t))return t;if(t.nodeName==="BR")return null}}const ax={code:"code",em:"italic",i:"italic",mark:"highlight",s:"strikethrough",strong:"bold",sub:"subscript",sup:"superscript",u:"underline"};function Tn(n){const e=ax[n.nodeName.toLowerCase()];return e===void 0?{node:null}:{forChild:Ed(n.style,e),node:null}}function ue(n=""){return Me(new At(n))}function z(n){return n instanceof At}function Ed(n,e){const t=n.fontWeight,r=n.textDecoration.split(" "),i=t==="700"||t==="bold",s=r.includes("line-through"),o=n.fontStyle==="italic",a=r.includes("underline"),l=n.verticalAlign;return c=>(z(c)&&(i&&!c.hasFormat("bold")&&c.toggleFormat("bold"),s&&!c.hasFormat("strikethrough")&&c.toggleFormat("strikethrough"),o&&!c.hasFormat("italic")&&c.toggleFormat("italic"),a&&!c.hasFormat("underline")&&c.toggleFormat("underline"),l!=="sub"||c.hasFormat("subscript")||c.toggleFormat("subscript"),l!=="super"||c.hasFormat("superscript")||c.toggleFormat("superscript"),e&&!c.hasFormat(e)&&c.toggleFormat(e)),c)}let Nd=class ey extends At{static getType(){return"tab"}static clone(e){return new ey(e.__key)}constructor(e){super("	",e),this.__detail=2}static importDOM(){return null}createDOM(e){const t=super.createDOM(e),r=Ti(e.theme,"tab");return r!==void 0&&t.classList.add(...r),t}static importJSON(e){return co().updateFromJSON(e)}setTextContent(e){return e!=="	"&&e!==""&&H(126),super.setTextContent("	")}spliceText(e,t,r,i){return r===""&&t===0||r==="	"&&t===1||H(286),this}setDetail(e){return e!==2&&H(127),this}setMode(e){return e!=="normal"&&H(128),this}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}};function co(){return Me(new Nd)}function ty(n){return n instanceof Nd}let lx=class{constructor(e,t,r){this._selection=null,this.key=e,this.offset=t,this.type=r}is(e){return this.key===e.key&&this.offset===e.offset&&this.type===e.type}isBefore(e){return this.key===e.key?this.offset<e.offset:Dy(fn(Ln(this,"next")),fn(Ln(e,"next")))<0}getNode(){const e=de(this.key);return e===null&&H(20),e}set(e,t,r,i){const s=this._selection,o=this.key;i&&this.key===e&&this.offset===t&&this.type===r||(this.key=e,this.offset=t,this.type=r,Zi()||(Xn()===o&&Qe(e),s!==null&&(s.setCachedNodes(null),s.dirty=!0)))}};function wt(n,e,t){return new lx(n,e,t)}function $c(n,e){let t=e.__key,r=n.offset,i="element";if(z(e)){i="text";const s=e.getTextContentSize();r>s&&(r=s)}else if(!j(e)){const s=e.getNextSibling();if(z(s))t=s.__key,r=0,i="text";else{const o=e.getParent();o&&(t=o.__key,r=e.getIndexWithinParent()+1)}}n.set(t,r,i)}function sh(n,e){if(j(e)){const t=e.getLastDescendant();j(t)||z(t)?$c(n,t):$c(n,e)}else $c(n,e)}let ny=class ry{constructor(e){this._cachedNodes=null,this._nodes=e,this.dirty=!1}getCachedNodes(){return this._cachedNodes}setCachedNodes(e){this._cachedNodes=e}is(e){if(!pt(e))return!1;const t=this._nodes,r=e._nodes;return t.size===r.size&&Array.from(t).every(i=>r.has(i))}isCollapsed(){return!1}isBackward(){return!1}getStartEndPoints(){return null}add(e){this.dirty=!0,this._nodes.add(e),this._cachedNodes=null}delete(e){this.dirty=!0,this._nodes.delete(e),this._cachedNodes=null}clear(){this.dirty=!0,this._nodes.clear(),this._cachedNodes=null}has(e){return this._nodes.has(e)}clone(){return new ry(new Set(this._nodes))}extract(){return this.getNodes()}insertRawText(e){}insertText(){}insertNodes(e){const t=this.getNodes(),r=t.length,i=t[r-1];let s;if(z(i))s=i.select();else{const o=i.getIndexWithinParent()+1;s=i.getParentOrThrow().select(o,o)}s.insertNodes(e);for(let o=0;o<r;o++)t[o].remove()}getNodes(){const e=this._cachedNodes;if(e!==null)return e;const t=this._nodes,r=[];for(const i of t){const s=de(i);s!==null&&r.push(s)}return Zi()||(this._cachedNodes=r),r}getTextContent(){const e=this.getNodes();let t="";for(let r=0;r<e.length;r++)t+=e[r].getTextContent();return t}deleteNodes(){const e=this.getNodes();if((K()||Xi())===this&&e[0]){const t=Be(e[0],"next");Kx(or(t,t))}for(const t of e)t.remove()}};function B(n){return n instanceof uo}let uo=class iy{constructor(e,t,r,i){this.anchor=e,this.focus=t,e._selection=this,t._selection=this,this._cachedNodes=null,this.format=r,this.style=i,this.dirty=!1}getCachedNodes(){return this._cachedNodes}setCachedNodes(e){this._cachedNodes=e}is(e){return!!B(e)&&this.anchor.is(e.anchor)&&this.focus.is(e.focus)&&this.format===e.format&&this.style===e.style}isCollapsed(){return this.anchor.is(this.focus)}getNodes(){const e=this._cachedNodes;if(e!==null)return e;const t=function(r){const i=[],[s,o]=r.getTextSlices();s&&i.push(s.caret.origin);const a=new Set,l=new Set;for(const c of r)if(Ht(c)){const{origin:u}=c;i.length===0?a.add(u):(l.add(u),i.push(u))}else{const{origin:u}=c;j(u)&&l.has(u)||i.push(u)}if(o&&i.push(o.caret.origin),zr(r.focus)&&j(r.focus.origin)&&r.focus.getNodeAtCaret()===null)for(let c=Yt(r.focus.origin,"previous");Ht(c)&&a.has(c.origin)&&!c.origin.isEmpty()&&c.origin.is(i[i.length-1]);c=Vs(c))a.delete(c.origin),i.pop();for(;i.length>1;){const c=i[i.length-1];if(!j(c)||l.has(c)||c.isEmpty()||a.has(c))break;i.pop()}if(i.length===0&&r.isCollapsed()){const c=fn(r.anchor),u=fn(r.anchor.getFlipped()),f=h=>tr(h)?h.origin:h.getNodeAtCaret(),d=f(c)||f(u)||(r.anchor.getNodeAtCaret()?c.origin:u.origin);i.push(d)}return i}(qy($h(this),"next"));return Zi()||(this._cachedNodes=t),t}setTextNodeRange(e,t,r,i){this.anchor.set(e.__key,t,"text"),this.focus.set(r.__key,i,"text")}getTextContent(){const e=this.getNodes();if(e.length===0)return"";const t=e[0],r=e[e.length-1],i=this.anchor,s=this.focus,o=i.isBefore(s),[a,l]=mu(this);let c="",u=!0;for(let f=0;f<e.length;f++){const d=e[f];if(j(d)&&!d.isInline())u||(c+=`
`),u=!d.isEmpty();else if(u=!1,z(d)){let h=d.getTextContent();d===t?d===r?i.type==="element"&&s.type==="element"&&s.offset!==i.offset||(h=a<l?h.slice(a,l):h.slice(l,a)):h=o?h.slice(a):h.slice(l):d===r&&(h=o?h.slice(0,l):h.slice(0,a)),c+=h}else!ve(d)&&!Pr(d)||d===r&&this.isCollapsed()||(c+=d.getTextContent())}return c}applyDOMRange(e){const t=$e(),r=t.getEditorState()._selection,i=oy(e.startContainer,e.startOffset,e.endContainer,e.endOffset,t,r);if(i===null)return;const[s,o]=i;this.anchor.set(s.key,s.offset,s.type,!0),this.focus.set(o.key,o.offset,o.type,!0),zs(this)}clone(){const e=this.anchor,t=this.focus;return new iy(wt(e.key,e.offset,e.type),wt(t.key,t.offset,t.type),this.format,this.style)}toggleFormat(e){this.format=Ka(this.format,e,null),this.dirty=!0}setFormat(e){this.format=e,this.dirty=!0}setStyle(e){this.style=e,this.dirty=!0}hasFormat(e){const t=rr[e];return!!(this.format&t)}insertRawText(e){const t=e.split(/(\r?\n|\t)/),r=[],i=t.length;for(let s=0;s<i;s++){const o=t[s];o===`
`||o===`\r
`?r.push(Ur()):o==="	"?r.push(co()):r.push(ue(o))}this.insertNodes(r)}insertText(e){const t=this.anchor,r=this.focus,i=this.format,s=this.style;let o=t,a=r;!this.isCollapsed()&&r.isBefore(t)&&(o=r,a=t),o.type==="element"&&function(y,b,_,C){const E=y.getNode(),O=E.getChildAtIndex(y.offset),N=ue(),D=et(E)?Ot().append(N):N;N.setFormat(_),N.setStyle(C),O===null?E.append(D):O.insertBefore(D),y.is(b)&&b.set(N.__key,0,"text"),y.set(N.__key,0,"text")}(o,a,i,s),a.type==="element"&&Gs(a,fn(Ln(a,"next")));const l=o.offset;let c=a.offset;const u=this.getNodes(),f=u.length;let d=u[0];z(d)||H(26);const h=d.getTextContent().length,p=d.getParentOrThrow();let m=u[f-1];if(f===1&&a.type==="element"&&(c=h,a.set(o.key,c,"text")),this.isCollapsed()&&l===h&&(Mn(d)||!d.canInsertTextAfter()||!p.canInsertTextAfter()&&d.getNextSibling()===null)){let y=d.getNextSibling();if(z(y)&&y.canInsertTextBefore()&&!Mn(y)||(y=ue(),y.setFormat(i),y.setStyle(s),p.canInsertTextAfter()?d.insertAfter(y):p.insertAfter(y)),y.select(0,0),d=y,e!=="")return void this.insertText(e)}else if(this.isCollapsed()&&l===0&&(Mn(d)||!d.canInsertTextBefore()||!p.canInsertTextBefore()&&d.getPreviousSibling()===null)){let y=d.getPreviousSibling();if(z(y)&&!Mn(y)||(y=ue(),y.setFormat(i),p.canInsertTextBefore()?d.insertBefore(y):p.insertBefore(y)),y.select(),d=y,e!=="")return void this.insertText(e)}else if(d.isSegmented()&&l!==h){const y=ue(d.getTextContent());y.setFormat(i),d.replace(y),d=y}else if(!this.isCollapsed()&&e!==""){const y=m.getParent();if(!p.canInsertTextBefore()||!p.canInsertTextAfter()||j(y)&&(!y.canInsertTextBefore()||!y.canInsertTextAfter()))return this.insertText(""),sy(this.anchor,this.focus,null),void this.insertText(e)}if(f===1){if(Rr(d)){const C=ue(e);return C.select(),void d.replace(C)}const y=d.getFormat(),b=d.getStyle();if(l!==c||y===i&&b===s){if(ty(d)){const C=ue(e);return C.setFormat(i),C.setStyle(s),C.select(),void d.replace(C)}}else{if(d.getTextContent()!==""){const C=ue(e);if(C.setFormat(i),C.setStyle(s),C.select(),l===0)d.insertBefore(C,!1);else{const[E]=d.splitText(l);E.insertAfter(C,!1)}return void(C.isComposing()&&this.anchor.type==="text"&&(this.anchor.offset-=e.length))}d.setFormat(i),d.setStyle(s)}const _=c-l;d=d.spliceText(l,_,e,!0),d.getTextContent()===""?d.remove():this.anchor.type==="text"&&(d.isComposing()?this.anchor.offset-=e.length:(this.format=y,this.style=b))}else{const y=new Set([...d.getParentKeys(),...m.getParentKeys()]),b=j(d)?d:d.getParentOrThrow();let _=j(m)?m:m.getParentOrThrow(),C=m;if(!b.is(_)&&_.isInline())do C=_,_=_.getParentOrThrow();while(_.isInline());if(a.type==="text"&&(c!==0||m.getTextContent()==="")||a.type==="element"&&m.getIndexWithinParent()<c)if(z(m)&&!Rr(m)&&c!==m.getTextContentSize()){if(m.isSegmented()){const P=ue(m.getTextContent());m.replace(P),m=P}et(a.getNode())||a.type!=="text"||(m=m.spliceText(0,c,"")),y.add(m.__key)}else{const P=m.getParentOrThrow();P.canBeEmpty()||P.getChildrenSize()!==1?m.remove():P.remove()}else y.add(m.__key);const E=_.getChildren(),O=new Set(u),N=b.is(_),D=b.isInline()&&d.getNextSibling()===null?b:d;for(let P=E.length-1;P>=0;P--){const $=E[P];if($.is(d)||j($)&&$.isParentOf(d))break;$.isAttached()&&(!O.has($)||$.is(C)?N||D.insertAfter($,!1):$.remove())}if(!N){let P=_,$=null;for(;P!==null;){const R=P.getChildren(),k=R.length;(k===0||R[k-1].is($))&&(y.delete(P.__key),$=P),P=P.getParent()}}if(Rr(d))if(l===h)d.select();else{const P=ue(e);P.select(),d.replace(P)}else d=d.spliceText(l,h-l,e,!0),d.getTextContent()===""?d.remove():d.isComposing()&&this.anchor.type==="text"&&(this.anchor.offset-=e.length);for(let P=1;P<f;P++){const $=u[P],R=$.__key;y.has(R)||$.remove()}}}removeText(){const e=K()===this;wa(this,Hx($h(this))),e&&K()!==this&&it(this)}formatText(e,t=null){if(this.isCollapsed())return this.toggleFormat(e),void Qe(null);const r=this.getNodes(),i=[];for(const E of r)z(E)&&i.push(E);const s=E=>{r.forEach(O=>{if(j(O)){const N=O.getFormatFlags(e,E);O.setTextFormat(N)}})},o=i.length;if(o===0)return this.toggleFormat(e),Qe(null),void s(t);const a=this.anchor,l=this.focus,c=this.isBackward(),u=c?l:a,f=c?a:l;let d=0,h=i[0],p=u.type==="element"?0:u.offset;if(u.type==="text"&&p===h.getTextContentSize()&&(d=1,h=i[1],p=0),h==null)return;const m=h.getFormatFlags(e,t);s(m);const y=o-1;let b=i[y];const _=f.type==="text"?f.offset:b.getTextContentSize();if(h.is(b)){if(p===_)return;if(Mn(h)||p===0&&_===h.getTextContentSize())h.setFormat(m);else{const E=h.splitText(p,_),O=p===0?E[0]:E[1];O.setFormat(m),u.type==="text"&&u.set(O.__key,0,"text"),f.type==="text"&&f.set(O.__key,_-p,"text")}return void(this.format=m)}p===0||Mn(h)||([,h]=h.splitText(p),p=0),h.setFormat(m);const C=b.getFormatFlags(e,m);_>0&&(_===b.getTextContentSize()||Mn(b)||([b]=b.splitText(_)),b.setFormat(C));for(let E=d+1;E<y;E++){const O=i[E],N=O.getFormatFlags(e,C);O.setFormat(N)}u.type==="text"&&u.set(h.__key,p,"text"),f.type==="text"&&f.set(b.__key,_,"text"),this.format=m|C}insertNodes(e){if(e.length===0)return;if(this.isCollapsed()||this.removeText(),this.anchor.key==="root"){this.insertParagraph();const p=K();return B(p)||H(134),p.insertNodes(e)}const t=(this.isBackward()?this.focus:this.anchor).getNode(),r=Dc(t,Rt),i=e[e.length-1];if(j(r)&&"__language"in r){if("__language"in e[0])this.insertText(e[0].getTextContent());else{const p=Pc(this);r.splice(p,0,e),i.selectEnd()}return}if(!e.some(p=>(j(p)||ve(p))&&!p.isInline())){j(r)||H(211,t.constructor.name,t.getType());const p=Pc(this);return r.splice(p,0,e),void i.selectEnd()}const s=function(p){const m=Ot();let y=null;for(let b=0;b<p.length;b++){const _=p[b],C=Pr(_);if(C||ve(_)&&_.isInline()||j(_)&&_.isInline()||z(_)||_.isParentRequired()){if(y===null&&(y=_.createParentElementNode(),m.append(y),C))continue;y!==null&&y.append(_)}else m.append(_),y=null}return m}(e),o=s.getLastDescendant(),a=s.getChildren(),l=!j(r)||!r.isEmpty()?this.insertParagraph():null,c=a[a.length-1];let u=a[0];var f;j(f=u)&&Rt(f)&&!f.isEmpty()&&j(r)&&(!r.isEmpty()||r.canMergeWhenEmpty())&&(j(r)||H(211,t.constructor.name,t.getType()),r.append(...u.getChildren()),u=a[1]),u&&(r===null&&H(212,t.constructor.name,t.getType()),function(p,m,y){const b=m.getParentOrThrow().getLastChild();let _=m;const C=[m];for(;_!==b;)_.getNextSibling()||H(140),_=_.getNextSibling(),C.push(_);let E=p;for(const O of C)E=E.insertAfter(O)}(r,u));const d=Dc(o,Rt);l&&j(d)&&(l.canMergeWhenEmpty()||Rt(c))&&(d.append(...l.getChildren()),l.remove()),j(r)&&r.isEmpty()&&r.remove(),o.selectEnd();const h=j(r)?r.getLastChild():null;Pr(h)&&d!==r&&h.remove()}insertParagraph(){if(this.anchor.key==="root"){const o=Ot();return pe().splice(this.anchor.offset,0,[o]),o.select(),o}const e=Pc(this),t=Dc(this.anchor.getNode(),Rt);j(t)||H(213);const r=t.getChildAtIndex(e),i=r?[r,...r.getNextSiblings()]:[],s=t.insertNewAfter(this,!1);return s?(s.append(...i),s.selectStart(),s):null}insertLineBreak(e){const t=Ur();if(this.insertNodes([t]),e){const r=t.getParentOrThrow(),i=t.getIndexWithinParent();r.select(i,i)}}extract(){const e=this.getNodes(),t=e.length,r=t-1,i=this.anchor,s=this.focus;let o=e[0],a=e[r];const[l,c]=mu(this);if(t===0)return[];if(t===1){if(z(o)&&!this.isCollapsed()){const f=l>c?c:l,d=l>c?l:c,h=o.splitText(f,d),p=f===0?h[0]:h[1];return p!=null?[p]:[]}return[o]}const u=i.isBefore(s);if(z(o)){const f=u?l:c;f===o.getTextContentSize()?e.shift():f!==0&&([,o]=o.splitText(f),e[0]=o)}if(z(a)){const f=a.getTextContent().length,d=u?c:l;d===0?e.pop():d!==f&&([a]=a.splitText(d),e[r]=a)}return e}modify(e,t,r){if(hh(this,e,t,r))return;const i=e==="move",s=$e(),o=Gt(jt(s));if(!o)return;const a=s._blockCursorElement,l=s._rootElement,c=this.focus.getNode();if(l===null||a===null||!j(c)||c.isInline()||c.canBeEmpty()||xu(a,s,l),this.dirty){let u=Fi(s,this.anchor.key),f=Fi(s,this.focus.key);this.anchor.type==="text"&&(u=ji(u)),this.focus.type==="text"&&(f=ji(f)),u&&f&&cy(o,u,this.anchor.offset,f,this.focus.offset)}if(function(u,f,d,h){u.modify(f,d,h)}(o,e,t?"backward":"forward",r),o.rangeCount>0){const u=o.getRangeAt(0),f=this.anchor.getNode(),d=et(f)?f:Mx(f);if(this.applyDOMRange(u),this.dirty=!0,!i){const h=this.getNodes(),p=[];let m=!1;for(let y=0;y<h.length;y++){const b=h[y];ku(b,d)?p.push(b):m=!0}if(m&&p.length>0)if(t){const y=p[0];j(y)?y.selectStart():y.getParentOrThrow().selectStart()}else{const y=p[p.length-1];j(y)?y.selectEnd():y.getParentOrThrow().selectEnd()}o.anchorNode===u.startContainer&&o.anchorOffset===u.startOffset||function(y){const b=y.focus,_=y.anchor,C=_.key,E=_.offset,O=_.type;_.set(b.key,b.offset,b.type,!0),b.set(C,E,O,!0)}(this)}}r==="lineboundary"&&hh(this,e,t,r,"decorators")}forwardDeletion(e,t,r){if(!r&&(e.type==="element"&&j(t)&&e.offset===t.getChildrenSize()||e.type==="text"&&e.offset===t.getTextContentSize())){const i=t.getParent(),s=t.getNextSibling()||(i===null?null:i.getNextSibling());if(j(s)&&s.isShadowRoot())return!0}return!1}deleteCharacter(e){const t=this.isCollapsed();if(this.isCollapsed()){const r=this.anchor;let i=r.getNode();if(this.forwardDeletion(r,i,e))return;const s=Vd(Ln(r,e?"previous":"next"));if(s.getTextSlices().every(a=>a===null||a.distance===0)){let a={type:"initial"};for(const l of s.iterNodeCarets("shadowRoot"))if(Ht(l)){if(!l.origin.isInline()){if(l.origin.isShadowRoot()){if(a.type==="merge-block")break;if(j(s.anchor.origin)&&s.anchor.origin.isEmpty()){const c=fn(l);wa(this,or(c,c)),s.anchor.origin.remove()}return}a.type!=="merge-next-block"&&a.type!=="merge-block"||(a={block:a.block,caret:l,type:"merge-block"})}}else{if(a.type==="merge-block")break;if(zr(l)){if(j(l.origin)){if(l.origin.isInline()){if(!l.origin.isParentOf(s.anchor.origin))break}else a={block:l.origin,type:"merge-next-block"};continue}if(ve(l.origin)){if(!l.origin.isIsolated())if(a.type==="merge-next-block"&&(l.origin.isKeyboardSelectable()||!l.origin.isInline())&&j(s.anchor.origin)&&s.anchor.origin.isEmpty()){s.anchor.origin.remove();const c=ly();c.add(l.origin.getKey()),it(c)}else l.origin.remove();return}break}}if(a.type==="merge-block"){const{caret:l,block:c}=a;return wa(this,or(!l.origin.isEmpty()&&c.isEmpty()?Sl(Be(c,l.direction)):s.anchor,l)),this.removeText()}}const o=this.focus;if(this.modify("extend",e,"character"),this.isCollapsed()){if(e&&r.offset===0&&ah(this,r.getNode()))return}else{const a=o.type==="text"?o.getNode():null;if(i=r.type==="text"?r.getNode():null,a!==null&&a.isSegmented()){const l=o.offset,c=a.getTextContentSize();if(a.is(i)||e&&l!==c||!e&&l!==0)return void lh(a,e,l)}else if(i!==null&&i.isSegmented()){const l=r.offset,c=i.getTextContentSize();if(i.is(a)||e&&l!==0||!e&&l!==c)return void lh(i,e,l)}(function(l,c){const u=l.anchor,f=l.focus,d=u.getNode(),h=f.getNode();if(d===h&&u.type==="text"&&f.type==="text"){const p=u.offset,m=f.offset,y=p<m,b=y?p:m,_=y?m:p,C=_-1;b!==C&&function(E){return!(Ey(E)||cx(E))}(d.getTextContent().slice(b,_))&&(c?f.set(f.key,C,f.type):u.set(u.key,C,u.type))}})(this,e)}}if(this.removeText(),e&&!t&&this.isCollapsed()&&this.anchor.type==="element"&&this.anchor.offset===0){const r=this.anchor.getNode();r.isEmpty()&&et(r.getParent())&&r.getPreviousSibling()===null&&ah(this,r)}}deleteLine(e){this.isCollapsed()&&this.modify("extend",e,"lineboundary"),this.isCollapsed()?this.deleteCharacter(e):this.removeText()}deleteWord(e){if(this.isCollapsed()){const t=this.anchor,r=t.getNode();if(this.forwardDeletion(t,r,e))return;this.modify("extend",e,"word")}this.removeText()}isBackward(){return this.focus.isBefore(this.anchor)}getStartEndPoints(){return[this.anchor,this.focus]}};function pt(n){return n instanceof ny}function oh(n){const e=n.offset;if(n.type==="text")return e;const t=n.getNode();return e===t.getChildrenSize()?t.getTextContent().length:0}function mu(n){const e=n.getStartEndPoints();if(e===null)return[0,0];const[t,r]=e;return t.type==="element"&&r.type==="element"&&t.key===r.key&&t.offset===r.offset?[0,0]:[oh(t),oh(r)]}function ah(n,e){for(let t=e;t;t=t.getParent()){if(j(t)){if(t.collapseAtStart(n))return!0;if(bn(t))break}if(t.getPreviousSibling())break}return!1}const cx=(()=>{try{const n=new RegExp("\\p{Emoji}","u"),e=n.test.bind(n);if(e("❤️")&&e("#️⃣")&&e("👍"))return e}catch{}return()=>!1})();function lh(n,e,t){const r=n,i=r.getTextContent().split(/(?=\s)/g),s=i.length;let o=0,a=0;for(let c=0;c<s;c++){const u=c===s-1;if(a=o,o+=i[c].length,e&&o===t||o>t||u){i.splice(c,1),u&&(a=void 0);break}}const l=i.join("").trim();l===""?r.remove():(r.setTextContent(l),r.select(a,a))}function ch(n,e,t,r){let i,s=e;if(Te(n)){let o=!1;const a=n.childNodes,l=a.length,c=r._blockCursorElement;s===l&&(o=!0,s=l-1);let u=a[s],f=!1;if(u===c)u=a[s+1],f=!0;else if(c!==null){const d=c.parentNode;n===d&&e>Array.prototype.indexOf.call(d.children,c)&&s--}if(i=Ci(u),z(i))s=nr(i,o?"next":"previous");else{let d=Ci(n);if(d===null)return null;if(j(d)){const h=r.getElementByKey(d.getKey());h===null&&H(214),[d,s]=d.getDOMSlot(h).resolveChildIndex(d,h,n,e),j(d)||H(215),o&&s>=d.getChildrenSize()&&(s=Math.max(0,d.getChildrenSize()-1));let m=d.getChildAtIndex(s);if(j(m)&&function(y,b,_){const C=y.getParent();return _===null||C===null||!C.canBeEmpty()||C!==_.getNode()}(m,0,t)){const y=o?m.getLastDescendant():m.getFirstDescendant();y===null?d=m:(m=y,d=j(m)?m:m.getParentOrThrow()),s=0}z(m)?(i=m,d=null,s=nr(m,o?"next":"previous")):m!==d&&o&&!f&&(j(d)||H(216),s=Math.min(d.getChildrenSize(),s+1))}else{const h=d.getIndexWithinParent();s=e===0&&ve(d)&&Ci(n)===d?h:h+1,d=d.getParentOrThrow()}if(j(d))return wt(d.__key,s,"element")}}else i=Ci(n);return z(i)?wt(i.__key,nr(i,s,"clamp"),"text"):null}function uh(n,e,t){const r=n.offset,i=n.getNode();if(r===0){const s=i.getPreviousSibling(),o=i.getParent();if(e){if((t||!e)&&s===null&&j(o)&&o.isInline()){const a=o.getPreviousSibling();z(a)&&n.set(a.__key,a.getTextContent().length,"text")}}else j(s)&&!t&&s.isInline()?n.set(s.__key,s.getChildrenSize(),"element"):z(s)&&n.set(s.__key,s.getTextContent().length,"text")}else if(r===i.getTextContent().length){const s=i.getNextSibling(),o=i.getParent();if(e&&j(s)&&s.isInline())n.set(s.__key,0,"element");else if((t||e)&&s===null&&j(o)&&o.isInline()&&!o.canInsertTextAfter()){const a=o.getNextSibling();z(a)&&n.set(a.__key,0,"text")}}}function sy(n,e,t){if(n.type==="text"&&e.type==="text"){const r=n.isBefore(e),i=n.is(e);uh(n,r,i),uh(e,!r,i),i&&e.set(n.key,n.offset,n.type);const s=$e();if(s.isComposing()&&s._compositionKey!==n.key&&B(t)){const o=t.anchor,a=t.focus;n.set(o.key,o.offset,o.type,!0),e.set(a.key,a.offset,a.type,!0)}}}function oy(n,e,t,r,i,s){if(n===null||t===null||!ho(i,n,t))return null;const o=ch(n,e,B(s)?s.anchor:null,i);if(o===null)return null;const a=ch(t,r,B(s)?s.focus:null,i);if(a===null)return null;if(o.type==="element"&&a.type==="element"){const l=Ci(n),c=Ci(t);if(ve(l)&&ve(c))return null}return sy(o,a,s),[o,a]}function yu(n){return j(n)&&!n.isInline()}function ay(n,e,t,r,i,s){const o=gr(),a=new uo(wt(n,e,i),wt(t,r,s),0,"");return a.dirty=!0,o._selection=a,a}function fo(){const n=wt("root",0,"element"),e=wt("root",0,"element");return new uo(n,e,0,"")}function ly(){return new ny(new Set)}function Md(n,e,t,r){const i=t._window;if(i===null)return null;const s=r||i.event,o=s?s.type:void 0,a=o==="selectionchange",l=!iu&&(a||o==="beforeinput"||o==="compositionstart"||o==="compositionend"||o==="click"&&s&&s.detail===3||o==="drop"||o===void 0);let c,u,f,d;if(B(n)&&!l)return n.clone();if(e===null)return null;if(c=e.anchorNode,u=e.focusNode,f=e.anchorOffset,d=e.focusOffset,a&&B(n)&&!ho(t,c,u))return n.clone();const h=oy(c,f,u,d,t,n);if(h===null)return null;const[p,m]=h;return new uo(p,m,B(n)?n.format:0,B(n)?n.style:"")}function K(){return gr()._selection}function Xi(){return $e()._editorState._selection}function za(n,e,t,r=1){const i=n.anchor,s=n.focus,o=i.getNode(),a=s.getNode();if(!e.is(o)&&!e.is(a))return;const l=e.__key;if(n.isCollapsed()){const c=i.offset;if(t<=c&&r>0||t<c&&r<0){const u=Math.max(0,c+r);i.set(l,u,"element"),s.set(l,u,"element"),dh(n)}}else{const c=n.isBackward(),u=c?s:i,f=u.getNode(),d=c?i:s,h=d.getNode();if(e.is(f)){const p=u.offset;(t<=p&&r>0||t<p&&r<0)&&u.set(l,Math.max(0,p+r),"element")}if(e.is(h)){const p=d.offset;(t<=p&&r>0||t<p&&r<0)&&d.set(l,Math.max(0,p+r),"element")}}dh(n)}function dh(n){const e=n.anchor,t=e.offset,r=n.focus,i=r.offset,s=e.getNode(),o=r.getNode();if(n.isCollapsed()){if(!j(s))return;const a=s.getChildrenSize(),l=t>=a,c=l?s.getChildAtIndex(a-1):s.getChildAtIndex(t);if(z(c)){let u=0;l&&(u=c.getTextContentSize()),e.set(c.__key,u,"text"),r.set(c.__key,u,"text")}}else{if(j(s)){const a=s.getChildrenSize(),l=t>=a,c=l?s.getChildAtIndex(a-1):s.getChildAtIndex(t);if(z(c)){let u=0;l&&(u=c.getTextContentSize()),e.set(c.__key,u,"text")}}if(j(o)){const a=o.getChildrenSize(),l=i>=a,c=l?o.getChildAtIndex(a-1):o.getChildAtIndex(i);if(z(c)){let u=0;l&&(u=c.getTextContentSize()),r.set(c.__key,u,"text")}}}}function Wa(n,e,t,r,i){let s=null,o=0,a=null;r!==null?(s=r.__key,z(r)?(o=r.getTextContentSize(),a="text"):j(r)&&(o=r.getChildrenSize(),a="element")):i!==null&&(s=i.__key,z(i)?a="text":j(i)&&(a="element")),s!==null&&a!==null?n.set(s,o,a):(o=e.getIndexWithinParent(),o===-1&&(o=t.getChildrenSize()),n.set(t.__key,o,"element"))}function fh(n,e,t,r,i){n.type==="text"?n.set(t,n.offset+(e?0:i),"text"):n.offset>r.getIndexWithinParent()&&n.set(n.key,n.offset-1,"element")}function cy(n,e,t,r,i){try{n.setBaseAndExtent(e,t,r,i)}catch{}}function ux(n,e,t,r,i,s,o){const a=r.anchorNode,l=r.focusNode,c=r.anchorOffset,u=r.focusOffset,f=document.activeElement;if(i.has(mx)&&f!==s||f!==null&&Dd(f))return;if(!B(e))return void(n!==null&&ho(t,a,l)&&r.removeAllRanges());const d=e.anchor,h=e.focus,p=d.key,m=h.key,y=Fi(t,p),b=Fi(t,m),_=d.offset,C=h.offset,E=e.format,O=e.style,N=e.isCollapsed();let D=y,P=b,$=!1;if(d.type==="text"){D=ji(y);const F=d.getNode();$=F.getFormat()!==E||F.getStyle()!==O}else B(n)&&n.anchor.type==="text"&&($=!0);var R,k,I,w,L;if(h.type==="text"&&(P=ji(b)),D!==null&&P!==null&&(N&&(n===null||$||B(n)&&(n.format!==E||n.style!==O))&&(R=E,k=O,I=_,w=p,L=performance.now(),Wm=[R,k,I,w,L]),c!==_||u!==C||a!==D||l!==P||r.type==="Range"&&N||(f!==null&&s.contains(f)||s.focus({preventScroll:!0}),d.type==="element"))){if(cy(r,D,_,P,C),!i.has(yx)&&e.isCollapsed()&&s!==null&&s===document.activeElement){const F=B(e)&&e.anchor.type==="element"?D.childNodes[_]||null:r.rangeCount>0?r.getRangeAt(0):null;if(F!==null){let q;if(F instanceof Text){const W=document.createRange();W.selectNode(F),q=W.getBoundingClientRect()}else q=F.getBoundingClientRect();(function(W,J,V){const G=$y(V),ee=zd(G);if(G===null||ee===null)return;let{top:Z,bottom:re}=J,oe=0,X=0,fe=V;for(;fe!==null;){const be=fe===G.body;if(be)oe=0,X=jt(W).innerHeight;else{const ce=fe.getBoundingClientRect();oe=ce.top,X=ce.bottom}let se=0;if(Z<oe?se=-(oe-Z):re>X&&(se=re-X),se!==0)if(be)ee.scrollBy(0,se);else{const ce=fe.scrollTop;fe.scrollTop+=se;const he=fe.scrollTop-ce;Z-=he,re-=he}if(be)break;fe=go(fe)}})(t,q,s)}}hu=!0}}function dx(n){let e=K()||Xi();e===null&&(e=pe().selectEnd()),e.insertNodes(n)}function Pc(n){let e=n;n.isCollapsed()||e.removeText();const t=K();B(t)&&(e=t),B(e)||H(161);const r=e.anchor;let i=r.getNode(),s=r.offset;for(;!Rt(i);){const o=i;if([i,s]=fx(i,s),o.is(i))break}return s}function fx(n,e){const t=n.getParent();if(!t){const i=Ot();return pe().append(i),i.select(),[pe(),0]}if(z(n)){const i=n.splitText(e);if(i.length===0)return[t,n.getIndexWithinParent()];const s=e===0?0:1;return[t,i[0].getIndexWithinParent()+s]}if(!j(n)||e===0)return[t,n.getIndexWithinParent()];const r=n.getChildAtIndex(e);if(r){const i=new uo(wt(n.__key,e,"element"),wt(n.__key,e,"element"),0,""),s=n.insertNewAfter(i);s&&s.append(r,...r.getNextSiblings())}return[t,n.getIndexWithinParent()+1]}function hh(n,e,t,r,i="decorators-and-blocks"){if(e==="move"&&r==="character"&&!n.isCollapsed()){const[u,f]=t===n.isBackward()?[n.focus,n.anchor]:[n.anchor,n.focus];return f.set(u.key,u.offset,u.type),!0}const s=Ln(n.focus,t?"previous":"next"),o=r==="lineboundary",a=e==="move";let l=s,c=i==="decorators-and-blocks";if(!Fy(l)){for(const u of l){c=!1;const{origin:f}=u;if(!ve(f)||f.isIsolated()||(l=u,!o||!f.isInline()))break}if(c)for(const u of Vd(s).iterNodeCarets(e==="extend"?"shadowRoot":"root")){if(Ht(u))u.origin.isInline()||(l=u);else{if(j(u.origin))continue;ve(u.origin)&&!u.origin.isInline()&&(l=u)}break}}if(l===s)return!1;if(a&&!o&&ve(l.origin)&&l.origin.isKeyboardSelectable()){const u=ly();return u.add(l.origin.getKey()),it(u),!0}return l=fn(l),a&&Gs(n.anchor,l),Gs(n.focus,l),c||!o}let We=null,Ke=null,Ct=!1,Ic=!1,ka=0;const gh={characterData:!0,childList:!0,subtree:!0};function Zi(){return Ct||We!==null&&We._readOnly}function Ze(){Ct&&H(13)}function uy(){ka>99&&H(14)}function gr(){return We===null&&H(195,dy()),We}function $e(){return Ke===null&&H(196,dy()),Ke}function dy(){let n=0;const e=new Set,t=bl.version;if(typeof window<"u")for(const i of document.querySelectorAll("[contenteditable]")){const s=vl(i);if(jd(s))n++;else if(s){let o=String(s.constructor.version||"<0.17.1");o===t&&(o+=" (separately built, likely a bundler configuration issue)"),e.add(o)}}let r=` Detected on the page: ${n} compatible editor(s) with version ${t}`;return e.size&&(r+=` and incompatible editors with versions ${Array.from(e).join(", ")}`),r}function hx(){return Ke}function ph(n,e,t){const r=e.__type,i=xy(n,r);let s=t.get(r);s===void 0&&(s=Array.from(i.transforms),t.set(r,s));const o=s.length;for(let a=0;a<o&&(s[a](e),e.isAttached());a++);}function mh(n,e){return n!==void 0&&n.__key!==e&&n.isAttached()}function fy(n,e){if(!e)return;const t=n._updateTags;let r=e;Array.isArray(e)||(r=[e]);for(const i of r)t.add(i)}function hy(n){return Ad(n,$e()._nodes)}function Ad(n,e){const t=n.type,r=e.get(t);r===void 0&&H(17,t);const i=r.klass;n.type!==i.getType()&&H(18,i.name);const s=i.importJSON(n),o=n.children;if(j(s)&&Array.isArray(o))for(let a=0;a<o.length;a++){const l=Ad(o[a],e);s.append(l)}return s}function yh(n,e,t){const r=We,i=Ct,s=Ke;We=e,Ct=!0,Ke=n;try{return t()}finally{We=r,Ct=i,Ke=s}}function On(n,e){const t=n._pendingEditorState,r=n._rootElement,i=n._headless||r===null;if(t===null)return;const s=n._editorState,o=s._selection,a=t._selection,l=n._dirtyType!==qr,c=We,u=Ct,f=Ke,d=n._updating,h=n._observer;let p=null;if(n._pendingEditorState=null,n._editorState=t,!i&&l&&h!==null){Ke=n,We=t,Ct=!1,n._updating=!0;try{const N=n._dirtyType,D=n._dirtyElements,P=n._dirtyLeaves;h.disconnect(),p=Wk(s,t,n,N,D,P)}catch(N){if(N instanceof Error&&n._onError(N),Ic)throw N;return ky(n,null,r,t),Em(n),n._dirtyType=Pi,Ic=!0,On(n,s),void(Ic=!1)}finally{h.observe(r,gh),n._updating=d,We=c,Ct=u,Ke=f}}t._readOnly||(t._readOnly=!0);const m=n._dirtyLeaves,y=n._dirtyElements,b=n._normalizedNodes,_=n._updateTags,C=n._deferred;l&&(n._dirtyType=qr,n._cloneNotNeeded.clear(),n._dirtyLeaves=new Set,n._dirtyElements=new Map,n._normalizedNodes=new Set,n._updateTags=new Set),function(N,D){const P=N._decorators;let $=N._pendingDecorators||P;const R=D._nodeMap;let k;for(k in $)R.has(k)||($===P&&($=Sy(N)),delete $[k])}(n,t);const E=i?null:Gt(jt(n));if(n._editable&&E!==null&&(l||a===null||a.dirty)&&r!==null&&!_.has(_x)){Ke=n,We=t;try{if(h!==null&&h.disconnect(),l||a===null||a.dirty){const N=n._blockCursorElement;N!==null&&xu(N,n,r),ux(o,a,n,E,_,r)}(function(N,D,P){let $=N._blockCursorElement;if(B(P)&&P.isCollapsed()&&P.anchor.type==="element"&&D.contains(document.activeElement)){const R=P.anchor,k=R.getNode(),I=R.offset;let w=!1,L=null;if(I===k.getChildrenSize())Lc(k.getChildAtIndex(I-1))&&(w=!0);else{const F=k.getChildAtIndex(I);if(F!==null&&Lc(F)){const q=F.getPreviousSibling();(q===null||Lc(q))&&(w=!0,L=N.getElementByKey(F.__key))}}if(w){const F=N.getElementByKey(k.__key);return $===null&&(N._blockCursorElement=$=function(q){const W=q.theme,J=document.createElement("div");J.contentEditable="false",J.setAttribute("data-lexical-cursor","true");let V=W.blockCursor;if(V!==void 0){if(typeof V=="string"){const G=Ia(V);V=W.blockCursor=G}V!==void 0&&J.classList.add(...V)}return J}(N._config)),D.style.caretColor="transparent",void(L===null?F.appendChild($):F.insertBefore($,L))}}$!==null&&xu($,N,D)})(n,r,a)}finally{h!==null&&h.observe(r,gh),Ke=f,We=c}}p!==null&&function(N,D,P,$,R){const k=Array.from(N._listeners.mutation),I=k.length;for(let w=0;w<I;w++){const[L,F]=k[w];for(const q of F){const W=D.get(q);W!==void 0&&L(W,{dirtyLeaves:$,prevEditorState:R,updateTags:P})}}}(n,p,_,m,s),B(a)||a===null||o!==null&&o.is(a)||n.dispatchCommand(fr,void 0);const O=n._pendingDecorators;O!==null&&(n._decorators=O,n._pendingDecorators=null,Fs("decorator",n,!0,O)),function(N,D,P){const $=xh(D),R=xh(P);$!==R&&Fs("textcontent",N,!0,R)}(n,e||s,t),Fs("update",n,!0,{dirtyElements:y,dirtyLeaves:m,editorState:t,mutatedNodes:p,normalizedNodes:b,prevEditorState:e||s,tags:_}),function(N,D){if(N._deferred=[],D.length!==0){const P=N._updating;N._updating=!0;try{for(let $=0;$<D.length;$++)D[$]()}finally{N._updating=P}}}(n,C),function(N){const D=N._updates;if(D.length!==0){const P=D.shift();if(P){const[$,R]=P;yl(N,$,R)}}}(n)}function Fs(n,e,t,...r){const i=e._updating;e._updating=t;try{const s=Array.from(e._listeners[n]);for(let o=0;o<s.length;o++)s[o].apply(null,r)}finally{e._updating=i}}function _h(n,e){const t=n._updates;let r=e||!1;for(;t.length!==0;){const i=t.shift();if(i){const[s,o]=i,a=n._pendingEditorState;let l;o!==void 0&&(l=o.onUpdate,o.skipTransforms&&(r=!0),o.discrete&&(a===null&&H(191),a._flushSync=!0),l&&n._deferred.push(l),fy(n,o.tag)),a==null?yl(n,s,o):s()}}return r}function yl(n,e,t){const r=n._updateTags;let i,s=!1,o=!1;t!==void 0&&(i=t.onUpdate,fy(n,t.tag),s=t.skipTransforms||!1,o=t.discrete||!1),i&&n._deferred.push(i);const a=n._editorState;let l=n._pendingEditorState,c=!1;(l===null||l._readOnly)&&(l=n._pendingEditorState=py(l||a),c=!0),l._flushSync=o;const u=We,f=Ct,d=Ke,h=n._updating;We=l,Ct=!1,n._updating=!0,Ke=n;const p=n._headless||n.getRootElement()===null;Rd(null);try{c&&(p?a._selection!==null&&(l._selection=a._selection.clone()):l._selection=function(_,C){const E=_.getEditorState()._selection,O=Gt(jt(_));return B(E)||E==null?Md(E,O,_,C):E.clone()}(n,t&&t.event||null));const y=n._compositionKey;e(),s=_h(n,s),function(_,C){const E=C.getEditorState()._selection,O=_._selection;if(B(O)){const N=O.anchor,D=O.focus;let P;if(N.type==="text"&&(P=N.getNode(),P.selectionTransform(E,O)),D.type==="text"){const $=D.getNode();P!==$&&$.selectionTransform(E,O)}}}(l,n),n._dirtyType!==qr&&(s?function(_,C){const E=C._dirtyLeaves,O=_._nodeMap;for(const N of E){const D=O.get(N);z(D)&&D.isAttached()&&D.isSimpleText()&&!D.isUnmergeable()&&Vf(D)}}(l,n):function(_,C){const E=C._dirtyLeaves,O=C._dirtyElements,N=_._nodeMap,D=Xn(),P=new Map;let $=E,R=$.size,k=O,I=k.size;for(;R>0||I>0;){if(R>0){C._dirtyLeaves=new Set;for(const w of $){const L=N.get(w);z(L)&&L.isAttached()&&L.isSimpleText()&&!L.isUnmergeable()&&Vf(L),L!==void 0&&mh(L,D)&&ph(C,L,P),E.add(w)}if($=C._dirtyLeaves,R=$.size,R>0){ka++;continue}}C._dirtyLeaves=new Set,C._dirtyElements=new Map,k.delete("root")&&k.set("root",!0);for(const w of k){const L=w[0],F=w[1];if(O.set(L,F),!F)continue;const q=N.get(L);q!==void 0&&mh(q,D)&&ph(C,q,P)}$=C._dirtyLeaves,R=$.size,k=C._dirtyElements,I=k.size,ka++}C._dirtyLeaves=E,C._dirtyElements=O}(l,n),_h(n),function(_,C,E,O){const N=_._nodeMap,D=C._nodeMap,P=[];for(const[$]of O){const R=D.get($);R!==void 0&&(R.isAttached()||(j(R)&&wm(R,$,N,D,P,O),N.has($)||O.delete($),P.push($)))}for(const $ of P)D.delete($);for(const $ of E){const R=D.get($);R===void 0||R.isAttached()||(N.has($)||E.delete($),D.delete($))}}(a,l,n._dirtyLeaves,n._dirtyElements)),y!==n._compositionKey&&(l._flushSync=!0);const b=l._selection;if(B(b)){const _=l._nodeMap,C=b.anchor.key,E=b.focus.key;_.get(C)!==void 0&&_.get(E)!==void 0||H(19)}else pt(b)&&b._nodes.size===0&&(l._selection=null)}catch(y){return y instanceof Error&&n._onError(y),n._pendingEditorState=a,n._dirtyType=Pi,n._cloneNotNeeded.clear(),n._dirtyLeaves=new Set,n._dirtyElements.clear(),void On(n)}finally{We=u,Ct=f,Ke=d,n._updating=h,ka=0}n._dirtyType!==qr||n._deferred.length>0||function(y,b){const _=b.getEditorState()._selection,C=y._selection;if(C!==null){if(C.dirty||!C.is(_))return!0}else if(_!==null)return!0;return!1}(l,n)?l._flushSync?(l._flushSync=!1,On(n)):c&&xx(()=>{On(n)}):(l._flushSync=!1,c&&(r.clear(),n._deferred=[],n._pendingEditorState=null))}function Et(n,e,t){Ke===n&&t===void 0?e():yl(n,e,t)}let gx=class xa{constructor(e,t,r){this.element=e,this.before=t||null,this.after=r||null}withBefore(e){return new xa(this.element,e,this.after)}withAfter(e){return new xa(this.element,this.before,e)}withElement(e){return this.element===e?this:new xa(e,this.before,this.after)}insertChild(e){const t=this.before||this.getManagedLineBreak();return t!==null&&t.parentElement!==this.element&&H(222),this.element.insertBefore(e,t),this}removeChild(e){return e.parentElement!==this.element&&H(223),this.element.removeChild(e),this}replaceChild(e,t){return t.parentElement!==this.element&&H(224),this.element.replaceChild(e,t),this}getFirstChild(){const e=this.after?this.after.nextSibling:this.element.firstChild;return e===this.before||e===this.getManagedLineBreak()?null:e}getManagedLineBreak(){return this.element.__lexicalLineBreak||null}setManagedLineBreak(e){if(e===null)this.removeManagedLineBreak();else{const t=e==="decorator"&&($i||Us);this.insertManagedLineBreak(t)}}removeManagedLineBreak(){const e=this.getManagedLineBreak();if(e){const t=this.element,r=e.nodeName==="IMG"?e.nextSibling:null;r&&t.removeChild(r),t.removeChild(e),t.__lexicalLineBreak=void 0}}insertManagedLineBreak(e){const t=this.getManagedLineBreak();if(t){if(e===(t.nodeName==="IMG"))return;this.removeManagedLineBreak()}const r=this.element,i=this.before,s=document.createElement("br");if(r.insertBefore(s,i),e){const o=document.createElement("img");o.setAttribute("data-lexical-linebreak","true"),o.style.cssText="display: inline !important; border: 0px !important; margin: 0px !important;",o.alt="",r.insertBefore(o,s),r.__lexicalLineBreak=o}else r.__lexicalLineBreak=s}getFirstChildOffset(){let e=0;for(let t=this.after;t!==null;t=t.previousSibling)e++;return e}resolveChildIndex(e,t,r,i){if(r===this.element){const l=this.getFirstChildOffset();return[e,Math.min(l+e.getChildrenSize(),Math.max(l,i))]}const s=bh(t,r);s.push(i);const o=bh(t,this.element);let a=e.getIndexWithinParent();for(let l=0;l<o.length;l++){const c=s[l],u=o[l];if(c===void 0||c<u)break;if(c>u){a+=1;break}}return[e.getParentOrThrow(),a]}};function bh(n,e){const t=[];let r=e;for(;r!==n&&r!==null;r=r.parentNode){let i=0;for(let s=r.previousSibling;s!==null;s=s.previousSibling)i++;t.push(i)}return r!==n&&H(225),t.reverse()}let ht=class extends Yi{constructor(e){super(e),this.__first=null,this.__last=null,this.__size=0,this.__format=0,this.__style="",this.__indent=0,this.__dir=null,this.__textFormat=0,this.__textStyle=""}afterCloneFrom(e){super.afterCloneFrom(e),this.__key===e.__key&&(this.__first=e.__first,this.__last=e.__last,this.__size=e.__size),this.__indent=e.__indent,this.__format=e.__format,this.__style=e.__style,this.__dir=e.__dir,this.__textFormat=e.__textFormat,this.__textStyle=e.__textStyle}getFormat(){return this.getLatest().__format}getFormatType(){const e=this.getFormat();return Ak[e]||""}getStyle(){return this.getLatest().__style}getIndent(){return this.getLatest().__indent}getChildren(){const e=[];let t=this.getFirstChild();for(;t!==null;)e.push(t),t=t.getNextSibling();return e}getChildrenKeys(){const e=[];let t=this.getFirstChild();for(;t!==null;)e.push(t.__key),t=t.getNextSibling();return e}getChildrenSize(){return this.getLatest().__size}isEmpty(){return this.getChildrenSize()===0}isDirty(){const e=$e()._dirtyElements;return e!==null&&e.has(this.__key)}isLastChild(){const e=this.getLatest(),t=this.getParentOrThrow().getLastChild();return t!==null&&t.is(e)}getAllTextNodes(){const e=[];let t=this.getFirstChild();for(;t!==null;){if(z(t)&&e.push(t),j(t)){const r=t.getAllTextNodes();e.push(...r)}t=t.getNextSibling()}return e}getFirstDescendant(){let e=this.getFirstChild();for(;j(e);){const t=e.getFirstChild();if(t===null)break;e=t}return e}getLastDescendant(){let e=this.getLastChild();for(;j(e);){const t=e.getLastChild();if(t===null)break;e=t}return e}getDescendantByIndex(e){const t=this.getChildren(),r=t.length;if(e>=r){const s=t[r-1];return j(s)&&s.getLastDescendant()||s||null}const i=t[e];return j(i)&&i.getFirstDescendant()||i||null}getFirstChild(){const e=this.getLatest().__first;return e===null?null:de(e)}getFirstChildOrThrow(){const e=this.getFirstChild();return e===null&&H(45,this.__key),e}getLastChild(){const e=this.getLatest().__last;return e===null?null:de(e)}getLastChildOrThrow(){const e=this.getLastChild();return e===null&&H(96,this.__key),e}getChildAtIndex(e){const t=this.getChildrenSize();let r,i;if(e<t/2){for(r=this.getFirstChild(),i=0;r!==null&&i<=e;){if(i===e)return r;r=r.getNextSibling(),i++}return null}for(r=this.getLastChild(),i=t-1;r!==null&&i>=e;){if(i===e)return r;r=r.getPreviousSibling(),i--}return null}getTextContent(){let e="";const t=this.getChildren(),r=t.length;for(let i=0;i<r;i++){const s=t[i];e+=s.getTextContent(),j(s)&&i!==r-1&&!s.isInline()&&(e+=Rn)}return e}getTextContentSize(){let e=0;const t=this.getChildren(),r=t.length;for(let i=0;i<r;i++){const s=t[i];e+=s.getTextContentSize(),j(s)&&i!==r-1&&!s.isInline()&&(e+=Rn.length)}return e}getDirection(){return this.getLatest().__dir}getTextFormat(){return this.getLatest().__textFormat}hasFormat(e){if(e!==""){const t=qf[e];return!!(this.getFormat()&t)}return!1}hasTextFormat(e){const t=rr[e];return!!(this.getTextFormat()&t)}getFormatFlags(e,t){return Ka(this.getLatest().__textFormat,e,t)}getTextStyle(){return this.getLatest().__textStyle}select(e,t){Ze();const r=K();let i=e,s=t;const o=this.getChildrenSize();if(!this.canBeEmpty()){if(e===0&&t===0){const l=this.getFirstChild();if(z(l)||j(l))return l.select(0,0)}else if(!(e!==void 0&&e!==o||t!==void 0&&t!==o)){const l=this.getLastChild();if(z(l)||j(l))return l.select()}}i===void 0&&(i=o),s===void 0&&(s=o);const a=this.__key;return B(r)?(r.anchor.set(a,i,"element"),r.focus.set(a,s,"element"),r.dirty=!0,r):ay(a,i,a,s,"element","element")}selectStart(){const e=this.getFirstDescendant();return e?e.selectStart():this.select()}selectEnd(){const e=this.getLastDescendant();return e?e.selectEnd():this.select()}clear(){const e=this.getWritable();return this.getChildren().forEach(t=>t.remove()),e}append(...e){return this.splice(this.getChildrenSize(),0,e)}setDirection(e){const t=this.getWritable();return t.__dir=e,t}setFormat(e){return this.getWritable().__format=e!==""?qf[e]:0,this}setStyle(e){return this.getWritable().__style=e||"",this}setTextFormat(e){const t=this.getWritable();return t.__textFormat=e,t}setTextStyle(e){const t=this.getWritable();return t.__textStyle=e,t}setIndent(e){return this.getWritable().__indent=e,this}splice(e,t,r){const i=r.length,s=this.getChildrenSize(),o=this.getWritable();e+t<=s||H(226,String(e),String(t),String(s));const a=o.__key,l=[],c=[],u=this.getChildAtIndex(e+t);let f=null,d=s-t+i;if(e!==0)if(e===s)f=this.getLastChild();else{const p=this.getChildAtIndex(e);p!==null&&(f=p.getPreviousSibling())}if(t>0){let p=f===null?this.getFirstChild():f.getNextSibling();for(let m=0;m<t;m++){p===null&&H(100);const y=p.getNextSibling(),b=p.__key;Lr(p.getWritable()),c.push(b),p=y}}let h=f;for(let p=0;p<i;p++){const m=r[p];h!==null&&m.is(h)&&(f=h=h.getPreviousSibling());const y=m.getWritable();y.__parent===a&&d--,Lr(y);const b=m.__key;if(h===null)o.__first=b,y.__prev=null;else{const _=h.getWritable();_.__next=b,y.__prev=_.__key}m.__key===a&&H(76),y.__parent=a,l.push(b),h=m}if(e+t===s)h!==null&&(h.getWritable().__next=null,o.__last=h.__key);else if(u!==null){const p=u.getWritable();if(h!==null){const m=h.getWritable();p.__prev=h.__key,m.__next=u.__key}else p.__prev=null}if(o.__size=d,c.length){const p=K();if(B(p)){const m=new Set(c),y=new Set(l),{anchor:b,focus:_}=p;vh(b,m,y)&&Wa(b,b.getNode(),this,f,u),vh(_,m,y)&&Wa(_,_.getNode(),this,f,u),d!==0||this.canBeEmpty()||bn(this)||this.remove()}}return o}getDOMSlot(e){return new gx(e)}exportDOM(e){const{element:t}=super.exportDOM(e);if(Te(t)){const r=this.getIndent();r>0&&(t.style.paddingInlineStart=40*r+"px");const i=this.getDirection();i&&(t.dir=i)}return{element:t}}exportJSON(){const e={children:[],direction:this.getDirection(),format:this.getFormatType(),indent:this.getIndent(),...super.exportJSON()},t=this.getTextFormat(),r=this.getTextStyle();return t!==0&&(e.textFormat=t),r!==""&&(e.textStyle=r),e}updateFromJSON(e){return super.updateFromJSON(e).setFormat(e.format).setIndent(e.indent).setDirection(e.direction).setTextFormat(e.textFormat||0).setTextStyle(e.textStyle||"")}insertNewAfter(e,t){return null}canIndent(){return!0}collapseAtStart(e){return!1}excludeFromCopy(e){return!1}canReplaceWith(e){return!0}canInsertAfter(e){return!0}canBeEmpty(){return!0}canInsertTextBefore(){return!0}canInsertTextAfter(){return!0}isInline(){return!1}isShadowRoot(){return!1}canMergeWith(e){return!1}extractWithChild(e,t,r){return!1}canMergeWhenEmpty(){return!1}reconcileObservedMutation(e,t){const r=this.getDOMSlot(e);let i=r.getFirstChild();for(let s=this.getFirstChild();s;s=s.getNextSibling()){const o=t.getElementByKey(s.getKey());o!==null&&(i==null?(r.insertChild(o),i=o):i!==o&&r.replaceChild(o,i),i=i.nextSibling)}}};function j(n){return n instanceof ht}function vh(n,e,t){let r=n.getNode();for(;r;){const i=r.__key;if(e.has(i)&&!t.has(i))return!0;r=r.getParent()}return!1}let pr=class extends Yi{decorate(e,t){H(47)}isIsolated(){return!1}isInline(){return!0}isKeyboardSelectable(){return!0}};function ve(n){return n instanceof pr}let Od=class gy extends ht{static getType(){return"root"}static clone(){return new gy}constructor(){super("root"),this.__cachedText=null}getTopLevelElementOrThrow(){H(51)}getTextContent(){const e=this.__cachedText;return!Zi()&&$e()._dirtyType!==qr||e===null?super.getTextContent():e}remove(){H(52)}replace(e){H(53)}insertBefore(e){H(54)}insertAfter(e){H(55)}updateDOM(e,t){return!1}splice(e,t,r){for(const i of r)j(i)||ve(i)||H(282);return super.splice(e,t,r)}static importJSON(e){return pe().updateFromJSON(e)}collapseAtStart(){return!0}};function et(n){return n instanceof Od}function py(n){return new yy(new Map(n._nodeMap))}function $d(){return new yy(new Map([["root",new Od]]))}function my(n){const e=n.exportJSON(),t=n.constructor;if(e.type!==t.getType()&&H(130,t.name),j(n)){const r=e.children;Array.isArray(r)||H(59,t.name);const i=n.getChildren();for(let s=0;s<i.length;s++){const o=my(i[s]);r.push(o)}}return e}let yy=class _y{constructor(e,t){this._nodeMap=e,this._selection=t||null,this._flushSync=!1,this._readOnly=!1}isEmpty(){return this._nodeMap.size===1&&this._selection===null}read(e,t){return yh(t&&t.editor||null,this,e)}clone(e){const t=new _y(this._nodeMap,e===void 0?this._selection:e);return t._readOnly=!0,t}toJSON(){return yh(null,this,()=>({root:my(pe())}))}};const _u="historic",px="history-push",Ir="history-merge",by="paste",mx="collaboration",yx="skip-scroll-into-view",_x="skip-dom-selection";let Pd=class extends ht{static getType(){return"artificial"}createDOM(e){return document.createElement("div")}},Qi=class vy extends ht{static getType(){return"paragraph"}static clone(e){return new vy(e.__key)}createDOM(e){const t=document.createElement("p"),r=Ti(e.theme,"paragraph");return r!==void 0&&t.classList.add(...r),t}updateDOM(e,t,r){return!1}static importDOM(){return{p:e=>({conversion:bx,priority:0})}}exportDOM(e){const{element:t}=super.exportDOM(e);if(Te(t)){this.isEmpty()&&t.append(document.createElement("br"));const r=this.getFormatType();r&&(t.style.textAlign=r)}return{element:t}}static importJSON(e){return Ot().updateFromJSON(e)}exportJSON(){return{...super.exportJSON(),textFormat:this.getTextFormat(),textStyle:this.getTextStyle()}}insertNewAfter(e,t){const r=Ot();r.setTextFormat(e.format),r.setTextStyle(e.style);const i=this.getDirection();return r.setDirection(i),r.setFormat(this.getFormatType()),r.setStyle(this.getStyle()),this.insertAfter(r,t),r}collapseAtStart(){const e=this.getChildren();if(e.length===0||z(e[0])&&e[0].getTextContent().trim()===""){if(this.getNextSibling()!==null)return this.selectNext(),this.remove(),!0;if(this.getPreviousSibling()!==null)return this.selectPrevious(),this.remove(),!0}return!1}};function bx(n){const e=Ot();return n.style&&(e.setFormat(n.style.textAlign),Px(n,e)),{node:e}}function Ot(){return Me(new Qi)}function Id(n){return n instanceof Qi}const ne=0,ei=1,Ca=2,_l=3,Si=4;function ky(n,e,t,r){const i=n._keyToDOMMap;i.clear(),n._editorState=$d(),n._pendingEditorState=r,n._compositionKey=null,n._dirtyType=qr,n._cloneNotNeeded.clear(),n._dirtyLeaves=new Set,n._dirtyElements.clear(),n._normalizedNodes=new Set,n._updateTags=new Set,n._updates=[],n._blockCursorElement=null;const s=n._observer;s!==null&&(s.disconnect(),n._observer=null),e!==null&&(e.textContent=""),t!==null&&(t.textContent="",i.set("root",t))}function vx(n){const e=n||{},t=hx(),r=e.theme||{},i=n===void 0?t:e.parentEditor||null,s=e.disableEvents||!1,o=$d(),a=e.namespace||(i!==null?i._config.namespace:Ny()),l=e.editorState,c=[Od,At,lo,Nd,Qi,Pd,...e.nodes||[]],{onError:u,html:f}=e,d=e.editable===void 0||e.editable;let h;if(n===void 0&&t!==null)h=t._nodes;else{h=new Map;for(let m=0;m<c.length;m++){let y=c[m],b=null,_=null;if(typeof y!="function"){const D=y;y=D.replace,b=D.with,_=D.withKlass||null}const{ownNodeConfig:C}=Kd(y),E=y.getType(),O=y.transform(),N=new Set;C&&C.$transform&&N.add(C.$transform),O!==null&&N.add(O),h.set(E,{exportDOM:f&&f.export?f.export.get(y):void 0,klass:y,replace:b,replaceWithKlass:_,sharedNodeState:Fk(c[m]),transforms:N})}}const p=new bl(o,i,h,{disableEvents:s,namespace:a,theme:r},u||console.error,function(m,y){const b=new Map,_=new Set,C=E=>{Object.keys(E).forEach(O=>{let N=b.get(O);N===void 0&&(N=[],b.set(O,N)),N.push(E[O])})};return m.forEach(E=>{const O=E.klass.importDOM;if(O==null||_.has(O))return;_.add(O);const N=O.call(E.klass);N!==null&&C(N)}),y&&C(y),b}(h,f?f.import:void 0),d,n);return l!==void 0&&(p._pendingEditorState=l,p._dirtyType=Pi),p}let bl=class{constructor(e,t,r,i,s,o,a,l){this._createEditorArgs=l,this._parentEditor=t,this._rootElement=null,this._editorState=e,this._pendingEditorState=null,this._compositionKey=null,this._deferred=[],this._keyToDOMMap=new Map,this._updates=[],this._updating=!1,this._listeners={decorator:new Set,editable:new Set,mutation:new Map,root:new Set,textcontent:new Set,update:new Set},this._commands=new Map,this._config=i,this._nodes=r,this._decorators={},this._pendingDecorators=null,this._dirtyType=qr,this._cloneNotNeeded=new Set,this._dirtyLeaves=new Set,this._dirtyElements=new Map,this._normalizedNodes=new Set,this._updateTags=new Set,this._observer=null,this._key=Ny(),this._onError=s,this._htmlConversions=o,this._editable=a,this._headless=t!==null&&t._headless,this._window=null,this._blockCursorElement=null}isComposing(){return this._compositionKey!=null}registerUpdateListener(e){const t=this._listeners.update;return t.add(e),()=>{t.delete(e)}}registerEditableListener(e){const t=this._listeners.editable;return t.add(e),()=>{t.delete(e)}}registerDecoratorListener(e){const t=this._listeners.decorator;return t.add(e),()=>{t.delete(e)}}registerTextContentListener(e){const t=this._listeners.textcontent;return t.add(e),()=>{t.delete(e)}}registerRootListener(e){const t=this._listeners.root;return e(this._rootElement,null),t.add(e),()=>{e(null,this._rootElement),t.delete(e)}}registerCommand(e,t,r){r===void 0&&H(35);const i=this._commands;i.has(e)||i.set(e,[new Set,new Set,new Set,new Set,new Set]);const s=i.get(e);s===void 0&&H(36,String(e));const o=s[r];return o.add(t),()=>{o.delete(t),s.every(a=>a.size===0)&&i.delete(e)}}registerMutationListener(e,t,r){const i=this.resolveRegisteredNodeAfterReplacements(this.getRegisteredNode(e)).klass,s=this._listeners.mutation;let o=s.get(t);o===void 0&&(o=new Set,s.set(t,o)),o.add(i);const a=r&&r.skipInitialization;return a!==void 0&&a||this.initializeMutationListener(t,i),()=>{o.delete(i),o.size===0&&s.delete(t)}}getRegisteredNode(e){const t=this._nodes.get(e.getType());return t===void 0&&H(37,e.name),t}resolveRegisteredNodeAfterReplacements(e){for(;e.replaceWithKlass;)e=this.getRegisteredNode(e.replaceWithKlass);return e}initializeMutationListener(e,t){const r=this._editorState,i=Mh(r).get(t.getType());if(!i)return;const s=new Map;for(const o of i.keys())s.set(o,"created");s.size>0&&e(s,{dirtyLeaves:new Set,prevEditorState:r,updateTags:new Set(["registerMutationListener"])})}registerNodeTransformToKlass(e,t){const r=this.getRegisteredNode(e);return r.transforms.add(t),r}registerNodeTransform(e,t){const r=this.registerNodeTransformToKlass(e,t),i=[r],s=r.replaceWithKlass;if(s!=null){const o=this.registerNodeTransformToKlass(s,t);i.push(o)}return function(o,a){const l=Mh(o.getEditorState()),c=[];for(const u of a){const f=l.get(u);f&&c.push(f)}c.length!==0&&o.update(()=>{for(const u of c)for(const f of u.keys()){const d=de(f);d&&d.markDirty()}},o._pendingEditorState===null?{tag:Ir}:void 0)}(this,i.map(o=>o.klass.getType())),()=>{i.forEach(o=>o.transforms.delete(t))}}hasNode(e){return this._nodes.has(e.getType())}hasNodes(e){return e.every(this.hasNode.bind(this))}dispatchCommand(e,t){return Y(this,e,t)}getDecorators(){return this._decorators}getRootElement(){return this._rootElement}getKey(){return this._key}setRootElement(e){const t=this._rootElement;if(e!==t){const r=Ti(this._config.theme,"root"),i=this._pendingEditorState||this._editorState;if(this._rootElement=e,ky(this,t,e,i),t!==null&&(this._config.disableEvents||tx(t),r!=null&&t.classList.remove(...r)),e!==null){const s=zd(e),o=e.style;o.userSelect="text",o.whiteSpace="pre-wrap",o.wordBreak="break-word",e.setAttribute("data-lexical-editor","true"),this._window=s,this._dirtyType=Pi,Em(this),this._updateTags.add(Ir),On(this),this._config.disableEvents||function(a,l){const c=a.ownerDocument,u=Ua.get(c);(u===void 0||u<1)&&c.addEventListener("selectionchange",Gm),Ua.set(c,(u||0)+1),a.__lexicalEditor=l;const f=Vm(a);for(let d=0;d<fu.length;d++){const[h,p]=fu[d],m=typeof p=="function"?y=>{th(y)||(eh(y),(l.isEditable()||h==="click")&&p(y,l))}:y=>{if(th(y))return;eh(y);const b=l.isEditable();switch(h){case"cut":return b&&Y(l,Qr,y);case"copy":return Y(l,hr,y);case"paste":return b&&Y(l,Zr,y);case"dragstart":return b&&Y(l,Sd,y);case"dragover":return b&&Y(l,qm,y);case"dragend":return b&&Y(l,Xk,y);case"focus":return b&&Y(l,Zk,y);case"blur":return b&&Y(l,Qk,y);case"drop":return b&&Y(l,ml,y)}};a.addEventListener(h,m),f.push(()=>{a.removeEventListener(h,m)})}}(e,this),r!=null&&e.classList.add(...r)}else this._window=null,this._updateTags.add(Ir),On(this);Fs("root",this,!1,e,t)}}getElementByKey(e){return this._keyToDOMMap.get(e)||null}getEditorState(){return this._editorState}setEditorState(e,t){e.isEmpty()&&H(38);let r=e;r._readOnly&&(r=py(e),r._selection=e._selection?e._selection.clone():null),Tm(this);const i=this._pendingEditorState,s=this._updateTags,o=t!==void 0?t.tag:null;i===null||i.isEmpty()||(o!=null&&s.add(o),On(this)),this._pendingEditorState=r,this._dirtyType=Pi,this._dirtyElements.set("root",!1),this._compositionKey=null,o!=null&&s.add(o),this._updating||On(this)}parseEditorState(e,t){return function(r,i,s){const o=$d(),a=We,l=Ct,c=Ke,u=i._dirtyElements,f=i._dirtyLeaves,d=i._cloneNotNeeded,h=i._dirtyType;i._dirtyElements=new Map,i._dirtyLeaves=new Set,i._cloneNotNeeded=new Set,i._dirtyType=0,We=o,Ct=!1,Ke=i,Rd(null);try{const p=i._nodes;Ad(r.root,p),s&&s(),o._readOnly=!0}catch(p){p instanceof Error&&i._onError(p)}finally{i._dirtyElements=u,i._dirtyLeaves=f,i._cloneNotNeeded=d,i._dirtyType=h,We=a,Ct=l,Ke=c}return o}(typeof e=="string"?JSON.parse(e):e,this,t)}read(e){return On(this),this.getEditorState().read(e,{editor:this})}update(e,t){(function(r,i,s){r._updating?r._updates.push([i,s]):yl(r,i,s)})(this,e,t)}focus(e,t={}){const r=this._rootElement;r!==null&&(r.setAttribute("autocapitalize","off"),Et(this,()=>{const i=K(),s=pe();i!==null?i.dirty||it(i.clone()):s.getChildrenSize()!==0&&(t.defaultSelection==="rootStart"?s.selectStart():s.selectEnd()),Py("focus"),Ex(()=>{r.removeAttribute("autocapitalize"),e&&e()})}),this._pendingEditorState===null&&r.removeAttribute("autocapitalize"))}blur(){const e=this._rootElement;e!==null&&e.blur();const t=Gt(this._window);t!==null&&t.removeAllRanges()}isEditable(){return this._editable}setEditable(e){this._editable!==e&&(this._editable=e,Fs("editable",this,!0,e))}toJSON(){return{editorState:this._editorState.toJSON()}}};bl.version="0.34.0+prod.esm";let bu=null;function Rd(n){bu=n}let kx=1;function xy(n,e){const t=Ld(n,e);return t===void 0&&H(30,e),t}function Ld(n,e){return n._nodes.get(e)}const xx=typeof queueMicrotask=="function"?queueMicrotask:n=>{Promise.resolve().then(n)};function kh(n){return ve(sr(n))}function Dd(n){const e=document.activeElement;if(!Te(e))return!1;const t=e.nodeName;return ve(sr(n))&&(t==="INPUT"||t==="TEXTAREA"||e.contentEditable==="true"&&vl(e)==null)}function ho(n,e,t){const r=n.getRootElement();try{return r!==null&&r.contains(e)&&r.contains(t)&&e!==null&&!Dd(e)&&Cy(e)===n}catch{return!1}}function jd(n){return n instanceof bl}function Cy(n){let e=n;for(;e!=null;){const t=vl(e);if(jd(t))return t;e=go(e)}return null}function vl(n){return n?n.__lexicalEditor:null}function Rr(n){return ty(n)||n.isToken()}function Mn(n){return Rr(n)||n.isSegmented()}function qn(n){return ti(n)&&n.nodeType===bk}function Cx(n){return ti(n)&&n.nodeType===vk}function ji(n){let e=n;for(;e!=null;){if(qn(e))return e;e=e.firstChild}return null}function Ka(n,e,t){const r=rr[e];if(t!==null&&(n&r)==(t&r))return n;let i=n^r;return e==="subscript"?i&=-65:e==="superscript"?i&=-33:e==="lowercase"?(i&=-513,i&=-1025):e==="uppercase"?(i&=-257,i&=-1025):e==="capitalize"&&(i&=-257,i&=-513),i}function wx(n,e){const t=function(){const o=bu;return bu=null,o}();if((e=e||t&&t.__key)!=null)return void(n.__key=e);Ze(),uy();const r=$e(),i=gr(),s=""+kx++;i._nodeMap.set(s,n),j(n)?r._dirtyElements.set(s,!0):r._dirtyLeaves.add(s),r._cloneNotNeeded.add(s),r._dirtyType=km,n.__key=s}function Lr(n){const e=n.getParent();if(e!==null){const t=n.getWritable(),r=e.getWritable(),i=n.getPreviousSibling(),s=n.getNextSibling(),o=s!==null?s.__key:null,a=i!==null?i.__key:null,l=i!==null?i.getWritable():null,c=s!==null?s.getWritable():null;i===null&&(r.__first=o),s===null&&(r.__last=a),l!==null&&(l.__next=o),c!==null&&(c.__prev=a),t.__prev=null,t.__next=null,t.__parent=null,r.__size--}}function Ha(n){uy();const e=n.getLatest(),t=e.__parent,r=gr(),i=$e(),s=r._nodeMap,o=i._dirtyElements;t!==null&&function(l,c,u){let f=l;for(;f!==null;){if(u.has(f))return;const d=c.get(f);if(d===void 0)break;u.set(f,!1),f=d.__parent}}(t,s,o);const a=e.__key;i._dirtyType=km,j(n)?o.set(a,!0):i._dirtyLeaves.add(a)}function Qe(n){Ze();const e=$e(),t=e._compositionKey;if(n!==t){if(e._compositionKey=n,t!==null){const r=de(t);r!==null&&r.getWritable()}if(n!==null){const r=de(n);r!==null&&r.getWritable()}}}function Xn(){return Zi()?null:$e()._compositionKey}function de(n,e){const t=(e||gr())._nodeMap.get(n);return t===void 0?null:t}function wy(n,e){const t=kl(n,$e());return t!==void 0?de(t,e):null}function kl(n,e){return n[`__lexicalKey_${e._key}`]}function sr(n,e){let t=n;for(;t!=null;){const r=wy(t,e);if(r!==null)return r;t=go(t)}return null}function Sy(n){const e=n._decorators,t=Object.assign({},e);return n._pendingDecorators=t,t}function xh(n){return n.read(()=>pe().getTextContent())}function pe(){return Ty(gr())}function Ty(n){return n._nodeMap.get("root")}function it(n){Ze();const e=gr();n!==null&&(n.dirty=!0,n.setCachedNodes(null)),e._selection=n}function Ci(n){const e=$e(),t=function(r,i){let s=r;for(;s!=null;){const o=kl(s,i);if(o!==void 0)return o;s=go(s)}return null}(n,e);return t===null?n===e.getRootElement()?de("root"):null:de(t)}function Ey(n){return/[\uD800-\uDBFF][\uDC00-\uDFFF]/g.test(n)}function Fd(n){const e=[];let t=n;for(;t!==null;)e.push(t),t=t._parentEditor;return e}function Ny(){return Math.random().toString(36).replace(/[^a-z]+/g,"").substring(0,5)}function My(n){return qn(n)?n.nodeValue:null}function qd(n,e,t){const r=Gt(jt(e));if(r===null)return;const i=r.anchorNode;let{anchorOffset:s,focusOffset:o}=r;if(i!==null){let a=My(i);const l=sr(i);if(a!==null&&z(l)){if(a===hl&&t){const c=t.length;a=t,s=c,o=c}a!==null&&Bd(l,a,s,o,n)}}}function Bd(n,e,t,r,i){let s=n;if(s.isAttached()&&(i||!s.isDirty())){const o=s.isComposing();let a=e;(o||i)&&e[e.length-1]===hl&&(a=e.slice(0,-1));const l=s.getTextContent();if(i||a!==l){if(a===""){if(Qe(null),Us||$i||Pa)s.remove();else{const m=$e();setTimeout(()=>{m.update(()=>{s.isAttached()&&s.remove()})},20)}return}const c=s.getParent(),u=Xi(),f=s.getTextContentSize(),d=Xn(),h=s.getKey();if(s.isToken()||d!==null&&h===d&&!o||B(u)&&(c!==null&&!c.canInsertTextBefore()&&u.anchor.offset===0||u.anchor.key===n.__key&&u.anchor.offset===0&&!s.canInsertTextBefore()&&!o||u.focus.key===n.__key&&u.focus.offset===f&&!s.canInsertTextAfter()&&!o))return void s.markDirty();const p=K();if(!B(p)||t===null||r===null)return void Ch(s,a,p);if(p.setTextNodeRange(s,t,s,r),s.isSegmented()){const m=ue(s.getTextContent());s.replace(m),s=m}Ch(s,a,p)}}}function Ch(n,e,t){if(n.setTextContent(e),B(t)){const r=n.getKey();for(const i of["anchor","focus"]){const s=t[i];s.type==="text"&&s.key===r&&(s.offset=nr(n,s.offset,"clamp"))}}}function Jo(n,e,t){const r=e[t]||!1;return r==="any"||r===n[t]}function Sx(n,e){return Jo(n,e,"altKey")&&Jo(n,e,"ctrlKey")&&Jo(n,e,"shiftKey")&&Jo(n,e,"metaKey")}function we(n,e,t){return Sx(n,t)&&n.key.toLowerCase()===e.toLowerCase()}const Nn={ctrlKey:!cn,metaKey:cn},wh={altKey:cn,ctrlKey:!cn};function Sh(n){return n.key==="Backspace"}function Th(n){return we(n,"a",Nn)}function Ay(n){const e=pe();if(B(n)){const t=n.anchor,r=n.focus,i=t.getNode().getTopLevelElementOrThrow().getParentOrThrow();return t.set(i.getKey(),0,"element"),r.set(i.getKey(),i.getChildrenSize(),"element"),zs(n),n}{const t=e.select(0,e.getChildrenSize());return it(zs(t)),t}}function Ti(n,e){n.__lexicalClassNameCache===void 0&&(n.__lexicalClassNameCache={});const t=n.__lexicalClassNameCache,r=t[e];if(r!==void 0)return r;const i=n[e];if(typeof i=="string"){const s=Ia(i);return t[e]=s,s}return i}function Ud(n,e,t,r,i){if(t.size===0)return;const s=r.__type,o=r.__key,a=e.get(s);a===void 0&&H(33,s);const l=a.klass;let c=n.get(l);c===void 0&&(c=new Map,n.set(l,c));const u=c.get(o),f=u==="destroyed"&&i==="created";(u===void 0||f)&&c.set(o,f?"updated":i)}function Eh(n,e,t){const r=n.getParent();let i=t,s=n;return r!==null&&(e&&t===0?(i=s.getIndexWithinParent(),s=r):e||t!==s.getChildrenSize()||(i=s.getIndexWithinParent()+1,s=r)),s.getChildAtIndex(e?i-1:i)}function vu(n,e){const t=n.offset;if(n.type==="element")return Eh(n.getNode(),e,t);{const r=n.getNode();if(e&&t===0||!e&&t===r.getTextContentSize()){const i=e?r.getPreviousSibling():r.getNextSibling();return i===null?Eh(r.getParentOrThrow(),e,r.getIndexWithinParent()+(e?0:1)):i}}return null}function Oy(n){const e=jt(n).event,t=e&&e.inputType;return t==="insertFromPaste"||t==="insertFromPasteAsQuotation"}function Y(n,e,t){return function(r,i,s){const o=Fd(r);for(let a=4;a>=0;a--)for(let l=0;l<o.length;l++){const c=o[l],u=c._commands.get(i);if(u!==void 0){const f=u[a];if(f!==void 0){const d=Array.from(f),h=d.length;let p=!1;if(Et(c,()=>{for(let m=0;m<h;m++)if(d[m](s,r))return void(p=!0)}),p)return p}}}return!1}(n,e,t)}function xl(n){return!et(n)&&!n.isLastChild()&&!n.isInline()}function Fi(n,e){const t=n._keyToDOMMap.get(e);return t===void 0&&H(75,e),t}function go(n){const e=n.assignedSlot||n.parentElement;return Cu(e)?e.host:e}function $y(n){return Cx(n)?n:Te(n)?n.ownerDocument:null}function Tx(n){return $e()._updateTags.has(n)}function Py(n){Ze(),$e()._updateTags.add(n)}function Ex(n){Ze(),$e()._deferred.push(n)}function ku(n,e){let t=n.getParent();for(;t!==null;){if(t.is(e))return!0;t=t.getParent()}return!1}function zd(n){const e=$y(n);return e?e.defaultView:null}function jt(n){const e=n._window;return e===null&&H(78),e}function Nx(n){return j(n)&&n.isInline()||ve(n)&&n.isInline()}function Mx(n){let e=n.getParentOrThrow();for(;e!==null;){if(bn(e))return e;e=e.getParentOrThrow()}return e}function bn(n){return et(n)||j(n)&&n.isShadowRoot()}function Me(n){const e=$e(),t=n.getType(),r=Ld(e,t);r===void 0&&H(200,n.constructor.name,t);const{replace:i,replaceWithKlass:s}=r;if(i!==null){const o=i(n),a=o.constructor;return s!==null?o instanceof s||H(201,s.name,s.getType(),a.name,a.getType(),n.constructor.name,t):o instanceof n.constructor&&a!==n.constructor||H(202,a.name,a.getType(),n.constructor.name,t),o.__key===n.__key&&H(203,n.constructor.name,t,a.name,a.getType()),o}return n}function Rc(n,e){!et(n.getParent())||j(e)||ve(e)||H(99)}function Ax(n){const e=de(n);return e===null&&H(63,n),e}function Lc(n){return(ve(n)||j(n)&&!n.canBeEmpty())&&!n.isInline()}function xu(n,e,t){t.style.removeProperty("caret-color"),e._blockCursorElement=null;const r=n.parentElement;r!==null&&r.removeChild(n)}function Gt(n){return Qt?(n||window).getSelection():null}function Ox(n){const e=zd(n);return e?e.getSelection():null}function Iy(n){return Te(n)&&n.tagName==="A"}function Te(n){return ti(n)&&n.nodeType===_k}function ti(n){return typeof n=="object"&&n!==null&&"nodeType"in n&&typeof n.nodeType=="number"}function Cu(n){return ti(n)&&n.nodeType===kk}function wu(n){const e=new RegExp(/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|mark|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var|#text)$/,"i");return n.nodeName.match(e)!==null}function Ja(n){const e=new RegExp(/^(address|article|aside|blockquote|canvas|dd|div|dl|dt|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hr|li|main|nav|noscript|ol|p|pre|section|table|td|tfoot|ul|video)$/,"i");return n.nodeName.match(e)!==null}function Rt(n){if(ve(n)&&!n.isInline())return!0;if(!j(n)||bn(n))return!1;const e=n.getFirstChild(),t=e===null||Pr(e)||z(e)||e.isInline();return!n.isInline()&&n.canBeEmpty()!==!1&&t}function Dc(n,e){let t=n;for(;t!==null&&t.getParent()!==null&&!e(t);)t=t.getParentOrThrow();return e(t)?t:null}function Cl(){return $e()}const Nh=new WeakMap,$x=new Map;function Mh(n){if(!n._readOnly&&n.isEmpty())return $x;n._readOnly||H(192);let e=Nh.get(n);return e||(e=function(t){const r=new Map;for(const[i,s]of t._nodeMap){const o=s.__type;let a=r.get(o);a||(a=new Map,r.set(o,a)),a.set(i,s)}return r}(n),Nh.set(n,e)),e}function Wd(n){const e=n.constructor.clone(n);return e.afterCloneFrom(n),e}function Px(n,e){const t=parseInt(n.style.paddingInlineStart,10)||0,r=Math.round(t/40);e.setIndent(r)}function Ix(n){n.__lexicalUnmanaged=!0}function Rx(n){return n.__lexicalUnmanaged===!0}function Ss(n,e){return function(t,r){return Object.prototype.hasOwnProperty.call(t,r)}(n,e)&&n[e]!==Yi[e]}function Kd(n){const e=Bf in n.prototype?n.prototype[Bf]():void 0,t=function(o){return o===pr||o===ht||o===Yi}(n),r=!t&&Ss(n,"getType")?n.getType():void 0;let i,s=r;if(e)if(r)i=e[r];else for(const[o,a]of Object.entries(e))s=o,i=a;if(!t&&s&&(Ss(n,"getType")||(n.getType=()=>s),Ss(n,"clone")||(n.clone=o=>(Rd(o),new n)),Ss(n,"importJSON")||(n.importJSON=i&&i.$importJSON||(o=>new n().updateFromJSON(o))),!Ss(n,"importDOM")&&i)){const{importDOM:o}=i;o&&(n.importDOM=()=>o)}return{ownNodeConfig:i,ownNodeType:s}}const Lx={next:"previous",previous:"next"};let Hd=class{constructor(e){this.origin=e}[Symbol.iterator](){return wl({hasNext:zr,initial:this.getAdjacentCaret(),map:e=>e,step:e=>e.getAdjacentCaret()})}getAdjacentCaret(){return Be(this.getNodeAtCaret(),this.direction)}getSiblingCaret(){return Be(this.origin,this.direction)}remove(){const e=this.getNodeAtCaret();return e&&e.remove(),this}replaceOrInsert(e,t){const r=this.getNodeAtCaret();return e.is(this.origin)||e.is(r)||(r===null?this.insert(e):r.replace(e,t)),this}splice(e,t,r="next"){const i=r===this.direction?t:Array.from(t).reverse();let s=this;const o=this.getParentAtCaret(),a=new Map;for(let l=s.getAdjacentCaret();l!==null&&a.size<e;l=l.getAdjacentCaret()){const c=l.origin.getWritable();a.set(c.getKey(),c)}for(const l of i){if(a.size>0){const c=s.getNodeAtCaret();if(c){if(a.delete(c.getKey()),a.delete(l.getKey()),!(c.is(l)||s.origin.is(l))){const u=l.getParent();u&&u.is(o)&&l.remove(),c.replace(l)}}else c===null&&H(263,Array.from(a).join(" "))}else s.insert(l);s=Be(l,this.direction)}for(const l of a.values())l.remove();return this}},Su=class Ry extends Hd{constructor(){super(...arguments);Pt(this,"type","child")}getLatest(){const t=this.origin.getLatest();return t===this.origin?this:Yt(t,this.direction)}getParentCaret(t="root"){return Be(Jd(this.getParentAtCaret(),t),this.direction)}getFlipped(){const t=es(this.direction);return Be(this.getNodeAtCaret(),t)||Yt(this.origin,t)}getParentAtCaret(){return this.origin}getChildCaret(){return this}isSameNodeCaret(t){return t instanceof Ry&&this.direction===t.direction&&this.origin.is(t.origin)}isSamePointCaret(t){return this.isSameNodeCaret(t)}};const Dx={root:et,shadowRoot:bn};function es(n){return Lx[n]}function Jd(n,e="root"){return Dx[e](n)?null:n}let Va=class Tu extends Hd{constructor(){super(...arguments);Pt(this,"type","sibling")}getLatest(){const t=this.origin.getLatest();return t===this.origin?this:Be(t,this.direction)}getSiblingCaret(){return this}getParentAtCaret(){return this.origin.getParent()}getChildCaret(){return j(this.origin)?Yt(this.origin,this.direction):null}getParentCaret(t="root"){return Be(Jd(this.getParentAtCaret(),t),this.direction)}getFlipped(){const t=es(this.direction);return Be(this.getNodeAtCaret(),t)||Yt(this.origin.getParentOrThrow(),t)}isSamePointCaret(t){return t instanceof Tu&&this.direction===t.direction&&this.origin.is(t.origin)}isSameNodeCaret(t){return(t instanceof Tu||t instanceof Ga)&&this.direction===t.direction&&this.origin.is(t.origin)}},Ga=class Eu extends Hd{constructor(t,r){super(t);Pt(this,"type","text");this.offset=r}getLatest(){const t=this.origin.getLatest();return t===this.origin?this:Wr(t,this.direction,this.offset)}getParentAtCaret(){return this.origin.getParent()}getChildCaret(){return null}getParentCaret(t="root"){return Be(Jd(this.getParentAtCaret(),t),this.direction)}getFlipped(){return Wr(this.origin,es(this.direction),this.offset)}isSamePointCaret(t){return t instanceof Eu&&this.direction===t.direction&&this.origin.is(t.origin)&&this.offset===t.offset}isSameNodeCaret(t){return(t instanceof Va||t instanceof Eu)&&this.direction===t.direction&&this.origin.is(t.origin)}getSiblingCaret(){return Be(this.origin,this.direction)}};function tr(n){return n instanceof Ga}function zr(n){return n instanceof Va}function Ht(n){return n instanceof Su}const jx={next:class extends Ga{constructor(){super(...arguments);Pt(this,"direction","next")}getNodeAtCaret(){return this.origin.getNextSibling()}insert(e){return this.origin.insertAfter(e),this}},previous:class extends Ga{constructor(){super(...arguments);Pt(this,"direction","previous")}getNodeAtCaret(){return this.origin.getPreviousSibling()}insert(e){return this.origin.insertBefore(e),this}}},Fx={next:class extends Va{constructor(){super(...arguments);Pt(this,"direction","next")}getNodeAtCaret(){return this.origin.getNextSibling()}insert(e){return this.origin.insertAfter(e),this}},previous:class extends Va{constructor(){super(...arguments);Pt(this,"direction","previous")}getNodeAtCaret(){return this.origin.getPreviousSibling()}insert(e){return this.origin.insertBefore(e),this}}},qx={next:class extends Su{constructor(){super(...arguments);Pt(this,"direction","next")}getNodeAtCaret(){return this.origin.getFirstChild()}insert(e){return this.origin.splice(0,0,[e]),this}},previous:class extends Su{constructor(){super(...arguments);Pt(this,"direction","previous")}getNodeAtCaret(){return this.origin.getLastChild()}insert(e){return this.origin.splice(this.origin.getChildrenSize(),0,[e]),this}}};function Be(n,e){return n?new Fx[e](n):null}function Wr(n,e,t){return n?new jx[e](n,nr(n,t)):null}function nr(n,e,t="error"){const r=n.getTextContentSize();let i=e==="next"?r:e==="previous"?0:e;return(i<0||i>r)&&(t!=="clamp"&&function(s,...o){const a=new URL("https://lexical.dev/docs/error"),l=new URLSearchParams;l.append("code",s);for(const c of o)l.append("v",c);a.search=l.toString(),console.warn(`Minified Lexical warning #${s}; visit ${a.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}(284,String(e),String(r),n.getKey()),i=i<0?0:r),i}function Ah(n,e){return new zx(n,e)}function Yt(n,e){return j(n)?new qx[e](n):null}function Bx(n){return n&&n.getChildCaret()||n}function Vs(n){return n&&Bx(n.getAdjacentCaret())}let Ux=class Ly{constructor(e,t,r){Pt(this,"type","node-caret-range");this.anchor=e,this.focus=t,this.direction=r}getLatest(){const e=this.anchor.getLatest(),t=this.focus.getLatest();return e===this.anchor&&t===this.focus?this:new Ly(e,t,this.direction)}isCollapsed(){return this.anchor.isSamePointCaret(this.focus)}getTextSlices(){const e=i=>{const s=this[i].getLatest();return tr(s)?function(o,a){const{direction:l,origin:c}=o,u=nr(c,a==="focus"?es(l):l);return Ah(o,u-o.offset)}(s,i):null},t=e("anchor"),r=e("focus");if(t&&r){const{caret:i}=t,{caret:s}=r;if(i.isSameNodeCaret(s))return[Ah(i,s.offset-i.offset),null]}return[t,r]}iterNodeCarets(e="root"){const t=tr(this.anchor)?this.anchor.getSiblingCaret():this.anchor.getLatest(),r=this.focus.getLatest(),i=tr(r),s=o=>o.isSameNodeCaret(r)?null:Vs(o)||o.getParentCaret(e);return wl({hasNext:o=>o!==null&&!(i&&r.isSameNodeCaret(o)),initial:t.isSameNodeCaret(r)?null:s(t),map:o=>o,step:s})}[Symbol.iterator](){return this.iterNodeCarets("root")}},zx=class{constructor(e,t){Pt(this,"type","slice");this.caret=e,this.distance=t}getSliceIndices(){const{distance:e,caret:{offset:t}}=this,r=t+e;return r<t?[r,t]:[t,r]}getTextContent(){const[e,t]=this.getSliceIndices();return this.caret.origin.getTextContent().slice(e,t)}getTextContentSize(){return Math.abs(this.distance)}removeTextSlice(){const{caret:{origin:e,direction:t}}=this,[r,i]=this.getSliceIndices(),s=e.getTextContent();return Wr(e.setTextContent(s.slice(0,r)+s.slice(i)),t,r)}};function Vd(n){return or(n,Be(pe(),n.direction))}function Wx(n){return or(n,n)}function or(n,e){return n.direction!==e.direction&&H(265),new Ux(n,e,n.direction)}function wl(n){const{initial:e,hasNext:t,step:r,map:i}=n;let s=e;return{[Symbol.iterator](){return this},next(){if(!t(s))return{done:!0,value:void 0};const o={done:!1,value:i(s)};return s=r(s),o}}}function Dy(n,e){const t=qs(n.origin,e.origin);switch(t===null&&H(275,n.origin.getKey(),e.origin.getKey()),t.type){case"same":{const r=n.type==="text",i=e.type==="text";return r&&i?function(s,o){return Math.sign(s-o)}(n.offset,e.offset):n.type===e.type?0:r?-1:i?1:n.type==="child"?-1:1}case"ancestor":return n.type==="child"?-1:1;case"descendant":return e.type==="child"?1:-1;case"branch":return jy(t)}}function jy(n){const{a:e,b:t}=n,r=e.__key,i=t.__key;let s=e,o=t;for(;s&&o;s=s.getNextSibling(),o=o.getNextSibling()){if(s.__key===i)return-1;if(o.__key===r)return 1}return s===null?1:-1}function Vo(n,e){return e.is(n)}function Oh(n){return j(n)?[n.getLatest(),null]:[n.getParent(),n.getLatest()]}function qs(n,e){if(n.is(e))return{commonAncestor:n,type:"same"};const t=new Map;for(let[r,i]=Oh(n);r;i=r,r=r.getParent())t.set(r,i);for(let[r,i]=Oh(e);r;i=r,r=r.getParent()){const s=t.get(r);if(s!==void 0)return s===null?(Vo(n,r)||H(276),{commonAncestor:r,type:"ancestor"}):i===null?(Vo(e,r)||H(277),{commonAncestor:r,type:"descendant"}):((j(s)||Vo(n,s))&&(j(i)||Vo(e,i))&&r.is(s.getParent())&&r.is(i.getParent())||H(278),{a:s,b:i,commonAncestor:r,type:"branch"})}return null}function Ln(n,e){const{type:t,key:r,offset:i}=n,s=Ax(n.key);return t==="text"?(z(s)||H(266,s.getType(),r),Wr(s,e,i)):(j(s)||H(267,s.getType(),r),Jx(s,n.offset,e))}function Gs(n,e){const{origin:t,direction:r}=e,i=r==="next";tr(e)?n.set(t.getKey(),e.offset,"text"):zr(e)?z(t)?n.set(t.getKey(),nr(t,r),"text"):n.set(t.getParentOrThrow().getKey(),t.getIndexWithinParent()+(i?1:0),"element"):(Ht(e)&&j(t)||H(268),n.set(t.getKey(),i?0:t.getChildrenSize(),"element"))}function Kx(n){const e=K(),t=B(e)?e:fo();return wa(t,n),it(t),t}function wa(n,e){Gs(n.anchor,e.anchor),Gs(n.focus,e.focus)}function $h(n){const{anchor:e,focus:t}=n,r=Ln(e,"next"),i=Ln(t,"next"),s=Dy(r,i)<=0?"next":"previous";return or(qi(r,s),qi(i,s))}function Sl(n){const{direction:e,origin:t}=n,r=Be(t,es(e)).getNodeAtCaret();return r?Be(r,e):Yt(t.getParentOrThrow(),e)}function Ph(n,e="root"){const t=[n];for(let r=Ht(n)?n.getParentCaret(e):n.getSiblingCaret();r!==null;r=r.getParentCaret(e))t.push(Sl(r));return t}function jc(n){return!!n&&n.origin.isAttached()}function Hx(n,e="removeEmptySlices"){if(n.isCollapsed())return n;const t="root",r="next";let i=e;const s=qy(n,r),o=Ph(s.anchor,t),a=Ph(s.focus.getFlipped(),t),l=new Set,c=[];for(const p of s.iterNodeCarets(t))if(Ht(p))l.add(p.origin.getKey());else if(zr(p)){const{origin:m}=p;j(m)&&!l.has(m.getKey())||c.push(m)}for(const p of c)p.remove();for(const p of s.getTextSlices()){if(!p)continue;const{origin:m}=p.caret,y=m.getTextContentSize(),b=Sl(Be(m,r)),_=m.getMode();if(Math.abs(p.distance)===y&&i==="removeEmptySlices"||_==="token"&&p.distance!==0)b.remove();else if(p.distance!==0){i="removeEmptySlices";let C=p.removeTextSlice();const E=p.caret.origin;if(_==="segmented"){const O=C.origin,N=ue(O.getTextContent()).setStyle(O.getStyle()).setFormat(O.getFormat());b.replaceOrInsert(N),C=Wr(N,r,C.offset)}E.is(o[0].origin)&&(o[0]=C),E.is(a[0].origin)&&(a[0]=C.getFlipped())}}let u,f;for(const p of o)if(jc(p)){u=fn(p);break}for(const p of a)if(jc(p)){f=fn(p);break}const d=function(p,m,y){if(!p||!m)return null;const b=p.getParentAtCaret(),_=m.getParentAtCaret();if(!b||!_)return null;const C=b.getParents().reverse();C.push(b);const E=_.getParents().reverse();E.push(_);const O=Math.min(C.length,E.length);let N;for(N=0;N<O&&C[N]===E[N];N++);const D=(R,k)=>{let I;for(let w=N;w<R.length;w++){const L=R[w];if(bn(L))return;!I&&k(L)&&(I=L)}return I},P=D(C,Rt),$=P&&D(E,R=>y.has(R.getKey())&&Rt(R));return P&&$?[P,$]:null}(u,f,l);if(d){const[p,m]=d;Yt(p,"previous").splice(0,m.getChildren()),m.remove()}const h=[u,f,...o,...a].find(jc);if(h)return Wx(qi(fn(h),n.direction));H(269,JSON.stringify(o.map(p=>p.origin.__key)))}function fn(n){const e=function(i){let s=i;for(;Ht(s);){const o=Vs(s);if(!Ht(o))break;s=o}return s}(n.getLatest()),{direction:t}=e;if(z(e.origin))return tr(e)?e:Wr(e.origin,t,t);const r=e.getAdjacentCaret();return zr(r)&&z(r.origin)?Wr(r.origin,t,es(t)):e}function Fy(n){return tr(n)&&n.offset!==nr(n.origin,n.direction)}function qi(n,e){return n.direction===e?n:n.getFlipped()}function qy(n,e){return n.direction===e?n:or(qi(n.focus,e),qi(n.anchor,e))}function Jx(n,e,t){let r=Yt(n,"next");for(let i=0;i<e;i++){const s=r.getAdjacentCaret();if(s===null)break;r=s}return qi(r,t)}const Vx=new Map;function Ih(n){let e=n;for(;e!=null;){if(e.nodeType===Node.TEXT_NODE)return e;e=e.firstChild}return null}function Rh(n){const e=n.parentNode;if(e==null)throw new Error("Should never happen");return[e,Array.from(e.childNodes).indexOf(n)]}function Gx(n,e,t,r,i){const s=e.getKey(),o=r.getKey(),a=document.createRange();let l=n.getElementByKey(s),c=n.getElementByKey(o),u=t,f=i;if(z(e)&&(l=Ih(l)),z(r)&&(c=Ih(c)),e===void 0||r===void 0||l===null||c===null)return null;l.nodeName==="BR"&&([l,u]=Rh(l)),c.nodeName==="BR"&&([c,f]=Rh(c));const d=l.firstChild;l===c&&d!=null&&d.nodeName==="BR"&&u===0&&f===0&&(f=1);try{a.setStart(l,u),a.setEnd(c,f)}catch{return null}return!a.collapsed||u===f&&s===o||(a.setStart(c,f),a.setEnd(l,u)),a}function Yx(n,e){const t=n.getRootElement();if(t===null)return[];const r=t.getBoundingClientRect(),i=getComputedStyle(t),s=parseFloat(i.paddingLeft)+parseFloat(i.paddingRight),o=Array.from(e.getClientRects());let a,l=o.length;o.sort((c,u)=>{const f=c.top-u.top;return Math.abs(f)<=3?c.left-u.left:f});for(let c=0;c<l;c++){const u=o[c],f=a&&a.top<=u.top&&a.top+a.height>u.top&&a.left+a.width>u.left,d=u.width+s===r.width;f||d?(o.splice(c--,1),l--):a=u}return o}function Xx(n){const e={};if(!n)return e;const t=n.split(";");for(const r of t)if(r!==""){const[i,s]=r.split(/:([^]+)/);i&&s&&(e[i.trim()]=s.trim())}return e}function By(n,e){const t=n.getStartEndPoints();if(e.isSelected(n)&&!Mn(e)&&t!==null){const[r,i]=t,s=n.isBackward(),o=r.getNode(),a=i.getNode(),l=e.is(o),c=e.is(a);if(l||c){const[u,f]=mu(n),d=o.is(a),h=e.is(s?a:o),p=e.is(s?o:a);let m,y=0;d?(y=u>f?f:u,m=u>f?u:f):h?(y=s?f:u,m=void 0):p&&(y=0,m=s?u:f),e.__text=e.__text.slice(y,m)}}return e}function Zx(n){const e=n.getStyle(),t=Xx(e);Vx.set(e,t)}function Qx(n,e){const t=n.getFormatType(),r=n.getIndent();t!==e.getFormatType()&&e.setFormat(t),r!==e.getIndent()&&e.setIndent(r)}function eC(n,e,t=Qx){if(n===null)return;const r=n.getStartEndPoints(),i=new Map;let s=null;if(r){const[o,a]=r;s=fo(),s.anchor.set(o.key,o.offset,o.type),s.focus.set(a.key,a.offset,a.type);const l=Fc(o.getNode(),Rt),c=Fc(a.getNode(),Rt);j(l)&&i.set(l.getKey(),l),j(c)&&i.set(c.getKey(),c)}for(const o of n.getNodes())if(j(o)&&Rt(o))i.set(o.getKey(),o);else if(r===null){const a=Fc(o,Rt);j(a)&&i.set(a.getKey(),a)}for(const[o,a]of i){const l=e();t(a,l),a.replace(l,!0),s&&(o===s.anchor.key&&s.anchor.set(l.getKey(),s.anchor.offset,s.anchor.type),o===s.focus.key&&s.focus.set(l.getKey(),s.focus.offset,s.focus.type))}s&&n.is(K())&&it(s)}function Uy(n){const e=n.anchor.getNode(),t=et(e)?e:e.getParentOrThrow(),r=Cl().getElementByKey(t.getKey());if(r===null)return!1;const i=r.ownerDocument.defaultView;return i===null?!1:i.getComputedStyle(r).writingMode==="vertical-rl"}function Ya(n,e){let t=Uy(n)?!e:e;zy(n)&&(t=!t);const r=Ln(n.focus,t?"previous":"next");if(Fy(r))return!1;for(const i of Vd(r)){if(Ht(i))return!i.origin.isInline();if(!j(i.origin)){if(ve(i.origin))return!0;break}}return!1}function tC(n,e,t,r){n.modify(e?"extend":"move",t,r)}function zy(n){const e=n.anchor.getNode();return(et(e)?e:e.getParentOrThrow()).getDirection()==="rtl"}function Xa(n,e,t){const r=zy(n);let i;i=Uy(n)||r?!t:t,tC(n,e,i,"character")}function Fc(n,e){let t=n;for(;t!==null&&t.getParent()!==null&&!e(t);)t=t.getParentOrThrow();return e(t)?t:null}function nC(n,...e){const t=new URL("https://lexical.dev/docs/error"),r=new URLSearchParams;r.append("code",n);for(const i of e)r.append("v",i);throw t.search=r.toString(),Error(`Minified Lexical error #${n}; visit ${t.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}const po=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,rC=po&&"documentMode"in document?document.documentMode:null,iC=po&&/Mac|iPod|iPhone|iPad/.test(navigator.platform),sC=po&&/^(?!.*Seamonkey)(?=.*Firefox).*/i.test(navigator.userAgent);!(!po||!("InputEvent"in window)||rC)&&"getTargetRanges"in new window.InputEvent("input");function Wy(...n){const e=[];for(const t of n)if(t&&typeof t=="string")for(const[r]of t.matchAll(/\S+/g))e.push(r);return e}function He(...n){return()=>{for(let e=n.length-1;e>=0;e--)n[e]();n.length=0}}const oC=po,Nu=iC,aC=sC;function ct(n,...e){const t=Wy(...e);t.length>0&&n.classList.add(...t)}function Dr(n,...e){const t=Wy(...e);t.length>0&&n.classList.remove(...t)}function Tl(n,e){return Array.from(lC(n))}function lC(n,e){return cC("next",n)}function cC(n,e,t){const r=pe(),i=e||r,s=j(i)?Yt(i,n):Be(i,n),o=uC(i),a=function(c,u){const f=Dh(Be(c,u));return f&&f[0]}(i,n);let l=o;return wl({hasNext:c=>c!==null,initial:s,map:c=>({depth:l,node:c.origin}),step:c=>{if(c.isSameNodeCaret(a))return null;Ht(c)&&l++;const u=Dh(c);return!u||u[0].isSameNodeCaret(a)?null:(l+=u[1],u[0])}})}function uC(n){let e=-1;for(let t=n;t!==null;t=t.getParent())e++;return e}function dC(n){const e=Xt(n,t=>j(t)&&!t.isInline());return j(e)||nC(4,n.__key),e}const Xt=(n,e)=>{let t=n;for(;t!==pe()&&t!=null;){if(e(t))return t;t=t.getParent()}return null};function Ky(n,e,t,r){const i=s=>s instanceof e;return n.registerNodeTransform(e,s=>{const o=(a=>{const l=a.getChildren();for(let f=0;f<l.length;f++){const d=l[f];if(i(d))return null}let c=a,u=a;for(;c!==null;)if(u=c,c=c.getParent(),i(c))return{child:u,parent:c};return null})(s);if(o!==null){const{child:a,parent:l}=o;if(a.is(s)){r(l,s);const c=a.getNextSiblings(),u=c.length;if(l.insertAfter(a),u!==0){const f=t(l);a.insertAfter(f);for(let d=0;d<u;d++)f.append(c[d])}l.canBeEmpty()||l.getChildrenSize()!==0||l.remove()}}})}function Pn(n,e){return n!==null&&Object.getPrototypeOf(n).constructor.name===e.name}let qc=!(aC||!oC)&&void 0;function fC(n){let e=1;if(function(){if(qc===void 0){const t=document.createElement("div");t.style.cssText="position: absolute; opacity: 0; width: 100px; left: -1000px;",document.body.appendChild(t);const r=t.getBoundingClientRect();t.style.setProperty("zoom","2"),qc=t.getBoundingClientRect().width===r.width,document.body.removeChild(t)}return qc}())for(;n;)e*=Number(window.getComputedStyle(n).getPropertyValue("zoom")),n=n.parentElement;return e}function Hy(n,e){const t=[],r=Array.from(n).reverse();for(let i=r.pop();i!==void 0;i=r.pop())if(e(i))t.push(i);else if(j(i))for(const s of hC(i))r.push(s);return t}function hC(n){return gC(Yt(n,"previous"))}function gC(n){return wl({hasNext:zr,initial:n.getAdjacentCaret(),map:e=>e.origin.getLatest(),step:e=>e.getAdjacentCaret()})}function Lh(n){Sl(Be(n,"next")).splice(1,n.getChildren())}function Dh(n,e="root"){let t=0,r=n,i=Vs(r);for(;i===null;){if(t--,i=r.getParentCaret(e),!i)return null;r=i,i=Vs(r)}return i&&[i,t]}var pC=Object.getOwnPropertyNames,mC=Object.getOwnPropertySymbols,yC=Object.prototype.hasOwnProperty;function jh(n,e){return function(r,i,s){return n(r,i,s)&&e(r,i,s)}}function Go(n){return function(t,r,i){if(!t||!r||typeof t!="object"||typeof r!="object")return n(t,r,i);var s=i.cache,o=s.get(t),a=s.get(r);if(o&&a)return o===r&&a===t;s.set(t,r),s.set(r,t);var l=n(t,r,i);return s.delete(t),s.delete(r),l}}function Fh(n){return pC(n).concat(mC(n))}var _C=Object.hasOwn||function(n,e){return yC.call(n,e)};function ni(n,e){return n===e||!n&&!e&&n!==n&&e!==e}var bC="__v",vC="__o",kC="_owner",qh=Object.getOwnPropertyDescriptor,Bh=Object.keys;function xC(n,e,t){var r=n.length;if(e.length!==r)return!1;for(;r-- >0;)if(!t.equals(n[r],e[r],r,r,n,e,t))return!1;return!0}function CC(n,e){return ni(n.getTime(),e.getTime())}function wC(n,e){return n.name===e.name&&n.message===e.message&&n.cause===e.cause&&n.stack===e.stack}function SC(n,e){return n===e}function Uh(n,e,t){var r=n.size;if(r!==e.size)return!1;if(!r)return!0;for(var i=new Array(r),s=n.entries(),o,a,l=0;(o=s.next())&&!o.done;){for(var c=e.entries(),u=!1,f=0;(a=c.next())&&!a.done;){if(i[f]){f++;continue}var d=o.value,h=a.value;if(t.equals(d[0],h[0],l,f,n,e,t)&&t.equals(d[1],h[1],d[0],h[0],n,e,t)){u=i[f]=!0;break}f++}if(!u)return!1;l++}return!0}var TC=ni;function EC(n,e,t){var r=Bh(n),i=r.length;if(Bh(e).length!==i)return!1;for(;i-- >0;)if(!Jy(n,e,t,r[i]))return!1;return!0}function Ts(n,e,t){var r=Fh(n),i=r.length;if(Fh(e).length!==i)return!1;for(var s,o,a;i-- >0;)if(s=r[i],!Jy(n,e,t,s)||(o=qh(n,s),a=qh(e,s),(o||a)&&(!o||!a||o.configurable!==a.configurable||o.enumerable!==a.enumerable||o.writable!==a.writable)))return!1;return!0}function NC(n,e){return ni(n.valueOf(),e.valueOf())}function MC(n,e){return n.source===e.source&&n.flags===e.flags}function zh(n,e,t){var r=n.size;if(r!==e.size)return!1;if(!r)return!0;for(var i=new Array(r),s=n.values(),o,a;(o=s.next())&&!o.done;){for(var l=e.values(),c=!1,u=0;(a=l.next())&&!a.done;){if(!i[u]&&t.equals(o.value,a.value,o.value,a.value,n,e,t)){c=i[u]=!0;break}u++}if(!c)return!1}return!0}function AC(n,e){var t=n.length;if(e.length!==t)return!1;for(;t-- >0;)if(n[t]!==e[t])return!1;return!0}function OC(n,e){return n.hostname===e.hostname&&n.pathname===e.pathname&&n.protocol===e.protocol&&n.port===e.port&&n.hash===e.hash&&n.username===e.username&&n.password===e.password}function Jy(n,e,t,r){return(r===kC||r===vC||r===bC)&&(n.$$typeof||e.$$typeof)?!0:_C(e,r)&&t.equals(n[r],e[r],r,r,n,e,t)}var $C="[object Arguments]",PC="[object Boolean]",IC="[object Date]",RC="[object Error]",LC="[object Map]",DC="[object Number]",jC="[object Object]",FC="[object RegExp]",qC="[object Set]",BC="[object String]",UC="[object URL]",zC=Array.isArray,Wh=typeof ArrayBuffer=="function"&&ArrayBuffer.isView?ArrayBuffer.isView:null,Kh=Object.assign,WC=Object.prototype.toString.call.bind(Object.prototype.toString);function KC(n){var e=n.areArraysEqual,t=n.areDatesEqual,r=n.areErrorsEqual,i=n.areFunctionsEqual,s=n.areMapsEqual,o=n.areNumbersEqual,a=n.areObjectsEqual,l=n.arePrimitiveWrappersEqual,c=n.areRegExpsEqual,u=n.areSetsEqual,f=n.areTypedArraysEqual,d=n.areUrlsEqual;return function(p,m,y){if(p===m)return!0;if(p==null||m==null)return!1;var b=typeof p;if(b!==typeof m)return!1;if(b!=="object")return b==="number"?o(p,m,y):b==="function"?i(p,m,y):!1;var _=p.constructor;if(_!==m.constructor)return!1;if(_===Object)return a(p,m,y);if(zC(p))return e(p,m,y);if(Wh!=null&&Wh(p))return f(p,m,y);if(_===Date)return t(p,m,y);if(_===RegExp)return c(p,m,y);if(_===Map)return s(p,m,y);if(_===Set)return u(p,m,y);var C=WC(p);return C===IC?t(p,m,y):C===FC?c(p,m,y):C===LC?s(p,m,y):C===qC?u(p,m,y):C===jC?typeof p.then!="function"&&typeof m.then!="function"&&a(p,m,y):C===UC?d(p,m,y):C===RC?r(p,m,y):C===$C?a(p,m,y):C===PC||C===DC||C===BC?l(p,m,y):!1}}function HC(n){var e=n.circular,t=n.createCustomConfig,r=n.strict,i={areArraysEqual:r?Ts:xC,areDatesEqual:CC,areErrorsEqual:wC,areFunctionsEqual:SC,areMapsEqual:r?jh(Uh,Ts):Uh,areNumbersEqual:TC,areObjectsEqual:r?Ts:EC,arePrimitiveWrappersEqual:NC,areRegExpsEqual:MC,areSetsEqual:r?jh(zh,Ts):zh,areTypedArraysEqual:r?Ts:AC,areUrlsEqual:OC};if(t&&(i=Kh({},i,t(i))),e){var s=Go(i.areArraysEqual),o=Go(i.areMapsEqual),a=Go(i.areObjectsEqual),l=Go(i.areSetsEqual);i=Kh({},i,{areArraysEqual:s,areMapsEqual:o,areObjectsEqual:a,areSetsEqual:l})}return i}function JC(n){return function(e,t,r,i,s,o,a){return n(e,t,a)}}function VC(n){var e=n.circular,t=n.comparator,r=n.createState,i=n.equals,s=n.strict;if(r)return function(l,c){var u=r(),f=u.cache,d=f===void 0?e?new WeakMap:void 0:f,h=u.meta;return t(l,c,{cache:d,equals:i,meta:h,strict:s})};if(e)return function(l,c){return t(l,c,{cache:new WeakMap,equals:i,meta:void 0,strict:s})};var o={cache:void 0,equals:i,meta:void 0,strict:s};return function(l,c){return t(l,c,o)}}var Jn=mr();mr({strict:!0});mr({circular:!0});mr({circular:!0,strict:!0});mr({createInternalComparator:function(){return ni}});mr({strict:!0,createInternalComparator:function(){return ni}});mr({circular:!0,createInternalComparator:function(){return ni}});mr({circular:!0,createInternalComparator:function(){return ni},strict:!0});function mr(n){n===void 0&&(n={});var e=n.circular,t=e===void 0?!1:e,r=n.createInternalComparator,i=n.createState,s=n.strict,o=s===void 0?!1:s,a=HC(n),l=KC(a),c=r?r(l):JC(l);return VC({circular:t,comparator:l,createState:i,equals:c,strict:o})}const Vy=x.createContext(null);function GC(n,e){return{getTheme:function(){return e??null}}}function ge(){const n=x.useContext(Vy);return n==null&&function(e,...t){const r=new URL("https://lexical.dev/docs/error"),i=new URLSearchParams;i.append("code",e);for(const s of t)i.append("v",s);throw r.search=i.toString(),Error(`Minified Lexical error #${e}; visit ${r.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}(8),n}function YC(n,e){const t=e.body?e.body.childNodes:[];let r=[];const i=[];for(let s=0;s<t.length;s++){const o=t[s];if(!Xy.has(o.nodeName)){const a=Zy(o,n,i,!1);a!==null&&(r=r.concat(a))}}return function(s){for(const o of s)o.getNextSibling()instanceof Pd&&o.insertAfter(Ur());for(const o of s){const a=o.getChildren();for(const l of a)o.insertBefore(l);o.remove()}}(i),r}function Gy(n,e){if(typeof document>"u"||typeof window>"u"&&global.window===void 0)throw new Error("To use $generateHtmlFromNodes in headless mode please initialize a headless browser implementation such as JSDom before calling this function.");const t=document.createElement("div"),r=pe().getChildren();for(let i=0;i<r.length;i++)Yy(n,r[i],t,e);return t.innerHTML}function Yy(n,e,t,r=null){let i=r===null||e.isSelected(r);const s=j(e)&&e.excludeFromCopy("html");let o=e;if(r!==null){let h=Wd(e);h=z(h)&&r!==null?By(r,h):h,o=h}const a=j(o)?o.getChildren():[],l=Ld(n,o.getType());let c;c=l&&l.exportDOM!==void 0?l.exportDOM(n,o):o.exportDOM(n);const{element:u,after:f}=c;if(!u)return!1;const d=document.createDocumentFragment();for(let h=0;h<a.length;h++){const p=a[h],m=Yy(n,p,d,r);!i&&j(e)&&m&&e.extractWithChild(p,r,"html")&&(i=!0)}if(i&&!s){if((Te(u)||Cu(u))&&u.append(d),t.append(u),f){const h=f.call(o,u);h&&(Cu(u)?u.replaceChildren(h):u.replaceWith(h))}}else t.append(d);return i}const Xy=new Set(["STYLE","SCRIPT"]);function Zy(n,e,t,r,i=new Map,s){let o=[];if(Xy.has(n.nodeName))return o;let a=null;const l=function(p,m){const{nodeName:y}=p,b=m._htmlConversions.get(y.toLowerCase());let _=null;if(b!==void 0)for(const C of b){const E=C(p);E!==null&&(_===null||(_.priority||0)<=(E.priority||0))&&(_=E)}return _!==null?_.conversion:null}(n,e),c=l?l(n):null;let u=null;if(c!==null){u=c.after;const p=c.node;if(a=Array.isArray(p)?p[p.length-1]:p,a!==null){for(const[,m]of i)if(a=m(a,s),!a)break;a&&o.push(...Array.isArray(p)?p:[a])}c.forChild!=null&&i.set(n.nodeName,c.forChild)}const f=n.childNodes;let d=[];const h=(a==null||!bn(a))&&(a!=null&&yu(a)||r);for(let p=0;p<f.length;p++)d.push(...Zy(f[p],e,t,h,new Map(i),a));return u!=null&&(d=u(d)),Ja(n)&&(d=XC(n,d,h?()=>{const p=new Pd;return t.push(p),p}:Ot)),a==null?d.length>0?o=o.concat(d):Ja(n)&&function(p){return p.nextSibling==null||p.previousSibling==null?!1:wu(p.nextSibling)&&wu(p.previousSibling)}(n)&&(o=o.concat(Ur())):j(a)&&a.append(...d),o}function XC(n,e,t){const r=n.style.textAlign,i=[];let s=[];for(let o=0;o<e.length;o++){const a=e[o];if(yu(a))r&&!a.getFormat()&&a.setFormat(r),i.push(a);else if(s.push(a),o===e.length-1||o<e.length-1&&yu(e[o+1])){const l=t();l.setFormat(r),l.append(...s),i.push(l),s=[]}}return i}const ZC=new Set(["http:","https:","mailto:","sms:","tel:"]);let Qy=class e_ extends ht{static getType(){return"link"}static clone(e){return new e_(e.__url,{rel:e.__rel,target:e.__target,title:e.__title},e.__key)}constructor(e="",t={},r){super(r);const{target:i=null,rel:s=null,title:o=null}=t;this.__url=e,this.__target=i,this.__rel=s,this.__title=o}createDOM(e){const t=document.createElement("a");return this.updateLinkDOM(null,t,e),ct(t,e.theme.link),t}updateLinkDOM(e,t,r){if(Iy(t)){e&&e.__url===this.__url||(t.href=this.sanitizeUrl(this.__url));for(const i of["target","rel","title"]){const s=`__${i}`,o=this[s];e&&e[s]===o||(o?t[i]=o:t.removeAttribute(i))}}}updateDOM(e,t,r){return this.updateLinkDOM(e,t,r),!1}static importDOM(){return{a:e=>({conversion:QC,priority:1})}}static importJSON(e){return Mu().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setURL(e.url).setRel(e.rel||null).setTarget(e.target||null).setTitle(e.title||null)}sanitizeUrl(e){e=Hh(e);try{const t=new URL(Hh(e));if(!ZC.has(t.protocol))return"about:blank"}catch{return e}return e}exportJSON(){return{...super.exportJSON(),rel:this.getRel(),target:this.getTarget(),title:this.getTitle(),url:this.getURL()}}getURL(){return this.getLatest().__url}setURL(e){const t=this.getWritable();return t.__url=e,t}getTarget(){return this.getLatest().__target}setTarget(e){const t=this.getWritable();return t.__target=e,t}getRel(){return this.getLatest().__rel}setRel(e){const t=this.getWritable();return t.__rel=e,t}getTitle(){return this.getLatest().__title}setTitle(e){const t=this.getWritable();return t.__title=e,t}insertNewAfter(e,t=!0){const r=Mu(this.__url,{rel:this.__rel,target:this.__target,title:this.__title});return this.insertAfter(r,t),r}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}canBeEmpty(){return!1}isInline(){return!0}extractWithChild(e,t,r){if(!B(t))return!1;const i=t.anchor.getNode(),s=t.focus.getNode();return this.isParentOf(i)&&this.isParentOf(s)&&t.getTextContent().length>0}isEmailURI(){return this.__url.startsWith("mailto:")}isWebSiteURI(){return this.__url.startsWith("https://")||this.__url.startsWith("http://")}};function QC(n){let e=null;if(Iy(n)){const t=n.textContent;(t!==null&&t!==""||n.children.length>0)&&(e=Mu(n.getAttribute("href")||"",{rel:n.getAttribute("rel"),target:n.getAttribute("target"),title:n.getAttribute("title")}))}return{node:e}}function Mu(n="",e){return Me(new Qy(n,e))}function ew(n){return n instanceof Qy}const tw=/^\+?[0-9\s()-]{5,}$/;function Hh(n){return n.match(/^[a-z][a-z0-9+.-]*:/i)||n.match(/^[/#.]/)?n:n.includes("@")?`mailto:${n}`:tw.test(n)?`tel:${n}`:`https://${n}`}const t_=[];let n_=class r_ extends ht{static getType(){return"mark"}static clone(e){return new r_(e.__ids,e.__key)}static importDOM(){return null}static importJSON(e){return Jh().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setIDs(e.ids)}exportJSON(){return{...super.exportJSON(),ids:this.getIDs()}}constructor(e=t_,t){super(t),this.__ids=e}createDOM(e){const t=document.createElement("mark");return ct(t,e.theme.mark),this.__ids.length>1&&ct(t,e.theme.markOverlap),t}updateDOM(e,t,r){const i=e.__ids,s=this.__ids,o=i.length,a=s.length,l=r.theme.markOverlap;return o!==a&&(o===1?a===2&&ct(t,l):a===1&&Dr(t,l)),!1}hasID(e){return this.getIDs().includes(e)}getIDs(){return Array.from(this.getLatest().__ids)}setIDs(e){const t=this.getWritable();return t.__ids=e,t}addID(e){const t=this.getWritable();return t.__ids.includes(e)?t:t.setIDs([...t.__ids,e])}deleteID(e){const t=this.getWritable(),r=t.__ids.indexOf(e);if(r===-1)return t;const i=Array.from(t.__ids);return i.splice(r,1),t.setIDs(i)}insertNewAfter(e,t=!0){const r=Jh(this.__ids);return this.insertAfter(r,t),r}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}canBeEmpty(){return!1}isInline(){return!0}extractWithChild(e,t,r){if(!B(t)||r==="html")return!1;const i=t.anchor,s=t.focus,o=i.getNode(),a=s.getNode(),l=t.isBackward()?i.offset-s.offset:s.offset-i.offset;return this.isParentOf(o)&&this.isParentOf(a)&&this.getTextContent().length===l}excludeFromCopy(e){return e!=="clone"}};function Jh(n=t_){return Me(new n_(n))}function nw(n){return n instanceof n_}function Za(n,...e){const t=new URL("https://lexical.dev/docs/error"),r=new URLSearchParams;r.append("code",n);for(const i of e)r.append("v",i);throw t.search=r.toString(),Error(`Minified Lexical error #${n}; visit ${t.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}function i_(n,e=K()){return e==null&&Za(166),B(e)&&e.isCollapsed()||e.getNodes().length===0?"":Gy(n,e)}function rw(n,e=K()){return e==null&&Za(166),B(e)&&e.isCollapsed()||e.getNodes().length===0?null:JSON.stringify(iw(n,e))}function Vh(n,e){const t=n.getData("text/plain")||n.getData("text/uri-list");t!=null&&e.insertRawText(t)}function Gh(n,e,t){const r=n.getData("application/x-lexical-editor");if(r)try{const a=JSON.parse(r);if(a.namespace===t._config.namespace&&Array.isArray(a.nodes))return Yh(t,sw(a.nodes),e)}catch{}const i=n.getData("text/html"),s=n.getData("text/plain");if(i&&s!==i)try{const a=new DOMParser().parseFromString(function(l){return window.trustedTypes&&window.trustedTypes.createPolicy?window.trustedTypes.createPolicy("lexical",{createHTML:c=>c}).createHTML(l):l}(i),"text/html");return Yh(t,YC(t,a),e)}catch{}const o=s||n.getData("text/uri-list");if(o!=null)if(B(e)){const a=o.split(/(\r?\n|\t)/);a[a.length-1]===""&&a.pop();for(let l=0;l<a.length;l++){const c=K();if(B(c)){const u=a[l];u===`
`||u===`\r
`?c.insertParagraph():u==="	"?c.insertNodes([co()]):c.insertText(u)}}}else e.insertRawText(o)}function Yh(n,e,t){n.dispatchCommand(Kk,{nodes:e,selection:t})||(t.insertNodes(e),function(r){if(B(r)&&r.isCollapsed()){const i=r.anchor;let s=null;const o=Ln(i,"previous");if(o)if(tr(o))s=o.origin;else{const a=or(o,Yt(pe(),"next").getFlipped());for(const l of a){if(z(l.origin)){s=l.origin;break}if(j(l.origin)&&!l.origin.isInline())break}}if(s&&z(s)){const a=s.getFormat(),l=s.getStyle();r.format===a&&r.style===l||(r.format=a,r.style=l,r.dirty=!0)}}}(t))}function s_(n,e,t,r=[]){let i=e===null||t.isSelected(e);const s=j(t)&&t.excludeFromCopy("html");let o=t;if(e!==null){let c=Wd(t);c=z(c)&&e!==null?By(e,c):c,o=c}const a=j(o)?o.getChildren():[],l=function(c){const u=c.exportJSON(),f=c.constructor;if(u.type!==f.getType()&&Za(58,f.name),j(c)){const d=u.children;Array.isArray(d)||Za(59,f.name)}return u}(o);if(z(o)){const c=o.__text;c.length>0?l.text=c:i=!1}for(let c=0;c<a.length;c++){const u=a[c],f=s_(n,e,u,l.children);!i&&j(t)&&f&&t.extractWithChild(u,e,"clone")&&(i=!0)}if(i&&!s)r.push(l);else if(Array.isArray(l.children))for(let c=0;c<l.children.length;c++){const u=l.children[c];r.push(u)}return i}function iw(n,e){const t=[],r=pe().getChildren();for(let i=0;i<r.length;i++)s_(n,e,r[i],t);return{namespace:n._config.namespace,nodes:t}}function sw(n){const e=[];for(let t=0;t<n.length;t++){const r=n[t],i=hy(r);z(i)&&Zx(i),e.push(i)}return e}let _i=null;async function Xh(n,e,t){if(_i!==null)return!1;if(e!==null)return new Promise((c,u)=>{n.update(()=>{c(Zh(n,e,t))})});const r=n.getRootElement(),i=n._window||window,s=window.document,o=Gt(i);if(r===null||o===null)return!1;const a=s.createElement("span");a.style.cssText="position: fixed; top: -1000px;",a.append(s.createTextNode("#")),r.append(a);const l=new Range;return l.setStart(a,0),l.setEnd(a,1),o.removeAllRanges(),o.addRange(l),new Promise((c,u)=>{const f=n.registerCommand(hr,d=>(Pn(d,ClipboardEvent)&&(f(),_i!==null&&(window.clearTimeout(_i),_i=null),c(Zh(n,d,t))),!0),Si);_i=window.setTimeout(()=>{f(),_i=null,c(!1)},50),s.execCommand("copy"),a.remove()})}function Zh(n,e,t){if(t===void 0){const i=Gt(n._window);if(!i)return!1;const s=i.anchorNode,o=i.focusNode;if(s!==null&&o!==null&&!ho(n,s,o))return!1;const a=K();if(a===null)return!1;t=aw(a)}e.preventDefault();const r=e.clipboardData;return r!==null&&(lw(r,t),!0)}const ow=[["text/html",i_],["application/x-lexical-editor",rw]];function aw(n=K()){const e={"text/plain":n?n.getTextContent():""};if(n){const t=Cl();for(const[r,i]of ow){const s=i(t,n);s!==null&&(e[r]=s)}}return e}function lw(n,e){for(const t in e){const r=e[t];r!==void 0&&n.setData(t,r)}}const Gd=/^(\d+(?:\.\d+)?)px$/,Ei={BOTH:3,NO_STATUS:0,ROW:1};let Yd=class o_ extends ht{static getType(){return"tablecell"}static clone(e){return new o_(e.__headerState,e.__colSpan,e.__width,e.__key)}afterCloneFrom(e){super.afterCloneFrom(e),this.__rowSpan=e.__rowSpan,this.__backgroundColor=e.__backgroundColor,this.__verticalAlign=e.__verticalAlign}static importDOM(){return{td:e=>({conversion:Qh,priority:0}),th:e=>({conversion:Qh,priority:0})}}static importJSON(e){return a_().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setHeaderStyles(e.headerState).setColSpan(e.colSpan||1).setRowSpan(e.rowSpan||1).setWidth(e.width||void 0).setBackgroundColor(e.backgroundColor||null).setVerticalAlign(e.verticalAlign||void 0)}constructor(e=Ei.NO_STATUS,t=1,r,i){super(i),this.__colSpan=t,this.__rowSpan=1,this.__headerState=e,this.__width=r,this.__backgroundColor=null,this.__verticalAlign=void 0}createDOM(e){const t=document.createElement(this.getTag());return this.__width&&(t.style.width=`${this.__width}px`),this.__colSpan>1&&(t.colSpan=this.__colSpan),this.__rowSpan>1&&(t.rowSpan=this.__rowSpan),this.__backgroundColor!==null&&(t.style.backgroundColor=this.__backgroundColor),Au(this.__verticalAlign)&&(t.style.verticalAlign=this.__verticalAlign),ct(t,e.theme.tableCell,this.hasHeader()&&e.theme.tableCellHeader),t}exportDOM(e){const t=super.exportDOM(e);if(Te(t.element)){const r=t.element;r.setAttribute("data-temporary-table-cell-lexical-key",this.getKey()),r.style.border="1px solid black",this.__colSpan>1&&(r.colSpan=this.__colSpan),this.__rowSpan>1&&(r.rowSpan=this.__rowSpan),r.style.width=`${this.getWidth()||75}px`,r.style.verticalAlign=this.getVerticalAlign()||"top",r.style.textAlign="start",this.__backgroundColor===null&&this.hasHeader()&&(r.style.backgroundColor="#f2f3f5")}return t}exportJSON(){return{...super.exportJSON(),...Au(this.__verticalAlign)&&{verticalAlign:this.__verticalAlign},backgroundColor:this.getBackgroundColor(),colSpan:this.__colSpan,headerState:this.__headerState,rowSpan:this.__rowSpan,width:this.getWidth()}}getColSpan(){return this.getLatest().__colSpan}setColSpan(e){const t=this.getWritable();return t.__colSpan=e,t}getRowSpan(){return this.getLatest().__rowSpan}setRowSpan(e){const t=this.getWritable();return t.__rowSpan=e,t}getTag(){return this.hasHeader()?"th":"td"}setHeaderStyles(e,t=Ei.BOTH){const r=this.getWritable();return r.__headerState=e&t|r.__headerState&~t,r}getHeaderStyles(){return this.getLatest().__headerState}setWidth(e){const t=this.getWritable();return t.__width=e,t}getWidth(){return this.getLatest().__width}getBackgroundColor(){return this.getLatest().__backgroundColor}setBackgroundColor(e){const t=this.getWritable();return t.__backgroundColor=e,t}getVerticalAlign(){return this.getLatest().__verticalAlign}setVerticalAlign(e){const t=this.getWritable();return t.__verticalAlign=e||void 0,t}toggleHeaderStyle(e){const t=this.getWritable();return(t.__headerState&e)===e?t.__headerState-=e:t.__headerState+=e,t}hasHeaderState(e){return(this.getHeaderStyles()&e)===e}hasHeader(){return this.getLatest().__headerState!==Ei.NO_STATUS}updateDOM(e){return e.__headerState!==this.__headerState||e.__width!==this.__width||e.__colSpan!==this.__colSpan||e.__rowSpan!==this.__rowSpan||e.__backgroundColor!==this.__backgroundColor||e.__verticalAlign!==this.__verticalAlign}isShadowRoot(){return!0}collapseAtStart(){return!0}canBeEmpty(){return!1}canIndent(){return!1}};function Au(n){return n==="middle"||n==="bottom"}function Qh(n){const e=n,t=n.nodeName.toLowerCase();let r;Gd.test(e.style.width)&&(r=parseFloat(e.style.width));const i=a_(t==="th"?Ei.ROW:Ei.NO_STATUS,e.colSpan,r);i.__rowSpan=e.rowSpan;const s=e.style.backgroundColor;s!==""&&(i.__backgroundColor=s);const o=e.style.verticalAlign;Au(o)&&(i.__verticalAlign=o);const a=e.style,l=(a&&a.textDecoration||"").split(" "),c=a.fontWeight==="700"||a.fontWeight==="bold",u=l.includes("line-through"),f=a.fontStyle==="italic",d=l.includes("underline");return{after:h=>{const p=[];let m=null;const y=()=>{if(m){const b=m.getFirstChild();Pr(b)&&m.getChildrenSize()===1&&b.remove()}};for(const b of h)Nx(b)||z(b)||Pr(b)?(z(b)&&(c&&b.toggleFormat("bold"),u&&b.toggleFormat("strikethrough"),f&&b.toggleFormat("italic"),d&&b.toggleFormat("underline")),m?m.append(b):(m=Ot().append(b),p.push(m))):(p.push(b),y(),m=null);return y(),p.length===0&&p.push(Ot()),p},node:i}}function a_(n=Ei.NO_STATUS,e=1,t){return Me(new Yd(n,e,t))}function Mt(n){return n instanceof Yd}function qe(n,...e){const t=new URL("https://lexical.dev/docs/error"),r=new URLSearchParams;r.append("code",n);for(const i of e)r.append("v",i);throw t.search=r.toString(),Error(`Minified Lexical error #${n}; visit ${t.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}class El extends ht{static getType(){return"tablerow"}static clone(e){return new El(e.__height,e.__key)}static importDOM(){return{tr:e=>({conversion:cw,priority:0})}}static importJSON(e){return l_().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setHeight(e.height)}constructor(e,t){super(t),this.__height=e}exportJSON(){const e=this.getHeight();return{...super.exportJSON(),...e===void 0?void 0:{height:e}}}createDOM(e){const t=document.createElement("tr");return this.__height&&(t.style.height=`${this.__height}px`),ct(t,e.theme.tableRow),t}extractWithChild(e,t,r){return r==="html"}isShadowRoot(){return!0}setHeight(e){const t=this.getWritable();return t.__height=e,t}getHeight(){return this.getLatest().__height}updateDOM(e){return e.__height!==this.__height}canBeEmpty(){return!1}canIndent(){return!1}}function cw(n){const e=n;let t;return Gd.test(e.style.height)&&(t=parseFloat(e.style.height)),{after:r=>Hy(r,Mt),node:l_(t)}}function l_(n){return Me(new El(n))}function mo(n){return n instanceof El}const c_=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,uw=c_&&"documentMode"in document?document.documentMode:null;c_&&"InputEvent"in window&&!uw&&new window.InputEvent("input");function dw(n,e,t){const[r,i,s]=u_(n,e,t);return i===null&&qe(207),s===null&&qe(208),[r,i,s]}function u_(n,e,t){const r=[];let i=null,s=null;function o(l){let c=r[l];return c===void 0&&(r[l]=c=[]),c}const a=n.getChildren();for(let l=0;l<a.length;l++){const c=a[l];mo(c)||qe(209);const u=o(l);for(let f=c.getFirstChild(),d=0;f!=null;f=f.getNextSibling()){for(Mt(f)||qe(147);u[d]!==void 0;)d++;const h={cell:f,startColumn:d,startRow:l},{__rowSpan:p,__colSpan:m}=f;for(let y=0;y<p&&!(l+y>=a.length);y++){const b=o(l+y);for(let _=0;_<m;_++)b[d+_]=h}e!==null&&i===null&&e.is(f)&&(i=h),t!==null&&s===null&&t.is(f)&&(s=h)}}return[r,i,s]}function fw(n){let e;if(n instanceof Yd)e=n;else if("__type"in n){const i=Xt(n,Mt);Mt(i)||qe(148),e=i}else{const i=Xt(n.getNode(),Mt);Mt(i)||qe(148),e=i}const t=e.getParent();mo(t)||qe(149);const r=t.getParent();return m_(r)||qe(210),[e,t,r]}function hw(n,e,t){let r,i=Math.min(e.startColumn,t.startColumn),s=Math.min(e.startRow,t.startRow),o=Math.max(e.startColumn+e.cell.__colSpan-1,t.startColumn+t.cell.__colSpan-1),a=Math.max(e.startRow+e.cell.__rowSpan-1,t.startRow+t.cell.__rowSpan-1);do{r=!1;for(let l=0;l<n.length;l++)for(let c=0;c<n[0].length;c++){const u=n[l][c];if(!u)continue;const f=u.startColumn+u.cell.__colSpan-1,d=u.startRow+u.cell.__rowSpan-1,h=u.startColumn<=o&&f>=i,p=u.startRow<=a&&d>=s;if(h&&p){const m=Math.min(i,u.startColumn),y=Math.max(o,f),b=Math.min(s,u.startRow),_=Math.max(a,d);m===i&&y===o&&b===s&&_===a||(i=m,o=y,s=b,a=_,r=!0)}}}while(r);return{maxColumn:o,maxRow:a,minColumn:i,minRow:s}}function eg(n){const[e,,t]=fw(n),r=t.getChildren(),i=r.length,s=r[0].getChildren().length,o=new Array(i);for(let a=0;a<i;a++)o[a]=new Array(s);for(let a=0;a<i;a++){const l=r[a].getChildren();let c=0;for(let u=0;u<l.length;u++){for(;o[a][c];)c++;const f=l[u],d=f.__rowSpan||1,h=f.__colSpan||1;for(let p=0;p<d;p++)for(let m=0;m<h;m++)o[a+p][c+m]=f;if(e===f)return{colSpan:h,columnIndex:c,rowIndex:a,rowSpan:d};c+=h}}return null}function tg(n){const[[e,t,r,i],[s,o,a,l]]=["anchor","focus"].map(c=>{const u=n[c].getNode(),f=Xt(u,Mt);Mt(f)||qe(238,c,u.getKey(),u.getType());const d=f.getParent();mo(d)||qe(239,c);const h=d.getParent();return m_(h)||qe(240,c),[u,f,d,h]});return i.is(l)||qe(241),{anchorCell:t,anchorNode:e,anchorRow:r,anchorTable:i,focusCell:o,focusNode:s,focusRow:a,focusTable:l}}let gw=class d_{constructor(e,t,r){this.anchor=t,this.focus=r,t._selection=this,r._selection=this,this._cachedNodes=null,this.dirty=!1,this.tableKey=e}getStartEndPoints(){return[this.anchor,this.focus]}isValid(){return this.tableKey!=="root"&&this.anchor.key!=="root"&&this.anchor.type==="element"&&this.focus.key!=="root"&&this.focus.type==="element"}isBackward(){return this.focus.isBefore(this.anchor)}getCachedNodes(){return this._cachedNodes}setCachedNodes(e){this._cachedNodes=e}is(e){return f_(e)&&this.tableKey===e.tableKey&&this.anchor.is(e.anchor)&&this.focus.is(e.focus)}set(e,t,r){this.dirty=this.dirty||e!==this.tableKey||t!==this.anchor.key||r!==this.focus.key,this.tableKey=e,this.anchor.key=t,this.focus.key=r,this._cachedNodes=null}clone(){return new d_(this.tableKey,wt(this.anchor.key,this.anchor.offset,this.anchor.type),wt(this.focus.key,this.focus.offset,this.focus.type))}isCollapsed(){return!1}extract(){return this.getNodes()}insertRawText(e){}insertText(){}hasFormat(e){let t=0;this.getNodes().filter(Mt).forEach(i=>{const s=i.getFirstChild();Id(s)&&(t|=s.getTextFormat())});const r=rr[e];return!!(t&r)}insertNodes(e){const t=this.focus.getNode();j(t)||qe(151),zs(t.select(0,t.getChildrenSize())).insertNodes(e)}getShape(){const{anchorCell:e,focusCell:t}=tg(this),r=eg(e);r===null&&qe(153);const i=eg(t);i===null&&qe(155);const s=Math.min(r.columnIndex,i.columnIndex),o=Math.max(r.columnIndex+r.colSpan-1,i.columnIndex+i.colSpan-1),a=Math.min(r.rowIndex,i.rowIndex),l=Math.max(r.rowIndex+r.rowSpan-1,i.rowIndex+i.rowSpan-1);return{fromX:Math.min(s,o),fromY:Math.min(a,l),toX:Math.max(s,o),toY:Math.max(a,l)}}getNodes(){if(!this.isValid())return[];const e=this._cachedNodes;if(e!==null)return e;const{anchorTable:t,anchorCell:r,focusCell:i}=tg(this),s=i.getParents()[1];if(s!==t){if(t.isParentOf(i)){const y=s.getParent();y==null&&qe(159),this.set(this.tableKey,i.getKey(),y.getKey())}else{const y=t.getParent();y==null&&qe(158),this.set(this.tableKey,y.getKey(),i.getKey())}return this.getNodes()}const[o,a,l]=dw(t,r,i),{minColumn:c,maxColumn:u,minRow:f,maxRow:d}=hw(o,a,l),h=new Map([[t.getKey(),t]]);let p=null;for(let y=f;y<=d;y++)for(let b=c;b<=u;b++){const{cell:_}=o[y][b],C=_.getParent();mo(C)||qe(160),C!==p&&(h.set(C.getKey(),C),p=C),h.has(_.getKey())||pw(_,E=>{h.set(E.getKey(),E)})}const m=Array.from(h.values());return Zi()||(this._cachedNodes=m),m}getTextContent(){const e=this.getNodes().filter(r=>Mt(r));let t="";for(let r=0;r<e.length;r++){const i=e[r],s=i.__parent,o=(e[r+1]||{}).__parent;t+=i.getTextContent()+(o!==s?`
`:"	")}return t}};function f_(n){return n instanceof gw}function pw(n,e){const t=[[n]];for(let r=t.at(-1);r!==void 0&&t.length>0;r=t.at(-1)){const i=r.pop();i===void 0?t.pop():e(i)!==!1&&j(i)&&t.push(i.getChildren())}}function Es(n){return Te(n)&&n.nodeName==="TABLE"}function mw(n,e){for(let t=e,r=null;t!==null;t=t.getParent()){if(n.is(t))return r;Mt(t)&&(r=t)}return null}function yw(n,e,t){return mw(n,sr(e,t))}function ng(n,e,t){if(!e.theme.tableAlignment)return;const r=[],i=[];for(const s of["center","right"]){const o=e.theme.tableAlignment[s];o&&(s===t?i:r).push(o)}Dr(n,...r),ct(n,...i)}const _w=new WeakSet;function rg(n=Cl()){return _w.has(n)}let h_=class g_ extends ht{static getType(){return"table"}getColWidths(){return this.getLatest().__colWidths}setColWidths(e){const t=this.getWritable();return t.__colWidths=e,t}static clone(e){return new g_(e.__key)}afterCloneFrom(e){super.afterCloneFrom(e),this.__colWidths=e.__colWidths,this.__rowStriping=e.__rowStriping,this.__frozenColumnCount=e.__frozenColumnCount,this.__frozenRowCount=e.__frozenRowCount}static importDOM(){return{table:e=>({conversion:bw,priority:1})}}static importJSON(e){return p_().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setRowStriping(e.rowStriping||!1).setFrozenColumns(e.frozenColumnCount||0).setFrozenRows(e.frozenRowCount||0).setColWidths(e.colWidths)}constructor(e){super(e),this.__rowStriping=!1,this.__frozenColumnCount=0,this.__frozenRowCount=0}exportJSON(){return{...super.exportJSON(),colWidths:this.getColWidths(),frozenColumnCount:this.__frozenColumnCount?this.__frozenColumnCount:void 0,frozenRowCount:this.__frozenRowCount?this.__frozenRowCount:void 0,rowStriping:this.__rowStriping?this.__rowStriping:void 0}}extractWithChild(e,t,r){return r==="html"}getDOMSlot(e){const t=Es(e)?e:e.querySelector("table");return Es(t)||qe(229),super.getDOMSlot(e).withElement(t).withAfter(t.querySelector("colgroup"))}createDOM(e,t){const r=document.createElement("table");this.__style&&(r.style.cssText=this.__style);const i=document.createElement("colgroup");if(r.appendChild(i),Ix(i),ct(r,e.theme.table),this.updateTableElement(null,r,e),rg(t)){const s=document.createElement("div"),o=e.theme.tableScrollableWrapper;return o?ct(s,o):s.style.cssText="overflow-x: auto;",s.appendChild(r),this.updateTableWrapper(null,s,r,e),s}return r}updateTableWrapper(e,t,r,i){this.__frozenColumnCount!==(e?e.__frozenColumnCount:0)&&function(s,o,a,l){l>0?(ct(s,a.theme.tableFrozenColumn),o.setAttribute("data-lexical-frozen-column","true")):(Dr(s,a.theme.tableFrozenColumn),o.removeAttribute("data-lexical-frozen-column"))}(t,r,i,this.__frozenColumnCount),this.__frozenRowCount!==(e?e.__frozenRowCount:0)&&function(s,o,a,l){l>0?(ct(s,a.theme.tableFrozenRow),o.setAttribute("data-lexical-frozen-row","true")):(Dr(s,a.theme.tableFrozenRow),o.removeAttribute("data-lexical-frozen-row"))}(t,r,i,this.__frozenRowCount)}updateTableElement(e,t,r){this.__style!==(e?e.__style:"")&&(t.style.cssText=this.__style),this.__rowStriping!==(!!e&&e.__rowStriping)&&function(i,s,o){o?(ct(i,s.theme.tableRowStriping),i.setAttribute("data-lexical-row-striping","true")):(Dr(i,s.theme.tableRowStriping),i.removeAttribute("data-lexical-row-striping"))}(t,r,this.__rowStriping),function(i,s,o,a){const l=i.querySelector("colgroup");if(!l)return;const c=[];for(let u=0;u<o;u++){const f=document.createElement("col"),d=a&&a[u];d&&(f.style.width=`${d}px`),c.push(f)}l.replaceChildren(...c)}(t,0,this.getColumnCount(),this.getColWidths()),ng(t,r,this.getFormatType())}updateDOM(e,t,r){const i=this.getDOMSlot(t).element;return t===i===rg()||(Te(s=t)&&s.nodeName==="DIV"&&this.updateTableWrapper(e,t,i,r),this.updateTableElement(e,i,r),!1);var s}exportDOM(e){const t=super.exportDOM(e),{element:r}=t;return{after:i=>{if(t.after&&(i=t.after(i)),!Es(i)&&Te(i)&&(i=i.querySelector("table")),!Es(i))return null;ng(i,e._config,this.getFormatType());const[s]=u_(this,null,null),o=new Map;for(const u of s)for(const f of u){const d=f.cell.getKey();o.has(d)||o.set(d,{colSpan:f.cell.getColSpan(),startColumn:f.startColumn})}const a=new Set;for(const u of i.querySelectorAll(":scope > tr > [data-temporary-table-cell-lexical-key]")){const f=u.getAttribute("data-temporary-table-cell-lexical-key");if(f){const d=o.get(f);if(u.removeAttribute("data-temporary-table-cell-lexical-key"),d){o.delete(f);for(let h=0;h<d.colSpan;h++)a.add(h+d.startColumn)}}}const l=i.querySelector(":scope > colgroup");if(l){const u=Array.from(i.querySelectorAll(":scope > colgroup > col")).filter((f,d)=>a.has(d));l.replaceChildren(...u)}const c=i.querySelectorAll(":scope > tr");if(c.length>0){const u=document.createElement("tbody");for(const f of c)u.appendChild(f);i.append(u)}return i},element:!Es(r)&&Te(r)?r.querySelector("table"):r}}canBeEmpty(){return!1}isShadowRoot(){return!0}getCordsFromCellNode(e,t){const{rows:r,domRows:i}=t;for(let s=0;s<r;s++){const o=i[s];if(o!=null)for(let a=0;a<o.length;a++){const l=o[a];if(l==null)continue;const{elem:c}=l,u=yw(this,c);if(u!==null&&e.is(u))return{x:a,y:s}}}throw new Error("Cell not found in table.")}getDOMCellFromCords(e,t,r){const{domRows:i}=r,s=i[t];if(s==null)return null;const o=s[e<s.length?e:s.length-1];return o??null}getDOMCellFromCordsOrThrow(e,t,r){const i=this.getDOMCellFromCords(e,t,r);if(!i)throw new Error("Cell not found at cords.");return i}getCellNodeFromCords(e,t,r){const i=this.getDOMCellFromCords(e,t,r);if(i==null)return null;const s=sr(i.elem);return Mt(s)?s:null}getCellNodeFromCordsOrThrow(e,t,r){const i=this.getCellNodeFromCords(e,t,r);if(!i)throw new Error("Node at cords not TableCellNode.");return i}getRowStriping(){return!!this.getLatest().__rowStriping}setRowStriping(e){const t=this.getWritable();return t.__rowStriping=e,t}setFrozenColumns(e){const t=this.getWritable();return t.__frozenColumnCount=e,t}getFrozenColumns(){return this.getLatest().__frozenColumnCount}setFrozenRows(e){const t=this.getWritable();return t.__frozenRowCount=e,t}getFrozenRows(){return this.getLatest().__frozenRowCount}canSelectBefore(){return!0}canIndent(){return!1}getColumnCount(){const e=this.getFirstChild();if(!e)return 0;let t=0;return e.getChildren().forEach(r=>{Mt(r)&&(t+=r.getColSpan())}),t}};function bw(n){const e=p_();n.hasAttribute("data-lexical-row-striping")&&e.setRowStriping(!0),n.hasAttribute("data-lexical-frozen-column")&&e.setFrozenColumns(1),n.hasAttribute("data-lexical-frozen-row")&&e.setFrozenRows(1);const t=n.querySelector(":scope > colgroup");if(t){let r=[];for(const i of t.querySelectorAll(":scope > col")){let s=i.style.width||"";if(!Gd.test(s)&&(s=i.getAttribute("width")||"",!/^\d+$/.test(s))){r=void 0;break}r.push(parseFloat(s))}r&&e.setColWidths(r)}return{after:r=>Hy(r,mo),node:e}}function p_(){return Me(new h_)}function m_(n){return n instanceof h_}const y_=Object.freeze({"	":"\\t","\n":"\\n"}),ig=new RegExp(Object.keys(y_).join("|"),"g"),un=Object.freeze({ancestorHasNextSibling:"|",ancestorIsLastChild:" ",hasNextSibling:"├",isLastChild:"└",selectedChar:"^",selectedLine:">"}),vw=[n=>n.hasFormat("bold")&&"Bold",n=>n.hasFormat("code")&&"Code",n=>n.hasFormat("italic")&&"Italic",n=>n.hasFormat("strikethrough")&&"Strikethrough",n=>n.hasFormat("subscript")&&"Subscript",n=>n.hasFormat("superscript")&&"Superscript",n=>n.hasFormat("underline")&&"Underline",n=>n.hasFormat("highlight")&&"Highlight"],kw=[n=>n.hasTextFormat("bold")&&"Bold",n=>n.hasTextFormat("code")&&"Code",n=>n.hasTextFormat("italic")&&"Italic",n=>n.hasTextFormat("strikethrough")&&"Strikethrough",n=>n.hasTextFormat("subscript")&&"Subscript",n=>n.hasTextFormat("superscript")&&"Superscript",n=>n.hasTextFormat("underline")&&"Underline",n=>n.hasTextFormat("highlight")&&"Highlight"],xw=[n=>n.isDirectionless()&&"Directionless",n=>n.isUnmergeable()&&"Unmergeable"],Cw=[n=>n.isToken()&&"Token",n=>n.isSegmented()&&"Segmented"];function ww(n,e,t,r,i=!1){const s=n.getEditorState(),o=n._config,a=n._compositionKey,l=n._editable;if(t){let d="";return s.read(()=>{d=function(h){const p=document.createElement("div");return p.innerHTML=h.trim(),b_(p,0).innerHTML}(Gy(n))}),d}let c=` root
`;const u=s.read(()=>{const d=K();return __(pe(),(h,p)=>{const m=`(${h.getKey()})`,y=h.getType()||"",b=h.isSelected();c+=`${b?un.selectedLine:" "} ${p.join(" ")} ${m} ${y} ${function(_,C,E=!1){const O=C?C(_,E):void 0;if(O!==void 0&&O.length>0)return O;if(z(_)){const N=_.getTextContent(),D=N.length===0?"(empty)":`"${sg(N,E)}"`,P=function($){return[og($),Sw($),Tw($),ag($)].filter(Boolean).join(", ")}(_);return[D,P.length!==0?`{ ${P} }`:null].filter(Boolean).join(" ").trim()}if(ew(_)){const N=_.getURL(),D=N.length===0?"(empty)":`"${sg(N,E)}"`,P=function($){return[Ew($),Nw($),Mw($),ag($)].filter(Boolean).join(", ")}(_);return[D,P.length!==0?`{ ${P} }`:null].filter(Boolean).join(" ").trim()}if(nw(_))return`ids: [ ${_.getIDs().join(", ")} ]`;if(Id(_)){const N=function(P){let $=kw.map(R=>R(P)).filter(Boolean).join(", ").toLocaleLowerCase();return $!==""&&($="format: "+$),$}(_);let D=N!==""?`{ ${N} }`:"";return D+=_.__style?`(${_.__style})`:"",D}return""}(h,r,i)}
`,c+=function({indent:_,isSelected:C,node:E,nodeKeyDisplay:O,selection:N,typeDisplay:D}){if(!z(E)||!B(N)||!C||j(E))return"";const P=N.anchor,$=N.focus;if(E.getTextContent()===""||P.getNode()===N.focus.getNode()&&P.offset===$.offset)return"";const[R,k]=function(J,V){const G=V.getStartEndPoints();if(pt(V)||G===null)return[-1,-1];const[ee,Z]=G,re=J.getTextContent(),oe=re.length;let X=-1,fe=-1;if(ee.type==="text"&&Z.type==="text"){const ce=ee.getNode(),he=Z.getNode();ce===he&&J===ce&&ee.offset!==Z.offset?[X,fe]=ee.offset<Z.offset?[ee.offset,Z.offset]:[Z.offset,ee.offset]:[X,fe]=J===ce?ce.isBefore(he)?[ee.offset,oe]:[0,ee.offset]:J===he?he.isBefore(ce)?[Z.offset,oe]:[0,Z.offset]:[0,oe]}const be=(re.slice(0,X).match(ig)||[]).length,se=(re.slice(X,fe).match(ig)||[]).length;return[X+be,fe+be+se]}(E,N);if(R===k)return"";const I=_[_.length-1]===un.hasNextSibling?un.ancestorHasNextSibling:un.ancestorIsLastChild,w=[..._.slice(0,_.length-1),I],L=Array(R+1).fill(" "),F=Array(k-R).fill(un.selectedChar),q=D.length+2,W=Array(O.length+q).fill(" ");return[un.selectedLine,w.join(" "),[...W,...L,...F].join("")].join(" ")+`
`}({indent:p,isSelected:b,node:h,nodeKeyDisplay:m,selection:d,typeDisplay:y})}),d===null?": null":B(d)?function(h){let p="";const m=og(h);p+=`: range ${m!==""?`{ ${m} }`:""} ${h.style!==""?`{ style: ${h.style} } `:""}`;const y=h.anchor,b=h.focus,_=y.offset,C=b.offset;return p+=`
  ├ anchor { key: ${y.key}, offset: ${_===null?"null":_}, type: ${y.type} }`,p+=`
  └ focus { key: ${b.key}, offset: ${C===null?"null":C}, type: ${b.type} }`,p}(d):f_(d)?function(h){return`: table
  └ { table: ${h.tableKey}, anchorCell: ${h.anchor.key}, focusCell: ${h.focus.key} }`}(d):function(h){return pt(h)?`: node
  └ [${Array.from(h._nodes).join(", ")}]`:""}(d)});if(c+=`
 selection`+u,c+=`

 commands:`,e.length)for(const{index:d,type:h,payload:p}of e)c+=`
  └ ${d}. { type: ${h}, payload: ${p instanceof Event?p.constructor.name:p} }`;else c+=`
  └ None dispatched.`;const{version:f}=n.constructor;return c+=`

 editor${f?` (v${f})`:""}:`,c+=`
  └ namespace ${o.namespace}`,a!==null&&(c+=`
  └ compositionKey ${a}`),c+=`
  └ editable ${String(l)}`,c}function __(n,e,t=[]){const r=n.getChildren(),i=r.length;r.forEach((s,o)=>{e(s,t.concat(o===i-1?un.isLastChild:un.hasNextSibling)),j(s)&&__(s,e,t.concat(o===i-1?un.ancestorIsLastChild:un.ancestorHasNextSibling))})}function sg(n,e=!1){const t=Object.entries(y_).reduce((r,[i,s])=>r.replace(new RegExp(i,"g"),String(s)),n);return e?t.replace(/[^\s]/g,"*"):t}function Sw(n){let e=xw.map(t=>t(n)).filter(Boolean).join(", ").toLocaleLowerCase();return e!==""&&(e="detail: "+e),e}function Tw(n){let e=Cw.map(t=>t(n)).filter(Boolean).join(", ").toLocaleLowerCase();return e!==""&&(e="mode: "+e),e}function og(n){let e=vw.map(t=>t(n)).filter(Boolean).join(", ").toLocaleLowerCase();return e!==""&&(e="format: "+e),e}function Ew(n){let e=n.getTarget();return e!=null&&(e="target: "+e),e}function Nw(n){let e=n.getRel();return e!=null&&(e="rel: "+e),e}function Mw(n){let e=n.getTitle();return e!=null&&(e="title: "+e),e}function ag(n){if(!n.__state)return!1;const e=[];for(const[r,i]of n.__state.knownState.entries()){if(r.isEqual(i,r.defaultValue))continue;const s=JSON.stringify(r.unparse(i));e.push(`[${r.key}: ${s}]`)}let t=e.join(",");return t!==""&&(t="state: "+t),t}function b_(n,e){const t=new Array(1+e++).join("  "),r=new Array(e-1).join("  ");let i;for(let s=0;s<n.children.length;s++)i=document.createTextNode(`
`+t),n.insertBefore(i,n.children[s]),b_(n.children[s],e),n.lastElementChild===n.children[s]&&(i=document.createTextNode(`
`+r),n.appendChild(i));return n}const Aw=x.forwardRef(function({treeTypeButtonClassName:n,timeTravelButtonClassName:e,timeTravelPanelSliderClassName:t,timeTravelPanelButtonClassName:r,viewClassName:i,timeTravelPanelClassName:s,editorState:o,setEditorState:a,setEditorReadOnly:l,generateContent:c,commandsLog:u=[]},f){const[d,h]=x.useState([]),[p,m]=x.useState(""),[y,b]=x.useState(!1),[_,C]=x.useState(!1),E=x.useRef(0),O=x.useRef(null),[N,D]=x.useState(!1),[P,$]=x.useState(!1),[R,k]=x.useState(!1),I=x.useRef(),w=x.useRef([]),L=x.useRef(0),F=x.useCallback(W=>{const J=++L.current;c(W).then(V=>{J===L.current&&m(V)}).catch(V=>{J===L.current&&m(`Error rendering tree: ${V.message}

Stack:
${V.stack}`)})},[c]);x.useEffect(()=>{if(!(!R&&o._nodeMap.size>1e3&&($(!0),!R))&&(I.current!==o||w.current!==u)){const W=I.current!==o;I.current=o,w.current=u,F(_),!y&&W&&h(J=>[...J,[Date.now(),o]])}},[o,F,_,R,y,u]);const q=d.length;return x.useEffect(()=>{if(N){let W;const J=()=>{const V=E.current;if(V===q-1)return void D(!1);const G=d[V][0],ee=d[V+1][0];W=setTimeout(()=>{E.current++;const Z=E.current,re=O.current;re!==null&&(re.value=String(Z)),a(d[Z][1]),J()},ee-G)};return J(),()=>{clearTimeout(W)}}},[d,N,q,a]),S.jsxs("div",{className:i,children:[!R&&P?S.jsxs("div",{style:{padding:20},children:[S.jsx("span",{style:{marginRight:20},children:"Detected large EditorState, this can impact debugging performance."}),S.jsx("button",{onClick:()=>{k(!0)},style:{background:"transparent",border:"1px solid white",color:"white",cursor:"pointer",padding:5},children:"Show full tree"})]}):null,R?null:S.jsx("button",{onClick:()=>(F(!_),void C(!_)),className:n,type:"button",children:_?"Tree":"Export DOM"}),!y&&(R||!P)&&q>2&&S.jsx("button",{onClick:()=>{l(!0),E.current=q-1,b(!0)},className:e,type:"button",children:"Time Travel"}),(R||!P)&&S.jsx("pre",{ref:f,children:p}),y&&(R||!P)&&S.jsxs("div",{className:s,children:[S.jsx("button",{className:r,onClick:()=>{E.current===q-1&&(E.current=1),D(!N)},type:"button",children:N?"Pause":"Play"}),S.jsx("input",{className:t,ref:O,onChange:W=>{const J=Number(W.target.value),V=d[J];V&&(E.current=J,a(V[1]))},type:"range",min:"1",max:q-1}),S.jsx("button",{className:r,onClick:()=>{l(!1);const W=d.length-1,J=d[W];a(J[1]);const V=O.current;V!==null&&(V.value=String(W)),b(!1),D(!1)},type:"button",children:"Exit"})]})]})});function Ow(n,e){const t=new Set;let r=0;for(const[i]of n._commands)t.add(n.registerCommand(i,s=>(e(o=>{r+=1;const a=[...o];return a.push({index:r,payload:s,type:i.type?i.type:"UNKNOWN"}),a.length>10&&a.shift(),a}),!1),Si));return()=>t.forEach(i=>i())}function $w(n){const[e,t]=x.useState([]);return x.useEffect(()=>Ow(n,t),[n]),x.useMemo(()=>e,[e])}function Pw({treeTypeButtonClassName:n,timeTravelButtonClassName:e,timeTravelPanelSliderClassName:t,timeTravelPanelButtonClassName:r,timeTravelPanelClassName:i,viewClassName:s,editor:o,customPrintNode:a}){const l=x.createRef(),[c,u]=x.useState(o.getEditorState()),f=$w(o);return x.useEffect(()=>He(o.registerUpdateListener(({editorState:d})=>{u(d)}),o.registerEditableListener(()=>{u(o.getEditorState())})),[o]),x.useEffect(()=>{const d=l.current;if(d!==null)return d.__lexicalEditor=o,()=>{d.__lexicalEditor=null}},[o,l]),S.jsx(Aw,{treeTypeButtonClassName:n,timeTravelButtonClassName:e,timeTravelPanelSliderClassName:t,timeTravelPanelButtonClassName:r,viewClassName:s,timeTravelPanelClassName:i,setEditorReadOnly:d=>{const h=o.getRootElement();h!=null&&(h.contentEditable=d?"false":"true")},editorState:c,setEditorState:d=>o.setEditorState(d),generateContent:async function(d){return ww(o,f,d,a)},ref:l,commandsLog:f})}const v_=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,Iw=v_?x.useLayoutEffect:x.useEffect,Yo={tag:Ir};function k_({initialConfig:n,children:e}){const t=x.useMemo(()=>{const{theme:r,namespace:i,nodes:s,onError:o,editorState:a,html:l}=n,c=GC(null,r),u=vx({editable:n.editable,html:l,namespace:i,nodes:s,onError:f=>o(f,u),theme:r});return function(f,d){if(d!==null){if(d===void 0)f.update(()=>{const h=pe();if(h.isEmpty()){const p=Ot();h.append(p);const m=v_?document.activeElement:null;(K()!==null||m!==null&&m===f.getRootElement())&&p.select()}},Yo);else if(d!==null)switch(typeof d){case"string":{const h=f.parseEditorState(d);f.setEditorState(h,Yo);break}case"object":f.setEditorState(d,Yo);break;case"function":f.update(()=>{pe().isEmpty()&&d(f)},Yo)}}}(u,a),[u,c]},[]);return Iw(()=>{const r=n.editable,[i]=t;i.setEditable(r===void 0||r)},[]),S.jsx(Vy.Provider,{value:t,children:e})}function x_(){return pe().getTextContent()}function C_(n,e=!0){if(n)return!1;let t=x_();return e&&(t=t.trim()),t===""}function Rw(n){if(!C_(n,!1))return!1;const e=pe().getChildren(),t=e.length;if(t>1)return!1;for(let r=0;r<t;r++){const i=e[r];if(ve(i))return!1;if(j(i)){if(!Id(i)||i.__indent!==0)return!1;const s=i.getChildren(),o=s.length;for(let a=0;a<o;a++){const l=s[r];if(!z(l))return!1}}}return!0}function Xd(n){return()=>Rw(n)}const w_=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0?x.useLayoutEffect:x.useEffect;function Lw({editor:n,ariaActiveDescendant:e,ariaAutoComplete:t,ariaControls:r,ariaDescribedBy:i,ariaErrorMessage:s,ariaExpanded:o,ariaInvalid:a,ariaLabel:l,ariaLabelledBy:c,ariaMultiline:u,ariaOwns:f,ariaRequired:d,autoCapitalize:h,className:p,id:m,role:y="textbox",spellCheck:b=!0,style:_,tabIndex:C,"data-testid":E,...O},N){const[D,P]=x.useState(n.isEditable()),$=x.useCallback(k=>{k&&k.ownerDocument&&k.ownerDocument.defaultView?n.setRootElement(k):n.setRootElement(null)},[n]),R=x.useMemo(()=>function(...k){return I=>{k.forEach(w=>{typeof w=="function"?w(I):w!=null&&(w.current=I)})}}(N,$),[$,N]);return w_(()=>(P(n.isEditable()),n.registerEditableListener(k=>{P(k)})),[n]),S.jsx("div",{"aria-activedescendant":D?e:void 0,"aria-autocomplete":D?t:"none","aria-controls":D?r:void 0,"aria-describedby":i,...s!=null?{"aria-errormessage":s}:{},"aria-expanded":D&&y==="combobox"?!!o:void 0,...a!=null?{"aria-invalid":a}:{},"aria-label":l,"aria-labelledby":c,"aria-multiline":u,"aria-owns":D?f:void 0,"aria-readonly":!D||void 0,"aria-required":d,autoCapitalize:h,className:p,contentEditable:D,"data-testid":E,id:m,ref:R,role:y,spellCheck:b,style:_,tabIndex:C,...O})}const Dw=x.forwardRef(Lw);function lg(n){return n.getEditorState().read(Xd(n.isComposing()))}const S_=x.forwardRef(jw);function jw(n,e){const{placeholder:t,...r}=n,[i]=ge();return S.jsxs(S.Fragment,{children:[S.jsx(Dw,{editor:i,...r,ref:e}),t!=null&&S.jsx(Fw,{editor:i,content:t})]})}function Fw({content:n,editor:e}){const t=function(o){const[a,l]=x.useState(()=>lg(o));return w_(()=>{function c(){const u=lg(o);l(u)}return c(),He(o.registerUpdateListener(()=>{c()}),o.registerEditableListener(()=>{c()}))},[o]),a}(e),[r,i]=x.useState(e.isEditable());if(x.useLayoutEffect(()=>(i(e.isEditable()),e.registerEditableListener(o=>{i(o)})),[e]),!t)return null;let s=null;return typeof n=="function"?s=n(r):n!==null&&(s=n),s===null?null:S.jsx("div",{"aria-hidden":!0,children:s})}function T_({editorRef:n}){const[e]=ge();return x.useEffect(()=>{typeof n=="function"?n(e):typeof n=="object"&&(n.current=e)},[e]),null}function Ou(n,e){return Ou=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},Ou(n,e)}var cg={error:null},qw=function(n){var e,t;function r(){for(var s,o=arguments.length,a=new Array(o),l=0;l<o;l++)a[l]=arguments[l];return(s=n.call.apply(n,[this].concat(a))||this).state=cg,s.resetErrorBoundary=function(){for(var c,u=arguments.length,f=new Array(u),d=0;d<u;d++)f[d]=arguments[d];s.props.onReset==null||(c=s.props).onReset.apply(c,f),s.reset()},s}t=n,(e=r).prototype=Object.create(t.prototype),e.prototype.constructor=e,Ou(e,t),r.getDerivedStateFromError=function(s){return{error:s}};var i=r.prototype;return i.reset=function(){this.setState(cg)},i.componentDidCatch=function(s,o){var a,l;(a=(l=this.props).onError)==null||a.call(l,s,o)},i.componentDidUpdate=function(s,o){var a,l,c,u,f=this.state.error,d=this.props.resetKeys;f!==null&&o.error!==null&&((c=s.resetKeys)===void 0&&(c=[]),(u=d)===void 0&&(u=[]),c.length!==u.length||c.some(function(h,p){return!Object.is(h,u[p])}))&&((a=(l=this.props).onResetKeysChange)==null||a.call(l,s.resetKeys,d),this.reset())},i.render=function(){var s=this.state.error,o=this.props,a=o.fallbackRender,l=o.FallbackComponent,c=o.fallback;if(s!==null){var u={error:s,resetErrorBoundary:this.resetErrorBoundary};if(x.isValidElement(c))return c;if(typeof a=="function")return a(u);if(l)return x.createElement(l,u);throw new Error("react-error-boundary requires either a fallback, fallbackRender, or FallbackComponent prop")}return this.props.children},r}(x.Component);function E_({children:n,onError:e}){return S.jsx(qw,{fallback:S.jsx("div",{style:{border:"1px solid #f00",color:"#f00",padding:"8px"},children:"An error was thrown."}),onError:e,children:n})}const Xo=0,$u=1,Pu=2,zt=0,Bw=1,ug=2,Uw=3,zw=4;function Ww(n,e,t,r,i){if(n===null||t.size===0&&r.size===0&&!i)return zt;const s=e._selection,o=n._selection;if(i)return Bw;if(!(B(s)&&B(o)&&o.isCollapsed()&&s.isCollapsed()))return zt;const a=function(b,_,C){const E=b._nodeMap,O=[];for(const N of _){const D=E.get(N);D!==void 0&&O.push(D)}for(const[N,D]of C){if(!D)continue;const P=E.get(N);P===void 0||et(P)||O.push(P)}return O}(e,t,r);if(a.length===0)return zt;if(a.length>1){const b=e._nodeMap,_=b.get(s.anchor.key),C=b.get(o.anchor.key);return _&&C&&!n._nodeMap.has(_.__key)&&z(_)&&_.__text.length===1&&s.anchor.offset===1?ug:zt}const l=a[0],c=n._nodeMap.get(l.__key);if(!z(c)||!z(l)||c.__mode!==l.__mode)return zt;const u=c.__text,f=l.__text;if(u===f)return zt;const d=s.anchor,h=o.anchor;if(d.key!==h.key||d.type!=="text")return zt;const p=d.offset,m=h.offset,y=f.length-u.length;return y===1&&m===p-1?ug:y===-1&&m===p+1?Uw:y===-1&&m===p?zw:zt}function Kw(n,e){let t=Date.now(),r=zt;return(i,s,o,a,l,c)=>{const u=Date.now();if(c.has(_u))return r=zt,t=u,Pu;const f=Ww(i,s,a,l,n.isComposing()),d=(()=>{const h=o===null||o.editor===n,p=c.has(px);if(!p&&h&&c.has(Ir))return Xo;if(i===null)return $u;const m=s._selection;return a.size>0||l.size>0?p===!1&&f!==zt&&f===r&&u<t+e&&h||a.size===1&&function(y,b,_){const C=b._nodeMap.get(y),E=_._nodeMap.get(y),O=b._selection,N=_._selection;return!(B(O)&&B(N)&&O.anchor.type==="element"&&O.focus.type==="element"&&N.anchor.type==="text"&&N.focus.type==="text"||!z(C)||!z(E)||C.__parent!==E.__parent)&&JSON.stringify(b.read(()=>C.exportJSON()))===JSON.stringify(_.read(()=>E.exportJSON()))}(Array.from(a)[0],i,s)?Xo:$u:m!==null?Xo:Pu})();return t=u,r=f,d}}function dg(n){n.undoStack=[],n.redoStack=[],n.current=null}function Hw(n,e,t){const r=Kw(n,t);return He(n.registerCommand(oo,()=>(function(s,o){const a=o.redoStack,l=o.undoStack;if(l.length!==0){const c=o.current,u=l.pop();c!==null&&(a.push(c),s.dispatchCommand(Os,!0)),l.length===0&&s.dispatchCommand($s,!1),o.current=u||null,u&&u.editor.setEditorState(u.editorState,{tag:_u})}}(n,e),!0),ne),n.registerCommand(ao,()=>(function(s,o){const a=o.redoStack,l=o.undoStack;if(a.length!==0){const c=o.current;c!==null&&(l.push(c),s.dispatchCommand($s,!0));const u=a.pop();a.length===0&&s.dispatchCommand(Os,!1),o.current=u||null,u&&u.editor.setEditorState(u.editorState,{tag:_u})}}(n,e),!0),ne),n.registerCommand(Td,()=>(dg(e),!1),ne),n.registerCommand(Bm,()=>(dg(e),n.dispatchCommand(Os,!1),n.dispatchCommand($s,!1),!0),ne),n.registerUpdateListener(({editorState:s,prevEditorState:o,dirtyLeaves:a,dirtyElements:l,tags:c})=>{const u=e.current,f=e.redoStack,d=e.undoStack,h=u===null?null:u.editorState;if(u!==null&&s===h)return;const p=r(o,s,u,a,l,c);if(p===$u)f.length!==0&&(e.redoStack=[],n.dispatchCommand(Os,!1)),u!==null&&(d.push({...u}),n.dispatchCommand($s,!0));else if(p===Pu)return;e.current={editor:n,editorState:s}}))}function Jw(){return{current:null,redoStack:[],undoStack:[]}}function N_({delay:n,externalHistoryState:e}){const[t]=ge();return function(r,i,s=1e3){const o=x.useMemo(()=>i||Jw(),[i]);x.useEffect(()=>Hw(r,o,s),[s,r,o])}(t,e,n),null}const Vw=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0?x.useLayoutEffect:x.useEffect;function Gw(n){return{initialValueFn:()=>n.isEditable(),subscribe:e=>n.registerEditableListener(e)}}function M_(){return function(n){const[e]=ge(),t=x.useMemo(()=>n(e),[e,n]),[r,i]=x.useState(()=>t.initialValueFn()),s=x.useRef(r);return Vw(()=>{const{initialValueFn:o,subscribe:a}=t,l=o();return s.current!==l&&(s.current=l,i(l)),a(c=>{s.current=c,i(c)})},[t,n]),r}(Gw)}function A_(n){const e=window.location.origin,t=r=>{if(r.origin!==e)return;const i=n.getRootElement();if(document.activeElement!==i)return;const s=r.data;if(typeof s=="string"){let o;try{o=JSON.parse(s)}catch{return}if(o&&o.protocol==="nuanria_messaging"&&o.type==="request"){const a=o.payload;if(a&&a.functionId==="makeChanges"){const l=a.args;if(l){const[c,u,f,d,h,p]=l;n.update(()=>{const m=K();if(B(m)){const y=m.anchor;let b=y.getNode(),_=0,C=0;if(z(b)&&c>=0&&u>=0&&(_=c,C=c+u,m.setTextNodeRange(b,_,b,C)),_===C&&f===""||(m.insertRawText(f),b=y.getNode()),z(b)){_=d,C=d+h;const E=b.getTextContentSize();_=_>E?E:_,C=C>E?E:C,m.setTextNodeRange(b,_,b,C)}r.stopImmediatePropagation()}})}}}}};return window.addEventListener("message",t,!0),()=>{window.removeEventListener("message",t,!0)}}function fg(n,e){if(document.caretRangeFromPoint!==void 0){const t=document.caretRangeFromPoint(n,e);return t===null?null:{node:t.startContainer,offset:t.startOffset}}if(document.caretPositionFromPoint!=="undefined"){const t=document.caretPositionFromPoint(n,e);return t===null?null:{node:t.offsetNode,offset:t.offset}}return null}const ts=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,Yw=ts&&"documentMode"in document?document.documentMode:null,Xw=!(!ts||!("InputEvent"in window)||Yw)&&"getTargetRanges"in new window.InputEvent("input"),Zw=ts&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent),hg=ts&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,Qw=ts&&/^(?=.*Chrome).*/i.test(navigator.userAgent),eS=ts&&/AppleWebKit\/[\d.]+/.test(navigator.userAgent)&&!Qw,gg=ie("DRAG_DROP_PASTE_FILE");function Zo(n){let e=null;if(Pn(n,DragEvent)?e=n.dataTransfer:Pn(n,ClipboardEvent)&&(e=n.clipboardData),e===null)return[!1,[],!1];const t=e.types,r=t.includes("Files"),i=t.includes("text/html")||t.includes("text/plain");return[r,Array.from(e.files),i]}function pg(n){const e=K();if(!B(e))return!1;const t=new Set,r=e.getNodes();for(let i=0;i<r.length;i++){const s=r[i],o=s.getKey();if(t.has(o))continue;const a=Xt(s,c=>j(c)&&!c.isInline());if(a===null)continue;const l=a.getKey();a.canIndent()&&!t.has(l)&&(t.add(l),n(a))}return t.size>0}function mg(n){const e=sr(n);return ve(e)}function Bc(n){for(const e of["lowercase","uppercase","capitalize"])n.hasFormat(e)&&n.toggleFormat(e)}function tS(n){return He(n.registerCommand(jm,e=>{const t=K();return!!pt(t)&&(t.clear(),!0)},ne),n.registerCommand(hn,e=>{const t=K();return B(t)?(t.deleteCharacter(e),!0):!!pt(t)&&(t.deleteNodes(),!0)},ne),n.registerCommand(Ri,e=>{const t=K();return!!B(t)&&(t.deleteWord(e),!0)},ne),n.registerCommand(Li,e=>{const t=K();return!!B(t)&&(t.deleteLine(e),!0)},ne),n.registerCommand($r,e=>{const t=K();if(typeof e=="string")t!==null&&t.insertText(e);else{if(t===null)return!1;const r=e.dataTransfer;if(r!=null)Gh(r,t,n);else if(B(t)){const i=e.data;return i&&t.insertText(i),!0}}return!0},ne),n.registerCommand(qa,()=>{const e=K();return!!B(e)&&(e.removeText(),!0)},ne),n.registerCommand(Yn,e=>{const t=K();return!!B(t)&&(t.formatText(e),!0)},ne),n.registerCommand(Yk,e=>{const t=K();if(!B(t)&&!pt(t))return!1;const r=t.getNodes();for(const i of r){const s=Xt(i,o=>j(o)&&!o.isInline());s!==null&&s.setFormat(e)}return!0},ne),n.registerCommand(er,e=>{const t=K();return!!B(t)&&(t.insertLineBreak(e),!0)},ne),n.registerCommand(Js,()=>{const e=K();return!!B(e)&&(e.insertParagraph(),!0)},ne),n.registerCommand(Vk,()=>(dx([co()]),!0),ne),n.registerCommand(Gk,()=>pg(e=>{const t=e.getIndent();e.setIndent(t+1)}),ne),n.registerCommand(Xf,()=>pg(e=>{const t=e.getIndent();t>0&&e.setIndent(Math.max(0,t-1))}),ne),n.registerCommand(vd,e=>{const t=K();if(pt(t)){const r=t.getNodes();if(r.length>0)return r[0].selectPrevious(),!0}else if(B(t)){const r=vu(t.focus,!0);if(!e.shiftKey&&ve(r)&&!r.isIsolated()&&!r.isInline())return r.selectPrevious(),e.preventDefault(),!0}return!1},ne),n.registerCommand(kd,e=>{const t=K();if(pt(t)){const r=t.getNodes();if(r.length>0)return r[0].selectNext(0,0),!0}else if(B(t)){if(function(i){const s=i.focus;return s.key==="root"&&s.offset===pe().getChildrenSize()}(t))return e.preventDefault(),!0;const r=vu(t.focus,!1);if(!e.shiftKey&&ve(r)&&!r.isIsolated()&&!r.isInline())return r.selectNext(),e.preventDefault(),!0}return!1},ne),n.registerCommand(bd,e=>{const t=K();if(pt(t)){const r=t.getNodes();if(r.length>0)return e.preventDefault(),r[0].selectPrevious(),!0}if(!B(t))return!1;if(Ya(t,!0)){const r=e.shiftKey;return e.preventDefault(),Xa(t,r,!0),!0}return!1},ne),n.registerCommand(_d,e=>{const t=K();if(pt(t)){const i=t.getNodes();if(i.length>0)return e.preventDefault(),i[0].selectNext(0,0),!0}if(!B(t))return!1;const r=e.shiftKey;return!!Ya(t,!1)&&(e.preventDefault(),Xa(t,r,!1),!0)},ne),n.registerCommand(xd,e=>{if(mg(e.target))return!1;const t=K();if(B(t)){if(function(r){if(!r.isCollapsed())return!1;const{anchor:i}=r;if(i.offset!==0)return!1;const s=i.getNode();if(et(s))return!1;const o=dC(s);return o.getIndent()>0&&(o.is(s)||s.is(o.getFirstDescendant()))}(t))return e.preventDefault(),n.dispatchCommand(Xf,void 0);if(hg&&navigator.language==="ko-KR")return!1}else if(!pt(t))return!1;return e.preventDefault(),n.dispatchCommand(hn,!0)},ne),n.registerCommand(Cd,e=>{if(mg(e.target))return!1;const t=K();return!(!B(t)&&!pt(t))&&(e.preventDefault(),n.dispatchCommand(hn,!1))},ne),n.registerCommand(Di,e=>{const t=K();if(!B(t))return!1;if(Bc(t),e!==null){if((hg||Zw||eS)&&Xw)return!1;if(e.preventDefault(),e.shiftKey)return n.dispatchCommand(er,!1)}return n.dispatchCommand(Js,void 0)},ne),n.registerCommand(pl,()=>{const e=K();return!!B(e)&&(n.blur(),!0)},ne),n.registerCommand(ml,e=>{const[,t]=Zo(e);if(t.length>0){const i=fg(e.clientX,e.clientY);if(i!==null){const{offset:s,node:o}=i,a=sr(o);if(a!==null){const l=fo();if(z(a))l.anchor.set(a.getKey(),s,"text"),l.focus.set(a.getKey(),s,"text");else{const u=a.getParentOrThrow().getKey(),f=a.getIndexWithinParent()+1;l.anchor.set(u,f,"element"),l.focus.set(u,f,"element")}const c=zs(l);it(c)}n.dispatchCommand(gg,t)}return e.preventDefault(),!0}const r=K();return!!B(r)},ne),n.registerCommand(Sd,e=>{const[t]=Zo(e),r=K();return!(t&&!B(r))},ne),n.registerCommand(qm,e=>{const[t]=Zo(e),r=K();if(t&&!B(r))return!1;const i=fg(e.clientX,e.clientY);if(i!==null){const s=sr(i.node);ve(s)&&e.preventDefault()}return!0},ne),n.registerCommand(Ba,()=>(Ay(),!0),ne),n.registerCommand(hr,e=>(Xh(n,Pn(e,ClipboardEvent)?e:null),!0),ne),n.registerCommand(Qr,e=>(async function(t,r){await Xh(r,Pn(t,ClipboardEvent)?t:null),r.update(()=>{const i=K();B(i)?i.removeText():pt(i)&&i.getNodes().forEach(s=>s.remove())})}(e,n),!0),ne),n.registerCommand(Zr,e=>{const[,t,r]=Zo(e);return t.length>0&&!r?(n.dispatchCommand(gg,t),!0):ti(e.target)&&Dd(e.target)?!1:K()!==null&&(function(i,s){i.preventDefault(),s.update(()=>{const o=K(),a=Pn(i,InputEvent)||Pn(i,KeyboardEvent)?null:i.clipboardData;a!=null&&o!==null&&Gh(a,o,s)},{tag:by})}(e,n),!0)},ne),n.registerCommand(Fm,e=>{const t=K();return B(t)&&Bc(t),!1},ne),n.registerCommand(wd,e=>{const t=K();return B(t)&&Bc(t),!1},ne))}const Iu=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0?x.useLayoutEffect:x.useEffect;function yg(n){return n.getEditorState().read(Xd(n.isComposing()))}function nS({contentEditable:n,placeholder:e=null,ErrorBoundary:t}){const[r]=ge(),i=function(s,o){const[a,l]=x.useState(()=>s.getDecorators());return Iu(()=>s.registerDecoratorListener(c=>{Nt.flushSync(()=>{l(c)})}),[s]),x.useEffect(()=>{l(s.getDecorators())},[s]),x.useMemo(()=>{const c=[],u=Object.keys(a);for(let f=0;f<u.length;f++){const d=u[f],h=S.jsx(o,{onError:m=>s._onError(m),children:S.jsx(x.Suspense,{fallback:null,children:a[d]})}),p=s.getElementByKey(d);p!==null&&c.push(Nt.createPortal(h,p,d))}return c},[o,a,s])}(r,t);return function(s){Iu(()=>He(tS(s),A_(s)),[s])}(r),S.jsxs(S.Fragment,{children:[n,S.jsx(rS,{content:e}),i]})}function rS({content:n}){const[e]=ge(),t=function(i){const[s,o]=x.useState(()=>yg(i));return Iu(()=>{function a(){const l=yg(i);o(l)}return a(),He(i.registerUpdateListener(()=>{a()}),i.registerEditableListener(()=>{a()}))},[i]),s}(e),r=M_();return t?typeof n=="function"?n(r):n:null}var Qo={exports:{}},Uc,_g;function iS(){if(_g)return Uc;_g=1;var n=-1,e=1,t=0;function r(k,I,w,L,F){if(k===I)return k?[[t,k]]:[];if(w!=null){var q=$(k,I,w);if(q)return q}var W=a(k,I),J=k.substring(0,W);k=k.substring(W),I=I.substring(W),W=c(k,I);var V=k.substring(k.length-W);k=k.substring(0,k.length-W),I=I.substring(0,I.length-W);var G=i(k,I);return J&&G.unshift([t,J]),V&&G.push([t,V]),_(G,F),L&&f(G),G}function i(k,I){var w;if(!k)return[[e,I]];if(!I)return[[n,k]];var L=k.length>I.length?k:I,F=k.length>I.length?I:k,q=L.indexOf(F);if(q!==-1)return w=[[e,L.substring(0,q)],[t,F],[e,L.substring(q+F.length)]],k.length>I.length&&(w[0][0]=w[2][0]=n),w;if(F.length===1)return[[n,k],[e,I]];var W=u(k,I);if(W){var J=W[0],V=W[1],G=W[2],ee=W[3],Z=W[4],re=r(J,G),oe=r(V,ee);return re.concat([[t,Z]],oe)}return s(k,I)}function s(k,I){for(var w=k.length,L=I.length,F=Math.ceil((w+L)/2),q=F,W=2*F,J=new Array(W),V=new Array(W),G=0;G<W;G++)J[G]=-1,V[G]=-1;J[q+1]=0,V[q+1]=0;for(var ee=w-L,Z=ee%2!==0,re=0,oe=0,X=0,fe=0,be=0;be<F;be++){for(var se=-be+re;se<=be-oe;se+=2){var ce=q+se,he;se===-be||se!==be&&J[ce-1]<J[ce+1]?he=J[ce+1]:he=J[ce-1]+1;for(var ke=he-se;he<w&&ke<L&&k.charAt(he)===I.charAt(ke);)he++,ke++;if(J[ce]=he,he>w)oe+=2;else if(ke>L)re+=2;else if(Z){var Ce=q+ee-se;if(Ce>=0&&Ce<W&&V[Ce]!==-1){var Se=w-V[Ce];if(he>=Se)return o(k,I,he,ke)}}}for(var Le=-be+X;Le<=be-fe;Le+=2){var Ce=q+Le,Se;Le===-be||Le!==be&&V[Ce-1]<V[Ce+1]?Se=V[Ce+1]:Se=V[Ce-1]+1;for(var st=Se-Le;Se<w&&st<L&&k.charAt(w-Se-1)===I.charAt(L-st-1);)Se++,st++;if(V[Ce]=Se,Se>w)fe+=2;else if(st>L)X+=2;else if(!Z){var ce=q+ee-Le;if(ce>=0&&ce<W&&J[ce]!==-1){var he=J[ce],ke=q+he-ce;if(Se=w-Se,he>=Se)return o(k,I,he,ke)}}}}return[[n,k],[e,I]]}function o(k,I,w,L){var F=k.substring(0,w),q=I.substring(0,L),W=k.substring(w),J=I.substring(L),V=r(F,q),G=r(W,J);return V.concat(G)}function a(k,I){if(!k||!I||k.charAt(0)!==I.charAt(0))return 0;for(var w=0,L=Math.min(k.length,I.length),F=L,q=0;w<F;)k.substring(q,F)==I.substring(q,F)?(w=F,q=w):L=F,F=Math.floor((L-w)/2+w);return C(k.charCodeAt(F-1))&&F--,F}function l(k,I){var w=k.length,L=I.length;if(w==0||L==0)return 0;w>L?k=k.substring(w-L):w<L&&(I=I.substring(0,w));var F=Math.min(w,L);if(k==I)return F;for(var q=0,W=1;;){var J=k.substring(F-W),V=I.indexOf(J);if(V==-1)return q;W+=V,(V==0||k.substring(F-W)==I.substring(0,W))&&(q=W,W++)}}function c(k,I){if(!k||!I||k.slice(-1)!==I.slice(-1))return 0;for(var w=0,L=Math.min(k.length,I.length),F=L,q=0;w<F;)k.substring(k.length-F,k.length-q)==I.substring(I.length-F,I.length-q)?(w=F,q=w):L=F,F=Math.floor((L-w)/2+w);return E(k.charCodeAt(k.length-F))&&F--,F}function u(k,I){var w=k.length>I.length?k:I,L=k.length>I.length?I:k;if(w.length<4||L.length*2<w.length)return null;function F(oe,X,fe){for(var be=oe.substring(fe,fe+Math.floor(oe.length/4)),se=-1,ce="",he,ke,Ce,Se;(se=X.indexOf(be,se+1))!==-1;){var Le=a(oe.substring(fe),X.substring(se)),st=c(oe.substring(0,fe),X.substring(0,se));ce.length<st+Le&&(ce=X.substring(se-st,se)+X.substring(se,se+Le),he=oe.substring(0,fe-st),ke=oe.substring(fe+Le),Ce=X.substring(0,se-st),Se=X.substring(se+Le))}return ce.length*2>=oe.length?[he,ke,Ce,Se,ce]:null}var q=F(w,L,Math.ceil(w.length/4)),W=F(w,L,Math.ceil(w.length/2)),J;if(!q&&!W)return null;W?q?J=q[4].length>W[4].length?q:W:J=W:J=q;var V,G,ee,Z;k.length>I.length?(V=J[0],G=J[1],ee=J[2],Z=J[3]):(ee=J[0],Z=J[1],V=J[2],G=J[3]);var re=J[4];return[V,G,ee,Z,re]}function f(k){for(var I=!1,w=[],L=0,F=null,q=0,W=0,J=0,V=0,G=0;q<k.length;)k[q][0]==t?(w[L++]=q,W=V,J=G,V=0,G=0,F=k[q][1]):(k[q][0]==e?V+=k[q][1].length:G+=k[q][1].length,F&&F.length<=Math.max(W,J)&&F.length<=Math.max(V,G)&&(k.splice(w[L-1],0,[n,F]),k[w[L-1]+1][0]=e,L--,L--,q=L>0?w[L-1]:-1,W=0,J=0,V=0,G=0,F=null,I=!0)),q++;for(I&&_(k),b(k),q=1;q<k.length;){if(k[q-1][0]==n&&k[q][0]==e){var ee=k[q-1][1],Z=k[q][1],re=l(ee,Z),oe=l(Z,ee);re>=oe?(re>=ee.length/2||re>=Z.length/2)&&(k.splice(q,0,[t,Z.substring(0,re)]),k[q-1][1]=ee.substring(0,ee.length-re),k[q+1][1]=Z.substring(re),q++):(oe>=ee.length/2||oe>=Z.length/2)&&(k.splice(q,0,[t,ee.substring(0,oe)]),k[q-1][0]=e,k[q-1][1]=Z.substring(0,Z.length-oe),k[q+1][0]=n,k[q+1][1]=ee.substring(oe),q++),q++}q++}}var d=/[^a-zA-Z0-9]/,h=/\s/,p=/[\r\n]/,m=/\n\r?\n$/,y=/^\r?\n\r?\n/;function b(k){function I(oe,X){if(!oe||!X)return 6;var fe=oe.charAt(oe.length-1),be=X.charAt(0),se=fe.match(d),ce=be.match(d),he=se&&fe.match(h),ke=ce&&be.match(h),Ce=he&&fe.match(p),Se=ke&&be.match(p),Le=Ce&&oe.match(m),st=Se&&X.match(y);return Le||st?5:Ce||Se?4:se&&!he&&ke?3:he||ke?2:se||ce?1:0}for(var w=1;w<k.length-1;){if(k[w-1][0]==t&&k[w+1][0]==t){var L=k[w-1][1],F=k[w][1],q=k[w+1][1],W=c(L,F);if(W){var J=F.substring(F.length-W);L=L.substring(0,L.length-W),F=J+F.substring(0,F.length-W),q=J+q}for(var V=L,G=F,ee=q,Z=I(L,F)+I(F,q);F.charAt(0)===q.charAt(0);){L+=F.charAt(0),F=F.substring(1)+q.charAt(0),q=q.substring(1);var re=I(L,F)+I(F,q);re>=Z&&(Z=re,V=L,G=F,ee=q)}k[w-1][1]!=V&&(V?k[w-1][1]=V:(k.splice(w-1,1),w--),k[w][1]=G,ee?k[w+1][1]=ee:(k.splice(w+1,1),w--))}w++}}function _(k,I){k.push([t,""]);for(var w=0,L=0,F=0,q="",W="",J;w<k.length;){if(w<k.length-1&&!k[w][1]){k.splice(w,1);continue}switch(k[w][0]){case e:F++,W+=k[w][1],w++;break;case n:L++,q+=k[w][1],w++;break;case t:var V=w-F-L-1;if(I){if(V>=0&&N(k[V][1])){var G=k[V][1].slice(-1);if(k[V][1]=k[V][1].slice(0,-1),q=G+q,W=G+W,!k[V][1]){k.splice(V,1),w--;var ee=V-1;k[ee]&&k[ee][0]===e&&(F++,W=k[ee][1]+W,ee--),k[ee]&&k[ee][0]===n&&(L++,q=k[ee][1]+q,ee--),V=ee}}if(O(k[w][1])){var G=k[w][1].charAt(0);k[w][1]=k[w][1].slice(1),q+=G,W+=G}}if(w<k.length-1&&!k[w][1]){k.splice(w,1);break}if(q.length>0||W.length>0){q.length>0&&W.length>0&&(J=a(W,q),J!==0&&(V>=0?k[V][1]+=W.substring(0,J):(k.splice(0,0,[t,W.substring(0,J)]),w++),W=W.substring(J),q=q.substring(J)),J=c(W,q),J!==0&&(k[w][1]=W.substring(W.length-J)+k[w][1],W=W.substring(0,W.length-J),q=q.substring(0,q.length-J)));var Z=F+L;q.length===0&&W.length===0?(k.splice(w-Z,Z),w=w-Z):q.length===0?(k.splice(w-Z,Z,[e,W]),w=w-Z+1):W.length===0?(k.splice(w-Z,Z,[n,q]),w=w-Z+1):(k.splice(w-Z,Z,[n,q],[e,W]),w=w-Z+2)}w!==0&&k[w-1][0]===t?(k[w-1][1]+=k[w][1],k.splice(w,1)):w++,F=0,L=0,q="",W="";break}}k[k.length-1][1]===""&&k.pop();var re=!1;for(w=1;w<k.length-1;)k[w-1][0]===t&&k[w+1][0]===t&&(k[w][1].substring(k[w][1].length-k[w-1][1].length)===k[w-1][1]?(k[w][1]=k[w-1][1]+k[w][1].substring(0,k[w][1].length-k[w-1][1].length),k[w+1][1]=k[w-1][1]+k[w+1][1],k.splice(w-1,1),re=!0):k[w][1].substring(0,k[w+1][1].length)==k[w+1][1]&&(k[w-1][1]+=k[w+1][1],k[w][1]=k[w][1].substring(k[w+1][1].length)+k[w+1][1],k.splice(w+1,1),re=!0)),w++;re&&_(k,I)}function C(k){return k>=55296&&k<=56319}function E(k){return k>=56320&&k<=57343}function O(k){return E(k.charCodeAt(0))}function N(k){return C(k.charCodeAt(k.length-1))}function D(k){for(var I=[],w=0;w<k.length;w++)k[w][1].length>0&&I.push(k[w]);return I}function P(k,I,w,L){return N(k)||O(L)?null:D([[t,k],[n,I],[e,w],[t,L]])}function $(k,I,w){var L=typeof w=="number"?{index:w,length:0}:w.oldRange,F=typeof w=="number"?null:w.newRange,q=k.length,W=I.length;if(L.length===0&&(F===null||F.length===0)){var J=L.index,V=k.slice(0,J),G=k.slice(J),ee=F?F.index:null;e:{var Z=J+W-q;if(ee!==null&&ee!==Z||Z<0||Z>W)break e;var re=I.slice(0,Z),oe=I.slice(Z);if(oe!==G)break e;var X=Math.min(J,Z),fe=V.slice(0,X),be=re.slice(0,X);if(fe!==be)break e;var se=V.slice(X),ce=re.slice(X);return P(fe,se,ce,G)}e:{if(ee!==null&&ee!==J)break e;var he=J,re=I.slice(0,he),oe=I.slice(he);if(re!==V)break e;var ke=Math.min(q-he,W-he),Ce=G.slice(G.length-ke),Se=oe.slice(oe.length-ke);if(Ce!==Se)break e;var se=G.slice(0,G.length-ke),ce=oe.slice(0,oe.length-ke);return P(V,se,ce,Ce)}}if(L.length>0&&F&&F.length===0)e:{var fe=k.slice(0,L.index),Ce=k.slice(L.index+L.length),X=fe.length,ke=Ce.length;if(W<X+ke)break e;var be=I.slice(0,X),Se=I.slice(W-ke);if(fe!==be||Ce!==Se)break e;var se=k.slice(X,q-ke),ce=I.slice(X,W-ke);return P(fe,se,ce,Ce)}return null}function R(k,I,w,L){return r(k,I,w,L,!0)}return R.INSERT=e,R.DELETE=n,R.EQUAL=t,Uc=R,Uc}var Ps={exports:{}};Ps.exports;var bg;function O_(){return bg||(bg=1,function(n,e){var t=200,r="__lodash_hash_undefined__",i=9007199254740991,s="[object Arguments]",o="[object Array]",a="[object Boolean]",l="[object Date]",c="[object Error]",u="[object Function]",f="[object GeneratorFunction]",d="[object Map]",h="[object Number]",p="[object Object]",m="[object Promise]",y="[object RegExp]",b="[object Set]",_="[object String]",C="[object Symbol]",E="[object WeakMap]",O="[object ArrayBuffer]",N="[object DataView]",D="[object Float32Array]",P="[object Float64Array]",$="[object Int8Array]",R="[object Int16Array]",k="[object Int32Array]",I="[object Uint8Array]",w="[object Uint8ClampedArray]",L="[object Uint16Array]",F="[object Uint32Array]",q=/[\\^$.*+?()[\]{}|]/g,W=/\w*$/,J=/^\[object .+?Constructor\]$/,V=/^(?:0|[1-9]\d*)$/,G={};G[s]=G[o]=G[O]=G[N]=G[a]=G[l]=G[D]=G[P]=G[$]=G[R]=G[k]=G[d]=G[h]=G[p]=G[y]=G[b]=G[_]=G[C]=G[I]=G[w]=G[L]=G[F]=!0,G[c]=G[u]=G[E]=!1;var ee=typeof Gn=="object"&&Gn&&Gn.Object===Object&&Gn,Z=typeof self=="object"&&self&&self.Object===Object&&self,re=ee||Z||Function("return this")(),oe=e&&!e.nodeType&&e,X=oe&&!0&&n&&!n.nodeType&&n,fe=X&&X.exports===oe;function be(g,v){return g.set(v[0],v[1]),g}function se(g,v){return g.add(v),g}function ce(g,v){for(var T=-1,U=g?g.length:0;++T<U&&v(g[T],T,g)!==!1;);return g}function he(g,v){for(var T=-1,U=v.length,le=g.length;++T<U;)g[le+T]=v[T];return g}function ke(g,v,T,U){for(var le=-1,te=g?g.length:0;++le<te;)T=v(T,g[le],le,g);return T}function Ce(g,v){for(var T=-1,U=Array(g);++T<g;)U[T]=v(T);return U}function Se(g,v){return g==null?void 0:g[v]}function Le(g){var v=!1;if(g!=null&&typeof g.toString!="function")try{v=!!(g+"")}catch{}return v}function st(g){var v=-1,T=Array(g.size);return g.forEach(function(U,le){T[++v]=[le,U]}),T}function ls(g,v){return function(T){return g(v(T))}}function wo(g){var v=-1,T=Array(g.size);return g.forEach(function(U){T[++v]=U}),T}var Dl=Array.prototype,jl=Function.prototype,oi=Object.prototype,cs=re["__core-js_shared__"],So=function(){var g=/[^.]+$/.exec(cs&&cs.keys&&cs.keys.IE_PROTO||"");return g?"Symbol(src)_1."+g:""}(),To=jl.toString,tn=oi.hasOwnProperty,ai=oi.toString,Fl=RegExp("^"+To.call(tn).replace(q,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),xr=fe?re.Buffer:void 0,li=re.Symbol,us=re.Uint8Array,$t=ls(Object.getPrototypeOf,Object),Eo=Object.create,No=oi.propertyIsEnumerable,ql=Dl.splice,ds=Object.getOwnPropertySymbols,ci=xr?xr.isBuffer:void 0,Mo=ls(Object.keys,Object),ui=Ut(re,"DataView"),Cr=Ut(re,"Map"),Bt=Ut(re,"Promise"),di=Ut(re,"Set"),fs=Ut(re,"WeakMap"),wr=Ut(Object,"create"),hs=gt(ui),Sr=gt(Cr),gs=gt(Bt),ps=gt(di),ms=gt(fs),Wn=li?li.prototype:void 0,Ao=Wn?Wn.valueOf:void 0;function vn(g){var v=-1,T=g?g.length:0;for(this.clear();++v<T;){var U=g[v];this.set(U[0],U[1])}}function Bl(){this.__data__=wr?wr(null):{}}function Ul(g){return this.has(g)&&delete this.__data__[g]}function zl(g){var v=this.__data__;if(wr){var T=v[g];return T===r?void 0:T}return tn.call(v,g)?v[g]:void 0}function Oo(g){var v=this.__data__;return wr?v[g]!==void 0:tn.call(v,g)}function ys(g,v){var T=this.__data__;return T[g]=wr&&v===void 0?r:v,this}vn.prototype.clear=Bl,vn.prototype.delete=Ul,vn.prototype.get=zl,vn.prototype.has=Oo,vn.prototype.set=ys;function Ye(g){var v=-1,T=g?g.length:0;for(this.clear();++v<T;){var U=g[v];this.set(U[0],U[1])}}function Wl(){this.__data__=[]}function Kl(g){var v=this.__data__,T=hi(v,g);if(T<0)return!1;var U=v.length-1;return T==U?v.pop():ql.call(v,T,1),!0}function Hl(g){var v=this.__data__,T=hi(v,g);return T<0?void 0:v[T][1]}function Jl(g){return hi(this.__data__,g)>-1}function Vl(g,v){var T=this.__data__,U=hi(T,g);return U<0?T.push([g,v]):T[U][1]=v,this}Ye.prototype.clear=Wl,Ye.prototype.delete=Kl,Ye.prototype.get=Hl,Ye.prototype.has=Jl,Ye.prototype.set=Vl;function ot(g){var v=-1,T=g?g.length:0;for(this.clear();++v<T;){var U=g[v];this.set(U[0],U[1])}}function Gl(){this.__data__={hash:new vn,map:new(Cr||Ye),string:new vn}}function Yl(g){return Er(this,g).delete(g)}function Xl(g){return Er(this,g).get(g)}function Zl(g){return Er(this,g).has(g)}function Ql(g,v){return Er(this,g).set(g,v),this}ot.prototype.clear=Gl,ot.prototype.delete=Yl,ot.prototype.get=Xl,ot.prototype.has=Zl,ot.prototype.set=Ql;function vt(g){this.__data__=new Ye(g)}function ec(){this.__data__=new Ye}function tc(g){return this.__data__.delete(g)}function nc(g){return this.__data__.get(g)}function rc(g){return this.__data__.has(g)}function ic(g,v){var T=this.__data__;if(T instanceof Ye){var U=T.__data__;if(!Cr||U.length<t-1)return U.push([g,v]),this;T=this.__data__=new ot(U)}return T.set(g,v),this}vt.prototype.clear=ec,vt.prototype.delete=tc,vt.prototype.get=nc,vt.prototype.has=rc,vt.prototype.set=ic;function fi(g,v){var T=ks(g)||pi(g)?Ce(g.length,String):[],U=T.length,le=!!U;for(var te in g)tn.call(g,te)&&!(le&&(te=="length"||_c(te,U)))&&T.push(te);return T}function $o(g,v,T){var U=g[v];(!(tn.call(g,v)&&Do(U,T))||T===void 0&&!(v in g))&&(g[v]=T)}function hi(g,v){for(var T=g.length;T--;)if(Do(g[T][0],v))return T;return-1}function nn(g,v){return g&&vs(v,Cs(v),g)}function _s(g,v,T,U,le,te,_e){var me;if(U&&(me=te?U(g,le,te,_e):U(g)),me!==void 0)return me;if(!sn(g))return g;var De=ks(g);if(De){if(me=mc(g),!v)return hc(g,me)}else{var xe=xn(g),at=xe==u||xe==f;if(jo(g))return gi(g,v);if(xe==p||xe==s||at&&!te){if(Le(g))return te?g:{};if(me=rn(at?{}:g),!v)return gc(g,nn(me,g))}else{if(!G[xe])return te?g:{};me=yc(g,xe,_s,v)}}_e||(_e=new vt);var kt=_e.get(g);if(kt)return kt;if(_e.set(g,me),!De)var je=T?pc(g):Cs(g);return ce(je||g,function(lt,Xe){je&&(Xe=lt,lt=g[Xe]),$o(me,Xe,_s(lt,v,T,U,Xe,g,_e))}),me}function sc(g){return sn(g)?Eo(g):{}}function oc(g,v,T){var U=v(g);return ks(g)?U:he(U,T(g))}function ac(g){return ai.call(g)}function lc(g){if(!sn(g)||vc(g))return!1;var v=xs(g)||Le(g)?Fl:J;return v.test(gt(g))}function cc(g){if(!Ro(g))return Mo(g);var v=[];for(var T in Object(g))tn.call(g,T)&&T!="constructor"&&v.push(T);return v}function gi(g,v){if(v)return g.slice();var T=new g.constructor(g.length);return g.copy(T),T}function bs(g){var v=new g.constructor(g.byteLength);return new us(v).set(new us(g)),v}function Tr(g,v){var T=v?bs(g.buffer):g.buffer;return new g.constructor(T,g.byteOffset,g.byteLength)}function Po(g,v,T){var U=v?T(st(g),!0):st(g);return ke(U,be,new g.constructor)}function Io(g){var v=new g.constructor(g.source,W.exec(g));return v.lastIndex=g.lastIndex,v}function uc(g,v,T){var U=v?T(wo(g),!0):wo(g);return ke(U,se,new g.constructor)}function dc(g){return Ao?Object(Ao.call(g)):{}}function fc(g,v){var T=v?bs(g.buffer):g.buffer;return new g.constructor(T,g.byteOffset,g.length)}function hc(g,v){var T=-1,U=g.length;for(v||(v=Array(U));++T<U;)v[T]=g[T];return v}function vs(g,v,T,U){T||(T={});for(var le=-1,te=v.length;++le<te;){var _e=v[le],me=void 0;$o(T,_e,me===void 0?g[_e]:me)}return T}function gc(g,v){return vs(g,kn(g),v)}function pc(g){return oc(g,Cs,kn)}function Er(g,v){var T=g.__data__;return bc(v)?T[typeof v=="string"?"string":"hash"]:T.map}function Ut(g,v){var T=Se(g,v);return lc(T)?T:void 0}var kn=ds?ls(ds,Object):xc,xn=ac;(ui&&xn(new ui(new ArrayBuffer(1)))!=N||Cr&&xn(new Cr)!=d||Bt&&xn(Bt.resolve())!=m||di&&xn(new di)!=b||fs&&xn(new fs)!=E)&&(xn=function(g){var v=ai.call(g),T=v==p?g.constructor:void 0,U=T?gt(T):void 0;if(U)switch(U){case hs:return N;case Sr:return d;case gs:return m;case ps:return b;case ms:return E}return v});function mc(g){var v=g.length,T=g.constructor(v);return v&&typeof g[0]=="string"&&tn.call(g,"index")&&(T.index=g.index,T.input=g.input),T}function rn(g){return typeof g.constructor=="function"&&!Ro(g)?sc($t(g)):{}}function yc(g,v,T,U){var le=g.constructor;switch(v){case O:return bs(g);case a:case l:return new le(+g);case N:return Tr(g,U);case D:case P:case $:case R:case k:case I:case w:case L:case F:return fc(g,U);case d:return Po(g,U,T);case h:case _:return new le(g);case y:return Io(g);case b:return uc(g,U,T);case C:return dc(g)}}function _c(g,v){return v=v??i,!!v&&(typeof g=="number"||V.test(g))&&g>-1&&g%1==0&&g<v}function bc(g){var v=typeof g;return v=="string"||v=="number"||v=="symbol"||v=="boolean"?g!=="__proto__":g===null}function vc(g){return!!So&&So in g}function Ro(g){var v=g&&g.constructor,T=typeof v=="function"&&v.prototype||oi;return g===T}function gt(g){if(g!=null){try{return To.call(g)}catch{}try{return g+""}catch{}}return""}function Lo(g){return _s(g,!0,!0)}function Do(g,v){return g===v||g!==g&&v!==v}function pi(g){return kc(g)&&tn.call(g,"callee")&&(!No.call(g,"callee")||ai.call(g)==s)}var ks=Array.isArray;function mi(g){return g!=null&&Fo(g.length)&&!xs(g)}function kc(g){return qo(g)&&mi(g)}var jo=ci||Cc;function xs(g){var v=sn(g)?ai.call(g):"";return v==u||v==f}function Fo(g){return typeof g=="number"&&g>-1&&g%1==0&&g<=i}function sn(g){var v=typeof g;return!!g&&(v=="object"||v=="function")}function qo(g){return!!g&&typeof g=="object"}function Cs(g){return mi(g)?fi(g):cc(g)}function xc(){return[]}function Cc(){return!1}n.exports=Lo}(Ps,Ps.exports)),Ps.exports}var Is={exports:{}};Is.exports;var vg;function $_(){return vg||(vg=1,function(n,e){var t=200,r="__lodash_hash_undefined__",i=1,s=2,o=9007199254740991,a="[object Arguments]",l="[object Array]",c="[object AsyncFunction]",u="[object Boolean]",f="[object Date]",d="[object Error]",h="[object Function]",p="[object GeneratorFunction]",m="[object Map]",y="[object Number]",b="[object Null]",_="[object Object]",C="[object Promise]",E="[object Proxy]",O="[object RegExp]",N="[object Set]",D="[object String]",P="[object Symbol]",$="[object Undefined]",R="[object WeakMap]",k="[object ArrayBuffer]",I="[object DataView]",w="[object Float32Array]",L="[object Float64Array]",F="[object Int8Array]",q="[object Int16Array]",W="[object Int32Array]",J="[object Uint8Array]",V="[object Uint8ClampedArray]",G="[object Uint16Array]",ee="[object Uint32Array]",Z=/[\\^$.*+?()[\]{}|]/g,re=/^\[object .+?Constructor\]$/,oe=/^(?:0|[1-9]\d*)$/,X={};X[w]=X[L]=X[F]=X[q]=X[W]=X[J]=X[V]=X[G]=X[ee]=!0,X[a]=X[l]=X[k]=X[u]=X[I]=X[f]=X[d]=X[h]=X[m]=X[y]=X[_]=X[O]=X[N]=X[D]=X[R]=!1;var fe=typeof Gn=="object"&&Gn&&Gn.Object===Object&&Gn,be=typeof self=="object"&&self&&self.Object===Object&&self,se=fe||be||Function("return this")(),ce=e&&!e.nodeType&&e,he=ce&&!0&&n&&!n.nodeType&&n,ke=he&&he.exports===ce,Ce=ke&&fe.process,Se=function(){try{return Ce&&Ce.binding&&Ce.binding("util")}catch{}}(),Le=Se&&Se.isTypedArray;function st(g,v){for(var T=-1,U=g==null?0:g.length,le=0,te=[];++T<U;){var _e=g[T];v(_e,T,g)&&(te[le++]=_e)}return te}function ls(g,v){for(var T=-1,U=v.length,le=g.length;++T<U;)g[le+T]=v[T];return g}function wo(g,v){for(var T=-1,U=g==null?0:g.length;++T<U;)if(v(g[T],T,g))return!0;return!1}function Dl(g,v){for(var T=-1,U=Array(g);++T<g;)U[T]=v(T);return U}function jl(g){return function(v){return g(v)}}function oi(g,v){return g.has(v)}function cs(g,v){return g==null?void 0:g[v]}function So(g){var v=-1,T=Array(g.size);return g.forEach(function(U,le){T[++v]=[le,U]}),T}function To(g,v){return function(T){return g(v(T))}}function tn(g){var v=-1,T=Array(g.size);return g.forEach(function(U){T[++v]=U}),T}var ai=Array.prototype,Fl=Function.prototype,xr=Object.prototype,li=se["__core-js_shared__"],us=Fl.toString,$t=xr.hasOwnProperty,Eo=function(){var g=/[^.]+$/.exec(li&&li.keys&&li.keys.IE_PROTO||"");return g?"Symbol(src)_1."+g:""}(),No=xr.toString,ql=RegExp("^"+us.call($t).replace(Z,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ds=ke?se.Buffer:void 0,ci=se.Symbol,Mo=se.Uint8Array,ui=xr.propertyIsEnumerable,Cr=ai.splice,Bt=ci?ci.toStringTag:void 0,di=Object.getOwnPropertySymbols,fs=ds?ds.isBuffer:void 0,wr=To(Object.keys,Object),hs=kn(se,"DataView"),Sr=kn(se,"Map"),gs=kn(se,"Promise"),ps=kn(se,"Set"),ms=kn(se,"WeakMap"),Wn=kn(Object,"create"),Ao=gt(hs),vn=gt(Sr),Bl=gt(gs),Ul=gt(ps),zl=gt(ms),Oo=ci?ci.prototype:void 0,ys=Oo?Oo.valueOf:void 0;function Ye(g){var v=-1,T=g==null?0:g.length;for(this.clear();++v<T;){var U=g[v];this.set(U[0],U[1])}}function Wl(){this.__data__=Wn?Wn(null):{},this.size=0}function Kl(g){var v=this.has(g)&&delete this.__data__[g];return this.size-=v?1:0,v}function Hl(g){var v=this.__data__;if(Wn){var T=v[g];return T===r?void 0:T}return $t.call(v,g)?v[g]:void 0}function Jl(g){var v=this.__data__;return Wn?v[g]!==void 0:$t.call(v,g)}function Vl(g,v){var T=this.__data__;return this.size+=this.has(g)?0:1,T[g]=Wn&&v===void 0?r:v,this}Ye.prototype.clear=Wl,Ye.prototype.delete=Kl,Ye.prototype.get=Hl,Ye.prototype.has=Jl,Ye.prototype.set=Vl;function ot(g){var v=-1,T=g==null?0:g.length;for(this.clear();++v<T;){var U=g[v];this.set(U[0],U[1])}}function Gl(){this.__data__=[],this.size=0}function Yl(g){var v=this.__data__,T=gi(v,g);if(T<0)return!1;var U=v.length-1;return T==U?v.pop():Cr.call(v,T,1),--this.size,!0}function Xl(g){var v=this.__data__,T=gi(v,g);return T<0?void 0:v[T][1]}function Zl(g){return gi(this.__data__,g)>-1}function Ql(g,v){var T=this.__data__,U=gi(T,g);return U<0?(++this.size,T.push([g,v])):T[U][1]=v,this}ot.prototype.clear=Gl,ot.prototype.delete=Yl,ot.prototype.get=Xl,ot.prototype.has=Zl,ot.prototype.set=Ql;function vt(g){var v=-1,T=g==null?0:g.length;for(this.clear();++v<T;){var U=g[v];this.set(U[0],U[1])}}function ec(){this.size=0,this.__data__={hash:new Ye,map:new(Sr||ot),string:new Ye}}function tc(g){var v=Ut(this,g).delete(g);return this.size-=v?1:0,v}function nc(g){return Ut(this,g).get(g)}function rc(g){return Ut(this,g).has(g)}function ic(g,v){var T=Ut(this,g),U=T.size;return T.set(g,v),this.size+=T.size==U?0:1,this}vt.prototype.clear=ec,vt.prototype.delete=tc,vt.prototype.get=nc,vt.prototype.has=rc,vt.prototype.set=ic;function fi(g){var v=-1,T=g==null?0:g.length;for(this.__data__=new vt;++v<T;)this.add(g[v])}function $o(g){return this.__data__.set(g,r),this}function hi(g){return this.__data__.has(g)}fi.prototype.add=fi.prototype.push=$o,fi.prototype.has=hi;function nn(g){var v=this.__data__=new ot(g);this.size=v.size}function _s(){this.__data__=new ot,this.size=0}function sc(g){var v=this.__data__,T=v.delete(g);return this.size=v.size,T}function oc(g){return this.__data__.get(g)}function ac(g){return this.__data__.has(g)}function lc(g,v){var T=this.__data__;if(T instanceof ot){var U=T.__data__;if(!Sr||U.length<t-1)return U.push([g,v]),this.size=++T.size,this;T=this.__data__=new vt(U)}return T.set(g,v),this.size=T.size,this}nn.prototype.clear=_s,nn.prototype.delete=sc,nn.prototype.get=oc,nn.prototype.has=ac,nn.prototype.set=lc;function cc(g,v){var T=pi(g),U=!T&&Do(g),le=!T&&!U&&mi(g),te=!T&&!U&&!le&&qo(g),_e=T||U||le||te,me=_e?Dl(g.length,String):[],De=me.length;for(var xe in g)$t.call(g,xe)&&!(_e&&(xe=="length"||le&&(xe=="offset"||xe=="parent")||te&&(xe=="buffer"||xe=="byteLength"||xe=="byteOffset")||yc(xe,De)))&&me.push(xe);return me}function gi(g,v){for(var T=g.length;T--;)if(Lo(g[T][0],v))return T;return-1}function bs(g,v,T){var U=v(g);return pi(g)?U:ls(U,T(g))}function Tr(g){return g==null?g===void 0?$:b:Bt&&Bt in Object(g)?xn(g):Ro(g)}function Po(g){return sn(g)&&Tr(g)==a}function Io(g,v,T,U,le){return g===v?!0:g==null||v==null||!sn(g)&&!sn(v)?g!==g&&v!==v:uc(g,v,T,U,Io,le)}function uc(g,v,T,U,le,te){var _e=pi(g),me=pi(v),De=_e?l:rn(g),xe=me?l:rn(v);De=De==a?_:De,xe=xe==a?_:xe;var at=De==_,kt=xe==_,je=De==xe;if(je&&mi(g)){if(!mi(v))return!1;_e=!0,at=!1}if(je&&!at)return te||(te=new nn),_e||qo(g)?vs(g,v,T,U,le,te):gc(g,v,De,T,U,le,te);if(!(T&i)){var lt=at&&$t.call(g,"__wrapped__"),Xe=kt&&$t.call(v,"__wrapped__");if(lt||Xe){var Kn=lt?g.value():g,Cn=Xe?v.value():v;return te||(te=new nn),le(Kn,Cn,T,U,te)}}return je?(te||(te=new nn),pc(g,v,T,U,le,te)):!1}function dc(g){if(!Fo(g)||bc(g))return!1;var v=jo(g)?ql:re;return v.test(gt(g))}function fc(g){return sn(g)&&xs(g.length)&&!!X[Tr(g)]}function hc(g){if(!vc(g))return wr(g);var v=[];for(var T in Object(g))$t.call(g,T)&&T!="constructor"&&v.push(T);return v}function vs(g,v,T,U,le,te){var _e=T&i,me=g.length,De=v.length;if(me!=De&&!(_e&&De>me))return!1;var xe=te.get(g);if(xe&&te.get(v))return xe==v;var at=-1,kt=!0,je=T&s?new fi:void 0;for(te.set(g,v),te.set(v,g);++at<me;){var lt=g[at],Xe=v[at];if(U)var Kn=_e?U(Xe,lt,at,v,g,te):U(lt,Xe,at,g,v,te);if(Kn!==void 0){if(Kn)continue;kt=!1;break}if(je){if(!wo(v,function(Cn,Nr){if(!oi(je,Nr)&&(lt===Cn||le(lt,Cn,T,U,te)))return je.push(Nr)})){kt=!1;break}}else if(!(lt===Xe||le(lt,Xe,T,U,te))){kt=!1;break}}return te.delete(g),te.delete(v),kt}function gc(g,v,T,U,le,te,_e){switch(T){case I:if(g.byteLength!=v.byteLength||g.byteOffset!=v.byteOffset)return!1;g=g.buffer,v=v.buffer;case k:return!(g.byteLength!=v.byteLength||!te(new Mo(g),new Mo(v)));case u:case f:case y:return Lo(+g,+v);case d:return g.name==v.name&&g.message==v.message;case O:case D:return g==v+"";case m:var me=So;case N:var De=U&i;if(me||(me=tn),g.size!=v.size&&!De)return!1;var xe=_e.get(g);if(xe)return xe==v;U|=s,_e.set(g,v);var at=vs(me(g),me(v),U,le,te,_e);return _e.delete(g),at;case P:if(ys)return ys.call(g)==ys.call(v)}return!1}function pc(g,v,T,U,le,te){var _e=T&i,me=Er(g),De=me.length,xe=Er(v),at=xe.length;if(De!=at&&!_e)return!1;for(var kt=De;kt--;){var je=me[kt];if(!(_e?je in v:$t.call(v,je)))return!1}var lt=te.get(g);if(lt&&te.get(v))return lt==v;var Xe=!0;te.set(g,v),te.set(v,g);for(var Kn=_e;++kt<De;){je=me[kt];var Cn=g[je],Nr=v[je];if(U)var Df=_e?U(Nr,Cn,je,v,g,te):U(Cn,Nr,je,g,v,te);if(!(Df===void 0?Cn===Nr||le(Cn,Nr,T,U,te):Df)){Xe=!1;break}Kn||(Kn=je=="constructor")}if(Xe&&!Kn){var Bo=g.constructor,Uo=v.constructor;Bo!=Uo&&"constructor"in g&&"constructor"in v&&!(typeof Bo=="function"&&Bo instanceof Bo&&typeof Uo=="function"&&Uo instanceof Uo)&&(Xe=!1)}return te.delete(g),te.delete(v),Xe}function Er(g){return bs(g,Cs,mc)}function Ut(g,v){var T=g.__data__;return _c(v)?T[typeof v=="string"?"string":"hash"]:T.map}function kn(g,v){var T=cs(g,v);return dc(T)?T:void 0}function xn(g){var v=$t.call(g,Bt),T=g[Bt];try{g[Bt]=void 0;var U=!0}catch{}var le=No.call(g);return U&&(v?g[Bt]=T:delete g[Bt]),le}var mc=di?function(g){return g==null?[]:(g=Object(g),st(di(g),function(v){return ui.call(g,v)}))}:xc,rn=Tr;(hs&&rn(new hs(new ArrayBuffer(1)))!=I||Sr&&rn(new Sr)!=m||gs&&rn(gs.resolve())!=C||ps&&rn(new ps)!=N||ms&&rn(new ms)!=R)&&(rn=function(g){var v=Tr(g),T=v==_?g.constructor:void 0,U=T?gt(T):"";if(U)switch(U){case Ao:return I;case vn:return m;case Bl:return C;case Ul:return N;case zl:return R}return v});function yc(g,v){return v=v??o,!!v&&(typeof g=="number"||oe.test(g))&&g>-1&&g%1==0&&g<v}function _c(g){var v=typeof g;return v=="string"||v=="number"||v=="symbol"||v=="boolean"?g!=="__proto__":g===null}function bc(g){return!!Eo&&Eo in g}function vc(g){var v=g&&g.constructor,T=typeof v=="function"&&v.prototype||xr;return g===T}function Ro(g){return No.call(g)}function gt(g){if(g!=null){try{return us.call(g)}catch{}try{return g+""}catch{}}return""}function Lo(g,v){return g===v||g!==g&&v!==v}var Do=Po(function(){return arguments}())?Po:function(g){return sn(g)&&$t.call(g,"callee")&&!ui.call(g,"callee")},pi=Array.isArray;function ks(g){return g!=null&&xs(g.length)&&!jo(g)}var mi=fs||Cc;function kc(g,v){return Io(g,v)}function jo(g){if(!Fo(g))return!1;var v=Tr(g);return v==h||v==p||v==c||v==E}function xs(g){return typeof g=="number"&&g>-1&&g%1==0&&g<=o}function Fo(g){var v=typeof g;return g!=null&&(v=="object"||v=="function")}function sn(g){return g!=null&&typeof g=="object"}var qo=Le?jl(Le):fc;function Cs(g){return ks(g)?cc(g):hc(g)}function xc(){return[]}function Cc(){return!1}n.exports=kc}(Is,Is.exports)),Is.exports}var ea={},kg;function sS(){if(kg)return ea;kg=1,Object.defineProperty(ea,"__esModule",{value:!0});const n=O_(),e=$_();var t;return function(r){function i(l={},c={},u=!1){typeof l!="object"&&(l={}),typeof c!="object"&&(c={});let f=n(c);u||(f=Object.keys(f).reduce((d,h)=>(f[h]!=null&&(d[h]=f[h]),d),{}));for(const d in l)l[d]!==void 0&&c[d]===void 0&&(f[d]=l[d]);return Object.keys(f).length>0?f:void 0}r.compose=i;function s(l={},c={}){typeof l!="object"&&(l={}),typeof c!="object"&&(c={});const u=Object.keys(l).concat(Object.keys(c)).reduce((f,d)=>(e(l[d],c[d])||(f[d]=c[d]===void 0?null:c[d]),f),{});return Object.keys(u).length>0?u:void 0}r.diff=s;function o(l={},c={}){l=l||{};const u=Object.keys(c).reduce((f,d)=>(c[d]!==l[d]&&l[d]!==void 0&&(f[d]=c[d]),f),{});return Object.keys(l).reduce((f,d)=>(l[d]!==c[d]&&c[d]===void 0&&(f[d]=null),f),u)}r.invert=o;function a(l,c,u=!1){if(typeof l!="object")return c;if(typeof c!="object")return;if(!u)return c;const f=Object.keys(c).reduce((d,h)=>(l[h]===void 0&&(d[h]=c[h]),d),{});return Object.keys(f).length>0?f:void 0}r.transform=a}(t||(t={})),ea.default=t,ea}var ta={},xg;function P_(){if(xg)return ta;xg=1,Object.defineProperty(ta,"__esModule",{value:!0});var n;return function(e){function t(r){return typeof r.delete=="number"?r.delete:typeof r.retain=="number"?r.retain:typeof r.retain=="object"&&r.retain!==null?1:typeof r.insert=="string"?r.insert.length:1}e.length=t}(n||(n={})),ta.default=n,ta}var na={},Cg;function oS(){if(Cg)return na;Cg=1,Object.defineProperty(na,"__esModule",{value:!0});const n=P_();class e{constructor(r){this.ops=r,this.index=0,this.offset=0}hasNext(){return this.peekLength()<1/0}next(r){r||(r=1/0);const i=this.ops[this.index];if(i){const s=this.offset,o=n.default.length(i);if(r>=o-s?(r=o-s,this.index+=1,this.offset=0):this.offset+=r,typeof i.delete=="number")return{delete:r};{const a={};return i.attributes&&(a.attributes=i.attributes),typeof i.retain=="number"?a.retain=r:typeof i.retain=="object"&&i.retain!==null?a.retain=i.retain:typeof i.insert=="string"?a.insert=i.insert.substr(s,r):a.insert=i.insert,a}}else return{retain:1/0}}peek(){return this.ops[this.index]}peekLength(){return this.ops[this.index]?n.default.length(this.ops[this.index])-this.offset:1/0}peekType(){const r=this.ops[this.index];return r?typeof r.delete=="number"?"delete":typeof r.retain=="number"||typeof r.retain=="object"&&r.retain!==null?"retain":"insert":"retain"}rest(){if(this.hasNext()){if(this.offset===0)return this.ops.slice(this.index);{const r=this.offset,i=this.index,s=this.next(),o=this.ops.slice(this.index);return this.offset=r,this.index=i,[s].concat(o)}}else return[]}}return na.default=e,na}var wg;function aS(){return wg||(wg=1,function(n,e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeMap=e.OpIterator=e.Op=void 0;const t=iS(),r=O_(),i=$_(),s=sS();e.AttributeMap=s.default;const o=P_();e.Op=o.default;const a=oS();e.OpIterator=a.default;const l="\0",c=(f,d)=>{if(typeof f!="object"||f===null)throw new Error(`cannot retain a ${typeof f}`);if(typeof d!="object"||d===null)throw new Error(`cannot retain a ${typeof d}`);const h=Object.keys(f)[0];if(!h||h!==Object.keys(d)[0])throw new Error(`embed types not matched: ${h} != ${Object.keys(d)[0]}`);return[h,f[h],d[h]]};class u{constructor(d){Array.isArray(d)?this.ops=d:d!=null&&Array.isArray(d.ops)?this.ops=d.ops:this.ops=[]}static registerEmbed(d,h){this.handlers[d]=h}static unregisterEmbed(d){delete this.handlers[d]}static getHandler(d){const h=this.handlers[d];if(!h)throw new Error(`no handlers for embed type "${d}"`);return h}insert(d,h){const p={};return typeof d=="string"&&d.length===0?this:(p.insert=d,h!=null&&typeof h=="object"&&Object.keys(h).length>0&&(p.attributes=h),this.push(p))}delete(d){return d<=0?this:this.push({delete:d})}retain(d,h){if(typeof d=="number"&&d<=0)return this;const p={retain:d};return h!=null&&typeof h=="object"&&Object.keys(h).length>0&&(p.attributes=h),this.push(p)}push(d){let h=this.ops.length,p=this.ops[h-1];if(d=r(d),typeof p=="object"){if(typeof d.delete=="number"&&typeof p.delete=="number")return this.ops[h-1]={delete:p.delete+d.delete},this;if(typeof p.delete=="number"&&d.insert!=null&&(h-=1,p=this.ops[h-1],typeof p!="object"))return this.ops.unshift(d),this;if(i(d.attributes,p.attributes)){if(typeof d.insert=="string"&&typeof p.insert=="string")return this.ops[h-1]={insert:p.insert+d.insert},typeof d.attributes=="object"&&(this.ops[h-1].attributes=d.attributes),this;if(typeof d.retain=="number"&&typeof p.retain=="number")return this.ops[h-1]={retain:p.retain+d.retain},typeof d.attributes=="object"&&(this.ops[h-1].attributes=d.attributes),this}}return h===this.ops.length?this.ops.push(d):this.ops.splice(h,0,d),this}chop(){const d=this.ops[this.ops.length-1];return d&&typeof d.retain=="number"&&!d.attributes&&this.ops.pop(),this}filter(d){return this.ops.filter(d)}forEach(d){this.ops.forEach(d)}map(d){return this.ops.map(d)}partition(d){const h=[],p=[];return this.forEach(m=>{(d(m)?h:p).push(m)}),[h,p]}reduce(d,h){return this.ops.reduce(d,h)}changeLength(){return this.reduce((d,h)=>h.insert?d+o.default.length(h):h.delete?d-h.delete:d,0)}length(){return this.reduce((d,h)=>d+o.default.length(h),0)}slice(d=0,h=1/0){const p=[],m=new a.default(this.ops);let y=0;for(;y<h&&m.hasNext();){let b;y<d?b=m.next(d-y):(b=m.next(h-y),p.push(b)),y+=o.default.length(b)}return new u(p)}compose(d){const h=new a.default(this.ops),p=new a.default(d.ops),m=[],y=p.peek();if(y!=null&&typeof y.retain=="number"&&y.attributes==null){let _=y.retain;for(;h.peekType()==="insert"&&h.peekLength()<=_;)_-=h.peekLength(),m.push(h.next());y.retain-_>0&&p.next(y.retain-_)}const b=new u(m);for(;h.hasNext()||p.hasNext();)if(p.peekType()==="insert")b.push(p.next());else if(h.peekType()==="delete")b.push(h.next());else{const _=Math.min(h.peekLength(),p.peekLength()),C=h.next(_),E=p.next(_);if(E.retain){const O={};if(typeof C.retain=="number")O.retain=typeof E.retain=="number"?_:E.retain;else if(typeof E.retain=="number")C.retain==null?O.insert=C.insert:O.retain=C.retain;else{const D=C.retain==null?"insert":"retain",[P,$,R]=c(C[D],E.retain),k=u.getHandler(P);O[D]={[P]:k.compose($,R,D==="retain")}}const N=s.default.compose(C.attributes,E.attributes,typeof C.retain=="number");if(N&&(O.attributes=N),b.push(O),!p.hasNext()&&i(b.ops[b.ops.length-1],O)){const D=new u(h.rest());return b.concat(D).chop()}}else typeof E.delete=="number"&&(typeof C.retain=="number"||typeof C.retain=="object"&&C.retain!==null)&&b.push(E)}return b.chop()}concat(d){const h=new u(this.ops.slice());return d.ops.length>0&&(h.push(d.ops[0]),h.ops=h.ops.concat(d.ops.slice(1))),h}diff(d,h){if(this.ops===d.ops)return new u;const p=[this,d].map(C=>C.map(E=>{if(E.insert!=null)return typeof E.insert=="string"?E.insert:l;const O=C===d?"on":"with";throw new Error("diff() called "+O+" non-document")}).join("")),m=new u,y=t(p[0],p[1],h,!0),b=new a.default(this.ops),_=new a.default(d.ops);return y.forEach(C=>{let E=C[1].length;for(;E>0;){let O=0;switch(C[0]){case t.INSERT:O=Math.min(_.peekLength(),E),m.push(_.next(O));break;case t.DELETE:O=Math.min(E,b.peekLength()),b.next(O),m.delete(O);break;case t.EQUAL:O=Math.min(b.peekLength(),_.peekLength(),E);const N=b.next(O),D=_.next(O);i(N.insert,D.insert)?m.retain(O,s.default.diff(N.attributes,D.attributes)):m.push(D).delete(O);break}E-=O}}),m.chop()}eachLine(d,h=`
`){const p=new a.default(this.ops);let m=new u,y=0;for(;p.hasNext();){if(p.peekType()!=="insert")return;const b=p.peek(),_=o.default.length(b)-p.peekLength(),C=typeof b.insert=="string"?b.insert.indexOf(h,_)-_:-1;if(C<0)m.push(p.next());else if(C>0)m.push(p.next(C));else{if(d(m,p.next(1).attributes||{},y)===!1)return;y+=1,m=new u}}m.length()>0&&d(m,{},y)}invert(d){const h=new u;return this.reduce((p,m)=>{if(m.insert)h.delete(o.default.length(m));else{if(typeof m.retain=="number"&&m.attributes==null)return h.retain(m.retain),p+m.retain;if(m.delete||typeof m.retain=="number"){const y=m.delete||m.retain;return d.slice(p,p+y).forEach(_=>{m.delete?h.push(_):m.retain&&m.attributes&&h.retain(o.default.length(_),s.default.invert(m.attributes,_.attributes))}),p+y}else if(typeof m.retain=="object"&&m.retain!==null){const y=d.slice(p,p+1),b=new a.default(y.ops).next(),[_,C,E]=c(m.retain,b.insert),O=u.getHandler(_);return h.retain({[_]:O.invert(C,E)},s.default.invert(m.attributes,b.attributes)),p+1}}return p},0),h.chop()}transform(d,h=!1){if(h=!!h,typeof d=="number")return this.transformPosition(d,h);const p=d,m=new a.default(this.ops),y=new a.default(p.ops),b=new u;for(;m.hasNext()||y.hasNext();)if(m.peekType()==="insert"&&(h||y.peekType()!=="insert"))b.retain(o.default.length(m.next()));else if(y.peekType()==="insert")b.push(y.next());else{const _=Math.min(m.peekLength(),y.peekLength()),C=m.next(_),E=y.next(_);if(C.delete)continue;if(E.delete)b.push(E);else{const O=C.retain,N=E.retain;let D=typeof N=="object"&&N!==null?N:_;if(typeof O=="object"&&O!==null&&typeof N=="object"&&N!==null){const P=Object.keys(O)[0];if(P===Object.keys(N)[0]){const $=u.getHandler(P);$&&(D={[P]:$.transform(O[P],N[P],h)})}}b.retain(D,s.default.transform(C.attributes,E.attributes,h))}}return b.chop()}transformPosition(d,h=!1){h=!!h;const p=new a.default(this.ops);let m=0;for(;p.hasNext()&&m<=d;){const y=p.peekLength(),b=p.peekType();if(p.next(),b==="delete"){d-=Math.min(y,d-m);continue}else b==="insert"&&(m<d||!h)&&(d+=y);m+=y}return d}}u.Op=o.default,u.OpIterator=a.default,u.AttributeMap=s.default,u.handlers={},e.default=u,n.exports=u,n.exports.default=u}(Qo,Qo.exports)),Qo.exports}var lS=aS();const Rs=$v(lS),Ru=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,cS=Ru?x.useLayoutEffect:x.useEffect;let uS=class{constructor(e){this.key=e,this.ref={current:null},this.setRefElement=this.setRefElement.bind(this)}setRefElement(e){this.ref={current:e}}};const Sg=n=>{const e=document.getElementById("typeahead-menu");if(!e)return;const t=e.getBoundingClientRect();t.top+t.height>window.innerHeight&&e.scrollIntoView({block:"center"}),t.top<0&&e.scrollIntoView({block:"center"}),n.scrollIntoView({block:"nearest"})};function Tg(n,e){const t=n.getBoundingClientRect(),r=e.getBoundingClientRect();return t.top>r.top&&t.top<r.bottom}function dS(n,e,t,r){const[i]=ge();x.useEffect(()=>{if(e!=null&&n!=null){const s=i.getRootElement(),o=s!=null?function(f,d){let h=getComputedStyle(f);const p=h.position==="absolute",m=/(auto|scroll)/;if(h.position==="fixed")return document.body;for(let y=f;y=y.parentElement;)if(h=getComputedStyle(y),(!p||h.position!=="static")&&m.test(h.overflow+h.overflowY+h.overflowX))return y;return document.body}(s):document.body;let a=!1,l=Tg(e,o);const c=function(){a||(window.requestAnimationFrame(function(){t(),a=!1}),a=!0);const f=Tg(e,o);f!==l&&(l=f,r!=null&&r(f))},u=new ResizeObserver(t);return window.addEventListener("resize",t),document.addEventListener("scroll",c,{capture:!0,passive:!0}),u.observe(e),()=>{u.unobserve(e),window.removeEventListener("resize",t),document.removeEventListener("scroll",c,!0)}}},[e,i,r,t,n])}const Eg=ie("SCROLL_TYPEAHEAD_OPTION_INTO_VIEW_COMMAND");function fS({close:n,editor:e,anchorElementRef:t,resolution:r,options:i,menuRenderFn:s,onSelectOption:o,shouldSplitNodeWithQuery:a=!1,commandPriority:l=ei,preselectFirstItem:c=!0}){const[u,f]=x.useState(null),d=r.match&&r.match.matchingString;x.useEffect(()=>{c&&f(0)},[d,c]);const h=x.useCallback(m=>{e.update(()=>{const y=r.match!=null&&a?function(b){const _=K();if(!B(_)||!_.isCollapsed())return null;const C=_.anchor;if(C.type!=="text")return null;const E=C.getNode();if(!E.isSimpleText())return null;const O=C.offset,N=E.getTextContent().slice(0,O),D=b.replaceableString.length,P=O-function(R,k,I){let w=I;for(let L=w;L<=k.length;L++)R.slice(-L)===k.substring(0,L)&&(w=L);return w}(N,b.matchingString,D);if(P<0)return null;let $;return P===0?[$]=E.splitText(O):[,$]=E.splitText(P,O),$}(r.match):null;o(m,y,n,r.match?r.match.matchingString:"")})},[e,a,r.match,o,n]),p=x.useCallback(m=>{const y=e.getRootElement();y!==null&&(y.setAttribute("aria-activedescendant","typeahead-item-"+m),f(m))},[e]);return x.useEffect(()=>()=>{const m=e.getRootElement();m!==null&&m.removeAttribute("aria-activedescendant")},[e]),cS(()=>{i===null?f(null):u===null&&c&&p(0)},[i,u,p,c]),x.useEffect(()=>He(e.registerCommand(Eg,({option:m})=>!(!m.ref||m.ref.current==null)&&(Sg(m.ref.current),!0),l)),[e,p,l]),x.useEffect(()=>He(e.registerCommand(kd,m=>{const y=m;if(i!==null&&i.length){const b=u===null?0:u!==i.length-1?u+1:0;p(b);const _=i[b];_.ref!=null&&_.ref.current&&e.dispatchCommand(Eg,{index:b,option:_}),y.preventDefault(),y.stopImmediatePropagation()}return!0},l),e.registerCommand(vd,m=>{const y=m;if(i!==null&&i.length){const b=u===null?i.length-1:u!==0?u-1:i.length-1;p(b);const _=i[b];_.ref!=null&&_.ref.current&&Sg(_.ref.current),y.preventDefault(),y.stopImmediatePropagation()}return!0},l),e.registerCommand(pl,m=>{const y=m;return y.preventDefault(),y.stopImmediatePropagation(),n(),!0},l),e.registerCommand(wd,m=>{const y=m;return i!==null&&u!==null&&i[u]!=null&&(y.preventDefault(),y.stopImmediatePropagation(),h(i[u]),!0)},l),e.registerCommand(Di,m=>i!==null&&u!==null&&i[u]!=null&&(m!==null&&(m.preventDefault(),m.stopImmediatePropagation()),h(i[u]),!0),l)),[h,n,e,i,u,p,l]),s(t,x.useMemo(()=>({options:i,selectOptionAndCleanUp:h,selectedIndex:u,setHighlightedIndex:f}),[h,u,i]),r.match?r.match.matchingString:"")}function Ng(n,e){e!=null&&(n.className=e),n.setAttribute("aria-label","Typeahead menu"),n.setAttribute("role","listbox"),n.style.display="block",n.style.position="absolute"}function hS({options:n,onWillOpen:e,onClose:t,onOpen:r,onSelectOption:i,menuRenderFn:s,anchorClassName:o,commandPriority:a=ei,parent:l}){const[c]=ge(),[u,f]=x.useState(null),d=x.useRef(null),h=function(_,C,E,O=Ru?document.body:void 0,N=!0){const[D]=ge(),P=Ru?document.createElement("div"):null,$=x.useRef(P),R=x.useCallback(()=>{if($.current===null||O===void 0)return;$.current.style.top=$.current.style.bottom;const I=D.getRootElement(),w=$.current,L=w.firstChild;if(I!==null&&_!==null){const{left:F,top:q,width:W,height:J}=_.getRect(),V=$.current.offsetHeight;if(w.style.top=`${q+V+3+(N?window.pageYOffset:0)}px`,w.style.left=`${F+window.pageXOffset}px`,w.style.height=`${J}px`,w.style.width=`${W}px`,L!==null){L.style.top=`${q}`;const G=L.getBoundingClientRect(),ee=G.height,Z=G.width,re=I.getBoundingClientRect();F+Z>re.right&&(w.style.left=`${re.right-Z+window.pageXOffset}px`),(q+ee>window.innerHeight||q+ee>re.bottom)&&q-re.top>ee+J&&(w.style.top=`${q-ee-J+(N?window.pageYOffset:0)}px`)}w.isConnected||(Ng(w,E),O.append(w)),w.setAttribute("id","typeahead-menu"),I.setAttribute("aria-controls","typeahead-menu")}},[D,_,N,E,O]);x.useEffect(()=>{const I=D.getRootElement();return _!==null&&R(),()=>{I!==null&&I.removeAttribute("aria-controls");const w=$.current;w!==null&&w.isConnected&&(w.remove(),w.removeAttribute("id"))}},[D,R,_]);const k=x.useCallback(I=>{_!==null&&(I||C(null))},[_,C]);return dS(_,$.current,R,k),P!=null&&P===$.current&&(Ng(P,E),O!=null&&O.append(P)),$}(u,f,o,l),p=x.useCallback(()=>{f(null),t!=null&&u!==null&&t()},[t,u]),m=x.useCallback(_=>{f(_),r!=null&&u===null&&r(_)},[r,u]),y=x.useCallback(_=>{_.preventDefault(),e!=null&&e(_);const C=fC(_.target);m({getRect:()=>new DOMRect(_.clientX/C,_.clientY/C,1,1)})},[m,e]),b=x.useCallback(_=>{u!==null&&d.current!=null&&_.target!=null&&ti(_.target)&&!d.current.contains(_.target)&&p()},[p,u]);return x.useEffect(()=>{const _=c.getRootElement();if(_)return _.addEventListener("contextmenu",y),()=>_.removeEventListener("contextmenu",y)},[c,y]),x.useEffect(()=>(document.addEventListener("click",b),()=>document.removeEventListener("click",b)),[c,b]),h.current===null||u===null||c===null?null:S.jsx(fS,{close:p,resolution:u,editor:c,anchorElementRef:h,options:n,menuRenderFn:(_,C)=>s(_,C,{setMenuRef:E=>{d.current=E}}),onSelectOption:i,commandPriority:a})}function gS({defaultSelection:n}){const[e]=ge();return x.useEffect(()=>{e.focus(()=>{const t=document.activeElement,r=e.getRootElement();r===null||t!==null&&r.contains(t)||r.focus({preventScroll:!0})},{defaultSelection:n})},[n,e]),null}const pS=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0?x.useLayoutEffect:x.useEffect;function mS({onClear:n}){const[e]=ge();return pS(()=>e.registerCommand(Td,t=>(e.update(()=>{if(n==null){const r=pe(),i=K(),s=Ot();r.clear(),r.append(s),i!==null&&s.select(),B(i)&&(i.format=0)}else n()}),!0),ne),[e,n]),null}const Mg=[["Cat","rgb(125, 50, 0)"],["Dog","rgb(100, 0, 0)"],["Rabbit","rgb(150, 0, 0)"],["Frog","rgb(200, 0, 0)"],["Fox","rgb(200, 75, 0)"],["Hedgehog","rgb(0, 75, 0)"],["Pigeon","rgb(0, 125, 0)"],["Squirrel","rgb(75, 100, 0)"],["Bear","rgb(125, 100, 0)"],["Tiger","rgb(0, 0, 150)"],["Leopard","rgb(0, 0, 200)"],["Zebra","rgb(0, 0, 250)"],["Wolf","rgb(0, 100, 150)"],["Owl","rgb(0, 100, 100)"],["Gull","rgb(100, 0, 100)"],["Squid","rgb(150, 0, 150)"]],Ag=Mg[Math.floor(Math.random()*Mg.length)],yS=x.createContext({clientID:0,color:Ag[1],isCollabActive:!1,name:Ag[0],yjsDocMap:new Map});function I_(n,e){return x.useContext(yS)}const _S=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0?x.useLayoutEffect:x.useEffect;function bS({ignoreHistoryMergeTagChange:n=!0,ignoreSelectionChange:e=!1,onChange:t}){const[r]=ge();return _S(()=>{if(t)return r.registerUpdateListener(({editorState:i,dirtyElements:s,dirtyLeaves:o,prevEditorState:a,tags:l})=>{e&&s.size===0&&o.size===0||n&&l.has(Ir)||a.isEmpty()||t(i,r,l)})},[r,n,e,t]),null}const ns=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,vS=ns&&"documentMode"in document?document.documentMode:null,kS=!(!ns||!("InputEvent"in window)||vS)&&"getTargetRanges"in new window.InputEvent("input"),xS=ns&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent),Og=ns&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,CS=ns&&/^(?=.*Chrome).*/i.test(navigator.userAgent),wS=ns&&/AppleWebKit\/[\d.]+/.test(navigator.userAgent)&&!CS;function $g(n,e){e.update(()=>{if(n!==null){const t=Pn(n,KeyboardEvent)?null:n.clipboardData,r=K();if(r!==null&&t!=null){n.preventDefault();const i=i_(e);i!==null&&t.setData("text/html",i),t.setData("text/plain",r.getTextContent())}}})}function SS(n){return He(n.registerCommand(hn,e=>{const t=K();return!!B(t)&&(t.deleteCharacter(e),!0)},ne),n.registerCommand(Ri,e=>{const t=K();return!!B(t)&&(t.deleteWord(e),!0)},ne),n.registerCommand(Li,e=>{const t=K();return!!B(t)&&(t.deleteLine(e),!0)},ne),n.registerCommand($r,e=>{const t=K();if(!B(t))return!1;if(typeof e=="string")t.insertText(e);else{const r=e.dataTransfer;if(r!=null)Vh(r,t);else{const i=e.data;i&&t.insertText(i)}}return!0},ne),n.registerCommand(qa,()=>{const e=K();return!!B(e)&&(e.removeText(),!0)},ne),n.registerCommand(er,e=>{const t=K();return!!B(t)&&(t.insertLineBreak(e),!0)},ne),n.registerCommand(Js,()=>{const e=K();return!!B(e)&&(e.insertLineBreak(),!0)},ne),n.registerCommand(bd,e=>{const t=K();if(!B(t))return!1;const r=e,i=r.shiftKey;return!!Ya(t,!0)&&(r.preventDefault(),Xa(t,i,!0),!0)},ne),n.registerCommand(_d,e=>{const t=K();if(!B(t))return!1;const r=e,i=r.shiftKey;return!!Ya(t,!1)&&(r.preventDefault(),Xa(t,i,!1),!0)},ne),n.registerCommand(xd,e=>{const t=K();return!!B(t)&&(!Og||navigator.language!=="ko-KR")&&(e.preventDefault(),n.dispatchCommand(hn,!0))},ne),n.registerCommand(Cd,e=>{const t=K();return!!B(t)&&(e.preventDefault(),n.dispatchCommand(hn,!1))},ne),n.registerCommand(Di,e=>{const t=K();if(!B(t))return!1;if(e!==null){if((Og||xS||wS)&&kS)return!1;e.preventDefault()}return n.dispatchCommand(er,!1)},ne),n.registerCommand(Ba,()=>(Ay(),!0),ne),n.registerCommand(hr,e=>{const t=K();return!!B(t)&&($g(e,n),!0)},ne),n.registerCommand(Qr,e=>{const t=K();return!!B(t)&&(function(r,i){$g(r,i),i.update(()=>{const s=K();B(s)&&s.removeText()})}(e,n),!0)},ne),n.registerCommand(Zr,e=>{const t=K();return!!B(t)&&(function(r,i){r.preventDefault(),i.update(()=>{const s=K(),o=Pn(r,ClipboardEvent)?r.clipboardData:null;o!=null&&B(s)&&Vh(o,s)},{tag:by})}(e,n),!0)},ne),n.registerCommand(ml,e=>{const t=K();return!!B(t)&&(e.preventDefault(),!0)},ne),n.registerCommand(Sd,e=>{const t=K();return!!B(t)&&(e.preventDefault(),!0)},ne))}const Lu=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0?x.useLayoutEffect:x.useEffect;function Pg(n){return n.getEditorState().read(Xd(n.isComposing()))}function TS({contentEditable:n,placeholder:e=null,ErrorBoundary:t}){const[r]=ge(),i=function(s,o){const[a,l]=x.useState(()=>s.getDecorators());return Lu(()=>s.registerDecoratorListener(c=>{Nt.flushSync(()=>{l(c)})}),[s]),x.useEffect(()=>{l(s.getDecorators())},[s]),x.useMemo(()=>{const c=[],u=Object.keys(a);for(let f=0;f<u.length;f++){const d=u[f],h=S.jsx(o,{onError:m=>s._onError(m),children:S.jsx(x.Suspense,{fallback:null,children:a[d]})}),p=s.getElementByKey(d);p!==null&&c.push(Nt.createPortal(h,p,d))}return c},[o,a,s])}(r,t);return function(s){Lu(()=>He(SS(s),A_(s)),[s])}(r),S.jsxs(S.Fragment,{children:[n,S.jsx(ES,{content:e}),i]})}function ES({content:n}){const[e]=ge(),t=function(i){const[s,o]=x.useState(()=>Pg(i));return Lu(()=>{function a(){const l=Pg(i);o(l)}return a(),He(i.registerUpdateListener(()=>{a()}),i.registerEditableListener(()=>{a()}))},[i]),s}(e),r=M_();return t?typeof n=="function"?n(r):n:null}const gn=()=>new Map,Du=n=>{const e=gn();return n.forEach((t,r)=>{e.set(r,t)}),e},rs=(n,e,t)=>{let r=n.get(e);return r===void 0&&n.set(e,r=t()),r},NS=(n,e)=>{const t=[];for(const[r,i]of n)t.push(e(i,r));return t},MS=(n,e)=>{for(const[t,r]of n)if(e(r,t))return!0;return!1},Bi=()=>new Set,zc=n=>n[n.length-1],Ui=Array.from,AS=Array.isArray;class OS{constructor(){this._observers=gn()}on(e,t){return rs(this._observers,e,Bi).add(t),t}once(e,t){const r=(...i)=>{this.off(e,r),t(...i)};this.on(e,r)}off(e,t){const r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return Ui((this._observers.get(e)||gn()).values()).forEach(r=>r(...t))}destroy(){this._observers=gn()}}const Kr=Math.floor,Sa=Math.abs,R_=(n,e)=>n<e?n:e,is=(n,e)=>n>e?n:e,$S=n=>n!==0?n<0:1/n<0,Ig=1,Rg=2,Wc=4,Kc=8,PS=32,L_=64,Qa=128,IS=31,Lg=63,Bs=127,RS=2147483647,LS=Number.isInteger||(n=>typeof n=="number"&&isFinite(n)&&Kr(n)===n),DS=n=>n.toLowerCase(),jS=/^\s*/g,FS=n=>n.replace(jS,""),qS=/([A-Z])/g,Dg=(n,e)=>FS(n.replace(qS,t=>`${e}${DS(t)}`)),BS=n=>{const e=unescape(encodeURIComponent(n)),t=e.length,r=new Uint8Array(t);for(let i=0;i<t;i++)r[i]=e.codePointAt(i);return r},Ys=typeof TextEncoder<"u"?new TextEncoder:null,US=n=>Ys.encode(n),zS=Ys?US:BS;let Hc=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Hc&&Hc.decode(new Uint8Array).length===1&&(Hc=null);class yo{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const Zd=()=>new yo,WS=n=>{let e=n.cpos;for(let t=0;t<n.bufs.length;t++)e+=n.bufs[t].length;return e},In=n=>{const e=new Uint8Array(WS(n));let t=0;for(let r=0;r<n.bufs.length;r++){const i=n.bufs[r];e.set(i,t),t+=i.length}return e.set(new Uint8Array(n.cbuf.buffer,0,n.cpos),t),e},KS=(n,e)=>{const t=n.cbuf.length;t-n.cpos<e&&(n.bufs.push(new Uint8Array(n.cbuf.buffer,0,n.cpos)),n.cbuf=new Uint8Array(is(t,e)*2),n.cpos=0)},ze=(n,e)=>{const t=n.cbuf.length;n.cpos===t&&(n.bufs.push(n.cbuf),n.cbuf=new Uint8Array(t*2),n.cpos=0),n.cbuf[n.cpos++]=e},ju=ze,Ee=(n,e)=>{for(;e>Bs;)ze(n,Qa|Bs&e),e=Kr(e/128);ze(n,Bs&e)},Qd=(n,e)=>{const t=$S(e);for(t&&(e=-e),ze(n,(e>Lg?Qa:0)|(t?L_:0)|Lg&e),e=Kr(e/64);e>0;)ze(n,(e>Bs?Qa:0)|Bs&e),e=Kr(e/128)},Fu=new Uint8Array(3e4),HS=Fu.length/3,JS=(n,e)=>{if(e.length<HS){const t=Ys.encodeInto(e,Fu).written||0;Ee(n,t);for(let r=0;r<t;r++)ze(n,Fu[r])}else Tt(n,zS(e))},VS=(n,e)=>{const t=unescape(encodeURIComponent(e)),r=t.length;Ee(n,r);for(let i=0;i<r;i++)ze(n,t.codePointAt(i))},Ni=Ys&&Ys.encodeInto?JS:VS,ef=(n,e)=>{const t=n.cbuf.length,r=n.cpos,i=R_(t-r,e.length),s=e.length-i;n.cbuf.set(e.subarray(0,i),r),n.cpos+=i,s>0&&(n.bufs.push(n.cbuf),n.cbuf=new Uint8Array(is(t*2,s)),n.cbuf.set(e.subarray(i)),n.cpos=s)},Tt=(n,e)=>{Ee(n,e.byteLength),ef(n,e)},tf=(n,e)=>{KS(n,e);const t=new DataView(n.cbuf.buffer,n.cpos,e);return n.cpos+=e,t},GS=(n,e)=>tf(n,4).setFloat32(0,e,!1),YS=(n,e)=>tf(n,8).setFloat64(0,e,!1),XS=(n,e)=>tf(n,8).setBigInt64(0,e,!1),jg=new DataView(new ArrayBuffer(4)),ZS=n=>(jg.setFloat32(0,n),jg.getFloat32(0)===n),Xs=(n,e)=>{switch(typeof e){case"string":ze(n,119),Ni(n,e);break;case"number":LS(e)&&Sa(e)<=RS?(ze(n,125),Qd(n,e)):ZS(e)?(ze(n,124),GS(n,e)):(ze(n,123),YS(n,e));break;case"bigint":ze(n,122),XS(n,e);break;case"object":if(e===null)ze(n,126);else if(AS(e)){ze(n,117),Ee(n,e.length);for(let t=0;t<e.length;t++)Xs(n,e[t])}else if(e instanceof Uint8Array)ze(n,116),Tt(n,e);else{ze(n,118);const t=Object.keys(e);Ee(n,t.length);for(let r=0;r<t.length;r++){const i=t[r];Ni(n,i),Xs(n,e[i])}}break;case"boolean":ze(n,e?120:121);break;default:ze(n,127)}};class Fg extends yo{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&Ee(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const qg=n=>{n.count>0&&(Qd(n.encoder,n.count===1?n.s:-n.s),n.count>1&&Ee(n.encoder,n.count-2))};class Ta{constructor(){this.encoder=new yo,this.s=0,this.count=0}write(e){this.s===e?this.count++:(qg(this),this.count=1,this.s=e)}toUint8Array(){return qg(this),In(this.encoder)}}const Bg=n=>{if(n.count>0){const e=n.diff*2+(n.count===1?0:1);Qd(n.encoder,e),n.count>1&&Ee(n.encoder,n.count-2)}};class Jc{constructor(){this.encoder=new yo,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(Bg(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return Bg(this),In(this.encoder)}}class QS{constructor(){this.sarr=[],this.s="",this.lensE=new Ta}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new yo;return this.sarr.push(this.s),this.s="",Ni(e,this.sarr.join("")),ef(e,this.lensE.toUint8Array()),In(e)}}const zi=n=>new Error(n),pn=()=>{throw zi("Method unimplemented")},Hr=()=>{throw zi("Unexpected case")},e0=crypto.getRandomValues.bind(crypto),D_=()=>e0(new Uint32Array(1))[0],t0="10000000-1000-4000-8000"+-1e11,n0=()=>t0.replace(/[018]/g,n=>(n^D_()&15>>n/4).toString(16)),Ug=n=>new Promise(n);Promise.all.bind(Promise);const zg=n=>n===void 0?null:n;class r0{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}}let j_=new r0,i0=!0;try{typeof localStorage<"u"&&localStorage&&(j_=localStorage,i0=!1)}catch{}const s0=j_,o0=Object.assign,a0=Object.keys,l0=(n,e)=>{for(const t in n)e(n[t],t)},Wg=n=>a0(n).length,c0=n=>{for(const e in n)return!1;return!0},u0=(n,e)=>{for(const t in n)if(!e(n[t],t))return!1;return!0},d0=(n,e)=>Object.prototype.hasOwnProperty.call(n,e),f0=(n,e)=>n===e||Wg(n)===Wg(e)&&u0(n,(t,r)=>(t!==void 0||d0(e,r))&&e[r]===t),h0=Object.freeze,F_=n=>{for(const e in n){const t=n[e];(typeof t=="object"||typeof t=="function")&&F_(n[e])}return h0(n)},nf=(n,e,t=0)=>{try{for(;t<n.length;t++)n[t](...e)}finally{t<n.length&&nf(n,e,t+1)}},g0=(n,e)=>e.includes(n);var q_={};const Zs=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";let on;const p0=()=>{if(on===void 0)if(Zs){on=gn();const n=process.argv;let e=null;for(let t=0;t<n.length;t++){const r=n[t];r[0]==="-"?(e!==null&&on.set(e,""),e=r):e!==null&&(on.set(e,r),e=null)}e!==null&&on.set(e,"")}else typeof location=="object"?(on=gn(),(location.search||"?").slice(1).split("&").forEach(n=>{if(n.length!==0){const[e,t]=n.split("=");on.set(`--${Dg(e,"-")}`,t),on.set(`-${Dg(e,"-")}`,t)}})):on=gn();return on},qu=n=>p0().has(n),el=n=>zg(Zs?q_[n.toUpperCase().replaceAll("-","_")]:s0.getItem(n)),B_=n=>qu("--"+n)||el(n)!==null;B_("production");const m0=Zs&&g0(q_.FORCE_COLOR,["true","1","2"]),y0=m0||!qu("--no-colors")&&!B_("no-color")&&(!Zs||process.stdout.isTTY)&&(!Zs||qu("--color")||el("COLORTERM")!==null||(el("TERM")||"").includes("color"));class _0{constructor(e,t){this.left=e,this.right=t}}const En=(n,e)=>new _0(n,e);typeof DOMParser<"u"&&new DOMParser;const b0=n=>NS(n,(e,t)=>`${t}:${e};`).join(""),Bn=Symbol,U_=Bn(),z_=Bn(),v0=Bn(),k0=Bn(),x0=Bn(),W_=Bn(),C0=Bn(),rf=Bn(),w0=Bn(),S0=n=>{var i;n.length===1&&((i=n[0])==null?void 0:i.constructor)===Function&&(n=n[0]());const e=[],t=[];let r=0;for(;r<n.length;r++){const s=n[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)e.push(s);else if(s.constructor===Object)break}for(r>0&&t.push(e.join(""));r<n.length;r++){const s=n[r];s instanceof Symbol||t.push(s)}return t},T0={[U_]:En("font-weight","bold"),[z_]:En("font-weight","normal"),[v0]:En("color","blue"),[x0]:En("color","green"),[k0]:En("color","grey"),[W_]:En("color","red"),[C0]:En("color","purple"),[rf]:En("color","orange"),[w0]:En("color","black")},E0=n=>{var o;n.length===1&&((o=n[0])==null?void 0:o.constructor)===Function&&(n=n[0]());const e=[],t=[],r=gn();let i=[],s=0;for(;s<n.length;s++){const a=n[s],l=T0[a];if(l!==void 0)r.set(l.left,l.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const c=b0(r);s>0||c.length>0?(e.push("%c"+a),t.push(c)):e.push(a)}else break}}for(s>0&&(i=t,i.unshift(e.join("")));s<n.length;s++){const a=n[s];a instanceof Symbol||i.push(a)}return i},K_=y0?E0:S0,N0=(...n)=>{console.log(...K_(n)),H_.forEach(e=>e.print(n))},M0=(...n)=>{console.warn(...K_(n)),n.unshift(rf),H_.forEach(e=>e.print(n))},H_=Bi(),J_=n=>({[Symbol.iterator](){return this},next:n}),A0=(n,e)=>J_(()=>{let t;do t=n.next();while(!t.done&&!e(t.value));return t}),Vc=(n,e)=>J_(()=>{const{done:t,value:r}=n.next();return{done:t,value:t?void 0:e(r)}});class O0{constructor(e,t){this.clock=e,this.len=t}}class $0{constructor(){this.clients=new Map}}const V_=(n,e,t)=>e.clients.forEach((r,i)=>{const s=n.doc.store.clients.get(i);if(s!=null){const o=s[s.length-1],a=o.id.clock+o.length;for(let l=0,c=r[l];l<r.length&&c.clock<a;c=r[++l])tb(n,s,c.clock,c.len,t)}}),P0=(n,e)=>{let t=0,r=n.length-1;for(;t<=r;){const i=Kr((t+r)/2),s=n[i],o=s.clock;if(o<=e){if(e<o+s.len)return i;t=i+1}else r=i-1}return null},G_=(n,e)=>{const t=n.clients.get(e.client);return t!==void 0&&P0(t,e.clock)!==null},Y_=n=>{n.clients.forEach(e=>{e.sort((i,s)=>i.clock-s.clock);let t,r;for(t=1,r=1;t<e.length;t++){const i=e[r-1],s=e[t];i.clock+i.len>=s.clock?i.len=is(i.len,s.clock+s.len-i.clock):(r<t&&(e[r]=s),r++)}e.length=r})},X_=(n,e,t,r)=>{rs(n.clients,e,()=>[]).push(new O0(t,r))},I0=(n,e)=>{Ee(n.restEncoder,e.clients.size),Ui(e.clients.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{n.resetDsCurVal(),Ee(n.restEncoder,t);const i=r.length;Ee(n.restEncoder,i);for(let s=0;s<i;s++){const o=r[s];n.writeDsClock(o.clock),n.writeDsLen(o.len)}})},Z_=D_;class _o extends OS{constructor({guid:e=n0(),collectionid:t=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=Z_(),this.guid=e,this.collectionid=t,this.share=new Map,this.store=new W0,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=Ug(c=>{this.on("load",()=>{this.isLoaded=!0,c(this)})});const l=()=>Ug(c=>{const u=f=>{(f===void 0||f===!0)&&(this.off("sync",u),c())};this.on("sync",u)});this.on("sync",c=>{c===!1&&this.isSynced&&(this.whenSynced=l()),this.isSynced=c===void 0||c===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=l()}load(){const e=this._item;e!==null&&!this.shouldLoad&&Ae(e.parent.doc,t=>{t.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Ui(this.subdocs).map(e=>e.guid))}transact(e,t=null){return Ae(this,e,t)}get(e,t=nt){const r=rs(this.share,e,()=>{const s=new t;return s._integrate(this,null),s}),i=r.constructor;if(t!==nt&&i!==t)if(i===nt){const s=new t;s._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=r._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=r._length,this.share.set(e,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,jr)}getText(e=""){return this.get(e,rl)}getMap(e=""){return this.get(e,Wi)}getXmlElement(e=""){return this.get(e,to)}getXmlFragment(e=""){return this.get(e,Ki)}toJSON(){const e={};return this.share.forEach((t,r)=>{e[r]=t.toJSON()}),e}destroy(){this.isDestroyed=!0,Ui(this.subdocs).forEach(t=>t.destroy());const e=this._item;if(e!==null){this._item=null;const t=e.content;t.doc=new _o({guid:this.guid,...t.opts,shouldLoad:!1}),t.doc._item=e,Ae(e.parent.doc,r=>{const i=t.doc;e.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class R0{constructor(){this.restEncoder=Zd()}toUint8Array(){return In(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){Ee(this.restEncoder,e)}writeDsLen(e){Ee(this.restEncoder,e)}}class L0 extends R0{writeLeftID(e){Ee(this.restEncoder,e.client),Ee(this.restEncoder,e.clock)}writeRightID(e){Ee(this.restEncoder,e.client),Ee(this.restEncoder,e.clock)}writeClient(e){Ee(this.restEncoder,e)}writeInfo(e){ju(this.restEncoder,e)}writeString(e){Ni(this.restEncoder,e)}writeParentInfo(e){Ee(this.restEncoder,e?1:0)}writeTypeRef(e){Ee(this.restEncoder,e)}writeLen(e){Ee(this.restEncoder,e)}writeAny(e){Xs(this.restEncoder,e)}writeBuf(e){Tt(this.restEncoder,e)}writeJSON(e){Ni(this.restEncoder,JSON.stringify(e))}writeKey(e){Ni(this.restEncoder,e)}}class D0{constructor(){this.restEncoder=Zd(),this.dsCurrVal=0}toUint8Array(){return In(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const t=e-this.dsCurrVal;this.dsCurrVal=e,Ee(this.restEncoder,t)}writeDsLen(e){e===0&&Hr(),Ee(this.restEncoder,e-1),this.dsCurrVal+=e}}class j0 extends D0{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Jc,this.clientEncoder=new Ta,this.leftClockEncoder=new Jc,this.rightClockEncoder=new Jc,this.infoEncoder=new Fg(ju),this.stringEncoder=new QS,this.parentInfoEncoder=new Fg(ju),this.typeRefEncoder=new Ta,this.lenEncoder=new Ta}toUint8Array(){const e=Zd();return Ee(e,0),Tt(e,this.keyClockEncoder.toUint8Array()),Tt(e,this.clientEncoder.toUint8Array()),Tt(e,this.leftClockEncoder.toUint8Array()),Tt(e,this.rightClockEncoder.toUint8Array()),Tt(e,In(this.infoEncoder)),Tt(e,this.stringEncoder.toUint8Array()),Tt(e,In(this.parentInfoEncoder)),Tt(e,this.typeRefEncoder.toUint8Array()),Tt(e,this.lenEncoder.toUint8Array()),ef(e,In(this.restEncoder)),In(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){Xs(this.restEncoder,e)}writeBuf(e){Tt(this.restEncoder,e)}writeJSON(e){Xs(this.restEncoder,e)}writeKey(e){const t=this.keyMap.get(e);t===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(t)}}const F0=(n,e,t,r)=>{r=is(r,e[0].id.clock);const i=Dn(e,r);Ee(n.restEncoder,e.length-i),n.writeClient(t),Ee(n.restEncoder,r);const s=e[i];s.write(n,r-s.id.clock);for(let o=i+1;o<e.length;o++)e[o].write(n,0)},q0=(n,e,t)=>{const r=new Map;t.forEach((i,s)=>{xt(e,s)>i&&r.set(s,i)}),sf(e).forEach((i,s)=>{t.has(s)||r.set(s,0)}),Ee(n.restEncoder,r.size),Ui(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{F0(n,e.clients.get(i),i,s)})},B0=(n,e)=>q0(n,e.doc.store,e.beforeState);class U0{constructor(){this.l=[]}}const Kg=()=>new U0,Hg=(n,e)=>n.l.push(e),Jg=(n,e)=>{const t=n.l,r=t.length;n.l=t.filter(i=>e!==i),r===n.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},Q_=(n,e,t)=>nf(n.l,[e,t]);class Ea{constructor(e,t){this.client=e,this.clock=t}}const ra=(n,e)=>n===e||n!==null&&e!==null&&n.client===e.client&&n.clock===e.clock,Pe=(n,e)=>new Ea(n,e),z0=n=>{for(const[e,t]of n.doc.share.entries())if(t===n)return e;throw Hr()},ki=(n,e)=>e===void 0?!n.deleted:e.sv.has(n.id.client)&&(e.sv.get(n.id.client)||0)>n.id.clock&&!G_(e.ds,n.id),Bu=(n,e)=>{const t=rs(n.meta,Bu,Bi),r=n.doc.store;t.has(e)||(e.sv.forEach((i,s)=>{i<xt(r,s)&&ar(n,Pe(s,i))}),V_(n,e.ds,i=>{}),t.add(e))};class W0{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const sf=n=>{const e=new Map;return n.clients.forEach((t,r)=>{const i=t[t.length-1];e.set(r,i.id.clock+i.length)}),e},xt=(n,e)=>{const t=n.clients.get(e);if(t===void 0)return 0;const r=t[t.length-1];return r.id.clock+r.length},eb=(n,e)=>{let t=n.clients.get(e.id.client);if(t===void 0)t=[],n.clients.set(e.id.client,t);else{const r=t[t.length-1];if(r.id.clock+r.length!==e.id.clock)throw Hr()}t.push(e)},Dn=(n,e)=>{let t=0,r=n.length-1,i=n[r],s=i.id.clock;if(s===e)return r;let o=Kr(e/(s+i.length-1)*r);for(;t<=r;){if(i=n[o],s=i.id.clock,s<=e){if(e<s+i.length)return o;t=o+1}else r=o-1;o=Kr((t+r)/2)}throw Hr()},K0=(n,e)=>{const t=n.clients.get(e.client);return t[Dn(t,e.clock)]},Gc=K0,Uu=(n,e,t)=>{const r=Dn(e,t),i=e[r];return i.id.clock<t&&i instanceof ut?(e.splice(r+1,0,vb(n,i,t-i.id.clock)),r+1):r},ar=(n,e)=>{const t=n.doc.store.clients.get(e.client);return t[Uu(n,t,e.clock)]},Vg=(n,e,t)=>{const r=e.clients.get(t.client),i=Dn(r,t.clock),s=r[i];return t.clock!==s.id.clock+s.length-1&&s.constructor!==Vn&&r.splice(i+1,0,vb(n,s,t.clock-s.id.clock+1)),s},H0=(n,e,t)=>{const r=n.clients.get(e.id.client);r[Dn(r,e.id.clock)]=t},tb=(n,e,t,r,i)=>{if(r===0)return;const s=t+r;let o=Uu(n,e,t),a;do a=e[o++],s<a.id.clock+a.length&&Uu(n,e,s),i(a);while(o<e.length&&e[o].id.clock<s)};class J0{constructor(e,t,r){this.doc=e,this.deleteSet=new $0,this.beforeState=sf(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=t,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const Gg=(n,e)=>e.deleteSet.clients.size===0&&!MS(e.afterState,(t,r)=>e.beforeState.get(r)!==t)?!1:(Y_(e.deleteSet),B0(n,e),I0(n,e.deleteSet),!0),Yg=(n,e,t)=>{const r=e._item;(r===null||r.id.clock<(n.beforeState.get(r.id.client)||0)&&!r.deleted)&&rs(n.changed,e,Bi).add(t)},Na=(n,e)=>{let t=n[e],r=n[e-1],i=e;for(;i>0;t=r,r=n[--i-1]){if(r.deleted===t.deleted&&r.constructor===t.constructor&&r.mergeWith(t)){t instanceof ut&&t.parentSub!==null&&t.parent._map.get(t.parentSub)===t&&t.parent._map.set(t.parentSub,r);continue}break}const s=e-i;return s&&n.splice(e+1-s,s),s},V0=(n,e,t)=>{for(const[r,i]of n.clients.entries()){const s=e.clients.get(r);for(let o=i.length-1;o>=0;o--){const a=i[o],l=a.clock+a.len;for(let c=Dn(s,a.clock),u=s[c];c<s.length&&u.id.clock<l;u=s[++c]){const f=s[c];if(a.clock+a.len<=f.id.clock)break;f instanceof ut&&f.deleted&&!f.keep&&t(f)&&f.gc(e,!1)}}}},G0=(n,e)=>{n.clients.forEach((t,r)=>{const i=e.clients.get(r);for(let s=t.length-1;s>=0;s--){const o=t[s],a=R_(i.length-1,1+Dn(i,o.clock+o.len-1));for(let l=a,c=i[l];l>0&&c.id.clock>=o.clock;c=i[l])l-=1+Na(i,l)}})},nb=(n,e)=>{if(e<n.length){const t=n[e],r=t.doc,i=r.store,s=t.deleteSet,o=t._mergeStructs;try{Y_(s),t.afterState=sf(t.doc.store),r.emit("beforeObserverCalls",[t,r]);const a=[];t.changed.forEach((l,c)=>a.push(()=>{(c._item===null||!c._item.deleted)&&c._callObserver(t,l)})),a.push(()=>{t.changedParentTypes.forEach((l,c)=>{c._dEH.l.length>0&&(c._item===null||!c._item.deleted)&&(l=l.filter(u=>u.target._item===null||!u.target._item.deleted),l.forEach(u=>{u.currentTarget=c,u._path=null}),l.sort((u,f)=>u.path.length-f.path.length),Q_(c._dEH,l,t))})}),a.push(()=>r.emit("afterTransaction",[t,r])),nf(a,[]),t._needFormattingCleanup&&o1(t)}finally{r.gc&&V0(s,i,r.gcFilter),G0(s,i),t.afterState.forEach((u,f)=>{const d=t.beforeState.get(f)||0;if(d!==u){const h=i.clients.get(f),p=is(Dn(h,d),1);for(let m=h.length-1;m>=p;)m-=1+Na(h,m)}});for(let u=o.length-1;u>=0;u--){const{client:f,clock:d}=o[u].id,h=i.clients.get(f),p=Dn(h,d);p+1<h.length&&Na(h,p+1)>1||p>0&&Na(h,p)}if(!t.local&&t.afterState.get(r.clientID)!==t.beforeState.get(r.clientID)&&(N0(rf,U_,"[yjs] ",z_,W_,"Changed the client-id because another client seems to be using it."),r.clientID=Z_()),r.emit("afterTransactionCleanup",[t,r]),r._observers.has("update")){const u=new L0;Gg(u,t)&&r.emit("update",[u.toUint8Array(),t.origin,r,t])}if(r._observers.has("updateV2")){const u=new j0;Gg(u,t)&&r.emit("updateV2",[u.toUint8Array(),t.origin,r,t])}const{subdocsAdded:a,subdocsLoaded:l,subdocsRemoved:c}=t;(a.size>0||c.size>0||l.size>0)&&(a.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),c.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:l,added:a,removed:c},r,t]),c.forEach(u=>u.destroy())),n.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,n])):nb(n,e+1)}}},Ae=(n,e,t=null,r=!0)=>{const i=n._transactionCleanups;let s=!1,o=null;n._transaction===null&&(s=!0,n._transaction=new J0(n,t,r),i.push(n._transaction),i.length===1&&n.emit("beforeAllTransactions",[n]),n.emit("beforeTransaction",[n._transaction,n]));try{o=e(n._transaction)}finally{if(s){const a=n._transaction===i[0];n._transaction=null,a&&nb(i,0)}}return o},Xg="You must not compute changes after the event-handler fired.";class Nl{constructor(e,t){this.target=e,this.currentTarget=e,this.transaction=t,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=Y0(this.currentTarget,this.target))}deletes(e){return G_(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw zi(Xg);const e=new Map,t=this.target;this.transaction.changed.get(t).forEach(i=>{if(i!==null){const s=t._map.get(i);let o,a;if(this.adds(s)){let l=s.left;for(;l!==null&&this.adds(l);)l=l.left;if(this.deletes(s))if(l!==null&&this.deletes(l))o="delete",a=zc(l.content.getContent());else return;else l!==null&&this.deletes(l)?(o="update",a=zc(l.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=zc(s.content.getContent());else return;e.set(i,{action:o,oldValue:a})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw zi(Xg);const t=this.target,r=Bi(),i=Bi(),s=[];if(e={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(t).has(null)){let a=null;const l=()=>{a&&s.push(a)};for(let c=t._start;c!==null;c=c.right)c.deleted?this.deletes(c)&&!this.adds(c)&&((a===null||a.delete===void 0)&&(l(),a={delete:0}),a.delete+=c.length,i.add(c)):this.adds(c)?((a===null||a.insert===void 0)&&(l(),a={insert:[]}),a.insert=a.insert.concat(c.content.getContent()),r.add(c)):((a===null||a.retain===void 0)&&(l(),a={retain:0}),a.retain+=c.length);a!==null&&a.retain===void 0&&l()}this._changes=e}return e}}const Y0=(n,e)=>{const t=[];for(;e._item!==null&&e!==n;){if(e._item.parentSub!==null)t.unshift(e._item.parentSub);else{let r=0,i=e._item.parent._start;for(;i!==e._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;t.unshift(r)}e=e._item.parent}return t},ft=()=>{M0("Invalid access: Add Yjs type to a document before reading data.")},rb=80;let of=0;class X0{constructor(e,t){e.marker=!0,this.p=e,this.index=t,this.timestamp=of++}}const Z0=n=>{n.timestamp=of++},ib=(n,e,t)=>{n.p.marker=!1,n.p=e,e.marker=!0,n.index=t,n.timestamp=of++},Q0=(n,e,t)=>{if(n.length>=rb){const r=n.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return ib(r,e,t),r}else{const r=new X0(e,t);return n.push(r),r}},Ml=(n,e)=>{if(n._start===null||e===0||n._searchMarker===null)return null;const t=n._searchMarker.length===0?null:n._searchMarker.reduce((s,o)=>Sa(e-s.index)<Sa(e-o.index)?s:o);let r=n._start,i=0;for(t!==null&&(r=t.p,i=t.index,Z0(t));r.right!==null&&i<e;){if(!r.deleted&&r.countable){if(e<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>e;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return t!==null&&Sa(t.index-i)<r.parent.length/rb?(ib(t,r,i),t):Q0(n._searchMarker,r,i)},Qs=(n,e,t)=>{for(let r=n.length-1;r>=0;r--){const i=n[r];if(t>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){n.splice(r,1);continue}i.p=s,s.marker=!0}(e<i.index||t>0&&e===i.index)&&(i.index=is(e,i.index+t))}},Al=(n,e,t)=>{const r=n,i=e.changedParentTypes;for(;rs(i,n,()=>[]).push(t),n._item!==null;)n=n._item.parent;Q_(r._eH,t,e)};class nt{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Kg(),this._dEH=Kg(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,t){this.doc=e,this._item=t}_copy(){throw pn()}clone(){throw pn()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,t){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){Hg(this._eH,e)}observeDeep(e){Hg(this._dEH,e)}unobserve(e){Jg(this._eH,e)}unobserveDeep(e){Jg(this._dEH,e)}toJSON(){}}const sb=(n,e,t)=>{n.doc??ft(),e<0&&(e=n._length+e),t<0&&(t=n._length+t);let r=t-e;const i=[];let s=n._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=e)e-=o.length;else{for(let a=e;a<o.length&&r>0;a++)i.push(o[a]),r--;e=0}}s=s.right}return i},ob=n=>{n.doc??ft();const e=[];let t=n._start;for(;t!==null;){if(t.countable&&!t.deleted){const r=t.content.getContent();for(let i=0;i<r.length;i++)e.push(r[i])}t=t.right}return e},eo=(n,e)=>{let t=0,r=n._start;for(n.doc??ft();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)e(i[s],t++,n)}r=r.right}},ab=(n,e)=>{const t=[];return eo(n,(r,i)=>{t.push(e(r,i,n))}),t},e1=n=>{let e=n._start,t=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(t===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};t=e.content.getContent(),r=0,e=e.right}const i=t[r++];return t.length<=r&&(t=null),{done:!1,value:i}}}},lb=(n,e)=>{n.doc??ft();const t=Ml(n,e);let r=n._start;for(t!==null&&(r=t.p,e-=t.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},tl=(n,e,t,r)=>{let i=t;const s=n.doc,o=s.clientID,a=s.store,l=t===null?e._start:t.right;let c=[];const u=()=>{c.length>0&&(i=new ut(Pe(o,xt(a,o)),i,i&&i.lastId,l,l&&l.id,e,null,new Hi(c)),i.integrate(n,0),c=[])};r.forEach(f=>{if(f===null)c.push(f);else switch(f.constructor){case Number:case Object:case Boolean:case Array:case String:c.push(f);break;default:switch(u(),f.constructor){case Uint8Array:case ArrayBuffer:i=new ut(Pe(o,xt(a,o)),i,i&&i.lastId,l,l&&l.id,e,null,new Ol(new Uint8Array(f))),i.integrate(n,0);break;case _o:i=new ut(Pe(o,xt(a,o)),i,i&&i.lastId,l,l&&l.id,e,null,new $l(f)),i.integrate(n,0);break;default:if(f instanceof nt)i=new ut(Pe(o,xt(a,o)),i,i&&i.lastId,l,l&&l.id,e,null,new yr(f)),i.integrate(n,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},cb=()=>zi("Length exceeded!"),ub=(n,e,t,r)=>{if(t>e._length)throw cb();if(t===0)return e._searchMarker&&Qs(e._searchMarker,t,r.length),tl(n,e,null,r);const i=t,s=Ml(e,t);let o=e._start;for(s!==null&&(o=s.p,t-=s.index,t===0&&(o=o.prev,t+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(t<=o.length){t<o.length&&ar(n,Pe(o.id.client,o.id.clock+t));break}t-=o.length}return e._searchMarker&&Qs(e._searchMarker,i,r.length),tl(n,e,o,r)},t1=(n,e,t)=>{let i=(e._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:e._start}).p;if(i)for(;i.right;)i=i.right;return tl(n,e,i,t)},db=(n,e,t,r)=>{if(r===0)return;const i=t,s=r,o=Ml(e,t);let a=e._start;for(o!==null&&(a=o.p,t-=o.index);a!==null&&t>0;a=a.right)!a.deleted&&a.countable&&(t<a.length&&ar(n,Pe(a.id.client,a.id.clock+t)),t-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&ar(n,Pe(a.id.client,a.id.clock+r)),a.delete(n),r-=a.length),a=a.right;if(r>0)throw cb();e._searchMarker&&Qs(e._searchMarker,i,-s+r)},nl=(n,e,t)=>{const r=e._map.get(t);r!==void 0&&r.delete(n)},af=(n,e,t,r)=>{const i=e._map.get(t)||null,s=n.doc,o=s.clientID;let a;if(r==null)a=new Hi([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:a=new Hi([r]);break;case Uint8Array:a=new Ol(r);break;case _o:a=new $l(r);break;default:if(r instanceof nt)a=new yr(r);else throw new Error("Unexpected content type")}new ut(Pe(o,xt(s.store,o)),i,i&&i.lastId,null,null,e,t,a).integrate(n,0)},lf=(n,e)=>{n.doc??ft();const t=n._map.get(e);return t!==void 0&&!t.deleted?t.content.getContent()[t.length-1]:void 0},fb=n=>{const e={};return n.doc??ft(),n._map.forEach((t,r)=>{t.deleted||(e[r]=t.content.getContent()[t.length-1])}),e},hb=(n,e)=>{n.doc??ft();const t=n._map.get(e);return t!==void 0&&!t.deleted},n1=(n,e)=>{const t={};return n._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!e.sv.has(s.id.client)||s.id.clock>=(e.sv.get(s.id.client)||0));)s=s.left;s!==null&&ki(s,e)&&(t[i]=s.content.getContent()[s.length-1])}),t},ia=n=>(n.doc??ft(),A0(n._map.entries(),e=>!e[1].deleted));class gb extends Nl{}class jr extends nt{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const t=new jr;return t.push(e),t}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new jr}clone(){const e=new jr;return e.insert(0,this.toArray().map(t=>t instanceof nt?t.clone():t)),e}get length(){return this.doc??ft(),this._length}_callObserver(e,t){super._callObserver(e,t),Al(this,e,new gb(this,e))}insert(e,t){this.doc!==null?Ae(this.doc,r=>{ub(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}push(e){this.doc!==null?Ae(this.doc,t=>{t1(t,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,t=1){this.doc!==null?Ae(this.doc,r=>{db(r,this,e,t)}):this._prelimContent.splice(e,t)}get(e){return lb(this,e)}toArray(){return ob(this)}slice(e=0,t=this.length){return sb(this,e,t)}toJSON(){return this.map(e=>e instanceof nt?e.toJSON():e)}map(e){return ab(this,e)}forEach(e){eo(this,e)}[Symbol.iterator](){return e1(this)}_write(e){e.writeTypeRef(f1)}}class r1 extends Nl{constructor(e,t,r){super(e,t),this.keysChanged=r}}class Wi extends nt{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,t){super._integrate(e,t),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new Wi}clone(){const e=new Wi;return this.forEach((t,r)=>{e.set(r,t instanceof nt?t.clone():t)}),e}_callObserver(e,t){Al(this,e,new r1(this,e,t))}toJSON(){this.doc??ft();const e={};return this._map.forEach((t,r)=>{if(!t.deleted){const i=t.content.getContent()[t.length-1];e[r]=i instanceof nt?i.toJSON():i}}),e}get size(){return[...ia(this)].length}keys(){return Vc(ia(this),e=>e[0])}values(){return Vc(ia(this),e=>e[1].content.getContent()[e[1].length-1])}entries(){return Vc(ia(this),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this.doc??ft(),this._map.forEach((t,r)=>{t.deleted||e(t.content.getContent()[t.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?Ae(this.doc,t=>{nl(t,this,e)}):this._prelimContent.delete(e)}set(e,t){return this.doc!==null?Ae(this.doc,r=>{af(r,this,e,t)}):this._prelimContent.set(e,t),t}get(e){return lf(this,e)}has(e){return hb(this,e)}clear(){this.doc!==null?Ae(this.doc,e=>{this.forEach(function(t,r,i){nl(e,i,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(h1)}}const Zn=(n,e)=>n===e||typeof n=="object"&&typeof e=="object"&&n&&e&&f0(n,e);class zu{constructor(e,t,r,i){this.left=e,this.right=t,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&Hr(),this.right.content.constructor){case Je:this.right.deleted||ss(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Zg=(n,e,t)=>{for(;e.right!==null&&t>0;){switch(e.right.content.constructor){case Je:e.right.deleted||ss(e.currentAttributes,e.right.content);break;default:e.right.deleted||(t<e.right.length&&ar(n,Pe(e.right.id.client,e.right.id.clock+t)),e.index+=e.right.length,t-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},sa=(n,e,t,r)=>{const i=new Map,s=r?Ml(e,t):null;if(s){const o=new zu(s.p.left,s.p,s.index,i);return Zg(n,o,t-s.index)}else{const o=new zu(null,e._start,0,i);return Zg(n,o,t)}},pb=(n,e,t,r)=>{for(;t.right!==null&&(t.right.deleted===!0||t.right.content.constructor===Je&&Zn(r.get(t.right.content.key),t.right.content.value));)t.right.deleted||r.delete(t.right.content.key),t.forward();const i=n.doc,s=i.clientID;r.forEach((o,a)=>{const l=t.left,c=t.right,u=new ut(Pe(s,xt(i.store,s)),l,l&&l.lastId,c,c&&c.id,e,null,new Je(a,o));u.integrate(n,0),t.right=u,t.forward()})},ss=(n,e)=>{const{key:t,value:r}=e;r===null?n.delete(t):n.set(t,r)},mb=(n,e)=>{for(;n.right!==null;){if(!(n.right.deleted||n.right.content.constructor===Je&&Zn(e[n.right.content.key]??null,n.right.content.value)))break;n.forward()}},yb=(n,e,t,r)=>{const i=n.doc,s=i.clientID,o=new Map;for(const a in r){const l=r[a],c=t.currentAttributes.get(a)??null;if(!Zn(c,l)){o.set(a,c);const{left:u,right:f}=t;t.right=new ut(Pe(s,xt(i.store,s)),u,u&&u.lastId,f,f&&f.id,e,null,new Je(a,l)),t.right.integrate(n,0),t.forward()}}return o},Yc=(n,e,t,r,i)=>{t.currentAttributes.forEach((d,h)=>{i[h]===void 0&&(i[h]=null)});const s=n.doc,o=s.clientID;mb(t,i);const a=yb(n,e,t,i),l=r.constructor===String?new jn(r):r instanceof nt?new yr(r):new os(r);let{left:c,right:u,index:f}=t;e._searchMarker&&Qs(e._searchMarker,t.index,l.getLength()),u=new ut(Pe(o,xt(s.store,o)),c,c&&c.lastId,u,u&&u.id,e,null,l),u.integrate(n,0),t.right=u,t.index=f,t.forward(),pb(n,e,t,a)},Qg=(n,e,t,r,i)=>{const s=n.doc,o=s.clientID;mb(t,i);const a=yb(n,e,t,i);e:for(;t.right!==null&&(r>0||a.size>0&&(t.right.deleted||t.right.content.constructor===Je));){if(!t.right.deleted)switch(t.right.content.constructor){case Je:{const{key:l,value:c}=t.right.content,u=i[l];if(u!==void 0){if(Zn(u,c))a.delete(l);else{if(r===0)break e;a.set(l,c)}t.right.delete(n)}else t.currentAttributes.set(l,c);break}default:r<t.right.length&&ar(n,Pe(t.right.id.client,t.right.id.clock+r)),r-=t.right.length;break}t.forward()}if(r>0){let l="";for(;r>0;r--)l+=`
`;t.right=new ut(Pe(o,xt(s.store,o)),t.left,t.left&&t.left.lastId,t.right,t.right&&t.right.id,e,null,new jn(l)),t.right.integrate(n,0),t.forward()}pb(n,e,t,a)},_b=(n,e,t,r,i)=>{let s=e;const o=gn();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===Je){const c=s.content;o.set(c.key,c)}s=s.right}let a=0,l=!1;for(;e!==s;){if(t===e&&(l=!0),!e.deleted){const c=e.content;switch(c.constructor){case Je:{const{key:u,value:f}=c,d=r.get(u)??null;(o.get(u)!==c||d===f)&&(e.delete(n),a++,!l&&(i.get(u)??null)===f&&d!==f&&(d===null?i.delete(u):i.set(u,d))),!l&&!e.deleted&&ss(i,c);break}}}e=e.right}return a},i1=(n,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const t=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===Je){const r=e.content.key;t.has(r)?e.delete(n):t.add(r)}e=e.left}},s1=n=>{let e=0;return Ae(n.doc,t=>{let r=n._start,i=n._start,s=gn();const o=Du(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case Je:ss(o,i.content);break;default:e+=_b(t,r,i,s,o),s=Du(o),r=i;break}i=i.right}}),e},o1=n=>{const e=new Set,t=n.doc;for(const[r,i]of n.afterState.entries()){const s=n.beforeState.get(r)||0;i!==s&&tb(n,t.store.clients.get(r),s,i,o=>{!o.deleted&&o.content.constructor===Je&&o.constructor!==Vn&&e.add(o.parent)})}Ae(t,r=>{V_(n,n.deleteSet,i=>{if(i instanceof Vn||!i.parent._hasFormatting||e.has(i.parent))return;const s=i.parent;i.content.constructor===Je?e.add(s):i1(r,i)});for(const i of e)s1(i)})},ep=(n,e,t)=>{const r=t,i=Du(e.currentAttributes),s=e.right;for(;t>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case yr:case os:case jn:t<e.right.length&&ar(n,Pe(e.right.id.client,e.right.id.clock+t)),t-=e.right.length,e.right.delete(n);break}e.forward()}s&&_b(n,s,e.right,i,e.currentAttributes);const o=(e.left||e.right).parent;return o._searchMarker&&Qs(o._searchMarker,e.index,-r+t),e};class a1 extends Nl{constructor(e,t,r){super(e,t),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,t=[];Ae(e,r=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const l={};let c="",u=0,f=0;const d=()=>{if(a!==null){let h=null;switch(a){case"delete":f>0&&(h={delete:f}),f=0;break;case"insert":(typeof c=="object"||c.length>0)&&(h={insert:c},i.size>0&&(h.attributes={},i.forEach((p,m)=>{p!==null&&(h.attributes[m]=p)}))),c="";break;case"retain":u>0&&(h={retain:u},c0(l)||(h.attributes=o0({},l))),u=0;break}h&&t.push(h),a=null}};for(;o!==null;){switch(o.content.constructor){case yr:case os:this.adds(o)?this.deletes(o)||(d(),a="insert",c=o.content.getContent()[0],d()):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),f+=1):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=1);break;case jn:this.adds(o)?this.deletes(o)||(a!=="insert"&&(d(),a="insert"),c+=o.content.str):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),f+=o.length):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=o.length);break;case Je:{const{key:h,value:p}=o.content;if(this.adds(o)){if(!this.deletes(o)){const m=i.get(h)??null;Zn(m,p)?p!==null&&o.delete(r):(a==="retain"&&d(),Zn(p,s.get(h)??null)?delete l[h]:l[h]=p)}}else if(this.deletes(o)){s.set(h,p);const m=i.get(h)??null;Zn(m,p)||(a==="retain"&&d(),l[h]=m)}else if(!o.deleted){s.set(h,p);const m=l[h];m!==void 0&&(Zn(m,p)?m!==null&&o.delete(r):(a==="retain"&&d(),p===null?delete l[h]:l[h]=p))}o.deleted||(a==="insert"&&d(),ss(i,o.content));break}}o=o.right}for(d();t.length>0;){const h=t[t.length-1];if(h.retain!==void 0&&h.attributes===void 0)t.pop();else break}}),this._delta=t}return this._delta}}class rl extends nt{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??ft(),this._length}_integrate(e,t){super._integrate(e,t);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new rl}clone(){const e=new rl;return e.applyDelta(this.toDelta()),e}_callObserver(e,t){super._callObserver(e,t);const r=new a1(this,e,t);Al(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){this.doc??ft();let e="",t=this._start;for(;t!==null;)!t.deleted&&t.countable&&t.content.constructor===jn&&(e+=t.content.str),t=t.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:t=!0}={}){this.doc!==null?Ae(this.doc,r=>{const i=new zu(null,this._start,0,new Map);for(let s=0;s<e.length;s++){const o=e[s];if(o.insert!==void 0){const a=!t&&typeof o.insert=="string"&&s===e.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&Yc(r,this,i,a,o.attributes||{})}else o.retain!==void 0?Qg(r,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&ep(r,i,o.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,t,r){this.doc??ft();const i=[],s=new Map,o=this.doc;let a="",l=this._start;function c(){if(a.length>0){const f={};let d=!1;s.forEach((p,m)=>{d=!0,f[m]=p});const h={insert:a};d&&(h.attributes=f),i.push(h),a=""}}const u=()=>{for(;l!==null;){if(ki(l,e)||t!==void 0&&ki(l,t))switch(l.content.constructor){case jn:{const f=s.get("ychange");e!==void 0&&!ki(l,e)?(f===void 0||f.user!==l.id.client||f.type!=="removed")&&(c(),s.set("ychange",r?r("removed",l.id):{type:"removed"})):t!==void 0&&!ki(l,t)?(f===void 0||f.user!==l.id.client||f.type!=="added")&&(c(),s.set("ychange",r?r("added",l.id):{type:"added"})):f!==void 0&&(c(),s.delete("ychange")),a+=l.content.str;break}case yr:case os:{c();const f={insert:l.content.getContent()[0]};if(s.size>0){const d={};f.attributes=d,s.forEach((h,p)=>{d[p]=h})}i.push(f);break}case Je:ki(l,e)&&(c(),ss(s,l.content));break}l=l.right}c()};return e||t?Ae(o,f=>{e&&Bu(f,e),t&&Bu(f,t),u()},"cleanup"):u(),i}insert(e,t,r){if(t.length<=0)return;const i=this.doc;i!==null?Ae(i,s=>{const o=sa(s,this,e,!r);r||(r={},o.currentAttributes.forEach((a,l)=>{r[l]=a})),Yc(s,this,o,t,r)}):this._pending.push(()=>this.insert(e,t,r))}insertEmbed(e,t,r){const i=this.doc;i!==null?Ae(i,s=>{const o=sa(s,this,e,!r);Yc(s,this,o,t,r||{})}):this._pending.push(()=>this.insertEmbed(e,t,r||{}))}delete(e,t){if(t===0)return;const r=this.doc;r!==null?Ae(r,i=>{ep(i,sa(i,this,e,!0),t)}):this._pending.push(()=>this.delete(e,t))}format(e,t,r){if(t===0)return;const i=this.doc;i!==null?Ae(i,s=>{const o=sa(s,this,e,!1);o.right!==null&&Qg(s,this,o,t,r)}):this._pending.push(()=>this.format(e,t,r))}removeAttribute(e){this.doc!==null?Ae(this.doc,t=>{nl(t,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,t){this.doc!==null?Ae(this.doc,r=>{af(r,this,e,t)}):this._pending.push(()=>this.setAttribute(e,t))}getAttribute(e){return lf(this,e)}getAttributes(){return fb(this)}_write(e){e.writeTypeRef(g1)}}class Xc{constructor(e,t=()=>!0){this._filter=t,this._root=e,this._currentNode=e._start,this._firstCall=!0,e.doc??ft()}[Symbol.iterator](){return this}next(){let e=this._currentNode,t=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(t)))do if(t=e.content.type,!e.deleted&&(t.constructor===to||t.constructor===Ki)&&t._start!==null)e=t._start;else for(;e!==null;){const r=e.next;if(r!==null){e=r;break}else e.parent===this._root?e=null:e=e.parent._item}while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class Ki extends nt{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Ki}clone(){const e=new Ki;return e.insert(0,this.toArray().map(t=>t instanceof nt?t.clone():t)),e}get length(){return this.doc??ft(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new Xc(this,e)}querySelector(e){e=e.toUpperCase();const r=new Xc(this,i=>i.nodeName&&i.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),Ui(new Xc(this,t=>t.nodeName&&t.nodeName.toUpperCase()===e))}_callObserver(e,t){Al(this,e,new l1(this,t,e))}toString(){return ab(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,t={},r){const i=e.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),eo(this,s=>{i.insertBefore(s.toDOM(e,t,r),null)}),i}insert(e,t){this.doc!==null?Ae(this.doc,r=>{ub(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}insertAfter(e,t){if(this.doc!==null)Ae(this.doc,r=>{const i=e&&e instanceof nt?e._item:e;tl(r,this,i,t)});else{const r=this._prelimContent,i=e===null?0:r.findIndex(s=>s===e)+1;if(i===0&&e!==null)throw zi("Reference item not found");r.splice(i,0,...t)}}delete(e,t=1){this.doc!==null?Ae(this.doc,r=>{db(r,this,e,t)}):this._prelimContent.splice(e,t)}toArray(){return ob(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return lb(this,e)}slice(e=0,t=this.length){return sb(this,e,t)}forEach(e){eo(this,e)}_write(e){e.writeTypeRef(m1)}}class to extends Ki{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,t){super._integrate(e,t),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new to(this.nodeName)}clone(){const e=new to(this.nodeName),t=this.getAttributes();return l0(t,(r,i)=>{typeof r=="string"&&e.setAttribute(i,r)}),e.insert(0,this.toArray().map(r=>r instanceof nt?r.clone():r)),e}toString(){const e=this.getAttributes(),t=[],r=[];for(const a in e)r.push(a);r.sort();const i=r.length;for(let a=0;a<i;a++){const l=r[a];t.push(l+'="'+e[l]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=t.length>0?" "+t.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(e){this.doc!==null?Ae(this.doc,t=>{nl(t,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,t){this.doc!==null?Ae(this.doc,r=>{af(r,this,e,t)}):this._prelimAttrs.set(e,t)}getAttribute(e){return lf(this,e)}hasAttribute(e){return hb(this,e)}getAttributes(e){return e?n1(this,e):fb(this)}toDOM(e=document,t={},r){const i=e.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return eo(this,o=>{i.appendChild(o.toDOM(e,t,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(e){e.writeTypeRef(p1),e.writeKey(this.nodeName)}}class l1 extends Nl{constructor(e,t,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,t.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class bb{constructor(e,t){this.id=e,this.length=t}get deleted(){throw pn()}mergeWith(e){return!1}write(e,t,r){throw pn()}integrate(e,t){throw pn()}}const c1=0;class Vn extends bb{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){t>0&&(this.id.clock+=t,this.length-=t),eb(e.doc.store,this)}write(e,t){e.writeInfo(c1),e.writeLen(this.length-t)}getMissing(e,t){return null}}class Ol{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Ol(this.content)}splice(e){throw pn()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeBuf(this.content)}getRef(){return 3}}class il{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new il(this.len)}splice(e){const t=new il(this.len-e);return this.len=e,t}mergeWith(e){return this.len+=e.len,!0}integrate(e,t){X_(e.deleteSet,t.id.client,t.id.clock,this.len),t.markDeleted()}delete(e){}gc(e){}write(e,t){e.writeLen(this.len-t)}getRef(){return 1}}const u1=(n,e)=>new _o({guid:n,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class $l{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const t={};this.opts=t,e.gc||(t.gc=!1),e.autoLoad&&(t.autoLoad=!0),e.meta!==null&&(t.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new $l(u1(this.doc.guid,this.opts))}splice(e){throw pn()}mergeWith(e){return!1}integrate(e,t){this.doc._item=t,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,t){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}class os{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new os(this.embed)}splice(e){throw pn()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeJSON(this.embed)}getRef(){return 5}}class Je{constructor(e,t){this.key=e,this.value=t}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Je(this.key,this.value)}splice(e){throw pn()}mergeWith(e){return!1}integrate(e,t){const r=t.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,t){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const d1=el("node_env")==="development";class Hi{constructor(e){this.arr=e,d1&&F_(e)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Hi(this.arr)}splice(e){const t=new Hi(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){const r=this.arr.length;e.writeLen(r-t);for(let i=t;i<r;i++){const s=this.arr[i];e.writeAny(s)}}getRef(){return 8}}class jn{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new jn(this.str)}splice(e){const t=new jn(this.str.slice(e));this.str=this.str.slice(0,e);const r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"�",t.str="�"+t.str.slice(1)),t}mergeWith(e){return this.str+=e.str,!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeString(t===0?this.str:this.str.slice(t))}getRef(){return 4}}const f1=0,h1=1,g1=2,p1=3,m1=4;class yr{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new yr(this.type._copy())}splice(e){throw pn()}mergeWith(e){return!1}integrate(e,t){this.type._integrate(e.doc,t)}delete(e){let t=this.type._start;for(;t!==null;)t.deleted?t.id.clock<(e.beforeState.get(t.id.client)||0)&&e._mergeStructs.push(t):t.delete(e),t=t.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let t=this.type._start;for(;t!==null;)t.gc(e,!0),t=t.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,t){this.type._write(e)}getRef(){return 7}}const vb=(n,e,t)=>{const{client:r,clock:i}=e.id,s=new ut(Pe(r,i+t),e,Pe(r,i+t-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(t));return e.deleted&&s.markDeleted(),e.keep&&(s.keep=!0),e.redone!==null&&(s.redone=Pe(e.redone.client,e.redone.clock+t)),e.right=s,s.right!==null&&(s.right.left=s),n._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),e.length=t,s};class ut extends bb{constructor(e,t,r,i,s,o,a,l){super(e,l.getLength()),this.origin=r,this.left=t,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=l,this.info=this.content.isCountable()?Rg:0}set marker(e){(this.info&Kc)>0!==e&&(this.info^=Kc)}get marker(){return(this.info&Kc)>0}get keep(){return(this.info&Ig)>0}set keep(e){this.keep!==e&&(this.info^=Ig)}get countable(){return(this.info&Rg)>0}get deleted(){return(this.info&Wc)>0}set deleted(e){this.deleted!==e&&(this.info^=Wc)}markDeleted(){this.info|=Wc}getMissing(e,t){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=xt(t,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=xt(t,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Ea&&this.id.client!==this.parent.client&&this.parent.clock>=xt(t,this.parent.client))return this.parent.client;if(this.origin&&(this.left=Vg(e,t,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=ar(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===Vn||this.right&&this.right.constructor===Vn)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===ut?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===ut&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Ea){const r=Gc(t,this.parent);r.constructor===Vn?this.parent=null:this.parent=r.content.type}return null}integrate(e,t){if(t>0&&(this.id.clock+=t,this.left=Vg(e,e.doc.store,Pe(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(t),this.length-=t),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),ra(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(ra(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(Gc(e.doc.store,i.origin)))s.has(Gc(e.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),eb(e.doc.store,this),this.content.integrate(e,this),Yg(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new Vn(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:Pe(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&ra(e.origin,this.lastId)&&this.right===e&&ra(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const t=this.parent._searchMarker;return t&&t.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const t=this.parent;this.countable&&this.parentSub===null&&(t._length-=this.length),this.markDeleted(),X_(e.deleteSet,this.id.client,this.id.clock,this.length),Yg(e,t,this.parentSub),this.content.delete(e)}}gc(e,t){if(!this.deleted)throw Hr();this.content.gc(e),t?H0(e,this,new Vn(this.id,this.length)):this.content=new il(this.length)}write(e,t){const r=t>0?Pe(this.id.client,this.id.clock+t-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&IS|(r===null?0:Qa)|(i===null?0:L_)|(s===null?0:PS);if(e.writeInfo(o),r!==null&&e.writeLeftID(r),i!==null&&e.writeRightID(i),r===null&&i===null){const a=this.parent;if(a._item!==void 0){const l=a._item;if(l===null){const c=z0(a);e.writeParentInfo(!0),e.writeString(c)}else e.writeParentInfo(!1),e.writeLeftID(l.id)}else a.constructor===String?(e.writeParentInfo(!0),e.writeString(a)):a.constructor===Ea?(e.writeParentInfo(!1),e.writeLeftID(a)):Hr();s!==null&&e.writeString(s)}this.content.write(e,t)}}const kb=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},xb="__ $YJS$ __";kb[xb]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");kb[xb]=!0;const y1=ie("TOGGLE_CONNECT_COMMAND");var _1=Object.defineProperty,b1=(n,e,t)=>e in n?_1(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Q=(n,e,t)=>b1(n,typeof e!="symbol"?e+"":e,t);const Zc=n=>Me(hy(n)),lr=Nm("cid",{parse:n=>typeof n=="string"?n:void 0}),Ji=Nm("segment",{parse:n=>typeof n=="string"?n:void 0}),Wu="unknown",Cb=1;class ri extends ht{constructor(e="",t="",r,i){super(i),Q(this,"__tag"),Q(this,"__marker"),Q(this,"__unknownAttributes"),this.__tag=e,this.__marker=t,this.__unknownAttributes=r}static getType(){return"unknown"}static clone(e){const{__tag:t,__marker:r,__unknownAttributes:i,__key:s}=e;return new ri(t,r,i,s)}static importDOM(){return{[Wu]:e=>k1(e)?{conversion:v1,priority:1}:null}}static importJSON(e){return wb().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setTag(e.tag).setMarker(e.marker).setUnknownAttributes(e.unknownAttributes)}setTag(e){if(this.__tag===e)return this;const t=this.getWritable();return t.__tag=e,t}getTag(){return this.getLatest().__tag}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement(Wu);return e.style.display="none",e}updateDOM(){return!1}exportDOM(){return{element:null}}exportJSON(){return{...super.exportJSON(),type:this.getType(),tag:this.getTag(),marker:this.getMarker(),unknownAttributes:this.getUnknownAttributes(),version:Cb}}canBeEmpty(){return!0}isInline(){return!0}extractWithChild(){return!1}excludeFromCopy(e){return e!=="clone"}}function v1(n){const e=n.getAttribute("data-tag")??"",t=n.getAttribute("data-marker")??"";return{node:wb(e,t)}}function wb(n,e,t){return Me(new ri(n,e,t))}function k1(n){return(n==null?void 0:n.tagName)===Wu}function bo(n){return n instanceof ri}const Pl="id",Sb=1;class Ft extends ht{constructor(e="",t,r){super(r),Q(this,"__marker",Pl),Q(this,"__code"),Q(this,"__unknownAttributes"),this.__code=e,this.__unknownAttributes=t}static getType(){return"book"}static clone(e){const{__code:t,__unknownAttributes:r,__key:i}=e;return new Ft(t,r,i)}static importJSON(e){const{code:t}=e;return Tb(t).updateFromJSON(e)}static isValidBookCode(e){return Pv(e)}updateFromJSON(e){return super.updateFromJSON(e).setCode(e.code).setUnknownAttributes(e.unknownAttributes)}getMarker(){return this.getLatest().__marker}setCode(e){if(this.__code===e)return this;const t=this.getWritable();return t.__code=e,t}getCode(){return this.getLatest().__code}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("p");return e.setAttribute("data-marker",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`),e.setAttribute("data-code",this.__code),e}updateDOM(){return!1}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),code:this.getCode(),unknownAttributes:this.getUnknownAttributes(),version:Sb}}}function Tb(n,e){return Me(new Ft(n,e))}function mn(n){return n instanceof Ft}function x1(n){return(n==null?void 0:n.type)===Ft.getType()}const Ne=" ",Ku="​",cf=`${Ne}|`,uf="p",Jr="+",df="-",sl="chapter",Hu="verse",tp="invalid",C1="text-spacing",w1="formatted-font",S1="marker-",ff="external-usj-mutation",Eb="selection-change",Ju="cursor-change",Vu="annotation-change",Gu="delta-change",T1=[ff,Eb,Ju,Vu,Gu],hf="c",Nb=1;class en extends ht{constructor(e="",t,r,i,s,o){super(o),Q(this,"__marker"),Q(this,"__number"),Q(this,"__sid"),Q(this,"__altnumber"),Q(this,"__pubnumber"),Q(this,"__unknownAttributes"),this.__marker=hf,this.__number=e,this.__sid=t,this.__altnumber=r,this.__pubnumber=i,this.__unknownAttributes=s}static getType(){return"chapter"}static clone(e){const{__number:t,__sid:r,__altnumber:i,__pubnumber:s,__unknownAttributes:o,__key:a}=e;return new en(t,r,i,s,o,a)}static importJSON(e){return Mb().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setNumber(e.number).setSid(e.sid).setAltnumber(e.altnumber).setPubnumber(e.pubnumber).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}setNumber(e){if(this.__number===e)return this;const t=this.getWritable();return t.__number=e,t}getNumber(){return this.getLatest().__number}setSid(e){if(this.__sid===e)return this;const t=this.getWritable();return t.__sid=e,t}getSid(){return this.getLatest().__sid}setAltnumber(e){if(this.__altnumber===e)return this;const t=this.getWritable();return t.__altnumber=e,t}getAltnumber(){return this.getLatest().__altnumber}setPubnumber(e){if(this.__pubnumber===e)return this;const t=this.getWritable();return t.__pubnumber=e,t}getPubnumber(){return this.getLatest().__pubnumber}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("p");return e.setAttribute("data-marker",this.__marker),e.classList.add(sl,`usfm_${this.__marker}`),e.setAttribute("data-number",this.__number),e}updateDOM(){return!1}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),number:this.getNumber(),sid:this.getSid(),altnumber:this.getAltnumber(),pubnumber:this.getPubnumber(),unknownAttributes:this.getUnknownAttributes(),version:Nb}}}function Mb(n,e,t,r,i){return Me(new en(n,e,t,r,i))}function gf(n){return n instanceof en}function E1(n){return(n==null?void 0:n.type)===en.getType()}const Ab=["fr","fq","fqa","fk","ft","fl","fw","fp","fv","fdc","fm"],Ob=["xo","xop","xk","xq","xt","xta","xot","xnt","xdc"],N1=["ca","cp","va","vp","add","bk","dc","em","jmp","k","nd","ord","pn","png","qt","rb","rq","sig","sls","tl","w","wa","wg","wh","wj","bd","it","bdit","no","sc","sup","ior","iqt","qac","qs","litl","lik","liv","liv1","liv2","liv3","liv4","liv5",...Ab,...Ob],$b=1;class Re extends ht{constructor(e="",t,r){super(r),Q(this,"__marker"),Q(this,"__unknownAttributes"),this.__marker=e,this.__unknownAttributes=t}static getType(){return"char"}static clone(e){const{__marker:t,__unknownAttributes:r,__key:i}=e;return new Re(t,r,i)}static isValidMarker(e){return e!==void 0&&N1.includes(e)}static isValidFootnoteMarker(e){return e!==void 0&&Ab.includes(e)}static isValidCrossReferenceMarker(e){return e!==void 0&&Ob.includes(e)}static importDOM(){return{span:e=>A1(e)?{conversion:M1,priority:1}:null}}static importJSON(e){return dn().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("span");return e.setAttribute("data-marker",this.__marker),e.setAttribute("title",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`),e}updateDOM(){return!1}exportDOM(e){const{element:t}=super.exportDOM(e);return t&&Te(t)&&(t.setAttribute("data-marker",this.getMarker()),t.classList.add(this.getType(),`usfm_${this.getMarker()}`)),{element:t}}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),unknownAttributes:this.getUnknownAttributes(),version:$b}}insertNewAfter(e,t){const r=dn(this.getMarker());return r.setTextFormat(e.format),r.setTextStyle(e.style),r.setDirection(this.getDirection()),r.setFormat(this.getFormatType()),r.setStyle(this.getTextStyle()),this.insertAfter(r,t),r}canBeEmpty(){return!1}isInline(){return!0}}function M1(n){const e=n.getAttribute("data-marker")??"f";return{node:dn(e)}}function dn(n,e){return Me(new Re(n,e))}function A1(n){if(!n)return!1;const e=n.getAttribute("data-marker")??"";return Re.isValidMarker(e)&&n.classList.contains(Re.getType())}function Ie(n){return n instanceof Re}function O1(n){return(n==null?void 0:n.type)===Re.getType()}const Pb=1,$1="c",Ib="span";class Un extends pr{constructor(e="",t=!1,r,i,s,o,a){super(a),Q(this,"__marker"),Q(this,"__number"),Q(this,"__showMarker"),Q(this,"__sid"),Q(this,"__altnumber"),Q(this,"__pubnumber"),Q(this,"__unknownAttributes"),this.__marker=$1,this.__number=e,this.__showMarker=t,this.__sid=r,this.__altnumber=i,this.__pubnumber=s,this.__unknownAttributes=o}static getType(){return"immutable-chapter"}static clone(e){const{__number:t,__showMarker:r,__sid:i,__altnumber:s,__pubnumber:o,__unknownAttributes:a,__key:l}=e;return new Un(t,r,i,s,o,a,l)}static importDOM(){return{span:e=>Rb(e)?{conversion:P1,priority:1}:null}}static importJSON(e){return pf().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setNumber(e.number).setShowMarker(e.showMarker).setSid(e.sid).setAltnumber(e.altnumber).setPubnumber(e.pubnumber).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}setNumber(e){if(this.__number===e)return this;const t=this.getWritable();return t.__number=e,t}getNumber(){return this.getLatest().__number}setShowMarker(e=!1){if(this.__showMarker===e)return this;const t=this.getWritable();return t.__showMarker=e,t}getShowMarker(){return this.getLatest().__showMarker}setSid(e){if(this.__sid===e)return this;const t=this.getWritable();return t.__sid=e,t}getSid(){return this.getLatest().__sid}setAltnumber(e){if(this.__altnumber===e)return this;const t=this.getWritable();return t.__altnumber=e,t}getAltnumber(){return this.getLatest().__altnumber}setPubnumber(e){if(this.__pubnumber===e)return this;const t=this.getWritable();return t.__pubnumber=e,t}getPubnumber(){return this.getLatest().__pubnumber}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement(Ib);return e.setAttribute("data-marker",this.__marker),e.classList.add(sl,`usfm_${this.__marker}`),this.__showMarker&&e.classList.add("marker"),e.setAttribute("data-number",this.__number),e}updateDOM(){return!1}exportDOM(e){const{element:t}=super.exportDOM(e);return t&&Te(t)&&(t.setAttribute("data-marker",this.getMarker()),t.classList.add(sl,`usfm_${this.getMarker()}`),t.setAttribute("data-number",this.getNumber())),{element:t}}decorate(){return this.getShowMarker()?ko(this.getMarker(),this.getNumber()):this.getNumber()}exportJSON(){return{type:this.getType(),marker:this.getMarker(),number:this.getNumber(),showMarker:this.getShowMarker(),sid:this.getSid(),altnumber:this.getAltnumber(),pubnumber:this.getPubnumber(),unknownAttributes:this.getUnknownAttributes(),version:Pb}}isInline(){return!1}isKeyboardSelectable(){return!1}}function P1(n){const e=n.getAttribute("data-number")??"0";return{node:pf(e)}}function pf(n,e,t,r,i,s){return Me(new Un(n,e,t,r,i,s))}function Rb(n){return n?n.classList.contains(sl)&&n.tagName.toLowerCase()===Ib:!1}function vo(n){return n instanceof Un}function I1(n){return(n==null?void 0:n.type)===Un.getType()}const Lb=1;class cr extends Qi{static getType(){return"implied-para"}static clone(e){return new cr(e.__key)}static importJSON(e){return Jt().updateFromJSON(e)}getMarker(){return uf}exportJSON(){return{...super.exportJSON(),type:this.getType(),version:Lb}}insertNewAfter(e,t){const r=Jt();return r.setTextFormat(e.format),r.setTextStyle(e.style),r.setDirection(this.getDirection()),r.setFormat(this.getFormatType()),r.setStyle(this.getTextStyle()),this.insertAfter(r,t),r}}function Jt(){return Me(new cr)}function Fn(n){return n instanceof cr}function mf(n){return(n==null?void 0:n.type)===cr.getType()}const Vr="zmsc-s",Mi="zmsc-e",R1=[Vr,Mi],L1=["ts-s","ts-e","t-s","t-e","ts","qt1-s","qt1-e","qt2-s","qt2-e","qt3-s","qt3-e","qt4-s","qt4-e","qt5-s","qt5-e","qt-s","qt-e",Vr,Mi],Db=1;class yn extends pr{constructor(e="",t,r,i,s){super(s),Q(this,"__marker"),Q(this,"__sid"),Q(this,"__eid"),Q(this,"__unknownAttributes"),this.__marker=e,this.__sid=t,this.__eid=r,this.__unknownAttributes=i}static getType(){return"ms"}static clone(e){const{__marker:t,__sid:r,__eid:i,__unknownAttributes:s,__key:o}=e;return new yn(t,r,i,s,o)}static importJSON(e){return jb().updateFromJSON(e)}static isValidMarker(e){return e!==void 0&&(L1.includes(e)||e.startsWith("z"))}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setSid(e.sid).setEid(e.eid).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}setSid(e){if(this.__sid===e)return this;const t=this.getWritable();return t.__sid=e,t}getSid(){return this.getLatest().__sid}setEid(e){if(this.__eid===e)return this;const t=this.getWritable();return t.__eid=e,t}getEid(){return this.getLatest().__eid}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("span");return e.setAttribute("data-marker",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`),e}updateDOM(){return!1}decorate(){return""}exportJSON(){return{type:this.getType(),marker:this.getMarker(),sid:this.getSid(),eid:this.getEid(),unknownAttributes:this.getUnknownAttributes(),version:Db}}isKeyboardSelectable(){return!1}}function D1(n){return R1.includes(n)}function jb(n,e,t,r){return Me(new yn(n,e,t,r))}function Il(n){return n instanceof yn}const Fb="f",j1=[Fb,"fe","ef","x","ex"],qb=1;class Ve extends ht{constructor(e=Fb,t,r=!0,i,s,o){super(o),Q(this,"__marker"),Q(this,"__caller"),Q(this,"__isCollapsed"),Q(this,"__category"),Q(this,"__unknownAttributes"),this.__marker=e,this.__caller=t??(e==="x"||e==="ex"?df:Jr),this.__isCollapsed=r,this.__category=i,this.__unknownAttributes=s}static getType(){return"note"}static clone(e){const{__marker:t,__caller:r,__isCollapsed:i,__category:s,__unknownAttributes:o,__key:a}=e;return new Ve(t,r,i,s,o,a)}static importDOM(){return{span:e=>q1(e)?{conversion:F1,priority:1}:null}}static importJSON(e){return yf().updateFromJSON(e)}static isValidMarker(e){return e!==void 0&&j1.includes(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setCaller(e.caller).setIsCollapsed(e.isCollapsed).setCategory(e.category).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}setCaller(e){if(this.__caller===e)return this;const t=this.getWritable();return t.__caller=e,t}getCaller(){return this.getLatest().__caller}setIsCollapsed(e){if(this.__isCollapsed===e)return this;const t=this.getWritable();return t.__isCollapsed=e,t}toggleIsCollapsed(){const e=this.getWritable();return e.__isCollapsed=!e.__isCollapsed,e}getIsCollapsed(){return this.getLatest().__isCollapsed}setCategory(e){if(this.__category===e)return this;const t=this.getWritable();return t.__category=e,t}getCategory(){return this.getLatest().__category}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("span");return e.setAttribute("data-marker",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`,this.__isCollapsed?"collapsed":"expanded"),e.setAttribute("data-caller",this.__caller),e}updateDOM(e){return e.__isCollapsed!==this.__isCollapsed}exportDOM(e){const{element:t}=super.exportDOM(e);return t&&Te(t)&&(t.setAttribute("data-marker",this.getMarker()),t.classList.add(this.getType(),`usfm_${this.getMarker()}`,this.getIsCollapsed()?"collapsed":"expanded"),t.setAttribute("data-caller",this.getCaller())),{element:t}}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),caller:this.getCaller(),isCollapsed:this.getIsCollapsed(),category:this.getCategory(),unknownAttributes:this.getUnknownAttributes(),version:qb}}canBeEmpty(){return!1}isInline(){return!0}}function F1(n){const e=n.getAttribute("data-marker")??"f",t=n.getAttribute("data-caller")??"",r=n.classList.contains("collapsed");return{node:yf(e,t,r)}}function yf(n,e,t,r,i){return Me(new Ve(n,e,t,r,i))}function q1(n){if(!n)return!1;const e=n.getAttribute("data-marker")??"";return Ve.isValidMarker(e)&&n.classList.contains(Ve.getType())}function ye(n){return n instanceof Ve}const B1=["ide","sts","rem","h","toc1","toc2","toc3","toca1","toca2","toca3","imt","imt1","imt2","imt3","imt4","is","is1","is2","ip","ipi","im","imi","ipq","imq","ipr","iq","iq1","iq2","iq3","ili","ili1","ili2","ib","iot","io","io1","io2","io3","io4","iex","imte","imte1","imte2","ie","mt","mt1","mt2","mt3","mt4","mte","mte1","mte2","cl","cd","ms","ms1","ms2","ms3","mr","s","s1","s2","s3","s4","sr","r","d","sp","sd","sd1","sd2","sd3","sd4",uf,"m","po","cls","pr","pc","pm","pmo","pmc","pmr","pi","pi1","pi2","pi3","mi","lit","nb","q","q1","q2","q3","q4","qr","qc","qa","qm","qm1","qm2","qm3","qd","b","lh","li","li1","li2","li3","li4","lf","lim","lim1","lim2","lim3","lim4","pb"],Bb=1;class St extends Qi{constructor(e=uf,t,r){super(r),Q(this,"__marker"),Q(this,"__unknownAttributes"),this.__marker=e,this.__unknownAttributes=t}static getType(){return"para"}static clone(e){const{__marker:t,__unknownAttributes:r,__key:i}=e;return new St(t,r,i)}static isValidMarker(e){return e!==void 0&&B1.includes(e)}static importDOM(){return{p:()=>({conversion:U1,priority:1})}}static importJSON(e){return no().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("p");return e.setAttribute("data-marker",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`),e}exportDOM(e){const{element:t}=super.exportDOM(e);return t&&Te(t)&&(t.setAttribute("data-marker",this.getMarker()),t.classList.add(this.getType(),`usfm_${this.getMarker()}`)),{element:t}}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),unknownAttributes:this.getUnknownAttributes(),version:Bb}}insertNewAfter(e,t){const r=no(this.getMarker());return r.setTextFormat(e.format),r.setTextStyle(e.style),r.setDirection(this.getDirection()),r.setFormat(this.getFormatType()),r.setStyle(this.getTextStyle()),this.insertAfter(r,t),r}}function U1(n){const e=n.getAttribute("data-marker")??void 0,t=no(e);if(n.style){t.setFormat(n.style.textAlign);const r=parseInt(n.style.textIndent,10)/20;r>0&&t.setIndent(r)}return{node:t}}function no(n,e){return Me(new St(n,e))}function dt(n){return n instanceof St}function z1(n){return(n==null?void 0:n.type)===St.getType()}const _f="v",Ub=1;class _t extends At{constructor(e="",t,r,i,s,o,a){super(t??e,a),Q(this,"__marker"),Q(this,"__number"),Q(this,"__sid"),Q(this,"__altnumber"),Q(this,"__pubnumber"),Q(this,"__unknownAttributes"),this.__marker=_f,this.__number=e,this.__sid=r,this.__altnumber=i,this.__pubnumber=s,this.__unknownAttributes=o}static getType(){return"verse"}static clone(e){const{__number:t,__text:r,__sid:i,__altnumber:s,__pubnumber:o,__unknownAttributes:a,__key:l}=e;return new _t(t,r,i,s,o,a,l)}static importJSON(e){return zb().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setNumber(e.number).setSid(e.sid).setAltnumber(e.altnumber).setPubnumber(e.pubnumber).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}setNumber(e){if(this.__number===e)return this;const t=this.getWritable();return t.__number=e,t}getNumber(){return this.getLatest().__number}setSid(e){if(this.__sid===e)return this;const t=this.getWritable();return t.__sid=e,t}getSid(){return this.getLatest().__sid}setAltnumber(e){if(this.__altnumber===e)return this;const t=this.getWritable();return t.__altnumber=e,t}getAltnumber(){return this.getLatest().__altnumber}setPubnumber(e){if(this.__pubnumber===e)return this;const t=this.getWritable();return t.__pubnumber=e,t}getPubnumber(){return this.getLatest().__pubnumber}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(e){const t=super.createDOM(e);return t.setAttribute("data-marker",this.__marker),t.classList.add(Hu,`usfm_${this.__marker}`),t.setAttribute("data-number",this.__number),t}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),number:this.getNumber(),sid:this.getSid(),altnumber:this.getAltnumber(),pubnumber:this.getPubnumber(),unknownAttributes:this.getUnknownAttributes(),version:Ub}}}function zb(n,e,t,r,i,s){return Me(new _t(n,e,t,r,i,s))}function bf(n){return n instanceof _t}function W1(n){return(n==null?void 0:n.type)===_t.getType()}function K1(n){return E1(n)||I1(n)}function Lt(n){return gf(n)||vo(n)}function H1(n,e){return n.find(t=>Lt(t)&&t.getNumber()===e.toString())}function J1(n,e=!1){return n.find((t,r)=>(!e||r>0)&&Lt(t))}function vf(n){var e;if(!n)return;if(Lt(n))return n;let t=(e=n.getTopLevelElement())==null?void 0:e.getPreviousSibling();for(;t&&!Lt(t);)t=t.getPreviousSibling();if(t&&Lt(t))return t}function Wb(n){let e=n;for(;e!==null;){if(ye(e))return e;e=e.getParent()}}function V1(n){return mn(n)||gf(n)||Ie(n)||vo(n)||Fn(n)||Il(n)||dt(n)||ye(n)||bf(n)||bo(n)}function G1(n){var e;if(n.anchor.type==="element"){const r=n.anchor.getNode(),i=n.anchor.offset;if(i<r.getChildrenSize())return r.getChildAtIndex(i)}const t=n.anchor.getNode();return t.getNextSibling()??((e=t.getParent())==null?void 0:e.getNextSibling())??null}function Y1(n){var e;const t=n.anchor.offset;if(n.anchor.type==="element"&&t>0)return n.anchor.getNode().getChildAtIndex(t-1);const r=n.anchor.getNode();return r.getPreviousSibling()??((e=r.getParent())==null?void 0:e.getPreviousSibling())??null}function Wt(n){return dt(n)||Fn(n)}function Yu(n,e){const t=Ii(e,lr),r=!!(n.cid&&t),i=!n.cid&&!t;return n.style===e.getMarker()&&(i||r&&n.cid===t)}function X1(n,e){const t=j(n)?n:n.getParent(),r=j(e)?e:e.getParent(),i=t&&r?qs(t,r):void 0;return i?i.commonAncestor:void 0}function Z1(n){const e=n.getStartEndPoints();if(!e)return;const[t,r]=e,i=n.isBackward()?t:r;n.focus.set(i.key,i.offset,i.type),n.anchor.set(i.key,i.offset,i.type)}function kf(n){return(n==null?void 0:n.type)===At.getType()}function Q1(n,e){if(!e)return;const t=n.findIndex(r=>r===e);t&&(n.length=t)}function eT(n,e){if(!e)return n;const t=e.getIndexWithinParent();return n.splice(t+1,n.length-t-1)}function _r(n){return`\\${n}`}function ro(n){return`\\${n}*`}function Kb(n,e,t){const r=_r(n);if(e!=null&&e.startsWith(r)){const i=parseInt(e.slice(r.length),10);isNaN(i)||(t=i.toString())}return t}function ko(n,e){let t=_r(n);return e&&(t+=`${Ne}${e}`),t+=" ",t}function Hb(n){return kf(n)?n.text:O1(n)?n.children.map(e=>Hb(e)).join(""):""}function tT(n){return n.map(e=>Hb(e)).join(" ").trim()}function xf(n){return Ne+n+" "}function Cf(n){return n.reduce((e,t)=>e+(Ie(t)?` ${t.getTextContent()}`:""),"").trim()}function Ge(n,e=Lv){const t={...n};return e.forEach(r=>{Reflect.deleteProperty(t,r)}),Object.keys(t).length===0?void 0:t}function nT(n,e){const t=e.getElementByKey(n.getKey());return t?t.tagName.toLowerCase():void 0}function Ue(n){return Object.fromEntries(Object.entries(n).filter(([,e])=>e!==void 0))}function Jb(n){if(!n)return;const e=n.getNodes();if(e.length>0)return n.isBackward()?e[e.length-1]:e[0]}function Xu(n,e){if(!e)return(n+1).toString();const t=e.split("-");if(t.length===2)return parseInt(t[1])?`${parseInt(t[1])+1}`:`${parseInt(t[0])+1}`;const r=RegExp(/^(\d+)([a-yA-Y]{1,3})$/).exec(e);if(!r)return(parseInt(e)+1).toString();const i=String.fromCharCode(r[2].charCodeAt(0)+1);return`${r[1]}${i}`}function wf(n,e){if(!e)return!1;const t=e.split("-").map(r=>parseInt(r));if(t.length<1||t.length>2||t[0]>t[1])throw new Error("isVerseInRange: invalid range");return t.length===1?n===t[0]:t.length===2&&isNaN(t[1])?n>=t[0]:(t.length===2&&isNaN(t[0])||n>=t[0])&&n<=t[1]}function rT(n){return!!n&&n.includes("-")}const iT=1;class ii extends At{constructor(e="",t="opening",r){super(Qc(e,t),r),Q(this,"__marker"),Q(this,"__markerSyntax"),this.__marker=e,this.__markerSyntax=t}static getType(){return"marker"}static clone(e){return new ii(e.__marker,e.__markerSyntax,e.__key)}static importJSON(e){return Zu().updateFromJSON(e)}updateFromJSON(e){const{marker:t,markerSyntax:r="opening"}=e;return super.updateFromJSON(e).setMarker(t).setMarkerSyntax(r)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t.__text=Qc(e,t.__markerSyntax),t}getMarker(){return this.getLatest().__marker}setMarkerSyntax(e){if(this.__markerSyntax===e)return this;const t=this.getWritable();return t.__markerSyntax=e,t.__text=Qc(t.__marker,e),t}getMarkerSyntax(){return this.getLatest().__markerSyntax}createDOM(e){const t=super.createDOM(e);return t.setAttribute("data-marker",this.__marker),t.classList.add(this.__markerSyntax),t}exportJSON(){return{...super.exportJSON(),type:this.getType(),text:this.getTextContent(),marker:this.getMarker(),markerSyntax:this.getMarkerSyntax(),version:iT}}}function Zu(n,e){return Me(new ii(n,e))}function xo(n){return n instanceof ii}function Qc(n,e){return e==="closing"?ro(n):e==="selfClosing"?ro(""):_r(n)}const Qn="internal-comment",sT=[Qn],oT={},aT=1;class tt extends ht{constructor(e=oT,t){super(t),Q(this,"__typedIDs"),this.__typedIDs=e}static getType(){return"typed-mark"}static clone(e){const t=JSON.parse(JSON.stringify(e.__typedIDs));return new tt(t,e.__key)}static isReservedType(e){return sT.includes(e)}static importDOM(){return null}static importJSON(e){return io().updateFromJSON(e)}exportJSON(){return{...super.exportJSON(),type:this.getType(),typedIDs:this.getTypedIDs(),version:aT}}createDOM(e){const t=document.createElement("mark");for(const[r,i]of Object.entries(this.__typedIDs))ct(t,oa(e.theme.typedMark,r)),i.length>1&&ct(t,oa(e.theme.typedMarkOverlap,r));return t}updateDOM(e,t,r){for(const[i,s]of Object.entries(this.__typedIDs)){const o=e.__typedIDs[i].length,a=s.length,l=oa(r.theme.typedMark,i),c=oa(r.theme.typedMarkOverlap,i);o!==a&&(o===0?a===1&&ct(t,l):a===0&&Dr(t,l),o===1?a===2&&ct(t,c):a===1&&Dr(t,c))}return!1}updateFromJSON(e){return super.updateFromJSON(e).setTypedIDs(e.typedIDs)}hasID(e,t){const r=this.getTypedIDs()[e];if(!r)return!1;for(const i of r)if(t===i)return!0;return!1}getTypedIDs(){const e=this.getLatest();return rt(e)?e.__typedIDs:{}}setTypedIDs(e){const t=this.getWritable();return t.__typedIDs=e,t}addID(e,t){const r=this.getWritable();if(!rt(r))return;const i=r.__typedIDs[e]??[];r.__typedIDs[e]=i;for(const s of i)if(t===s)return;i.push(t)}deleteID(e,t){const r=this.getWritable();if(!rt(r))return;const i=r.__typedIDs[e];for(let s=0;s<i.length;s++)if(t===i[s]){i.splice(s,1);return}}hasNoIDsForEveryType(){return Object.values(this.getTypedIDs()).every(e=>e===void 0||e.length===0)}insertNewAfter(e,t=!0){const r=io(this.__typedIDs);return this.insertAfter(r,t),r}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}canBeEmpty(){return!1}isInline(){return!0}extractWithChild(e,t,r){if(!B(t)||r==="html")return!1;const i=t.anchor,s=t.focus,o=i.getNode(),a=s.getNode(),l=t.isBackward()?i.offset-s.offset:s.offset-i.offset;return this.isParentOf(o)&&this.isParentOf(a)&&this.getTextContent().length===l}excludeFromCopy(e){return e!=="clone"}}function oa(n,e){return`${n}-${e}`}function io(n){return Me(new tt(n))}function rt(n){return n instanceof tt}function lT(n){return(n==null?void 0:n.type)===tt.getType()}function Vb(n){const e=n.getChildren();let t=null;for(const r of e)t===null?n.insertBefore(r):t.insertAfter(r),t=r;n.remove()}function Gb(n,e,t,r){const i=n.getNodes(),s=n.anchor.offset,o=n.focus.offset,a=i.length,l=n.isBackward(),c=l?o:s,u=l?s:o;let f,d;for(let h=0;h<a;h++){const p=i[h];if(j(d)&&d.isParentOf(p))continue;const m=h===0,y=h===a-1;let b=null;if(z(p)){const _=p.getTextContentSize(),C=m?c:0,E=y?u:_;if(C===0&&E===0)continue;const O=p.splitText(C,E);b=O.length>1&&(O.length===3||m&&!y||E===_)?O[1]:O[0]}else{if(rt(p))continue;j(p)&&p.isInline()&&(b=p)}if(b!==null){if(b&&b.is(f))continue;const _=b.getParent();(_==null||!_.is(f))&&(d=void 0),f=_,d===void 0&&(d=io({[e]:[t]}),b.insertBefore(d)),d.append(b)}else f=void 0,d=void 0}e===Qn&&j(d)&&(l?d.selectStart():d.selectEnd())}function cT(n,e,t){let r=n;for(;r!==null;){if(rt(r))return r.getTypedIDs()[e];if(z(r)&&t===r.getTextContentSize()){const i=r.getNextSibling();if(rt(i))return i.getTypedIDs()[e]}r=r.getParent()}}function np(n){return`external-${n}`}const Yb=1;class br extends pr{constructor(e="",t="",r){super(r),Q(this,"__textType"),Q(this,"__text"),this.__textType=e,this.__text=t}static getType(){return"immutable-typed-text"}static clone(e){const{__textType:t,__text:r,__key:i}=e;return new br(t,r,i)}static importDOM(){return{span:e=>dT(e)?{conversion:uT,priority:1}:null}}static importJSON(e){return ol().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setTextType(e.textType).setTextContent(e.text)}setTextType(e){if(this.__textType===e)return this;const t=this.getWritable();return t.__textType=e,t}getTextType(){return this.getLatest().__textType}setTextContent(e){if(this.__text===e)return this;const t=this.getWritable();return t.__text=e,t}getTextContent(){return this.getLatest().__text}createDOM(){const e=document.createElement("span");return e.setAttribute("data-text-type",this.__textType),e.classList.add(this.__textType),e}updateDOM(){return!1}exportDOM(e){const{element:t}=super.exportDOM(e);return t&&Te(t)&&t.setAttribute("data-text-type",this.getTextType()),{element:t}}decorate(){return this.getTextContent()}exportJSON(){return{type:this.getType(),textType:this.getTextType(),text:this.getTextContent(),version:Yb}}isKeyboardSelectable(){return!1}}function uT(n){const e=n.getAttribute("data-text-type")??"",t=n.textContent??"";return{node:ol(e,t)}}function ol(n,e){return Me(new br(n,e))}function dT(n){return(n==null?void 0:n.tagName)==="span"}function al(n){return n instanceof br}function fT(n){return(n==null?void 0:n.type)===br.getType()}const ll="unmatched",Xb=1;class vr extends pr{constructor(e="",t){super(t),Q(this,"__marker"),this.__marker=e}static getType(){return"unmatched"}static clone(e){const{__marker:t,__key:r}=e;return new vr(t,r)}static importDOM(){return{[ll]:e=>gT(e)?{conversion:hT,priority:1}:null}}static importJSON(e){return Sf().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}createDOM(){const e=document.createElement(ll);e.setAttribute("data-marker",this.__marker),e.classList.add(tp);const t=this.__marker.endsWith("*");return e.title=t?"This closing marker has no matching opening marker!":"This opening marker has no matching closing marker!",e}updateDOM(){return!1}exportDOM(e){const{element:t}=super.exportDOM(e);return t&&Te(t)&&(t.setAttribute("data-marker",this.getMarker()),t.classList.add(tp)),{element:t}}decorate(){return`\\${this.getMarker()}${Ku}`}exportJSON(){return{type:this.getType(),marker:this.getMarker(),version:Xb}}isKeyboardSelectable(){return!1}}function hT(n){const e=n.getAttribute("data-marker")??"";return{node:Sf(e)}}function Sf(n){return Me(new vr(n))}function gT(n){return(n==null?void 0:n.tagName)===ll}function Zb(n){return n instanceof vr}const pT=[Ft,Un,en,_t,Re,Ve,yn,ii,ri,br,vr,St,cr,{replace:Qi,with:()=>Jt(),withKlass:cr}];var A;(function(n){n.FileIdentification="FileIdentification",n.Headers="Headers",n.Remarks="Remarks",n.Introduction="Introduction",n.DivisionMarks="DivisionMarks",n.Paragraphs="Paragraphs",n.Poetry="Poetry",n.TitlesHeadings="TitlesHeadings",n.Tables="Tables",n.CenterTables="CenterTables",n.RightTables="RightTables",n.Lists="Lists",n.Footnotes="Footnotes",n.CrossReferences="CrossReferences",n.SpecialText="SpecialText",n.CharacterStyling="CharacterStyling",n.Breaks="Breaks",n.SpecialFeatures="SpecialFeatures",n.PeripheralReferences="PeripheralReferences",n.PeripheralMaterials="PeripheralMaterials",n.Uncategorized="Uncategorized"})(A||(A={}));var M;(function(n){n.Paragraph="Paragraph",n.Character="Character",n.Note="Note",n.Unknown="Unknown"})(M||(M={}));const mT={id:{category:A.FileIdentification,type:M.Paragraph,description:"File identification information (BOOKID, FILENAME, EDITOR, MODIFICATION DATE)",hasEndMarker:!1,children:{FileIdentification:["usfm","ide"],Headers:["h","h1","h2","h3","toc1","toc2","toc3"],Remarks:["rem","sts","restore"],Introduction:["imt","imt1","imt2","imt3","imt4","imte","imte1","imte2","is","is1","is2","iot","io","io1","io2","io3","io4","ior","ip","im","ipi","imi","ili","ili1","ili2","ipq","imq","ipr","ib","iq","iq1","iq2","iq3","iex","ie"],DivisionMarks:["c","cl"],TitlesHeadings:["mt","mt1","mt2","mt3","mt4"]}},usfm:{category:A.FileIdentification,type:M.Paragraph,description:"File markup version information",hasEndMarker:!1,children:void 0},ide:{category:A.FileIdentification,type:M.Paragraph,description:"File encoding information",hasEndMarker:!1,children:{Remarks:["rem","sts"]}},h:{category:A.Headers,type:M.Paragraph,description:"Running header text for a book (basic)",hasEndMarker:!1,children:{Headers:["toc1","toc2","toc3","toca1","toca2","toca3"]}},h1:{category:A.Headers,type:M.Paragraph,description:"Running header text",hasEndMarker:!1,children:{Headers:["toc1","toc2","toc3","toca1","toca2","toca3"]}},h2:{category:A.Headers,type:M.Paragraph,description:"Running header text, left side of page",hasEndMarker:!1,children:{Headers:["toc1","toc2","toc3","toca1","toca2","toca3"]}},h3:{category:A.Headers,type:M.Paragraph,description:"Running header text, right side of page",hasEndMarker:!1,children:{Headers:["toc1","toc2","toc3","toca1","toca2","toca3"]}},toc1:{category:A.Headers,type:M.Paragraph,description:"Long table of contents text",hasEndMarker:!1,children:void 0},toc2:{category:A.Headers,type:M.Paragraph,description:"Short table of contents text",hasEndMarker:!1,children:void 0},toc3:{category:A.Headers,type:M.Paragraph,description:"Book Abbreviation",hasEndMarker:!1,children:void 0},toca1:{category:A.Headers,type:M.Paragraph,description:"Alternative language long table of contents text",hasEndMarker:!1,children:void 0},toca2:{category:A.Headers,type:M.Paragraph,description:"Alternative language short table of contents text",hasEndMarker:!1,children:void 0},toca3:{category:A.Headers,type:M.Paragraph,description:"Alternative language book Abbreviation",hasEndMarker:!1,children:void 0},rem:{category:A.Remarks,type:M.Paragraph,description:"Comments and remarks",hasEndMarker:!1,children:void 0},sts:{category:A.Remarks,type:M.Paragraph,description:"Status of this file",hasEndMarker:!1,children:void 0},restore:{category:A.Remarks,type:M.Paragraph,description:"Project restore information",hasEndMarker:!1,children:void 0},imt:{category:A.Introduction,type:M.Paragraph,description:"Introduction major title, level 1 (if single level) (basic)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imt1:{category:A.Introduction,type:M.Paragraph,description:"Introduction major title, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imt2:{category:A.Introduction,type:M.Paragraph,description:"Introduction major title, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imt3:{category:A.Introduction,type:M.Paragraph,description:"Introduction major title, level 3",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imt4:{category:A.Introduction,type:M.Paragraph,description:"Introduction major title, level 4 (usually within parenthesis)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imte:{category:A.Introduction,type:M.Paragraph,description:"Introduction major title at introduction end, level 1 (if single level)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imte1:{category:A.Introduction,type:M.Paragraph,description:"Introduction major title at introduction end, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imte2:{category:A.Introduction,type:M.Paragraph,description:"Introduction major title at introduction end, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},is:{category:A.Introduction,type:M.Paragraph,description:"Introduction section heading, level 1 (if single level) (basic)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"],CharacterStyling:["no"]}},is1:{category:A.Introduction,type:M.Paragraph,description:"Introduction section heading, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},is2:{category:A.Introduction,type:M.Paragraph,description:"Introduction section heading, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},iot:{category:A.Introduction,type:M.Paragraph,description:"Introduction outline title (basic)",hasEndMarker:!1,children:{Introduction:["iqt"],CharacterStyling:["no"]}},io:{category:A.Introduction,type:M.Paragraph,description:"Introduction outline text, level 1 (if single level)",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},io1:{category:A.Introduction,type:M.Paragraph,description:"Introduction outline text, level 1 (if multiple levels) (basic)",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},io2:{category:A.Introduction,type:M.Paragraph,description:"Introduction outline text, level 2",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},io3:{category:A.Introduction,type:M.Paragraph,description:"Introduction outline text, level 3",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},io4:{category:A.Introduction,type:M.Paragraph,description:"Introduction outline text, level 4",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ior:{category:A.Introduction,type:M.Character,description:"Introduction references range for outline entry; for marking references separately",hasEndMarker:!0,children:void 0},ip:{category:A.Introduction,type:M.Paragraph,description:"Introduction prose paragraph (basic)",hasEndMarker:!1,children:{Introduction:["iqt"],Footnotes:["f","fe","fm"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},im:{category:A.Introduction,type:M.Paragraph,description:"Introduction prose paragraph, with no first line indent (may occur after poetry)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ipi:{category:A.Introduction,type:M.Paragraph,description:"Introduction prose paragraph, indented, with first line indent",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},imi:{category:A.Introduction,type:M.Paragraph,description:"Introduction prose paragraph text, indented, with no first line indent",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ili:{category:A.Introduction,type:M.Paragraph,description:"A list entry, level 1 (if single level)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ili1:{category:A.Introduction,type:M.Paragraph,description:"A list entry, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ili2:{category:A.Introduction,type:M.Paragraph,description:"A list entry, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ipq:{category:A.Introduction,type:M.Paragraph,description:"Introduction prose paragraph, quote from the body text",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},imq:{category:A.Introduction,type:M.Paragraph,description:"Introduction prose paragraph, quote from the body text, with no first line indent",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ipr:{category:A.Introduction,type:M.Paragraph,description:"Introduction prose paragraph, right aligned",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},ib:{category:A.Introduction,type:M.Paragraph,description:"Introduction blank line",hasEndMarker:!1,children:{Introduction:["iqt"]}},iq:{category:A.Introduction,type:M.Paragraph,description:"Introduction poetry text, level 1 (if single level)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},iq1:{category:A.Introduction,type:M.Paragraph,description:"Introduction poetry text, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},iq2:{category:A.Introduction,type:M.Paragraph,description:"Introduction poetry text, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},iq3:{category:A.Introduction,type:M.Paragraph,description:"Introduction poetry text, level 3",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},iex:{category:A.Introduction,type:M.Paragraph,description:"Introduction explanatory or bridge text (e.g. explanation of missing book in Short Old Testament)",hasEndMarker:!1,children:{Introduction:["iqt"],CharacterStyling:["no"]}},iqt:{category:A.Introduction,type:M.Character,description:"For quoted scripture text appearing in the introduction",hasEndMarker:!0,children:void 0},ie:{category:A.Introduction,type:M.Paragraph,description:"Introduction ending marker",hasEndMarker:!1,children:void 0},c:{category:A.DivisionMarks,type:M.Paragraph,description:"Chapter number",hasEndMarker:!1,children:{DivisionMarks:["ca","cp","cl","cd"],Paragraphs:["p","m","po","pr","cls","pi","pi1","pi2","pi3","pc","mi","nb"],Poetry:["q","q1","q2","q3","q4","qc","qr","qa","qd","b"],TitlesHeadings:["mte","ms","ms1","ms2","ms3","s","s1","s2","s3","s4","r","sp","d","sd","sd1","sd2","sd3","sd4"],Lists:["lh","li","li1","li2","li3","li4","lf","lim","lim1","lim2","lim3","lim4"],Footnotes:["f","fe"],SpecialText:["lit"],Breaks:["pb"]}},ca:{category:A.DivisionMarks,type:M.Character,description:"Second (alternate) chapter number (for coding dual versification; useful for places where different traditions of chapter breaks need to be supported in the same translation)",hasEndMarker:!0,children:void 0},cp:{category:A.DivisionMarks,type:M.Paragraph,description:"Published chapter number (chapter string that should appear in the published text)",hasEndMarker:!1,children:{Footnotes:["f"]}},cl:{category:A.DivisionMarks,type:M.Paragraph,description:"Chapter label used for translations that add a word such as 'Chapter' before chapter numbers (e.g. Psalms). The subsequent text is the chapter label.",hasEndMarker:!1,children:void 0},cd:{category:A.DivisionMarks,type:M.Paragraph,description:"Chapter Description (Publishing option D, e.g. in Russian Bibles)",hasEndMarker:!1,children:{DivisionMarks:["vp"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},v:{category:A.DivisionMarks,type:M.Character,description:"A verse number",hasEndMarker:!1,children:void 0},va:{category:A.DivisionMarks,type:M.Character,description:"Second (alternate) verse number (for coding dual numeration in Psalms; see also NRSV Exo 22.1-4)",hasEndMarker:!0,children:void 0},vp:{category:A.DivisionMarks,type:M.Character,description:"Published verse marker (verse string that should appear in the published text)",hasEndMarker:!0,children:void 0},p:{category:A.Paragraphs,type:M.Paragraph,description:"Paragraph text, with first line indent (basic)",hasEndMarker:!1,children:{Paragraphs:["pmo","pm","pmc","pmr"],Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},m:{category:A.Paragraphs,type:M.Paragraph,description:"Paragraph text, with no first line indent (may occur after poetry) (basic)",hasEndMarker:!1,children:{Paragraphs:["pmo","pm","pmc","pmr"],Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},po:{category:A.Paragraphs,type:M.Paragraph,description:"Letter opening",hasEndMarker:!1,children:{Paragraphs:["pmo","pm","pmc","pmr"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pr:{category:A.Paragraphs,type:M.Paragraph,description:"Text refrain (paragraph text, right aligned)",hasEndMarker:!1,children:{Paragraphs:["pmo","pm","pmc","pmr"],Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},cls:{category:A.Paragraphs,type:M.Paragraph,description:"Letter Closing",hasEndMarker:!1,children:{SpecialText:["tl","sig","pn","png","addpn","add"]}},pmo:{category:A.Paragraphs,type:M.Paragraph,description:"Embedded text opening",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pm:{category:A.Paragraphs,type:M.Paragraph,description:"Embedded text paragraph",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pmc:{category:A.Paragraphs,type:M.Paragraph,description:"Embedded text closing",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pmr:{category:A.Paragraphs,type:M.Paragraph,description:"Embedded text refrain (e.g. Then all the people shall say, 'Amen!')",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pi:{category:A.Paragraphs,type:M.Paragraph,description:"Paragraph text, level 1 indent (if single level), with first line indent; often used for discourse (basic)",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pi1:{category:A.Paragraphs,type:M.Paragraph,description:"Paragraph text, level 1 indent (if multiple levels), with first line indent; often used for discourse",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pi2:{category:A.Paragraphs,type:M.Paragraph,description:"Paragraph text, level 2 indent, with first line indent; often used for discourse",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pi3:{category:A.Paragraphs,type:M.Paragraph,description:"Paragraph text, level 3 indent, with first line indent; often used for discourse",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pc:{category:A.Paragraphs,type:M.Paragraph,description:"Paragraph text, centered (for Inscription)",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},mi:{category:A.Paragraphs,type:M.Paragraph,description:"Paragraph text, indented, with no first line indent; often used for discourse",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},nb:{category:A.Paragraphs,type:M.Paragraph,description:"Paragraph text, with no break from previous paragraph text (at chapter boundary) (basic)",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q:{category:A.Poetry,type:M.Paragraph,description:"Poetry text, level 1 indent (if single level)",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q1:{category:A.Poetry,type:M.Paragraph,description:"Poetry text, level 1 indent (if multiple levels) (basic)",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q2:{category:A.Poetry,type:M.Paragraph,description:"Poetry text, level 2 indent (basic)",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q3:{category:A.Poetry,type:M.Paragraph,description:"Poetry text, level 3 indent",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q4:{category:A.Poetry,type:M.Paragraph,description:"Poetry text, level 4 indent",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qc:{category:A.Poetry,type:M.Paragraph,description:"Poetry text, centered",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qr:{category:A.Poetry,type:M.Paragraph,description:"Poetry text, Right Aligned",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qs:{category:A.Poetry,type:M.Character,description:"Poetry text, Selah",hasEndMarker:!0,children:{Footnotes:["f"],CrossReferences:["x"]}},qa:{category:A.Poetry,type:M.Paragraph,description:"Poetry text, Acrostic marker/heading",hasEndMarker:!1,children:void 0},qac:{category:A.Poetry,type:M.Character,description:"Poetry text, Acrostic markup of the first character of a line of acrostic poetry",hasEndMarker:!0,children:void 0},qm:{category:A.Poetry,type:M.Paragraph,description:"Poetry text, embedded, level 1 indent (if single level)",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qm1:{category:A.Poetry,type:M.Paragraph,description:"Poetry text, embedded, level 1 indent (if multiple levels)",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qm2:{category:A.Poetry,type:M.Paragraph,description:"Poetry text, embedded, level 2 indent",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qm3:{category:A.Poetry,type:M.Paragraph,description:"Poetry text, embedded, level 3 indent",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qd:{category:A.Poetry,type:M.Paragraph,description:"A Hebrew musical performance annotation, similar in content to Hebrew descriptive title.",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},b:{category:A.Poetry,type:M.Paragraph,description:"Poetry text stanza break (e.g. stanza break) (basic)",hasEndMarker:!1,children:void 0},mt:{category:A.TitlesHeadings,type:M.Paragraph,description:"The main title of the book (if single level)",hasEndMarker:!1,children:{Footnotes:["f"],CrossReferences:["x"]}},mt1:{category:A.TitlesHeadings,type:M.Paragraph,description:"The main title of the book (if multiple levels) (basic)",hasEndMarker:!1,children:{Footnotes:["f"],CrossReferences:["x"]}},mt2:{category:A.TitlesHeadings,type:M.Paragraph,description:"A secondary title usually occurring before the main title (basic)",hasEndMarker:!1,children:{Footnotes:["f"],CrossReferences:["x"]}},mt3:{category:A.TitlesHeadings,type:M.Paragraph,description:"A secondary title occurring after the main title",hasEndMarker:!1,children:{Footnotes:["f"],CrossReferences:["x"]}},mt4:{category:A.TitlesHeadings,type:M.Paragraph,description:"A small secondary title sometimes occurring within parentheses",hasEndMarker:!1,children:void 0},mte:{category:A.TitlesHeadings,type:M.Paragraph,description:"The main title of the book repeated at the end of the book, level 1 (if single level)",hasEndMarker:!1,children:void 0},mte1:{category:A.TitlesHeadings,type:M.Paragraph,description:"The main title of the book repeated at the end of the book, level 1 (if multiple levels)",hasEndMarker:!1,children:{TitlesHeadings:["mte2"]}},mte2:{category:A.TitlesHeadings,type:M.Paragraph,description:"A secondary title occurring before or after the 'ending' main title",hasEndMarker:!1,children:void 0},ms:{category:A.TitlesHeadings,type:M.Paragraph,description:"A major section division heading, level 1 (if single level) (basic)",hasEndMarker:!1,children:{TitlesHeadings:["mr"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},ms1:{category:A.TitlesHeadings,type:M.Paragraph,description:"A major section division heading, level 1 (if multiple levels)",hasEndMarker:!1,children:{TitlesHeadings:["mr"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},ms2:{category:A.TitlesHeadings,type:M.Paragraph,description:"A major section division heading, level 2",hasEndMarker:!1,children:{TitlesHeadings:["mr"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},ms3:{category:A.TitlesHeadings,type:M.Paragraph,description:"A major section division heading, level 3",hasEndMarker:!1,children:{TitlesHeadings:["mr"],Footnotes:["f","fe"]}},mr:{category:A.TitlesHeadings,type:M.Paragraph,description:"A major section division references range heading (basic)",hasEndMarker:!1,children:void 0},s:{category:A.TitlesHeadings,type:M.Paragraph,description:"A section heading, level 1 (if single level) (basic)",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},s1:{category:A.TitlesHeadings,type:M.Paragraph,description:"A section heading, level 1 (if multiple levels)",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},s2:{category:A.TitlesHeadings,type:M.Paragraph,description:"A section heading, level 2 (e.g. Proverbs 22-24)",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},s3:{category:A.TitlesHeadings,type:M.Paragraph,description:"A section heading, level 3 (e.g. Genesis 'The First Day')",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},s4:{category:A.TitlesHeadings,type:M.Paragraph,description:"A section heading, level 4",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},sr:{category:A.TitlesHeadings,type:M.Paragraph,description:"A section division references range heading",hasEndMarker:!1,children:void 0},r:{category:A.TitlesHeadings,type:M.Paragraph,description:"Parallel reference(s) (basic)",hasEndMarker:!1,children:void 0},sp:{category:A.TitlesHeadings,type:M.Paragraph,description:"A heading, to identify the speaker (e.g. Job)",hasEndMarker:!1,children:{Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},d:{category:A.TitlesHeadings,type:M.Paragraph,description:"A Hebrew text heading, to provide description (e.g. Psalms)",hasEndMarker:!1,children:{Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},sd:{category:A.TitlesHeadings,type:M.Paragraph,description:"Vertical space used to divide the text into sections, level 1 (if single level)",hasEndMarker:!1,children:void 0},sd1:{category:A.TitlesHeadings,type:M.Paragraph,description:"Vertical space used to divide the text into sections, level 1 (if multiple levels)",hasEndMarker:!1,children:void 0},sd2:{category:A.TitlesHeadings,type:M.Paragraph,description:"Vertical space used to divide the text into sections, level 2",hasEndMarker:!1,children:void 0},sd3:{category:A.TitlesHeadings,type:M.Paragraph,description:"Vertical space used to divide the text into sections, level 3",hasEndMarker:!1,children:void 0},sd4:{category:A.TitlesHeadings,type:M.Paragraph,description:"Vertical space used to divide the text into sections, level 4",hasEndMarker:!1,children:void 0},lh:{category:A.Lists,type:M.Paragraph,description:"List header (introductory remark)",hasEndMarker:!1,children:{Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li:{category:A.Lists,type:M.Paragraph,description:"A list entry, level 1 (if single level)",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li1:{category:A.Lists,type:M.Paragraph,description:"A list entry, level 1 (if multiple levels)",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li2:{category:A.Lists,type:M.Paragraph,description:"A list entry, level 2",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li3:{category:A.Lists,type:M.Paragraph,description:"A list entry, level 3",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li4:{category:A.Lists,type:M.Paragraph,description:"A list entry, level 4",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lf:{category:A.Lists,type:M.Paragraph,description:"List footer (concluding remark)",hasEndMarker:!1,children:{Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim:{category:A.Lists,type:M.Paragraph,description:"An embedded list entry, level 1 (if single level)",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim1:{category:A.Lists,type:M.Paragraph,description:"An embedded list entry, level 1 (if multiple levels)",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim2:{category:A.Lists,type:M.Paragraph,description:"An embedded list entry, level 2",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim3:{category:A.Lists,type:M.Paragraph,description:"An embedded list item, level 3",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim4:{category:A.Lists,type:M.Paragraph,description:"An embedded list entry, level 4",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},litl:{category:A.Lists,type:M.Character,description:"List entry total text",hasEndMarker:!0,children:void 0},lik:{category:A.Lists,type:M.Character,description:"Structured list entry key text",hasEndMarker:!0,children:void 0},liv:{category:A.Lists,type:M.Character,description:"Structured list entry value 1 content (if single value)",hasEndMarker:!0,children:void 0},liv1:{category:A.Lists,type:M.Character,description:"Structured list entry value 1 content (if multiple values)",hasEndMarker:!0,children:void 0},liv2:{category:A.Lists,type:M.Character,description:"Structured list entry value 2 content",hasEndMarker:!0,children:void 0},liv3:{category:A.Lists,type:M.Character,description:"Structured list entry value 3 content",hasEndMarker:!0,children:void 0},liv4:{category:A.Lists,type:M.Character,description:"Structured list entry value 4 content",hasEndMarker:!0,children:void 0},liv5:{category:A.Lists,type:M.Character,description:"Structured list entry value 5 content",hasEndMarker:!0,children:void 0},f:{category:A.Footnotes,type:M.Note,description:"A Footnote text item (basic)",hasEndMarker:!0,children:{Footnotes:["fr","ft","fk","fq","fqa","fl","fw","fp","fv","fdc"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},fe:{category:A.Footnotes,type:M.Note,description:"An Endnote text item",hasEndMarker:!0,children:{Footnotes:["fr","ft","fk","fq","fqa","fl","fw","fp","fv","fdc"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},fr:{category:A.Footnotes,type:M.Character,description:"The origin reference for the footnote (basic)",hasEndMarker:!0,children:void 0},ft:{category:A.Footnotes,type:M.Character,description:"Footnote text, Protocanon (basic)",hasEndMarker:!0,children:void 0},fk:{category:A.Footnotes,type:M.Character,description:"A footnote keyword (basic)",hasEndMarker:!0,children:void 0},fq:{category:A.Footnotes,type:M.Character,description:"A footnote scripture quote or alternate rendering (basic)",hasEndMarker:!0,children:void 0},fqa:{category:A.Footnotes,type:M.Character,description:"A footnote alternate rendering for a portion of scripture text",hasEndMarker:!0,children:void 0},fl:{category:A.Footnotes,type:M.Character,description:"A footnote label text item, for marking or 'labelling' the type or alternate translation being provided in the note.",hasEndMarker:!0,children:void 0},fw:{category:A.Footnotes,type:M.Character,description:"A footnote witness list, for distinguishing a list of sigla representing witnesses in critical editions.",hasEndMarker:!0,children:void 0},fp:{category:A.Footnotes,type:M.Character,description:"A Footnote additional paragraph marker",hasEndMarker:!0,children:void 0},fv:{category:A.Footnotes,type:M.Character,description:"A verse number within the footnote text",hasEndMarker:!0,children:void 0},fdc:{category:A.Footnotes,type:M.Character,description:"Footnote text, applies to Deuterocanon only",hasEndMarker:!0,children:void 0},fm:{category:A.Footnotes,type:M.Character,description:"An additional footnote marker location for a previous footnote",hasEndMarker:!0,children:void 0},x:{category:A.CrossReferences,type:M.Note,description:"A list of cross references (basic)",hasEndMarker:!0,children:{CrossReferences:["xo","xop","xt","xta","xk","xq","xot","xnt","xdc"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},xo:{category:A.CrossReferences,type:M.Character,description:"The cross reference origin reference (basic)",hasEndMarker:!0,children:void 0},xop:{category:A.CrossReferences,type:M.Character,description:"Published cross reference origin reference (origin reference that should appear in the published text)",hasEndMarker:!0,children:void 0},xt:{category:A.CrossReferences,type:M.Character,description:"The cross reference target reference(s), protocanon only (basic)",hasEndMarker:!0,children:void 0},xta:{category:A.CrossReferences,type:M.Character,description:"Cross reference target references added text",hasEndMarker:!0,children:void 0},xk:{category:A.CrossReferences,type:M.Character,description:"A cross reference keyword",hasEndMarker:!0,children:void 0},xq:{category:A.CrossReferences,type:M.Character,description:"A cross-reference quotation from the scripture text",hasEndMarker:!0,children:void 0},xot:{category:A.CrossReferences,type:M.Character,description:"Cross-reference target reference(s), Old Testament only",hasEndMarker:!0,children:void 0},xnt:{category:A.CrossReferences,type:M.Character,description:"Cross-reference target reference(s), New Testament only",hasEndMarker:!0,children:void 0},xdc:{category:A.CrossReferences,type:M.Character,description:"Cross-reference target reference(s), Deuterocanon only",hasEndMarker:!0,children:void 0},rq:{category:A.CrossReferences,type:M.Character,description:"A cross-reference indicating the source text for the preceding quotation.",hasEndMarker:!0,children:void 0},qt:{category:A.SpecialText,type:M.Character,description:"For Old Testament quoted text appearing in the New Testament (basic)",hasEndMarker:!0,children:void 0},nd:{category:A.SpecialText,type:M.Character,description:"For name of deity (basic)",hasEndMarker:!0,children:void 0},tl:{category:A.SpecialText,type:M.Character,description:"For transliterated words",hasEndMarker:!0,children:void 0},dc:{category:A.SpecialText,type:M.Character,description:"Deuterocanonical/LXX additions or insertions in the Protocanonical text",hasEndMarker:!0,children:void 0},bk:{category:A.SpecialText,type:M.Character,description:"For the quoted name of a book",hasEndMarker:!0,children:void 0},sig:{category:A.SpecialText,type:M.Character,description:"For the signature of the author of an Epistle",hasEndMarker:!0,children:void 0},pn:{category:A.SpecialText,type:M.Character,description:"For a proper name",hasEndMarker:!0,children:void 0},png:{category:A.SpecialText,type:M.Character,description:"For a geographic proper name",hasEndMarker:!0,children:void 0},addpn:{category:A.SpecialText,type:M.Character,description:"For chinese words to be dot underline & underline",hasEndMarker:!0,children:void 0},wj:{category:A.SpecialText,type:M.Character,description:"For marking the words of Jesus",hasEndMarker:!0,children:void 0},k:{category:A.SpecialText,type:M.Character,description:"For a keyword",hasEndMarker:!0,children:void 0},sls:{category:A.SpecialText,type:M.Character,description:"To represent where the original text is in a secondary language or from an alternate text source",hasEndMarker:!0,children:void 0},ord:{category:A.SpecialText,type:M.Character,description:"For the text portion of an ordinal number",hasEndMarker:!0,children:void 0},add:{category:A.SpecialText,type:M.Character,description:"For a translational addition to the text",hasEndMarker:!0,children:void 0},lit:{category:A.SpecialText,type:M.Paragraph,description:"For a comment or note inserted for liturgical use",hasEndMarker:!1,children:void 0},no:{category:A.CharacterStyling,type:M.Character,description:"A character style, use normal text",hasEndMarker:!0,children:void 0},it:{category:A.CharacterStyling,type:M.Character,description:"A character style, use italic text",hasEndMarker:!0,children:void 0},bd:{category:A.CharacterStyling,type:M.Character,description:"A character style, use bold text",hasEndMarker:!0,children:void 0},bdit:{category:A.CharacterStyling,type:M.Character,description:"A character style, use bold + italic text",hasEndMarker:!0,children:void 0},em:{category:A.CharacterStyling,type:M.Character,description:"A character style, use emphasized text style",hasEndMarker:!0,children:void 0},sc:{category:A.CharacterStyling,type:M.Character,description:"A character style, for small capitalization text",hasEndMarker:!0,children:void 0},sup:{category:A.CharacterStyling,type:M.Character,description:"A character style, for superscript text. Typically for use in critical edition footnotes.",hasEndMarker:!0,children:void 0},pb:{category:A.Breaks,type:M.Paragraph,description:"Page Break used for new reader portions and children's bibles where content is controlled by the page",hasEndMarker:!1,children:void 0}},Ar={DivisionMarks:{add:["v","c"],remove:[]},Paragraphs:{add:["p"],remove:[]},Poetry:{add:["q","q1","q2","q3","q4","b"],remove:[]},TitlesHeadings:{add:["mte","ms","ms1","ms2","ms3","s","s1","s2","s3","s4","r","sp","d","sd","sd1","sd2","sd3","sd4"],remove:[]}},yT={p:{children:Ar},q:{children:Ar},q1:{children:Ar},q2:{children:Ar},q3:{children:Ar},q4:{children:Ar},b:{children:Ar},qm:{children:{Paragraphs:{add:["p"],remove:[]}}},c:{type:M.Paragraph,children:null},v:{children:null}};function rp(n){const e=mT[n],t=yT[n];if(!e)return;if(!t)return e;let r=e.children?{...e.children}:void 0;if(t.children===null&&(r=void 0),t.children){r=r||{};for(const[i,s]of Object.entries(t.children)){const o=i;if(s===null)Reflect.deleteProperty(r,o);else{let a=r[o]||[];s.remove&&(a=a.filter(l=>!s.remove.includes(l))),s.add&&(a=[...new Set([...a,...s.add])]),a.length>0?r[o]=a:Reflect.deleteProperty(r,o)}}Object.keys(r).length===0&&(r=void 0)}return{...e,...t,children:r}}function ip(n,e,t){const r={type:Oi,version:Ai,content:n},i=e.serializeEditorState(r,t);return mf(i.root.children[0])?i.root.children[0].children[0]:i.root.children[0]}const Qb=1;class Vt extends pr{constructor(e=Jr,t="",r,i){super(i),Q(this,"__caller"),Q(this,"__previewText"),Q(this,"__onClick"),this.__caller=e,this.__previewText=t,this.__onClick=r??(()=>{})}static getType(){return"immutable-note-caller"}static clone(e){const{__caller:t,__previewText:r,__onClick:i,__key:s}=e;return new Vt(t,r,i,s)}static importDOM(){return{span:e=>bT(e)?{conversion:_T,priority:1}:null}}static importJSON(e){return Tf().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setCaller(e.caller).setPreviewText(e.previewText).setOnClick(e.onClick)}setCaller(e){if(this.__caller===e)return this;const t=this.getWritable();return t.__caller=e,t}getCaller(){return this.getLatest().__caller}setPreviewText(e){if(this.__previewText===e)return this;const t=this.getWritable();return t.__previewText=e,t}getPreviewText(){return this.getLatest().__previewText}setOnClick(e){if(this.__onClick===e)return this;const t=this.getWritable();return t.__onClick=e,t}getOnClick(){return this.getLatest().__onClick}createDOM(){const e=document.createElement("span");return e.classList.add(this.__type),e.setAttribute("data-caller",this.__caller),e.setAttribute("data-preview-text",this.__previewText),e}updateDOM(e){return e.__caller!==this.__caller}exportDOM(e){const{element:t}=super.exportDOM(e);return t&&Te(t)&&(t.classList.add(this.getType()),t.setAttribute("data-caller",this.getCaller()),t.setAttribute("data-preview-text",this.getPreviewText())),{element:t}}decorate(e){const t=this.getParent();if(!t)return null;const r=t.getKey(),i=t.getIsCollapsed(),s=this.__key,o=l=>{var c;return(c=this.__onClick)==null?void 0:c.call(this,l,r,i,()=>vT(e,r),u=>kT(e,r,s,u))},a=`${this.__caller}_${this.__previewText}}`.replace(/\s+/g,"").substring(0,25);return S.jsx("button",{onClick:o,title:this.__previewText,"data-caller-id":a,children:this.__caller===Jr&&i?"":this.__caller})}exportJSON(){return{type:this.getType(),caller:this.getCaller(),previewText:this.getPreviewText(),onClick:this.getOnClick(),version:Qb}}isKeyboardSelectable(){return!1}}function _T(n){const e=n.getAttribute("data-caller")??"",t=n.getAttribute("data-preview-text")??"";return{node:Tf(e,t)}}function Tf(n,e,t){return Me(new Vt(n,e,t))}function bT(n){return n?n.classList.contains(Vt.getType()):!1}function kr(n){return n instanceof Vt}function vT(n,e){return n.read(()=>{const t=de(e);if(!ye(t))throw new Error(`getCaller: Note node not found: ${e}`);return t.getCaller()})}function kT(n,e,t,r){n.update(()=>{const i=de(e);if(!ye(i))throw new Error(`setCaller: Note node not found: ${e}`);i.setCaller(r);const s=de(t);if(!kr(s))throw new Error(`setCaller: Caller node not found: ${t}`);s.setCaller(r)})}const xT=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],ev="v",tv=1;class bt extends pr{constructor(e="",t=!1,r,i,s,o,a){super(a),Q(this,"__marker"),Q(this,"__number"),Q(this,"__showMarker"),Q(this,"__sid"),Q(this,"__altnumber"),Q(this,"__pubnumber"),Q(this,"__unknownAttributes"),this.__marker=ev,this.__number=e,this.__showMarker=t,this.__sid=r,this.__altnumber=i,this.__pubnumber=s,this.__unknownAttributes=o}static getType(){return"immutable-verse"}static clone(e){const{__number:t,__showMarker:r,__sid:i,__altnumber:s,__pubnumber:o,__unknownAttributes:a,__key:l}=e;return new bt(t,r,i,s,o,a,l)}static importDOM(){return{span:e=>wT(e)?{conversion:CT,priority:1}:null}}static importJSON(e){return Ef().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setNumber(e.number).setShowMarker(e.showMarker).setSid(e.sid).setAltnumber(e.altnumber).setPubnumber(e.pubnumber).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}setNumber(e){if(this.__number===e)return this;const t=this.getWritable();return t.__number=e,t}getNumber(){return this.getLatest().__number}setShowMarker(e=!1){if(this.__showMarker===e)return this;const t=this.getWritable();return t.__showMarker=e,t}getShowMarker(){return this.getLatest().__showMarker}setSid(e){if(this.__sid===e)return this;const t=this.getWritable();return t.__sid=e,t}getSid(){return this.getLatest().__sid}setAltnumber(e){if(this.__altnumber===e)return this;const t=this.getWritable();return t.__altnumber=e,t}getAltnumber(){return this.getLatest().__altnumber}setPubnumber(e){if(this.__pubnumber===e)return this;const t=this.getWritable();return t.__pubnumber=e,t}getPubnumber(){return this.getLatest().__pubnumber}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("span");return e.setAttribute("data-marker",this.__marker),e.classList.add(Hu,`usfm_${this.__marker}`),this.__showMarker&&e.classList.add("marker"),e.setAttribute("data-number",this.__number),e}updateDOM(){return!1}exportDOM(e){const{element:t}=super.exportDOM(e);return t&&Te(t)&&(t.setAttribute("data-marker",this.getMarker()),t.classList.add(Hu,`usfm_${this.getMarker()}`),t.setAttribute("data-number",this.getNumber())),{element:t}}decorate(){return S.jsx("span",{children:this.getShowMarker()?ko(this.getMarker(),this.getNumber()):Ku+this.getNumber()+Ku})}exportJSON(){return{type:this.getType(),marker:this.getMarker(),number:this.getNumber(),showMarker:this.getShowMarker(),sid:this.getSid(),altnumber:this.getAltnumber(),pubnumber:this.getPubnumber(),unknownAttributes:this.getUnknownAttributes(),version:tv}}isKeyboardSelectable(){return!1}}function CT(n){const e=n.getAttribute("data-number")??"0";return{node:Ef(e)}}function Ef(n,e,t,r,i,s){return Me(new bt(n,e,t,r,i,s))}function wT(n){return((n==null?void 0:n.getAttribute("data-marker"))??void 0)===ev}function as(n){return n instanceof bt}function ST(n){return(n==null?void 0:n.type)===bt.getType()}function Qu(n,e){if(!n||!z(n))return[void 0,void 0];const t=n.getTextContent();if(e>=0&&e<t.length)return[n,e];let r=n.getNextSibling();if(!r){const s=n.getParent();rt(s)&&(r=s.getNextSibling())}if(!r||!rt(r)&&!z(r))return[void 0,void 0];const i=e-t.length;return r&&z(r)?Qu(r,i):Qu(r.getFirstChild()??void 0,i)}function sp(n){const e=Iv(n.jsonPath);let t=pe();for(const r of e){if(!t||!j(t))return[void 0,void 0];t=t.getChildAtIndex(r)??void 0}return Qu(t,n.offset)}function op(n){return j(n)?"element":"text"}function Nf(n){const{start:e}=n;let{end:t}=n;t===void 0&&(t=e);const[r,i]=sp(e),[s,o]=sp(t);if(!r||!s||i===void 0||o===void 0)return;const a=fo();return a.anchor=wt(r.getKey(),i,op(r)),a.focus=wt(s.getKey(),o,op(s)),a}function ap(n,e){const t=[];let r=n;for(;r!=null&&r.getParent();){const i=r.getParent();if(i){const s=i==null?void 0:i.getChildren().indexOf(r);s>=0&&t.unshift(s)}r=i}return{jsonPath:Rv(t),offset:e}}function nv(){const n=K();if(!n||!B(n))return;const e=n.isBackward()?n.focus.getNode():n.anchor.getNode(),t=n.isBackward()?n.focus.offset:n.anchor.offset,r=ap(e,t);if(n.isCollapsed())return{start:r};const i=n.isBackward()?n.anchor.getNode():n.focus.getNode(),s=n.isBackward()?n.anchor.offset:n.focus.offset,o=ap(i,s);return{start:r,end:o}}function Dt(n){return bf(n)||as(n)}function TT(n){return W1(n)||ST(n)}function ET(n,e,t,r,i,s){if(!Ve.isValidMarker(n))throw new Error(`$insertNote: Invalid note marker '${n}'`);const o=t?Nf(t):K();if(!B(o))return;const a=NT(o,n,r),l=iv(n,e,a,i,s);return rv(l,o,i),l}function rv(n,e,t){const r=(t==null?void 0:t.noteMode)==="collapsed";if(n.setIsCollapsed(r),e.isCollapsed()||Z1(e),e.insertNodes([n]),!r){const i=n.getChildren().reverse().find(Ie);i==null||i.selectEnd()}}function NT(n,e,t){const r=[],{chapterNum:i,verseNum:s}=t??{};switch(e){case"f":case"fe":case"ef":if(i!==void 0&&s!==void 0&&r.push(dn("fr").append(ue(`${i}:${s}`))),!n.isCollapsed()){const o=n.getTextContent().trim();if(o.length>0){const a=dn("fq");a.append(ue(o)),r.push(a)}}r.push(dn("ft").append(ue("-")));break;case"x":case"ex":i!==void 0&&s!==void 0&&r.push(dn("xo").append(ue(`${i}:${s}`))),r.push(dn("xt").append(ue("-")));break}return r}function iv(n,e,t,r,i,s){const o=(r==null?void 0:r.noteMode)!=="expanded",a=yf(n,e,o);s&&$n(a,Ji,()=>s);let l,c;(r==null?void 0:r.markerMode)==="editable"?(l=Zu(n),c=Zu(n,"closing")):(r==null?void 0:r.markerMode)==="visible"&&(l=ol("marker",_r(n)+Ne),c=ol("marker",ro(n)+Ne));let u;if(l&&a.append(l),(r==null?void 0:r.markerMode)==="editable")u=ue(xf(a.__caller)),a.append(u,...t);else{const f=()=>ue(Ne),d=Cf(t);let h=()=>{};i!=null&&i.noteCallerOnClick&&(h=i.noteCallerOnClick),u=Tf(a.__caller,d,h);const p=t.flatMap(OT(f));a.append(u,f(),...p)}return c&&a.append(c),a}function MT(n){var e;if(typeof n=="string"){const i=de(n);return ye(i)?i:void 0}const t=Tl();if(t.length<=0)return;const r=(e=t.filter(i=>ye(i.node))[n])==null?void 0:e.node;if(ye(r))return r}function AT(n,e){const t=(e==null?void 0:e.noteMode)==="collapsed";if(n.setIsCollapsed(t),t){const r=n.getPreviousSibling();if(as(r)||!r){const i=n.getParent();if(i){const s=n.getIndexWithinParent();i.select(s,s)}}else r.selectEnd()}else{const r=n.getChildren().reverse().find(Ie);r==null||r.selectEnd()}}function OT(n){return e=>al(e)?[e]:[e,n()]}function $T(n){return n.find(e=>dt(e))}function PT(n,e){return j(n)?n.getChildren().find(t=>Dt(t)&&wf(e,t.getNumber())):void 0}function IT(n,e){return e===0?$T(n):n.map(t=>PT(t,e)).filter(t=>t)[0]}function lp(n){return!n||!j(n)?void 0:n.getChildren().findLast(e=>Dt(e))}function sv(n){var e,t;if(!n||Lt(n))return;if(Dt(n))return n;let r=rt(n.getParent())?(e=n.getParent())==null?void 0:e.getPreviousSibling():n.getPreviousSibling();for(;r&&!Dt(r)&&!Lt(r);)r=r.getPreviousSibling();if(r&&Dt(r))return r;let i=(t=n.getTopLevelElement())==null?void 0:t.getPreviousSibling(),s=lp(i),o=s;for(;i&&!s&&!Lt(i);)s=o,i=i.getPreviousSibling(),o=lp(i);if(!(!s&&Lt(i)))return s}function RT(n){return V1(n)||as(n)}function Mf(n){if(z(n)){const e=n.getTextContent();!e.endsWith(" ")&&!e.endsWith(Ne)&&n.setTextContent(`${e} `)}}function ov(n){if(z(n)){const e=n.getTextContent();e.startsWith(" ")&&n.setTextContent(e.trimStart())}}function Af(n,e){return n.getEditorState().read(()=>!de(e))}const LT=[Vt,bt,...pT],DT=x.forwardRef((n,e)=>{const{coords:t,children:r,style:i,...s}=n,o=t!==void 0;return S.jsx("div",{ref:e,className:"floating-box","aria-hidden":!o,style:{...i,position:"absolute",zIndex:1e3,top:t==null?void 0:t.y,left:t==null?void 0:t.x,visibility:o?"visible":"hidden",opacity:o?1:0},...s,children:r})});function jT(){const[n,e]=x.useState(void 0),[t,r]=x.useState(),i=x.useRef(null),s=x.useCallback((a,l)=>{i.current&&i.current();const c=a.commonAncestorContainer.nodeType===a.commonAncestorContainer.TEXT_NODE?a:a.commonAncestorContainer;i.current=Dv(c,l,()=>{jv(c,l,{placement:"bottom-start",middleware:[Fv(),qv()]}).then(u=>{r(u.placement),e(f=>(f==null?void 0:f.x)===u.x&&(f==null?void 0:f.y)===u.y?f:{x:u.x,y:u.y})}).catch(()=>{e(void 0)})})},[]),o=x.useCallback(()=>{i.current&&(e(void 0),i.current(),i.current=null)},[]);return x.useEffect(()=>o,[o]),{coords:n,placement:t,updatePosition:s,cleanup:o}}function FT({isOpen:n,floatingBoxRef:e}){const{coords:t,updatePosition:r,cleanup:i,placement:s}=jT();return x.useEffect(()=>{var o;if(!n||!e.current){i();return}const a=(o=window.getSelection())==null?void 0:o.getRangeAt(0);if(!a){i();return}return r(a,e.current),i},[i,n,e,r]),{coords:t,placement:s}}const qT=document.body,BT=x.memo(DT);function UT({isOpen:n=!1,children:e}){const t=x.useRef(null),{coords:r,placement:i}=FT({isOpen:n,floatingBoxRef:t}),s=x.useMemo(()=>r?typeof e=="function"?e:()=>e:()=>null,[e,r]);return Nt.createPortal(S.jsx(BT,{ref:t,coords:r,style:r?void 0:{display:"none"},children:s({isOpen:n,placement:i})}),qT)}const av=x.createContext(void 0);function Of(){const n=x.useContext(av);if(!n)throw new Error("useMenuContext must be used within a MenuProvider");return n}function zT(n,e){const[t,r]=x.useState(0),[i,s]=x.useState(-1),o=x.useMemo(()=>n??[],[n]),a={menuItems:o,activeIndex:t,selectedIndex:i,onSelectOption:e??(()=>{})},l=x.useCallback(()=>{r(f=>{const d=o.length;return d?(f-1+d)%d:0})},[o.length]),c=x.useCallback(()=>{r(f=>{const d=o.length;return d?(f+1)%d:0})},[o.length]),u=x.useCallback(()=>{const f=o.length;if(t>=0&&t<f){const d=o[t];e==null||e(d),s(t)}},[t,o,e]);return{state:a,moveUp:l,moveDown:c,select:u,setActiveIndex:r,setSelectedIndex:s}}function WT({children:n,menuItems:e,onSelectOption:t,...r}){const i=zT(e,t);return S.jsx(av.Provider,{value:i,children:S.jsx("div",{...r,children:n})})}const lv=x.forwardRef(({index:n,children:e,onMouseEnter:t,onClick:r,...i},s)=>{const{state:{activeIndex:o},setActiveIndex:a,setSelectedIndex:l,select:c}=Of(),u=x.useCallback(d=>{c(),l(-1),r==null||r(d)},[r,c,l]),f=x.useCallback(d=>{a(n),t==null||t(d)},[n,a,t]);return S.jsx("button",{ref:s,role:"menuitem",...i,onClick:u,onMouseEnter:f,"aria-selected":n!==void 0&&o===n?"true":void 0,tabIndex:-1,children:e})});function KT({children:n,autoIndex:e=!0,...t}){const r=x.useRef(null),{state:{activeIndex:i,menuItems:s}}=Of(),o=x.useMemo(()=>s?typeof n=="function"?n:()=>n:()=>null,[n,s]),a=x.useMemo(()=>{const l=o(s);return e?x.Children.map(l,(c,u)=>x.isValidElement(c)&&c.type===lv&&c.props.index===void 0?x.cloneElement(c,{index:u}):c):l},[o,e,s]);return x.useEffect(()=>{if(r.current){const l=r.current,c=l.children[i];if(c){const u=l.getBoundingClientRect(),f=c.getBoundingClientRect();f.bottom>u.bottom?l.scrollTop+=f.bottom-u.bottom:f.top<u.top&&(l.scrollTop-=u.top-f.top)}}},[i]),S.jsx("div",{ref:r,role:"menu",...t,children:a})}const eu={Root:WT,Options:KT,Option:lv},HT=(n,e,t)=>Ma(n,t).toLowerCase().includes(e.toLowerCase()),cp=n=>Object.keys(n).find(e=>typeof n[e]=="string")||"",Ma=(n,e)=>{const t=n[e];return typeof t=="string"?t:String(t)};function JT(n){const{query:e,items:t,filterBy:r,filter:i,sortBy:s,sortingOptions:o}=n,{caseSensitive:a=!1,priorityOrder:l=["exact","startsWith","contains"]}=o||{},c=a?e:e.toLowerCase();let u,f;i?(f=i,u=t.length>0?cp(t[0]):""):(u=r||(t.length>0?cp(t[0]):""),f=(p,m)=>HT(p,m,u));const d=s||u,h=new Map;return t.filter(p=>{try{return f(p,e)}catch(m){return console.warn("Error filtering item:",p,m),!1}}).sort((p,m)=>{const y=C=>(h.has(C)||h.set(C,Ma(C,d).toLowerCase()),h.get(C)??""),b=a?Ma(p,d):y(p),_=a?Ma(m,d):y(m);for(const C of l)switch(C){case"exact":if(b===c&&_!==c)return-1;if(_===c&&b!==c)return 1;break;case"startsWith":if(b.startsWith(c)&&!_.startsWith(c))return-1;if(_.startsWith(c)&&!b.startsWith(c))return 1;break;case"contains":{const E=b.indexOf(c),O=_.indexOf(c);if(E!==-1&&O===-1)return-1;if(O!==-1&&E===-1)return 1;if(E!==-1&&O!==-1)return E-O;break}}return b.localeCompare(_)})}function VT(n){const{query:e,items:t,filterBy:r,filter:i,sortBy:s,sortingOptions:o}=n;return x.useMemo(()=>JT({query:e,items:t,filterBy:r,filter:i,sortBy:s,sortingOptions:o}),[e,t,r,i,s,o])}function GT(){const{moveUp:n,moveDown:e,select:t}=Of();return x.useMemo(()=>({moveUp:n,moveDown:e,select:t}),[n,e,t])}const YT=()=>{const n=GT(),[e]=ge();x.useEffect(()=>{const t=r=>{const i={ArrowDown:()=>n==null?void 0:n.moveDown(),ArrowUp:()=>n==null?void 0:n.moveUp(),Enter:()=>n==null?void 0:n.select(),Tab:()=>n==null?void 0:n.select()}[r.key];return i?(i(),r.preventDefault(),r.stopPropagation(),!0):!1};return e.registerCommand(Gi,t,_l)},[e,n])};function XT(){return YT(),null}function ZT(n){const{options:e,onSelectOption:t,onClose:r,inverse:i,query:s,menuOpenKey:o}=n,[a]=ge(),l=s!==void 0,[c,u]=x.useState(""),f=l?s??"":c,d=VT({query:f,items:e,filterBy:"name"}),h=p=>{r==null||r(),t?t(p):p.action(a)};return x.useEffect(()=>a.registerCommand(Gi,p=>{if(l)return!1;const m={Escape:()=>r==null?void 0:r(),Backspace:()=>{f.length===0?r==null||r():u(y=>y.slice(0,-1))}}[p.key];return m?(p.stopPropagation(),p.preventDefault(),m(),!0):p.key.length===1?(p.stopPropagation(),p.preventDefault(),p.key!==o&&u(y=>y+p.key),!0):!1},_l),[a,l,f,o,r]),S.jsxs(eu.Root,{className:`autocomplete-menu-container ${i?"inverse":""}`,menuItems:d,onSelectOption:p=>h(p),children:[!l&&S.jsx("input",{value:f,type:"text",disabled:!0}),S.jsx(XT,{}),S.jsx(eu.Options,{className:"autocomplete-menu-options",autoIndex:!1,children:p=>p.map((m,y)=>S.jsxs(eu.Option,{index:y,children:[S.jsx("span",{className:"label",children:m.label??m.name}),S.jsx("span",{className:"description",children:m.description})]},m.name))})]})}function QT({trigger:n,items:e}){const[t]=ge(),[r,i]=x.useState(!1),s=x.useCallback(o=>{o.key==="Escape"&&r?(i(!1),t.focus()):o.key===n&&!r&&(o.preventDefault(),i(!0))},[t,n,r]);return x.useEffect(()=>t.registerRootListener(o=>{if(o)return o.addEventListener("keydown",s),()=>{o.removeEventListener("keydown",s)}}),[t,s]),x.useEffect(()=>t.registerUpdateListener(({prevEditorState:o,editorState:a})=>{const l=o.read(()=>{const c=K();if(B(c))return c});a.read(()=>{const c=K();!B(c)||l!=null&&l.is(c)||i(!1)})}),[t]),e&&S.jsx(UT,{isOpen:r,children:({placement:o})=>S.jsx(ZT,{options:e,onClose:()=>i(!1),inverse:o==="top-start",menuOpenKey:n})})}function eE({scriptureReference:n,contextMarker:e,getMarkerAction:t}){return{markersMenuItems:x.useMemo(()=>{if(!e||!n)return;const r=rp(e);if(r!=null&&r.children)return Object.values(r.children).flatMap(i=>i.map(s=>{const o=rp(s),{action:a}=t(s,o);return{name:s,label:s,description:(o==null?void 0:o.description)??"",action:l=>{a({editor:l,reference:n})}}}))},[e,t,n])}}function Aa(n,e){return`${n}:${e}`}function tE(n,e){x.useEffect(()=>{if(!n.hasNodes([tt]))throw new Error("AnnotationPlugin: TypedMarkNode not registered on editor!");const t=new Map;return He(Ky(n,tt,r=>io(r.getTypedIDs()),(r,i)=>{for(const[s,o]of Object.entries(r.getTypedIDs()))o.forEach(a=>{i.addID(s,a)})}),n.registerMutationListener(tt,r=>{n.getEditorState().read(()=>{for(const[i,s]of r){const o=de(i);let a={};s==="destroyed"?a=t.get(i)??{}:rt(o)&&(a=o.getTypedIDs());for(const[l,c]of Object.entries(a))if(!tt.isReservedType(l))for(const u of c){let f=e.get(Aa(l,u));a[l]=c,t.set(i,a),s==="destroyed"?f!==void 0&&(f.delete(i),f.size===0&&e.delete(Aa(l,u))):(f===void 0&&(f=new Set,e.set(Aa(l,u),f)),f.has(i)||f.add(i))}}})},{skipInitialization:!0}))},[n,e])}const nE=x.forwardRef(function({logger:n},e){const[t]=ge(),r=x.useMemo(()=>new Map,[]);return tE(t,r),x.useImperativeHandle(e,()=>({addAnnotation(i,s,o){if(tt.isReservedType(s))throw new Error(`addAnnotation: Can't directly add this reserved annotation type '${s}'. Use the appropriate plugin instead.`);t.update(()=>{const a=Nf(i);if(a===void 0){n==null||n.error("Failed to find start or end node of the annotation.");return}Gb(a,s,o)},{tag:Vu})},removeAnnotation(i,s){if(tt.isReservedType(i))throw new Error(`removeAnnotation: Can't directly remove this reserved annotation type '${i}'. Use the appropriate plugin instead.`);const o=r.get(Aa(i,s));o!==void 0&&setTimeout(()=>{t.update(()=>{for(const a of o){const l=de(a);rt(l)&&(l.deleteID(i,s),l.hasNoIDsForEveryType()&&Vb(l))}},{tag:Vu})})}})),null}),so=`
`;function ur(n){return Lt(n)||Dt(n)||Il(n)||ye(n)||Zb(n)}function _n(n){return Wt(n)||mn(n)}function cv(n,e){if(!n)return!1;if(!e)return!0;let t=e.node.getParent();for(;t;){if(t===n)return!1;t=t.getParent()}return!0}function ed(n,e){const t={insert:n.__text},r=Ii(n,Ji);if(r&&(t.attributes={segment:r}),e&&e.length>0){let i=e.map(s=>{const o={style:s.__marker},a=Ii(s,lr);return a&&(o.cid=a),o});i.length===1&&(i=i[0]),t.attributes={...t.attributes,char:i}}return t}function up(n){const e=new Rs;return n.isEmpty()||n.read(()=>{const t=pe();if(!t||t.isEmpty())return;const r=t.getChildren();if(r.length===1&&Fn(r[0])&&(!r[0].getChildren()||r[0].getChildrenSize()===0))return;const i=rE();for(const s of i)e.push(s)}),e}function rE(){const n=[],e=Tl(),t=[],r=[],i={children:[],contentsOps:[]};for(let s=0;s<e.length;s++){const o=e[s].node;n.push(...dp(o,s,e,t,r,i))}for(const s of t)n.push(...dp(s,e.length,e,t,r,i));return n}function dp(n,e,t,r,i,s){if(!n)return[];const o=[];return iE(n,o,r),sE(n,o,i,s),oE(n,e,t,i),Lt(n)&&o.push(cE(n)),Dt(n)&&o.push(dE(n)),Il(n)&&o.push(fE(n)),Zb(n)&&o.push(hE(n)),aE(n,o,s),o}function iE(n,e,t){if(!n.isInline()){const r=t.pop();mn(r)?e.push(lE(r)):dt(r)?e.push(uE(r)):Fn(r)&&e.push({insert:so})}_n(n)&&(t.includes(n)||t.push(n))}function sE(n,e,t,r){var i;if(!z(n))return;const s=n.getParent();if(ye(s)&&s.getFirstChild()===n)return;const o=ed(n,t);if(r.children.includes(n)){const a=n.getTextContent();if(!a||a===Ne||a.startsWith(cf))return;(i=r.contentsOps)==null||i.push(o)}else e.push(o)}function oE(n,e,t,r){Ie(n)&&!r.includes(n)&&r.push(n);const i=t[e+1];for(const s of r.toReversed())cv(s,i)&&r.pop()}function aE(n,e,t){var r;if(!ye(n))return;Tl(n).forEach(s=>t.children.push(s.node));const i=gE(n);t.contentsOps=(r=i.insert.note.contents)==null?void 0:r.ops,e.push(i)}function lE(n){const e={style:Pl,code:n.__code};return{insert:so,attributes:{book:e}}}function cE(n){const e={style:hf,number:n.__number};return n.__sid&&(e.sid=n.__sid),n.__altnumber&&(e.altnumber=n.__altnumber),n.__pubnumber&&(e.pubnumber=n.__pubnumber),{insert:{chapter:e}}}function uE(n){const e={style:n.__marker};return{insert:so,attributes:{para:e}}}function dE(n){const e={style:_f,number:n.__number};return n.__sid&&(e.sid=n.__sid),n.__altnumber&&(e.altnumber=n.__altnumber),n.__pubnumber&&(e.pubnumber=n.__pubnumber),{insert:{verse:e}}}function fE(n){const e={style:n.__marker};return n.__sid&&(e.sid=n.__sid),n.__eid&&(e.eid=n.__eid),{insert:{milestone:e}}}function hE(n){return{insert:{unmatched:{marker:n.__marker}}}}function gE(n){const e={style:n.__marker,caller:n.__caller};return n.__category&&(e.category=n.__category),n.getChildrenSize()>1&&(e.contents={ops:[]}),{insert:{note:e}}}function pE({ignoreHistoryMergeTagChange:n=!0,ignoreSelectionChange:e=!1,onChange:t}){const[r]=ge();return x.useLayoutEffect(()=>{if(t)return r.registerUpdateListener(i=>{const{editorState:s,dirtyElements:o,dirtyLeaves:a,prevEditorState:l,tags:c}=i;if(e&&o.size===0&&a.size===0||n&&c.has(Ir)||l.isEmpty())return;const u=mE(r,i);u.length!==0&&t(s,r,c,u)})},[r,n,e,t]),null}function mE(n,{dirtyLeaves:e,prevEditorState:t}){let r=new Rs;return n.getEditorState().read(()=>{const i=e.values().next().value??"";if(e.size===1&&z(de(i))){const s=de(i),o=yE(s);if(z(s)){const a=t.read(()=>{const u=de(i);return new Rs([z(u)?ed(u):{insert:""}])}),l=new Rs([ed(s)]),c=new Rs(o>0?[{retain:o}]:[]);r=r.concat(c).concat(a.diff(l))}}else{const s=up(t),o=up(n.getEditorState());r=s.diff(o)}}),r.ops}function yE(n){if(!n)return 0;const e=Tl(),t=[];let r=0;for(let i=0;i<e.length;i++){const s=e[i].node;if(s===n)return r;r+=_E(s,i,e,t)}return r}function _E(n,e,t,r){return z(n)?n.getTextContent().length:ur(n)?1:_n(n)?bE(n,e,t,r):0}function bE(n,e,t,r){if(r.includes(n)||r.push(n),cv(n,t[e+1])){const i=r.indexOf(n);return i>-1&&r.splice(i,1),1}return 0}const vE=["style"],kE=["style","code"],cl=["style","cid"],xE=["style","number","sid","altnumber","pubnumber"],CE=["style","number","sid","altnumber","pubnumber"],wE=["style","sid","eid"],SE=["style","caller","category","contents"];function TE(n,e,t,r){let i=0;n.forEach(s=>{if("retain"in s)i+=EE(s,i,r);else if("delete"in s){if(typeof s.delete!="number"||s.delete<=0){r==null||r.error(`Invalid delete operation: ${JSON.stringify(s)}`);return}r==null||r.debug(`Delete: ${s.delete}`),ME(i,s.delete,r)}else"insert"in s?typeof s.insert=="string"?(r==null||r.debug(`Insert: '${s.insert}'`),i+=AE(i,s.insert,s.attributes,r)):typeof s.insert=="object"&&s.insert!==null?(r==null||r.debug(`Insert embed: ${JSON.stringify(s.insert)}`),$E(i,s,e,t,r)?i+=1:r==null||r.error(`Failed to process insert embed operation: ${JSON.stringify(s.insert)} at index ${i}. Document may be inconsistent.`)):r==null||r.error(`Insert of unknown type: ${JSON.stringify(s.insert)}`):r==null||r.error(`Unknown operation: ${JSON.stringify(s)}`)})}function EE(n,e,t){return typeof n.retain!="number"||n.retain<0?(t==null||t.error(`Invalid retain operation: ${JSON.stringify(n)}`),0):(t==null||t.debug(`Retain: ${n.retain}`),n.attributes&&(t==null||t.debug(`Retain attributes: ${JSON.stringify(n.attributes)}`),NE(e,n.retain,n.attributes,t)),n.retain)}function NE(n,e,t,r){r==null||r.debug(`Applying attributes for range [${n}, ${n+e-1}] with attributes: ${JSON.stringify(t)}`);let i=e,s=0,o=-1;const a=pe();function l(c){if(i<=0)return!0;if(z(c)){const u=c.getTextContentSize();if(n<s+u&&s<n+e){const f=Math.max(0,n-s),d=u-f,h=Math.min(i,d);if(h>0){let p=c;const m=f>0,y=h<u-f;if(m&&y){const[,b]=c.splitText(f);[p]=b.splitText(h)}else m?[,p]=c.splitText(f):y&&([p]=c.splitText(h));if(Gr(t)){const b=p.getParent();if(Ie(b)){const _=t.char;let C;Array.isArray(_)?o>=0&&o<=_.length-1&&(C=_[o]):o===0&&(C=_);const E=C?Yu(C,b):!1;if(E&&Array.isArray(_)&&_.length>1){const O=ue("");p.replace(O);const N=typeof t.segment=="string"?t.segment:void 0,D=Rl(_.slice(1),p,N);O.replace(D),It(t,p)}else if(E)It(t,p);else{const O=ue("");p.replace(O);const N=fp(p,t,r);N?b.insertAfter(N):O.replace(p)}}else{const _=ue("");p.replace(_);const C=fp(p,t,r);C?_.replace(C):_.replace(p)}}else It(t,p);i-=h}}s+=u}else if(ur(c))n<=s&&s<n+e&&i>0&&(hp(c,t),i-=1),s+=1;else if(Ie(c)){o+=1;let u=!1;if(n<=s&&s<n+e&&i>0)if(Gr(t)){const f=t.char;let d;if(Array.isArray(f)?o>=0&&o<=f.length-1&&(d=f[o]):o===0&&(d=f),d){c.setMarker(d.style),typeof d.cid=="string"&&$n(c,lr,()=>d.cid);const h=Ge(d,cl);h&&Object.keys(h).length>0?c.setUnknownAttributes({...c.getUnknownAttributes()??{},...h}):c.setUnknownAttributes(void 0)}}else(t.char===!1||t.char===null||qE(t.char))&&(u=!0);if(i>0){const f=c.getChildren();for(const d of f){if(i<=0)break;if(l(d)&&i<=0)return u&&Lh(c),!0}}u&&Lh(c),o-=1}else if(_n(c)){const u=c.getChildren();for(const d of u){if(i<=0)break;if(l(d)&&i<=0)return!0}const f=1;if(n<=s&&s<n+i&&i>0){if(!Fn(c))hp(c,t);else if($f(t)){const d=dv(t.para);d&&c.replace(d,!0)}i-=f}s+=f}else if(j(c)){const u=c.getChildren();for(const f of u){if(i<=0)break;if(l(f)&&i<=0)return!0}}return i<=0}l(a),i>0&&(r==null||r.warn(`$applyAttributes: Not all characters in the retain operation (length ${e}) could be processed. Remaining: ${i}. targetIndex: ${n}, final currentIndex: ${s}`))}function fp(n,e,t){var r;const i=typeof e.segment=="string"?e.segment:void 0,s=Rl(e.char,n,i);if(!Ie(s)){t==null||t.error(`Failed to create CharNode for text transformation. Style: ${Array.isArray(e.char)?e.char[0].style:(r=e.char)==null?void 0:r.style}. Falling back to standard text attributes.`),It(e,n);return}const o={};fv.forEach(c=>{n.hasFormat(c)&&(o[c]="true")});const a={};Object.entries(e).forEach(([c,u])=>{c==="segment"||c==="char"||(typeof u=="string"?a[c]=u:u===!0?a[c]="true":u===!1&&(a[c]="false"))});const l={...s.getUnknownAttributes()??{},...o,...a};return Object.keys(l).length>0&&s.setUnknownAttributes(l),It(e,n),s}function hp(n,e){for(const t of Object.keys(e)){const r=e[t];if(t==="char"&&Ie(n)&&Gr(e)){const i=r;if(n.setMarker(i.style),typeof i.cid=="string"){const o=i.cid;$n(n,lr,()=>o)}const s=Ge(i,cl);s&&Object.keys(s).length>0&&n.setUnknownAttributes({...n.getUnknownAttributes()??{},...s});continue}typeof r=="string"&&(Lt(n)||Dt(n)||Il(n)||ye(n)||bo(n)?n.setUnknownAttributes({...n.getUnknownAttributes()??{},[t]:r}):(mn(n)||dt(n)||Ie(n))&&(t==="style"&&!mn(n)?n.setMarker(r):t==="code"&&mn(n)?n.setCode(r):n.setUnknownAttributes({...n.getUnknownAttributes()??{},[t]:r})),t==="segment"&&$n(n,Ji,()=>r))}}function ME(n,e,t){if(e<=0)return;const r=pe();let i=0,s=e;function o(a){if(s<=0)return!0;if(z(a)){let l=a.getTextContentSize();if(n<i+l&&i<n+s){const c=Math.max(0,n-i),u=l-c,f=Math.min(s,u);f>0&&(a.spliceText(c,f,""),a.getTextContentSize()===0&&a.remove(),t==null||t.debug(`Deleted ${f} length from TextNode (key: ${a.getKey()}) at nodeOffset ${c}. Original targetIndex: ${n}, current currentIndex: ${i}.`),s-=f,l-=f)}i+=l}else if(ur(a))n<=i&&i<n+s?(a.remove(),t==null||t.debug(`Deleted embed node (key: ${a.getKey()}) at currentIndex: ${i}. Original targetIndex: ${n}, remainingToDelete: ${s}.`),s-=1):i+=1;else if(_n(a)){const l=a.getChildren().slice(),c=a.getChildren();for(const u of c){if(s<=0)break;if(o(u)&&s<=0)return!0}if(n<=i&&i<n+s&&_n(a)){s-=1;const u=a.getChildren().length;if(l.length>0&&u===0){const f=a.getParent();((f==null?void 0:f.getChildren())??[]).length>1?(a.remove(),t==null||t.debug(`Removed entire ParaNode that had all its content deleted at currentIndex: ${i}. Original targetIndex: ${n}, remainingToDelete: ${s}.`)):(a.replace(Jt(),!0),t==null||t.debug(`Replaced last ParaNode with ImpliedParaNode at currentIndex: ${i}. Original targetIndex: ${n}, remainingToDelete: ${s}.`))}else if(s>0){const f=a.getNextSibling();if(f&&Wt(f)){let d=i+1;const h=f.getChildren();for(const m of h){if(s<=0)break;const y=i;if(i=d,o(m)){i=y;break}z(m)?d+=m.getTextContentSize():ur(m)&&(d+=1),i=y}const p=f.getChildren();for(const m of p)m.remove(),a.append(m);f.remove(),t==null||t.debug(`Merged next paragraph into current one after deleting symbolic close at currentIndex: ${i}. Original targetIndex: ${n}, remainingToDelete: ${s}.`)}else a.replace(Jt(),!0)}else dt(a)?a.replace(Jt(),!0):a.remove()}i+=1}else if(j(a)){const l=a.getChildren();for(const c of l){if(s<=0)break;if(o(c)&&s<=0)return!0}}return s<=0}o(r),s>0&&(t==null||t.warn(`Delete operation could not remove all requested characters. Remaining to delete: ${s}. Original targetIndex: ${n}, OT length: ${e}. Final currentIndex: ${i}`))}function AE(n,e,t,r){if(e===so)return gp(n,t,r);if(e.endsWith(so)&&!$f(t)){const i=e.slice(0,-1);let s=0;if(i.length>0){if(Gr(t))throw new Error("Text + LF should not have char attributes");s+=ul(n,i,t,r)}return s+=gp(n+s,t,r),s}else return Gr(t)?OE(n,e,t,r):ul(n,e,t,r)}function OE(n,e,t,r){r==null||r.debug(`Attempting to insert CharNode with text "${e}" and attributes ${JSON.stringify(t.char)} at index ${n}`);const i=ue(e);It(t,i);let s;{let u=function(h){if(z(h)){const p=h.getTextContentSize();if(n>=d&&n<=d+p){const m=h.getParent();return Ie(m)&&(s=m),!0}d+=p}else if(ur(h))d+=1;else if(Ie(h)){const p=h.getChildren();for(const m of p)if(u(m))return!0}else if(j(h)){const p=h.getChildren();for(const m of p)if(u(m))return!0;_n(h)&&(d+=1)}return!1};const f=pe();let d=0;u(f)}let o=t.char;if(Array.isArray(o)&&s){const u=s.getMarker(),f=Ii(s,lr),d=o[0];d&&d.style===u&&d.cid===f&&(o=o.slice(1),o.length===1&&(o=o[0]))}const a=typeof t.segment=="string"?t.segment:void 0,l=Rl(o,i,a);if(!Ie(l))return r==null||r.error(`CharNode style is missing for text "${e}". Attributes: ${JSON.stringify(t.char)}. Falling back to rich text insertion.`),ul(n,e,void 0,r);const c={};for(const[u,f]of Object.entries(t))u!=="char"&&u!=="segment"&&typeof f=="string"&&(c[u]=f);return Object.keys(c).length>0&&l.setUnknownAttributes(c),uv(n,l,r)?e.length:(r==null||r.error(`Failed to insert CharNode with text "${e}" at index ${n}. Falling back to rich text.`),ul(n,e,void 0,r))}function ul(n,e,t,r){if(e.length<=0)return r==null||r.debug("Attempted to insert empty string. No action taken."),0;const i=pe();let s=0,o=!1;function a(l){if(o)return!0;if(z(l)){const c=l.getTextContentSize();if(n>=s&&n<=s+c){const u=n-s,f=ue(e);if(It(t,f),u===0)l.insertBefore(f);else if(u===c){const d=l.getParent();Ie(d)&&!Gr(t)?d.insertAfter(f):l.insertAfter(f)}else{const[,d]=l.splitText(u);d.insertBefore(f)}return r==null||r.debug(`Inserted text "${e}" in/around TextNode (key: ${l.getKey()}) at nodeOffset ${u}. Original targetIndex: ${n}, currentIndex at node start: ${s}.`),o=!0,!0}s+=c}else if(ur(l))s+=1;else if(Ie(l)){if(!o&&n===s){const u=ue(e);It(t,u);const f=l.getFirstChild();return f?f.insertBefore(u):l.append(u),r==null||r.debug(`Inserted text "${e}" at beginning of CharNode ${l.getType()} (key: ${l.getKey()}).`),o=!0,!0}const c=l.getChildren();for(const u of c){if(a(u))return!0;if(o)break}if(!o&&n===s){const u=ue(e);return It(t,u),l.append(u),r==null||r.debug(`Appended text "${e}" to end of CharNode ${l.getType()} (key: ${l.getKey()}).`),o=!0,!0}}else if(_n(l)){if(!o&&n===s){const u=ue(e);It(t,u);const f=l.getFirstChild();return f?f.insertBefore(u):l.append(u),r==null||r.debug(`Inserted text "${e}" at beginning of container ${l.getType()} (key: ${l.getKey()}).`),o=!0,!0}const c=l.getChildren();for(const u of c){if(a(u))return!0;if(o)break}if(!o&&n===s){const u=ue(e);return It(t,u),l.append(u),r==null||r.debug(`Appended text "${e}" to end of container ${l.getType()} (key: ${l.getKey()}).`),o=!0,!0}s+=1}else if(j(l)){const c=l.getChildren();for(const u of c){if(a(u))return!0;if(o)break}}return o}if(a(i),!o&&n===s){r==null||r.debug(`Insertion point matches end of document (targetIndex: ${n}, final currentIndex: ${s}). Appending text to new ParaNode.`);const l=ue(e);It(t,l);const c=Jt().append(l);i.append(c),o=!0}return o?e.length:(r==null||r.warn(`$insertRichText: Could not find insertion point for text "${e}" at targetIndex ${n}. Final currentIndex: ${s}. Text not inserted.`),0)}function uv(n,e,t){const r=pe();let i=0,s=!1;function o(a){if(s)return!0;if(a===r&&n===0&&!r.getFirstChild())return e.isInline()?(t==null||t.debug(`$insertNodeAtCharacterOffset: Inserting inline node ${e.getType()} into empty root, wrapped in ImpliedParaNode. targetIndex: ${n}`),r.append(Jt().append(e))):(t==null||t.debug(`$insertNodeAtCharacterOffset: Inserting block node ${e.getType()} directly into empty root. targetIndex: ${n}`),r.append(e)),s=!0,!0;if(!j(a))return!1;const l=a.getChildren();for(const c of l){if(n===i&&!s){if(a===r&&e.isInline())if(Wt(c)){t==null||t.debug(`$insertNodeAtCharacterOffset: Inserting inline node ${e.getType()} into existing ${c.getType()} at beginning. targetIndex: ${n}`);const u=c.getFirstChild();u?u.insertBefore(e):c.append(e)}else t==null||t.debug(`$insertNodeAtCharacterOffset: Inserting inline node ${e.getType()} into root before ${c.getType()}, wrapping in ImpliedParaNode. targetIndex: ${n}`),c.insertBefore(Jt().append(e));else c.insertBefore(e),t==null||t.debug(`$insertNodeAtCharacterOffset: Inserted node ${e.getType()} (key: ${e.getKey()}) before child ${c.getType()} (key: ${c.getKey()}) in ${a.getType()} (key: ${a.getKey()}). targetIndex: ${n}, currentIndex: ${i}`);return s=!0,!0}if(z(c)){const u=c.getTextContentSize();if(!s&&n>i&&n<i+u){const f=n-i,[d]=c.splitText(f);return d.insertAfter(e),t==null||t.debug(`$insertNodeAtCharacterOffset: Inserted node ${e.getType()} (key: ${e.getKey()}) by splitting TextNode (key: ${c.getKey()}) at offset ${f}. targetIndex: ${n}, currentIndex at node start: ${i}`),s=!0,!0}i+=u}else if(ur(c))i+=1;else if(Ie(c)){if(o(c))return!0}else if(_n(c)){const u=c;if(o(u))return!0;const f=i;if(Fn(u)&&_n(e)&&n===f&&!s)return t==null||t.debug(`$insertNodeAtCharacterOffset: Replacing ImpliedParaNode (key: ${u.getKey()}) with block node '${e.getType()}' (key: ${e.getKey()}) at OT index ${n}.`),c.replace(e,!0),i=f+1,s=!0,!0;i+=1}else if(j(c)&&o(c))return!0;if(s)return!0}return j(a)&&!s&&(n===i||a===r&&n>i)?a===r?(e.isInline()?(t==null||t.debug(`$insertNodeAtCharacterOffset: Appending inline node ${e.getType()} to root. Wrapping in new ImpliedParaNode. targetIndex: ${n}, current document OT length: ${i}.`),r.append(Jt().append(e))):(t==null||t.debug(`$insertNodeAtCharacterOffset: Appending block node ${e.getType()} to root. targetIndex: ${n}, current document OT length: ${i}.`),r.append(e)),s=!0,!0):Wt(a)?Fn(a)&&dt(e)&&n===i?(t==null||t.debug(`$insertNodeAtCharacterOffset: Replacing ImpliedParaNode container (key: ${a.getKey()}) with ParaNode ${e.getType()} (key: ${e.getKey()}) via append logic. targetIndex: ${n}`),a.replace(e,!0),s=!0,!0):e.isInline()||!Wt(e)?(t==null||t.debug(`$insertNodeAtCharacterOffset: Appending node ${e.getType()} to existing container ${a.getType()} (key: ${a.getKey()}). targetIndex: ${n}, container end OT index: ${i}.`),a.append(e),s=!0,!0):(t==null||t.debug(`$insertNodeAtCharacterOffset: Inserting block node ${e.getType()} after container ${a.getType()} (key: ${a.getKey()}). targetIndex: ${n}, container end OT index: ${i}.`),a.insertAfter(e),s=!0,!0):(e.isInline()||!Wt(e)?(t==null||t.debug(`$insertNodeAtCharacterOffset: Appending node ${e.getType()} to generic element ${a.getType()} (key: ${a.getKey()}). targetIndex: ${n}, element end OT index: ${i}.`),a.append(e)):(t==null||t.debug(`$insertNodeAtCharacterOffset: Inserting block node ${e.getType()} after generic element ${a.getType()} (key: ${a.getKey()}). targetIndex: ${n}, element end OT index: ${i}.`),a.insertAfter(e)),s=!0,!0):s}return o(r),s||t==null||t.warn(`$insertNodeAtCharacterOffset: Could not find insertion point for node ${e.getType()} (key: ${e.getKey()}) at targetIndex ${n}. Final currentIndex: ${i}. Node not inserted.`),s}function $E(n,e,t,r,i){const s=e.insert;let o;return Ns("chapter",s)?o=PE(s.chapter,t):Ns("verse",s)?o=IE(s.verse,t):Ns("ms",s)?o=RE(s.ms):Ns("unmatched",s)?o=LE(s.unmatched):Ns("note",s)&&(o=DE(e,t,r)),o?uv(n,o,i):(i==null||i.error(`$insertEmbedAtCurrentIndex: Cannot create LexicalNode for embed object: ${JSON.stringify(s)}`),!1)}function gp(n,e,t){let r;$f(e)?r=dv(e.para):FE(e)&&(r=jE(e.book)),r??(r=Jt());const i=r,s=dt(i),o=Fn(i);let a=0,l=!1;function c(u){if(l)return!0;if(z(u)){const f=u.getTextContentSize();if(n>=a&&n<=a+f){const d=u.getParent();if(dt(d)&&(s||o)){t==null||t.debug(`Splitting ParaNode (marker: ${d.getMarker()}) with LF attributes at targetIndex ${n}`);const h=n-a,[p]=h>0?u.splitText(h):[void 0];let m=p==null?void 0:p.getPreviousSibling();for(;m;){const y=m;m=m.getPreviousSibling();const b=i.getFirstChild();b?b.insertBefore(y):i.append(y)}return p&&i.append(p),d.insertBefore(i),l=!0,!0}}a+=f}else if(ur(u))a+=1;else if(_n(u)){const f=u.getChildren();for(const d of f){if(c(d))return!0;if(l)break}if(n===a){if(Fn(u)&&i)return t==null||t.debug(`Replacing ImpliedParaNode (key: ${u.getKey()}) with ParaNode at targetIndex ${n}`),u.replace(i,!0),l=!0,!0;if(dt(u)&&i){const d=u;return t==null||t.debug(`Creating new block node with LF attributes after existing ParaNode (marker: ${d.getMarker()}) at targetIndex ${n}`),d.insertAfter(i),l=!0,!0}}if(a+=1,n===a&&dt(u)&&i)return t==null||t.debug(`Creating new block node after existing ParaNode (marker: ${u.getMarker()}) at targetIndex ${n}`),u.insertAfter(i),l=!0,!0}else if(j(u)){const f=u.getChildren();for(const d of f){if(c(d))return!0;if(l)break}}return l}return c(pe()),l||t==null||t.warn(`Could not find location to handle newline with para attributes at targetIndex ${n}. Final currentIndex: ${a}.`),1}function PE(n,e){const{number:t,sid:r,altnumber:i,pubnumber:s}=n;if(!t)return;const o=Ge(n,xE);let a;if(e.markerMode==="editable")a=Mb(t,r,i,s,o);else{const l=e.markerMode==="visible";a=pf(t,l,r,i,s,o)}return a}function IE(n,e){const{style:t,number:r,sid:i,altnumber:s,pubnumber:o}=n;if(!r)return;const a=Ge(n,CE);let l;if(e.markerMode==="editable"){if(!t)return;const c=ko(t,r);l=zb(r,c,i,s,o,a)}else{const c=e.markerMode==="visible";l=Ef(r,c,i,s,o,a)}return l}function RE(n){const{style:e,sid:t,eid:r}=n;if(!e)return;const i=Ge(n,wE);return jb(e,t,r,i)}function LE(n){const{marker:e}=n;if(e)return Sf(e)}function DE(n,e,t){var r;const i=n.insert,{style:s,caller:o,category:a,contents:l}=i.note;if(!s||!o)return;const c=Ge(i.note,SE),u=(r=n.attributes)==null?void 0:r.segment;let f;u&&typeof u=="string"&&(f=u);const d=[];for(const h of(l==null?void 0:l.ops)??[])typeof h.insert=="string"&&(Gr(h.attributes)?d.push(Rl(h.attributes.char,ue(h.insert))):d.push(ue(h.insert)));return iv(s,o,d,e,t,f).setCategory(a).setUnknownAttributes(c)}function jE(n){const{style:e,code:t}=n;if(!e||e!==Pl||!t||!Ft.isValidBookCode(t))return;const r=Ge(n,kE);return Tb(t,r)}function dv(n){const{style:e}=n;if(!e)return;const t=Ge(n,vE);return no(e,t)}function Rl(n,e,t){if(Array.isArray(n)){if(n.length===0)throw new Error("Empty charAttr array");return n.reduceRight((r,i,s)=>{const o=dn(i.style,Ge(i,cl));return typeof i.cid=="string"&&$n(o,lr,()=>i.cid),t&&s===n.length-1&&$n(o,Ji,()=>t),r&&o.append(r),o},e)}else{const r=dn(n.style,Ge(n,cl));return typeof n.cid=="string"&&$n(r,lr,()=>n.cid),t&&$n(r,Ji,()=>t),e&&r.append(e),r}}function Ns(n,e){if(!(n in e))return!1;const t=e[n];return typeof t=="object"&&t!==null}function FE(n){return!!n&&!!n.book&&typeof n.book=="object"&&n.book!==null&&"style"in n.book&&typeof n.book.style=="string"&&"code"in n.book&&typeof n.book.code=="string"}function $f(n){return!!n&&!!n.para&&typeof n.para=="object"&&n.para!==null&&"style"in n.para&&typeof n.para.style=="string"}function Gr(n){return!!n&&!!n.char&&typeof n.char=="object"&&n.char!==null&&(!Array.isArray(n.char)&&"style"in n.char&&typeof n.char.style=="string"||Array.isArray(n.char)&&n.char.length>0&&"style"in n.char[0]&&typeof n.char[0].style=="string")}function qE(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&Object.keys(n).length===0}function It(n,e){if(n)for(const t of Object.keys(n)){if(t==="segment"&&typeof n[t]=="string"){const r=n[t];$n(e,Ji,()=>r);continue}if(BE(t)){const r=!!n[t],i=t,s=e.hasFormat(i);(r&&!s||!r&&s)&&e.toggleFormat(i)}}}const fv=["bold","underline","strikethrough","italic","highlight","code","subscript","superscript","lowercase","uppercase","capitalize"];function BE(n){return fv.includes(n)}function UE({viewOptions:n}){const[e]=ge();return zE(e,n),null}function zE(n,e){x.useEffect(()=>{if(!n.hasNodes([Un,bt,Ve]))throw new Error("ArrowNavigationPlugin: ImmutableChapterNode, ImmutableVerseNode or NoteNode not registered on editor!");const t=r=>{if(r.key!=="ArrowLeft"&&r.key!=="ArrowRight")return!1;const i=K();if(!B(i)||!i.isCollapsed())return!1;const s=n.getRootElement();if(!s)return!1;const o=s.dir||"ltr";let a=!1;return WE(o,r.key)?a=HE(i):KE(o,r.key)&&(a=JE(i,e)),a&&r.preventDefault(),a};return n.registerCommand(Gi,t,_l)},[n,e])}function WE(n,e){return n==="ltr"&&e==="ArrowRight"||n==="rtl"&&e==="ArrowLeft"}function KE(n,e){return n==="ltr"&&e==="ArrowLeft"||n==="rtl"&&e==="ArrowRight"}function HE(n){var e,t,r;const i=n.anchor.getNode(),s=G1(n);if(ye(s)&&!xo(s.getFirstChild())){if(Wt(i)){if(n.anchor.offset===i.getChildrenSize())return!1}else if(n.anchor.offset!==i.getTextContentSize())return!1;if(s.getIsCollapsed()){if(s.is((e=s.getParent())==null?void 0:e.getLastChild()))return(r=(t=s.getParent())==null?void 0:t.getNextSibling())==null||r.selectStart(),!0}else return al(s.getFirstChild())?s.select(2,2):s.select(1,1),!0}if(Wt(i)&&ye(s)&&s.getIsCollapsed()){const a=s.getNextSibling();return a?a.selectStart():s.selectEnd(),!0}const o=s==null?void 0:s.getParent();if(al(s)&&ye(o)&&s.is(o==null?void 0:o.getLastChild())){const a=o.getNextSibling();return a?a.selectStart():o.selectEnd(),!0}return!1}function JE(n,e){const t=Y1(n);if(vo(t)&&!t.getPreviousSibling())return!0;if(n.anchor.offset!==0)return!1;const r=n.anchor.getNode();if(mn(r.getParent()))return!0;if(ye(t)&&t.getIsCollapsed()){const s=t.getPreviousSibling();if(!as(s))return!1;const o=t.getParent();if(!o)return!1;const a=t.getIndexWithinParent();return o.select(a,a),!0}if(Wt(t)&&(e==null?void 0:e.noteMode)==="collapsed"){const s=t.getLastChild();if(!s)return!1;const o=Xt(s,a=>ye(a));if(ye(o)&&o.getIsCollapsed()){const a=o.getParent();if(!a)return!1;const l=o.getIndexWithinParent();return a.select(l,l),!0}}const i=Wb(r);if(!i||i.getIsCollapsed())return!1;if(kr(t)){const s=i.getParent();if(!s)return!1;const o=i.getIndexWithinParent();return s.select(o,o),!0}return!1}function VE(){const[n]=ge();return GE(n),null}function GE(n){x.useEffect(()=>{if(!n.hasNodes([Re]))throw new Error("CharNodePlugin: CharNode not registered on editor!");return n.registerNodeTransform(Re,YE)},[n])}function YE(n){if(!Ie(n))return;if(n.isEmpty()){n.remove();return}const e=n.getMarker(),t=Ii(n,lr),r=n.getUnknownAttributes(),i=n.getNextSibling();Ie(i)&&Yu({style:e,cid:t},i)&&Jn(r,i.getUnknownAttributes())&&(n.append(...i.getChildren()),i.remove());const s=n.getPreviousSibling();Ie(s)&&Yu({style:e,cid:t},s)&&Jn(r,s.getUnknownAttributes())&&(s.append(...n.getChildren()),n.remove())}function hv(n){return n.replaceAll("	"," ")}const Pf=n=>{navigator.clipboard.read().then(async e=>{if((await navigator.permissions.query({name:"clipboard-read"})).state==="denied"){alert("Not allowed to paste from clipboard.");return}const t=new DataTransfer,r=e[0];for(const s of r.types){const o=await(await r.getType(s)).text();t.setData(s,hv(o))}const i=new ClipboardEvent("paste",{clipboardData:t});n.dispatchCommand(Zr,i)})},If=n=>{navigator.clipboard.read().then(async()=>{if((await navigator.permissions.query({name:"clipboard-read"})).state==="denied"){alert("Not allowed to paste from clipboard.");return}const e=new DataTransfer,t=await navigator.clipboard.readText();e.setData("text/plain",hv(t));const r=new ClipboardEvent("paste",{clipboardData:e});n.dispatchCommand(Zr,r)})};function XE(){const[n]=ge();return x.useEffect(()=>{const e=t=>{const{key:r,shiftKey:i,metaKey:s,ctrlKey:o,altKey:a}=t;!(Nu?s:o)||a||(!i&&r.toLowerCase()==="c"?(t.preventDefault(),n.dispatchCommand(hr,null)):!i&&r.toLowerCase()==="x"?(t.preventDefault(),n.dispatchCommand(Qr,null)):r.toLowerCase()==="v"&&(t.preventDefault(),i?If(n):Pf(n)))};return n.registerRootListener((t,r)=>{r!==null&&r.removeEventListener("keydown",e),t!==null&&t.addEventListener("keydown",e)})},[n]),null}function ZE({logger:n}){const[e]=ge();return x.useEffect(()=>He(e.registerCommand(Gi,t=>t.key!=="\\"&&t.key!=="/"?!1:(t.preventDefault(),!0),Ca),e.registerCommand(Zr,t=>{var r;const i=(r=t.clipboardData)==null?void 0:r.getData("text/plain");return!i||!i.includes("\\")&&!i.includes("/")?!1:(n==null||n.info("CommandMenuPlugin: paste containing backslash or forward slash ignored."),t.preventDefault(),!0)},Ca),e.registerCommand(ml,t=>{var r;const i=(r=t.dataTransfer)==null?void 0:r.getData("text/plain");return!i||!i.includes("\\")&&!i.includes("/")?!1:(n==null||n.info("CommandMenuPlugin: drag containing backslash or forward slash ignored."),t.preventDefault(),!0)},Ca)),[e,n]),null}function QE({index:n,isSelected:e,onClick:t,onMouseEnter:r,option:i}){let s="item";return e&&(s+=" selected"),i.isDisabled&&(s+=" disabled"),S.jsx("li",{tabIndex:-1,className:s,ref:i.setRefElement,role:"option","aria-selected":e,"aria-disabled":i.isDisabled,id:"typeahead-item-"+n,onMouseEnter:r,onClick:i.isDisabled?void 0:t,children:S.jsx("span",{className:"text",children:i.title})},i.key)}function eN({options:n,selectedItemIndex:e,onOptionClick:t,onOptionMouseEnter:r}){return S.jsx("div",{className:"typeahead-popover",children:S.jsx("ul",{children:n.map((i,s)=>S.jsx(QE,{index:s,isSelected:e===s,onClick:()=>t(i,s),onMouseEnter:()=>r(s),option:i},i.key))})})}class aa extends uS{constructor(e,t){super(e),Q(this,"title"),Q(this,"onSelect"),Q(this,"isDisabled"),this.title=e,this.onSelect=t.onSelect.bind(this),this.isDisabled=t.isDisabled||!1}}function tN(n,e="editor-input"){return n?n.classList.contains(e):!1}function nN(){const[n]=ge(),[e,t]=x.useState(()=>!n.isEditable()),r=x.useRef(void 0),i=x.useRef(void 0),s=x.useRef(void 0),o=x.useMemo(()=>[new aa("Cut",{onSelect:()=>{n.dispatchCommand(Qr,null)},isDisabled:e}),new aa("Copy",{onSelect:()=>{n.dispatchCommand(hr,null)}}),new aa("Paste",{onSelect:()=>{Pf(n)},isDisabled:e}),new aa("Paste as Plain Text",{onSelect:()=>{If(n)},isDisabled:e})],[n,e]),a=x.useCallback((l,c,u)=>{n.update(()=>{l==null||l.onSelect(c),u()})},[n]);return x.useEffect(()=>{var l;i.current=((l=n.getRootElement())==null?void 0:l.className)??""},[n]),x.useEffect(()=>{const l=()=>{var c;(c=s.current)==null||c.call(s)};return window.addEventListener("scroll",l,!0),()=>{window.removeEventListener("scroll",l,!0)}},[]),x.useEffect(()=>n.registerEditableListener(l=>{t(!l)}),[n]),S.jsx(hS,{options:o,onSelectOption:a,onWillOpen:l=>{r.current=l.target},menuRenderFn:(l,{selectedIndex:c,options:u,selectOptionAndCleanUp:f,setHighlightedIndex:d},{setMenuRef:h})=>(s.current=()=>f(void 0),l.current&&!tN(r.current,i.current)&&!Rb(r.current)?Nt.createPortal(S.jsx("div",{className:"typeahead-popover auto-embed-menu",style:{marginLeft:l.current.style.width,userSelect:"none",width:200},ref:h,children:S.jsx(eN,{options:o,selectedItemIndex:c,onOptionClick:(p,m)=>{p.isDisabled||(d(m),f(p))},onOptionMouseEnter:p=>{d(p)}})}),l.current):null)})}function rN({isEditable:n}){const[e]=ge();return x.useLayoutEffect(()=>{e.setEditable(n)},[e,n]),null}function iN({scripture:n,nodeOptions:e,editorAdaptor:t,viewOptions:r,logger:i}){const[s]=ge();return x.useEffect(()=>{var o;(o=t.initialize)==null||o.call(t,e,i)},[t,i,e]),x.useEffect(()=>{var o;(o=t.reset)==null||o.call(t);const a=t.serializeEditorState(n,r);if(a==null){i==null||i.warn("LoadStatePlugin: serializedEditorState was null or undefined. Skipping editor update.");return}try{const l=s.parseEditorState(a);s.update(()=>{s.setEditorState(l),s.dispatchCommand(Bm,void 0)},{tag:ff})}catch{i==null||i.error("LoadStatePlugin: error parsing or setting editor state.")}},[s,t,i,n,r]),null}function sN({expandedNoteKeyRef:n,nodeOptions:e,viewOptions:t,logger:r}){const[i]=ge();return oN(e,r),aN(i,n,t,r),null}function oN(n,e){const t=x.useRef(void 0),r=n.noteCallers;x.useEffect(()=>{let i=r;(!i||i.length<=0)&&(i=xT),t.current!==i&&(t.current=i,pN("note-callers",i,e))},[e,r])}function aN(n,e,t,r){x.useEffect(()=>{if(!n.hasNodes([Re,Ve,Vt]))throw new Error("NoteNodePlugin: CharNode, NoteNode or ImmutableNoteCallerNode not registered on editor!");const i=s=>n.update(()=>gN(s));return He(n.registerNodeTransform(Ve,s=>lN(s,t)),n.registerNodeTransform(Re,cN),n.registerNodeTransform(At,uN),n.registerNodeTransform(Vt,dN),n.registerMutationListener(Vt,(s,{prevEditorState:o})=>fN(s,o)),n.registerCommand(fr,()=>hN(n,e,t,r),ei),n.registerRootListener((s,o)=>{o!==null&&o.removeEventListener("dblclick",i),s!==null&&s.addEventListener("dblclick",i)}))},[n,e,r,t])}function lN(n,e){const t=n.getChildren();if(!t.some(r=>kr(r))&&(e==null?void 0:e.markerMode)!=="editable"&&n.remove(),t.length>0){const r=t[0];z(r)&&!xo(r)&&n.insertBefore(r)}}function cN(n){const e=n.getParentOrThrow(),t=e.getChildren(),r=t.find(o=>kr(o));if(!Ie(n)||!ye(e)||!r)return;const i=Cf(t);r.getPreviewText()!==i&&r.setPreviewText(i);const s=n.getNextSibling();z(s)?s.getTextContent()!==Ne&&s.setTextContent(Ne):n.insertAfter(ue(Ne))}function uN(n){const e=Wb(n),t=e==null?void 0:e.getChildren(),r=t==null?void 0:t.find(s=>kr(s));if(!z(n)||!ye(e)||!r||!t)return;const i=Cf(t);r.getPreviewText()!==i&&r.setPreviewText(i),!(xo(n)||!ye(n.getParent()))&&n.getTextContent()!==Ne&&(n.setTextContent(Ne),n.selectEnd())}function dN(n){if(!kr(n))return;const e=n.getNextSibling();!z(e)||xo(e)?n.insertAfter(ue(Ne)):e.getTextContent()!==Ne&&e.setTextContent(Ne)}function fN(n,e){for(const[t,r]of n){if(r!=="destroyed")continue;const i=e.read(()=>{const o=de(t),a=o==null?void 0:o.getParent();return kr(o)&&ye(a)&&a.getCaller()===Jr}),s=document.querySelector(".editor-input");!i||!s||(s.classList.add("reset-counters"),s.offsetHeight,s.classList.remove("reset-counters"))}}function hN(n,e,t,r){var i;if((t==null?void 0:t.noteMode)!=="expandInline")return!1;const s=K();if(!B(s)||!s.isCollapsed())return!1;const o=s.anchor,a=o.getNode();if(e.current){const l=Xt(a,c=>ye(c));if(l)e.current!==l.getKey()&&(e.current=l.getKey());else{const c=de(e.current);c&&!c.getIsCollapsed()&&(r==null||r.debug("Cursor moved away from NoteNode, collapsing it"),Ms(n,e.current,r)),e.current=void 0}}if(o.offset===0){const l=a.getPreviousSibling();if(ye(l)){r==null||r.debug("Cursor is just after a NoteNode");const c=l.getKey();l.getIsCollapsed()?e.current=c:e.current=void 0,Ms(n,c,r)}}if(o.offset===a.getTextContentSize()){const l=a.getNextSibling();if(ye(l)){r==null||r.debug("Cursor is just before a NoteNode");const c=l.getKey();l.getIsCollapsed()?e.current=c:e.current=void 0,Ms(n,c,r)}else if(!l){const c=Xt(a,u=>ye(u));if(c&&c.getIsCollapsed()&&Wt(c.getParent())&&c.is((i=c.getParent())==null?void 0:i.getLastChild())){r==null||r.debug("Cursor is at end of note at end of para");const u=c.getKey();e.current=u,Ms(n,u,r)}}}if(Wt(a)){const l=a.getChildAtIndex(o.offset),c=l==null?void 0:l.getPreviousSibling();if(as(c)&&ye(l)){r==null||r.debug("Cursor is between verse and NoteNode");const u=l.getKey();l.getIsCollapsed()?e.current=u:e.current=void 0,Ms(n,u,r)}}return!1}function Ms(n,e,t){const r=de(e);try{r==null||r.toggleIsCollapsed()}catch(i){if(i instanceof Error&&i.message.includes("read only"))t==null||t.warn("Fallback triggered after stabilization - edge case"),setTimeout(()=>{n.update(()=>{r==null||r.toggleIsCollapsed()})},0);else throw i}}function gN(n){const e=K();if(!B(e))return;const t=e.anchor,r=e.focus,i=t.getNode(),s=r.getNode();if(ye(i)&&z(s)){n.preventDefault();const o=fo();o.anchor.set(s.getKey(),0,"text"),o.focus.set(s.getKey(),r.offset,"text"),it(o)}}function pN(n,e,t){for(const r of document.styleSheets)try{const i=r.cssRules||r.rules;for(const s of i)if(mN(s,n)){const o=e.map(a=>`"${a}"`).join(" ");s.symbols=o;return}}catch{continue}t==null||t.warn(`Editor: counter style "${n}" not found.`)}function mN(n,e){return typeof n=="object"&&n!==null&&"name"in n&&n.name===e&&"symbols"in n&&typeof n.symbols=="string"}function yN({onChange:n}){const[e]=ge();return x.useEffect(()=>e.registerCommand(fr,()=>{const t=e.read(()=>nv());return n==null||n(t),!1},ei),[e,n]),null}function _N(){const[n]=ge();return bN(n),null}function bN(n){x.useEffect(()=>{if(!n.hasNodes([St]))throw new Error("ParaNodePlugin: ParaNode not registered on editor!");return n.registerNodeTransform(St,e=>vN(e,n))},[n])}function vN(n,e){Af(e,n.getKey())&&ov(n.getFirstChild()),!(!dt(n)||n.getMarker()!=="b"||n.isEmpty()||!e.getEditorState().read(()=>{const t=de(n.getKey());return dt(t)&&((t==null?void 0:t.isEmpty())??!1)}))&&n.clear()}function gv({onStateChange:n}){const[e]=ge(),[t,r]=x.useState(e),i=x.useRef(!1),s=x.useRef(!1),o=x.useRef(),a=x.useCallback(()=>{const l=K();if(B(l)){const c=l.anchor.getNode();let u=c.getKey()==="root"?c:Xt(c,d=>{const h=d.getParent();return h!==null&&bn(h)});u===null&&(u=c.getTopLevelElementOrThrow());const f=u.getKey();t.getElementByKey(f)!==null&&(dt(u)||mn(u)||vo(u))&&(o.current=u.getMarker(),n==null||n(i.current,s.current,o.current))}},[t,n]);return x.useEffect(()=>e.registerCommand(fr,(l,c)=>(a(),r(c),!1),Si),[e,a]),x.useEffect(()=>He(t.registerUpdateListener(({editorState:l})=>{l.read(()=>{a()})}),t.registerCommand($s,l=>(i.current=l,n==null||n(i.current,s.current,o.current),!1),Si),t.registerCommand(Os,l=>(s.current=l,n==null||n(i.current,s.current,o.current),!1),Si)),[a,t,n]),null}function kN({textDirection:n}){const[e]=ge();return xN(e,n),CN(e),null}function xN(n,e){x.useEffect(()=>{function t(){const r=n.getRootElement();if(!r||e==="auto")return;r.dir=e;const i=n._config.theme.placeholder,s=document.getElementsByClassName(i)[0];s&&(s.dir=e)}return t(),n.registerUpdateListener(({dirtyElements:r})=>{r.size>0&&t()})},[n,e])}function CN(n){x.useEffect(()=>{const e=t=>{if(t.key!=="ArrowLeft"&&t.key!=="ArrowRight")return!1;const r=K();if(!B(r))return!1;const i=r.anchor.getNode(),s=Xt(i,f=>nT(f,n)==="p");if(!s)return!1;const o=n.getElementByKey(s.getKey());if(!o)return!1;const a=o.parentElement,l=o.dir||"ltr",c=((a==null?void 0:a.dir)??"")||"ltr";if(!a||l===c)return!1;const u=a.dir==="rtl"&&t.key==="ArrowLeft"||a.dir==="ltr"&&t.key==="ArrowRight";return r.modify("move",u,"character"),t.preventDefault(),!0};return n.registerCommand(Gi,e,_l)},[n])}function wN(){const[n]=ge();return SN(n),null}function SN(n){x.useEffect(()=>{if(!n.hasNodes([Re,bt,Ve,At,_t]))throw new Error("TextSpacingPlugin: CharNode, ImmutableVerseNode, NoteNode, TextNode or VerseNode not registered on editor!");return He(n.registerNodeTransform(At,TN),n.registerNodeTransform(At,e=>EN(e,n)),n.registerNodeTransform(_t,pp),n.registerNodeTransform(bt,pp))},[n])}function TN(n){if(!n.isAttached())return;const e=n.getTextContent(),t=n.getNextSibling(),r=n.getParent();n.getMode()!=="normal"||e.endsWith(" ")&&e.length>1||ye(t)||Ie(r)||rt(r)||bo(r)||(e===" "&&!Dt(t)?n.setTextContent(""):Mf(n))}function EN(n,e){const t=n.getParent();!bo(t)||!n.isAttached()||Af(e,n.getKey())&&t.insertAfter(n)}function pp(n){if(!n.isAttached())return;const e=n.getPreviousSibling();e&&!Dt(e)&&!z(e)&&!bo(e)&&n.insertBefore(ue(" "))}function NN({trigger:n,scriptureReference:e,contextMarker:t,getMarkerAction:r}){const{markersMenuItems:i}=eE({scriptureReference:e,contextMarker:t,getMarkerAction:r});return S.jsx(QT,{trigger:n,items:i})}function MN({trigger:n,scrRef:e,getMarkerAction:t}){const{book:r,chapterNum:i,verseNum:s,verse:o}=e,a=x.useMemo(()=>e,[r,i,s,o]),[l]=ge(),[c]=AN(l);return ON(l),S.jsx(NN,{trigger:n,scriptureReference:a,contextMarker:c,getMarkerAction:t})}function AN(n){const[e,t]=x.useState();return x.useEffect(()=>n.registerCommand(fr,()=>(n.read(()=>{const r=K();if(!B(r)){e&&t(void 0);return}const i=de(r.anchor.key),s=de(r.focus.key);if(!i||!s){e&&t(void 0);return}const o=X1(i,s);if(!o||!RT(o)){e&&t(void 0);return}const a=o.getMarker();e!==a&&t(a)}),!1),ei),[e,n]),[e]}function ON(n){x.useEffect(()=>{if(!n.hasNodes([_t,bt]))throw new Error("UsjNodesMenuPlugin: VerseNode or ImmutableVerseNode not registered on editor!");const e={},t={};return He(n.registerNodeTransform(bt,r=>mp(r,n,e)),n.registerNodeTransform(_t,r=>mp(r,n,e)),n.registerMutationListener(bt,r=>vp(r,n,e,t)),n.registerMutationListener(_t,r=>vp(r,n,e,t)))},[n])}function mp(n,e,t){Tx(ff)||Af(e,n.getKey())&&IN(n,t)}function yp(n){return RegExp(/(\d+)([a-zA-Z]+)?(-(\d+)([a-zA-Z]+)?)?/).exec(n)}const _p=2,$N=3,bp=4,PN=5;function IN(n,e){var t;const r=vf(n),i=r==null?void 0:r.getNumber();if(!i)return;const s=e[i];if(!s)return;let o=parseInt(n.getNumber()),a=((t=yp(n.getNumber()))==null?void 0:t[_p])??"";s.forEach(l=>{const c=de(l);if(!c)return;const u=c.getNumber(),f=parseInt(u),d=yp(u),h=!!(d!=null&&d[$N]),p=h?parseInt(d[bp]):f;if(p<o||f>o||p===o&&a)return;const m=(d==null?void 0:d[_p])??"",y=(d==null?void 0:d[PN])??"",b=h?Xu(parseInt(d[bp]),void 0):"";let _=`${m}`;_+=h?`-${b}${y}`:"";const C=Xu(f,void 0);c.setNumber(`${C}${_}`),o=parseInt(h?b:C),a=h?y:m})}function vp(n,e,t,r){e.getEditorState().read(()=>{for(const[i,s]of n){const o=de(i);if(Dt(o)){if(s==="created"){const a=vf(o);if(!a)continue;const l=a.getNumber();t[l]||(t[l]=[]),t[l].push(i),r[i]=l}else if(s==="destroyed"){const a=r[i],l=t[a];if(!l)continue;const c=l.findIndex(u=>u===i);if(c===-1)continue;l.splice(c,1),Reflect.deleteProperty(r,i)}}}})}const pv="formatted",RN="unformatted";let Rf;function LN(n){const e=DN(n);if(!e)throw new Error(`Invalid view mode: ${n}`);Rf=e}LN(pv);const Co=()=>Rf;function DN(n){let e;switch(n){case pv:e={markerMode:"hidden",noteMode:"collapsed",hasSpacing:!0,isFormattedFont:!0};break;case RN:e={markerMode:"editable",noteMode:"expanded",hasSpacing:!1,isFormattedFont:!1};break}return e}function jN(n){if(n)return n.markerMode==="editable"?_t:bt}function FN(n){const e=[],t=n??Rf;return t&&(e.push(`${S1}${t.markerMode}`),t.hasSpacing&&e.push(C1),t.isFormattedFont&&e.push(w1)),e}const kp={type:Oi,version:Ai,content:[]};let td;function qN(n){n&&(td=n)}function BN(n){if(n.isEmpty())return kp;const e=n.toJSON();if(!e.root||!e.root.children)return;const t=e.root.children;if(t.length===1&&mf(t[0])&&(!t[0].children||t[0].children.length===0))return kp;const r=mv(t),i=Hn(r);return i?{type:Oi,version:Ai,content:i}:void 0}function UN(n,e){const{type:t,marker:r,unknownAttributes:i}=n;let s;return n.code!==""&&(s=n.code),Ue({type:t,marker:r,code:s,...i,content:e})}function zN(n){const{marker:e,number:t,sid:r,altnumber:i,pubnumber:s,unknownAttributes:o}=n;return Ue({type:en.getType(),marker:e,number:t,sid:r,altnumber:i,pubnumber:s,...o})}function WN(n,e){const{marker:t,sid:r,altnumber:i,pubnumber:s,unknownAttributes:o}=n,a=e&&typeof e[0]=="string"?e[0]:void 0;let{number:l}=n;return l=Kb(t,a,l),Ue({type:en.getType(),marker:t,number:l,sid:r,altnumber:i,pubnumber:s,...o})}function KN(n){const{marker:e,sid:t,altnumber:r,pubnumber:i,unknownAttributes:s}=n,{text:o}=n;let{number:a}=n;return a=Kb(e,o,a),Ue({type:_t.getType(),marker:e,number:a,sid:t,altnumber:r,pubnumber:i,...s})}function HN(n,e){const{type:t,marker:r,unknownAttributes:i}=n;return e==null||e.forEach((s,o)=>{typeof s=="string"&&s.startsWith(Ne)&&(e[o]=s.slice(1))}),Ue({type:t,marker:r,...i,content:e})}function JN(n,e){const{type:t,marker:r,unknownAttributes:i}=n;return Ue({type:t,marker:r,...i,content:e})}function VN(n,e){const{type:t,marker:r,caller:i,category:s,unknownAttributes:o}=n;return Ue({type:t,marker:r,caller:i,category:s,...o,content:e})}function xi(n){const{type:e,marker:t,sid:r,eid:i,unknownAttributes:s}=n;return Ue({type:e,marker:t,sid:r,eid:i,...s})}function GN(n){return n.text}function YN(n,e){const{tag:t,marker:r,unknownAttributes:i}=n;return Ue({type:t,marker:r,...i,content:e})}function XN(n){const{marker:e}=n;return{type:ll,marker:e}}function xp(n,e){const t=n[n.length-1];t&&typeof t=="string"?n[n.length-1]=t+e:n.push(e)}function ZN(n,e,t,r,i){const s=yn.getType(),o=e.filter(a=>!t.includes(a));if(t.filter(a=>!e.includes(a)).forEach(a=>{const l=xi({type:s,marker:Mi,eid:a});i.push(l)}),o.forEach(a=>{const l=xi({type:s,marker:Vr,sid:a});i.push(l)}),e.length===0){const a=xi({type:s,marker:Vr});i.push(a)}if(i.push(...n),e.length===0){const a=xi({type:s,marker:Mi});i.push(a)}(!r||!lT(r))&&e.forEach(a=>{const l=xi({type:s,marker:Mi,eid:a});i.push(l)})}function Hn(n,e){const t=[];let r,i=[];return n.forEach((s,o)=>{const a=s,l=s,c=s,u=s,f=s,d=s,h=s,p=s;switch(s.type){case Ft.getType():t.push(UN(a,Hn(a.children)));break;case Un.getType():t.push(zN(s));break;case en.getType():t.push(WN(l,Hn(l.children)));break;case bt.getType():case _t.getType():t.push(KN(s));break;case Re.getType():t.push(HN(c,Hn(c.children)));break;case St.getType():t.push(JN(u,Hn(u.children)));break;case Ve.getType():t.push(VN(f,Hn(f.children,f.caller)));break;case br.getType():case Vt.getType():case lo.getType():case ii.getType():break;case tt.getType():if(r=Hn(h.children),r){const m=h.typedIDs[Qn];if(m)ZN(r,m,i,n[o+1],t),i=m;else{const y=r.shift();y&&(typeof y=="string"?xp(t,y):t.push(y)),r.length>0&&t.push(...r)}}break;case yn.getType():t.push(xi(s));break;case At.getType():d.text&&d.text!==Ne&&!d.text.startsWith(cf)&&(!e||d.text!==xf(e))&&xp(t,GN(d));break;case ri.getType():t.push(YN(p,Hn(p.children)));break;case vr.getType():t.push(XN(s));break;default:td==null||td.error(`Unexpected node type '${s.type}'!`)}}),t&&t.length>0?t:void 0}function mv(n){const e=n.findIndex(t=>mf(t));if(e>=0){const t=n.slice(0,e),r=n[e].children,i=mv(n.slice(e+1));n=[...t,...r,...i]}return n}const tu={initialize:qN,deserializeEditorState:BN},Cp=yv([]),QN={type:lo.getType(),version:1};let dl=[],ae,Oa,nd,Oe;function eM(n,e){dl=[],rM(n),iM(e)}function tM(n=0){}function nM(n,e){ae=e??Co();let t;return n?(n.type!==Oi&&(Oe==null||Oe.warn(`This USJ type '${n.type}' didn't match the expected type '${Oi}'.`)),n.version!==Ai&&(Oe==null||Oe.warn(`This USJ version '${n.version}' didn't match the expected version '${Ai}'.`)),n.content.length>0?t=id(Ls(n.content)):t=[Cp]):t=[Cp],nd==null||nd(dl),{root:{children:t,direction:null,format:"",indent:0,type:"root",version:1}}}function rM(n){n&&(Oa=n),n!=null&&n.addMissingComments&&(nd=n.addMissingComments)}function iM(n){n&&(Oe=n)}function sM(n){return!n||n.length!==1||typeof n[0]!="string"?"":n[0]}function oM(n){const{marker:e,code:t}=n;e!==Pl&&(Oe==null||Oe.warn(`Unexpected book marker '${e}'!`)),(!t||!Ft.isValidBookCode(t))&&(Oe==null||Oe.warn(`Unexpected book code '${t}'!`));const r=[];((ae==null?void 0:ae.markerMode)==="editable"||(ae==null?void 0:ae.markerMode)==="visible")&&r.push(Xr("marker",_r(e)+" "+t+Ne));const i=sM(n.content);i&&r.push(Yr(i));const s=Ge(n);return Ue({type:Ft.getType(),marker:e,code:t??"",unknownAttributes:s,children:r,direction:null,format:"",indent:0,version:Sb})}function aM(n){const{marker:e,number:t,sid:r,altnumber:i,pubnumber:s}=n;e!==hf&&(Oe==null||Oe.warn(`Unexpected chapter marker '${e}'!`));const o=Ge(n);let a;return(ae==null?void 0:ae.markerMode)==="visible"&&(a=!0),(ae==null?void 0:ae.markerMode)==="editable"?Ue({type:en.getType(),marker:e,number:t??"",sid:r,altnumber:i,pubnumber:s,unknownAttributes:o,children:[Yr(ko(e,t)??"")],direction:null,format:"",indent:0,version:Nb}):Ue({type:Un.getType(),marker:e,number:t??"",showMarker:a,sid:r,altnumber:i,pubnumber:s,unknownAttributes:o,version:Pb})}function lM(n){const{marker:e,number:t,sid:r,altnumber:i,pubnumber:s}=n;e!==_f&&(Oe==null||Oe.warn(`Unexpected verse marker '${e}'!`));const o=(jN(ae)??bt).getType(),a=(ae==null?void 0:ae.markerMode)==="editable"?Ub:tv;let l,c;(ae==null?void 0:ae.markerMode)==="editable"?l=ko(e,t):(ae==null?void 0:ae.markerMode)==="visible"&&(c=!0);const u=Ge(n);return Ue({type:o,text:l,marker:e,number:t??"",sid:r,altnumber:i,pubnumber:s,showMarker:c,unknownAttributes:u,version:a})}function cM(n,e=[]){const{marker:t}=n;Re.isValidMarker(t)||Oe==null||Oe.warn(`Unexpected char marker '${t}'!`),(ae==null?void 0:ae.markerMode)==="editable"&&e.forEach(i=>{kf(i)&&(i.text=Ne+i.text)});const r=Ge(n);return Ue({type:Re.getType(),marker:t,unknownAttributes:r,children:[...e],direction:null,format:"",indent:0,textFormat:0,textStyle:"",version:$b})}function yv(n){return{type:cr.getType(),children:n,direction:null,format:"",indent:0,textFormat:0,textStyle:"",version:Lb}}function uM(n,e=[]){const{marker:t}=n;St.isValidMarker(t)||Oe==null||Oe.warn(`Unexpected para marker '${t}'!`);const r=[];(ae==null?void 0:ae.markerMode)==="editable"?r.push(Vi(t),Yr(Ne)):(ae==null?void 0:ae.markerMode)==="visible"&&r.push(Xr("marker",_r(t)+Ne)),r.push(...e);const i=Ge(n);return Ue({type:St.getType(),marker:t,unknownAttributes:i,children:r,direction:null,format:"",indent:0,textFormat:0,textStyle:"",version:Bb})}function dM(n,e){const t=tT(e);let r=()=>{};return Oa!=null&&Oa.noteCallerOnClick&&(r=Oa.noteCallerOnClick),Ue({type:Vt.getType(),caller:n,previewText:t,onClick:r,version:Qb})}function fM(n,e){const{marker:t,category:r}=n;Ve.isValidMarker(t)||Oe==null||Oe.warn(`Unexpected note marker '${t}'!`);const i=n.caller??"*",s=(ae==null?void 0:ae.noteMode)!=="expanded",o=Ge(n);let a,l;(ae==null?void 0:ae.markerMode)==="editable"?(a=Vi(t),l=Vi(t,"closing")):(ae==null?void 0:ae.markerMode)==="visible"&&(a=Xr("marker",_r(t)+Ne),l=Xr("marker",ro(t)+Ne));const c=[];let u;if(a&&c.push(a),(ae==null?void 0:ae.markerMode)==="editable")u=Yr(xf(i)),c.push(u,...e);else{const f=Yr(Ne);u=dM(i,e),c.push(u,f,...e.flatMap(hM(f)))}return l&&c.push(l),Ue({type:Ve.getType(),marker:t,caller:i,isCollapsed:s,category:r,unknownAttributes:o,children:c,direction:null,format:"",indent:0,version:qb})}function hM(n){return e=>fT(e)?[e]:[e,n]}function gM(n){const{marker:e,sid:t,eid:r}=n;(!e||!yn.isValidMarker(e))&&(Oe==null||Oe.warn(`Unexpected milestone marker '${e}'!`));const i=Ge(n);return Ue({type:yn.getType(),marker:e,sid:t,eid:r,unknownAttributes:i,version:Db})}function wp(n,e=[]){return{type:tt.getType(),typedIDs:{[Qn]:e},children:n,direction:null,format:"",indent:0,version:1}}function pM(n,e){const{marker:t}=n,r=n.type,i=Ge(n),s=[...e];return s.forEach(o=>{kf(o)&&(o.mode="token")}),Ue({type:ri.getType(),tag:r,marker:t,unknownAttributes:i,children:s,direction:null,format:"",indent:0,version:Cb})}function mM(n){return{type:vr.getType(),marker:n,version:Xb}}function Vi(n,e="opening"){return{type:ii.getType(),marker:n,markerSyntax:e,text:"",detail:0,format:0,mode:"normal",style:"",version:1}}function Yr(n,e="normal"){return{type:At.getType(),text:n,detail:0,format:0,mode:e,style:"",version:1}}function Xr(n,e){return{type:br.getType(),text:e,textType:n,version:Yb}}function Sp(n,e){(ae==null?void 0:ae.markerMode)==="editable"?e.push(Vi(n)):(ae==null?void 0:ae.markerMode)==="visible"&&e.push(Xr("marker",_r(n)))}function Tp(n,e,t=!1){Re.isValidFootnoteMarker(n)||Re.isValidCrossReferenceMarker(n)||((ae==null?void 0:ae.markerMode)==="editable"?t?e.push(Vi("","selfClosing")):e.push(Vi(n,"closing")):(ae==null?void 0:ae.markerMode)==="visible"&&e.push(Xr("marker",ro(t?"":n))))}function yM(n,e){if(n.type!=="ms")return;const t=[];if(n.sid&&t.push(`sid="${n.sid}"`),n.eid&&t.push(`eid="${n.eid}"`),t.length<=0)return;const r=cf+t.join(" ");(ae==null?void 0:ae.markerMode)==="editable"?e.push(Yr(r)):(ae==null?void 0:ae.markerMode)==="visible"&&e.push(Xr("attribute",r))}function Ep(n,e){return n.length<=0||e===0?n:n.map(t=>t-e)}function _M(n,e){const t=n.indexOf(e,0);t>-1&&n.splice(t,1)}function Np(n,e){e.marker===Vr&&e.sid!==void 0&&n.push(e.sid),e.marker===Mi&&e.eid!==void 0&&_M(n,e.eid)}function rd(n,e,t=!1,r=[]){if(e.length<=0||e[0]>=n.length)return n;const i=e.shift(),s=e.length>0?e.shift():n.length-1;if(i===void 0||s===void 0||s>=n.length||n.length<=0)return n;const o=n.slice(0,i),a=t?[wp(o,[...r])]:o,l=n[i];Np(r,l);const c=rd(n.slice(i+1,s),Ep(e,i+1),l.marker===Vr,r),u=wp(c,[...r]),f=n[s];Np(r,f);const d=rd(n.slice(s+1),Ep(e,s+1),f.marker===Vr,r);return[...a,u,...d]}function Ls(n){const e=[],t=[];return n==null||n.forEach(r=>{if(typeof r=="string")r&&t.push(Yr(r));else if(!r.type)Oe==null||Oe.error("Marker type is missing!");else switch(r.type){case Ft.getType():t.push(oM(r));break;case en.getType():t.push(aM(r));break;case _t.getType():ae!=null&&ae.hasSpacing||t.push(QN),t.push(lM(r));break;case Re.getType():Sp(r.marker,t),t.push(cM(r,Ls(r.content))),Tp(r.marker,t);break;case St.getType():t.push(uM(r,Ls(r.content)));break;case Ve.getType():t.push(fM(r,Ls(r.content)));break;case yn.getType():D1(r.marker)&&(e.push(t.length),r.sid!==void 0&&(dl==null||dl.push(r.sid))),t.push(gM(r)),Sp(r.marker,t),yM(r,t),Tp(r.marker,t,!0);break;case vr.getType():t.push(mM(r.marker));break;default:Oe==null||Oe.warn(`Unknown type-marker '${r.type}-${r.marker}'!`),t.push(pM(r,Ls(r.content)))}}),rd(t,e)}function id(n){const e=n.findIndex(t=>x1(t)||K1(t)||z1(t));if(e>=0){const t=id(n.slice(0,e)),r=n[e],i=id(n.slice(e+1));return[...t,r,...i]}else if(n.some(t=>"text"in t&&"mode"in t||TT(t)))return[yv(n)];return n}const sd={initialize:eM,reset:tM,serializeEditorState:nM},nu=n=>{if(!Ve.isValidMarker(n)||!n.includes("f"))throw new Error(`Invalid footnote marker '${n}'`);return{action:e=>{const{chapterNum:t,verseNum:r}=e.reference,i=[];return t!==void 0&&r!==void 0&&i.push({type:"char",marker:"fr",content:[`${t}:${r}`]}),e.noteText&&i.push({type:"char",marker:"fq",content:[e.noteText]}),i.push({type:"char",marker:"ft",content:["-"]}),[{type:"note",marker:n,caller:Jr,content:i}]}}},Mp=n=>{if(!Ve.isValidMarker(n)||!n.includes("x"))throw new Error(`Invalid cross-reference marker '${n}'`);return{action:e=>{const{chapterNum:t,verseNum:r}=e.reference,i=[];return t!==void 0&&r!==void 0&&i.push({type:"char",marker:"xo",content:[`${t}:${r}`]}),i.push({type:"char",marker:"xt",content:["-"]}),[{type:"note",marker:n,caller:df,content:i}]}}},bM={c:{action:n=>{const{chapterNum:e}=n.reference;return[{type:"chapter",marker:"c",number:`${e+1}`}]}},v:{action:n=>{const{verseNum:e,verse:t}=n.reference;return[{type:"verse",marker:"v",number:`${Xu(e,t)}`}]}},f:nu("f"),fe:nu("fe"),ef:nu("ef"),x:Mp("x"),ex:Mp("ex")};function vM(n,e,t,r,i){const s=kM(n);return{action:o=>{o.editor.update(()=>{var a;const l=K();B(l)&&(o.noteText=l.getTextContent());const c=(a=s==null?void 0:s.action)==null?void 0:a.call(s,o);if(!c)return;const u=ip(c,sd,r),f=Zc(u);if(B(l)){const d=l.anchor.getNode();if(ye(f))rv(f,l,r),f.getIsCollapsed()||(e.current=f.getKey());else if(l.getTextContent().length>0)xM(l,()=>Zc(u));else if(j(f)&&!f.isInline()){const h=l.insertParagraph();if(h){const p=h.getChildren();f.append(...p),h.replace(f),f.selectStart()}}else if(z(d)&&!xo(d)&&ye(d.getParent())&&l.isCollapsed()){let h=d.insertAfter(f);if(al(f)){const p={...r||Co(),markerMode:"hidden"},m=ip(c,sd,p),y=Zc(m);h=h.insertAfter(y)}h.insertAfter(ue(Ne))}else{l.insertNodes([f]),EM(f);const h=f.getNextSibling();h?h.selectStart():f.selectStart()}}else l==null||l.insertNodes([f])},i)},label:s==null?void 0:s.label}}function kM(n){let e=bM[n];return e||(St.isValidMarker(n)?e={action:()=>[{type:St.getType(),marker:n,content:[]}]}:Re.isValidMarker(n)&&(e={action:()=>[{type:Re.getType(),marker:n,content:["-"]}]})),e}function xM(n,e){const t=n.getNodes(),[r,i]=CM(n);let s;t.forEach((o,a)=>{if(j(s)&&s.isParentOf(o))return;const l=wM(o,a===0,a===t.length-1,r,i);if(!l){s=void 0;return}s||(s=e(),l.insertBefore(s)),TM(l,s)}),(z(s)||j(s))&&s.selectEnd()}function CM(n){const e=n.anchor.offset,t=n.focus.offset;return n.isBackward()?[t,e]:[e,t]}function wM(n,e,t,r,i){if(!(rt(n)||ye(n)||ye(n.getParent()))){if(z(n))return SM(n,e,t,r,i);if(j(n)&&n.isInline())return n}}function SM(n,e,t,r,i){const s=n.getTextContentSize(),o=e?r:0,a=t?i:s;if(o===0&&a===0)return;const l=n.splitText(o,a);return l.length===1?l[0]:l.length===3||a===s?l[1]:l[0]}function TM(n,e){var t;if(z(e)){const r=Ap(n,e);e.setTextContent(r),n.remove()}else if(j(e)){const r=e.getChildrenSize();e.append(n);for(let i=0;i<r;i++)(t=e.getFirstChild())==null||t.remove();Ap(n,e)}}function Ap(n,e){let t=n.getTextContent();if(z(n)&&e.isInline()&&t.startsWith(" ")){t=t.trimStart(),n.setTextContent(t);const r=e.getPreviousSibling();Mf(r),z(r)||e.insertBefore(ue(" "))}return t}function EM(n){Dt(n)&&(Mf(n.getPreviousSibling()),ov(n.getNextSibling()))}const _v={chapter:"chapter",verse:"verse",char:"char",para:"para",typedMark:"editor-typed-mark",typedMarkOverlap:"editor-typed-markOverlap",mark:"editor-mark",markOverlap:"editor-markOverlap",placeholder:"editor-placeholder",paragraph:"editor-paragraph",quote:"editor-quote",heading:{h1:"editor-heading-h1",h2:"editor-heading-h2",h3:"editor-heading-h3",h4:"editor-heading-h4",h5:"editor-heading-h5"},list:{nested:{listitem:"editor-nested-listitem"},ol:"editor-list-ol",ul:"editor-list-ul",listitem:"editor-listitem"},image:"editor-image",link:"editor-link",text:{bold:"editor-text-bold",italic:"editor-text-italic",overflowed:"editor-text-overflowed",hashtag:"editor-text-hashtag",underline:"editor-text-underline",strikethrough:"editor-text-strikethrough",underlineStrikethrough:"editor-text-underlineStrikethrough"}};function NM({options:n,editedUsjRef:e,usj:t,setUsj:r}){const{view:i,nodes:s}=n||{},{hasSpacing:o,isFormattedFont:a,markerMode:l}=i||{};return x.useEffect(()=>{e.current&&!Jn(e.current,t)&&r(e.current)},[e,o,a,l,s,r,t]),null}function MM({scrRef:n,onScrRefChange:e}){const[t]=ge(),r=x.useRef(!1),i=x.useRef(!1),{book:s,chapterNum:o,verseNum:a}=n;return x.useEffect(()=>t.registerMutationListener(Ft,l=>{t.update(()=>{for(const[c,u]of l){const f=de(c);f&&mn(f)&&u==="created"&&Op(o,a,i)}},{tag:Ju})},{skipInitialization:!0}),[t,o,a]),x.useEffect(()=>{r.current?r.current=!1:t.update(()=>Op(o,a,i),{tag:Ju})},[t,o,a]),x.useEffect(()=>t.registerCommand(fr,()=>(i.current?i.current=!1:AM(s,o,a,e,r),!1),ei),[t,s,o,a,e]),null}function Op(n,e,t){var r;const i=Jb(K()),s=(r=sv(i))==null?void 0:r.getNumber();if(rT(s)&&wf(e,s))return;const o=pe().getChildren(),a=H1(o,n),l=eT(o,a),c=J1(l,!!a);if(c&&!a||!a)return;Q1(l,c);const u=IT(l,e);if(u){if(dt(u)){const f=u.getFirstChild();z(f)?f.select(0,0):u.select(0,0)}else u.selectNext(0,0);t.current=!0}}function AM(n,e,t,r,i){const s=Jb(K());if(!s)return;const o=vf(s),a=parseInt((o==null?void 0:o.getNumber())??"1",10),l=sv(s),c=l==null?void 0:l.getNumber(),u=parseInt(c??"0",10),f=c?wf(t,c):t===u;if(i.current=!!(o&&a!==e||!f),i.current){const d={book:n,chapterNum:a,verseNum:u};c!=null&&u.toString()!==c&&(d.verse=c),r(d)}}function OM(n){return mn(n)?`${n.__code}`:gf(n)?`${n.__marker} "${n.__number}"`:Ie(n)?`${n.__marker}`:vo(n)?`${n.__marker} "${n.__number}"`:kr(n)?`${n.__caller}`:as(n)?`${n.__marker} "${n.__number}"`:ye(n)?`${n.__marker} "${n.__caller}"`+(n.__isCollapsed?" (collapsed)":" (expanded)"):dt(n)?`${n.__marker}`:rt(n)?`ids: [ ${JSON.stringify(n.getTypedIDs())} ]`:bf(n)?`${n.__marker} "${n.__number}"`:""}function $M(){const[n]=ge();return S.jsx(Pw,{viewClassName:"tree-view-output",treeTypeButtonClassName:"debug-treetype-button",timeTravelPanelClassName:"debug-timetravel-panel",timeTravelButtonClassName:"debug-timetravel-button",timeTravelPanelSliderClassName:"debug-timetravel-panel-slider",timeTravelPanelButtonClassName:"debug-timetravel-panel-button",customPrintNode:OM,editor:n})}const bv=x.createContext(null),$p=4;function PM({children:n,className:e,onClick:t,title:r}){const i=x.useRef(null),s=x.useContext(bv);if(s===null)throw new Error("DropDownItem must be used within a DropDown");const{registerItem:o}=s;return x.useEffect(()=>{i&&i.current&&o(i)},[i,o]),S.jsx("button",{className:e,onClick:t,ref:i,title:r,type:"button",children:n})}function IM({children:n,dropDownRef:e,onClose:t}){const[r,i]=x.useState(),[s,o]=x.useState(),a=x.useCallback(u=>{i(f=>f?[...f,u]:[u])},[i]),l=u=>{if(!r)return;const f=u.key;["Escape","ArrowUp","ArrowDown","Tab"].includes(f)&&u.preventDefault(),f==="Escape"||f==="Tab"?t():f==="ArrowUp"?o(d=>{if(!d)return r[0];const h=r.indexOf(d)-1;return r[h===-1?r.length-1:h]}):f==="ArrowDown"&&o(d=>d?r[r.indexOf(d)+1]:r[0])},c=x.useMemo(()=>({registerItem:a}),[a]);return x.useEffect(()=>{r&&!s&&o(r[0]),s&&s.current&&s.current.focus()},[r,s]),S.jsx(bv.Provider,{value:c,children:S.jsx("div",{className:"dropdown",ref:e,onKeyDown:l,children:n})})}function RM({disabled:n=!1,buttonLabel:e,buttonAriaLabel:t,buttonClassName:r,buttonIconClassName:i,children:s,stopCloseOnClickSelf:o}){const a=x.useRef(null),l=x.useRef(null),[c,u]=x.useState(!1),f=()=>{u(!1),l&&l.current&&l.current.focus()};return x.useEffect(()=>{const d=l.current,h=a.current;if(c&&d!==null&&h!==null){const{top:p,left:m}=d.getBoundingClientRect();h.style.top=`${p+d.offsetHeight+$p}px`,h.style.left=`${Math.min(m,window.innerWidth-h.offsetWidth-20)}px`}},[a,l,c]),x.useEffect(()=>{const d=l.current;if(d!==null&&c){const h=p=>{const m=p.target;o&&a.current&&a.current.contains(m)||d.contains(m)||u(!1)};return document.addEventListener("click",h),()=>{document.removeEventListener("click",h)}}return()=>{}},[a,l,c,o]),x.useEffect(()=>{const d=()=>{if(c){const h=l.current,p=a.current;if(h!==null&&p!==null){const{top:m}=h.getBoundingClientRect(),y=m+h.offsetHeight+$p;y!==p.getBoundingClientRect().top&&(p.style.top=`${y}px`)}}};return document.addEventListener("scroll",d),()=>{document.removeEventListener("scroll",d)}},[l,a,c]),S.jsxs(S.Fragment,{children:[S.jsxs("button",{type:"button",disabled:n,"aria-label":t||e,className:r,onClick:()=>u(!c),ref:l,children:[i&&S.jsx("span",{className:i}),e&&S.jsx("span",{className:"text dropdown-button-text",children:e}),S.jsx("i",{className:"chevron-down"})]}),c&&Nt.createPortal(S.jsx(IM,{dropDownRef:a,onClose:f,children:s}),document.body)]})}const od={m:"m - Paragraph - Margin - No First Line Indent",ms:"ms - Heading - Major Section Level 1",nb:"nb - Paragraph - No Break with Previous Paragraph",p:"p - Paragraph - Normal - First Line Indent",pi:"pi - Paragraph - Indented - Level 1 - First Line Indent",q1:"q1 - Poetry - Indent Level 1",q2:"q2 - Poetry - Indent Level 2",r:"r - Heading - Parallel References",s:"s - Heading - Section Level 1"},ad={...od,ide:"ide - File - Encoding",h:"h - File - Header",h1:"h1 - File - Header",h2:"h2 - File - Left Header",h3:"h3 - File - Right Header",toc1:"toc1 - File - Long Table of Contents Text",toc2:"toc2 - File - Short Table of Contents Text",toc3:"toc3 - File - Book Abbreviation",cl:"cl - Chapter - Publishing Label",mt:"mt - Title - Major Title Level 1",mt1:"mt1 - Title - Major Title Level 1",mt2:"mt2 - Title - Major Title Level 2",mt3:"mt3 - Title - Major Title Level 3",mt4:"mt4 - Title - Major Title Level 4",ms1:"ms1 - Heading - Major Section Level 1",ms2:"ms2 - Heading - Major Section Level 2",ms3:"ms3 - Heading - Major Section Level 3",b:"b - Poetry - Stanza Break (Blank Line)"};function LM({editorRef:n,blockMarker:e,disabled:t=!1}){return S.jsx(RM,{disabled:t,buttonClassName:"toolbar-item block-controls",buttonIconClassName:"icon block-marker "+DM(e),buttonLabel:jM(e),buttonAriaLabel:"Formatting options for block type",children:Object.keys(od).map(r=>S.jsxs(PM,{className:"item block-marker "+FM(e===r),onClick:()=>{var i;return(i=n.current)==null?void 0:i.formatPara(r)},children:[S.jsx("i",{className:"icon block-marker "+r}),S.jsx("span",{className:"text usfm_"+r,children:od[r]})]},r))})}function DM(n){return n&&n in ad?n:"ban"}function jM(n){return n&&n in ad?ad[n]:"No Style"}function FM(n){return n?"active dropdown-item-active":""}function Pp(){return S.jsx("div",{className:"divider"})}const qM=x.forwardRef(function({editorRef:n,isReadonly:e=!1,onStateChange:t},r){const[i]=ge(),[s,o]=x.useState(i),[a,l]=x.useState(),[c,u]=x.useState(!1),[f,d]=x.useState(!1),h=x.useCallback((p,m,y)=>{u(p),d(m),l(y),t==null||t(p,m,y)},[t]);return x.useEffect(()=>i.registerCommand(fr,(p,m)=>(o(m),!1),Si),[i]),S.jsxs(S.Fragment,{children:[S.jsx(gv,{onStateChange:h}),S.jsxs("div",{className:"toolbar",children:[S.jsx("button",{disabled:!c||e,onClick:()=>{s.dispatchCommand(oo,void 0)},title:Nu?"Undo (⌘Z)":"Undo (Ctrl+Z)",type:"button",className:"toolbar-item spaced","aria-label":"Undo",children:S.jsx("i",{className:"format undo"})}),S.jsx("button",{disabled:!f||e,onClick:()=>{s.dispatchCommand(ao,void 0)},title:Nu?"Redo (⌘Y)":"Redo (Ctrl+Y)",type:"button",className:"toolbar-item","aria-label":"Redo",children:S.jsx("i",{className:"format redo"})}),S.jsx(Pp,{}),s===i&&S.jsxs(S.Fragment,{children:[S.jsx(LM,{editorRef:n,blockMarker:a,disabled:e}),S.jsx(Pp,{})]}),S.jsx("div",{ref:r,className:"end-container"})]})]})}),Ip={namespace:"platformEditor",theme:_v,editable:!0,editorState:void 0,onError(n){throw n},nodes:[tt,...LT]},BM=Co(),UM={},zM={};function WM(){return S.jsx("div",{className:"editor-placeholder",children:"Enter some Scripture..."})}const vv=x.forwardRef(function({defaultUsj:n,scrRef:e,onScrRefChange:t,onSelectionChange:r,onUsjChange:i,onStateChange:s,options:o,logger:a,children:l},c){const u=x.useRef(null),f=x.useRef(null),d=x.useRef(null),h=x.useRef(n),p=x.useRef(),[m,y]=x.useState(n),{isReadonly:b=!1,hasExternalUI:_=!1,hasSpellCheck:C=!1,textDirection:E="ltr",markerMenuTrigger:O="\\",view:N=BM,nodes:D=UM,debug:P=!1}=o??zM;Ip.editable=!b,tu.initialize(a),x.useImperativeHandle(c,()=>({focus(){var R;(R=u.current)==null||R.focus()},undo(){var R;(R=u.current)==null||R.dispatchCommand(oo,void 0)},redo(){var R;(R=u.current)==null||R.dispatchCommand(ao,void 0)},cut(){var R;(R=u.current)==null||R.dispatchCommand(Qr,null)},copy(){var R;(R=u.current)==null||R.dispatchCommand(hr,null)},paste(){u.current&&Pf(u.current)},pastePlainText(){u.current&&If(u.current)},getUsj(){return h.current},setUsj(R){Jn(h.current,R)||(h.current=R,y(R))},applyUpdate(R,k="remote"){var I,w;(I=u.current)==null||I.update(()=>{k==="remote"&&Py(Gu),TE(R,N,D,a)},{discrete:!0});const L=(w=u.current)==null?void 0:w.getEditorState();if(!L)return;const F=tu.deserializeEditorState(L);if(F){const q=!Jn(h.current,F);q&&(h.current=F),(q||!Jn(m,F))&&(i==null||i(F,R,k))}},getSelection(){var R;return(R=u.current)==null?void 0:R.read(nv)},setSelection(R){var k;(k=u.current)==null||k.update(()=>{const I=Nf(R);I!==void 0&&it(I)},{tag:Eb})},addAnnotation(R,k,I){var w;(w=f.current)==null||w.addAnnotation(R,np(k),I)},removeAnnotation(R,k){var I;(I=f.current)==null||I.removeAnnotation(np(R),k)},formatPara(R){var k;(k=u.current)==null||k.update(()=>{const I=K();B(I)&&eC(I,()=>no(R))})},insertNote(R,k,I){var w;(w=u.current)==null||w.update(()=>{const L=ET(R,k,I,e,N,D);L&&!L.getIsCollapsed()&&(p.current=L.getKey())})},selectNote(R){var k;(k=u.current)==null||k.update(()=>{const I=MT(R);I&&(AT(I,N),I.getIsCollapsed()||(p.current=I.getKey()))})},get toolbarEndRef(){return d}}));const $=x.useCallback((R,k,I,w)=>{if(T1.some(F=>I.has(F)))return;const L=tu.deserializeEditorState(R);if(L){const F=!Jn(h.current,L);F&&(h.current=L);const q=I.has(Gu)?"remote":"local";(F||!Jn(m,L))&&(i==null||i(L,w,q))}},[m,i]);return S.jsxs(k_,{initialConfig:Ip,children:[S.jsx(rN,{isEditable:!b}),S.jsxs("div",{className:"editor-container",children:[_?S.jsx(gv,{onStateChange:s}):S.jsx("div",{className:"editor-toolbar-container"+(b?"-readonly":"-editable"),children:S.jsx(qM,{ref:d,editorRef:c,isReadonly:b,onStateChange:s})}),S.jsxs("div",{className:"editor-inner",children:[S.jsx(T_,{editorRef:u}),S.jsx(nS,{contentEditable:S.jsx(S_,{className:`editor-input usfm ${FN(N).join(" ")}`,spellCheck:C}),placeholder:S.jsx(WM,{}),ErrorBoundary:E_}),S.jsx(N_,{}),e&&t&&S.jsx(MM,{scrRef:e,onScrRefChange:t}),e&&S.jsx(MN,{trigger:O,scrRef:e,getMarkerAction:(R,k)=>vM(R,p,k,N)}),S.jsx(NM,{options:{view:N,nodes:D},editedUsjRef:h,usj:m,setUsj:y}),S.jsx(iN,{scripture:m,nodeOptions:D,editorAdaptor:sd,viewOptions:N,logger:a}),S.jsx(yN,{onChange:r}),S.jsx(pE,{onChange:$,ignoreSelectionChange:!0,ignoreHistoryMergeTagChange:!0}),S.jsx(nE,{ref:f,logger:a}),S.jsx(UE,{viewOptions:N}),S.jsx(VE,{}),S.jsx(XE,{}),S.jsx(ZE,{logger:a}),S.jsx(nN,{}),S.jsx(sN,{expandedNoteKeyRef:p,nodeOptions:D,viewOptions:N,logger:a}),S.jsx(_N,{}),S.jsx(kN,{textDirection:E}),S.jsx(wN,{}),l]}),P&&S.jsx($M,{})]})]})}),Ll=x.forwardRef(function(n,e){const{children:t,...r}=n;return S.jsx(vv,{ref:e,...r})});function kv(){return Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5)}function fl(n,e,t,r,i){return{author:e,content:n,deleted:i===void 0?!1:i,id:t===void 0?kv():t,timeStamp:r===void 0?performance.timeOrigin+performance.now():r,type:"comment"}}function xv(n,e,t){return{comments:e,id:t===void 0?kv():t,quote:n,type:"thread"}}function Rp(n){return{comments:Array.from(n.comments),id:n.id,quote:n.quote,type:"thread"}}function KM(n){return{author:n.author,content:"[Deleted Comment]",deleted:!0,id:n.id,timeStamp:n.timeStamp,type:"comment"}}function ru(n){const e=n._changeListeners;for(const t of e)t()}class HM{constructor(e,t){Q(this,"_editor"),Q(this,"_comments"),Q(this,"_changeListeners"),Q(this,"_collabProvider"),Q(this,"logger"),this._comments=[],this._editor=e,this.logger=t,this._collabProvider=null,this._changeListeners=new Set}isCollaborative(){return this._collabProvider!==null}getComments(){return this._comments}setComments(e){this._comments=e,ru(this)}addComment(e,t,r){const i=Array.from(this._comments),s=this._getCollabComments();if(t!==void 0&&e.type==="comment")for(let o=0;o<i.length;o++){const a=i[o];if(a.type==="thread"&&a.id===t.id){const l=Rp(a);i.splice(o,1,l);const c=r!==void 0?r:l.comments.length;if(this.isCollaborative()&&s!==null){const u=s.get(o).get("comments");this._withRemoteTransaction(()=>{const f=this._createCollabSharedMap(e);u.insert(c,[f])})}l.comments.splice(c,0,e);break}}else{const o=r!==void 0?r:i.length;this.isCollaborative()&&s!==null&&this._withRemoteTransaction(()=>{const a=this._createCollabSharedMap(e);s.insert(o,[a])}),i.splice(o,0,e)}this._comments=i,ru(this)}deleteCommentOrThread(e,t){const r=Array.from(this._comments),i=this._getCollabComments();let s=null;if(t!==void 0)for(let o=0;o<r.length;o++){const a=r[o];if(a.type==="thread"&&a.id===t.id){const l=Rp(a);r.splice(o,1,l);const c=l.comments;if(s=c.indexOf(e),this.isCollaborative()&&i!==null){const u=i.get(o).get("comments"),f=s;this._withRemoteTransaction(()=>{u.delete(f)})}c.splice(s,1);break}}else s=r.indexOf(e),this.isCollaborative()&&i!==null&&this._withRemoteTransaction(()=>{i.delete(s)}),r.splice(s,1);return this._comments=r,ru(this),e.type==="comment"?{index:s,markedComment:KM(e)}:null}registerOnChange(e){const t=this._changeListeners;return t.add(e),()=>{t.delete(e)}}_withRemoteTransaction(e){const t=this._collabProvider;t!==null&&t.doc.transact(e,this)}_withLocalTransaction(e){const t=this._collabProvider;try{this._collabProvider=null,e()}finally{this._collabProvider=t}}_getCollabComments(){const e=this._collabProvider;return e!==null?e.doc.get("comments",jr):null}_createCollabSharedMap(e){const t=new Wi,r=e.type,i=e.id;if(t.set("type",r),t.set("id",i),r==="comment")t.set("author",e.author),t.set("content",e.content),t.set("deleted",e.deleted),t.set("timeStamp",e.timeStamp);else{t.set("quote",e.quote);const s=new jr;e.comments.forEach((o,a)=>{const l=this._createCollabSharedMap(o);s.insert(a,[l])}),t.set("comments",s)}return t}registerCollaboration(e){this._collabProvider=e;const t=this._getCollabComments(),r=()=>{e.connect()},i=()=>{try{e.disconnect()}catch{}},s=this._editor.registerCommand(y1,a=>{var l,c;return r!==void 0&&i!==void 0&&(a?((l=this.logger)==null||l.info("Comments connected!"),r()):((c=this.logger)==null||c.info("Comments disconnected!"),i())),!1},ei),o=(a,l)=>{if(l.origin!==this){for(const c of a)if(c instanceof gb){const u=c.target,f=c.delta;let d=0;for(const h of f){const p=h.insert,m=h.retain,y=h.delete,b=u.parent,_=u===t?void 0:b instanceof Wi&&this._comments.find(C=>C.id===b.get("id"));if(Array.isArray(p)){const C=d;p.slice().reverse().forEach(E=>{const O=E.get("id"),N=E.get("type")==="thread"?xv(E.get("quote"),E.get("comments").toArray().map(D=>fl(D.get("content"),D.get("author"),D.get("id"),D.get("timeStamp"),D.get("deleted"))),O):fl(E.get("content"),E.get("author"),O,E.get("timeStamp"),E.get("deleted"));this._withLocalTransaction(()=>{this.addComment(N,_,C)})})}else if(typeof m=="number")d+=m;else if(typeof y=="number")for(let C=0;C<y;C++){const E=_===void 0||_===!1?this._comments[d]:_.comments[d];this._withLocalTransaction(()=>{this.deleteCommentOrThread(E,_)}),d++}}}}};return t===null?()=>null:(t.observeDeep(o),r(),()=>{t.unobserveDeep(o),s(),this._collabProvider=null})}}function JM(n){const[e,t]=x.useState(n.getComments());return x.useEffect(()=>n.registerOnChange(()=>{t(n.getComments())}),[n]),e}function VM({onClose:n,children:e,title:t,closeOnClickOutside:r}){const i=x.useRef(null);return x.useEffect(()=>{i.current!==null&&i.current.focus()},[]),x.useEffect(()=>{let s=null;const o=c=>{c.key==="Escape"&&n()},a=c=>{const u=c.target;i.current!==null&&!i.current.contains(u)&&r&&n()},l=i.current;return l!==null&&(s=l.parentElement,s!==null&&s.addEventListener("click",a)),window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o),s!==null&&(s==null||s.removeEventListener("click",a))}},[r,n]),S.jsx("div",{className:"Modal__overlay",role:"dialog",children:S.jsxs("div",{className:"Modal__modal",tabIndex:-1,ref:i,children:[S.jsx("h2",{className:"Modal__title",children:t}),S.jsx("button",{className:"Modal__closeButton","aria-label":"Close modal",type:"button",onClick:n,children:"X"}),S.jsx("div",{className:"Modal__content",children:e})]})})}function GM({onClose:n,children:e,title:t,closeOnClickOutside:r=!1}){return Nt.createPortal(S.jsx(VM,{onClose:n,title:t,closeOnClickOutside:r,children:e}),document.body)}function Cv(){const[n,e]=x.useState(null),t=x.useCallback(()=>{e(null)},[]),r=x.useMemo(()=>{if(n===null)return null;const{title:s,content:o,closeOnClickOutside:a}=n;return S.jsx(GM,{onClose:t,title:s,closeOnClickOutside:a,children:o})},[n,t]),i=x.useCallback((s,o,a=!1)=>{e({closeOnClickOutside:a,content:o(t),title:s})},[t]);return[r,i]}const YM={..._v,paragraph:"CommentEditorTheme__paragraph"};function XM(...n){return n.filter(Boolean).join(" ")}function dr({"data-test-id":n,children:e,className:t,onClick:r,disabled:i,small:s,title:o}){return S.jsx("button",{disabled:i,className:XM("Button__root",i&&"Button__disabled",s&&"Button__small",t),onClick:r,title:o,"aria-label":o,...n&&{"data-test-id":n},children:e})}function ZM({className:n}){return S.jsx(S_,{className:n||"ContentEditable__root"})}function QM({children:n,className:e}){return S.jsx("div",{className:e||"Placeholder__root",children:n})}const Lp=ie("INSERT_INLINE_COMMAND");function eA({anchorKey:n,editor:e,showComments:t,onAddComment:r}){const i=x.useRef(null),s=x.useCallback(()=>{const o=i.current,a=e.getRootElement(),l=e.getElementByKey(n);if(o!==null&&a!==null&&l!==null){const{right:c}=a.getBoundingClientRect(),{top:u}=l.getBoundingClientRect();o.style.left=`${c-20}px`,o.style.top=`${u-30}px`}},[n,e]);return x.useEffect(()=>(window.addEventListener("resize",s),()=>{window.removeEventListener("resize",s)}),[e,s]),x.useLayoutEffect(()=>{s()},[n,e,t,s]),S.jsx("div",{className:"CommentPlugin_AddCommentBox",ref:i,children:S.jsx("button",{className:"CommentPlugin_AddCommentBox_button",onClick:r,children:S.jsx("i",{className:"icon add-comment"})})})}function tA({onEscape:n}){const[e]=ge();return x.useEffect(()=>e.registerCommand(pl,t=>n(t),Ca),[e,n]),null}function wv({className:n,autoFocus:e,onEscape:t,onChange:r,editorRef:i,placeholder:s="Type a comment..."}){return S.jsx(k_,{initialConfig:{namespace:"Commenting",nodes:[],onError:o=>{throw o},theme:YM},children:S.jsxs("div",{className:"CommentPlugin_CommentInputBox_EditorContainer",children:[S.jsx(TS,{contentEditable:S.jsx(ZM,{className:n}),placeholder:S.jsx(QM,{children:s}),ErrorBoundary:E_}),S.jsx(bS,{onChange:r}),S.jsx(N_,{}),e!==!1&&S.jsx(gS,{}),S.jsx(tA,{onEscape:t}),S.jsx(mS,{}),i!==void 0&&S.jsx(T_,{editorRef:i})]})})}function Sv(n,e){return x.useCallback((t,r)=>{t.read(()=>{n(x_()),e(!C_(r.isComposing(),!0))})},[e,n])}function nA({editor:n,cancelAddComment:e,submitAddComment:t}){const[r,i]=x.useState(""),[s,o]=x.useState(!1),a=x.useRef(null),l=x.useMemo(()=>({container:document.createElement("div"),elements:[]}),[]),c=x.useRef(null),u=Ev(),f=x.useCallback(()=>{n.getEditorState().read(()=>{const m=K();if(B(m)){c.current=m.clone();const y=m.anchor,b=m.focus,_=Gx(n,y.getNode(),y.offset,b.getNode(),b.offset),C=a.current;if(_!==null&&C!==null){const{left:E,bottom:O,width:N}=_.getBoundingClientRect(),D=Yx(n,_);let P=D.length===1?E+N/2-125:E-125;P<10&&(P=10),C.style.left=`${P}px`,C.style.top=`${O+20+(window.pageYOffset||document.documentElement.scrollTop)}px`;const $=D.length,{container:R}=l,k=l.elements,I=k.length;for(let w=0;w<$;w++){const L=D[w];let F=k[w];F===void 0&&(F=document.createElement("span"),k[w]=F,R.appendChild(F));const q=`position:absolute;top:${L.top+(window.pageYOffset||document.documentElement.scrollTop)}px;left:${L.left}px;height:${L.height}px;width:${L.width}px;background-color:rgba(255, 212, 0, 0.3);pointer-events:none;z-index:5;`;F.style.cssText=q}for(let w=I-1;w>=$;w--){const L=k[w];R.removeChild(L),k.pop()}}}})},[n,l]);x.useLayoutEffect(()=>{f();const m=l.container,y=document.body;return y!==null?(y.appendChild(m),()=>{y.removeChild(m)}):()=>{}},[l.container,f]),x.useEffect(()=>(window.addEventListener("resize",f),()=>{window.removeEventListener("resize",f)}),[f]);const d=m=>(m.preventDefault(),e(),!0),h=()=>{if(s){let m=n.getEditorState().read(()=>{const y=c.current;return y?y.getTextContent():""});m.length>100&&(m=m.slice(0,99)+"…"),t(xv(m,[fl(r,u)]),!0,void 0,c.current),c.current=null}},p=Sv(i,o);return S.jsxs("div",{className:"CommentPlugin_CommentInputBox",ref:a,children:[S.jsx(wv,{className:"CommentPlugin_CommentInputBox_Editor",onEscape:d,onChange:p}),S.jsxs("div",{className:"CommentPlugin_CommentInputBox_Buttons",children:[S.jsx(dr,{onClick:e,className:"CommentPlugin_CommentInputBox_Button",children:"Cancel"}),S.jsx(dr,{onClick:h,disabled:!s,className:"CommentPlugin_CommentInputBox_Button primary",children:"Comment"})]})]})}function rA({submitAddComment:n,thread:e,placeholder:t}){const[r,i]=x.useState(""),[s,o]=x.useState(!1),a=x.useRef(null),l=Ev(),c=Sv(i,o);return S.jsxs(S.Fragment,{children:[S.jsx(wv,{className:"CommentPlugin_CommentsPanel_Editor",autoFocus:!1,onEscape:()=>!0,onChange:c,editorRef:a,placeholder:t}),S.jsx(dr,{className:"CommentPlugin_CommentsPanel_SendButton",onClick:()=>{if(s){n(fl(r,l),!1,e);const u=a.current;u!==null&&u.dispatchCommand(Td,void 0)}},disabled:!s,children:S.jsx("i",{className:"send"})})]})}function Tv({commentOrThread:n,deleteCommentOrThread:e,onClose:t,thread:r=void 0}){return S.jsxs(S.Fragment,{children:["Are you sure you want to delete this ",n.type,"?",S.jsxs("div",{className:"Modal__content",children:[S.jsx(dr,{onClick:()=>{e(n,r),t()},children:"Delete"})," ",S.jsx(dr,{onClick:()=>{t()},children:"Cancel"})]})]})}function Dp({comment:n,deleteComment:e,thread:t,rtf:r}){const i=Math.round((n.timeStamp-(performance.timeOrigin+performance.now()))/1e3),s=Math.round(i/60),[o,a]=Cv();return S.jsxs("li",{className:"CommentPlugin_CommentsPanel_List_Comment",children:[S.jsxs("div",{className:"CommentPlugin_CommentsPanel_List_Details",children:[S.jsx("span",{className:"CommentPlugin_CommentsPanel_List_Comment_Author",children:n.author}),S.jsxs("span",{className:"CommentPlugin_CommentsPanel_List_Comment_Time",children:["· ",i>-10?"Just now":r.format(s,"minute")]})]}),S.jsx("p",{className:n.deleted?"CommentPlugin_CommentsPanel_DeletedComment":"",children:n.content}),!n.deleted&&S.jsxs(S.Fragment,{children:[S.jsx(dr,{onClick:()=>{a("Delete Comment",l=>S.jsx(Tv,{commentOrThread:n,deleteCommentOrThread:e,thread:t,onClose:l}))},className:"CommentPlugin_CommentsPanel_List_DeleteButton",children:S.jsx("i",{className:"delete"})}),o]})]})}function iA({activeIDs:n,comments:e,deleteCommentOrThread:t,listRef:r,submitAddComment:i,markNodeMap:s}){const[o]=ge(),[a,l]=x.useState(0),[c,u]=Cv(),f=x.useMemo(()=>new Intl.RelativeTimeFormat("en",{localeMatcher:"best fit",numeric:"auto",style:"short"}),[]);return x.useEffect(()=>{const d=setTimeout(()=>{l(a+1)},1e4);return()=>{clearTimeout(d)}},[a]),S.jsx("ul",{className:"CommentPlugin_CommentsPanel_List",ref:r,children:e.map(d=>{const h=d.id;return d.type==="thread"?S.jsxs("li",{onClick:()=>{const p=s.get(h);if(p!==void 0&&(n===null||n.indexOf(h)===-1)){const m=document.activeElement;o.update(()=>{const y=Array.from(p)[0],b=de(y);rt(b)&&b.selectStart()},{onUpdate(){m!==null&&m.focus()}})}},className:`CommentPlugin_CommentsPanel_List_Thread ${s.has(h)?"interactive":""} ${n.indexOf(h)===-1?"":"active"}`,children:[S.jsxs("div",{className:"CommentPlugin_CommentsPanel_List_Thread_QuoteBox",children:[S.jsxs("blockquote",{className:"CommentPlugin_CommentsPanel_List_Thread_Quote",children:["> ",S.jsx("span",{children:d.quote})]}),S.jsx(dr,{onClick:()=>{u("Delete Thread",p=>S.jsx(Tv,{commentOrThread:d,deleteCommentOrThread:t,onClose:p}))},className:"CommentPlugin_CommentsPanel_List_DeleteButton",children:S.jsx("i",{className:"delete"})}),c]}),S.jsx("ul",{className:"CommentPlugin_CommentsPanel_List_Thread_Comments",children:d.comments.map(p=>S.jsx(Dp,{comment:p,deleteComment:t,thread:d,rtf:f},p.id))}),S.jsx("div",{className:"CommentPlugin_CommentsPanel_List_Thread_Editor",children:S.jsx(rA,{submitAddComment:i,thread:d,placeholder:"Reply to comment..."})})]},h):S.jsx(Dp,{comment:d,deleteComment:t,rtf:f},h)})})}function sA({activeIDs:n,deleteCommentOrThread:e,comments:t,submitAddComment:r,markNodeMap:i}){const s=x.useRef(null),o=t.length===0;return S.jsxs("div",{className:"CommentPlugin_CommentsPanel",children:[S.jsx("h2",{className:"CommentPlugin_CommentsPanel_Heading",children:"Comments"}),o?S.jsx("div",{className:"CommentPlugin_CommentsPanel_Empty",children:"No Comments"}):S.jsx(iA,{activeIDs:n,comments:t,deleteCommentOrThread:e,listRef:s,submitAddComment:r,markNodeMap:i})]})}function Ev(){const n=I_(),{yjsDocMap:e,name:t}=n;return e.has("comments")?t:"Scripture User"}function oA({providerFactory:n,setCommentStore:e,onChange:t,showCommentsContainerRef:r,commentContainerRef:i,logger:s}){const o=I_(),[a]=ge(),l=x.useMemo(()=>{const P=new HM(a,s);return t&&P.registerOnChange(t),e==null||e(P),P},[a,s,t,e]),c=JM(l),u=x.useMemo(()=>new Map,[]),[f,d]=x.useState(),[h,p]=x.useState([]),[m,y]=x.useState(!1),[b,_]=x.useState(!1),{yjsDocMap:C}=o;x.useEffect(()=>{if(n){const P=n("comments",C);return l.registerCollaboration(P)}return()=>{}},[l,n,C]);const E=x.useCallback(()=>{a.update(()=>{const P=K();P!==null&&(P.dirty=!0)}),y(!1)},[a]),O=x.useCallback((P,$)=>{if(P.type==="comment"){const R=l.deleteCommentOrThread(P,$);if(!R)return;const{markedComment:k,index:I}=R;l.addComment(k,$,I)}else{l.deleteCommentOrThread(P);const R=$!==void 0?$.id:P.id,k=u.get(R);k!==void 0&&setTimeout(()=>{a.update(()=>{for(const I of k){const w=de(I);rt(w)&&(w.deleteID(Qn,R),w.hasNoIDsForEveryType()&&Vb(w))}})})}},[l,a,u]),N=x.useCallback((P,$,R,k)=>{l.addComment(P,R),$&&(a.update(()=>{B(k)&&Gb(k,Qn,P.id)}),y(!1))},[l,a]);x.useEffect(()=>{const P=[];for(const $ of h){const R=u.get($);if(R!==void 0)for(const k of R){const I=a.getElementByKey(k);I!==null&&(I.classList.add("selected"),P.push(I),_(!0))}}return()=>{for(const $ of P)$.classList.remove("selected")}},[h,a,u]),x.useEffect(()=>{if(!a.hasNodes([tt]))throw new Error("CommentPlugin: TypedMarkNode not registered on editor!");const P=new Map;return He(Ky(a,tt,$=>io($.getTypedIDs()),($,R)=>{for(const[k,I]of Object.entries($.getTypedIDs()))I.forEach(w=>{R.addID(k,w)})}),a.registerMutationListener(tt,$=>{a.getEditorState().read(()=>{for(const[R,k]of $){const I=de(R);let w=[];k==="destroyed"?w=P.get(R)??[]:rt(I)&&(w=I.getTypedIDs()[Qn]??[]);for(const L of w){let F=u.get(L);P.set(R,w),k==="destroyed"?F!==void 0&&(F.delete(R),F.size===0&&u.delete(L)):(F===void 0&&(F=new Set,u.set(L,F)),F.has(R)||F.add(R))}}})},{skipInitialization:!1}),a.registerUpdateListener(({editorState:$,tags:R})=>{$.read(()=>{const k=K();let I=!1,w=!1;if(B(k)){const L=k.anchor.getNode();if(z(L)){const F=cT(L,Qn,k.anchor.offset)??[];F!==null&&(p(F),I=!0),k.isCollapsed()||(d(L.getKey()),w=!0)}}I||p(L=>L.length===0?L:[]),w||d(null),!R.has("collaboration")&&B(k)&&y(!1)})}),a.registerCommand(Lp,()=>{const $=window.getSelection();return $!==null&&$.removeAllRanges(),y(!0),!0},ne))},[a,u]);const D=()=>{a.dispatchCommand(Lp,void 0)};return S.jsxs(S.Fragment,{children:[m&&Nt.createPortal(S.jsx(nA,{editor:a,cancelAddComment:E,submitAddComment:N}),document.body),f!=null&&!m&&Nt.createPortal(S.jsx(eA,{anchorKey:f,editor:a,showComments:b,onAddComment:D}),document.body),r!==null&&Nt.createPortal(S.jsx(dr,{className:`CommentPlugin_ShowCommentsButton ${b?"active":""}`,onClick:()=>_(!b),title:b?"Hide Comments":"Show Comments",children:S.jsx("i",{className:"comments"})}),(r==null?void 0:r.current)??document.body),b&&Nt.createPortal(S.jsx(sA,{comments:c,submitAddComment:N,deleteCommentOrThread:O,activeIDs:h,markNodeMap:u}),(i==null?void 0:i.current)??document.body)]})}function aA(){const n=x.useRef(void 0),e=x.useCallback(t=>{n.current=t},[]);return[n,e]}function lA(n,e){var t,r;const i=((t=e.current)==null?void 0:t.getComments())??[],s=i==null?void 0:i.map(a=>a.id),o=n.map(a=>{const l=s.findIndex(c=>c===a);return l!==void 0&&l>=0?i[l]:{comments:[{author:"unknown",content:"Comment not found",deleted:!1,id:"",timeStamp:0,type:"comment"}],id:a,quote:"",type:"thread"}});i.forEach(a=>{n.includes(a.id)||o.push(a)}),o&&((r=e.current)==null||r.setComments(o))}function cA(n,e){x.useEffect(()=>{var t;n.options??(n.options={}),(t=n.options).nodes??(t.nodes={}),n.options.nodes.addMissingComments=r=>{lA(r,e)}},[e,n])}x.forwardRef(function(n,e){const t=x.useRef(null),r=x.useRef(!0),i=x.useRef(null),[s,o]=x.useState(null),{children:a,onCommentChange:l,onUsjChange:c,showCommentsContainerRef:u,...f}=n,{options:{isReadonly:d}={}}=n,[h,p]=aA();cA(f,h),x.useImperativeHandle(e,()=>({focus(){var b;(b=t.current)==null||b.focus()},undo(){var b;(b=t.current)==null||b.undo()},redo(){var b;(b=t.current)==null||b.redo()},cut(){var b;(b=t.current)==null||b.cut()},copy(){var b;(b=t.current)==null||b.copy()},paste(){var b;(b=t.current)==null||b.paste()},pastePlainText(){var b;(b=t.current)==null||b.pastePlainText()},getUsj(){var b;return(b=t.current)==null?void 0:b.getUsj()},setUsj(b){var _;(_=t.current)==null||_.setUsj(b)},applyUpdate(b,_){var C;(C=t.current)==null||C.applyUpdate(b,_)},getSelection(){var b;return(b=t.current)==null?void 0:b.getSelection()},setSelection(b){var _;(_=t.current)==null||_.setSelection(b)},addAnnotation(b,_,C){var E;(E=t.current)==null||E.addAnnotation(b,_,C)},removeAnnotation(b,_){var C;(C=t.current)==null||C.removeAnnotation(b,_)},formatPara(b){var _;(_=t.current)==null||_.formatPara(b)},insertNote(b,_,C){var E;(E=t.current)==null||E.insertNote(b,_,C)},selectNote(b){var _;(_=t.current)==null||_.selectNote(b)},setComments(b){var _;(_=h.current)==null||_.setComments(b),r.current=!0},get toolbarEndRef(){return s}}));const m=x.useCallback((b,_,C)=>{var E;if(!c)return;const O=(E=h.current)==null?void 0:E.getComments();c(b,O,_,C)},[h,c]),y=x.useCallback(()=>{var b;if(!l||r.current){r.current=!1;return}const _=(b=h.current)==null?void 0:b.getComments();l(_)},[h,r,l]);return x.useEffect(()=>{var b;return o(((b=t.current)==null?void 0:b.toolbarEndRef)??null),()=>o(null)},[]),S.jsxs(vv,{ref:t,onUsjChange:m,...f,children:[S.jsx(oA,{setCommentStore:p,onChange:y,showCommentsContainerRef:d?null:u??s,commentContainerRef:i,logger:f.logger}),S.jsx("div",{ref:i,className:"comment-container"})]})});const Lf=x.memo(function({viewMode:e,description:t,children:r}){const i=e==="story",s=x.useMemo(()=>!i||typeof t!="string"||!t.trim()?null:S.jsxs(Uv,{className:"tw-w-full",children:[S.jsx(zv,{className:"tw-pb-2",children:S.jsx(Wv,{className:"tw-text-sm tw-font-medium tw-text-muted-foreground",children:"Story Description"})}),S.jsx(Kv,{className:"tw-pt-2",children:S.jsx(Bv,{className:"tw-prose-sm tw-max-w-none tw-text-muted-foreground",markdown:t})})]}),[t,i]);return S.jsxs("div",{style:{display:"grid",gap:8},children:[r,s]})});Lf.__docgenInfo={description:"",methods:[],displayName:"CanvasWithDescription",props:{viewMode:{required:!1,tsType:{name:"string"},description:""},description:{required:!1,tsType:{name:"string"},description:""},children:{required:!0,tsType:{name:"ReactNode"},description:""}}};const ld={m:"m - Paragraph - Margin - No First Line Indent",ms:"ms - Heading - Major Section Level 1",nb:"nb - Paragraph - No Break with Previous Paragraph",p:"p - Paragraph - Normal - First Line Indent",pi:"pi - Paragraph - Indented - Level 1 - First Line Indent",q1:"q1 - Poetry - Indent Level 1",q2:"q2 - Poetry - Indent Level 2",r:"r - Heading - Parallel References",s:"s - Heading - Section Level 1"},jp={...ld,ide:"ide - File - Encoding",h:"h - File - Header",h1:"h1 - File - Header",h2:"h2 - File - Left Header",h3:"h3 - File - Right Header",toc1:"toc1 - File - Long Table of Contents Text",toc2:"toc2 - File - Short Table of Contents Text",toc3:"toc3 - File - Book Abbreviation",cl:"cl - Chapter - Publishing Label",mt:"mt - Title - Major Title Level 1",mt1:"mt1 - Title - Major Title Level 1",mt2:"mt2 - Title - Major Title Level 2",mt3:"mt3 - Title - Major Title Level 3",mt4:"mt4 - Title - Major Title Level 4",ms1:"ms1 - Heading - Major Section Level 1",ms2:"ms2 - Heading - Major Section Level 2",ms3:"ms3 - Heading - Major Section Level 3",b:"b - Poetry - Stanza Break (Blank Line)"},Fp={m:zo,ms:yi,nb:zo,p:zo,pi:zo,q1:Sc,q2:Sc,r:yi,s:yi,ide:wn,h:wn,h1:wn,h2:wn,h3:wn,toc1:wn,toc2:wn,toc3:wn,cl:wn,mt:yi,mt1:yi,mt2:jf,mt3:wc,mt4:wc,ms1:yi,ms2:jf,ms3:wc,b:Sc};function qp({blockMarker:n,className:e}){const t=n&&n in Fp?Fp[n]:tk;return S.jsx(t,{className:e,size:16})}function Nv({editorRef:n,blockMarker:e}){return S.jsxs(Vv,{children:[S.jsx(Gv,{asChild:!0,children:S.jsxs(bi,{variant:"outline",className:"","aria-label":"Formatting options for block type",children:[S.jsx(qp,{blockMarker:e,className:"tw-me-2"}),uA(e),S.jsx(Zv,{className:"tw-ms-2"})]})}),S.jsx(Yv,{children:Object.keys(ld).map(t=>S.jsxs(Xv,{className:`item block-marker ${dA(e===t)}`,onClick:()=>{var r;return(r=n.current)==null?void 0:r.formatPara(t)},children:[S.jsx(qp,{blockMarker:t,className:"tw-me-2"}),S.jsx("span",{className:`text usfm_${t}`,children:ld[t]})]},t))})]})}function uA(n){return n&&n in jp?jp[n]:"No Style"}function dA(n){return n?"active dropdown-item-active":""}Nv.__docgenInfo={description:"",methods:[],displayName:"BlockFormatDropDown",props:{editorRef:{required:!0,tsType:{name:"MutableRefObject",elements:[{name:"union",raw:"EditorRef | null",elements:[{name:"EditorRef"},{name:"null"}]}],raw:"MutableRefObject<EditorRef | null>"},description:""},blockMarker:{required:!0,tsType:{name:"union",raw:"string | undefined",elements:[{name:"string"},{name:"undefined"}]},description:""}}};const fA={columns:{"platformScriptureEditor.edit":{label:"Edit",order:1},"platformScriptureEditor.insert":{label:"Insert",order:2}},groups:{"platformScriptureEditor.clipboard":{column:"platformScriptureEditor.edit",order:1},"platformScriptureEditor.insertNote":{column:"platformScriptureEditor.insert",order:1}},items:[{label:"Insert footnote",group:"platformScriptureEditor.insertNote",order:1,command:"platformScriptureEditor.insertFootnoteAtSelection",localizeNotes:""},{label:"Insert cross-reference",group:"platformScriptureEditor.insertNote",order:2,command:"platformScriptureEditor.insertCrossReferenceAtSelection",localizeNotes:""},{label:"Insert endnote",group:"platformScriptureEditor.insertNote",order:3,command:"platformScriptureEditor.insertEndnoteAtSelection",localizeNotes:""},{label:"Cut",group:"platformScriptureEditor.clipboard",order:1,command:"platformScriptureEditor.cut",localizeNotes:""},{label:"Copy",group:"platformScriptureEditor.clipboard",order:2,command:"platformScriptureEditor.copy",localizeNotes:""},{label:"Paste",group:"platformScriptureEditor.clipboard",order:3,command:"platformScriptureEditor.paste",localizeNotes:""},{label:"Paste as plain text",group:"platformScriptureEditor.clipboard",order:4,command:"platformScriptureEditor.pastePlainText",localizeNotes:""}]};function Mv({editorRef:n,scrRef:e,onScrRefChange:t,isReadonly:r=!1,canUndo:i=!1,canRedo:s=!1,blockMarker:o}){const a=()=>{var d;(d=n.current)==null||d.insertNote("f")},l=()=>{var d;(d=n.current)==null||d.insertNote("x")},c=()=>{var d;(d=n.current)==null||d.insertNote("fe")},u=d=>{var h,p,m,y;switch(d.command){case"platformScriptureEditor.insertFootnoteAtSelection":a();break;case"platformScriptureEditor.insertCrossReferenceAtSelection":l();break;case"platformScriptureEditor.insertEndnoteAtSelection":c();break;case"platformScriptureEditor.cut":(h=n.current)==null||h.cut();break;case"platformScriptureEditor.copy":(p=n.current)==null||p.copy();break;case"platformScriptureEditor.paste":(m=n.current)==null||m.paste();break;case"platformScriptureEditor.pastePlainText":(y=n.current)==null||y.pastePlainText();break;default:throw new Error(`Unknown onSelectProjectMenuItem command: ${d.command}`)}},f=()=>{};return S.jsx(Jv,{onSelectProjectMenuItem:u,onSelectViewInfoMenuItem:f,projectMenuData:fA,className:"toolbar",startAreaChildren:S.jsxs(S.Fragment,{children:[S.jsx("div",{className:"tw-flex tw-h-full tw-items-center",children:S.jsx(Hv,{scrRef:e,handleSubmit:t})}),!r&&S.jsxs(S.Fragment,{children:[S.jsx(bi,{"aria-label":"Undo",title:"Undo",variant:"ghost",size:"icon",onClick:()=>{var d;return(d=n.current)==null?void 0:d.undo()},disabled:!i,children:S.jsx(pk,{})}),S.jsx(bi,{"aria-label":"Redo",title:"Redo",variant:"ghost",size:"icon",onClick:()=>{var d;return(d=n.current)==null?void 0:d.redo()},disabled:!s,children:S.jsx(lk,{})}),S.jsx(Nv,{editorRef:n,blockMarker:o}),S.jsx(bi,{"aria-label":"Insert footnote",title:"Insert footnote",variant:"ghost",size:"icon",onClick:a,children:S.jsx(fk,{})}),S.jsx(bi,{"aria-label":"Insert cross-reference",title:"Insert cross-reference",variant:"ghost",size:"icon",onClick:l,children:S.jsx(uk,{})}),S.jsx(bi,{"aria-label":"Insert endnote",title:"Insert endnote",variant:"ghost",size:"icon",onClick:c,children:S.jsx(ok,{})})]})]})})}Mv.__docgenInfo={description:"",methods:[],displayName:"PlatformToolbar",props:{editorRef:{required:!0,tsType:{name:"RefObject",elements:[{name:"union",raw:"MarginalRef | EditorRef | null",elements:[{name:"MarginalRef"},{name:"EditorRef"},{name:"null"}]}],raw:"RefObject<MarginalRef | EditorRef | null>"},description:""},scrRef:{required:!0,tsType:{name:"SerializedVerseRef"},description:""},onScrRefChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(scrRef: SerializedVerseRef) => void",signature:{arguments:[{type:{name:"SerializedVerseRef"},name:"scrRef"}],return:{name:"void"}}},description:""},isReadonly:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},canUndo:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},canRedo:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},blockMarker:{required:!1,tsType:{name:"string"},description:""}}};function si(n,e,t){var d,h,p,m;const r=x.useRef(null),[i,s]=x.useState(t),[o,a]=x.useState(!1),[l,c]=x.useState(!1),[u,f]=x.useState();return S.jsxs(Lf,{viewMode:e.viewMode,description:((p=(h=(d=e.parameters)==null?void 0:d.docs)==null?void 0:h.description)==null?void 0:p.story)??((m=e.parameters)==null?void 0:m.description),children:[S.jsx(Mv,{editorRef:r,scrRef:i,onScrRefChange:s,isReadonly:!1,canUndo:o,canRedo:l,blockMarker:u}),S.jsx(Ll,{...n,ref:r,scrRef:i,onScrRefChange:s,onStateChange:(y,b,_)=>{a(y),c(b),f(_)}})]})}si.__docgenInfo={description:`Render function that combines the Editorial component with a PlatformToolbar. This provides a
complete editing experience with undo/redo, navigation, and other toolbar features.

Use this as a render function in a Storybook story, not as a component.`,methods:[],displayName:"renderEditorialWithToolbar"};const hA='<usx version="3.1" />',gA=cd(hA),pA=`<?xml version="1.0" encoding="utf-8"?>
<usx version="3.1">
  <book code="PSA" style="id">World English Bible (WEB)</book>
  <para style="mt1">The Psalms</para>
  <chapter number="1" style="c" sid="PSA 1" />
  <para style="q1">
    <verse number="1" style="v" sid="PSA 1:1" />Blessed is the man who doesn’t walk in the counsel of the wicked<note caller="+" style="f"><char style="fr">1:1 </char><char style="ft">Or "sinful"</char></note>,</para>
  <para style="q2" vid="PSA 1:1">nor stand on the path<note caller="+" style="f"><char style="fr">1:1 </char><char style="ft">Hebrew: "way"</char></note> of sinners,</para>
  <para style="q2" vid="PSA 1:1">nor sit in the seat of scoffers;<verse eid="PSA 1:1" /></para>
  <para style="q1">
    <verse number="2" style="v" sid="PSA 1:2" /><note caller="+" style="f"><char style="fr" closed="false">1:2 </char><char style="ft" closed="false">After verse</char></note> but his delight is in Yahweh’s<note caller="+" style="f"><char style="fr" closed="false">1:2 </char><char style="ft" closed="false">“Yahweh” is God’s proper Name, sometimes rendered “LORD” (all caps) in other translations.</char></note> law.<note caller="+" style="f"><char style="fr" closed="false">1:2 </char><char style="ft" closed="false">End of Para</char></note></para>
  <para style="q2" vid="PSA 1:2">On his law he meditates day and night.<note caller="+" style="f"><char style="fr" closed="false">1:2 </char><char style="ft" closed="false">End of Doc</char></note><verse eid="PSA 1:2" /></para>
</usx>
`,zn=cd(pA),mA={start:{jsonPath:"$.content[3].content[1]",offset:15},end:{jsonPath:"$.content[3].content[1]",offset:18}},yA={start:{jsonPath:"$.content[3].content[1]",offset:15},end:{jsonPath:"$.content[3].content[1]",offset:22}},_A=`<?xml version="1.0" encoding="utf-8"?>
<usx version="3.1">
  <book code="PSA" style="id">תהילים</book>
  <para style="mt1">תהילים</para>
  <chapter number="1" style="c" sid="PSA 1" />
  <para style="q1">
    <verse number="1" style="v" sid="PSA 1:1" />אשרי האיש אשר לא הלך בעצת רשעים,</para>
  <para style="q2" vid="PSA 1:1">ובדרך חטאים לא עמד,</para>
  <para style="q2" vid="PSA 1:1">ובמושב לצים לא ישב.<verse eid="PSA 1:1" /></para>
  <para style="q1">
    <verse number="2" style="v" sid="PSA 1:2" />כי אם בתורת יהוה חפצו,</para>
  <para style="q2" vid="PSA 1:2">ובתורתו יהגה יומם ולילה.<verse eid="PSA 1:2" /></para>
</usx>
`,bA=cd(_A),qt={book:"PSA",chapterNum:1,verseNum:1},LO={title:"Demo/Editorial",component:Ll,tags:["autodocs"],parameters:{docs:{description:{component:`
**Demo Only:** This component is provided for demonstration purposes only. For production applications, developers should import the Scripture Editor component directly from:
- npm [@eten-tech-foundation/platform-editor](https://www.npmjs.com/package/@eten-tech-foundation/platform-editor)
- github [eten-tech-foundation/platform-editor](https://github.com/eten-tech-foundation/scripture-editors/tree/main/packages/platform)

This demo version is included in Storybook to showcase the component's functionality and usage patterns.

**Known Limitation:** In the Docs view, all story examples may show the same note caller style due to global state management in the editor component. To see the correct note caller behavior for each story (default lowercase letters vs custom symbols), please view the individual stories in the Canvas view instead of the Docs view.
        `}}},argTypes:{ref:{control:"object",description:"Reference to the editor instance",defaultValue:null},defaultUsj:{control:"object",description:"Default USJ object to initialize the editor with",defaultValue:{type:Oi,version:Ai,content:[""]}},scrRef:{control:"object",description:"Scripture reference",defaultValue:qt},options:{control:"object",description:"Options to configure the editor (EditorOptions)",defaultValue:{},table:{type:{summary:"EditorOptions",detail:'{ isReadonly?: boolean; hasSpellCheck?: boolean; textDirection?: "ltr" | "rtl" | "auto"; markerMenuTrigger?: string; nodes?: UsjNodeOptions; }'}}}}},la={args:{defaultUsj:zn,scrRef:qt}},ca={args:{defaultUsj:gA,scrRef:qt}},ua={args:{defaultUsj:zn,scrRef:qt,options:{isReadonly:!0}}},da={render:(n,e)=>si(n,e,qt),parameters:{docs:{description:{story:'Right-to-left example using a Hebrew snippet (Psalm 1:1). The editor is set to RTL via _options.textDirection = "rtl"_. If you want the UI (tab toolbar) to be RTL click **Switch direction** in the Storybook toolbar.'}}},args:{defaultUsj:bA,options:{hasExternalUI:!0,textDirection:"rtl"}}},fa={render:n=>{const e=x.useRef(null);return x.useEffect(()=>{e.current&&(e.current.addAnnotation(mA,"spelling","annotationId"),e.current.addAnnotation(yA,"grammar","abc123"))},[]),S.jsx(Ll,{...n,ref:e})},args:{defaultUsj:zn,scrRef:qt}},vA={hasExternalUI:!0,view:{...Co(),noteMode:"expandInline"},nodes:{noteCallerOnClick:(n,e,t,r,i)=>{t||(r()===Jr?i(df):i(Jr))}}},ha={render:(n,e)=>si(n,e,qt),parameters:{docs:{description:{story:"This story demonstrates editing notes inline. Move your cursor to a note caller and the note will expand and can be edited. Move the cursor out of the note and it will collapse. Click the expanded note caller to toggle between the auto-generated caller and the hidden caller."}}},args:{defaultUsj:zn,options:vA}},kA={hasExternalUI:!0,view:{...Co(),noteMode:"expandInline"}},ga={render:(n,e)=>si(n,e,qt),parameters:{docs:{description:{story:'This story demonstrates inserting notes. Use the Project menu (hamburger) or the toolbar buttons above the editor to insert footnotes, cross-references, and endnotes at the current cursor position. Selecting text before inserting a footnote will use that text as the footnote quote. You can also insert by typing "\\f", "\\x", or "\\fe".'}}},args:{defaultUsj:zn,options:kA}},xA={hasExternalUI:!0,nodes:{noteCallers:["①","②","③","④","⑤","⑥","⑦","⑧","⑨","⑩"],noteCallerOnClick:n=>{console.log("Note caller clicked:",n),alert("Note caller clicked! Check console for details.")}}},pa={render:(n,e)=>si(n,e,qt),parameters:{docs:{description:{story:"This story demonstrates custom note callers and click handling. **Try clicking on the circled number footnote markers (① ②) in the text to see the click handler in action!** The click event will show an alert and log details to the browser console."}}},args:{defaultUsj:zn,options:xA}},ma={render:(n,e)=>si(n,e,qt),parameters:{docs:{description:{story:'This story demonstrates using a custom marker menu trigger key. **Try typing "?" (question mark) anywhere in the editor text to open the marker menu!** The default trigger is "\\\\" (backslash), but this story changes it to "?" for demonstration. The marker menu allows you to insert USFM markers into the text.'}}},args:{defaultUsj:zn,options:{hasExternalUI:!0,markerMenuTrigger:"?"}}},ya={render:(n,e)=>{var c,u,f,d;const t=x.useRef(null),[r,i]=x.useState(null),[s,o]=x.useState(!1),a=x.useMemo(()=>({...n.options??{},view:{markerMode:s?"visible":"hidden",hasSpacing:!0,isFormattedFont:!0}}),[n.options,s]);x.useEffect(()=>{var p,m;const h=(m=(p=t.current)==null?void 0:p.toolbarEndRef)==null?void 0:m.current;if(h)i(h);else{const y=window.setTimeout(()=>{var _,C;const b=(C=(_=t.current)==null?void 0:_.toolbarEndRef)==null?void 0:C.current;b&&i(b)},0);return()=>window.clearTimeout(y)}},[a]);const l=x.useCallback(()=>o(h=>!h),[]);return S.jsxs(Lf,{viewMode:e.viewMode,description:((f=(u=(c=e.parameters)==null?void 0:c.docs)==null?void 0:u.description)==null?void 0:f.story)??((d=e.parameters)==null?void 0:d.description),children:[S.jsx(Ll,{...n,options:a,ref:t}),r&&Nt.createPortal(S.jsx("button",{type:"button",title:"Show/hide markers","aria-label":"Show/hide markers","aria-pressed":s,className:`toolbar-item ${s?"active":""}`,onClick:l,children:S.jsx("span",{className:"icon pilcrow-icon","aria-hidden":"true",children:"¶"})}),r)]})},parameters:{docs:{description:{story:"This story demonstrates the Markers view, which shows USFM markers inline with the text. Click the **Show/hide markers** (¶) button in the editor toolbar to toggle the Markers view on and off. "}}},args:{defaultUsj:zn,scrRef:qt}},_a={name:"View Options",render:(n,e)=>si(n,e,qt),parameters:{docs:{description:{story:'Demonstrates the editor view options (marker visibility, spacing, and formatted font) using USX input. Below in the **Controls** tab, try changing the **options.view** values to see how they affect the editor display. Valid values for **markerMode** are _"hidden"_, _"visible"_, and _"editable"_.'}}},args:{defaultUsj:zn,options:{hasExternalUI:!0,view:{markerMode:"hidden",hasSpacing:!0,isFormattedFont:!0}}}};var Bp,Up,zp;la.parameters={...la.parameters,docs:{...(Bp=la.parameters)==null?void 0:Bp.docs,source:{originalSource:`{
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef
  }
}`,...(zp=(Up=la.parameters)==null?void 0:Up.docs)==null?void 0:zp.source}}};var Wp,Kp,Hp;ca.parameters={...ca.parameters,docs:{...(Wp=ca.parameters)==null?void 0:Wp.docs,source:{originalSource:`{
  args: {
    defaultUsj: usjEmpty,
    scrRef: defaultScrRef
  }
}`,...(Hp=(Kp=ca.parameters)==null?void 0:Kp.docs)==null?void 0:Hp.source}}};var Jp,Vp,Gp;ua.parameters={...ua.parameters,docs:{...(Jp=ua.parameters)==null?void 0:Jp.docs,source:{originalSource:`{
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef,
    options: {
      isReadonly: true
    }
  }
}`,...(Gp=(Vp=ua.parameters)==null?void 0:Vp.docs)==null?void 0:Gp.source}}};var Yp,Xp,Zp;da.parameters={...da.parameters,docs:{...(Yp=da.parameters)==null?void 0:Yp.docs,source:{originalSource:`{
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'Right-to-left example using a Hebrew snippet (Psalm 1:1). ' + 'The editor is set to RTL via _options.textDirection = "rtl"_. If you want the UI ' + '(tab toolbar) to be RTL click **Switch direction** in the Storybook toolbar.'
      }
    }
  },
  args: {
    defaultUsj: usjHebrew,
    options: {
      hasExternalUI: true,
      textDirection: 'rtl'
    }
  }
}`,...(Zp=(Xp=da.parameters)==null?void 0:Xp.docs)==null?void 0:Zp.source}}};var Qp,em,tm;fa.parameters={...fa.parameters,docs:{...(Qp=fa.parameters)==null?void 0:Qp.docs,source:{originalSource:`{
  render: args => {
    // eslint-disable-next-line no-null/no-null
    const editorRef = useRef<EditorRef | null>(null);
    useEffect(() => {
      if (editorRef.current) {
        editorRef.current.addAnnotation(annotationRangeWeb1, 'spelling', 'annotationId');
        editorRef.current.addAnnotation(annotationRangeWeb2, 'grammar', 'abc123');
      }
    }, []);
    return <Editorial {...args} ref={editorRef} />;
  },
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef
  }
}`,...(tm=(em=fa.parameters)==null?void 0:em.docs)==null?void 0:tm.source}}};var nm,rm,im;ha.parameters={...ha.parameters,docs:{...(nm=ha.parameters)==null?void 0:nm.docs,source:{originalSource:`{
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates editing notes inline. Move your cursor to a note caller and ' + 'the note will expand and can be edited. Move the cursor out of the note and it will ' + 'collapse. Click the expanded note caller to toggle between the auto-generated caller ' + 'and the hidden caller.'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    options: inlineNoteOptions
  }
}`,...(im=(rm=ha.parameters)==null?void 0:rm.docs)==null?void 0:im.source}}};var sm,om,am;ga.parameters={...ga.parameters,docs:{...(sm=ga.parameters)==null?void 0:sm.docs,source:{originalSource:`{
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates inserting notes. Use the Project menu (hamburger) or the ' + 'toolbar buttons above the editor to insert footnotes, cross-references, and endnotes ' + 'at the current cursor position. Selecting text before inserting a footnote will use ' + 'that text as the footnote quote. You can also insert by typing "\\\\f", "\\\\x", or "\\\\fe".'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    options: insertNoteOptions
  }
}`,...(am=(om=ga.parameters)==null?void 0:om.docs)==null?void 0:am.source}}};var lm,cm,um;pa.parameters={...pa.parameters,docs:{...(lm=pa.parameters)==null?void 0:lm.docs,source:{originalSource:`{
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates custom note callers and click handling. **Try clicking on the ' + 'circled number footnote markers (① ②) in the text to see the click handler in ' + 'action!** The click event will show an alert and log details to the browser console.'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    options: customNodeOptions
  }
}`,...(um=(cm=pa.parameters)==null?void 0:cm.docs)==null?void 0:um.source}}};var dm,fm,hm;ma.parameters={...ma.parameters,docs:{...(dm=ma.parameters)==null?void 0:dm.docs,source:{originalSource:`{
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates using a custom marker menu trigger key. **Try typing "?" ' + '(question mark) anywhere in the editor text to open the marker menu!** The default ' + 'trigger is "\\\\\\\\" (backslash), but this story changes it to "?" for demonstration. ' + 'The marker menu allows you to insert USFM markers into the text.'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    options: {
      hasExternalUI: true,
      markerMenuTrigger: '?'
    }
  }
}`,...(hm=(fm=ma.parameters)==null?void 0:fm.docs)==null?void 0:hm.source}}};var gm,pm,mm;ya.parameters={...ya.parameters,docs:{...(gm=ya.parameters)==null?void 0:gm.docs,source:{originalSource:`{
  render: (args, context) => {
    // eslint-disable-next-line no-null/no-null
    const editorRef = useRef<EditorRef | null>(null);
    // eslint-disable-next-line no-null/no-null
    const [toolbarEndEl, setToolbarEndEl] = useState<HTMLElement | null>(null);
    const [showMarkers, setShowMarkers] = useState(false);
    const mergedOptions = useMemo(() => {
      const base = args.options ?? {};
      const view: ViewOptions = {
        markerMode: showMarkers ? 'visible' : 'hidden',
        hasSpacing: true,
        isFormattedFont: true
      };
      return {
        ...base,
        view
      };
    }, [args.options, showMarkers]);
    useEffect(() => {
      const el = editorRef.current?.toolbarEndRef?.current;
      if (el) setToolbarEndEl(el);else {
        // Retry once on next tick in case the toolbar mounts after the ref effect
        const id = window.setTimeout(() => {
          const el2 = editorRef.current?.toolbarEndRef?.current;
          if (el2) setToolbarEndEl(el2);
        }, 0);
        return () => window.clearTimeout(id);
      }
      return undefined;
    }, [mergedOptions]);
    const handleShowMarkerToggle = useCallback(() => setShowMarkers(v => !v), []);
    return <CanvasWithDescription viewMode={context.viewMode} description={context.parameters?.docs?.description?.story ?? context.parameters?.description}>
        <Editorial {...args} options={mergedOptions} ref={editorRef} />
        {toolbarEndEl && createPortal(<button type="button" title="Show/hide markers" aria-label="Show/hide markers" aria-pressed={showMarkers} className={\`toolbar-item \${showMarkers ? 'active' : ''}\`} onClick={handleShowMarkerToggle}>
              <span className="icon pilcrow-icon" aria-hidden="true">
                ¶
              </span>
            </button>, toolbarEndEl)}
      </CanvasWithDescription>;
  },
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates the Markers view, which shows USFM markers inline with the ' + 'text. Click the **Show/hide markers** (¶) button in the editor toolbar to toggle the ' + 'Markers view on and off. '
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef
  }
}`,...(mm=(pm=ya.parameters)==null?void 0:pm.docs)==null?void 0:mm.source}}};var ym,_m,bm;_a.parameters={..._a.parameters,docs:{...(ym=_a.parameters)==null?void 0:ym.docs,source:{originalSource:`{
  name: 'View Options',
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'Demonstrates the editor view options (marker visibility, spacing, and formatted font) ' + 'using USX input. Below in the **Controls** tab, try changing the **options.view** ' + 'values to see how they affect the editor display. Valid values for **markerMode** are ' + '_"hidden"_, _"visible"_, and _"editable"_.'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    options: {
      hasExternalUI: true,
      view: {
        markerMode: 'hidden',
        hasSpacing: true,
        isFormattedFont: true
      }
    }
  }
}`,...(bm=(_m=_a.parameters)==null?void 0:_m.docs)==null?void 0:bm.source}}};const DO=["Default","Empty","ReadOnly","RTL","Annotated","InlineNoteEditing","InsertNote","CustomNoteOptions","CustomMarkerTrigger","MarkersView","ViewOptionsStory"];export{fa as Annotated,ma as CustomMarkerTrigger,pa as CustomNoteOptions,la as Default,ca as Empty,ha as InlineNoteEditing,ga as InsertNote,ya as MarkersView,da as RTL,ua as ReadOnly,_a as ViewOptionsStory,DO as __namedExportsOrder,LO as default};
