import{j as s}from"./jsx-runtime-J3BB4-gP.js";import{B as K}from"./button-DbnBzV_G.js";import{m as y,C as z,a as U,P as he,b as fe,c as we,d as ge,e as ke,f as be}from"./index.es-B2O1xZuo.js";import{r,b as Ce}from"./iframe-CY5uwS6E.js";import{c as M}from"./shadcn-ui.util-DMJ19wEV.js";import{q as Ne,w as X}from"./index-5K9QuiCI.js";import{c as A}from"./index-CyYdYC-x.js";import{C as Z}from"./chevron-right-DKkldXud.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],ye=A("ArrowLeft",xe);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],Te=A("ArrowRight",ve);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],J=A("ChevronLeft",Ee);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=[["path",{d:"m11 17-5-5 5-5",key:"13zhaf"}],["path",{d:"m18 17-5-5 5-5",key:"h8a8et"}]],W=A("ChevronsLeft",Le);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=[["path",{d:"m6 17 5-5-5-5",key:"xnjwq"}],["path",{d:"m13 17 5-5-5-5",key:"17xmmf"}]],ee=A("ChevronsRight",Oe),re=y.allBookIds.filter(e=>!y.isObsolete(y.bookIdToNumber(e))),N=Object.fromEntries(re.map(e=>[e,y.bookIdToEnglishName(e)])),je={OT:"Old Testament",NT:"New Testament",DC:"Deuterocanon",Extra:"Extra"},F={BOOK_ONLY:/^([^:\s]+(?:\s+[^:\s]+)*)$/i,BOOK_CHAPTER:/^([^:\s]+(?:\s+[^:\s]+)*)\s+(\d+)$/i,BOOK_CHAPTER_VERSE:/^([^:\s]+(?:\s+[^:\s]+)*)\s+(\d+):(\d*)$/i},_e=[F.BOOK_ONLY,F.BOOK_CHAPTER,F.BOOK_CHAPTER_VERSE];function te(e){const o=/^[a-zA-Z]$/.test(e),w=/^[0-9]$/.test(e);return{isLetter:o,isDigit:w}}function v(e){return Ne(y.bookIdToNumber(e))}function Be(e,o){if(!e.trim()||o.length===0)return;const w=_e.reduce((u,x)=>{if(u)return u;const b=x.exec(e.trim());if(b){const[c,g=void 0,C=void 0]=b.slice(1);let i;const f=c.toLowerCase(),l=o.filter(p=>N[p].toLowerCase().includes(f)||p.toLowerCase().includes(f));if(l.length===1&&([i]=l),!i&&g&&y.isBookIdValid(c)){const p=c.toUpperCase();o.includes(p)&&(i=p)}if(!i&&g){const m=(L=>Object.keys(N).find($=>N[$].toLowerCase()===L.toLowerCase()))(c);m&&o.includes(m)&&(i=m)}if(i){let p=g?parseInt(g,10):void 0;p&&p>v(i)&&(p=Math.max(v(i),1));const m=C?parseInt(C,10):void 0;return{book:i,chapterNum:p,verseNum:m}}}},void 0);if(w)return w}function oe(e,o){return`${e} ${N[e]}${o?` ${o}`:""}`}function De(e,o,w,u){const x=r.useCallback(()=>{if(e.chapterNum>1)u({book:e.book,chapterNum:e.chapterNum-1,verseNum:1});else{const C=o.indexOf(e.book);if(C>0){const i=o[C-1],f=Math.max(v(i),1);u({book:i,chapterNum:f,verseNum:1})}}},[e,o,u]),b=r.useCallback(()=>{const C=v(e.book);if(e.chapterNum<C)u({book:e.book,chapterNum:e.chapterNum+1,verseNum:1});else{const i=o.indexOf(e.book);if(i<o.length-1){const f=o[i+1];u({book:f,chapterNum:1,verseNum:1})}}},[e,o,u]),c=r.useCallback(()=>{u({book:e.book,chapterNum:e.chapterNum,verseNum:e.verseNum>1?e.verseNum-1:0})},[e,u]),g=r.useCallback(()=>{u({book:e.book,chapterNum:e.chapterNum,verseNum:e.verseNum+1})},[e,u]);return r.useMemo(()=>[{onClick:x,disabled:o.length===0||e.chapterNum===1&&o.indexOf(e.book)===0,title:"Previous chapter",icon:w==="ltr"?W:ee},{onClick:c,disabled:o.length===0||e.verseNum===0,title:"Previous verse",icon:w==="ltr"?J:Z},{onClick:g,disabled:o.length===0,title:"Next verse",icon:w==="ltr"?Z:J},{onClick:b,disabled:o.length===0||(e.chapterNum===v(e.book)||v(e.book)===-1)&&o.indexOf(e.book)===o.length-1,title:"Next chapter",icon:w==="ltr"?ee:W}],[e,o,w,x,c,g,b])}function G({bookId:e,scrRef:o,onChapterSelect:w,setChapterRef:u,isChapterDimmed:x,className:b}){if(e)return s.jsx(z,{children:s.jsx("div",{className:M("tw-grid tw-grid-cols-6 tw-gap-1",b),children:Array.from({length:v(e)},(c,g)=>g+1).map(c=>s.jsx(U,{value:`${e} ${N[e]||""} ${c}`,onSelect:()=>w(c),ref:u(c),className:M("tw-h-8 tw-w-8 tw-cursor-pointer tw-justify-center tw-rounded-md tw-text-center tw-text-sm",{"tw-bg-primary tw-text-primary-foreground":e===o.book&&c===o.chapterNum},{"tw-bg-muted/50 tw-text-muted-foreground/50":(x==null?void 0:x(c))??!1}),children:c},c))})})}G.__docgenInfo={description:`Renders a grid of chapter numbers for a given book, with highlighting for the current chapter and
optional dimmed chapters based on state logic.`,methods:[],displayName:"ChapterGrid",props:{bookId:{required:!0,tsType:{name:"string"},description:"The book ID to render chapters for"},scrRef:{required:!0,tsType:{name:"signature",type:"object",raw:"{ book: string; chapterNum: number }",signature:{properties:[{key:"book",value:{name:"string",required:!0}},{key:"chapterNum",value:{name:"number",required:!0}}]}},description:"Current scripture reference for highlighting"},onChapterSelect:{required:!0,tsType:{name:"signature",type:"function",raw:"(chapter: number) => void",signature:{arguments:[{type:{name:"number"},name:"chapter"}],return:{name:"void"}}},description:"Callback when a chapter is selected"},setChapterRef:{required:!0,tsType:{name:"signature",type:"function",raw:"(chapter: number) => (element: HTMLDivElement | null) => void",signature:{arguments:[{type:{name:"number"},name:"chapter"}],return:{name:"signature",type:"function",raw:"(element: HTMLDivElement | null) => void",signature:{arguments:[{type:{name:"union",raw:"HTMLDivElement | null",elements:[{name:"HTMLDivElement"},{name:"null"}]},name:"element"}],return:{name:"void"}}}}},description:"Function to set chapter refs for keyboard navigation"},isChapterDimmed:{required:!1,tsType:{name:"signature",type:"function",raw:"(chapter: number) => boolean",signature:{arguments:[{type:{name:"number"},name:"chapter"}],return:{name:"boolean"}}},description:"Optional function to determine if a chapter should be dimmed"},className:{required:!1,tsType:{name:"string"},description:"Optional additional class name for styling"}}};function Ie({scrRef:e,handleSubmit:o,className:w,getActiveBookIds:u}){const x=Ce(),[b,c]=r.useState(!1),[g,C]=r.useState(""),[i,f]=r.useState(""),[l,p]=r.useState("books"),[m,L]=r.useState(void 0),[$,S]=r.useState(!1),P=r.useRef(void 0),O=r.useRef(void 0),j=r.useRef(void 0),V=r.useRef(void 0),q=r.useRef({}),_=r.useMemo(()=>u?u():re,[u]),B=r.useMemo(()=>({OT:_.filter(a=>y.isBookOT(a)),NT:_.filter(a=>y.isBookNT(a)),DC:_.filter(a=>y.isBookDC(a)),Extra:_.filter(a=>y.extraBooks().includes(a))}),[_]),H=r.useMemo(()=>Object.values(B).flat(),[B]),ne=r.useMemo(()=>{if(!i.trim())return B;const t=i.toLowerCase().trim(),a={OT:[],NT:[],DC:[],Extra:[]};return["OT","NT","DC","Extra"].forEach(k=>{a[k]=B[k].filter(h=>N[h].toLowerCase().includes(t)||h.toLowerCase().includes(t))}),a},[B,i]),n=r.useMemo(()=>Be(i,H),[i,H]),se=r.useCallback(()=>{n&&(o({book:n.book,chapterNum:n.chapterNum??1,verseNum:n.verseNum??1}),c(!1),f(""),C(""))},[o,n]),ae=r.useCallback(t=>{if(v(t)<=1){o({book:t,chapterNum:1,verseNum:1}),c(!1),f("");return}L(t),p("chapters")},[o]),Y=r.useCallback(t=>{const a=l==="chapters"?m:n==null?void 0:n.book;a&&(o({book:a,chapterNum:t,verseNum:1}),c(!1),p("books"),L(void 0),f(""))},[o,l,m,n]),ie=De(e,H,x,o),D=r.useCallback(()=>{p("books"),L(void 0),setTimeout(()=>{O.current&&O.current.focus()},0)},[]),ce=r.useCallback(t=>{if(!t&&l==="chapters"){D();return}c(t),t&&(p("books"),L(void 0),f(""))},[l,D]),ue=r.useCallback(t=>n?!!n.chapterNum&&!t.toString().includes(n.chapterNum.toString()):!1,[n]),le=r.useMemo(()=>X(e,"English"),[e]),Q=r.useCallback(t=>a=>{q.current[t]=a},[]),me=r.useCallback(t=>{(t.key==="Home"||t.key==="End")&&t.stopPropagation()},[]),de=r.useCallback(t=>{if(t.ctrlKey)return;const{isLetter:a,isDigit:d}=te(t.key);if(l==="chapters"){if(t.key==="Backspace"){t.preventDefault(),t.stopPropagation(),D();return}if(a||d){if(t.preventDefault(),t.stopPropagation(),p("books"),L(void 0),d&&m){const k=N[m];f(`${k} ${t.key}`)}else f(t.key);setTimeout(()=>{O.current&&O.current.focus()},0);return}}if((l==="chapters"||l==="books"&&n)&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(t.key)){const k=l==="chapters"?m:n==null?void 0:n.book;if(!k)return;const h=(()=>{if(!g)return 1;const I=g.match(/(\d+)$/);return I?parseInt(I[1],10):0})(),E=v(k);if(!E)return;let T=h;const R=6;switch(t.key){case"ArrowLeft":h!==0&&(T=h>1?h-1:E);break;case"ArrowRight":h!==0&&(T=h<E?h+1:1);break;case"ArrowUp":T=h===0?E:Math.max(1,h-R);break;case"ArrowDown":T=h===0?1:Math.min(E,h+R);break;default:return}T!==h&&(t.preventDefault(),t.stopPropagation(),C(oe(k,T)),setTimeout(()=>{const I=q.current[T];I&&I.scrollIntoView({block:"nearest",behavior:"smooth"})},0))}},[l,n,D,m,g]),pe=r.useCallback(t=>{if(t.shiftKey||t.key==="Tab"||t.key===" ")return;const{isLetter:a,isDigit:d}=te(t.key);(a||d)&&(t.preventDefault(),f(k=>k+t.key),O.current.focus(),S(!1))},[]);return r.useLayoutEffect(()=>{const t=setTimeout(()=>{if(b&&l==="books"&&j.current&&V.current){const a=j.current,d=V.current,k=d.offsetTop,h=a.clientHeight,E=d.clientHeight,T=k-h/2+E/2;a.scrollTo({top:Math.max(0,T),behavior:"smooth"}),C(oe(e.book))}},0);return()=>{clearTimeout(t)}},[b,l,i,n,e.book]),r.useLayoutEffect(()=>{if(l==="chapters"&&m){const t=m===e.book;setTimeout(()=>{if(j.current)if(t){const a=q.current[e.chapterNum];a&&a.scrollIntoView({block:"center",behavior:"smooth"})}else j.current.scrollTo({top:0});P.current&&P.current.focus()},0)}},[l,m,n,e.book,e.chapterNum]),s.jsxs(he,{open:b,onOpenChange:ce,children:[s.jsx(fe,{asChild:!0,children:s.jsx(K,{"aria-label":"book-chapter-trigger",variant:"outline",role:"combobox","aria-expanded":b,className:M("tw-h-8 tw-w-full tw-min-w-16 tw-max-w-48 tw-overflow-hidden tw-px-1",w),children:s.jsx("span",{className:"tw-truncate",children:le})})}),s.jsx(we,{forceMount:!0,className:"tw-z-[250] tw-w-[280px] tw-p-0",align:"center",children:s.jsxs(ge,{ref:P,onKeyDown:de,loop:!0,value:g,onValueChange:C,shouldFilter:!1,children:[l==="books"?s.jsxs("div",{className:"tw-flex tw-items-end",children:[s.jsx(ke,{ref:O,value:i,onValueChange:f,onKeyDown:me,onFocus:()=>S(!1)}),s.jsx("div",{className:"tw-flex tw-items-center tw-gap-1 tw-border-b tw-pe-2",children:ie.map(({onClick:t,disabled:a,title:d,icon:k})=>s.jsx(K,{variant:"ghost",size:"sm",onClick:()=>{S(!0),t()},disabled:a,className:"tw-h-10 tw-w-4 tw-p-0",title:d,onKeyDown:pe,children:s.jsx(k,{})},d))})]}):s.jsxs("div",{className:"tw-flex tw-items-center tw-border-b tw-px-3 tw-py-2",children:[s.jsx(K,{variant:"ghost",size:"sm",onClick:D,className:"tw-mr-2 tw-h-6 tw-w-6 tw-p-0",tabIndex:-1,children:x==="ltr"?s.jsx(ye,{className:"tw-h-4 tw-w-4"}):s.jsx(Te,{className:"tw-h-4 tw-w-4"})}),s.jsx("span",{tabIndex:-1,className:"tw-text-sm tw-font-medium",children:N[m||""]||""})]}),!$&&s.jsxs(be,{ref:j,children:[l==="books"&&s.jsxs(s.Fragment,{children:[!n&&Object.entries(ne).map(([t,a])=>{if(a.length!==0)return s.jsx(z,{heading:je[t],children:a.map(d=>s.jsx("div",{className:M("tw-mx-1 tw-my-1 tw-border-b-0 tw-border-e-0 tw-border-s-2 tw-border-t-0 tw-border-solid",{"tw-border-s-red-200":t.toLowerCase()==="ot","tw-border-s-purple-200":t.toLowerCase()==="nt","tw-border-s-indigo-200":t.toLowerCase()==="dc","tw-border-s-amber-200":t.toLowerCase()==="extra"}),children:s.jsx(U,{value:`${d} ${N[d]}`,onSelect:()=>ae(d),ref:d===e.book?V:void 0,className:"tw-ms-1 tw-px-2",children:N[d]})},d))},t)}),n&&s.jsx(z,{children:s.jsx(U,{value:`${n.book} ${N[n.book]} ${n.chapterNum||""}:${n.verseNum||""})}`,onSelect:se,className:"tw-font-semibold tw-text-primary",children:X({book:n.book,chapterNum:n.chapterNum??1,verseNum:n.verseNum??1})},"top-match")}),n&&v(n.book)>1&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"tw-mb-2 tw-px-3 tw-text-sm tw-font-medium tw-text-muted-foreground",children:N[n.book]}),s.jsx(G,{bookId:n.book,scrRef:e,onChapterSelect:Y,setChapterRef:Q,isChapterDimmed:ue,className:"tw-px-4 tw-pb-4"})]})]}),l==="chapters"&&m&&s.jsx(G,{bookId:m,scrRef:e,onChapterSelect:Y,setChapterRef:Q,className:"tw-p-4"})]})]})})]})}Ie.__docgenInfo={description:`\`BookChapterControl\` is a component that provides an interactive UI for selecting book chapters.
It allows users to input a search query to find specific books and chapters, navigate through
options with keyboard interactions, and submit selections. The component handles various
interactions such as opening and closing the dropdown menu, filtering book lists based on search
input, and managing highlighted selections. It also integrates with external handlers for
submitting selected references and retrieving active book IDs.`,methods:[],displayName:"BookChapterControl",props:{scrRef:{required:!0,tsType:{name:"SerializedVerseRef"},description:"The current scripture reference"},handleSubmit:{required:!0,tsType:{name:"signature",type:"function",raw:"(scrRef: SerializedVerseRef) => void",signature:{arguments:[{type:{name:"SerializedVerseRef"},name:"scrRef"}],return:{name:"void"}}},description:"Callback to handle the submission of a selected reference"},className:{required:!1,tsType:{name:"string"},description:"Optional additional class name for styling"},getActiveBookIds:{required:!1,tsType:{name:"signature",type:"function",raw:"() => string[]",signature:{arguments:[],return:{name:"Array",elements:[{name:"string"}],raw:"string[]"}}},description:"Callback to retrieve book IDs that are available in the current context"}}};export{Ie as B};
