var Zv=Object.defineProperty;var ek=(n,e,t)=>e in n?Zv(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var Rt=(n,e,t)=>ek(n,typeof e!="symbol"?e+"":e,t);import{j as v}from"./jsx-runtime-Du_8R6LL.js";import{c as er,g as tk,r as x}from"./iframe-CAS-i6k-.js";import{_ as Lm,H as nk,p as Qs,O as Zs,D as rk,U as ik,B as sk,V as xd}from"./index-ZThHfTg3.js";import{r as Ot}from"./index-C2y9RtON.js";import{c as ok,d as ak,e as lk,g as ck}from"./floating-ui.react-dom-DUQmvAQT.js";import{M as uk}from"./markdown-renderer.component-Bsxd7MQ-.js";import{C as dk,a as fk,b as hk,d as pk}from"./card-DP37mItE.js";import{B as gk}from"./book-chapter-control.component-D8ZP9Grl.js";import{T as mk}from"./tab-toolbar.component-CoFK6NrS.js";import{B as Ht}from"./button-DAOtSrcb.js";import{D as Cd,a as Sd,b as Td,c as yk,j as Fm,e as qm,l as zs}from"./dropdown-menu-C2-VmM13.js";import{C as _k}from"./chevron-down-Dolkjw94.js";import{c as Nt}from"./createLucideIcon-B3z13J0b.js";import{F as Nn}from"./file-text-BKflgLP-.js";import{a as Ws,T as Ks,b as Ra,c as Hs,d as bk}from"./tooltip-Be_gBZWV.js";import{I as vk}from"./input-DOZ1sNJZ.js";import{v as kk}from"./index-BnrdmiR7.js";import{X as wk}from"./x-DI4PB2KH.js";import{C as xk}from"./check-B_83dK-m.js";import{C as Ck}from"./copy-CNd_UZOW.js";import{P as Sk,c as Tk,b as Ek}from"./popover-D89ixrIO.js";import"./index-rn2J4cF3.js";import"./shadcn-ui.util-DMJ19wEV.js";import"./book-item.utils-Bb2A-8Vs.js";import"./command-BRVKhvDq.js";import"./index-COlKviql.js";import"./index-C7G3xPvp.js";import"./index-C8EIOP8x.js";import"./index-Tuja0Ikt.js";import"./index-CJvw1LOF.js";import"./index-DPY8u6RY.js";import"./index-By5Rdupb.js";import"./index-B174tuNt.js";import"./index-C0Kn8h_e.js";import"./Combination-DKjFnhkH.js";import"./index-DZaCsRLK.js";import"./index-DruRAUtd.js";import"./index-OHFlXsx9.js";import"./dialog-CPJKFEsJ.js";import"./search-0rLdTv83.js";import"./index.es-D4jfZzAn.js";import"./chevron-left-wBZj_MEs.js";import"./chevron-right-KK9Awaec.js";import"./arrow-right-BnREzYrA.js";import"./tab-dropdown-menu.component-DXY7CALz.js";import"./menu.util-Dxh7JGT4.js";import"./menu-icon.component-CSWOxwoU.js";import"./tab-toolbar-container.component-BrTLz7xD.js";import"./index-BPbCuWFR.js";import"./menu.context-C3RlMc-K.js";import"./index-C0-LEpdt.js";import"./index-Dk4tK-IO.js";import"./index-Bdmso1Vb.js";import"./index-UDZMDAQe.js";import"./index-BeULaLL_.js";import"./index-DH-nbUJW.js";import"./circle-JNnpHkOO.js";import"./index-BI__t0LQ.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nk=[["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 18h18",key:"1h113x"}],["path",{d:"M3 6h18",key:"d0wm0j"}]],ra=Nt("AlignJustify",Nk);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mk=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]],Ak=Nt("Ban",Mk);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ok=[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"m17 12 3-2v8",key:"1hhhft"}]],xi=Nt("Heading1",Ok);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $k=[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M21 18h-4c0-4 4-3 4-6 0-1.5-2-2.5-4-1",key:"9jr5yi"}]],Qf=Nt("Heading2",$k);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ik=[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M17.5 10.5c1.7-1 3.5 0 3.5 1.5a2 2 0 0 1-2 2",key:"68ncm8"}],["path",{d:"M17 17.5c2 1.5 4 .3 4-1.5a2 2 0 0 0-2-2",key:"1ejuhz"}]],Fc=Nt("Heading3",Ik);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pk=[["path",{d:"M16 12H3",key:"1a2rj7"}],["path",{d:"M16 6H3",key:"1wxfjs"}],["path",{d:"M10 18H3",key:"13769t"}],["path",{d:"M21 6v10a2 2 0 0 1-2 2h-5",key:"ilrcs8"}],["path",{d:"m16 16-2 2 2 2",key:"kkc6pm"}]],Rk=Nt("ListEnd",Pk);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jk=[["path",{d:"M21 7v6h-6",key:"3ptur4"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7",key:"1kgawr"}]],Dk=Nt("Redo",jk);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lk=[["path",{d:"m18 14 4 4-4 4",key:"10pe0f"}],["path",{d:"m18 2 4 4-4 4",key:"pucp1d"}],["path",{d:"M2 18h1.973a4 4 0 0 0 3.3-1.7l5.454-8.6a4 4 0 0 1 3.3-1.7H22",key:"1ailkh"}],["path",{d:"M2 6h1.972a4 4 0 0 1 3.6 2.2",key:"km57vx"}],["path",{d:"M22 18h-6.041a4 4 0 0 1-3.3-1.8l-.359-.45",key:"os18l9"}]],Fk=Nt("Shuffle",Lk);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qk=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"M9 17c2 0 2.8-1 2.8-2.8V10c0-2 1-3.3 3.2-3",key:"m1af9g"}],["path",{d:"M9 11.2h5.7",key:"3zgcl2"}]],Bm=Nt("SquareFunction",qk);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bk=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M16 8.9V7H8l4 5-4 5h8v-1.9",key:"9nih0i"}]],Um=Nt("SquareSigma",Bk);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uk=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],zk=Nt("SquareX",Uk);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wk=[["path",{d:"m4 19 8-8",key:"hr47gm"}],["path",{d:"m12 19-8-8",key:"1dhhmo"}],["path",{d:"M20 12h-4c0-1.5.442-2 1.5-2.5S20 8.334 20 7.002c0-.472-.17-.93-.484-1.29a2.105 2.105 0 0 0-2.617-.436c-.42.239-.738.614-.899 1.06",key:"1dfcux"}]],Kk=Nt("Superscript",Wk);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hk=[["path",{d:"M17 6H3",key:"16j9eg"}],["path",{d:"M21 12H8",key:"scolzb"}],["path",{d:"M21 18H8",key:"1wfozv"}],["path",{d:"M3 12v6",key:"fv4c87"}]],qc=Nt("TextQuote",Hk);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jk=[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]],Vk=Nt("Undo",Jk);function J(n,...e){const t=new URL("https://lexical.dev/docs/error"),r=new URLSearchParams;r.append("code",n);for(const i of e)r.append("v",i);throw t.search=r.toString(),Error(`Minified Lexical error #${n}; visit ${t.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}const nn=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,Gk=nn&&"documentMode"in document?document.documentMode:null,fn=nn&&/Mac|iPod|iPhone|iPad/.test(navigator.platform),zr=nn&&/^(?!.*Seamonkey)(?=.*Firefox).*/i.test(navigator.userAgent),Ga=!(!nn||!("InputEvent"in window)||Gk)&&"getTargetRanges"in new window.InputEvent("input"),eo=nn&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent),Ri=nn&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,Yk=nn&&/Android/.test(navigator.userAgent),zm=nn&&/^(?=.*Chrome).*/i.test(navigator.userAgent),Zf=nn&&Yk&&zm,Ya=nn&&/AppleWebKit\/[\d.]+/.test(navigator.userAgent)&&!zm;function Xa(...n){const e=[];for(const t of n)if(t&&typeof t=="string")for(const[r]of t.matchAll(/\S+/g))e.push(r);return e}const Xk=1,Qk=3,Zk=9,ew=11,Wr=0,Wm=1,ji=2,tw=0,nw=1,rw=2,Qa=4,Za=8,Ed=128,iw=1792|(112|(3|Qa|Za)|Ed),Nd=1,Md=2,Ad=3,Od=4,$d=5,Id=6,Ol=eo||Ri||Ya?" ":"​",Bn=`

`,sw=zr?" ":Ol,Km="֑-߿יִ-﷽ﹰ-ﻼ",Hm="A-Za-zÀ-ÖØ-öø-ʸ̀-֐ࠀ-῿‎Ⰰ-﬜︀-﹯﻽-￿",ow=new RegExp("^[^"+Hm+"]*["+Km+"]"),aw=new RegExp("^[^"+Km+"]*["+Hm+"]"),lr={bold:1,capitalize:1024,code:16,highlight:Ed,italic:2,lowercase:256,strikethrough:Qa,subscript:32,superscript:64,underline:Za,uppercase:512},lw={directionless:1,unmergeable:2},eh={center:Md,end:Id,justify:Od,left:Nd,right:Ad,start:$d},cw={[Md]:"center",[Id]:"end",[Od]:"justify",[Nd]:"left",[Ad]:"right",[$d]:"start"},uw={normal:0,segmented:2,token:1},dw={[tw]:"normal",[rw]:"segmented",[nw]:"token"},th="$config";function Jm(n,e,t,r,i,s){let o=n.getFirstChild();for(;o!==null;){const a=o.__key;o.__parent===e&&(F(o)&&Jm(o,a,t,r,i,s),t.has(a)||s.delete(a),i.push(a)),o=o.getNextSibling()}}const fw=100;let vu=!1,Pd=0;function hw(n){Pd=n.timeStamp}function Bc(n,e,t){const r=n.nodeName==="BR",i=e.__lexicalLineBreak;return i&&(n===i||r&&n.previousSibling===i)||r&&ql(n,t)!==void 0}function pw(n,e,t){const r=Qt(qt(t));let i=null,s=null;r!==null&&r.anchorNode===n&&(i=r.anchorOffset,s=r.focusOffset);const o=n.nodeValue;o!==null&&rf(e,o,i,s,!1)}function gw(n,e,t){if(q(n)){const r=n.anchor.getNode();if(r.is(t)&&n.format!==r.getFormat())return!1}return Hn(e)&&t.isAttached()}function mw(n,e,t,r){for(let i=n;i&&!px(i);i=Eo(i)){const s=ql(i,e);if(s!==void 0){const o=ce(s,t);if(o)return ke(o)||!Ne(i)?void 0:[i,o]}else if(i===r)return[r,zy(t)]}}function Vm(n,e,t){vu=!0;const r=performance.now()-Pd>fw;try{At(n,()=>{const i=K()||function(d){return d.getEditorState().read(()=>{const h=K();return h!==null?h.clone():null})}(n),s=new Map,o=n.getRootElement(),a=n._editorState,l=n._blockCursorElement;let c=!1,u="";for(let d=0;d<e.length;d++){const h=e[d],g=h.type,m=h.target,y=mw(m,n,a,o);if(!y)continue;const[b,_]=y;if(g==="characterData")r&&W(_)&&Hn(m)&&gw(i,m,_)&&pw(m,_,n);else if(g==="childList"){c=!0;const w=h.addedNodes;for(let M=0;M<w.length;M++){const j=w[M],A=By(j),$=j.parentNode;if($!=null&&j!==l&&A===null&&!Bc(j,$,n)){if(zr){const B=(Ne(j)?j.innerText:null)||j.nodeValue;B&&(u+=B)}$.removeChild(j)}}const T=h.removedNodes,O=T.length;if(O>0){let M=0;for(let j=0;j<O;j++){const A=T[j];(Bc(A,m,n)||l===A)&&(m.appendChild(A),M++)}O!==M&&s.set(b,_)}}}if(s.size>0)for(const[d,h]of s)h.reconcileObservedMutation(d,n);const f=t.takeRecords();if(f.length>0){for(let d=0;d<f.length;d++){const h=f[d],g=h.addedNodes,m=h.target;for(let y=0;y<g.length;y++){const b=g[y],_=b.parentNode;_==null||b.nodeName!=="BR"||Bc(b,m,n)||_.removeChild(b)}}t.takeRecords()}i!==null&&(c&&it(i),zr&&Vy(n)&&i.insertRawText(u))})}finally{vu=!1}}function Gm(n){const e=n._observer;e!==null&&Vm(n,e.takeRecords(),e)}function Ym(n){(function(e){Pd===0&&qt(e).addEventListener("textInput",hw,!0)})(n),n._observer=new MutationObserver((e,t)=>{Vm(n,e,t)})}let yw=class{constructor(e,t){this.key=e,this.parse=t.parse.bind(t),this.unparse=(t.unparse||vw).bind(t),this.isEqual=(t.isEqual||Object.is).bind(t),this.defaultValue=this.parse(void 0)}};function Xm(n,e){return new yw(n,e)}function es(n,e,t="latest"){const r=(t==="latest"?n.getLatest():n).__state;return r?r.getValue(e):e.defaultValue}function Ln(n,e,t){let r;if(Qe(),typeof t=="function"){const s=n.getLatest(),o=es(s,e);if(r=t(o),e.isEqual(o,r))return s}else r=t;const i=n.getWritable();return Zm(i).updateFromKnown(e,r),i}function _w(n){const e=new Map,t=new Set;for(let r=typeof n=="function"?n:n.replace;r.prototype&&r.prototype.getType!==void 0;r=Object.getPrototypeOf(r)){const{ownNodeConfig:i}=lf(r);if(i&&i.stateConfigs)for(const s of i.stateConfigs){let o;"stateConfig"in s?(o=s.stateConfig,s.flat&&t.add(o.key)):o=s,e.set(o.key,o)}}return{flatKeys:t,sharedConfigMap:e}}let bw=class Qm{constructor(e,t,r=void 0,i=new Map,s=void 0){this.node=e,this.sharedNodeState=t,this.unknownState=r,this.knownState=i;const{sharedConfigMap:o}=this.sharedNodeState,a=s!==void 0?s:function(l,c,u){let f=u.size;if(c)for(const d in c){const h=l.get(d);h&&u.has(h)||f++}return f}(o,r,i);this.size=a}getValue(e){const t=this.knownState.get(e);if(t!==void 0)return t;this.sharedNodeState.sharedConfigMap.set(e.key,e);let r=e.defaultValue;if(this.unknownState&&e.key in this.unknownState){const i=this.unknownState[e.key];i!==void 0&&(r=e.parse(i)),this.updateFromKnown(e,r)}return r}getInternalState(){return[this.unknownState,this.knownState]}toJSON(){const e={...this.unknownState},t={};for(const[r,i]of this.knownState)r.isEqual(i,r.defaultValue)?delete e[r.key]:e[r.key]=r.unparse(i);for(const r of this.sharedNodeState.flatKeys)r in e&&(t[r]=e[r],delete e[r]);return nh(e)&&(t.$=e),t}getWritable(e){if(this.node===e)return this;const{sharedNodeState:t,unknownState:r}=this,i=new Map(this.knownState);return new Qm(e,t,function(s,o,a){let l;if(a)for(const[c,u]of Object.entries(a)){const f=s.get(c);f?o.has(f)||o.set(f,f.parse(u)):(l=l||{},l[c]=u)}return l}(t.sharedConfigMap,i,r),i,this.size)}updateFromKnown(e,t){const r=e.key;this.sharedNodeState.sharedConfigMap.set(r,e);const{knownState:i,unknownState:s}=this;i.has(e)||s&&r in s||(s&&(delete s[r],this.unknownState=nh(s)),this.size++),i.set(e,t)}updateFromUnknown(e,t){const r=this.sharedNodeState.sharedConfigMap.get(e);r?this.updateFromKnown(r,r.parse(t)):(this.unknownState=this.unknownState||{},e in this.unknownState||this.size++,this.unknownState[e]=t)}updateFromJSON(e){const{knownState:t}=this;for(const r of t.keys())t.set(r,r.defaultValue);if(this.size=t.size,this.unknownState=void 0,e)for(const[r,i]of Object.entries(e))this.updateFromUnknown(r,i)}};function Zm(n){const e=n.getWritable(),t=e.__state?e.__state.getWritable(e):new bw(e,ey(e));return e.__state=t,t}function ey(n){return n.__state?n.__state.sharedNodeState:Fy(Ul(),n.getType()).sharedNodeState}function nh(n){if(n)for(const e in n)return n}function vw(n){return n}function rh(n,e,t){for(const[r,i]of e.knownState){if(n.has(r.key))continue;n.add(r.key);const s=t?t.getValue(r):r.defaultValue;if(s!==i&&!r.isEqual(s,i))return!0}return!1}function ih(n,e,t){const{unknownState:r}=e,i=t?t.unknownState:void 0;if(r){for(const[s,o]of Object.entries(r))if(!n.has(s)&&(n.add(s),o!==(i?i[s]:void 0)))return!0}return!1}function sh(n,e){const t=n.__state;return t&&t.node===n?t.getWritable(e):t}function oh(n,e){const t=n.__mode,r=n.__format,i=n.__style,s=e.__mode,o=e.__format,a=e.__style,l=n.__state,c=e.__state;return(t===null||t===s)&&(r===null||r===o)&&(i===null||i===a)&&(n.__state===null||l===c||function(u,f){if(u===f)return!0;if(u&&f&&u.size!==f.size)return!1;const d=new Set;return!(u&&rh(d,u,f)||f&&rh(d,f,u)||u&&ih(d,u,f)||f&&ih(d,f,u))}(l,c))}function ah(n,e){const t=n.mergeWithSibling(e),r=Ie()._normalizedNodes;return r.add(n.__key),r.add(e.__key),t}function lh(n){let e,t,r=n;if(r.__text!==""||!r.isSimpleText()||r.isUnmergeable()){for(;(e=r.getPreviousSibling())!==null&&W(e)&&e.isSimpleText()&&!e.isUnmergeable();){if(e.__text!==""){if(oh(e,r)){r=ah(e,r);break}break}e.remove()}for(;(t=r.getNextSibling())!==null&&W(t)&&t.isSimpleText()&&!t.isUnmergeable();){if(t.__text!==""){if(oh(r,t)){r=ah(r,t);break}break}t.remove()}}else r.remove()}function to(n){return ch(n.anchor),ch(n.focus),n}function ch(n){for(;n.type==="element";){const e=n.getNode(),t=n.offset;let r,i;if(t===e.getChildrenSize()?(r=e.getChildAtIndex(t-1),i=!0):(r=e.getChildAtIndex(t),i=!1),W(r)){n.set(r.__key,i?r.getTextContentSize():0,"text",!0);break}if(!F(r))break;n.set(r.__key,i?r.getChildrenSize():0,"element",!0)}}let cr,_t,no,$l,ku,wu,Kr,Vt,xu,ro,Fe="",yt="",un=null,dn="",Pn="",ty=!1,io=!1,ja=null;function el(n,e){const t=Kr.get(n);if(e!==null){const r=Tu(n);r.parentNode===e&&e.removeChild(r)}if(Vt.has(n)||_t._keyToDOMMap.delete(n),F(t)){const r=nl(t,Kr);Cu(r,0,r.length-1,null)}t!==void 0&&sf(ro,no,$l,t,"destroyed")}function Cu(n,e,t,r){let i=e;for(;i<=t;++i){const s=n[i];s!==void 0&&el(s,r)}}function Ir(n,e){n.setProperty("text-align",e)}const kw="40px";function ny(n,e){const t=cr.theme.indent;if(typeof t=="string"){const i=n.classList.contains(t);e>0&&!i?n.classList.add(t):e<1&&i&&n.classList.remove(t)}const r=getComputedStyle(n).getPropertyValue("--lexical-indent-base-value")||kw;n.style.setProperty("padding-inline-start",e===0?"":`calc(${e} * ${r})`)}function ry(n,e){const t=n.style;e===0?Ir(t,""):e===Nd?Ir(t,"left"):e===Md?Ir(t,"center"):e===Ad?Ir(t,"right"):e===Od?Ir(t,"justify"):e===$d?Ir(t,"start"):e===Id&&Ir(t,"end")}function tl(n,e){const t=Vt.get(n);t===void 0&&J(60);const r=t.createDOM(cr,_t);if(function(i,s,o){const a=o._keyToDOMMap;(function(l,c,u){const f=`__lexicalKey_${c._key}`;l[f]=u})(s,o,i),a.set(i,s)}(n,r,_t),W(t)?r.setAttribute("data-lexical-text","true"):ke(t)&&r.setAttribute("data-lexical-decorator","true"),F(t)){const i=t.__indent,s=t.__size;if(i!==0&&ny(r,i),s!==0){const a=s-1;(function(l,c,u,f){const d=yt;yt="",Su(l,u,0,c,u.getDOMSlot(f)),sy(u,f),yt=d})(nl(t,Vt),a,t,r)}const o=t.__format;o!==0&&ry(r,o),t.isInline()||iy(null,t,r),Bl(t)&&(Fe+=Bn,Pn+=Bn)}else{const i=t.getTextContent();if(ke(t)){const s=t.decorate(_t,cr);s!==null&&oy(n,s),r.contentEditable="false"}else W(t)&&(t.isDirectionless()||(yt+=i));Fe+=i,Pn+=i}return e!==null&&e.insertChild(r),sf(ro,no,$l,t,"created"),r}function Su(n,e,t,r,i){const s=Fe;Fe="";let o=t;for(;o<=r;++o){tl(n[o],i);const a=Vt.get(n[o]);a!==null&&W(a)&&(un===null&&(un=a.getFormat()),dn===""&&(dn=a.getStyle()))}Bl(e)&&(Fe+=Bn),i.element.__lexicalTextContent=Fe,Fe=s+Fe}function uh(n,e){if(n){const t=n.__last;if(t){const r=e.get(t);if(r)return Dr(r)?"line-break":ke(r)&&r.isInline()?"decorator":null}return"empty"}return null}function iy(n,e,t){const r=uh(n,Kr),i=uh(e,Vt);r!==i&&e.getDOMSlot(t).setManagedLineBreak(i)}function sy(n,e){const t=e.__lexicalDirTextContent||"",r=e.__lexicalDir||"";if(t!==yt||r!==ja){const i=yt==="",s=i?ja:function(o){return ow.test(o)?"rtl":aw.test(o)?"ltr":null}(yt);if(s!==r){const o=e.classList,a=cr.theme;let l=r!==null?a[r]:void 0,c=s!==null?a[s]:void 0;if(l!==void 0){if(typeof l=="string"){const u=Xa(l);l=a[r]=u}o.remove(...l)}if(s===null||i&&s==="ltr")e.removeAttribute("dir");else{if(c!==void 0){if(typeof c=="string"){const u=Xa(c);c=a[s]=u}c!==void 0&&o.add(...c)}e.dir=s}io||(n.getWritable().__dir=s)}ja=s,e.__lexicalDirTextContent=yt,e.__lexicalDir=s}}function ww(n,e,t){const r=yt;var i;yt="",un=null,dn="",function(s,o,a){const l=Fe,c=s.__size,u=o.__size;Fe="";const f=a.element;if(c===1&&u===1){const d=s.__first,h=o.__first;if(d===h)js(d,f);else{const m=Tu(d),y=tl(h,null);try{f.replaceChild(y,m)}catch(b){if(typeof b=="object"&&b!=null){const _=`${b.toString()} Parent: ${f.tagName}, new child: {tag: ${y.tagName} key: ${h}}, old child: {tag: ${m.tagName}, key: ${d}}.`;throw new Error(_)}throw b}el(d,null)}const g=Vt.get(h);W(g)&&(un===null&&(un=g.getFormat()),dn===""&&(dn=g.getStyle()))}else{const d=nl(s,Kr),h=nl(o,Vt);if(d.length!==c&&J(227),h.length!==u&&J(228),c===0)u!==0&&Su(h,o,0,u-1,a);else if(u===0){if(c!==0){const g=a.after==null&&a.before==null&&a.element.__lexicalLineBreak==null;Cu(d,0,c-1,g?null:f),g&&(f.textContent="")}}else(function(g,m,y,b,_,w){const T=b-1,O=_-1;let M,j,A=w.getFirstChild(),$=0,B=0;for(;$<=T&&B<=O;){const S=m[$],R=y[B];if(S===R)A=Uc(js(R,w.element)),$++,B++;else{M===void 0&&(M=new Set(m)),j===void 0&&(j=new Set(y));const D=j.has(S),z=M.has(R);if(D)if(z){const H=Bi(_t,R);H===A?A=Uc(js(R,w.element)):(w.withBefore(A).insertChild(H),js(R,w.element)),$++,B++}else tl(R,w.withBefore(A)),B++;else A=Uc(Tu(S)),el(S,w.element),$++}const L=Vt.get(R);L!==null&&W(L)&&(un===null&&(un=L.getFormat()),dn===""&&(dn=L.getStyle()))}const C=$>T,N=B>O;if(C&&!N){const S=y[O+1],R=S===void 0?null:_t.getElementByKey(S);Su(y,g,B,O,w.withBefore(R))}else N&&!C&&Cu(m,$,T,w.element)})(o,d,h,c,u,a)}Bl(o)&&(Fe+=Bn),f.__lexicalTextContent=Fe,Fe=l+Fe}(n,e,e.getDOMSlot(t)),sy(e,t),i=e,un==null||un===i.__textFormat||io||i.setTextFormat(un),function(s){dn===""||dn===s.__textStyle||io||s.setTextStyle(dn)}(e),yt=r}function nl(n,e){const t=[];let r=n.__first;for(;r!==null;){const i=e.get(r);i===void 0&&J(101),t.push(r),r=i.__next}return t}function js(n,e){const t=Kr.get(n);let r=Vt.get(n);t!==void 0&&r!==void 0||J(61);const i=ty||wu.has(n)||ku.has(n),s=Bi(_t,n);if(t===r&&!i){if(F(t)){const o=s.__lexicalTextContent;o!==void 0&&(Fe+=o,Pn+=o);const a=s.__lexicalDirTextContent;a!==void 0&&(yt+=a)}else{const o=t.getTextContent();W(t)&&!t.isDirectionless()&&(yt+=o),Pn+=o,Fe+=o}return s}if(t!==r&&i&&sf(ro,no,$l,r,"updated"),r.updateDOM(t,s,cr)){const o=tl(n,null);return e===null&&J(62),e.replaceChild(o,s),el(n,null),o}if(F(t)&&F(r)){const o=r.__indent;o!==t.__indent&&ny(s,o);const a=r.__format;a!==t.__format&&ry(s,a),i&&(ww(t,r,s),et(r)||r.isInline()||iy(t,r,s)),Bl(r)&&(Fe+=Bn,Pn+=Bn)}else{const o=r.getTextContent();if(ke(r)){const a=r.decorate(_t,cr);a!==null&&oy(n,a)}else W(r)&&!r.isDirectionless()&&(yt+=o);Fe+=o,Pn+=o}if(!io&&et(r)&&r.__cachedText!==Pn){const o=r.getWritable();o.__cachedText=Pn,r=o}return s}function oy(n,e){let t=_t._pendingDecorators;const r=_t._decorators;if(t===null){if(r[n]===e)return;t=Uy(_t)}t[n]=e}function Uc(n){let e=n.nextSibling;return e!==null&&e===_t._blockCursorElement&&(e=e.nextSibling),e}function xw(n,e,t,r,i,s){Fe="",Pn="",yt="",ty=r===ji,ja=null,_t=t,cr=t._config,no=t._nodes,$l=_t._listeners.mutation,ku=i,wu=s,Kr=n._nodeMap,Vt=e._nodeMap,io=e._readOnly,xu=new Map(t._keyToDOMMap);const o=new Map;return ro=o,js("root",null),_t=void 0,no=void 0,ku=void 0,wu=void 0,Kr=void 0,Vt=void 0,cr=void 0,xu=void 0,ro=void 0,o}function Tu(n){const e=xu.get(n);return e===void 0&&J(75,n),e}function ie(n){return{type:n}}const mr=ie("SELECTION_CHANGE_COMMAND"),Cw=ie("SELECTION_INSERT_CLIPBOARD_NODES_COMMAND"),ay=ie("CLICK_COMMAND"),mn=ie("DELETE_CHARACTER_COMMAND"),sr=ie("INSERT_LINE_BREAK_COMMAND"),so=ie("INSERT_PARAGRAPH_COMMAND"),jr=ie("CONTROLLED_TEXT_INSERTION_COMMAND"),ri=ie("PASTE_COMMAND"),rl=ie("REMOVE_TEXT_COMMAND"),Di=ie("DELETE_WORD_COMMAND"),Li=ie("DELETE_LINE_COMMAND"),tr=ie("FORMAT_TEXT_COMMAND"),vo=ie("UNDO_COMMAND"),ko=ie("REDO_COMMAND"),ts=ie("KEYDOWN_COMMAND"),Rd=ie("KEY_ARROW_RIGHT_COMMAND"),Sw=ie("MOVE_TO_END"),jd=ie("KEY_ARROW_LEFT_COMMAND"),Tw=ie("MOVE_TO_START"),Dd=ie("KEY_ARROW_UP_COMMAND"),Ld=ie("KEY_ARROW_DOWN_COMMAND"),Fi=ie("KEY_ENTER_COMMAND"),ly=ie("KEY_SPACE_COMMAND"),Fd=ie("KEY_BACKSPACE_COMMAND"),Il=ie("KEY_ESCAPE_COMMAND"),qd=ie("KEY_DELETE_COMMAND"),Bd=ie("KEY_TAB_COMMAND"),Ew=ie("INSERT_TAB_COMMAND"),Nw=ie("INDENT_CONTENT_COMMAND"),dh=ie("OUTDENT_CONTENT_COMMAND"),Pl=ie("DROP_COMMAND"),Mw=ie("FORMAT_ELEMENT_COMMAND"),Ud=ie("DRAGSTART_COMMAND"),cy=ie("DRAGOVER_COMMAND"),Aw=ie("DRAGEND_COMMAND"),yr=ie("COPY_COMMAND"),ii=ie("CUT_COMMAND"),il=ie("SELECT_ALL_COMMAND"),zd=ie("CLEAR_EDITOR_COMMAND"),uy=ie("CLEAR_HISTORY_COMMAND"),Ds=ie("CAN_REDO_COMMAND"),Ls=ie("CAN_UNDO_COMMAND"),Ow=ie("FOCUS_COMMAND"),$w=ie("BLUR_COMMAND"),Iw=ie("KEY_MODIFIER_COMMAND"),Mn=Object.freeze({}),Eu=30,Nu=[["keydown",function(n,e){if(Js=n.timeStamp,dy=n.key,!e.isComposing()&&!Y(e,ts,n)&&n.key!=null){if(zc&&Fh(n))return At(e,()=>{ia(e,Wc)}),zc=!1,void(Wc="");if(function(t){return Se(t,"ArrowRight",{shiftKey:"any"})}(n))Y(e,Rd,n);else if(function(t){return Se(t,"ArrowRight",$n)}(n))Y(e,Sw,n);else if(function(t){return Se(t,"ArrowLeft",{shiftKey:"any"})}(n))Y(e,jd,n);else if(function(t){return Se(t,"ArrowLeft",$n)}(n))Y(e,Tw,n);else if(function(t){return Se(t,"ArrowUp",{altKey:"any",shiftKey:"any"})}(n))Y(e,Dd,n);else if(function(t){return Se(t,"ArrowDown",{altKey:"any",shiftKey:"any"})}(n))Y(e,Ld,n);else if(function(t){return Se(t,"Enter",{altKey:"any",ctrlKey:"any",metaKey:"any",shiftKey:!0})}(n))Vs=!0,Y(e,Fi,n);else if(function(t){return t.key===" "}(n))Y(e,ly,n);else if(function(t){return fn&&Se(t,"o",{ctrlKey:!0})}(n))n.preventDefault(),Vs=!0,Y(e,sr,!0);else if(function(t){return Se(t,"Enter",{altKey:"any",ctrlKey:"any",metaKey:"any"})}(n))Vs=!1,Y(e,Fi,n);else if(function(t){return Se(t,"Backspace",{shiftKey:"any"})||fn&&Se(t,"h",{ctrlKey:!0})}(n))Fh(n)?Y(e,Fd,n):(n.preventDefault(),Y(e,mn,!0));else if(function(t){return t.key==="Escape"}(n))Y(e,Il,n);else if(function(t){return Se(t,"Delete",{})||fn&&Se(t,"d",{ctrlKey:!0})}(n))(function(t){return t.key==="Delete"})(n)?Y(e,qd,n):(n.preventDefault(),Y(e,mn,!1));else if(function(t){return Se(t,"Backspace",Lh)}(n))n.preventDefault(),Y(e,Di,!0);else if(function(t){return Se(t,"Delete",Lh)}(n))n.preventDefault(),Y(e,Di,!1);else if(function(t){return fn&&Se(t,"Backspace",{metaKey:!0})}(n))n.preventDefault(),Y(e,Li,!0);else if(function(t){return fn&&(Se(t,"Delete",{metaKey:!0})||Se(t,"k",{ctrlKey:!0}))}(n))n.preventDefault(),Y(e,Li,!1);else if(function(t){return Se(t,"b",$n)}(n))n.preventDefault(),Y(e,tr,"bold");else if(function(t){return Se(t,"u",$n)}(n))n.preventDefault(),Y(e,tr,"underline");else if(function(t){return Se(t,"i",$n)}(n))n.preventDefault(),Y(e,tr,"italic");else if(function(t){return Se(t,"Tab",{shiftKey:"any"})}(n))Y(e,Bd,n);else if(function(t){return Se(t,"z",$n)}(n))n.preventDefault(),Y(e,vo,void 0);else if(function(t){return fn?Se(t,"z",{metaKey:!0,shiftKey:!0}):Se(t,"y",{ctrlKey:!0})||Se(t,"z",{ctrlKey:!0,shiftKey:!0})}(n))n.preventDefault(),Y(e,ko,void 0);else{const t=e._editorState._selection;t===null||q(t)?qh(n)&&(n.preventDefault(),Y(e,il,n)):function(r){return Se(r,"c",$n)}(n)?(n.preventDefault(),Y(e,yr,n)):function(r){return Se(r,"x",$n)}(n)?(n.preventDefault(),Y(e,ii,n)):qh(n)&&(n.preventDefault(),Y(e,il,n))}(function(t){return t.ctrlKey||t.shiftKey||t.altKey||t.metaKey})(n)&&Y(e,Iw,n)}}],["pointerdown",function(n,e){const t=n.target,r=n.pointerType;ai(t)&&r!=="touch"&&r!=="pen"&&n.button===0&&At(e,()=>{Rh(t)||(Au=!0)})}],["compositionstart",function(n,e){At(e,()=>{const t=K();if(q(t)&&!e.isComposing()){const r=t.anchor,i=t.anchor.getNode();Ze(r.key),(n.timeStamp<Js+Eu||r.type==="element"||!t.isCollapsed()||i.getFormat()!==t.format||W(i)&&i.getStyle()!==t.style)&&Y(e,jr,sw)}})}],["compositionend",function(n,e){zr?Os=!0:Ri||!eo&&!Ya?At(e,()=>{ia(e,n.data)}):(zc=!0,Wc=n.data)}],["input",function(n,e){n.stopPropagation(),At(e,()=>{if(Ne(n.target)&&Rh(n.target))return;const t=K(),r=n.data,i=my(n);if(r!=null&&q(t)&&py(t,i,r,n.timeStamp,!1)){Os&&(ia(e,r),Os=!1);const s=t.anchor.getNode(),o=Qt(qt(e));if(o===null)return;const a=t.isBackward(),l=a?t.anchor.offset:t.focus.offset,c=a?t.focus.offset:t.anchor.offset;Ga&&!t.isCollapsed()&&W(s)&&o.anchorNode!==null&&s.getTextContent().slice(0,l)+r+s.getTextContent().slice(l+c)===Hy(o.anchorNode)||Y(e,jr,r);const u=r.length;zr&&u>1&&n.inputType==="insertCompositionText"&&!e.isComposing()&&(t.anchor.offset-=u),eo||Ri||Ya||!e.isComposing()||(Js=0,Ze(null))}else nf(!1,e,r!==null?r:void 0),Os&&(ia(e,r||void 0),Os=!1);(function(){Qe();const s=Ie();Gm(s)})()},{event:n}),Si=null}],["click",function(n,e){At(e,()=>{const t=K(),r=Qt(qt(e)),i=rs();if(r){if(q(t)){const s=t.anchor,o=s.getNode();if(s.type==="element"&&s.offset===0&&t.isCollapsed()&&!et(o)&&ye().getChildrenSize()===1&&o.getTopLevelElementOrThrow().isEmpty()&&i!==null&&t.is(i))r.removeAllRanges(),t.dirty=!0;else if(n.detail===3&&!t.isCollapsed()&&o!==t.focus.getNode()){const a=function(l,c){let u=l;for(;u!==ye()&&u!=null;){if(c(u))return u;u=u.getParent()}return null}(o,l=>F(l)&&!l.isInline());F(a)&&a.select(0)}}else if(n.pointerType==="touch"||n.pointerType==="pen"){const s=r.anchorNode;(Ne(s)||Hn(s))&&it(Kd(i,r,e,n))}}Y(e,ay,n)})}],["cut",Mn],["copy",Mn],["dragstart",Mn],["dragover",Mn],["dragend",Mn],["paste",Mn],["focus",Mn],["blur",Mn],["drop",Mn]];Ga&&Nu.push(["beforeinput",(n,e)=>function(t,r){const i=t.inputType,s=my(t);i==="deleteCompositionText"||zr&&Vy(r)||i!=="insertCompositionText"&&At(r,()=>{const o=K();if(i==="deleteContentBackward"){if(o===null){const h=rs();if(!q(h))return;it(h.clone())}if(q(o)){const h=o.anchor.key===o.focus.key;if(a=t.timeStamp,dy==="MediaLast"&&a<Js+Eu&&r.isComposing()&&h){if(Ze(null),Js=0,setTimeout(()=>{At(r,()=>{Ze(null)})},Eu),q(o)){const g=o.anchor.getNode();g.markDirty(),W(g)||J(142),gy(o,g)}}else{Ze(null),t.preventDefault();const g=o.anchor.getNode(),m=g.getTextContent(),y=g.canInsertTextAfter(),b=o.anchor.offset===0&&o.focus.offset===m.length;let _=Zf&&h&&!b&&y;if(_&&o.isCollapsed()&&(_=!ke(ju(o.anchor,!0))),!_){Y(r,mn,!0);const w=K();Zf&&q(w)&&w.isCollapsed()&&(Rr=w,setTimeout(()=>Rr=null))}}return}}var a;if(!q(o))return;const l=t.data;Si!==null&&nf(!1,r,Si),o.dirty&&Si===null||!o.isCollapsed()||et(o.anchor.getNode())||s===null||o.applyDOMRange(s),Si=null;const c=o.anchor,u=o.focus,f=c.getNode(),d=u.getNode();if(i!=="insertText"&&i!=="insertTranspose")switch(t.preventDefault(),i){case"insertFromYank":case"insertFromDrop":case"insertReplacementText":Y(r,jr,t);break;case"insertFromComposition":Ze(null),Y(r,jr,t);break;case"insertLineBreak":Ze(null),Y(r,sr,!1);break;case"insertParagraph":Ze(null),Vs&&!Ri?(Vs=!1,Y(r,sr,!1)):Y(r,so,void 0);break;case"insertFromPaste":case"insertFromPasteAsQuotation":Y(r,ri,t);break;case"deleteByComposition":(function(h,g){return h!==g||F(h)||F(g)||!Fr(h)||!Fr(g)})(f,d)&&Y(r,rl,t);break;case"deleteByDrag":case"deleteByCut":Y(r,rl,t);break;case"deleteContent":Y(r,mn,!1);break;case"deleteWordBackward":Y(r,Di,!0);break;case"deleteWordForward":Y(r,Di,!1);break;case"deleteHardLineBackward":case"deleteSoftLineBackward":Y(r,Li,!0);break;case"deleteContentForward":case"deleteHardLineForward":case"deleteSoftLineForward":Y(r,Li,!1);break;case"formatStrikeThrough":Y(r,tr,"strikethrough");break;case"formatBold":Y(r,tr,"bold");break;case"formatItalic":Y(r,tr,"italic");break;case"formatUnderline":Y(r,tr,"underline");break;case"historyUndo":Y(r,vo,void 0);break;case"historyRedo":Y(r,ko,void 0)}else{if(l===`
`)t.preventDefault(),Y(r,sr,!1);else if(l===Bn)t.preventDefault(),Y(r,so,void 0);else if(l==null&&t.dataTransfer){const h=t.dataTransfer.getData("text/plain");t.preventDefault(),o.insertRawText(h)}else l!=null&&py(o,s,l,t.timeStamp,!0)?(t.preventDefault(),Y(r,jr,l)):Si=l;fy=t.timeStamp}})}(n,e)]);let Js=0,dy=null,fy=0,Si=null;const sl=new WeakMap;let Mu=!1,Au=!1,Vs=!1,Os=!1,zc=!1,Wc="",Rr=null,hy=[0,"",0,"root",0];function py(n,e,t,r,i){const s=n.anchor,o=n.focus,a=s.getNode(),l=Ie(),c=Qt(qt(l)),u=c!==null?c.anchorNode:null,f=s.key,d=l.getElementByKey(f),h=t.length;return f!==o.key||!W(a)||(!i&&(!Ga||fy<r+50)||a.isDirty()&&h<2||Wy(t))&&s.offset!==o.offset&&!a.isComposing()||In(a)||a.isDirty()&&h>1||(i||!Ga)&&d!==null&&!a.isComposing()&&u!==qi(d)||c!==null&&e!==null&&(!e.collapsed||e.startContainer!==c.anchorNode||e.startOffset!==c.anchorOffset)||a.getFormat()!==n.format||a.getStyle()!==n.style||function(g,m){if(m.isSegmented())return!0;if(!g.isCollapsed())return!1;const y=g.anchor.offset,b=m.getParentOrThrow(),_=Fr(m);return y===0?!m.canInsertTextBefore()||!b.canInsertTextBefore()&&!m.isComposing()||_||function(w){const T=w.getPreviousSibling();return(W(T)||F(T)&&T.isInline())&&!T.canInsertTextAfter()}(m):y===m.getTextContentSize()&&(!m.canInsertTextAfter()||!b.canInsertTextAfter()&&!m.isComposing()||_)}(n,a)}function fh(n,e){return Hn(n)&&n.nodeValue!==null&&e!==0&&e!==n.nodeValue.length}function hh(n,e,t){const{anchorNode:r,anchorOffset:i,focusNode:s,focusOffset:o}=n;Mu&&(Mu=!1,fh(r,i)&&fh(s,o)&&!Rr)||At(e,()=>{if(!t)return void it(null);if(!To(e,r,s))return;let a=K();if(Rr&&q(a)&&a.isCollapsed()){const l=a.anchor,c=Rr.anchor;(l.key===c.key&&l.offset===c.offset+1||l.offset===1&&c.getNode().is(l.getNode().getPreviousSibling()))&&(a=Rr.clone(),it(a))}if(Rr=null,q(a)){const l=a.anchor,c=l.getNode();if(a.isCollapsed()){n.type==="Range"&&n.anchorNode===n.focusNode&&(a.dirty=!0);const u=qt(e).event,f=u?u.timeStamp:performance.now(),[d,h,g,m,y]=hy,b=ye(),_=e.isComposing()===!1&&b.getTextContent()==="";if(f<y+200&&l.offset===g&&l.key===m)Da(a,d,h);else if(l.type==="text")W(c)||J(141),gy(a,c);else if(l.type==="element"&&!_){F(c)||J(259);const w=l.getNode();w.isEmpty()?function(T,O){const M=O.getTextFormat(),j=O.getTextStyle();Da(T,M,j)}(a,w):Da(a,0,"")}}else{const u=l.key,f=a.focus.key,d=a.getNodes(),h=d.length,g=a.isBackward(),m=g?o:i,y=g?i:o,b=g?f:u,_=g?u:f;let w=iw,T=!1;for(let O=0;O<h;O++){const M=d[O],j=M.getTextContentSize();if(W(M)&&j!==0&&!(O===0&&M.__key===b&&m===j||O===h-1&&M.__key===_&&y===0)&&(T=!0,w&=M.getFormat(),w===0))break}a.format=T?w:0}}Y(e,mr,void 0)})}function Da(n,e,t){n.format===e&&n.style===t||(n.format=e,n.style=t,n.dirty=!0)}function gy(n,e){Da(n,e.getFormat(),e.getStyle())}function my(n){if(!n.getTargetRanges)return null;const e=n.getTargetRanges();return e.length===0?null:e[0]}function ia(n,e){const t=n._compositionKey;if(Ze(null),t!==null&&e!=null){if(e===""){const r=ce(t),i=qi(n.getElementByKey(t));return void(i!==null&&i.nodeValue!==null&&W(r)&&rf(r,i.nodeValue,null,null,!0))}if(e[e.length-1]===`
`){const r=K();if(q(r)){const i=r.focus;return r.anchor.set(i.key,i.offset,i.type),void Y(n,Fi,null)}}}nf(!0,n,e)}function yy(n){let e=n.__lexicalEventHandles;return e===void 0&&(e=[],n.__lexicalEventHandles=e),e}const Mi=new Map;function _y(n){const e=ux(n.target);if(e===null)return;const t=qy(e.anchorNode);if(t===null)return;Au&&(Au=!1,At(t,()=>{const l=rs(),c=e.anchorNode;(Ne(c)||Hn(c))&&it(Kd(l,e,t,n))}));const r=tf(t),i=r[r.length-1],s=i._key,o=Mi.get(s),a=o||i;a!==t&&hh(e,a,!1),hh(e,t,!0),t!==i?Mi.set(s,t):o&&Mi.delete(s)}function ph(n){n._lexicalHandled=!0}function gh(n){return n._lexicalHandled===!0}function Pw(n){const e=n.ownerDocument,t=sl.get(e);if(t===void 0)return;const r=t-1;r>=0||J(164),sl.set(e,r),r===0&&e.removeEventListener("selectionchange",_y);const i=Fl(n);ef(i)?(function(o){if(o._parentEditor!==null){const a=tf(o),l=a[a.length-1]._key;Mi.get(l)===o&&Mi.delete(l)}else Mi.delete(o._key)}(i),n.__lexicalEditor=null):i&&J(198);const s=yy(n);for(let o=0;o<s.length;o++)s[o]();n.__lexicalEventHandles=[]}function Ou(n,e,t){Qe();const r=n.__key,i=n.getParent();if(i===null)return;const s=function(a){const l=K();if(!q(l)||!F(a))return l;const{anchor:c,focus:u}=l,f=c.getNode(),d=u.getNode();return Du(f,a)&&c.set(a.__key,0,"element"),Du(d,a)&&u.set(a.__key,0,"element"),l}(n);let o=!1;if(q(s)&&e){const a=s.anchor,l=s.focus;a.key===r&&(al(a,n,i,n.getPreviousSibling(),n.getNextSibling()),o=!0),l.key===r&&(al(l,n,i,n.getPreviousSibling(),n.getNextSibling()),o=!0)}else mt(s)&&e&&n.isSelected()&&n.selectPrevious();if(q(s)&&e&&!o){const a=n.getIndexWithinParent();qr(n),ol(s,i,a,-1)}else qr(n);t||wn(i)||i.canBeEmpty()||!i.isEmpty()||Ou(i,e),e&&s&&et(i)&&i.isEmpty()&&i.selectEnd()}let ns=class{static getType(){const{ownNodeType:e}=lf(this);return e===void 0&&J(64,this.name),e}static clone(e){J(65,this.name)}$config(){return{}}config(e,t){const r=t.extends||Object.getPrototypeOf(this.constructor);return Object.assign(t,{extends:r,type:e}),{[e]:t}}afterCloneFrom(e){this.__key===e.__key?(this.__parent=e.__parent,this.__next=e.__next,this.__prev=e.__prev,this.__state=e.__state):e.__state&&(this.__state=e.__state.getWritable(this))}constructor(e){this.__type=this.constructor.getType(),this.__parent=null,this.__prev=null,this.__next=null,Object.defineProperty(this,"__state",{configurable:!0,enumerable:!1,value:void 0,writable:!0}),rx(this,e)}getType(){return this.__type}isInline(){J(137,this.constructor.name)}isAttached(){let e=this.__key;for(;e!==null;){if(e==="root")return!0;const t=ce(e);if(t===null)break;e=t.__parent}return!1}isSelected(e){const t=e||K();if(t==null)return!1;const r=t.getNodes().some(i=>i.__key===this.__key);if(W(this))return r;if(q(t)&&t.anchor.type==="element"&&t.focus.type==="element"){if(t.isCollapsed())return!1;const i=this.getParent();if(ke(this)&&this.isInline()&&i){const s=t.isBackward()?t.focus:t.anchor;if(i.is(s.getNode())&&s.offset===i.getChildrenSize()&&this.is(i.getLastChild()))return!1}}return r}getKey(){return this.__key}getIndexWithinParent(){const e=this.getParent();if(e===null)return-1;let t=e.getFirstChild(),r=0;for(;t!==null;){if(this.is(t))return r;r++,t=t.getNextSibling()}return-1}getParent(){const e=this.getLatest().__parent;return e===null?null:ce(e)}getParentOrThrow(){const e=this.getParent();return e===null&&J(66,this.__key),e}getTopLevelElement(){let e=this;for(;e!==null;){const t=e.getParent();if(wn(t))return F(e)||e===this&&ke(e)||J(194),e;e=t}return null}getTopLevelElementOrThrow(){const e=this.getTopLevelElement();return e===null&&J(67,this.__key),e}getParents(){const e=[];let t=this.getParent();for(;t!==null;)e.push(t),t=t.getParent();return e}getParentKeys(){const e=[];let t=this.getParent();for(;t!==null;)e.push(t.__key),t=t.getParent();return e}getPreviousSibling(){const e=this.getLatest().__prev;return e===null?null:ce(e)}getPreviousSiblings(){const e=[],t=this.getParent();if(t===null)return e;let r=t.getFirstChild();for(;r!==null&&!r.is(this);)e.push(r),r=r.getNextSibling();return e}getNextSibling(){const e=this.getLatest().__next;return e===null?null:ce(e)}getNextSiblings(){const e=[];let t=this.getNextSibling();for(;t!==null;)e.push(t),t=t.getNextSibling();return e}getCommonAncestor(e){const t=F(this)?this:this.getParent(),r=F(e)?e:e.getParent(),i=t&&r?Ys(t,r):null;return i?i.commonAncestor:null}is(e){return e!=null&&this.__key===e.__key}isBefore(e){const t=Ys(this,e);return t!==null&&(t.type==="descendant"||(t.type==="branch"?t_(t)===-1:(t.type!=="same"&&t.type!=="ancestor"&&J(279),!1)))}isParentOf(e){const t=Ys(this,e);return t!==null&&t.type==="ancestor"}getNodesBetween(e){const t=this.isBefore(e),r=[],i=new Set;let s=this;for(;s!==null;){const o=s.__key;if(i.has(o)||(i.add(o),r.push(s)),s===e)break;const a=F(s)?t?s.getFirstChild():s.getLastChild():null;if(a!==null){s=a;continue}const l=t?s.getNextSibling():s.getPreviousSibling();if(l!==null){s=l;continue}const c=s.getParentOrThrow();if(i.has(c.__key)||r.push(c),c===e)break;let u=null,f=c;do{if(f===null&&J(68),u=t?f.getNextSibling():f.getPreviousSibling(),f=f.getParent(),f===null)break;u!==null||i.has(f.__key)||r.push(f)}while(u===null);s=u}return t||r.reverse(),r}isDirty(){const e=Ie()._dirtyLeaves;return e!==null&&e.has(this.__key)}getLatest(){const e=ce(this.__key);return e===null&&J(113),e}getWritable(){Qe();const e=_r(),t=Ie(),r=e._nodeMap,i=this.__key,s=this.getLatest(),o=t._cloneNotNeeded,a=K();if(a!==null&&a.setCachedNodes(null),o.has(i))return cl(s),s;const l=af(s);return o.add(i),cl(l),r.set(i,l),l}getTextContent(){return""}getTextContentSize(){return this.getTextContent().length}createDOM(e,t){J(70)}updateDOM(e,t,r){J(71)}exportDOM(e){return{element:this.createDOM(e._config,e)}}exportJSON(){const e=this.__state?this.__state.toJSON():void 0;return{type:this.__type,version:1,...e}}static importJSON(e){J(18,this.name)}updateFromJSON(e){return function(t,r){const i=t.getWritable(),s=r.$;let o=s;for(const a of ey(i).flatKeys)a in r&&(o!==void 0&&o!==s||(o={...s}),o[a]=r[a]);return(i.__state||o)&&Zm(t).updateFromJSON(o),i}(this,e)}static transform(){return null}remove(e){Ou(this,!0,e)}replace(e,t){Qe();let r=K();r!==null&&(r=r.clone()),Yc(this,e);const i=this.getLatest(),s=this.__key,o=e.__key,a=e.getWritable(),l=this.getParentOrThrow().getWritable(),c=l.__size;qr(a);const u=i.getPreviousSibling(),f=i.getNextSibling(),d=i.__prev,h=i.__next,g=i.__parent;if(Ou(i,!1,!0),u===null?l.__first=o:u.getWritable().__next=o,a.__prev=d,f===null?l.__last=o:f.getWritable().__prev=o,a.__next=h,a.__parent=g,l.__size=c,t&&(F(this)&&F(a)||J(139),this.getChildren().forEach(m=>{a.append(m)})),q(r)){it(r);const m=r.anchor,y=r.focus;m.key===s&&bh(m,a),y.key===s&&bh(y,a)}return nr()===s&&Ze(o),a}insertAfter(e,t=!0){Qe(),Yc(this,e);const r=this.getWritable(),i=e.getWritable(),s=i.getParent(),o=K();let a=!1,l=!1;if(s!==null){const h=e.getIndexWithinParent();if(qr(i),q(o)){const g=s.__key,m=o.anchor,y=o.focus;a=m.type==="element"&&m.key===g&&m.offset===h+1,l=y.type==="element"&&y.key===g&&y.offset===h+1}}const c=this.getNextSibling(),u=this.getParentOrThrow().getWritable(),f=i.__key,d=r.__next;if(c===null?u.__last=f:c.getWritable().__prev=f,u.__size++,r.__next=f,i.__next=d,i.__prev=r.__key,i.__parent=r.__parent,t&&q(o)){const h=this.getIndexWithinParent();ol(o,u,h+1);const g=u.__key;a&&o.anchor.set(g,h+2,"element"),l&&o.focus.set(g,h+2,"element")}return e}insertBefore(e,t=!0){Qe(),Yc(this,e);const r=this.getWritable(),i=e.getWritable(),s=i.__key;qr(i);const o=this.getPreviousSibling(),a=this.getParentOrThrow().getWritable(),l=r.__prev,c=this.getIndexWithinParent();o===null?a.__first=s:o.getWritable().__next=s,a.__size++,r.__prev=s,i.__prev=l,i.__next=r.__key,i.__parent=r.__parent;const u=K();return t&&q(u)&&ol(u,this.getParentOrThrow(),c),e}isParentRequired(){return!1}createParentElementNode(){return It()}selectStart(){return this.selectPrevious()}selectEnd(){return this.selectNext(0,0)}selectPrevious(e,t){Qe();const r=this.getPreviousSibling(),i=this.getParentOrThrow();if(r===null)return i.select(0,0);if(F(r))return r.select();if(!W(r)){const s=r.getIndexWithinParent()+1;return i.select(s,s)}return r.select(e,t)}selectNext(e,t){Qe();const r=this.getNextSibling(),i=this.getParentOrThrow();if(r===null)return i.select();if(F(r))return r.select(0,0);if(!W(r)){const s=r.getIndexWithinParent();return i.select(s,s)}return r.select(e,t)}markDirty(){this.getWritable()}reconcileObservedMutation(e,t){this.markDirty()}},wo=class by extends ns{static getType(){return"linebreak"}static clone(e){return new by(e.__key)}constructor(e){super(e)}getTextContent(){return`
`}createDOM(){return document.createElement("br")}updateDOM(){return!1}isInline(){return!0}static importDOM(){return{br:e=>function(t){const r=t.parentElement;if(r!==null&&ul(r)){const i=r.firstChild;if(i===t||i.nextSibling===t&&sa(i)){const s=r.lastChild;if(s===t||s.previousSibling===t&&sa(s))return!0}}return!1}(e)||function(t){const r=t.parentElement;if(r!==null&&ul(r)){const i=r.firstChild;if(i===t||i.nextSibling===t&&sa(i))return!1;const s=r.lastChild;if(s===t||s.previousSibling===t&&sa(s))return!0}return!1}(e)?null:{conversion:Rw,priority:0}}}static importJSON(e){return Hr().updateFromJSON(e)}};function Rw(n){return{node:Hr()}}function Hr(){return Ae(new wo)}function Dr(n){return n instanceof wo}function sa(n){return Hn(n)&&/^( |\t|\r?\n)+$/.test(n.textContent||"")}function Kc(n,e){return 16&e?"code":e&Ed?"mark":32&e?"sub":64&e?"sup":null}function Hc(n,e){return 1&e?"strong":2&e?"em":"span"}function vy(n,e,t,r,i){const s=r.classList;let o=Oi(i,"base");o!==void 0&&s.add(...o),o=Oi(i,"underlineStrikethrough");let a=!1;const l=e&Za&&e&Qa;o!==void 0&&(t&Za&&t&Qa?(a=!0,l||s.add(...o)):l&&s.remove(...o));for(const c in lr){const u=lr[c];if(o=Oi(i,c),o!==void 0)if(t&u){if(a&&(c==="underline"||c==="strikethrough")){e&u&&s.remove(...o);continue}e&u&&(!l||c!=="underline")&&c!=="strikethrough"||s.add(...o)}else e&u&&s.remove(...o)}}function ky(n,e,t){const r=e.firstChild,i=t.isComposing(),s=n+(i?Ol:"");if(r==null)e.textContent=s;else{const o=r.nodeValue;if(o!==s)if(i||zr){const[a,l,c]=function(u,f){const d=u.length,h=f.length;let g=0,m=0;for(;g<d&&g<h&&u[g]===f[g];)g++;for(;m+g<d&&m+g<h&&u[d-m-1]===f[h-m-1];)m++;return[g,d-g-m,f.slice(g,h-m)]}(o,s);l!==0&&r.deleteData(a,l),r.insertData(a,c)}else r.nodeValue=s}}function mh(n,e,t,r,i,s){ky(i,n,e);const o=s.theme.text;o!==void 0&&vy(0,0,r,n,o)}function oa(n,e){const t=document.createElement(e);return t.appendChild(n),t}class ft extends ns{static getType(){return"text"}static clone(e){return new ft(e.__text,e.__key)}afterCloneFrom(e){super.afterCloneFrom(e),this.__text=e.__text,this.__format=e.__format,this.__style=e.__style,this.__mode=e.__mode,this.__detail=e.__detail}constructor(e="",t){super(t),this.__text=e,this.__format=0,this.__style="",this.__mode=0,this.__detail=0}getFormat(){return this.getLatest().__format}getDetail(){return this.getLatest().__detail}getMode(){const e=this.getLatest();return dw[e.__mode]}getStyle(){return this.getLatest().__style}isToken(){return this.getLatest().__mode===1}isComposing(){return this.__key===nr()}isSegmented(){return this.getLatest().__mode===2}isDirectionless(){return!!(1&this.getLatest().__detail)}isUnmergeable(){return!!(2&this.getLatest().__detail)}hasFormat(e){const t=lr[e];return!!(this.getFormat()&t)}isSimpleText(){return this.__type==="text"&&this.__mode===0}getTextContent(){return this.getLatest().__text}getFormatFlags(e,t){return ll(this.getLatest().__format,e,t)}canHaveFormat(){return!0}isInline(){return!0}createDOM(e,t){const r=this.__format,i=Kc(0,r),s=Hc(0,r),o=i===null?s:i,a=document.createElement(o);let l=a;this.hasFormat("code")&&a.setAttribute("spellcheck","false"),i!==null&&(l=document.createElement(s),a.appendChild(l)),mh(l,this,0,r,this.__text,e);const c=this.__style;return c!==""&&(a.style.cssText=c),a}updateDOM(e,t,r){const i=this.__text,s=e.__format,o=this.__format,a=Kc(0,s),l=Kc(0,o),c=Hc(0,s),u=Hc(0,o);if((a===null?c:a)!==(l===null?u:l))return!0;if(a===l&&c!==u){const m=t.firstChild;m==null&&J(48);const y=document.createElement(u);return mh(y,this,0,o,i,r),t.replaceChild(y,m),!1}let f=t;l!==null&&a!==null&&(f=t.firstChild,f==null&&J(49)),ky(i,f,this);const d=r.theme.text;d!==void 0&&s!==o&&vy(0,s,o,f,d);const h=e.__style,g=this.__style;return h!==g&&(t.style.cssText=g),!1}static importDOM(){return{"#text":()=>({conversion:Fw,priority:0}),b:()=>({conversion:Dw,priority:0}),code:()=>({conversion:An,priority:0}),em:()=>({conversion:An,priority:0}),i:()=>({conversion:An,priority:0}),mark:()=>({conversion:An,priority:0}),s:()=>({conversion:An,priority:0}),span:()=>({conversion:jw,priority:0}),strong:()=>({conversion:An,priority:0}),sub:()=>({conversion:An,priority:0}),sup:()=>({conversion:An,priority:0}),u:()=>({conversion:An,priority:0})}}static importJSON(e){return de().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setTextContent(e.text).setFormat(e.format).setDetail(e.detail).setMode(e.mode).setStyle(e.style)}exportDOM(e){let{element:t}=super.exportDOM(e);return Ne(t)||J(132),t.style.whiteSpace="pre-wrap",this.hasFormat("lowercase")?t.style.textTransform="lowercase":this.hasFormat("uppercase")?t.style.textTransform="uppercase":this.hasFormat("capitalize")&&(t.style.textTransform="capitalize"),this.hasFormat("bold")&&(t=oa(t,"b")),this.hasFormat("italic")&&(t=oa(t,"i")),this.hasFormat("strikethrough")&&(t=oa(t,"s")),this.hasFormat("underline")&&(t=oa(t,"u")),{element:t}}exportJSON(){return{detail:this.getDetail(),format:this.getFormat(),mode:this.getMode(),style:this.getStyle(),text:this.getTextContent(),...super.exportJSON()}}selectionTransform(e,t){}setFormat(e){const t=this.getWritable();return t.__format=typeof e=="string"?lr[e]:e,t}setDetail(e){const t=this.getWritable();return t.__detail=typeof e=="string"?lw[e]:e,t}setStyle(e){const t=this.getWritable();return t.__style=e,t}toggleFormat(e){const t=ll(this.getFormat(),e,null);return this.setFormat(t)}toggleDirectionless(){const e=this.getWritable();return e.__detail^=1,e}toggleUnmergeable(){const e=this.getWritable();return e.__detail^=2,e}setMode(e){const t=uw[e];if(this.__mode===t)return this;const r=this.getWritable();return r.__mode=t,r}setTextContent(e){if(this.__text===e)return this;const t=this.getWritable();return t.__text=e,t}select(e,t){Qe();let r=e,i=t;const s=K(),o=this.getTextContent(),a=this.__key;if(typeof o=="string"){const l=o.length;r===void 0&&(r=l),i===void 0&&(i=l)}else r=0,i=0;if(!q(s))return Ey(a,r,a,i,"text","text");{const l=nr();l!==s.anchor.key&&l!==s.focus.key||Ze(a),s.setTextNodeRange(this,r,this,i)}return s}selectStart(){return this.select(0,0)}selectEnd(){const e=this.getTextContentSize();return this.select(e,e)}spliceText(e,t,r,i){const s=this.getWritable(),o=s.__text,a=r.length;let l=e;l<0&&(l=a+l,l<0&&(l=0));const c=K();if(i&&q(c)){const f=e+a;c.setTextNodeRange(s,f,s,f)}const u=o.slice(0,l)+r+o.slice(l+t);return s.__text=u,s}canInsertTextBefore(){return!0}canInsertTextAfter(){return!0}splitText(...e){Qe();const t=this.getLatest(),r=t.getTextContent();if(r==="")return[];const i=t.__key,s=nr(),o=r.length;e.sort((A,$)=>A-$),e.push(o);const a=[],l=e.length;for(let A=0,$=0;A<o&&$<=l;$++){const B=e[$];B>A&&(a.push(r.slice(A,B)),A=B)}const c=a.length;if(c===1)return[t];const u=a[0],f=t.getParent();let d;const h=t.getFormat(),g=t.getStyle(),m=t.__detail;let y=!1,b=null,_=null;const w=K();if(q(w)){const[A,$]=w.isBackward()?[w.focus,w.anchor]:[w.anchor,w.focus];A.type==="text"&&A.key===i&&(b=A),$.type==="text"&&$.key===i&&(_=$)}t.isSegmented()?(d=de(u),d.__format=h,d.__style=g,d.__detail=m,d.__state=sh(t,d),y=!0):d=t.setTextContent(u);const T=[d];for(let A=1;A<c;A++){const $=de(a[A]);$.__format=h,$.__style=g,$.__detail=m,$.__state=sh(t,$);const B=$.__key;s===i&&Ze(B),T.push($)}const O=b?b.offset:null,M=_?_.offset:null;let j=0;for(const A of T){if(!b&&!_)break;const $=j+A.getTextContentSize();if(b!==null&&O!==null&&O<=$&&O>=j&&(b.set(A.getKey(),O-j,"text"),O<$&&(b=null)),_!==null&&M!==null&&M<=$&&M>=j){_.set(A.getKey(),M-j,"text");break}j=$}if(f!==null){(function(B){const C=B.getPreviousSibling(),N=B.getNextSibling();C!==null&&cl(C),N!==null&&cl(N)})(this);const A=f.getWritable(),$=this.getIndexWithinParent();y?(A.splice($,0,T),this.remove()):A.splice($,1,T),q(w)&&ol(w,f,$,c-1)}return T}mergeWithSibling(e){const t=e===this.getPreviousSibling();t||e===this.getNextSibling()||J(50);const r=this.__key,i=e.__key,s=this.__text,o=s.length;nr()===i&&Ze(r);const a=K();if(q(a)){const f=a.anchor,d=a.focus;f!==null&&f.key===i&&Th(f,t,r,e,o),d!==null&&d.key===i&&Th(d,t,r,e,o)}const l=e.__text,c=t?l+s:s+l;this.setTextContent(c);const u=this.getWritable();return e.remove(),u}isTextEntity(){return!1}}function jw(n){return{forChild:Wd(n.style),node:null}}function Dw(n){const e=n,t=e.style.fontWeight==="normal";return{forChild:Wd(e.style,t?void 0:"bold"),node:null}}const yh=new WeakMap;function Lw(n){if(!Ne(n))return!1;if(n.nodeName==="PRE")return!0;const e=n.style.whiteSpace;return typeof e=="string"&&e.startsWith("pre")}function Fw(n){const e=n;n.parentElement===null&&J(129);let t=e.textContent||"";if(function(r){let i,s=r.parentNode;const o=[r];for(;s!==null&&(i=yh.get(s))===void 0&&!Lw(s);)o.push(s),s=s.parentNode;const a=i===void 0?s:i;for(let l=0;l<o.length;l++)yh.set(o[l],a);return a}(e)!==null){const r=t.split(/(\r?\n|\t)/),i=[],s=r.length;for(let o=0;o<s;o++){const a=r[o];a===`
`||a===`\r
`?i.push(Hr()):a==="	"?i.push(Co()):a!==""&&i.push(de(a))}return{node:i}}if(t=t.replace(/\r/g,"").replace(/[ \t\n]+/g," "),t==="")return{node:null};if(t[0]===" "){let r=e,i=!0;for(;r!==null&&(r=_h(r,!1))!==null;){const s=r.textContent||"";if(s.length>0){/[ \t\n]$/.test(s)&&(t=t.slice(1)),i=!1;break}}i&&(t=t.slice(1))}if(t[t.length-1]===" "){let r=e,i=!0;for(;r!==null&&(r=_h(r,!0))!==null;)if((r.textContent||"").replace(/^( |\t|\r?\n)+/,"").length>0){i=!1;break}i&&(t=t.slice(0,t.length-1))}return t===""?{node:null}:{node:de(t)}}function _h(n,e){let t=n;for(;;){let r;for(;(r=e?t.nextSibling:t.previousSibling)===null;){const s=t.parentElement;if(s===null)return null;t=s}if(t=r,Ne(t)){const s=t.style.display;if(s===""&&!qu(t)||s!==""&&!s.startsWith("inline"))return null}let i=t;for(;(i=e?t.firstChild:t.lastChild)!==null;)t=i;if(Hn(t))return t;if(t.nodeName==="BR")return null}}const qw={code:"code",em:"italic",i:"italic",mark:"highlight",s:"strikethrough",strong:"bold",sub:"subscript",sup:"superscript",u:"underline"};function An(n){const e=qw[n.nodeName.toLowerCase()];return e===void 0?{node:null}:{forChild:Wd(n.style,e),node:null}}function de(n=""){return Ae(new ft(n))}function W(n){return n instanceof ft}function Wd(n,e){const t=n.fontWeight,r=n.textDecoration.split(" "),i=t==="700"||t==="bold",s=r.includes("line-through"),o=n.fontStyle==="italic",a=r.includes("underline"),l=n.verticalAlign;return c=>(W(c)&&(i&&!c.hasFormat("bold")&&c.toggleFormat("bold"),s&&!c.hasFormat("strikethrough")&&c.toggleFormat("strikethrough"),o&&!c.hasFormat("italic")&&c.toggleFormat("italic"),a&&!c.hasFormat("underline")&&c.toggleFormat("underline"),l!=="sub"||c.hasFormat("subscript")||c.toggleFormat("subscript"),l!=="super"||c.hasFormat("superscript")||c.toggleFormat("superscript"),e&&!c.hasFormat(e)&&c.toggleFormat(e)),c)}class xo extends ft{static getType(){return"tab"}static clone(e){return new xo(e.__key)}constructor(e){super("	",e),this.__detail=2}static importDOM(){return null}createDOM(e){const t=super.createDOM(e),r=Oi(e.theme,"tab");return r!==void 0&&t.classList.add(...r),t}static importJSON(e){return Co().updateFromJSON(e)}setTextContent(e){return e!=="	"&&e!==""&&J(126),super.setTextContent("	")}spliceText(e,t,r,i){return r===""&&t===0||r==="	"&&t===1||J(286),this}setDetail(e){return e!==2&&J(127),this}setMode(e){return e!=="normal"&&J(128),this}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}}function Co(){return Ae(new xo)}function wy(n){return n instanceof xo}class Bw{constructor(e,t,r){this._selection=null,this.key=e,this.offset=t,this.type=r}is(e){return this.key===e.key&&this.offset===e.offset&&this.type===e.type}isBefore(e){return this.key===e.key?this.offset<e.offset:e_(gn(Un(this,"next")),gn(Un(e,"next")))<0}getNode(){const e=ce(this.key);return e===null&&J(20),e}set(e,t,r,i){const s=this._selection,o=this.key;i&&this.key===e&&this.offset===t&&this.type===r||(this.key=e,this.offset=t,this.type=r,is()||(nr()===o&&Ze(e),s!==null&&(s.setCachedNodes(null),s.dirty=!0)))}}function St(n,e,t){return new Bw(n,e,t)}function Jc(n,e){let t=e.__key,r=n.offset,i="element";if(W(e)){i="text";const s=e.getTextContentSize();r>s&&(r=s)}else if(!F(e)){const s=e.getNextSibling();if(W(s))t=s.__key,r=0,i="text";else{const o=e.getParent();o&&(t=o.__key,r=e.getIndexWithinParent()+1)}}n.set(t,r,i)}function bh(n,e){if(F(e)){const t=e.getLastDescendant();F(t)||W(t)?Jc(n,t):Jc(n,e)}else Jc(n,e)}let xy=class Cy{constructor(e){this._cachedNodes=null,this._nodes=e,this.dirty=!1}getCachedNodes(){return this._cachedNodes}setCachedNodes(e){this._cachedNodes=e}is(e){if(!mt(e))return!1;const t=this._nodes,r=e._nodes;return t.size===r.size&&Array.from(t).every(i=>r.has(i))}isCollapsed(){return!1}isBackward(){return!1}getStartEndPoints(){return null}add(e){this.dirty=!0,this._nodes.add(e),this._cachedNodes=null}delete(e){this.dirty=!0,this._nodes.delete(e),this._cachedNodes=null}clear(){this.dirty=!0,this._nodes.clear(),this._cachedNodes=null}has(e){return this._nodes.has(e)}clone(){return new Cy(new Set(this._nodes))}extract(){return this.getNodes()}insertRawText(e){}insertText(){}insertNodes(e){const t=this.getNodes(),r=t.length,i=t[r-1];let s;if(W(i))s=i.select();else{const o=i.getIndexWithinParent()+1;s=i.getParentOrThrow().select(o,o)}s.insertNodes(e);for(let o=0;o<r;o++)t[o].remove()}getNodes(){const e=this._cachedNodes;if(e!==null)return e;const t=this._nodes,r=[];for(const i of t){const s=ce(i);s!==null&&r.push(s)}return is()||(this._cachedNodes=r),r}getTextContent(){const e=this.getNodes();let t="";for(let r=0;r<e.length;r++)t+=e[r].getTextContent();return t}deleteNodes(){const e=this.getNodes();if((K()||rs())===this&&e[0]){const t=Be(e[0],"next");Cx(dr(t,t))}for(const t of e)t.remove()}};function q(n){return n instanceof si}class si{constructor(e,t,r,i){this.anchor=e,this.focus=t,e._selection=this,t._selection=this,this._cachedNodes=null,this.format=r,this.style=i,this.dirty=!1}getCachedNodes(){return this._cachedNodes}setCachedNodes(e){this._cachedNodes=e}is(e){return!!q(e)&&this.anchor.is(e.anchor)&&this.focus.is(e.focus)&&this.format===e.format&&this.style===e.style}isCollapsed(){return this.anchor.is(this.focus)}getNodes(){const e=this._cachedNodes;if(e!==null)return e;const t=function(r){const i=[],[s,o]=r.getTextSlices();s&&i.push(s.caret.origin);const a=new Set,l=new Set;for(const c of r)if(Gt(c)){const{origin:u}=c;i.length===0?a.add(u):(l.add(u),i.push(u))}else{const{origin:u}=c;F(u)&&l.has(u)||i.push(u)}if(o&&i.push(o.caret.origin),Jr(r.focus)&&F(r.focus.origin)&&r.focus.getNodeAtCaret()===null)for(let c=Zt(r.focus.origin,"previous");Gt(c)&&a.has(c.origin)&&!c.origin.isEmpty()&&c.origin.is(i[i.length-1]);c=oo(c))a.delete(c.origin),i.pop();for(;i.length>1;){const c=i[i.length-1];if(!F(c)||l.has(c)||c.isEmpty()||a.has(c))break;i.pop()}if(i.length===0&&r.isCollapsed()){const c=gn(r.anchor),u=gn(r.anchor.getFlipped()),f=h=>or(h)?h.origin:h.getNodeAtCaret(),d=f(c)||f(u)||(r.anchor.getNodeAtCaret()?c.origin:u.origin);i.push(d)}return i}(r_(Hh(this),"next"));return is()||(this._cachedNodes=t),t}setTextNodeRange(e,t,r,i){this.anchor.set(e.__key,t,"text"),this.focus.set(r.__key,i,"text")}getTextContent(){const e=this.getNodes();if(e.length===0)return"";const t=e[0],r=e[e.length-1],i=this.anchor,s=this.focus,o=i.isBefore(s),[a,l]=$u(this);let c="",u=!0;for(let f=0;f<e.length;f++){const d=e[f];if(F(d)&&!d.isInline())u||(c+=`
`),u=!d.isEmpty();else if(u=!1,W(d)){let h=d.getTextContent();d===t?d===r?i.type==="element"&&s.type==="element"&&s.offset!==i.offset||(h=a<l?h.slice(a,l):h.slice(l,a)):h=o?h.slice(a):h.slice(l):d===r&&(h=o?h.slice(0,l):h.slice(0,a)),c+=h}else!ke(d)&&!Dr(d)||d===r&&this.isCollapsed()||(c+=d.getTextContent())}return c}applyDOMRange(e){const t=Ie(),r=t.getEditorState()._selection,i=Ty(e.startContainer,e.startOffset,e.endContainer,e.endOffset,t,r);if(i===null)return;const[s,o]=i;this.anchor.set(s.key,s.offset,s.type,!0),this.focus.set(o.key,o.offset,o.type,!0),to(this)}clone(){const e=this.anchor,t=this.focus;return new si(St(e.key,e.offset,e.type),St(t.key,t.offset,t.type),this.format,this.style)}toggleFormat(e){this.format=ll(this.format,e,null),this.dirty=!0}setFormat(e){this.format=e,this.dirty=!0}setStyle(e){this.style=e,this.dirty=!0}hasFormat(e){const t=lr[e];return!!(this.format&t)}insertRawText(e){const t=e.split(/(\r?\n|\t)/),r=[],i=t.length;for(let s=0;s<i;s++){const o=t[s];o===`
`||o===`\r
`?r.push(Hr()):o==="	"?r.push(Co()):r.push(de(o))}this.insertNodes(r)}insertText(e){const t=this.anchor,r=this.focus,i=this.format,s=this.style;let o=t,a=r;!this.isCollapsed()&&r.isBefore(t)&&(o=r,a=t),o.type==="element"&&function(y,b,_,w){const T=y.getNode(),O=T.getChildAtIndex(y.offset),M=de(),j=et(T)?It().append(M):M;M.setFormat(_),M.setStyle(w),O===null?T.append(j):O.insertBefore(j),y.is(b)&&b.set(M.__key,0,"text"),y.set(M.__key,0,"text")}(o,a,i,s),a.type==="element"&&ao(a,gn(Un(a,"next")));const l=o.offset;let c=a.offset;const u=this.getNodes(),f=u.length;let d=u[0];W(d)||J(26);const h=d.getTextContent().length,g=d.getParentOrThrow();let m=u[f-1];if(f===1&&a.type==="element"&&(c=h,a.set(o.key,c,"text")),this.isCollapsed()&&l===h&&(In(d)||!d.canInsertTextAfter()||!g.canInsertTextAfter()&&d.getNextSibling()===null)){let y=d.getNextSibling();if(W(y)&&y.canInsertTextBefore()&&!In(y)||(y=de(),y.setFormat(i),y.setStyle(s),g.canInsertTextAfter()?d.insertAfter(y):g.insertAfter(y)),y.select(0,0),d=y,e!=="")return void this.insertText(e)}else if(this.isCollapsed()&&l===0&&(In(d)||!d.canInsertTextBefore()||!g.canInsertTextBefore()&&d.getPreviousSibling()===null)){let y=d.getPreviousSibling();if(W(y)&&!In(y)||(y=de(),y.setFormat(i),g.canInsertTextBefore()?d.insertBefore(y):g.insertBefore(y)),y.select(),d=y,e!=="")return void this.insertText(e)}else if(d.isSegmented()&&l!==h){const y=de(d.getTextContent());y.setFormat(i),d.replace(y),d=y}else if(!this.isCollapsed()&&e!==""){const y=m.getParent();if(!g.canInsertTextBefore()||!g.canInsertTextAfter()||F(y)&&(!y.canInsertTextBefore()||!y.canInsertTextAfter()))return this.insertText(""),Sy(this.anchor,this.focus,null),void this.insertText(e)}if(f===1){if(Fr(d)){const w=de(e);return w.select(),void d.replace(w)}const y=d.getFormat(),b=d.getStyle();if(l!==c||y===i&&b===s){if(wy(d)){const w=de(e);return w.setFormat(i),w.setStyle(s),w.select(),void d.replace(w)}}else{if(d.getTextContent()!==""){const w=de(e);if(w.setFormat(i),w.setStyle(s),w.select(),l===0)d.insertBefore(w,!1);else{const[T]=d.splitText(l);T.insertAfter(w,!1)}return void(w.isComposing()&&this.anchor.type==="text"&&(this.anchor.offset-=e.length))}d.setFormat(i),d.setStyle(s)}const _=c-l;d=d.spliceText(l,_,e,!0),d.getTextContent()===""?d.remove():this.anchor.type==="text"&&(d.isComposing()?this.anchor.offset-=e.length:(this.format=y,this.style=b))}else{const y=new Set([...d.getParentKeys(),...m.getParentKeys()]),b=F(d)?d:d.getParentOrThrow();let _=F(m)?m:m.getParentOrThrow(),w=m;if(!b.is(_)&&_.isInline())do w=_,_=_.getParentOrThrow();while(_.isInline());if(a.type==="text"&&(c!==0||m.getTextContent()==="")||a.type==="element"&&m.getIndexWithinParent()<c)if(W(m)&&!Fr(m)&&c!==m.getTextContentSize()){if(m.isSegmented()){const A=de(m.getTextContent());m.replace(A),m=A}et(a.getNode())||a.type!=="text"||(m=m.spliceText(0,c,"")),y.add(m.__key)}else{const A=m.getParentOrThrow();A.canBeEmpty()||A.getChildrenSize()!==1?m.remove():A.remove()}else y.add(m.__key);const T=_.getChildren(),O=new Set(u),M=b.is(_),j=b.isInline()&&d.getNextSibling()===null?b:d;for(let A=T.length-1;A>=0;A--){const $=T[A];if($.is(d)||F($)&&$.isParentOf(d))break;$.isAttached()&&(!O.has($)||$.is(w)?M||j.insertAfter($,!1):$.remove())}if(!M){let A=_,$=null;for(;A!==null;){const B=A.getChildren(),C=B.length;(C===0||B[C-1].is($))&&(y.delete(A.__key),$=A),A=A.getParent()}}if(Fr(d))if(l===h)d.select();else{const A=de(e);A.select(),d.replace(A)}else d=d.spliceText(l,h-l,e,!0),d.getTextContent()===""?d.remove():d.isComposing()&&this.anchor.type==="text"&&(this.anchor.offset-=e.length);for(let A=1;A<f;A++){const $=u[A],B=$.__key;y.has(B)||$.remove()}}}removeText(){const e=K()===this;Ba(this,Sx(Hh(this))),e&&K()!==this&&it(this)}formatText(e,t=null){if(this.isCollapsed())return this.toggleFormat(e),void Ze(null);const r=this.getNodes(),i=[];for(const T of r)W(T)&&i.push(T);const s=T=>{r.forEach(O=>{if(F(O)){const M=O.getFormatFlags(e,T);O.setTextFormat(M)}})},o=i.length;if(o===0)return this.toggleFormat(e),Ze(null),void s(t);const a=this.anchor,l=this.focus,c=this.isBackward(),u=c?l:a,f=c?a:l;let d=0,h=i[0],g=u.type==="element"?0:u.offset;if(u.type==="text"&&g===h.getTextContentSize()&&(d=1,h=i[1],g=0),h==null)return;const m=h.getFormatFlags(e,t);s(m);const y=o-1;let b=i[y];const _=f.type==="text"?f.offset:b.getTextContentSize();if(h.is(b)){if(g===_)return;if(In(h)||g===0&&_===h.getTextContentSize())h.setFormat(m);else{const T=h.splitText(g,_),O=g===0?T[0]:T[1];O.setFormat(m),u.type==="text"&&u.set(O.__key,0,"text"),f.type==="text"&&f.set(O.__key,_-g,"text")}return void(this.format=m)}g===0||In(h)||([,h]=h.splitText(g),g=0),h.setFormat(m);const w=b.getFormatFlags(e,m);_>0&&(_===b.getTextContentSize()||In(b)||([b]=b.splitText(_)),b.setFormat(w));for(let T=d+1;T<y;T++){const O=i[T],M=O.getFormatFlags(e,w);O.setFormat(M)}u.type==="text"&&u.set(h.__key,g,"text"),f.type==="text"&&f.set(b.__key,_,"text"),this.format=m|w}insertNodes(e){if(e.length===0)return;if(this.isCollapsed()||this.removeText(),this.anchor.key==="root"){this.insertParagraph();const g=K();return q(g)||J(134),g.insertNodes(e)}const t=(this.isBackward()?this.focus:this.anchor).getNode(),r=Qc(t,Dt),i=e[e.length-1];if(F(r)&&"__language"in r){if("__language"in e[0])this.insertText(e[0].getTextContent());else{const g=Vc(this);r.splice(g,0,e),i.selectEnd()}return}if(!e.some(g=>(F(g)||ke(g))&&!g.isInline())){F(r)||J(211,t.constructor.name,t.getType());const g=Vc(this);return r.splice(g,0,e),void i.selectEnd()}const s=function(g){const m=It();let y=null;for(let b=0;b<g.length;b++){const _=g[b],w=Dr(_);if(w||ke(_)&&_.isInline()||F(_)&&_.isInline()||W(_)||_.isParentRequired()){if(y===null&&(y=_.createParentElementNode(),m.append(y),w))continue;y!==null&&y.append(_)}else m.append(_),y=null}return m}(e),o=s.getLastDescendant(),a=s.getChildren(),l=!F(r)||!r.isEmpty()?this.insertParagraph():null,c=a[a.length-1];let u=a[0];var f;F(f=u)&&Dt(f)&&!f.isEmpty()&&F(r)&&(!r.isEmpty()||r.canMergeWhenEmpty())&&(F(r)||J(211,t.constructor.name,t.getType()),r.append(...u.getChildren()),u=a[1]),u&&(r===null&&J(212,t.constructor.name,t.getType()),function(g,m,y){const b=m.getParentOrThrow().getLastChild();let _=m;const w=[m];for(;_!==b;)_.getNextSibling()||J(140),_=_.getNextSibling(),w.push(_);let T=g;for(const O of w)T=T.insertAfter(O)}(r,u));const d=Qc(o,Dt);l&&F(d)&&(l.canMergeWhenEmpty()||Dt(c))&&(d.append(...l.getChildren()),l.remove()),F(r)&&r.isEmpty()&&r.remove(),o.selectEnd();const h=F(r)?r.getLastChild():null;Dr(h)&&d!==r&&h.remove()}insertParagraph(){if(this.anchor.key==="root"){const o=It();return ye().splice(this.anchor.offset,0,[o]),o.select(),o}const e=Vc(this),t=Qc(this.anchor.getNode(),Dt);F(t)||J(213);const r=t.getChildAtIndex(e),i=r?[r,...r.getNextSiblings()]:[],s=t.insertNewAfter(this,!1);return s?(s.append(...i),s.selectStart(),s):null}insertLineBreak(e){const t=Hr();if(this.insertNodes([t]),e){const r=t.getParentOrThrow(),i=t.getIndexWithinParent();r.select(i,i)}}extract(){const e=this.getNodes(),t=e.length,r=t-1,i=this.anchor,s=this.focus;let o=e[0],a=e[r];const[l,c]=$u(this);if(t===0)return[];if(t===1){if(W(o)&&!this.isCollapsed()){const f=l>c?c:l,d=l>c?l:c,h=o.splitText(f,d),g=f===0?h[0]:h[1];return g!=null?[g]:[]}return[o]}const u=i.isBefore(s);if(W(o)){const f=u?l:c;f===o.getTextContentSize()?e.shift():f!==0&&([,o]=o.splitText(f),e[0]=o)}if(W(a)){const f=a.getTextContent().length,d=u?c:l;d===0?e.pop():d!==f&&([a]=a.splitText(d),e[r]=a)}return e}modify(e,t,r){if(Eh(this,e,t,r))return;const i=e==="move",s=Ie(),o=Qt(qt(s));if(!o)return;const a=s._blockCursorElement,l=s._rootElement,c=this.focus.getNode();if(l===null||a===null||!F(c)||c.isInline()||c.canBeEmpty()||Lu(a,s,l),this.dirty){let u=Bi(s,this.anchor.key),f=Bi(s,this.focus.key);this.anchor.type==="text"&&(u=qi(u)),this.focus.type==="text"&&(f=qi(f)),u&&f&&My(o,u,this.anchor.offset,f,this.focus.offset)}if(function(u,f,d,h){u.modify(f,d,h)}(o,e,t?"backward":"forward",r),o.rangeCount>0){const u=o.getRangeAt(0),f=this.anchor.getNode(),d=et(f)?f:lx(f);if(this.applyDOMRange(u),this.dirty=!0,!i){const h=this.getNodes(),g=[];let m=!1;for(let y=0;y<h.length;y++){const b=h[y];Du(b,d)?g.push(b):m=!0}if(m&&g.length>0)if(t){const y=g[0];F(y)?y.selectStart():y.getParentOrThrow().selectStart()}else{const y=g[g.length-1];F(y)?y.selectEnd():y.getParentOrThrow().selectEnd()}o.anchorNode===u.startContainer&&o.anchorOffset===u.startOffset||function(y){const b=y.focus,_=y.anchor,w=_.key,T=_.offset,O=_.type;_.set(b.key,b.offset,b.type,!0),b.set(w,T,O,!0)}(this)}}r==="lineboundary"&&Eh(this,e,t,r,"decorators")}forwardDeletion(e,t,r){if(!r&&(e.type==="element"&&F(t)&&e.offset===t.getChildrenSize()||e.type==="text"&&e.offset===t.getTextContentSize())){const i=t.getParent(),s=t.getNextSibling()||(i===null?null:i.getNextSibling());if(F(s)&&s.isShadowRoot())return!0}return!1}deleteCharacter(e){const t=this.isCollapsed();if(this.isCollapsed()){const r=this.anchor;let i=r.getNode();if(this.forwardDeletion(r,i,e))return;const s=df(Un(r,e?"previous":"next"));if(s.getTextSlices().every(a=>a===null||a.distance===0)){let a={type:"initial"};for(const l of s.iterNodeCarets("shadowRoot"))if(Gt(l)){if(!l.origin.isInline()){if(l.origin.isShadowRoot()){if(a.type==="merge-block")break;if(F(s.anchor.origin)&&s.anchor.origin.isEmpty()){const c=gn(l);Ba(this,dr(c,c)),s.anchor.origin.remove()}return}a.type!=="merge-next-block"&&a.type!=="merge-block"||(a={block:a.block,caret:l,type:"merge-block"})}}else{if(a.type==="merge-block")break;if(Jr(l)){if(F(l.origin)){if(l.origin.isInline()){if(!l.origin.isParentOf(s.anchor.origin))break}else a={block:l.origin,type:"merge-next-block"};continue}if(ke(l.origin)){if(!l.origin.isIsolated())if(a.type==="merge-next-block"&&(l.origin.isKeyboardSelectable()||!l.origin.isInline())&&F(s.anchor.origin)&&s.anchor.origin.isEmpty()){s.anchor.origin.remove();const c=Ny();c.add(l.origin.getKey()),it(c)}else l.origin.remove();return}break}}if(a.type==="merge-block"){const{caret:l,block:c}=a;return Ba(this,dr(!l.origin.isEmpty()&&c.isEmpty()?Wl(Be(c,l.direction)):s.anchor,l)),this.removeText()}}const o=this.focus;if(this.modify("extend",e,"character"),this.isCollapsed()){if(e&&r.offset===0&&kh(this,r.getNode()))return}else{const a=o.type==="text"?o.getNode():null;if(i=r.type==="text"?r.getNode():null,a!==null&&a.isSegmented()){const l=o.offset,c=a.getTextContentSize();if(a.is(i)||e&&l!==c||!e&&l!==0)return void wh(a,e,l)}else if(i!==null&&i.isSegmented()){const l=r.offset,c=i.getTextContentSize();if(i.is(a)||e&&l!==0||!e&&l!==c)return void wh(i,e,l)}(function(l,c){const u=l.anchor,f=l.focus,d=u.getNode(),h=f.getNode();if(d===h&&u.type==="text"&&f.type==="text"){const g=u.offset,m=f.offset,y=g<m,b=y?g:m,_=y?m:g,w=_-1;b!==w&&function(T){return!(Wy(T)||Uw(T))}(d.getTextContent().slice(b,_))&&(c?f.set(f.key,w,f.type):u.set(u.key,w,u.type))}})(this,e)}}if(this.removeText(),e&&!t&&this.isCollapsed()&&this.anchor.type==="element"&&this.anchor.offset===0){const r=this.anchor.getNode();r.isEmpty()&&et(r.getParent())&&r.getPreviousSibling()===null&&kh(this,r)}}deleteLine(e){this.isCollapsed()&&this.modify("extend",e,"lineboundary"),this.isCollapsed()?this.deleteCharacter(e):this.removeText()}deleteWord(e){if(this.isCollapsed()){const t=this.anchor,r=t.getNode();if(this.forwardDeletion(t,r,e))return;this.modify("extend",e,"word")}this.removeText()}isBackward(){return this.focus.isBefore(this.anchor)}getStartEndPoints(){return[this.anchor,this.focus]}}function mt(n){return n instanceof xy}function vh(n){const e=n.offset;if(n.type==="text")return e;const t=n.getNode();return e===t.getChildrenSize()?t.getTextContent().length:0}function $u(n){const e=n.getStartEndPoints();if(e===null)return[0,0];const[t,r]=e;return t.type==="element"&&r.type==="element"&&t.key===r.key&&t.offset===r.offset?[0,0]:[vh(t),vh(r)]}function kh(n,e){for(let t=e;t;t=t.getParent()){if(F(t)){if(t.collapseAtStart(n))return!0;if(wn(t))break}if(t.getPreviousSibling())break}return!1}const Uw=(()=>{try{const n=new RegExp("\\p{Emoji}","u"),e=n.test.bind(n);if(e("❤️")&&e("#️⃣")&&e("👍"))return e}catch{}return()=>!1})();function wh(n,e,t){const r=n,i=r.getTextContent().split(/(?=\s)/g),s=i.length;let o=0,a=0;for(let c=0;c<s;c++){const u=c===s-1;if(a=o,o+=i[c].length,e&&o===t||o>t||u){i.splice(c,1),u&&(a=void 0);break}}const l=i.join("").trim();l===""?r.remove():(r.setTextContent(l),r.select(a,a))}function xh(n,e,t,r){let i,s=e;if(Ne(n)){let o=!1;const a=n.childNodes,l=a.length,c=r._blockCursorElement;s===l&&(o=!0,s=l-1);let u=a[s],f=!1;if(u===c)u=a[s+1],f=!0;else if(c!==null){const d=c.parentNode;n===d&&e>Array.prototype.indexOf.call(d.children,c)&&s--}if(i=Ni(u),W(i))s=ar(i,o?"next":"previous");else{let d=Ni(n);if(d===null)return null;if(F(d)){const h=r.getElementByKey(d.getKey());h===null&&J(214),[d,s]=d.getDOMSlot(h).resolveChildIndex(d,h,n,e),F(d)||J(215),o&&s>=d.getChildrenSize()&&(s=Math.max(0,d.getChildrenSize()-1));let m=d.getChildAtIndex(s);if(F(m)&&function(y,b,_){const w=y.getParent();return _===null||w===null||!w.canBeEmpty()||w!==_.getNode()}(m,0,t)){const y=o?m.getLastDescendant():m.getFirstDescendant();y===null?d=m:(m=y,d=F(m)?m:m.getParentOrThrow()),s=0}W(m)?(i=m,d=null,s=ar(m,o?"next":"previous")):m!==d&&o&&!f&&(F(d)||J(216),s=Math.min(d.getChildrenSize(),s+1))}else{const h=d.getIndexWithinParent();s=e===0&&ke(d)&&Ni(n)===d?h:h+1,d=d.getParentOrThrow()}if(F(d))return St(d.__key,s,"element")}}else i=Ni(n);return W(i)?St(i.__key,ar(i,s,"clamp"),"text"):null}function Ch(n,e,t){const r=n.offset,i=n.getNode();if(r===0){const s=i.getPreviousSibling(),o=i.getParent();if(e){if((t||!e)&&s===null&&F(o)&&o.isInline()){const a=o.getPreviousSibling();W(a)&&n.set(a.__key,a.getTextContent().length,"text")}}else F(s)&&!t&&s.isInline()?n.set(s.__key,s.getChildrenSize(),"element"):W(s)&&n.set(s.__key,s.getTextContent().length,"text")}else if(r===i.getTextContent().length){const s=i.getNextSibling(),o=i.getParent();if(e&&F(s)&&s.isInline())n.set(s.__key,0,"element");else if((t||e)&&s===null&&F(o)&&o.isInline()&&!o.canInsertTextAfter()){const a=o.getNextSibling();W(a)&&n.set(a.__key,0,"text")}}}function Sy(n,e,t){if(n.type==="text"&&e.type==="text"){const r=n.isBefore(e),i=n.is(e);Ch(n,r,i),Ch(e,!r,i),i&&e.set(n.key,n.offset,n.type);const s=Ie();if(s.isComposing()&&s._compositionKey!==n.key&&q(t)){const o=t.anchor,a=t.focus;n.set(o.key,o.offset,o.type,!0),e.set(a.key,a.offset,a.type,!0)}}}function Ty(n,e,t,r,i,s){if(n===null||t===null||!To(i,n,t))return null;const o=xh(n,e,q(s)?s.anchor:null,i);if(o===null)return null;const a=xh(t,r,q(s)?s.focus:null,i);if(a===null)return null;if(o.type==="element"&&a.type==="element"){const l=Ni(n),c=Ni(t);if(ke(l)&&ke(c))return null}return Sy(o,a,s),[o,a]}function Iu(n){return F(n)&&!n.isInline()}function Ey(n,e,t,r,i,s){const o=_r(),a=new si(St(n,e,i),St(t,r,s),0,"");return a.dirty=!0,o._selection=a,a}function So(){const n=St("root",0,"element"),e=St("root",0,"element");return new si(n,e,0,"")}function Ny(){return new xy(new Set)}function Kd(n,e,t,r){const i=t._window;if(i===null)return null;const s=r||i.event,o=s?s.type:void 0,a=o==="selectionchange",l=!vu&&(a||o==="beforeinput"||o==="compositionstart"||o==="compositionend"||o==="click"&&s&&s.detail===3||o==="drop"||o===void 0);let c,u,f,d;if(q(n)&&!l)return n.clone();if(e===null)return null;if(c=e.anchorNode,u=e.focusNode,f=e.anchorOffset,d=e.focusOffset,a&&q(n)&&!To(t,c,u))return n.clone();const h=Ty(c,f,u,d,t,n);if(h===null)return null;const[g,m]=h;return new si(g,m,q(n)?n.format:0,q(n)?n.style:"")}function K(){return _r()._selection}function rs(){return Ie()._editorState._selection}function ol(n,e,t,r=1){const i=n.anchor,s=n.focus,o=i.getNode(),a=s.getNode();if(!e.is(o)&&!e.is(a))return;const l=e.__key;if(n.isCollapsed()){const c=i.offset;if(t<=c&&r>0||t<c&&r<0){const u=Math.max(0,c+r);i.set(l,u,"element"),s.set(l,u,"element"),Sh(n)}}else{const c=n.isBackward(),u=c?s:i,f=u.getNode(),d=c?i:s,h=d.getNode();if(e.is(f)){const g=u.offset;(t<=g&&r>0||t<g&&r<0)&&u.set(l,Math.max(0,g+r),"element")}if(e.is(h)){const g=d.offset;(t<=g&&r>0||t<g&&r<0)&&d.set(l,Math.max(0,g+r),"element")}}Sh(n)}function Sh(n){const e=n.anchor,t=e.offset,r=n.focus,i=r.offset,s=e.getNode(),o=r.getNode();if(n.isCollapsed()){if(!F(s))return;const a=s.getChildrenSize(),l=t>=a,c=l?s.getChildAtIndex(a-1):s.getChildAtIndex(t);if(W(c)){let u=0;l&&(u=c.getTextContentSize()),e.set(c.__key,u,"text"),r.set(c.__key,u,"text")}}else{if(F(s)){const a=s.getChildrenSize(),l=t>=a,c=l?s.getChildAtIndex(a-1):s.getChildAtIndex(t);if(W(c)){let u=0;l&&(u=c.getTextContentSize()),e.set(c.__key,u,"text")}}if(F(o)){const a=o.getChildrenSize(),l=i>=a,c=l?o.getChildAtIndex(a-1):o.getChildAtIndex(i);if(W(c)){let u=0;l&&(u=c.getTextContentSize()),r.set(c.__key,u,"text")}}}}function al(n,e,t,r,i){let s=null,o=0,a=null;r!==null?(s=r.__key,W(r)?(o=r.getTextContentSize(),a="text"):F(r)&&(o=r.getChildrenSize(),a="element")):i!==null&&(s=i.__key,W(i)?a="text":F(i)&&(a="element")),s!==null&&a!==null?n.set(s,o,a):(o=e.getIndexWithinParent(),o===-1&&(o=t.getChildrenSize()),n.set(t.__key,o,"element"))}function Th(n,e,t,r,i){n.type==="text"?n.set(t,n.offset+(e?0:i),"text"):n.offset>r.getIndexWithinParent()&&n.set(n.key,n.offset-1,"element")}function My(n,e,t,r,i){try{n.setBaseAndExtent(e,t,r,i)}catch{}}function zw(n,e,t,r,i,s,o){const a=r.anchorNode,l=r.focusNode,c=r.anchorOffset,u=r.focusOffset,f=document.activeElement;if(i.has(Gw)&&f!==s||f!==null&&Zd(f))return;if(!q(e))return void(n!==null&&To(t,a,l)&&r.removeAllRanges());const d=e.anchor,h=e.focus,g=d.key,m=h.key,y=Bi(t,g),b=Bi(t,m),_=d.offset,w=h.offset,T=e.format,O=e.style,M=e.isCollapsed();let j=y,A=b,$=!1;if(d.type==="text"){j=qi(y);const L=d.getNode();$=L.getFormat()!==T||L.getStyle()!==O}else q(n)&&n.anchor.type==="text"&&($=!0);var B,C,N,S,R;if(h.type==="text"&&(A=qi(b)),j!==null&&A!==null&&(M&&(n===null||$||q(n)&&(n.format!==T||n.style!==O))&&(B=T,C=O,N=_,S=g,R=performance.now(),hy=[B,C,N,S,R]),c!==_||u!==w||a!==j||l!==A||r.type==="Range"&&M||(f!==null&&s.contains(f)||s.focus({preventScroll:!0}),d.type==="element"))){if(My(r,j,_,A,w),!i.has(Yw)&&e.isCollapsed()&&s!==null&&s===document.activeElement){const L=q(e)&&e.anchor.type==="element"?j.childNodes[_]||null:r.rangeCount>0?r.getRangeAt(0):null;if(L!==null){let D;if(L instanceof Text){const z=document.createRange();z.selectNode(L),D=z.getBoundingClientRect()}else D=L.getBoundingClientRect();(function(z,H,V){const G=Gy(V),ee=of(G);if(G===null||ee===null)return;let{top:Q,bottom:re}=H,oe=0,X=0,fe=V;for(;fe!==null;){const ve=fe===G.body;if(ve)oe=0,X=qt(z).innerHeight;else{const ue=fe.getBoundingClientRect();oe=ue.top,X=ue.bottom}let se=0;if(Q<oe?se=-(oe-Q):re>X&&(se=re-X),se!==0)if(ve)ee.scrollBy(0,se);else{const ue=fe.scrollTop;fe.scrollTop+=se;const he=fe.scrollTop-ue;Q-=he,re-=he}if(ve)break;fe=Eo(fe)}})(t,D,s)}}Mu=!0}}function Ww(n){let e=K()||rs();e===null&&(e=ye().selectEnd()),e.insertNodes(n)}function Vc(n){let e=n;n.isCollapsed()||e.removeText();const t=K();q(t)&&(e=t),q(e)||J(161);const r=e.anchor;let i=r.getNode(),s=r.offset;for(;!Dt(i);){const o=i;if([i,s]=Kw(i,s),o.is(i))break}return s}function Kw(n,e){const t=n.getParent();if(!t){const i=It();return ye().append(i),i.select(),[ye(),0]}if(W(n)){const i=n.splitText(e);if(i.length===0)return[t,n.getIndexWithinParent()];const s=e===0?0:1;return[t,i[0].getIndexWithinParent()+s]}if(!F(n)||e===0)return[t,n.getIndexWithinParent()];const r=n.getChildAtIndex(e);if(r){const i=new si(St(n.__key,e,"element"),St(n.__key,e,"element"),0,""),s=n.insertNewAfter(i);s&&s.append(r,...r.getNextSiblings())}return[t,n.getIndexWithinParent()+1]}function Eh(n,e,t,r,i="decorators-and-blocks"){if(e==="move"&&r==="character"&&!n.isCollapsed()){const[u,f]=t===n.isBackward()?[n.focus,n.anchor]:[n.anchor,n.focus];return f.set(u.key,u.offset,u.type),!0}const s=Un(n.focus,t?"previous":"next"),o=r==="lineboundary",a=e==="move";let l=s,c=i==="decorators-and-blocks";if(!n_(l)){for(const u of l){c=!1;const{origin:f}=u;if(!ke(f)||f.isIsolated()||(l=u,!o||!f.isInline()))break}if(c)for(const u of df(s).iterNodeCarets(e==="extend"?"shadowRoot":"root")){if(Gt(u))u.origin.isInline()||(l=u);else{if(F(u.origin))continue;ke(u.origin)&&!u.origin.isInline()&&(l=u)}break}}if(l===s)return!1;if(a&&!o&&ke(l.origin)&&l.origin.isKeyboardSelectable()){const u=Ny();return u.add(l.origin.getKey()),it(u),!0}return l=gn(l),a&&ao(n.anchor,l),ao(n.focus,l),c||!o}let Ke=null,He=null,Ct=!1,Gc=!1,La=0;const Nh={characterData:!0,childList:!0,subtree:!0};function is(){return Ct||Ke!==null&&Ke._readOnly}function Qe(){Ct&&J(13)}function Ay(){La>99&&J(14)}function _r(){return Ke===null&&J(195,Oy()),Ke}function Ie(){return He===null&&J(196,Oy()),He}function Oy(){let n=0;const e=new Set,t=Ll.version;if(typeof window<"u")for(const i of document.querySelectorAll("[contenteditable]")){const s=Fl(i);if(ef(s))n++;else if(s){let o=String(s.constructor.version||"<0.17.1");o===t&&(o+=" (separately built, likely a bundler configuration issue)"),e.add(o)}}let r=` Detected on the page: ${n} compatible editor(s) with version ${t}`;return e.size&&(r+=` and incompatible editors with versions ${Array.from(e).join(", ")}`),r}function Hw(){return He}function Mh(n,e,t){const r=e.__type,i=Fy(n,r);let s=t.get(r);s===void 0&&(s=Array.from(i.transforms),t.set(r,s));const o=s.length;for(let a=0;a<o&&(s[a](e),e.isAttached());a++);}function Ah(n,e){return n!==void 0&&n.__key!==e&&n.isAttached()}function $y(n,e){if(!e)return;const t=n._updateTags;let r=e;Array.isArray(e)||(r=[e]);for(const i of r)t.add(i)}function Iy(n){return Hd(n,Ie()._nodes)}function Hd(n,e){const t=n.type,r=e.get(t);r===void 0&&J(17,t);const i=r.klass;n.type!==i.getType()&&J(18,i.name);const s=i.importJSON(n),o=n.children;if(F(s)&&Array.isArray(o))for(let a=0;a<o.length;a++){const l=Hd(o[a],e);s.append(l)}return s}function Oh(n,e,t){const r=Ke,i=Ct,s=He;Ke=e,Ct=!0,He=n;try{return t()}finally{Ke=r,Ct=i,He=s}}function jn(n,e){const t=n._pendingEditorState,r=n._rootElement,i=n._headless||r===null;if(t===null)return;const s=n._editorState,o=s._selection,a=t._selection,l=n._dirtyType!==Wr,c=Ke,u=Ct,f=He,d=n._updating,h=n._observer;let g=null;if(n._pendingEditorState=null,n._editorState=t,!i&&l&&h!==null){He=n,Ke=t,Ct=!1,n._updating=!0;try{const M=n._dirtyType,j=n._dirtyElements,A=n._dirtyLeaves;h.disconnect(),g=xw(s,t,n,M,j,A)}catch(M){if(M instanceof Error&&n._onError(M),Gc)throw M;return Ly(n,null,r,t),Ym(n),n._dirtyType=ji,Gc=!0,jn(n,s),void(Gc=!1)}finally{h.observe(r,Nh),n._updating=d,Ke=c,Ct=u,He=f}}t._readOnly||(t._readOnly=!0);const m=n._dirtyLeaves,y=n._dirtyElements,b=n._normalizedNodes,_=n._updateTags,w=n._deferred;l&&(n._dirtyType=Wr,n._cloneNotNeeded.clear(),n._dirtyLeaves=new Set,n._dirtyElements=new Map,n._normalizedNodes=new Set,n._updateTags=new Set),function(M,j){const A=M._decorators;let $=M._pendingDecorators||A;const B=j._nodeMap;let C;for(C in $)B.has(C)||($===A&&($=Uy(M)),delete $[C])}(n,t);const T=i?null:Qt(qt(n));if(n._editable&&T!==null&&(l||a===null||a.dirty)&&r!==null&&!_.has(Xw)){He=n,Ke=t;try{if(h!==null&&h.disconnect(),l||a===null||a.dirty){const M=n._blockCursorElement;M!==null&&Lu(M,n,r),zw(o,a,n,T,_,r)}(function(M,j,A){let $=M._blockCursorElement;if(q(A)&&A.isCollapsed()&&A.anchor.type==="element"&&j.contains(document.activeElement)){const B=A.anchor,C=B.getNode(),N=B.offset;let S=!1,R=null;if(N===C.getChildrenSize())Xc(C.getChildAtIndex(N-1))&&(S=!0);else{const L=C.getChildAtIndex(N);if(L!==null&&Xc(L)){const D=L.getPreviousSibling();(D===null||Xc(D))&&(S=!0,R=M.getElementByKey(L.__key))}}if(S){const L=M.getElementByKey(C.__key);return $===null&&(M._blockCursorElement=$=function(D){const z=D.theme,H=document.createElement("div");H.contentEditable="false",H.setAttribute("data-lexical-cursor","true");let V=z.blockCursor;if(V!==void 0){if(typeof V=="string"){const G=Xa(V);V=z.blockCursor=G}V!==void 0&&H.classList.add(...V)}return H}(M._config)),j.style.caretColor="transparent",void(R===null?L.appendChild($):L.insertBefore($,R))}}$!==null&&Lu($,M,j)})(n,r,a)}finally{h!==null&&h.observe(r,Nh),He=f,Ke=c}}g!==null&&function(M,j,A,$,B){const C=Array.from(M._listeners.mutation),N=C.length;for(let S=0;S<N;S++){const[R,L]=C[S];for(const D of L){const z=j.get(D);z!==void 0&&R(z,{dirtyLeaves:$,prevEditorState:B,updateTags:A})}}}(n,g,_,m,s),q(a)||a===null||o!==null&&o.is(a)||n.dispatchCommand(mr,void 0);const O=n._pendingDecorators;O!==null&&(n._decorators=O,n._pendingDecorators=null,Gs("decorator",n,!0,O)),function(M,j,A){const $=jh(j),B=jh(A);$!==B&&Gs("textcontent",M,!0,B)}(n,e||s,t),Gs("update",n,!0,{dirtyElements:y,dirtyLeaves:m,editorState:t,mutatedNodes:g,normalizedNodes:b,prevEditorState:e||s,tags:_}),function(M,j){if(M._deferred=[],j.length!==0){const A=M._updating;M._updating=!0;try{for(let $=0;$<j.length;$++)j[$]()}finally{M._updating=A}}}(n,w),function(M){const j=M._updates;if(j.length!==0){const A=j.shift();if(A){const[$,B]=A;Rl(M,$,B)}}}(n)}function Gs(n,e,t,...r){const i=e._updating;e._updating=t;try{const s=Array.from(e._listeners[n]);for(let o=0;o<s.length;o++)s[o].apply(null,r)}finally{e._updating=i}}function $h(n,e){const t=n._updates;let r=e||!1;for(;t.length!==0;){const i=t.shift();if(i){const[s,o]=i,a=n._pendingEditorState;let l;o!==void 0&&(l=o.onUpdate,o.skipTransforms&&(r=!0),o.discrete&&(a===null&&J(191),a._flushSync=!0),l&&n._deferred.push(l),$y(n,o.tag)),a==null?Rl(n,s,o):s()}}return r}function Rl(n,e,t){const r=n._updateTags;let i,s=!1,o=!1;t!==void 0&&(i=t.onUpdate,$y(n,t.tag),s=t.skipTransforms||!1,o=t.discrete||!1),i&&n._deferred.push(i);const a=n._editorState;let l=n._pendingEditorState,c=!1;(l===null||l._readOnly)&&(l=n._pendingEditorState=Ry(l||a),c=!0),l._flushSync=o;const u=Ke,f=Ct,d=He,h=n._updating;Ke=l,Ct=!1,n._updating=!0,He=n;const g=n._headless||n.getRootElement()===null;Xd(null);try{c&&(g?a._selection!==null&&(l._selection=a._selection.clone()):l._selection=function(_,w){const T=_.getEditorState()._selection,O=Qt(qt(_));return q(T)||T==null?Kd(T,O,_,w):T.clone()}(n,t&&t.event||null));const y=n._compositionKey;e(),s=$h(n,s),function(_,w){const T=w.getEditorState()._selection,O=_._selection;if(q(O)){const M=O.anchor,j=O.focus;let A;if(M.type==="text"&&(A=M.getNode(),A.selectionTransform(T,O)),j.type==="text"){const $=j.getNode();A!==$&&$.selectionTransform(T,O)}}}(l,n),n._dirtyType!==Wr&&(s?function(_,w){const T=w._dirtyLeaves,O=_._nodeMap;for(const M of T){const j=O.get(M);W(j)&&j.isAttached()&&j.isSimpleText()&&!j.isUnmergeable()&&lh(j)}}(l,n):function(_,w){const T=w._dirtyLeaves,O=w._dirtyElements,M=_._nodeMap,j=nr(),A=new Map;let $=T,B=$.size,C=O,N=C.size;for(;B>0||N>0;){if(B>0){w._dirtyLeaves=new Set;for(const S of $){const R=M.get(S);W(R)&&R.isAttached()&&R.isSimpleText()&&!R.isUnmergeable()&&lh(R),R!==void 0&&Ah(R,j)&&Mh(w,R,A),T.add(S)}if($=w._dirtyLeaves,B=$.size,B>0){La++;continue}}w._dirtyLeaves=new Set,w._dirtyElements=new Map,C.delete("root")&&C.set("root",!0);for(const S of C){const R=S[0],L=S[1];if(O.set(R,L),!L)continue;const D=M.get(R);D!==void 0&&Ah(D,j)&&Mh(w,D,A)}$=w._dirtyLeaves,B=$.size,C=w._dirtyElements,N=C.size,La++}w._dirtyLeaves=T,w._dirtyElements=O}(l,n),$h(n),function(_,w,T,O){const M=_._nodeMap,j=w._nodeMap,A=[];for(const[$]of O){const B=j.get($);B!==void 0&&(B.isAttached()||(F(B)&&Jm(B,$,M,j,A,O),M.has($)||O.delete($),A.push($)))}for(const $ of A)j.delete($);for(const $ of T){const B=j.get($);B===void 0||B.isAttached()||(M.has($)||T.delete($),j.delete($))}}(a,l,n._dirtyLeaves,n._dirtyElements)),y!==n._compositionKey&&(l._flushSync=!0);const b=l._selection;if(q(b)){const _=l._nodeMap,w=b.anchor.key,T=b.focus.key;_.get(w)!==void 0&&_.get(T)!==void 0||J(19)}else mt(b)&&b._nodes.size===0&&(l._selection=null)}catch(y){return y instanceof Error&&n._onError(y),n._pendingEditorState=a,n._dirtyType=ji,n._cloneNotNeeded.clear(),n._dirtyLeaves=new Set,n._dirtyElements.clear(),void jn(n)}finally{Ke=u,Ct=f,He=d,n._updating=h,La=0}n._dirtyType!==Wr||n._deferred.length>0||function(y,b){const _=b.getEditorState()._selection,w=y._selection;if(w!==null){if(w.dirty||!w.is(_))return!0}else if(_!==null)return!0;return!1}(l,n)?l._flushSync?(l._flushSync=!1,jn(n)):c&&tx(()=>{jn(n)}):(l._flushSync=!1,c&&(r.clear(),n._deferred=[],n._pendingEditorState=null))}function At(n,e,t){He===n&&t===void 0?e():Rl(n,e,t)}let Jw=class Fa{constructor(e,t,r){this.element=e,this.before=t||null,this.after=r||null}withBefore(e){return new Fa(this.element,e,this.after)}withAfter(e){return new Fa(this.element,this.before,e)}withElement(e){return this.element===e?this:new Fa(e,this.before,this.after)}insertChild(e){const t=this.before||this.getManagedLineBreak();return t!==null&&t.parentElement!==this.element&&J(222),this.element.insertBefore(e,t),this}removeChild(e){return e.parentElement!==this.element&&J(223),this.element.removeChild(e),this}replaceChild(e,t){return t.parentElement!==this.element&&J(224),this.element.replaceChild(e,t),this}getFirstChild(){const e=this.after?this.after.nextSibling:this.element.firstChild;return e===this.before||e===this.getManagedLineBreak()?null:e}getManagedLineBreak(){return this.element.__lexicalLineBreak||null}setManagedLineBreak(e){if(e===null)this.removeManagedLineBreak();else{const t=e==="decorator"&&(Ri||eo);this.insertManagedLineBreak(t)}}removeManagedLineBreak(){const e=this.getManagedLineBreak();if(e){const t=this.element,r=e.nodeName==="IMG"?e.nextSibling:null;r&&t.removeChild(r),t.removeChild(e),t.__lexicalLineBreak=void 0}}insertManagedLineBreak(e){const t=this.getManagedLineBreak();if(t){if(e===(t.nodeName==="IMG"))return;this.removeManagedLineBreak()}const r=this.element,i=this.before,s=document.createElement("br");if(r.insertBefore(s,i),e){const o=document.createElement("img");o.setAttribute("data-lexical-linebreak","true"),o.style.cssText="display: inline !important; border: 0px !important; margin: 0px !important;",o.alt="",r.insertBefore(o,s),r.__lexicalLineBreak=o}else r.__lexicalLineBreak=s}getFirstChildOffset(){let e=0;for(let t=this.after;t!==null;t=t.previousSibling)e++;return e}resolveChildIndex(e,t,r,i){if(r===this.element){const l=this.getFirstChildOffset();return[e,Math.min(l+e.getChildrenSize(),Math.max(l,i))]}const s=Ih(t,r);s.push(i);const o=Ih(t,this.element);let a=e.getIndexWithinParent();for(let l=0;l<o.length;l++){const c=s[l],u=o[l];if(c===void 0||c<u)break;if(c>u){a+=1;break}}return[e.getParentOrThrow(),a]}};function Ih(n,e){const t=[];let r=e;for(;r!==n&&r!==null;r=r.parentNode){let i=0;for(let s=r.previousSibling;s!==null;s=s.previousSibling)i++;t.push(i)}return r!==n&&J(225),t.reverse()}let pt=class extends ns{constructor(e){super(e),this.__first=null,this.__last=null,this.__size=0,this.__format=0,this.__style="",this.__indent=0,this.__dir=null,this.__textFormat=0,this.__textStyle=""}afterCloneFrom(e){super.afterCloneFrom(e),this.__key===e.__key&&(this.__first=e.__first,this.__last=e.__last,this.__size=e.__size),this.__indent=e.__indent,this.__format=e.__format,this.__style=e.__style,this.__dir=e.__dir,this.__textFormat=e.__textFormat,this.__textStyle=e.__textStyle}getFormat(){return this.getLatest().__format}getFormatType(){const e=this.getFormat();return cw[e]||""}getStyle(){return this.getLatest().__style}getIndent(){return this.getLatest().__indent}getChildren(){const e=[];let t=this.getFirstChild();for(;t!==null;)e.push(t),t=t.getNextSibling();return e}getChildrenKeys(){const e=[];let t=this.getFirstChild();for(;t!==null;)e.push(t.__key),t=t.getNextSibling();return e}getChildrenSize(){return this.getLatest().__size}isEmpty(){return this.getChildrenSize()===0}isDirty(){const e=Ie()._dirtyElements;return e!==null&&e.has(this.__key)}isLastChild(){const e=this.getLatest(),t=this.getParentOrThrow().getLastChild();return t!==null&&t.is(e)}getAllTextNodes(){const e=[];let t=this.getFirstChild();for(;t!==null;){if(W(t)&&e.push(t),F(t)){const r=t.getAllTextNodes();e.push(...r)}t=t.getNextSibling()}return e}getFirstDescendant(){let e=this.getFirstChild();for(;F(e);){const t=e.getFirstChild();if(t===null)break;e=t}return e}getLastDescendant(){let e=this.getLastChild();for(;F(e);){const t=e.getLastChild();if(t===null)break;e=t}return e}getDescendantByIndex(e){const t=this.getChildren(),r=t.length;if(e>=r){const s=t[r-1];return F(s)&&s.getLastDescendant()||s||null}const i=t[e];return F(i)&&i.getFirstDescendant()||i||null}getFirstChild(){const e=this.getLatest().__first;return e===null?null:ce(e)}getFirstChildOrThrow(){const e=this.getFirstChild();return e===null&&J(45,this.__key),e}getLastChild(){const e=this.getLatest().__last;return e===null?null:ce(e)}getLastChildOrThrow(){const e=this.getLastChild();return e===null&&J(96,this.__key),e}getChildAtIndex(e){const t=this.getChildrenSize();let r,i;if(e<t/2){for(r=this.getFirstChild(),i=0;r!==null&&i<=e;){if(i===e)return r;r=r.getNextSibling(),i++}return null}for(r=this.getLastChild(),i=t-1;r!==null&&i>=e;){if(i===e)return r;r=r.getPreviousSibling(),i--}return null}getTextContent(){let e="";const t=this.getChildren(),r=t.length;for(let i=0;i<r;i++){const s=t[i];e+=s.getTextContent(),F(s)&&i!==r-1&&!s.isInline()&&(e+=Bn)}return e}getTextContentSize(){let e=0;const t=this.getChildren(),r=t.length;for(let i=0;i<r;i++){const s=t[i];e+=s.getTextContentSize(),F(s)&&i!==r-1&&!s.isInline()&&(e+=Bn.length)}return e}getDirection(){return this.getLatest().__dir}getTextFormat(){return this.getLatest().__textFormat}hasFormat(e){if(e!==""){const t=eh[e];return!!(this.getFormat()&t)}return!1}hasTextFormat(e){const t=lr[e];return!!(this.getTextFormat()&t)}getFormatFlags(e,t){return ll(this.getLatest().__textFormat,e,t)}getTextStyle(){return this.getLatest().__textStyle}select(e,t){Qe();const r=K();let i=e,s=t;const o=this.getChildrenSize();if(!this.canBeEmpty()){if(e===0&&t===0){const l=this.getFirstChild();if(W(l)||F(l))return l.select(0,0)}else if(!(e!==void 0&&e!==o||t!==void 0&&t!==o)){const l=this.getLastChild();if(W(l)||F(l))return l.select()}}i===void 0&&(i=o),s===void 0&&(s=o);const a=this.__key;return q(r)?(r.anchor.set(a,i,"element"),r.focus.set(a,s,"element"),r.dirty=!0,r):Ey(a,i,a,s,"element","element")}selectStart(){const e=this.getFirstDescendant();return e?e.selectStart():this.select()}selectEnd(){const e=this.getLastDescendant();return e?e.selectEnd():this.select()}clear(){const e=this.getWritable();return this.getChildren().forEach(t=>t.remove()),e}append(...e){return this.splice(this.getChildrenSize(),0,e)}setDirection(e){const t=this.getWritable();return t.__dir=e,t}setFormat(e){return this.getWritable().__format=e!==""?eh[e]:0,this}setStyle(e){return this.getWritable().__style=e||"",this}setTextFormat(e){const t=this.getWritable();return t.__textFormat=e,t}setTextStyle(e){const t=this.getWritable();return t.__textStyle=e,t}setIndent(e){return this.getWritable().__indent=e,this}splice(e,t,r){const i=r.length,s=this.getChildrenSize(),o=this.getWritable();e+t<=s||J(226,String(e),String(t),String(s));const a=o.__key,l=[],c=[],u=this.getChildAtIndex(e+t);let f=null,d=s-t+i;if(e!==0)if(e===s)f=this.getLastChild();else{const g=this.getChildAtIndex(e);g!==null&&(f=g.getPreviousSibling())}if(t>0){let g=f===null?this.getFirstChild():f.getNextSibling();for(let m=0;m<t;m++){g===null&&J(100);const y=g.getNextSibling(),b=g.__key;qr(g.getWritable()),c.push(b),g=y}}let h=f;for(let g=0;g<i;g++){const m=r[g];h!==null&&m.is(h)&&(f=h=h.getPreviousSibling());const y=m.getWritable();y.__parent===a&&d--,qr(y);const b=m.__key;if(h===null)o.__first=b,y.__prev=null;else{const _=h.getWritable();_.__next=b,y.__prev=_.__key}m.__key===a&&J(76),y.__parent=a,l.push(b),h=m}if(e+t===s)h!==null&&(h.getWritable().__next=null,o.__last=h.__key);else if(u!==null){const g=u.getWritable();if(h!==null){const m=h.getWritable();g.__prev=h.__key,m.__next=u.__key}else g.__prev=null}if(o.__size=d,c.length){const g=K();if(q(g)){const m=new Set(c),y=new Set(l),{anchor:b,focus:_}=g;Ph(b,m,y)&&al(b,b.getNode(),this,f,u),Ph(_,m,y)&&al(_,_.getNode(),this,f,u),d!==0||this.canBeEmpty()||wn(this)||this.remove()}}return o}getDOMSlot(e){return new Jw(e)}exportDOM(e){const{element:t}=super.exportDOM(e);if(Ne(t)){const r=this.getIndent();r>0&&(t.style.paddingInlineStart=40*r+"px");const i=this.getDirection();i&&(t.dir=i)}return{element:t}}exportJSON(){const e={children:[],direction:this.getDirection(),format:this.getFormatType(),indent:this.getIndent(),...super.exportJSON()},t=this.getTextFormat(),r=this.getTextStyle();return t!==0&&(e.textFormat=t),r!==""&&(e.textStyle=r),e}updateFromJSON(e){return super.updateFromJSON(e).setFormat(e.format).setIndent(e.indent).setDirection(e.direction).setTextFormat(e.textFormat||0).setTextStyle(e.textStyle||"")}insertNewAfter(e,t){return null}canIndent(){return!0}collapseAtStart(e){return!1}excludeFromCopy(e){return!1}canReplaceWith(e){return!0}canInsertAfter(e){return!0}canBeEmpty(){return!0}canInsertTextBefore(){return!0}canInsertTextAfter(){return!0}isInline(){return!1}isShadowRoot(){return!1}canMergeWith(e){return!1}extractWithChild(e,t,r){return!1}canMergeWhenEmpty(){return!1}reconcileObservedMutation(e,t){const r=this.getDOMSlot(e);let i=r.getFirstChild();for(let s=this.getFirstChild();s;s=s.getNextSibling()){const o=t.getElementByKey(s.getKey());o!==null&&(i==null?(r.insertChild(o),i=o):i!==o&&r.replaceChild(o,i),i=i.nextSibling)}}};function F(n){return n instanceof pt}function Ph(n,e,t){let r=n.getNode();for(;r;){const i=r.__key;if(e.has(i)&&!t.has(i))return!0;r=r.getParent()}return!1}class br extends ns{decorate(e,t){J(47)}isIsolated(){return!1}isInline(){return!0}isKeyboardSelectable(){return!0}}function ke(n){return n instanceof br}let Jd=class Py extends pt{static getType(){return"root"}static clone(){return new Py}constructor(){super("root"),this.__cachedText=null}getTopLevelElementOrThrow(){J(51)}getTextContent(){const e=this.__cachedText;return!is()&&Ie()._dirtyType!==Wr||e===null?super.getTextContent():e}remove(){J(52)}replace(e){J(53)}insertBefore(e){J(54)}insertAfter(e){J(55)}updateDOM(e,t){return!1}splice(e,t,r){for(const i of r)F(i)||ke(i)||J(282);return super.splice(e,t,r)}static importJSON(e){return ye().updateFromJSON(e)}collapseAtStart(){return!0}};function et(n){return n instanceof Jd}function Ry(n){return new jl(new Map(n._nodeMap))}function Vd(){return new jl(new Map([["root",new Jd]]))}function jy(n){const e=n.exportJSON(),t=n.constructor;if(e.type!==t.getType()&&J(130,t.name),F(n)){const r=e.children;Array.isArray(r)||J(59,t.name);const i=n.getChildren();for(let s=0;s<i.length;s++){const o=jy(i[s]);r.push(o)}}return e}class jl{constructor(e,t){this._nodeMap=e,this._selection=t||null,this._flushSync=!1,this._readOnly=!1}isEmpty(){return this._nodeMap.size===1&&this._selection===null}read(e,t){return Oh(t&&t.editor||null,this,e)}clone(e){const t=new jl(this._nodeMap,e===void 0?this._selection:e);return t._readOnly=!0,t}toJSON(){return Oh(null,this,()=>({root:jy(ye())}))}}const Pu="historic",Vw="history-push",Lr="history-merge",Dy="paste",Gw="collaboration",Yw="skip-scroll-into-view",Xw="skip-dom-selection";class Gd extends pt{static getType(){return"artificial"}createDOM(e){return document.createElement("div")}}class vr extends pt{static getType(){return"paragraph"}static clone(e){return new vr(e.__key)}createDOM(e){const t=document.createElement("p"),r=Oi(e.theme,"paragraph");return r!==void 0&&t.classList.add(...r),t}updateDOM(e,t,r){return!1}static importDOM(){return{p:e=>({conversion:Qw,priority:0})}}exportDOM(e){const{element:t}=super.exportDOM(e);if(Ne(t)){this.isEmpty()&&t.append(document.createElement("br"));const r=this.getFormatType();r&&(t.style.textAlign=r)}return{element:t}}static importJSON(e){return It().updateFromJSON(e)}exportJSON(){return{...super.exportJSON(),textFormat:this.getTextFormat(),textStyle:this.getTextStyle()}}insertNewAfter(e,t){const r=It();r.setTextFormat(e.format),r.setTextStyle(e.style);const i=this.getDirection();return r.setDirection(i),r.setFormat(this.getFormatType()),r.setStyle(this.getStyle()),this.insertAfter(r,t),r}collapseAtStart(){const e=this.getChildren();if(e.length===0||W(e[0])&&e[0].getTextContent().trim()===""){if(this.getNextSibling()!==null)return this.selectNext(),this.remove(),!0;if(this.getPreviousSibling()!==null)return this.selectPrevious(),this.remove(),!0}return!1}}function Qw(n){const e=It();return n.style&&(e.setFormat(n.style.textAlign),fx(n,e)),{node:e}}function It(){return Ae(new vr)}function Yd(n){return n instanceof vr}const ne=0,oi=1,qa=2,Dl=3,Ai=4;function Ly(n,e,t,r){const i=n._keyToDOMMap;i.clear(),n._editorState=Vd(),n._pendingEditorState=r,n._compositionKey=null,n._dirtyType=Wr,n._cloneNotNeeded.clear(),n._dirtyLeaves=new Set,n._dirtyElements.clear(),n._normalizedNodes=new Set,n._updateTags=new Set,n._updates=[],n._blockCursorElement=null;const s=n._observer;s!==null&&(s.disconnect(),n._observer=null),e!==null&&(e.textContent=""),t!==null&&(t.textContent="",i.set("root",t))}function Zw(n){const e=n||{},t=Hw(),r=e.theme||{},i=n===void 0?t:e.parentEditor||null,s=e.disableEvents||!1,o=Vd(),a=e.namespace||(i!==null?i._config.namespace:Ky()),l=e.editorState,c=[Jd,ft,wo,xo,vr,Gd,...e.nodes||[]],{onError:u,html:f}=e,d=e.editable===void 0||e.editable;let h;if(n===void 0&&t!==null)h=t._nodes;else{h=new Map;for(let m=0;m<c.length;m++){let y=c[m],b=null,_=null;if(typeof y!="function"){const j=y;y=j.replace,b=j.with,_=j.withKlass||null}const{ownNodeConfig:w}=lf(y),T=y.getType(),O=y.transform(),M=new Set;w&&w.$transform&&M.add(w.$transform),O!==null&&M.add(O),h.set(T,{exportDOM:f&&f.export?f.export.get(y):void 0,klass:y,replace:b,replaceWithKlass:_,sharedNodeState:_w(c[m]),transforms:M})}}const g=new Ll(o,i,h,{disableEvents:s,namespace:a,theme:r},u||console.error,function(m,y){const b=new Map,_=new Set,w=T=>{Object.keys(T).forEach(O=>{let M=b.get(O);M===void 0&&(M=[],b.set(O,M)),M.push(T[O])})};return m.forEach(T=>{const O=T.klass.importDOM;if(O==null||_.has(O))return;_.add(O);const M=O.call(T.klass);M!==null&&w(M)}),y&&w(y),b}(h,f?f.import:void 0),d,n);return l!==void 0&&(g._pendingEditorState=l,g._dirtyType=ji),g}class Ll{constructor(e,t,r,i,s,o,a,l){this._createEditorArgs=l,this._parentEditor=t,this._rootElement=null,this._editorState=e,this._pendingEditorState=null,this._compositionKey=null,this._deferred=[],this._keyToDOMMap=new Map,this._updates=[],this._updating=!1,this._listeners={decorator:new Set,editable:new Set,mutation:new Map,root:new Set,textcontent:new Set,update:new Set},this._commands=new Map,this._config=i,this._nodes=r,this._decorators={},this._pendingDecorators=null,this._dirtyType=Wr,this._cloneNotNeeded=new Set,this._dirtyLeaves=new Set,this._dirtyElements=new Map,this._normalizedNodes=new Set,this._updateTags=new Set,this._observer=null,this._key=Ky(),this._onError=s,this._htmlConversions=o,this._editable=a,this._headless=t!==null&&t._headless,this._window=null,this._blockCursorElement=null}isComposing(){return this._compositionKey!=null}registerUpdateListener(e){const t=this._listeners.update;return t.add(e),()=>{t.delete(e)}}registerEditableListener(e){const t=this._listeners.editable;return t.add(e),()=>{t.delete(e)}}registerDecoratorListener(e){const t=this._listeners.decorator;return t.add(e),()=>{t.delete(e)}}registerTextContentListener(e){const t=this._listeners.textcontent;return t.add(e),()=>{t.delete(e)}}registerRootListener(e){const t=this._listeners.root;return e(this._rootElement,null),t.add(e),()=>{e(null,this._rootElement),t.delete(e)}}registerCommand(e,t,r){r===void 0&&J(35);const i=this._commands;i.has(e)||i.set(e,[new Set,new Set,new Set,new Set,new Set]);const s=i.get(e);s===void 0&&J(36,String(e));const o=s[r];return o.add(t),()=>{o.delete(t),s.every(a=>a.size===0)&&i.delete(e)}}registerMutationListener(e,t,r){const i=this.resolveRegisteredNodeAfterReplacements(this.getRegisteredNode(e)).klass,s=this._listeners.mutation;let o=s.get(t);o===void 0&&(o=new Set,s.set(t,o)),o.add(i);const a=r&&r.skipInitialization;return a!==void 0&&a||this.initializeMutationListener(t,i),()=>{o.delete(i),o.size===0&&s.delete(t)}}getRegisteredNode(e){const t=this._nodes.get(e.getType());return t===void 0&&J(37,e.name),t}resolveRegisteredNodeAfterReplacements(e){for(;e.replaceWithKlass;)e=this.getRegisteredNode(e.replaceWithKlass);return e}initializeMutationListener(e,t){const r=this._editorState,i=zh(r).get(t.getType());if(!i)return;const s=new Map;for(const o of i.keys())s.set(o,"created");s.size>0&&e(s,{dirtyLeaves:new Set,prevEditorState:r,updateTags:new Set(["registerMutationListener"])})}registerNodeTransformToKlass(e,t){const r=this.getRegisteredNode(e);return r.transforms.add(t),r}registerNodeTransform(e,t){const r=this.registerNodeTransformToKlass(e,t),i=[r],s=r.replaceWithKlass;if(s!=null){const o=this.registerNodeTransformToKlass(s,t);i.push(o)}return function(o,a){const l=zh(o.getEditorState()),c=[];for(const u of a){const f=l.get(u);f&&c.push(f)}c.length!==0&&o.update(()=>{for(const u of c)for(const f of u.keys()){const d=ce(f);d&&d.markDirty()}},o._pendingEditorState===null?{tag:Lr}:void 0)}(this,i.map(o=>o.klass.getType())),()=>{i.forEach(o=>o.transforms.delete(t))}}hasNode(e){return this._nodes.has(e.getType())}hasNodes(e){return e.every(this.hasNode.bind(this))}dispatchCommand(e,t){return Y(this,e,t)}getDecorators(){return this._decorators}getRootElement(){return this._rootElement}getKey(){return this._key}setRootElement(e){const t=this._rootElement;if(e!==t){const r=Oi(this._config.theme,"root"),i=this._pendingEditorState||this._editorState;if(this._rootElement=e,Ly(this,t,e,i),t!==null&&(this._config.disableEvents||Pw(t),r!=null&&t.classList.remove(...r)),e!==null){const s=of(e),o=e.style;o.userSelect="text",o.whiteSpace="pre-wrap",o.wordBreak="break-word",e.setAttribute("data-lexical-editor","true"),this._window=s,this._dirtyType=ji,Ym(this),this._updateTags.add(Lr),jn(this),this._config.disableEvents||function(a,l){const c=a.ownerDocument,u=sl.get(c);(u===void 0||u<1)&&c.addEventListener("selectionchange",_y),sl.set(c,(u||0)+1),a.__lexicalEditor=l;const f=yy(a);for(let d=0;d<Nu.length;d++){const[h,g]=Nu[d],m=typeof g=="function"?y=>{gh(y)||(ph(y),(l.isEditable()||h==="click")&&g(y,l))}:y=>{if(gh(y))return;ph(y);const b=l.isEditable();switch(h){case"cut":return b&&Y(l,ii,y);case"copy":return Y(l,yr,y);case"paste":return b&&Y(l,ri,y);case"dragstart":return b&&Y(l,Ud,y);case"dragover":return b&&Y(l,cy,y);case"dragend":return b&&Y(l,Aw,y);case"focus":return b&&Y(l,Ow,y);case"blur":return b&&Y(l,$w,y);case"drop":return b&&Y(l,Pl,y)}};a.addEventListener(h,m),f.push(()=>{a.removeEventListener(h,m)})}}(e,this),r!=null&&e.classList.add(...r)}else this._window=null,this._updateTags.add(Lr),jn(this);Gs("root",this,!1,e,t)}}getElementByKey(e){return this._keyToDOMMap.get(e)||null}getEditorState(){return this._editorState}setEditorState(e,t){e.isEmpty()&&J(38);let r=e;r._readOnly&&(r=Ry(e),r._selection=e._selection?e._selection.clone():null),Gm(this);const i=this._pendingEditorState,s=this._updateTags,o=t!==void 0?t.tag:null;i===null||i.isEmpty()||(o!=null&&s.add(o),jn(this)),this._pendingEditorState=r,this._dirtyType=ji,this._dirtyElements.set("root",!1),this._compositionKey=null,o!=null&&s.add(o),this._updating||jn(this)}parseEditorState(e,t){return function(r,i,s){const o=Vd(),a=Ke,l=Ct,c=He,u=i._dirtyElements,f=i._dirtyLeaves,d=i._cloneNotNeeded,h=i._dirtyType;i._dirtyElements=new Map,i._dirtyLeaves=new Set,i._cloneNotNeeded=new Set,i._dirtyType=0,Ke=o,Ct=!1,He=i,Xd(null);try{const g=i._nodes;Hd(r.root,g),s&&s(),o._readOnly=!0}catch(g){g instanceof Error&&i._onError(g)}finally{i._dirtyElements=u,i._dirtyLeaves=f,i._cloneNotNeeded=d,i._dirtyType=h,Ke=a,Ct=l,He=c}return o}(typeof e=="string"?JSON.parse(e):e,this,t)}read(e){return jn(this),this.getEditorState().read(e,{editor:this})}update(e,t){(function(r,i,s){r._updating?r._updates.push([i,s]):Rl(r,i,s)})(this,e,t)}focus(e,t={}){const r=this._rootElement;r!==null&&(r.setAttribute("autocapitalize","off"),At(this,()=>{const i=K(),s=ye();i!==null?i.dirty||it(i.clone()):s.getChildrenSize()!==0&&(t.defaultSelection==="rootStart"?s.selectStart():s.selectEnd()),Yy("focus"),ox(()=>{r.removeAttribute("autocapitalize"),e&&e()})}),this._pendingEditorState===null&&r.removeAttribute("autocapitalize"))}blur(){const e=this._rootElement;e!==null&&e.blur();const t=Qt(this._window);t!==null&&t.removeAllRanges()}isEditable(){return this._editable}setEditable(e){this._editable!==e&&(this._editable=e,Gs("editable",this,!0,e))}toJSON(){return{editorState:this._editorState.toJSON()}}}Ll.version="0.34.0+prod.esm";let Ru=null;function Xd(n){Ru=n}let ex=1;function Fy(n,e){const t=Qd(n,e);return t===void 0&&J(30,e),t}function Qd(n,e){return n._nodes.get(e)}const tx=typeof queueMicrotask=="function"?queueMicrotask:n=>{Promise.resolve().then(n)};function Rh(n){return ke(ur(n))}function Zd(n){const e=document.activeElement;if(!Ne(e))return!1;const t=e.nodeName;return ke(ur(n))&&(t==="INPUT"||t==="TEXTAREA"||e.contentEditable==="true"&&Fl(e)==null)}function To(n,e,t){const r=n.getRootElement();try{return r!==null&&r.contains(e)&&r.contains(t)&&e!==null&&!Zd(e)&&qy(e)===n}catch{return!1}}function ef(n){return n instanceof Ll}function qy(n){let e=n;for(;e!=null;){const t=Fl(e);if(ef(t))return t;e=Eo(e)}return null}function Fl(n){return n?n.__lexicalEditor:null}function Fr(n){return wy(n)||n.isToken()}function In(n){return Fr(n)||n.isSegmented()}function Hn(n){return ai(n)&&n.nodeType===Qk}function nx(n){return ai(n)&&n.nodeType===Zk}function qi(n){let e=n;for(;e!=null;){if(Hn(e))return e;e=e.firstChild}return null}function ll(n,e,t){const r=lr[e];if(t!==null&&(n&r)==(t&r))return n;let i=n^r;return e==="subscript"?i&=-65:e==="superscript"?i&=-33:e==="lowercase"?(i&=-513,i&=-1025):e==="uppercase"?(i&=-257,i&=-1025):e==="capitalize"&&(i&=-257,i&=-513),i}function rx(n,e){const t=function(){const o=Ru;return Ru=null,o}();if((e=e||t&&t.__key)!=null)return void(n.__key=e);Qe(),Ay();const r=Ie(),i=_r(),s=""+ex++;i._nodeMap.set(s,n),F(n)?r._dirtyElements.set(s,!0):r._dirtyLeaves.add(s),r._cloneNotNeeded.add(s),r._dirtyType=Wm,n.__key=s}function qr(n){const e=n.getParent();if(e!==null){const t=n.getWritable(),r=e.getWritable(),i=n.getPreviousSibling(),s=n.getNextSibling(),o=s!==null?s.__key:null,a=i!==null?i.__key:null,l=i!==null?i.getWritable():null,c=s!==null?s.getWritable():null;i===null&&(r.__first=o),s===null&&(r.__last=a),l!==null&&(l.__next=o),c!==null&&(c.__prev=a),t.__prev=null,t.__next=null,t.__parent=null,r.__size--}}function cl(n){Ay();const e=n.getLatest(),t=e.__parent,r=_r(),i=Ie(),s=r._nodeMap,o=i._dirtyElements;t!==null&&function(l,c,u){let f=l;for(;f!==null;){if(u.has(f))return;const d=c.get(f);if(d===void 0)break;u.set(f,!1),f=d.__parent}}(t,s,o);const a=e.__key;i._dirtyType=Wm,F(n)?o.set(a,!0):i._dirtyLeaves.add(a)}function Ze(n){Qe();const e=Ie(),t=e._compositionKey;if(n!==t){if(e._compositionKey=n,t!==null){const r=ce(t);r!==null&&r.getWritable()}if(n!==null){const r=ce(n);r!==null&&r.getWritable()}}}function nr(){return is()?null:Ie()._compositionKey}function ce(n,e){const t=(e||_r())._nodeMap.get(n);return t===void 0?null:t}function By(n,e){const t=ql(n,Ie());return t!==void 0?ce(t,e):null}function ql(n,e){return n[`__lexicalKey_${e._key}`]}function ur(n,e){let t=n;for(;t!=null;){const r=By(t,e);if(r!==null)return r;t=Eo(t)}return null}function Uy(n){const e=n._decorators,t=Object.assign({},e);return n._pendingDecorators=t,t}function jh(n){return n.read(()=>ye().getTextContent())}function ye(){return zy(_r())}function zy(n){return n._nodeMap.get("root")}function it(n){Qe();const e=_r();n!==null&&(n.dirty=!0,n.setCachedNodes(null)),e._selection=n}function Ni(n){const e=Ie(),t=function(r,i){let s=r;for(;s!=null;){const o=ql(s,i);if(o!==void 0)return o;s=Eo(s)}return null}(n,e);return t===null?n===e.getRootElement()?ce("root"):null:ce(t)}function Wy(n){return/[\uD800-\uDBFF][\uDC00-\uDFFF]/g.test(n)}function tf(n){const e=[];let t=n;for(;t!==null;)e.push(t),t=t._parentEditor;return e}function Ky(){return Math.random().toString(36).replace(/[^a-z]+/g,"").substring(0,5)}function Hy(n){return Hn(n)?n.nodeValue:null}function nf(n,e,t){const r=Qt(qt(e));if(r===null)return;const i=r.anchorNode;let{anchorOffset:s,focusOffset:o}=r;if(i!==null){let a=Hy(i);const l=ur(i);if(a!==null&&W(l)){if(a===Ol&&t){const c=t.length;a=t,s=c,o=c}a!==null&&rf(l,a,s,o,n)}}}function rf(n,e,t,r,i){let s=n;if(s.isAttached()&&(i||!s.isDirty())){const o=s.isComposing();let a=e;(o||i)&&e[e.length-1]===Ol&&(a=e.slice(0,-1));const l=s.getTextContent();if(i||a!==l){if(a===""){if(Ze(null),eo||Ri||Ya)s.remove();else{const m=Ie();setTimeout(()=>{m.update(()=>{s.isAttached()&&s.remove()})},20)}return}const c=s.getParent(),u=rs(),f=s.getTextContentSize(),d=nr(),h=s.getKey();if(s.isToken()||d!==null&&h===d&&!o||q(u)&&(c!==null&&!c.canInsertTextBefore()&&u.anchor.offset===0||u.anchor.key===n.__key&&u.anchor.offset===0&&!s.canInsertTextBefore()&&!o||u.focus.key===n.__key&&u.focus.offset===f&&!s.canInsertTextAfter()&&!o))return void s.markDirty();const g=K();if(!q(g)||t===null||r===null)return void Dh(s,a,g);if(g.setTextNodeRange(s,t,s,r),s.isSegmented()){const m=de(s.getTextContent());s.replace(m),s=m}Dh(s,a,g)}}}function Dh(n,e,t){if(n.setTextContent(e),q(t)){const r=n.getKey();for(const i of["anchor","focus"]){const s=t[i];s.type==="text"&&s.key===r&&(s.offset=ar(n,s.offset,"clamp"))}}}function aa(n,e,t){const r=e[t]||!1;return r==="any"||r===n[t]}function ix(n,e){return aa(n,e,"altKey")&&aa(n,e,"ctrlKey")&&aa(n,e,"shiftKey")&&aa(n,e,"metaKey")}function Se(n,e,t){return ix(n,t)&&n.key.toLowerCase()===e.toLowerCase()}const $n={ctrlKey:!fn,metaKey:fn},Lh={altKey:fn,ctrlKey:!fn};function Fh(n){return n.key==="Backspace"}function qh(n){return Se(n,"a",$n)}function Jy(n){const e=ye();if(q(n)){const t=n.anchor,r=n.focus,i=t.getNode().getTopLevelElementOrThrow().getParentOrThrow();return t.set(i.getKey(),0,"element"),r.set(i.getKey(),i.getChildrenSize(),"element"),to(n),n}{const t=e.select(0,e.getChildrenSize());return it(to(t)),t}}function Oi(n,e){n.__lexicalClassNameCache===void 0&&(n.__lexicalClassNameCache={});const t=n.__lexicalClassNameCache,r=t[e];if(r!==void 0)return r;const i=n[e];if(typeof i=="string"){const s=Xa(i);return t[e]=s,s}return i}function sf(n,e,t,r,i){if(t.size===0)return;const s=r.__type,o=r.__key,a=e.get(s);a===void 0&&J(33,s);const l=a.klass;let c=n.get(l);c===void 0&&(c=new Map,n.set(l,c));const u=c.get(o),f=u==="destroyed"&&i==="created";(u===void 0||f)&&c.set(o,f?"updated":i)}function Bh(n,e,t){const r=n.getParent();let i=t,s=n;return r!==null&&(e&&t===0?(i=s.getIndexWithinParent(),s=r):e||t!==s.getChildrenSize()||(i=s.getIndexWithinParent()+1,s=r)),s.getChildAtIndex(e?i-1:i)}function ju(n,e){const t=n.offset;if(n.type==="element")return Bh(n.getNode(),e,t);{const r=n.getNode();if(e&&t===0||!e&&t===r.getTextContentSize()){const i=e?r.getPreviousSibling():r.getNextSibling();return i===null?Bh(r.getParentOrThrow(),e,r.getIndexWithinParent()+(e?0:1)):i}}return null}function Vy(n){const e=qt(n).event,t=e&&e.inputType;return t==="insertFromPaste"||t==="insertFromPasteAsQuotation"}function Y(n,e,t){return function(r,i,s){const o=tf(r);for(let a=4;a>=0;a--)for(let l=0;l<o.length;l++){const c=o[l],u=c._commands.get(i);if(u!==void 0){const f=u[a];if(f!==void 0){const d=Array.from(f),h=d.length;let g=!1;if(At(c,()=>{for(let m=0;m<h;m++)if(d[m](s,r))return void(g=!0)}),g)return g}}}return!1}(n,e,t)}function Bl(n){return!et(n)&&!n.isLastChild()&&!n.isInline()}function Bi(n,e){const t=n._keyToDOMMap.get(e);return t===void 0&&J(75,e),t}function Eo(n){const e=n.assignedSlot||n.parentElement;return Fu(e)?e.host:e}function Gy(n){return nx(n)?n:Ne(n)?n.ownerDocument:null}function sx(n){return Ie()._updateTags.has(n)}function Yy(n){Qe(),Ie()._updateTags.add(n)}function ox(n){Qe(),Ie()._deferred.push(n)}function Du(n,e){let t=n.getParent();for(;t!==null;){if(t.is(e))return!0;t=t.getParent()}return!1}function of(n){const e=Gy(n);return e?e.defaultView:null}function qt(n){const e=n._window;return e===null&&J(78),e}function ax(n){return F(n)&&n.isInline()||ke(n)&&n.isInline()}function lx(n){let e=n.getParentOrThrow();for(;e!==null;){if(wn(e))return e;e=e.getParentOrThrow()}return e}function wn(n){return et(n)||F(n)&&n.isShadowRoot()}function Ae(n){const e=Ie(),t=n.getType(),r=Qd(e,t);r===void 0&&J(200,n.constructor.name,t);const{replace:i,replaceWithKlass:s}=r;if(i!==null){const o=i(n),a=o.constructor;return s!==null?o instanceof s||J(201,s.name,s.getType(),a.name,a.getType(),n.constructor.name,t):o instanceof n.constructor&&a!==n.constructor||J(202,a.name,a.getType(),n.constructor.name,t),o.__key===n.__key&&J(203,n.constructor.name,t,a.name,a.getType()),o}return n}function Yc(n,e){!et(n.getParent())||F(e)||ke(e)||J(99)}function cx(n){const e=ce(n);return e===null&&J(63,n),e}function Xc(n){return(ke(n)||F(n)&&!n.canBeEmpty())&&!n.isInline()}function Lu(n,e,t){t.style.removeProperty("caret-color"),e._blockCursorElement=null;const r=n.parentElement;r!==null&&r.removeChild(n)}function Qt(n){return nn?(n||window).getSelection():null}function ux(n){const e=of(n);return e?e.getSelection():null}function Xy(n){return Ne(n)&&n.tagName==="A"}function Ne(n){return ai(n)&&n.nodeType===Xk}function ai(n){return typeof n=="object"&&n!==null&&"nodeType"in n&&typeof n.nodeType=="number"}function Fu(n){return ai(n)&&n.nodeType===ew}function qu(n){const e=new RegExp(/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|mark|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var|#text)$/,"i");return n.nodeName.match(e)!==null}function ul(n){const e=new RegExp(/^(address|article|aside|blockquote|canvas|dd|div|dl|dt|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hr|li|main|nav|noscript|ol|p|pre|section|table|td|tfoot|ul|video)$/,"i");return n.nodeName.match(e)!==null}function Dt(n){if(ke(n)&&!n.isInline())return!0;if(!F(n)||wn(n))return!1;const e=n.getFirstChild(),t=e===null||Dr(e)||W(e)||e.isInline();return!n.isInline()&&n.canBeEmpty()!==!1&&t}function Qc(n,e){let t=n;for(;t!==null&&t.getParent()!==null&&!e(t);)t=t.getParentOrThrow();return e(t)?t:null}function Ul(){return Ie()}const Uh=new WeakMap,dx=new Map;function zh(n){if(!n._readOnly&&n.isEmpty())return dx;n._readOnly||J(192);let e=Uh.get(n);return e||(e=function(t){const r=new Map;for(const[i,s]of t._nodeMap){const o=s.__type;let a=r.get(o);a||(a=new Map,r.set(o,a)),a.set(i,s)}return r}(n),Uh.set(n,e)),e}function af(n){const e=n.constructor.clone(n);return e.afterCloneFrom(n),e}function fx(n,e){const t=parseInt(n.style.paddingInlineStart,10)||0,r=Math.round(t/40);e.setIndent(r)}function hx(n){n.__lexicalUnmanaged=!0}function px(n){return n.__lexicalUnmanaged===!0}function $s(n,e){return function(t,r){return Object.prototype.hasOwnProperty.call(t,r)}(n,e)&&n[e]!==ns[e]}function lf(n){const e=th in n.prototype?n.prototype[th]():void 0,t=function(o){return o===br||o===pt||o===ns}(n),r=!t&&$s(n,"getType")?n.getType():void 0;let i,s=r;if(e)if(r)i=e[r];else for(const[o,a]of Object.entries(e))s=o,i=a;if(!t&&s&&($s(n,"getType")||(n.getType=()=>s),$s(n,"clone")||(n.clone=o=>(Xd(o),new n)),$s(n,"importJSON")||(n.importJSON=i&&i.$importJSON||(o=>new n().updateFromJSON(o))),!$s(n,"importDOM")&&i)){const{importDOM:o}=i;o&&(n.importDOM=()=>o)}return{ownNodeConfig:i,ownNodeType:s}}const gx={next:"previous",previous:"next"};let cf=class{constructor(e){this.origin=e}[Symbol.iterator](){return zl({hasNext:Jr,initial:this.getAdjacentCaret(),map:e=>e,step:e=>e.getAdjacentCaret()})}getAdjacentCaret(){return Be(this.getNodeAtCaret(),this.direction)}getSiblingCaret(){return Be(this.origin,this.direction)}remove(){const e=this.getNodeAtCaret();return e&&e.remove(),this}replaceOrInsert(e,t){const r=this.getNodeAtCaret();return e.is(this.origin)||e.is(r)||(r===null?this.insert(e):r.replace(e,t)),this}splice(e,t,r="next"){const i=r===this.direction?t:Array.from(t).reverse();let s=this;const o=this.getParentAtCaret(),a=new Map;for(let l=s.getAdjacentCaret();l!==null&&a.size<e;l=l.getAdjacentCaret()){const c=l.origin.getWritable();a.set(c.getKey(),c)}for(const l of i){if(a.size>0){const c=s.getNodeAtCaret();if(c){if(a.delete(c.getKey()),a.delete(l.getKey()),!(c.is(l)||s.origin.is(l))){const u=l.getParent();u&&u.is(o)&&l.remove(),c.replace(l)}}else c===null&&J(263,Array.from(a).join(" "))}else s.insert(l);s=Be(l,this.direction)}for(const l of a.values())l.remove();return this}},Bu=class Qy extends cf{constructor(){super(...arguments);Rt(this,"type","child")}getLatest(){const t=this.origin.getLatest();return t===this.origin?this:Zt(t,this.direction)}getParentCaret(t="root"){return Be(uf(this.getParentAtCaret(),t),this.direction)}getFlipped(){const t=ss(this.direction);return Be(this.getNodeAtCaret(),t)||Zt(this.origin,t)}getParentAtCaret(){return this.origin}getChildCaret(){return this}isSameNodeCaret(t){return t instanceof Qy&&this.direction===t.direction&&this.origin.is(t.origin)}isSamePointCaret(t){return this.isSameNodeCaret(t)}};const mx={root:et,shadowRoot:wn};function ss(n){return gx[n]}function uf(n,e="root"){return mx[e](n)?null:n}let dl=class Uu extends cf{constructor(){super(...arguments);Rt(this,"type","sibling")}getLatest(){const t=this.origin.getLatest();return t===this.origin?this:Be(t,this.direction)}getSiblingCaret(){return this}getParentAtCaret(){return this.origin.getParent()}getChildCaret(){return F(this.origin)?Zt(this.origin,this.direction):null}getParentCaret(t="root"){return Be(uf(this.getParentAtCaret(),t),this.direction)}getFlipped(){const t=ss(this.direction);return Be(this.getNodeAtCaret(),t)||Zt(this.origin.getParentOrThrow(),t)}isSamePointCaret(t){return t instanceof Uu&&this.direction===t.direction&&this.origin.is(t.origin)}isSameNodeCaret(t){return(t instanceof Uu||t instanceof fl)&&this.direction===t.direction&&this.origin.is(t.origin)}},fl=class zu extends cf{constructor(t,r){super(t);Rt(this,"type","text");this.offset=r}getLatest(){const t=this.origin.getLatest();return t===this.origin?this:Vr(t,this.direction,this.offset)}getParentAtCaret(){return this.origin.getParent()}getChildCaret(){return null}getParentCaret(t="root"){return Be(uf(this.getParentAtCaret(),t),this.direction)}getFlipped(){return Vr(this.origin,ss(this.direction),this.offset)}isSamePointCaret(t){return t instanceof zu&&this.direction===t.direction&&this.origin.is(t.origin)&&this.offset===t.offset}isSameNodeCaret(t){return(t instanceof dl||t instanceof zu)&&this.direction===t.direction&&this.origin.is(t.origin)}getSiblingCaret(){return Be(this.origin,this.direction)}};function or(n){return n instanceof fl}function Jr(n){return n instanceof dl}function Gt(n){return n instanceof Bu}const yx={next:class extends fl{constructor(){super(...arguments);Rt(this,"direction","next")}getNodeAtCaret(){return this.origin.getNextSibling()}insert(e){return this.origin.insertAfter(e),this}},previous:class extends fl{constructor(){super(...arguments);Rt(this,"direction","previous")}getNodeAtCaret(){return this.origin.getPreviousSibling()}insert(e){return this.origin.insertBefore(e),this}}},_x={next:class extends dl{constructor(){super(...arguments);Rt(this,"direction","next")}getNodeAtCaret(){return this.origin.getNextSibling()}insert(e){return this.origin.insertAfter(e),this}},previous:class extends dl{constructor(){super(...arguments);Rt(this,"direction","previous")}getNodeAtCaret(){return this.origin.getPreviousSibling()}insert(e){return this.origin.insertBefore(e),this}}},bx={next:class extends Bu{constructor(){super(...arguments);Rt(this,"direction","next")}getNodeAtCaret(){return this.origin.getFirstChild()}insert(e){return this.origin.splice(0,0,[e]),this}},previous:class extends Bu{constructor(){super(...arguments);Rt(this,"direction","previous")}getNodeAtCaret(){return this.origin.getLastChild()}insert(e){return this.origin.splice(this.origin.getChildrenSize(),0,[e]),this}}};function Be(n,e){return n?new _x[e](n):null}function Vr(n,e,t){return n?new yx[e](n,ar(n,t)):null}function ar(n,e,t="error"){const r=n.getTextContentSize();let i=e==="next"?r:e==="previous"?0:e;return(i<0||i>r)&&(t!=="clamp"&&function(s,...o){const a=new URL("https://lexical.dev/docs/error"),l=new URLSearchParams;l.append("code",s);for(const c of o)l.append("v",c);a.search=l.toString(),console.warn(`Minified Lexical warning #${s}; visit ${a.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}(284,String(e),String(r),n.getKey()),i=i<0?0:r),i}function Wh(n,e){return new wx(n,e)}function Zt(n,e){return F(n)?new bx[e](n):null}function vx(n){return n&&n.getChildCaret()||n}function oo(n){return n&&vx(n.getAdjacentCaret())}let kx=class Zy{constructor(e,t,r){Rt(this,"type","node-caret-range");this.anchor=e,this.focus=t,this.direction=r}getLatest(){const e=this.anchor.getLatest(),t=this.focus.getLatest();return e===this.anchor&&t===this.focus?this:new Zy(e,t,this.direction)}isCollapsed(){return this.anchor.isSamePointCaret(this.focus)}getTextSlices(){const e=i=>{const s=this[i].getLatest();return or(s)?function(o,a){const{direction:l,origin:c}=o,u=ar(c,a==="focus"?ss(l):l);return Wh(o,u-o.offset)}(s,i):null},t=e("anchor"),r=e("focus");if(t&&r){const{caret:i}=t,{caret:s}=r;if(i.isSameNodeCaret(s))return[Wh(i,s.offset-i.offset),null]}return[t,r]}iterNodeCarets(e="root"){const t=or(this.anchor)?this.anchor.getSiblingCaret():this.anchor.getLatest(),r=this.focus.getLatest(),i=or(r),s=o=>o.isSameNodeCaret(r)?null:oo(o)||o.getParentCaret(e);return zl({hasNext:o=>o!==null&&!(i&&r.isSameNodeCaret(o)),initial:t.isSameNodeCaret(r)?null:s(t),map:o=>o,step:s})}[Symbol.iterator](){return this.iterNodeCarets("root")}},wx=class{constructor(e,t){Rt(this,"type","slice");this.caret=e,this.distance=t}getSliceIndices(){const{distance:e,caret:{offset:t}}=this,r=t+e;return r<t?[r,t]:[t,r]}getTextContent(){const[e,t]=this.getSliceIndices();return this.caret.origin.getTextContent().slice(e,t)}getTextContentSize(){return Math.abs(this.distance)}removeTextSlice(){const{caret:{origin:e,direction:t}}=this,[r,i]=this.getSliceIndices(),s=e.getTextContent();return Vr(e.setTextContent(s.slice(0,r)+s.slice(i)),t,r)}};function df(n){return dr(n,Be(ye(),n.direction))}function xx(n){return dr(n,n)}function dr(n,e){return n.direction!==e.direction&&J(265),new kx(n,e,n.direction)}function zl(n){const{initial:e,hasNext:t,step:r,map:i}=n;let s=e;return{[Symbol.iterator](){return this},next(){if(!t(s))return{done:!0,value:void 0};const o={done:!1,value:i(s)};return s=r(s),o}}}function e_(n,e){const t=Ys(n.origin,e.origin);switch(t===null&&J(275,n.origin.getKey(),e.origin.getKey()),t.type){case"same":{const r=n.type==="text",i=e.type==="text";return r&&i?function(s,o){return Math.sign(s-o)}(n.offset,e.offset):n.type===e.type?0:r?-1:i?1:n.type==="child"?-1:1}case"ancestor":return n.type==="child"?-1:1;case"descendant":return e.type==="child"?1:-1;case"branch":return t_(t)}}function t_(n){const{a:e,b:t}=n,r=e.__key,i=t.__key;let s=e,o=t;for(;s&&o;s=s.getNextSibling(),o=o.getNextSibling()){if(s.__key===i)return-1;if(o.__key===r)return 1}return s===null?1:-1}function la(n,e){return e.is(n)}function Kh(n){return F(n)?[n.getLatest(),null]:[n.getParent(),n.getLatest()]}function Ys(n,e){if(n.is(e))return{commonAncestor:n,type:"same"};const t=new Map;for(let[r,i]=Kh(n);r;i=r,r=r.getParent())t.set(r,i);for(let[r,i]=Kh(e);r;i=r,r=r.getParent()){const s=t.get(r);if(s!==void 0)return s===null?(la(n,r)||J(276),{commonAncestor:r,type:"ancestor"}):i===null?(la(e,r)||J(277),{commonAncestor:r,type:"descendant"}):((F(s)||la(n,s))&&(F(i)||la(e,i))&&r.is(s.getParent())&&r.is(i.getParent())||J(278),{a:s,b:i,commonAncestor:r,type:"branch"})}return null}function Un(n,e){const{type:t,key:r,offset:i}=n,s=cx(n.key);return t==="text"?(W(s)||J(266,s.getType(),r),Vr(s,e,i)):(F(s)||J(267,s.getType(),r),Tx(s,n.offset,e))}function ao(n,e){const{origin:t,direction:r}=e,i=r==="next";or(e)?n.set(t.getKey(),e.offset,"text"):Jr(e)?W(t)?n.set(t.getKey(),ar(t,r),"text"):n.set(t.getParentOrThrow().getKey(),t.getIndexWithinParent()+(i?1:0),"element"):(Gt(e)&&F(t)||J(268),n.set(t.getKey(),i?0:t.getChildrenSize(),"element"))}function Cx(n){const e=K(),t=q(e)?e:So();return Ba(t,n),it(t),t}function Ba(n,e){ao(n.anchor,e.anchor),ao(n.focus,e.focus)}function Hh(n){const{anchor:e,focus:t}=n,r=Un(e,"next"),i=Un(t,"next"),s=e_(r,i)<=0?"next":"previous";return dr(Ui(r,s),Ui(i,s))}function Wl(n){const{direction:e,origin:t}=n,r=Be(t,ss(e)).getNodeAtCaret();return r?Be(r,e):Zt(t.getParentOrThrow(),e)}function Jh(n,e="root"){const t=[n];for(let r=Gt(n)?n.getParentCaret(e):n.getSiblingCaret();r!==null;r=r.getParentCaret(e))t.push(Wl(r));return t}function Zc(n){return!!n&&n.origin.isAttached()}function Sx(n,e="removeEmptySlices"){if(n.isCollapsed())return n;const t="root",r="next";let i=e;const s=r_(n,r),o=Jh(s.anchor,t),a=Jh(s.focus.getFlipped(),t),l=new Set,c=[];for(const g of s.iterNodeCarets(t))if(Gt(g))l.add(g.origin.getKey());else if(Jr(g)){const{origin:m}=g;F(m)&&!l.has(m.getKey())||c.push(m)}for(const g of c)g.remove();for(const g of s.getTextSlices()){if(!g)continue;const{origin:m}=g.caret,y=m.getTextContentSize(),b=Wl(Be(m,r)),_=m.getMode();if(Math.abs(g.distance)===y&&i==="removeEmptySlices"||_==="token"&&g.distance!==0)b.remove();else if(g.distance!==0){i="removeEmptySlices";let w=g.removeTextSlice();const T=g.caret.origin;if(_==="segmented"){const O=w.origin,M=de(O.getTextContent()).setStyle(O.getStyle()).setFormat(O.getFormat());b.replaceOrInsert(M),w=Vr(M,r,w.offset)}T.is(o[0].origin)&&(o[0]=w),T.is(a[0].origin)&&(a[0]=w.getFlipped())}}let u,f;for(const g of o)if(Zc(g)){u=gn(g);break}for(const g of a)if(Zc(g)){f=gn(g);break}const d=function(g,m,y){if(!g||!m)return null;const b=g.getParentAtCaret(),_=m.getParentAtCaret();if(!b||!_)return null;const w=b.getParents().reverse();w.push(b);const T=_.getParents().reverse();T.push(_);const O=Math.min(w.length,T.length);let M;for(M=0;M<O&&w[M]===T[M];M++);const j=(B,C)=>{let N;for(let S=M;S<B.length;S++){const R=B[S];if(wn(R))return;!N&&C(R)&&(N=R)}return N},A=j(w,Dt),$=A&&j(T,B=>y.has(B.getKey())&&Dt(B));return A&&$?[A,$]:null}(u,f,l);if(d){const[g,m]=d;Zt(g,"previous").splice(0,m.getChildren()),m.remove()}const h=[u,f,...o,...a].find(Zc);if(h)return xx(Ui(gn(h),n.direction));J(269,JSON.stringify(o.map(g=>g.origin.__key)))}function gn(n){const e=function(i){let s=i;for(;Gt(s);){const o=oo(s);if(!Gt(o))break;s=o}return s}(n.getLatest()),{direction:t}=e;if(W(e.origin))return or(e)?e:Vr(e.origin,t,t);const r=e.getAdjacentCaret();return Jr(r)&&W(r.origin)?Vr(r.origin,t,ss(t)):e}function n_(n){return or(n)&&n.offset!==ar(n.origin,n.direction)}function Ui(n,e){return n.direction===e?n:n.getFlipped()}function r_(n,e){return n.direction===e?n:dr(Ui(n.focus,e),Ui(n.anchor,e))}function Tx(n,e,t){let r=Zt(n,"next");for(let i=0;i<e;i++){const s=r.getAdjacentCaret();if(s===null)break;r=s}return Ui(r,t)}const Ex=new Map;function Vh(n){let e=n;for(;e!=null;){if(e.nodeType===Node.TEXT_NODE)return e;e=e.firstChild}return null}function Gh(n){const e=n.parentNode;if(e==null)throw new Error("Should never happen");return[e,Array.from(e.childNodes).indexOf(n)]}function Nx(n,e,t,r,i){const s=e.getKey(),o=r.getKey(),a=document.createRange();let l=n.getElementByKey(s),c=n.getElementByKey(o),u=t,f=i;if(W(e)&&(l=Vh(l)),W(r)&&(c=Vh(c)),e===void 0||r===void 0||l===null||c===null)return null;l.nodeName==="BR"&&([l,u]=Gh(l)),c.nodeName==="BR"&&([c,f]=Gh(c));const d=l.firstChild;l===c&&d!=null&&d.nodeName==="BR"&&u===0&&f===0&&(f=1);try{a.setStart(l,u),a.setEnd(c,f)}catch{return null}return!a.collapsed||u===f&&s===o||(a.setStart(c,f),a.setEnd(l,u)),a}function Mx(n,e){const t=n.getRootElement();if(t===null)return[];const r=t.getBoundingClientRect(),i=getComputedStyle(t),s=parseFloat(i.paddingLeft)+parseFloat(i.paddingRight),o=Array.from(e.getClientRects());let a,l=o.length;o.sort((c,u)=>{const f=c.top-u.top;return Math.abs(f)<=3?c.left-u.left:f});for(let c=0;c<l;c++){const u=o[c],f=a&&a.top<=u.top&&a.top+a.height>u.top&&a.left+a.width>u.left,d=u.width+s===r.width;f||d?(o.splice(c--,1),l--):a=u}return o}function Ax(n){const e={};if(!n)return e;const t=n.split(";");for(const r of t)if(r!==""){const[i,s]=r.split(/:([^]+)/);i&&s&&(e[i.trim()]=s.trim())}return e}function i_(n,e){const t=n.getStartEndPoints();if(e.isSelected(n)&&!In(e)&&t!==null){const[r,i]=t,s=n.isBackward(),o=r.getNode(),a=i.getNode(),l=e.is(o),c=e.is(a);if(l||c){const[u,f]=$u(n),d=o.is(a),h=e.is(s?a:o),g=e.is(s?o:a);let m,y=0;d?(y=u>f?f:u,m=u>f?u:f):h?(y=s?f:u,m=void 0):g&&(y=0,m=s?u:f),e.__text=e.__text.slice(y,m)}}return e}function Ox(n){const e=n.getStyle(),t=Ax(e);Ex.set(e,t)}function $x(n,e){const t=n.getFormatType(),r=n.getIndent();t!==e.getFormatType()&&e.setFormat(t),r!==e.getIndent()&&e.setIndent(r)}function Ix(n,e,t=$x){if(n===null)return;const r=n.getStartEndPoints(),i=new Map;let s=null;if(r){const[o,a]=r;s=So(),s.anchor.set(o.key,o.offset,o.type),s.focus.set(a.key,a.offset,a.type);const l=eu(o.getNode(),Dt),c=eu(a.getNode(),Dt);F(l)&&i.set(l.getKey(),l),F(c)&&i.set(c.getKey(),c)}for(const o of n.getNodes())if(F(o)&&Dt(o))i.set(o.getKey(),o);else if(r===null){const a=eu(o,Dt);F(a)&&i.set(a.getKey(),a)}for(const[o,a]of i){const l=e();t(a,l),a.replace(l,!0),s&&(o===s.anchor.key&&s.anchor.set(l.getKey(),s.anchor.offset,s.anchor.type),o===s.focus.key&&s.focus.set(l.getKey(),s.focus.offset,s.focus.type))}s&&n.is(K())&&it(s)}function s_(n){const e=n.anchor.getNode(),t=et(e)?e:e.getParentOrThrow(),r=Ul().getElementByKey(t.getKey());if(r===null)return!1;const i=r.ownerDocument.defaultView;return i===null?!1:i.getComputedStyle(r).writingMode==="vertical-rl"}function hl(n,e){let t=s_(n)?!e:e;o_(n)&&(t=!t);const r=Un(n.focus,t?"previous":"next");if(n_(r))return!1;for(const i of df(r)){if(Gt(i))return!i.origin.isInline();if(!F(i.origin)){if(ke(i.origin))return!0;break}}return!1}function Px(n,e,t,r){n.modify(e?"extend":"move",t,r)}function o_(n){const e=n.anchor.getNode();return(et(e)?e:e.getParentOrThrow()).getDirection()==="rtl"}function pl(n,e,t){const r=o_(n);let i;i=s_(n)||r?!t:t,Px(n,e,i,"character")}function eu(n,e){let t=n;for(;t!==null&&t.getParent()!==null&&!e(t);)t=t.getParentOrThrow();return e(t)?t:null}function Rx(n,...e){const t=new URL("https://lexical.dev/docs/error"),r=new URLSearchParams;r.append("code",n);for(const i of e)r.append("v",i);throw t.search=r.toString(),Error(`Minified Lexical error #${n}; visit ${t.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}const No=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,jx=No&&"documentMode"in document?document.documentMode:null,Dx=No&&/Mac|iPod|iPhone|iPad/.test(navigator.platform),Lx=No&&/^(?!.*Seamonkey)(?=.*Firefox).*/i.test(navigator.userAgent);!(!No||!("InputEvent"in window)||jx)&&"getTargetRanges"in new window.InputEvent("input");function a_(...n){const e=[];for(const t of n)if(t&&typeof t=="string")for(const[r]of t.matchAll(/\S+/g))e.push(r);return e}function Ue(...n){return()=>{for(let e=n.length-1;e>=0;e--)n[e]();n.length=0}}const Fx=No,Wu=Dx,qx=Lx;function ct(n,...e){const t=a_(...e);t.length>0&&n.classList.add(...t)}function Br(n,...e){const t=a_(...e);t.length>0&&n.classList.remove(...t)}function Mo(n,e){return Array.from(Bx(n))}function Bx(n,e){return Ux("next",n)}function Ux(n,e,t){const r=ye(),i=e||r,s=F(i)?Zt(i,n):Be(i,n),o=zx(i),a=function(c,u){const f=Xh(Be(c,u));return f&&f[0]}(i,n);let l=o;return zl({hasNext:c=>c!==null,initial:s,map:c=>({depth:l,node:c.origin}),step:c=>{if(c.isSameNodeCaret(a))return null;Gt(c)&&l++;const u=Xh(c);return!u||u[0].isSameNodeCaret(a)?null:(l+=u[1],u[0])}})}function zx(n){let e=-1;for(let t=n;t!==null;t=t.getParent())e++;return e}function Wx(n){const e=en(n,t=>F(t)&&!t.isInline());return F(e)||Rx(4,n.__key),e}const en=(n,e)=>{let t=n;for(;t!==ye()&&t!=null;){if(e(t))return t;t=t.getParent()}return null};function l_(n,e,t,r){const i=s=>s instanceof e;return n.registerNodeTransform(e,s=>{const o=(a=>{const l=a.getChildren();for(let f=0;f<l.length;f++){const d=l[f];if(i(d))return null}let c=a,u=a;for(;c!==null;)if(u=c,c=c.getParent(),i(c))return{child:u,parent:c};return null})(s);if(o!==null){const{child:a,parent:l}=o;if(a.is(s)){r(l,s);const c=a.getNextSiblings(),u=c.length;if(l.insertAfter(a),u!==0){const f=t(l);a.insertAfter(f);for(let d=0;d<u;d++)f.append(c[d])}l.canBeEmpty()||l.getChildrenSize()!==0||l.remove()}}})}function Fn(n,e){return n!==null&&Object.getPrototypeOf(n).constructor.name===e.name}let tu=!(qx||!Fx)&&void 0;function Kx(n){let e=1;if(function(){if(tu===void 0){const t=document.createElement("div");t.style.cssText="position: absolute; opacity: 0; width: 100px; left: -1000px;",document.body.appendChild(t);const r=t.getBoundingClientRect();t.style.setProperty("zoom","2"),tu=t.getBoundingClientRect().width===r.width,document.body.removeChild(t)}return tu}())for(;n;)e*=Number(window.getComputedStyle(n).getPropertyValue("zoom")),n=n.parentElement;return e}function c_(n,e){const t=[],r=Array.from(n).reverse();for(let i=r.pop();i!==void 0;i=r.pop())if(e(i))t.push(i);else if(F(i))for(const s of Hx(i))r.push(s);return t}function Hx(n){return Jx(Zt(n,"previous"))}function Jx(n){return zl({hasNext:Jr,initial:n.getAdjacentCaret(),map:e=>e.origin.getLatest(),step:e=>e.getAdjacentCaret()})}function Yh(n){Wl(Be(n,"next")).splice(1,n.getChildren())}function Xh(n,e="root"){let t=0,r=n,i=oo(r);for(;i===null;){if(t--,i=r.getParentCaret(e),!i)return null;r=i,i=oo(r)}return i&&[i,t]}var ca={exports:{}},nu,Qh;function Vx(){if(Qh)return nu;Qh=1;var n=-1,e=1,t=0;function r(C,N,S,R,L){if(C===N)return C?[[t,C]]:[];if(S!=null){var D=$(C,N,S);if(D)return D}var z=a(C,N),H=C.substring(0,z);C=C.substring(z),N=N.substring(z),z=c(C,N);var V=C.substring(C.length-z);C=C.substring(0,C.length-z),N=N.substring(0,N.length-z);var G=i(C,N);return H&&G.unshift([t,H]),V&&G.push([t,V]),_(G,L),R&&f(G),G}function i(C,N){var S;if(!C)return[[e,N]];if(!N)return[[n,C]];var R=C.length>N.length?C:N,L=C.length>N.length?N:C,D=R.indexOf(L);if(D!==-1)return S=[[e,R.substring(0,D)],[t,L],[e,R.substring(D+L.length)]],C.length>N.length&&(S[0][0]=S[2][0]=n),S;if(L.length===1)return[[n,C],[e,N]];var z=u(C,N);if(z){var H=z[0],V=z[1],G=z[2],ee=z[3],Q=z[4],re=r(H,G),oe=r(V,ee);return re.concat([[t,Q]],oe)}return s(C,N)}function s(C,N){for(var S=C.length,R=N.length,L=Math.ceil((S+R)/2),D=L,z=2*L,H=new Array(z),V=new Array(z),G=0;G<z;G++)H[G]=-1,V[G]=-1;H[D+1]=0,V[D+1]=0;for(var ee=S-R,Q=ee%2!==0,re=0,oe=0,X=0,fe=0,ve=0;ve<L;ve++){for(var se=-ve+re;se<=ve-oe;se+=2){var ue=D+se,he;se===-ve||se!==ve&&H[ue-1]<H[ue+1]?he=H[ue+1]:he=H[ue-1]+1;for(var we=he-se;he<S&&we<R&&C.charAt(he)===N.charAt(we);)he++,we++;if(H[ue]=he,he>S)oe+=2;else if(we>R)re+=2;else if(Q){var Ce=D+ee-se;if(Ce>=0&&Ce<z&&V[Ce]!==-1){var Ee=S-V[Ce];if(he>=Ee)return o(C,N,he,we)}}}for(var je=-ve+X;je<=ve-fe;je+=2){var Ce=D+je,Ee;je===-ve||je!==ve&&V[Ce-1]<V[Ce+1]?Ee=V[Ce+1]:Ee=V[Ce-1]+1;for(var st=Ee-je;Ee<S&&st<R&&C.charAt(S-Ee-1)===N.charAt(R-st-1);)Ee++,st++;if(V[Ce]=Ee,Ee>S)fe+=2;else if(st>R)X+=2;else if(!Q){var ue=D+ee-je;if(ue>=0&&ue<z&&H[ue]!==-1){var he=H[ue],we=D+he-ue;if(Ee=S-Ee,he>=Ee)return o(C,N,he,we)}}}}return[[n,C],[e,N]]}function o(C,N,S,R){var L=C.substring(0,S),D=N.substring(0,R),z=C.substring(S),H=N.substring(R),V=r(L,D),G=r(z,H);return V.concat(G)}function a(C,N){if(!C||!N||C.charAt(0)!==N.charAt(0))return 0;for(var S=0,R=Math.min(C.length,N.length),L=R,D=0;S<L;)C.substring(D,L)==N.substring(D,L)?(S=L,D=S):R=L,L=Math.floor((R-S)/2+S);return w(C.charCodeAt(L-1))&&L--,L}function l(C,N){var S=C.length,R=N.length;if(S==0||R==0)return 0;S>R?C=C.substring(S-R):S<R&&(N=N.substring(0,S));var L=Math.min(S,R);if(C==N)return L;for(var D=0,z=1;;){var H=C.substring(L-z),V=N.indexOf(H);if(V==-1)return D;z+=V,(V==0||C.substring(L-z)==N.substring(0,z))&&(D=z,z++)}}function c(C,N){if(!C||!N||C.slice(-1)!==N.slice(-1))return 0;for(var S=0,R=Math.min(C.length,N.length),L=R,D=0;S<L;)C.substring(C.length-L,C.length-D)==N.substring(N.length-L,N.length-D)?(S=L,D=S):R=L,L=Math.floor((R-S)/2+S);return T(C.charCodeAt(C.length-L))&&L--,L}function u(C,N){var S=C.length>N.length?C:N,R=C.length>N.length?N:C;if(S.length<4||R.length*2<S.length)return null;function L(oe,X,fe){for(var ve=oe.substring(fe,fe+Math.floor(oe.length/4)),se=-1,ue="",he,we,Ce,Ee;(se=X.indexOf(ve,se+1))!==-1;){var je=a(oe.substring(fe),X.substring(se)),st=c(oe.substring(0,fe),X.substring(0,se));ue.length<st+je&&(ue=X.substring(se-st,se)+X.substring(se,se+je),he=oe.substring(0,fe-st),we=oe.substring(fe+je),Ce=X.substring(0,se-st),Ee=X.substring(se+je))}return ue.length*2>=oe.length?[he,we,Ce,Ee,ue]:null}var D=L(S,R,Math.ceil(S.length/4)),z=L(S,R,Math.ceil(S.length/2)),H;if(!D&&!z)return null;z?D?H=D[4].length>z[4].length?D:z:H=z:H=D;var V,G,ee,Q;C.length>N.length?(V=H[0],G=H[1],ee=H[2],Q=H[3]):(ee=H[0],Q=H[1],V=H[2],G=H[3]);var re=H[4];return[V,G,ee,Q,re]}function f(C){for(var N=!1,S=[],R=0,L=null,D=0,z=0,H=0,V=0,G=0;D<C.length;)C[D][0]==t?(S[R++]=D,z=V,H=G,V=0,G=0,L=C[D][1]):(C[D][0]==e?V+=C[D][1].length:G+=C[D][1].length,L&&L.length<=Math.max(z,H)&&L.length<=Math.max(V,G)&&(C.splice(S[R-1],0,[n,L]),C[S[R-1]+1][0]=e,R--,R--,D=R>0?S[R-1]:-1,z=0,H=0,V=0,G=0,L=null,N=!0)),D++;for(N&&_(C),b(C),D=1;D<C.length;){if(C[D-1][0]==n&&C[D][0]==e){var ee=C[D-1][1],Q=C[D][1],re=l(ee,Q),oe=l(Q,ee);re>=oe?(re>=ee.length/2||re>=Q.length/2)&&(C.splice(D,0,[t,Q.substring(0,re)]),C[D-1][1]=ee.substring(0,ee.length-re),C[D+1][1]=Q.substring(re),D++):(oe>=ee.length/2||oe>=Q.length/2)&&(C.splice(D,0,[t,ee.substring(0,oe)]),C[D-1][0]=e,C[D-1][1]=Q.substring(0,Q.length-oe),C[D+1][0]=n,C[D+1][1]=ee.substring(oe),D++),D++}D++}}var d=/[^a-zA-Z0-9]/,h=/\s/,g=/[\r\n]/,m=/\n\r?\n$/,y=/^\r?\n\r?\n/;function b(C){function N(oe,X){if(!oe||!X)return 6;var fe=oe.charAt(oe.length-1),ve=X.charAt(0),se=fe.match(d),ue=ve.match(d),he=se&&fe.match(h),we=ue&&ve.match(h),Ce=he&&fe.match(g),Ee=we&&ve.match(g),je=Ce&&oe.match(m),st=Ee&&X.match(y);return je||st?5:Ce||Ee?4:se&&!he&&we?3:he||we?2:se||ue?1:0}for(var S=1;S<C.length-1;){if(C[S-1][0]==t&&C[S+1][0]==t){var R=C[S-1][1],L=C[S][1],D=C[S+1][1],z=c(R,L);if(z){var H=L.substring(L.length-z);R=R.substring(0,R.length-z),L=H+L.substring(0,L.length-z),D=H+D}for(var V=R,G=L,ee=D,Q=N(R,L)+N(L,D);L.charAt(0)===D.charAt(0);){R+=L.charAt(0),L=L.substring(1)+D.charAt(0),D=D.substring(1);var re=N(R,L)+N(L,D);re>=Q&&(Q=re,V=R,G=L,ee=D)}C[S-1][1]!=V&&(V?C[S-1][1]=V:(C.splice(S-1,1),S--),C[S][1]=G,ee?C[S+1][1]=ee:(C.splice(S+1,1),S--))}S++}}function _(C,N){C.push([t,""]);for(var S=0,R=0,L=0,D="",z="",H;S<C.length;){if(S<C.length-1&&!C[S][1]){C.splice(S,1);continue}switch(C[S][0]){case e:L++,z+=C[S][1],S++;break;case n:R++,D+=C[S][1],S++;break;case t:var V=S-L-R-1;if(N){if(V>=0&&M(C[V][1])){var G=C[V][1].slice(-1);if(C[V][1]=C[V][1].slice(0,-1),D=G+D,z=G+z,!C[V][1]){C.splice(V,1),S--;var ee=V-1;C[ee]&&C[ee][0]===e&&(L++,z=C[ee][1]+z,ee--),C[ee]&&C[ee][0]===n&&(R++,D=C[ee][1]+D,ee--),V=ee}}if(O(C[S][1])){var G=C[S][1].charAt(0);C[S][1]=C[S][1].slice(1),D+=G,z+=G}}if(S<C.length-1&&!C[S][1]){C.splice(S,1);break}if(D.length>0||z.length>0){D.length>0&&z.length>0&&(H=a(z,D),H!==0&&(V>=0?C[V][1]+=z.substring(0,H):(C.splice(0,0,[t,z.substring(0,H)]),S++),z=z.substring(H),D=D.substring(H)),H=c(z,D),H!==0&&(C[S][1]=z.substring(z.length-H)+C[S][1],z=z.substring(0,z.length-H),D=D.substring(0,D.length-H)));var Q=L+R;D.length===0&&z.length===0?(C.splice(S-Q,Q),S=S-Q):D.length===0?(C.splice(S-Q,Q,[e,z]),S=S-Q+1):z.length===0?(C.splice(S-Q,Q,[n,D]),S=S-Q+1):(C.splice(S-Q,Q,[n,D],[e,z]),S=S-Q+2)}S!==0&&C[S-1][0]===t?(C[S-1][1]+=C[S][1],C.splice(S,1)):S++,L=0,R=0,D="",z="";break}}C[C.length-1][1]===""&&C.pop();var re=!1;for(S=1;S<C.length-1;)C[S-1][0]===t&&C[S+1][0]===t&&(C[S][1].substring(C[S][1].length-C[S-1][1].length)===C[S-1][1]?(C[S][1]=C[S-1][1]+C[S][1].substring(0,C[S][1].length-C[S-1][1].length),C[S+1][1]=C[S-1][1]+C[S+1][1],C.splice(S-1,1),re=!0):C[S][1].substring(0,C[S+1][1].length)==C[S+1][1]&&(C[S-1][1]+=C[S+1][1],C[S][1]=C[S][1].substring(C[S+1][1].length)+C[S+1][1],C.splice(S+1,1),re=!0)),S++;re&&_(C,N)}function w(C){return C>=55296&&C<=56319}function T(C){return C>=56320&&C<=57343}function O(C){return T(C.charCodeAt(0))}function M(C){return w(C.charCodeAt(C.length-1))}function j(C){for(var N=[],S=0;S<C.length;S++)C[S][1].length>0&&N.push(C[S]);return N}function A(C,N,S,R){return M(C)||O(R)?null:j([[t,C],[n,N],[e,S],[t,R]])}function $(C,N,S){var R=typeof S=="number"?{index:S,length:0}:S.oldRange,L=typeof S=="number"?null:S.newRange,D=C.length,z=N.length;if(R.length===0&&(L===null||L.length===0)){var H=R.index,V=C.slice(0,H),G=C.slice(H),ee=L?L.index:null;e:{var Q=H+z-D;if(ee!==null&&ee!==Q||Q<0||Q>z)break e;var re=N.slice(0,Q),oe=N.slice(Q);if(oe!==G)break e;var X=Math.min(H,Q),fe=V.slice(0,X),ve=re.slice(0,X);if(fe!==ve)break e;var se=V.slice(X),ue=re.slice(X);return A(fe,se,ue,G)}e:{if(ee!==null&&ee!==H)break e;var he=H,re=N.slice(0,he),oe=N.slice(he);if(re!==V)break e;var we=Math.min(D-he,z-he),Ce=G.slice(G.length-we),Ee=oe.slice(oe.length-we);if(Ce!==Ee)break e;var se=G.slice(0,G.length-we),ue=oe.slice(0,oe.length-we);return A(V,se,ue,Ce)}}if(R.length>0&&L&&L.length===0)e:{var fe=C.slice(0,R.index),Ce=C.slice(R.index+R.length),X=fe.length,we=Ce.length;if(z<X+we)break e;var ve=N.slice(0,X),Ee=N.slice(z-we);if(fe!==ve||Ce!==Ee)break e;var se=C.slice(X,D-we),ue=N.slice(X,z-we);return A(fe,se,ue,Ce)}return null}function B(C,N,S,R){return r(C,N,S,R,!0)}return B.INSERT=e,B.DELETE=n,B.EQUAL=t,nu=B,nu}var Fs={exports:{}};Fs.exports;var Zh;function u_(){return Zh||(Zh=1,function(n,e){var t=200,r="__lodash_hash_undefined__",i=9007199254740991,s="[object Arguments]",o="[object Array]",a="[object Boolean]",l="[object Date]",c="[object Error]",u="[object Function]",f="[object GeneratorFunction]",d="[object Map]",h="[object Number]",g="[object Object]",m="[object Promise]",y="[object RegExp]",b="[object Set]",_="[object String]",w="[object Symbol]",T="[object WeakMap]",O="[object ArrayBuffer]",M="[object DataView]",j="[object Float32Array]",A="[object Float64Array]",$="[object Int8Array]",B="[object Int16Array]",C="[object Int32Array]",N="[object Uint8Array]",S="[object Uint8ClampedArray]",R="[object Uint16Array]",L="[object Uint32Array]",D=/[\\^$.*+?()[\]{}|]/g,z=/\w*$/,H=/^\[object .+?Constructor\]$/,V=/^(?:0|[1-9]\d*)$/,G={};G[s]=G[o]=G[O]=G[M]=G[a]=G[l]=G[j]=G[A]=G[$]=G[B]=G[C]=G[d]=G[h]=G[g]=G[y]=G[b]=G[_]=G[w]=G[N]=G[S]=G[R]=G[L]=!0,G[c]=G[u]=G[T]=!1;var ee=typeof er=="object"&&er&&er.Object===Object&&er,Q=typeof self=="object"&&self&&self.Object===Object&&self,re=ee||Q||Function("return this")(),oe=e&&!e.nodeType&&e,X=oe&&!0&&n&&!n.nodeType&&n,fe=X&&X.exports===oe;function ve(p,k){return p.set(k[0],k[1]),p}function se(p,k){return p.add(k),p}function ue(p,k){for(var E=-1,U=p?p.length:0;++E<U&&k(p[E],E,p)!==!1;);return p}function he(p,k){for(var E=-1,U=k.length,le=p.length;++E<U;)p[le+E]=k[E];return p}function we(p,k,E,U){for(var le=-1,te=p?p.length:0;++le<te;)E=k(E,p[le],le,p);return E}function Ce(p,k){for(var E=-1,U=Array(p);++E<p;)U[E]=k(E);return U}function Ee(p,k){return p==null?void 0:p[k]}function je(p){var k=!1;if(p!=null&&typeof p.toString!="function")try{k=!!(p+"")}catch{}return k}function st(p){var k=-1,E=Array(p.size);return p.forEach(function(U,le){E[++k]=[le,U]}),E}function gs(p,k){return function(E){return p(k(E))}}function Lo(p){var k=-1,E=Array(p.size);return p.forEach(function(U){E[++k]=U}),E}var Ql=Array.prototype,Zl=Function.prototype,fi=Object.prototype,ms=re["__core-js_shared__"],Fo=function(){var p=/[^.]+$/.exec(ms&&ms.keys&&ms.keys.IE_PROTO||"");return p?"Symbol(src)_1."+p:""}(),qo=Zl.toString,sn=fi.hasOwnProperty,hi=fi.toString,ec=RegExp("^"+qo.call(sn).replace(D,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Tr=fe?re.Buffer:void 0,pi=re.Symbol,ys=re.Uint8Array,Pt=gs(Object.getPrototypeOf,Object),Bo=Object.create,Uo=fi.propertyIsEnumerable,tc=Ql.splice,_s=Object.getOwnPropertySymbols,gi=Tr?Tr.isBuffer:void 0,zo=gs(Object.keys,Object),mi=Wt(re,"DataView"),Er=Wt(re,"Map"),zt=Wt(re,"Promise"),yi=Wt(re,"Set"),bs=Wt(re,"WeakMap"),Nr=Wt(Object,"create"),vs=gt(mi),Mr=gt(Er),ks=gt(zt),ws=gt(yi),xs=gt(bs),Yn=pi?pi.prototype:void 0,Wo=Yn?Yn.valueOf:void 0;function Cn(p){var k=-1,E=p?p.length:0;for(this.clear();++k<E;){var U=p[k];this.set(U[0],U[1])}}function nc(){this.__data__=Nr?Nr(null):{}}function rc(p){return this.has(p)&&delete this.__data__[p]}function ic(p){var k=this.__data__;if(Nr){var E=k[p];return E===r?void 0:E}return sn.call(k,p)?k[p]:void 0}function Ko(p){var k=this.__data__;return Nr?k[p]!==void 0:sn.call(k,p)}function Cs(p,k){var E=this.__data__;return E[p]=Nr&&k===void 0?r:k,this}Cn.prototype.clear=nc,Cn.prototype.delete=rc,Cn.prototype.get=ic,Cn.prototype.has=Ko,Cn.prototype.set=Cs;function Ye(p){var k=-1,E=p?p.length:0;for(this.clear();++k<E;){var U=p[k];this.set(U[0],U[1])}}function sc(){this.__data__=[]}function oc(p){var k=this.__data__,E=bi(k,p);if(E<0)return!1;var U=k.length-1;return E==U?k.pop():tc.call(k,E,1),!0}function ac(p){var k=this.__data__,E=bi(k,p);return E<0?void 0:k[E][1]}function lc(p){return bi(this.__data__,p)>-1}function cc(p,k){var E=this.__data__,U=bi(E,p);return U<0?E.push([p,k]):E[U][1]=k,this}Ye.prototype.clear=sc,Ye.prototype.delete=oc,Ye.prototype.get=ac,Ye.prototype.has=lc,Ye.prototype.set=cc;function ot(p){var k=-1,E=p?p.length:0;for(this.clear();++k<E;){var U=p[k];this.set(U[0],U[1])}}function uc(){this.__data__={hash:new Cn,map:new(Er||Ye),string:new Cn}}function dc(p){return Or(this,p).delete(p)}function fc(p){return Or(this,p).get(p)}function hc(p){return Or(this,p).has(p)}function pc(p,k){return Or(this,p).set(p,k),this}ot.prototype.clear=uc,ot.prototype.delete=dc,ot.prototype.get=fc,ot.prototype.has=hc,ot.prototype.set=pc;function kt(p){this.__data__=new Ye(p)}function gc(){this.__data__=new Ye}function mc(p){return this.__data__.delete(p)}function yc(p){return this.__data__.get(p)}function _c(p){return this.__data__.has(p)}function bc(p,k){var E=this.__data__;if(E instanceof Ye){var U=E.__data__;if(!Er||U.length<t-1)return U.push([p,k]),this;E=this.__data__=new ot(U)}return E.set(p,k),this}kt.prototype.clear=gc,kt.prototype.delete=mc,kt.prototype.get=yc,kt.prototype.has=_c,kt.prototype.set=bc;function _i(p,k){var E=Ns(p)||ki(p)?Ce(p.length,String):[],U=E.length,le=!!U;for(var te in p)sn.call(p,te)&&!(le&&(te=="length"||Ic(te,U)))&&E.push(te);return E}function Ho(p,k,E){var U=p[k];(!(sn.call(p,k)&&Xo(U,E))||E===void 0&&!(k in p))&&(p[k]=E)}function bi(p,k){for(var E=p.length;E--;)if(Xo(p[E][0],k))return E;return-1}function on(p,k){return p&&Es(k,As(k),p)}function Ss(p,k,E,U,le,te,be){var _e;if(U&&(_e=te?U(p,le,te,be):U(p)),_e!==void 0)return _e;if(!ln(p))return p;var De=Ns(p);if(De){if(_e=Oc(p),!k)return Nc(p,_e)}else{var xe=Tn(p),at=xe==u||xe==f;if(Qo(p))return vi(p,k);if(xe==g||xe==s||at&&!te){if(je(p))return te?p:{};if(_e=an(at?{}:p),!k)return Mc(p,on(_e,p))}else{if(!G[xe])return te?p:{};_e=$c(p,xe,Ss,k)}}be||(be=new kt);var wt=be.get(p);if(wt)return wt;if(be.set(p,_e),!De)var Le=E?Ac(p):As(p);return ue(Le||p,function(lt,Xe){Le&&(Xe=lt,lt=p[Xe]),Ho(_e,Xe,Ss(lt,k,E,U,Xe,p,be))}),_e}function vc(p){return ln(p)?Bo(p):{}}function kc(p,k,E){var U=k(p);return Ns(p)?U:he(U,E(p))}function wc(p){return hi.call(p)}function xc(p){if(!ln(p)||Rc(p))return!1;var k=Ms(p)||je(p)?ec:H;return k.test(gt(p))}function Cc(p){if(!Go(p))return zo(p);var k=[];for(var E in Object(p))sn.call(p,E)&&E!="constructor"&&k.push(E);return k}function vi(p,k){if(k)return p.slice();var E=new p.constructor(p.length);return p.copy(E),E}function Ts(p){var k=new p.constructor(p.byteLength);return new ys(k).set(new ys(p)),k}function Ar(p,k){var E=k?Ts(p.buffer):p.buffer;return new p.constructor(E,p.byteOffset,p.byteLength)}function Jo(p,k,E){var U=k?E(st(p),!0):st(p);return we(U,ve,new p.constructor)}function Vo(p){var k=new p.constructor(p.source,z.exec(p));return k.lastIndex=p.lastIndex,k}function Sc(p,k,E){var U=k?E(Lo(p),!0):Lo(p);return we(U,se,new p.constructor)}function Tc(p){return Wo?Object(Wo.call(p)):{}}function Ec(p,k){var E=k?Ts(p.buffer):p.buffer;return new p.constructor(E,p.byteOffset,p.length)}function Nc(p,k){var E=-1,U=p.length;for(k||(k=Array(U));++E<U;)k[E]=p[E];return k}function Es(p,k,E,U){E||(E={});for(var le=-1,te=k.length;++le<te;){var be=k[le],_e=void 0;Ho(E,be,_e===void 0?p[be]:_e)}return E}function Mc(p,k){return Es(p,Sn(p),k)}function Ac(p){return kc(p,As,Sn)}function Or(p,k){var E=p.__data__;return Pc(k)?E[typeof k=="string"?"string":"hash"]:E.map}function Wt(p,k){var E=Ee(p,k);return xc(E)?E:void 0}var Sn=_s?gs(_s,Object):Dc,Tn=wc;(mi&&Tn(new mi(new ArrayBuffer(1)))!=M||Er&&Tn(new Er)!=d||zt&&Tn(zt.resolve())!=m||yi&&Tn(new yi)!=b||bs&&Tn(new bs)!=T)&&(Tn=function(p){var k=hi.call(p),E=k==g?p.constructor:void 0,U=E?gt(E):void 0;if(U)switch(U){case vs:return M;case Mr:return d;case ks:return m;case ws:return b;case xs:return T}return k});function Oc(p){var k=p.length,E=p.constructor(k);return k&&typeof p[0]=="string"&&sn.call(p,"index")&&(E.index=p.index,E.input=p.input),E}function an(p){return typeof p.constructor=="function"&&!Go(p)?vc(Pt(p)):{}}function $c(p,k,E,U){var le=p.constructor;switch(k){case O:return Ts(p);case a:case l:return new le(+p);case M:return Ar(p,U);case j:case A:case $:case B:case C:case N:case S:case R:case L:return Ec(p,U);case d:return Jo(p,U,E);case h:case _:return new le(p);case y:return Vo(p);case b:return Sc(p,U,E);case w:return Tc(p)}}function Ic(p,k){return k=k??i,!!k&&(typeof p=="number"||V.test(p))&&p>-1&&p%1==0&&p<k}function Pc(p){var k=typeof p;return k=="string"||k=="number"||k=="symbol"||k=="boolean"?p!=="__proto__":p===null}function Rc(p){return!!Fo&&Fo in p}function Go(p){var k=p&&p.constructor,E=typeof k=="function"&&k.prototype||fi;return p===E}function gt(p){if(p!=null){try{return qo.call(p)}catch{}try{return p+""}catch{}}return""}function Yo(p){return Ss(p,!0,!0)}function Xo(p,k){return p===k||p!==p&&k!==k}function ki(p){return jc(p)&&sn.call(p,"callee")&&(!Uo.call(p,"callee")||hi.call(p)==s)}var Ns=Array.isArray;function wi(p){return p!=null&&Zo(p.length)&&!Ms(p)}function jc(p){return ea(p)&&wi(p)}var Qo=gi||Lc;function Ms(p){var k=ln(p)?hi.call(p):"";return k==u||k==f}function Zo(p){return typeof p=="number"&&p>-1&&p%1==0&&p<=i}function ln(p){var k=typeof p;return!!p&&(k=="object"||k=="function")}function ea(p){return!!p&&typeof p=="object"}function As(p){return wi(p)?_i(p):Cc(p)}function Dc(){return[]}function Lc(){return!1}n.exports=Yo}(Fs,Fs.exports)),Fs.exports}var qs={exports:{}};qs.exports;var ep;function d_(){return ep||(ep=1,function(n,e){var t=200,r="__lodash_hash_undefined__",i=1,s=2,o=9007199254740991,a="[object Arguments]",l="[object Array]",c="[object AsyncFunction]",u="[object Boolean]",f="[object Date]",d="[object Error]",h="[object Function]",g="[object GeneratorFunction]",m="[object Map]",y="[object Number]",b="[object Null]",_="[object Object]",w="[object Promise]",T="[object Proxy]",O="[object RegExp]",M="[object Set]",j="[object String]",A="[object Symbol]",$="[object Undefined]",B="[object WeakMap]",C="[object ArrayBuffer]",N="[object DataView]",S="[object Float32Array]",R="[object Float64Array]",L="[object Int8Array]",D="[object Int16Array]",z="[object Int32Array]",H="[object Uint8Array]",V="[object Uint8ClampedArray]",G="[object Uint16Array]",ee="[object Uint32Array]",Q=/[\\^$.*+?()[\]{}|]/g,re=/^\[object .+?Constructor\]$/,oe=/^(?:0|[1-9]\d*)$/,X={};X[S]=X[R]=X[L]=X[D]=X[z]=X[H]=X[V]=X[G]=X[ee]=!0,X[a]=X[l]=X[C]=X[u]=X[N]=X[f]=X[d]=X[h]=X[m]=X[y]=X[_]=X[O]=X[M]=X[j]=X[B]=!1;var fe=typeof er=="object"&&er&&er.Object===Object&&er,ve=typeof self=="object"&&self&&self.Object===Object&&self,se=fe||ve||Function("return this")(),ue=e&&!e.nodeType&&e,he=ue&&!0&&n&&!n.nodeType&&n,we=he&&he.exports===ue,Ce=we&&fe.process,Ee=function(){try{return Ce&&Ce.binding&&Ce.binding("util")}catch{}}(),je=Ee&&Ee.isTypedArray;function st(p,k){for(var E=-1,U=p==null?0:p.length,le=0,te=[];++E<U;){var be=p[E];k(be,E,p)&&(te[le++]=be)}return te}function gs(p,k){for(var E=-1,U=k.length,le=p.length;++E<U;)p[le+E]=k[E];return p}function Lo(p,k){for(var E=-1,U=p==null?0:p.length;++E<U;)if(k(p[E],E,p))return!0;return!1}function Ql(p,k){for(var E=-1,U=Array(p);++E<p;)U[E]=k(E);return U}function Zl(p){return function(k){return p(k)}}function fi(p,k){return p.has(k)}function ms(p,k){return p==null?void 0:p[k]}function Fo(p){var k=-1,E=Array(p.size);return p.forEach(function(U,le){E[++k]=[le,U]}),E}function qo(p,k){return function(E){return p(k(E))}}function sn(p){var k=-1,E=Array(p.size);return p.forEach(function(U){E[++k]=U}),E}var hi=Array.prototype,ec=Function.prototype,Tr=Object.prototype,pi=se["__core-js_shared__"],ys=ec.toString,Pt=Tr.hasOwnProperty,Bo=function(){var p=/[^.]+$/.exec(pi&&pi.keys&&pi.keys.IE_PROTO||"");return p?"Symbol(src)_1."+p:""}(),Uo=Tr.toString,tc=RegExp("^"+ys.call(Pt).replace(Q,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),_s=we?se.Buffer:void 0,gi=se.Symbol,zo=se.Uint8Array,mi=Tr.propertyIsEnumerable,Er=hi.splice,zt=gi?gi.toStringTag:void 0,yi=Object.getOwnPropertySymbols,bs=_s?_s.isBuffer:void 0,Nr=qo(Object.keys,Object),vs=Sn(se,"DataView"),Mr=Sn(se,"Map"),ks=Sn(se,"Promise"),ws=Sn(se,"Set"),xs=Sn(se,"WeakMap"),Yn=Sn(Object,"create"),Wo=gt(vs),Cn=gt(Mr),nc=gt(ks),rc=gt(ws),ic=gt(xs),Ko=gi?gi.prototype:void 0,Cs=Ko?Ko.valueOf:void 0;function Ye(p){var k=-1,E=p==null?0:p.length;for(this.clear();++k<E;){var U=p[k];this.set(U[0],U[1])}}function sc(){this.__data__=Yn?Yn(null):{},this.size=0}function oc(p){var k=this.has(p)&&delete this.__data__[p];return this.size-=k?1:0,k}function ac(p){var k=this.__data__;if(Yn){var E=k[p];return E===r?void 0:E}return Pt.call(k,p)?k[p]:void 0}function lc(p){var k=this.__data__;return Yn?k[p]!==void 0:Pt.call(k,p)}function cc(p,k){var E=this.__data__;return this.size+=this.has(p)?0:1,E[p]=Yn&&k===void 0?r:k,this}Ye.prototype.clear=sc,Ye.prototype.delete=oc,Ye.prototype.get=ac,Ye.prototype.has=lc,Ye.prototype.set=cc;function ot(p){var k=-1,E=p==null?0:p.length;for(this.clear();++k<E;){var U=p[k];this.set(U[0],U[1])}}function uc(){this.__data__=[],this.size=0}function dc(p){var k=this.__data__,E=vi(k,p);if(E<0)return!1;var U=k.length-1;return E==U?k.pop():Er.call(k,E,1),--this.size,!0}function fc(p){var k=this.__data__,E=vi(k,p);return E<0?void 0:k[E][1]}function hc(p){return vi(this.__data__,p)>-1}function pc(p,k){var E=this.__data__,U=vi(E,p);return U<0?(++this.size,E.push([p,k])):E[U][1]=k,this}ot.prototype.clear=uc,ot.prototype.delete=dc,ot.prototype.get=fc,ot.prototype.has=hc,ot.prototype.set=pc;function kt(p){var k=-1,E=p==null?0:p.length;for(this.clear();++k<E;){var U=p[k];this.set(U[0],U[1])}}function gc(){this.size=0,this.__data__={hash:new Ye,map:new(Mr||ot),string:new Ye}}function mc(p){var k=Wt(this,p).delete(p);return this.size-=k?1:0,k}function yc(p){return Wt(this,p).get(p)}function _c(p){return Wt(this,p).has(p)}function bc(p,k){var E=Wt(this,p),U=E.size;return E.set(p,k),this.size+=E.size==U?0:1,this}kt.prototype.clear=gc,kt.prototype.delete=mc,kt.prototype.get=yc,kt.prototype.has=_c,kt.prototype.set=bc;function _i(p){var k=-1,E=p==null?0:p.length;for(this.__data__=new kt;++k<E;)this.add(p[k])}function Ho(p){return this.__data__.set(p,r),this}function bi(p){return this.__data__.has(p)}_i.prototype.add=_i.prototype.push=Ho,_i.prototype.has=bi;function on(p){var k=this.__data__=new ot(p);this.size=k.size}function Ss(){this.__data__=new ot,this.size=0}function vc(p){var k=this.__data__,E=k.delete(p);return this.size=k.size,E}function kc(p){return this.__data__.get(p)}function wc(p){return this.__data__.has(p)}function xc(p,k){var E=this.__data__;if(E instanceof ot){var U=E.__data__;if(!Mr||U.length<t-1)return U.push([p,k]),this.size=++E.size,this;E=this.__data__=new kt(U)}return E.set(p,k),this.size=E.size,this}on.prototype.clear=Ss,on.prototype.delete=vc,on.prototype.get=kc,on.prototype.has=wc,on.prototype.set=xc;function Cc(p,k){var E=ki(p),U=!E&&Xo(p),le=!E&&!U&&wi(p),te=!E&&!U&&!le&&ea(p),be=E||U||le||te,_e=be?Ql(p.length,String):[],De=_e.length;for(var xe in p)Pt.call(p,xe)&&!(be&&(xe=="length"||le&&(xe=="offset"||xe=="parent")||te&&(xe=="buffer"||xe=="byteLength"||xe=="byteOffset")||$c(xe,De)))&&_e.push(xe);return _e}function vi(p,k){for(var E=p.length;E--;)if(Yo(p[E][0],k))return E;return-1}function Ts(p,k,E){var U=k(p);return ki(p)?U:gs(U,E(p))}function Ar(p){return p==null?p===void 0?$:b:zt&&zt in Object(p)?Tn(p):Go(p)}function Jo(p){return ln(p)&&Ar(p)==a}function Vo(p,k,E,U,le){return p===k?!0:p==null||k==null||!ln(p)&&!ln(k)?p!==p&&k!==k:Sc(p,k,E,U,Vo,le)}function Sc(p,k,E,U,le,te){var be=ki(p),_e=ki(k),De=be?l:an(p),xe=_e?l:an(k);De=De==a?_:De,xe=xe==a?_:xe;var at=De==_,wt=xe==_,Le=De==xe;if(Le&&wi(p)){if(!wi(k))return!1;be=!0,at=!1}if(Le&&!at)return te||(te=new on),be||ea(p)?Es(p,k,E,U,le,te):Mc(p,k,De,E,U,le,te);if(!(E&i)){var lt=at&&Pt.call(p,"__wrapped__"),Xe=wt&&Pt.call(k,"__wrapped__");if(lt||Xe){var Xn=lt?p.value():p,En=Xe?k.value():k;return te||(te=new on),le(Xn,En,E,U,te)}}return Le?(te||(te=new on),Ac(p,k,E,U,le,te)):!1}function Tc(p){if(!Zo(p)||Pc(p))return!1;var k=Qo(p)?tc:re;return k.test(gt(p))}function Ec(p){return ln(p)&&Ms(p.length)&&!!X[Ar(p)]}function Nc(p){if(!Rc(p))return Nr(p);var k=[];for(var E in Object(p))Pt.call(p,E)&&E!="constructor"&&k.push(E);return k}function Es(p,k,E,U,le,te){var be=E&i,_e=p.length,De=k.length;if(_e!=De&&!(be&&De>_e))return!1;var xe=te.get(p);if(xe&&te.get(k))return xe==k;var at=-1,wt=!0,Le=E&s?new _i:void 0;for(te.set(p,k),te.set(k,p);++at<_e;){var lt=p[at],Xe=k[at];if(U)var Xn=be?U(Xe,lt,at,k,p,te):U(lt,Xe,at,p,k,te);if(Xn!==void 0){if(Xn)continue;wt=!1;break}if(Le){if(!Lo(k,function(En,$r){if(!fi(Le,$r)&&(lt===En||le(lt,En,E,U,te)))return Le.push($r)})){wt=!1;break}}else if(!(lt===Xe||le(lt,Xe,E,U,te))){wt=!1;break}}return te.delete(p),te.delete(k),wt}function Mc(p,k,E,U,le,te,be){switch(E){case N:if(p.byteLength!=k.byteLength||p.byteOffset!=k.byteOffset)return!1;p=p.buffer,k=k.buffer;case C:return!(p.byteLength!=k.byteLength||!te(new zo(p),new zo(k)));case u:case f:case y:return Yo(+p,+k);case d:return p.name==k.name&&p.message==k.message;case O:case j:return p==k+"";case m:var _e=Fo;case M:var De=U&i;if(_e||(_e=sn),p.size!=k.size&&!De)return!1;var xe=be.get(p);if(xe)return xe==k;U|=s,be.set(p,k);var at=Es(_e(p),_e(k),U,le,te,be);return be.delete(p),at;case A:if(Cs)return Cs.call(p)==Cs.call(k)}return!1}function Ac(p,k,E,U,le,te){var be=E&i,_e=Or(p),De=_e.length,xe=Or(k),at=xe.length;if(De!=at&&!be)return!1;for(var wt=De;wt--;){var Le=_e[wt];if(!(be?Le in k:Pt.call(k,Le)))return!1}var lt=te.get(p);if(lt&&te.get(k))return lt==k;var Xe=!0;te.set(p,k),te.set(k,p);for(var Xn=be;++wt<De;){Le=_e[wt];var En=p[Le],$r=k[Le];if(U)var Xf=be?U($r,En,Le,k,p,te):U(En,$r,Le,p,k,te);if(!(Xf===void 0?En===$r||le(En,$r,E,U,te):Xf)){Xe=!1;break}Xn||(Xn=Le=="constructor")}if(Xe&&!Xn){var ta=p.constructor,na=k.constructor;ta!=na&&"constructor"in p&&"constructor"in k&&!(typeof ta=="function"&&ta instanceof ta&&typeof na=="function"&&na instanceof na)&&(Xe=!1)}return te.delete(p),te.delete(k),Xe}function Or(p){return Ts(p,As,Oc)}function Wt(p,k){var E=p.__data__;return Ic(k)?E[typeof k=="string"?"string":"hash"]:E.map}function Sn(p,k){var E=ms(p,k);return Tc(E)?E:void 0}function Tn(p){var k=Pt.call(p,zt),E=p[zt];try{p[zt]=void 0;var U=!0}catch{}var le=Uo.call(p);return U&&(k?p[zt]=E:delete p[zt]),le}var Oc=yi?function(p){return p==null?[]:(p=Object(p),st(yi(p),function(k){return mi.call(p,k)}))}:Dc,an=Ar;(vs&&an(new vs(new ArrayBuffer(1)))!=N||Mr&&an(new Mr)!=m||ks&&an(ks.resolve())!=w||ws&&an(new ws)!=M||xs&&an(new xs)!=B)&&(an=function(p){var k=Ar(p),E=k==_?p.constructor:void 0,U=E?gt(E):"";if(U)switch(U){case Wo:return N;case Cn:return m;case nc:return w;case rc:return M;case ic:return B}return k});function $c(p,k){return k=k??o,!!k&&(typeof p=="number"||oe.test(p))&&p>-1&&p%1==0&&p<k}function Ic(p){var k=typeof p;return k=="string"||k=="number"||k=="symbol"||k=="boolean"?p!=="__proto__":p===null}function Pc(p){return!!Bo&&Bo in p}function Rc(p){var k=p&&p.constructor,E=typeof k=="function"&&k.prototype||Tr;return p===E}function Go(p){return Uo.call(p)}function gt(p){if(p!=null){try{return ys.call(p)}catch{}try{return p+""}catch{}}return""}function Yo(p,k){return p===k||p!==p&&k!==k}var Xo=Jo(function(){return arguments}())?Jo:function(p){return ln(p)&&Pt.call(p,"callee")&&!mi.call(p,"callee")},ki=Array.isArray;function Ns(p){return p!=null&&Ms(p.length)&&!Qo(p)}var wi=bs||Lc;function jc(p,k){return Vo(p,k)}function Qo(p){if(!Zo(p))return!1;var k=Ar(p);return k==h||k==g||k==c||k==T}function Ms(p){return typeof p=="number"&&p>-1&&p%1==0&&p<=o}function Zo(p){var k=typeof p;return p!=null&&(k=="object"||k=="function")}function ln(p){return p!=null&&typeof p=="object"}var ea=je?Zl(je):Ec;function As(p){return Ns(p)?Cc(p):Nc(p)}function Dc(){return[]}function Lc(){return!1}n.exports=jc}(qs,qs.exports)),qs.exports}var ua={},tp;function Gx(){if(tp)return ua;tp=1,Object.defineProperty(ua,"__esModule",{value:!0});const n=u_(),e=d_();var t;return function(r){function i(l={},c={},u=!1){typeof l!="object"&&(l={}),typeof c!="object"&&(c={});let f=n(c);u||(f=Object.keys(f).reduce((d,h)=>(f[h]!=null&&(d[h]=f[h]),d),{}));for(const d in l)l[d]!==void 0&&c[d]===void 0&&(f[d]=l[d]);return Object.keys(f).length>0?f:void 0}r.compose=i;function s(l={},c={}){typeof l!="object"&&(l={}),typeof c!="object"&&(c={});const u=Object.keys(l).concat(Object.keys(c)).reduce((f,d)=>(e(l[d],c[d])||(f[d]=c[d]===void 0?null:c[d]),f),{});return Object.keys(u).length>0?u:void 0}r.diff=s;function o(l={},c={}){l=l||{};const u=Object.keys(c).reduce((f,d)=>(c[d]!==l[d]&&l[d]!==void 0&&(f[d]=c[d]),f),{});return Object.keys(l).reduce((f,d)=>(l[d]!==c[d]&&c[d]===void 0&&(f[d]=null),f),u)}r.invert=o;function a(l,c,u=!1){if(typeof l!="object")return c;if(typeof c!="object")return;if(!u)return c;const f=Object.keys(c).reduce((d,h)=>(l[h]===void 0&&(d[h]=c[h]),d),{});return Object.keys(f).length>0?f:void 0}r.transform=a}(t||(t={})),ua.default=t,ua}var da={},np;function f_(){if(np)return da;np=1,Object.defineProperty(da,"__esModule",{value:!0});var n;return function(e){function t(r){return typeof r.delete=="number"?r.delete:typeof r.retain=="number"?r.retain:typeof r.retain=="object"&&r.retain!==null?1:typeof r.insert=="string"?r.insert.length:1}e.length=t}(n||(n={})),da.default=n,da}var fa={},rp;function Yx(){if(rp)return fa;rp=1,Object.defineProperty(fa,"__esModule",{value:!0});const n=f_();class e{constructor(r){this.ops=r,this.index=0,this.offset=0}hasNext(){return this.peekLength()<1/0}next(r){r||(r=1/0);const i=this.ops[this.index];if(i){const s=this.offset,o=n.default.length(i);if(r>=o-s?(r=o-s,this.index+=1,this.offset=0):this.offset+=r,typeof i.delete=="number")return{delete:r};{const a={};return i.attributes&&(a.attributes=i.attributes),typeof i.retain=="number"?a.retain=r:typeof i.retain=="object"&&i.retain!==null?a.retain=i.retain:typeof i.insert=="string"?a.insert=i.insert.substr(s,r):a.insert=i.insert,a}}else return{retain:1/0}}peek(){return this.ops[this.index]}peekLength(){return this.ops[this.index]?n.default.length(this.ops[this.index])-this.offset:1/0}peekType(){const r=this.ops[this.index];return r?typeof r.delete=="number"?"delete":typeof r.retain=="number"||typeof r.retain=="object"&&r.retain!==null?"retain":"insert":"retain"}rest(){if(this.hasNext()){if(this.offset===0)return this.ops.slice(this.index);{const r=this.offset,i=this.index,s=this.next(),o=this.ops.slice(this.index);return this.offset=r,this.index=i,[s].concat(o)}}else return[]}}return fa.default=e,fa}var ip;function Xx(){return ip||(ip=1,function(n,e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeMap=e.OpIterator=e.Op=void 0;const t=Vx(),r=u_(),i=d_(),s=Gx();e.AttributeMap=s.default;const o=f_();e.Op=o.default;const a=Yx();e.OpIterator=a.default;const l="\0",c=(f,d)=>{if(typeof f!="object"||f===null)throw new Error(`cannot retain a ${typeof f}`);if(typeof d!="object"||d===null)throw new Error(`cannot retain a ${typeof d}`);const h=Object.keys(f)[0];if(!h||h!==Object.keys(d)[0])throw new Error(`embed types not matched: ${h} != ${Object.keys(d)[0]}`);return[h,f[h],d[h]]};class u{constructor(d){Array.isArray(d)?this.ops=d:d!=null&&Array.isArray(d.ops)?this.ops=d.ops:this.ops=[]}static registerEmbed(d,h){this.handlers[d]=h}static unregisterEmbed(d){delete this.handlers[d]}static getHandler(d){const h=this.handlers[d];if(!h)throw new Error(`no handlers for embed type "${d}"`);return h}insert(d,h){const g={};return typeof d=="string"&&d.length===0?this:(g.insert=d,h!=null&&typeof h=="object"&&Object.keys(h).length>0&&(g.attributes=h),this.push(g))}delete(d){return d<=0?this:this.push({delete:d})}retain(d,h){if(typeof d=="number"&&d<=0)return this;const g={retain:d};return h!=null&&typeof h=="object"&&Object.keys(h).length>0&&(g.attributes=h),this.push(g)}push(d){let h=this.ops.length,g=this.ops[h-1];if(d=r(d),typeof g=="object"){if(typeof d.delete=="number"&&typeof g.delete=="number")return this.ops[h-1]={delete:g.delete+d.delete},this;if(typeof g.delete=="number"&&d.insert!=null&&(h-=1,g=this.ops[h-1],typeof g!="object"))return this.ops.unshift(d),this;if(i(d.attributes,g.attributes)){if(typeof d.insert=="string"&&typeof g.insert=="string")return this.ops[h-1]={insert:g.insert+d.insert},typeof d.attributes=="object"&&(this.ops[h-1].attributes=d.attributes),this;if(typeof d.retain=="number"&&typeof g.retain=="number")return this.ops[h-1]={retain:g.retain+d.retain},typeof d.attributes=="object"&&(this.ops[h-1].attributes=d.attributes),this}}return h===this.ops.length?this.ops.push(d):this.ops.splice(h,0,d),this}chop(){const d=this.ops[this.ops.length-1];return d&&typeof d.retain=="number"&&!d.attributes&&this.ops.pop(),this}filter(d){return this.ops.filter(d)}forEach(d){this.ops.forEach(d)}map(d){return this.ops.map(d)}partition(d){const h=[],g=[];return this.forEach(m=>{(d(m)?h:g).push(m)}),[h,g]}reduce(d,h){return this.ops.reduce(d,h)}changeLength(){return this.reduce((d,h)=>h.insert?d+o.default.length(h):h.delete?d-h.delete:d,0)}length(){return this.reduce((d,h)=>d+o.default.length(h),0)}slice(d=0,h=1/0){const g=[],m=new a.default(this.ops);let y=0;for(;y<h&&m.hasNext();){let b;y<d?b=m.next(d-y):(b=m.next(h-y),g.push(b)),y+=o.default.length(b)}return new u(g)}compose(d){const h=new a.default(this.ops),g=new a.default(d.ops),m=[],y=g.peek();if(y!=null&&typeof y.retain=="number"&&y.attributes==null){let _=y.retain;for(;h.peekType()==="insert"&&h.peekLength()<=_;)_-=h.peekLength(),m.push(h.next());y.retain-_>0&&g.next(y.retain-_)}const b=new u(m);for(;h.hasNext()||g.hasNext();)if(g.peekType()==="insert")b.push(g.next());else if(h.peekType()==="delete")b.push(h.next());else{const _=Math.min(h.peekLength(),g.peekLength()),w=h.next(_),T=g.next(_);if(T.retain){const O={};if(typeof w.retain=="number")O.retain=typeof T.retain=="number"?_:T.retain;else if(typeof T.retain=="number")w.retain==null?O.insert=w.insert:O.retain=w.retain;else{const j=w.retain==null?"insert":"retain",[A,$,B]=c(w[j],T.retain),C=u.getHandler(A);O[j]={[A]:C.compose($,B,j==="retain")}}const M=s.default.compose(w.attributes,T.attributes,typeof w.retain=="number");if(M&&(O.attributes=M),b.push(O),!g.hasNext()&&i(b.ops[b.ops.length-1],O)){const j=new u(h.rest());return b.concat(j).chop()}}else typeof T.delete=="number"&&(typeof w.retain=="number"||typeof w.retain=="object"&&w.retain!==null)&&b.push(T)}return b.chop()}concat(d){const h=new u(this.ops.slice());return d.ops.length>0&&(h.push(d.ops[0]),h.ops=h.ops.concat(d.ops.slice(1))),h}diff(d,h){if(this.ops===d.ops)return new u;const g=[this,d].map(w=>w.map(T=>{if(T.insert!=null)return typeof T.insert=="string"?T.insert:l;const O=w===d?"on":"with";throw new Error("diff() called "+O+" non-document")}).join("")),m=new u,y=t(g[0],g[1],h,!0),b=new a.default(this.ops),_=new a.default(d.ops);return y.forEach(w=>{let T=w[1].length;for(;T>0;){let O=0;switch(w[0]){case t.INSERT:O=Math.min(_.peekLength(),T),m.push(_.next(O));break;case t.DELETE:O=Math.min(T,b.peekLength()),b.next(O),m.delete(O);break;case t.EQUAL:O=Math.min(b.peekLength(),_.peekLength(),T);const M=b.next(O),j=_.next(O);i(M.insert,j.insert)?m.retain(O,s.default.diff(M.attributes,j.attributes)):m.push(j).delete(O);break}T-=O}}),m.chop()}eachLine(d,h=`
`){const g=new a.default(this.ops);let m=new u,y=0;for(;g.hasNext();){if(g.peekType()!=="insert")return;const b=g.peek(),_=o.default.length(b)-g.peekLength(),w=typeof b.insert=="string"?b.insert.indexOf(h,_)-_:-1;if(w<0)m.push(g.next());else if(w>0)m.push(g.next(w));else{if(d(m,g.next(1).attributes||{},y)===!1)return;y+=1,m=new u}}m.length()>0&&d(m,{},y)}invert(d){const h=new u;return this.reduce((g,m)=>{if(m.insert)h.delete(o.default.length(m));else{if(typeof m.retain=="number"&&m.attributes==null)return h.retain(m.retain),g+m.retain;if(m.delete||typeof m.retain=="number"){const y=m.delete||m.retain;return d.slice(g,g+y).forEach(_=>{m.delete?h.push(_):m.retain&&m.attributes&&h.retain(o.default.length(_),s.default.invert(m.attributes,_.attributes))}),g+y}else if(typeof m.retain=="object"&&m.retain!==null){const y=d.slice(g,g+1),b=new a.default(y.ops).next(),[_,w,T]=c(m.retain,b.insert),O=u.getHandler(_);return h.retain({[_]:O.invert(w,T)},s.default.invert(m.attributes,b.attributes)),g+1}}return g},0),h.chop()}transform(d,h=!1){if(h=!!h,typeof d=="number")return this.transformPosition(d,h);const g=d,m=new a.default(this.ops),y=new a.default(g.ops),b=new u;for(;m.hasNext()||y.hasNext();)if(m.peekType()==="insert"&&(h||y.peekType()!=="insert"))b.retain(o.default.length(m.next()));else if(y.peekType()==="insert")b.push(y.next());else{const _=Math.min(m.peekLength(),y.peekLength()),w=m.next(_),T=y.next(_);if(w.delete)continue;if(T.delete)b.push(T);else{const O=w.retain,M=T.retain;let j=typeof M=="object"&&M!==null?M:_;if(typeof O=="object"&&O!==null&&typeof M=="object"&&M!==null){const A=Object.keys(O)[0];if(A===Object.keys(M)[0]){const $=u.getHandler(A);$&&(j={[A]:$.transform(O[A],M[A],h)})}}b.retain(j,s.default.transform(w.attributes,T.attributes,h))}}return b.chop()}transformPosition(d,h=!1){h=!!h;const g=new a.default(this.ops);let m=0;for(;g.hasNext()&&m<=d;){const y=g.peekLength(),b=g.peekType();if(g.next(),b==="delete"){d-=Math.min(y,d-m);continue}else b==="insert"&&(m<d||!h)&&(d+=y);m+=y}return d}}u.Op=o.default,u.OpIterator=a.default,u.AttributeMap=s.default,u.handlers={},e.default=u,n.exports=u,n.exports.default=u}(ca,ca.exports)),ca.exports}var Qx=Xx();const Bs=tk(Qx);var Zx=Object.getOwnPropertyNames,eC=Object.getOwnPropertySymbols,tC=Object.prototype.hasOwnProperty;function sp(n,e){return function(r,i,s){return n(r,i,s)&&e(r,i,s)}}function ha(n){return function(t,r,i){if(!t||!r||typeof t!="object"||typeof r!="object")return n(t,r,i);var s=i.cache,o=s.get(t),a=s.get(r);if(o&&a)return o===r&&a===t;s.set(t,r),s.set(r,t);var l=n(t,r,i);return s.delete(t),s.delete(r),l}}function op(n){return Zx(n).concat(eC(n))}var nC=Object.hasOwn||function(n,e){return tC.call(n,e)};function li(n,e){return n===e||!n&&!e&&n!==n&&e!==e}var rC="__v",iC="__o",sC="_owner",ap=Object.getOwnPropertyDescriptor,lp=Object.keys;function oC(n,e,t){var r=n.length;if(e.length!==r)return!1;for(;r-- >0;)if(!t.equals(n[r],e[r],r,r,n,e,t))return!1;return!0}function aC(n,e){return li(n.getTime(),e.getTime())}function lC(n,e){return n.name===e.name&&n.message===e.message&&n.cause===e.cause&&n.stack===e.stack}function cC(n,e){return n===e}function cp(n,e,t){var r=n.size;if(r!==e.size)return!1;if(!r)return!0;for(var i=new Array(r),s=n.entries(),o,a,l=0;(o=s.next())&&!o.done;){for(var c=e.entries(),u=!1,f=0;(a=c.next())&&!a.done;){if(i[f]){f++;continue}var d=o.value,h=a.value;if(t.equals(d[0],h[0],l,f,n,e,t)&&t.equals(d[1],h[1],d[0],h[0],n,e,t)){u=i[f]=!0;break}f++}if(!u)return!1;l++}return!0}var uC=li;function dC(n,e,t){var r=lp(n),i=r.length;if(lp(e).length!==i)return!1;for(;i-- >0;)if(!h_(n,e,t,r[i]))return!1;return!0}function Is(n,e,t){var r=op(n),i=r.length;if(op(e).length!==i)return!1;for(var s,o,a;i-- >0;)if(s=r[i],!h_(n,e,t,s)||(o=ap(n,s),a=ap(e,s),(o||a)&&(!o||!a||o.configurable!==a.configurable||o.enumerable!==a.enumerable||o.writable!==a.writable)))return!1;return!0}function fC(n,e){return li(n.valueOf(),e.valueOf())}function hC(n,e){return n.source===e.source&&n.flags===e.flags}function up(n,e,t){var r=n.size;if(r!==e.size)return!1;if(!r)return!0;for(var i=new Array(r),s=n.values(),o,a;(o=s.next())&&!o.done;){for(var l=e.values(),c=!1,u=0;(a=l.next())&&!a.done;){if(!i[u]&&t.equals(o.value,a.value,o.value,a.value,n,e,t)){c=i[u]=!0;break}u++}if(!c)return!1}return!0}function pC(n,e){var t=n.length;if(e.length!==t)return!1;for(;t-- >0;)if(n[t]!==e[t])return!1;return!0}function gC(n,e){return n.hostname===e.hostname&&n.pathname===e.pathname&&n.protocol===e.protocol&&n.port===e.port&&n.hash===e.hash&&n.username===e.username&&n.password===e.password}function h_(n,e,t,r){return(r===sC||r===iC||r===rC)&&(n.$$typeof||e.$$typeof)?!0:nC(e,r)&&t.equals(n[r],e[r],r,r,n,e,t)}var mC="[object Arguments]",yC="[object Boolean]",_C="[object Date]",bC="[object Error]",vC="[object Map]",kC="[object Number]",wC="[object Object]",xC="[object RegExp]",CC="[object Set]",SC="[object String]",TC="[object URL]",EC=Array.isArray,dp=typeof ArrayBuffer=="function"&&ArrayBuffer.isView?ArrayBuffer.isView:null,fp=Object.assign,NC=Object.prototype.toString.call.bind(Object.prototype.toString);function MC(n){var e=n.areArraysEqual,t=n.areDatesEqual,r=n.areErrorsEqual,i=n.areFunctionsEqual,s=n.areMapsEqual,o=n.areNumbersEqual,a=n.areObjectsEqual,l=n.arePrimitiveWrappersEqual,c=n.areRegExpsEqual,u=n.areSetsEqual,f=n.areTypedArraysEqual,d=n.areUrlsEqual;return function(g,m,y){if(g===m)return!0;if(g==null||m==null)return!1;var b=typeof g;if(b!==typeof m)return!1;if(b!=="object")return b==="number"?o(g,m,y):b==="function"?i(g,m,y):!1;var _=g.constructor;if(_!==m.constructor)return!1;if(_===Object)return a(g,m,y);if(EC(g))return e(g,m,y);if(dp!=null&&dp(g))return f(g,m,y);if(_===Date)return t(g,m,y);if(_===RegExp)return c(g,m,y);if(_===Map)return s(g,m,y);if(_===Set)return u(g,m,y);var w=NC(g);return w===_C?t(g,m,y):w===xC?c(g,m,y):w===vC?s(g,m,y):w===CC?u(g,m,y):w===wC?typeof g.then!="function"&&typeof m.then!="function"&&a(g,m,y):w===TC?d(g,m,y):w===bC?r(g,m,y):w===mC?a(g,m,y):w===yC||w===kC||w===SC?l(g,m,y):!1}}function AC(n){var e=n.circular,t=n.createCustomConfig,r=n.strict,i={areArraysEqual:r?Is:oC,areDatesEqual:aC,areErrorsEqual:lC,areFunctionsEqual:cC,areMapsEqual:r?sp(cp,Is):cp,areNumbersEqual:uC,areObjectsEqual:r?Is:dC,arePrimitiveWrappersEqual:fC,areRegExpsEqual:hC,areSetsEqual:r?sp(up,Is):up,areTypedArraysEqual:r?Is:pC,areUrlsEqual:gC};if(t&&(i=fp({},i,t(i))),e){var s=ha(i.areArraysEqual),o=ha(i.areMapsEqual),a=ha(i.areObjectsEqual),l=ha(i.areSetsEqual);i=fp({},i,{areArraysEqual:s,areMapsEqual:o,areObjectsEqual:a,areSetsEqual:l})}return i}function OC(n){return function(e,t,r,i,s,o,a){return n(e,t,a)}}function $C(n){var e=n.circular,t=n.comparator,r=n.createState,i=n.equals,s=n.strict;if(r)return function(l,c){var u=r(),f=u.cache,d=f===void 0?e?new WeakMap:void 0:f,h=u.meta;return t(l,c,{cache:d,equals:i,meta:h,strict:s})};if(e)return function(l,c){return t(l,c,{cache:new WeakMap,equals:i,meta:void 0,strict:s})};var o={cache:void 0,equals:i,meta:void 0,strict:s};return function(l,c){return t(l,c,o)}}var Rn=kr();kr({strict:!0});kr({circular:!0});kr({circular:!0,strict:!0});kr({createInternalComparator:function(){return li}});kr({strict:!0,createInternalComparator:function(){return li}});kr({circular:!0,createInternalComparator:function(){return li}});kr({circular:!0,createInternalComparator:function(){return li},strict:!0});function kr(n){n===void 0&&(n={});var e=n.circular,t=e===void 0?!1:e,r=n.createInternalComparator,i=n.createState,s=n.strict,o=s===void 0?!1:s,a=AC(n),l=MC(a),c=r?r(l):OC(l);return $C({circular:t,comparator:l,createState:i,equals:c,strict:o})}const p_=x.createContext(null);function IC(n,e){return{getTheme:function(){return e??null}}}function pe(){const n=x.useContext(p_);return n==null&&function(e,...t){const r=new URL("https://lexical.dev/docs/error"),i=new URLSearchParams;i.append("code",e);for(const s of t)i.append("v",s);throw r.search=i.toString(),Error(`Minified Lexical error #${e}; visit ${r.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}(8),n}function PC(n,e){const t=e.body?e.body.childNodes:[];let r=[];const i=[];for(let s=0;s<t.length;s++){const o=t[s];if(!y_.has(o.nodeName)){const a=__(o,n,i,!1);a!==null&&(r=r.concat(a))}}return function(s){for(const o of s)o.getNextSibling()instanceof Gd&&o.insertAfter(Hr());for(const o of s){const a=o.getChildren();for(const l of a)o.insertBefore(l);o.remove()}}(i),r}function g_(n,e){if(typeof document>"u"||typeof window>"u"&&global.window===void 0)throw new Error("To use $generateHtmlFromNodes in headless mode please initialize a headless browser implementation such as JSDom before calling this function.");const t=document.createElement("div"),r=ye().getChildren();for(let i=0;i<r.length;i++)m_(n,r[i],t,e);return t.innerHTML}function m_(n,e,t,r=null){let i=r===null||e.isSelected(r);const s=F(e)&&e.excludeFromCopy("html");let o=e;if(r!==null){let h=af(e);h=W(h)&&r!==null?i_(r,h):h,o=h}const a=F(o)?o.getChildren():[],l=Qd(n,o.getType());let c;c=l&&l.exportDOM!==void 0?l.exportDOM(n,o):o.exportDOM(n);const{element:u,after:f}=c;if(!u)return!1;const d=document.createDocumentFragment();for(let h=0;h<a.length;h++){const g=a[h],m=m_(n,g,d,r);!i&&F(e)&&m&&e.extractWithChild(g,r,"html")&&(i=!0)}if(i&&!s){if((Ne(u)||Fu(u))&&u.append(d),t.append(u),f){const h=f.call(o,u);h&&(Fu(u)?u.replaceChildren(h):u.replaceWith(h))}}else t.append(d);return i}const y_=new Set(["STYLE","SCRIPT"]);function __(n,e,t,r,i=new Map,s){let o=[];if(y_.has(n.nodeName))return o;let a=null;const l=function(g,m){const{nodeName:y}=g,b=m._htmlConversions.get(y.toLowerCase());let _=null;if(b!==void 0)for(const w of b){const T=w(g);T!==null&&(_===null||(_.priority||0)<=(T.priority||0))&&(_=T)}return _!==null?_.conversion:null}(n,e),c=l?l(n):null;let u=null;if(c!==null){u=c.after;const g=c.node;if(a=Array.isArray(g)?g[g.length-1]:g,a!==null){for(const[,m]of i)if(a=m(a,s),!a)break;a&&o.push(...Array.isArray(g)?g:[a])}c.forChild!=null&&i.set(n.nodeName,c.forChild)}const f=n.childNodes;let d=[];const h=(a==null||!wn(a))&&(a!=null&&Iu(a)||r);for(let g=0;g<f.length;g++)d.push(...__(f[g],e,t,h,new Map(i),a));return u!=null&&(d=u(d)),ul(n)&&(d=RC(n,d,h?()=>{const g=new Gd;return t.push(g),g}:It)),a==null?d.length>0?o=o.concat(d):ul(n)&&function(g){return g.nextSibling==null||g.previousSibling==null?!1:qu(g.nextSibling)&&qu(g.previousSibling)}(n)&&(o=o.concat(Hr())):F(a)&&a.append(...d),o}function RC(n,e,t){const r=n.style.textAlign,i=[];let s=[];for(let o=0;o<e.length;o++){const a=e[o];if(Iu(a))r&&!a.getFormat()&&a.setFormat(r),i.push(a);else if(s.push(a),o===e.length-1||o<e.length-1&&Iu(e[o+1])){const l=t();l.setFormat(r),l.append(...s),i.push(l),s=[]}}return i}const jC=new Set(["http:","https:","mailto:","sms:","tel:"]);let b_=class v_ extends pt{static getType(){return"link"}static clone(e){return new v_(e.__url,{rel:e.__rel,target:e.__target,title:e.__title},e.__key)}constructor(e="",t={},r){super(r);const{target:i=null,rel:s=null,title:o=null}=t;this.__url=e,this.__target=i,this.__rel=s,this.__title=o}createDOM(e){const t=document.createElement("a");return this.updateLinkDOM(null,t,e),ct(t,e.theme.link),t}updateLinkDOM(e,t,r){if(Xy(t)){e&&e.__url===this.__url||(t.href=this.sanitizeUrl(this.__url));for(const i of["target","rel","title"]){const s=`__${i}`,o=this[s];e&&e[s]===o||(o?t[i]=o:t.removeAttribute(i))}}}updateDOM(e,t,r){return this.updateLinkDOM(e,t,r),!1}static importDOM(){return{a:e=>({conversion:DC,priority:1})}}static importJSON(e){return Ku().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setURL(e.url).setRel(e.rel||null).setTarget(e.target||null).setTitle(e.title||null)}sanitizeUrl(e){e=hp(e);try{const t=new URL(hp(e));if(!jC.has(t.protocol))return"about:blank"}catch{return e}return e}exportJSON(){return{...super.exportJSON(),rel:this.getRel(),target:this.getTarget(),title:this.getTitle(),url:this.getURL()}}getURL(){return this.getLatest().__url}setURL(e){const t=this.getWritable();return t.__url=e,t}getTarget(){return this.getLatest().__target}setTarget(e){const t=this.getWritable();return t.__target=e,t}getRel(){return this.getLatest().__rel}setRel(e){const t=this.getWritable();return t.__rel=e,t}getTitle(){return this.getLatest().__title}setTitle(e){const t=this.getWritable();return t.__title=e,t}insertNewAfter(e,t=!0){const r=Ku(this.__url,{rel:this.__rel,target:this.__target,title:this.__title});return this.insertAfter(r,t),r}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}canBeEmpty(){return!1}isInline(){return!0}extractWithChild(e,t,r){if(!q(t))return!1;const i=t.anchor.getNode(),s=t.focus.getNode();return this.isParentOf(i)&&this.isParentOf(s)&&t.getTextContent().length>0}isEmailURI(){return this.__url.startsWith("mailto:")}isWebSiteURI(){return this.__url.startsWith("https://")||this.__url.startsWith("http://")}};function DC(n){let e=null;if(Xy(n)){const t=n.textContent;(t!==null&&t!==""||n.children.length>0)&&(e=Ku(n.getAttribute("href")||"",{rel:n.getAttribute("rel"),target:n.getAttribute("target"),title:n.getAttribute("title")}))}return{node:e}}function Ku(n="",e){return Ae(new b_(n,e))}function LC(n){return n instanceof b_}const FC=/^\+?[0-9\s()-]{5,}$/;function hp(n){return n.match(/^[a-z][a-z0-9+.-]*:/i)||n.match(/^[/#.]/)?n:n.includes("@")?`mailto:${n}`:FC.test(n)?`tel:${n}`:`https://${n}`}const k_=[];let w_=class x_ extends pt{static getType(){return"mark"}static clone(e){return new x_(e.__ids,e.__key)}static importDOM(){return null}static importJSON(e){return pp().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setIDs(e.ids)}exportJSON(){return{...super.exportJSON(),ids:this.getIDs()}}constructor(e=k_,t){super(t),this.__ids=e}createDOM(e){const t=document.createElement("mark");return ct(t,e.theme.mark),this.__ids.length>1&&ct(t,e.theme.markOverlap),t}updateDOM(e,t,r){const i=e.__ids,s=this.__ids,o=i.length,a=s.length,l=r.theme.markOverlap;return o!==a&&(o===1?a===2&&ct(t,l):a===1&&Br(t,l)),!1}hasID(e){return this.getIDs().includes(e)}getIDs(){return Array.from(this.getLatest().__ids)}setIDs(e){const t=this.getWritable();return t.__ids=e,t}addID(e){const t=this.getWritable();return t.__ids.includes(e)?t:t.setIDs([...t.__ids,e])}deleteID(e){const t=this.getWritable(),r=t.__ids.indexOf(e);if(r===-1)return t;const i=Array.from(t.__ids);return i.splice(r,1),t.setIDs(i)}insertNewAfter(e,t=!0){const r=pp(this.__ids);return this.insertAfter(r,t),r}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}canBeEmpty(){return!1}isInline(){return!0}extractWithChild(e,t,r){if(!q(t)||r==="html")return!1;const i=t.anchor,s=t.focus,o=i.getNode(),a=s.getNode(),l=t.isBackward()?i.offset-s.offset:s.offset-i.offset;return this.isParentOf(o)&&this.isParentOf(a)&&this.getTextContent().length===l}excludeFromCopy(e){return e!=="clone"}};function pp(n=k_){return Ae(new w_(n))}function qC(n){return n instanceof w_}function gl(n,...e){const t=new URL("https://lexical.dev/docs/error"),r=new URLSearchParams;r.append("code",n);for(const i of e)r.append("v",i);throw t.search=r.toString(),Error(`Minified Lexical error #${n}; visit ${t.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}function C_(n,e=K()){return e==null&&gl(166),q(e)&&e.isCollapsed()||e.getNodes().length===0?"":g_(n,e)}function BC(n,e=K()){return e==null&&gl(166),q(e)&&e.isCollapsed()||e.getNodes().length===0?null:JSON.stringify(UC(n,e))}function gp(n,e){const t=n.getData("text/plain")||n.getData("text/uri-list");t!=null&&e.insertRawText(t)}function mp(n,e,t){const r=n.getData("application/x-lexical-editor");if(r)try{const a=JSON.parse(r);if(a.namespace===t._config.namespace&&Array.isArray(a.nodes))return yp(t,zC(a.nodes),e)}catch{}const i=n.getData("text/html"),s=n.getData("text/plain");if(i&&s!==i)try{const a=new DOMParser().parseFromString(function(l){return window.trustedTypes&&window.trustedTypes.createPolicy?window.trustedTypes.createPolicy("lexical",{createHTML:c=>c}).createHTML(l):l}(i),"text/html");return yp(t,PC(t,a),e)}catch{}const o=s||n.getData("text/uri-list");if(o!=null)if(q(e)){const a=o.split(/(\r?\n|\t)/);a[a.length-1]===""&&a.pop();for(let l=0;l<a.length;l++){const c=K();if(q(c)){const u=a[l];u===`
`||u===`\r
`?c.insertParagraph():u==="	"?c.insertNodes([Co()]):c.insertText(u)}}}else e.insertRawText(o)}function yp(n,e,t){n.dispatchCommand(Cw,{nodes:e,selection:t})||(t.insertNodes(e),function(r){if(q(r)&&r.isCollapsed()){const i=r.anchor;let s=null;const o=Un(i,"previous");if(o)if(or(o))s=o.origin;else{const a=dr(o,Zt(ye(),"next").getFlipped());for(const l of a){if(W(l.origin)){s=l.origin;break}if(F(l.origin)&&!l.origin.isInline())break}}if(s&&W(s)){const a=s.getFormat(),l=s.getStyle();r.format===a&&r.style===l||(r.format=a,r.style=l,r.dirty=!0)}}}(t))}function S_(n,e,t,r=[]){let i=e===null||t.isSelected(e);const s=F(t)&&t.excludeFromCopy("html");let o=t;if(e!==null){let c=af(t);c=W(c)&&e!==null?i_(e,c):c,o=c}const a=F(o)?o.getChildren():[],l=function(c){const u=c.exportJSON(),f=c.constructor;if(u.type!==f.getType()&&gl(58,f.name),F(c)){const d=u.children;Array.isArray(d)||gl(59,f.name)}return u}(o);if(W(o)){const c=o.__text;c.length>0?l.text=c:i=!1}for(let c=0;c<a.length;c++){const u=a[c],f=S_(n,e,u,l.children);!i&&F(t)&&f&&t.extractWithChild(u,e,"clone")&&(i=!0)}if(i&&!s)r.push(l);else if(Array.isArray(l.children))for(let c=0;c<l.children.length;c++){const u=l.children[c];r.push(u)}return i}function UC(n,e){const t=[],r=ye().getChildren();for(let i=0;i<r.length;i++)S_(n,e,r[i],t);return{namespace:n._config.namespace,nodes:t}}function zC(n){const e=[];for(let t=0;t<n.length;t++){const r=n[t],i=Iy(r);W(i)&&Ox(i),e.push(i)}return e}let Ci=null;async function _p(n,e,t){if(Ci!==null)return!1;if(e!==null)return new Promise((c,u)=>{n.update(()=>{c(bp(n,e,t))})});const r=n.getRootElement(),i=n._window||window,s=window.document,o=Qt(i);if(r===null||o===null)return!1;const a=s.createElement("span");a.style.cssText="position: fixed; top: -1000px;",a.append(s.createTextNode("#")),r.append(a);const l=new Range;return l.setStart(a,0),l.setEnd(a,1),o.removeAllRanges(),o.addRange(l),new Promise((c,u)=>{const f=n.registerCommand(yr,d=>(Fn(d,ClipboardEvent)&&(f(),Ci!==null&&(window.clearTimeout(Ci),Ci=null),c(bp(n,d,t))),!0),Ai);Ci=window.setTimeout(()=>{f(),Ci=null,c(!1)},50),s.execCommand("copy"),a.remove()})}function bp(n,e,t){if(t===void 0){const i=Qt(n._window);if(!i)return!1;const s=i.anchorNode,o=i.focusNode;if(s!==null&&o!==null&&!To(n,s,o))return!1;const a=K();if(a===null)return!1;t=KC(a)}e.preventDefault();const r=e.clipboardData;return r!==null&&(HC(r,t),!0)}const WC=[["text/html",C_],["application/x-lexical-editor",BC]];function KC(n=K()){const e={"text/plain":n?n.getTextContent():""};if(n){const t=Ul();for(const[r,i]of WC){const s=i(t,n);s!==null&&(e[r]=s)}}return e}function HC(n,e){for(const t in e){const r=e[t];r!==void 0&&n.setData(t,r)}}const ff=/^(\d+(?:\.\d+)?)px$/,$i={BOTH:3,NO_STATUS:0,ROW:1};let hf=class T_ extends pt{static getType(){return"tablecell"}static clone(e){return new T_(e.__headerState,e.__colSpan,e.__width,e.__key)}afterCloneFrom(e){super.afterCloneFrom(e),this.__rowSpan=e.__rowSpan,this.__backgroundColor=e.__backgroundColor,this.__verticalAlign=e.__verticalAlign}static importDOM(){return{td:e=>({conversion:vp,priority:0}),th:e=>({conversion:vp,priority:0})}}static importJSON(e){return E_().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setHeaderStyles(e.headerState).setColSpan(e.colSpan||1).setRowSpan(e.rowSpan||1).setWidth(e.width||void 0).setBackgroundColor(e.backgroundColor||null).setVerticalAlign(e.verticalAlign||void 0)}constructor(e=$i.NO_STATUS,t=1,r,i){super(i),this.__colSpan=t,this.__rowSpan=1,this.__headerState=e,this.__width=r,this.__backgroundColor=null,this.__verticalAlign=void 0}createDOM(e){const t=document.createElement(this.getTag());return this.__width&&(t.style.width=`${this.__width}px`),this.__colSpan>1&&(t.colSpan=this.__colSpan),this.__rowSpan>1&&(t.rowSpan=this.__rowSpan),this.__backgroundColor!==null&&(t.style.backgroundColor=this.__backgroundColor),Hu(this.__verticalAlign)&&(t.style.verticalAlign=this.__verticalAlign),ct(t,e.theme.tableCell,this.hasHeader()&&e.theme.tableCellHeader),t}exportDOM(e){const t=super.exportDOM(e);if(Ne(t.element)){const r=t.element;r.setAttribute("data-temporary-table-cell-lexical-key",this.getKey()),r.style.border="1px solid black",this.__colSpan>1&&(r.colSpan=this.__colSpan),this.__rowSpan>1&&(r.rowSpan=this.__rowSpan),r.style.width=`${this.getWidth()||75}px`,r.style.verticalAlign=this.getVerticalAlign()||"top",r.style.textAlign="start",this.__backgroundColor===null&&this.hasHeader()&&(r.style.backgroundColor="#f2f3f5")}return t}exportJSON(){return{...super.exportJSON(),...Hu(this.__verticalAlign)&&{verticalAlign:this.__verticalAlign},backgroundColor:this.getBackgroundColor(),colSpan:this.__colSpan,headerState:this.__headerState,rowSpan:this.__rowSpan,width:this.getWidth()}}getColSpan(){return this.getLatest().__colSpan}setColSpan(e){const t=this.getWritable();return t.__colSpan=e,t}getRowSpan(){return this.getLatest().__rowSpan}setRowSpan(e){const t=this.getWritable();return t.__rowSpan=e,t}getTag(){return this.hasHeader()?"th":"td"}setHeaderStyles(e,t=$i.BOTH){const r=this.getWritable();return r.__headerState=e&t|r.__headerState&~t,r}getHeaderStyles(){return this.getLatest().__headerState}setWidth(e){const t=this.getWritable();return t.__width=e,t}getWidth(){return this.getLatest().__width}getBackgroundColor(){return this.getLatest().__backgroundColor}setBackgroundColor(e){const t=this.getWritable();return t.__backgroundColor=e,t}getVerticalAlign(){return this.getLatest().__verticalAlign}setVerticalAlign(e){const t=this.getWritable();return t.__verticalAlign=e||void 0,t}toggleHeaderStyle(e){const t=this.getWritable();return(t.__headerState&e)===e?t.__headerState-=e:t.__headerState+=e,t}hasHeaderState(e){return(this.getHeaderStyles()&e)===e}hasHeader(){return this.getLatest().__headerState!==$i.NO_STATUS}updateDOM(e){return e.__headerState!==this.__headerState||e.__width!==this.__width||e.__colSpan!==this.__colSpan||e.__rowSpan!==this.__rowSpan||e.__backgroundColor!==this.__backgroundColor||e.__verticalAlign!==this.__verticalAlign}isShadowRoot(){return!0}collapseAtStart(){return!0}canBeEmpty(){return!1}canIndent(){return!1}};function Hu(n){return n==="middle"||n==="bottom"}function vp(n){const e=n,t=n.nodeName.toLowerCase();let r;ff.test(e.style.width)&&(r=parseFloat(e.style.width));const i=E_(t==="th"?$i.ROW:$i.NO_STATUS,e.colSpan,r);i.__rowSpan=e.rowSpan;const s=e.style.backgroundColor;s!==""&&(i.__backgroundColor=s);const o=e.style.verticalAlign;Hu(o)&&(i.__verticalAlign=o);const a=e.style,l=(a&&a.textDecoration||"").split(" "),c=a.fontWeight==="700"||a.fontWeight==="bold",u=l.includes("line-through"),f=a.fontStyle==="italic",d=l.includes("underline");return{after:h=>{const g=[];let m=null;const y=()=>{if(m){const b=m.getFirstChild();Dr(b)&&m.getChildrenSize()===1&&b.remove()}};for(const b of h)ax(b)||W(b)||Dr(b)?(W(b)&&(c&&b.toggleFormat("bold"),u&&b.toggleFormat("strikethrough"),f&&b.toggleFormat("italic"),d&&b.toggleFormat("underline")),m?m.append(b):(m=It().append(b),g.push(m))):(g.push(b),y(),m=null);return y(),g.length===0&&g.push(It()),g},node:i}}function E_(n=$i.NO_STATUS,e=1,t){return Ae(new hf(n,e,t))}function $t(n){return n instanceof hf}function qe(n,...e){const t=new URL("https://lexical.dev/docs/error"),r=new URLSearchParams;r.append("code",n);for(const i of e)r.append("v",i);throw t.search=r.toString(),Error(`Minified Lexical error #${n}; visit ${t.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}let N_=class M_ extends pt{static getType(){return"tablerow"}static clone(e){return new M_(e.__height,e.__key)}static importDOM(){return{tr:e=>({conversion:JC,priority:0})}}static importJSON(e){return A_().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setHeight(e.height)}constructor(e,t){super(t),this.__height=e}exportJSON(){const e=this.getHeight();return{...super.exportJSON(),...e===void 0?void 0:{height:e}}}createDOM(e){const t=document.createElement("tr");return this.__height&&(t.style.height=`${this.__height}px`),ct(t,e.theme.tableRow),t}extractWithChild(e,t,r){return r==="html"}isShadowRoot(){return!0}setHeight(e){const t=this.getWritable();return t.__height=e,t}getHeight(){return this.getLatest().__height}updateDOM(e){return e.__height!==this.__height}canBeEmpty(){return!1}canIndent(){return!1}};function JC(n){const e=n;let t;return ff.test(e.style.height)&&(t=parseFloat(e.style.height)),{after:r=>c_(r,$t),node:A_(t)}}function A_(n){return Ae(new N_(n))}function Ao(n){return n instanceof N_}const O_=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,VC=O_&&"documentMode"in document?document.documentMode:null;O_&&"InputEvent"in window&&!VC&&new window.InputEvent("input");function GC(n,e,t){const[r,i,s]=$_(n,e,t);return i===null&&qe(207),s===null&&qe(208),[r,i,s]}function $_(n,e,t){const r=[];let i=null,s=null;function o(l){let c=r[l];return c===void 0&&(r[l]=c=[]),c}const a=n.getChildren();for(let l=0;l<a.length;l++){const c=a[l];Ao(c)||qe(209);const u=o(l);for(let f=c.getFirstChild(),d=0;f!=null;f=f.getNextSibling()){for($t(f)||qe(147);u[d]!==void 0;)d++;const h={cell:f,startColumn:d,startRow:l},{__rowSpan:g,__colSpan:m}=f;for(let y=0;y<g&&!(l+y>=a.length);y++){const b=o(l+y);for(let _=0;_<m;_++)b[d+_]=h}e!==null&&i===null&&e.is(f)&&(i=h),t!==null&&s===null&&t.is(f)&&(s=h)}}return[r,i,s]}function YC(n){let e;if(n instanceof hf)e=n;else if("__type"in n){const i=en(n,$t);$t(i)||qe(148),e=i}else{const i=en(n.getNode(),$t);$t(i)||qe(148),e=i}const t=e.getParent();Ao(t)||qe(149);const r=t.getParent();return L_(r)||qe(210),[e,t,r]}function XC(n,e,t){let r,i=Math.min(e.startColumn,t.startColumn),s=Math.min(e.startRow,t.startRow),o=Math.max(e.startColumn+e.cell.__colSpan-1,t.startColumn+t.cell.__colSpan-1),a=Math.max(e.startRow+e.cell.__rowSpan-1,t.startRow+t.cell.__rowSpan-1);do{r=!1;for(let l=0;l<n.length;l++)for(let c=0;c<n[0].length;c++){const u=n[l][c];if(!u)continue;const f=u.startColumn+u.cell.__colSpan-1,d=u.startRow+u.cell.__rowSpan-1,h=u.startColumn<=o&&f>=i,g=u.startRow<=a&&d>=s;if(h&&g){const m=Math.min(i,u.startColumn),y=Math.max(o,f),b=Math.min(s,u.startRow),_=Math.max(a,d);m===i&&y===o&&b===s&&_===a||(i=m,o=y,s=b,a=_,r=!0)}}}while(r);return{maxColumn:o,maxRow:a,minColumn:i,minRow:s}}function kp(n){const[e,,t]=YC(n),r=t.getChildren(),i=r.length,s=r[0].getChildren().length,o=new Array(i);for(let a=0;a<i;a++)o[a]=new Array(s);for(let a=0;a<i;a++){const l=r[a].getChildren();let c=0;for(let u=0;u<l.length;u++){for(;o[a][c];)c++;const f=l[u],d=f.__rowSpan||1,h=f.__colSpan||1;for(let g=0;g<d;g++)for(let m=0;m<h;m++)o[a+g][c+m]=f;if(e===f)return{colSpan:h,columnIndex:c,rowIndex:a,rowSpan:d};c+=h}}return null}function wp(n){const[[e,t,r,i],[s,o,a,l]]=["anchor","focus"].map(c=>{const u=n[c].getNode(),f=en(u,$t);$t(f)||qe(238,c,u.getKey(),u.getType());const d=f.getParent();Ao(d)||qe(239,c);const h=d.getParent();return L_(h)||qe(240,c),[u,f,d,h]});return i.is(l)||qe(241),{anchorCell:t,anchorNode:e,anchorRow:r,anchorTable:i,focusCell:o,focusNode:s,focusRow:a,focusTable:l}}let QC=class I_{constructor(e,t,r){this.anchor=t,this.focus=r,t._selection=this,r._selection=this,this._cachedNodes=null,this.dirty=!1,this.tableKey=e}getStartEndPoints(){return[this.anchor,this.focus]}isValid(){return this.tableKey!=="root"&&this.anchor.key!=="root"&&this.anchor.type==="element"&&this.focus.key!=="root"&&this.focus.type==="element"}isBackward(){return this.focus.isBefore(this.anchor)}getCachedNodes(){return this._cachedNodes}setCachedNodes(e){this._cachedNodes=e}is(e){return P_(e)&&this.tableKey===e.tableKey&&this.anchor.is(e.anchor)&&this.focus.is(e.focus)}set(e,t,r){this.dirty=this.dirty||e!==this.tableKey||t!==this.anchor.key||r!==this.focus.key,this.tableKey=e,this.anchor.key=t,this.focus.key=r,this._cachedNodes=null}clone(){return new I_(this.tableKey,St(this.anchor.key,this.anchor.offset,this.anchor.type),St(this.focus.key,this.focus.offset,this.focus.type))}isCollapsed(){return!1}extract(){return this.getNodes()}insertRawText(e){}insertText(){}hasFormat(e){let t=0;this.getNodes().filter($t).forEach(i=>{const s=i.getFirstChild();Yd(s)&&(t|=s.getTextFormat())});const r=lr[e];return!!(t&r)}insertNodes(e){const t=this.focus.getNode();F(t)||qe(151),to(t.select(0,t.getChildrenSize())).insertNodes(e)}getShape(){const{anchorCell:e,focusCell:t}=wp(this),r=kp(e);r===null&&qe(153);const i=kp(t);i===null&&qe(155);const s=Math.min(r.columnIndex,i.columnIndex),o=Math.max(r.columnIndex+r.colSpan-1,i.columnIndex+i.colSpan-1),a=Math.min(r.rowIndex,i.rowIndex),l=Math.max(r.rowIndex+r.rowSpan-1,i.rowIndex+i.rowSpan-1);return{fromX:Math.min(s,o),fromY:Math.min(a,l),toX:Math.max(s,o),toY:Math.max(a,l)}}getNodes(){if(!this.isValid())return[];const e=this._cachedNodes;if(e!==null)return e;const{anchorTable:t,anchorCell:r,focusCell:i}=wp(this),s=i.getParents()[1];if(s!==t){if(t.isParentOf(i)){const y=s.getParent();y==null&&qe(159),this.set(this.tableKey,i.getKey(),y.getKey())}else{const y=t.getParent();y==null&&qe(158),this.set(this.tableKey,y.getKey(),i.getKey())}return this.getNodes()}const[o,a,l]=GC(t,r,i),{minColumn:c,maxColumn:u,minRow:f,maxRow:d}=XC(o,a,l),h=new Map([[t.getKey(),t]]);let g=null;for(let y=f;y<=d;y++)for(let b=c;b<=u;b++){const{cell:_}=o[y][b],w=_.getParent();Ao(w)||qe(160),w!==g&&(h.set(w.getKey(),w),g=w),h.has(_.getKey())||ZC(_,T=>{h.set(T.getKey(),T)})}const m=Array.from(h.values());return is()||(this._cachedNodes=m),m}getTextContent(){const e=this.getNodes().filter(r=>$t(r));let t="";for(let r=0;r<e.length;r++){const i=e[r],s=i.__parent,o=(e[r+1]||{}).__parent;t+=i.getTextContent()+(o!==s?`
`:"	")}return t}};function P_(n){return n instanceof QC}function ZC(n,e){const t=[[n]];for(let r=t.at(-1);r!==void 0&&t.length>0;r=t.at(-1)){const i=r.pop();i===void 0?t.pop():e(i)!==!1&&F(i)&&t.push(i.getChildren())}}function Ps(n){return Ne(n)&&n.nodeName==="TABLE"}function e0(n,e){for(let t=e,r=null;t!==null;t=t.getParent()){if(n.is(t))return r;$t(t)&&(r=t)}return null}function t0(n,e,t){return e0(n,ur(e,t))}function xp(n,e,t){if(!e.theme.tableAlignment)return;const r=[],i=[];for(const s of["center","right"]){const o=e.theme.tableAlignment[s];o&&(s===t?i:r).push(o)}Br(n,...r),ct(n,...i)}const n0=new WeakSet;function Cp(n=Ul()){return n0.has(n)}let R_=class j_ extends pt{static getType(){return"table"}getColWidths(){return this.getLatest().__colWidths}setColWidths(e){const t=this.getWritable();return t.__colWidths=e,t}static clone(e){return new j_(e.__key)}afterCloneFrom(e){super.afterCloneFrom(e),this.__colWidths=e.__colWidths,this.__rowStriping=e.__rowStriping,this.__frozenColumnCount=e.__frozenColumnCount,this.__frozenRowCount=e.__frozenRowCount}static importDOM(){return{table:e=>({conversion:r0,priority:1})}}static importJSON(e){return D_().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setRowStriping(e.rowStriping||!1).setFrozenColumns(e.frozenColumnCount||0).setFrozenRows(e.frozenRowCount||0).setColWidths(e.colWidths)}constructor(e){super(e),this.__rowStriping=!1,this.__frozenColumnCount=0,this.__frozenRowCount=0}exportJSON(){return{...super.exportJSON(),colWidths:this.getColWidths(),frozenColumnCount:this.__frozenColumnCount?this.__frozenColumnCount:void 0,frozenRowCount:this.__frozenRowCount?this.__frozenRowCount:void 0,rowStriping:this.__rowStriping?this.__rowStriping:void 0}}extractWithChild(e,t,r){return r==="html"}getDOMSlot(e){const t=Ps(e)?e:e.querySelector("table");return Ps(t)||qe(229),super.getDOMSlot(e).withElement(t).withAfter(t.querySelector("colgroup"))}createDOM(e,t){const r=document.createElement("table");this.__style&&(r.style.cssText=this.__style);const i=document.createElement("colgroup");if(r.appendChild(i),hx(i),ct(r,e.theme.table),this.updateTableElement(null,r,e),Cp(t)){const s=document.createElement("div"),o=e.theme.tableScrollableWrapper;return o?ct(s,o):s.style.cssText="overflow-x: auto;",s.appendChild(r),this.updateTableWrapper(null,s,r,e),s}return r}updateTableWrapper(e,t,r,i){this.__frozenColumnCount!==(e?e.__frozenColumnCount:0)&&function(s,o,a,l){l>0?(ct(s,a.theme.tableFrozenColumn),o.setAttribute("data-lexical-frozen-column","true")):(Br(s,a.theme.tableFrozenColumn),o.removeAttribute("data-lexical-frozen-column"))}(t,r,i,this.__frozenColumnCount),this.__frozenRowCount!==(e?e.__frozenRowCount:0)&&function(s,o,a,l){l>0?(ct(s,a.theme.tableFrozenRow),o.setAttribute("data-lexical-frozen-row","true")):(Br(s,a.theme.tableFrozenRow),o.removeAttribute("data-lexical-frozen-row"))}(t,r,i,this.__frozenRowCount)}updateTableElement(e,t,r){this.__style!==(e?e.__style:"")&&(t.style.cssText=this.__style),this.__rowStriping!==(!!e&&e.__rowStriping)&&function(i,s,o){o?(ct(i,s.theme.tableRowStriping),i.setAttribute("data-lexical-row-striping","true")):(Br(i,s.theme.tableRowStriping),i.removeAttribute("data-lexical-row-striping"))}(t,r,this.__rowStriping),function(i,s,o,a){const l=i.querySelector("colgroup");if(!l)return;const c=[];for(let u=0;u<o;u++){const f=document.createElement("col"),d=a&&a[u];d&&(f.style.width=`${d}px`),c.push(f)}l.replaceChildren(...c)}(t,0,this.getColumnCount(),this.getColWidths()),xp(t,r,this.getFormatType())}updateDOM(e,t,r){const i=this.getDOMSlot(t).element;return t===i===Cp()||(Ne(s=t)&&s.nodeName==="DIV"&&this.updateTableWrapper(e,t,i,r),this.updateTableElement(e,i,r),!1);var s}exportDOM(e){const t=super.exportDOM(e),{element:r}=t;return{after:i=>{if(t.after&&(i=t.after(i)),!Ps(i)&&Ne(i)&&(i=i.querySelector("table")),!Ps(i))return null;xp(i,e._config,this.getFormatType());const[s]=$_(this,null,null),o=new Map;for(const u of s)for(const f of u){const d=f.cell.getKey();o.has(d)||o.set(d,{colSpan:f.cell.getColSpan(),startColumn:f.startColumn})}const a=new Set;for(const u of i.querySelectorAll(":scope > tr > [data-temporary-table-cell-lexical-key]")){const f=u.getAttribute("data-temporary-table-cell-lexical-key");if(f){const d=o.get(f);if(u.removeAttribute("data-temporary-table-cell-lexical-key"),d){o.delete(f);for(let h=0;h<d.colSpan;h++)a.add(h+d.startColumn)}}}const l=i.querySelector(":scope > colgroup");if(l){const u=Array.from(i.querySelectorAll(":scope > colgroup > col")).filter((f,d)=>a.has(d));l.replaceChildren(...u)}const c=i.querySelectorAll(":scope > tr");if(c.length>0){const u=document.createElement("tbody");for(const f of c)u.appendChild(f);i.append(u)}return i},element:!Ps(r)&&Ne(r)?r.querySelector("table"):r}}canBeEmpty(){return!1}isShadowRoot(){return!0}getCordsFromCellNode(e,t){const{rows:r,domRows:i}=t;for(let s=0;s<r;s++){const o=i[s];if(o!=null)for(let a=0;a<o.length;a++){const l=o[a];if(l==null)continue;const{elem:c}=l,u=t0(this,c);if(u!==null&&e.is(u))return{x:a,y:s}}}throw new Error("Cell not found in table.")}getDOMCellFromCords(e,t,r){const{domRows:i}=r,s=i[t];if(s==null)return null;const o=s[e<s.length?e:s.length-1];return o??null}getDOMCellFromCordsOrThrow(e,t,r){const i=this.getDOMCellFromCords(e,t,r);if(!i)throw new Error("Cell not found at cords.");return i}getCellNodeFromCords(e,t,r){const i=this.getDOMCellFromCords(e,t,r);if(i==null)return null;const s=ur(i.elem);return $t(s)?s:null}getCellNodeFromCordsOrThrow(e,t,r){const i=this.getCellNodeFromCords(e,t,r);if(!i)throw new Error("Node at cords not TableCellNode.");return i}getRowStriping(){return!!this.getLatest().__rowStriping}setRowStriping(e){const t=this.getWritable();return t.__rowStriping=e,t}setFrozenColumns(e){const t=this.getWritable();return t.__frozenColumnCount=e,t}getFrozenColumns(){return this.getLatest().__frozenColumnCount}setFrozenRows(e){const t=this.getWritable();return t.__frozenRowCount=e,t}getFrozenRows(){return this.getLatest().__frozenRowCount}canSelectBefore(){return!0}canIndent(){return!1}getColumnCount(){const e=this.getFirstChild();if(!e)return 0;let t=0;return e.getChildren().forEach(r=>{$t(r)&&(t+=r.getColSpan())}),t}};function r0(n){const e=D_();n.hasAttribute("data-lexical-row-striping")&&e.setRowStriping(!0),n.hasAttribute("data-lexical-frozen-column")&&e.setFrozenColumns(1),n.hasAttribute("data-lexical-frozen-row")&&e.setFrozenRows(1);const t=n.querySelector(":scope > colgroup");if(t){let r=[];for(const i of t.querySelectorAll(":scope > col")){let s=i.style.width||"";if(!ff.test(s)&&(s=i.getAttribute("width")||"",!/^\d+$/.test(s))){r=void 0;break}r.push(parseFloat(s))}r&&e.setColWidths(r)}return{after:r=>c_(r,Ao),node:e}}function D_(){return Ae(new R_)}function L_(n){return n instanceof R_}const F_=Object.freeze({"	":"\\t","\n":"\\n"}),Sp=new RegExp(Object.keys(F_).join("|"),"g"),hn=Object.freeze({ancestorHasNextSibling:"|",ancestorIsLastChild:" ",hasNextSibling:"├",isLastChild:"└",selectedChar:"^",selectedLine:">"}),i0=[n=>n.hasFormat("bold")&&"Bold",n=>n.hasFormat("code")&&"Code",n=>n.hasFormat("italic")&&"Italic",n=>n.hasFormat("strikethrough")&&"Strikethrough",n=>n.hasFormat("subscript")&&"Subscript",n=>n.hasFormat("superscript")&&"Superscript",n=>n.hasFormat("underline")&&"Underline",n=>n.hasFormat("highlight")&&"Highlight"],s0=[n=>n.hasTextFormat("bold")&&"Bold",n=>n.hasTextFormat("code")&&"Code",n=>n.hasTextFormat("italic")&&"Italic",n=>n.hasTextFormat("strikethrough")&&"Strikethrough",n=>n.hasTextFormat("subscript")&&"Subscript",n=>n.hasTextFormat("superscript")&&"Superscript",n=>n.hasTextFormat("underline")&&"Underline",n=>n.hasTextFormat("highlight")&&"Highlight"],o0=[n=>n.isDirectionless()&&"Directionless",n=>n.isUnmergeable()&&"Unmergeable"],a0=[n=>n.isToken()&&"Token",n=>n.isSegmented()&&"Segmented"];function l0(n,e,t,r,i=!1){const s=n.getEditorState(),o=n._config,a=n._compositionKey,l=n._editable;if(t){let d="";return s.read(()=>{d=function(h){const g=document.createElement("div");return g.innerHTML=h.trim(),B_(g,0).innerHTML}(g_(n))}),d}let c=` root
`;const u=s.read(()=>{const d=K();return q_(ye(),(h,g)=>{const m=`(${h.getKey()})`,y=h.getType()||"",b=h.isSelected();c+=`${b?hn.selectedLine:" "} ${g.join(" ")} ${m} ${y} ${function(_,w,T=!1){const O=w?w(_,T):void 0;if(O!==void 0&&O.length>0)return O;if(W(_)){const M=_.getTextContent(),j=M.length===0?"(empty)":`"${Tp(M,T)}"`,A=function($){return[Ep($),c0($),u0($),Np($)].filter(Boolean).join(", ")}(_);return[j,A.length!==0?`{ ${A} }`:null].filter(Boolean).join(" ").trim()}if(LC(_)){const M=_.getURL(),j=M.length===0?"(empty)":`"${Tp(M,T)}"`,A=function($){return[d0($),f0($),h0($),Np($)].filter(Boolean).join(", ")}(_);return[j,A.length!==0?`{ ${A} }`:null].filter(Boolean).join(" ").trim()}if(qC(_))return`ids: [ ${_.getIDs().join(", ")} ]`;if(Yd(_)){const M=function(A){let $=s0.map(B=>B(A)).filter(Boolean).join(", ").toLocaleLowerCase();return $!==""&&($="format: "+$),$}(_);let j=M!==""?`{ ${M} }`:"";return j+=_.__style?`(${_.__style})`:"",j}return""}(h,r,i)}
`,c+=function({indent:_,isSelected:w,node:T,nodeKeyDisplay:O,selection:M,typeDisplay:j}){if(!W(T)||!q(M)||!w||F(T))return"";const A=M.anchor,$=M.focus;if(T.getTextContent()===""||A.getNode()===M.focus.getNode()&&A.offset===$.offset)return"";const[B,C]=function(H,V){const G=V.getStartEndPoints();if(mt(V)||G===null)return[-1,-1];const[ee,Q]=G,re=H.getTextContent(),oe=re.length;let X=-1,fe=-1;if(ee.type==="text"&&Q.type==="text"){const ue=ee.getNode(),he=Q.getNode();ue===he&&H===ue&&ee.offset!==Q.offset?[X,fe]=ee.offset<Q.offset?[ee.offset,Q.offset]:[Q.offset,ee.offset]:[X,fe]=H===ue?ue.isBefore(he)?[ee.offset,oe]:[0,ee.offset]:H===he?he.isBefore(ue)?[Q.offset,oe]:[0,Q.offset]:[0,oe]}const ve=(re.slice(0,X).match(Sp)||[]).length,se=(re.slice(X,fe).match(Sp)||[]).length;return[X+ve,fe+ve+se]}(T,M);if(B===C)return"";const N=_[_.length-1]===hn.hasNextSibling?hn.ancestorHasNextSibling:hn.ancestorIsLastChild,S=[..._.slice(0,_.length-1),N],R=Array(B+1).fill(" "),L=Array(C-B).fill(hn.selectedChar),D=j.length+2,z=Array(O.length+D).fill(" ");return[hn.selectedLine,S.join(" "),[...z,...R,...L].join("")].join(" ")+`
`}({indent:g,isSelected:b,node:h,nodeKeyDisplay:m,selection:d,typeDisplay:y})}),d===null?": null":q(d)?function(h){let g="";const m=Ep(h);g+=`: range ${m!==""?`{ ${m} }`:""} ${h.style!==""?`{ style: ${h.style} } `:""}`;const y=h.anchor,b=h.focus,_=y.offset,w=b.offset;return g+=`
  ├ anchor { key: ${y.key}, offset: ${_===null?"null":_}, type: ${y.type} }`,g+=`
  └ focus { key: ${b.key}, offset: ${w===null?"null":w}, type: ${b.type} }`,g}(d):P_(d)?function(h){return`: table
  └ { table: ${h.tableKey}, anchorCell: ${h.anchor.key}, focusCell: ${h.focus.key} }`}(d):function(h){return mt(h)?`: node
  └ [${Array.from(h._nodes).join(", ")}]`:""}(d)});if(c+=`
 selection`+u,c+=`

 commands:`,e.length)for(const{index:d,type:h,payload:g}of e)c+=`
  └ ${d}. { type: ${h}, payload: ${g instanceof Event?g.constructor.name:g} }`;else c+=`
  └ None dispatched.`;const{version:f}=n.constructor;return c+=`

 editor${f?` (v${f})`:""}:`,c+=`
  └ namespace ${o.namespace}`,a!==null&&(c+=`
  └ compositionKey ${a}`),c+=`
  └ editable ${String(l)}`,c}function q_(n,e,t=[]){const r=n.getChildren(),i=r.length;r.forEach((s,o)=>{e(s,t.concat(o===i-1?hn.isLastChild:hn.hasNextSibling)),F(s)&&q_(s,e,t.concat(o===i-1?hn.ancestorIsLastChild:hn.ancestorHasNextSibling))})}function Tp(n,e=!1){const t=Object.entries(F_).reduce((r,[i,s])=>r.replace(new RegExp(i,"g"),String(s)),n);return e?t.replace(/[^\s]/g,"*"):t}function c0(n){let e=o0.map(t=>t(n)).filter(Boolean).join(", ").toLocaleLowerCase();return e!==""&&(e="detail: "+e),e}function u0(n){let e=a0.map(t=>t(n)).filter(Boolean).join(", ").toLocaleLowerCase();return e!==""&&(e="mode: "+e),e}function Ep(n){let e=i0.map(t=>t(n)).filter(Boolean).join(", ").toLocaleLowerCase();return e!==""&&(e="format: "+e),e}function d0(n){let e=n.getTarget();return e!=null&&(e="target: "+e),e}function f0(n){let e=n.getRel();return e!=null&&(e="rel: "+e),e}function h0(n){let e=n.getTitle();return e!=null&&(e="title: "+e),e}function Np(n){if(!n.__state)return!1;const e=[];for(const[r,i]of n.__state.knownState.entries()){if(r.isEqual(i,r.defaultValue))continue;const s=JSON.stringify(r.unparse(i));e.push(`[${r.key}: ${s}]`)}let t=e.join(",");return t!==""&&(t="state: "+t),t}function B_(n,e){const t=new Array(1+e++).join("  "),r=new Array(e-1).join("  ");let i;for(let s=0;s<n.children.length;s++)i=document.createTextNode(`
`+t),n.insertBefore(i,n.children[s]),B_(n.children[s],e),n.lastElementChild===n.children[s]&&(i=document.createTextNode(`
`+r),n.appendChild(i));return n}const p0=x.forwardRef(function({treeTypeButtonClassName:n,timeTravelButtonClassName:e,timeTravelPanelSliderClassName:t,timeTravelPanelButtonClassName:r,viewClassName:i,timeTravelPanelClassName:s,editorState:o,setEditorState:a,setEditorReadOnly:l,generateContent:c,commandsLog:u=[]},f){const[d,h]=x.useState([]),[g,m]=x.useState(""),[y,b]=x.useState(!1),[_,w]=x.useState(!1),T=x.useRef(0),O=x.useRef(null),[M,j]=x.useState(!1),[A,$]=x.useState(!1),[B,C]=x.useState(!1),N=x.useRef(),S=x.useRef([]),R=x.useRef(0),L=x.useCallback(z=>{const H=++R.current;c(z).then(V=>{H===R.current&&m(V)}).catch(V=>{H===R.current&&m(`Error rendering tree: ${V.message}

Stack:
${V.stack}`)})},[c]);x.useEffect(()=>{if(!(!B&&o._nodeMap.size>1e3&&($(!0),!B))&&(N.current!==o||S.current!==u)){const z=N.current!==o;N.current=o,S.current=u,L(_),!y&&z&&h(H=>[...H,[Date.now(),o]])}},[o,L,_,B,y,u]);const D=d.length;return x.useEffect(()=>{if(M){let z;const H=()=>{const V=T.current;if(V===D-1)return void j(!1);const G=d[V][0],ee=d[V+1][0];z=setTimeout(()=>{T.current++;const Q=T.current,re=O.current;re!==null&&(re.value=String(Q)),a(d[Q][1]),H()},ee-G)};return H(),()=>{clearTimeout(z)}}},[d,M,D,a]),v.jsxs("div",{className:i,children:[!B&&A?v.jsxs("div",{style:{padding:20},children:[v.jsx("span",{style:{marginRight:20},children:"Detected large EditorState, this can impact debugging performance."}),v.jsx("button",{onClick:()=>{C(!0)},style:{background:"transparent",border:"1px solid white",color:"white",cursor:"pointer",padding:5},children:"Show full tree"})]}):null,B?null:v.jsx("button",{onClick:()=>(L(!_),void w(!_)),className:n,type:"button",children:_?"Tree":"Export DOM"}),!y&&(B||!A)&&D>2&&v.jsx("button",{onClick:()=>{l(!0),T.current=D-1,b(!0)},className:e,type:"button",children:"Time Travel"}),(B||!A)&&v.jsx("pre",{ref:f,children:g}),y&&(B||!A)&&v.jsxs("div",{className:s,children:[v.jsx("button",{className:r,onClick:()=>{T.current===D-1&&(T.current=1),j(!M)},type:"button",children:M?"Pause":"Play"}),v.jsx("input",{className:t,ref:O,onChange:z=>{const H=Number(z.target.value),V=d[H];V&&(T.current=H,a(V[1]))},type:"range",min:"1",max:D-1}),v.jsx("button",{className:r,onClick:()=>{l(!1);const z=d.length-1,H=d[z];a(H[1]);const V=O.current;V!==null&&(V.value=String(z)),b(!1),j(!1)},type:"button",children:"Exit"})]})]})});function g0(n,e){const t=new Set;let r=0;for(const[i]of n._commands)t.add(n.registerCommand(i,s=>(e(o=>{r+=1;const a=[...o];return a.push({index:r,payload:s,type:i.type?i.type:"UNKNOWN"}),a.length>10&&a.shift(),a}),!1),Ai));return()=>t.forEach(i=>i())}function m0(n){const[e,t]=x.useState([]);return x.useEffect(()=>g0(n,t),[n]),x.useMemo(()=>e,[e])}function y0({treeTypeButtonClassName:n,timeTravelButtonClassName:e,timeTravelPanelSliderClassName:t,timeTravelPanelButtonClassName:r,timeTravelPanelClassName:i,viewClassName:s,editor:o,customPrintNode:a}){const l=x.createRef(),[c,u]=x.useState(o.getEditorState()),f=m0(o);return x.useEffect(()=>Ue(o.registerUpdateListener(({editorState:d})=>{u(d)}),o.registerEditableListener(()=>{u(o.getEditorState())})),[o]),x.useEffect(()=>{const d=l.current;if(d!==null)return d.__lexicalEditor=o,()=>{d.__lexicalEditor=null}},[o,l]),v.jsx(p0,{treeTypeButtonClassName:n,timeTravelButtonClassName:e,timeTravelPanelSliderClassName:t,timeTravelPanelButtonClassName:r,viewClassName:s,timeTravelPanelClassName:i,setEditorReadOnly:d=>{const h=o.getRootElement();h!=null&&(h.contentEditable=d?"false":"true")},editorState:c,setEditorState:d=>o.setEditorState(d),generateContent:async function(d){return l0(o,f,d,a)},ref:l,commandsLog:f})}const U_=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,_0=U_?x.useLayoutEffect:x.useEffect,pa={tag:Lr};function z_({initialConfig:n,children:e}){const t=x.useMemo(()=>{const{theme:r,namespace:i,nodes:s,onError:o,editorState:a,html:l}=n,c=IC(null,r),u=Zw({editable:n.editable,html:l,namespace:i,nodes:s,onError:f=>o(f,u),theme:r});return function(f,d){if(d!==null){if(d===void 0)f.update(()=>{const h=ye();if(h.isEmpty()){const g=It();h.append(g);const m=U_?document.activeElement:null;(K()!==null||m!==null&&m===f.getRootElement())&&g.select()}},pa);else if(d!==null)switch(typeof d){case"string":{const h=f.parseEditorState(d);f.setEditorState(h,pa);break}case"object":f.setEditorState(d,pa);break;case"function":f.update(()=>{ye().isEmpty()&&d(f)},pa)}}}(u,a),[u,c]},[]);return _0(()=>{const r=n.editable,[i]=t;i.setEditable(r===void 0||r)},[]),v.jsx(p_.Provider,{value:t,children:e})}function W_(){return ye().getTextContent()}function K_(n,e=!0){if(n)return!1;let t=W_();return e&&(t=t.trim()),t===""}function b0(n){if(!K_(n,!1))return!1;const e=ye().getChildren(),t=e.length;if(t>1)return!1;for(let r=0;r<t;r++){const i=e[r];if(ke(i))return!1;if(F(i)){if(!Yd(i)||i.__indent!==0)return!1;const s=i.getChildren(),o=s.length;for(let a=0;a<o;a++){const l=s[r];if(!W(l))return!1}}}return!0}function pf(n){return()=>b0(n)}const H_=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0?x.useLayoutEffect:x.useEffect;function v0({editor:n,ariaActiveDescendant:e,ariaAutoComplete:t,ariaControls:r,ariaDescribedBy:i,ariaErrorMessage:s,ariaExpanded:o,ariaInvalid:a,ariaLabel:l,ariaLabelledBy:c,ariaMultiline:u,ariaOwns:f,ariaRequired:d,autoCapitalize:h,className:g,id:m,role:y="textbox",spellCheck:b=!0,style:_,tabIndex:w,"data-testid":T,...O},M){const[j,A]=x.useState(n.isEditable()),$=x.useCallback(C=>{C&&C.ownerDocument&&C.ownerDocument.defaultView?n.setRootElement(C):n.setRootElement(null)},[n]),B=x.useMemo(()=>function(...C){return N=>{C.forEach(S=>{typeof S=="function"?S(N):S!=null&&(S.current=N)})}}(M,$),[$,M]);return H_(()=>(A(n.isEditable()),n.registerEditableListener(C=>{A(C)})),[n]),v.jsx("div",{"aria-activedescendant":j?e:void 0,"aria-autocomplete":j?t:"none","aria-controls":j?r:void 0,"aria-describedby":i,...s!=null?{"aria-errormessage":s}:{},"aria-expanded":j&&y==="combobox"?!!o:void 0,...a!=null?{"aria-invalid":a}:{},"aria-label":l,"aria-labelledby":c,"aria-multiline":u,"aria-owns":j?f:void 0,"aria-readonly":!j||void 0,"aria-required":d,autoCapitalize:h,className:g,contentEditable:j,"data-testid":T,id:m,ref:B,role:y,spellCheck:b,style:_,tabIndex:w,...O})}const k0=x.forwardRef(v0);function Mp(n){return n.getEditorState().read(pf(n.isComposing()))}const J_=x.forwardRef(w0);function w0(n,e){const{placeholder:t,...r}=n,[i]=pe();return v.jsxs(v.Fragment,{children:[v.jsx(k0,{editor:i,...r,ref:e}),t!=null&&v.jsx(x0,{editor:i,content:t})]})}function x0({content:n,editor:e}){const t=function(o){const[a,l]=x.useState(()=>Mp(o));return H_(()=>{function c(){const u=Mp(o);l(u)}return c(),Ue(o.registerUpdateListener(()=>{c()}),o.registerEditableListener(()=>{c()}))},[o]),a}(e),[r,i]=x.useState(e.isEditable());if(x.useLayoutEffect(()=>(i(e.isEditable()),e.registerEditableListener(o=>{i(o)})),[e]),!t)return null;let s=null;return typeof n=="function"?s=n(r):n!==null&&(s=n),s===null?null:v.jsx("div",{"aria-hidden":!0,children:s})}function V_({editorRef:n}){const[e]=pe();return x.useEffect(()=>{typeof n=="function"?n(e):typeof n=="object"&&(n.current=e)},[e]),null}function Ju(n,e){return Ju=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},Ju(n,e)}var Ap={error:null},C0=function(n){var e,t;function r(){for(var s,o=arguments.length,a=new Array(o),l=0;l<o;l++)a[l]=arguments[l];return(s=n.call.apply(n,[this].concat(a))||this).state=Ap,s.resetErrorBoundary=function(){for(var c,u=arguments.length,f=new Array(u),d=0;d<u;d++)f[d]=arguments[d];s.props.onReset==null||(c=s.props).onReset.apply(c,f),s.reset()},s}t=n,(e=r).prototype=Object.create(t.prototype),e.prototype.constructor=e,Ju(e,t),r.getDerivedStateFromError=function(s){return{error:s}};var i=r.prototype;return i.reset=function(){this.setState(Ap)},i.componentDidCatch=function(s,o){var a,l;(a=(l=this.props).onError)==null||a.call(l,s,o)},i.componentDidUpdate=function(s,o){var a,l,c,u,f=this.state.error,d=this.props.resetKeys;f!==null&&o.error!==null&&((c=s.resetKeys)===void 0&&(c=[]),(u=d)===void 0&&(u=[]),c.length!==u.length||c.some(function(h,g){return!Object.is(h,u[g])}))&&((a=(l=this.props).onResetKeysChange)==null||a.call(l,s.resetKeys,d),this.reset())},i.render=function(){var s=this.state.error,o=this.props,a=o.fallbackRender,l=o.FallbackComponent,c=o.fallback;if(s!==null){var u={error:s,resetErrorBoundary:this.resetErrorBoundary};if(x.isValidElement(c))return c;if(typeof a=="function")return a(u);if(l)return x.createElement(l,u);throw new Error("react-error-boundary requires either a fallback, fallbackRender, or FallbackComponent prop")}return this.props.children},r}(x.Component);function G_({children:n,onError:e}){return v.jsx(C0,{fallback:v.jsx("div",{style:{border:"1px solid #f00",color:"#f00",padding:"8px"},children:"An error was thrown."}),onError:e,children:n})}const ga=0,Vu=1,Gu=2,Kt=0,S0=1,Op=2,T0=3,E0=4;function N0(n,e,t,r,i){if(n===null||t.size===0&&r.size===0&&!i)return Kt;const s=e._selection,o=n._selection;if(i)return S0;if(!(q(s)&&q(o)&&o.isCollapsed()&&s.isCollapsed()))return Kt;const a=function(b,_,w){const T=b._nodeMap,O=[];for(const M of _){const j=T.get(M);j!==void 0&&O.push(j)}for(const[M,j]of w){if(!j)continue;const A=T.get(M);A===void 0||et(A)||O.push(A)}return O}(e,t,r);if(a.length===0)return Kt;if(a.length>1){const b=e._nodeMap,_=b.get(s.anchor.key),w=b.get(o.anchor.key);return _&&w&&!n._nodeMap.has(_.__key)&&W(_)&&_.__text.length===1&&s.anchor.offset===1?Op:Kt}const l=a[0],c=n._nodeMap.get(l.__key);if(!W(c)||!W(l)||c.__mode!==l.__mode)return Kt;const u=c.__text,f=l.__text;if(u===f)return Kt;const d=s.anchor,h=o.anchor;if(d.key!==h.key||d.type!=="text")return Kt;const g=d.offset,m=h.offset,y=f.length-u.length;return y===1&&m===g-1?Op:y===-1&&m===g+1?T0:y===-1&&m===g?E0:Kt}function M0(n,e){let t=Date.now(),r=Kt;return(i,s,o,a,l,c)=>{const u=Date.now();if(c.has(Pu))return r=Kt,t=u,Gu;const f=N0(i,s,a,l,n.isComposing()),d=(()=>{const h=o===null||o.editor===n,g=c.has(Vw);if(!g&&h&&c.has(Lr))return ga;if(i===null)return Vu;const m=s._selection;return a.size>0||l.size>0?g===!1&&f!==Kt&&f===r&&u<t+e&&h||a.size===1&&function(y,b,_){const w=b._nodeMap.get(y),T=_._nodeMap.get(y),O=b._selection,M=_._selection;return!(q(O)&&q(M)&&O.anchor.type==="element"&&O.focus.type==="element"&&M.anchor.type==="text"&&M.focus.type==="text"||!W(w)||!W(T)||w.__parent!==T.__parent)&&JSON.stringify(b.read(()=>w.exportJSON()))===JSON.stringify(_.read(()=>T.exportJSON()))}(Array.from(a)[0],i,s)?ga:Vu:m!==null?ga:Gu})();return t=u,r=f,d}}function $p(n){n.undoStack=[],n.redoStack=[],n.current=null}function A0(n,e,t){const r=M0(n,t);return Ue(n.registerCommand(vo,()=>(function(s,o){const a=o.redoStack,l=o.undoStack;if(l.length!==0){const c=o.current,u=l.pop();c!==null&&(a.push(c),s.dispatchCommand(Ds,!0)),l.length===0&&s.dispatchCommand(Ls,!1),o.current=u||null,u&&u.editor.setEditorState(u.editorState,{tag:Pu})}}(n,e),!0),ne),n.registerCommand(ko,()=>(function(s,o){const a=o.redoStack,l=o.undoStack;if(a.length!==0){const c=o.current;c!==null&&(l.push(c),s.dispatchCommand(Ls,!0));const u=a.pop();a.length===0&&s.dispatchCommand(Ds,!1),o.current=u||null,u&&u.editor.setEditorState(u.editorState,{tag:Pu})}}(n,e),!0),ne),n.registerCommand(zd,()=>($p(e),!1),ne),n.registerCommand(uy,()=>($p(e),n.dispatchCommand(Ds,!1),n.dispatchCommand(Ls,!1),!0),ne),n.registerUpdateListener(({editorState:s,prevEditorState:o,dirtyLeaves:a,dirtyElements:l,tags:c})=>{const u=e.current,f=e.redoStack,d=e.undoStack,h=u===null?null:u.editorState;if(u!==null&&s===h)return;const g=r(o,s,u,a,l,c);if(g===Vu)f.length!==0&&(e.redoStack=[],n.dispatchCommand(Ds,!1)),u!==null&&(d.push({...u}),n.dispatchCommand(Ls,!0));else if(g===Gu)return;e.current={editor:n,editorState:s}}))}function O0(){return{current:null,redoStack:[],undoStack:[]}}function Y_({delay:n,externalHistoryState:e}){const[t]=pe();return function(r,i,s=1e3){const o=x.useMemo(()=>i||O0(),[i]);x.useEffect(()=>A0(r,o,s),[s,r,o])}(t,e,n),null}const $0=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0?x.useLayoutEffect:x.useEffect;function I0(n){return{initialValueFn:()=>n.isEditable(),subscribe:e=>n.registerEditableListener(e)}}function X_(){return function(n){const[e]=pe(),t=x.useMemo(()=>n(e),[e,n]),[r,i]=x.useState(()=>t.initialValueFn()),s=x.useRef(r);return $0(()=>{const{initialValueFn:o,subscribe:a}=t,l=o();return s.current!==l&&(s.current=l,i(l)),a(c=>{s.current=c,i(c)})},[t,n]),r}(I0)}function Q_(n){const e=window.location.origin,t=r=>{if(r.origin!==e)return;const i=n.getRootElement();if(document.activeElement!==i)return;const s=r.data;if(typeof s=="string"){let o;try{o=JSON.parse(s)}catch{return}if(o&&o.protocol==="nuanria_messaging"&&o.type==="request"){const a=o.payload;if(a&&a.functionId==="makeChanges"){const l=a.args;if(l){const[c,u,f,d,h,g]=l;n.update(()=>{const m=K();if(q(m)){const y=m.anchor;let b=y.getNode(),_=0,w=0;if(W(b)&&c>=0&&u>=0&&(_=c,w=c+u,m.setTextNodeRange(b,_,b,w)),_===w&&f===""||(m.insertRawText(f),b=y.getNode()),W(b)){_=d,w=d+h;const T=b.getTextContentSize();_=_>T?T:_,w=w>T?T:w,m.setTextNodeRange(b,_,b,w)}r.stopImmediatePropagation()}})}}}}};return window.addEventListener("message",t,!0),()=>{window.removeEventListener("message",t,!0)}}function Ip(n,e){if(document.caretRangeFromPoint!==void 0){const t=document.caretRangeFromPoint(n,e);return t===null?null:{node:t.startContainer,offset:t.startOffset}}if(document.caretPositionFromPoint!=="undefined"){const t=document.caretPositionFromPoint(n,e);return t===null?null:{node:t.offsetNode,offset:t.offset}}return null}const os=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,P0=os&&"documentMode"in document?document.documentMode:null,R0=!(!os||!("InputEvent"in window)||P0)&&"getTargetRanges"in new window.InputEvent("input"),j0=os&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent),Pp=os&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,D0=os&&/^(?=.*Chrome).*/i.test(navigator.userAgent),L0=os&&/AppleWebKit\/[\d.]+/.test(navigator.userAgent)&&!D0,Rp=ie("DRAG_DROP_PASTE_FILE");function ma(n){let e=null;if(Fn(n,DragEvent)?e=n.dataTransfer:Fn(n,ClipboardEvent)&&(e=n.clipboardData),e===null)return[!1,[],!1];const t=e.types,r=t.includes("Files"),i=t.includes("text/html")||t.includes("text/plain");return[r,Array.from(e.files),i]}function jp(n){const e=K();if(!q(e))return!1;const t=new Set,r=e.getNodes();for(let i=0;i<r.length;i++){const s=r[i],o=s.getKey();if(t.has(o))continue;const a=en(s,c=>F(c)&&!c.isInline());if(a===null)continue;const l=a.getKey();a.canIndent()&&!t.has(l)&&(t.add(l),n(a))}return t.size>0}function Dp(n){const e=ur(n);return ke(e)}function ru(n){for(const e of["lowercase","uppercase","capitalize"])n.hasFormat(e)&&n.toggleFormat(e)}function F0(n){return Ue(n.registerCommand(ay,e=>{const t=K();return!!mt(t)&&(t.clear(),!0)},ne),n.registerCommand(mn,e=>{const t=K();return q(t)?(t.deleteCharacter(e),!0):!!mt(t)&&(t.deleteNodes(),!0)},ne),n.registerCommand(Di,e=>{const t=K();return!!q(t)&&(t.deleteWord(e),!0)},ne),n.registerCommand(Li,e=>{const t=K();return!!q(t)&&(t.deleteLine(e),!0)},ne),n.registerCommand(jr,e=>{const t=K();if(typeof e=="string")t!==null&&t.insertText(e);else{if(t===null)return!1;const r=e.dataTransfer;if(r!=null)mp(r,t,n);else if(q(t)){const i=e.data;return i&&t.insertText(i),!0}}return!0},ne),n.registerCommand(rl,()=>{const e=K();return!!q(e)&&(e.removeText(),!0)},ne),n.registerCommand(tr,e=>{const t=K();return!!q(t)&&(t.formatText(e),!0)},ne),n.registerCommand(Mw,e=>{const t=K();if(!q(t)&&!mt(t))return!1;const r=t.getNodes();for(const i of r){const s=en(i,o=>F(o)&&!o.isInline());s!==null&&s.setFormat(e)}return!0},ne),n.registerCommand(sr,e=>{const t=K();return!!q(t)&&(t.insertLineBreak(e),!0)},ne),n.registerCommand(so,()=>{const e=K();return!!q(e)&&(e.insertParagraph(),!0)},ne),n.registerCommand(Ew,()=>(Ww([Co()]),!0),ne),n.registerCommand(Nw,()=>jp(e=>{const t=e.getIndent();e.setIndent(t+1)}),ne),n.registerCommand(dh,()=>jp(e=>{const t=e.getIndent();t>0&&e.setIndent(Math.max(0,t-1))}),ne),n.registerCommand(Dd,e=>{const t=K();if(mt(t)){const r=t.getNodes();if(r.length>0)return r[0].selectPrevious(),!0}else if(q(t)){const r=ju(t.focus,!0);if(!e.shiftKey&&ke(r)&&!r.isIsolated()&&!r.isInline())return r.selectPrevious(),e.preventDefault(),!0}return!1},ne),n.registerCommand(Ld,e=>{const t=K();if(mt(t)){const r=t.getNodes();if(r.length>0)return r[0].selectNext(0,0),!0}else if(q(t)){if(function(i){const s=i.focus;return s.key==="root"&&s.offset===ye().getChildrenSize()}(t))return e.preventDefault(),!0;const r=ju(t.focus,!1);if(!e.shiftKey&&ke(r)&&!r.isIsolated()&&!r.isInline())return r.selectNext(),e.preventDefault(),!0}return!1},ne),n.registerCommand(jd,e=>{const t=K();if(mt(t)){const r=t.getNodes();if(r.length>0)return e.preventDefault(),r[0].selectPrevious(),!0}if(!q(t))return!1;if(hl(t,!0)){const r=e.shiftKey;return e.preventDefault(),pl(t,r,!0),!0}return!1},ne),n.registerCommand(Rd,e=>{const t=K();if(mt(t)){const i=t.getNodes();if(i.length>0)return e.preventDefault(),i[0].selectNext(0,0),!0}if(!q(t))return!1;const r=e.shiftKey;return!!hl(t,!1)&&(e.preventDefault(),pl(t,r,!1),!0)},ne),n.registerCommand(Fd,e=>{if(Dp(e.target))return!1;const t=K();if(q(t)){if(function(r){if(!r.isCollapsed())return!1;const{anchor:i}=r;if(i.offset!==0)return!1;const s=i.getNode();if(et(s))return!1;const o=Wx(s);return o.getIndent()>0&&(o.is(s)||s.is(o.getFirstDescendant()))}(t))return e.preventDefault(),n.dispatchCommand(dh,void 0);if(Pp&&navigator.language==="ko-KR")return!1}else if(!mt(t))return!1;return e.preventDefault(),n.dispatchCommand(mn,!0)},ne),n.registerCommand(qd,e=>{if(Dp(e.target))return!1;const t=K();return!(!q(t)&&!mt(t))&&(e.preventDefault(),n.dispatchCommand(mn,!1))},ne),n.registerCommand(Fi,e=>{const t=K();if(!q(t))return!1;if(ru(t),e!==null){if((Pp||j0||L0)&&R0)return!1;if(e.preventDefault(),e.shiftKey)return n.dispatchCommand(sr,!1)}return n.dispatchCommand(so,void 0)},ne),n.registerCommand(Il,()=>{const e=K();return!!q(e)&&(n.blur(),!0)},ne),n.registerCommand(Pl,e=>{const[,t]=ma(e);if(t.length>0){const i=Ip(e.clientX,e.clientY);if(i!==null){const{offset:s,node:o}=i,a=ur(o);if(a!==null){const l=So();if(W(a))l.anchor.set(a.getKey(),s,"text"),l.focus.set(a.getKey(),s,"text");else{const u=a.getParentOrThrow().getKey(),f=a.getIndexWithinParent()+1;l.anchor.set(u,f,"element"),l.focus.set(u,f,"element")}const c=to(l);it(c)}n.dispatchCommand(Rp,t)}return e.preventDefault(),!0}const r=K();return!!q(r)},ne),n.registerCommand(Ud,e=>{const[t]=ma(e),r=K();return!(t&&!q(r))},ne),n.registerCommand(cy,e=>{const[t]=ma(e),r=K();if(t&&!q(r))return!1;const i=Ip(e.clientX,e.clientY);if(i!==null){const s=ur(i.node);ke(s)&&e.preventDefault()}return!0},ne),n.registerCommand(il,()=>(Jy(),!0),ne),n.registerCommand(yr,e=>(_p(n,Fn(e,ClipboardEvent)?e:null),!0),ne),n.registerCommand(ii,e=>(async function(t,r){await _p(r,Fn(t,ClipboardEvent)?t:null),r.update(()=>{const i=K();q(i)?i.removeText():mt(i)&&i.getNodes().forEach(s=>s.remove())})}(e,n),!0),ne),n.registerCommand(ri,e=>{const[,t,r]=ma(e);return t.length>0&&!r?(n.dispatchCommand(Rp,t),!0):ai(e.target)&&Zd(e.target)?!1:K()!==null&&(function(i,s){i.preventDefault(),s.update(()=>{const o=K(),a=Fn(i,InputEvent)||Fn(i,KeyboardEvent)?null:i.clipboardData;a!=null&&o!==null&&mp(a,o,s)},{tag:Dy})}(e,n),!0)},ne),n.registerCommand(ly,e=>{const t=K();return q(t)&&ru(t),!1},ne),n.registerCommand(Bd,e=>{const t=K();return q(t)&&ru(t),!1},ne))}const Yu=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0?x.useLayoutEffect:x.useEffect;function Lp(n){return n.getEditorState().read(pf(n.isComposing()))}function q0({contentEditable:n,placeholder:e=null,ErrorBoundary:t}){const[r]=pe(),i=function(s,o){const[a,l]=x.useState(()=>s.getDecorators());return Yu(()=>s.registerDecoratorListener(c=>{Ot.flushSync(()=>{l(c)})}),[s]),x.useEffect(()=>{l(s.getDecorators())},[s]),x.useMemo(()=>{const c=[],u=Object.keys(a);for(let f=0;f<u.length;f++){const d=u[f],h=v.jsx(o,{onError:m=>s._onError(m),children:v.jsx(x.Suspense,{fallback:null,children:a[d]})}),g=s.getElementByKey(d);g!==null&&c.push(Ot.createPortal(h,g,d))}return c},[o,a,s])}(r,t);return function(s){Yu(()=>Ue(F0(s),Q_(s)),[s])}(r),v.jsxs(v.Fragment,{children:[n,v.jsx(B0,{content:e}),i]})}function B0({content:n}){const[e]=pe(),t=function(i){const[s,o]=x.useState(()=>Lp(i));return Yu(()=>{function a(){const l=Lp(i);o(l)}return a(),Ue(i.registerUpdateListener(()=>{a()}),i.registerEditableListener(()=>{a()}))},[i]),s}(e),r=X_();return t?typeof n=="function"?n(r):n:null}const Xu=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,U0=Xu?x.useLayoutEffect:x.useEffect;let z0=class{constructor(e){this.key=e,this.ref={current:null},this.setRefElement=this.setRefElement.bind(this)}setRefElement(e){this.ref={current:e}}};const Fp=n=>{const e=document.getElementById("typeahead-menu");if(!e)return;const t=e.getBoundingClientRect();t.top+t.height>window.innerHeight&&e.scrollIntoView({block:"center"}),t.top<0&&e.scrollIntoView({block:"center"}),n.scrollIntoView({block:"nearest"})};function qp(n,e){const t=n.getBoundingClientRect(),r=e.getBoundingClientRect();return t.top>r.top&&t.top<r.bottom}function W0(n,e,t,r){const[i]=pe();x.useEffect(()=>{if(e!=null&&n!=null){const s=i.getRootElement(),o=s!=null?function(f,d){let h=getComputedStyle(f);const g=h.position==="absolute",m=/(auto|scroll)/;if(h.position==="fixed")return document.body;for(let y=f;y=y.parentElement;)if(h=getComputedStyle(y),(!g||h.position!=="static")&&m.test(h.overflow+h.overflowY+h.overflowX))return y;return document.body}(s):document.body;let a=!1,l=qp(e,o);const c=function(){a||(window.requestAnimationFrame(function(){t(),a=!1}),a=!0);const f=qp(e,o);f!==l&&(l=f,r!=null&&r(f))},u=new ResizeObserver(t);return window.addEventListener("resize",t),document.addEventListener("scroll",c,{capture:!0,passive:!0}),u.observe(e),()=>{u.unobserve(e),window.removeEventListener("resize",t),document.removeEventListener("scroll",c,!0)}}},[e,i,r,t,n])}const Bp=ie("SCROLL_TYPEAHEAD_OPTION_INTO_VIEW_COMMAND");function K0({close:n,editor:e,anchorElementRef:t,resolution:r,options:i,menuRenderFn:s,onSelectOption:o,shouldSplitNodeWithQuery:a=!1,commandPriority:l=oi,preselectFirstItem:c=!0}){const[u,f]=x.useState(null),d=r.match&&r.match.matchingString;x.useEffect(()=>{c&&f(0)},[d,c]);const h=x.useCallback(m=>{e.update(()=>{const y=r.match!=null&&a?function(b){const _=K();if(!q(_)||!_.isCollapsed())return null;const w=_.anchor;if(w.type!=="text")return null;const T=w.getNode();if(!T.isSimpleText())return null;const O=w.offset,M=T.getTextContent().slice(0,O),j=b.replaceableString.length,A=O-function(B,C,N){let S=N;for(let R=S;R<=C.length;R++)B.slice(-R)===C.substring(0,R)&&(S=R);return S}(M,b.matchingString,j);if(A<0)return null;let $;return A===0?[$]=T.splitText(O):[,$]=T.splitText(A,O),$}(r.match):null;o(m,y,n,r.match?r.match.matchingString:"")})},[e,a,r.match,o,n]),g=x.useCallback(m=>{const y=e.getRootElement();y!==null&&(y.setAttribute("aria-activedescendant","typeahead-item-"+m),f(m))},[e]);return x.useEffect(()=>()=>{const m=e.getRootElement();m!==null&&m.removeAttribute("aria-activedescendant")},[e]),U0(()=>{i===null?f(null):u===null&&c&&g(0)},[i,u,g,c]),x.useEffect(()=>Ue(e.registerCommand(Bp,({option:m})=>!(!m.ref||m.ref.current==null)&&(Fp(m.ref.current),!0),l)),[e,g,l]),x.useEffect(()=>Ue(e.registerCommand(Ld,m=>{const y=m;if(i!==null&&i.length){const b=u===null?0:u!==i.length-1?u+1:0;g(b);const _=i[b];_.ref!=null&&_.ref.current&&e.dispatchCommand(Bp,{index:b,option:_}),y.preventDefault(),y.stopImmediatePropagation()}return!0},l),e.registerCommand(Dd,m=>{const y=m;if(i!==null&&i.length){const b=u===null?i.length-1:u!==0?u-1:i.length-1;g(b);const _=i[b];_.ref!=null&&_.ref.current&&Fp(_.ref.current),y.preventDefault(),y.stopImmediatePropagation()}return!0},l),e.registerCommand(Il,m=>{const y=m;return y.preventDefault(),y.stopImmediatePropagation(),n(),!0},l),e.registerCommand(Bd,m=>{const y=m;return i!==null&&u!==null&&i[u]!=null&&(y.preventDefault(),y.stopImmediatePropagation(),h(i[u]),!0)},l),e.registerCommand(Fi,m=>i!==null&&u!==null&&i[u]!=null&&(m!==null&&(m.preventDefault(),m.stopImmediatePropagation()),h(i[u]),!0),l)),[h,n,e,i,u,g,l]),s(t,x.useMemo(()=>({options:i,selectOptionAndCleanUp:h,selectedIndex:u,setHighlightedIndex:f}),[h,u,i]),r.match?r.match.matchingString:"")}function Up(n,e){e!=null&&(n.className=e),n.setAttribute("aria-label","Typeahead menu"),n.setAttribute("role","listbox"),n.style.display="block",n.style.position="absolute"}function H0({options:n,onWillOpen:e,onClose:t,onOpen:r,onSelectOption:i,menuRenderFn:s,anchorClassName:o,commandPriority:a=oi,parent:l}){const[c]=pe(),[u,f]=x.useState(null),d=x.useRef(null),h=function(_,w,T,O=Xu?document.body:void 0,M=!0){const[j]=pe(),A=Xu?document.createElement("div"):null,$=x.useRef(A),B=x.useCallback(()=>{if($.current===null||O===void 0)return;$.current.style.top=$.current.style.bottom;const N=j.getRootElement(),S=$.current,R=S.firstChild;if(N!==null&&_!==null){const{left:L,top:D,width:z,height:H}=_.getRect(),V=$.current.offsetHeight;if(S.style.top=`${D+V+3+(M?window.pageYOffset:0)}px`,S.style.left=`${L+window.pageXOffset}px`,S.style.height=`${H}px`,S.style.width=`${z}px`,R!==null){R.style.top=`${D}`;const G=R.getBoundingClientRect(),ee=G.height,Q=G.width,re=N.getBoundingClientRect();L+Q>re.right&&(S.style.left=`${re.right-Q+window.pageXOffset}px`),(D+ee>window.innerHeight||D+ee>re.bottom)&&D-re.top>ee+H&&(S.style.top=`${D-ee-H+(M?window.pageYOffset:0)}px`)}S.isConnected||(Up(S,T),O.append(S)),S.setAttribute("id","typeahead-menu"),N.setAttribute("aria-controls","typeahead-menu")}},[j,_,M,T,O]);x.useEffect(()=>{const N=j.getRootElement();return _!==null&&B(),()=>{N!==null&&N.removeAttribute("aria-controls");const S=$.current;S!==null&&S.isConnected&&(S.remove(),S.removeAttribute("id"))}},[j,B,_]);const C=x.useCallback(N=>{_!==null&&(N||w(null))},[_,w]);return W0(_,$.current,B,C),A!=null&&A===$.current&&(Up(A,T),O!=null&&O.append(A)),$}(u,f,o,l),g=x.useCallback(()=>{f(null),t!=null&&u!==null&&t()},[t,u]),m=x.useCallback(_=>{f(_),r!=null&&u===null&&r(_)},[r,u]),y=x.useCallback(_=>{_.preventDefault(),e!=null&&e(_);const w=Kx(_.target);m({getRect:()=>new DOMRect(_.clientX/w,_.clientY/w,1,1)})},[m,e]),b=x.useCallback(_=>{u!==null&&d.current!=null&&_.target!=null&&ai(_.target)&&!d.current.contains(_.target)&&g()},[g,u]);return x.useEffect(()=>{const _=c.getRootElement();if(_)return _.addEventListener("contextmenu",y),()=>_.removeEventListener("contextmenu",y)},[c,y]),x.useEffect(()=>(document.addEventListener("click",b),()=>document.removeEventListener("click",b)),[c,b]),h.current===null||u===null||c===null?null:v.jsx(K0,{close:g,resolution:u,editor:c,anchorElementRef:h,options:n,menuRenderFn:(_,w)=>s(_,w,{setMenuRef:T=>{d.current=T}}),onSelectOption:i,commandPriority:a})}function J0({defaultSelection:n}){const[e]=pe();return x.useEffect(()=>{e.focus(()=>{const t=document.activeElement,r=e.getRootElement();r===null||t!==null&&r.contains(t)||r.focus({preventScroll:!0})},{defaultSelection:n})},[n,e]),null}const V0=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0?x.useLayoutEffect:x.useEffect;function G0({onClear:n}){const[e]=pe();return V0(()=>e.registerCommand(zd,t=>(e.update(()=>{if(n==null){const r=ye(),i=K(),s=It();r.clear(),r.append(s),i!==null&&s.select(),q(i)&&(i.format=0)}else n()}),!0),ne),[e,n]),null}const zp=[["Cat","rgb(125, 50, 0)"],["Dog","rgb(100, 0, 0)"],["Rabbit","rgb(150, 0, 0)"],["Frog","rgb(200, 0, 0)"],["Fox","rgb(200, 75, 0)"],["Hedgehog","rgb(0, 75, 0)"],["Pigeon","rgb(0, 125, 0)"],["Squirrel","rgb(75, 100, 0)"],["Bear","rgb(125, 100, 0)"],["Tiger","rgb(0, 0, 150)"],["Leopard","rgb(0, 0, 200)"],["Zebra","rgb(0, 0, 250)"],["Wolf","rgb(0, 100, 150)"],["Owl","rgb(0, 100, 100)"],["Gull","rgb(100, 0, 100)"],["Squid","rgb(150, 0, 150)"]],Wp=zp[Math.floor(Math.random()*zp.length)],Y0=x.createContext({clientID:0,color:Wp[1],isCollabActive:!1,name:Wp[0],yjsDocMap:new Map});function Z_(n,e){return x.useContext(Y0)}const X0=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0?x.useLayoutEffect:x.useEffect;function Q0({ignoreHistoryMergeTagChange:n=!0,ignoreSelectionChange:e=!1,onChange:t}){const[r]=pe();return X0(()=>{if(t)return r.registerUpdateListener(({editorState:i,dirtyElements:s,dirtyLeaves:o,prevEditorState:a,tags:l})=>{e&&s.size===0&&o.size===0||n&&l.has(Lr)||a.isEmpty()||t(i,r,l)})},[r,n,e,t]),null}const as=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,Z0=as&&"documentMode"in document?document.documentMode:null,eS=!(!as||!("InputEvent"in window)||Z0)&&"getTargetRanges"in new window.InputEvent("input"),tS=as&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent),Kp=as&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,nS=as&&/^(?=.*Chrome).*/i.test(navigator.userAgent),rS=as&&/AppleWebKit\/[\d.]+/.test(navigator.userAgent)&&!nS;function Hp(n,e){e.update(()=>{if(n!==null){const t=Fn(n,KeyboardEvent)?null:n.clipboardData,r=K();if(r!==null&&t!=null){n.preventDefault();const i=C_(e);i!==null&&t.setData("text/html",i),t.setData("text/plain",r.getTextContent())}}})}function iS(n){return Ue(n.registerCommand(mn,e=>{const t=K();return!!q(t)&&(t.deleteCharacter(e),!0)},ne),n.registerCommand(Di,e=>{const t=K();return!!q(t)&&(t.deleteWord(e),!0)},ne),n.registerCommand(Li,e=>{const t=K();return!!q(t)&&(t.deleteLine(e),!0)},ne),n.registerCommand(jr,e=>{const t=K();if(!q(t))return!1;if(typeof e=="string")t.insertText(e);else{const r=e.dataTransfer;if(r!=null)gp(r,t);else{const i=e.data;i&&t.insertText(i)}}return!0},ne),n.registerCommand(rl,()=>{const e=K();return!!q(e)&&(e.removeText(),!0)},ne),n.registerCommand(sr,e=>{const t=K();return!!q(t)&&(t.insertLineBreak(e),!0)},ne),n.registerCommand(so,()=>{const e=K();return!!q(e)&&(e.insertLineBreak(),!0)},ne),n.registerCommand(jd,e=>{const t=K();if(!q(t))return!1;const r=e,i=r.shiftKey;return!!hl(t,!0)&&(r.preventDefault(),pl(t,i,!0),!0)},ne),n.registerCommand(Rd,e=>{const t=K();if(!q(t))return!1;const r=e,i=r.shiftKey;return!!hl(t,!1)&&(r.preventDefault(),pl(t,i,!1),!0)},ne),n.registerCommand(Fd,e=>{const t=K();return!!q(t)&&(!Kp||navigator.language!=="ko-KR")&&(e.preventDefault(),n.dispatchCommand(mn,!0))},ne),n.registerCommand(qd,e=>{const t=K();return!!q(t)&&(e.preventDefault(),n.dispatchCommand(mn,!1))},ne),n.registerCommand(Fi,e=>{const t=K();if(!q(t))return!1;if(e!==null){if((Kp||tS||rS)&&eS)return!1;e.preventDefault()}return n.dispatchCommand(sr,!1)},ne),n.registerCommand(il,()=>(Jy(),!0),ne),n.registerCommand(yr,e=>{const t=K();return!!q(t)&&(Hp(e,n),!0)},ne),n.registerCommand(ii,e=>{const t=K();return!!q(t)&&(function(r,i){Hp(r,i),i.update(()=>{const s=K();q(s)&&s.removeText()})}(e,n),!0)},ne),n.registerCommand(ri,e=>{const t=K();return!!q(t)&&(function(r,i){r.preventDefault(),i.update(()=>{const s=K(),o=Fn(r,ClipboardEvent)?r.clipboardData:null;o!=null&&q(s)&&gp(o,s)},{tag:Dy})}(e,n),!0)},ne),n.registerCommand(Pl,e=>{const t=K();return!!q(t)&&(e.preventDefault(),!0)},ne),n.registerCommand(Ud,e=>{const t=K();return!!q(t)&&(e.preventDefault(),!0)},ne))}const Qu=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0?x.useLayoutEffect:x.useEffect;function Jp(n){return n.getEditorState().read(pf(n.isComposing()))}function sS({contentEditable:n,placeholder:e=null,ErrorBoundary:t}){const[r]=pe(),i=function(s,o){const[a,l]=x.useState(()=>s.getDecorators());return Qu(()=>s.registerDecoratorListener(c=>{Ot.flushSync(()=>{l(c)})}),[s]),x.useEffect(()=>{l(s.getDecorators())},[s]),x.useMemo(()=>{const c=[],u=Object.keys(a);for(let f=0;f<u.length;f++){const d=u[f],h=v.jsx(o,{onError:m=>s._onError(m),children:v.jsx(x.Suspense,{fallback:null,children:a[d]})}),g=s.getElementByKey(d);g!==null&&c.push(Ot.createPortal(h,g,d))}return c},[o,a,s])}(r,t);return function(s){Qu(()=>Ue(iS(s),Q_(s)),[s])}(r),v.jsxs(v.Fragment,{children:[n,v.jsx(oS,{content:e}),i]})}function oS({content:n}){const[e]=pe(),t=function(i){const[s,o]=x.useState(()=>Jp(i));return Qu(()=>{function a(){const l=Jp(i);o(l)}return a(),Ue(i.registerUpdateListener(()=>{a()}),i.registerEditableListener(()=>{a()}))},[i]),s}(e),r=X_();return t?typeof n=="function"?n(r):n:null}const yn=()=>new Map,Zu=n=>{const e=yn();return n.forEach((t,r)=>{e.set(r,t)}),e},ls=(n,e,t)=>{let r=n.get(e);return r===void 0&&n.set(e,r=t()),r},aS=(n,e)=>{const t=[];for(const[r,i]of n)t.push(e(i,r));return t},lS=(n,e)=>{for(const[t,r]of n)if(e(r,t))return!0;return!1},zi=()=>new Set,iu=n=>n[n.length-1],Wi=Array.from,cS=Array.isArray;class uS{constructor(){this._observers=yn()}on(e,t){return ls(this._observers,e,zi).add(t),t}once(e,t){const r=(...i)=>{this.off(e,r),t(...i)};this.on(e,r)}off(e,t){const r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return Wi((this._observers.get(e)||yn()).values()).forEach(r=>r(...t))}destroy(){this._observers=yn()}}const Gr=Math.floor,Ua=Math.abs,eb=(n,e)=>n<e?n:e,cs=(n,e)=>n>e?n:e,dS=n=>n!==0?n<0:1/n<0,Vp=1,Gp=2,su=4,ou=8,fS=32,tb=64,ml=128,hS=31,Yp=63,Xs=127,pS=2147483647,gS=Number.isInteger||(n=>typeof n=="number"&&isFinite(n)&&Gr(n)===n),mS=n=>n.toLowerCase(),yS=/^\s*/g,_S=n=>n.replace(yS,""),bS=/([A-Z])/g,Xp=(n,e)=>_S(n.replace(bS,t=>`${e}${mS(t)}`)),vS=n=>{const e=unescape(encodeURIComponent(n)),t=e.length,r=new Uint8Array(t);for(let i=0;i<t;i++)r[i]=e.codePointAt(i);return r},lo=typeof TextEncoder<"u"?new TextEncoder:null,kS=n=>lo.encode(n),wS=lo?kS:vS;let au=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});au&&au.decode(new Uint8Array).length===1&&(au=null);class Oo{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const gf=()=>new Oo,xS=n=>{let e=n.cpos;for(let t=0;t<n.bufs.length;t++)e+=n.bufs[t].length;return e},qn=n=>{const e=new Uint8Array(xS(n));let t=0;for(let r=0;r<n.bufs.length;r++){const i=n.bufs[r];e.set(i,t),t+=i.length}return e.set(new Uint8Array(n.cbuf.buffer,0,n.cpos),t),e},CS=(n,e)=>{const t=n.cbuf.length;t-n.cpos<e&&(n.bufs.push(new Uint8Array(n.cbuf.buffer,0,n.cpos)),n.cbuf=new Uint8Array(cs(t,e)*2),n.cpos=0)},We=(n,e)=>{const t=n.cbuf.length;n.cpos===t&&(n.bufs.push(n.cbuf),n.cbuf=new Uint8Array(t*2),n.cpos=0),n.cbuf[n.cpos++]=e},ed=We,Me=(n,e)=>{for(;e>Xs;)We(n,ml|Xs&e),e=Gr(e/128);We(n,Xs&e)},mf=(n,e)=>{const t=dS(e);for(t&&(e=-e),We(n,(e>Yp?ml:0)|(t?tb:0)|Yp&e),e=Gr(e/64);e>0;)We(n,(e>Xs?ml:0)|Xs&e),e=Gr(e/128)},td=new Uint8Array(3e4),SS=td.length/3,TS=(n,e)=>{if(e.length<SS){const t=lo.encodeInto(e,td).written||0;Me(n,t);for(let r=0;r<t;r++)We(n,td[r])}else Mt(n,wS(e))},ES=(n,e)=>{const t=unescape(encodeURIComponent(e)),r=t.length;Me(n,r);for(let i=0;i<r;i++)We(n,t.codePointAt(i))},Ii=lo&&lo.encodeInto?TS:ES,yf=(n,e)=>{const t=n.cbuf.length,r=n.cpos,i=eb(t-r,e.length),s=e.length-i;n.cbuf.set(e.subarray(0,i),r),n.cpos+=i,s>0&&(n.bufs.push(n.cbuf),n.cbuf=new Uint8Array(cs(t*2,s)),n.cbuf.set(e.subarray(i)),n.cpos=s)},Mt=(n,e)=>{Me(n,e.byteLength),yf(n,e)},_f=(n,e)=>{CS(n,e);const t=new DataView(n.cbuf.buffer,n.cpos,e);return n.cpos+=e,t},NS=(n,e)=>_f(n,4).setFloat32(0,e,!1),MS=(n,e)=>_f(n,8).setFloat64(0,e,!1),AS=(n,e)=>_f(n,8).setBigInt64(0,e,!1),Qp=new DataView(new ArrayBuffer(4)),OS=n=>(Qp.setFloat32(0,n),Qp.getFloat32(0)===n),co=(n,e)=>{switch(typeof e){case"string":We(n,119),Ii(n,e);break;case"number":gS(e)&&Ua(e)<=pS?(We(n,125),mf(n,e)):OS(e)?(We(n,124),NS(n,e)):(We(n,123),MS(n,e));break;case"bigint":We(n,122),AS(n,e);break;case"object":if(e===null)We(n,126);else if(cS(e)){We(n,117),Me(n,e.length);for(let t=0;t<e.length;t++)co(n,e[t])}else if(e instanceof Uint8Array)We(n,116),Mt(n,e);else{We(n,118);const t=Object.keys(e);Me(n,t.length);for(let r=0;r<t.length;r++){const i=t[r];Ii(n,i),co(n,e[i])}}break;case"boolean":We(n,e?120:121);break;default:We(n,127)}};class Zp extends Oo{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&Me(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const eg=n=>{n.count>0&&(mf(n.encoder,n.count===1?n.s:-n.s),n.count>1&&Me(n.encoder,n.count-2))};class za{constructor(){this.encoder=new Oo,this.s=0,this.count=0}write(e){this.s===e?this.count++:(eg(this),this.count=1,this.s=e)}toUint8Array(){return eg(this),qn(this.encoder)}}const tg=n=>{if(n.count>0){const e=n.diff*2+(n.count===1?0:1);mf(n.encoder,e),n.count>1&&Me(n.encoder,n.count-2)}};class lu{constructor(){this.encoder=new Oo,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(tg(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return tg(this),qn(this.encoder)}}class $S{constructor(){this.sarr=[],this.s="",this.lensE=new za}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new Oo;return this.sarr.push(this.s),this.s="",Ii(e,this.sarr.join("")),yf(e,this.lensE.toUint8Array()),qn(e)}}const Ki=n=>new Error(n),_n=()=>{throw Ki("Method unimplemented")},Yr=()=>{throw Ki("Unexpected case")},IS=crypto.getRandomValues.bind(crypto),nb=()=>IS(new Uint32Array(1))[0],PS="10000000-1000-4000-8000"+-1e11,RS=()=>PS.replace(/[018]/g,n=>(n^nb()&15>>n/4).toString(16)),ng=n=>new Promise(n);Promise.all.bind(Promise);const rg=n=>n===void 0?null:n;class jS{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}}let rb=new jS,DS=!0;try{typeof localStorage<"u"&&localStorage&&(rb=localStorage,DS=!1)}catch{}const LS=rb,FS=Object.assign,qS=Object.keys,BS=(n,e)=>{for(const t in n)e(n[t],t)},ig=n=>qS(n).length,US=n=>{for(const e in n)return!1;return!0},zS=(n,e)=>{for(const t in n)if(!e(n[t],t))return!1;return!0},WS=(n,e)=>Object.prototype.hasOwnProperty.call(n,e),KS=(n,e)=>n===e||ig(n)===ig(e)&&zS(n,(t,r)=>(t!==void 0||WS(e,r))&&e[r]===t),HS=Object.freeze,ib=n=>{for(const e in n){const t=n[e];(typeof t=="object"||typeof t=="function")&&ib(n[e])}return HS(n)},bf=(n,e,t=0)=>{try{for(;t<n.length;t++)n[t](...e)}finally{t<n.length&&bf(n,e,t+1)}},JS=(n,e)=>e.includes(n);var sb={};const uo=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";let cn;const VS=()=>{if(cn===void 0)if(uo){cn=yn();const n=process.argv;let e=null;for(let t=0;t<n.length;t++){const r=n[t];r[0]==="-"?(e!==null&&cn.set(e,""),e=r):e!==null&&(cn.set(e,r),e=null)}e!==null&&cn.set(e,"")}else typeof location=="object"?(cn=yn(),(location.search||"?").slice(1).split("&").forEach(n=>{if(n.length!==0){const[e,t]=n.split("=");cn.set(`--${Xp(e,"-")}`,t),cn.set(`-${Xp(e,"-")}`,t)}})):cn=yn();return cn},nd=n=>VS().has(n),yl=n=>rg(uo?sb[n.toUpperCase().replaceAll("-","_")]:LS.getItem(n)),ob=n=>nd("--"+n)||yl(n)!==null;ob("production");const GS=uo&&JS(sb.FORCE_COLOR,["true","1","2"]),YS=GS||!nd("--no-colors")&&!ob("no-color")&&(!uo||process.stdout.isTTY)&&(!uo||nd("--color")||yl("COLORTERM")!==null||(yl("TERM")||"").includes("color"));class XS{constructor(e,t){this.left=e,this.right=t}}const On=(n,e)=>new XS(n,e);typeof DOMParser<"u"&&new DOMParser;const QS=n=>aS(n,(e,t)=>`${t}:${e};`).join(""),Jn=Symbol,ab=Jn(),lb=Jn(),ZS=Jn(),e1=Jn(),t1=Jn(),cb=Jn(),n1=Jn(),vf=Jn(),r1=Jn(),i1=n=>{var i;n.length===1&&((i=n[0])==null?void 0:i.constructor)===Function&&(n=n[0]());const e=[],t=[];let r=0;for(;r<n.length;r++){const s=n[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)e.push(s);else if(s.constructor===Object)break}for(r>0&&t.push(e.join(""));r<n.length;r++){const s=n[r];s instanceof Symbol||t.push(s)}return t},s1={[ab]:On("font-weight","bold"),[lb]:On("font-weight","normal"),[ZS]:On("color","blue"),[t1]:On("color","green"),[e1]:On("color","grey"),[cb]:On("color","red"),[n1]:On("color","purple"),[vf]:On("color","orange"),[r1]:On("color","black")},o1=n=>{var o;n.length===1&&((o=n[0])==null?void 0:o.constructor)===Function&&(n=n[0]());const e=[],t=[],r=yn();let i=[],s=0;for(;s<n.length;s++){const a=n[s],l=s1[a];if(l!==void 0)r.set(l.left,l.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){const c=QS(r);s>0||c.length>0?(e.push("%c"+a),t.push(c)):e.push(a)}else break}}for(s>0&&(i=t,i.unshift(e.join("")));s<n.length;s++){const a=n[s];a instanceof Symbol||i.push(a)}return i},ub=YS?o1:i1,a1=(...n)=>{console.log(...ub(n)),db.forEach(e=>e.print(n))},l1=(...n)=>{console.warn(...ub(n)),n.unshift(vf),db.forEach(e=>e.print(n))},db=zi(),fb=n=>({[Symbol.iterator](){return this},next:n}),c1=(n,e)=>fb(()=>{let t;do t=n.next();while(!t.done&&!e(t.value));return t}),cu=(n,e)=>fb(()=>{const{done:t,value:r}=n.next();return{done:t,value:t?void 0:e(r)}});class u1{constructor(e,t){this.clock=e,this.len=t}}class d1{constructor(){this.clients=new Map}}const hb=(n,e,t)=>e.clients.forEach((r,i)=>{const s=n.doc.store.clients.get(i);if(s!=null){const o=s[s.length-1],a=o.id.clock+o.length;for(let l=0,c=r[l];l<r.length&&c.clock<a;c=r[++l])vb(n,s,c.clock,c.len,t)}}),f1=(n,e)=>{let t=0,r=n.length-1;for(;t<=r;){const i=Gr((t+r)/2),s=n[i],o=s.clock;if(o<=e){if(e<o+s.len)return i;t=i+1}else r=i-1}return null},pb=(n,e)=>{const t=n.clients.get(e.client);return t!==void 0&&f1(t,e.clock)!==null},gb=n=>{n.clients.forEach(e=>{e.sort((i,s)=>i.clock-s.clock);let t,r;for(t=1,r=1;t<e.length;t++){const i=e[r-1],s=e[t];i.clock+i.len>=s.clock?i.len=cs(i.len,s.clock+s.len-i.clock):(r<t&&(e[r]=s),r++)}e.length=r})},mb=(n,e,t,r)=>{ls(n.clients,e,()=>[]).push(new u1(t,r))},h1=(n,e)=>{Me(n.restEncoder,e.clients.size),Wi(e.clients.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{n.resetDsCurVal(),Me(n.restEncoder,t);const i=r.length;Me(n.restEncoder,i);for(let s=0;s<i;s++){const o=r[s];n.writeDsClock(o.clock),n.writeDsLen(o.len)}})},yb=nb;class $o extends uS{constructor({guid:e=RS(),collectionid:t=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=yb(),this.guid=e,this.collectionid=t,this.share=new Map,this.store=new x1,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=ng(c=>{this.on("load",()=>{this.isLoaded=!0,c(this)})});const l=()=>ng(c=>{const u=f=>{(f===void 0||f===!0)&&(this.off("sync",u),c())};this.on("sync",u)});this.on("sync",c=>{c===!1&&this.isSynced&&(this.whenSynced=l()),this.isSynced=c===void 0||c===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=l()}load(){const e=this._item;e!==null&&!this.shouldLoad&&Oe(e.parent.doc,t=>{t.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Wi(this.subdocs).map(e=>e.guid))}transact(e,t=null){return Oe(this,e,t)}get(e,t=nt){const r=ls(this.share,e,()=>{const s=new t;return s._integrate(this,null),s}),i=r.constructor;if(t!==nt&&i!==t)if(i===nt){const s=new t;s._map=r._map,r._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=s}),s._start=r._start;for(let o=s._start;o!==null;o=o.right)o.parent=s;return s._length=r._length,this.share.set(e,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,Ur)}getText(e=""){return this.get(e,vl)}getMap(e=""){return this.get(e,Hi)}getXmlElement(e=""){return this.get(e,po)}getXmlFragment(e=""){return this.get(e,Ji)}toJSON(){const e={};return this.share.forEach((t,r)=>{e[r]=t.toJSON()}),e}destroy(){this.isDestroyed=!0,Wi(this.subdocs).forEach(t=>t.destroy());const e=this._item;if(e!==null){this._item=null;const t=e.content;t.doc=new $o({guid:this.guid,...t.opts,shouldLoad:!1}),t.doc._item=e,Oe(e.parent.doc,r=>{const i=t.doc;e.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class p1{constructor(){this.restEncoder=gf()}toUint8Array(){return qn(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){Me(this.restEncoder,e)}writeDsLen(e){Me(this.restEncoder,e)}}class g1 extends p1{writeLeftID(e){Me(this.restEncoder,e.client),Me(this.restEncoder,e.clock)}writeRightID(e){Me(this.restEncoder,e.client),Me(this.restEncoder,e.clock)}writeClient(e){Me(this.restEncoder,e)}writeInfo(e){ed(this.restEncoder,e)}writeString(e){Ii(this.restEncoder,e)}writeParentInfo(e){Me(this.restEncoder,e?1:0)}writeTypeRef(e){Me(this.restEncoder,e)}writeLen(e){Me(this.restEncoder,e)}writeAny(e){co(this.restEncoder,e)}writeBuf(e){Mt(this.restEncoder,e)}writeJSON(e){Ii(this.restEncoder,JSON.stringify(e))}writeKey(e){Ii(this.restEncoder,e)}}class m1{constructor(){this.restEncoder=gf(),this.dsCurrVal=0}toUint8Array(){return qn(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const t=e-this.dsCurrVal;this.dsCurrVal=e,Me(this.restEncoder,t)}writeDsLen(e){e===0&&Yr(),Me(this.restEncoder,e-1),this.dsCurrVal+=e}}class y1 extends m1{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new lu,this.clientEncoder=new za,this.leftClockEncoder=new lu,this.rightClockEncoder=new lu,this.infoEncoder=new Zp(ed),this.stringEncoder=new $S,this.parentInfoEncoder=new Zp(ed),this.typeRefEncoder=new za,this.lenEncoder=new za}toUint8Array(){const e=gf();return Me(e,0),Mt(e,this.keyClockEncoder.toUint8Array()),Mt(e,this.clientEncoder.toUint8Array()),Mt(e,this.leftClockEncoder.toUint8Array()),Mt(e,this.rightClockEncoder.toUint8Array()),Mt(e,qn(this.infoEncoder)),Mt(e,this.stringEncoder.toUint8Array()),Mt(e,qn(this.parentInfoEncoder)),Mt(e,this.typeRefEncoder.toUint8Array()),Mt(e,this.lenEncoder.toUint8Array()),yf(e,qn(this.restEncoder)),qn(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){co(this.restEncoder,e)}writeBuf(e){Mt(this.restEncoder,e)}writeJSON(e){co(this.restEncoder,e)}writeKey(e){const t=this.keyMap.get(e);t===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(t)}}const _1=(n,e,t,r)=>{r=cs(r,e[0].id.clock);const i=zn(e,r);Me(n.restEncoder,e.length-i),n.writeClient(t),Me(n.restEncoder,r);const s=e[i];s.write(n,r-s.id.clock);for(let o=i+1;o<e.length;o++)e[o].write(n,0)},b1=(n,e,t)=>{const r=new Map;t.forEach((i,s)=>{xt(e,s)>i&&r.set(s,i)}),kf(e).forEach((i,s)=>{t.has(s)||r.set(s,0)}),Me(n.restEncoder,r.size),Wi(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{_1(n,e.clients.get(i),i,s)})},v1=(n,e)=>b1(n,e.doc.store,e.beforeState);class k1{constructor(){this.l=[]}}const sg=()=>new k1,og=(n,e)=>n.l.push(e),ag=(n,e)=>{const t=n.l,r=t.length;n.l=t.filter(i=>e!==i),r===n.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},_b=(n,e,t)=>bf(n.l,[e,t]);class Wa{constructor(e,t){this.client=e,this.clock=t}}const ya=(n,e)=>n===e||n!==null&&e!==null&&n.client===e.client&&n.clock===e.clock,Re=(n,e)=>new Wa(n,e),w1=n=>{for(const[e,t]of n.doc.share.entries())if(t===n)return e;throw Yr()},Ti=(n,e)=>e===void 0?!n.deleted:e.sv.has(n.id.client)&&(e.sv.get(n.id.client)||0)>n.id.clock&&!pb(e.ds,n.id),rd=(n,e)=>{const t=ls(n.meta,rd,zi),r=n.doc.store;t.has(e)||(e.sv.forEach((i,s)=>{i<xt(r,s)&&fr(n,Re(s,i))}),hb(n,e.ds,i=>{}),t.add(e))};class x1{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const kf=n=>{const e=new Map;return n.clients.forEach((t,r)=>{const i=t[t.length-1];e.set(r,i.id.clock+i.length)}),e},xt=(n,e)=>{const t=n.clients.get(e);if(t===void 0)return 0;const r=t[t.length-1];return r.id.clock+r.length},bb=(n,e)=>{let t=n.clients.get(e.id.client);if(t===void 0)t=[],n.clients.set(e.id.client,t);else{const r=t[t.length-1];if(r.id.clock+r.length!==e.id.clock)throw Yr()}t.push(e)},zn=(n,e)=>{let t=0,r=n.length-1,i=n[r],s=i.id.clock;if(s===e)return r;let o=Gr(e/(s+i.length-1)*r);for(;t<=r;){if(i=n[o],s=i.id.clock,s<=e){if(e<s+i.length)return o;t=o+1}else r=o-1;o=Gr((t+r)/2)}throw Yr()},C1=(n,e)=>{const t=n.clients.get(e.client);return t[zn(t,e.clock)]},uu=C1,id=(n,e,t)=>{const r=zn(e,t),i=e[r];return i.id.clock<t&&i instanceof ut?(e.splice(r+1,0,Fb(n,i,t-i.id.clock)),r+1):r},fr=(n,e)=>{const t=n.doc.store.clients.get(e.client);return t[id(n,t,e.clock)]},lg=(n,e,t)=>{const r=e.clients.get(t.client),i=zn(r,t.clock),s=r[i];return t.clock!==s.id.clock+s.length-1&&s.constructor!==Zn&&r.splice(i+1,0,Fb(n,s,t.clock-s.id.clock+1)),s},S1=(n,e,t)=>{const r=n.clients.get(e.id.client);r[zn(r,e.id.clock)]=t},vb=(n,e,t,r,i)=>{if(r===0)return;const s=t+r;let o=id(n,e,t),a;do a=e[o++],s<a.id.clock+a.length&&id(n,e,s),i(a);while(o<e.length&&e[o].id.clock<s)};class T1{constructor(e,t,r){this.doc=e,this.deleteSet=new d1,this.beforeState=kf(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=t,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const cg=(n,e)=>e.deleteSet.clients.size===0&&!lS(e.afterState,(t,r)=>e.beforeState.get(r)!==t)?!1:(gb(e.deleteSet),v1(n,e),h1(n,e.deleteSet),!0),ug=(n,e,t)=>{const r=e._item;(r===null||r.id.clock<(n.beforeState.get(r.id.client)||0)&&!r.deleted)&&ls(n.changed,e,zi).add(t)},Ka=(n,e)=>{let t=n[e],r=n[e-1],i=e;for(;i>0;t=r,r=n[--i-1]){if(r.deleted===t.deleted&&r.constructor===t.constructor&&r.mergeWith(t)){t instanceof ut&&t.parentSub!==null&&t.parent._map.get(t.parentSub)===t&&t.parent._map.set(t.parentSub,r);continue}break}const s=e-i;return s&&n.splice(e+1-s,s),s},E1=(n,e,t)=>{for(const[r,i]of n.clients.entries()){const s=e.clients.get(r);for(let o=i.length-1;o>=0;o--){const a=i[o],l=a.clock+a.len;for(let c=zn(s,a.clock),u=s[c];c<s.length&&u.id.clock<l;u=s[++c]){const f=s[c];if(a.clock+a.len<=f.id.clock)break;f instanceof ut&&f.deleted&&!f.keep&&t(f)&&f.gc(e,!1)}}}},N1=(n,e)=>{n.clients.forEach((t,r)=>{const i=e.clients.get(r);for(let s=t.length-1;s>=0;s--){const o=t[s],a=eb(i.length-1,1+zn(i,o.clock+o.len-1));for(let l=a,c=i[l];l>0&&c.id.clock>=o.clock;c=i[l])l-=1+Ka(i,l)}})},kb=(n,e)=>{if(e<n.length){const t=n[e],r=t.doc,i=r.store,s=t.deleteSet,o=t._mergeStructs;try{gb(s),t.afterState=kf(t.doc.store),r.emit("beforeObserverCalls",[t,r]);const a=[];t.changed.forEach((l,c)=>a.push(()=>{(c._item===null||!c._item.deleted)&&c._callObserver(t,l)})),a.push(()=>{t.changedParentTypes.forEach((l,c)=>{c._dEH.l.length>0&&(c._item===null||!c._item.deleted)&&(l=l.filter(u=>u.target._item===null||!u.target._item.deleted),l.forEach(u=>{u.currentTarget=c,u._path=null}),l.sort((u,f)=>u.path.length-f.path.length),_b(c._dEH,l,t))})}),a.push(()=>r.emit("afterTransaction",[t,r])),bf(a,[]),t._needFormattingCleanup&&F1(t)}finally{r.gc&&E1(s,i,r.gcFilter),N1(s,i),t.afterState.forEach((u,f)=>{const d=t.beforeState.get(f)||0;if(d!==u){const h=i.clients.get(f),g=cs(zn(h,d),1);for(let m=h.length-1;m>=g;)m-=1+Ka(h,m)}});for(let u=o.length-1;u>=0;u--){const{client:f,clock:d}=o[u].id,h=i.clients.get(f),g=zn(h,d);g+1<h.length&&Ka(h,g+1)>1||g>0&&Ka(h,g)}if(!t.local&&t.afterState.get(r.clientID)!==t.beforeState.get(r.clientID)&&(a1(vf,ab,"[yjs] ",lb,cb,"Changed the client-id because another client seems to be using it."),r.clientID=yb()),r.emit("afterTransactionCleanup",[t,r]),r._observers.has("update")){const u=new g1;cg(u,t)&&r.emit("update",[u.toUint8Array(),t.origin,r,t])}if(r._observers.has("updateV2")){const u=new y1;cg(u,t)&&r.emit("updateV2",[u.toUint8Array(),t.origin,r,t])}const{subdocsAdded:a,subdocsLoaded:l,subdocsRemoved:c}=t;(a.size>0||c.size>0||l.size>0)&&(a.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),c.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:l,added:a,removed:c},r,t]),c.forEach(u=>u.destroy())),n.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,n])):kb(n,e+1)}}},Oe=(n,e,t=null,r=!0)=>{const i=n._transactionCleanups;let s=!1,o=null;n._transaction===null&&(s=!0,n._transaction=new T1(n,t,r),i.push(n._transaction),i.length===1&&n.emit("beforeAllTransactions",[n]),n.emit("beforeTransaction",[n._transaction,n]));try{o=e(n._transaction)}finally{if(s){const a=n._transaction===i[0];n._transaction=null,a&&kb(i,0)}}return o},dg="You must not compute changes after the event-handler fired.";class Kl{constructor(e,t){this.target=e,this.currentTarget=e,this.transaction=t,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=M1(this.currentTarget,this.target))}deletes(e){return pb(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Ki(dg);const e=new Map,t=this.target;this.transaction.changed.get(t).forEach(i=>{if(i!==null){const s=t._map.get(i);let o,a;if(this.adds(s)){let l=s.left;for(;l!==null&&this.adds(l);)l=l.left;if(this.deletes(s))if(l!==null&&this.deletes(l))o="delete",a=iu(l.content.getContent());else return;else l!==null&&this.deletes(l)?(o="update",a=iu(l.content.getContent())):(o="add",a=void 0)}else if(this.deletes(s))o="delete",a=iu(s.content.getContent());else return;e.set(i,{action:o,oldValue:a})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw Ki(dg);const t=this.target,r=zi(),i=zi(),s=[];if(e={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(t).has(null)){let a=null;const l=()=>{a&&s.push(a)};for(let c=t._start;c!==null;c=c.right)c.deleted?this.deletes(c)&&!this.adds(c)&&((a===null||a.delete===void 0)&&(l(),a={delete:0}),a.delete+=c.length,i.add(c)):this.adds(c)?((a===null||a.insert===void 0)&&(l(),a={insert:[]}),a.insert=a.insert.concat(c.content.getContent()),r.add(c)):((a===null||a.retain===void 0)&&(l(),a={retain:0}),a.retain+=c.length);a!==null&&a.retain===void 0&&l()}this._changes=e}return e}}const M1=(n,e)=>{const t=[];for(;e._item!==null&&e!==n;){if(e._item.parentSub!==null)t.unshift(e._item.parentSub);else{let r=0,i=e._item.parent._start;for(;i!==e._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;t.unshift(r)}e=e._item.parent}return t},ht=()=>{l1("Invalid access: Add Yjs type to a document before reading data.")},wb=80;let wf=0;class A1{constructor(e,t){e.marker=!0,this.p=e,this.index=t,this.timestamp=wf++}}const O1=n=>{n.timestamp=wf++},xb=(n,e,t)=>{n.p.marker=!1,n.p=e,e.marker=!0,n.index=t,n.timestamp=wf++},$1=(n,e,t)=>{if(n.length>=wb){const r=n.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return xb(r,e,t),r}else{const r=new A1(e,t);return n.push(r),r}},Hl=(n,e)=>{if(n._start===null||e===0||n._searchMarker===null)return null;const t=n._searchMarker.length===0?null:n._searchMarker.reduce((s,o)=>Ua(e-s.index)<Ua(e-o.index)?s:o);let r=n._start,i=0;for(t!==null&&(r=t.p,i=t.index,O1(t));r.right!==null&&i<e;){if(!r.deleted&&r.countable){if(e<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>e;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return t!==null&&Ua(t.index-i)<r.parent.length/wb?(xb(t,r,i),t):$1(n._searchMarker,r,i)},fo=(n,e,t)=>{for(let r=n.length-1;r>=0;r--){const i=n[r];if(t>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){n.splice(r,1);continue}i.p=s,s.marker=!0}(e<i.index||t>0&&e===i.index)&&(i.index=cs(e,i.index+t))}},Jl=(n,e,t)=>{const r=n,i=e.changedParentTypes;for(;ls(i,n,()=>[]).push(t),n._item!==null;)n=n._item.parent;_b(r._eH,t,e)};class nt{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=sg(),this._dEH=sg(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,t){this.doc=e,this._item=t}_copy(){throw _n()}clone(){throw _n()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,t){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){og(this._eH,e)}observeDeep(e){og(this._dEH,e)}unobserve(e){ag(this._eH,e)}unobserveDeep(e){ag(this._dEH,e)}toJSON(){}}const Cb=(n,e,t)=>{n.doc??ht(),e<0&&(e=n._length+e),t<0&&(t=n._length+t);let r=t-e;const i=[];let s=n._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const o=s.content.getContent();if(o.length<=e)e-=o.length;else{for(let a=e;a<o.length&&r>0;a++)i.push(o[a]),r--;e=0}}s=s.right}return i},Sb=n=>{n.doc??ht();const e=[];let t=n._start;for(;t!==null;){if(t.countable&&!t.deleted){const r=t.content.getContent();for(let i=0;i<r.length;i++)e.push(r[i])}t=t.right}return e},ho=(n,e)=>{let t=0,r=n._start;for(n.doc??ht();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)e(i[s],t++,n)}r=r.right}},Tb=(n,e)=>{const t=[];return ho(n,(r,i)=>{t.push(e(r,i,n))}),t},I1=n=>{let e=n._start,t=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(t===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};t=e.content.getContent(),r=0,e=e.right}const i=t[r++];return t.length<=r&&(t=null),{done:!1,value:i}}}},Eb=(n,e)=>{n.doc??ht();const t=Hl(n,e);let r=n._start;for(t!==null&&(r=t.p,e-=t.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},_l=(n,e,t,r)=>{let i=t;const s=n.doc,o=s.clientID,a=s.store,l=t===null?e._start:t.right;let c=[];const u=()=>{c.length>0&&(i=new ut(Re(o,xt(a,o)),i,i&&i.lastId,l,l&&l.id,e,null,new Vi(c)),i.integrate(n,0),c=[])};r.forEach(f=>{if(f===null)c.push(f);else switch(f.constructor){case Number:case Object:case Boolean:case Array:case String:c.push(f);break;default:switch(u(),f.constructor){case Uint8Array:case ArrayBuffer:i=new ut(Re(o,xt(a,o)),i,i&&i.lastId,l,l&&l.id,e,null,new Vl(new Uint8Array(f))),i.integrate(n,0);break;case $o:i=new ut(Re(o,xt(a,o)),i,i&&i.lastId,l,l&&l.id,e,null,new Gl(f)),i.integrate(n,0);break;default:if(f instanceof nt)i=new ut(Re(o,xt(a,o)),i,i&&i.lastId,l,l&&l.id,e,null,new wr(f)),i.integrate(n,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},Nb=()=>Ki("Length exceeded!"),Mb=(n,e,t,r)=>{if(t>e._length)throw Nb();if(t===0)return e._searchMarker&&fo(e._searchMarker,t,r.length),_l(n,e,null,r);const i=t,s=Hl(e,t);let o=e._start;for(s!==null&&(o=s.p,t-=s.index,t===0&&(o=o.prev,t+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(t<=o.length){t<o.length&&fr(n,Re(o.id.client,o.id.clock+t));break}t-=o.length}return e._searchMarker&&fo(e._searchMarker,i,r.length),_l(n,e,o,r)},P1=(n,e,t)=>{let i=(e._searchMarker||[]).reduce((s,o)=>o.index>s.index?o:s,{index:0,p:e._start}).p;if(i)for(;i.right;)i=i.right;return _l(n,e,i,t)},Ab=(n,e,t,r)=>{if(r===0)return;const i=t,s=r,o=Hl(e,t);let a=e._start;for(o!==null&&(a=o.p,t-=o.index);a!==null&&t>0;a=a.right)!a.deleted&&a.countable&&(t<a.length&&fr(n,Re(a.id.client,a.id.clock+t)),t-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&fr(n,Re(a.id.client,a.id.clock+r)),a.delete(n),r-=a.length),a=a.right;if(r>0)throw Nb();e._searchMarker&&fo(e._searchMarker,i,-s+r)},bl=(n,e,t)=>{const r=e._map.get(t);r!==void 0&&r.delete(n)},xf=(n,e,t,r)=>{const i=e._map.get(t)||null,s=n.doc,o=s.clientID;let a;if(r==null)a=new Vi([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:a=new Vi([r]);break;case Uint8Array:a=new Vl(r);break;case $o:a=new Gl(r);break;default:if(r instanceof nt)a=new wr(r);else throw new Error("Unexpected content type")}new ut(Re(o,xt(s.store,o)),i,i&&i.lastId,null,null,e,t,a).integrate(n,0)},Cf=(n,e)=>{n.doc??ht();const t=n._map.get(e);return t!==void 0&&!t.deleted?t.content.getContent()[t.length-1]:void 0},Ob=n=>{const e={};return n.doc??ht(),n._map.forEach((t,r)=>{t.deleted||(e[r]=t.content.getContent()[t.length-1])}),e},$b=(n,e)=>{n.doc??ht();const t=n._map.get(e);return t!==void 0&&!t.deleted},R1=(n,e)=>{const t={};return n._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!e.sv.has(s.id.client)||s.id.clock>=(e.sv.get(s.id.client)||0));)s=s.left;s!==null&&Ti(s,e)&&(t[i]=s.content.getContent()[s.length-1])}),t},_a=n=>(n.doc??ht(),c1(n._map.entries(),e=>!e[1].deleted));class Ib extends Kl{}class Ur extends nt{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const t=new Ur;return t.push(e),t}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Ur}clone(){const e=new Ur;return e.insert(0,this.toArray().map(t=>t instanceof nt?t.clone():t)),e}get length(){return this.doc??ht(),this._length}_callObserver(e,t){super._callObserver(e,t),Jl(this,e,new Ib(this,e))}insert(e,t){this.doc!==null?Oe(this.doc,r=>{Mb(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}push(e){this.doc!==null?Oe(this.doc,t=>{P1(t,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,t=1){this.doc!==null?Oe(this.doc,r=>{Ab(r,this,e,t)}):this._prelimContent.splice(e,t)}get(e){return Eb(this,e)}toArray(){return Sb(this)}slice(e=0,t=this.length){return Cb(this,e,t)}toJSON(){return this.map(e=>e instanceof nt?e.toJSON():e)}map(e){return Tb(this,e)}forEach(e){ho(this,e)}[Symbol.iterator](){return I1(this)}_write(e){e.writeTypeRef(K1)}}class j1 extends Kl{constructor(e,t,r){super(e,t),this.keysChanged=r}}class Hi extends nt{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,t){super._integrate(e,t),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new Hi}clone(){const e=new Hi;return this.forEach((t,r)=>{e.set(r,t instanceof nt?t.clone():t)}),e}_callObserver(e,t){Jl(this,e,new j1(this,e,t))}toJSON(){this.doc??ht();const e={};return this._map.forEach((t,r)=>{if(!t.deleted){const i=t.content.getContent()[t.length-1];e[r]=i instanceof nt?i.toJSON():i}}),e}get size(){return[..._a(this)].length}keys(){return cu(_a(this),e=>e[0])}values(){return cu(_a(this),e=>e[1].content.getContent()[e[1].length-1])}entries(){return cu(_a(this),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this.doc??ht(),this._map.forEach((t,r)=>{t.deleted||e(t.content.getContent()[t.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?Oe(this.doc,t=>{bl(t,this,e)}):this._prelimContent.delete(e)}set(e,t){return this.doc!==null?Oe(this.doc,r=>{xf(r,this,e,t)}):this._prelimContent.set(e,t),t}get(e){return Cf(this,e)}has(e){return $b(this,e)}clear(){this.doc!==null?Oe(this.doc,e=>{this.forEach(function(t,r,i){bl(e,i,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(H1)}}const rr=(n,e)=>n===e||typeof n=="object"&&typeof e=="object"&&n&&e&&KS(n,e);class sd{constructor(e,t,r,i){this.left=e,this.right=t,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&Yr(),this.right.content.constructor){case Je:this.right.deleted||us(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const fg=(n,e,t)=>{for(;e.right!==null&&t>0;){switch(e.right.content.constructor){case Je:e.right.deleted||us(e.currentAttributes,e.right.content);break;default:e.right.deleted||(t<e.right.length&&fr(n,Re(e.right.id.client,e.right.id.clock+t)),e.index+=e.right.length,t-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},ba=(n,e,t,r)=>{const i=new Map,s=r?Hl(e,t):null;if(s){const o=new sd(s.p.left,s.p,s.index,i);return fg(n,o,t-s.index)}else{const o=new sd(null,e._start,0,i);return fg(n,o,t)}},Pb=(n,e,t,r)=>{for(;t.right!==null&&(t.right.deleted===!0||t.right.content.constructor===Je&&rr(r.get(t.right.content.key),t.right.content.value));)t.right.deleted||r.delete(t.right.content.key),t.forward();const i=n.doc,s=i.clientID;r.forEach((o,a)=>{const l=t.left,c=t.right,u=new ut(Re(s,xt(i.store,s)),l,l&&l.lastId,c,c&&c.id,e,null,new Je(a,o));u.integrate(n,0),t.right=u,t.forward()})},us=(n,e)=>{const{key:t,value:r}=e;r===null?n.delete(t):n.set(t,r)},Rb=(n,e)=>{for(;n.right!==null;){if(!(n.right.deleted||n.right.content.constructor===Je&&rr(e[n.right.content.key]??null,n.right.content.value)))break;n.forward()}},jb=(n,e,t,r)=>{const i=n.doc,s=i.clientID,o=new Map;for(const a in r){const l=r[a],c=t.currentAttributes.get(a)??null;if(!rr(c,l)){o.set(a,c);const{left:u,right:f}=t;t.right=new ut(Re(s,xt(i.store,s)),u,u&&u.lastId,f,f&&f.id,e,null,new Je(a,l)),t.right.integrate(n,0),t.forward()}}return o},du=(n,e,t,r,i)=>{t.currentAttributes.forEach((d,h)=>{i[h]===void 0&&(i[h]=null)});const s=n.doc,o=s.clientID;Rb(t,i);const a=jb(n,e,t,i),l=r.constructor===String?new Wn(r):r instanceof nt?new wr(r):new ds(r);let{left:c,right:u,index:f}=t;e._searchMarker&&fo(e._searchMarker,t.index,l.getLength()),u=new ut(Re(o,xt(s.store,o)),c,c&&c.lastId,u,u&&u.id,e,null,l),u.integrate(n,0),t.right=u,t.index=f,t.forward(),Pb(n,e,t,a)},hg=(n,e,t,r,i)=>{const s=n.doc,o=s.clientID;Rb(t,i);const a=jb(n,e,t,i);e:for(;t.right!==null&&(r>0||a.size>0&&(t.right.deleted||t.right.content.constructor===Je));){if(!t.right.deleted)switch(t.right.content.constructor){case Je:{const{key:l,value:c}=t.right.content,u=i[l];if(u!==void 0){if(rr(u,c))a.delete(l);else{if(r===0)break e;a.set(l,c)}t.right.delete(n)}else t.currentAttributes.set(l,c);break}default:r<t.right.length&&fr(n,Re(t.right.id.client,t.right.id.clock+r)),r-=t.right.length;break}t.forward()}if(r>0){let l="";for(;r>0;r--)l+=`
`;t.right=new ut(Re(o,xt(s.store,o)),t.left,t.left&&t.left.lastId,t.right,t.right&&t.right.id,e,null,new Wn(l)),t.right.integrate(n,0),t.forward()}Pb(n,e,t,a)},Db=(n,e,t,r,i)=>{let s=e;const o=yn();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===Je){const c=s.content;o.set(c.key,c)}s=s.right}let a=0,l=!1;for(;e!==s;){if(t===e&&(l=!0),!e.deleted){const c=e.content;switch(c.constructor){case Je:{const{key:u,value:f}=c,d=r.get(u)??null;(o.get(u)!==c||d===f)&&(e.delete(n),a++,!l&&(i.get(u)??null)===f&&d!==f&&(d===null?i.delete(u):i.set(u,d))),!l&&!e.deleted&&us(i,c);break}}}e=e.right}return a},D1=(n,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const t=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===Je){const r=e.content.key;t.has(r)?e.delete(n):t.add(r)}e=e.left}},L1=n=>{let e=0;return Oe(n.doc,t=>{let r=n._start,i=n._start,s=yn();const o=Zu(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case Je:us(o,i.content);break;default:e+=Db(t,r,i,s,o),s=Zu(o),r=i;break}i=i.right}}),e},F1=n=>{const e=new Set,t=n.doc;for(const[r,i]of n.afterState.entries()){const s=n.beforeState.get(r)||0;i!==s&&vb(n,t.store.clients.get(r),s,i,o=>{!o.deleted&&o.content.constructor===Je&&o.constructor!==Zn&&e.add(o.parent)})}Oe(t,r=>{hb(n,n.deleteSet,i=>{if(i instanceof Zn||!i.parent._hasFormatting||e.has(i.parent))return;const s=i.parent;i.content.constructor===Je?e.add(s):D1(r,i)});for(const i of e)L1(i)})},pg=(n,e,t)=>{const r=t,i=Zu(e.currentAttributes),s=e.right;for(;t>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case wr:case ds:case Wn:t<e.right.length&&fr(n,Re(e.right.id.client,e.right.id.clock+t)),t-=e.right.length,e.right.delete(n);break}e.forward()}s&&Db(n,s,e.right,i,e.currentAttributes);const o=(e.left||e.right).parent;return o._searchMarker&&fo(o._searchMarker,e.index,-r+t),e};class q1 extends Kl{constructor(e,t,r){super(e,t),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,t=[];Oe(e,r=>{const i=new Map,s=new Map;let o=this.target._start,a=null;const l={};let c="",u=0,f=0;const d=()=>{if(a!==null){let h=null;switch(a){case"delete":f>0&&(h={delete:f}),f=0;break;case"insert":(typeof c=="object"||c.length>0)&&(h={insert:c},i.size>0&&(h.attributes={},i.forEach((g,m)=>{g!==null&&(h.attributes[m]=g)}))),c="";break;case"retain":u>0&&(h={retain:u},US(l)||(h.attributes=FS({},l))),u=0;break}h&&t.push(h),a=null}};for(;o!==null;){switch(o.content.constructor){case wr:case ds:this.adds(o)?this.deletes(o)||(d(),a="insert",c=o.content.getContent()[0],d()):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),f+=1):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=1);break;case Wn:this.adds(o)?this.deletes(o)||(a!=="insert"&&(d(),a="insert"),c+=o.content.str):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),f+=o.length):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=o.length);break;case Je:{const{key:h,value:g}=o.content;if(this.adds(o)){if(!this.deletes(o)){const m=i.get(h)??null;rr(m,g)?g!==null&&o.delete(r):(a==="retain"&&d(),rr(g,s.get(h)??null)?delete l[h]:l[h]=g)}}else if(this.deletes(o)){s.set(h,g);const m=i.get(h)??null;rr(m,g)||(a==="retain"&&d(),l[h]=m)}else if(!o.deleted){s.set(h,g);const m=l[h];m!==void 0&&(rr(m,g)?m!==null&&o.delete(r):(a==="retain"&&d(),g===null?delete l[h]:l[h]=g))}o.deleted||(a==="insert"&&d(),us(i,o.content));break}}o=o.right}for(d();t.length>0;){const h=t[t.length-1];if(h.retain!==void 0&&h.attributes===void 0)t.pop();else break}}),this._delta=t}return this._delta}}class vl extends nt{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??ht(),this._length}_integrate(e,t){super._integrate(e,t);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new vl}clone(){const e=new vl;return e.applyDelta(this.toDelta()),e}_callObserver(e,t){super._callObserver(e,t);const r=new q1(this,e,t);Jl(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){this.doc??ht();let e="",t=this._start;for(;t!==null;)!t.deleted&&t.countable&&t.content.constructor===Wn&&(e+=t.content.str),t=t.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:t=!0}={}){this.doc!==null?Oe(this.doc,r=>{const i=new sd(null,this._start,0,new Map);for(let s=0;s<e.length;s++){const o=e[s];if(o.insert!==void 0){const a=!t&&typeof o.insert=="string"&&s===e.length-1&&i.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&du(r,this,i,a,o.attributes||{})}else o.retain!==void 0?hg(r,this,i,o.retain,o.attributes||{}):o.delete!==void 0&&pg(r,i,o.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,t,r){this.doc??ht();const i=[],s=new Map,o=this.doc;let a="",l=this._start;function c(){if(a.length>0){const f={};let d=!1;s.forEach((g,m)=>{d=!0,f[m]=g});const h={insert:a};d&&(h.attributes=f),i.push(h),a=""}}const u=()=>{for(;l!==null;){if(Ti(l,e)||t!==void 0&&Ti(l,t))switch(l.content.constructor){case Wn:{const f=s.get("ychange");e!==void 0&&!Ti(l,e)?(f===void 0||f.user!==l.id.client||f.type!=="removed")&&(c(),s.set("ychange",r?r("removed",l.id):{type:"removed"})):t!==void 0&&!Ti(l,t)?(f===void 0||f.user!==l.id.client||f.type!=="added")&&(c(),s.set("ychange",r?r("added",l.id):{type:"added"})):f!==void 0&&(c(),s.delete("ychange")),a+=l.content.str;break}case wr:case ds:{c();const f={insert:l.content.getContent()[0]};if(s.size>0){const d={};f.attributes=d,s.forEach((h,g)=>{d[g]=h})}i.push(f);break}case Je:Ti(l,e)&&(c(),us(s,l.content));break}l=l.right}c()};return e||t?Oe(o,f=>{e&&rd(f,e),t&&rd(f,t),u()},"cleanup"):u(),i}insert(e,t,r){if(t.length<=0)return;const i=this.doc;i!==null?Oe(i,s=>{const o=ba(s,this,e,!r);r||(r={},o.currentAttributes.forEach((a,l)=>{r[l]=a})),du(s,this,o,t,r)}):this._pending.push(()=>this.insert(e,t,r))}insertEmbed(e,t,r){const i=this.doc;i!==null?Oe(i,s=>{const o=ba(s,this,e,!r);du(s,this,o,t,r||{})}):this._pending.push(()=>this.insertEmbed(e,t,r||{}))}delete(e,t){if(t===0)return;const r=this.doc;r!==null?Oe(r,i=>{pg(i,ba(i,this,e,!0),t)}):this._pending.push(()=>this.delete(e,t))}format(e,t,r){if(t===0)return;const i=this.doc;i!==null?Oe(i,s=>{const o=ba(s,this,e,!1);o.right!==null&&hg(s,this,o,t,r)}):this._pending.push(()=>this.format(e,t,r))}removeAttribute(e){this.doc!==null?Oe(this.doc,t=>{bl(t,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,t){this.doc!==null?Oe(this.doc,r=>{xf(r,this,e,t)}):this._pending.push(()=>this.setAttribute(e,t))}getAttribute(e){return Cf(this,e)}getAttributes(){return Ob(this)}_write(e){e.writeTypeRef(J1)}}class fu{constructor(e,t=()=>!0){this._filter=t,this._root=e,this._currentNode=e._start,this._firstCall=!0,e.doc??ht()}[Symbol.iterator](){return this}next(){let e=this._currentNode,t=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(t)))do if(t=e.content.type,!e.deleted&&(t.constructor===po||t.constructor===Ji)&&t._start!==null)e=t._start;else for(;e!==null;){const r=e.next;if(r!==null){e=r;break}else e.parent===this._root?e=null:e=e.parent._item}while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class Ji extends nt{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Ji}clone(){const e=new Ji;return e.insert(0,this.toArray().map(t=>t instanceof nt?t.clone():t)),e}get length(){return this.doc??ht(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new fu(this,e)}querySelector(e){e=e.toUpperCase();const r=new fu(this,i=>i.nodeName&&i.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),Wi(new fu(this,t=>t.nodeName&&t.nodeName.toUpperCase()===e))}_callObserver(e,t){Jl(this,e,new B1(this,t,e))}toString(){return Tb(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,t={},r){const i=e.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),ho(this,s=>{i.insertBefore(s.toDOM(e,t,r),null)}),i}insert(e,t){this.doc!==null?Oe(this.doc,r=>{Mb(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}insertAfter(e,t){if(this.doc!==null)Oe(this.doc,r=>{const i=e&&e instanceof nt?e._item:e;_l(r,this,i,t)});else{const r=this._prelimContent,i=e===null?0:r.findIndex(s=>s===e)+1;if(i===0&&e!==null)throw Ki("Reference item not found");r.splice(i,0,...t)}}delete(e,t=1){this.doc!==null?Oe(this.doc,r=>{Ab(r,this,e,t)}):this._prelimContent.splice(e,t)}toArray(){return Sb(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return Eb(this,e)}slice(e=0,t=this.length){return Cb(this,e,t)}forEach(e){ho(this,e)}_write(e){e.writeTypeRef(G1)}}class po extends Ji{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,t){super._integrate(e,t),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new po(this.nodeName)}clone(){const e=new po(this.nodeName),t=this.getAttributes();return BS(t,(r,i)=>{typeof r=="string"&&e.setAttribute(i,r)}),e.insert(0,this.toArray().map(r=>r instanceof nt?r.clone():r)),e}toString(){const e=this.getAttributes(),t=[],r=[];for(const a in e)r.push(a);r.sort();const i=r.length;for(let a=0;a<i;a++){const l=r[a];t.push(l+'="'+e[l]+'"')}const s=this.nodeName.toLocaleLowerCase(),o=t.length>0?" "+t.join(" "):"";return`<${s}${o}>${super.toString()}</${s}>`}removeAttribute(e){this.doc!==null?Oe(this.doc,t=>{bl(t,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,t){this.doc!==null?Oe(this.doc,r=>{xf(r,this,e,t)}):this._prelimAttrs.set(e,t)}getAttribute(e){return Cf(this,e)}hasAttribute(e){return $b(this,e)}getAttributes(e){return e?R1(this,e):Ob(this)}toDOM(e=document,t={},r){const i=e.createElement(this.nodeName),s=this.getAttributes();for(const o in s){const a=s[o];typeof a=="string"&&i.setAttribute(o,a)}return ho(this,o=>{i.appendChild(o.toDOM(e,t,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(e){e.writeTypeRef(V1),e.writeKey(this.nodeName)}}class B1 extends Kl{constructor(e,t,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,t.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class Lb{constructor(e,t){this.id=e,this.length=t}get deleted(){throw _n()}mergeWith(e){return!1}write(e,t,r){throw _n()}integrate(e,t){throw _n()}}const U1=0;class Zn extends Lb{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){t>0&&(this.id.clock+=t,this.length-=t),bb(e.doc.store,this)}write(e,t){e.writeInfo(U1),e.writeLen(this.length-t)}getMissing(e,t){return null}}class Vl{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Vl(this.content)}splice(e){throw _n()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeBuf(this.content)}getRef(){return 3}}class kl{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new kl(this.len)}splice(e){const t=new kl(this.len-e);return this.len=e,t}mergeWith(e){return this.len+=e.len,!0}integrate(e,t){mb(e.deleteSet,t.id.client,t.id.clock,this.len),t.markDeleted()}delete(e){}gc(e){}write(e,t){e.writeLen(this.len-t)}getRef(){return 1}}const z1=(n,e)=>new $o({guid:n,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class Gl{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const t={};this.opts=t,e.gc||(t.gc=!1),e.autoLoad&&(t.autoLoad=!0),e.meta!==null&&(t.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Gl(z1(this.doc.guid,this.opts))}splice(e){throw _n()}mergeWith(e){return!1}integrate(e,t){this.doc._item=t,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,t){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}class ds{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new ds(this.embed)}splice(e){throw _n()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeJSON(this.embed)}getRef(){return 5}}class Je{constructor(e,t){this.key=e,this.value=t}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Je(this.key,this.value)}splice(e){throw _n()}mergeWith(e){return!1}integrate(e,t){const r=t.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,t){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const W1=yl("node_env")==="development";class Vi{constructor(e){this.arr=e,W1&&ib(e)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Vi(this.arr)}splice(e){const t=new Vi(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){const r=this.arr.length;e.writeLen(r-t);for(let i=t;i<r;i++){const s=this.arr[i];e.writeAny(s)}}getRef(){return 8}}class Wn{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Wn(this.str)}splice(e){const t=new Wn(this.str.slice(e));this.str=this.str.slice(0,e);const r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"�",t.str="�"+t.str.slice(1)),t}mergeWith(e){return this.str+=e.str,!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeString(t===0?this.str:this.str.slice(t))}getRef(){return 4}}const K1=0,H1=1,J1=2,V1=3,G1=4;class wr{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new wr(this.type._copy())}splice(e){throw _n()}mergeWith(e){return!1}integrate(e,t){this.type._integrate(e.doc,t)}delete(e){let t=this.type._start;for(;t!==null;)t.deleted?t.id.clock<(e.beforeState.get(t.id.client)||0)&&e._mergeStructs.push(t):t.delete(e),t=t.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let t=this.type._start;for(;t!==null;)t.gc(e,!0),t=t.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,t){this.type._write(e)}getRef(){return 7}}const Fb=(n,e,t)=>{const{client:r,clock:i}=e.id,s=new ut(Re(r,i+t),e,Re(r,i+t-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(t));return e.deleted&&s.markDeleted(),e.keep&&(s.keep=!0),e.redone!==null&&(s.redone=Re(e.redone.client,e.redone.clock+t)),e.right=s,s.right!==null&&(s.right.left=s),n._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),e.length=t,s};class ut extends Lb{constructor(e,t,r,i,s,o,a,l){super(e,l.getLength()),this.origin=r,this.left=t,this.right=i,this.rightOrigin=s,this.parent=o,this.parentSub=a,this.redone=null,this.content=l,this.info=this.content.isCountable()?Gp:0}set marker(e){(this.info&ou)>0!==e&&(this.info^=ou)}get marker(){return(this.info&ou)>0}get keep(){return(this.info&Vp)>0}set keep(e){this.keep!==e&&(this.info^=Vp)}get countable(){return(this.info&Gp)>0}get deleted(){return(this.info&su)>0}set deleted(e){this.deleted!==e&&(this.info^=su)}markDeleted(){this.info|=su}getMissing(e,t){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=xt(t,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=xt(t,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Wa&&this.id.client!==this.parent.client&&this.parent.clock>=xt(t,this.parent.client))return this.parent.client;if(this.origin&&(this.left=lg(e,t,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=fr(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===Zn||this.right&&this.right.constructor===Zn)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===ut?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===ut&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Wa){const r=uu(t,this.parent);r.constructor===Zn?this.parent=null:this.parent=r.content.type}return null}integrate(e,t){if(t>0&&(this.id.clock+=t,this.left=lg(e,e.doc.store,Re(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(t),this.length-=t),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,o=new Set;for(;i!==null&&i!==this.right;){if(o.add(i),s.add(i),ya(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(ya(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&o.has(uu(e.doc.store,i.origin)))s.has(uu(e.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),bb(e.doc.store,this),this.content.integrate(e,this),ug(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new Zn(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:Re(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&ya(e.origin,this.lastId)&&this.right===e&&ya(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const t=this.parent._searchMarker;return t&&t.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const t=this.parent;this.countable&&this.parentSub===null&&(t._length-=this.length),this.markDeleted(),mb(e.deleteSet,this.id.client,this.id.clock,this.length),ug(e,t,this.parentSub),this.content.delete(e)}}gc(e,t){if(!this.deleted)throw Yr();this.content.gc(e),t?S1(e,this,new Zn(this.id,this.length)):this.content=new kl(this.length)}write(e,t){const r=t>0?Re(this.id.client,this.id.clock+t-1):this.origin,i=this.rightOrigin,s=this.parentSub,o=this.content.getRef()&hS|(r===null?0:ml)|(i===null?0:tb)|(s===null?0:fS);if(e.writeInfo(o),r!==null&&e.writeLeftID(r),i!==null&&e.writeRightID(i),r===null&&i===null){const a=this.parent;if(a._item!==void 0){const l=a._item;if(l===null){const c=w1(a);e.writeParentInfo(!0),e.writeString(c)}else e.writeParentInfo(!1),e.writeLeftID(l.id)}else a.constructor===String?(e.writeParentInfo(!0),e.writeString(a)):a.constructor===Wa?(e.writeParentInfo(!1),e.writeLeftID(a)):Yr();s!==null&&e.writeString(s)}this.content.write(e,t)}}const qb=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},Bb="__ $YJS$ __";qb[Bb]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");qb[Bb]=!0;const Y1=ie("TOGGLE_CONNECT_COMMAND");var X1=Object.defineProperty,Q1=(n,e,t)=>e in n?X1(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Z=(n,e,t)=>Q1(n,typeof e!="symbol"?e+"":e,t);const hu=n=>Ae(Iy(n)),Xr=Xm("cid",{parse:n=>typeof n=="string"?n:void 0}),Qr=Xm("segment",{parse:n=>typeof n=="string"?n:void 0}),od="unknown",Ub=1;class ci extends pt{constructor(e="",t,r,i){super(i),Z(this,"__tag"),Z(this,"__marker"),Z(this,"__unknownAttributes"),this.__tag=e,this.__marker=t,this.__unknownAttributes=r}static getType(){return"unknown"}static clone(e){const{__tag:t,__marker:r,__unknownAttributes:i,__key:s}=e;return new ci(t,r,i,s)}static importDOM(){return{[od]:e=>eT(e)?{conversion:Z1,priority:1}:null}}static importJSON(e){return zb().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setTag(e.tag).setMarker(e.marker).setUnknownAttributes(e.unknownAttributes)}setTag(e){if(this.__tag===e)return this;const t=this.getWritable();return t.__tag=e,t}getTag(){return this.getLatest().__tag}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement(od);return e.style.display="none",e}updateDOM(){return!1}exportDOM(){return{element:null}}exportJSON(){return{...super.exportJSON(),type:this.getType(),tag:this.getTag(),marker:this.getMarker(),unknownAttributes:this.getUnknownAttributes(),version:Ub}}canBeEmpty(){return!0}isInline(){return!0}extractWithChild(){return!1}excludeFromCopy(e){return e!=="clone"}}function Z1(n){const e=n.getAttribute("data-tag")??"",t=n.getAttribute("data-marker")??"";return{node:zb(e,t)}}function zb(n,e,t){return Ae(new ci(n,e,t))}function eT(n){return(n==null?void 0:n.tagName)===od}function Io(n){return n instanceof ci}const go="id",Wb=1;class Bt extends pt{constructor(e="",t,r){super(r),Z(this,"__marker",go),Z(this,"__code"),Z(this,"__unknownAttributes"),this.__code=e,this.__unknownAttributes=t}static getType(){return"book"}static clone(e){const{__code:t,__unknownAttributes:r,__key:i}=e;return new Bt(t,r,i)}static importJSON(e){const{code:t}=e;return Kb(t).updateFromJSON(e)}static isValidBookCode(e){return nk(e)}updateFromJSON(e){return super.updateFromJSON(e).setCode(e.code).setUnknownAttributes(e.unknownAttributes)}getMarker(){return this.getLatest().__marker}setCode(e){if(this.__code===e)return this;const t=this.getWritable();return t.__code=e,t}getCode(){return this.getLatest().__code}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("p");return e.setAttribute("data-marker",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`),e.setAttribute("data-code",this.__code),e}updateDOM(){return!1}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),code:this.getCode(),unknownAttributes:this.getUnknownAttributes(),version:Wb}}}function Kb(n,e){return Ae(new Bt(n,e))}function bn(n){return n instanceof Bt}function tT(n){return(n==null?void 0:n.type)===Bt.getType()}const me=" ",ad="​",Sf=`${me}|`,Yl="p",vn="+",Gi="-",wl="chapter",ld="verse",gg="invalid",nT="text-spacing",rT="formatted-font",iT="marker-",Tf="external-usj-mutation",Hb="selection-change",cd="cursor-change",ud="annotation-change",dd="delta-change",sT=[Tf,Hb,cd,ud,dd],xl="c",Jb=1;class rn extends pt{constructor(e="",t,r,i,s,o){super(o),Z(this,"__marker"),Z(this,"__number"),Z(this,"__sid"),Z(this,"__altnumber"),Z(this,"__pubnumber"),Z(this,"__unknownAttributes"),this.__marker=xl,this.__number=e,this.__sid=t,this.__altnumber=r,this.__pubnumber=i,this.__unknownAttributes=s}static getType(){return"chapter"}static clone(e){const{__number:t,__sid:r,__altnumber:i,__pubnumber:s,__unknownAttributes:o,__key:a}=e;return new rn(t,r,i,s,o,a)}static importJSON(e){return Vb().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setNumber(e.number).setSid(e.sid).setAltnumber(e.altnumber).setPubnumber(e.pubnumber).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}setNumber(e){if(this.__number===e)return this;const t=this.getWritable();return t.__number=e,t}getNumber(){return this.getLatest().__number}setSid(e){if(this.__sid===e)return this;const t=this.getWritable();return t.__sid=e,t}getSid(){return this.getLatest().__sid}setAltnumber(e){if(this.__altnumber===e)return this;const t=this.getWritable();return t.__altnumber=e,t}getAltnumber(){return this.getLatest().__altnumber}setPubnumber(e){if(this.__pubnumber===e)return this;const t=this.getWritable();return t.__pubnumber=e,t}getPubnumber(){return this.getLatest().__pubnumber}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("p");return e.setAttribute("data-marker",this.__marker),e.classList.add(wl,`usfm_${this.__marker}`),e.setAttribute("data-number",this.__number),e}updateDOM(){return!1}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),number:this.getNumber(),sid:this.getSid(),altnumber:this.getAltnumber(),pubnumber:this.getPubnumber(),unknownAttributes:this.getUnknownAttributes(),version:Jb}}}function Vb(n,e,t,r,i){return Ae(new rn(n,e,t,r,i))}function Ef(n){return n instanceof rn}function oT(n){return(n==null?void 0:n.type)===rn.getType()}const Gb=["fr","fq","fqa","fk","ft","fl","fw","fp","fv","fdc","fm"],Yb=["xo","xop","xk","xq","xt","xta","xot","xnt","xdc"],aT=["ca","cp","va","vp","add","bk","dc","em","jmp","k","nd","ord","pn","png","qt","rb","rq","sig","sls","tl","w","wa","wg","wh","wj","bd","it","bdit","no","sc","sup","ior","iqt","qac","qs","litl","lik","liv","liv1","liv2","liv3","liv4","liv5",...Gb,...Yb],Xb=1;class Pe extends pt{constructor(e="",t,r){super(r),Z(this,"__marker"),Z(this,"__unknownAttributes"),this.__marker=e,this.__unknownAttributes=t}static getType(){return"char"}static clone(e){const{__marker:t,__unknownAttributes:r,__key:i}=e;return new Pe(t,r,i)}static isValidMarker(e){return e!==void 0&&aT.includes(e)}static isValidFootnoteMarker(e){return e!==void 0&&Gb.includes(e)}static isValidCrossReferenceMarker(e){return e!==void 0&&Yb.includes(e)}static importDOM(){return{span:e=>cT(e)?{conversion:lT,priority:1}:null}}static importJSON(e){return pn().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("span");return e.setAttribute("data-marker",this.__marker),e.setAttribute("title",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`),e}updateDOM(){return!1}exportDOM(e){const{element:t}=super.exportDOM(e);return t&&Ne(t)&&(t.setAttribute("data-marker",this.getMarker()),t.classList.add(this.getType(),`usfm_${this.getMarker()}`)),{element:t}}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),unknownAttributes:this.getUnknownAttributes(),version:Xb}}insertNewAfter(e,t){const r=pn(this.getMarker());return r.setTextFormat(e.format),r.setTextStyle(e.style),r.setDirection(this.getDirection()),r.setFormat(this.getFormatType()),r.setStyle(this.getTextStyle()),this.insertAfter(r,t),r}canBeEmpty(){return!1}isInline(){return!0}}function lT(n){const e=n.getAttribute("data-marker")??"f";return{node:pn(e)}}function pn(n,e){return Ae(new Pe(n,e))}function cT(n){if(!n)return!1;const e=n.getAttribute("data-marker")??"";return Pe.isValidMarker(e)&&n.classList.contains(Pe.getType())}function Te(n){return n instanceof Pe}function uT(n){return(n==null?void 0:n.type)===Pe.getType()}const Qb=1,dT="c",Zb="span";class Vn extends br{constructor(e="",t=!1,r,i,s,o,a){super(a),Z(this,"__marker"),Z(this,"__number"),Z(this,"__showMarker"),Z(this,"__sid"),Z(this,"__altnumber"),Z(this,"__pubnumber"),Z(this,"__unknownAttributes"),this.__marker=dT,this.__number=e,this.__showMarker=t,this.__sid=r,this.__altnumber=i,this.__pubnumber=s,this.__unknownAttributes=o}static getType(){return"immutable-chapter"}static clone(e){const{__number:t,__showMarker:r,__sid:i,__altnumber:s,__pubnumber:o,__unknownAttributes:a,__key:l}=e;return new Vn(t,r,i,s,o,a,l)}static importDOM(){return{span:e=>ev(e)?{conversion:fT,priority:1}:null}}static importJSON(e){return Nf().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setNumber(e.number).setShowMarker(e.showMarker).setSid(e.sid).setAltnumber(e.altnumber).setPubnumber(e.pubnumber).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}setNumber(e){if(this.__number===e)return this;const t=this.getWritable();return t.__number=e,t}getNumber(){return this.getLatest().__number}setShowMarker(e=!1){if(this.__showMarker===e)return this;const t=this.getWritable();return t.__showMarker=e,t}getShowMarker(){return this.getLatest().__showMarker}setSid(e){if(this.__sid===e)return this;const t=this.getWritable();return t.__sid=e,t}getSid(){return this.getLatest().__sid}setAltnumber(e){if(this.__altnumber===e)return this;const t=this.getWritable();return t.__altnumber=e,t}getAltnumber(){return this.getLatest().__altnumber}setPubnumber(e){if(this.__pubnumber===e)return this;const t=this.getWritable();return t.__pubnumber=e,t}getPubnumber(){return this.getLatest().__pubnumber}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement(Zb);return e.setAttribute("data-marker",this.__marker),e.classList.add(wl,`usfm_${this.__marker}`),this.__showMarker&&e.classList.add("marker"),e.setAttribute("data-number",this.__number),e}updateDOM(){return!1}exportDOM(e){const{element:t}=super.exportDOM(e);return t&&Ne(t)&&(t.setAttribute("data-marker",this.getMarker()),t.classList.add(wl,`usfm_${this.getMarker()}`),t.setAttribute("data-number",this.getNumber())),{element:t}}decorate(){return this.getShowMarker()?Ro(this.getMarker(),this.getNumber()):this.getNumber()}exportJSON(){return{type:this.getType(),marker:this.getMarker(),number:this.getNumber(),showMarker:this.getShowMarker(),sid:this.getSid(),altnumber:this.getAltnumber(),pubnumber:this.getPubnumber(),unknownAttributes:this.getUnknownAttributes(),version:Qb}}isInline(){return!1}isKeyboardSelectable(){return!1}}function fT(n){const e=n.getAttribute("data-number")??"0";return{node:Nf(e)}}function Nf(n,e,t,r,i,s){return Ae(new Vn(n,e,t,r,i,s))}function ev(n){return n?n.classList.contains(wl)&&n.tagName.toLowerCase()===Zb:!1}function Po(n){return n instanceof Vn}function hT(n){return(n==null?void 0:n.type)===Vn.getType()}const tv=1;class hr extends vr{static getType(){return"implied-para"}static clone(e){return new hr(e.__key)}static importJSON(e){return Yt().updateFromJSON(e)}getMarker(){return Yl}exportJSON(){return{...super.exportJSON(),type:this.getType(),version:tv}}insertNewAfter(e,t){const r=Yt();return r.setTextFormat(e.format),r.setTextStyle(e.style),r.setDirection(this.getDirection()),r.setFormat(this.getFormatType()),r.setStyle(this.getTextStyle()),this.insertAfter(r,t),r}}function Yt(){return Ae(new hr)}function Kn(n){return n instanceof hr}function Mf(n){return(n==null?void 0:n.type)===hr.getType()}const Zr="zmsc-s",Pi="zmsc-e",pT=[Zr,Pi],gT=["ts-s","ts-e","t-s","t-e","ts","qt1-s","qt1-e","qt2-s","qt2-e","qt3-s","qt3-e","qt4-s","qt4-e","qt5-s","qt5-e","qt-s","qt-e",Zr,Pi],nv=1;class kn extends br{constructor(e="",t,r,i,s){super(s),Z(this,"__marker"),Z(this,"__sid"),Z(this,"__eid"),Z(this,"__unknownAttributes"),this.__marker=e,this.__sid=t,this.__eid=r,this.__unknownAttributes=i}static getType(){return"ms"}static clone(e){const{__marker:t,__sid:r,__eid:i,__unknownAttributes:s,__key:o}=e;return new kn(t,r,i,s,o)}static importJSON(e){return rv().updateFromJSON(e)}static isValidMarker(e){return e!==void 0&&(gT.includes(e)||e.startsWith("z"))}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setSid(e.sid).setEid(e.eid).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}setSid(e){if(this.__sid===e)return this;const t=this.getWritable();return t.__sid=e,t}getSid(){return this.getLatest().__sid}setEid(e){if(this.__eid===e)return this;const t=this.getWritable();return t.__eid=e,t}getEid(){return this.getLatest().__eid}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("span");return e.setAttribute("data-marker",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`),e}updateDOM(){return!1}decorate(){return""}exportJSON(){return{type:this.getType(),marker:this.getMarker(),sid:this.getSid(),eid:this.getEid(),unknownAttributes:this.getUnknownAttributes(),version:nv}}isKeyboardSelectable(){return!1}}function mT(n){return pT.includes(n)}function rv(n,e,t,r){return Ae(new kn(n,e,t,r))}function Xl(n){return n instanceof kn}const Af="f",yT=[Af,"fe","ef","efe","x","ex"],iv=1;class Ve extends pt{constructor(e=Af,t,r=!0,i,s,o){super(o),Z(this,"__marker"),Z(this,"__caller"),Z(this,"__isCollapsed"),Z(this,"__category"),Z(this,"__unknownAttributes"),this.__marker=e,this.__caller=t??(e==="x"||e==="ex"?Gi:vn),this.__isCollapsed=r,this.__category=i,this.__unknownAttributes=s}static getType(){return"note"}static clone(e){const{__marker:t,__caller:r,__isCollapsed:i,__category:s,__unknownAttributes:o,__key:a}=e;return new Ve(t,r,i,s,o,a)}static importDOM(){return{span:e=>bT(e)?{conversion:_T,priority:1}:null}}static importJSON(e){return Of().updateFromJSON(e)}static isValidMarker(e){return e!==void 0&&yT.includes(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setCaller(e.caller).setIsCollapsed(e.isCollapsed).setCategory(e.category).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}setCaller(e){if(this.__caller===e)return this;const t=this.getWritable();return t.__caller=e,t}getCaller(){return this.getLatest().__caller}setIsCollapsed(e){if(this.__isCollapsed===e)return this;const t=this.getWritable();return t.__isCollapsed=e,t}toggleIsCollapsed(){const e=this.getWritable();return e.__isCollapsed=!e.__isCollapsed,e}getIsCollapsed(){return this.getLatest().__isCollapsed}setCategory(e){if(this.__category===e)return this;const t=this.getWritable();return t.__category=e,t}getCategory(){return this.getLatest().__category}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("span");return e.setAttribute("data-marker",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`,this.__isCollapsed?"collapsed":"expanded"),e.setAttribute("data-caller",this.__caller),e}updateDOM(e){return e.__isCollapsed!==this.__isCollapsed}exportDOM(e){const{element:t}=super.exportDOM(e);return t&&Ne(t)&&(t.setAttribute("data-marker",this.getMarker()),t.classList.add(this.getType(),`usfm_${this.getMarker()}`,this.getIsCollapsed()?"collapsed":"expanded"),t.setAttribute("data-caller",this.getCaller())),{element:t}}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),caller:this.getCaller(),isCollapsed:this.getIsCollapsed(),category:this.getCategory(),unknownAttributes:this.getUnknownAttributes(),version:iv}}canBeEmpty(){return!1}isInline(){return!0}}function _T(n){const e=n.getAttribute("data-marker")??"f",t=n.getAttribute("data-caller")??"",r=n.classList.contains("collapsed");return{node:Of(e,t,r)}}function Of(n,e,t,r,i){return Ae(new Ve(n,e,t,r,i))}function bT(n){if(!n)return!1;const e=n.getAttribute("data-marker")??"";return Ve.isValidMarker(e)&&n.classList.contains(Ve.getType())}function ge(n){return n instanceof Ve}const vT=["ide","sts","rem","h","toc1","toc2","toc3","toca1","toca2","toca3","imt","imt1","imt2","imt3","imt4","is","is1","is2","ip","ipi","im","imi","ipq","imq","ipr","iq","iq1","iq2","iq3","ili","ili1","ili2","ib","iot","io","io1","io2","io3","io4","iex","imte","imte1","imte2","ie","mt","mt1","mt2","mt3","mt4","mte","mte1","mte2","cl","cd","ms","ms1","ms2","ms3","mr","s","s1","s2","s3","s4","sr","r","d","sp","sd","sd1","sd2","sd3","sd4",Yl,"m","po","cls","pr","pc","pm","pmo","pmc","pmr","pi","pi1","pi2","pi3","mi","lit","nb","q","q1","q2","q3","q4","qr","qc","qa","qm","qm1","qm2","qm3","qd","b","lh","li","li1","li2","li3","li4","lf","lim","lim1","lim2","lim3","lim4","pb"],sv=1;class Tt extends vr{constructor(e=Yl,t,r){super(r),Z(this,"__marker"),Z(this,"__unknownAttributes"),this.__marker=e,this.__unknownAttributes=t}static getType(){return"para"}static clone(e){const{__marker:t,__unknownAttributes:r,__key:i}=e;return new Tt(t,r,i)}static isValidMarker(e){return e!==void 0&&vT.includes(e)}static importDOM(){return{p:()=>({conversion:kT,priority:1})}}static importJSON(e){return mo().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("p");return e.setAttribute("data-marker",this.__marker),e.classList.add(this.__type,`usfm_${this.__marker}`),e}exportDOM(e){const{element:t}=super.exportDOM(e);return t&&Ne(t)&&(t.setAttribute("data-marker",this.getMarker()),t.classList.add(this.getType(),`usfm_${this.getMarker()}`)),{element:t}}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),unknownAttributes:this.getUnknownAttributes(),version:sv}}insertNewAfter(e,t){const r=mo(this.getMarker());return r.setTextFormat(e.format),r.setTextStyle(e.style),r.setDirection(this.getDirection()),r.setFormat(this.getFormatType()),r.setStyle(this.getTextStyle()),this.insertAfter(r,t),r}}function kT(n){const e=n.getAttribute("data-marker")??void 0,t=mo(e);if(n.style){t.setFormat(n.style.textAlign);const r=parseInt(n.style.textIndent,10)/20;r>0&&t.setIndent(r)}return{node:t}}function mo(n,e){return Ae(new Tt(n,e))}function dt(n){return n instanceof Tt}function wT(n){return(n==null?void 0:n.type)===Tt.getType()}const Cl="v",ov=1;class bt extends ft{constructor(e="",t,r,i,s,o,a){super(t??e,a),Z(this,"__marker"),Z(this,"__number"),Z(this,"__sid"),Z(this,"__altnumber"),Z(this,"__pubnumber"),Z(this,"__unknownAttributes"),this.__marker=Cl,this.__number=e,this.__sid=r,this.__altnumber=i,this.__pubnumber=s,this.__unknownAttributes=o}static getType(){return"verse"}static clone(e){const{__number:t,__text:r,__sid:i,__altnumber:s,__pubnumber:o,__unknownAttributes:a,__key:l}=e;return new bt(t,r,i,s,o,a,l)}static importJSON(e){return av().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setNumber(e.number).setSid(e.sid).setAltnumber(e.altnumber).setPubnumber(e.pubnumber).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}setNumber(e){if(this.__number===e)return this;const t=this.getWritable();return t.__number=e,t}getNumber(){return this.getLatest().__number}setSid(e){if(this.__sid===e)return this;const t=this.getWritable();return t.__sid=e,t}getSid(){return this.getLatest().__sid}setAltnumber(e){if(this.__altnumber===e)return this;const t=this.getWritable();return t.__altnumber=e,t}getAltnumber(){return this.getLatest().__altnumber}setPubnumber(e){if(this.__pubnumber===e)return this;const t=this.getWritable();return t.__pubnumber=e,t}getPubnumber(){return this.getLatest().__pubnumber}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(e){const t=super.createDOM(e);return t.setAttribute("data-marker",this.__marker),t.classList.add(ld,`usfm_${this.__marker}`),t.setAttribute("data-number",this.__number),t}exportJSON(){return{...super.exportJSON(),type:this.getType(),marker:this.getMarker(),number:this.getNumber(),sid:this.getSid(),altnumber:this.getAltnumber(),pubnumber:this.getPubnumber(),unknownAttributes:this.getUnknownAttributes(),version:ov}}}function av(n,e,t,r,i,s){return Ae(new bt(n,e,t,r,i,s))}function $f(n){return n instanceof bt}function xT(n){return(n==null?void 0:n.type)===bt.getType()}function CT(n){return oT(n)||hT(n)}function Lt(n){return Ef(n)||Po(n)}function ST(n,e){return n.find(t=>Lt(t)&&t.getNumber()===e.toString())}function TT(n,e=!1){return n.find((t,r)=>(!e||r>0)&&Lt(t))}function If(n){var e;if(!n)return;if(Lt(n))return n;let t=(e=n.getTopLevelElement())==null?void 0:e.getPreviousSibling();for(;t&&!Lt(t);)t=t.getPreviousSibling();if(t&&Lt(t))return t}function lv(n){let e=n;for(;e!==null;){if(ge(e))return e;e=e.getParent()}}function ET(n){return bn(n)||Ef(n)||Te(n)||Po(n)||Kn(n)||Xl(n)||dt(n)||ge(n)||$f(n)||Io(n)}function NT(n){var e;if(n.anchor.type==="element"){const r=n.anchor.getNode(),i=n.anchor.offset;if(i<r.getChildrenSize())return r.getChildAtIndex(i)}const t=n.anchor.getNode();return t.getNextSibling()??((e=t.getParent())==null?void 0:e.getNextSibling())??null}function MT(n){var e;const t=n.anchor.offset;if(n.anchor.type==="element"&&t>0)return n.anchor.getNode().getChildAtIndex(t-1);const r=n.anchor.getNode();return r.getPreviousSibling()??((e=r.getParent())==null?void 0:e.getPreviousSibling())??null}function Jt(n){return dt(n)||Kn(n)}function AT(n,e){let t=n.getParent();for(;t;){if(t.getKey()===e)return!0;t=t.getParent()}return!1}function ei(n,e){const t=es(e,Xr),r=!!(n.cid&&t),i=!n.cid&&!t;return n.style===e.getMarker()&&(i||r&&n.cid===t)}function OT(n,e){const t=F(n)?n:n.getParent(),r=F(e)?e:e.getParent(),i=t&&r?Ys(t,r):void 0;return i?i.commonAncestor:void 0}function $T(n){const e=n.getStartEndPoints();if(!e)return;const[t,r]=e,i=n.isBackward()?t:r;n.focus.set(i.key,i.offset,i.type),n.anchor.set(i.key,i.offset,i.type)}function Pf(n){return(n==null?void 0:n.type)===ft.getType()}function IT(n,e){if(!e)return;const t=n.findIndex(r=>r===e);t&&(n.length=t)}function PT(n,e){if(!e)return n;const t=e.getIndexWithinParent();return n.splice(t+1,n.length-t-1)}function Gn(n){return`\\${n}`}function Yi(n){return`\\${n}*`}function cv(n,e,t){const r=Gn(n);if(e!=null&&e.startsWith(r)){const i=parseInt(e.slice(r.length),10);isNaN(i)||(t=i.toString())}return t}function Ro(n,e){let t=Gn(n);return e&&(t+=`${me}${e}`),t+=" ",t}function uv(n){return Pf(n)&&n.text!==me?n.text:uT(n)?n.children.map(e=>uv(e)).join(""):""}function RT(n){return n.map(e=>uv(e)).filter(e=>e.length>0).join(" ").trim()}function Rf(n){return me+n+" "}function jf(n){const e=[];for(const t of n){if(!Te(t))continue;const r=t.getTextContent();r!==me&&r.length>0&&e.push(r)}return e.join(" ").trim()}function Ge(n,e=sk){const t={...n};return e.forEach(r=>{Reflect.deleteProperty(t,r)}),Object.keys(t).length===0?void 0:t}function jT(n,e){const t=e.getElementByKey(n.getKey());return t?t.tagName.toLowerCase():void 0}function ze(n){return Object.fromEntries(Object.entries(n).filter(([,e])=>e!==void 0))}function dv(n){if(!n)return;const e=n.getNodes();if(e.length>0)return n.isBackward()?e[e.length-1]:e[0]}function fd(n,e){if(!e)return(n+1).toString();const t=e.split("-");if(t.length===2)return parseInt(t[1])?`${parseInt(t[1])+1}`:`${parseInt(t[0])+1}`;const r=RegExp(/^(\d+)([a-yA-Y]{1,3})$/).exec(e);if(!r)return(parseInt(e)+1).toString();const i=String.fromCharCode(r[2].charCodeAt(0)+1);return`${r[1]}${i}`}function Df(n,e){if(!e)return!1;const t=e.split("-").map(r=>parseInt(r));if(t.length<1||t.length>2||t[0]>t[1])throw new Error("isVerseInRange: invalid range");return t.length===1?n===t[0]:t.length===2&&isNaN(t[1])?n>=t[0]:(t.length===2&&isNaN(t[0])||n>=t[0])&&n<=t[1]}function DT(n){return!!n&&n.includes("-")}const LT=1;class ui extends ft{constructor(e="",t="opening",r){super(pu(e,t),r),Z(this,"__marker"),Z(this,"__markerSyntax"),this.__marker=e,this.__markerSyntax=t}static getType(){return"marker"}static clone(e){return new ui(e.__marker,e.__markerSyntax,e.__key)}static importJSON(e){return Xi().updateFromJSON(e)}updateFromJSON(e){const{marker:t,markerSyntax:r="opening"}=e;return super.updateFromJSON(e).setMarker(t).setMarkerSyntax(r)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t.__text=pu(e,t.__markerSyntax),t}getMarker(){return this.getLatest().__marker}setMarkerSyntax(e){if(this.__markerSyntax===e)return this;const t=this.getWritable();return t.__markerSyntax=e,t.__text=pu(t.__marker,e),t}getMarkerSyntax(){return this.getLatest().__markerSyntax}createDOM(e){const t=super.createDOM(e);return t.setAttribute("data-marker",this.__marker),t.classList.add(this.__markerSyntax),t}exportJSON(){return{...super.exportJSON(),type:this.getType(),text:this.getTextContent(),marker:this.getMarker(),markerSyntax:this.getMarkerSyntax(),version:LT}}}function Xi(n,e){return Ae(new ui(n,e))}function jo(n){return n instanceof ui}function pu(n,e){return e==="closing"?Yi(n):e==="selfClosing"?Yi(""):Gn(n)}const ir="internal-comment",FT=[ir],qT={},BT=1;class tt extends pt{constructor(e=qT,t){super(t),Z(this,"__typedIDs"),this.__typedIDs=e}static getType(){return"typed-mark"}static clone(e){const t=JSON.parse(JSON.stringify(e.__typedIDs));return new tt(t,e.__key)}static isReservedType(e){return FT.includes(e)}static importDOM(){return null}static importJSON(e){return yo().updateFromJSON(e)}exportJSON(){return{...super.exportJSON(),type:this.getType(),typedIDs:this.getTypedIDs(),version:BT}}createDOM(e){const t=document.createElement("mark");for(const[r,i]of Object.entries(this.__typedIDs))ct(t,va(e.theme.typedMark,r)),i.length>1&&ct(t,va(e.theme.typedMarkOverlap,r));return t}updateDOM(e,t,r){for(const[i,s]of Object.entries(this.__typedIDs)){const o=e.__typedIDs[i].length,a=s.length,l=va(r.theme.typedMark,i),c=va(r.theme.typedMarkOverlap,i);o!==a&&(o===0?a===1&&ct(t,l):a===0&&Br(t,l),o===1?a===2&&ct(t,c):a===1&&Br(t,c))}return!1}updateFromJSON(e){return super.updateFromJSON(e).setTypedIDs(e.typedIDs)}hasID(e,t){const r=this.getTypedIDs()[e];if(!r)return!1;for(const i of r)if(t===i)return!0;return!1}getTypedIDs(){const e=this.getLatest();return rt(e)?e.__typedIDs:{}}setTypedIDs(e){const t=this.getWritable();return t.__typedIDs=e,t}addID(e,t){const r=this.getWritable();if(!rt(r))return;const i=r.__typedIDs[e]??[];r.__typedIDs[e]=i;for(const s of i)if(t===s)return;i.push(t)}deleteID(e,t){const r=this.getWritable();if(!rt(r))return;const i=r.__typedIDs[e];for(let s=0;s<i.length;s++)if(t===i[s]){i.splice(s,1);return}}hasNoIDsForEveryType(){return Object.values(this.getTypedIDs()).every(e=>e===void 0||e.length===0)}insertNewAfter(e,t=!0){const r=yo(this.__typedIDs);return this.insertAfter(r,t),r}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}canBeEmpty(){return!1}isInline(){return!0}extractWithChild(e,t,r){if(!q(t)||r==="html")return!1;const i=t.anchor,s=t.focus,o=i.getNode(),a=s.getNode(),l=t.isBackward()?i.offset-s.offset:s.offset-i.offset;return this.isParentOf(o)&&this.isParentOf(a)&&this.getTextContent().length===l}excludeFromCopy(e){return e!=="clone"}}function va(n,e){return`${n}-${e}`}function yo(n){return Ae(new tt(n))}function rt(n){return n instanceof tt}function UT(n){return(n==null?void 0:n.type)===tt.getType()}function fv(n){const e=n.getChildren();let t=null;for(const r of e)t===null?n.insertBefore(r):t.insertAfter(r),t=r;n.remove()}function hv(n,e,t,r){const i=n.getNodes(),s=n.anchor.offset,o=n.focus.offset,a=i.length,l=n.isBackward(),c=l?o:s,u=l?s:o;let f,d;for(let h=0;h<a;h++){const g=i[h];if(F(d)&&d.isParentOf(g))continue;const m=h===0,y=h===a-1;let b=null;if(W(g)){const _=g.getTextContentSize(),w=m?c:0,T=y?u:_;if(w===0&&T===0)continue;const O=g.splitText(w,T);b=O.length>1&&(O.length===3||m&&!y||T===_)?O[1]:O[0]}else{if(rt(g))continue;F(g)&&g.isInline()&&(b=g)}if(b!==null){if(b&&b.is(f))continue;const _=b.getParent();(_==null||!_.is(f))&&(d=void 0),f=_,d===void 0&&(d=yo({[e]:[t]}),b.insertBefore(d)),d.append(b)}else f=void 0,d=void 0}e===ir&&F(d)&&(l?d.selectStart():d.selectEnd())}function zT(n,e,t){let r=n;for(;r!==null;){if(rt(r))return r.getTypedIDs()[e];if(W(r)&&t===r.getTextContentSize()){const i=r.getNextSibling();if(rt(i))return i.getTypedIDs()[e]}r=r.getParent()}}function mg(n){return`external-${n}`}const pv=1;class xr extends br{constructor(e="",t="",r){super(r),Z(this,"__textType"),Z(this,"__text"),this.__textType=e,this.__text=t}static getType(){return"immutable-typed-text"}static clone(e){const{__textType:t,__text:r,__key:i}=e;return new xr(t,r,i)}static importDOM(){return{span:e=>KT(e)?{conversion:WT,priority:1}:null}}static importJSON(e){return Qi().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setTextType(e.textType).setTextContent(e.text)}setTextType(e){if(this.__textType===e)return this;const t=this.getWritable();return t.__textType=e,t}getTextType(){return this.getLatest().__textType}setTextContent(e){if(this.__text===e)return this;const t=this.getWritable();return t.__text=e,t}getTextContent(){return this.getLatest().__text}createDOM(){const e=document.createElement("span");return e.setAttribute("data-text-type",this.__textType),e.classList.add(this.__textType),e}updateDOM(){return!1}exportDOM(e){const{element:t}=super.exportDOM(e);return t&&Ne(t)&&t.setAttribute("data-text-type",this.getTextType()),{element:t}}decorate(){return this.getTextContent()}exportJSON(){return{type:this.getType(),textType:this.getTextType(),text:this.getTextContent(),version:pv}}isKeyboardSelectable(){return!1}}function WT(n){const e=n.getAttribute("data-text-type")??"",t=n.textContent??"";return{node:Qi(e,t)}}function Qi(n,e){return Ae(new xr(n,e))}function KT(n){return(n==null?void 0:n.tagName)==="span"}function Sl(n){return n instanceof xr}function HT(n){return(n==null?void 0:n.type)===xr.getType()}const Tl="unmatched",gv=1;class Cr extends br{constructor(e="",t){super(t),Z(this,"__marker"),this.__marker=e}static getType(){return"unmatched"}static clone(e){const{__marker:t,__key:r}=e;return new Cr(t,r)}static importDOM(){return{[Tl]:e=>VT(e)?{conversion:JT,priority:1}:null}}static importJSON(e){return Lf().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}createDOM(){const e=document.createElement(Tl);e.setAttribute("data-marker",this.__marker),e.classList.add(gg);const t=this.__marker.endsWith("*");return e.title=t?"This closing marker has no matching opening marker!":"This opening marker has no matching closing marker!",e}updateDOM(){return!1}exportDOM(e){const{element:t}=super.exportDOM(e);return t&&Ne(t)&&(t.setAttribute("data-marker",this.getMarker()),t.classList.add(gg)),{element:t}}decorate(){return`\\${this.getMarker()}${ad}`}exportJSON(){return{type:this.getType(),marker:this.getMarker(),version:gv}}isKeyboardSelectable(){return!1}}function JT(n){const e=n.getAttribute("data-marker")??"";return{node:Lf(e)}}function Lf(n){return Ae(new Cr(n))}function VT(n){return(n==null?void 0:n.tagName)===Tl}function mv(n){return n instanceof Cr}const GT=[Bt,Vn,rn,bt,Pe,Ve,kn,ui,ci,xr,Cr,Tt,hr,{replace:vr,with:()=>Yt(),withKlass:hr}];var P;(function(n){n.FileIdentification="FileIdentification",n.Headers="Headers",n.Remarks="Remarks",n.Introduction="Introduction",n.DivisionMarks="DivisionMarks",n.Paragraphs="Paragraphs",n.Poetry="Poetry",n.TitlesHeadings="TitlesHeadings",n.Tables="Tables",n.CenterTables="CenterTables",n.RightTables="RightTables",n.Lists="Lists",n.Footnotes="Footnotes",n.CrossReferences="CrossReferences",n.SpecialText="SpecialText",n.CharacterStyling="CharacterStyling",n.Breaks="Breaks",n.SpecialFeatures="SpecialFeatures",n.PeripheralReferences="PeripheralReferences",n.PeripheralMaterials="PeripheralMaterials",n.Uncategorized="Uncategorized"})(P||(P={}));var I;(function(n){n.Paragraph="Paragraph",n.Character="Character",n.Note="Note",n.Unknown="Unknown"})(I||(I={}));const YT={id:{category:P.FileIdentification,type:I.Paragraph,description:"File identification information (BOOKID, FILENAME, EDITOR, MODIFICATION DATE)",hasEndMarker:!1,children:{FileIdentification:["usfm","ide"],Headers:["h","h1","h2","h3","toc1","toc2","toc3"],Remarks:["rem","sts","restore"],Introduction:["imt","imt1","imt2","imt3","imt4","imte","imte1","imte2","is","is1","is2","iot","io","io1","io2","io3","io4","ior","ip","im","ipi","imi","ili","ili1","ili2","ipq","imq","ipr","ib","iq","iq1","iq2","iq3","iex","ie"],DivisionMarks:["c","cl"],TitlesHeadings:["mt","mt1","mt2","mt3","mt4"]}},usfm:{category:P.FileIdentification,type:I.Paragraph,description:"File markup version information",hasEndMarker:!1,children:void 0},ide:{category:P.FileIdentification,type:I.Paragraph,description:"File encoding information",hasEndMarker:!1,children:{Remarks:["rem","sts"]}},h:{category:P.Headers,type:I.Paragraph,description:"Running header text for a book (basic)",hasEndMarker:!1,children:{Headers:["toc1","toc2","toc3","toca1","toca2","toca3"]}},h1:{category:P.Headers,type:I.Paragraph,description:"Running header text",hasEndMarker:!1,children:{Headers:["toc1","toc2","toc3","toca1","toca2","toca3"]}},h2:{category:P.Headers,type:I.Paragraph,description:"Running header text, left side of page",hasEndMarker:!1,children:{Headers:["toc1","toc2","toc3","toca1","toca2","toca3"]}},h3:{category:P.Headers,type:I.Paragraph,description:"Running header text, right side of page",hasEndMarker:!1,children:{Headers:["toc1","toc2","toc3","toca1","toca2","toca3"]}},toc1:{category:P.Headers,type:I.Paragraph,description:"Long table of contents text",hasEndMarker:!1,children:void 0},toc2:{category:P.Headers,type:I.Paragraph,description:"Short table of contents text",hasEndMarker:!1,children:void 0},toc3:{category:P.Headers,type:I.Paragraph,description:"Book Abbreviation",hasEndMarker:!1,children:void 0},toca1:{category:P.Headers,type:I.Paragraph,description:"Alternative language long table of contents text",hasEndMarker:!1,children:void 0},toca2:{category:P.Headers,type:I.Paragraph,description:"Alternative language short table of contents text",hasEndMarker:!1,children:void 0},toca3:{category:P.Headers,type:I.Paragraph,description:"Alternative language book Abbreviation",hasEndMarker:!1,children:void 0},rem:{category:P.Remarks,type:I.Paragraph,description:"Comments and remarks",hasEndMarker:!1,children:void 0},sts:{category:P.Remarks,type:I.Paragraph,description:"Status of this file",hasEndMarker:!1,children:void 0},restore:{category:P.Remarks,type:I.Paragraph,description:"Project restore information",hasEndMarker:!1,children:void 0},imt:{category:P.Introduction,type:I.Paragraph,description:"Introduction major title, level 1 (if single level) (basic)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imt1:{category:P.Introduction,type:I.Paragraph,description:"Introduction major title, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imt2:{category:P.Introduction,type:I.Paragraph,description:"Introduction major title, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imt3:{category:P.Introduction,type:I.Paragraph,description:"Introduction major title, level 3",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imt4:{category:P.Introduction,type:I.Paragraph,description:"Introduction major title, level 4 (usually within parenthesis)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imte:{category:P.Introduction,type:I.Paragraph,description:"Introduction major title at introduction end, level 1 (if single level)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imte1:{category:P.Introduction,type:I.Paragraph,description:"Introduction major title at introduction end, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},imte2:{category:P.Introduction,type:I.Paragraph,description:"Introduction major title at introduction end, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},is:{category:P.Introduction,type:I.Paragraph,description:"Introduction section heading, level 1 (if single level) (basic)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"],CharacterStyling:["no"]}},is1:{category:P.Introduction,type:I.Paragraph,description:"Introduction section heading, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},is2:{category:P.Introduction,type:I.Paragraph,description:"Introduction section heading, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],SpecialText:["bk"]}},iot:{category:P.Introduction,type:I.Paragraph,description:"Introduction outline title (basic)",hasEndMarker:!1,children:{Introduction:["iqt"],CharacterStyling:["no"]}},io:{category:P.Introduction,type:I.Paragraph,description:"Introduction outline text, level 1 (if single level)",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},io1:{category:P.Introduction,type:I.Paragraph,description:"Introduction outline text, level 1 (if multiple levels) (basic)",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},io2:{category:P.Introduction,type:I.Paragraph,description:"Introduction outline text, level 2",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},io3:{category:P.Introduction,type:I.Paragraph,description:"Introduction outline text, level 3",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},io4:{category:P.Introduction,type:I.Paragraph,description:"Introduction outline text, level 4",hasEndMarker:!1,children:{Introduction:["ior","iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ior:{category:P.Introduction,type:I.Character,description:"Introduction references range for outline entry; for marking references separately",hasEndMarker:!0,children:void 0},ip:{category:P.Introduction,type:I.Paragraph,description:"Introduction prose paragraph (basic)",hasEndMarker:!1,children:{Introduction:["iqt"],Footnotes:["f","fe","fm"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},im:{category:P.Introduction,type:I.Paragraph,description:"Introduction prose paragraph, with no first line indent (may occur after poetry)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ipi:{category:P.Introduction,type:I.Paragraph,description:"Introduction prose paragraph, indented, with first line indent",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},imi:{category:P.Introduction,type:I.Paragraph,description:"Introduction prose paragraph text, indented, with no first line indent",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ili:{category:P.Introduction,type:I.Paragraph,description:"A list entry, level 1 (if single level)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ili1:{category:P.Introduction,type:I.Paragraph,description:"A list entry, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ili2:{category:P.Introduction,type:I.Paragraph,description:"A list entry, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ipq:{category:P.Introduction,type:I.Paragraph,description:"Introduction prose paragraph, quote from the body text",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},imq:{category:P.Introduction,type:I.Paragraph,description:"Introduction prose paragraph, quote from the body text, with no first line indent",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},ipr:{category:P.Introduction,type:I.Paragraph,description:"Introduction prose paragraph, right aligned",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},ib:{category:P.Introduction,type:I.Paragraph,description:"Introduction blank line",hasEndMarker:!1,children:{Introduction:["iqt"]}},iq:{category:P.Introduction,type:I.Paragraph,description:"Introduction poetry text, level 1 (if single level)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},iq1:{category:P.Introduction,type:I.Paragraph,description:"Introduction poetry text, level 1 (if multiple levels)",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},iq2:{category:P.Introduction,type:I.Paragraph,description:"Introduction poetry text, level 2",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},iq3:{category:P.Introduction,type:I.Paragraph,description:"Introduction poetry text, level 3",hasEndMarker:!1,children:{Introduction:["iqt"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},iex:{category:P.Introduction,type:I.Paragraph,description:"Introduction explanatory or bridge text (e.g. explanation of missing book in Short Old Testament)",hasEndMarker:!1,children:{Introduction:["iqt"],CharacterStyling:["no"]}},iqt:{category:P.Introduction,type:I.Character,description:"For quoted scripture text appearing in the introduction",hasEndMarker:!0,children:void 0},ie:{category:P.Introduction,type:I.Paragraph,description:"Introduction ending marker",hasEndMarker:!1,children:void 0},c:{category:P.DivisionMarks,type:I.Paragraph,description:"Chapter number",hasEndMarker:!1,children:{DivisionMarks:["ca","cp","cl","cd"],Paragraphs:["p","m","po","pr","cls","pi","pi1","pi2","pi3","pc","mi","nb"],Poetry:["q","q1","q2","q3","q4","qc","qr","qa","qd","b"],TitlesHeadings:["mte","ms","ms1","ms2","ms3","s","s1","s2","s3","s4","r","sp","d","sd","sd1","sd2","sd3","sd4"],Lists:["lh","li","li1","li2","li3","li4","lf","lim","lim1","lim2","lim3","lim4"],Footnotes:["f","fe"],SpecialText:["lit"],Breaks:["pb"]}},ca:{category:P.DivisionMarks,type:I.Character,description:"Second (alternate) chapter number (for coding dual versification; useful for places where different traditions of chapter breaks need to be supported in the same translation)",hasEndMarker:!0,children:void 0},cp:{category:P.DivisionMarks,type:I.Paragraph,description:"Published chapter number (chapter string that should appear in the published text)",hasEndMarker:!1,children:{Footnotes:["f"]}},cl:{category:P.DivisionMarks,type:I.Paragraph,description:"Chapter label used for translations that add a word such as 'Chapter' before chapter numbers (e.g. Psalms). The subsequent text is the chapter label.",hasEndMarker:!1,children:void 0},cd:{category:P.DivisionMarks,type:I.Paragraph,description:"Chapter Description (Publishing option D, e.g. in Russian Bibles)",hasEndMarker:!1,children:{DivisionMarks:["vp"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},v:{category:P.DivisionMarks,type:I.Character,description:"A verse number",hasEndMarker:!1,children:void 0},va:{category:P.DivisionMarks,type:I.Character,description:"Second (alternate) verse number (for coding dual numeration in Psalms; see also NRSV Exo 22.1-4)",hasEndMarker:!0,children:void 0},vp:{category:P.DivisionMarks,type:I.Character,description:"Published verse marker (verse string that should appear in the published text)",hasEndMarker:!0,children:void 0},p:{category:P.Paragraphs,type:I.Paragraph,description:"Paragraph text, with first line indent (basic)",hasEndMarker:!1,children:{Paragraphs:["pmo","pm","pmc","pmr"],Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},m:{category:P.Paragraphs,type:I.Paragraph,description:"Paragraph text, with no first line indent (may occur after poetry) (basic)",hasEndMarker:!1,children:{Paragraphs:["pmo","pm","pmc","pmr"],Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},po:{category:P.Paragraphs,type:I.Paragraph,description:"Letter opening",hasEndMarker:!1,children:{Paragraphs:["pmo","pm","pmc","pmr"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pr:{category:P.Paragraphs,type:I.Paragraph,description:"Text refrain (paragraph text, right aligned)",hasEndMarker:!1,children:{Paragraphs:["pmo","pm","pmc","pmr"],Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},cls:{category:P.Paragraphs,type:I.Paragraph,description:"Letter Closing",hasEndMarker:!1,children:{SpecialText:["tl","sig","pn","png","addpn","add"]}},pmo:{category:P.Paragraphs,type:I.Paragraph,description:"Embedded text opening",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pm:{category:P.Paragraphs,type:I.Paragraph,description:"Embedded text paragraph",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pmc:{category:P.Paragraphs,type:I.Paragraph,description:"Embedded text closing",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pmr:{category:P.Paragraphs,type:I.Paragraph,description:"Embedded text refrain (e.g. Then all the people shall say, 'Amen!')",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pi:{category:P.Paragraphs,type:I.Paragraph,description:"Paragraph text, level 1 indent (if single level), with first line indent; often used for discourse (basic)",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pi1:{category:P.Paragraphs,type:I.Paragraph,description:"Paragraph text, level 1 indent (if multiple levels), with first line indent; often used for discourse",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pi2:{category:P.Paragraphs,type:I.Paragraph,description:"Paragraph text, level 2 indent, with first line indent; often used for discourse",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pi3:{category:P.Paragraphs,type:I.Paragraph,description:"Paragraph text, level 3 indent, with first line indent; often used for discourse",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},pc:{category:P.Paragraphs,type:I.Paragraph,description:"Paragraph text, centered (for Inscription)",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},mi:{category:P.Paragraphs,type:I.Paragraph,description:"Paragraph text, indented, with no first line indent; often used for discourse",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},nb:{category:P.Paragraphs,type:I.Paragraph,description:"Paragraph text, with no break from previous paragraph text (at chapter boundary) (basic)",hasEndMarker:!1,children:{Poetry:["qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q:{category:P.Poetry,type:I.Paragraph,description:"Poetry text, level 1 indent (if single level)",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q1:{category:P.Poetry,type:I.Paragraph,description:"Poetry text, level 1 indent (if multiple levels) (basic)",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q2:{category:P.Poetry,type:I.Paragraph,description:"Poetry text, level 2 indent (basic)",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q3:{category:P.Poetry,type:I.Paragraph,description:"Poetry text, level 3 indent",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},q4:{category:P.Poetry,type:I.Paragraph,description:"Poetry text, level 4 indent",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qc:{category:P.Poetry,type:I.Paragraph,description:"Poetry text, centered",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qr:{category:P.Poetry,type:I.Paragraph,description:"Poetry text, Right Aligned",hasEndMarker:!1,children:{Poetry:["qs","qac","qm","qm1","qm2","qm3"],TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qs:{category:P.Poetry,type:I.Character,description:"Poetry text, Selah",hasEndMarker:!0,children:{Footnotes:["f"],CrossReferences:["x"]}},qa:{category:P.Poetry,type:I.Paragraph,description:"Poetry text, Acrostic marker/heading",hasEndMarker:!1,children:void 0},qac:{category:P.Poetry,type:I.Character,description:"Poetry text, Acrostic markup of the first character of a line of acrostic poetry",hasEndMarker:!0,children:void 0},qm:{category:P.Poetry,type:I.Paragraph,description:"Poetry text, embedded, level 1 indent (if single level)",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qm1:{category:P.Poetry,type:I.Paragraph,description:"Poetry text, embedded, level 1 indent (if multiple levels)",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qm2:{category:P.Poetry,type:I.Paragraph,description:"Poetry text, embedded, level 2 indent",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qm3:{category:P.Poetry,type:I.Paragraph,description:"Poetry text, embedded, level 3 indent",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},qd:{category:P.Poetry,type:I.Paragraph,description:"A Hebrew musical performance annotation, similar in content to Hebrew descriptive title.",hasEndMarker:!1,children:{TitlesHeadings:["mte1"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},b:{category:P.Poetry,type:I.Paragraph,description:"Poetry text stanza break (e.g. stanza break) (basic)",hasEndMarker:!1,children:void 0},mt:{category:P.TitlesHeadings,type:I.Paragraph,description:"The main title of the book (if single level)",hasEndMarker:!1,children:{Footnotes:["f"],CrossReferences:["x"]}},mt1:{category:P.TitlesHeadings,type:I.Paragraph,description:"The main title of the book (if multiple levels) (basic)",hasEndMarker:!1,children:{Footnotes:["f"],CrossReferences:["x"]}},mt2:{category:P.TitlesHeadings,type:I.Paragraph,description:"A secondary title usually occurring before the main title (basic)",hasEndMarker:!1,children:{Footnotes:["f"],CrossReferences:["x"]}},mt3:{category:P.TitlesHeadings,type:I.Paragraph,description:"A secondary title occurring after the main title",hasEndMarker:!1,children:{Footnotes:["f"],CrossReferences:["x"]}},mt4:{category:P.TitlesHeadings,type:I.Paragraph,description:"A small secondary title sometimes occurring within parentheses",hasEndMarker:!1,children:void 0},mte:{category:P.TitlesHeadings,type:I.Paragraph,description:"The main title of the book repeated at the end of the book, level 1 (if single level)",hasEndMarker:!1,children:void 0},mte1:{category:P.TitlesHeadings,type:I.Paragraph,description:"The main title of the book repeated at the end of the book, level 1 (if multiple levels)",hasEndMarker:!1,children:{TitlesHeadings:["mte2"]}},mte2:{category:P.TitlesHeadings,type:I.Paragraph,description:"A secondary title occurring before or after the 'ending' main title",hasEndMarker:!1,children:void 0},ms:{category:P.TitlesHeadings,type:I.Paragraph,description:"A major section division heading, level 1 (if single level) (basic)",hasEndMarker:!1,children:{TitlesHeadings:["mr"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},ms1:{category:P.TitlesHeadings,type:I.Paragraph,description:"A major section division heading, level 1 (if multiple levels)",hasEndMarker:!1,children:{TitlesHeadings:["mr"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},ms2:{category:P.TitlesHeadings,type:I.Paragraph,description:"A major section division heading, level 2",hasEndMarker:!1,children:{TitlesHeadings:["mr"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},ms3:{category:P.TitlesHeadings,type:I.Paragraph,description:"A major section division heading, level 3",hasEndMarker:!1,children:{TitlesHeadings:["mr"],Footnotes:["f","fe"]}},mr:{category:P.TitlesHeadings,type:I.Paragraph,description:"A major section division references range heading (basic)",hasEndMarker:!1,children:void 0},s:{category:P.TitlesHeadings,type:I.Paragraph,description:"A section heading, level 1 (if single level) (basic)",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},s1:{category:P.TitlesHeadings,type:I.Paragraph,description:"A section heading, level 1 (if multiple levels)",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},s2:{category:P.TitlesHeadings,type:I.Paragraph,description:"A section heading, level 2 (e.g. Proverbs 22-24)",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},s3:{category:P.TitlesHeadings,type:I.Paragraph,description:"A section heading, level 3 (e.g. Genesis 'The First Day')",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["no","it","bd","bdit","em","sc","sup"]}},s4:{category:P.TitlesHeadings,type:I.Paragraph,description:"A section heading, level 4",hasEndMarker:!1,children:{TitlesHeadings:["sr","r"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},sr:{category:P.TitlesHeadings,type:I.Paragraph,description:"A section division references range heading",hasEndMarker:!1,children:void 0},r:{category:P.TitlesHeadings,type:I.Paragraph,description:"Parallel reference(s) (basic)",hasEndMarker:!1,children:void 0},sp:{category:P.TitlesHeadings,type:I.Paragraph,description:"A heading, to identify the speaker (e.g. Job)",hasEndMarker:!1,children:{Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},d:{category:P.TitlesHeadings,type:I.Paragraph,description:"A Hebrew text heading, to provide description (e.g. Psalms)",hasEndMarker:!1,children:{Footnotes:["f","fe","fm"],CrossReferences:["x","xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},sd:{category:P.TitlesHeadings,type:I.Paragraph,description:"Vertical space used to divide the text into sections, level 1 (if single level)",hasEndMarker:!1,children:void 0},sd1:{category:P.TitlesHeadings,type:I.Paragraph,description:"Vertical space used to divide the text into sections, level 1 (if multiple levels)",hasEndMarker:!1,children:void 0},sd2:{category:P.TitlesHeadings,type:I.Paragraph,description:"Vertical space used to divide the text into sections, level 2",hasEndMarker:!1,children:void 0},sd3:{category:P.TitlesHeadings,type:I.Paragraph,description:"Vertical space used to divide the text into sections, level 3",hasEndMarker:!1,children:void 0},sd4:{category:P.TitlesHeadings,type:I.Paragraph,description:"Vertical space used to divide the text into sections, level 4",hasEndMarker:!1,children:void 0},lh:{category:P.Lists,type:I.Paragraph,description:"List header (introductory remark)",hasEndMarker:!1,children:{Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li:{category:P.Lists,type:I.Paragraph,description:"A list entry, level 1 (if single level)",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li1:{category:P.Lists,type:I.Paragraph,description:"A list entry, level 1 (if multiple levels)",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li2:{category:P.Lists,type:I.Paragraph,description:"A list entry, level 2",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li3:{category:P.Lists,type:I.Paragraph,description:"A list entry, level 3",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},li4:{category:P.Lists,type:I.Paragraph,description:"A list entry, level 4",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lf:{category:P.Lists,type:I.Paragraph,description:"List footer (concluding remark)",hasEndMarker:!1,children:{Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim:{category:P.Lists,type:I.Paragraph,description:"An embedded list entry, level 1 (if single level)",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim1:{category:P.Lists,type:I.Paragraph,description:"An embedded list entry, level 1 (if multiple levels)",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim2:{category:P.Lists,type:I.Paragraph,description:"An embedded list entry, level 2",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim3:{category:P.Lists,type:I.Paragraph,description:"An embedded list item, level 3",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},lim4:{category:P.Lists,type:I.Paragraph,description:"An embedded list entry, level 4",hasEndMarker:!1,children:{Lists:["litl","lik","liv","liv1","liv2","liv3","liv4","liv5"],Footnotes:["f","fe","fm"],CrossReferences:["x","xt","rq"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},litl:{category:P.Lists,type:I.Character,description:"List entry total text",hasEndMarker:!0,children:void 0},lik:{category:P.Lists,type:I.Character,description:"Structured list entry key text",hasEndMarker:!0,children:void 0},liv:{category:P.Lists,type:I.Character,description:"Structured list entry value 1 content (if single value)",hasEndMarker:!0,children:void 0},liv1:{category:P.Lists,type:I.Character,description:"Structured list entry value 1 content (if multiple values)",hasEndMarker:!0,children:void 0},liv2:{category:P.Lists,type:I.Character,description:"Structured list entry value 2 content",hasEndMarker:!0,children:void 0},liv3:{category:P.Lists,type:I.Character,description:"Structured list entry value 3 content",hasEndMarker:!0,children:void 0},liv4:{category:P.Lists,type:I.Character,description:"Structured list entry value 4 content",hasEndMarker:!0,children:void 0},liv5:{category:P.Lists,type:I.Character,description:"Structured list entry value 5 content",hasEndMarker:!0,children:void 0},f:{category:P.Footnotes,type:I.Note,description:"A Footnote text item (basic)",hasEndMarker:!0,children:{Footnotes:["fr","ft","fk","fq","fqa","fl","fw","fp","fv","fdc"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},fe:{category:P.Footnotes,type:I.Note,description:"An Endnote text item",hasEndMarker:!0,children:{Footnotes:["fr","ft","fk","fq","fqa","fl","fw","fp","fv","fdc"],CrossReferences:["xt"],SpecialText:["qt","nd","tl","dc","bk","sig","pn","png","addpn","wj","k","sls","ord","add"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},fr:{category:P.Footnotes,type:I.Character,description:"The origin reference for the footnote (basic)",hasEndMarker:!0,children:void 0},ft:{category:P.Footnotes,type:I.Character,description:"Footnote text, Protocanon (basic)",hasEndMarker:!0,children:void 0},fk:{category:P.Footnotes,type:I.Character,description:"A footnote keyword (basic)",hasEndMarker:!0,children:void 0},fq:{category:P.Footnotes,type:I.Character,description:"A footnote scripture quote or alternate rendering (basic)",hasEndMarker:!0,children:void 0},fqa:{category:P.Footnotes,type:I.Character,description:"A footnote alternate rendering for a portion of scripture text",hasEndMarker:!0,children:void 0},fl:{category:P.Footnotes,type:I.Character,description:"A footnote label text item, for marking or 'labelling' the type or alternate translation being provided in the note.",hasEndMarker:!0,children:void 0},fw:{category:P.Footnotes,type:I.Character,description:"A footnote witness list, for distinguishing a list of sigla representing witnesses in critical editions.",hasEndMarker:!0,children:void 0},fp:{category:P.Footnotes,type:I.Character,description:"A Footnote additional paragraph marker",hasEndMarker:!0,children:void 0},fv:{category:P.Footnotes,type:I.Character,description:"A verse number within the footnote text",hasEndMarker:!0,children:void 0},fdc:{category:P.Footnotes,type:I.Character,description:"Footnote text, applies to Deuterocanon only",hasEndMarker:!0,children:void 0},fm:{category:P.Footnotes,type:I.Character,description:"An additional footnote marker location for a previous footnote",hasEndMarker:!0,children:void 0},x:{category:P.CrossReferences,type:I.Note,description:"A list of cross references (basic)",hasEndMarker:!0,children:{CrossReferences:["xo","xop","xt","xta","xk","xq","xot","xnt","xdc"],CharacterStyling:["it","bd","bdit","em","sc","sup"]}},xo:{category:P.CrossReferences,type:I.Character,description:"The cross reference origin reference (basic)",hasEndMarker:!0,children:void 0},xop:{category:P.CrossReferences,type:I.Character,description:"Published cross reference origin reference (origin reference that should appear in the published text)",hasEndMarker:!0,children:void 0},xt:{category:P.CrossReferences,type:I.Character,description:"The cross reference target reference(s), protocanon only (basic)",hasEndMarker:!0,children:void 0},xta:{category:P.CrossReferences,type:I.Character,description:"Cross reference target references added text",hasEndMarker:!0,children:void 0},xk:{category:P.CrossReferences,type:I.Character,description:"A cross reference keyword",hasEndMarker:!0,children:void 0},xq:{category:P.CrossReferences,type:I.Character,description:"A cross-reference quotation from the scripture text",hasEndMarker:!0,children:void 0},xot:{category:P.CrossReferences,type:I.Character,description:"Cross-reference target reference(s), Old Testament only",hasEndMarker:!0,children:void 0},xnt:{category:P.CrossReferences,type:I.Character,description:"Cross-reference target reference(s), New Testament only",hasEndMarker:!0,children:void 0},xdc:{category:P.CrossReferences,type:I.Character,description:"Cross-reference target reference(s), Deuterocanon only",hasEndMarker:!0,children:void 0},rq:{category:P.CrossReferences,type:I.Character,description:"A cross-reference indicating the source text for the preceding quotation.",hasEndMarker:!0,children:void 0},qt:{category:P.SpecialText,type:I.Character,description:"For Old Testament quoted text appearing in the New Testament (basic)",hasEndMarker:!0,children:void 0},nd:{category:P.SpecialText,type:I.Character,description:"For name of deity (basic)",hasEndMarker:!0,children:void 0},tl:{category:P.SpecialText,type:I.Character,description:"For transliterated words",hasEndMarker:!0,children:void 0},dc:{category:P.SpecialText,type:I.Character,description:"Deuterocanonical/LXX additions or insertions in the Protocanonical text",hasEndMarker:!0,children:void 0},bk:{category:P.SpecialText,type:I.Character,description:"For the quoted name of a book",hasEndMarker:!0,children:void 0},sig:{category:P.SpecialText,type:I.Character,description:"For the signature of the author of an Epistle",hasEndMarker:!0,children:void 0},pn:{category:P.SpecialText,type:I.Character,description:"For a proper name",hasEndMarker:!0,children:void 0},png:{category:P.SpecialText,type:I.Character,description:"For a geographic proper name",hasEndMarker:!0,children:void 0},addpn:{category:P.SpecialText,type:I.Character,description:"For chinese words to be dot underline & underline",hasEndMarker:!0,children:void 0},wj:{category:P.SpecialText,type:I.Character,description:"For marking the words of Jesus",hasEndMarker:!0,children:void 0},k:{category:P.SpecialText,type:I.Character,description:"For a keyword",hasEndMarker:!0,children:void 0},sls:{category:P.SpecialText,type:I.Character,description:"To represent where the original text is in a secondary language or from an alternate text source",hasEndMarker:!0,children:void 0},ord:{category:P.SpecialText,type:I.Character,description:"For the text portion of an ordinal number",hasEndMarker:!0,children:void 0},add:{category:P.SpecialText,type:I.Character,description:"For a translational addition to the text",hasEndMarker:!0,children:void 0},lit:{category:P.SpecialText,type:I.Paragraph,description:"For a comment or note inserted for liturgical use",hasEndMarker:!1,children:void 0},no:{category:P.CharacterStyling,type:I.Character,description:"A character style, use normal text",hasEndMarker:!0,children:void 0},it:{category:P.CharacterStyling,type:I.Character,description:"A character style, use italic text",hasEndMarker:!0,children:void 0},bd:{category:P.CharacterStyling,type:I.Character,description:"A character style, use bold text",hasEndMarker:!0,children:void 0},bdit:{category:P.CharacterStyling,type:I.Character,description:"A character style, use bold + italic text",hasEndMarker:!0,children:void 0},em:{category:P.CharacterStyling,type:I.Character,description:"A character style, use emphasized text style",hasEndMarker:!0,children:void 0},sc:{category:P.CharacterStyling,type:I.Character,description:"A character style, for small capitalization text",hasEndMarker:!0,children:void 0},sup:{category:P.CharacterStyling,type:I.Character,description:"A character style, for superscript text. Typically for use in critical edition footnotes.",hasEndMarker:!0,children:void 0},pb:{category:P.Breaks,type:I.Paragraph,description:"Page Break used for new reader portions and children's bibles where content is controlled by the page",hasEndMarker:!1,children:void 0}},Pr={DivisionMarks:{add:["v","c"],remove:[]},Paragraphs:{add:["p"],remove:[]},Poetry:{add:["q","q1","q2","q3","q4","b"],remove:[]},TitlesHeadings:{add:["mte","ms","ms1","ms2","ms3","s","s1","s2","s3","s4","r","sp","d","sd","sd1","sd2","sd3","sd4"],remove:[]}},XT={p:{children:Pr},q:{children:Pr},q1:{children:Pr},q2:{children:Pr},q3:{children:Pr},q4:{children:Pr},b:{children:Pr},qm:{children:{Paragraphs:{add:["p"],remove:[]}}},c:{type:I.Paragraph,children:null},v:{children:null}};function yg(n){const e=YT[n],t=XT[n];if(!e)return;if(!t)return e;let r=e.children?{...e.children}:void 0;if(t.children===null&&(r=void 0),t.children){r=r||{};for(const[i,s]of Object.entries(t.children)){const o=i;if(s===null)Reflect.deleteProperty(r,o);else{let a=r[o]||[];s.remove&&(a=a.filter(l=>!s.remove.includes(l))),s.add&&(a=[...new Set([...a,...s.add])]),a.length>0?r[o]=a:Reflect.deleteProperty(r,o)}}Object.keys(r).length===0&&(r=void 0)}return{...e,...t,children:r}}function _g(n,e,t){const r={type:Qs,version:Zs,content:n},i=e.serializeEditorState(r,t);return Mf(i.root.children[0])?i.root.children[0].children[0]:i.root.children[0]}function hd(n,e){if(!n||!W(n))return[void 0,void 0];const t=n.getTextContent();if(e>=0&&e<t.length)return[n,e];let r=n.getNextSibling();if(!r){const s=n.getParent();rt(s)&&(r=s.getNextSibling())}if(!r||!rt(r)&&!W(r))return[void 0,void 0];const i=e-t.length;return r&&W(r)?hd(r,i):hd(r.getFirstChild()??void 0,i)}function bg(n){const e=rk(n.jsonPath);let t=ye();for(const r of e){if(!t||!F(t))return[void 0,void 0];t=t.getChildAtIndex(r)??void 0}return hd(t,n.offset)}function vg(n){return F(n)?"element":"text"}function Ff(n){const{start:e}=n;let{end:t}=n;t===void 0&&(t=e);const[r,i]=bg(e),[s,o]=bg(t);if(!r||!s||i===void 0||o===void 0)return;const a=So();return a.anchor=St(r.getKey(),i,vg(r)),a.focus=St(s.getKey(),o,vg(s)),a}function kg(n,e){const t=[];let r=n;for(;r!=null&&r.getParent();){const i=r.getParent();if(i){const s=i==null?void 0:i.getChildren().indexOf(r);s>=0&&t.unshift(s)}r=i}return{jsonPath:ik(t),offset:e}}function yv(){const n=K();if(!n||!q(n))return;const e=n.isBackward()?n.focus.getNode():n.anchor.getNode(),t=n.isBackward()?n.focus.offset:n.anchor.offset,r=kg(e,t);if(n.isCollapsed())return{start:r};const i=n.isBackward()?n.anchor.getNode():n.focus.getNode(),s=n.isBackward()?n.anchor.offset:n.focus.offset,o=kg(i,s);return{start:r,end:o}}const _v="v",bv=1;class vt extends br{constructor(e="",t=!1,r,i,s,o,a){super(a),Z(this,"__marker"),Z(this,"__number"),Z(this,"__showMarker"),Z(this,"__sid"),Z(this,"__altnumber"),Z(this,"__pubnumber"),Z(this,"__unknownAttributes"),this.__marker=_v,this.__number=e,this.__showMarker=t,this.__sid=r,this.__altnumber=i,this.__pubnumber=s,this.__unknownAttributes=o}static getType(){return"immutable-verse"}static clone(e){const{__number:t,__showMarker:r,__sid:i,__altnumber:s,__pubnumber:o,__unknownAttributes:a,__key:l}=e;return new vt(t,r,i,s,o,a,l)}static importDOM(){return{span:e=>ZT(e)?{conversion:QT,priority:1}:null}}static importJSON(e){return qf().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setMarker(e.marker).setNumber(e.number).setShowMarker(e.showMarker).setSid(e.sid).setAltnumber(e.altnumber).setPubnumber(e.pubnumber).setUnknownAttributes(e.unknownAttributes)}setMarker(e){if(this.__marker===e)return this;const t=this.getWritable();return t.__marker=e,t}getMarker(){return this.getLatest().__marker}setNumber(e){if(this.__number===e)return this;const t=this.getWritable();return t.__number=e,t}getNumber(){return this.getLatest().__number}setShowMarker(e=!1){if(this.__showMarker===e)return this;const t=this.getWritable();return t.__showMarker=e,t}getShowMarker(){return this.getLatest().__showMarker}setSid(e){if(this.__sid===e)return this;const t=this.getWritable();return t.__sid=e,t}getSid(){return this.getLatest().__sid}setAltnumber(e){if(this.__altnumber===e)return this;const t=this.getWritable();return t.__altnumber=e,t}getAltnumber(){return this.getLatest().__altnumber}setPubnumber(e){if(this.__pubnumber===e)return this;const t=this.getWritable();return t.__pubnumber=e,t}getPubnumber(){return this.getLatest().__pubnumber}setUnknownAttributes(e){const t=this.getWritable();return t.__unknownAttributes=e,t}getUnknownAttributes(){return this.getLatest().__unknownAttributes}createDOM(){const e=document.createElement("span");return e.setAttribute("data-marker",this.__marker),e.classList.add(ld,`usfm_${this.__marker}`),this.__showMarker&&e.classList.add("marker"),e.setAttribute("data-number",this.__number),e}updateDOM(){return!1}exportDOM(e){const{element:t}=super.exportDOM(e);return t&&Ne(t)&&(t.setAttribute("data-marker",this.getMarker()),t.classList.add(ld,`usfm_${this.getMarker()}`),t.setAttribute("data-number",this.getNumber())),{element:t}}decorate(){return v.jsx("span",{children:this.getShowMarker()?Ro(this.getMarker(),this.getNumber()):ad+this.getNumber()+ad})}exportJSON(){return{type:this.getType(),marker:this.getMarker(),number:this.getNumber(),showMarker:this.getShowMarker(),sid:this.getSid(),altnumber:this.getAltnumber(),pubnumber:this.getPubnumber(),unknownAttributes:this.getUnknownAttributes(),version:bv}}isKeyboardSelectable(){return!1}}function QT(n){const e=n.getAttribute("data-number")??"0";return{node:qf(e)}}function qf(n,e,t,r,i,s){return Ae(new vt(n,e,t,r,i,s))}function ZT(n){return((n==null?void 0:n.getAttribute("data-marker"))??void 0)===_v}function fs(n){return n instanceof vt}function eE(n){return(n==null?void 0:n.type)===vt.getType()}function Ft(n){return $f(n)||fs(n)}function tE(n){return xT(n)||eE(n)}function nE(n,e,t,r,i,s,o){if(!Ve.isValidMarker(n))throw new Error(`$insertNote: Invalid note marker '${n}'`);const a=t?Ff(t):K();if(!q(a))return;const l=rE(a,n,r,o);if(l===void 0)return;const c=kv(n,e,l,i,s);return vv(c,a,i),c}function vv(n,e,t){const r=(t==null?void 0:t.noteMode)==="collapsed";if(n.setIsCollapsed(r),e.isCollapsed()||$T(e),e.insertNodes([n]),!r){const i=n.getChildren().reverse().find(Te);i==null||i.selectEnd()}}function rE(n,e,t,r){const i=[],{chapterNum:s,verseNum:o}=t??{};switch(e){case"f":case"fe":case"ef":case"efe":if(s!==void 0&&o!==void 0&&i.push(pn("fr").append(de(`${s}:${o}`))),!n.isCollapsed()){const a=n.getTextContent().trim();if(a.length>0){const l=pn("fq");l.append(de(a)),i.push(l)}}i.push(pn("ft").append(de(me)));break;case"x":case"ex":s!==void 0&&o!==void 0&&i.push(pn("xo").append(de(`${s}:${o}`))),i.push(pn("xt").append(de(me)));break;default:r==null||r.warn(`$createNoteChildren: Unsupported note marker '${e}'`);return}return i}function kv(n,e,t,r,i,s){const o=(r==null?void 0:r.noteMode)!=="expanded",a=Of(n,e,o);s&&Ln(a,Qr,()=>s);let l,c;(r==null?void 0:r.markerMode)==="editable"?(l=Xi(n),c=Xi(n,"closing")):(r==null?void 0:r.markerMode)==="visible"&&(l=Qi("marker",Gn(n)+me),c=Qi("marker",Yi(n)+me));let u;if(l&&a.append(l),(r==null?void 0:r.markerMode)==="editable")e===""?a.append(...t):(u=de(Rf(a.__caller)),a.append(u,...t));else{const f=()=>de(me),d=t.flatMap(sE(f));if(e==="")a.append(...d);else{const h=jf(t);let g=()=>{};i!=null&&i.noteCallerOnClick&&(g=i.noteCallerOnClick),u=Wf(a.__caller,h,g),a.append(u,f(),...d)}}return c&&a.append(c),a}function wg(n){var e;if(typeof n=="string"){const i=ce(n);return ge(i)?i:void 0}const t=Mo();if(t.length<=0)return;const r=(e=t.filter(i=>ge(i.node))[n])==null?void 0:e.node;if(ge(r))return r}function iE(n,e){const t=(e==null?void 0:e.noteMode)==="collapsed";if(n.setIsCollapsed(t),t){const r=n.getPreviousSibling();if(fs(r)||!r){const i=n.getParent();if(i){const s=n.getIndexWithinParent();i.select(s,s)}}else r.selectEnd()}else{const r=n.getChildren().reverse().find(Te);r==null||r.selectEnd()}}function sE(n){return e=>Sl(e)?[e]:[e,n()]}function oE(n){return n.find(e=>dt(e))}function aE(n,e){return F(n)?n.getChildren().find(t=>Ft(t)&&Df(e,t.getNumber())):void 0}function lE(n,e){return e===0?oE(n):n.map(t=>aE(t,e)).filter(t=>t)[0]}function xg(n){return!n||!F(n)?void 0:n.getChildren().findLast(e=>Ft(e))}function wv(n){var e,t;if(!n||Lt(n))return;if(Ft(n))return n;let r=rt(n.getParent())?(e=n.getParent())==null?void 0:e.getPreviousSibling():n.getPreviousSibling();for(;r&&!Ft(r)&&!Lt(r);)r=r.getPreviousSibling();if(r&&Ft(r))return r;let i=(t=n.getTopLevelElement())==null?void 0:t.getPreviousSibling(),s=xg(i),o=s;for(;i&&!s&&!Lt(i);)s=o,i=i.getPreviousSibling(),o=xg(i);if(!(!s&&Lt(i)))return s}function cE(n){return ET(n)||fs(n)}function Bf(n){if(W(n)){const e=n.getTextContent();!e.endsWith(" ")&&!e.endsWith(me)&&n.setTextContent(`${e} `)}}function xv(n){if(W(n)){const e=n.getTextContent();e.startsWith(" ")&&n.setTextContent(e.trimStart())}}function Uf(n,e){return n.getEditorState().read(()=>!ce(e))}const uE=["style"],dE=["style","code"],El=["style","cid"],fE=["style","number","sid","altnumber","pubnumber"],hE=["style","number","sid","altnumber","pubnumber"],pE=["style","sid","eid"],gE=["style","caller","category","contents"],mE=["chapter","immutable-chapter","verse","immutable-verse","ms","note","unmatched"],_o=`
`;function yE(n,e){const t=ce(n);if(!tn(t))return;const r=Cv(t);return r===void 0?void 0:[{retain:r},...e,{delete:1}]}function Cv(n){if(!n)return;const e=Mo();let t=0;const r=[];let i,s;const o=n.getKey();let a;for(const l of e){const c=l.node;for(let u=r.length-1;u>=0;u--)if(bo(r[u],l)){const f=r[u];if(r.splice(u,1),t+=1,a&&f.getKey()===a.getKey())return t-1}if(i&&bo(i,l)&&(i=void 0,s=void 0),i){if(c.getKey()===o)return s;continue}if(c.getKey()===o){if(W(c)||tn(c))return t;Ut(c)&&(a=c)}if(Ut(c)&&(r.includes(c)||r.push(c)),ge(c)){i=c,s=t,t+=1;continue}t+=Sv(c)}if(a)return t}function Cg(n,e){if(n.length<2||!vE(n[0])||!bE(n[1]))return;const t=n[0].retain;return e.read(()=>{const r=_E(t);return r==null?void 0:r.getKey()})}function _E(n){const e=Mo();let t=0;const r=[];let i,s;for(const o of e){const a=o.node;for(let c=r.length-1;c>=0;c--)if(bo(r[c],o)){const u=r[c];if(r.splice(c,1),t===n)return u;t+=1}if(i&&bo(i,o)&&(i=void 0,s=void 0),i){if(s===n)return i;continue}if(Ut(a)&&(r.includes(a)||r.push(a)),ge(a)){if(i=a,s=t,t===n)return a;t+=1;continue}const l=Sv(a);if(W(a)&&l>0&&n>=t&&n<t+l||tn(a)&&t===n)return a;t+=l}for(const o of r){if(t===n)return o;t+=1}}function bo(n,e){return n?e?!AT(e.node,n.getKey()):!0:!1}function tn(n){return Lt(n)||Ft(n)||Xl(n)||ge(n)||mv(n)}function Ut(n){return Jt(n)||bn(n)}function Dn(n,e){return e.insert!=null&&typeof e.insert=="object"&&n in e.insert}function bE(n){if(n.insert==null||typeof n.insert!="object")return!1;const e=Object.keys(n.insert)[0];return n.insert!=null&&typeof n.insert=="object"&&e in n.insert&&mE.includes(e)}function vE(n){return n.retain!=null&&typeof n.retain=="number"}function Sv(n){return W(n)?n.getTextContentSize():tn(n)?1:0}function pd(n,e){const t={insert:n.__text},r=es(n,Qr);if(r&&(t.attributes={segment:r}),e&&e.length>0){const i=Tv(e);i&&(t.attributes={...t.attributes,char:i})}return t}function Sg(n){const e=new Bs;return n.isEmpty()||n.read(()=>{const t=ye();if(!t||t.isEmpty())return;const r=t.getChildren();if(r.length===1&&Kn(r[0])&&(!r[0].getChildren()||r[0].getChildrenSize()===0))return;const i=kE();for(const s of i)e.push(s)}),e}function zf(n,e){const t=[],r=Mo(n),i=[],s=[],o={children:[],contentsOps:[]},a=new Set;for(let l=0;l<r.length;l++){const c=r[l].node;t.push(...Tg(c,l,r,i,s,o,a))}for(const l of i)t.push(...Tg(l,r.length,r,i,s,o,a));return t}function kE(){return zf()}function Tg(n,e,t,r,i,s,o){if(!n)return[];const a=[];return wE(n,a,r),xE(n,a,i,s,o),CE(n,e,t,i,o,s,a),Lt(n)&&a.push(EE(n)),Ft(n)&&a.push(ME(n)),Xl(n)&&a.push(AE(n)),mv(n)&&a.push(OE(n)),SE(n,a,s),a}function wE(n,e,t){if(!n.isInline()){const r=t.pop();bn(r)?e.push(TE(r)):dt(r)?e.push(NE(r)):Kn(r)&&e.push({insert:_o})}Ut(n)&&(t.includes(n)||t.push(n))}function xE(n,e,t,r,i){var s;if(!W(n))return;const o=n.getParent();if(ge(o)&&o.getFirstChild()===n)return;const a=n.getTextContent(),l=a.startsWith(Sf),c=Te(o)?o:void 0,u=!!c&&a===me&&c.getChildrenSize()===1,f=pd(n,t);if(r.children.includes(n)){if(!a||a===me||l)return;(s=r.contentsOps)==null||s.push(f)}else u||l&&c||e.push(f);const d=a!==""&&!u&&!(l&&c);if(t.length>0&&d)for(const h of t)i.add(h)}function CE(n,e,t,r,i,s,o){var a;Te(n)&&!r.includes(n)&&r.push(n);const l=t[e+1];for(const c of r.toReversed())if(bo(c,l)){if(r.pop(),!i.has(c)){const u=IE(c);s.children.includes(c)?(a=s.contentsOps)==null||a.push(u):o.push(u)}i.delete(c)}}function SE(n,e,t){var r,i;if(!ge(n))return;Mo(n).forEach(o=>t.children.push(o.node));const s=$E(n);t.contentsOps=(i=(r=s.insert.note)==null?void 0:r.contents)==null?void 0:i.ops,e.push(s)}function TE(n){const e={style:go,code:n.__code};return{insert:_o,attributes:{book:e}}}function EE(n){const e={style:xl,number:n.__number};return n.__sid&&(e.sid=n.__sid),n.__altnumber&&(e.altnumber=n.__altnumber),n.__pubnumber&&(e.pubnumber=n.__pubnumber),{insert:{chapter:e}}}function NE(n){const e={style:n.__marker};return{insert:_o,attributes:{para:e}}}function ME(n){const e={style:Cl,number:n.__number};return n.__sid&&(e.sid=n.__sid),n.__altnumber&&(e.altnumber=n.__altnumber),n.__pubnumber&&(e.pubnumber=n.__pubnumber),{insert:{verse:e}}}function AE(n){const e={style:n.__marker};return n.__sid&&(e.sid=n.__sid),n.__eid&&(e.eid=n.__eid),{insert:{milestone:e}}}function OE(n){return{insert:{unmatched:{marker:n.__marker}}}}function $E(n){const e={style:n.__marker,caller:n.__caller};n.__category&&(e.category=n.__category),n.getChildrenSize()>1&&(e.contents={ops:[]});const t={insert:{note:e}},r=es(n,Qr);return r&&(t.attributes={segment:r}),t}function IE(n){const e={insert:""},t=Tv([n]);return t&&(e.attributes={char:t}),e}function Tv(n){if(n.length===0)return;const e=n.map(PE);return e.length===1?e[0]:e}function PE(n){const e={style:n.__marker},t=es(n,Xr);t&&(e.cid=t);const r=n.getUnknownAttributes();return r&&Object.keys(r).length>0&&Object.assign(e,r),e}const Ev=1;class Xt extends br{constructor(e=vn,t="",r,i){super(i),Z(this,"__caller"),Z(this,"__previewText"),Z(this,"__onClick"),this.__caller=e,this.__previewText=t,this.__onClick=r??(()=>{})}static getType(){return"immutable-note-caller"}static clone(e){const{__caller:t,__previewText:r,__onClick:i,__key:s}=e;return new Xt(t,r,i,s)}static importDOM(){return{span:e=>jE(e)?{conversion:RE,priority:1}:null}}static importJSON(e){return Wf().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setCaller(e.caller).setPreviewText(e.previewText).setOnClick(e.onClick)}setCaller(e){if(this.__caller===e)return this;const t=this.getWritable();return t.__caller=e,t}getCaller(){return this.getLatest().__caller}setPreviewText(e){if(this.__previewText===e)return this;const t=this.getWritable();return t.__previewText=e,t}getPreviewText(){return this.getLatest().__previewText}setOnClick(e){if(this.__onClick===e)return this;const t=this.getWritable();return t.__onClick=e,t}getOnClick(){return this.getLatest().__onClick}createDOM(){const e=document.createElement("span");return e.classList.add(this.__type),e.setAttribute("data-caller",this.__caller),e.setAttribute("data-preview-text",this.__previewText),e}updateDOM(e){return e.__caller!==this.__caller}exportDOM(e){const{element:t}=super.exportDOM(e);return t&&Ne(t)&&(t.classList.add(this.getType()),t.setAttribute("data-caller",this.getCaller()),t.setAttribute("data-preview-text",this.getPreviewText())),{element:t}}decorate(e){const t=this.getParent();if(!t)return null;const r=t.getKey(),i=t.getIsCollapsed(),s=this.__key,o=l=>{var c;return(c=this.__onClick)==null?void 0:c.call(this,l,r,i,()=>DE(e,r),u=>LE(e,r,s,u),()=>FE(e,r))},a=`${this.__caller}_${this.__previewText}}`.replace(/\s+/g,"").substring(0,25);return v.jsx("button",{onClick:o,title:this.__previewText,"data-caller-id":a,children:this.__caller===vn&&i?"":this.__caller})}exportJSON(){return{type:this.getType(),caller:this.getCaller(),previewText:this.getPreviewText(),onClick:this.getOnClick(),version:Ev}}isKeyboardSelectable(){return!1}}function RE(n){const e=n.getAttribute("data-caller")??"",t=n.getAttribute("data-preview-text")??"";return{node:Wf(e,t)}}function Wf(n,e,t){return Ae(new Xt(n,e,t))}function jE(n){return n?n.classList.contains(Xt.getType()):!1}function Sr(n){return n instanceof Xt}function DE(n,e){return n.read(()=>{const t=ce(e);if(!ge(t))throw new Error(`getNoteCaller: Note node not found: ${e}`);return t.getCaller()})}function LE(n,e,t,r){n.update(()=>{const i=ce(e);if(!ge(i))throw new Error(`setNoteCaller: Note node not found: ${e}`);i.setCaller(r);const s=ce(t);if(!Sr(s))throw new Error(`setNoteCaller: Caller node not found: ${t}`);s.setCaller(r)})}function FE(n,e){return n.read(()=>{const t=ce(e);if(!ge(t))throw new Error(`getNoteOps: Note node not found: ${e}`);return zf(t)})}const qE=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],BE=[Xt,vt,...GT],UE=x.forwardRef((n,e)=>{const{coords:t,children:r,style:i,...s}=n,o=t!==void 0;return v.jsx("div",{ref:e,className:"floating-box","aria-hidden":!o,style:{...i,position:"absolute",zIndex:1e3,top:t==null?void 0:t.y,left:t==null?void 0:t.x,visibility:o?"visible":"hidden",opacity:o?1:0},...s,children:r})});function zE(){const[n,e]=x.useState(void 0),[t,r]=x.useState(),i=x.useRef(null),s=x.useCallback((a,l)=>{i.current&&i.current();const c=a.commonAncestorContainer.nodeType===a.commonAncestorContainer.TEXT_NODE?a:a.commonAncestorContainer;i.current=ok(c,l,()=>{ak(c,l,{placement:"bottom-start",middleware:[lk(),ck()]}).then(u=>{r(u.placement),e(f=>(f==null?void 0:f.x)===u.x&&(f==null?void 0:f.y)===u.y?f:{x:u.x,y:u.y})}).catch(()=>{e(void 0)})})},[]),o=x.useCallback(()=>{i.current&&(e(void 0),i.current(),i.current=null)},[]);return x.useEffect(()=>o,[o]),{coords:n,placement:t,updatePosition:s,cleanup:o}}function WE({isOpen:n,floatingBoxRef:e}){const{coords:t,updatePosition:r,cleanup:i,placement:s}=zE();return x.useEffect(()=>{var o;if(!n||!e.current){i();return}const a=(o=window.getSelection())==null?void 0:o.getRangeAt(0);if(!a){i();return}return r(a,e.current),i},[i,n,e,r]),{coords:t,placement:s}}const KE=document.body,HE=x.memo(UE);function JE({isOpen:n=!1,children:e}){const t=x.useRef(null),{coords:r,placement:i}=WE({isOpen:n,floatingBoxRef:t}),s=x.useMemo(()=>r?typeof e=="function"?e:()=>e:()=>null,[e,r]);return Ot.createPortal(v.jsx(HE,{ref:t,coords:r,style:r?void 0:{display:"none"},children:s({isOpen:n,placement:i})}),KE)}const Nv=x.createContext(void 0);function Kf(){const n=x.useContext(Nv);if(!n)throw new Error("useMenuContext must be used within a MenuProvider");return n}function VE(n,e){const[t,r]=x.useState(0),[i,s]=x.useState(-1),o=x.useMemo(()=>n??[],[n]),a={menuItems:o,activeIndex:t,selectedIndex:i,onSelectOption:e??(()=>{})},l=x.useCallback(()=>{r(f=>{const d=o.length;return d?(f-1+d)%d:0})},[o.length]),c=x.useCallback(()=>{r(f=>{const d=o.length;return d?(f+1)%d:0})},[o.length]),u=x.useCallback(()=>{const f=o.length;if(t>=0&&t<f){const d=o[t];e==null||e(d),s(t)}},[t,o,e]);return{state:a,moveUp:l,moveDown:c,select:u,setActiveIndex:r,setSelectedIndex:s}}function GE({children:n,menuItems:e,onSelectOption:t,...r}){const i=VE(e,t);return v.jsx(Nv.Provider,{value:i,children:v.jsx("div",{...r,children:n})})}const Mv=x.forwardRef(({index:n,children:e,onMouseEnter:t,onClick:r,...i},s)=>{const{state:{activeIndex:o},setActiveIndex:a,setSelectedIndex:l,select:c}=Kf(),u=x.useCallback(d=>{c(),l(-1),r==null||r(d)},[r,c,l]),f=x.useCallback(d=>{a(n),t==null||t(d)},[n,a,t]);return v.jsx("button",{ref:s,role:"menuitem",...i,onClick:u,onMouseEnter:f,"aria-selected":n!==void 0&&o===n?"true":void 0,tabIndex:-1,children:e})});function YE({children:n,autoIndex:e=!0,...t}){const r=x.useRef(null),{state:{activeIndex:i,menuItems:s}}=Kf(),o=x.useMemo(()=>s?typeof n=="function"?n:()=>n:()=>null,[n,s]),a=x.useMemo(()=>{const l=o(s);return e?x.Children.map(l,(c,u)=>x.isValidElement(c)&&c.type===Mv&&c.props.index===void 0?x.cloneElement(c,{index:u}):c):l},[o,e,s]);return x.useEffect(()=>{if(r.current){const l=r.current,c=l.children[i];if(c){const u=l.getBoundingClientRect(),f=c.getBoundingClientRect();f.bottom>u.bottom?l.scrollTop+=f.bottom-u.bottom:f.top<u.top&&(l.scrollTop-=u.top-f.top)}}},[i]),v.jsx("div",{ref:r,role:"menu",...t,children:a})}const gu={Root:GE,Options:YE,Option:Mv},XE=(n,e,t)=>Ha(n,t).toLowerCase().includes(e.toLowerCase()),Eg=n=>Object.keys(n).find(e=>typeof n[e]=="string")||"",Ha=(n,e)=>{const t=n[e];return typeof t=="string"?t:String(t)};function QE(n){const{query:e,items:t,filterBy:r,filter:i,sortBy:s,sortingOptions:o}=n,{caseSensitive:a=!1,priorityOrder:l=["exact","startsWith","contains"]}=o||{},c=a?e:e.toLowerCase();let u,f;i?(f=i,u=t.length>0?Eg(t[0]):""):(u=r||(t.length>0?Eg(t[0]):""),f=(g,m)=>XE(g,m,u));const d=s||u,h=new Map;return t.filter(g=>{try{return f(g,e)}catch(m){return console.warn("Error filtering item:",g,m),!1}}).sort((g,m)=>{const y=w=>(h.has(w)||h.set(w,Ha(w,d).toLowerCase()),h.get(w)??""),b=a?Ha(g,d):y(g),_=a?Ha(m,d):y(m);for(const w of l)switch(w){case"exact":if(b===c&&_!==c)return-1;if(_===c&&b!==c)return 1;break;case"startsWith":if(b.startsWith(c)&&!_.startsWith(c))return-1;if(_.startsWith(c)&&!b.startsWith(c))return 1;break;case"contains":{const T=b.indexOf(c),O=_.indexOf(c);if(T!==-1&&O===-1)return-1;if(O!==-1&&T===-1)return 1;if(T!==-1&&O!==-1)return T-O;break}}return b.localeCompare(_)})}function ZE(n){const{query:e,items:t,filterBy:r,filter:i,sortBy:s,sortingOptions:o}=n;return x.useMemo(()=>QE({query:e,items:t,filterBy:r,filter:i,sortBy:s,sortingOptions:o}),[e,t,r,i,s,o])}function eN(){const{moveUp:n,moveDown:e,select:t}=Kf();return x.useMemo(()=>({moveUp:n,moveDown:e,select:t}),[n,e,t])}const tN=()=>{const n=eN(),[e]=pe();x.useEffect(()=>{const t=r=>{const i={ArrowDown:()=>n==null?void 0:n.moveDown(),ArrowUp:()=>n==null?void 0:n.moveUp(),Enter:()=>n==null?void 0:n.select(),Tab:()=>n==null?void 0:n.select()}[r.key];return i?(i(),r.preventDefault(),r.stopPropagation(),!0):!1};return e.registerCommand(ts,t,Dl)},[e,n])};function nN(){return tN(),null}function rN(n){const{options:e,onSelectOption:t,onClose:r,inverse:i,query:s,menuOpenKey:o}=n,[a]=pe(),l=s!==void 0,[c,u]=x.useState(""),f=l?s??"":c,d=ZE({query:f,items:e,filterBy:"name"}),h=g=>{r==null||r(),t?t(g):g.action(a)};return x.useEffect(()=>a.registerCommand(ts,g=>{if(l)return!1;const m={Escape:()=>r==null?void 0:r(),Backspace:()=>{f.length===0?r==null||r():u(y=>y.slice(0,-1))}}[g.key];return m?(g.stopPropagation(),g.preventDefault(),m(),!0):g.key.length===1?(g.stopPropagation(),g.preventDefault(),g.key!==o&&u(y=>y+g.key),!0):!1},Dl),[a,l,f,o,r]),v.jsxs(gu.Root,{className:`autocomplete-menu-container ${i?"inverse":""}`,menuItems:d,onSelectOption:g=>h(g),children:[!l&&v.jsx("input",{value:f,type:"text",disabled:!0}),v.jsx(nN,{}),v.jsx(gu.Options,{className:"autocomplete-menu-options",autoIndex:!1,children:g=>g.map((m,y)=>v.jsxs(gu.Option,{index:y,children:[v.jsx("span",{className:"label",children:m.label??m.name}),v.jsx("span",{className:"description",children:m.description})]},m.name))})]})}function iN({trigger:n,items:e}){const[t]=pe(),[r,i]=x.useState(!1),s=x.useCallback(o=>{o.key==="Escape"&&r?(i(!1),t.focus()):o.key===n&&!r&&(o.preventDefault(),i(!0))},[t,n,r]);return x.useEffect(()=>t.registerRootListener(o=>{if(o)return o.addEventListener("keydown",s),()=>{o.removeEventListener("keydown",s)}}),[t,s]),x.useEffect(()=>t.registerUpdateListener(({prevEditorState:o,editorState:a})=>{const l=o.read(()=>{const c=K();if(q(c))return c});a.read(()=>{const c=K();!q(c)||l!=null&&l.is(c)||i(!1)})}),[t]),e&&v.jsx(JE,{isOpen:r,children:({placement:o})=>v.jsx(rN,{options:e,onClose:()=>i(!1),inverse:o==="top-start",menuOpenKey:n})})}function sN({scriptureReference:n,contextMarker:e,getMarkerAction:t}){return{markersMenuItems:x.useMemo(()=>{if(!e||!n)return;const r=yg(e);if(r!=null&&r.children)return Object.values(r.children).flatMap(i=>i.map(s=>{const o=yg(s),{action:a}=t(s,o);return{name:s,label:s,description:(o==null?void 0:o.description)??"",action:l=>{a({editor:l,reference:n})}}}))},[e,t,n])}}function Ja(n,e){return`${n}:${e}`}function oN(n,e){x.useEffect(()=>{if(!n.hasNodes([tt]))throw new Error("AnnotationPlugin: TypedMarkNode not registered on editor!");const t=new Map;return Ue(l_(n,tt,r=>yo(r.getTypedIDs()),(r,i)=>{for(const[s,o]of Object.entries(r.getTypedIDs()))o.forEach(a=>{i.addID(s,a)})}),n.registerMutationListener(tt,r=>{n.getEditorState().read(()=>{for(const[i,s]of r){const o=ce(i);let a={};s==="destroyed"?a=t.get(i)??{}:rt(o)&&(a=o.getTypedIDs());for(const[l,c]of Object.entries(a))if(!tt.isReservedType(l))for(const u of c){let f=e.get(Ja(l,u));a[l]=c,t.set(i,a),s==="destroyed"?f!==void 0&&(f.delete(i),f.size===0&&e.delete(Ja(l,u))):(f===void 0&&(f=new Set,e.set(Ja(l,u),f)),f.has(i)||f.add(i))}}})},{skipInitialization:!0}))},[n,e])}const aN=x.forwardRef(function({logger:n},e){const[t]=pe(),r=x.useMemo(()=>new Map,[]);return oN(t,r),x.useImperativeHandle(e,()=>({addAnnotation(i,s,o){if(tt.isReservedType(s))throw new Error(`addAnnotation: Can't directly add this reserved annotation type '${s}'. Use the appropriate plugin instead.`);t.update(()=>{const a=Ff(i);if(a===void 0){n==null||n.error("Failed to find start or end node of the annotation.");return}hv(a,s,o)},{tag:ud})},removeAnnotation(i,s){if(tt.isReservedType(i))throw new Error(`removeAnnotation: Can't directly remove this reserved annotation type '${i}'. Use the appropriate plugin instead.`);const o=r.get(Ja(i,s));o!==void 0&&setTimeout(()=>{t.update(()=>{for(const a of o){const l=ce(a);rt(l)&&(l.deleteID(i,s),l.hasNoIDsForEveryType()&&fv(l))}},{tag:ud})})}})),null});function lN({ignoreHistoryMergeTagChange:n=!0,ignoreSelectionChange:e=!1,onChange:t}){const[r]=pe();return x.useLayoutEffect(()=>{if(t)return r.registerUpdateListener(i=>{const{editorState:s,dirtyElements:o,dirtyLeaves:a,prevEditorState:l,tags:c}=i;if(e&&o.size===0&&a.size===0||n&&c.has(Lr)||l.isEmpty())return;const u=cN(r,i);u.length!==0&&t(s,r,c,u)})},[r,n,e,t]),null}function cN(n,{dirtyLeaves:e,prevEditorState:t}){let r=new Bs;return n.getEditorState().read(()=>{const i=e.values().next().value??"";if(e.size===1&&W(ce(i))){const s=ce(i),o=Cv(s);if(W(s)&&o!==void 0){const a=t.read(()=>{const u=ce(i);return new Bs([W(u)?pd(u):{insert:""}])}),l=new Bs([pd(s)]),c=new Bs(o>0?[{retain:o}]:[]);r=r.concat(c).concat(a.diff(l))}}else{const s=Sg(t),o=Sg(n.getEditorState());r=s.diff(o)}}),r.ops}function uN(n,e,t,r){let i=0;n.forEach(s=>{if("retain"in s)i+=dN(s,i,e,r);else if("delete"in s){if(typeof s.delete!="number"||s.delete<=0){r==null||r.error(`Invalid delete operation: ${JSON.stringify(s)}`);return}r==null||r.debug(`Delete: ${s.delete}`),hN(i,s.delete,r)}else"insert"in s?typeof s.insert=="string"?(r==null||r.debug(`Insert: '${s.insert}'`),i+=pN(i,s.insert,s.attributes,e,r)):typeof s.insert=="object"&&s.insert!==null?(r==null||r.debug(`Insert embed: ${JSON.stringify(s.insert)}`),mN(i,s,e,t,r)?i+=1:r==null||r.error(`Failed to process insert embed operation: ${JSON.stringify(s.insert)} at index ${i}. Document may be inconsistent.`)):r==null||r.error(`Insert of unknown type: ${JSON.stringify(s.insert)}`):r==null||r.error(`Unknown operation: ${JSON.stringify(s)}`)})}function dN(n,e,t,r){return typeof n.retain!="number"||n.retain<0?(r==null||r.error(`Invalid retain operation: ${JSON.stringify(n)}`),0):(r==null||r.debug(`Retain: ${n.retain}`),n.attributes&&(r==null||r.debug(`Retain attributes: ${JSON.stringify(n.attributes)}`),fN(e,n.retain,n.attributes,t,r)),n.retain)}function fN(n,e,t,r,i){i==null||i.debug(`Applying attributes for range [${n}, ${n+e-1}] with attributes: ${JSON.stringify(t)}`);let s=e,o=0,a=-1;const l=ye();function c(u){if(s<=0)return!0;if(W(u)){const f=u.getTextContentSize();if(n<o+f&&o<n+e){const d=Math.max(0,n-o),h=f-d,g=Math.min(s,h);if(g>0){let m=u;const y=d>0,b=g<f-d;if(y&&b){const[,_]=u.splitText(d);[m]=_.splitText(g)}else y?[,m]=u.splitText(d):b&&([m]=u.splitText(g));if(ti(t)){const _=m.getParent();if(Te(_)){const w=t.char;let T;Array.isArray(w)?a>=0&&a<=w.length-1&&(T=w[a]):a===0&&(T=w);const O=T?ei(T,_):!1;if(O&&Array.isArray(w)&&w.length>1){const M=de("");m.replace(M);const j=typeof t.segment=="string"?t.segment:void 0,A=Do(w.slice(1),r,m,j);let $=M;for(const B of A)$.insertAfter(B),$=B;M.remove(),jt(t,m)}else if(O)jt(t,m);else{m.remove();const M=Ng(m,t,r,i);if(M&&M.length>0){let j=_;for(const A of M)j.insertAfter(A),j=A}}}else{const w=de("");m.replace(w);const T=Ng(m,t,r,i);if(T&&T.length>0){let O=w;for(const M of T)O.insertAfter(M),O=M;w.remove()}else w.replace(m)}}else jt(t,m);s-=g}}o+=f}else if(tn(u))n<=o&&o<n+e&&s>0&&(Mg(u,t),s-=1),o+=1;else if(Te(u)){a+=1;let f=!1;if(n<=o&&o<n+e&&s>0)if(ti(t)){const d=t.char;let h;if(Array.isArray(d)?a>=0&&a<=d.length-1&&(h=d[a]):a===0&&(h=d),h){u.setMarker(h.style),typeof h.cid=="string"&&Ln(u,Xr,()=>h.cid);const g=Ge(h,El);g&&Object.keys(g).length>0?u.setUnknownAttributes({...u.getUnknownAttributes()??{},...g}):u.setUnknownAttributes(void 0)}}else(t.char===!1||t.char===null||CN(t.char))&&(f=!0);if(s>0){const d=u.getChildren();for(const h of d){if(s<=0)break;if(c(h)&&s<=0)return f&&Yh(u),!0}}f&&Yh(u),a-=1}else if(Ut(u)){const f=u.getChildren();for(const h of f){if(s<=0)break;if(c(h)&&s<=0)return!0}const d=1;if(n<=o&&o<n+s&&s>0){if(!Kn(u))Mg(u,t);else if(Hf(t)){const h=Ov(t.para);h&&u.replace(h,!0)}s-=d}o+=d}else if(F(u)){const f=u.getChildren();for(const d of f){if(s<=0)break;if(c(d)&&s<=0)return!0}}return s<=0}c(l),s>0&&(i==null||i.warn(`$applyAttributes: Not all characters in the retain operation (length ${e}) could be processed. Remaining: ${s}. targetIndex: ${n}, final currentIndex: ${o}`))}function Ng(n,e,t,r){var i;const s=typeof e.segment=="string"?e.segment:void 0,o=Do(e.char,t,n,s),a=o.find(Te);if(!a){r==null||r.error(`Failed to create CharNode for text transformation. Style: ${Array.isArray(e.char)?e.char[0].style:(i=e.char)==null?void 0:i.style}. Falling back to standard text attributes.`),jt(e,n);return}const l={};$v.forEach(f=>{n.hasFormat(f)&&(l[f]="true")});const c={};Object.entries(e).forEach(([f,d])=>{f==="segment"||f==="char"||(typeof d=="string"?c[f]=d:d===!0?c[f]="true":d===!1&&(c[f]="false"))});const u={...a.getUnknownAttributes()??{},...l,...c};return Object.keys(u).length>0&&a.setUnknownAttributes(u),jt(e,n),o}function Mg(n,e){for(const t of Object.keys(e)){const r=e[t];if(t==="char"&&Te(n)&&ti(e)){const i=r;if(n.setMarker(i.style),typeof i.cid=="string"){const o=i.cid;Ln(n,Xr,()=>o)}const s=Ge(i,El);s&&Object.keys(s).length>0&&n.setUnknownAttributes({...n.getUnknownAttributes()??{},...s});continue}typeof r=="string"&&(Lt(n)||Ft(n)||Xl(n)||ge(n)||Io(n)?n.setUnknownAttributes({...n.getUnknownAttributes()??{},[t]:r}):(bn(n)||dt(n)||Te(n))&&(t==="style"&&!bn(n)?n.setMarker(r):t==="code"&&bn(n)?n.setCode(r):n.setUnknownAttributes({...n.getUnknownAttributes()??{},[t]:r})),t==="segment"&&Ln(n,Qr,()=>r))}}function hN(n,e,t){if(e<=0)return;const r=ye();let i=0,s=e;function o(a){if(s<=0)return!0;if(W(a)){let l=a.getTextContentSize();if(n<i+l&&i<n+s){const c=Math.max(0,n-i),u=l-c,f=Math.min(s,u);f>0&&(a.spliceText(c,f,""),a.getTextContentSize()===0&&a.remove(),t==null||t.debug(`Deleted ${f} length from TextNode (key: ${a.getKey()}) at nodeOffset ${c}. Original targetIndex: ${n}, current currentIndex: ${i}.`),s-=f,l-=f)}i+=l}else if(tn(a))n<=i&&i<n+s?(a.remove(),t==null||t.debug(`Deleted embed node (key: ${a.getKey()}) at currentIndex: ${i}. Original targetIndex: ${n}, remainingToDelete: ${s}.`),s-=1):i+=1;else if(Ut(a)){const l=a.getChildren().slice(),c=a.getChildren();for(const u of c){if(s<=0)break;if(o(u)&&s<=0)return!0}if(n<=i&&i<n+s&&Ut(a)){s-=1;const u=a.getChildren().length;if(l.length>0&&u===0){const f=a.getParent();((f==null?void 0:f.getChildren())??[]).length>1?(a.remove(),t==null||t.debug(`Removed entire ParaNode that had all its content deleted at currentIndex: ${i}. Original targetIndex: ${n}, remainingToDelete: ${s}.`)):(a.replace(Yt(),!0),t==null||t.debug(`Replaced last ParaNode with ImpliedParaNode at currentIndex: ${i}. Original targetIndex: ${n}, remainingToDelete: ${s}.`))}else if(s>0){const f=a.getNextSibling();if(f&&Jt(f)){let d=i+1;const h=f.getChildren();for(const m of h){if(s<=0)break;const y=i;if(i=d,o(m)){i=y;break}W(m)?d+=m.getTextContentSize():tn(m)&&(d+=1),i=y}const g=f.getChildren();for(const m of g)m.remove(),a.append(m);f.remove(),t==null||t.debug(`Merged next paragraph into current one after deleting symbolic close at currentIndex: ${i}. Original targetIndex: ${n}, remainingToDelete: ${s}.`)}else a.replace(Yt(),!0)}else dt(a)?a.replace(Yt(),!0):a.remove()}i+=1}else if(F(a)){const l=a.getChildren();for(const c of l){if(s<=0)break;if(o(c)&&s<=0)return!0}}return s<=0}o(r),s>0&&(t==null||t.warn(`Delete operation could not remove all requested characters. Remaining to delete: ${s}. Original targetIndex: ${n}, OT length: ${e}. Final currentIndex: ${i}`))}function pN(n,e,t,r,i){if(e===_o)return Ag(n,t,i);if(e.endsWith(_o)&&!Hf(t)){const s=e.slice(0,-1);let o=0;if(s.length>0){if(ti(t))throw new Error("Text + LF should not have char attributes");o+=Nl(n,s,t,i)}return o+=Ag(n+o,t,i),o}else return ti(t)?gN(n,e,t,r,i):Nl(n,e,t,i)}function gN(n,e,t,r,i){i==null||i.debug(`Attempting to insert CharNode with text "${e}" and attributes ${JSON.stringify(t.char)} at index ${n}`);const s=de(e===""?me:e);jt(t,s);let o;{let h=function(y){if(W(y)){const b=y.getTextContentSize();if(n>=m&&n<m+b){const _=y.getParent();return Te(_)&&(o=_),!0}m+=b}else if(tn(y))m+=1;else if(Te(y)){const b=y.getChildren();for(const _ of b)if(h(_))return!0}else if(F(y)){const b=y.getChildren();for(const _ of b)if(h(_))return!0;Ut(y)&&(m+=1)}return!1};const g=ye();let m=0;h(g)}let a=t.char;if(Array.isArray(a)){if(o){const h=a[0];h&&ei(h,o)?(a=a.slice(1),a.length===1&&(a=a[0])):o=void 0}}else o&&(ei(a,o)||(o=void 0));const l=typeof t.segment=="string"?t.segment:void 0,c=Do(a,r,s,l,o?[o]:void 0);if(c.length===0)return e.length;const u=c.find(Te);if(!u)return i==null||i.error(`CharNode style is missing for text "${e}". Attributes: ${JSON.stringify(t.char)}. Falling back to rich text insertion.`),Nl(n,e,void 0,i);const f={};for(const[h,g]of Object.entries(t))h!=="char"&&h!=="segment"&&typeof g=="string"&&(f[h]=g);Object.keys(f).length>0&&u.setUnknownAttributes(f);let d=!0;for(const h of c)if(!Av(n,h,i)){d=!1;break}return d?e.length:(i==null||i.error(`Failed to insert CharNode with text "${e}" at index ${n}. Falling back to rich text.`),Nl(n,e,void 0,i))}function Nl(n,e,t,r){if(e.length<=0)return r==null||r.debug("Attempted to insert empty string. No action taken."),0;const i=ye();let s=0,o=!1;function a(l){if(o)return!0;if(W(l)){const c=l.getTextContentSize();if(n>=s&&n<=s+c){const u=n-s,f=de(e);if(jt(t,f),u===0)l.insertBefore(f);else if(u===c){const d=l.getParent();Te(d)&&!ti(t)?d.insertAfter(f):l.insertAfter(f)}else{const[,d]=l.splitText(u);d.insertBefore(f)}return r==null||r.debug(`Inserted text "${e}" in/around TextNode (key: ${l.getKey()}) at nodeOffset ${u}. Original targetIndex: ${n}, currentIndex at node start: ${s}.`),o=!0,!0}s+=c}else if(tn(l))s+=1;else if(Te(l)){if(!o&&n===s){const u=de(e);jt(t,u);const f=l.getFirstChild();return f?f.insertBefore(u):l.append(u),r==null||r.debug(`Inserted text "${e}" at beginning of CharNode ${l.getType()} (key: ${l.getKey()}).`),o=!0,!0}const c=l.getChildren();for(const u of c){if(a(u))return!0;if(o)break}if(!o&&n===s){const u=de(e);return jt(t,u),l.append(u),r==null||r.debug(`Appended text "${e}" to end of CharNode ${l.getType()} (key: ${l.getKey()}).`),o=!0,!0}}else if(Ut(l)){if(!o&&n===s){const u=de(e);jt(t,u);const f=l.getFirstChild();return f?f.insertBefore(u):l.append(u),r==null||r.debug(`Inserted text "${e}" at beginning of container ${l.getType()} (key: ${l.getKey()}).`),o=!0,!0}const c=l.getChildren();for(const u of c){if(a(u))return!0;if(o)break}if(!o&&n===s){const u=de(e);return jt(t,u),l.append(u),r==null||r.debug(`Appended text "${e}" to end of container ${l.getType()} (key: ${l.getKey()}).`),o=!0,!0}s+=1}else if(F(l)){const c=l.getChildren();for(const u of c){if(a(u))return!0;if(o)break}}return o}if(a(i),!o&&n===s){r==null||r.debug(`Insertion point matches end of document (targetIndex: ${n}, final currentIndex: ${s}). Appending text to new ParaNode.`);const l=de(e);jt(t,l);const c=Yt().append(l);i.append(c),o=!0}return o?e.length:(r==null||r.warn(`$insertRichText: Could not find insertion point for text "${e}" at targetIndex ${n}. Final currentIndex: ${s}. Text not inserted.`),0)}function Av(n,e,t){const r=ye();let i=0,s=!1;function o(a){if(s)return!0;if(a===r&&n===0&&!r.getFirstChild())return e.isInline()?(t==null||t.debug(`$insertNodeAtCharacterOffset: Inserting inline node ${e.getType()} into empty root, wrapped in ImpliedParaNode. targetIndex: ${n}`),r.append(Yt().append(e))):(t==null||t.debug(`$insertNodeAtCharacterOffset: Inserting block node ${e.getType()} directly into empty root. targetIndex: ${n}`),r.append(e)),s=!0,!0;if(!F(a))return!1;const l=a.getChildren();for(const c of l){if(n===i&&!s){if(a===r&&e.isInline())if(Jt(c)){t==null||t.debug(`$insertNodeAtCharacterOffset: Inserting inline node ${e.getType()} into existing ${c.getType()} at beginning. targetIndex: ${n}`);const u=c.getFirstChild();u?u.insertBefore(e):c.append(e)}else t==null||t.debug(`$insertNodeAtCharacterOffset: Inserting inline node ${e.getType()} into root before ${c.getType()}, wrapping in ImpliedParaNode. targetIndex: ${n}`),c.insertBefore(Yt().append(e));else c.insertBefore(e),t==null||t.debug(`$insertNodeAtCharacterOffset: Inserted node ${e.getType()} (key: ${e.getKey()}) before child ${c.getType()} (key: ${c.getKey()}) in ${a.getType()} (key: ${a.getKey()}). targetIndex: ${n}, currentIndex: ${i}`);return s=!0,!0}if(W(c)){const u=c.getTextContentSize();if(!s&&n>i&&n<i+u){const f=n-i,[d]=c.splitText(f);return d.insertAfter(e),t==null||t.debug(`$insertNodeAtCharacterOffset: Inserted node ${e.getType()} (key: ${e.getKey()}) by splitting TextNode (key: ${c.getKey()}) at offset ${f}. targetIndex: ${n}, currentIndex at node start: ${i}`),s=!0,!0}i+=u}else if(tn(c))i+=1;else if(Te(c)){if(o(c))return!0}else if(Ut(c)){const u=c;if(o(u))return!0;const f=i;if(Kn(u)&&Ut(e)&&n===f&&!s)return t==null||t.debug(`$insertNodeAtCharacterOffset: Replacing ImpliedParaNode (key: ${u.getKey()}) with block node '${e.getType()}' (key: ${e.getKey()}) at OT index ${n}.`),c.replace(e,!0),i=f+1,s=!0,!0;i+=1}else if(F(c)&&o(c))return!0;if(s)return!0}return F(a)&&!s&&(n===i||a===r&&n>i)?a===r?(e.isInline()?(t==null||t.debug(`$insertNodeAtCharacterOffset: Appending inline node ${e.getType()} to root. Wrapping in new ImpliedParaNode. targetIndex: ${n}, current document OT length: ${i}.`),r.append(Yt().append(e))):(t==null||t.debug(`$insertNodeAtCharacterOffset: Appending block node ${e.getType()} to root. targetIndex: ${n}, current document OT length: ${i}.`),r.append(e)),s=!0,!0):Jt(a)?Kn(a)&&dt(e)&&n===i?(t==null||t.debug(`$insertNodeAtCharacterOffset: Replacing ImpliedParaNode container (key: ${a.getKey()}) with ParaNode ${e.getType()} (key: ${e.getKey()}) via append logic. targetIndex: ${n}`),a.replace(e,!0),s=!0,!0):e.isInline()||!Jt(e)?(t==null||t.debug(`$insertNodeAtCharacterOffset: Appending node ${e.getType()} to existing container ${a.getType()} (key: ${a.getKey()}). targetIndex: ${n}, container end OT index: ${i}.`),a.append(e),s=!0,!0):(t==null||t.debug(`$insertNodeAtCharacterOffset: Inserting block node ${e.getType()} after container ${a.getType()} (key: ${a.getKey()}). targetIndex: ${n}, container end OT index: ${i}.`),a.insertAfter(e),s=!0,!0):(Te(a)?(t==null||t.debug(`$insertNodeAtCharacterOffset: Inserting node ${e.getType()} after CharNode (key: ${a.getKey()}). targetIndex: ${n}, element end OT index: ${i}.`),a.insertAfter(e)):e.isInline()||!Jt(e)?(t==null||t.debug(`$insertNodeAtCharacterOffset: Appending node ${e.getType()} to generic element ${a.getType()} (key: ${a.getKey()}). targetIndex: ${n}, element end OT index: ${i}.`),a.append(e)):(t==null||t.debug(`$insertNodeAtCharacterOffset: Inserting block node ${e.getType()} after generic element ${a.getType()} (key: ${a.getKey()}). targetIndex: ${n}, element end OT index: ${i}.`),a.insertAfter(e)),s=!0,!0):s}return o(r),s||t==null||t.warn(`$insertNodeAtCharacterOffset: Could not find insertion point for node ${e.getType()} (key: ${e.getKey()}) at targetIndex ${n}. Final currentIndex: ${i}. Node not inserted.`),s}function mN(n,e,t,r,i){let s;return Dn("chapter",e)?s=yN(e.insert.chapter,t):Dn("verse",e)?s=_N(e.insert.verse,t):Dn("ms",e)?s=bN(e.insert.ms):Dn("unmatched",e)?s=vN(e.insert.unmatched):Dn("note",e)&&(s=kN(e,t,r,i)),s?Av(n,s,i):(i==null||i.error(`$insertEmbedAtCurrentIndex: Cannot create LexicalNode for embed object: ${JSON.stringify(e.insert)}`),!1)}function Ag(n,e,t){let r;Hf(e)?r=Ov(e.para):xN(e)&&(r=wN(e.book)),r??(r=Yt());const i=r,s=dt(i),o=Kn(i);let a=0,l=!1;function c(u){if(l)return!0;if(W(u)){const f=u.getTextContentSize();if(n>=a&&n<=a+f){const d=u.getParent();if(dt(d)&&(s||o)){t==null||t.debug(`Splitting ParaNode (marker: ${d.getMarker()}) with LF attributes at targetIndex ${n}`);const h=n-a,[g]=h>0?u.splitText(h):[void 0];let m=g==null?void 0:g.getPreviousSibling();for(;m;){const y=m;m=m.getPreviousSibling();const b=i.getFirstChild();b?b.insertBefore(y):i.append(y)}return g&&i.append(g),d.insertBefore(i),l=!0,!0}}a+=f}else if(tn(u))a+=1;else if(Ut(u)){const f=u.getChildren();for(const d of f){if(c(d))return!0;if(l)break}if(n===a){if(Kn(u)&&i)return t==null||t.debug(`Replacing ImpliedParaNode (key: ${u.getKey()}) with ParaNode at targetIndex ${n}`),u.replace(i,!0),l=!0,!0;if(dt(u)&&i){const d=u;return t==null||t.debug(`Creating new block node with LF attributes after existing ParaNode (marker: ${d.getMarker()}) at targetIndex ${n}`),d.insertAfter(i),l=!0,!0}}if(a+=1,n===a&&dt(u)&&i)return t==null||t.debug(`Creating new block node after existing ParaNode (marker: ${u.getMarker()}) at targetIndex ${n}`),u.insertAfter(i),l=!0,!0}else if(F(u)){const f=u.getChildren();for(const d of f){if(c(d))return!0;if(l)break}}return l}return c(ye()),l||t==null||t.warn(`Could not find location to handle newline with para attributes at targetIndex ${n}. Final currentIndex: ${a}.`),1}function yN(n,e){if(!n)return;const{number:t,sid:r,altnumber:i,pubnumber:s}=n;if(!t)return;const o=Ge(n,fE);let a;if(e.markerMode==="editable")a=Vb(t,r,i,s,o);else{const l=e.markerMode==="visible";a=Nf(t,l,r,i,s,o)}return a}function _N(n,e){if(!n)return;const{style:t,number:r,sid:i,altnumber:s,pubnumber:o}=n;if(!r)return;const a=Ge(n,hE);let l;if(e.markerMode==="editable"){if(!t)return;const c=Ro(t,r);l=av(r,c,i,s,o,a)}else{const c=e.markerMode==="visible";l=qf(r,c,i,s,o,a)}return l}function bN(n){if(!n)return;const{style:e,sid:t,eid:r}=n;if(!e)return;const i=Ge(n,pE);return rv(e,t,r,i)}function vN(n){if(!n)return;const{marker:e}=n;if(e)return Lf(e)}function kN(n,e,t,r){var i;const s=n.insert;if(!s.note)return;const{style:o,caller:a,category:l,contents:c}=s.note;if(!o||a==null)return;a===""&&(r==null||r.warn("Note has empty caller. Only use for note editing."));const u=Ge(s.note,gE),f=(i=n.attributes)==null?void 0:i.segment;let d;f&&typeof f=="string"&&(d=f);const h=[];for(const g of(c==null?void 0:c.ops)??[])if(typeof g.insert=="string")if(ti(g.attributes)){const m=Do(g.attributes.char,e,de(g.insert),void 0,h);h.push(...m)}else h.push(de(g.insert));return kv(o,a,h,e,t,d).setCategory(l).setUnknownAttributes(u)}function wN(n){const{style:e,code:t}=n;if(!e||e!==go||!t||!Bt.isValidBookCode(t))return;const r=Ge(n,dE);return Kb(t,r)}function Ov(n){const{style:e}=n;if(!e)return;const t=Ge(n,uE);return mo(e,t)}function Do(n,e,t,r,i){if(W(t)&&t.getTextContentSize()===0&&t.setTextContent(me),Array.isArray(n)){if(n.length===0)throw new Error("Empty charAttr array");const s=n[0],o=i==null?void 0:i[i.length-1];if(Te(o)&&ei(s,o))return n.length>1?Do(n.slice(1),e,t).forEach(u=>o.append(u)):t&&o.append(t),[];const a=n.reduceRight((u,f,d)=>{const h=pn(f.style,Ge(f,El));if(typeof f.cid=="string"&&Ln(h,Xr,()=>f.cid),r&&d===n.length-1&&Ln(h,Qr,()=>r),u)if(Te(u)){const g=u.getMarker(),m=[];mu(g,m,e),m.forEach(b=>h.append(b)),h.append(u);const y=[];yu(g,y,e),y.forEach(b=>h.append(b))}else h.append(u);return h},t),l=[],c=n[0];return mu(c.style,l,e),l.push(a),yu(c.style,l,e),l}else{const s=i==null?void 0:i[i.length-1];if(Te(s)&&ei(n,s))return t&&s.append(t),[];const o=[];mu(n.style,o,e);const a=pn(n.style,Ge(n,El));return typeof n.cid=="string"&&Ln(a,Xr,()=>n.cid),r&&Ln(a,Qr,()=>r),t&&a.append(t),o.push(a),yu(n.style,o,e),o}}function mu(n,e,t){(t==null?void 0:t.markerMode)==="editable"?e.push(Xi(n)):(t==null?void 0:t.markerMode)==="visible"&&e.push(Qi("marker",Gn(n)))}function yu(n,e,t,r=!1){Pe.isValidFootnoteMarker(n)||Pe.isValidCrossReferenceMarker(n)||((t==null?void 0:t.markerMode)==="editable"?r?e.push(Xi("","selfClosing")):e.push(Xi(n,"closing")):(t==null?void 0:t.markerMode)==="visible"&&e.push(Qi("marker",Yi(r?"":n))))}function xN(n){return!!n&&!!n.book&&typeof n.book=="object"&&n.book!==null&&"style"in n.book&&typeof n.book.style=="string"&&"code"in n.book&&typeof n.book.code=="string"}function Hf(n){return!!n&&!!n.para&&typeof n.para=="object"&&n.para!==null&&"style"in n.para&&typeof n.para.style=="string"}function ti(n){return!!n&&!!n.char&&typeof n.char=="object"&&n.char!==null&&(!Array.isArray(n.char)&&"style"in n.char&&typeof n.char.style=="string"||Array.isArray(n.char)&&n.char.length>0&&"style"in n.char[0]&&typeof n.char[0].style=="string")}function CN(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&Object.keys(n).length===0}function jt(n,e){if(n)for(const t of Object.keys(n)){if(t==="segment"&&typeof n[t]=="string"){const r=n[t];Ln(e,Qr,()=>r);continue}if(SN(t)){const r=!!n[t],i=t,s=e.hasFormat(i);(r&&!s||!r&&s)&&e.toggleFormat(i)}}}const $v=["bold","underline","strikethrough","italic","highlight","code","subscript","superscript","lowercase","uppercase","capitalize"];function SN(n){return $v.includes(n)}function TN({viewOptions:n}){const[e]=pe();return EN(e,n),null}function EN(n,e){x.useEffect(()=>{if(!n.hasNodes([Vn,vt,Ve]))throw new Error("ArrowNavigationPlugin: ImmutableChapterNode, ImmutableVerseNode or NoteNode not registered on editor!");const t=r=>{if(r.key!=="ArrowLeft"&&r.key!=="ArrowRight")return!1;const i=K();if(!q(i)||!i.isCollapsed())return!1;const s=n.getRootElement();if(!s)return!1;const o=s.dir||"ltr";let a=!1;return NN(o,r.key)?a=AN(i):MN(o,r.key)&&(a=ON(i,e)),a&&r.preventDefault(),a};return n.registerCommand(ts,t,Dl)},[n,e])}function NN(n,e){return n==="ltr"&&e==="ArrowRight"||n==="rtl"&&e==="ArrowLeft"}function MN(n,e){return n==="ltr"&&e==="ArrowLeft"||n==="rtl"&&e==="ArrowRight"}function AN(n){var e,t,r;const i=n.anchor.getNode(),s=NT(n);if(ge(s)&&!jo(s.getFirstChild())){if(Jt(i)){if(n.anchor.offset===i.getChildrenSize())return!1}else if(n.anchor.offset!==i.getTextContentSize())return!1;if(s.getIsCollapsed()){if(s.is((e=s.getParent())==null?void 0:e.getLastChild()))return(r=(t=s.getParent())==null?void 0:t.getNextSibling())==null||r.selectStart(),!0}else return Sl(s.getFirstChild())?s.select(2,2):s.select(1,1),!0}if(Jt(i)&&ge(s)&&s.getIsCollapsed()){const a=s.getNextSibling();return a?a.selectStart():s.selectEnd(),!0}const o=s==null?void 0:s.getParent();if(Sl(s)&&ge(o)&&s.is(o==null?void 0:o.getLastChild())){const a=o.getNextSibling();return a?a.selectStart():o.selectEnd(),!0}return!1}function ON(n,e){const t=MT(n);if(Po(t)&&!t.getPreviousSibling())return!0;if(n.anchor.offset!==0)return!1;const r=n.anchor.getNode();if(bn(r.getParent()))return!0;if(ge(t)&&t.getIsCollapsed()){const s=t.getPreviousSibling();if(!fs(s))return!1;const o=t.getParent();if(!o)return!1;const a=t.getIndexWithinParent();return o.select(a,a),!0}if(Jt(t)&&(e==null?void 0:e.noteMode)==="collapsed"){const s=t.getLastChild();if(!s)return!1;const o=en(s,a=>ge(a));if(ge(o)&&o.getIsCollapsed()){const a=o.getParent();if(!a)return!1;const l=o.getIndexWithinParent();return a.select(l,l),!0}}const i=lv(r);if(!i||i.getIsCollapsed())return!1;if(Sr(t)){const s=i.getParent();if(!s)return!1;const o=i.getIndexWithinParent();return s.select(o,o),!0}return!1}function $N(){const[n]=pe();return IN(n),null}function IN(n){x.useEffect(()=>{if(!n.hasNodes([Pe]))throw new Error("CharNodePlugin: CharNode not registered on editor!");return Ue(n.registerNodeTransform(Pe,PN),n.registerNodeTransform(ft,RN))},[n])}function PN(n){if(!Te(n))return;if(n.isEmpty()){n.remove();return}const e=n.getMarker(),t=es(n,Xr),r=n.getUnknownAttributes(),i=n.getNextSibling();Te(i)&&ei({style:e,cid:t},i)&&Rn(r,i.getUnknownAttributes())&&(n.append(...i.getChildren()),i.remove());const s=n.getPreviousSibling();Te(s)&&ei({style:e,cid:t},s)&&Rn(r,s.getUnknownAttributes())&&(s.append(...n.getChildren()),n.remove())}function RN(n){const e=n.getParent();if(!Te(e)||e.getChildrenSize()!==1)return;const t=n.getTextContent();t.length>1&&t.startsWith(me)&&(n.setTextContent(t.slice(1)),n.selectEnd())}function Iv(n){return n.replaceAll("	"," ")}const Jf=n=>{navigator.clipboard.read().then(async e=>{if((await navigator.permissions.query({name:"clipboard-read"})).state==="denied"){alert("Not allowed to paste from clipboard.");return}const t=new DataTransfer,r=e[0];for(const s of r.types){const o=await(await r.getType(s)).text();t.setData(s,Iv(o))}const i=new ClipboardEvent("paste",{clipboardData:t});n.dispatchCommand(ri,i)})},Vf=n=>{navigator.clipboard.read().then(async()=>{if((await navigator.permissions.query({name:"clipboard-read"})).state==="denied"){alert("Not allowed to paste from clipboard.");return}const e=new DataTransfer,t=await navigator.clipboard.readText();e.setData("text/plain",Iv(t));const r=new ClipboardEvent("paste",{clipboardData:e});n.dispatchCommand(ri,r)})};function jN(){const[n]=pe();return x.useEffect(()=>{const e=t=>{const{key:r,shiftKey:i,metaKey:s,ctrlKey:o,altKey:a}=t;!(Wu?s:o)||a||(!i&&r.toLowerCase()==="c"?(t.preventDefault(),n.dispatchCommand(yr,null)):!i&&r.toLowerCase()==="x"?(t.preventDefault(),n.dispatchCommand(ii,null)):r.toLowerCase()==="v"&&(t.preventDefault(),i?Vf(n):Jf(n)))};return n.registerRootListener((t,r)=>{r!==null&&r.removeEventListener("keydown",e),t!==null&&t.addEventListener("keydown",e)})},[n]),null}function DN({logger:n}){const[e]=pe();return x.useEffect(()=>Ue(e.registerCommand(ts,t=>t.key!=="\\"&&t.key!=="/"?!1:(t.preventDefault(),!0),qa),e.registerCommand(ri,t=>{var r;const i=(r=t.clipboardData)==null?void 0:r.getData("text/plain");return!i||!i.includes("\\")&&!i.includes("/")?!1:(n==null||n.info("CommandMenuPlugin: paste containing backslash or forward slash ignored."),t.preventDefault(),!0)},qa),e.registerCommand(Pl,t=>{var r;const i=(r=t.dataTransfer)==null?void 0:r.getData("text/plain");return!i||!i.includes("\\")&&!i.includes("/")?!1:(n==null||n.info("CommandMenuPlugin: drag containing backslash or forward slash ignored."),t.preventDefault(),!0)},qa)),[e,n]),null}function LN({index:n,isSelected:e,onClick:t,onMouseEnter:r,option:i}){let s="item";return e&&(s+=" selected"),i.isDisabled&&(s+=" disabled"),v.jsx("li",{tabIndex:-1,className:s,ref:i.setRefElement,role:"option","aria-selected":e,"aria-disabled":i.isDisabled,id:"typeahead-item-"+n,onMouseEnter:r,onClick:i.isDisabled?void 0:t,children:v.jsx("span",{className:"text",children:i.title})},i.key)}function FN({options:n,selectedItemIndex:e,onOptionClick:t,onOptionMouseEnter:r}){return v.jsx("div",{className:"typeahead-popover",children:v.jsx("ul",{children:n.map((i,s)=>v.jsx(LN,{index:s,isSelected:e===s,onClick:()=>t(i,s),onMouseEnter:()=>r(s),option:i},i.key))})})}class ka extends z0{constructor(e,t){super(e),Z(this,"title"),Z(this,"onSelect"),Z(this,"isDisabled"),this.title=e,this.onSelect=t.onSelect.bind(this),this.isDisabled=t.isDisabled||!1}}function qN(n,e="editor-input"){return n?n.classList.contains(e):!1}function BN(){const[n]=pe(),[e,t]=x.useState(()=>!n.isEditable()),r=x.useRef(void 0),i=x.useRef(void 0),s=x.useRef(void 0),o=x.useMemo(()=>[new ka("Cut",{onSelect:()=>{n.dispatchCommand(ii,null)},isDisabled:e}),new ka("Copy",{onSelect:()=>{n.dispatchCommand(yr,null)}}),new ka("Paste",{onSelect:()=>{Jf(n)},isDisabled:e}),new ka("Paste as Plain Text",{onSelect:()=>{Vf(n)},isDisabled:e})],[n,e]),a=x.useCallback((l,c,u)=>{n.update(()=>{l==null||l.onSelect(c),u()})},[n]);return x.useEffect(()=>{var l;i.current=((l=n.getRootElement())==null?void 0:l.className)??""},[n]),x.useEffect(()=>{const l=()=>{var c;(c=s.current)==null||c.call(s)};return window.addEventListener("scroll",l,!0),()=>{window.removeEventListener("scroll",l,!0)}},[]),x.useEffect(()=>n.registerEditableListener(l=>{t(!l)}),[n]),v.jsx(H0,{options:o,onSelectOption:a,onWillOpen:l=>{r.current=l.target},menuRenderFn:(l,{selectedIndex:c,options:u,selectOptionAndCleanUp:f,setHighlightedIndex:d},{setMenuRef:h})=>(s.current=()=>f(void 0),l.current&&!qN(r.current,i.current)&&!ev(r.current)?Ot.createPortal(v.jsx("div",{className:"typeahead-popover auto-embed-menu",style:{marginLeft:l.current.style.width,userSelect:"none",width:200},ref:h,children:v.jsx(FN,{options:o,selectedItemIndex:c,onOptionClick:(g,m)=>{g.isDisabled||(d(m),f(g))},onOptionMouseEnter:g=>{d(g)}})}),l.current):null)})}function UN({isEditable:n}){const[e]=pe();return x.useLayoutEffect(()=>{e.setEditable(n)},[e,n]),null}function zN({scripture:n,nodeOptions:e,editorAdaptor:t,viewOptions:r,logger:i}){const[s]=pe();return x.useEffect(()=>{var o;(o=t.initialize)==null||o.call(t,e,i)},[t,i,e]),x.useEffect(()=>{var o;(o=t.reset)==null||o.call(t);const a=t.serializeEditorState(n,r);if(a==null){i==null||i.warn("LoadStatePlugin: serializedEditorState was null or undefined. Skipping editor update.");return}try{const l=s.parseEditorState(a);queueMicrotask(()=>{s.update(()=>{s.setEditorState(l),s.dispatchCommand(uy,void 0)},{tag:Tf})})}catch{i==null||i.error("LoadStatePlugin: error parsing or setting editor state.")}},[s,t,i,n,r]),null}function WN({expandedNoteKeyRef:n,nodeOptions:e,viewOptions:t,logger:r}){const[i]=pe();return KN(e,r),HN(i,n,t,r),null}function KN(n,e){const t=x.useRef(void 0),r=n.noteCallers;x.useEffect(()=>{let i=r;(!i||i.length<=0)&&(i=qE),t.current!==i&&(t.current=i,eM("note-callers",i,e))},[e,r])}function HN(n,e,t,r){x.useEffect(()=>{if(!n.hasNodes([Pe,Ve,Xt]))throw new Error("NoteNodePlugin: CharNode, NoteNode or ImmutableNoteCallerNode not registered on editor!");const i=s=>n.update(()=>ZN(s));return Ue(n.registerNodeTransform(Ve,s=>JN(s,t)),n.registerNodeTransform(Pe,VN),n.registerNodeTransform(ft,GN),n.registerNodeTransform(Xt,YN),n.registerMutationListener(Xt,(s,{prevEditorState:o})=>XN(s,o)),n.registerCommand(mr,()=>QN(n,e,t,r),oi),n.registerRootListener((s,o)=>{o!==null&&o.removeEventListener("dblclick",i),s!==null&&s.addEventListener("dblclick",i)}))},[n,e,r,t])}function JN(n,e){const t=n.getChildren();if(!t.some(r=>Sr(r))&&(e==null?void 0:e.markerMode)!=="editable"&&n.getCaller()!==""&&n.remove(),t.length>0){const r=t[0];W(r)&&!jo(r)&&n.insertBefore(r)}}function VN(n){const e=n.getParentOrThrow(),t=e.getChildren(),r=t.find(o=>Sr(o));if(!Te(n)||!ge(e)||!r)return;const i=jf(t);r.getPreviewText()!==i&&r.setPreviewText(i);const s=n.getNextSibling();W(s)?s.getTextContent()!==me&&s.setTextContent(me):n.insertAfter(de(me))}function GN(n){const e=lv(n),t=e==null?void 0:e.getChildren(),r=t==null?void 0:t.find(o=>Sr(o));if(!W(n)||!ge(e)||!r||!t)return;const i=n.getParent();if(!jo(n)&&ge(i)&&n.getTextContent()!==me&&(n.setTextContent(me),n.selectEnd()),Te(i)&&i.getChildrenSize()===1){const o=n.getTextContent();o.length>1&&o.startsWith(me)&&(n.setTextContent(o.slice(1)),n.selectEnd())}const s=jf(t);r.getPreviewText()!==s&&r.setPreviewText(s)}function YN(n){if(!Sr(n))return;const e=n.getNextSibling();!W(e)||jo(e)?n.insertAfter(de(me)):e.getTextContent()!==me&&e.setTextContent(me)}function XN(n,e){for(const[t,r]of n){if(r!=="destroyed")continue;const i=e.read(()=>{const o=ce(t),a=o==null?void 0:o.getParent();return Sr(o)&&ge(a)&&a.getCaller()===vn}),s=document.querySelector(".editor-input");!i||!s||(s.classList.add("reset-counters"),s.offsetHeight,s.classList.remove("reset-counters"))}}function QN(n,e,t,r){var i;if((t==null?void 0:t.noteMode)!=="expandInline")return!1;const s=K();if(!q(s)||!s.isCollapsed())return!1;const o=s.anchor,a=o.getNode();if(e.current){const l=en(a,c=>ge(c));if(l)e.current!==l.getKey()&&(e.current=l.getKey());else{const c=ce(e.current);c&&!c.getIsCollapsed()&&(r==null||r.debug("Cursor moved away from NoteNode, collapsing it"),Rs(n,e.current,r)),e.current=void 0}}if(o.offset===0){const l=a.getPreviousSibling();if(ge(l)){r==null||r.debug("Cursor is just after a NoteNode");const c=l.getKey();l.getIsCollapsed()?e.current=c:e.current=void 0,Rs(n,c,r)}}if(o.offset===a.getTextContentSize()){const l=a.getNextSibling();if(ge(l)){r==null||r.debug("Cursor is just before a NoteNode");const c=l.getKey();l.getIsCollapsed()?e.current=c:e.current=void 0,Rs(n,c,r)}else if(!l){const c=en(a,u=>ge(u));if(c&&c.getIsCollapsed()&&Jt(c.getParent())&&c.is((i=c.getParent())==null?void 0:i.getLastChild())){r==null||r.debug("Cursor is at end of note at end of para");const u=c.getKey();e.current=u,Rs(n,u,r)}}}if(Jt(a)){const l=a.getChildAtIndex(o.offset),c=l==null?void 0:l.getPreviousSibling();if(fs(c)&&ge(l)){r==null||r.debug("Cursor is between verse and NoteNode");const u=l.getKey();l.getIsCollapsed()?e.current=u:e.current=void 0,Rs(n,u,r)}}return!1}function Rs(n,e,t){const r=ce(e);try{r==null||r.toggleIsCollapsed()}catch(i){if(i instanceof Error&&i.message.includes("read only"))t==null||t.warn("Fallback triggered after stabilization - edge case"),setTimeout(()=>{n.update(()=>{r==null||r.toggleIsCollapsed()})},0);else throw i}}function ZN(n){const e=K();if(!q(e))return;const t=e.anchor,r=e.focus,i=t.getNode(),s=r.getNode();if(ge(i)&&W(s)){n.preventDefault();const o=So();o.anchor.set(s.getKey(),0,"text"),o.focus.set(s.getKey(),r.offset,"text"),it(o)}}function eM(n,e,t){for(const r of document.styleSheets)try{const i=r.cssRules||r.rules;for(const s of i)if(tM(s,n)){const o=e.map(a=>`"${a}"`).join(" ");s.symbols=o;return}}catch{continue}t==null||t.warn(`Editor: counter style "${n}" not found.`)}function tM(n,e){return typeof n=="object"&&n!==null&&"name"in n&&n.name===e&&"symbols"in n&&typeof n.symbols=="string"}function nM({onChange:n}){const[e]=pe();return x.useEffect(()=>e.registerCommand(mr,()=>{const t=e.read(()=>yv());return n==null||n(t),!1},oi),[e,n]),null}function rM(){const[n]=pe();return iM(n),null}function iM(n){x.useEffect(()=>{if(!n.hasNodes([Tt]))throw new Error("ParaNodePlugin: ParaNode not registered on editor!");return n.registerNodeTransform(Tt,e=>sM(e,n))},[n])}function sM(n,e){Uf(e,n.getKey())&&xv(n.getFirstChild()),!(!dt(n)||n.getMarker()!=="b"||n.isEmpty()||!e.getEditorState().read(()=>{const t=ce(n.getKey());return dt(t)&&((t==null?void 0:t.isEmpty())??!1)}))&&n.clear()}function Pv({onStateChange:n}){const[e]=pe(),[t,r]=x.useState(e),i=x.useRef(!1),s=x.useRef(!1),o=x.useRef(),a=x.useCallback(()=>{const l=K();if(q(l)){const c=l.anchor.getNode();let u=c.getKey()==="root"?c:en(c,d=>{const h=d.getParent();return h!==null&&wn(h)});u===null&&(u=c.getTopLevelElementOrThrow());const f=u.getKey();t.getElementByKey(f)!==null&&(dt(u)||bn(u)||Po(u))&&(o.current=u.getMarker(),n==null||n(i.current,s.current,o.current))}},[t,n]);return x.useEffect(()=>e.registerCommand(mr,(l,c)=>(a(),r(c),!1),Ai),[e,a]),x.useEffect(()=>Ue(t.registerUpdateListener(({editorState:l})=>{l.read(()=>{a()})}),t.registerCommand(Ls,l=>(i.current=l,n==null||n(i.current,s.current,o.current),!1),Ai),t.registerCommand(Ds,l=>(s.current=l,n==null||n(i.current,s.current,o.current),!1),Ai)),[a,t,n]),null}function oM({textDirection:n}){const[e]=pe();return aM(e,n),lM(e),null}function aM(n,e){x.useEffect(()=>{function t(){const r=n.getRootElement();if(!r||e==="auto")return;r.dir=e;const i=n._config.theme.placeholder,s=document.getElementsByClassName(i)[0];s&&(s.dir=e)}return t(),n.registerUpdateListener(({dirtyElements:r})=>{r.size>0&&t()})},[n,e])}function lM(n){x.useEffect(()=>{const e=t=>{if(t.key!=="ArrowLeft"&&t.key!=="ArrowRight")return!1;const r=K();if(!q(r))return!1;const i=r.anchor.getNode(),s=en(i,f=>jT(f,n)==="p");if(!s)return!1;const o=n.getElementByKey(s.getKey());if(!o)return!1;const a=o.parentElement,l=o.dir||"ltr",c=((a==null?void 0:a.dir)??"")||"ltr";if(!a||l===c)return!1;const u=a.dir==="rtl"&&t.key==="ArrowLeft"||a.dir==="ltr"&&t.key==="ArrowRight";return r.modify("move",u,"character"),t.preventDefault(),!0};return n.registerCommand(ts,e,Dl)},[n])}function cM(){const[n]=pe();return uM(n),null}function uM(n){x.useEffect(()=>{if(!n.hasNodes([Pe,vt,Ve,ft,bt]))throw new Error("TextSpacingPlugin: CharNode, ImmutableVerseNode, NoteNode, TextNode or VerseNode not registered on editor!");return Ue(n.registerNodeTransform(ft,dM),n.registerNodeTransform(ft,e=>fM(e,n)),n.registerNodeTransform(bt,Og),n.registerNodeTransform(vt,Og))},[n])}function dM(n){if(!n.isAttached())return;const e=n.getTextContent(),t=n.getNextSibling(),r=n.getParent();n.getMode()!=="normal"||e.endsWith(" ")&&e.length>1||ge(t)||Te(r)||rt(r)||Io(r)||(e===" "&&!Ft(t)?n.setTextContent(""):Bf(n))}function fM(n,e){const t=n.getParent();!Io(t)||!n.isAttached()||Uf(e,n.getKey())&&t.insertAfter(n)}function Og(n){if(!n.isAttached())return;const e=n.getPreviousSibling();e&&!Ft(e)&&!W(e)&&!Io(e)&&n.insertBefore(de(" "))}function hM({trigger:n,scriptureReference:e,contextMarker:t,getMarkerAction:r}){const{markersMenuItems:i}=sN({scriptureReference:e,contextMarker:t,getMarkerAction:r});return v.jsx(iN,{trigger:n,items:i})}function pM({trigger:n,scrRef:e,getMarkerAction:t}){const{book:r,chapterNum:i,verseNum:s,verse:o}=e,a=x.useMemo(()=>e,[r,i,s,o]),[l]=pe(),[c]=gM(l);return mM(l),v.jsx(hM,{trigger:n,scriptureReference:a,contextMarker:c,getMarkerAction:t})}function gM(n){const[e,t]=x.useState();return x.useEffect(()=>n.registerCommand(mr,()=>(n.read(()=>{const r=K();if(!q(r)){e&&t(void 0);return}const i=ce(r.anchor.key),s=ce(r.focus.key);if(!i||!s){e&&t(void 0);return}const o=OT(i,s);if(!o||!cE(o)){e&&t(void 0);return}const a=o.getMarker();e!==a&&t(a)}),!1),oi),[e,n]),[e]}function mM(n){x.useEffect(()=>{if(!n.hasNodes([bt,vt]))throw new Error("UsjNodesMenuPlugin: VerseNode or ImmutableVerseNode not registered on editor!");const e={},t={};return Ue(n.registerNodeTransform(vt,r=>$g(r,n,e)),n.registerNodeTransform(bt,r=>$g(r,n,e)),n.registerMutationListener(vt,r=>jg(r,n,e,t)),n.registerMutationListener(bt,r=>jg(r,n,e,t)))},[n])}function $g(n,e,t){sx(Tf)||Uf(e,n.getKey())&&bM(n,t)}function Ig(n){return RegExp(/(\d+)([a-zA-Z]+)?(-(\d+)([a-zA-Z]+)?)?/).exec(n)}const Pg=2,yM=3,Rg=4,_M=5;function bM(n,e){var t;const r=If(n),i=r==null?void 0:r.getNumber();if(!i)return;const s=e[i];if(!s)return;let o=parseInt(n.getNumber()),a=((t=Ig(n.getNumber()))==null?void 0:t[Pg])??"";s.forEach(l=>{const c=ce(l);if(!c)return;const u=c.getNumber(),f=parseInt(u),d=Ig(u),h=!!(d!=null&&d[yM]),g=h?parseInt(d[Rg]):f;if(g<o||f>o||g===o&&a)return;const m=(d==null?void 0:d[Pg])??"",y=(d==null?void 0:d[_M])??"",b=h?fd(parseInt(d[Rg]),void 0):"";let _=`${m}`;_+=h?`-${b}${y}`:"";const w=fd(f,void 0);c.setNumber(`${w}${_}`),o=parseInt(h?b:w),a=h?y:m})}function jg(n,e,t,r){e.getEditorState().read(()=>{for(const[i,s]of n){const o=ce(i);if(Ft(o)){if(s==="created"){const a=If(o);if(!a)continue;const l=a.getNumber();t[l]||(t[l]=[]),t[l].push(i),r[i]=l}else if(s==="destroyed"){const a=r[i],l=t[a];if(!l)continue;const c=l.findIndex(u=>u===i);if(c===-1)continue;l.splice(c,1),Reflect.deleteProperty(r,i)}}}})}const Rv="formatted",vM="unformatted";let Gf;function kM(n){const e=wM(n);if(!e)throw new Error(`Invalid view mode: ${n}`);Gf=e}kM(Rv);const hs=()=>Gf;function wM(n){let e;switch(n){case Rv:e={markerMode:"hidden",noteMode:"collapsed",hasSpacing:!0,isFormattedFont:!0};break;case vM:e={markerMode:"editable",noteMode:"expanded",hasSpacing:!1,isFormattedFont:!1};break}return e}function xM(n){if(n)return n.markerMode==="editable"?bt:vt}function CM(n){const e=[],t=n??Gf;return t&&(e.push(`${iT}${t.markerMode}`),t.hasSpacing&&e.push(nT),t.isFormattedFont&&e.push(rT)),e}let gd;function SM(n){n&&(gd=n)}function TM(n){return n.isEmpty()?Lm:EM(n.toJSON())}function EM(n){if(!n.root||!n.root.children)return;const e=n.root.children;if(e.length===1&&Mf(e[0])&&(!e[0].children||e[0].children.length===0))return Lm;const t=jv(e),r=Qn(t);return r?{type:Qs,version:Zs,content:r}:void 0}function NM(n,e){const{type:t,marker:r,unknownAttributes:i}=n;let s;return n.code!==""&&(s=n.code),ze({type:t,marker:r,code:s,...i,content:e})}function MM(n){const{marker:e,number:t,sid:r,altnumber:i,pubnumber:s,unknownAttributes:o}=n;return ze({type:rn.getType(),marker:e,number:t,sid:r,altnumber:i,pubnumber:s,...o})}function AM(n,e){const{marker:t,sid:r,altnumber:i,pubnumber:s,unknownAttributes:o}=n,a=e&&typeof e[0]=="string"?e[0]:void 0;let{number:l}=n;return l=cv(t,a,l),ze({type:rn.getType(),marker:t,number:l,sid:r,altnumber:i,pubnumber:s,...o})}function OM(n){const{marker:e,sid:t,altnumber:r,pubnumber:i,unknownAttributes:s}=n,{text:o}=n;let{number:a}=n;return a=cv(e,o,a),ze({type:bt.getType(),marker:e,number:a,sid:t,altnumber:r,pubnumber:i,...s})}function $M(n,e){const{type:t,marker:r,unknownAttributes:i}=n,s=r===""?void 0:r;return e==null||e.forEach((o,a)=>{typeof o=="string"&&o.startsWith(me)&&(e[a]=o.slice(1))}),ze({type:t,marker:s,...i,content:e})}function IM(n,e){const{type:t,marker:r,unknownAttributes:i}=n;return ze({type:t,marker:r,...i,content:e})}function PM(n,e){const{type:t,marker:r,caller:i,category:s,unknownAttributes:o}=n;return ze({type:t,marker:r,caller:i,category:s,...o,content:e})}function Ei(n){const{type:e,marker:t,sid:r,eid:i,unknownAttributes:s}=n;return ze({type:e,marker:t===""?void 0:t,sid:r,eid:i,...s})}function RM(n){return n.text}function jM(n,e){const{tag:t,marker:r,unknownAttributes:i}=n;return ze({type:t,marker:r,...i,content:e})}function DM(n){const{marker:e}=n;return{type:Tl,marker:e===""?void 0:e}}function Dg(n,e){const t=n[n.length-1];t&&typeof t=="string"?n[n.length-1]=t+e:n.push(e)}function LM(n,e,t,r,i){const s=kn.getType(),o=e.filter(a=>!t.includes(a));if(t.filter(a=>!e.includes(a)).forEach(a=>{const l=Ei({type:s,marker:Pi,eid:a});i.push(l)}),o.forEach(a=>{const l=Ei({type:s,marker:Zr,sid:a});i.push(l)}),e.length===0){const a=Ei({type:s,marker:Zr});i.push(a)}if(i.push(...n),e.length===0){const a=Ei({type:s,marker:Pi});i.push(a)}(!r||!UT(r))&&e.forEach(a=>{const l=Ei({type:s,marker:Pi,eid:a});i.push(l)})}function Qn(n,e){const t=[];let r,i=[];return n.forEach((s,o)=>{const a=s,l=s,c=s,u=s,f=s,d=s,h=s,g=s;switch(s.type){case Bt.getType():t.push(NM(a,Qn(a.children)));break;case Vn.getType():t.push(MM(s));break;case rn.getType():t.push(AM(l,Qn(l.children)));break;case vt.getType():case bt.getType():t.push(OM(s));break;case Pe.getType():t.push($M(c,Qn(c.children)));break;case Tt.getType():t.push(IM(u,Qn(u.children)));break;case Ve.getType():t.push(PM(f,Qn(f.children,f.caller)));break;case xr.getType():case Xt.getType():case wo.getType():case ui.getType():break;case tt.getType():if(r=Qn(h.children),r){const m=h.typedIDs[ir];if(m)LM(r,m,i,n[o+1],t),i=m;else{const y=r.shift();y&&(typeof y=="string"?Dg(t,y):t.push(y)),r.length>0&&t.push(...r)}}break;case kn.getType():t.push(Ei(s));break;case ft.getType():d.text&&d.text!==me&&!d.text.startsWith(Sf)&&(!e||d.text!==Rf(e))&&Dg(t,RM(d));break;case ci.getType():t.push(jM(g,Qn(g.children)));break;case Cr.getType():t.push(DM(s));break;default:gd==null||gd.error(`Unexpected node type '${s.type}'!`)}}),t&&t.length>0?t:void 0}function jv(n){const e=n.findIndex(t=>Mf(t));if(e>=0){const t=n.slice(0,e),r=n[e].children,i=jv(n.slice(e+1));n=[...t,...r,...i]}return n}const _u={initialize:SM,deserializeEditorState:TM},Lg=Dv([]),FM={type:wo.getType(),version:1};let Ml=[],ae,Va,md,$e;function qM(n,e){Ml=[],zM(n),WM(e)}function BM(n=0){}function UM(n,e){ae=e??hs();let t;return n?(n.type!==Qs&&($e==null||$e.warn(`This USJ type '${n.type}' didn't match the expected type '${Qs}'.`)),n.version!==Zs&&($e==null||$e.warn(`This USJ version '${n.version}' didn't match the expected version '${Zs}'.`)),n.content.length>0?t=_d(Us(n.content)):t=[Lg]):t=[Lg],md==null||md(Ml),{root:{children:t,direction:null,format:"",indent:0,type:"root",version:1}}}function zM(n){n&&(Va=n),n!=null&&n.addMissingComments&&(md=n.addMissingComments)}function WM(n){n&&($e=n)}function KM(n){return!n||n.length!==1||typeof n[0]!="string"?"":n[0]}function HM(n){let{marker:e}=n;e!==go&&($e==null||$e.warn(`Unexpected book marker '${e}'!`)),e=e??go;const{code:t}=n;(!t||!Bt.isValidBookCode(t))&&($e==null||$e.warn(`Unexpected book code '${t}'!`));const r=[];((ae==null?void 0:ae.markerMode)==="editable"||(ae==null?void 0:ae.markerMode)==="visible")&&r.push(ni("marker",Gn(e)+" "+t+me));const i=KM(n.content);i&&r.push(pr(i));const s=Ge(n);return ze({type:Bt.getType(),marker:e,code:t??"",unknownAttributes:s,children:r,direction:null,format:"",indent:0,version:Wb})}function JM(n){let{marker:e}=n;e!==xl&&($e==null||$e.warn(`Unexpected chapter marker '${e}'!`)),e=e??xl;const{number:t,sid:r,altnumber:i,pubnumber:s}=n,o=Ge(n);let a;return(ae==null?void 0:ae.markerMode)==="visible"&&(a=!0),(ae==null?void 0:ae.markerMode)==="editable"?ze({type:rn.getType(),marker:e,number:t??"",sid:r,altnumber:i,pubnumber:s,unknownAttributes:o,children:[pr(Ro(e,t)??"")],direction:null,format:"",indent:0,version:Jb}):ze({type:Vn.getType(),marker:e,number:t??"",showMarker:a,sid:r,altnumber:i,pubnumber:s,unknownAttributes:o,version:Qb})}function VM(n){let{marker:e}=n;e!==Cl&&($e==null||$e.warn(`Unexpected verse marker '${e}'!`)),e=e??Cl;const{number:t,sid:r,altnumber:i,pubnumber:s}=n,o=(xM(ae)??vt).getType(),a=(ae==null?void 0:ae.markerMode)==="editable"?ov:bv;let l,c;(ae==null?void 0:ae.markerMode)==="editable"?l=Ro(e,t):(ae==null?void 0:ae.markerMode)==="visible"&&(c=!0);const u=Ge(n);return ze({type:o,text:l,marker:e,number:t??"",sid:r,altnumber:i,pubnumber:s,showMarker:c,unknownAttributes:u,version:a})}function GM(n,e=[]){let{marker:t}=n;Pe.isValidMarker(t)||$e==null||$e.warn(`Unexpected char marker '${t}'!`),t=t??"",(ae==null?void 0:ae.markerMode)==="editable"&&e.forEach(i=>{Pf(i)&&(i.text=me+i.text)}),e.length===0&&e.push(pr(me));const r=Ge(n);return ze({type:Pe.getType(),marker:t,unknownAttributes:r,children:[...e],direction:null,format:"",indent:0,textFormat:0,textStyle:"",version:Xb})}function Dv(n){return{type:hr.getType(),children:n,direction:null,format:"",indent:0,textFormat:0,textStyle:"",version:tv}}function YM(n,e=[]){let{marker:t}=n;Tt.isValidMarker(t)||$e==null||$e.warn(`Unexpected para marker '${t}'!`),t=t??Yl;const r=[];(ae==null?void 0:ae.markerMode)==="editable"?r.push(Zi(t),pr(me)):(ae==null?void 0:ae.markerMode)==="visible"&&r.push(ni("marker",Gn(t)+me)),r.push(...e);const i=Ge(n);return ze({type:Tt.getType(),marker:t,unknownAttributes:i,children:r,direction:null,format:"",indent:0,textFormat:0,textStyle:"",version:sv})}function XM(n,e){const t=RT(e);let r=()=>{};return Va!=null&&Va.noteCallerOnClick&&(r=Va.noteCallerOnClick),ze({type:Xt.getType(),caller:n,previewText:t,onClick:r,version:Ev})}function QM(n,e){let{marker:t}=n;Ve.isValidMarker(t)||$e==null||$e.warn(`Unexpected note marker '${t}'!`),t=t??Af;const{category:r}=n,i=n.caller??"*",s=(ae==null?void 0:ae.noteMode)!=="expanded",o=Ge(n);let a,l;(ae==null?void 0:ae.markerMode)==="editable"?(a=Zi(t),l=Zi(t,"closing")):(ae==null?void 0:ae.markerMode)==="visible"&&(a=ni("marker",Gn(t)+me),l=ni("marker",Yi(t)+me));const c=[];let u;if(a&&c.push(a),(ae==null?void 0:ae.markerMode)==="editable")u=pr(Rf(i)),c.push(u,...e);else{const f=pr(me);u=XM(i,e),c.push(u,f,...e.flatMap(ZM(f)))}return l&&c.push(l),ze({type:Ve.getType(),marker:t,caller:i,isCollapsed:s,category:r,unknownAttributes:o,children:c,direction:null,format:"",indent:0,version:iv})}function ZM(n){return e=>HT(e)?[e]:[e,n]}function eA(n){let{marker:e}=n;(!e||!kn.isValidMarker(e))&&($e==null||$e.warn(`Unexpected milestone marker '${e}'!`)),e=e??"";const{sid:t,eid:r}=n,i=Ge(n);return ze({type:kn.getType(),marker:e,sid:t,eid:r,unknownAttributes:i,version:nv})}function Fg(n,e=[]){return{type:tt.getType(),typedIDs:{[ir]:e},children:n,direction:null,format:"",indent:0,version:1}}function tA(n,e){const{marker:t}=n,r=n.type,i=Ge(n),s=[...e];return s.forEach(o=>{Pf(o)&&(o.mode="token")}),ze({type:ci.getType(),tag:r,marker:t,unknownAttributes:i,children:s,direction:null,format:"",indent:0,version:Ub})}function nA(n){return{type:Cr.getType(),marker:n,version:gv}}function Zi(n,e="opening"){return{type:ui.getType(),marker:n,markerSyntax:e,text:"",detail:0,format:0,mode:"normal",style:"",version:1}}function pr(n,e="normal"){return{type:ft.getType(),text:n,detail:0,format:0,mode:e,style:"",version:1}}function ni(n,e){return{type:xr.getType(),text:e,textType:n,version:pv}}function qg(n,e){(ae==null?void 0:ae.markerMode)==="editable"?e.push(Zi(n)):(ae==null?void 0:ae.markerMode)==="visible"&&e.push(ni("marker",Gn(n)))}function Bg(n,e,t=!1){Pe.isValidFootnoteMarker(n)||Pe.isValidCrossReferenceMarker(n)||((ae==null?void 0:ae.markerMode)==="editable"?t?e.push(Zi("","selfClosing")):e.push(Zi(n,"closing")):(ae==null?void 0:ae.markerMode)==="visible"&&e.push(ni("marker",Yi(t?"":n))))}function rA(n,e){if(n.type!=="ms")return;const t=[];if(n.sid&&t.push(`sid="${n.sid}"`),n.eid&&t.push(`eid="${n.eid}"`),t.length<=0)return;const r=Sf+t.join(" ");(ae==null?void 0:ae.markerMode)==="editable"?e.push(pr(r)):(ae==null?void 0:ae.markerMode)==="visible"&&e.push(ni("attribute",r))}function Ug(n,e){return n.length<=0||e===0?n:n.map(t=>t-e)}function iA(n,e){const t=n.indexOf(e,0);t>-1&&n.splice(t,1)}function zg(n,e){e.marker===Zr&&e.sid!==void 0&&n.push(e.sid),e.marker===Pi&&e.eid!==void 0&&iA(n,e.eid)}function yd(n,e,t=!1,r=[]){if(e.length<=0||e[0]>=n.length)return n;const i=e.shift(),s=e.length>0?e.shift():n.length-1;if(i===void 0||s===void 0||s>=n.length||n.length<=0)return n;const o=n.slice(0,i),a=t?[Fg(o,[...r])]:o,l=n[i];zg(r,l);const c=yd(n.slice(i+1,s),Ug(e,i+1),l.marker===Zr,r),u=Fg(c,[...r]),f=n[s];zg(r,f);const d=yd(n.slice(s+1),Ug(e,s+1),f.marker===Zr,r);return[...a,u,...d]}function Us(n){const e=[],t=[];return n==null||n.forEach(r=>{if(typeof r=="string")r&&t.push(pr(r));else if(!r.type)$e==null||$e.error("Marker type is missing!");else switch(r.type){case Bt.getType():t.push(HM(r));break;case rn.getType():t.push(JM(r));break;case bt.getType():ae!=null&&ae.hasSpacing||t.push(FM),t.push(VM(r));break;case Pe.getType():qg(r.marker??"",t),t.push(GM(r,Us(r.content))),Bg(r.marker??"",t);break;case Tt.getType():t.push(YM(r,Us(r.content)));break;case Ve.getType():t.push(QM(r,Us(r.content)));break;case kn.getType():mT(r.marker??"")&&(e.push(t.length),r.sid!==void 0&&(Ml==null||Ml.push(r.sid))),t.push(eA(r)),qg(r.marker??"",t),rA(r,t),Bg(r.marker??"",t,!0);break;case Cr.getType():t.push(nA(r.marker??""));break;default:$e==null||$e.warn(`Unknown type-marker '${r.type}-${r.marker}'!`),t.push(tA(r,Us(r.content)))}}),yd(t,e)}function _d(n){const e=n.findIndex(t=>tT(t)||CT(t)||wT(t));if(e>=0){const t=_d(n.slice(0,e)),r=n[e],i=_d(n.slice(e+1));return[...t,r,...i]}else if(n.some(t=>"text"in t&&"mode"in t||tE(t)))return[Dv(n)];return n}const bd={initialize:qM,reset:BM,serializeEditorState:UM},wa=n=>{if(!Ve.isValidMarker(n)||!n.includes("f"))throw new Error(`Invalid footnote marker '${n}'`);return{action:e=>{const{chapterNum:t,verseNum:r}=e.reference,i=[];return t!==void 0&&r!==void 0&&i.push({type:"char",marker:"fr",content:[`${t}:${r}`]}),e.noteText&&i.push({type:"char",marker:"fq",content:[e.noteText]}),i.push({type:"char",marker:"ft"}),[{type:"note",marker:n,caller:vn,content:i}]}}},Wg=n=>{if(!Ve.isValidMarker(n)||!n.includes("x"))throw new Error(`Invalid cross-reference marker '${n}'`);return{action:e=>{const{chapterNum:t,verseNum:r}=e.reference,i=[];return t!==void 0&&r!==void 0&&i.push({type:"char",marker:"xo",content:[`${t}:${r}`]}),i.push({type:"char",marker:"xt"}),[{type:"note",marker:n,caller:Gi,content:i}]}}},sA={c:{action:n=>{const{chapterNum:e}=n.reference;return[{type:"chapter",marker:"c",number:`${e+1}`}]}},v:{action:n=>{const{verseNum:e,verse:t}=n.reference;return[{type:"verse",marker:"v",number:`${fd(e,t)}`}]}},f:wa("f"),fe:wa("fe"),ef:wa("ef"),efe:wa("efe"),x:Wg("x"),ex:Wg("ex")};function oA(n,e,t,r,i){const s=aA(n);return{action:o=>{o.editor.update(()=>{var a;const l=K();q(l)&&(o.noteText=l.getTextContent());const c=(a=s==null?void 0:s.action)==null?void 0:a.call(s,o);if(!c)return;const u=_g(c,bd,r),f=hu(u);if(q(l)){const d=l.anchor.getNode();if(ge(f))vv(f,l,r),f.getIsCollapsed()||(e.current=f.getKey());else if(l.getTextContent().length>0)lA(l,()=>hu(u));else if(F(f)&&!f.isInline()){const h=l.insertParagraph();if(h){const g=h.getChildren();f.append(...g),h.replace(f),f.selectStart()}}else if(W(d)&&!jo(d)&&ge(d.getParent())&&l.isCollapsed()){let h=d.insertAfter(f);if(Sl(f)){const g={...r||hs(),markerMode:"hidden"},m=_g(c,bd,g),y=hu(m);h=h.insertAfter(y)}h.insertAfter(de(me))}else{l.insertNodes([f]),hA(f);const h=f.getNextSibling();h?h.selectStart():f.selectStart()}}else l==null||l.insertNodes([f])},i)},label:s==null?void 0:s.label}}function aA(n){let e=sA[n];return e||(Tt.isValidMarker(n)?e={action:()=>[{type:Tt.getType(),marker:n,content:[]}]}:Pe.isValidMarker(n)&&(e={action:()=>[{type:Pe.getType(),marker:n}]})),e}function lA(n,e){const t=n.getNodes(),[r,i]=cA(n);let s;t.forEach((o,a)=>{if(F(s)&&s.isParentOf(o))return;const l=uA(o,a===0,a===t.length-1,r,i);if(!l){s=void 0;return}s||(s=e(),l.insertBefore(s)),fA(l,s)}),(W(s)||F(s))&&s.selectEnd()}function cA(n){const e=n.anchor.offset,t=n.focus.offset;return n.isBackward()?[t,e]:[e,t]}function uA(n,e,t,r,i){if(!(rt(n)||ge(n)||ge(n.getParent()))){if(W(n))return dA(n,e,t,r,i);if(F(n)&&n.isInline())return n}}function dA(n,e,t,r,i){const s=n.getTextContentSize(),o=e?r:0,a=t?i:s;if(o===0&&a===0)return;const l=n.splitText(o,a);return l.length===1?l[0]:l.length===3||a===s?l[1]:l[0]}function fA(n,e){var t;if(W(e)){const r=Kg(n,e);e.setTextContent(r),n.remove()}else if(F(e)){const r=e.getChildrenSize();e.append(n);for(let i=0;i<r;i++)(t=e.getFirstChild())==null||t.remove();Kg(n,e)}}function Kg(n,e){let t=n.getTextContent();if(W(n)&&e.isInline()&&t.startsWith(" ")){t=t.trimStart(),n.setTextContent(t);const r=e.getPreviousSibling();Bf(r),W(r)||e.insertBefore(de(" "))}return t}function hA(n){Ft(n)&&(Bf(n.getPreviousSibling()),xv(n.getNextSibling()))}const Lv={chapter:"chapter",verse:"verse",char:"char",para:"para",typedMark:"editor-typed-mark",typedMarkOverlap:"editor-typed-markOverlap",mark:"editor-mark",markOverlap:"editor-markOverlap",placeholder:"editor-placeholder",paragraph:"editor-paragraph",quote:"editor-quote",heading:{h1:"editor-heading-h1",h2:"editor-heading-h2",h3:"editor-heading-h3",h4:"editor-heading-h4",h5:"editor-heading-h5"},list:{nested:{listitem:"editor-nested-listitem"},ol:"editor-list-ol",ul:"editor-list-ul",listitem:"editor-listitem"},image:"editor-image",link:"editor-link",text:{bold:"editor-text-bold",italic:"editor-text-italic",overflowed:"editor-text-overflowed",hashtag:"editor-text-hashtag",underline:"editor-text-underline",strikethrough:"editor-text-strikethrough",underlineStrikethrough:"editor-text-underlineStrikethrough"}};function pA({options:n,editedUsjRef:e,usj:t,setUsj:r}){const{view:i,nodes:s}=n||{},{hasSpacing:o,isFormattedFont:a,markerMode:l}=i||{};return x.useEffect(()=>{e.current&&!Rn(e.current,t)&&r(e.current)},[e,o,a,l,s,r,t]),null}function gA({scrRef:n,onScrRefChange:e}){const[t]=pe(),r=x.useRef(!1),i=x.useRef(!1),{book:s,chapterNum:o,verseNum:a}=n;return x.useEffect(()=>t.registerMutationListener(Bt,l=>{t.update(()=>{for(const[c,u]of l){const f=ce(c);f&&bn(f)&&u==="created"&&Hg(o,a,i)}},{tag:cd})},{skipInitialization:!0}),[t,o,a]),x.useEffect(()=>{r.current?r.current=!1:t.update(()=>Hg(o,a,i),{tag:cd})},[t,o,a]),x.useEffect(()=>t.registerCommand(mr,()=>(i.current?i.current=!1:mA(s,o,a,e,r),!1),oi),[t,s,o,a,e]),null}function Hg(n,e,t){var r;const i=dv(K()),s=(r=wv(i))==null?void 0:r.getNumber();if(DT(s)&&Df(e,s))return;const o=ye().getChildren(),a=ST(o,n),l=PT(o,a),c=TT(l,!!a);if(c&&!a||!a)return;IT(l,c);const u=lE(l,e);if(u){if(dt(u)){const f=u.getFirstChild();W(f)?f.select(0,0):u.select(0,0)}else u.selectNext(0,0);t.current=!0}}function mA(n,e,t,r,i){const s=dv(K());if(!s)return;const o=If(s),a=parseInt((o==null?void 0:o.getNumber())??"1",10),l=wv(s),c=l==null?void 0:l.getNumber(),u=parseInt(c??"0",10),f=c?Df(t,c):t===u;if(i.current=!!(o&&a!==e||!f),i.current){const d={book:n,chapterNum:a,verseNum:u};c!=null&&u.toString()!==c&&(d.verse=c),r(d)}}function yA(n){return bn(n)?`${n.__code}`:Ef(n)?`${n.__marker} "${n.__number}"`:Te(n)?`${n.__marker}`:Po(n)?`${n.__marker} "${n.__number}"`:Sr(n)?`${n.__caller}`:fs(n)?`${n.__marker} "${n.__number}"`:ge(n)?`${n.__marker} "${n.__caller}"`+(n.__isCollapsed?" (collapsed)":" (expanded)"):dt(n)?`${n.__marker}`:rt(n)?`ids: [ ${JSON.stringify(n.getTypedIDs())} ]`:$f(n)?`${n.__marker} "${n.__number}"`:""}function _A(){const[n]=pe();return v.jsx(y0,{viewClassName:"tree-view-output",treeTypeButtonClassName:"debug-treetype-button",timeTravelPanelClassName:"debug-timetravel-panel",timeTravelButtonClassName:"debug-timetravel-button",timeTravelPanelSliderClassName:"debug-timetravel-panel-slider",timeTravelPanelButtonClassName:"debug-timetravel-panel-button",customPrintNode:yA,editor:n})}const Fv=x.createContext(null),Jg=4;function bA({children:n,className:e,onClick:t,title:r}){const i=x.useRef(null),s=x.useContext(Fv);if(s===null)throw new Error("DropDownItem must be used within a DropDown");const{registerItem:o}=s;return x.useEffect(()=>{i&&i.current&&o(i)},[i,o]),v.jsx("button",{className:e,onClick:t,ref:i,title:r,type:"button",children:n})}function vA({children:n,dropDownRef:e,onClose:t}){const[r,i]=x.useState(),[s,o]=x.useState(),a=x.useCallback(u=>{i(f=>f?[...f,u]:[u])},[i]),l=u=>{if(!r)return;const f=u.key;["Escape","ArrowUp","ArrowDown","Tab"].includes(f)&&u.preventDefault(),f==="Escape"||f==="Tab"?t():f==="ArrowUp"?o(d=>{if(!d)return r[0];const h=r.indexOf(d)-1;return r[h===-1?r.length-1:h]}):f==="ArrowDown"&&o(d=>d?r[r.indexOf(d)+1]:r[0])},c=x.useMemo(()=>({registerItem:a}),[a]);return x.useEffect(()=>{r&&!s&&o(r[0]),s&&s.current&&s.current.focus()},[r,s]),v.jsx(Fv.Provider,{value:c,children:v.jsx("div",{className:"dropdown",ref:e,onKeyDown:l,children:n})})}function kA({disabled:n=!1,buttonLabel:e,buttonAriaLabel:t,buttonClassName:r,buttonIconClassName:i,children:s,stopCloseOnClickSelf:o}){const a=x.useRef(null),l=x.useRef(null),[c,u]=x.useState(!1),f=()=>{u(!1),l&&l.current&&l.current.focus()};return x.useEffect(()=>{const d=l.current,h=a.current;if(c&&d!==null&&h!==null){const{top:g,left:m}=d.getBoundingClientRect();h.style.top=`${g+d.offsetHeight+Jg}px`,h.style.left=`${Math.min(m,window.innerWidth-h.offsetWidth-20)}px`}},[a,l,c]),x.useEffect(()=>{const d=l.current;if(d!==null&&c){const h=g=>{const m=g.target;o&&a.current&&a.current.contains(m)||d.contains(m)||u(!1)};return document.addEventListener("click",h),()=>{document.removeEventListener("click",h)}}return()=>{}},[a,l,c,o]),x.useEffect(()=>{const d=()=>{if(c){const h=l.current,g=a.current;if(h!==null&&g!==null){const{top:m}=h.getBoundingClientRect(),y=m+h.offsetHeight+Jg;y!==g.getBoundingClientRect().top&&(g.style.top=`${y}px`)}}};return document.addEventListener("scroll",d),()=>{document.removeEventListener("scroll",d)}},[l,a,c]),v.jsxs(v.Fragment,{children:[v.jsxs("button",{type:"button",disabled:n,"aria-label":t||e,className:r,onClick:()=>u(!c),ref:l,children:[i&&v.jsx("span",{className:i}),e&&v.jsx("span",{className:"text dropdown-button-text",children:e}),v.jsx("i",{className:"chevron-down"})]}),c&&Ot.createPortal(v.jsx(vA,{dropDownRef:a,onClose:f,children:s}),document.body)]})}const vd={m:"m - Paragraph - Margin - No First Line Indent",ms:"ms - Heading - Major Section Level 1",nb:"nb - Paragraph - No Break with Previous Paragraph",p:"p - Paragraph - Normal - First Line Indent",pi:"pi - Paragraph - Indented - Level 1 - First Line Indent",q1:"q1 - Poetry - Indent Level 1",q2:"q2 - Poetry - Indent Level 2",r:"r - Heading - Parallel References",s:"s - Heading - Section Level 1"},kd={...vd,ide:"ide - File - Encoding",h:"h - File - Header",h1:"h1 - File - Header",h2:"h2 - File - Left Header",h3:"h3 - File - Right Header",toc1:"toc1 - File - Long Table of Contents Text",toc2:"toc2 - File - Short Table of Contents Text",toc3:"toc3 - File - Book Abbreviation",cl:"cl - Chapter - Publishing Label",mt:"mt - Title - Major Title Level 1",mt1:"mt1 - Title - Major Title Level 1",mt2:"mt2 - Title - Major Title Level 2",mt3:"mt3 - Title - Major Title Level 3",mt4:"mt4 - Title - Major Title Level 4",ms1:"ms1 - Heading - Major Section Level 1",ms2:"ms2 - Heading - Major Section Level 2",ms3:"ms3 - Heading - Major Section Level 3",b:"b - Poetry - Stanza Break (Blank Line)"};function wA({editorRef:n,blockMarker:e,disabled:t=!1}){return v.jsx(kA,{disabled:t,buttonClassName:"toolbar-item block-controls",buttonIconClassName:"icon block-marker "+xA(e),buttonLabel:CA(e),buttonAriaLabel:"Formatting options for block type",children:Object.keys(vd).map(r=>v.jsxs(bA,{className:"item block-marker "+SA(e===r),onClick:()=>{var i;return(i=n.current)==null?void 0:i.formatPara(r)},children:[v.jsx("i",{className:"icon block-marker "+r}),v.jsx("span",{className:"text usfm_"+r,children:vd[r]})]},r))})}function xA(n){return n&&n in kd?n:"ban"}function CA(n){return n&&n in kd?kd[n]:"No Style"}function SA(n){return n?"active dropdown-item-active":""}function Vg(){return v.jsx("div",{className:"divider"})}const TA=x.forwardRef(function({editorRef:n,isReadonly:e=!1,onStateChange:t},r){const[i]=pe(),[s,o]=x.useState(i),[a,l]=x.useState(),[c,u]=x.useState(!1),[f,d]=x.useState(!1),h=x.useCallback((g,m,y)=>{u(g),d(m),l(y),t==null||t(g,m,y)},[t]);return x.useEffect(()=>i.registerCommand(mr,(g,m)=>(o(m),!1),Ai),[i]),v.jsxs(v.Fragment,{children:[v.jsx(Pv,{onStateChange:h}),v.jsxs("div",{className:"toolbar",children:[v.jsx("button",{disabled:!c||e,onClick:()=>{s.dispatchCommand(vo,void 0)},title:Wu?"Undo (⌘Z)":"Undo (Ctrl+Z)",type:"button",className:"toolbar-item spaced","aria-label":"Undo",children:v.jsx("i",{className:"format undo"})}),v.jsx("button",{disabled:!f||e,onClick:()=>{s.dispatchCommand(ko,void 0)},title:Wu?"Redo (⌘Y)":"Redo (Ctrl+Y)",type:"button",className:"toolbar-item","aria-label":"Redo",children:v.jsx("i",{className:"format redo"})}),v.jsx(Vg,{}),s===i&&v.jsxs(v.Fragment,{children:[v.jsx(wA,{editorRef:n,blockMarker:a,disabled:e}),v.jsx(Vg,{})]}),v.jsx("div",{ref:r,className:"end-container"})]})]})}),Gg={namespace:"platformEditor",theme:Lv,editable:!0,editorState:void 0,onError(n){throw n},nodes:[tt,...BE]},EA=hs(),NA={},MA={};function AA(){return v.jsx("div",{className:"editor-placeholder",children:"Enter some Scripture..."})}const qv=x.forwardRef(function({defaultUsj:n,scrRef:e,onScrRefChange:t,onSelectionChange:r,onUsjChange:i,onStateChange:s,options:o,logger:a,children:l},c){const u=x.useRef(null),f=x.useRef(null),d=x.useRef(null),h=x.useRef(n),g=x.useRef(),[m,y]=x.useState(n),[b,_]=x.useState(0),{isReadonly:w=!1,hasExternalUI:T=!1,hasSpellCheck:O=!1,textDirection:M="ltr",markerMenuTrigger:j="\\",view:A=EA,nodes:$=NA,debug:B=!1}=o??MA;Gg.editable=!w,_u.initialize(a),x.useImperativeHandle(c,()=>({focus(){var N;(N=u.current)==null||N.focus()},undo(){var N;(N=u.current)==null||N.dispatchCommand(vo,void 0)},redo(){var N;(N=u.current)==null||N.dispatchCommand(ko,void 0)},cut(){var N;(N=u.current)==null||N.dispatchCommand(ii,null)},copy(){var N;(N=u.current)==null||N.dispatchCommand(yr,null)},paste(){u.current&&Jf(u.current)},pastePlainText(){u.current&&Vf(u.current)},getUsj(){return h.current},setUsj(N){if(!Rn(h.current,N)){h.current=N;const S=Rn(m,N);y(N),S&&_(R=>R+1)}},applyUpdate(N,S="remote"){var R,L;(R=u.current)==null||R.update(()=>{S==="remote"&&Yy(dd),uN(N,A,$,a)},{discrete:!0});const D=(L=u.current)==null?void 0:L.getEditorState();if(!D)return;const z=_u.deserializeEditorState(D);if(z){const H=!Rn(h.current,z);if(H&&(h.current=z),H||!Rn(m,z)){const V=Cg(N,D);i==null||i(z,N,S,V)}}},replaceEmbedUpdate(N,S){var R;const L=(R=u.current)==null?void 0:R.read(()=>yE(N,S));L&&this.applyUpdate(L)},getSelection(){var N;return(N=u.current)==null?void 0:N.read(yv)},setSelection(N){var S;(S=u.current)==null||S.update(()=>{const R=Ff(N);R!==void 0&&it(R)},{tag:Hb})},addAnnotation(N,S,R){var L;(L=f.current)==null||L.addAnnotation(N,mg(S),R)},removeAnnotation(N,S){var R;(R=f.current)==null||R.removeAnnotation(mg(N),S)},formatPara(N){var S;(S=u.current)==null||S.update(()=>{const R=K();q(R)&&Ix(R,()=>mo(N))})},getElementByKey(N){var S;return(S=u.current)==null?void 0:S.read(()=>{var R;return((R=u.current)==null?void 0:R.getElementByKey(N))??void 0})},insertNote(N,S,R){var L;(L=u.current)==null||L.update(()=>{const D=nE(N,S,R,e,A,$,a);D&&!D.getIsCollapsed()&&(g.current=D.getKey())})},selectNote(N){var S;(S=u.current)==null||S.update(()=>{const R=wg(N);R&&(iE(R,A),R.getIsCollapsed()||(g.current=R.getKey()))})},getNoteOps(N){var S;return(S=u.current)==null?void 0:S.read(()=>{const R=wg(N);if(R)return zf(R)})},get toolbarEndRef(){return d}}));const C=x.useCallback((N,S,R,L)=>{if(sT.some(z=>R.has(z)))return;const D=_u.deserializeEditorState(N);if(D){const z=!Rn(h.current,D);if(z&&(h.current=D),z||!Rn(m,D)){const H=R.has(dd)?"remote":"local",V=Cg(L,N);i==null||i(D,L,H,V)}}},[m,i]);return v.jsxs(z_,{initialConfig:Gg,children:[v.jsx(UN,{isEditable:!w}),v.jsxs("div",{className:"editor-container",children:[T?v.jsx(Pv,{onStateChange:s}):v.jsx("div",{className:"editor-toolbar-container"+(w?"-readonly":"-editable"),children:v.jsx(TA,{ref:d,editorRef:c,isReadonly:w,onStateChange:s})}),v.jsxs("div",{className:"editor-inner",children:[v.jsx(V_,{editorRef:u}),v.jsx(q0,{contentEditable:v.jsx(J_,{className:`editor-input usfm ${CM(A).join(" ")}`,spellCheck:O}),placeholder:v.jsx(AA,{}),ErrorBoundary:G_}),v.jsx(Y_,{}),e&&t&&v.jsx(gA,{scrRef:e,onScrRefChange:t}),e&&v.jsx(pM,{trigger:j,scrRef:e,getMarkerAction:(N,S)=>oA(N,g,S,A)}),v.jsx(pA,{options:{view:A,nodes:$},editedUsjRef:h,usj:m,setUsj:y}),v.jsx(zN,{scripture:m,nodeOptions:$,editorAdaptor:bd,viewOptions:A,logger:a},b),v.jsx(nM,{onChange:r}),v.jsx(lN,{onChange:C,ignoreSelectionChange:!0,ignoreHistoryMergeTagChange:!0}),v.jsx(aN,{ref:f,logger:a}),v.jsx(TN,{viewOptions:A}),v.jsx($N,{}),v.jsx(jN,{}),v.jsx(DN,{logger:a}),v.jsx(BN,{}),v.jsx(WN,{expandedNoteKeyRef:g,nodeOptions:$,viewOptions:A,logger:a}),v.jsx(rM,{}),v.jsx(oM,{textDirection:M}),v.jsx(cM,{}),l]}),B&&v.jsx(_A,{})]})]})}),ps=x.forwardRef(function(n,e){const{children:t,...r}=n;return v.jsx(qv,{ref:e,...r})});function Bv(){return Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5)}function Al(n,e,t,r,i){return{author:e,content:n,deleted:i===void 0?!1:i,id:t===void 0?Bv():t,timeStamp:r===void 0?performance.timeOrigin+performance.now():r,type:"comment"}}function Uv(n,e,t){return{comments:e,id:t===void 0?Bv():t,quote:n,type:"thread"}}function Yg(n){return{comments:Array.from(n.comments),id:n.id,quote:n.quote,type:"thread"}}function OA(n){return{author:n.author,content:"[Deleted Comment]",deleted:!0,id:n.id,timeStamp:n.timeStamp,type:"comment"}}function bu(n){const e=n._changeListeners;for(const t of e)t()}class $A{constructor(e,t){Z(this,"_editor"),Z(this,"_comments"),Z(this,"_changeListeners"),Z(this,"_collabProvider"),Z(this,"logger"),this._comments=[],this._editor=e,this.logger=t,this._collabProvider=null,this._changeListeners=new Set}isCollaborative(){return this._collabProvider!==null}getComments(){return this._comments}setComments(e){this._comments=e,bu(this)}addComment(e,t,r){const i=Array.from(this._comments),s=this._getCollabComments();if(t!==void 0&&e.type==="comment")for(let o=0;o<i.length;o++){const a=i[o];if(a.type==="thread"&&a.id===t.id){const l=Yg(a);i.splice(o,1,l);const c=r!==void 0?r:l.comments.length;if(this.isCollaborative()&&s!==null){const u=s.get(o).get("comments");this._withRemoteTransaction(()=>{const f=this._createCollabSharedMap(e);u.insert(c,[f])})}l.comments.splice(c,0,e);break}}else{const o=r!==void 0?r:i.length;this.isCollaborative()&&s!==null&&this._withRemoteTransaction(()=>{const a=this._createCollabSharedMap(e);s.insert(o,[a])}),i.splice(o,0,e)}this._comments=i,bu(this)}deleteCommentOrThread(e,t){const r=Array.from(this._comments),i=this._getCollabComments();let s=null;if(t!==void 0)for(let o=0;o<r.length;o++){const a=r[o];if(a.type==="thread"&&a.id===t.id){const l=Yg(a);r.splice(o,1,l);const c=l.comments;if(s=c.indexOf(e),this.isCollaborative()&&i!==null){const u=i.get(o).get("comments"),f=s;this._withRemoteTransaction(()=>{u.delete(f)})}c.splice(s,1);break}}else s=r.indexOf(e),this.isCollaborative()&&i!==null&&this._withRemoteTransaction(()=>{i.delete(s)}),r.splice(s,1);return this._comments=r,bu(this),e.type==="comment"?{index:s,markedComment:OA(e)}:null}registerOnChange(e){const t=this._changeListeners;return t.add(e),()=>{t.delete(e)}}_withRemoteTransaction(e){const t=this._collabProvider;t!==null&&t.doc.transact(e,this)}_withLocalTransaction(e){const t=this._collabProvider;try{this._collabProvider=null,e()}finally{this._collabProvider=t}}_getCollabComments(){const e=this._collabProvider;return e!==null?e.doc.get("comments",Ur):null}_createCollabSharedMap(e){const t=new Hi,r=e.type,i=e.id;if(t.set("type",r),t.set("id",i),r==="comment")t.set("author",e.author),t.set("content",e.content),t.set("deleted",e.deleted),t.set("timeStamp",e.timeStamp);else{t.set("quote",e.quote);const s=new Ur;e.comments.forEach((o,a)=>{const l=this._createCollabSharedMap(o);s.insert(a,[l])}),t.set("comments",s)}return t}registerCollaboration(e){this._collabProvider=e;const t=this._getCollabComments(),r=()=>{e.connect()},i=()=>{try{e.disconnect()}catch{}},s=this._editor.registerCommand(Y1,a=>{var l,c;return r!==void 0&&i!==void 0&&(a?((l=this.logger)==null||l.info("Comments connected!"),r()):((c=this.logger)==null||c.info("Comments disconnected!"),i())),!1},oi),o=(a,l)=>{if(l.origin!==this){for(const c of a)if(c instanceof Ib){const u=c.target,f=c.delta;let d=0;for(const h of f){const g=h.insert,m=h.retain,y=h.delete,b=u.parent,_=u===t?void 0:b instanceof Hi&&this._comments.find(w=>w.id===b.get("id"));if(Array.isArray(g)){const w=d;g.slice().reverse().forEach(T=>{const O=T.get("id"),M=T.get("type")==="thread"?Uv(T.get("quote"),T.get("comments").toArray().map(j=>Al(j.get("content"),j.get("author"),j.get("id"),j.get("timeStamp"),j.get("deleted"))),O):Al(T.get("content"),T.get("author"),O,T.get("timeStamp"),T.get("deleted"));this._withLocalTransaction(()=>{this.addComment(M,_,w)})})}else if(typeof m=="number")d+=m;else if(typeof y=="number")for(let w=0;w<y;w++){const T=_===void 0||_===!1?this._comments[d]:_.comments[d];this._withLocalTransaction(()=>{this.deleteCommentOrThread(T,_)}),d++}}}}};return t===null?()=>null:(t.observeDeep(o),r(),()=>{t.unobserveDeep(o),s(),this._collabProvider=null})}}function IA(n){const[e,t]=x.useState(n.getComments());return x.useEffect(()=>n.registerOnChange(()=>{t(n.getComments())}),[n]),e}function PA({onClose:n,children:e,title:t,closeOnClickOutside:r}){const i=x.useRef(null);return x.useEffect(()=>{i.current!==null&&i.current.focus()},[]),x.useEffect(()=>{let s=null;const o=c=>{c.key==="Escape"&&n()},a=c=>{const u=c.target;i.current!==null&&!i.current.contains(u)&&r&&n()},l=i.current;return l!==null&&(s=l.parentElement,s!==null&&s.addEventListener("click",a)),window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o),s!==null&&(s==null||s.removeEventListener("click",a))}},[r,n]),v.jsx("div",{className:"Modal__overlay",role:"dialog",children:v.jsxs("div",{className:"Modal__modal",tabIndex:-1,ref:i,children:[v.jsx("h2",{className:"Modal__title",children:t}),v.jsx("button",{className:"Modal__closeButton","aria-label":"Close modal",type:"button",onClick:n,children:"X"}),v.jsx("div",{className:"Modal__content",children:e})]})})}function RA({onClose:n,children:e,title:t,closeOnClickOutside:r=!1}){return Ot.createPortal(v.jsx(PA,{onClose:n,title:t,closeOnClickOutside:r,children:e}),document.body)}function zv(){const[n,e]=x.useState(null),t=x.useCallback(()=>{e(null)},[]),r=x.useMemo(()=>{if(n===null)return null;const{title:s,content:o,closeOnClickOutside:a}=n;return v.jsx(RA,{onClose:t,title:s,closeOnClickOutside:a,children:o})},[n,t]),i=x.useCallback((s,o,a=!1)=>{e({closeOnClickOutside:a,content:o(t),title:s})},[t]);return[r,i]}const jA={...Lv,paragraph:"CommentEditorTheme__paragraph"};function DA(...n){return n.filter(Boolean).join(" ")}function gr({"data-test-id":n,children:e,className:t,onClick:r,disabled:i,small:s,title:o}){return v.jsx("button",{disabled:i,className:DA("Button__root",i&&"Button__disabled",s&&"Button__small",t),onClick:r,title:o,"aria-label":o,...n&&{"data-test-id":n},children:e})}function LA({className:n}){return v.jsx(J_,{className:n||"ContentEditable__root"})}function FA({children:n,className:e}){return v.jsx("div",{className:e||"Placeholder__root",children:n})}const Xg=ie("INSERT_INLINE_COMMAND");function qA({anchorKey:n,editor:e,showComments:t,onAddComment:r}){const i=x.useRef(null),s=x.useCallback(()=>{const o=i.current,a=e.getRootElement(),l=e.getElementByKey(n);if(o!==null&&a!==null&&l!==null){const{right:c}=a.getBoundingClientRect(),{top:u}=l.getBoundingClientRect();o.style.left=`${c-20}px`,o.style.top=`${u-30}px`}},[n,e]);return x.useEffect(()=>(window.addEventListener("resize",s),()=>{window.removeEventListener("resize",s)}),[e,s]),x.useLayoutEffect(()=>{s()},[n,e,t,s]),v.jsx("div",{className:"CommentPlugin_AddCommentBox",ref:i,children:v.jsx("button",{className:"CommentPlugin_AddCommentBox_button",onClick:r,children:v.jsx("i",{className:"icon add-comment"})})})}function BA({onEscape:n}){const[e]=pe();return x.useEffect(()=>e.registerCommand(Il,t=>n(t),qa),[e,n]),null}function Wv({className:n,autoFocus:e,onEscape:t,onChange:r,editorRef:i,placeholder:s="Type a comment..."}){return v.jsx(z_,{initialConfig:{namespace:"Commenting",nodes:[],onError:o=>{throw o},theme:jA},children:v.jsxs("div",{className:"CommentPlugin_CommentInputBox_EditorContainer",children:[v.jsx(sS,{contentEditable:v.jsx(LA,{className:n}),placeholder:v.jsx(FA,{children:s}),ErrorBoundary:G_}),v.jsx(Q0,{onChange:r}),v.jsx(Y_,{}),e!==!1&&v.jsx(J0,{}),v.jsx(BA,{onEscape:t}),v.jsx(G0,{}),i!==void 0&&v.jsx(V_,{editorRef:i})]})})}function Kv(n,e){return x.useCallback((t,r)=>{t.read(()=>{n(W_()),e(!K_(r.isComposing(),!0))})},[e,n])}function UA({editor:n,cancelAddComment:e,submitAddComment:t}){const[r,i]=x.useState(""),[s,o]=x.useState(!1),a=x.useRef(null),l=x.useMemo(()=>({container:document.createElement("div"),elements:[]}),[]),c=x.useRef(null),u=Jv(),f=x.useCallback(()=>{n.getEditorState().read(()=>{const m=K();if(q(m)){c.current=m.clone();const y=m.anchor,b=m.focus,_=Nx(n,y.getNode(),y.offset,b.getNode(),b.offset),w=a.current;if(_!==null&&w!==null){const{left:T,bottom:O,width:M}=_.getBoundingClientRect(),j=Mx(n,_);let A=j.length===1?T+M/2-125:T-125;A<10&&(A=10),w.style.left=`${A}px`,w.style.top=`${O+20+(window.pageYOffset||document.documentElement.scrollTop)}px`;const $=j.length,{container:B}=l,C=l.elements,N=C.length;for(let S=0;S<$;S++){const R=j[S];let L=C[S];L===void 0&&(L=document.createElement("span"),C[S]=L,B.appendChild(L));const D=`position:absolute;top:${R.top+(window.pageYOffset||document.documentElement.scrollTop)}px;left:${R.left}px;height:${R.height}px;width:${R.width}px;background-color:rgba(255, 212, 0, 0.3);pointer-events:none;z-index:5;`;L.style.cssText=D}for(let S=N-1;S>=$;S--){const R=C[S];B.removeChild(R),C.pop()}}}})},[n,l]);x.useLayoutEffect(()=>{f();const m=l.container,y=document.body;return y!==null?(y.appendChild(m),()=>{y.removeChild(m)}):()=>{}},[l.container,f]),x.useEffect(()=>(window.addEventListener("resize",f),()=>{window.removeEventListener("resize",f)}),[f]);const d=m=>(m.preventDefault(),e(),!0),h=()=>{if(s){let m=n.getEditorState().read(()=>{const y=c.current;return y?y.getTextContent():""});m.length>100&&(m=m.slice(0,99)+"…"),t(Uv(m,[Al(r,u)]),!0,void 0,c.current),c.current=null}},g=Kv(i,o);return v.jsxs("div",{className:"CommentPlugin_CommentInputBox",ref:a,children:[v.jsx(Wv,{className:"CommentPlugin_CommentInputBox_Editor",onEscape:d,onChange:g}),v.jsxs("div",{className:"CommentPlugin_CommentInputBox_Buttons",children:[v.jsx(gr,{onClick:e,className:"CommentPlugin_CommentInputBox_Button",children:"Cancel"}),v.jsx(gr,{onClick:h,disabled:!s,className:"CommentPlugin_CommentInputBox_Button primary",children:"Comment"})]})]})}function zA({submitAddComment:n,thread:e,placeholder:t}){const[r,i]=x.useState(""),[s,o]=x.useState(!1),a=x.useRef(null),l=Jv(),c=Kv(i,o);return v.jsxs(v.Fragment,{children:[v.jsx(Wv,{className:"CommentPlugin_CommentsPanel_Editor",autoFocus:!1,onEscape:()=>!0,onChange:c,editorRef:a,placeholder:t}),v.jsx(gr,{className:"CommentPlugin_CommentsPanel_SendButton",onClick:()=>{if(s){n(Al(r,l),!1,e);const u=a.current;u!==null&&u.dispatchCommand(zd,void 0)}},disabled:!s,children:v.jsx("i",{className:"send"})})]})}function Hv({commentOrThread:n,deleteCommentOrThread:e,onClose:t,thread:r=void 0}){return v.jsxs(v.Fragment,{children:["Are you sure you want to delete this ",n.type,"?",v.jsxs("div",{className:"Modal__content",children:[v.jsx(gr,{onClick:()=>{e(n,r),t()},children:"Delete"})," ",v.jsx(gr,{onClick:()=>{t()},children:"Cancel"})]})]})}function Qg({comment:n,deleteComment:e,thread:t,rtf:r}){const i=Math.round((n.timeStamp-(performance.timeOrigin+performance.now()))/1e3),s=Math.round(i/60),[o,a]=zv();return v.jsxs("li",{className:"CommentPlugin_CommentsPanel_List_Comment",children:[v.jsxs("div",{className:"CommentPlugin_CommentsPanel_List_Details",children:[v.jsx("span",{className:"CommentPlugin_CommentsPanel_List_Comment_Author",children:n.author}),v.jsxs("span",{className:"CommentPlugin_CommentsPanel_List_Comment_Time",children:["· ",i>-10?"Just now":r.format(s,"minute")]})]}),v.jsx("p",{className:n.deleted?"CommentPlugin_CommentsPanel_DeletedComment":"",children:n.content}),!n.deleted&&v.jsxs(v.Fragment,{children:[v.jsx(gr,{onClick:()=>{a("Delete Comment",l=>v.jsx(Hv,{commentOrThread:n,deleteCommentOrThread:e,thread:t,onClose:l}))},className:"CommentPlugin_CommentsPanel_List_DeleteButton",children:v.jsx("i",{className:"delete"})}),o]})]})}function WA({activeIDs:n,comments:e,deleteCommentOrThread:t,listRef:r,submitAddComment:i,markNodeMap:s}){const[o]=pe(),[a,l]=x.useState(0),[c,u]=zv(),f=x.useMemo(()=>new Intl.RelativeTimeFormat("en",{localeMatcher:"best fit",numeric:"auto",style:"short"}),[]);return x.useEffect(()=>{const d=setTimeout(()=>{l(a+1)},1e4);return()=>{clearTimeout(d)}},[a]),v.jsx("ul",{className:"CommentPlugin_CommentsPanel_List",ref:r,children:e.map(d=>{const h=d.id;return d.type==="thread"?v.jsxs("li",{onClick:()=>{const g=s.get(h);if(g!==void 0&&(n===null||n.indexOf(h)===-1)){const m=document.activeElement;o.update(()=>{const y=Array.from(g)[0],b=ce(y);rt(b)&&b.selectStart()},{onUpdate(){m!==null&&m.focus()}})}},className:`CommentPlugin_CommentsPanel_List_Thread ${s.has(h)?"interactive":""} ${n.indexOf(h)===-1?"":"active"}`,children:[v.jsxs("div",{className:"CommentPlugin_CommentsPanel_List_Thread_QuoteBox",children:[v.jsxs("blockquote",{className:"CommentPlugin_CommentsPanel_List_Thread_Quote",children:["> ",v.jsx("span",{children:d.quote})]}),v.jsx(gr,{onClick:()=>{u("Delete Thread",g=>v.jsx(Hv,{commentOrThread:d,deleteCommentOrThread:t,onClose:g}))},className:"CommentPlugin_CommentsPanel_List_DeleteButton",children:v.jsx("i",{className:"delete"})}),c]}),v.jsx("ul",{className:"CommentPlugin_CommentsPanel_List_Thread_Comments",children:d.comments.map(g=>v.jsx(Qg,{comment:g,deleteComment:t,thread:d,rtf:f},g.id))}),v.jsx("div",{className:"CommentPlugin_CommentsPanel_List_Thread_Editor",children:v.jsx(zA,{submitAddComment:i,thread:d,placeholder:"Reply to comment..."})})]},h):v.jsx(Qg,{comment:d,deleteComment:t,rtf:f},h)})})}function KA({activeIDs:n,deleteCommentOrThread:e,comments:t,submitAddComment:r,markNodeMap:i}){const s=x.useRef(null),o=t.length===0;return v.jsxs("div",{className:"CommentPlugin_CommentsPanel",children:[v.jsx("h2",{className:"CommentPlugin_CommentsPanel_Heading",children:"Comments"}),o?v.jsx("div",{className:"CommentPlugin_CommentsPanel_Empty",children:"No Comments"}):v.jsx(WA,{activeIDs:n,comments:t,deleteCommentOrThread:e,listRef:s,submitAddComment:r,markNodeMap:i})]})}function Jv(){const n=Z_(),{yjsDocMap:e,name:t}=n;return e.has("comments")?t:"Scripture User"}function HA({providerFactory:n,setCommentStore:e,onChange:t,showCommentsContainerRef:r,commentContainerRef:i,logger:s}){const o=Z_(),[a]=pe(),l=x.useMemo(()=>{const A=new $A(a,s);return t&&A.registerOnChange(t),e==null||e(A),A},[a,s,t,e]),c=IA(l),u=x.useMemo(()=>new Map,[]),[f,d]=x.useState(),[h,g]=x.useState([]),[m,y]=x.useState(!1),[b,_]=x.useState(!1),{yjsDocMap:w}=o;x.useEffect(()=>{if(n){const A=n("comments",w);return l.registerCollaboration(A)}return()=>{}},[l,n,w]);const T=x.useCallback(()=>{a.update(()=>{const A=K();A!==null&&(A.dirty=!0)}),y(!1)},[a]),O=x.useCallback((A,$)=>{if(A.type==="comment"){const B=l.deleteCommentOrThread(A,$);if(!B)return;const{markedComment:C,index:N}=B;l.addComment(C,$,N)}else{l.deleteCommentOrThread(A);const B=$!==void 0?$.id:A.id,C=u.get(B);C!==void 0&&setTimeout(()=>{a.update(()=>{for(const N of C){const S=ce(N);rt(S)&&(S.deleteID(ir,B),S.hasNoIDsForEveryType()&&fv(S))}})})}},[l,a,u]),M=x.useCallback((A,$,B,C)=>{l.addComment(A,B),$&&(a.update(()=>{q(C)&&hv(C,ir,A.id)}),y(!1))},[l,a]);x.useEffect(()=>{const A=[];for(const $ of h){const B=u.get($);if(B!==void 0)for(const C of B){const N=a.getElementByKey(C);N!==null&&(N.classList.add("selected"),A.push(N),_(!0))}}return()=>{for(const $ of A)$.classList.remove("selected")}},[h,a,u]),x.useEffect(()=>{if(!a.hasNodes([tt]))throw new Error("CommentPlugin: TypedMarkNode not registered on editor!");const A=new Map;return Ue(l_(a,tt,$=>yo($.getTypedIDs()),($,B)=>{for(const[C,N]of Object.entries($.getTypedIDs()))N.forEach(S=>{B.addID(C,S)})}),a.registerMutationListener(tt,$=>{a.getEditorState().read(()=>{for(const[B,C]of $){const N=ce(B);let S=[];C==="destroyed"?S=A.get(B)??[]:rt(N)&&(S=N.getTypedIDs()[ir]??[]);for(const R of S){let L=u.get(R);A.set(B,S),C==="destroyed"?L!==void 0&&(L.delete(B),L.size===0&&u.delete(R)):(L===void 0&&(L=new Set,u.set(R,L)),L.has(B)||L.add(B))}}})},{skipInitialization:!1}),a.registerUpdateListener(({editorState:$,tags:B})=>{$.read(()=>{const C=K();let N=!1,S=!1;if(q(C)){const R=C.anchor.getNode();if(W(R)){const L=zT(R,ir,C.anchor.offset)??[];L!==null&&(g(L),N=!0),C.isCollapsed()||(d(R.getKey()),S=!0)}}N||g(R=>R.length===0?R:[]),S||d(null),!B.has("collaboration")&&q(C)&&y(!1)})}),a.registerCommand(Xg,()=>{const $=window.getSelection();return $!==null&&$.removeAllRanges(),y(!0),!0},ne))},[a,u]);const j=()=>{a.dispatchCommand(Xg,void 0)};return v.jsxs(v.Fragment,{children:[m&&Ot.createPortal(v.jsx(UA,{editor:a,cancelAddComment:T,submitAddComment:M}),document.body),f!=null&&!m&&Ot.createPortal(v.jsx(qA,{anchorKey:f,editor:a,showComments:b,onAddComment:j}),document.body),r!==null&&Ot.createPortal(v.jsx(gr,{className:`CommentPlugin_ShowCommentsButton ${b?"active":""}`,onClick:()=>_(!b),title:b?"Hide Comments":"Show Comments",children:v.jsx("i",{className:"comments"})}),(r==null?void 0:r.current)??document.body),b&&Ot.createPortal(v.jsx(KA,{comments:c,submitAddComment:M,deleteCommentOrThread:O,activeIDs:h,markNodeMap:u}),(i==null?void 0:i.current)??document.body)]})}function JA(){const n=x.useRef(void 0),e=x.useCallback(t=>{n.current=t},[]);return[n,e]}function VA(n,e){var t,r;const i=((t=e.current)==null?void 0:t.getComments())??[],s=i==null?void 0:i.map(a=>a.id),o=n.map(a=>{const l=s.findIndex(c=>c===a);return l!==void 0&&l>=0?i[l]:{comments:[{author:"unknown",content:"Comment not found",deleted:!1,id:"",timeStamp:0,type:"comment"}],id:a,quote:"",type:"thread"}});i.forEach(a=>{n.includes(a.id)||o.push(a)}),o&&((r=e.current)==null||r.setComments(o))}function GA(n,e){x.useEffect(()=>{var t;n.options??(n.options={}),(t=n.options).nodes??(t.nodes={}),n.options.nodes.addMissingComments=r=>{VA(r,e)}},[e,n])}x.forwardRef(function(n,e){const t=x.useRef(null),r=x.useRef(!0),i=x.useRef(null),[s,o]=x.useState(null),{children:a,onCommentChange:l,onUsjChange:c,showCommentsContainerRef:u,...f}=n,{options:{isReadonly:d}={}}=n,[h,g]=JA();GA(f,h),x.useImperativeHandle(e,()=>({focus(){var b;(b=t.current)==null||b.focus()},undo(){var b;(b=t.current)==null||b.undo()},redo(){var b;(b=t.current)==null||b.redo()},cut(){var b;(b=t.current)==null||b.cut()},copy(){var b;(b=t.current)==null||b.copy()},paste(){var b;(b=t.current)==null||b.paste()},pastePlainText(){var b;(b=t.current)==null||b.pastePlainText()},getUsj(){var b;return(b=t.current)==null?void 0:b.getUsj()},setUsj(b){var _;(_=t.current)==null||_.setUsj(b)},applyUpdate(b,_){var w;(w=t.current)==null||w.applyUpdate(b,_)},replaceEmbedUpdate(b,_){var w;return(w=t.current)==null?void 0:w.replaceEmbedUpdate(b,_)},getSelection(){var b;return(b=t.current)==null?void 0:b.getSelection()},setSelection(b){var _;(_=t.current)==null||_.setSelection(b)},addAnnotation(b,_,w){var T;(T=t.current)==null||T.addAnnotation(b,_,w)},removeAnnotation(b,_){var w;(w=t.current)==null||w.removeAnnotation(b,_)},formatPara(b){var _;(_=t.current)==null||_.formatPara(b)},getElementByKey(b){var _;return(_=t.current)==null?void 0:_.getElementByKey(b)},insertNote(b,_,w){var T;(T=t.current)==null||T.insertNote(b,_,w)},selectNote(b){var _;(_=t.current)==null||_.selectNote(b)},getNoteOps(b){var _;return(_=t.current)==null?void 0:_.getNoteOps(b)},setComments(b){var _;(_=h.current)==null||_.setComments(b),r.current=!0},get toolbarEndRef(){return s}}));const m=x.useCallback((b,_,w,T)=>{var O;if(!c)return;const M=(O=h.current)==null?void 0:O.getComments();c(b,M,_,w,T)},[h,c]),y=x.useCallback(()=>{var b;if(!l||r.current){r.current=!1;return}const _=(b=h.current)==null?void 0:b.getComments();l(_)},[h,r,l]);return x.useEffect(()=>{var b;return o(((b=t.current)==null?void 0:b.toolbarEndRef)??null),()=>o(null)},[]),v.jsxs(qv,{ref:t,onUsjChange:m,...f,children:[v.jsx(HA,{setCommentStore:g,onChange:y,showCommentsContainerRef:d?null:u??s,commentContainerRef:i,logger:f.logger}),v.jsx("div",{ref:i,className:"comment-container"})]})});const Yf=x.memo(function({viewMode:e,description:t,children:r}){const i=e==="story",s=x.useMemo(()=>!i||typeof t!="string"||!t.trim()?null:v.jsxs(dk,{className:"tw-w-full",children:[v.jsx(fk,{className:"tw-pb-2",children:v.jsx(hk,{className:"tw-text-sm tw-font-medium tw-text-muted-foreground",children:"Story Description"})}),v.jsx(pk,{className:"tw-pt-2",children:v.jsx(uk,{className:"tw-prose-sm tw-max-w-none tw-text-muted-foreground",markdown:t})})]}),[t,i]);return v.jsxs("div",{style:{display:"grid",gap:8},children:[r,s]})});Yf.__docgenInfo={description:"",methods:[],displayName:"CanvasWithDescription",props:{viewMode:{required:!1,tsType:{name:"string"},description:""},description:{required:!1,tsType:{name:"string"},description:""},children:{required:!0,tsType:{name:"ReactNode"},description:""}}};const wd={m:"m - Paragraph - Margin - No First Line Indent",ms:"ms - Heading - Major Section Level 1",nb:"nb - Paragraph - No Break with Previous Paragraph",p:"p - Paragraph - Normal - First Line Indent",pi:"pi - Paragraph - Indented - Level 1 - First Line Indent",q1:"q1 - Poetry - Indent Level 1",q2:"q2 - Poetry - Indent Level 2",r:"r - Heading - Parallel References",s:"s - Heading - Section Level 1"},Zg={...wd,ide:"ide - File - Encoding",h:"h - File - Header",h1:"h1 - File - Header",h2:"h2 - File - Left Header",h3:"h3 - File - Right Header",toc1:"toc1 - File - Long Table of Contents Text",toc2:"toc2 - File - Short Table of Contents Text",toc3:"toc3 - File - Book Abbreviation",cl:"cl - Chapter - Publishing Label",mt:"mt - Title - Major Title Level 1",mt1:"mt1 - Title - Major Title Level 1",mt2:"mt2 - Title - Major Title Level 2",mt3:"mt3 - Title - Major Title Level 3",mt4:"mt4 - Title - Major Title Level 4",ms1:"ms1 - Heading - Major Section Level 1",ms2:"ms2 - Heading - Major Section Level 2",ms3:"ms3 - Heading - Major Section Level 3",b:"b - Poetry - Stanza Break (Blank Line)"},em={m:ra,ms:xi,nb:ra,p:ra,pi:ra,q1:qc,q2:qc,r:xi,s:xi,ide:Nn,h:Nn,h1:Nn,h2:Nn,h3:Nn,toc1:Nn,toc2:Nn,toc3:Nn,cl:Nn,mt:xi,mt1:xi,mt2:Qf,mt3:Fc,mt4:Fc,ms1:xi,ms2:Qf,ms3:Fc,b:qc};function tm({blockMarker:n,className:e}){const t=n&&n in em?em[n]:Ak;return v.jsx(t,{className:e,size:16})}function Vv({editorRef:n,blockMarker:e}){return v.jsxs(Cd,{children:[v.jsx(Sd,{asChild:!0,children:v.jsxs(Ht,{variant:"outline",className:"","aria-label":"Formatting options for block type",children:[v.jsx(tm,{blockMarker:e,className:"tw-me-2"}),YA(e),v.jsx(_k,{className:"tw-ms-2"})]})}),v.jsx(Td,{children:Object.keys(wd).map(t=>v.jsxs(yk,{className:`item block-marker ${XA(e===t)}`,onClick:()=>{var r;return(r=n.current)==null?void 0:r.formatPara(t)},children:[v.jsx(tm,{blockMarker:t,className:"tw-me-2"}),v.jsx("span",{className:`text usfm_${t}`,children:wd[t]})]},t))})]})}function YA(n){return n&&n in Zg?Zg[n]:"No Style"}function XA(n){return n?"active dropdown-item-active":""}Vv.__docgenInfo={description:"",methods:[],displayName:"BlockFormatDropDown",props:{editorRef:{required:!0,tsType:{name:"MutableRefObject",elements:[{name:"union",raw:"EditorRef | null",elements:[{name:"EditorRef"},{name:"null"}]}],raw:"MutableRefObject<EditorRef | null>"},description:""},blockMarker:{required:!0,tsType:{name:"union",raw:"string | undefined",elements:[{name:"string"},{name:"undefined"}]},description:""}}};const QA={columns:{"platformScriptureEditor.edit":{label:"Edit",order:1},"platformScriptureEditor.insert":{label:"Insert",order:2}},groups:{"platformScriptureEditor.clipboard":{column:"platformScriptureEditor.edit",order:1},"platformScriptureEditor.insertNote":{column:"platformScriptureEditor.insert",order:1}},items:[{label:"Insert footnote",group:"platformScriptureEditor.insertNote",order:1,command:"platformScriptureEditor.insertFootnoteAtSelection",localizeNotes:""},{label:"Insert cross-reference",group:"platformScriptureEditor.insertNote",order:2,command:"platformScriptureEditor.insertCrossReferenceAtSelection",localizeNotes:""},{label:"Insert endnote",group:"platformScriptureEditor.insertNote",order:3,command:"platformScriptureEditor.insertEndnoteAtSelection",localizeNotes:""},{label:"Cut",group:"platformScriptureEditor.clipboard",order:1,command:"platformScriptureEditor.cut",localizeNotes:""},{label:"Copy",group:"platformScriptureEditor.clipboard",order:2,command:"platformScriptureEditor.copy",localizeNotes:""},{label:"Paste",group:"platformScriptureEditor.clipboard",order:3,command:"platformScriptureEditor.paste",localizeNotes:""},{label:"Paste as plain text",group:"platformScriptureEditor.clipboard",order:4,command:"platformScriptureEditor.pastePlainText",localizeNotes:""}]};function Gv({editorRef:n,scrRef:e,onScrRefChange:t,isReadonly:r=!1,canUndo:i=!1,canRedo:s=!1,blockMarker:o}){const a=()=>{var d;(d=n.current)==null||d.insertNote("f")},l=()=>{var d;(d=n.current)==null||d.insertNote("x")},c=()=>{var d;(d=n.current)==null||d.insertNote("fe")},u=d=>{var h,g,m,y;switch(d.command){case"platformScriptureEditor.insertFootnoteAtSelection":a();break;case"platformScriptureEditor.insertCrossReferenceAtSelection":l();break;case"platformScriptureEditor.insertEndnoteAtSelection":c();break;case"platformScriptureEditor.cut":(h=n.current)==null||h.cut();break;case"platformScriptureEditor.copy":(g=n.current)==null||g.copy();break;case"platformScriptureEditor.paste":(m=n.current)==null||m.paste();break;case"platformScriptureEditor.pastePlainText":(y=n.current)==null||y.pastePlainText();break;default:throw new Error(`Unknown onSelectProjectMenuItem command: ${d.command}`)}},f=()=>{};return v.jsx(mk,{onSelectProjectMenuItem:u,onSelectViewInfoMenuItem:f,projectMenuData:QA,className:"toolbar",startAreaChildren:v.jsxs(v.Fragment,{children:[v.jsx("div",{className:"tw-flex tw-h-full tw-items-center",children:v.jsx(gk,{scrRef:e,handleSubmit:t})}),!r&&v.jsxs(v.Fragment,{children:[v.jsx(Ht,{"aria-label":"Undo",title:"Undo",variant:"ghost",size:"icon",onClick:()=>{var d;return(d=n.current)==null?void 0:d.undo()},disabled:!i,children:v.jsx(Vk,{})}),v.jsx(Ht,{"aria-label":"Redo",title:"Redo",variant:"ghost",size:"icon",onClick:()=>{var d;return(d=n.current)==null?void 0:d.redo()},disabled:!s,children:v.jsx(Dk,{})}),v.jsx(Vv,{editorRef:n,blockMarker:o}),v.jsx(Ht,{"aria-label":"Insert footnote",title:"Insert footnote",variant:"ghost",size:"icon",onClick:a,children:v.jsx(Kk,{})}),v.jsx(Ht,{"aria-label":"Insert cross-reference",title:"Insert cross-reference",variant:"ghost",size:"icon",onClick:l,children:v.jsx(Fk,{})}),v.jsx(Ht,{"aria-label":"Insert endnote",title:"Insert endnote",variant:"ghost",size:"icon",onClick:c,children:v.jsx(Rk,{})})]})]})})}Gv.__docgenInfo={description:"",methods:[],displayName:"PlatformToolbar",props:{editorRef:{required:!0,tsType:{name:"RefObject",elements:[{name:"union",raw:"MarginalRef | EditorRef | null",elements:[{name:"MarginalRef"},{name:"EditorRef"},{name:"null"}]}],raw:"RefObject<MarginalRef | EditorRef | null>"},description:""},scrRef:{required:!0,tsType:{name:"SerializedVerseRef"},description:""},onScrRefChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(scrRef: SerializedVerseRef) => void",signature:{arguments:[{type:{name:"SerializedVerseRef"},name:"scrRef"}],return:{name:"void"}}},description:""},isReadonly:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},canUndo:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},canRedo:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},blockMarker:{required:!1,tsType:{name:"string"},description:""}}};function di(n,e,t){var d,h,g,m;const r=x.useRef(null),[i,s]=x.useState(t),[o,a]=x.useState(!1),[l,c]=x.useState(!1),[u,f]=x.useState();return v.jsxs(Yf,{viewMode:e.viewMode,description:((g=(h=(d=e.parameters)==null?void 0:d.docs)==null?void 0:h.description)==null?void 0:g.story)??((m=e.parameters)==null?void 0:m.description),children:[v.jsx(Gv,{editorRef:r,scrRef:i,onScrRefChange:s,isReadonly:!1,canUndo:o,canRedo:l,blockMarker:u}),v.jsx(ps,{...n,ref:r,scrRef:i,onScrRefChange:s,onStateChange:(y,b,_)=>{a(y),c(b),f(_)}})]})}di.__docgenInfo={description:`Render function that combines the Editorial component with a PlatformToolbar. This provides a
complete editing experience with undo/redo, navigation, and other toolbar features.

Use this as a render function in a Storybook story, not as a component.`,methods:[],displayName:"renderEditorialWithToolbar"};const ZA='<usx version="3.1" />',eO=xd(ZA),tO=`<?xml version="1.0" encoding="utf-8"?>
<usx version="3.1">
  <book code="PSA" style="id">World English Bible (WEB)</book>
  <para style="mt1">The Psalms</para>
  <chapter number="1" style="c" sid="PSA 1" />
  <para style="q1">
    <verse number="1" style="v" sid="PSA 1:1" />Blessed is the man who doesn’t walk in the counsel of the wicked<note caller="+" style="f"><char style="fr">1:1 </char><char style="ft">Or "sinful"</char></note>,</para>
  <para style="q2" vid="PSA 1:1">nor stand on the path<note caller="+" style="f"><char style="fr">1:1 </char><char style="ft">Hebrew: "way"</char></note> of sinners,</para>
  <para style="q2" vid="PSA 1:1">nor sit in the seat of scoffers;<verse eid="PSA 1:1" /></para>
  <para style="q1">
    <verse number="2" style="v" sid="PSA 1:2" /><note caller="+" style="f"><char style="fr" closed="false">1:2 </char><char style="ft" closed="false">After verse</char></note> but his delight is in Yahweh’s<note caller="+" style="f"><char style="fr" closed="false">1:2 </char><char style="ft" closed="false">“Yahweh” is God’s proper Name, sometimes rendered “LORD” (all caps) in other translations.</char></note> law.<note caller="+" style="f"><char style="fr" closed="false">1:2 </char><char style="ft" closed="false">End of Para</char></note></para>
  <para style="q2" vid="PSA 1:2">On his law he meditates day and night.<note caller="+" style="f"><char style="fr" closed="false">1:2 </char><char style="ft" closed="false">End of Doc</char></note><verse eid="PSA 1:2" /></para>
</usx>
`,xn=xd(tO),nO={start:{jsonPath:"$.content[3].content[1]",offset:15},end:{jsonPath:"$.content[3].content[1]",offset:18}},rO={start:{jsonPath:"$.content[3].content[1]",offset:15},end:{jsonPath:"$.content[3].content[1]",offset:22}},iO=`<?xml version="1.0" encoding="utf-8"?>
<usx version="3.1">
  <book code="PSA" style="id">תהילים</book>
  <para style="mt1">תהילים</para>
  <chapter number="1" style="c" sid="PSA 1" />
  <para style="q1">
    <verse number="1" style="v" sid="PSA 1:1" />אשרי האיש אשר לא הלך בעצת רשעים,</para>
  <para style="q2" vid="PSA 1:1">ובדרך חטאים לא עמד,</para>
  <para style="q2" vid="PSA 1:1">ובמושב לצים לא ישב.<verse eid="PSA 1:1" /></para>
  <para style="q1">
    <verse number="2" style="v" sid="PSA 1:2" />כי אם בתורת יהוה חפצו,</para>
  <para style="q2" vid="PSA 1:2">ובתורתו יהגה יומם ולילה.<verse eid="PSA 1:2" /></para>
</usx>
`,sO=xd(iO),oO=(n,e,t)=>n==="generated"?v.jsxs(v.Fragment,{children:[v.jsx("p",{children:"+"})," ",e["%footnoteEditor_callerDropdown_item_generated%"]]}):n==="hidden"?v.jsxs(v.Fragment,{children:[v.jsx("p",{children:"-"})," ",e["%footnoteEditor_callerDropdown_item_hidden%"]]}):v.jsxs(v.Fragment,{children:[v.jsx("p",{children:t})," ",e["%footnoteEditor_callerDropdown_item_custom%"]]});function Yv({callerType:n,updateCallerType:e,customCaller:t,updateCustomCaller:r,localizedStrings:i}){const[s,o]=x.useState(n),[a,l]=x.useState(t);x.useEffect(()=>{o(n)},[n]),x.useEffect(()=>{a!==t&&l(t)},[t]);const c=u=>{u||(s!=="custom"||a?(e(s),r(a)):(o(n),l(t)))};return v.jsxs(Cd,{onOpenChange:c,children:[v.jsx(Ws,{children:v.jsxs(Ks,{children:[v.jsx(Ra,{asChild:!0,children:v.jsx(Sd,{asChild:!0,children:v.jsx(Ht,{variant:"outline",className:"tw-h-6",children:oO(n,i,t)})})}),v.jsx(Hs,{children:i["%footnoteEditor_callerDropdown_tooltip%"]})]})}),v.jsxs(Td,{className:"tw-z-[300]",children:[v.jsx(Fm,{children:i["%footnoteEditor_callerDropdown_label%"]}),v.jsx(qm,{}),v.jsx(zs,{checked:s==="generated",onCheckedChange:()=>o("generated"),children:v.jsxs("div",{className:"tw-flex tw-w-full tw-justify-between",children:[v.jsx("span",{children:i["%footnoteEditor_callerDropdown_item_generated%"]}),v.jsx("span",{className:"tw-w-10 tw-text-center",children:vn})]})}),v.jsx(zs,{checked:s==="hidden",onCheckedChange:()=>o("hidden"),children:v.jsxs("div",{className:"tw-flex tw-w-full tw-justify-between",children:[v.jsx("span",{children:i["%footnoteEditor_callerDropdown_item_hidden%"]}),v.jsx("span",{className:"tw-w-10 tw-text-center",children:Gi})]})}),v.jsx(zs,{checked:s==="custom",onCheckedChange:()=>o("custom"),onSelect:u=>u.preventDefault(),children:v.jsxs("div",{className:"tw-flex tw-w-full tw-justify-between",children:[v.jsx("span",{children:i["%footnoteEditor_callerDropdown_item_custom%"]}),v.jsx(vk,{className:"tw-h-auto tw-w-10 tw-p-0 tw-text-center",value:a,maxLength:1,onChange:u=>l(u.target.value)})]})})]})]})}Yv.__docgenInfo={description:"",methods:[],displayName:"FootnoteCallerDropdown",props:{callerType:{required:!0,tsType:{name:"union",raw:"'generated' | 'hidden' | 'custom'",elements:[{name:"literal",value:"'generated'"},{name:"literal",value:"'hidden'"},{name:"literal",value:"'custom'"}]},description:"The caller type value to pass to the dropdown"},updateCallerType:{required:!0,tsType:{name:"signature",type:"function",raw:"(newCallerType: FootnoteCallerType) => void",signature:{arguments:[{type:{name:"union",raw:"'generated' | 'hidden' | 'custom'",elements:[{name:"literal",value:"'generated'"},{name:"literal",value:"'hidden'"},{name:"literal",value:"'custom'"}]},name:"newCallerType"}],return:{name:"void"}}},description:"Function to update the caller type"},customCaller:{required:!0,tsType:{name:"string"},description:"The custom caller to pass to the custom caller input field"},updateCustomCaller:{required:!0,tsType:{name:"signature",type:"function",raw:"(newCustomCaller: string) => void",signature:{arguments:[{type:{name:"string"},name:"newCustomCaller"}],return:{name:"void"}}},description:"FUnction to update the custom caller"},localizedStrings:{required:!0,tsType:{name:"signature",type:"object",raw:`{
  [localizedKey in (typeof FOOTNOTE_EDITOR_STRING_KEYS)[number]]?: string;
}`,signature:{properties:[{key:{name:"unknown[number]",raw:"(typeof FOOTNOTE_EDITOR_STRING_KEYS)[number]",required:!1},value:{name:"string"}}]}},description:"Localized strings from the parent component"}}};const aO=(n,e)=>n==="f"?v.jsxs(v.Fragment,{children:[v.jsx(Bm,{})," ",e["%footnoteEditor_noteType_footnote_label%"]]}):n==="fe"?v.jsxs(v.Fragment,{children:[v.jsx(Um,{})," ",e["%footnoteEditor_noteType_endNote_label%"]]}):v.jsxs(v.Fragment,{children:[v.jsx(zk,{})," ",e["%footnoteEditor_noteType_crossReference_label%"]]}),lO=(n,e)=>{if(n==="x")return e["%footnoteEditor_noteType_crossReference_label%"];let t=e["%footnoteEditor_noteType_endNote_label%"];return n==="f"&&(t=e["%footnoteEditor_noteType_footnote_label%"]),kk(e["%footnoteEditor_noteType_tooltip%"]??"",{noteType:t})};function Xv({noteType:n,handleNoteTypeChange:e,localizedStrings:t}){return v.jsxs(Cd,{children:[v.jsx(Ws,{children:v.jsxs(Ks,{children:[v.jsx(bk,{asChild:!0,children:v.jsx(Sd,{asChild:!0,children:v.jsx(Ht,{variant:"outline",className:"tw-h-6 disabled:tw-pointer-events-auto",disabled:n==="x",children:aO(n,t)})})}),v.jsx(Hs,{children:v.jsx("p",{children:lO(n,t)})})]})}),n!=="x"&&v.jsxs(Td,{className:"tw-z-[300]",children:[v.jsx(Fm,{children:t["%footnoteEditor_noteTypeDropdown_label%"]}),v.jsx(qm,{}),v.jsxs(zs,{checked:n==="f",onCheckedChange:()=>e("f"),className:"tw-gap-2",children:[v.jsx(Bm,{}),v.jsx("span",{children:t["%footnoteEditor_noteType_footnote_label%"]})]}),v.jsxs(zs,{checked:n==="fe",onCheckedChange:()=>e("fe"),className:"tw-gap-2",children:[v.jsx(Um,{}),v.jsx("span",{children:t["%footnoteEditor_noteType_endNote_label%"]})]})]})]})}Xv.__docgenInfo={description:"",methods:[],displayName:"FootnoteTypeDropdown",props:{noteType:{required:!0,tsType:{name:"string"},description:""},handleNoteTypeChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(newNoteType: string) => void",signature:{arguments:[{type:{name:"string"},name:"newNoteType"}],return:{name:"void"}}},description:""},localizedStrings:{required:!0,tsType:{name:"signature",type:"object",raw:`{
  [localizedKey in (typeof FOOTNOTE_EDITOR_STRING_KEYS)[number]]?: string;
}`,signature:{properties:[{key:{name:"unknown[number]",raw:"(typeof FOOTNOTE_EDITOR_STRING_KEYS)[number]",required:!1},value:{name:"string"}}]}},description:""}}};function Qv({noteOps:n,onSave:e,onClose:t,scrRef:r,noteKey:i,editorOptions:s,localizedStrings:o}){const a=x.useRef(null),l=x.createRef(),[c,u]=x.useState("generated"),[f,d]=x.useState("*"),[h,g]=x.useState("f"),m=x.useMemo(()=>({...s,markerMenuTrigger:s.markerMenuTrigger??"\\",hasExternalUI:!0,view:{...s.view??hs(),noteMode:"expanded"}}),[s]);x.useEffect(()=>{var w;(w=a.current)==null||w.focus()}),x.useEffect(()=>{var O,M;let w;const T=n==null?void 0:n.at(0);if(T&&Dn("note",T)){const j=(O=T.insert.note)==null?void 0:O.caller;let A="custom";j===vn?A="generated":j===Gi?A="hidden":j&&d(j),u(A),g(((M=T.insert.note)==null?void 0:M.style)??"f"),T.insert.note&&(T.insert.note.caller=""),w=setTimeout(()=>{var $;($=a.current)==null||$.applyUpdate([{delete:1},T])},0)}return()=>{w&&clearTimeout(w)}},[n,i]);const y=x.useCallback(()=>{var T,O;const w=(O=(T=a.current)==null?void 0:T.getNoteOps(0))==null?void 0:O.at(0);w&&Dn("note",w)&&(w.insert.note&&(c==="custom"?w.insert.note.caller=f:w.insert.note.caller=c==="generated"?vn:Gi),e([w]))},[c,f,e]),b=()=>{var T;const w=(T=l.current)==null?void 0:T.getElementsByClassName("editor-input")[0];w!=null&&w.textContent&&navigator.clipboard.writeText(w.textContent)},_=w=>{var O,M,j;g(w);const T=(M=(O=a.current)==null?void 0:O.getNoteOps(0))==null?void 0:M.at(0);T&&Dn("note",T)&&(T.insert.note&&(T.insert.note.style=w),(j=a.current)==null||j.applyUpdate([{delete:1},T]))};return v.jsxs("div",{className:"footnote-editor tw-grid tw-gap-[12px]",children:[v.jsxs("div",{className:"tw-flex",children:[v.jsxs("div",{className:"tw-flex tw-gap-4",children:[v.jsx(Xv,{noteType:h,handleNoteTypeChange:_,localizedStrings:o}),v.jsx(Yv,{callerType:c,updateCallerType:u,customCaller:f,updateCustomCaller:d,localizedStrings:o})]}),v.jsxs("div",{className:"tw-flex tw-w-full tw-justify-end tw-gap-4",children:[v.jsx(Ws,{children:v.jsxs(Ks,{children:[v.jsx(Ra,{asChild:!0,children:v.jsx(Ht,{onClick:t,className:"tw-h-6 tw-w-6",size:"icon",variant:"secondary",children:v.jsx(wk,{})})}),v.jsx(Hs,{children:v.jsx("p",{children:o["%footnoteEditor_cancelButton_tooltip%"]})})]})}),v.jsx(Ws,{children:v.jsxs(Ks,{children:[v.jsx(Ra,{asChild:!0,children:v.jsx(Ht,{onClick:y,className:"tw-h-6 tw-w-6",size:"icon",variant:"default",children:v.jsx(xk,{})})}),v.jsx(Hs,{children:o["%footnoteEditor_saveButton_tooltip%"]})]})})]})]}),v.jsxs("div",{ref:l,className:"tw-relative tw-rounded-[6px] tw-border-2 tw-border-ring",children:[v.jsx(ps,{options:m,onScrRefChange:()=>{},scrRef:r,ref:a}),v.jsx("div",{className:"tw-absolute tw-bottom-0 tw-right-0",children:v.jsx(Ws,{children:v.jsxs(Ks,{children:[v.jsx(Ra,{asChild:!0,children:v.jsx(Ht,{onClick:b,className:"tw-h-6 tw-w-6",variant:"ghost",size:"icon",children:v.jsx(Ck,{})})}),v.jsx(Hs,{children:v.jsx("p",{children:o["%footnoteEditor_copyButton_tooltip%"]})})]})})})]})]})}Qv.__docgenInfo={description:`Component to edit footnotes from within the editor component

@param usj The raw usj of the footnote to edit
@param parentRef The ref of the parent editor component
@returns`,methods:[],displayName:"FootnoteEditor",props:{noteOps:{required:!0,tsType:{name:"union",raw:"DeltaOpInsertNoteEmbed[] | undefined",elements:[{name:"Array",elements:[{name:"DeltaOpInsertNoteEmbed"}],raw:"DeltaOpInsertNoteEmbed[]"},{name:"undefined"}]},description:"Delta ops for the current note being edited that are applied to the note editorial"},onSave:{required:!0,tsType:{name:"signature",type:"function",raw:"(noteOps: DeltaOpInsertNoteEmbed[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"DeltaOpInsertNoteEmbed"}],raw:"DeltaOpInsertNoteEmbed[]"},name:"noteOps"}],return:{name:"void"}}},description:"External function to handle saving changes to the footnote"},onClose:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:`External function to handle closing the footnote editor. Gets called when the editor is closed
without saving changes`},scrRef:{required:!0,tsType:{name:"SerializedVerseRef"},description:"The scripture reference for the parent editor"},noteKey:{required:!0,tsType:{name:"union",raw:"string | undefined",elements:[{name:"string"},{name:"undefined"}]},description:"The unique note key to identify the note being edited used to apply changes to the note"},editorOptions:{required:!0,tsType:{name:"EditorOptions"},description:"View options of the parent editor"},localizedStrings:{required:!0,tsType:{name:"signature",type:"object",raw:`{
  [localizedKey in (typeof FOOTNOTE_EDITOR_STRING_KEYS)[number]]?: string;
}`,signature:{properties:[{key:{name:"unknown[number]",raw:"(typeof FOOTNOTE_EDITOR_STRING_KEYS)[number]",required:!1},value:{name:"string"}}]}},description:"Localized strings to be passed to the footnote editor component"}}};const Et={book:"PSA",chapterNum:1,verseNum:1},C$={title:"Demo/Editorial",component:ps,tags:["autodocs"],parameters:{docs:{description:{component:`
**Demo Only:** This component is provided for demonstration purposes only. For production applications, developers should import the Scripture Editor component directly from:
- npm [@eten-tech-foundation/platform-editor](https://www.npmjs.com/package/@eten-tech-foundation/platform-editor)
- github [eten-tech-foundation/platform-editor](https://github.com/eten-tech-foundation/scripture-editors/tree/main/packages/platform)

This demo version is included in Storybook to showcase the component's functionality and usage patterns.

**Known Limitation:** In the Docs view, all story examples may show the same note caller style due to global state management in the editor component. To see the correct note caller behavior for each story (default lowercase letters vs custom symbols), please view the individual stories in the Canvas view instead of the Docs view.
        `}}},argTypes:{ref:{control:"object",description:"Reference to the editor instance",defaultValue:null},defaultUsj:{control:"object",description:"Default USJ object to initialize the editor with",defaultValue:{type:Qs,version:Zs,content:[""]}},scrRef:{control:"object",description:"Scripture reference",defaultValue:Et},options:{control:"object",description:"Options to configure the editor (EditorOptions)",defaultValue:{},table:{type:{summary:"EditorOptions",detail:'{ isReadonly?: boolean; hasSpellCheck?: boolean; textDirection?: "ltr" | "rtl" | "auto"; markerMenuTrigger?: string; nodes?: UsjNodeOptions; }'}}}}},xa={args:{defaultUsj:xn,scrRef:Et}},Ca={args:{defaultUsj:eO,scrRef:Et}},Sa={args:{defaultUsj:xn,scrRef:Et,options:{isReadonly:!0}}},Ta={render:(n,e)=>di(n,e,Et),parameters:{docs:{description:{story:'Right-to-left example using a Hebrew snippet (Psalm 1:1). The editor is set to RTL via _options.textDirection = "rtl"_. If you want the UI (tab toolbar) to be RTL click **Switch direction** in the Storybook toolbar.'}}},args:{defaultUsj:sO,options:{hasExternalUI:!0,textDirection:"rtl"}}},Ea={render:n=>{const e=x.useRef(null);return x.useEffect(()=>{const t=setTimeout(()=>{e.current&&(e.current.addAnnotation(nO,"spelling","annotationId"),e.current.addAnnotation(rO,"grammar","abc123"))},0);return()=>clearTimeout(t)},[]),v.jsx(ps,{...n,ref:e})},args:{defaultUsj:xn,scrRef:Et}},cO={hasExternalUI:!0,view:{...hs(),noteMode:"expandInline"},nodes:{noteCallerOnClick:(n,e,t,r,i)=>{t||(r()===vn?i(Gi):i(vn))}}},Na={render:(n,e)=>di(n,e,Et),parameters:{docs:{description:{story:"This story demonstrates editing notes inline. Move your cursor to a note caller and the note will expand and can be edited. Move the cursor out of the note and it will collapse. Click the expanded note caller to toggle between the auto-generated caller and the hidden caller."}}},args:{defaultUsj:xn,options:cO}},uO={hasExternalUI:!0,view:{...hs(),noteMode:"expandInline"}},Ma={render:(n,e)=>di(n,e,Et),parameters:{docs:{description:{story:'This story demonstrates inserting notes. Use the Project menu (hamburger) or the toolbar buttons above the editor to insert footnotes, cross-references, and endnotes at the current cursor position. Selecting text before inserting a footnote will use that text as the footnote quote. You can also insert by typing "\\f", "\\x", or "\\fe".'}}},args:{defaultUsj:xn,options:uO}},dO={hasExternalUI:!0,nodes:{noteCallers:["①","②","③","④","⑤","⑥","⑦","⑧","⑨","⑩"],noteCallerOnClick:(n,e,t,r,i,s)=>{console.log("Note caller clicked:",n,e,t,r,i,s),alert("Note caller clicked! Check console for details.")}}},Aa={render:(n,e)=>di(n,e,Et),parameters:{docs:{description:{story:"This story demonstrates custom note callers and click handling. **Try clicking on the circled number footnote markers (① ②) in the text to see the click handler in action!** The click event will show an alert and log details to the browser console."}}},args:{defaultUsj:xn,options:dO}},Oa={render:(n,e)=>di(n,e,Et),parameters:{docs:{description:{story:'This story demonstrates using a custom marker menu trigger key. **Try typing "?" (question mark) anywhere in the editor text to open the marker menu!** The default trigger is "\\\\" (backslash), but this story changes it to "?" for demonstration. The marker menu allows you to insert USFM markers into the text.'}}},args:{defaultUsj:xn,options:{hasExternalUI:!0,markerMenuTrigger:"?"}}},fO={"%footnoteEditor_callerDropdown_label%":"Footnote caller","%footnoteEditor_callerDropdown_item_generated%":"Auto-generated","%footnoteEditor_callerDropdown_item_hidden%":"Hidden","%footnoteEditor_callerDropdown_item_custom%":"Custom","%footnoteEditor_callerDropdown_tooltip%":"Footnote caller","%footnoteEditor_cancelButton_tooltip%":"Cancel","%footnoteEditor_copyButton_tooltip%":"Copy footnote","%footnoteEditor_noteType_crossReference_label%":"Cross reference","%footnoteEditor_noteType_endNote_label%":"Endnote","%footnoteEditor_noteType_footnote_label%":"Footnote","%footnoteEditor_noteType_tooltip%":"Change type: Footnote","%footnoteEditor_noteTypeDropdown_label%":"Type","%footnoteEditor_saveButton_tooltip%":"Save"},$a={render:n=>{const e=x.useRef(null),t=x.useRef(),r=x.useRef(),[i,s]=x.useState(),[o,a]=x.useState(),[l,c]=x.useState(),[u,f]=x.useState(),d=x.useMemo(()=>({markerMode:"hidden",noteMode:"collapsed",hasSpacing:!0,isFormattedFont:!0}),[]),h=x.useMemo(()=>({...n.options??{},nodes:{noteCallerOnClick:(b,_,w,T,O,M)=>{var A;const j=b.currentTarget.getBoundingClientRect();if(s(j.left),a(j.top),c(j.height),w){if(t.current)return;const $=(A=M())==null?void 0:A.at(0);if(!$||!Dn("note",$))return;t.current=_,r.current=[$],f(!0)}}},view:d}),[n.options,d,t]),g=()=>{t.current=void 0,r.current=void 0,f(!1)},m=y=>{var b;t.current&&((b=e.current)==null||b.replaceEmbedUpdate(t.current,y)),g()};return v.jsxs("div",{children:[v.jsx(ps,{...n,options:h,ref:e,onScrRefChange:()=>{}}),v.jsxs(Sk,{open:u,children:[v.jsx(Tk,{className:"tw-absolute",style:{top:o??0,left:i??0,height:l,width:0}}),v.jsx(Ek,{className:"tw-w-[500px] tw-p-[10px]",children:v.jsx(Qv,{noteKey:t.current,noteOps:r.current,onSave:m,onClose:g,scrRef:n.scrRef??Et,editorOptions:h,localizedStrings:fO})})]})]})},parameters:{docs:{description:{story:"This story demonstrates the use of the new footnote editor on the side of the  editorial component"}}},args:{defaultUsj:xn,scrRef:Et,options:{hasExternalUI:!1,markerMenuTrigger:"\\"}}},Ia={render:(n,e)=>{var c,u,f,d;const t=x.useRef(null),[r,i]=x.useState(null),[s,o]=x.useState(!1),a=x.useMemo(()=>({...n.options??{},view:{markerMode:s?"visible":"hidden",hasSpacing:!0,isFormattedFont:!0}}),[n.options,s]);x.useEffect(()=>{var g,m;const h=(m=(g=t.current)==null?void 0:g.toolbarEndRef)==null?void 0:m.current;if(h)i(h);else{const y=window.setTimeout(()=>{var _,w;const b=(w=(_=t.current)==null?void 0:_.toolbarEndRef)==null?void 0:w.current;b&&i(b)},0);return()=>window.clearTimeout(y)}},[a]);const l=x.useCallback(()=>o(h=>!h),[]);return v.jsxs(Yf,{viewMode:e.viewMode,description:((f=(u=(c=e.parameters)==null?void 0:c.docs)==null?void 0:u.description)==null?void 0:f.story)??((d=e.parameters)==null?void 0:d.description),children:[v.jsx(ps,{...n,options:a,ref:t}),r&&Ot.createPortal(v.jsx("button",{type:"button",title:"Show/hide markers","aria-label":"Show/hide markers","aria-pressed":s,className:`toolbar-item ${s?"active":""}`,onClick:l,children:v.jsx("span",{className:"icon pilcrow-icon","aria-hidden":"true",children:"¶"})}),r)]})},parameters:{docs:{description:{story:"This story demonstrates the Markers view, which shows USFM markers inline with the text. Click the **Show/hide markers** (¶) button in the editor toolbar to toggle the Markers view on and off. "}}},args:{defaultUsj:xn,scrRef:Et}},Pa={name:"View Options",render:(n,e)=>di(n,e,Et),parameters:{docs:{description:{story:'Demonstrates the editor view options (marker visibility, spacing, and formatted font) using USX input. Below in the **Controls** tab, try changing the **options.view** values to see how they affect the editor display. Valid values for **markerMode** are _"hidden"_, _"visible"_, and _"editable"_. Valid values for **noteMode** are _"collapsed"_, _"expandInline"_, and _"expanded"_.'}}},args:{defaultUsj:xn,options:{hasExternalUI:!0,view:{markerMode:"hidden",noteMode:"collapsed",hasSpacing:!0,isFormattedFont:!0}}}};var nm,rm,im;xa.parameters={...xa.parameters,docs:{...(nm=xa.parameters)==null?void 0:nm.docs,source:{originalSource:`{
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef
  }
}`,...(im=(rm=xa.parameters)==null?void 0:rm.docs)==null?void 0:im.source}}};var sm,om,am;Ca.parameters={...Ca.parameters,docs:{...(sm=Ca.parameters)==null?void 0:sm.docs,source:{originalSource:`{
  args: {
    defaultUsj: usjEmpty,
    scrRef: defaultScrRef
  }
}`,...(am=(om=Ca.parameters)==null?void 0:om.docs)==null?void 0:am.source}}};var lm,cm,um;Sa.parameters={...Sa.parameters,docs:{...(lm=Sa.parameters)==null?void 0:lm.docs,source:{originalSource:`{
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef,
    options: {
      isReadonly: true
    }
  }
}`,...(um=(cm=Sa.parameters)==null?void 0:cm.docs)==null?void 0:um.source}}};var dm,fm,hm;Ta.parameters={...Ta.parameters,docs:{...(dm=Ta.parameters)==null?void 0:dm.docs,source:{originalSource:`{
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'Right-to-left example using a Hebrew snippet (Psalm 1:1). ' + 'The editor is set to RTL via _options.textDirection = "rtl"_. If you want the UI ' + '(tab toolbar) to be RTL click **Switch direction** in the Storybook toolbar.'
      }
    }
  },
  args: {
    defaultUsj: usjHebrew,
    options: {
      hasExternalUI: true,
      textDirection: 'rtl'
    }
  }
}`,...(hm=(fm=Ta.parameters)==null?void 0:fm.docs)==null?void 0:hm.source}}};var pm,gm,mm;Ea.parameters={...Ea.parameters,docs:{...(pm=Ea.parameters)==null?void 0:pm.docs,source:{originalSource:`{
  render: args => {
    // eslint-disable-next-line no-null/no-null
    const editorRef = useRef<EditorRef | null>(null);
    useEffect(() => {
      const timeoutId = setTimeout(() => {
        if (editorRef.current) {
          editorRef.current.addAnnotation(annotationRangeWeb1, 'spelling', 'annotationId');
          editorRef.current.addAnnotation(annotationRangeWeb2, 'grammar', 'abc123');
        }
      }, 0);
      return () => clearTimeout(timeoutId);
    }, []);
    return <Editorial {...args} ref={editorRef} />;
  },
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef
  }
}`,...(mm=(gm=Ea.parameters)==null?void 0:gm.docs)==null?void 0:mm.source}}};var ym,_m,bm;Na.parameters={...Na.parameters,docs:{...(ym=Na.parameters)==null?void 0:ym.docs,source:{originalSource:`{
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates editing notes inline. Move your cursor to a note caller and ' + 'the note will expand and can be edited. Move the cursor out of the note and it will ' + 'collapse. Click the expanded note caller to toggle between the auto-generated caller ' + 'and the hidden caller.'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    options: inlineNoteOptions
  }
}`,...(bm=(_m=Na.parameters)==null?void 0:_m.docs)==null?void 0:bm.source}}};var vm,km,wm;Ma.parameters={...Ma.parameters,docs:{...(vm=Ma.parameters)==null?void 0:vm.docs,source:{originalSource:`{
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates inserting notes. Use the Project menu (hamburger) or the ' + 'toolbar buttons above the editor to insert footnotes, cross-references, and endnotes ' + 'at the current cursor position. Selecting text before inserting a footnote will use ' + 'that text as the footnote quote. You can also insert by typing "\\\\f", "\\\\x", or "\\\\fe".'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    options: insertNoteOptions
  }
}`,...(wm=(km=Ma.parameters)==null?void 0:km.docs)==null?void 0:wm.source}}};var xm,Cm,Sm;Aa.parameters={...Aa.parameters,docs:{...(xm=Aa.parameters)==null?void 0:xm.docs,source:{originalSource:`{
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates custom note callers and click handling. **Try clicking on the ' + 'circled number footnote markers (① ②) in the text to see the click handler in ' + 'action!** The click event will show an alert and log details to the browser console.'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    options: customNodeOptions
  }
}`,...(Sm=(Cm=Aa.parameters)==null?void 0:Cm.docs)==null?void 0:Sm.source}}};var Tm,Em,Nm;Oa.parameters={...Oa.parameters,docs:{...(Tm=Oa.parameters)==null?void 0:Tm.docs,source:{originalSource:`{
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates using a custom marker menu trigger key. **Try typing "?" ' + '(question mark) anywhere in the editor text to open the marker menu!** The default ' + 'trigger is "\\\\\\\\" (backslash), but this story changes it to "?" for demonstration. ' + 'The marker menu allows you to insert USFM markers into the text.'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    options: {
      hasExternalUI: true,
      markerMenuTrigger: '?'
    }
  }
}`,...(Nm=(Em=Oa.parameters)==null?void 0:Em.docs)==null?void 0:Nm.source}}};var Mm,Am,Om;$a.parameters={...$a.parameters,docs:{...(Mm=$a.parameters)==null?void 0:Mm.docs,source:{originalSource:`{
  render: args => {
    // eslint-disable-next-line no-null/no-null
    const editorRef = useRef<EditorRef | null>(null);
    const noteKey = useRef<string>();
    const noteOps = useRef<DeltaOpInsertNoteEmbed[]>();
    const [popoverX, setPopoverX] = useState<number>();
    const [popoverY, setPopoverY] = useState<number>();
    const [popoverHeight, setPopoverHeight] = useState<number>();
    const [showFootnoteEditor, setShowFootnoteEditor] = useState<boolean>();
    const viewOptions = useMemo<ViewOptions>(() => ({
      markerMode: 'hidden',
      noteMode: 'collapsed',
      hasSpacing: true,
      isFormattedFont: true
    }), []);
    const mergedOptions = useMemo<EditorOptions>(() => {
      const base = args.options ?? {};
      return {
        ...base,
        nodes: {
          noteCallerOnClick: (event, noteNodeKey, isCollapsed, _getCaller, _setCaller, getNoteOps) => {
            const targetRect = event.currentTarget.getBoundingClientRect();
            setPopoverX(targetRect.left);
            setPopoverY(targetRect.top);
            setPopoverHeight(targetRect.height);
            if (isCollapsed) {
              // (event as SyntheticEvent<)
              if (noteKey.current) return;

              // Makes sure the note op is the correct type and is defined
              const noteOp = getNoteOps()?.at(0);
              if (!noteOp || !isInsertEmbedOpOfType('note', noteOp)) return;
              noteKey.current = noteNodeKey;
              noteOps.current = [noteOp];
              setShowFootnoteEditor(true);
            }
          }
        },
        view: viewOptions
      };
    }, [args.options, viewOptions, noteKey]);
    const onEditorClose = () => {
      noteKey.current = undefined;
      noteOps.current = undefined;
      setShowFootnoteEditor(false);
    };
    const onEditorSave = (newNoteOps: DeltaOp[]) => {
      if (noteKey.current) {
        editorRef.current?.replaceEmbedUpdate(noteKey.current, newNoteOps);
      }
      onEditorClose();
    };
    return <div>
        <Editorial {...args} options={mergedOptions} ref={editorRef} onScrRefChange={() => undefined} />
        <Popover open={showFootnoteEditor}>
          <PopoverAnchor className="tw-absolute" style={{
          top: popoverY ?? 0,
          left: popoverX ?? 0,
          height: popoverHeight,
          width: 0
        }} />
          <PopoverContent className="tw-w-[500px] tw-p-[10px]">
            <FootnoteEditor noteKey={noteKey.current} noteOps={noteOps.current} onSave={onEditorSave} onClose={onEditorClose} scrRef={args.scrRef ?? defaultScrRef} editorOptions={mergedOptions} localizedStrings={sampleFootnoteEditorLocalizedStrings} />
          </PopoverContent>
        </Popover>
      </div>;
  },
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates the use of the new footnote editor on the side of the ' + ' editorial component'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef,
    options: {
      hasExternalUI: false,
      markerMenuTrigger: '\\\\'
    }
  }
}`,...(Om=(Am=$a.parameters)==null?void 0:Am.docs)==null?void 0:Om.source}}};var $m,Im,Pm;Ia.parameters={...Ia.parameters,docs:{...($m=Ia.parameters)==null?void 0:$m.docs,source:{originalSource:`{
  render: (args, context) => {
    // eslint-disable-next-line no-null/no-null
    const editorRef = useRef<EditorRef | null>(null);
    // eslint-disable-next-line no-null/no-null
    const [toolbarEndEl, setToolbarEndEl] = useState<HTMLElement | null>(null);
    const [showMarkers, setShowMarkers] = useState(false);
    const mergedOptions = useMemo(() => {
      const base = args.options ?? {};
      const view: ViewOptions = {
        markerMode: showMarkers ? 'visible' : 'hidden',
        hasSpacing: true,
        isFormattedFont: true
      };
      return {
        ...base,
        view
      };
    }, [args.options, showMarkers]);
    useEffect(() => {
      const el = editorRef.current?.toolbarEndRef?.current;
      if (el) setToolbarEndEl(el);else {
        // Retry once on next tick in case the toolbar mounts after the ref effect
        const id = window.setTimeout(() => {
          const el2 = editorRef.current?.toolbarEndRef?.current;
          if (el2) setToolbarEndEl(el2);
        }, 0);
        return () => window.clearTimeout(id);
      }
      return undefined;
    }, [mergedOptions]);
    const handleShowMarkerToggle = useCallback(() => setShowMarkers(v => !v), []);
    return <CanvasWithDescription viewMode={context.viewMode} description={context.parameters?.docs?.description?.story ?? context.parameters?.description}>
        <Editorial {...args} options={mergedOptions} ref={editorRef} />
        {toolbarEndEl && createPortal(<button type="button" title="Show/hide markers" aria-label="Show/hide markers" aria-pressed={showMarkers} className={\`toolbar-item \${showMarkers ? 'active' : ''}\`} onClick={handleShowMarkerToggle}>
              <span className="icon pilcrow-icon" aria-hidden="true">
                ¶
              </span>
            </button>, toolbarEndEl)}
      </CanvasWithDescription>;
  },
  parameters: {
    docs: {
      description: {
        story: 'This story demonstrates the Markers view, which shows USFM markers inline with the ' + 'text. Click the **Show/hide markers** (¶) button in the editor toolbar to toggle the ' + 'Markers view on and off. '
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    scrRef: defaultScrRef
  }
}`,...(Pm=(Im=Ia.parameters)==null?void 0:Im.docs)==null?void 0:Pm.source}}};var Rm,jm,Dm;Pa.parameters={...Pa.parameters,docs:{...(Rm=Pa.parameters)==null?void 0:Rm.docs,source:{originalSource:`{
  name: 'View Options',
  render: (args, context) => renderEditorialWithToolbar(args, context, defaultScrRef),
  parameters: {
    docs: {
      description: {
        story: 'Demonstrates the editor view options (marker visibility, spacing, and formatted font) ' + 'using USX input. Below in the **Controls** tab, try changing the **options.view** ' + 'values to see how they affect the editor display. Valid values for **markerMode** are ' + '_"hidden"_, _"visible"_, and _"editable"_. Valid values for **noteMode** are ' + '_"collapsed"_, _"expandInline"_, and _"expanded"_.'
      }
    }
  },
  args: {
    defaultUsj: usjWeb,
    options: {
      hasExternalUI: true,
      view: {
        markerMode: 'hidden',
        noteMode: 'collapsed',
        hasSpacing: true,
        isFormattedFont: true
      }
    }
  }
}`,...(Dm=(jm=Pa.parameters)==null?void 0:jm.docs)==null?void 0:Dm.source}}};const S$=["Default","Empty","ReadOnly","RTL","Annotated","InlineNoteEditing","InsertNote","CustomNoteOptions","CustomMarkerTrigger","FootnoteEditorView","MarkersView","ViewOptionsStory"];export{Ea as Annotated,Oa as CustomMarkerTrigger,Aa as CustomNoteOptions,xa as Default,Ca as Empty,$a as FootnoteEditorView,Na as InlineNoteEditing,Ma as InsertNote,Ia as MarkersView,Ta as RTL,Sa as ReadOnly,Pa as ViewOptionsStory,S$ as __namedExportsOrder,C$ as default};
