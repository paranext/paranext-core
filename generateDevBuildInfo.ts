import * as fs from 'fs';
import * as path from 'path';
import { execSync } from 'child_process';

const buildInfoPath = path.resolve(__dirname, 'release/app/buildInfo.json');

// Matches the format of the buildInfo.json file generated by webpack.config.main.prod.ts
const buildInfo = {
  label: 'development',
  id: `${process.env.USERNAME || process.env.USER || 'unknown'}.${new Date()
    .toISOString()
    .replace(/[-:TZ]/g, '')
    .slice(0, 14)}.${execSync('git rev-parse HEAD').toString().trim()}`,
};

// Ensure the directory exists before writing the file
fs.mkdirSync(path.dirname(buildInfoPath), { recursive: true });
fs.writeFileSync(buildInfoPath, JSON.stringify(buildInfo));

// eslint-disable-next-line no-console
console.log(`Generated development buildInfo.json at ${buildInfoPath}`);
